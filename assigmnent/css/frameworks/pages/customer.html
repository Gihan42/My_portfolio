<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>pos system customer page</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link rel="icon" type="image/x-icon" href="/assigmnent/css/frameworks/assests/pos_img/icons8-customer-64.png"  >
    <link rel="stylesheet" href="/assets/fonts/css/all.min.css">
    <!--link Bootstrap Framework-->
    <link href="/assigmnent/css/frameworks/assests/css/bootstrap.min.css" rel="stylesheet">
   <style>
    * {
    margin:0;
    padding:0;
    box-sizing: border-box;
    text-decoration: none;
}
body{
  background-color: white;
}
    .blockquote{
        margin: 40px;
    }
    .card{
        border: 1px solid;
        padding: 10px;
        box-shadow: 5px 10px #dcdadaf2;
        margin: 5px;
        background-color: rgb(237, 239, 240);
    }
    .card-2{
        border: 1px solid;
        padding: 10px;
        box-shadow: 5px 10px #dcdadaf2;
        margin: 0px;
        margin-bottom: 20px;
        background-color: rgb(237, 239, 240);
    }
    .card:hover{
        border: 1px solid rgb(21, 153, 255);
        height: 200px;
        width: 400px;
    }
    .nav-item > a:hover {
        color: rgb(255, 255, 255);
    }
    .row{
      margin-bottom: 5px;
    }
    table{
      height: 180px;
      border: 1px solid rgb(105, 105, 105);
    }
    button{
      margin: 5px;
    }
    .customer{
        margin-top: 80px;
    }
    .tableHead {
        background-color: crimson;
    }
   </style>
</head>
<body>
<!-- navbar -->
<nav class="navbar navbar-expand-lg fixed-top" style="background-color: #a9ff46;">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" style="color: rgb(116, 4, 4); font-size: 25px;">  <img src="/assigmnent/css/frameworks/assests/pos_img/icons8-customer-64.png" alt="cart" width="35" height="28" style="margin: 5px;" >customer </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll" aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarScroll">
        <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/assigmnent/css/frameworks/index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/assigmnent/css/frameworks/pages/customer.html" >customer</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/assigmnent/css/frameworks/pages/item.html">products</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/assigmnent/css/frameworks/pages/order.html">orders</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fa-sharp fa-solid fa-moon"></i></a>
          </li>
        </ul>
        <form class="d-flex" role="search">
          <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success" type="submit" >Search</button>
        </form>
      </div>
    </div>
  </nav>

  <!-- customer form -->
<section id="customer" class="customer">
    <span class="d-block p-2 text-bg-primary">customer form</span><br>
      <!--Nav bar ends-->
      <section class="row container-fluid"> <!--row-->
          <section class="col"> <!--col 1-->
              <!--form starts here-->
              <div class="form-floating mb-3">
                  <input type="email" class="form-control" id="customer-search" placeholder="name@example.com">
                  <label for="floatingInput">NIC / NAME  / ID</label>
              </div>
              <!--form ends here-->
          </section>
          <section class="col"><!--col-2-->
            <button type="button" class="btn btn-secondary" data-bs-target="#exampleModal" data-bs-toggle="modal" id="loadForm" >load customer details</button>
            <button class="btn btn-danger" data-bs-target="#exampleModal" data-bs-toggle="modal" type="button" id="addnewCustomer">
              + add new customer
          </button>
          <!-- new customer -->
          <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="exampleModal" tabindex="-1" id="Customerform" >
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #46b2ff;">
                        <h5 class="modal-title" id="exampleModalLabel">Customer Save</h5>
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                    </div>
                    <div class="modal-body">
                        <section>
                            <div class="mb-3">
                                <label class="form-label" for="formFile">Customer ID</label>
                                <input class="form-control" id="txtcustomerId" type="text">
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="formFileMultiple">Customer Name</label>
                                <input class="form-control" id="txtcustomerName" multiple type="text">
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="formFileDisabled">Customer Address</label>
                                <input class="form-control" id="txtcustomerAddress" type="text">
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="formFileSm">Customer Salary</label>
                                <input class="form-control form-control-sm" id="txtcustomerSalary" type="number">
                            </div>
        
                            <div aria-label="Basic mixed styles example" class="btn-group" role="group">
                                <button class="btn btn-danger" type="button" id="customerDelete">Customer Delete</button>
                                <button class="btn btn-warning" type="button" id="customerUpdate">Update</button>
                                <button class="btn btn-success " type="button" id="save-customer">Save</button>
                                <button class="btn btn-info " type="button" id="getAll-customer">Get-All</button>
                            </div>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Close</button>
                        <button class="btn btn-primary" type="button">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
        
      </section>
      <section class="row"><!--col-2-->
          <section class="col"><!--col-2-->
            <button class="btn btn-outline-success" data-bs-target="#exampleModal" data-bs-toggle="modal" type="button" id="search">ðŸ”Ž Search</button>
              <select class="fctorm-sele" name="names" id="name" style="width: 250px; height: 38px; border: 1px solid black; border-radius: 8px; " >
              </select>
      </section><br><br><br>
      <section class="row"><!--col-2-->
          <section class="col"><!--col-2-->
              <button type="button" class="btn btn-dark">Delete</button>
              <button type="button" class="btn btn-danger" id="details">Details</button>
              <button type="button" class="btn btn-warning">Clear</button>
              </select>
      </section>
  </section>
          </section>
      </section>
      <!--Table contents starts from here-->
      <table class="table table-warning" id="table-customer">
          <thead>
          <tr >
              <th scope="col" id="cusId" class="tableHead">id</th>
              <th scope="col" class="tableHead">name</th>
              <th scope="col" class="tableHead">address</th>
              <th scope="col" class="tableHead">salary</th>
          </tr>
          </thead>
          <tbody id="customer-tablebody">
       
          </tbody>
      </table>
      <!--Table contents ends from here-->
  </section>
  <script src="/assigmnent/css/frameworks/assests/js/bootstrap.min.js"></script>
  <script src="/assigmnent/js/spa/assests/jquery/jquery-3.6.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.34/dist/sweetalert2.all.min.js"></script>
  <script>
    
    var customers=[]
    $('#save-customer').click(function(){
  saveCustomer();
  loadAllCustomers();
  loadDetails();
  doubleClickRemoveRow();
  clear();
  })
  function saveCustomer(){
  Swal.fire({
  position: 'center',
  icon: 'success',
  title: 'Your work has been saved',
  showConfirmButton: false,
  timer: 1500
})
    let customerId=  $('#txtcustomerId').val()
    let custonerName=  $('#txtcustomerName').val()
    let customerAddress=  $('#txtcustomerAddress').val()
    let customerSalary=  $('#txtcustomerSalary').val()

    var custome = {
      customerId,
      custonerName,
      customerAddress,
      customerSalary
    }
  
  customers.push(custome)
  console.log(customers)
  }
  $('#getAll-customer').click(function(){
    loadAllCustomers();
    clear()
  })

  function loadAllCustomers(){
  $('#customer-tablebody').empty()
    for(var i of customers){
      // console.log('customerId='+i.customerId)
      var row=`<tr ><td>${i.customerId}</td><td >${ i.custonerName}</td> <td >${i.customerAddress}</td><td >${i.customerSalary}</td></tr>`;
      $('#customer-tablebody').append(row); 
    }
}
  // SEARCH CUSTOMER
  $('#search').click(function(){
            let typedId = $("#customer-search").val();
            let customer = searchCustomer(typedId);
            if (customer != null) {
                $('#txtcustomerId').val(customer.customerId)
                $('#txtcustomerName').val(customer.custonerName)
                $('#txtcustomerAddress').val(customer.customerAddress)
                $('#txtcustomerSalary').val(customer.customerSalary)
            } else {
                Swal.fire("There is no cusotmer available for that " + typedId)
                setTextfieldValues("", "", "", "");
            }
  })
  
// function findCustomer(){
//   var result=$('#customer-search').val()
//     for(var i of customers ){
//       console.log(i.customerId)
//       if(i.customerId == result ){
//         $('#txtcustomerId').val(i.customerId)
//         $('#txtcustomerName').val(i.custonerName)
//         $('#txtcustomerAddress').val(i.customerAddress)
//         $('#txtcustomerSalary').val(i.customerSalary)
//       }
//     }
//     }
// }

function searchCustomer(cusID) {
        for (let customer of customers) {
            if (customer.customerId == cusID) {
                return customer;
                console.log(customer)
            }
        }
        return null;
    }
    //END SEARCH CUSTOMER

//////CUSTOMER DELETE//////
$('#customerDelete').click(function(){
  let cusId=$("#customer-search").val();
  let option=confirm('Do you want to delete this customer'+cusId)
  if(option){
    if(deleteCustomer(cusId)){
Swal.fire({
  icon: 'delete',
  title: 'Deleted...',
  text: 'Customer Successfully Deleted!',
})
$('#txtcustomerId').val('')
  $('#txtcustomerName').val('')
  $('#txtcustomerAddress').val('')
  $('#txtcustomerSalary').val('')
}
else{
  Swal.fire("No such customer to delete. please check the id" )
}
    }

})
function deleteCustomer(customerID){
  let customer= searchCustomer(customerID)
  if(customer!=null){
    let indexNo= customers.indexOf(customer);
    customers.splice(indexNo,1)
    loadAllCustomers()
    return true;
  }else{
    return false;
  }
}
//////END   CUSTOMER DELETE//////
/////UPDATE CUSTOMER//////
$('#customerUpdate').click(function(){
  let cutomerId=$('#txtcustomerId').val()
  let response=updateCustomer(cutomerId)
  if(response){
    Swal.fire({
  position: 'center',
  icon: 'success',
  title: 'Customer Updated Successfully',
  showConfirmButton: false,
  timer: 1500
})
$('#txtcustomerId').val('')
  $('#txtcustomerName').val('')
  $('#txtcustomerAddress').val('')
  $('#txtcustomerSalary').val('')
  }
  else{
    Swal.fire("Update Failed..!" )
  }
})
function updateCustomer(customerID){
  let customer= searchCustomer(customerID)
  if(customer !=null){
    customer.customerID=$('#txtcustomerId').val()
    customer.custonerName= $('#txtcustomerName').val()
    customer.customerAddress= $('#txtcustomerAddress').val()
    customer.customerSalary= $('#txtcustomerSalary').val()
    loadAllCustomers()
    return true
  }
  else{
    return false
  }
}
////END UPDATE CUSTOMER////
function clear(){
  $('#txtcustomerId').val('')
  $('#txtcustomerName').val('')
  $('#txtcustomerAddress').val('')
  $('#txtcustomerSalary').val('')
}
////////end find customer////////
//CLICK ROW AND SET VALUES TEXT FEILD//////
$('#loadForm').click(function(){
  loadDetails()
})  
function loadDetails(){
$("#customer-tablebody>tr").click(function(){
  let id= $(this).children(':eq(0)').text()
  let name=$(this).children(':eq(1)').text()
  let address=$(this).children(':eq(2)').text()
  let salary=$(this).children(':eq(3)').text()
  console.log(id,name,address,salary)

  $('#txtcustomerId').val(id)
  $('#txtcustomerName').val(name)
  $('#txtcustomerAddress').val(address)
  $('#txtcustomerSalary').val(salary)
})
}
///// DOUBLE CLICK REMOVE ROW /////
function removeRow(){
  $("#customer-tablebody>tr").on('dblclick',function(){
      $(this).remove()
});
}
///// END REMOVE ROW /////
$('#addnewCustomer').click(function(){
  $('#txtcustomerId').focus()
})
///ENTER EVENT  SAVE CUSTOMER & VALIDATION///
$('#txtcustomerId').focus()
$('#txtcustomerId').on('keydown',function(event){
    if(event.key=='Enter'){
            var id = /^(C)[0-9]{3}$/;
            var result = id.test($("#txtcustomerId").val());
            if (result) {
                $("#txtcustomerId").css({
                    'border': '2px solid green'
                })
                $('#txtcustomerName').focus();
            } else {
                $("#txtcustomerId").css({
                    'border-color': 'red'
                })

                $('#txtcustomerId').error='Customer ID Pattern is Wrong : C00-001'
            }
    }
})
$('#txtcustomerName').on('keydown',function(event){
  if(event.key=='Enter'){
    var Name = /^[A-z ]{3,15}$/;
            var result = Name.test($("#txtcustomerName").val());
            console.log(result);

            if (result) {
                $("#txtcustomerName").css({
                    'border-color': 'green'
                })
                     $('#txtcustomerAddress').focus();
            } else {
                $("#txtcustomerName").css({
                    'border-color': 'red'
                })
            }
  }
})
$('#txtcustomerAddress').on('keydown',function(event){
  if(event.key=='Enter'){
            var address=/^[A-z0-9 ,/]{4,20}$/
            var result=address.test($('#txtcustomerAddress').val())
            if(result){
              //no3,Galle
                $('#txtcustomerAddress').css({
                    'border-color': 'green'
                })
                $('#txtcustomerSalary').focus(); 
            }
            else{
                $('#txtcustomerAddress').css({
                    'border-color': 'red'
                })
              }
  }
})
$('#txtcustomerSalary').on('keydown',function(event){
  if(event.key=='Enter'){
    var salary=/^[1-9][0-9]*(.[0-9]{2})?$/;
            var result=salary.test($("#txtcustomerSalary").val())
            if (result){
                $('#txtcustomerSalary').css({
                    'border-color': 'green'
                })
                  confirm('Do you want to save this customer')
                  saveCustomer();
                  loadAllCustomers();
                  clear();
            }
            else{
                $('#txtcustomerSalary').css({
                    'border-color': 'red'
                })
            }
  }
})

////disable tab key of all  text fields
$('#txtcustomerId,#txtcustomerName,#txtcustomerAddress,#txtcustomerSalary').on('keydown',function(event){
  if(event.key=='Tab'){
    event.preventDefault();
  }
})
////END ENTER EVENT & SAVE CUSTOMER///
  </script>

</body>
</html>