/*! Copyright (c) 2022 WhatsApp Inc. All Rights Reserved. */
(self.webpackChunkwhatsapp_web_client=self.webpackChunkwhatsapp_web_client||[]).push([[9209],{363509:(e,t,n)=>{var r={"./f00.png":731213,"./f01.png":8750,"./f02.png":448738,"./f03.png":415494,"./f04.png":115885,"./f05.png":305851,"./f06.png":568540,"./f07.png":930293,"./f08.png":291131,"./f09.png":627879,"./f10.png":808610,"./f11.png":132641,"./f12.png":398479,"./f13.png":925670,"./f14.png":500759,"./f15.png":852264,"./f16.png":686035,"./f17.png":694878,"./f18.png":267514,"./f19.png":23533,"./f20.png":586319,"./f21.png":365664,"./f22.png":310191,"./f23.png":348850,"./f24.png":392553,"./f25.png":853453,"./f26.png":278691,"./f27.png":717430,"./f28.png":640610,"./f29.png":678643,"./f30.png":573434,"./f31.png":854981,"./f32.png":686488,"./f33.png":728881,"./f34.png":371199,"./f35.png":97836,"./f36.png":177985,"./f37.png":173570,"./f38.png":642949,"./f39.png":621404,"./f40.png":721792,"./f41.png":986197,"./f42.png":79685,"./f43.png":139346,"./f44.png":255878,"./f45.png":986904,"./f46.png":186906,"./f47.png":363265,"./f48.png":307029,"./f49.png":139871,"./f50.png":58360,"./f51.png":535277,"./f52.png":163418,"./f53.png":958235,"./f54.png":333929,"./f55.png":133417,"./f56.png":150407,"./f57.png":629423,"./f58.png":232176,"./f59.png":450874,"./f60.png":721578,"./f61.png":622129,"./f62.png":433819,"./f63.png":997359,"./f64.png":239887,"./f65.png":638275,"./f66.png":471673,"./f67.png":621264,"./f68.png":596007,"./f69.png":959163,"./f70.png":91732,"./f71.png":303913,"./f72.png":392293,"./f73.png":851577,"./f74.png":26347,"./f75.png":170345,"./f76.png":760318,"./f77.png":186426,"./f78.png":762002,"./f79.png":349889,"./f80.png":224324,"./f81.png":959354,"./f82.png":874992,"./f83.png":780502,"./f84.png":74260,"./f85.png":64108,"./f86.png":171042,"./f87.png":795563,"./f88.png":264594,"./f89.png":768005,"./f90.png":516888,"./f91.png":352943,"./f92.png":324613,"./f93.png":994922,"./f94.png":518725,"./f95.png":982950,"./f96.png":607251,"./f97.png":617978,"./f98.png":486273,"./f99.png":831666,"./favicon-error.png":715688,"./favicon-error2.png":372174,"./favicon.png":868431};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=363509},276554:(e,t,n)=>{var r={"./f00.png":795203,"./f01.png":266574,"./f02.png":419833,"./f03.png":839974,"./f04.png":586727,"./f05.png":678808,"./f06.png":571258,"./f07.png":464497,"./f08.png":866114,"./f09.png":212430,"./f10.png":729809,"./f11.png":41191,"./f12.png":887642,"./f13.png":26841,"./f14.png":307967,"./f15.png":338817,"./f16.png":965587,"./f17.png":538297,"./f18.png":561665,"./f19.png":316962,"./f20.png":942387,"./f21.png":374420,"./f22.png":584319,"./f23.png":743302,"./f24.png":834444,"./f25.png":114231,"./f26.png":415842,"./f27.png":425925,"./f28.png":810149,"./f29.png":690154,"./f30.png":500701,"./f31.png":727707,"./f32.png":695169,"./f33.png":677763,"./f34.png":898593,"./f35.png":716569,"./f36.png":435807,"./f37.png":382439,"./f38.png":841360,"./f39.png":493127,"./f40.png":162369,"./f41.png":955876,"./f42.png":31990,"./f43.png":36009,"./f44.png":924580,"./f45.png":61400,"./f46.png":578354,"./f47.png":527020,"./f48.png":127961,"./f49.png":608725,"./f50.png":725129,"./f51.png":933690,"./f52.png":715722,"./f53.png":194416,"./f54.png":759965,"./f55.png":197937,"./f56.png":191425,"./f57.png":540564,"./f58.png":335705,"./f59.png":422762,"./f60.png":405285,"./f61.png":160792,"./f62.png":1219,"./f63.png":266899,"./f64.png":514772,"./f65.png":561160,"./f66.png":726671,"./f67.png":618327,"./f68.png":508659,"./f69.png":980157,"./f70.png":214440,"./f71.png":90805,"./f72.png":439619,"./f73.png":730472,"./f74.png":260325,"./f75.png":159019,"./f76.png":369536,"./f77.png":570577,"./f78.png":835033,"./f79.png":562003,"./f80.png":565263,"./f81.png":39681,"./f82.png":361422,"./f83.png":250966,"./f84.png":860408,"./f85.png":669738,"./f86.png":87724,"./f87.png":93370,"./f88.png":563963,"./f89.png":713976,"./f90.png":626034,"./f91.png":841727,"./f92.png":354257,"./f93.png":61109,"./f94.png":402801,"./f95.png":811318,"./f96.png":725889,"./f97.png":430341,"./f98.png":351222,"./f99.png":153279,"./favicon-error.png":981740,"./favicon-error2.png":605079,"./favicon.png":149420};function i(e){var t=a(e);return n(t)}function a(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=a,e.exports=i,i.id=276554},123098:module=>{var e={},aa={},l;for(l in e)e.hasOwnProperty(l)&&(aa[l]=e[l]);function ba(e){eval.call(null,e)}for(l in e.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},"undefined"!=typeof arguments&&(e.arguments=arguments),"undefined"!=typeof console?(e.print||(e.print=function(e){console.log(e)}),e.printErr||(e.printErr=function(e){console.log(e)})):e.print||(e.print=function(){}),void 0===e.setWindowTitle&&(e.setWindowTitle=function(e){document.title=e}),!e.load&&e.read&&(e.load=function(t){ba(e.read(t))}),e.print||(e.print=function(){}),e.printErr||(e.printErr=e.print),e.arguments||(e.arguments=[]),e.thisProgram||(e.thisProgram="./this.program"),e.print=e.print,e.S=e.printErr,e.preRun=[],e.postRun=[],aa)aa.hasOwnProperty(l)&&(e[l]=aa[l]);var n={cb:function(e){ca=e},Ua:function(){return ca},na:function(){return m},X:function(e){m=e},Aa:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:return"*"===e[e.length-1]?n.H:"i"===e[0]?(assert(0==(e=parseInt(e.substr(1)))%8),e/8):0}},Ta:function(e){return Math.max(n.Aa(e),n.H)},dd:16,Bd:function(e,t){return"double"===t||"i64"===t?7&e&&(assert(4==(7&e)),e+=4):assert(0==(3&e)),e},od:function(e,t,r){return r||"i64"!=e&&"double"!=e?e?Math.min(t||(e?n.Ta(e):0),n.H):Math.min(t,8):8},J:function(t,n,r){return r&&r.length?(r.splice||(r=Array.prototype.slice.call(r)),r.splice(0,0,n),e["dynCall_"+t].apply(null,r)):e["dynCall_"+t].call(null,n)},U:[],Ma:function(e){for(var t=0;t<n.U.length;t++)if(!n.U[t])return n.U[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},$a:function(e){n.U[(e-2)/2]=null},M:function(t){n.M.ma||(n.M.ma={}),n.M.ma[t]||(n.M.ma[t]=1,e.S(t))},ha:{},rd:function(e,t){assert(t),n.ha[t]||(n.ha[t]={});var r=n.ha[t];return r[e]||(r[e]=function(){return n.J(t,e,arguments)}),r[e]},pd:function(){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},W:function(e){var t=m;return m=(m=m+e|0)+15&-16,t},Ia:function(e){var t=p;return p=(p=p+e|0)+15&-16,t},P:function(e){var t=v;return(e=(v=(v=v+e|0)+15&-16)>=w)&&(z("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+w+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which adjusts the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 "),e=!0),e?(v=t,0):t},ea:function(e,t){return Math.ceil(e/(t||16))*(t||16)},xd:function(e,t,n){return n?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t)},La:8,H:4,ed:0};e.Runtime=n,n.addFunction=n.Ma,n.removeFunction=n.$a;var A=!1,da,fa,ca,ha,ia,buffer;function assert(e,t){e||z("Assertion failed: "+t)}function ga(a){var b=e["_"+a];if(!b)try{b=eval("_"+a)}catch(e){}return assert(b,"Cannot call unknown function "+a+" (perhaps LLVM optimizations or closure removed it?)"),b}function ma(e,t,n){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":D[e>>0]=t;break;case"i16":E[e>>1]=t;break;case"i32":F[e>>2]=t;break;case"i64":fa=[t>>>0,(da=t,1<=+na(da)?0<da?(0|oa(+pa(da/4294967296),4294967295))>>>0:~~+qa((da-+(~~da>>>0))/4294967296)>>>0:0)],F[e>>2]=fa[0],F[e+4>>2]=fa[1];break;case"float":ra[e>>2]=t;break;case"double":sa[e>>3]=t;break;default:z("invalid type for setValue: "+n)}}function ta(e,t){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return D[e>>0];case"i16":return E[e>>1];case"i32":case"i64":return F[e>>2];case"float":return ra[e>>2];case"double":return sa[e>>3];default:z("invalid type for setValue: "+t)}return null}function G(e,t,r,i){var a,o;"number"==typeof e?(a=!0,o=e):(a=!1,o=e.length);var s,l,c="string"==typeof t?t:null;if(r=4==r?i:[ua,n.W,n.Ia,n.P][void 0===r?2:r](Math.max(o,c?1:t.length)),a){for(i=r,assert(0==(3&r)),e=r+(-4&o);i<e;i+=4)F[i>>2]=0;for(e=r+o;i<e;)D[i++>>0]=0;return r}if("i8"===c)return e.subarray||e.slice?H.set(e,r):H.set(new Uint8Array(e),r),r;for(i=0;i<o;){var u=e[i];"function"==typeof u&&(u=n.sd(u)),0===(a=c||t[i])?i++:("i64"==a&&(a="i32"),ma(r+i,u,a),l!==a&&(s=n.Aa(a),l=a),i+=s)}return r}function la(t,n){if(0===n||!t)return"";for(var r,i=0,a=0;(i|=r=H[t+a>>0],0!=r||n)&&(a++,!n||a!=n););if(n||(n=a),r="",128>i){for(;0<n;)i=String.fromCharCode.apply(String,H.subarray(t,t+Math.min(n,1024))),r=r?r+i:i,t+=1024,n-=1024;return r}return e.UTF8ToString(t)}function za(e,t){for(var n,r,i,a,o,s="";;){if(!(n=e[t++]))return s;128&n?(r=63&e[t++],192==(224&n)?s+=String.fromCharCode((31&n)<<6|r):(i=63&e[t++],224==(240&n)?n=(15&n)<<12|r<<6|i:(a=63&e[t++],240==(248&n)?n=(7&n)<<18|r<<12|i<<6|a:(o=63&e[t++],248==(252&n)?n=(3&n)<<24|r<<18|i<<12|a<<6|o:n=(1&n)<<30|r<<24|i<<18|a<<12|o<<6|63&e[t++])),65536>n?s+=String.fromCharCode(n):(n-=65536,s+=String.fromCharCode(55296|n>>10,56320|1023&n)))):s+=String.fromCharCode(n)}}function Aa(e,t,n,r){if(!(0<r))return 0;var i=n;r=n+r-1;for(var a=0;a<e.length;++a){var o=e.charCodeAt(a);if(55296<=o&&57343>=o&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),127>=o){if(n>=r)break;t[n++]=o}else{if(2047>=o){if(n+1>=r)break;t[n++]=192|o>>6}else{if(65535>=o){if(n+2>=r)break;t[n++]=224|o>>12}else{if(2097151>=o){if(n+3>=r)break;t[n++]=240|o>>18}else{if(67108863>=o){if(n+4>=r)break;t[n++]=248|o>>24}else{if(n+5>=r)break;t[n++]=252|o>>30,t[n++]=128|o>>24&63}t[n++]=128|o>>18&63}t[n++]=128|o>>12&63}t[n++]=128|o>>6&63}t[n++]=128|63&o}}return t[n]=0,n-i}function Ba(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),127>=r?++t:t=2047>=r?t+2:65535>=r?t+3:2097151>=r?t+4:67108863>=r?t+5:t+6}return t}function Ca(t){var r=!!e.___cxa_demangle;if(r)try{var i=ua(t.length);ka(t.substr(1),i);var a=ua(4),o=e.___cxa_demangle(i,0,0,a);if(0===ta(a,"i32")&&o)return la(o)}catch(e){}finally{i&&Da(i),a&&Da(a),o&&Da(o)}var s=3,l={v:"void",b:"bool",c:"char",s:"short",i:"int",l:"long",f:"float",d:"double",w:"wchar_t",a:"signed char",h:"unsigned char",t:"unsigned short",j:"unsigned int",m:"unsigned long",x:"long long",y:"unsigned long long",z:"..."},c=[],u=!0;i=t;try{if("Object._main"==t||"_main"==t)return"main()";if("number"==typeof t&&(t=la(t)),"_"!==t[0]||"_"!==t[1]||"Z"!==t[2])return t;switch(t[3]){case"n":return"operator new()";case"d":return"operator delete()"}i=function e(n,r,i){r=r||1/0;var a,o="",d=[];if("N"===t[s]){for(s++,"K"===t[s]&&s++,a=[];"E"!==t[s];)if("S"===t[s]){s++;var p=t.indexOf("_",s);a.push(c[t.substring(s,p)||0]||"?"),s=p+1}else if("C"===t[s])a.push(a[a.length-1]),s+=2;else{var f=(p=parseInt(t.substr(s))).toString().length;if(!p||!f){s--;break}var _=t.substr(s+f,p);a.push(_),c.push(_),s+=f+p}if(s++,a=a.join("::"),0==--r)return n?[a]:a}else("K"===t[s]||u&&"L"===t[s])&&s++,(p=parseInt(t.substr(s)))&&(f=p.toString().length,a=t.substr(s+f,p),s+=f+p);u=!1,"I"===t[s]?(s++,p=e(!0),o+=(f=e(!0,1,!0))[0]+" "+a+"<"+p.join(", ")+">"):o=a;e:for(;s<t.length&&0<r--;)if(a=t[s++],a in l)d.push(l[a]);else switch(a){case"P":d.push(e(!0,1,!0)[0]+"*");break;case"R":d.push(e(!0,1,!0)[0]+"&");break;case"L":s++,p=t.indexOf("E",s)-s,d.push(t.substr(s,p)),s+=p+2;break;case"A":if(p=parseInt(t.substr(s)),s+=p.toString().length,"_"!==t[s])throw"?";s++,d.push(e(!0,1,!0)[0]+" ["+p+"]");break;case"E":break e;default:o+="?"+a;break e}return i||1!==d.length||"void"!==d[0]||(d=[]),n?(o&&d.push(o+"?"),d):o+"("+d.join(", ")+")"}()}catch(e){i+="?"}return 0<=i.indexOf("?")&&!r&&n.M("warning: a problem occurred in builtin C++ name demangling; build with  -s DEMANGLE_SUPPORT=1  to link in libcxxabi demangling"),i}function Ea(){return Fa().replace(/__Z[\w\d_]+/g,(function(e){var t=Ca(e);return e===t?e:e+" ["+t+"]"}))}function Fa(){var e=Error();if(!e.stack){try{throw Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function Ga(){var e=v;return 0<e%4096&&(e+=4096-e%4096),e}(function(){function a(e){return{arguments:(e=e.toString().match(d).slice(1))[0],body:e[1],returnValue:e[2]}}var b={stackSave:function(){n.na()},stackRestore:function(){n.X()},arrayToC:function(e){var t=n.W(e.length);return ja(e,t),t},stringToC:function(e){var t=0;return null!=e&&0!==e&&ka(e,t=n.W(1+(e.length<<2))),t}},c={string:b.stringToC,array:b.arrayToC};ia=function(e,t,r,i,a){e=ga(e);var o=[],s=0;if(i)for(var l=0;l<i.length;l++){var u=c[r[l]];u?(0===s&&(s=n.na()),o[l]=u(i[l])):o[l]=i[l]}if(r=e.apply(null,o),"string"===t&&(r=la(r)),0!==s){if(a&&a.async)return void EmterpreterAsync.hd.push((function(){n.X(s)}));n.X(s)}return r};var d=/^function\s*\(([^)]*)\)\s*{\s*([^*]*?)[\s;]*(?:return\s*(.*?)[;\s]*)?}$/,f={},h;for(h in b)b.hasOwnProperty(h)&&(f[h]=a(b[h]));ha=function(b,c,d){d=d||[];var h=ga(b);b=d.every((function(e){return"number"===e}));var u="string"!==c;if(u&&b)return h;var q=d.map((function(e,t){return"$"+t}));c="(function("+q.join(",")+") {";var y=d.length;if(!b){c+="var stack = "+f.stackSave.body+";";for(var B=0;B<y;B++){var J=q[B],ea=d[B];"number"!==ea&&(ea=f[ea+"ToC"],c+="var "+ea.arguments+" = "+J+";",c+=ea.body+";",c+=J+"="+ea.returnValue+";")}}return d=a((function(){return h})).returnValue,c+="var ret = "+d+"("+q.join(",")+");",u||(d=a((function(){return la})).returnValue,c+="ret = "+d+"(ret);"),b||(c+=f.stackRestore.body.replace("()","(stack)")+";"),eval(c+"return ret})")}})(),e.ccall=ia,e.cwrap=ha,e.setValue=ma,e.getValue=ta,e.ALLOC_NORMAL=0,e.ALLOC_STACK=1,e.ALLOC_STATIC=2,e.ALLOC_DYNAMIC=3,e.ALLOC_NONE=4,e.allocate=G,e.getMemory=function(e){return va?void 0!==wa&&!wa.C||!xa?n.P(e):ua(e):n.Ia(e)},e.Pointer_stringify=la,e.AsciiToString=function(e){for(var t="";;){var n=D[e++>>0];if(!n)return t;t+=String.fromCharCode(n)}},e.stringToAscii=function(e,t){return ya(e,t,!1)},e.UTF8ArrayToString=za,e.UTF8ToString=function(e){return za(H,e)},e.stringToUTF8Array=Aa,e.stringToUTF8=function(e,t,n){return Aa(e,H,t,n)},e.lengthBytesUTF8=Ba,e.UTF16ToString=function(e){for(var t=0,n="";;){var r=E[e+2*t>>1];if(0==r)return n;++t,n+=String.fromCharCode(r)}},e.stringToUTF16=function(e,t,n){if(void 0===n&&(n=2147483647),2>n)return 0;var r=t;n=(n-=2)<2*e.length?n/2:e.length;for(var i=0;i<n;++i)E[t>>1]=e.charCodeAt(i),t+=2;return E[t>>1]=0,t-r},e.lengthBytesUTF16=function(e){return 2*e.length},e.UTF32ToString=function(e){for(var t=0,n="";;){var r=F[e+4*t>>2];if(0==r)return n;++t,65536<=r?(r-=65536,n+=String.fromCharCode(55296|r>>10,56320|1023&r)):n+=String.fromCharCode(r)}},e.stringToUTF32=function(e,t,n){if(void 0===n&&(n=2147483647),4>n)return 0;var r=t;n=r+n-4;for(var i=0;i<e.length;++i){if(55296<=(a=e.charCodeAt(i))&&57343>=a)var a=65536+((1023&a)<<10)|1023&e.charCodeAt(++i);if(F[t>>2]=a,(t+=4)+4>n)break}return F[t>>2]=0,t-r},e.lengthBytesUTF32=function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);55296<=r&&57343>=r&&++n,t+=4}return t},e.stackTrace=function(){return Ea()};for(var D,H,E,Ha,F,Ia,ra,sa,Ja=0,p=0,va=!1,Ka=0,m=0,La=0,Ma=0,v=0,Na=e.TOTAL_STACK||5242880,w=e.TOTAL_MEMORY||16777216,I=65536;I<w||I<2*Na;)I=16777216>I?2*I:I+16777216;function Oa(e){for(;0<e.length;){var t=e.shift();if("function"==typeof t)t();else{var r=t.Qa;"number"==typeof r?void 0===t.T?n.J("v",r):n.J("vi",r,[t.T]):r(void 0===t.T?null:t.T)}}}I!==w&&(w=I),assert("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set,"JS engine does not provide full typed array support"),buffer=new ArrayBuffer(w),D=new Int8Array(buffer),E=new Int16Array(buffer),F=new Int32Array(buffer),H=new Uint8Array(buffer),Ha=new Uint16Array(buffer),Ia=new Uint32Array(buffer),ra=new Float32Array(buffer),sa=new Float64Array(buffer),F[0]=255,assert(255===H[0]&&0===H[3],"Typed arrays 2 must be run on a little-endian system"),e.HEAP=void 0,e.buffer=buffer,e.HEAP8=D,e.HEAP16=E,e.HEAP32=F,e.HEAPU8=H,e.HEAPU16=Ha,e.HEAPU32=Ia,e.HEAPF32=ra,e.HEAPF64=sa;var Pa=[],Qa=[],Ra=[],K=[],Sa=[],xa=!1;function Ta(e){Pa.unshift(e)}function Ua(e){Sa.unshift(e)}function Va(e,t,n){return e=Aa(e,n=Array(0<n?n:Ba(e)+1),0,n.length),t&&(n.length=e),n}function ka(e,t,n){for(e=Va(e,n),n=0;n<e.length;)D[t+n>>0]=e[n],n+=1}function ja(e,t){for(var n=0;n<e.length;n++)D[t++>>0]=e[n]}function ya(e,t,n){for(var r=0;r<e.length;++r)D[t++>>0]=e.charCodeAt(r);n||(D[t>>0]=0)}e.addOnPreRun=Ta,e.addOnInit=function(e){Qa.unshift(e)},e.addOnPreMain=function(e){Ra.unshift(e)},e.addOnExit=function(e){K.unshift(e)},e.addOnPostRun=Ua,e.intArrayFromString=Va,e.intArrayToString=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];255<r&&(r&=255),t.push(String.fromCharCode(r))}return t.join("")},e.writeStringToMemory=ka,e.writeArrayToMemory=ja,e.writeAsciiToMemory=ya,Math.imul&&-5===Math.imul(4294967295,5)||(Math.imul=function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16)*r+n*(t>>>16)<<16)|0}),Math.td=Math.imul,Math.clz32||(Math.clz32=function(e){e>>>=0;for(var t=0;32>t;t++)if(e&1<<31-t)return t;return 32}),Math.kd=Math.clz32;var na=Math.abs,qa=Math.ceil,pa=Math.floor,oa=Math.min,L=0,Wa=null,Xa=null;function Ya(){L++,e.monitorRunDependencies&&e.monitorRunDependencies(L)}function Za(){if(L--,e.monitorRunDependencies&&e.monitorRunDependencies(L),0==L&&(null!==Wa&&(clearInterval(Wa),Wa=null),Xa)){var t=Xa;Xa=null,t()}}e.addRunDependency=Ya,e.removeRunDependency=Za,e.preloadedImages={},e.preloadedAudios={},Ja=8,p=Ja+1696,Qa.push(),G([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,164,2,0,0,0,4,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"i8",4,n.La);var $a=n.ea(G(12,"i8",2),8);function eb(e,t){K.push((function(){n.J("vi",e,[t])})),eb.level=K.length}assert(0==$a%8),e._bitshift64Ashr=ab,e._i64Subtract=bb,e._i64Add=cb,e._memset=db,e._bitshift64Lshr=fb,e._bitshift64Shl=gb;var M={G:1,B:2,Qc:3,Nb:4,F:5,sa:6,gb:7,kc:8,Z:9,ub:10,oa:11,$c:11,Ka:12,Y:13,Gb:14,wc:15,$:16,pa:17,ad:18,ba:19,qa:20,N:21,u:22,fc:23,Ja:24,O:25,Xc:26,Hb:27,sc:28,da:29,Nc:30,Zb:31,Gc:32,Db:33,Kc:34,oc:42,Kb:43,vb:44,Qb:45,Rb:46,Sb:47,Yb:48,Yc:49,ic:50,Pb:51,Ab:35,lc:37,mb:52,pb:53,bd:54,gc:55,qb:56,rb:57,Bb:35,sb:59,uc:60,jc:61,Uc:62,tc:63,pc:64,qc:65,Mc:66,mc:67,jb:68,Rc:69,wb:70,Hc:71,ac:72,Eb:73,ob:74,Bc:76,nb:77,Lc:78,Tb:79,Ub:80,Xb:81,Wb:82,Vb:83,vc:38,ra:39,bc:36,aa:40,Cc:95,Fc:96,zb:104,hc:105,kb:97,Jc:91,zc:88,rc:92,Oc:108,yb:111,hb:98,xb:103,ec:101,cc:100,Vc:110,Ib:112,Jb:113,Mb:115,lb:114,Cb:89,$b:90,Ic:93,Pc:94,ib:99,dc:102,Ob:106,xc:107,Wc:109,Zc:87,Fb:122,Sc:116,Ac:95,nc:123,Lb:84,Dc:75,tb:125,yc:131,Ec:130,Tc:86},hb={0:"Success",1:"Not super-user",2:"No such file or directory",3:"No such process",4:"Interrupted system call",5:"I/O error",6:"No such device or address",7:"Arg list too long",8:"Exec format error",9:"Bad file number",10:"No children",11:"No more processes",12:"Not enough core",13:"Permission denied",14:"Bad address",15:"Block device required",16:"Mount device busy",17:"File exists",18:"Cross-device link",19:"No such device",20:"Not a directory",21:"Is a directory",22:"Invalid argument",23:"Too many open files in system",24:"Too many open files",25:"Not a typewriter",26:"Text file busy",27:"File too large",28:"No space left on device",29:"Illegal seek",30:"Read only file system",31:"Too many links",32:"Broken pipe",33:"Math arg out of domain of func",34:"Math result not representable",35:"File locking deadlock error",36:"File or path name too long",37:"No record locks available",38:"Function not implemented",39:"Directory not empty",40:"Too many symbolic links",42:"No message of desired type",43:"Identifier removed",44:"Channel number out of range",45:"Level 2 not synchronized",46:"Level 3 halted",47:"Level 3 reset",48:"Link number out of range",49:"Protocol driver not attached",50:"No CSI structure available",51:"Level 2 halted",52:"Invalid exchange",53:"Invalid request descriptor",54:"Exchange full",55:"No anode",56:"Invalid request code",57:"Invalid slot",59:"Bad font file fmt",60:"Device not a stream",61:"No data (for no delay io)",62:"Timer expired",63:"Out of streams resources",64:"Machine is not on the network",65:"Package not installed",66:"The object is remote",67:"The link has been severed",68:"Advertise error",69:"Srmount error",70:"Communication error on send",71:"Protocol error",72:"Multihop attempted",73:"Cross mount point (not really error)",74:"Trying to read unreadable message",75:"Value too large for defined data type",76:"Given log. name not unique",77:"f.d. invalid for this operation",78:"Remote address changed",79:"Can   access a needed shared lib",80:"Accessing a corrupted shared lib",81:".lib section in a.out corrupted",82:"Attempting to link in too many libs",83:"Attempting to exec a shared library",84:"Illegal byte sequence",86:"Streams pipe error",87:"Too many users",88:"Socket operation on non-socket",89:"Destination address required",90:"Message too long",91:"Protocol wrong type for socket",92:"Protocol not available",93:"Unknown protocol",94:"Socket type not supported",95:"Not supported",96:"Protocol family not supported",97:"Address family not supported by protocol family",98:"Address already in use",99:"Address not available",100:"Network interface is not configured",101:"Network is unreachable",102:"Connection reset by network",103:"Connection aborted",104:"Connection reset by peer",105:"No buffer space available",106:"Socket is already connected",107:"Socket is not connected",108:"Can't send after socket shutdown",109:"Too many references",110:"Connection timed out",111:"Connection refused",112:"Host is down",113:"Host is unreachable",114:"Socket already connected",115:"Connection already in progress",116:"Stale file handle",122:"Quota exceeded",123:"No medium (in tape drive)",125:"Operation canceled",130:"Previous owner died",131:"State not recoverable"};function ib(t){return e.___errno_location&&(F[e.___errno_location()>>2]=t),t}function jb(e,t){for(var n=0,r=e.length-1;0<=r;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function N(e){var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function kb(e){var t=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1);return e=t[0],t=t[1],e||t?(t&&(t=t.substr(0,t.length-1)),e+t):"."}function lb(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)}function mb(){for(var e="",t=!1,n=arguments.length-1;-1<=n&&!t;n--){if("string"!=typeof(t=0<=n?arguments[n]:"/"))throw new TypeError("Arguments to path.resolve must be strings");if(!t)return"";e=t+"/"+e,t="/"===t.charAt(0)}return(t?"/":"")+(e=jb(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."}var nb=[];function ob(e,t){nb[e]={input:[],output:[],L:t},pb(e,qb)}var qb={open:function(e){var t=nb[e.g.rdev];if(!t)throw new O(M.ba);e.tty=t,e.seekable=!1},close:function(e){e.tty.L.flush(e.tty)},flush:function(e){e.tty.L.flush(e.tty)},read:function(e,t,n,r){if(!e.tty||!e.tty.L.Ba)throw new O(M.sa);for(var i=0,a=0;a<r;a++){var o;try{o=e.tty.L.Ba(e.tty)}catch(e){throw new O(M.F)}if(void 0===o&&0===i)throw new O(M.oa);if(null==o)break;i++,t[n+a]=o}return i&&(e.g.timestamp=Date.now()),i},write:function(e,t,n,r){if(!e.tty||!e.tty.L.ja)throw new O(M.sa);for(var i=0;i<r;i++)try{e.tty.L.ja(e.tty,t[n+i])}catch(e){throw new O(M.F)}return r&&(e.g.timestamp=Date.now()),i}},rb={Ba:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&(null!==(t=readline())&&(t+="\n")),!t)return null;e.input=Va(t,!0)}return e.input.shift()},ja:function(t,n){null===n||10===n?(e.print(za(t.output,0)),t.output=[]):0!=n&&t.output.push(n)},flush:function(t){t.output&&0<t.output.length&&(e.print(za(t.output,0)),t.output=[])}},sb={ja:function(t,n){null===n||10===n?(e.printErr(za(t.output,0)),t.output=[]):0!=n&&t.output.push(n)},flush:function(t){t.output&&0<t.output.length&&(e.printErr(za(t.output,0)),t.output=[])}},P={q:null,A:function(){return P.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(24576==(61440&n)||4096==(61440&n))throw new O(M.G);return P.q||(P.q={dir:{g:{D:P.k.D,p:P.k.p,lookup:P.k.lookup,V:P.k.V,rename:P.k.rename,unlink:P.k.unlink,rmdir:P.k.rmdir,readdir:P.k.readdir,symlink:P.k.symlink},stream:{I:P.n.I}},file:{g:{D:P.k.D,p:P.k.p},stream:{I:P.n.I,read:P.n.read,write:P.n.write,ta:P.n.ta,Ea:P.n.Ea,Ga:P.n.Ga}},link:{g:{D:P.k.D,p:P.k.p,readlink:P.k.readlink},stream:{}},va:{g:{D:P.k.D,p:P.k.p},stream:tb}}),16384==(61440&(n=ub(e,t,n,r)).mode)?(n.k=P.q.dir.g,n.n=P.q.dir.stream,n.e={}):32768==(61440&n.mode)?(n.k=P.q.file.g,n.n=P.q.file.stream,n.o=0,n.e=null):40960==(61440&n.mode)?(n.k=P.q.link.g,n.n=P.q.link.stream):8192==(61440&n.mode)&&(n.k=P.q.va.g,n.n=P.q.va.stream),n.timestamp=Date.now(),e&&(e.e[t]=n),n},Sa:function(e){if(e.e&&e.e.subarray){for(var t=[],n=0;n<e.o;++n)t.push(e.e[n]);return t}return e.e},qd:function(e){return e.e?e.e.subarray?e.e.subarray(0,e.o):new Uint8Array(e.e):new Uint8Array},ya:function(e,t){if(e.e&&e.e.subarray&&t>e.e.length&&(e.e=P.Sa(e),e.o=e.e.length),!e.e||e.e.subarray){var n=e.e?e.e.buffer.byteLength:0;n>=t||(t=Math.max(t,n*(1048576>n?2:1.125)|0),0!=n&&(t=Math.max(t,256)),n=e.e,e.e=new Uint8Array(t),0<e.o&&e.e.set(n.subarray(0,e.o),0))}else for(!e.e&&0<t&&(e.e=[]);e.e.length<t;)e.e.push(0)},ab:function(e,t){if(e.o!=t)if(0==t)e.e=null,e.o=0;else{if(!e.e||e.e.subarray){var n=e.e;e.e=new Uint8Array(new ArrayBuffer(t)),n&&e.e.set(n.subarray(0,Math.min(t,e.o)))}else if(e.e||(e.e=[]),e.e.length>t)e.e.length=t;else for(;e.e.length<t;)e.e.push(0);e.o=t}},k:{D:function(e){var t={};return t.dev=8192==(61440&e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,16384==(61440&e.mode)?t.size=4096:32768==(61440&e.mode)?t.size=e.o:40960==(61440&e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.Pa=4096,t.blocks=Math.ceil(t.size/t.Pa),t},p:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&P.ab(e,t.size)},lookup:function(){throw vb[M.B]},V:function(e,t,n,r){return P.createNode(e,t,n,r)},rename:function(e,t,n){if(16384==(61440&e.mode)){var r;try{r=wb(t,n)}catch(e){}if(r)for(var i in r.e)throw new O(M.ra)}delete e.parent.e[e.name],e.name=n,t.e[n]=e,e.parent=t},unlink:function(e,t){delete e.e[t]},rmdir:function(e,t){var n,r=wb(e,t);for(n in r.e)throw new O(M.ra);delete e.e[t]},readdir:function(e){var t,n=[".",".."];for(t in e.e)e.e.hasOwnProperty(t)&&n.push(t);return n},symlink:function(e,t,n){return(e=P.createNode(e,t,41471,0)).link=n,e},readlink:function(e){if(40960!=(61440&e.mode))throw new O(M.u);return e.link}},n:{read:function(e,t,n,r,i){var a=e.g.e;if(i>=e.g.o)return 0;if(assert(0<=(e=Math.min(e.g.o-i,r))),8<e&&a.subarray)t.set(a.subarray(i,i+e),n);else for(r=0;r<e;r++)t[n+r]=a[i+r];return e},write:function(e,t,n,r,i,a){if(!r)return 0;if((e=e.g).timestamp=Date.now(),t.subarray&&(!e.e||e.e.subarray)){if(a)return e.e=t.subarray(n,n+r),e.o=r;if(0===e.o&&0===i)return e.e=new Uint8Array(t.subarray(n,n+r)),e.o=r;if(i+r<=e.o)return e.e.set(t.subarray(n,n+r),i),r}if(P.ya(e,i+r),e.e.subarray&&t.subarray)e.e.set(t.subarray(n,n+r),i);else for(a=0;a<r;a++)e.e[i+a]=t[n+a];return e.o=Math.max(e.o,i+r),r},I:function(e,t,n){if(1===n?t+=e.position:2===n&&32768==(61440&e.g.mode)&&(t+=e.g.o),0>t)throw new O(M.u);return t},ta:function(e,t,n){P.ya(e.g,t+n),e.g.o=Math.max(e.g.o,t+n)},Ea:function(e,t,n,r,i,a,o){if(32768!=(61440&e.g.mode))throw new O(M.ba);if(n=e.g.e,2&o||n.buffer!==t&&n.buffer!==t.buffer){if((0<i||i+r<e.g.o)&&(n=n.subarray?n.subarray(i,i+r):Array.prototype.slice.call(n,i,i+r)),e=!0,!(r=ua(r)))throw new O(M.Ka);t.set(n,r)}else e=!1,r=n.byteOffset;return{Cd:r,gd:e}},Ga:function(e,t,n,r,i){if(32768!=(61440&e.g.mode))throw new O(M.ba);return 2&i||P.n.write(e,t,0,r,n,!1),0}}};G(1,"i32*",2),G(1,"i32*",2),G(1,"i32*",2);var xb=null,yb=[null],zb=[],Ab=1,R=null,Cb=!0,S={},O=null,vb={};function T(e,t){if(t=t||{},!(e=mb("/",e)))return{path:"",g:null};var n,r={za:!0,ka:0};for(n in r)void 0===t[n]&&(t[n]=r[n]);if(8<t.ka)throw new O(M.aa);r=jb(e.split("/").filter((function(e){return!!e})),!1);var i=xb;n="/";for(var a=0;a<r.length;a++){var o=a===r.length-1;if(o&&t.parent)break;if(i=wb(i,r[a]),n=N(n+"/"+r[a]),i.R&&(!o||o&&t.za)&&(i=i.R.root),!o||t.ga)for(o=0;40960==(61440&i.mode);)if(i=Db(n),i=T(n=mb(kb(n),i),{ka:t.ka}).g,40<o++)throw new O(M.aa)}return{path:n,g:i}}function U(e){for(var t;;){if(e===e.parent)return e=e.A.Fa,t?"/"!==e[e.length-1]?e+"/"+t:e+t:e;t=t?e.name+"/"+t:e.name,e=e.parent}}function Eb(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%R.length}function Fb(e){var t=Eb(e.parent.id,e.name);e.K=R[t],R[t]=e}function wb(e,t){var n;if(n=(n=Gb(e,"x"))?n:e.k.lookup?0:M.Y)throw new O(n,e);for(n=R[Eb(e.id,t)];n;n=n.K){var r=n.name;if(n.parent.id===e.id&&r===t)return n}return e.k.lookup(e,t)}function ub(e,t,n,r){return Hb||((Hb=function(e,t,n,r){e||(e=this),this.parent=e,this.A=e.A,this.R=null,this.id=Ab++,this.name=t,this.mode=n,this.k={},this.n={},this.rdev=r}).prototype={},Object.defineProperties(Hb.prototype,{read:{get:function(){return 365==(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146==(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},Xa:{get:function(){return 16384==(61440&this.mode)}},Ca:{get:function(){return 8192==(61440&this.mode)}}})),Fb(e=new Hb(e,t,n,r)),e}var Ib={r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218};function Gb(e,t){return Cb||(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:M.Y}function Jb(e,t){try{return wb(e,t),M.pa}catch(e){}return Gb(e,"wx")}function Kb(){for(var e=0;e<=4096;e++)if(!zb[e])return e;throw new O(M.Ja)}function Lb(e){Mb||((Mb=function(){}).prototype={},Object.defineProperties(Mb.prototype,{object:{get:function(){return this.g},set:function(e){this.g=e}},vd:{get:function(){return 1!=(2097155&this.flags)}},wd:{get:function(){return 0!=(2097155&this.flags)}},ud:{get:function(){return 1024&this.flags}}}));var t,n=new Mb;for(t in e)n[t]=e[t];return e=n,n=Kb(),e.fd=n,zb[n]=e}var tb={open:function(e){e.n=yb[e.g.rdev].n,e.n.open&&e.n.open(e)},I:function(){throw new O(M.da)}},Zb;function pb(e,t){yb[e]={n:t}}function Nb(e,t){var n,r="/"===t,i=!t;if(r&&xb)throw new O(M.$);if(!r&&!i){if(t=(n=T(t,{za:!1})).path,(n=n.g).R)throw new O(M.$);if(16384!=(61440&n.mode))throw new O(M.qa)}i={type:e,Ad:{},Fa:t,Ya:[]};var a=e.A(i);a.A=i,i.root=a,r?xb=a:n&&(n.R=i,n.A&&n.A.Ya.push(i))}function Ob(e,t,n){var r=T(e,{parent:!0}).g;if(!(e=lb(e))||"."===e||".."===e)throw new O(M.u);var i=Jb(r,e);if(i)throw new O(i);if(!r.k.V)throw new O(M.G);return r.k.V(r,e,t,n)}function Pb(e,t){return t=4095&(void 0!==t?t:438),Ob(e,t|=32768,0)}function V(e,t){return t=1023&(void 0!==t?t:511),Ob(e,t|=16384,0)}function Qb(e,t,n){return void 0===n&&(n=t,t=438),Ob(e,8192|t,n)}function Rb(e,t){if(!mb(e))throw new O(M.B);var n=T(t,{parent:!0}).g;if(!n)throw new O(M.B);var r=lb(t),i=Jb(n,r);if(i)throw new O(i);if(!n.k.symlink)throw new O(M.G);return n.k.symlink(n,r,e)}function Db(e){if(!(e=T(e).g))throw new O(M.B);if(!e.k.readlink)throw new O(M.u);return mb(U(e.parent),e.k.readlink(e))}function Sb(e,t){var n;if(!(n="string"==typeof e?T(e,{ga:!0}).g:e).k.p)throw new O(M.G);n.k.p(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})}function Tb(t,n){var r,i,a;if(""===t)throw new O(M.B);if("string"==typeof n){if(void 0===(i=Ib[n]))throw Error("Unknown file open mode: "+n)}else i=n;if(r=64&(n=i)?4095&(void 0===r?438:r)|32768:0,"object"==typeof t)a=t;else{t=N(t);try{a=T(t,{ga:!(131072&n)}).g}catch(e){}}if(i=!1,64&n)if(a){if(128&n)throw new O(M.pa)}else a=Ob(t,r,0),i=!0;if(!a)throw new O(M.B);if(8192==(61440&a.mode)&&(n&=-513),65536&n&&16384!=(61440&a.mode))throw new O(M.qa);if(!i&&(a?40960==(61440&a.mode)?r=M.aa:16384==(61440&a.mode)&&(0!=(2097155&n)||512&n)?r=M.N:(r=["r","w","rw"][3&n],512&n&&(r+="w"),r=Gb(a,r)):r=M.B,r))throw new O(r);if(512&n){var o;if(!(o="string"==typeof(r=a)?T(r,{ga:!0}).g:r).k.p)throw new O(M.G);if(16384==(61440&o.mode))throw new O(M.N);if(32768!=(61440&o.mode))throw new O(M.u);if(r=Gb(o,"w"))throw new O(r);o.k.p(o,{size:0,timestamp:Date.now()})}n&=-641,(a=Lb({g:a,path:U(a),flags:n,seekable:!0,position:0,n:a.n,eb:[],error:!1})).n.open&&a.n.open(a),!e.logReadFiles||1&n||(Ub||(Ub={}),t in Ub||(Ub[t]=1,e.printErr("read file: "+t)));try{S.onOpenFile&&(o=0,1!=(2097155&n)&&(o|=1),0!=(2097155&n)&&(o|=2),S.onOpenFile(t,o))}catch(e){console.log("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return a}function Vb(e){e.ia&&(e.ia=null);try{e.n.close&&e.n.close(e)}catch(e){throw e}finally{zb[e.fd]=null}}function Wb(e,t,n){if(!e.seekable||!e.n.I)throw new O(M.da);e.position=e.n.I(e,t,n),e.eb=[]}function Xb(e,t,n,r,i,a){if(0>r||0>i)throw new O(M.u);if(0==(2097155&e.flags))throw new O(M.Z);if(16384==(61440&e.g.mode))throw new O(M.N);if(!e.n.write)throw new O(M.u);1024&e.flags&&Wb(e,0,2);var o=!0;if(void 0===i)i=e.position,o=!1;else if(!e.seekable)throw new O(M.da);t=e.n.write(e,t,n,r,i,a),o||(e.position+=t);try{e.path&&S.onWriteToFile&&S.onWriteToFile(e.path)}catch(e){console.log("FS.trackingDelegate['onWriteToFile']('"+path+"') threw an exception: "+e.message)}return t}function Yb(){O||((O=function(e,t){this.g=t,this.bb=function(e){for(var t in this.Q=e,M)if(M[t]===e){this.code=t;break}},this.bb(e),this.message=hb[e]}).prototype=Error(),O.prototype.constructor=O,[M.B].forEach((function(e){vb[e]=new O(e),vb[e].stack="<generic error, no stack>"})))}function $b(e,t){var n=0;return e&&(n|=365),t&&(n|=146),n}function ac(e,t,n,r){return Pb(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(n,r))}function bc(e,t,n,r,i,a){if(i=Pb(e=t?N(("string"==typeof e?e:U(e))+"/"+t):e,r=$b(r,i)),n){if("string"==typeof n){e=Array(n.length),t=0;for(var o=n.length;t<o;++t)e[t]=n.charCodeAt(t);n=e}Sb(i,146|r),Xb(e=Tb(i,"w"),n,0,n.length,0,a),Vb(e),Sb(i,r)}return i}function W(e,t,n,r){e=N(("string"==typeof e?e:U(e))+"/"+t),t=$b(!!n,!!r),W.Da||(W.Da=64);var i=W.Da++<<8|0;return pb(i,{open:function(e){e.seekable=!1},close:function(){r&&r.buffer&&r.buffer.length&&r(10)},read:function(e,t,r,i){for(var a=0,o=0;o<i;o++){var s;try{s=n()}catch(e){throw new O(M.F)}if(void 0===s&&0===a)throw new O(M.oa);if(null==s)break;a++,t[r+o]=s}return a&&(e.g.timestamp=Date.now()),a},write:function(e,t,n,i){for(var a=0;a<i;a++)try{r(t[n+a])}catch(e){throw new O(M.F)}return i&&(e.g.timestamp=Date.now()),a}}),Qb(e,t,i)}function cc(t){if(t.Ca||t.Xa||t.link||t.e)return!0;var n=!0;if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!e.read)throw Error("Cannot load without read() or XMLHttpRequest.");try{t.e=Va(e.read(t.url),!0),t.o=t.e.length}catch(e){n=!1}return n||ib(M.F),n}var dc={},Hb,Mb,Ub,ec=0;function X(){return F[(ec+=4)-4>>2]}function fc(){var e;if(e=X(),!(e=zb[e]))throw new O(M.Z);return e}function wa(e){wa.C||(v=Ga(),wa.C=!0,assert(n.P),wa.Ra=n.P,n.P=function(){z("cannot dynamically allocate, sbrk now has control")});var t=v;return 0==e||wa.Ra(e)?t:4294967295}function hc(e,t){if(ic=e,jc=t,!kc)return 1;if(0==e)Y=function(){setTimeout(lc,t)},mc="timeout";else if(1==e)Y=function(){nc(lc)},mc="rAF";else if(2==e){if(!window.setImmediate){var n=[];window.addEventListener("message",(function(e){e.source===window&&"__emcc"===e.data&&(e.stopPropagation(),n.shift()())}),!0),window.setImmediate=function(e){n.push(e),window.postMessage("__emcc","*")}}Y=function(){window.setImmediate(lc)},mc="immediate"}return 0}function oc(t,r,i,a,o){e.noExitRuntime=!0,assert(!kc,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),kc=t,pc=a;var s=qc;if(lc=function(){if(!A)if(0<rc.length){var r=Date.now(),i=rc.shift();if(i.Qa(i.T),sc){var o=sc,l=0==o%1?o-1:Math.floor(o);sc=i.ld?l:(8*o+(l+.5))/9}console.log('main loop blocker "'+i.name+'" took '+(Date.now()-r)+" ms"),tc(),setTimeout(lc,0)}else s<qc||(uc=uc+1|0,1==ic&&1<jc&&0!=uc%jc?Y():("timeout"===mc&&e.fa&&(e.S("Looks like you are rendering without using requestAnimationFrame for the main loop. You should use 0 for the frame rate in emscripten_set_main_loop in order to use requestAnimationFrame, as that can greatly improve your frame rates!"),mc=""),vc((function(){void 0!==a?n.J("vi",t,[a]):n.J("v",t)})),s<qc||("object"==typeof SDL&&SDL.audio&&SDL.audio.Za&&SDL.audio.Za(),Y())))},o||(r&&0<r?hc(0,1e3/r):hc(1,1),Y()),i)throw"SimulateInfiniteLoop"}e._memcpy=gc;var Y=null,mc="",qc=0,kc=null,pc=0,ic=0,jc=0,uc=0,rc=[];function tc(){if(e.setStatus){var t=e.statusMessage||"Please wait...",n=sc,r=wc.nd;n?n<r?e.setStatus(t+" ("+(r-n)+"/"+r+")"):e.setStatus(t):e.setStatus("")}}function vc(t){if(!(A||e.preMainLoop&&!1===e.preMainLoop())){try{t()}catch(t){if(t instanceof xc)return;throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t}e.postMainLoop&&e.postMainLoop()}}var wc={},lc,sc,yc=!1,zc=!1,Ac=[];function Bc(){function t(){zc=document.pointerLockElement===r||document.mozPointerLockElement===r||document.webkitPointerLockElement===r||document.msPointerLockElement===r}if(e.preloadPlugins||(e.preloadPlugins=[]),!Cc){Cc=!0;try{Dc=!0}catch(e){Dc=!1,console.log("warning: no blob constructor, cannot create blobs with mimetypes")}Ec="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Dc?null:console.log("warning: no BlobBuilder"),Fc="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,e.Ha||void 0!==Fc||(console.log("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),e.Ha=!0),e.preloadPlugins.push({canHandle:function(t){return!e.Ha&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},handle:function(t,r,i,a){var o=null;if(Dc)try{(o=new Blob([t],{type:Gc(r)})).size!==t.length&&(o=new Blob([new Uint8Array(t).buffer],{type:Gc(r)}))}catch(e){n.M("Blob constructor present but fails: "+e+"; falling back to blob builder")}o||((o=new Ec).append(new Uint8Array(t).buffer),o=o.getBlob());var s=Fc.createObjectURL(o),l=new Image;l.onload=function(){assert(l.complete,"Image "+r+" could not be decoded");var n=document.createElement("canvas");n.width=l.width,n.height=l.height,n.getContext("2d").drawImage(l,0,0),e.preloadedImages[r]=n,Fc.revokeObjectURL(s),i&&i(t)},l.onerror=function(){console.log("Image "+s+" could not be decoded"),a&&a()},l.src=s}}),e.preloadPlugins.push({canHandle:function(t){return!e.zd&&t.substr(-4)in{".ogg":1,".wav":1,".mp3":1}},handle:function(t,n,r,i){function a(i){s||(s=!0,e.preloadedAudios[n]=i,r&&r(t))}function o(){s||(s=!0,e.preloadedAudios[n]=new Audio,i&&i())}var s=!1;if(!Dc)return o();try{var l=new Blob([t],{type:Gc(n)})}catch(e){return o()}l=Fc.createObjectURL(l);var c=new Audio;c.addEventListener("canplaythrough",(function(){a(c)}),!1),c.onerror=function(){if(!s){console.log("warning: browser could not fully decode audio "+n+", trying slower base64 approach");for(var e="",r=0,i=0,o=0;o<t.length;o++)for(r=r<<8|t[o],i+=8;6<=i;){var l=r>>i-6&63;i=i-6,e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]}2==i?(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&r)<<4],e+="=="):4==i&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&r)<<2],e+="="),c.src="data:audio/x-"+n.substr(-3)+";base64,"+e,a(c)}},c.src=l,Hc((function(){a(c)}))}});var r=e.canvas;r&&(r.la=r.requestPointerLock||r.mozRequestPointerLock||r.webkitRequestPointerLock||r.msRequestPointerLock||function(){},r.wa=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},r.wa=r.wa.bind(document),document.addEventListener("pointerlockchange",t,!1),document.addEventListener("mozpointerlockchange",t,!1),document.addEventListener("webkitpointerlockchange",t,!1),document.addEventListener("mspointerlockchange",t,!1),e.elementPointerLock&&r.addEventListener("click",(function(e){!zc&&r.la&&(r.la(),e.preventDefault())}),!1))}}function Ic(t,n,r,i){if(n&&e.fa&&t==e.canvas)return e.fa;var a,o;if(n){if(o={antialias:!1,alpha:!1},i)for(var s in i)o[s]=i[s];(o=GL.createContext(t,o))&&(a=GL.getContext(o).cd),t.style.backgroundColor="black"}else a=t.getContext("2d");return a?(r&&(n||assert("undefined"==typeof GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),e.fa=a,n&&GL.yd(o),e.Dd=n,Ac.forEach((function(e){e()})),Bc()),a):null}var Jc=!1,Kc=void 0,Lc=void 0;function Mc(t,n,r){function i(){yc=!1;var t=a.parentNode;(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t?(a.ua=document.cancelFullScreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||document.exitFullscreen||function(){},a.ua=a.ua.bind(document),Kc&&a.la(),yc=!0,Lc&&Nc()):(t.parentNode.insertBefore(a,t),t.parentNode.removeChild(t),Lc&&Oc()),e.onFullScreen&&e.onFullScreen(yc),Pc(a)}void 0===(Kc=t)&&(Kc=!0),void 0===(Lc=n)&&(Lc=!1),void 0===(Qc=r)&&(Qc=null);var a=e.canvas;Jc||(Jc=!0,document.addEventListener("fullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("MSFullscreenChange",i,!1));var o=document.createElement("div");a.parentNode.insertBefore(o,a),o.appendChild(a),o.C=o.requestFullScreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),r?o.C({Ed:r}):o.C()}var Rc=0;function Sc(e){var t=Date.now();if(0===Rc)Rc=t+1e3/60;else for(;t+2>=Rc;)Rc+=1e3/60;t=Math.max(Rc-t,0),setTimeout(e,t)}function nc(e){"undefined"==typeof window?Sc(e):(window.requestAnimationFrame||(window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||Sc),window.requestAnimationFrame(e))}function Hc(t){e.noExitRuntime=!0,setTimeout((function(){A||t()}),1e4)}function Gc(e){return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"}[e.substr(e.lastIndexOf(".")+1)]}function Tc(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}function Uc(e,t,n){Tc(e,(function(n){assert(n,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(n)),Za()}),(function(){if(!n)throw'Loading data file "'+e+'" failed.';n()})),Ya()}var Vc=[],Cc,Dc,Ec,Fc,Qc;function Wc(){var t=e.canvas;Vc.forEach((function(e){e(t.width,t.height)}))}function Nc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=8388608|e}Wc()}function Oc(){if("undefined"!=typeof SDL){var e=Ia[SDL.screen+0*n.H>>2];F[SDL.screen+0*n.H>>2]=-8388609&e}Wc()}function Pc(t,n,r){n&&r?(t.fb=n,t.Va=r):(n=t.fb,r=t.Va);var i=n,a=r;if(e.forcedAspectRatio&&0<e.forcedAspectRatio&&(i/a<e.forcedAspectRatio?i=Math.round(a*e.forcedAspectRatio):a=Math.round(i/e.forcedAspectRatio)),(document.webkitFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.mozFullscreenElement||document.fullScreenElement||document.fullscreenElement||document.msFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement)===t.parentNode&&"undefined"!=typeof screen){var o=Math.min(screen.width/i,screen.height/a);i=Math.round(i*o),a=Math.round(a*o)}Lc?(t.width!=i&&(t.width=i),t.height!=a&&(t.height=a),void 0!==t.style&&(t.style.removeProperty("width"),t.style.removeProperty("height"))):(t.width!=n&&(t.width=n),t.height!=r&&(t.height=r),void 0!==t.style&&(i!=n||a!=r?(t.style.setProperty("width",i+"px","important"),t.style.setProperty("height",a+"px","important")):(t.style.removeProperty("width"),t.style.removeProperty("height"))))}Yb(),R=Array(4096),Nb(P,"/"),V("/tmp"),V("/home"),V("/home/web_user"),function(){var e;if(V("/dev"),pb(259,{read:function(){return 0},write:function(e,t,n,r){return r}}),Qb("/dev/null",259),ob(1280,rb),ob(1536,sb),Qb("/dev/tty",1280),Qb("/dev/tty1",1536),"undefined"!=typeof crypto){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}else e=function(){return 256*Math.random()|0};W("/dev","random",e),W("/dev","urandom",e),V("/dev/shm"),V("/dev/shm/tmp")}(),V("/proc"),V("/proc/self"),V("/proc/self/fd"),Nb({A:function(){var e=ub("/proc/self","fd",16895,73);return e.k={lookup:function(e,t){var n=zb[+t];if(!n)throw new O(M.Z);var r={parent:null,A:{Fa:"fake"},k:{readlink:function(){return n.path}}};return r.parent=r}},e}},"/proc/self/fd"),Qa.unshift((function(){if(!e.noFSInit&&!Zb){assert(!Zb,"FS.init was previously called. If you want to initialize later with custom parameters, remove any earlier calls (note that one is automatically added to the generated code)"),Zb=!0,Yb(),e.stdin=e.stdin,e.stdout=e.stdout,e.stderr=e.stderr,e.stdin?W("/dev","stdin",e.stdin):Rb("/dev/tty","/dev/stdin"),e.stdout?W("/dev","stdout",null,e.stdout):Rb("/dev/tty","/dev/stdout"),e.stderr?W("/dev","stderr",null,e.stderr):Rb("/dev/tty1","/dev/stderr");var t=Tb("/dev/stdin","r");assert(0===t.fd,"invalid handle for stdin ("+t.fd+")"),assert(1===(t=Tb("/dev/stdout","w")).fd,"invalid handle for stdout ("+t.fd+")"),assert(2===(t=Tb("/dev/stderr","w")).fd,"invalid handle for stderr ("+t.fd+")")}})),Ra.push((function(){Cb=!1})),K.push((function(){Zb=!1;var t=e._fflush;for(t&&t(0),t=0;t<zb.length;t++){var n=zb[t];n&&Vb(n)}})),e.FS_createFolder=function(e,t,n,r){return V(e=N(("string"==typeof e?e:U(e))+"/"+t),$b(n,r))},e.FS_createPath=function(e,t){e="string"==typeof e?e:U(e);for(var n=t.split("/").reverse();n.length;){var r=n.pop();if(r){var i=N(e+"/"+r);try{V(i)}catch(e){}e=i}}return i},e.FS_createDataFile=bc,e.FS_createPreloadedFile=function(t,n,r,i,a,o,s,l,c,u){function d(r){function d(e){u&&u(),l||bc(t,n,e,i,a,c),o&&o(),Za()}var f=!1;e.preloadPlugins.forEach((function(e){!f&&e.canHandle(p)&&(e.handle(r,p,d,(function(){s&&s(),Za()})),f=!0)})),f||d(r)}Bc();var p=n?mb(N(t+"/"+n)):t;Ya(),"string"==typeof r?Uc(r,(function(e){d(e)}),s):d(r)},e.FS_createLazyFile=function(e,t,n,r,i){if("undefined"!=typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";n={Ca:!1,url:n};var a=ac(e,t,r,i);n.e?a.e=n.e:n.url&&(a.e=null,a.url=n.url),Object.defineProperty(a,"usedBytes",{get:function(){return this.e.length}});var o={};return Object.keys(a.n).forEach((function(e){var t=a.n[e];o[e]=function(){if(!cc(a))throw new O(M.F);return t.apply(null,arguments)}})),o.read=function(e,t,n,r,i){if(!cc(a))throw new O(M.F);if(i>=(e=e.g.e).length)return 0;if(assert(0<=(r=Math.min(e.length-i,r))),e.slice)for(var o=0;o<r;o++)t[n+o]=e[i+o];else for(o=0;o<r;o++)t[n+o]=e.get(i+o);return r},a.n=o,a},e.FS_createLink=function(e,t,n){return Rb(n,e=N(("string"==typeof e?e:U(e))+"/"+t))},e.FS_createDevice=W,e.FS_unlink=function(e){var t,n=T(e,{parent:!0}).g,r=lb(e),i=wb(n,r);e:{try{t=wb(n,r)}catch(e){t=e.Q;break e}var a=Gb(n,"wx");t=a||(16384==(61440&t.mode)?M.N:0)}if(t)throw t===M.N&&(t=M.G),new O(t);if(!n.k.unlink)throw new O(M.G);if(i.R)throw new O(M.$);try{S.willDeletePath&&S.willDeletePath(e)}catch(t){console.log("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}if(n.k.unlink(n,r),n=Eb(i.parent.id,i.name),R[n]===i)R[n]=i.K;else for(n=R[n];n;){if(n.K===i){n.K=i.K;break}n=n.K}try{S.onDeletePath&&S.onDeletePath(e)}catch(t){console.log("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},Qa.unshift((function(){})),K.push((function(){})),e.requestFullScreen=function(e,t,n){Mc(e,t,n)},e.requestAnimationFrame=function(e){nc(e)},e.setCanvasSize=function(t,n,r){Pc(e.canvas,t,n),r||Wc()},e.pauseMainLoop=function(){Y=null,qc++},e.resumeMainLoop=function(){qc++;var e=ic,t=jc,n=kc;kc=null,oc(n,0,!1,pc,!0),hc(e,t),Y()},e.getUserMedia=function(){window.C||(window.C=navigator.getUserMedia||navigator.mozGetUserMedia),window.C(void 0)},e.createContext=function(e,t,n,r){return Ic(e,t,n,r)},Ka=m=n.ea(p),va=!0,La=Ka+Na,Ma=v=n.ea(La),assert(Ma<w,"TOTAL_MEMORY not big enough for stack");var Xc=G([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",3);e.Na={Math,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Float32Array,Float64Array,NaN:NaN,Infinity:1/0},e.Oa={abort:z,assert,invoke_ii:function(t,n){try{return e.dynCall_ii(t,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_iiii:function(t,n,r,i){try{return e.dynCall_iiii(t,n,r,i)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},invoke_vi:function(t,n){try{e.dynCall_vi(t,n)}catch(e){if("number"!=typeof e&&"longjmp"!==e)throw e;Z.setThrew(1,0)}},_pthread_cleanup_pop:function(){assert(eb.level==K.length,"cannot pop if something else added meanwhile!"),K.pop(),eb.level=K.length},___lock:function(){},_emscripten_set_main_loop:oc,_pthread_self:function(){return 0},___syscall6:function(e,t){ec=t;try{return Vb(fc()),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_emscripten_set_main_loop_timing:hc,_abort:function(){e.abort()},_sbrk:wa,_time:function(e){var t=Date.now()/1e3|0;return e&&(F[e>>2]=t),t},___setErrNo:ib,_emscripten_memcpy_big:function(e,t,n){return H.set(H.subarray(t,t+n),e),e},___syscall54:function(e,t){ec=t;try{var n=fc(),r=X();switch(r){case 21505:case 21506:return n.tty?0:-M.O;case 21519:if(!n.tty)return-M.O;var i=X();return F[i>>2]=0;case 21520:return n.tty?-M.u:-M.O;case 21531:if(i=X(),!n.n.Wa)throw new O(M.O);return n.n.Wa(n,r,i);default:z("bad ioctl syscall "+r)}}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},___unlock:function(){},___syscall140:function(e,t){ec=t;try{var n=fc(),r=X(),i=X(),a=X(),o=X();return assert(0===r),Wb(n,i,o),F[a>>2]=n.position,n.ia&&0===i&&0===o&&(n.ia=null),0}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},_pthread_cleanup_push:eb,_sysconf:function(e){switch(e){case 30:return 4096;case 85:return I/4096;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 80:case 81:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 79:return 0;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return ib(M.u),-1},___syscall146:function(e,t){ec=t;try{var n,r=fc(),i=X();e:{for(var a=X(),o=0,s=0;s<a;s++){var l=Xb(r,D,F[i+8*s>>2],F[i+(8*s+4)>>2],void 0);if(0>l){n=-1;break e}o+=l}n=o}return n}catch(e){return void 0!==dc&&e instanceof O||z(e),-e.Q}},STACKTOP:m,STACK_MAX:La,tempDoublePtr:$a,ABORT:A,cttz_i8:Xc};var Z=function(e,t,n){var r=new e.Int8Array(n),i=(new e.Int16Array(n),new e.Int32Array(n)),a=new e.Uint8Array(n),o=(new e.Uint16Array(n),new e.Uint32Array(n),new e.Float32Array(n),new e.Float64Array(n),0|t.STACKTOP),s=(t.STACK_MAX,t.tempDoublePtr,t.ABORT,t.cttz_i8,0),l=(e.NaN,e.Infinity,0),c=(e.Math.floor,e.Math.abs,e.Math.sqrt,e.Math.pow,e.Math.cos,e.Math.sin,e.Math.tan,e.Math.acos,e.Math.asin,e.Math.atan,e.Math.atan2,e.Math.exp,e.Math.log,e.Math.ceil,e.Math.imul),u=(e.Math.min,e.Math.clz32,t.abort),d=(t.assert,t.invoke_ii,t.invoke_iiii,t.invoke_vi,t._pthread_cleanup_pop),p=t.___lock,f=(t._emscripten_set_main_loop,t._pthread_self),_=t.___syscall6,h=(t._emscripten_set_main_loop_timing,t._abort),g=t._sbrk,m=t._time,y=(t.___setErrNo,t._emscripten_memcpy_big),S=t.___syscall54,E=t.___unlock,v=t.___syscall140,T=t._pthread_cleanup_push,C=t._sysconf,A=t.___syscall146;function b(e,t,n){e|=0;var r,a=0,s=0,c=0,u=0,d=0,p=0,f=0,_=0,h=0,g=0,m=0;r=o,o=o+160|0,P(a=r,t|=0,n|=0),t=0|i[(n=a+144|0)>>2],s=0|i[n+4>>2],u=0|i[(c=n=a+64|0)>>2],d=0|i[c+4>>2],c=0|F(0|t,0|s,18,0),p=l,f=0|U(0|u,0|d,0|t,0|s),s=0|U(0|f,0|l,0|c,0|p),i[(p=n)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+136|0)>>2],n=0|i[p+4>>2],f=0|i[(c=p=a+56|0)>>2],t=0|i[c+4>>2],c=0|F(0|s,0|n,18,0),d=l,u=0|U(0|f,0|t,0|s,0|n),n=0|U(0|u,0|l,0|c,0|d),i[(d=p)>>2]=n,i[d+4>>2]=l,n=0|i[(d=a+128|0)>>2],p=0|i[d+4>>2],u=0|i[(c=d=a+48|0)>>2],s=0|i[c+4>>2],c=0|F(0|n,0|p,18,0),t=l,f=0|U(0|u,0|s,0|n,0|p),p=0|U(0|f,0|l,0|c,0|t),i[(t=d)>>2]=p,i[t+4>>2]=l,p=0|i[(t=a+120|0)>>2],d=0|i[t+4>>2],f=0|i[(c=t=a+40|0)>>2],n=0|i[c+4>>2],c=0|F(0|p,0|d,18,0),s=l,u=0|U(0|f,0|n,0|p,0|d),d=0|U(0|u,0|l,0|c,0|s),i[(s=t)>>2]=d,i[s+4>>2]=l,d=0|i[(s=a+112|0)>>2],t=0|i[s+4>>2],u=0|i[(c=s=a+32|0)>>2],p=0|i[c+4>>2],c=0|F(0|d,0|t,18,0),n=l,f=0|U(0|u,0|p,0|d,0|t),t=0|U(0|f,0|l,0|c,0|n),i[(n=s)>>2]=t,i[n+4>>2]=l,t=0|i[(n=a+104|0)>>2],s=0|i[n+4>>2],f=0|i[(c=n=a+24|0)>>2],d=0|i[c+4>>2],c=0|F(0|t,0|s,18,0),p=l,u=0|U(0|f,0|d,0|t,0|s),s=0|U(0|u,0|l,0|c,0|p),i[(p=n)>>2]=s,i[p+4>>2]=l,s=0|i[(p=a+96|0)>>2],n=0|i[p+4>>2],u=0|i[(c=p=a+16|0)>>2],t=0|i[c+4>>2],c=0|F(0|s,0|n,18,0),d=l,f=0|U(0|u,0|t,0|s,0|n),n=0|U(0|f,0|l,0|c,0|d),i[(d=p)>>2]=n,i[d+4>>2]=l,n=0|i[(d=a+88|0)>>2],p=0|i[d+4>>2],f=0|i[(c=d=a+8|0)>>2],s=0|i[c+4>>2],c=0|F(0|n,0|p,18,0),t=l,u=0|U(0|f,0|s,0|n,0|p),p=0|U(0|u,0|l,0|c,0|t),i[(t=d)>>2]=p,i[t+4>>2]=l,c=0|i[(p=t=a+80|0)>>2],u=0|i[p+4>>2],n=0|i[(p=a)>>2],s=0|i[p+4>>2],p=0|F(0|c,0|u,18,0),f=l,_=0|U(0|n,0|s,0|c,0|u),u=0|U(0|_,0|l,0|p,0|f),f=l,i[(p=a)>>2]=u,i[p+4>>2]=f,i[(p=t)>>2]=0,i[p+4>>2]=0,p=f,f=u,u=0;do{n=0|k(0|f,0|p,0|(s=0|B(0|(c=0|D(0|(_=0|U(p>>31>>>6|0,0,0|f,0|p)),0|l,26)),0|(_=l),26)),0|l),i[(s=a+(u<<3)|0)>>2]=n,i[s+4>>2]=l,m=0|k(0|(h=0|U(0|c,0|_,0|i[(n=s=a+((1|u)<<3)|0)>>2],0|i[n+4>>2])),0|(n=l),0|(g=0|B(0|(c=0|D(0|(_=0|U(n>>31>>>7|0,0,0|h,0|n)),0|l,25)),0|(_=l),25)),0|l),i[(g=s)>>2]=m,i[g+4>>2]=l,f=0|U(0|c,0|_,0|i[(m=g=a+((u=u+2|0)<<3)|0)>>2],0|i[m+4>>2]),p=l,i[(m=g)>>2]=f,i[m+4>>2]=p}while(u>>>0<10);p=0|i[(u=t)>>2],f=0|i[u+4>>2],m=0|i[(u=a)>>2],g=0|i[u+4>>2],u=0|F(0|p,0|f,18,0),_=l,c=0|U(0|m,0|g,0|p,0|f),f=0|U(0|c,0|l,0|u,0|_),_=l,i[(u=t)>>2]=0,i[u+4>>2]=0,p=0|k(0|f,0|_,0|(c=0|B(0|(t=0|D(0|(u=0|U(_>>31>>>6|0,0,0|f,0|_)),0|l,26)),0|(u=l),26)),0|l),i[(c=a)>>2]=p,i[c+4>>2]=l,p=0|U(0|t,0|u,0|i[(c=d)>>2],0|i[c+4>>2]),i[(c=d)>>2]=p,i[c+4>>2]=l,c=e,e=a,a=c+80|0;do{i[c>>2]=i[e>>2],c=c+4|0,e=e+4|0}while((0|c)<(0|a));o=r}function P(e,t,n){e|=0,n|=0;var r=0,a=0,o=0,s=0,c=0,u=0,d=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,S=0,E=0,v=0,T=0,C=0,A=0,b=0,P=0,O=0;r=0|D(0,0|i[(t|=0)>>2],32),a=l,s=0|F(0|(o=0|D(0,0|i[n>>2],32)),0|l,0|r,0|a),i[(a=e)>>2]=s,i[a+4>>2]=l,a=0|D(0,0|i[t>>2],32),s=l,c=0|F(0|(o=0|D(0,0|i[(r=n+8|0)>>2],32)),0|l,0|a,0|s),s=l,o=0|D(0,0|i[(a=t+8|0)>>2],32),u=l,u=0|U(0|(p=0|F(0|(d=0|D(0,0|i[n>>2],32)),0|l,0|o,0|u)),0|l,0|c,0|s),i[(s=e+8|0)>>2]=u,i[s+4>>2]=l,s=0|D(0,0|i[a>>2],31),u=l,p=0|F(0|(c=0|D(0,0|i[r>>2],32)),0|l,0|s,0|u),u=l,s=0|D(0,0|i[t>>2],32),c=l,c=0|U(0|(f=0|F(0|(d=0|D(0,0|i[(o=n+16|0)>>2],32)),0|l,0|s,0|c)),0|l,0|p,0|u),u=l,f=0|D(0,0|i[(p=t+16|0)>>2],32),s=l,s=0|U(0|c,0|u,0|(_=0|F(0|(d=0|D(0,0|i[n>>2],32)),0|l,0|f,0|s)),0|l),i[(_=e+16|0)>>2]=s,i[_+4>>2]=l,_=0|D(0,0|i[a>>2],32),s=l,c=0|F(0|(u=0|D(0,0|i[o>>2],32)),0|l,0|_,0|s),s=l,_=0|D(0,0|i[p>>2],32),u=l,u=0|U(0|(d=0|F(0|(f=0|D(0,0|i[r>>2],32)),0|l,0|_,0|u)),0|l,0|c,0|s),s=l,c=0|D(0,0|i[t>>2],32),d=l,d=0|U(0|u,0|s,0|(h=0|F(0|(f=0|D(0,0|i[(_=n+24|0)>>2],32)),0|l,0|c,0|d)),0|l),h=l,u=0|D(0,0|i[(s=t+24|0)>>2],32),c=l,c=0|U(0|d,0|h,0|(g=0|F(0|(f=0|D(0,0|i[n>>2],32)),0|l,0|u,0|c)),0|l),i[(g=e+24|0)>>2]=c,i[g+4>>2]=l,g=0|D(0,0|i[p>>2],32),c=l,d=0|F(0|(h=0|D(0,0|i[o>>2],32)),0|l,0|g,0|c),c=l,g=0|D(0,0|i[a>>2],32),h=l,f=0|F(0|(u=0|D(0,0|i[_>>2],32)),0|l,0|g,0|h),h=l,g=0|D(0,0|i[s>>2],32),u=l,u=0|U(0|(y=0|F(0|(m=0|D(0,0|i[r>>2],32)),0|l,0|g,0|u)),0|l,0|f,0|h),u=0|U(0|(h=0|B(0|u,0|l,1)),0|l,0|d,0|c),c=l,d=0|D(0,0|i[t>>2],32),h=l,h=0|U(0|u,0|c,0|(g=0|F(0|(y=0|D(0,0|i[(f=n+32|0)>>2],32)),0|l,0|d,0|h)),0|l),g=l,u=0|D(0,0|i[(c=t+32|0)>>2],32),d=l,d=0|U(0|h,0|g,0|(m=0|F(0|(y=0|D(0,0|i[n>>2],32)),0|l,0|u,0|d)),0|l),i[(m=e+32|0)>>2]=d,i[m+4>>2]=l,m=0|D(0,0|i[p>>2],32),d=l,h=0|F(0|(g=0|D(0,0|i[_>>2],32)),0|l,0|m,0|d),d=l,m=0|D(0,0|i[s>>2],32),g=l,g=0|U(0|(y=0|F(0|(u=0|D(0,0|i[o>>2],32)),0|l,0|m,0|g)),0|l,0|h,0|d),d=l,h=0|D(0,0|i[a>>2],32),y=l,y=0|U(0|g,0|d,0|(u=0|F(0|(m=0|D(0,0|i[f>>2],32)),0|l,0|h,0|y)),0|l),u=l,d=0|D(0,0|i[c>>2],32),g=l,g=0|U(0|y,0|u,0|(m=0|F(0|(h=0|D(0,0|i[r>>2],32)),0|l,0|d,0|g)),0|l),m=l,u=0|D(0,0|i[t>>2],32),y=l,y=0|U(0|g,0|m,0|(S=0|F(0|(h=0|D(0,0|i[(d=n+40|0)>>2],32)),0|l,0|u,0|y)),0|l),S=l,g=0|D(0,0|i[(m=t+40|0)>>2],32),u=l,u=0|U(0|y,0|S,0|(E=0|F(0|(h=0|D(0,0|i[n>>2],32)),0|l,0|g,0|u)),0|l),i[(E=e+40|0)>>2]=u,i[E+4>>2]=l,E=0|D(0,0|i[s>>2],32),u=l,y=0|F(0|(S=0|D(0,0|i[_>>2],32)),0|l,0|E,0|u),u=l,E=0|D(0,0|i[a>>2],32),S=l,S=0|U(0|(h=0|F(0|(g=0|D(0,0|i[d>>2],32)),0|l,0|E,0|S)),0|l,0|y,0|u),u=l,y=0|D(0,0|i[m>>2],32),h=l,g=0|B(0|(h=0|U(0|S,0|u,0|(g=0|F(0|(E=0|D(0,0|i[r>>2],32)),0|l,0|y,0|h)),0|l)),0|l,1),h=l,u=0|D(0,0|i[p>>2],32),S=l,S=0|U(0|g,0|h,0|(E=0|F(0|(y=0|D(0,0|i[f>>2],32)),0|l,0|u,0|S)),0|l),E=l,h=0|D(0,0|i[c>>2],32),g=l,g=0|U(0|S,0|E,0|(y=0|F(0|(u=0|D(0,0|i[o>>2],32)),0|l,0|h,0|g)),0|l),y=l,E=0|D(0,0|i[t>>2],32),S=l,S=0|U(0|g,0|y,0|(v=0|F(0|(u=0|D(0,0|i[(h=n+48|0)>>2],32)),0|l,0|E,0|S)),0|l),v=l,g=0|D(0,0|i[(y=t+48|0)>>2],32),E=l,E=0|U(0|S,0|v,0|(T=0|F(0|(u=0|D(0,0|i[n>>2],32)),0|l,0|g,0|E)),0|l),i[(T=e+48|0)>>2]=E,i[T+4>>2]=l,T=0|D(0,0|i[s>>2],32),E=l,S=0|F(0|(v=0|D(0,0|i[f>>2],32)),0|l,0|T,0|E),E=l,T=0|D(0,0|i[c>>2],32),v=l,v=0|U(0|(u=0|F(0|(g=0|D(0,0|i[_>>2],32)),0|l,0|T,0|v)),0|l,0|S,0|E),E=l,S=0|D(0,0|i[p>>2],32),u=l,u=0|U(0|v,0|E,0|(g=0|F(0|(T=0|D(0,0|i[d>>2],32)),0|l,0|S,0|u)),0|l),g=l,E=0|D(0,0|i[m>>2],32),v=l,v=0|U(0|u,0|g,0|(T=0|F(0|(S=0|D(0,0|i[o>>2],32)),0|l,0|E,0|v)),0|l),T=l,g=0|D(0,0|i[a>>2],32),u=l,u=0|U(0|v,0|T,0|(S=0|F(0|(E=0|D(0,0|i[h>>2],32)),0|l,0|g,0|u)),0|l),S=l,T=0|D(0,0|i[y>>2],32),v=l,v=0|U(0|u,0|S,0|(E=0|F(0|(g=0|D(0,0|i[r>>2],32)),0|l,0|T,0|v)),0|l),E=l,S=0|D(0,0|i[t>>2],32),u=l,u=0|U(0|v,0|E,0|(C=0|F(0|(g=0|D(0,0|i[(T=n+56|0)>>2],32)),0|l,0|S,0|u)),0|l),C=l,v=0|D(0,0|i[(E=t+56|0)>>2],32),S=l,S=0|U(0|u,0|C,0|(A=0|F(0|(g=0|D(0,0|i[n>>2],32)),0|l,0|v,0|S)),0|l),i[(A=e+56|0)>>2]=S,i[A+4>>2]=l,A=0|D(0,0|i[c>>2],32),S=l,u=0|F(0|(C=0|D(0,0|i[f>>2],32)),0|l,0|A,0|S),S=l,A=0|D(0,0|i[s>>2],32),C=l,g=0|F(0|(v=0|D(0,0|i[d>>2],32)),0|l,0|A,0|C),C=l,A=0|D(0,0|i[m>>2],32),v=l,v=0|U(0|(P=0|F(0|(b=0|D(0,0|i[_>>2],32)),0|l,0|A,0|v)),0|l,0|g,0|C),C=l,g=0|D(0,0|i[a>>2],32),P=l,P=0|U(0|v,0|C,0|(b=0|F(0|(A=0|D(0,0|i[T>>2],32)),0|l,0|g,0|P)),0|l),b=l,C=0|D(0,0|i[E>>2],32),v=l,v=0|U(0|P,0|b,0|(A=0|F(0|(g=0|D(0,0|i[r>>2],32)),0|l,0|C,0|v)),0|l),v=0|U(0|(A=0|B(0|v,0|l,1)),0|l,0|u,0|S),S=l,u=0|D(0,0|i[p>>2],32),A=l,A=0|U(0|v,0|S,0|(P=0|F(0|(b=0|D(0,0|i[h>>2],32)),0|l,0|u,0|A)),0|l),P=l,S=0|D(0,0|i[y>>2],32),v=l,v=0|U(0|A,0|P,0|(b=0|F(0|(u=0|D(0,0|i[o>>2],32)),0|l,0|S,0|v)),0|l),b=l,P=0|D(0,0|i[t>>2],32),A=l,A=0|U(0|v,0|b,0|(C=0|F(0|(u=0|D(0,0|i[(S=n+64|0)>>2],32)),0|l,0|P,0|A)),0|l),C=l,v=0|D(0,0|i[(b=t+64|0)>>2],32),P=l,P=0|U(0|A,0|C,0|(g=0|F(0|(u=0|D(0,0|i[n>>2],32)),0|l,0|v,0|P)),0|l),i[(g=e+64|0)>>2]=P,i[g+4>>2]=l,g=0|D(0,0|i[c>>2],32),P=l,A=0|F(0|(C=0|D(0,0|i[d>>2],32)),0|l,0|g,0|P),P=l,g=0|D(0,0|i[m>>2],32),C=l,C=0|U(0|(u=0|F(0|(v=0|D(0,0|i[f>>2],32)),0|l,0|g,0|C)),0|l,0|A,0|P),P=l,A=0|D(0,0|i[s>>2],32),u=l,u=0|U(0|C,0|P,0|(v=0|F(0|(g=0|D(0,0|i[h>>2],32)),0|l,0|A,0|u)),0|l),v=l,P=0|D(0,0|i[y>>2],32),C=l,C=0|U(0|u,0|v,0|(g=0|F(0|(A=0|D(0,0|i[_>>2],32)),0|l,0|P,0|C)),0|l),g=l,v=0|D(0,0|i[p>>2],32),u=l,u=0|U(0|C,0|g,0|(A=0|F(0|(P=0|D(0,0|i[T>>2],32)),0|l,0|v,0|u)),0|l),A=l,g=0|D(0,0|i[E>>2],32),C=l,C=0|U(0|u,0|A,0|(P=0|F(0|(v=0|D(0,0|i[o>>2],32)),0|l,0|g,0|C)),0|l),P=l,A=0|D(0,0|i[a>>2],32),u=l,u=0|U(0|C,0|P,0|(v=0|F(0|(g=0|D(0,0|i[S>>2],32)),0|l,0|A,0|u)),0|l),v=l,P=0|D(0,0|i[b>>2],32),C=l,C=0|U(0|u,0|v,0|(g=0|F(0|(A=0|D(0,0|i[r>>2],32)),0|l,0|P,0|C)),0|l),g=l,v=0|D(0,0|i[t>>2],32),u=l,u=0|U(0|C,0|g,0|(O=0|F(0|(A=0|D(0,0|i[(P=n+72|0)>>2],32)),0|l,0|v,0|u)),0|l),O=l,t=0|D(0,0|i[(g=t+72|0)>>2],32),C=l,C=0|U(0|u,0|O,0|(n=0|F(0|(v=0|D(0,0|i[n>>2],32)),0|l,0|t,0|C)),0|l),i[(n=e+72|0)>>2]=C,i[n+4>>2]=l,n=0|D(0,0|i[m>>2],32),C=l,u=0|F(0|(O=0|D(0,0|i[d>>2],32)),0|l,0|n,0|C),C=l,n=0|D(0,0|i[s>>2],32),O=l,O=0|U(0|(v=0|F(0|(t=0|D(0,0|i[T>>2],32)),0|l,0|n,0|O)),0|l,0|u,0|C),C=l,u=0|D(0,0|i[E>>2],32),v=l,v=0|U(0|O,0|C,0|(t=0|F(0|(n=0|D(0,0|i[_>>2],32)),0|l,0|u,0|v)),0|l),t=l,C=0|D(0,0|i[a>>2],32),a=l,a=0|U(0|v,0|t,0|(u=0|F(0|(O=0|D(0,0|i[P>>2],32)),0|l,0|C,0|a)),0|l),u=l,t=0|D(0,0|i[g>>2],32),v=l,r=0|B(0|(v=0|U(0|a,0|u,0|(r=0|F(0|(C=0|D(0,0|i[r>>2],32)),0|l,0|t,0|v)),0|l)),0|l,1),v=l,u=0|D(0,0|i[c>>2],32),a=l,a=0|U(0|r,0|v,0|(C=0|F(0|(t=0|D(0,0|i[h>>2],32)),0|l,0|u,0|a)),0|l),C=l,v=0|D(0,0|i[y>>2],32),r=l,r=0|U(0|a,0|C,0|(t=0|F(0|(u=0|D(0,0|i[f>>2],32)),0|l,0|v,0|r)),0|l),t=l,C=0|D(0,0|i[p>>2],32),a=l,a=0|U(0|r,0|t,0|(u=0|F(0|(v=0|D(0,0|i[S>>2],32)),0|l,0|C,0|a)),0|l),u=l,t=0|D(0,0|i[b>>2],32),r=l,r=0|U(0|a,0|u,0|(v=0|F(0|(C=0|D(0,0|i[o>>2],32)),0|l,0|t,0|r)),0|l),i[(v=e+80|0)>>2]=r,i[v+4>>2]=l,v=0|D(0,0|i[m>>2],32),r=l,a=0|F(0|(u=0|D(0,0|i[h>>2],32)),0|l,0|v,0|r),r=l,v=0|D(0,0|i[y>>2],32),u=l,u=0|U(0|(C=0|F(0|(t=0|D(0,0|i[d>>2],32)),0|l,0|v,0|u)),0|l,0|a,0|r),r=l,a=0|D(0,0|i[c>>2],32),C=l,C=0|U(0|u,0|r,0|(t=0|F(0|(v=0|D(0,0|i[T>>2],32)),0|l,0|a,0|C)),0|l),t=l,r=0|D(0,0|i[E>>2],32),u=l,u=0|U(0|C,0|t,0|(v=0|F(0|(a=0|D(0,0|i[f>>2],32)),0|l,0|r,0|u)),0|l),v=l,t=0|D(0,0|i[s>>2],32),C=l,C=0|U(0|u,0|v,0|(a=0|F(0|(r=0|D(0,0|i[S>>2],32)),0|l,0|t,0|C)),0|l),a=l,v=0|D(0,0|i[b>>2],32),u=l,u=0|U(0|C,0|a,0|(r=0|F(0|(t=0|D(0,0|i[_>>2],32)),0|l,0|v,0|u)),0|l),r=l,a=0|D(0,0|i[p>>2],32),p=l,p=0|U(0|u,0|r,0|(v=0|F(0|(C=0|D(0,0|i[P>>2],32)),0|l,0|a,0|p)),0|l),v=l,r=0|D(0,0|i[g>>2],32),u=l,u=0|U(0|p,0|v,0|(o=0|F(0|(a=0|D(0,0|i[o>>2],32)),0|l,0|r,0|u)),0|l),i[(o=e+88|0)>>2]=u,i[o+4>>2]=l,o=0|D(0,0|i[y>>2],32),u=l,p=0|F(0|(v=0|D(0,0|i[h>>2],32)),0|l,0|o,0|u),u=l,o=0|D(0,0|i[m>>2],32),v=l,a=0|F(0|(r=0|D(0,0|i[T>>2],32)),0|l,0|o,0|v),v=l,o=0|D(0,0|i[E>>2],32),r=l,r=0|U(0|(t=0|F(0|(C=0|D(0,0|i[d>>2],32)),0|l,0|o,0|r)),0|l,0|a,0|v),v=l,a=0|D(0,0|i[s>>2],32),s=l,s=0|U(0|r,0|v,0|(o=0|F(0|(t=0|D(0,0|i[P>>2],32)),0|l,0|a,0|s)),0|l),o=l,v=0|D(0,0|i[g>>2],32),r=l,r=0|U(0|s,0|o,0|(_=0|F(0|(a=0|D(0,0|i[_>>2],32)),0|l,0|v,0|r)),0|l),r=0|U(0|(_=0|B(0|r,0|l,1)),0|l,0|p,0|u),u=l,p=0|D(0,0|i[c>>2],32),_=l,_=0|U(0|r,0|u,0|(s=0|F(0|(o=0|D(0,0|i[S>>2],32)),0|l,0|p,0|_)),0|l),s=l,u=0|D(0,0|i[b>>2],32),r=l,r=0|U(0|_,0|s,0|(o=0|F(0|(p=0|D(0,0|i[f>>2],32)),0|l,0|u,0|r)),0|l),i[(o=e+96|0)>>2]=r,i[o+4>>2]=l,o=0|D(0,0|i[y>>2],32),r=l,_=0|F(0|(s=0|D(0,0|i[T>>2],32)),0|l,0|o,0|r),r=l,o=0|D(0,0|i[E>>2],32),s=l,s=0|U(0|(p=0|F(0|(u=0|D(0,0|i[h>>2],32)),0|l,0|o,0|s)),0|l,0|_,0|r),r=l,_=0|D(0,0|i[m>>2],32),p=l,p=0|U(0|s,0|r,0|(u=0|F(0|(o=0|D(0,0|i[S>>2],32)),0|l,0|_,0|p)),0|l),u=l,r=0|D(0,0|i[b>>2],32),s=l,s=0|U(0|p,0|u,0|(o=0|F(0|(_=0|D(0,0|i[d>>2],32)),0|l,0|r,0|s)),0|l),o=l,u=0|D(0,0|i[c>>2],32),c=l,c=0|U(0|s,0|o,0|(r=0|F(0|(p=0|D(0,0|i[P>>2],32)),0|l,0|u,0|c)),0|l),r=l,o=0|D(0,0|i[g>>2],32),s=l,s=0|U(0|c,0|r,0|(f=0|F(0|(u=0|D(0,0|i[f>>2],32)),0|l,0|o,0|s)),0|l),i[(f=e+104|0)>>2]=s,i[f+4>>2]=l,f=0|D(0,0|i[E>>2],32),s=l,c=0|F(0|(r=0|D(0,0|i[T>>2],32)),0|l,0|f,0|s),s=l,f=0|D(0,0|i[m>>2],32),m=l,m=0|U(0|(o=0|F(0|(r=0|D(0,0|i[P>>2],32)),0|l,0|f,0|m)),0|l,0|c,0|s),s=l,c=0|D(0,0|i[g>>2],32),o=l,d=0|B(0|(o=0|U(0|m,0|s,0|(d=0|F(0|(f=0|D(0,0|i[d>>2],32)),0|l,0|c,0|o)),0|l)),0|l,1),o=l,s=0|D(0,0|i[y>>2],32),m=l,m=0|U(0|d,0|o,0|(f=0|F(0|(c=0|D(0,0|i[S>>2],32)),0|l,0|s,0|m)),0|l),f=l,o=0|D(0,0|i[b>>2],32),d=l,d=0|U(0|m,0|f,0|(c=0|F(0|(s=0|D(0,0|i[h>>2],32)),0|l,0|o,0|d)),0|l),i[(c=e+112|0)>>2]=d,i[c+4>>2]=l,c=0|D(0,0|i[E>>2],32),d=l,m=0|F(0|(f=0|D(0,0|i[S>>2],32)),0|l,0|c,0|d),d=l,c=0|D(0,0|i[b>>2],32),f=l,f=0|U(0|(s=0|F(0|(o=0|D(0,0|i[T>>2],32)),0|l,0|c,0|f)),0|l,0|m,0|d),d=l,m=0|D(0,0|i[y>>2],32),y=l,y=0|U(0|f,0|d,0|(c=0|F(0|(s=0|D(0,0|i[P>>2],32)),0|l,0|m,0|y)),0|l),c=l,d=0|D(0,0|i[g>>2],32),f=l,f=0|U(0|y,0|c,0|(h=0|F(0|(m=0|D(0,0|i[h>>2],32)),0|l,0|d,0|f)),0|l),i[(h=e+120|0)>>2]=f,i[h+4>>2]=l,h=0|D(0,0|i[b>>2],32),f=l,y=0|F(0|(c=0|D(0,0|i[S>>2],32)),0|l,0|h,0|f),f=l,h=0|D(0,0|i[E>>2],32),E=l,d=0|F(0|(c=0|D(0,0|i[P>>2],32)),0|l,0|h,0|E),E=l,h=0|D(0,0|i[g>>2],32),c=l,c=0|U(0|(T=0|F(0|(m=0|D(0,0|i[T>>2],32)),0|l,0|h,0|c)),0|l,0|d,0|E),c=0|U(0|(E=0|B(0|c,0|l,1)),0|l,0|y,0|f),i[(f=e+128|0)>>2]=c,i[f+4>>2]=l,f=0|D(0,0|i[b>>2],32),b=l,y=0|F(0|(c=0|D(0,0|i[P>>2],32)),0|l,0|f,0|b),b=l,f=0|D(0,0|i[g>>2],32),c=l,c=0|U(0|(S=0|F(0|(E=0|D(0,0|i[S>>2],32)),0|l,0|f,0|c)),0|l,0|y,0|b),i[(b=e+136|0)>>2]=c,i[b+4>>2]=l,b=0|D(0,0|i[g>>2],31),g=l,P=0|F(0|(c=0|D(0,0|i[P>>2],32)),0|l,0|b,0|g),i[(g=e+144|0)>>2]=P,i[g+4>>2]=l}function O(e,t){e|=0;var n,r,a,s=0,c=0,u=0,d=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,S=0,E=0,v=0,T=0,C=0,A=0,b=0,P=0,O=0,M=0,I=0,w=0,R=0,N=0,L=0,G=0,x=0,j=0,Y=0,K=0,W=0,H=0,V=0,$=0,z=0,q=0;n=o,o=o+160|0,s=n,d=0|F(0|(r=0|D(0,0|(c=0|i[(t|=0)>>2]),32)),0|(u=l),0|r,0|u),i[(p=s)>>2]=d,i[p+4>>2]=l,p=0|D(0,0|c,31),c=l,g=0|F(0|(_=0|D(0,0|(f=0|i[(d=t+8|0)>>2]),32)),0|(h=l),0|p,0|c),i[(m=a=s+8|0)>>2]=g,i[m+4>>2]=l,m=0|F(0|_,0|h,0|_,0|h),g=l,g=0|B(0|(T=0|U(0|(v=0|F(0|(S=0|D(0,0|i[(y=t+16|0)>>2],32)),0|(E=l),0|r,0|u)),0|l,0|m,0|g)),0|l,1),i[(m=T=s+16|0)>>2]=g,i[m+4>>2]=l,m=0|F(0|S,0|E,0|_,0|h),g=l,g=0|B(0|(P=0|U(0|(b=0|F(0|(C=0|D(0,0|i[(v=t+24|0)>>2],32)),0|(A=l),0|r,0|u)),0|l,0|m,0|g)),0|l,1),i[(m=P=s+24|0)>>2]=g,i[m+4>>2]=l,m=0|F(0|S,0|E,0|S,0|E),g=l,b=0|U(0|(O=0|F(0|C,0|A,0|(b=0|D(0,0|f,30)),0|l)),0|l,0|m,0|g),c=0|U(0|b,0|(g=l),0|(I=0|F(0|(O=0|D(0,0|i[(m=t+32|0)>>2],32)),0|(M=l),0|p,0|c)),0|l),i[(g=I=s+32|0)>>2]=c,i[g+4>>2]=l,g=0|F(0|C,0|A,0|S,0|E),c=l,p=0|U(0|(b=0|F(0|O,0|M,0|_,0|h)),0|l,0|g,0|c),R=0|B(0|(N=0|U(0|p,0|(c=l),0|(R=0|F(0|(b=0|D(0,0|i[(g=t+40|0)>>2],32)),0|(w=l),0|r,0|u)),0|l)),0|l,1),i[(c=N=s+40|0)>>2]=R,i[c+4>>2]=l,c=0|F(0|C,0|A,0|C,0|A),R=l,L=0|U(0|(p=0|F(0|O,0|M,0|S,0|E)),0|l,0|c,0|R),j=0|U(0|L,0|(R=l),0|(x=0|F(0|(p=0|D(0,0|i[(c=t+48|0)>>2],32)),0|(G=l),0|r,0|u)),0|l),f=0|B(0|(R=0|U(0|j,0|(x=l),0|(f=0|F(0|b,0|w,0|(R=0|D(0,0|f,31)),0|l)),0|l)),0|l,1),i[(x=R=s+48|0)>>2]=f,i[x+4>>2]=l,x=0|F(0|O,0|M,0|C,0|A),f=l,L=0|U(0|(j=0|F(0|b,0|w,0|S,0|E)),0|l,0|x,0|f),j=0|U(0|L,0|(f=l),0|(x=0|F(0|p,0|G,0|_,0|h)),0|l),K=0|B(0|(W=0|U(0|j,0|(x=l),0|(K=0|F(0|(L=0|D(0,0|i[(f=t+56|0)>>2],32)),0|(Y=l),0|r,0|u)),0|l)),0|l,1),i[(x=W=s+56|0)>>2]=K,i[x+4>>2]=l,x=0|F(0|O,0|M,0|O,0|M),K=l,j=0|F(0|p,0|G,0|S,0|E),H=l,u=0|U(0|(q=0|F(0|($=0|D(0,0|i[(V=t+64|0)>>2],32)),0|(z=l),0|r,0|u)),0|l,0|j,0|H),H=l,j=0|F(0|L,0|Y,0|_,0|h),h=l,q=0|U(0|(_=0|F(0|b,0|w,0|C,0|A)),0|l,0|j,0|h),q=0|U(0|u,0|H,0|(h=0|B(0|q,0|l,1)),0|l),q=0|U(0|(h=0|B(0|q,0|l,1)),0|l,0|x,0|K),i[(x=K=s+64|0)>>2]=q,i[x+4>>2]=l,x=0|F(0|b,0|w,0|O,0|M),q=l,A=0|U(0|(h=0|F(0|p,0|G,0|C,0|A)),0|l,0|x,0|q),E=0|U(0|A,0|(q=l),0|(x=0|F(0|L,0|Y,0|S,0|E)),0|l),S=0|U(0|E,0|(x=l),0|(A=0|F(0|$,0|z,0|(q=0|D(0,0|i[d>>2],32)),0|(d=l))),0|l),A=l,x=0|D(0,0|i[t>>2],32),E=l,H=0|B(0|(E=0|U(0|S,0|A,0|(H=0|F(0|(t=0|D(0,0|(h=0|i[t+72>>2]),32)),0|(C=l),0|x,0|E)),0|l)),0|l,1),i[(E=s+72|0)>>2]=H,i[E+4>>2]=l,E=0|F(0|b,0|w,0|b,0|w),H=l,M=0|U(0|(A=0|F(0|p,0|G,0|O,0|M)),0|l,0|E,0|H),O=0|U(0|M,0|(H=l),0|(A=0|F(0|$,0|z,0|(E=0|D(0,0|i[y>>2],32)),0|(y=l))),0|l),A=l,M=0|F(0|L,0|Y,0|(H=0|D(0,0|i[v>>2],32)),0|(v=l)),S=l,S=0|B(0|(d=0|U(0|(x=0|F(0|t,0|C,0|q,0|d)),0|l,0|M,0|S)),0|l,1),S=0|B(0|(d=0|U(0|O,0|A,0|S,0|l)),0|l,1),i[(A=d=s+80|0)>>2]=S,i[A+4>>2]=l,A=0|F(0|p,0|G,0|b,0|w),w=l,O=0|U(0|(S=0|F(0|L,0|Y,0|(b=0|D(0,0|i[m>>2],32)),0|(m=l))),0|l,0|A,0|w),S=0|U(0|O,0|(w=l),0|(A=0|F(0|$,0|z,0|H,0|v)),0|l),A=0|B(0|(y=0|U(0|S,0|(A=l),0|(w=0|F(0|t,0|C,0|E,0|y)),0|l)),0|(w=l),1),S=l,i[(E=s+88|0)>>2]=A,i[E+4>>2]=S,E=0|F(0|p,0|G,0|p,0|G),G=l,p=0|F(0|$,0|z,0|b,0|m),O=l,q=0|F(0|L,0|Y,0|(g=0|D(0,0|(M=0|i[g>>2]),32)),0|(x=l)),u=l,v=0|U(0|(j=0|F(0|t,0|C,0|H,0|v)),0|l,0|q,0|u),v=0|U(0|(u=0|B(0|v,0|l,1)),0|l,0|p,0|O),v=0|U(0|(O=0|B(0|v,0|l,1)),0|l,0|E,0|G),G=l,i[(E=s+96|0)>>2]=v,i[E+4>>2]=G,O=0|F(0|L,0|Y,0|(E=0|D(0,0|i[c>>2],32)),0|(c=l)),Y=l,x=0|U(0|(L=0|F(0|$,0|z,0|g,0|x)),0|l,0|O,0|Y),Y=0|B(0|(m=0|U(0|x,0|(Y=l),0|(O=0|F(0|t,0|C,0|b,0|m)),0|l)),0|(O=l),1),x=l,i[(b=s+104|0)>>2]=Y,i[b+4>>2]=x,g=0|F(0|(f=0|D(0,0|(b=0|i[f>>2]),32)),0|(L=l),0|f,0|L),p=l,z=0|U(0|(u=0|F(0|$,0|z,0|E,0|c)),0|l,0|g,0|p),p=0|B(0|(g=0|U(0|z,0|(p=l),0|(M=0|F(0|t,0|C,0|(g=0|D(0,0|M,31)),0|l)),0|l)),0|(M=l),1),z=l,i[(u=s+112|0)>>2]=p,i[u+4>>2]=z,q=0|F(0|(V=0|D(0,0|(u=0|i[V>>2]),32)),0|($=l),0|f,0|L),L=l,q=0|B(0|(c=0|U(0|(f=0|F(0|t,0|C,0|E,0|c)),0|l,0|q,0|L)),0|(L=l),1),f=l,i[(E=s+120|0)>>2]=q,i[E+4>>2]=f,E=0|F(0|V,0|$,0|V,0|$),$=l,V=0|U(0|(b=0|F(0|t,0|C,0|(V=0|D(0,0|b,30)),0|l)),0|l,0|E,0|$),$=l,i[(E=s+128|0)>>2]=V,i[E+4>>2]=$,u=0|F(0|t,0|C,0|(E=0|D(0,0|u,31)),0|l),E=l,i[(b=s+136|0)>>2]=u,i[b+4>>2]=E,h=0|F(0|(b=0|D(0,0|h,31)),0|l,0|t,0|C),C=l,i[(t=s+144|0)>>2]=h,i[t+4>>2]=C,b=0|i[(t=K)>>2],j=0|i[t+4>>2],t=0|F(0|h,0|C,18,0),H=l,_=0|U(0|h,0|C,0|b,0|j),j=0|U(0|_,0|l,0|t,0|H),i[(H=K)>>2]=j,i[H+4>>2]=l,j=0|i[(H=W)>>2],K=0|i[H+4>>2],H=0|F(0|u,0|E,18,0),t=l,_=0|U(0|j,0|K,0|u,0|E),E=0|U(0|_,0|l,0|H,0|t),i[(t=W)>>2]=E,i[t+4>>2]=l,E=0|i[(t=R)>>2],W=0|i[t+4>>2],t=0|F(0|V,0|$,18,0),H=l,_=0|U(0|E,0|W,0|V,0|$),$=0|U(0|_,0|l,0|t,0|H),i[(H=R)>>2]=$,i[H+4>>2]=l,$=0|i[(H=N)>>2],R=0|i[H+4>>2],H=0|F(0|c,0|L,36,0),L=l,c=0|U(0|$,0|R,0|q,0|f),f=0|U(0|c,0|l,0|H,0|L),i[(L=N)>>2]=f,i[L+4>>2]=l,f=0|i[(L=I)>>2],N=0|i[L+4>>2],L=0|F(0|g,0|M,36,0),M=l,g=0|U(0|f,0|N,0|p,0|z),z=0|U(0|g,0|l,0|L,0|M),i[(M=I)>>2]=z,i[M+4>>2]=l,z=0|i[(M=P)>>2],I=0|i[M+4>>2],M=0|F(0|m,0|O,36,0),O=l,m=0|U(0|z,0|I,0|Y,0|x),x=0|U(0|m,0|l,0|M,0|O),i[(O=P)>>2]=x,i[O+4>>2]=l,x=0|i[(O=T)>>2],P=0|i[O+4>>2],O=0|F(0|v,0|G,18,0),M=l,m=0|U(0|x,0|P,0|v,0|G),G=0|U(0|m,0|l,0|O,0|M),i[(M=T)>>2]=G,i[M+4>>2]=l,G=0|i[(M=a)>>2],T=0|i[M+4>>2],M=0|F(0|y,0|w,36,0),w=l,y=0|U(0|G,0|T,0|A,0|S),S=0|U(0|y,0|l,0|M,0|w),i[(w=a)>>2]=S,i[w+4>>2]=l,S=0|i[(w=d)>>2],M=0|i[w+4>>2],y=0|i[(w=s)>>2],A=0|i[w+4>>2],w=0|F(0|S,0|M,18,0),T=l,G=0|U(0|y,0|A,0|S,0|M),M=0|U(0|G,0|l,0|w,0|T),T=l,i[(w=s)>>2]=M,i[w+4>>2]=T,i[(w=d)>>2]=0,i[w+4>>2]=0,w=T,T=M,M=0;do{y=0|k(0|T,0|w,0|(A=0|B(0|(S=0|D(0|(G=0|U(w>>31>>>6|0,0,0|T,0|w)),0|l,26)),0|(G=l),26)),0|l),i[(A=s+(M<<3)|0)>>2]=y,i[A+4>>2]=l,v=0|k(0|(O=0|U(0|S,0|G,0|i[(y=A=s+((1|M)<<3)|0)>>2],0|i[y+4>>2])),0|(y=l),0|(m=0|B(0|(S=0|D(0|(G=0|U(y>>31>>>7|0,0,0|O,0|y)),0|l,25)),0|(G=l),25)),0|l),i[(m=A)>>2]=v,i[m+4>>2]=l,T=0|U(0|S,0|G,0|i[(v=m=s+((M=M+2|0)<<3)|0)>>2],0|i[v+4>>2]),w=l,i[(v=m)>>2]=T,i[v+4>>2]=w}while(M>>>0<10);w=0|i[(M=d)>>2],T=0|i[M+4>>2],v=0|i[(M=s)>>2],m=0|i[M+4>>2],M=0|F(0|w,0|T,18,0),G=l,S=0|U(0|v,0|m,0|w,0|T),T=0|U(0|S,0|l,0|M,0|G),G=l,i[(M=d)>>2]=0,i[M+4>>2]=0,w=0|k(0|T,0|G,0|(S=0|B(0|(d=0|D(0|(M=0|U(G>>31>>>6|0,0,0|T,0|G)),0|l,26)),0|(M=l),26)),0|l),i[(S=s)>>2]=w,i[S+4>>2]=l,w=0|U(0|d,0|M,0|i[(S=a)>>2],0|i[S+4>>2]),i[(S=a)>>2]=w,i[S+4>>2]=l,S=e,e=s,s=S+80|0;do{i[S>>2]=i[e>>2],S=S+4|0,e=e+4|0}while((0|S)<(0|s));o=n}function M(){return 0|(0|i[2]?0|i[60+(0|f())>>2]:56)}function I(e){var t=0;return(e|=0)>>>0>4294963200?(i[(0|M())>>2]=0-e,t=-1):t=e,0|t}function w(e){return 0,0}function R(e){0}function N(e,t,n){t|=0,n|=0;var r,a,s,l,c,u=0,p=0,f=0,_=0,h=0,g=0,m=0,y=0,S=0,E=0,v=0,C=0,b=0,P=0,O=0,M=0;for(r=o,o=o+48|0,a=r+16|0,s=r,u=r+32|0,p=0|i[(l=(e|=0)+28|0)>>2],i[u>>2]=p,f=(0|i[(c=e+20|0)>>2])-p|0,i[u+4>>2]=f,i[u+8>>2]=t,i[u+12>>2]=n,t=e+60|0,p=e+44|0,_=u,u=2,h=f+n|0;;){if(0|i[2]?(T(1,0|e),i[s>>2]=i[t>>2],i[s+4>>2]=_,i[s+8>>2]=u,f=0|I(0|A(146,0|s)),d(0),g=f):(i[a>>2]=i[t>>2],i[a+4>>2]=_,i[a+8>>2]=u,g=0|I(0|A(146,0|a))),(0|h)==(0|g)){m=6;break}if((0|g)<0){y=_,S=u,m=8;break}f=h-g|0,g>>>0<=(E=0|i[_+4>>2])>>>0?2==(0|u)?(i[l>>2]=(0|i[l>>2])+g,v=E,C=g,b=_,P=2):(v=E,C=g,b=_,P=u):(O=0|i[p>>2],i[l>>2]=O,i[c>>2]=O,v=0|i[_+12>>2],C=g-E|0,b=_+8|0,P=u+-1|0),i[b>>2]=(0|i[b>>2])+C,i[b+4>>2]=v-C,_=b,u=P,h=f}return 6==(0|m)?(h=0|i[p>>2],i[e+16>>2]=h+(0|i[e+48>>2]),p=h,i[l>>2]=p,i[c>>2]=p,M=n):8==(0|m)&&(i[e+16>>2]=0,i[l>>2]=0,i[c>>2]=0,i[e>>2]=32|i[e>>2],M=2==(0|S)?0:n-(0|i[y+4>>2])|0),o=r,0|M}function L(e){var t,n,r=0,a=0,o=0,s=0,l=0;return n=(e|=0)+28|0,(0|i[(t=e+20|0)>>2])>>>0>(0|i[n>>2])>>>0&&(Y[3&i[e+36>>2]](e,0,0),0==(0|i[t>>2]))?r=-1:((o=0|i[(a=e+4|0)>>2])>>>0<(l=0|i[(s=e+8|0)>>2])>>>0&&Y[3&i[e+40>>2]](e,o-l|0,1),i[e+16>>2]=0,i[n>>2]=0,i[t>>2]=0,i[s>>2]=0,i[a>>2]=0,r=0),0|r}function D(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(l=t>>n,e>>>n|(t&(1<<n)-1)<<32-n):(l=(0|t)<0?-1:0,t>>n-32|0)}function k(e,t,n,r){return(t|=0)-(r|=0)>>>0,0|(l=t-r-((n|=0)>>>0>(e|=0)>>>0|0)>>>0,e-n>>>0|0)}function U(e,t,n,r){var i;return 0|(l=(t|=0)+(r|=0)+((i=(e|=0)+(n|=0)>>>0)>>>0<e>>>0|0)>>>0,0|i)}function G(e,t,n){t|=0;var a,o=0,s=0,l=0;if(a=(e|=0)+(n|=0)|0,(0|n)>=20){if(s=(t&=255)|t<<8|t<<16|t<<24,l=-4&a,o=3&e)for(o=e+4-o|0;(0|e)<(0|o);)r[e>>0]=t,e=e+1|0;for(;(0|e)<(0|l);)i[e>>2]=s,e=e+4|0}for(;(0|e)<(0|a);)r[e>>0]=t,e=e+1|0;return e-n|0}function x(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(l=t>>>n,e>>>n|(t&(1<<n)-1)<<32-n):(l=0,t>>>n-32|0)}function B(e,t,n){return e|=0,t|=0,(0|(n|=0))<32?(l=t<<n|(e&(1<<n)-1<<32-n)>>>32-n,e<<n):(l=e<<n-32,0)}function F(e,t,n,r){t|=0,r|=0;var i,a;return n=0|function(e,t){var n,r,i,a=0;return e=((r=0|c(a=65535&(t|=0),n=65535&(e|=0)))>>>16)+(0|c(a,i=e>>>16))|0,t=0|c(a=t>>>16,n),0|(l=(e>>>16)+(0|c(a,i))+(((65535&e)+t|0)>>>16)|0,e+t<<16|65535&r|0)}(i=e|=0,e=n|=0),a=l,0|(l=(0|c(t,e))+(0|c(r,i))+a|0&a,0|n)}var j=[function(e){return 0,u(0),0},function(e){var t,n;return e|=0,t=o,o=o+16|0,i[(n=t)>>2]=i[e+60>>2],e=0|I(0|_(6,0|n)),o=t,0|e}],Y=[function(e,t,n){return 0,0,0,u(1),0},function(e,t,n){t|=0,n|=0;var a,s=0;return a=o,o=o+80|0,s=a,i[(e|=0)+36>>2]=3,0==(64&i[e>>2]|0)&&(i[s>>2]=i[e+60>>2],i[s+4>>2]=21505,i[s+8>>2]=a+12,0!=(0|S(54,0|s)))&&(r[e+75>>0]=-1),s=0|N(e,t,n),o=a,0|s},function(e,t,n){e|=0,t|=0,n|=0;var r,a,s,l=0;return r=o,o=o+32|0,s=r+20|0,i[(a=r)>>2]=i[e+60>>2],i[a+4>>2]=0,i[a+8>>2]=t,i[a+12>>2]=s,i[a+16>>2]=n,(0|I(0|v(140,0|a)))<0?(i[s>>2]=-1,l=-1):l=0|i[s>>2],o=r,0|l},N],K=[function(e){u(2)},function(e){0|i[(e|=0)+68>>2]||R()}];return{_curve25519_donna:function(e,t,n){e|=0,n|=0;var s,u,d,p,f,_,h,g,m,y,S,E,v,T,C,A,M,I,w,R,N,L,j,Y,K,W,H,V,$,z,q,J,Q,X,Z,ee,te,ne,re,ie,ae,oe,se,le,ce,ue,de,pe,fe,_e,he,ge,me,ye,Se,Ee,ve,Te,Ce,Ae=0,be=0,Pe=0,Oe=0,Me=0,Ie=0,we=0,Re=0,Ne=0,Le=0,De=0,ke=0,Ue=0,Ge=0,xe=0,Be=0,Fe=0,je=0,Ye=0,Ke=0,We=0,He=0,Ve=0,$e=0,ze=0,qe=0,Je=0,Qe=0,Xe=0,Ze=0,et=0,tt=0,nt=0,rt=0,it=0,at=0,ot=0,st=0,lt=0,ct=0,ut=0,dt=0,pt=0,ft=0,_t=0,ht=0,gt=0,mt=0,yt=0,St=0,Et=0,vt=0,Tt=0,Ct=0,At=0,bt=0,Pt=0,Ot=0,Mt=0,It=0,wt=0,Rt=0,Nt=0,Lt=0,Dt=0,kt=0,Ut=0,Gt=0,xt=0,Bt=0,Ft=0,jt=0,Yt=0,Kt=0,Wt=0,Ht=0,Vt=0,$t=0,zt=0,qt=0,Jt=0,Qt=0,Xt=0,Zt=0,en=0,tn=0,nn=0,rn=0,an=0,on=0,sn=0,ln=0,cn=0,un=0,dn=0,pn=0,fn=0,_n=0,hn=0,gn=0,mn=0,yn=0,Sn=0,En=0,vn=0,Tn=0,Cn=0,An=0,bn=0,Pn=0,On=0,Mn=0,In=0,wn=0,Rn=0,Nn=0,Ln=0,Dn=0;s=o,o=o+2640|0,Ae=s+2456|0,be=s+2304|0,Pe=s+2152|0,Oe=s+2e3|0,Me=s+1848|0,Ie=s+1696|0,we=s+1544|0,Re=s+1392|0,Ne=s+1240|0,Le=s+1088|0,De=s+936|0,ke=s+784|0,Ue=s+632|0,Ge=s+480|0,xe=s+328|0,u=s+248|0,Be=s+168|0,Fe=s+80|0,je=s,Ke=t|=0,t=(Ye=d=s+2608|0)+32|0;do{r[Ye>>0]=0|r[Ke>>0],Ye=Ye+1|0,Ke=Ke+1|0}while((0|Ye)<(0|t));r[d>>0]=248&(0|a[d>>0]),r[(We=d+31|0)>>0]=63&(0|a[We>>0])|64,We=0|a[n>>0],He=0|B(0|a[n+1>>0],0,8),Ve=l,$e=0|B(0|a[n+2>>0],0,16),ze=Ve|l,qe=0|B(0|(Ve=0|a[n+3>>0]),0,24),i[(Je=u)>>2]=He|We|$e|50331648&qe,i[Je+4>>2]=ze,ze=0|B(0|a[n+4>>0],0,8),Je=l,qe=0|B(0|a[n+5>>0],0,16),$e=Je|l,He=0|x(ze|Ve|qe|(We=0|B(0|(Je=0|a[n+6>>0]),0,24))|0,$e|l|0,2),i[($e=u+8|0)>>2]=33554431&He,i[$e+4>>2]=0,$e=0|B(0|a[n+7>>0],0,8),He=l,We=0|B(0|a[n+8>>0],0,16),qe=He|l,ze=0|x($e|Je|We|(Ve=0|B(0|(He=0|a[n+9>>0]),0,24))|0,qe|l|0,3),i[(qe=u+16|0)>>2]=67108863&ze,i[qe+4>>2]=0,qe=0|B(0|a[n+10>>0],0,8),ze=l,Ve=0|B(0|a[n+11>>0],0,16),We=ze|l,$e=0|x(qe|He|Ve|(Je=0|B(0|(ze=0|a[n+12>>0]),0,24))|0,We|l|0,5),i[(We=u+24|0)>>2]=33554431&$e,i[We+4>>2]=0,We=0|B(0|a[n+13>>0],0,8),$e=l,Je=0|B(0|a[n+14>>0],0,16),Ve=$e|l,He=0|x(We|ze|Je|($e=0|B(0|a[n+15>>0],0,24))|0,Ve|l|0,6),i[(Ve=u+32|0)>>2]=67108863&He,i[Ve+4>>2]=0,Ve=0|a[n+16>>0],He=0|B(0|a[n+17>>0],0,8),$e=l,Je=0|B(0|a[n+18>>0],0,16),ze=$e|l,We=0|B(0|($e=0|a[n+19>>0]),0,24),i[(qe=u+40|0)>>2]=He|Ve|Je|16777216&We,i[qe+4>>2]=ze,ze=0|B(0|a[n+20>>0],0,8),qe=l,We=0|B(0|a[n+21>>0],0,16),Je=qe|l,He=0|x(ze|$e|We|(Ve=0|B(0|(qe=0|a[n+22>>0]),0,24))|0,Je|l|0,1),i[(Je=u+48|0)>>2]=67108863&He,i[Je+4>>2]=0,Je=0|B(0|a[n+23>>0],0,8),He=l,Ve=0|B(0|a[n+24>>0],0,16),We=He|l,ze=0|x(Je|qe|Ve|($e=0|B(0|(He=0|a[n+25>>0]),0,24))|0,We|l|0,3),i[(We=u+56|0)>>2]=33554431&ze,i[We+4>>2]=0,We=0|B(0|a[n+26>>0],0,8),ze=l,$e=0|B(0|a[n+27>>0],0,16),Ve=ze|l,Je=0|x(We|He|$e|(qe=0|B(0|(ze=0|a[n+28>>0]),0,24))|0,Ve|l|0,4),i[(Ve=u+64|0)>>2]=67108863&Je,i[Ve+4>>2]=0,Ve=0|B(0|a[n+29>>0],0,8),Je=l,qe=0|B(0|a[n+30>>0],0,16),$e=Je|l,n=0|x(Ve|ze|qe|(Je=0|B(0|a[n+31>>0],0,24))|0,$e|l|0,6),i[($e=u+72|0)>>2]=33554431&n,i[$e+4>>2]=0,G(0|Ne,0,152),i[($e=Ne)>>2]=1,i[$e+4>>2]=0,G(0|Le,0,152),i[($e=Le)>>2]=1,i[$e+4>>2]=0,G(0|De,0,152),G(0|ke,0,152),G(0|Ue,0,152),i[($e=Ue)>>2]=1,i[$e+4>>2]=0,G(0|Ge,0,152),G(0|xe,0,152),i[($e=xe)>>2]=1,i[$e+4>>2]=0,t=(Ye=Re+80|0)+72|0;do{i[Ye>>2]=0,Ye=Ye+4|0}while((0|Ye)<(0|t));Ke=u,t=(Ye=Re)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));for($e=Oe+144|0,n=Oe+64|0,Je=Oe+136|0,qe=Oe+56|0,ze=Oe+128|0,Ve=Oe+48|0,He=Oe+120|0,We=Oe+40|0,p=Oe+112|0,f=Oe+32|0,_=Oe+104|0,h=Oe+24|0,g=Oe+96|0,m=Oe+16|0,y=Oe+88|0,S=Oe+8|0,E=Oe+80|0,v=Me+144|0,T=Me+64|0,C=Me+136|0,A=Me+56|0,M=Me+128|0,I=Me+48|0,w=Me+120|0,R=Me+40|0,N=Me+112|0,L=Me+32|0,j=Me+104|0,Y=Me+24|0,K=Me+96|0,W=Me+16|0,H=Me+88|0,V=Me+8|0,$=Me+80|0,z=Oe+72|0,q=Me+72|0,J=be+8|0,Q=Pe+8|0,X=be+16|0,Z=Pe+16|0,ee=be+24|0,te=Pe+24|0,ne=be+32|0,re=Pe+32|0,ie=be+40|0,ae=Pe+40|0,oe=be+48|0,se=Pe+48|0,le=be+56|0,ce=Pe+56|0,ue=be+64|0,de=Pe+64|0,pe=be+72|0,fe=Pe+72|0,_e=Ae+80|0,he=Ae+8|0,ge=Ae+16|0,me=Ae+24|0,ye=Ae+32|0,Se=Ae+40|0,Ee=Ae+48|0,ve=Ae+56|0,Te=Ae+64|0,Ce=Ae+72|0,Qe=0,Xe=Re,Ze=ke,ke=Ne,et=Ue,Ue=Le,tt=Ge,Ge=De,De=xe;;){for(xe=0|r[d+(31-Qe)>>0],nt=0,rt=Xe,it=Ze,at=ke,ot=et,st=Ue,lt=tt,ct=Ge,ut=De;;){pt=0|k(0,0,(dt=255&xe)>>>7|0,0),ft=l,_t=0;do{mt=0|i[(gt=ht=st+(_t<<3)|0)>>2],yt=0|i[gt+4>>2],Et=0|i[(St=gt=rt+(_t<<3)|0)>>2],Tt=((vt=0|i[St+4>>2])^yt)&ft,yt=0|D(0,(St=(Et^mt)&pt)^mt|0,32),i[(mt=ht)>>2]=yt,i[mt+4>>2]=l,mt=0|D(0,St^Et|0,32),i[(Et=gt)>>2]=mt,i[Et+4>>2]=l,_t=_t+1|0}while(10!=(0|_t));Ct=0;do{mt=0|i[(Et=_t=ct+(Ct<<3)|0)>>2],gt=0|i[Et+4>>2],yt=0|i[(St=Et=at+(Ct<<3)|0)>>2],vt=((ht=0|i[St+4>>2])^gt)&ft,gt=0|D(0,(St=(yt^mt)&pt)^mt|0,32),i[(mt=_t)>>2]=gt,i[mt+4>>2]=l,mt=0|D(0,St^yt|0,32),i[(yt=Et)>>2]=mt,i[yt+4>>2]=l,Ct=Ct+1|0}while(10!=(0|Ct));mt=0|i[(yt=st)>>2],Et=0|i[yt+4>>2],gt=0|i[(St=yt=st+8|0)>>2],_t=0|i[St+4>>2],vt=0|i[(ht=St=st+16|0)>>2],Tt=0|i[ht+4>>2],bt=0|i[(At=ht=st+24|0)>>2],Pt=0|i[At+4>>2],Mt=0|i[(Ot=At=st+32|0)>>2],It=0|i[Ot+4>>2],Rt=0|i[(wt=Ot=st+40|0)>>2],Nt=0|i[wt+4>>2],Dt=0|i[(Lt=wt=st+48|0)>>2],kt=0|i[Lt+4>>2],Gt=0|i[(Ut=Lt=st+56|0)>>2],xt=0|i[Ut+4>>2],Ft=0|i[(Bt=Ut=st+64|0)>>2],jt=0|i[Bt+4>>2],Kt=0|i[(Yt=Bt=st+72|0)>>2],Wt=0|i[Yt+4>>2],Yt=0|U(0|(Ht=0|i[(Yt=ct)>>2]),0|(Vt=0|i[Yt+4>>2]),0|mt,0|Et),i[($t=st)>>2]=Yt,i[$t+4>>2]=l,Yt=0|U(0|(zt=0|i[(Yt=$t=ct+8|0)>>2]),0|(qt=0|i[Yt+4>>2]),0|gt,0|_t),i[(Jt=yt)>>2]=Yt,i[Jt+4>>2]=l,Yt=0|U(0|(yt=0|i[(Yt=Jt=ct+16|0)>>2]),0|(Qt=0|i[Yt+4>>2]),0|vt,0|Tt),i[(Xt=St)>>2]=Yt,i[Xt+4>>2]=l,Yt=0|U(0|(St=0|i[(Yt=Xt=ct+24|0)>>2]),0|(Zt=0|i[Yt+4>>2]),0|bt,0|Pt),i[(en=ht)>>2]=Yt,i[en+4>>2]=l,Yt=0|U(0|(ht=0|i[(Yt=en=ct+32|0)>>2]),0|(tn=0|i[Yt+4>>2]),0|Mt,0|It),i[(nn=At)>>2]=Yt,i[nn+4>>2]=l,Yt=0|U(0|(At=0|i[(Yt=nn=ct+40|0)>>2]),0|(rn=0|i[Yt+4>>2]),0|Rt,0|Nt),i[(an=Ot)>>2]=Yt,i[an+4>>2]=l,Yt=0|U(0|(Ot=0|i[(Yt=an=ct+48|0)>>2]),0|(on=0|i[Yt+4>>2]),0|Dt,0|kt),i[(sn=wt)>>2]=Yt,i[sn+4>>2]=l,Yt=0|U(0|(wt=0|i[(Yt=sn=ct+56|0)>>2]),0|(ln=0|i[Yt+4>>2]),0|Gt,0|xt),i[(cn=Lt)>>2]=Yt,i[cn+4>>2]=l,Yt=0|U(0|(Lt=0|i[(Yt=cn=ct+64|0)>>2]),0|(un=0|i[Yt+4>>2]),0|Ft,0|jt),i[(dn=Ut)>>2]=Yt,i[dn+4>>2]=l,Yt=0|U(0|(Ut=0|i[(Yt=dn=ct+72|0)>>2]),0|(pn=0|i[Yt+4>>2]),0|Kt,0|Wt),i[(fn=Bt)>>2]=Yt,i[fn+4>>2]=l,fn=0|k(0|mt,0|Et,0|Ht,0|Vt),i[(Vt=ct)>>2]=fn,i[Vt+4>>2]=l,Vt=0|k(0|gt,0|_t,0|zt,0|qt),i[(qt=$t)>>2]=Vt,i[qt+4>>2]=l,qt=0|k(0|vt,0|Tt,0|yt,0|Qt),i[(Qt=Jt)>>2]=qt,i[Qt+4>>2]=l,Qt=0|k(0|bt,0|Pt,0|St,0|Zt),i[(Zt=Xt)>>2]=Qt,i[Zt+4>>2]=l,Zt=0|k(0|Mt,0|It,0|ht,0|tn),i[(tn=en)>>2]=Zt,i[tn+4>>2]=l,tn=0|k(0|Rt,0|Nt,0|At,0|rn),i[(rn=nn)>>2]=tn,i[rn+4>>2]=l,rn=0|k(0|Dt,0|kt,0|Ot,0|on),i[(on=an)>>2]=rn,i[on+4>>2]=l,on=0|k(0|Gt,0|xt,0|wt,0|ln),i[(ln=sn)>>2]=on,i[ln+4>>2]=l,ln=0|k(0|Ft,0|jt,0|Lt,0|un),i[(un=cn)>>2]=ln,i[un+4>>2]=l,un=0|k(0|Kt,0|Wt,0|Ut,0|pn),i[(pn=dn)>>2]=un,i[pn+4>>2]=l,un=0|i[(pn=rt)>>2],dn=0|i[pn+4>>2],Wt=0|i[(Ut=pn=rt+8|0)>>2],Kt=0|i[Ut+4>>2],cn=0|i[(ln=Ut=rt+16|0)>>2],Lt=0|i[ln+4>>2],Ft=0|i[(jt=ln=rt+24|0)>>2],on=0|i[jt+4>>2],wt=0|i[(sn=jt=rt+32|0)>>2],xt=0|i[sn+4>>2],rn=0|i[(Gt=sn=rt+40|0)>>2],an=0|i[Gt+4>>2],kt=0|i[(Ot=Gt=rt+48|0)>>2],Dt=0|i[Ot+4>>2],nn=0|i[(tn=Ot=rt+56|0)>>2],At=0|i[tn+4>>2],Rt=0|i[(Nt=tn=rt+64|0)>>2],Zt=0|i[Nt+4>>2],ht=0|i[(en=Nt=rt+72|0)>>2],It=0|i[en+4>>2],en=0|U(0|(Mt=0|i[(en=at)>>2]),0|(Qt=0|i[en+4>>2]),0|un,0|dn),i[(Xt=rt)>>2]=en,i[Xt+4>>2]=l,en=0|U(0|(St=0|i[(en=Xt=at+8|0)>>2]),0|(Pt=0|i[en+4>>2]),0|Wt,0|Kt),i[(bt=pn)>>2]=en,i[bt+4>>2]=l,en=0|U(0|(pn=0|i[(en=bt=at+16|0)>>2]),0|(qt=0|i[en+4>>2]),0|cn,0|Lt),i[(Jt=Ut)>>2]=en,i[Jt+4>>2]=l,en=0|U(0|(Ut=0|i[(en=Jt=at+24|0)>>2]),0|(yt=0|i[en+4>>2]),0|Ft,0|on),i[(Tt=ln)>>2]=en,i[Tt+4>>2]=l,en=0|U(0|(ln=0|i[(en=Tt=at+32|0)>>2]),0|(vt=0|i[en+4>>2]),0|wt,0|xt),i[(Vt=jt)>>2]=en,i[Vt+4>>2]=l,en=0|U(0|(jt=0|i[(en=Vt=at+40|0)>>2]),0|($t=0|i[en+4>>2]),0|rn,0|an),i[(zt=sn)>>2]=en,i[zt+4>>2]=l,en=0|U(0|(sn=0|i[(en=zt=at+48|0)>>2]),0|(_t=0|i[en+4>>2]),0|kt,0|Dt),i[(gt=Gt)>>2]=en,i[gt+4>>2]=l,en=0|U(0|(Gt=0|i[(en=gt=at+56|0)>>2]),0|(fn=0|i[en+4>>2]),0|nn,0|At),i[(Ht=Ot)>>2]=en,i[Ht+4>>2]=l,en=0|U(0|(Ot=0|i[(en=Ht=at+64|0)>>2]),0|(Et=0|i[en+4>>2]),0|Rt,0|Zt),i[(mt=tn)>>2]=en,i[mt+4>>2]=l,en=0|U(0|(tn=0|i[(en=mt=at+72|0)>>2]),0|(Yt=0|i[en+4>>2]),0|ht,0|It),i[(Bt=Nt)>>2]=en,i[Bt+4>>2]=l,Bt=0|k(0|un,0|dn,0|Mt,0|Qt),i[(Qt=at)>>2]=Bt,i[Qt+4>>2]=l,Qt=0|k(0|Wt,0|Kt,0|St,0|Pt),i[(Pt=Xt)>>2]=Qt,i[Pt+4>>2]=l,Pt=0|k(0|cn,0|Lt,0|pn,0|qt),i[(qt=bt)>>2]=Pt,i[qt+4>>2]=l,qt=0|k(0|Ft,0|on,0|Ut,0|yt),i[(yt=Jt)>>2]=qt,i[yt+4>>2]=l,yt=0|k(0|wt,0|xt,0|ln,0|vt),i[(vt=Tt)>>2]=yt,i[vt+4>>2]=l,vt=0|k(0|rn,0|an,0|jt,0|$t),i[($t=Vt)>>2]=vt,i[$t+4>>2]=l,$t=0|k(0|kt,0|Dt,0|sn,0|_t),i[(_t=zt)>>2]=$t,i[_t+4>>2]=l,_t=0|k(0|nn,0|At,0|Gt,0|fn),i[(fn=gt)>>2]=_t,i[fn+4>>2]=l,fn=0|k(0|Rt,0|Zt,0|Ot,0|Et),i[(Et=Ht)>>2]=fn,i[Et+4>>2]=l,Et=0|k(0|ht,0|It,0|tn,0|Yt),i[(Yt=mt)>>2]=Et,i[Yt+4>>2]=l,P(Oe,rt,ct),P(Me,st,at),Et=0|i[(Yt=$e)>>2],mt=0|i[Yt+4>>2],tn=0|i[(Yt=n)>>2],It=0|i[Yt+4>>2],Yt=0|F(0|Et,0|mt,18,0),ht=l,fn=0|U(0|tn,0|It,0|Et,0|mt),mt=0|U(0|fn,0|l,0|Yt,0|ht),i[(ht=n)>>2]=mt,i[ht+4>>2]=l,mt=0|i[(ht=Je)>>2],Yt=0|i[ht+4>>2],fn=0|i[(ht=qe)>>2],Et=0|i[ht+4>>2],ht=0|F(0|mt,0|Yt,18,0),It=l,tn=0|U(0|fn,0|Et,0|mt,0|Yt),Yt=0|U(0|tn,0|l,0|ht,0|It),i[(It=qe)>>2]=Yt,i[It+4>>2]=l,Yt=0|i[(It=ze)>>2],ht=0|i[It+4>>2],tn=0|i[(It=Ve)>>2],mt=0|i[It+4>>2],It=0|F(0|Yt,0|ht,18,0),Et=l,fn=0|U(0|tn,0|mt,0|Yt,0|ht),ht=0|U(0|fn,0|l,0|It,0|Et),i[(Et=Ve)>>2]=ht,i[Et+4>>2]=l,ht=0|i[(Et=He)>>2],It=0|i[Et+4>>2],fn=0|i[(Et=We)>>2],Yt=0|i[Et+4>>2],Et=0|F(0|ht,0|It,18,0),mt=l,tn=0|U(0|fn,0|Yt,0|ht,0|It),It=0|U(0|tn,0|l,0|Et,0|mt),i[(mt=We)>>2]=It,i[mt+4>>2]=l,It=0|i[(mt=p)>>2],Et=0|i[mt+4>>2],tn=0|i[(mt=f)>>2],ht=0|i[mt+4>>2],mt=0|F(0|It,0|Et,18,0),Yt=l,fn=0|U(0|tn,0|ht,0|It,0|Et),Et=0|U(0|fn,0|l,0|mt,0|Yt),i[(Yt=f)>>2]=Et,i[Yt+4>>2]=l,Et=0|i[(Yt=_)>>2],mt=0|i[Yt+4>>2],fn=0|i[(Yt=h)>>2],It=0|i[Yt+4>>2],Yt=0|F(0|Et,0|mt,18,0),ht=l,tn=0|U(0|fn,0|It,0|Et,0|mt),mt=0|U(0|tn,0|l,0|Yt,0|ht),i[(ht=h)>>2]=mt,i[ht+4>>2]=l,mt=0|i[(ht=g)>>2],Yt=0|i[ht+4>>2],tn=0|i[(ht=m)>>2],Et=0|i[ht+4>>2],ht=0|F(0|mt,0|Yt,18,0),It=l,fn=0|U(0|tn,0|Et,0|mt,0|Yt),Yt=0|U(0|fn,0|l,0|ht,0|It),i[(It=m)>>2]=Yt,i[It+4>>2]=l,Yt=0|i[(It=y)>>2],ht=0|i[It+4>>2],fn=0|i[(It=S)>>2],mt=0|i[It+4>>2],It=0|F(0|Yt,0|ht,18,0),Et=l,tn=0|U(0|fn,0|mt,0|Yt,0|ht),ht=0|U(0|tn,0|l,0|It,0|Et),i[(Et=S)>>2]=ht,i[Et+4>>2]=l,ht=0|i[(Et=E)>>2],It=0|i[Et+4>>2],tn=0|i[(Et=Oe)>>2],Yt=0|i[Et+4>>2],Et=0|F(0|ht,0|It,18,0),mt=l,fn=0|U(0|tn,0|Yt,0|ht,0|It),It=0|U(0|fn,0|l,0|Et,0|mt),mt=l,i[(Et=Oe)>>2]=It,i[Et+4>>2]=mt,i[(Et=E)>>2]=0,i[Et+4>>2]=0,Et=mt,mt=It,It=0;do{tn=0|k(0|mt,0|Et,0|(Yt=0|B(0|(ht=0|D(0|(fn=0|U(Et>>31>>>6|0,0,0|mt,0|Et)),0|l,26)),0|(fn=l),26)),0|l),i[(Yt=Oe+(It<<3)|0)>>2]=tn,i[Yt+4>>2]=l,Zt=0|k(0|(Ht=0|U(0|ht,0|fn,0|i[(tn=Yt=Oe+((1|It)<<3)|0)>>2],0|i[tn+4>>2])),0|(tn=l),0|(Ot=0|B(0|(ht=0|D(0|(fn=0|U(tn>>31>>>7|0,0,0|Ht,0|tn)),0|l,25)),0|(fn=l),25)),0|l),i[(Ot=Yt)>>2]=Zt,i[Ot+4>>2]=l,mt=0|U(0|ht,0|fn,0|i[(Zt=Ot=Oe+((It=It+2|0)<<3)|0)>>2],0|i[Zt+4>>2]),Et=l,i[(Zt=Ot)>>2]=mt,i[Zt+4>>2]=Et}while(It>>>0<10);Et=0|i[(It=E)>>2],mt=0|i[It+4>>2],Zt=0|i[(It=Oe)>>2],Ot=0|i[It+4>>2],It=0|F(0|Et,0|mt,18,0),fn=l,ht=0|U(0|Zt,0|Ot,0|Et,0|mt),mt=0|U(0|ht,0|l,0|It,0|fn),fn=l,i[(It=E)>>2]=0,i[It+4>>2]=0,Ot=0|k(0|mt,0|fn,0|(Et=0|B(0|(ht=0|D(0|(It=0|U(fn>>31>>>6|0,0,0|mt,0|fn)),0|l,26)),0|(It=l),26)),0|l),Et=l,i[(fn=Oe)>>2]=Ot,i[fn+4>>2]=Et,mt=0|U(0|ht,0|It,0|i[(fn=S)>>2],0|i[fn+4>>2]),fn=l,i[(It=S)>>2]=mt,i[It+4>>2]=fn,ht=0|i[(It=v)>>2],Zt=0|i[It+4>>2],Yt=0|i[(It=T)>>2],tn=0|i[It+4>>2],It=0|F(0|ht,0|Zt,18,0),Ht=l,Rt=0|U(0|Yt,0|tn,0|ht,0|Zt),Zt=0|U(0|Rt,0|l,0|It,0|Ht),i[(Ht=T)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=C)>>2],It=0|i[Ht+4>>2],Rt=0|i[(Ht=A)>>2],ht=0|i[Ht+4>>2],Ht=0|F(0|Zt,0|It,18,0),tn=l,Yt=0|U(0|Rt,0|ht,0|Zt,0|It),It=0|U(0|Yt,0|l,0|Ht,0|tn),i[(tn=A)>>2]=It,i[tn+4>>2]=l,It=0|i[(tn=M)>>2],Ht=0|i[tn+4>>2],Yt=0|i[(tn=I)>>2],Zt=0|i[tn+4>>2],tn=0|F(0|It,0|Ht,18,0),ht=l,Rt=0|U(0|Yt,0|Zt,0|It,0|Ht),Ht=0|U(0|Rt,0|l,0|tn,0|ht),i[(ht=I)>>2]=Ht,i[ht+4>>2]=l,Ht=0|i[(ht=w)>>2],tn=0|i[ht+4>>2],Rt=0|i[(ht=R)>>2],It=0|i[ht+4>>2],ht=0|F(0|Ht,0|tn,18,0),Zt=l,Yt=0|U(0|Rt,0|It,0|Ht,0|tn),tn=0|U(0|Yt,0|l,0|ht,0|Zt),i[(Zt=R)>>2]=tn,i[Zt+4>>2]=l,tn=0|i[(Zt=N)>>2],ht=0|i[Zt+4>>2],Yt=0|i[(Zt=L)>>2],Ht=0|i[Zt+4>>2],Zt=0|F(0|tn,0|ht,18,0),It=l,Rt=0|U(0|Yt,0|Ht,0|tn,0|ht),ht=0|U(0|Rt,0|l,0|Zt,0|It),i[(It=L)>>2]=ht,i[It+4>>2]=l,ht=0|i[(It=j)>>2],Zt=0|i[It+4>>2],Rt=0|i[(It=Y)>>2],tn=0|i[It+4>>2],It=0|F(0|ht,0|Zt,18,0),Ht=l,Yt=0|U(0|Rt,0|tn,0|ht,0|Zt),Zt=0|U(0|Yt,0|l,0|It,0|Ht),i[(Ht=Y)>>2]=Zt,i[Ht+4>>2]=l,Zt=0|i[(Ht=K)>>2],It=0|i[Ht+4>>2],Yt=0|i[(Ht=W)>>2],ht=0|i[Ht+4>>2],Ht=0|F(0|Zt,0|It,18,0),tn=l,Rt=0|U(0|Yt,0|ht,0|Zt,0|It),It=0|U(0|Rt,0|l,0|Ht,0|tn),i[(tn=W)>>2]=It,i[tn+4>>2]=l,It=0|i[(tn=H)>>2],Ht=0|i[tn+4>>2],Rt=0|i[(tn=V)>>2],Zt=0|i[tn+4>>2],tn=0|F(0|It,0|Ht,18,0),ht=l,Yt=0|U(0|Rt,0|Zt,0|It,0|Ht),Ht=0|U(0|Yt,0|l,0|tn,0|ht),i[(ht=V)>>2]=Ht,i[ht+4>>2]=l,Ht=0|i[(ht=$)>>2],tn=0|i[ht+4>>2],Yt=0|i[(ht=Me)>>2],It=0|i[ht+4>>2],ht=0|F(0|Ht,0|tn,18,0),Zt=l,Rt=0|U(0|Yt,0|It,0|Ht,0|tn),tn=0|U(0|Rt,0|l,0|ht,0|Zt),Zt=l,i[(ht=Me)>>2]=tn,i[ht+4>>2]=Zt,i[(ht=$)>>2]=0,i[ht+4>>2]=0,ht=Zt,Zt=tn,tn=0;do{Yt=0|k(0|Zt,0|ht,0|(It=0|B(0|(Ht=0|D(0|(Rt=0|U(ht>>31>>>6|0,0,0|Zt,0|ht)),0|l,26)),0|(Rt=l),26)),0|l),i[(It=Me+(tn<<3)|0)>>2]=Yt,i[It+4>>2]=l,Gt=0|k(0|(_t=0|U(0|Ht,0|Rt,0|i[(Yt=It=Me+((1|tn)<<3)|0)>>2],0|i[Yt+4>>2])),0|(Yt=l),0|(gt=0|B(0|(Ht=0|D(0|(Rt=0|U(Yt>>31>>>7|0,0,0|_t,0|Yt)),0|l,25)),0|(Rt=l),25)),0|l),i[(gt=It)>>2]=Gt,i[gt+4>>2]=l,Zt=0|U(0|Ht,0|Rt,0|i[(Gt=gt=Me+((tn=tn+2|0)<<3)|0)>>2],0|i[Gt+4>>2]),ht=l,i[(Gt=gt)>>2]=Zt,i[Gt+4>>2]=ht}while(tn>>>0<10);ht=0|i[(tn=$)>>2],Zt=0|i[tn+4>>2],Gt=0|i[(tn=Me)>>2],gt=0|i[tn+4>>2],tn=0|F(0|ht,0|Zt,18,0),Rt=l,Ht=0|U(0|Gt,0|gt,0|ht,0|Zt),Zt=0|U(0|Ht,0|l,0|tn,0|Rt),Rt=l,i[(tn=$)>>2]=0,i[tn+4>>2]=0,gt=0|k(0|Zt,0|Rt,0|(ht=0|B(0|(Ht=0|D(0|(tn=0|U(Rt>>31>>>6|0,0,0|Zt,0|Rt)),0|l,26)),0|(tn=l),26)),0|l),ht=l,Zt=0|U(0|Ht,0|tn,0|i[(Rt=V)>>2],0|i[Rt+4>>2]),Rt=l,Ht=0|i[(tn=m)>>2],Gt=0|i[tn+4>>2],It=0|i[(tn=h)>>2],Yt=0|i[tn+4>>2],_t=0|i[(tn=f)>>2],At=0|i[tn+4>>2],nn=0|i[(tn=We)>>2],$t=0|i[tn+4>>2],zt=0|i[(tn=Ve)>>2],sn=0|i[tn+4>>2],Dt=0|i[(tn=qe)>>2],kt=0|i[tn+4>>2],vt=0|i[(tn=n)>>2],Vt=0|i[tn+4>>2],jt=0|i[(tn=z)>>2],an=0|i[tn+4>>2],tn=0|U(0|gt,0|ht,0|Ot,0|Et),i[(rn=Oe)>>2]=tn,i[rn+4>>2]=l,rn=0|U(0|Zt,0|Rt,0|mt,0|fn),i[(tn=S)>>2]=rn,i[tn+4>>2]=l,tn=0|U(0|(rn=0|i[(tn=W)>>2]),0|(yt=0|i[tn+4>>2]),0|Ht,0|Gt),i[(Tt=m)>>2]=tn,i[Tt+4>>2]=l,Tt=0|U(0|(tn=0|i[(Tt=Y)>>2]),0|(ln=0|i[Tt+4>>2]),0|It,0|Yt),i[(xt=h)>>2]=Tt,i[xt+4>>2]=l,xt=0|U(0|(Tt=0|i[(xt=L)>>2]),0|(wt=0|i[xt+4>>2]),0|_t,0|At),i[(qt=f)>>2]=xt,i[qt+4>>2]=l,qt=0|U(0|(xt=0|i[(qt=R)>>2]),0|(Jt=0|i[qt+4>>2]),0|nn,0|$t),i[(Ut=We)>>2]=qt,i[Ut+4>>2]=l,Ut=0|U(0|(qt=0|i[(Ut=I)>>2]),0|(on=0|i[Ut+4>>2]),0|zt,0|sn),i[(Ft=Ve)>>2]=Ut,i[Ft+4>>2]=l,Ft=0|U(0|(Ut=0|i[(Ft=A)>>2]),0|(Pt=0|i[Ft+4>>2]),0|Dt,0|kt),i[(bt=qe)>>2]=Ft,i[bt+4>>2]=l,bt=0|U(0|(Ft=0|i[(bt=T)>>2]),0|(pn=0|i[bt+4>>2]),0|vt,0|Vt),i[(Lt=n)>>2]=bt,i[Lt+4>>2]=l,Lt=0|U(0|(bt=0|i[(Lt=q)>>2]),0|(cn=0|i[Lt+4>>2]),0|jt,0|an),i[(Qt=z)>>2]=Lt,i[Qt+4>>2]=l,Qt=0|k(0|Ot,0|Et,0|gt,0|ht),i[(ht=Me)>>2]=Qt,i[ht+4>>2]=l,ht=0|k(0|mt,0|fn,0|Zt,0|Rt),i[(Rt=V)>>2]=ht,i[Rt+4>>2]=l,Rt=0|k(0|Ht,0|Gt,0|rn,0|yt),i[(yt=W)>>2]=Rt,i[yt+4>>2]=l,yt=0|k(0|It,0|Yt,0|tn,0|ln),i[(ln=Y)>>2]=yt,i[ln+4>>2]=l,ln=0|k(0|_t,0|At,0|Tt,0|wt),i[(wt=L)>>2]=ln,i[wt+4>>2]=l,wt=0|k(0|nn,0|$t,0|xt,0|Jt),i[(Jt=R)>>2]=wt,i[Jt+4>>2]=l,Jt=0|k(0|zt,0|sn,0|qt,0|on),i[(on=I)>>2]=Jt,i[on+4>>2]=l,on=0|k(0|Dt,0|kt,0|Ut,0|Pt),i[(Pt=A)>>2]=on,i[Pt+4>>2]=l,Pt=0|k(0|vt,0|Vt,0|Ft,0|pn),i[(pn=T)>>2]=Pt,i[pn+4>>2]=l,pn=0|k(0|jt,0|an,0|bt,0|cn),i[(cn=q)>>2]=pn,i[cn+4>>2]=l,O(we,Oe),O(Ie,Me),P(Me,Ie,u),pn=0|i[(cn=v)>>2],bt=0|i[cn+4>>2],an=0|i[(cn=T)>>2],jt=0|i[cn+4>>2],cn=0|F(0|pn,0|bt,18,0),Pt=l,Ft=0|U(0|an,0|jt,0|pn,0|bt),bt=0|U(0|Ft,0|l,0|cn,0|Pt),i[(Pt=T)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=C)>>2],cn=0|i[Pt+4>>2],Ft=0|i[(Pt=A)>>2],pn=0|i[Pt+4>>2],Pt=0|F(0|bt,0|cn,18,0),jt=l,an=0|U(0|Ft,0|pn,0|bt,0|cn),cn=0|U(0|an,0|l,0|Pt,0|jt),i[(jt=A)>>2]=cn,i[jt+4>>2]=l,cn=0|i[(jt=M)>>2],Pt=0|i[jt+4>>2],an=0|i[(jt=I)>>2],bt=0|i[jt+4>>2],jt=0|F(0|cn,0|Pt,18,0),pn=l,Ft=0|U(0|an,0|bt,0|cn,0|Pt),Pt=0|U(0|Ft,0|l,0|jt,0|pn),i[(pn=I)>>2]=Pt,i[pn+4>>2]=l,Pt=0|i[(pn=w)>>2],jt=0|i[pn+4>>2],Ft=0|i[(pn=R)>>2],cn=0|i[pn+4>>2],pn=0|F(0|Pt,0|jt,18,0),bt=l,an=0|U(0|Ft,0|cn,0|Pt,0|jt),jt=0|U(0|an,0|l,0|pn,0|bt),i[(bt=R)>>2]=jt,i[bt+4>>2]=l,jt=0|i[(bt=N)>>2],pn=0|i[bt+4>>2],an=0|i[(bt=L)>>2],Pt=0|i[bt+4>>2],bt=0|F(0|jt,0|pn,18,0),cn=l,Ft=0|U(0|an,0|Pt,0|jt,0|pn),pn=0|U(0|Ft,0|l,0|bt,0|cn),i[(cn=L)>>2]=pn,i[cn+4>>2]=l,pn=0|i[(cn=j)>>2],bt=0|i[cn+4>>2],Ft=0|i[(cn=Y)>>2],jt=0|i[cn+4>>2],cn=0|F(0|pn,0|bt,18,0),Pt=l,an=0|U(0|Ft,0|jt,0|pn,0|bt),bt=0|U(0|an,0|l,0|cn,0|Pt),i[(Pt=Y)>>2]=bt,i[Pt+4>>2]=l,bt=0|i[(Pt=K)>>2],cn=0|i[Pt+4>>2],an=0|i[(Pt=W)>>2],pn=0|i[Pt+4>>2],Pt=0|F(0|bt,0|cn,18,0),jt=l,Ft=0|U(0|an,0|pn,0|bt,0|cn),cn=0|U(0|Ft,0|l,0|Pt,0|jt),i[(jt=W)>>2]=cn,i[jt+4>>2]=l,cn=0|i[(jt=H)>>2],Pt=0|i[jt+4>>2],Ft=0|i[(jt=V)>>2],bt=0|i[jt+4>>2],jt=0|F(0|cn,0|Pt,18,0),pn=l,an=0|U(0|Ft,0|bt,0|cn,0|Pt),Pt=0|U(0|an,0|l,0|jt,0|pn),i[(pn=V)>>2]=Pt,i[pn+4>>2]=l,Pt=0|i[(pn=$)>>2],jt=0|i[pn+4>>2],an=0|i[(pn=Me)>>2],cn=0|i[pn+4>>2],pn=0|F(0|Pt,0|jt,18,0),bt=l,Ft=0|U(0|an,0|cn,0|Pt,0|jt),jt=0|U(0|Ft,0|l,0|pn,0|bt),bt=l,i[(pn=Me)>>2]=jt,i[pn+4>>2]=bt,i[(pn=$)>>2]=0,i[pn+4>>2]=0,pn=bt,bt=jt,jt=0;do{an=0|k(0|bt,0|pn,0|(cn=0|B(0|(Pt=0|D(0|(Ft=0|U(pn>>31>>>6|0,0,0|bt,0|pn)),0|l,26)),0|(Ft=l),26)),0|l),i[(cn=Me+(jt<<3)|0)>>2]=an,i[cn+4>>2]=l,on=0|k(0|(Vt=0|U(0|Pt,0|Ft,0|i[(an=cn=Me+((1|jt)<<3)|0)>>2],0|i[an+4>>2])),0|(an=l),0|(vt=0|B(0|(Pt=0|D(0|(Ft=0|U(an>>31>>>7|0,0,0|Vt,0|an)),0|l,25)),0|(Ft=l),25)),0|l),i[(vt=cn)>>2]=on,i[vt+4>>2]=l,bt=0|U(0|Pt,0|Ft,0|i[(on=vt=Me+((jt=jt+2|0)<<3)|0)>>2],0|i[on+4>>2]),pn=l,i[(on=vt)>>2]=bt,i[on+4>>2]=pn}while(jt>>>0<10);pn=0|i[(jt=$)>>2],bt=0|i[jt+4>>2],fn=0|i[(jt=Me)>>2],mt=0|i[jt+4>>2],jt=0|F(0|pn,0|bt,18,0),Et=l,Ot=0|U(0|fn,0|mt,0|pn,0|bt),bt=0|U(0|Ot,0|l,0|jt,0|Et),Et=l,i[(jt=$)>>2]=0,i[jt+4>>2]=0,mt=0|k(0|bt,0|Et,0|(pn=0|B(0|(Ot=0|D(0|(jt=0|U(Et>>31>>>6|0,0,0|bt,0|Et)),0|l,26)),0|(jt=l),26)),0|l),i[(pn=Me)>>2]=mt,i[pn+4>>2]=l,mt=0|U(0|Ot,0|jt,0|i[(pn=V)>>2],0|i[pn+4>>2]),i[(pn=V)>>2]=mt,i[pn+4>>2]=l,Ke=we,t=(Ye=it)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));Ke=Me,t=(Ye=ot)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));O(be,st),O(Pe,ct),P(lt,be,Pe),mt=0|i[(pn=lt+144|0)>>2],jt=0|i[pn+4>>2],Et=0|i[(Ot=pn=lt+64|0)>>2],bt=0|i[Ot+4>>2],Ot=0|F(0|mt,0|jt,18,0),fn=l,on=0|U(0|Et,0|bt,0|mt,0|jt),jt=0|U(0|on,0|l,0|Ot,0|fn),i[(fn=pn)>>2]=jt,i[fn+4>>2]=l,jt=0|i[(fn=lt+136|0)>>2],pn=0|i[fn+4>>2],on=0|i[(Ot=fn=lt+56|0)>>2],mt=0|i[Ot+4>>2],Ot=0|F(0|jt,0|pn,18,0),bt=l,Et=0|U(0|on,0|mt,0|jt,0|pn),pn=0|U(0|Et,0|l,0|Ot,0|bt),i[(bt=fn)>>2]=pn,i[bt+4>>2]=l,pn=0|i[(bt=lt+128|0)>>2],fn=0|i[bt+4>>2],Et=0|i[(Ot=bt=lt+48|0)>>2],jt=0|i[Ot+4>>2],Ot=0|F(0|pn,0|fn,18,0),mt=l,on=0|U(0|Et,0|jt,0|pn,0|fn),fn=0|U(0|on,0|l,0|Ot,0|mt),i[(mt=bt)>>2]=fn,i[mt+4>>2]=l,fn=0|i[(mt=lt+120|0)>>2],bt=0|i[mt+4>>2],on=0|i[(Ot=mt=lt+40|0)>>2],pn=0|i[Ot+4>>2],Ot=0|F(0|fn,0|bt,18,0),jt=l,Et=0|U(0|on,0|pn,0|fn,0|bt),bt=0|U(0|Et,0|l,0|Ot,0|jt),i[(jt=mt)>>2]=bt,i[jt+4>>2]=l,bt=0|i[(jt=lt+112|0)>>2],mt=0|i[jt+4>>2],Et=0|i[(Ot=jt=lt+32|0)>>2],fn=0|i[Ot+4>>2],Ot=0|F(0|bt,0|mt,18,0),pn=l,on=0|U(0|Et,0|fn,0|bt,0|mt),mt=0|U(0|on,0|l,0|Ot,0|pn),i[(pn=jt)>>2]=mt,i[pn+4>>2]=l,mt=0|i[(pn=lt+104|0)>>2],jt=0|i[pn+4>>2],on=0|i[(Ot=pn=lt+24|0)>>2],bt=0|i[Ot+4>>2],Ot=0|F(0|mt,0|jt,18,0),fn=l,Et=0|U(0|on,0|bt,0|mt,0|jt),jt=0|U(0|Et,0|l,0|Ot,0|fn),i[(fn=pn)>>2]=jt,i[fn+4>>2]=l,jt=0|i[(fn=lt+96|0)>>2],pn=0|i[fn+4>>2],Et=0|i[(Ot=fn=lt+16|0)>>2],mt=0|i[Ot+4>>2],Ot=0|F(0|jt,0|pn,18,0),bt=l,on=0|U(0|Et,0|mt,0|jt,0|pn),pn=0|U(0|on,0|l,0|Ot,0|bt),i[(bt=fn)>>2]=pn,i[bt+4>>2]=l,pn=0|i[(bt=lt+88|0)>>2],fn=0|i[bt+4>>2],on=0|i[(Ot=bt=lt+8|0)>>2],jt=0|i[Ot+4>>2],Ot=0|F(0|pn,0|fn,18,0),mt=l,Et=0|U(0|on,0|jt,0|pn,0|fn),fn=0|U(0|Et,0|l,0|Ot,0|mt),i[(mt=bt)>>2]=fn,i[mt+4>>2]=l,Ot=0|i[(fn=mt=lt+80|0)>>2],Et=0|i[fn+4>>2],pn=0|i[(fn=lt)>>2],jt=0|i[fn+4>>2],fn=0|F(0|Ot,0|Et,18,0),on=l,vt=0|U(0|pn,0|jt,0|Ot,0|Et),Et=0|U(0|vt,0|l,0|fn,0|on),on=l,i[(fn=lt)>>2]=Et,i[fn+4>>2]=on,i[(fn=mt)>>2]=0,i[fn+4>>2]=0,fn=on,on=Et,Et=0;do{pn=0|k(0|on,0|fn,0|(jt=0|B(0|(Ot=0|D(0|(vt=0|U(fn>>31>>>6|0,0,0|on,0|fn)),0|l,26)),0|(vt=l),26)),0|l),i[(jt=lt+(Et<<3)|0)>>2]=pn,i[jt+4>>2]=l,cn=0|k(0|(Ft=0|U(0|Ot,0|vt,0|i[(pn=jt=lt+((1|Et)<<3)|0)>>2],0|i[pn+4>>2])),0|(pn=l),0|(Pt=0|B(0|(Ot=0|D(0|(vt=0|U(pn>>31>>>7|0,0,0|Ft,0|pn)),0|l,25)),0|(vt=l),25)),0|l),i[(Pt=jt)>>2]=cn,i[Pt+4>>2]=l,on=0|U(0|Ot,0|vt,0|i[(cn=Pt=lt+((Et=Et+2|0)<<3)|0)>>2],0|i[cn+4>>2]),fn=l,i[(cn=Pt)>>2]=on,i[cn+4>>2]=fn}while(Et>>>0<10);fn=0|i[(Et=mt)>>2],on=0|i[Et+4>>2],cn=0|i[(Et=lt)>>2],Pt=0|i[Et+4>>2],Et=0|F(0|fn,0|on,18,0),vt=l,Ot=0|U(0|cn,0|Pt,0|fn,0|on),on=0|U(0|Ot,0|l,0|Et,0|vt),vt=l,i[(Et=mt)>>2]=0,i[Et+4>>2]=0,Pt=0|k(0|on,0|vt,0|(fn=0|B(0|(Ot=0|D(0|(Et=0|U(vt>>31>>>6|0,0,0|on,0|vt)),0|l,26)),0|(Et=l),26)),0|l),i[(fn=lt)>>2]=Pt,i[fn+4>>2]=l,Pt=0|U(0|Ot,0|Et,0|i[(fn=bt)>>2],0|i[fn+4>>2]),i[(fn=bt)>>2]=Pt,i[fn+4>>2]=l,Ot=0|k(0|(Pt=0|i[(fn=be)>>2]),0|(Et=0|i[fn+4>>2]),0|i[(fn=Pe)>>2],0|i[fn+4>>2]),fn=l,i[(vt=Pe)>>2]=Ot,i[vt+4>>2]=fn,jt=0|k(0|(on=0|i[(vt=J)>>2]),0|(cn=0|i[vt+4>>2]),0|i[(vt=Q)>>2],0|i[vt+4>>2]),vt=l,i[(pn=Q)>>2]=jt,i[pn+4>>2]=vt,Vt=0|k(0|(Ft=0|i[(pn=X)>>2]),0|(an=0|i[pn+4>>2]),0|i[(pn=Z)>>2],0|i[pn+4>>2]),pn=l,i[(Ut=Z)>>2]=Vt,i[Ut+4>>2]=pn,Jt=0|k(0|(kt=0|i[(Ut=ee)>>2]),0|(Dt=0|i[Ut+4>>2]),0|i[(Ut=te)>>2],0|i[Ut+4>>2]),Ut=l,i[(qt=te)>>2]=Jt,i[qt+4>>2]=Ut,wt=0|k(0|(sn=0|i[(qt=ne)>>2]),0|(zt=0|i[qt+4>>2]),0|i[(qt=re)>>2],0|i[qt+4>>2]),qt=l,i[(xt=re)>>2]=wt,i[xt+4>>2]=qt,ln=0|k(0|($t=0|i[(xt=ie)>>2]),0|(nn=0|i[xt+4>>2]),0|i[(xt=ae)>>2],0|i[xt+4>>2]),xt=l,i[(Tt=ae)>>2]=ln,i[Tt+4>>2]=xt,yt=0|k(0|(At=0|i[(Tt=oe)>>2]),0|(_t=0|i[Tt+4>>2]),0|i[(Tt=se)>>2],0|i[Tt+4>>2]),Tt=l,i[(tn=se)>>2]=yt,i[tn+4>>2]=Tt,Rt=0|k(0|(Yt=0|i[(tn=le)>>2]),0|(It=0|i[tn+4>>2]),0|i[(tn=ce)>>2],0|i[tn+4>>2]),tn=l,i[(rn=ce)>>2]=Rt,i[rn+4>>2]=tn,ht=0|k(0|(Gt=0|i[(rn=ue)>>2]),0|(Ht=0|i[rn+4>>2]),0|i[(rn=de)>>2],0|i[rn+4>>2]),rn=l,i[(Zt=de)>>2]=ht,i[Zt+4>>2]=rn,Lt=0|k(0|(Qt=0|i[(Zt=pe)>>2]),0|(gt=0|i[Zt+4>>2]),0|i[(Zt=fe)>>2],0|i[Zt+4>>2]),Zt=l,i[(Xt=fe)>>2]=Lt,i[Xt+4>>2]=Zt,t=(Ye=_e)+72|0;do{i[Ye>>2]=0,Ye=Ye+4|0}while((0|Ye)<(0|t));bt=0|F(0|Ot,0|fn,121665,0),mt=l,i[(Xt=Ae)>>2]=bt,i[Xt+4>>2]=mt,Xt=0|F(0|jt,0|vt,121665,0),i[(St=he)>>2]=Xt,i[St+4>>2]=l,St=0|F(0|Vt,0|pn,121665,0),i[(Xt=ge)>>2]=St,i[Xt+4>>2]=l,Xt=0|F(0|Jt,0|Ut,121665,0),i[(St=me)>>2]=Xt,i[St+4>>2]=l,St=0|F(0|wt,0|qt,121665,0),i[(Xt=ye)>>2]=St,i[Xt+4>>2]=l,Xt=0|F(0|ln,0|xt,121665,0),i[(St=Se)>>2]=Xt,i[St+4>>2]=l,St=0|F(0|yt,0|Tt,121665,0),i[(Xt=Ee)>>2]=St,i[Xt+4>>2]=l,Xt=0|F(0|Rt,0|tn,121665,0),i[(St=ve)>>2]=Xt,i[St+4>>2]=l,St=0|F(0|ht,0|rn,121665,0),i[(Xt=Te)>>2]=St,i[Xt+4>>2]=l,Xt=0|F(0|Lt,0|Zt,121665,0),i[(St=Ce)>>2]=Xt,i[St+4>>2]=l,i[(St=_e)>>2]=0,i[St+4>>2]=0,St=mt,mt=bt,bt=0;do{Bt=0|k(0|mt,0|St,0|(Wt=0|B(0|(Kt=0|D(0|(Xt=0|U(St>>31>>>6|0,0,0|mt,0|St)),0|l,26)),0|(Xt=l),26)),0|l),i[(Wt=Ae+(bt<<3)|0)>>2]=Bt,i[Wt+4>>2]=l,un=0|k(0|(Mt=0|U(0|Kt,0|Xt,0|i[(Bt=Wt=Ae+((1|bt)<<3)|0)>>2],0|i[Bt+4>>2])),0|(Bt=l),0|(dn=0|B(0|(Kt=0|D(0|(Xt=0|U(Bt>>31>>>7|0,0,0|Mt,0|Bt)),0|l,25)),0|(Xt=l),25)),0|l),i[(dn=Wt)>>2]=un,i[dn+4>>2]=l,mt=0|U(0|Kt,0|Xt,0|i[(un=dn=Ae+((bt=bt+2|0)<<3)|0)>>2],0|i[un+4>>2]),St=l,i[(un=dn)>>2]=mt,i[un+4>>2]=St}while(bt>>>0<10);St=0|i[(bt=_e)>>2],mt=0|i[bt+4>>2],Zt=0|i[(bt=Ae)>>2],Lt=0|i[bt+4>>2],bt=0|F(0|St,0|mt,18,0),rn=l,ht=0|U(0|Zt,0|Lt,0|St,0|mt),mt=0|U(0|ht,0|l,0|bt,0|rn),rn=l,i[(bt=_e)>>2]=0,i[bt+4>>2]=0,St=0|B(0|(ht=0|D(0|(bt=0|U(rn>>31>>>6|0,0,0|mt,0|rn)),0|l,26)),0|(bt=l),26),Lt=l,tn=0|i[(Zt=he)>>2],Rt=0|i[Zt+4>>2],rn=0|k(0|(Zt=0|U(0|mt,0|rn,0|Pt,0|Et)),0|l,0|St,0|Lt),i[(Lt=Ae)>>2]=rn,i[Lt+4>>2]=l,Lt=0|U(0|tn,0|Rt,0|on,0|cn),Rt=0|U(0|Lt,0|l,0|ht,0|bt),i[(bt=he)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=ge)>>2],0|i[bt+4>>2],0|Ft,0|an),i[(bt=ge)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=me)>>2],0|i[bt+4>>2],0|kt,0|Dt),i[(bt=me)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=ye)>>2],0|i[bt+4>>2],0|sn,0|zt),i[(bt=ye)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=Se)>>2],0|i[bt+4>>2],0|$t,0|nn),i[(bt=Se)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=Ee)>>2],0|i[bt+4>>2],0|At,0|_t),i[(bt=Ee)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=ve)>>2],0|i[bt+4>>2],0|Yt,0|It),i[(bt=ve)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=Te)>>2],0|i[bt+4>>2],0|Gt,0|Ht),i[(bt=Te)>>2]=Rt,i[bt+4>>2]=l,Rt=0|U(0|i[(bt=Ce)>>2],0|i[bt+4>>2],0|Qt,0|gt),i[(bt=Ce)>>2]=Rt,i[bt+4>>2]=l,P(ut,Pe,Ae),Rt=0|i[(bt=ut+144|0)>>2],ht=0|i[bt+4>>2],tn=0|i[(Lt=bt=ut+64|0)>>2],rn=0|i[Lt+4>>2],Lt=0|F(0|Rt,0|ht,18,0),St=l,Zt=0|U(0|tn,0|rn,0|Rt,0|ht),ht=0|U(0|Zt,0|l,0|Lt,0|St),i[(St=bt)>>2]=ht,i[St+4>>2]=l,ht=0|i[(St=ut+136|0)>>2],bt=0|i[St+4>>2],Zt=0|i[(Lt=St=ut+56|0)>>2],Rt=0|i[Lt+4>>2],Lt=0|F(0|ht,0|bt,18,0),rn=l,tn=0|U(0|Zt,0|Rt,0|ht,0|bt),bt=0|U(0|tn,0|l,0|Lt,0|rn),i[(rn=St)>>2]=bt,i[rn+4>>2]=l,bt=0|i[(rn=ut+128|0)>>2],St=0|i[rn+4>>2],tn=0|i[(Lt=rn=ut+48|0)>>2],ht=0|i[Lt+4>>2],Lt=0|F(0|bt,0|St,18,0),Rt=l,Zt=0|U(0|tn,0|ht,0|bt,0|St),St=0|U(0|Zt,0|l,0|Lt,0|Rt),i[(Rt=rn)>>2]=St,i[Rt+4>>2]=l,St=0|i[(Rt=ut+120|0)>>2],rn=0|i[Rt+4>>2],Zt=0|i[(Lt=Rt=ut+40|0)>>2],bt=0|i[Lt+4>>2],Lt=0|F(0|St,0|rn,18,0),ht=l,tn=0|U(0|Zt,0|bt,0|St,0|rn),rn=0|U(0|tn,0|l,0|Lt,0|ht),i[(ht=Rt)>>2]=rn,i[ht+4>>2]=l,rn=0|i[(ht=ut+112|0)>>2],Rt=0|i[ht+4>>2],tn=0|i[(Lt=ht=ut+32|0)>>2],St=0|i[Lt+4>>2],Lt=0|F(0|rn,0|Rt,18,0),bt=l,Zt=0|U(0|tn,0|St,0|rn,0|Rt),Rt=0|U(0|Zt,0|l,0|Lt,0|bt),i[(bt=ht)>>2]=Rt,i[bt+4>>2]=l,Rt=0|i[(bt=ut+104|0)>>2],ht=0|i[bt+4>>2],Zt=0|i[(Lt=bt=ut+24|0)>>2],rn=0|i[Lt+4>>2],Lt=0|F(0|Rt,0|ht,18,0),St=l,tn=0|U(0|Zt,0|rn,0|Rt,0|ht),ht=0|U(0|tn,0|l,0|Lt,0|St),i[(St=bt)>>2]=ht,i[St+4>>2]=l,ht=0|i[(St=ut+96|0)>>2],bt=0|i[St+4>>2],tn=0|i[(Lt=St=ut+16|0)>>2],Rt=0|i[Lt+4>>2],Lt=0|F(0|ht,0|bt,18,0),rn=l,Zt=0|U(0|tn,0|Rt,0|ht,0|bt),bt=0|U(0|Zt,0|l,0|Lt,0|rn),i[(rn=St)>>2]=bt,i[rn+4>>2]=l,bt=0|i[(rn=ut+88|0)>>2],St=0|i[rn+4>>2],Zt=0|i[(Lt=rn=ut+8|0)>>2],ht=0|i[Lt+4>>2],Lt=0|F(0|bt,0|St,18,0),Rt=l,tn=0|U(0|Zt,0|ht,0|bt,0|St),St=0|U(0|tn,0|l,0|Lt,0|Rt),i[(Rt=rn)>>2]=St,i[Rt+4>>2]=l,Lt=0|i[(St=Rt=ut+80|0)>>2],tn=0|i[St+4>>2],bt=0|i[(St=ut)>>2],ht=0|i[St+4>>2],St=0|F(0|Lt,0|tn,18,0),Zt=l,mt=0|U(0|bt,0|ht,0|Lt,0|tn),tn=0|U(0|mt,0|l,0|St,0|Zt),Zt=l,i[(St=ut)>>2]=tn,i[St+4>>2]=Zt,i[(St=Rt)>>2]=0,i[St+4>>2]=0,St=Zt,Zt=tn,tn=0;do{bt=0|k(0|Zt,0|St,0|(ht=0|B(0|(Lt=0|D(0|(mt=0|U(St>>31>>>6|0,0,0|Zt,0|St)),0|l,26)),0|(mt=l),26)),0|l),i[(ht=ut+(tn<<3)|0)>>2]=bt,i[ht+4>>2]=l,xt=0|k(0|(Tt=0|U(0|Lt,0|mt,0|i[(bt=ht=ut+((1|tn)<<3)|0)>>2],0|i[bt+4>>2])),0|(bt=l),0|(yt=0|B(0|(Lt=0|D(0|(mt=0|U(bt>>31>>>7|0,0,0|Tt,0|bt)),0|l,25)),0|(mt=l),25)),0|l),i[(yt=ht)>>2]=xt,i[yt+4>>2]=l,Zt=0|U(0|Lt,0|mt,0|i[(xt=yt=ut+((tn=tn+2|0)<<3)|0)>>2],0|i[xt+4>>2]),St=l,i[(xt=yt)>>2]=Zt,i[xt+4>>2]=St}while(tn>>>0<10);St=0|i[(tn=Rt)>>2],Zt=0|i[tn+4>>2],gt=0|i[(tn=ut)>>2],Qt=0|i[tn+4>>2],tn=0|F(0|St,0|Zt,18,0),Ht=l,Gt=0|U(0|gt,0|Qt,0|St,0|Zt),Zt=0|U(0|Gt,0|l,0|tn,0|Ht),Ht=l,i[(tn=Rt)>>2]=0,i[tn+4>>2]=0,Qt=0|k(0|Zt,0|Ht,0|(St=0|B(0|(Gt=0|D(0|(tn=0|U(Ht>>31>>>6|0,0,0|Zt,0|Ht)),0|l,26)),0|(tn=l),26)),0|l),i[(St=ut)>>2]=Qt,i[St+4>>2]=l,Qt=0|U(0|Gt,0|tn,0|i[(St=rn)>>2],0|i[St+4>>2]),i[(St=rn)>>2]=Qt,i[St+4>>2]=l,St=0;do{Gt=0|i[(tn=Qt=lt+(St<<3)|0)>>2],Ht=0|i[tn+4>>2],gt=0|i[(Zt=tn=it+(St<<3)|0)>>2],Yt=((It=0|i[Zt+4>>2])^Ht)&ft,Ht=0|D(0,(Zt=(gt^Gt)&pt)^Gt|0,32),i[(Gt=Qt)>>2]=Ht,i[Gt+4>>2]=l,Gt=0|D(0,Zt^gt|0,32),i[(gt=tn)>>2]=Gt,i[gt+4>>2]=l,St=St+1|0}while(10!=(0|St));_n=0;do{Rt=0|i[(rn=St=ut+(_n<<3)|0)>>2],gt=0|i[rn+4>>2],tn=0|i[(Gt=rn=ot+(_n<<3)|0)>>2],Ht=((Zt=0|i[Gt+4>>2])^gt)&ft,gt=0|D(0,(Gt=(tn^Rt)&pt)^Rt|0,32),i[(Rt=St)>>2]=gt,i[Rt+4>>2]=l,Rt=0|D(0,Gt^tn|0,32),i[(tn=rn)>>2]=Rt,i[tn+4>>2]=l,_n=_n+1|0}while(10!=(0|_n));if(8==(0|(nt=nt+1|0))){hn=rt,gn=it,mn=at,yn=ot,Sn=st,En=lt,vn=ct,Tn=ut;break}ft=ut,pt=lt,tn=ot,Rt=it,xe=dt<<1&255,ut=ct,ct=ft,lt=st,st=pt,ot=at,at=tn,it=rt,rt=Rt}if(32==(0|(rt=Qe+1|0))){Cn=En,An=Tn;break}Qe=rt,Xe=gn,Ze=hn,ke=yn,et=mn,Ue=En,tt=Sn,Ge=Tn,De=vn}Ke=Cn,t=(Ye=Be)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));Ke=An,t=(Ye=Fe)+80|0;do{i[Ye>>2]=i[Ke>>2],Ye=Ye+4|0,Ke=Ke+4|0}while((0|Ye)<(0|t));O(Ae,Fe),O(Le,Ae),O(Ne,Le),b(be,Ne,Fe),b(Pe,be,Ae),O(Ne,Pe),b(Oe,Ne,be),O(Ne,Oe),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),b(Me,Ne,Oe),O(Ne,Me),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),b(Ie,Le,Me),O(Ne,Ie),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),b(Ne,Le,Ie),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),b(we,Ne,Me),O(Ne,we),O(Le,Ne),Me=2;do{O(Ne,Le),O(Le,Ne),Me=Me+2|0}while((0|Me)<50);b(Re,Le,we),O(Le,Re),O(Ne,Le),Me=2;do{O(Le,Ne),O(Ne,Le),Me=Me+2|0}while((0|Me)<100);b(Le,Ne,Re),O(Ne,Le),O(Le,Ne),Re=2;do{O(Ne,Le),O(Le,Ne),Re=Re+2|0}while((0|Re)<50);for(b(Ne,Le,we),O(Le,Ne),O(Ne,Le),O(Le,Ne),O(Ne,Le),O(Le,Ne),b(je,Le,Pe),b(Fe,Be,je),je=0|i[Fe>>2],i[Ae>>2]=je,i[(Be=Ae+4|0)>>2]=i[Fe+8>>2],i[(Pe=Ae+8|0)>>2]=i[Fe+16>>2],i[(Le=Ae+12|0)>>2]=i[Fe+24>>2],i[(Ne=Ae+16|0)>>2]=i[Fe+32>>2],i[(we=Ae+20|0)>>2]=i[Fe+40>>2],i[(Re=Ae+24|0)>>2]=i[Fe+48>>2],i[(Me=Ae+28|0)>>2]=i[Fe+56>>2],i[(Ie=Ae+32|0)>>2]=i[Fe+64>>2],i[(Oe=Ae+36|0)>>2]=i[Fe+72>>2],Fe=je,je=0;be=Ae+(je<<2)|0,Ke=Fe>>31&Fe,1&je?(t=Ke>>25,i[be>>2]=(0|c(t,-33554432))+Fe,Cn=(0|i[(Ke=Ae+((be=je+1|0)<<2)|0)>>2])+t|0,i[Ke>>2]=Cn,bn=Cn,Pn=be):(Ye=Ke>>26,i[be>>2]=(0|c(Ye,-67108864))+Fe,Cn=(0|i[(An=Ae+((t=je+1|0)<<2)|0)>>2])+Ye|0,i[An>>2]=Cn,bn=Cn,Pn=t),9!=(0|Pn);)Fe=bn,je=Pn;for(je=((Pn=0|i[Oe>>2])>>31&Pn)>>25,i[Oe>>2]=(0|c(je,-33554432))+Pn,Pn=(19*je|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Pn,je=Pn,Pn=0;bn=Ae+(Pn<<2)|0,Fe=je>>31&je,1&Pn?(t=Fe>>25,i[bn>>2]=(0|c(t,-33554432))+je,Cn=(0|i[(Fe=Ae+((bn=Pn+1|0)<<2)|0)>>2])+t|0,i[Fe>>2]=Cn,On=bn,Mn=Cn):(be=Fe>>26,i[bn>>2]=(0|c(be,-67108864))+je,t=(0|i[(Ke=Ae+((Cn=Pn+1|0)<<2)|0)>>2])+be|0,i[Ke>>2]=t,On=Cn,Mn=t),9!=(0|On);)je=Mn,Pn=On;for(Pn=((On=0|i[Oe>>2])>>31&On)>>25,i[Oe>>2]=(0|c(Pn,-33554432))+On,On=(19*Pn|0)+(0|i[Ae>>2])|0,Mn=(0|c(Pn=(On>>31&On)>>26,-67108864))+On|0,i[Ae>>2]=Mn,i[Be>>2]=Pn+(0|i[Be>>2]),Pn=Mn,Mn=0;On=Ae+(Mn<<2)|0,1&Mn?(i[On>>2]=33554431&Pn,je=(0|i[(bn=Ae+((On=Mn+1|0)<<2)|0)>>2])+(Pn>>25)|0,i[bn>>2]=je,In=On,wn=je):(i[On>>2]=67108863&Pn,bn=(0|i[(Cn=Ae+((je=Mn+1|0)<<2)|0)>>2])+(Pn>>26)|0,i[Cn>>2]=bn,In=je,wn=bn),9!=(0|In);)Pn=wn,Mn=In;for(In=0|i[Oe>>2],i[Oe>>2]=33554431&In,Mn=(19*(In>>25)|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Mn,In=Mn,Mn=0;wn=Ae+(Mn<<2)|0,1&Mn?(i[wn>>2]=33554431&In,Pn=(0|i[(On=Ae+((wn=Mn+1|0)<<2)|0)>>2])+(In>>25)|0,i[On>>2]=Pn,Rn=wn,Nn=Pn):(i[wn>>2]=67108863&In,On=(0|i[(je=Ae+((Pn=Mn+1|0)<<2)|0)>>2])+(In>>26)|0,i[je>>2]=On,Rn=Pn,Nn=On),9!=(0|Rn);)In=Nn,Mn=Rn;for(Mn=33554431&(Rn=0|i[Oe>>2]),i[Oe>>2]=Mn,Nn=(19*(Rn>>25)|0)+(0|i[Ae>>2])|0,i[Ae>>2]=Nn,Rn=1,In=~(Nn+-67108845>>31);;){if(Pn=0|i[Ae+(Rn<<2)>>2],Ln=1&Rn?(Pn=(On=(Pn=(On=Pn<<16&(-33554432^Pn))<<8&On)<<4&Pn)<<2&On)<<1&Pn:(On=(wn=(On=(wn=Pn<<16&(-67108864^Pn))<<8&wn)<<4&On)<<2&wn)<<1&On,Pn=Ln>>31&In,10==(0|(Rn=Rn+1|0))){Dn=Pn;break}In=Pn}return In=Nn-(67108845&Dn)|0,i[Ae>>2]=In,Ae=67108863&Dn,Nn=33554431&Dn,Ln=(Rn=(0|i[Be>>2])-Nn|0)<<2,On=(Pn=(0|i[Pe>>2])-Ae|0)<<3,je=(wn=(0|i[Le>>2])-Nn|0)<<5,Dn=(bn=(0|i[Ne>>2])-Dn|0)<<6,Cn=(0|i[we>>2])-Nn|0,i[we>>2]=Cn,Fe=(we=(0|i[Re>>2])-Ae|0)<<1,Ke=(t=(0|i[Me>>2])-Nn|0)<<3,be=(0|i[Ie>>2])-Ae<<4,i[Be>>2]=Ln,i[Pe>>2]=On,i[Le>>2]=je,i[Ne>>2]=Dn,i[Re>>2]=Fe,i[Me>>2]=Ke,i[Ie>>2]=be,i[Oe>>2]=Mn-Nn<<6,r[e>>0]=In,r[e+1>>0]=In>>>8,r[e+2>>0]=In>>>16,r[e+3>>0]=Ln|In>>>24,r[e+4>>0]=Rn>>>6,r[e+5>>0]=Rn>>>14,r[e+6>>0]=On|Rn>>>22,r[e+7>>0]=Pn>>>5,r[e+8>>0]=Pn>>>13,r[e+9>>0]=je|Pn>>>21,r[e+10>>0]=wn>>>3,r[e+11>>0]=wn>>>11,r[e+12>>0]=Dn|wn>>>19,r[e+13>>0]=bn>>>2,r[e+14>>0]=bn>>>10,r[e+15>>0]=bn>>>18,r[e+16>>0]=Cn,r[e+17>>0]=Cn>>>8,r[e+18>>0]=Cn>>>16,r[e+19>>0]=Cn>>>24|Fe,r[e+20>>0]=we>>>7,r[e+21>>0]=we>>>15,r[e+22>>0]=we>>>23|Ke,r[e+23>>0]=t>>>5,r[e+24>>0]=t>>>13,Ke=0|i[Ie>>2],r[e+25>>0]=t>>>21|Ke,r[e+26>>0]=Ke>>>8,r[e+27>>0]=Ke>>>16,t=0|i[Oe>>2],r[e+28>>0]=Ke>>>24|t,r[e+29>>0]=t>>>8,r[e+30>>0]=t>>>16,r[e+31>>0]=t>>>24,o=s,0},_free:function(e){var t,n,r=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,f=0,_=0,g=0,m=0,y=0,S=0,E=0,v=0,T=0,C=0,A=0,b=0,P=0,O=0,M=0,I=0,w=0,R=0,N=0,L=0,D=0,k=0,U=0,G=0,x=0;if(e|=0){(r=e+-8|0)>>>0<(a=0|i[47])>>>0&&h(),1==(0|(e=3&(t=0|i[e+-4>>2])))&&h(),n=r+(o=-8&t)|0;do{if(1&t)p=r,f=o;else{if(s=0|i[r>>2],!e)return;if(c=s+o|0,(l=r+(0-s)|0)>>>0<a>>>0&&h(),(0|l)==(0|i[48])){if(3!=(3&(d=0|i[(u=n+4|0)>>2])|0)){p=l,f=c;break}return i[45]=c,i[u>>2]=-2&d,i[l+4>>2]=1|c,void(i[l+c>>2]=c)}if(d=s>>>3,s>>>0<256){if(s=0|i[l+8>>2],u=0|i[l+12>>2],(0|s)!=(0|(_=212+(d<<1<<2)|0))&&(s>>>0<a>>>0&&h(),(0|i[s+12>>2])!=(0|l)&&h()),(0|u)==(0|s)){i[43]=i[43]&~(1<<d),p=l,f=c;break}(0|u)!=(0|_)?(u>>>0<a>>>0&&h(),(0|i[(_=u+8|0)>>2])==(0|l)?g=_:h()):g=u+8|0,i[s+12>>2]=u,i[g>>2]=s,p=l,f=c;break}s=0|i[l+24>>2],u=0|i[l+12>>2];do{if((0|u)==(0|l)){if(m=0|i[(d=(_=l+16|0)+4|0)>>2])E=m,v=d;else{if(!(y=0|i[_>>2])){S=0;break}E=y,v=_}for(;;)if(m=0|i[(d=E+20|0)>>2])E=m,v=d;else{if(!(m=0|i[(d=E+16|0)>>2])){T=E,C=v;break}E=m,v=d}if(!(C>>>0<a>>>0)){i[C>>2]=0,S=T;break}h()}else{if((d=0|i[l+8>>2])>>>0<a>>>0&&h(),(0|i[(m=d+12|0)>>2])!=(0|l)&&h(),(0|i[(_=u+8|0)>>2])==(0|l)){i[m>>2]=u,i[_>>2]=d,S=u;break}h()}}while(0);if(s){if(u=0|i[l+28>>2],(0|l)==(0|i[(d=476+(u<<2)|0)>>2])){if(i[d>>2]=S,!S){i[44]=i[44]&~(1<<u),p=l,f=c;break}}else if(s>>>0<(0|i[47])>>>0&&h(),(0|i[(u=s+16|0)>>2])==(0|l)?i[u>>2]=S:i[s+20>>2]=S,!S){p=l,f=c;break}S>>>0<(u=0|i[47])>>>0&&h(),i[S+24>>2]=s,_=0|i[(d=l+16|0)>>2];do{if(_){if(!(_>>>0<u>>>0)){i[S+16>>2]=_,i[_+24>>2]=S;break}h()}}while(0);if(_=0|i[d+4>>2]){if(!(_>>>0<(0|i[47])>>>0)){i[S+20>>2]=_,i[_+24>>2]=S,p=l,f=c;break}h()}else p=l,f=c}else p=l,f=c}}while(0);if(p>>>0>=n>>>0&&h(),1&(r=0|i[(o=n+4|0)>>2])||h(),2&r)i[o>>2]=-2&r,i[p+4>>2]=1|f,i[p+f>>2]=f,w=f;else{if((0|n)==(0|i[49])){if(S=(0|i[46])+f|0,i[46]=S,i[49]=p,i[p+4>>2]=1|S,(0|p)!=(0|i[48]))return;return i[48]=0,void(i[45]=0)}if((0|n)==(0|i[48]))return S=(0|i[45])+f|0,i[45]=S,i[48]=p,i[p+4>>2]=1|S,void(i[p+S>>2]=S);S=(-8&r)+f|0,a=r>>>3;do{if(r>>>0>=256){T=0|i[n+24>>2],C=0|i[n+12>>2];do{if((0|C)==(0|n)){if(g=0|i[(E=(v=n+16|0)+4|0)>>2])b=g,P=E;else{if(!(e=0|i[v>>2])){A=0;break}b=e,P=v}for(;;)if(g=0|i[(E=b+20|0)>>2])b=g,P=E;else{if(!(g=0|i[(E=b+16|0)>>2])){O=b,M=P;break}b=g,P=E}if(!(M>>>0<(0|i[47])>>>0)){i[M>>2]=0,A=O;break}h()}else{if((E=0|i[n+8>>2])>>>0<(0|i[47])>>>0&&h(),(0|i[(g=E+12|0)>>2])!=(0|n)&&h(),(0|i[(v=C+8|0)>>2])==(0|n)){i[g>>2]=C,i[v>>2]=E,A=C;break}h()}}while(0);if(T){if(C=0|i[n+28>>2],(0|n)==(0|i[(c=476+(C<<2)|0)>>2])){if(i[c>>2]=A,!A){i[44]=i[44]&~(1<<C);break}}else if(T>>>0<(0|i[47])>>>0&&h(),(0|i[(C=T+16|0)>>2])==(0|n)?i[C>>2]=A:i[T+20>>2]=A,!A)break;A>>>0<(C=0|i[47])>>>0&&h(),i[A+24>>2]=T,l=0|i[(c=n+16|0)>>2];do{if(l){if(!(l>>>0<C>>>0)){i[A+16>>2]=l,i[l+24>>2]=A;break}h()}}while(0);if(l=0|i[c+4>>2]){if(!(l>>>0<(0|i[47])>>>0)){i[A+20>>2]=l,i[l+24>>2]=A;break}h()}}}else{if(l=0|i[n+8>>2],C=0|i[n+12>>2],(0|l)!=(0|(T=212+(a<<1<<2)|0))&&(l>>>0<(0|i[47])>>>0&&h(),(0|i[l+12>>2])!=(0|n)&&h()),(0|C)==(0|l)){i[43]=i[43]&~(1<<a);break}(0|C)!=(0|T)?(C>>>0<(0|i[47])>>>0&&h(),(0|i[(T=C+8|0)>>2])==(0|n)?I=T:h()):I=C+8|0,i[l+12>>2]=C,i[I>>2]=l}}while(0);if(i[p+4>>2]=1|S,i[p+S>>2]=S,(0|p)==(0|i[48]))return void(i[45]=S);w=S}if(f=w>>>3,w>>>0<256)return r=212+(f<<1<<2)|0,(o=0|i[43])&(S=1<<f)?(I=0|i[(f=r+8|0)>>2])>>>0<(0|i[47])>>>0?h():(R=f,N=I):(i[43]=o|S,R=r+8|0,N=r),i[R>>2]=p,i[N+12>>2]=p,i[p+8>>2]=N,void(i[p+12>>2]=r);L=(r=w>>>8)?w>>>0>16777215?31:w>>>((o=14-((r=((R=r<<(N=(r+1048320|0)>>>16&8))+520192|0)>>>16&4)|N|(R=((S=R<<r)+245760|0)>>>16&2))+(S<<R>>>15)|0)+7|0)&1|o<<1:0,o=476+(L<<2)|0,i[p+28>>2]=L,i[p+20>>2]=0,i[p+16>>2]=0,R=0|i[44],S=1<<L;do{if(R&S){for(N=w<<(31==(0|L)?0:25-(L>>>1)|0),r=0|i[o>>2];;){if((-8&i[r+4>>2]|0)==(0|w)){D=r,k=130;break}if(!(f=0|i[(I=r+16+(N>>>31<<2)|0)>>2])){U=I,G=r,k=127;break}N<<=1,r=f}if(127==(0|k)){if(!(U>>>0<(0|i[47])>>>0)){i[U>>2]=p,i[p+24>>2]=G,i[p+12>>2]=p,i[p+8>>2]=p;break}h()}else if(130==(0|k)){if((N=0|i[(r=D+8|0)>>2])>>>0>=(c=0|i[47])>>>0&D>>>0>=c>>>0){i[N+12>>2]=p,i[r>>2]=p,i[p+8>>2]=N,i[p+12>>2]=D,i[p+24>>2]=0;break}h()}}else i[44]=R|S,i[o>>2]=p,i[p+24>>2]=o,i[p+12>>2]=p,i[p+8>>2]=p}while(0);if(p=(0|i[51])-1|0,i[51]=p,!p){for(x=628;p=0|i[x>>2];)x=p+8|0;i[51]=-1}}},_i64Add:U,_bitshift64Ashr:D,_i64Subtract:k,_memset:G,_malloc:function(e){e|=0;var t=0,n=0,r=0,a=0,o=0,s=0,l=0,c=0,u=0,d=0,p=0,f=0,_=0,y=0,S=0,E=0,v=0,T=0,A=0,b=0,P=0,O=0,I=0,w=0,R=0,N=0,L=0,D=0,k=0,U=0,G=0,x=0,B=0,F=0,j=0,Y=0,K=0,W=0,H=0,V=0,$=0,z=0,q=0,J=0,Q=0,X=0,Z=0,ee=0,te=0,ne=0,re=0,ie=0,ae=0,oe=0,se=0,le=0,ce=0,ue=0,de=0,pe=0,fe=0,_e=0,he=0,ge=0,me=0,ye=0,Se=0,Ee=0,ve=0,Te=0,Ce=0,Ae=0,be=0,Pe=0,Oe=0,Me=0,Ie=0,we=0,Re=0,Ne=0,Le=0,De=0,ke=0,Ue=0,Ge=0,xe=0,Be=0,Fe=0,je=0,Ye=0;do{if(e>>>0<245){if(n=(t=e>>>0<11?16:e+11&-8)>>>3,3&(a=(r=0|i[43])>>>n)){c=0|i[(l=(s=212+((o=(1&a^1)+n|0)<<1<<2)|0)+8|0)>>2],d=0|i[(u=c+8|0)>>2];do{if((0|s)!=(0|d)){if(d>>>0<(0|i[47])>>>0&&h(),(0|i[(p=d+12|0)>>2])==(0|c)){i[p>>2]=s,i[l>>2]=d;break}h()}else i[43]=r&~(1<<o)}while(0);return d=o<<3,i[c+4>>2]=3|d,i[(l=c+d+4|0)>>2]=1|i[l>>2],0|u}if(t>>>0>(l=0|i[45])>>>0){if(a){f=0|i[(y=(_=212+((S=((d=(p=(d=((s=a<<n&((d=2<<n)|0-d))&0-s)-1|0)>>>(s=d>>>12&16))>>>5&8)|s|(p=(f=p>>>d)>>>2&4)|(f=(_=f>>>p)>>>1&2)|(_=(y=_>>>f)>>>1&1))+(y>>>_)|0)<<1<<2)|0)+8|0)>>2],s=0|i[(p=f+8|0)>>2];do{if((0|_)!=(0|s)){if(s>>>0<(0|i[47])>>>0&&h(),(0|i[(d=s+12|0)>>2])==(0|f)){i[d>>2]=_,i[y>>2]=s,E=0|i[45];break}h()}else i[43]=r&~(1<<S),E=l}while(0);return l=(S<<3)-t|0,i[f+4>>2]=3|t,i[(r=f+t|0)+4>>2]=1|l,i[r+l>>2]=l,E&&(s=0|i[48],_=212+((y=E>>>3)<<1<<2)|0,(n=0|i[43])&(a=1<<y)?(u=0|i[(y=_+8|0)>>2])>>>0<(0|i[47])>>>0?h():(v=y,T=u):(i[43]=n|a,v=_+8|0,T=_),i[v>>2]=s,i[T+12>>2]=s,i[s+8>>2]=T,i[s+12>>2]=_),i[45]=l,i[48]=r,0|p}if(r=0|i[44]){for(u=0|i[476+(((l=(_=(l=(r&0-r)-1|0)>>>(r=l>>>12&16))>>>5&8)|r|(_=(s=_>>>l)>>>2&4)|(s=(a=s>>>_)>>>1&2)|(a=(n=a>>>s)>>>1&1))+(n>>>a)<<2)>>2],a=(-8&i[u+4>>2])-t|0,n=u,s=u;;){if(u=0|i[n+16>>2])P=u;else{if(!(_=0|i[n+20>>2])){A=a,b=s;break}P=_}a=(_=(u=(-8&i[P+4>>2])-t|0)>>>0<a>>>0)?u:a,n=P,s=_?P:s}b>>>0<(s=0|i[47])>>>0&&h(),b>>>0>=(n=b+t|0)>>>0&&h(),a=0|i[b+24>>2],p=0|i[b+12>>2];do{if((0|p)==(0|b)){if(S=0|i[(f=b+20|0)>>2])I=S,w=f;else{if(!(u=0|i[(_=b+16|0)>>2])){O=0;break}I=u,w=_}for(;;)if(S=0|i[(f=I+20|0)>>2])I=S,w=f;else{if(!(S=0|i[(f=I+16|0)>>2])){R=I,N=w;break}I=S,w=f}if(!(N>>>0<s>>>0)){i[N>>2]=0,O=R;break}h()}else{if((f=0|i[b+8>>2])>>>0<s>>>0&&h(),(0|i[(S=f+12|0)>>2])!=(0|b)&&h(),(0|i[(_=p+8|0)>>2])==(0|b)){i[S>>2]=p,i[_>>2]=f,O=p;break}h()}}while(0);do{if(a){if(p=0|i[b+28>>2],(0|b)==(0|i[(s=476+(p<<2)|0)>>2])){if(i[s>>2]=O,!O){i[44]=i[44]&~(1<<p);break}}else if(a>>>0<(0|i[47])>>>0&&h(),(0|i[(p=a+16|0)>>2])==(0|b)?i[p>>2]=O:i[a+20>>2]=O,!O)break;O>>>0<(p=0|i[47])>>>0&&h(),i[O+24>>2]=a,s=0|i[b+16>>2];do{if(s){if(!(s>>>0<p>>>0)){i[O+16>>2]=s,i[s+24>>2]=O;break}h()}}while(0);if(s=0|i[b+20>>2]){if(!(s>>>0<(0|i[47])>>>0)){i[O+20>>2]=s,i[s+24>>2]=O;break}h()}}}while(0);return A>>>0<16?(a=A+t|0,i[b+4>>2]=3|a,i[(s=b+a+4|0)>>2]=1|i[s>>2]):(i[b+4>>2]=3|t,i[n+4>>2]=1|A,i[n+A>>2]=A,(s=0|i[45])&&(a=0|i[48],s=212+((p=s>>>3)<<1<<2)|0,(f=0|i[43])&(_=1<<p)?(S=0|i[(p=s+8|0)>>2])>>>0<(0|i[47])>>>0?h():(L=p,D=S):(i[43]=f|_,L=s+8|0,D=s),i[L>>2]=a,i[D+12>>2]=a,i[a+8>>2]=D,i[a+12>>2]=s),i[45]=A,i[48]=n),0|(b+8|0)}k=t}else k=t}else if(e>>>0<=4294967231)if(a=-8&(s=e+11|0),_=0|i[44]){f=0-a|0,U=(S=s>>>8)?a>>>0>16777215?31:a>>>((r=14-((S=((p=S<<(s=(S+1048320|0)>>>16&8))+520192|0)>>>16&4)|s|(p=((u=p<<S)+245760|0)>>>16&2))+(u<<p>>>15)|0)+7|0)&1|r<<1:0,r=0|i[476+(U<<2)>>2];e:do{if(r)for(p=f,u=0,s=a<<(31==(0|U)?0:25-(U>>>1)|0),S=r,l=0;;){if((c=(y=-8&i[S+4>>2])-a|0)>>>0<p>>>0){if((0|y)==(0|a)){j=c,Y=S,K=S,F=90;break e}W=c,H=S}else W=p,H=l;if(y=0==(0|(c=0|i[S+20>>2]))|(0|c)==(0|(S=0|i[S+16+(s>>>31<<2)>>2]))?u:c,c=0==(0|S)){G=W,x=y,B=H,F=86;break}p=W,u=y,s<<=1&c^1,l=H}else G=f,x=0,B=0,F=86}while(0);if(86==(0|F)){if(0==(0|x)&0==(0|B)){if(!(f=_&((r=2<<U)|0-r))){k=a;break}V=0|i[476+(((r=(t=(r=(f&0-f)-1|0)>>>(f=r>>>12&16))>>>5&8)|f|(t=(n=t>>>r)>>>2&4)|(n=(l=n>>>t)>>>1&2)|(l=(s=l>>>n)>>>1&1))+(s>>>l)<<2)>>2]}else V=x;V?(j=G,Y=V,K=B,F=90):($=G,z=B)}if(90==(0|F))for(;;)if(F=0,n=(s=(l=(-8&i[Y+4>>2])-a|0)>>>0<j>>>0)?l:j,l=s?Y:K,s=0|i[Y+16>>2])j=n,Y=s,K=l,F=90;else{if(!(Y=0|i[Y+20>>2])){$=n,z=l;break}j=n,K=l,F=90}if(0!=(0|z)&&$>>>0<((0|i[45])-a|0)>>>0){z>>>0<(_=0|i[47])>>>0&&h(),z>>>0>=(l=z+a|0)>>>0&&h(),n=0|i[z+24>>2],s=0|i[z+12>>2];do{if((0|s)==(0|z)){if(f=0|i[(t=z+20|0)>>2])J=f,Q=t;else{if(!(u=0|i[(r=z+16|0)>>2])){q=0;break}J=u,Q=r}for(;;)if(f=0|i[(t=J+20|0)>>2])J=f,Q=t;else{if(!(f=0|i[(t=J+16|0)>>2])){X=J,Z=Q;break}J=f,Q=t}if(!(Z>>>0<_>>>0)){i[Z>>2]=0,q=X;break}h()}else{if((t=0|i[z+8>>2])>>>0<_>>>0&&h(),(0|i[(f=t+12|0)>>2])!=(0|z)&&h(),(0|i[(r=s+8|0)>>2])==(0|z)){i[f>>2]=s,i[r>>2]=t,q=s;break}h()}}while(0);do{if(n){if(s=0|i[z+28>>2],(0|z)==(0|i[(_=476+(s<<2)|0)>>2])){if(i[_>>2]=q,!q){i[44]=i[44]&~(1<<s);break}}else if(n>>>0<(0|i[47])>>>0&&h(),(0|i[(s=n+16|0)>>2])==(0|z)?i[s>>2]=q:i[n+20>>2]=q,!q)break;q>>>0<(s=0|i[47])>>>0&&h(),i[q+24>>2]=n,_=0|i[z+16>>2];do{if(_){if(!(_>>>0<s>>>0)){i[q+16>>2]=_,i[_+24>>2]=q;break}h()}}while(0);if(_=0|i[z+20>>2]){if(!(_>>>0<(0|i[47])>>>0)){i[q+20>>2]=_,i[_+24>>2]=q;break}h()}}}while(0);do{if($>>>0>=16){if(i[z+4>>2]=3|a,i[l+4>>2]=1|$,i[l+$>>2]=$,n=$>>>3,$>>>0<256){_=212+(n<<1<<2)|0,(s=0|i[43])&(t=1<<n)?(r=0|i[(n=_+8|0)>>2])>>>0<(0|i[47])>>>0?h():(ee=n,te=r):(i[43]=s|t,ee=_+8|0,te=_),i[ee>>2]=l,i[te+12>>2]=l,i[l+8>>2]=te,i[l+12>>2]=_;break}if(ne=(_=$>>>8)?$>>>0>16777215?31:$>>>((n=14-((_=((s=_<<(t=(_+1048320|0)>>>16&8))+520192|0)>>>16&4)|t|(s=((r=s<<_)+245760|0)>>>16&2))+(r<<s>>>15)|0)+7|0)&1|n<<1:0,n=476+(ne<<2)|0,i[l+28>>2]=ne,i[(s=l+16|0)+4>>2]=0,i[s>>2]=0,!((s=0|i[44])&(r=1<<ne))){i[44]=s|r,i[n>>2]=l,i[l+24>>2]=n,i[l+12>>2]=l,i[l+8>>2]=l;break}for(r=$<<(31==(0|ne)?0:25-(ne>>>1)|0),s=0|i[n>>2];;){if((-8&i[s+4>>2]|0)==(0|$)){re=s,F=148;break}if(!(t=0|i[(n=s+16+(r>>>31<<2)|0)>>2])){ie=n,ae=s,F=145;break}r<<=1,s=t}if(145==(0|F)){if(!(ie>>>0<(0|i[47])>>>0)){i[ie>>2]=l,i[l+24>>2]=ae,i[l+12>>2]=l,i[l+8>>2]=l;break}h()}else if(148==(0|F)){if((r=0|i[(s=re+8|0)>>2])>>>0>=(t=0|i[47])>>>0&re>>>0>=t>>>0){i[r+12>>2]=l,i[s>>2]=l,i[l+8>>2]=r,i[l+12>>2]=re,i[l+24>>2]=0;break}h()}}else r=$+a|0,i[z+4>>2]=3|r,i[(s=z+r+4|0)>>2]=1|i[s>>2]}while(0);return 0|(z+8|0)}k=a}else k=a;else k=-1}while(0);if((z=0|i[45])>>>0>=k>>>0)return $=z-k|0,re=0|i[48],$>>>0>15?(ae=re+k|0,i[48]=ae,i[45]=$,i[ae+4>>2]=1|$,i[ae+$>>2]=$,i[re+4>>2]=3|k):(i[45]=0,i[48]=0,i[re+4>>2]=3|z,i[($=re+z+4|0)>>2]=1|i[$>>2]),0|(re+8|0);if((re=0|i[46])>>>0>k>>>0)return $=re-k|0,i[46]=$,z=(re=0|i[49])+k|0,i[49]=z,i[z+4>>2]=1|$,i[re+4>>2]=3|k,0|(re+8|0);do{if(!(0|i[161])){if(!((re=0|C(30))+-1&re)){i[163]=re,i[162]=re,i[164]=-1,i[165]=-1,i[166]=0,i[154]=0,i[161]=-16&(0|m(0))^1431655768;break}h()}}while(0);if(re=k+48|0,($=(ae=($=0|i[163])+(z=k+47|0)|0)&(ie=0-$|0))>>>0<=k>>>0)return 0|0;if(0!=(0|(ne=0|i[153]))&&(ee=(te=0|i[151])+$|0)>>>0<=te>>>0|ee>>>0>ne>>>0)return 0|0;e:do{if(4&i[154])F=190;else{ne=0|i[49];t:do{if(ne){for(ee=620;;){if((te=0|i[ee>>2])>>>0<=ne>>>0&&(te+(0|i[(q=ee+4|0)>>2])|0)>>>0>ne>>>0){oe=ee,se=q;break}if(!(ee=0|i[ee+8>>2])){F=173;break t}}if((ee=ae-(0|i[46])&ie)>>>0<2147483647)if((0|(q=0|g(0|ee)))==((0|i[oe>>2])+(0|i[se>>2])|0)){if(-1!=(0|q)){le=q,ce=ee,F=193;break e}}else ue=q,de=ee,F=183}else F=173}while(0);do{if(173==(0|F)&&-1!=(0|(ne=0|g(0)))&&(a=ne,pe=(q=(ee=0|i[162])+-1|0)&a?$-a+(q+a&0-ee)|0:$,a=(ee=0|i[151])+pe|0,pe>>>0>k>>>0&pe>>>0<2147483647)){if(0!=(0|(q=0|i[153]))&&a>>>0<=ee>>>0|a>>>0>q>>>0)break;if((0|(q=0|g(0|pe)))==(0|ne)){le=ne,ce=pe,F=193;break e}ue=q,de=pe,F=183}}while(0);t:do{if(183==(0|F)){q=0-de|0;do{if(re>>>0>de>>>0&de>>>0<2147483647&-1!=(0|ue)&&(a=z-de+(ne=0|i[163])&0-ne)>>>0<2147483647){if(-1==(0|g(0|a))){g(0|q);break t}fe=a+de|0;break}fe=de}while(0);if(-1!=(0|ue)){le=ue,ce=fe,F=193;break e}}}while(0);i[154]=4|i[154],F=190}}while(0);if(190==(0|F)&&$>>>0<2147483647&&(fe=0|g(0|$))>>>0<($=0|g(0))>>>0&-1!=(0|fe)&-1!=(0|$)&&(ue=$-fe|0)>>>0>(k+40|0)>>>0&&(le=fe,ce=ue,F=193),193==(0|F)){ue=(0|i[151])+ce|0,i[151]=ue,ue>>>0>(0|i[152])>>>0&&(i[152]=ue),ue=0|i[49];do{if(ue){fe=620;do{if((0|le)==(($=0|i[fe>>2])+(z=0|i[(de=fe+4|0)>>2])|0)){_e=$,he=de,ge=z,me=fe,F=203;break}fe=0|i[fe+8>>2]}while(0!=(0|fe));if(203==(0|F)&&0==(8&i[me+12>>2]|0)&&ue>>>0<le>>>0&ue>>>0>=_e>>>0){i[he>>2]=ge+ce,fe=ue+(z=0==(7&(fe=ue+8|0)|0)?0:0-fe&7)|0,de=ce-z+(0|i[46])|0,i[49]=fe,i[46]=de,i[fe+4>>2]=1|de,i[fe+de+4>>2]=40,i[50]=i[165];break}for(le>>>0<(de=0|i[47])>>>0?(i[47]=le,ye=le):ye=de,de=le+ce|0,fe=620;;){if((0|i[fe>>2])==(0|de)){Se=fe,Ee=fe,F=211;break}if(!(fe=0|i[fe+8>>2])){ve=620;break}}if(211==(0|F)){if(!(8&i[Ee+12>>2])){i[Se>>2]=le,i[(fe=Ee+4|0)>>2]=(0|i[fe>>2])+ce,z=le+(0==(7&(fe=le+8|0)|0)?0:0-fe&7)|0,$=de+(0==(7&(fe=de+8|0)|0)?0:0-fe&7)|0,fe=z+k|0,re=$-z-k|0,i[z+4>>2]=3|k;do{if((0|$)!=(0|ue)){if((0|$)==(0|i[48])){pe=(0|i[45])+re|0,i[45]=pe,i[48]=fe,i[fe+4>>2]=1|pe,i[fe+pe>>2]=pe;break}if(1==(3&(pe=0|i[$+4>>2])|0)){se=-8&pe,oe=pe>>>3;e:do{if(pe>>>0>=256){ie=0|i[$+24>>2],ae=0|i[$+12>>2];do{if((0|ae)==(0|$)){if(ne=0|i[(a=(q=$+16|0)+4|0)>>2])Ce=ne,Ae=a;else{if(!(ee=0|i[q>>2])){Te=0;break}Ce=ee,Ae=q}for(;;)if(ne=0|i[(a=Ce+20|0)>>2])Ce=ne,Ae=a;else{if(!(ne=0|i[(a=Ce+16|0)>>2])){be=Ce,Pe=Ae;break}Ce=ne,Ae=a}if(!(Pe>>>0<ye>>>0)){i[Pe>>2]=0,Te=be;break}h()}else{if((a=0|i[$+8>>2])>>>0<ye>>>0&&h(),(0|i[(ne=a+12|0)>>2])!=(0|$)&&h(),(0|i[(q=ae+8|0)>>2])==(0|$)){i[ne>>2]=ae,i[q>>2]=a,Te=ae;break}h()}}while(0);if(!ie)break;a=476+((ae=0|i[$+28>>2])<<2)|0;do{if((0|$)==(0|i[a>>2])){if(i[a>>2]=Te,Te)break;i[44]=i[44]&~(1<<ae);break e}if(ie>>>0<(0|i[47])>>>0&&h(),(0|i[(q=ie+16|0)>>2])==(0|$)?i[q>>2]=Te:i[ie+20>>2]=Te,!Te)break e}while(0);Te>>>0<(ae=0|i[47])>>>0&&h(),i[Te+24>>2]=ie,q=0|i[(a=$+16|0)>>2];do{if(q){if(!(q>>>0<ae>>>0)){i[Te+16>>2]=q,i[q+24>>2]=Te;break}h()}}while(0);if(!(q=0|i[a+4>>2]))break;if(!(q>>>0<(0|i[47])>>>0)){i[Te+20>>2]=q,i[q+24>>2]=Te;break}h()}else{q=0|i[$+8>>2],ae=0|i[$+12>>2],ie=212+(oe<<1<<2)|0;do{if((0|q)!=(0|ie)){if(q>>>0<ye>>>0&&h(),(0|i[q+12>>2])==(0|$))break;h()}}while(0);if((0|ae)==(0|q)){i[43]=i[43]&~(1<<oe);break}do{if((0|ae)==(0|ie))Oe=ae+8|0;else{if(ae>>>0<ye>>>0&&h(),(0|i[(a=ae+8|0)>>2])==(0|$)){Oe=a;break}h()}}while(0);i[q+12>>2]=ae,i[Oe>>2]=q}}while(0);Me=$+se|0,Ie=se+re|0}else Me=$,Ie=re;if(i[(oe=Me+4|0)>>2]=-2&i[oe>>2],i[fe+4>>2]=1|Ie,i[fe+Ie>>2]=Ie,oe=Ie>>>3,Ie>>>0<256){pe=212+(oe<<1<<2)|0,ie=0|i[43],a=1<<oe;do{if(ie&a){if((ne=0|i[(oe=pe+8|0)>>2])>>>0>=(0|i[47])>>>0){we=oe,Re=ne;break}h()}else i[43]=ie|a,we=pe+8|0,Re=pe}while(0);i[we>>2]=fe,i[Re+12>>2]=fe,i[fe+8>>2]=Re,i[fe+12>>2]=pe;break}a=Ie>>>8;do{if(a){if(Ie>>>0>16777215){Ne=31;break}Ne=Ie>>>((ee=14-((ne=((se=a<<(ie=(a+1048320|0)>>>16&8))+520192|0)>>>16&4)|ie|(se=((oe=se<<ne)+245760|0)>>>16&2))+(oe<<se>>>15)|0)+7|0)&1|ee<<1}else Ne=0}while(0);if(a=476+(Ne<<2)|0,i[fe+28>>2]=Ne,i[(pe=fe+16|0)+4>>2]=0,i[pe>>2]=0,!((pe=0|i[44])&(ee=1<<Ne))){i[44]=pe|ee,i[a>>2]=fe,i[fe+24>>2]=a,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}for(ee=Ie<<(31==(0|Ne)?0:25-(Ne>>>1)|0),pe=0|i[a>>2];;){if((-8&i[pe+4>>2]|0)==(0|Ie)){Le=pe,F=281;break}if(!(se=0|i[(a=pe+16+(ee>>>31<<2)|0)>>2])){De=a,ke=pe,F=278;break}ee<<=1,pe=se}if(278==(0|F)){if(!(De>>>0<(0|i[47])>>>0)){i[De>>2]=fe,i[fe+24>>2]=ke,i[fe+12>>2]=fe,i[fe+8>>2]=fe;break}h()}else if(281==(0|F)){if((ee=0|i[(pe=Le+8|0)>>2])>>>0>=(se=0|i[47])>>>0&Le>>>0>=se>>>0){i[ee+12>>2]=fe,i[pe>>2]=fe,i[fe+8>>2]=ee,i[fe+12>>2]=Le,i[fe+24>>2]=0;break}h()}}else ee=(0|i[46])+re|0,i[46]=ee,i[49]=fe,i[fe+4>>2]=1|ee}while(0);return 0|(z+8|0)}ve=620}for(;;){if((fe=0|i[ve>>2])>>>0<=ue>>>0&&(re=fe+(0|i[ve+4>>2])|0)>>>0>ue>>>0){Ue=re;break}ve=0|i[ve+8>>2]}fe=(z=(fe=(z=Ue+-47|0)+(0==(7&(re=z+8|0)|0)?0:0-re&7)|0)>>>0<(re=ue+16|0)>>>0?ue:fe)+8|0,$=le+(de=0==(7&($=le+8|0)|0)?0:0-$&7)|0,ee=ce+-40-de|0,i[49]=$,i[46]=ee,i[$+4>>2]=1|ee,i[$+ee+4>>2]=40,i[50]=i[165],i[(ee=z+4|0)>>2]=27,i[fe>>2]=i[155],i[fe+4>>2]=i[156],i[fe+8>>2]=i[157],i[fe+12>>2]=i[158],i[155]=le,i[156]=ce,i[158]=0,i[157]=fe,fe=z+24|0;do{i[(fe=fe+4|0)>>2]=7}while((fe+4|0)>>>0<Ue>>>0);if((0|z)!=(0|ue)){if(fe=z-ue|0,i[ee>>2]=-2&i[ee>>2],i[ue+4>>2]=1|fe,i[z>>2]=fe,$=fe>>>3,fe>>>0<256){de=212+($<<1<<2)|0,(pe=0|i[43])&(se=1<<$)?(a=0|i[($=de+8|0)>>2])>>>0<(0|i[47])>>>0?h():(Ge=$,xe=a):(i[43]=pe|se,Ge=de+8|0,xe=de),i[Ge>>2]=ue,i[xe+12>>2]=ue,i[ue+8>>2]=xe,i[ue+12>>2]=de;break}if(Be=(de=fe>>>8)?fe>>>0>16777215?31:fe>>>(($=14-((de=((pe=de<<(se=(de+1048320|0)>>>16&8))+520192|0)>>>16&4)|se|(pe=((a=pe<<de)+245760|0)>>>16&2))+(a<<pe>>>15)|0)+7|0)&1|$<<1:0,$=476+(Be<<2)|0,i[ue+28>>2]=Be,i[ue+20>>2]=0,i[re>>2]=0,!((pe=0|i[44])&(a=1<<Be))){i[44]=pe|a,i[$>>2]=ue,i[ue+24>>2]=$,i[ue+12>>2]=ue,i[ue+8>>2]=ue;break}for(a=fe<<(31==(0|Be)?0:25-(Be>>>1)|0),pe=0|i[$>>2];;){if((-8&i[pe+4>>2]|0)==(0|fe)){Fe=pe,F=307;break}if(!(se=0|i[($=pe+16+(a>>>31<<2)|0)>>2])){je=$,Ye=pe,F=304;break}a<<=1,pe=se}if(304==(0|F)){if(!(je>>>0<(0|i[47])>>>0)){i[je>>2]=ue,i[ue+24>>2]=Ye,i[ue+12>>2]=ue,i[ue+8>>2]=ue;break}h()}else if(307==(0|F)){if((a=0|i[(pe=Fe+8|0)>>2])>>>0>=(fe=0|i[47])>>>0&Fe>>>0>=fe>>>0){i[a+12>>2]=ue,i[pe>>2]=ue,i[ue+8>>2]=a,i[ue+12>>2]=Fe,i[ue+24>>2]=0;break}h()}}}else{0==(0|(a=0|i[47]))|le>>>0<a>>>0&&(i[47]=le),i[155]=le,i[156]=ce,i[158]=0,i[52]=i[161],i[51]=-1,a=0;do{i[(pe=212+(a<<1<<2)|0)+12>>2]=pe,i[pe+8>>2]=pe,a=a+1|0}while(32!=(0|a));a=le+(pe=0==(7&(a=le+8|0)|0)?0:0-a&7)|0,fe=ce+-40-pe|0,i[49]=a,i[46]=fe,i[a+4>>2]=1|fe,i[a+fe+4>>2]=40,i[50]=i[165]}}while(0);if((ce=0|i[46])>>>0>k>>>0)return le=ce-k|0,i[46]=le,ue=(ce=0|i[49])+k|0,i[49]=ue,i[ue+4>>2]=1|le,i[ce+4>>2]=3|k,0|(ce+8|0)}return i[(0|M())>>2]=12,0|0},_memcpy:function(e,t,n){var a;if(e|=0,t|=0,(0|(n|=0))>=4096)return 0|y(0|e,0|t,0|n);if(a=0|e,(3&e)==(3&t)){for(;3&e;){if(!n)return 0|a;r[e>>0]=0|r[t>>0],e=e+1|0,t=t+1|0,n=n-1|0}for(;(0|n)>=4;)i[e>>2]=i[t>>2],e=e+4|0,t=t+4|0,n=n-4|0}for(;(0|n)>0;)r[e>>0]=0|r[t>>0],e=e+1|0,t=t+1|0,n=n-1|0;return 0|a},_bitshift64Lshr:x,_fflush:function e(t){t|=0;var n=0,r=0,a=0,o=0,s=0,l=0,c=0;do{if(t){if((0|i[t+76>>2])<=-1){n=0|L(t);break}r=0==(0|w()),a=0|L(t),r||R(),n=a}else{if(o=0|i[13]?0|e(0|i[13]):0,p(36),a=0|i[8])for(r=a,a=o;;){if(l=(0|i[r+76>>2])>-1?0|w():0,c=(0|i[r+20>>2])>>>0>(0|i[r+28>>2])>>>0?0|L(r)|a:a,l&&R(),!(r=0|i[r+56>>2])){s=c;break}a=c}else s=o;E(36),n=s}}while(0);return 0|n},___errno_location:M,_bitshift64Shl:B,runPostSets:function(){},stackAlloc:function(e){var t;return t=o,o=(o=o+(e|=0)|0)+15&-16,0|t},stackSave:function(){return 0|o},stackRestore:function(e){o=e|=0},establishStackSpace:function(e,t){o=e|=0,t|=0},setThrew:function(e,t){e|=0,t|=0,s||(s=e,t)},setTempRet0:function(e){l=e|=0},getTempRet0:function(){return 0|l},dynCall_ii:function(e,t){return t|=0,0|j[1&(e|=0)](0|t)},dynCall_iiii:function(e,t,n,r){return t|=0,n|=0,r|=0,0|Y[3&(e|=0)](0|t,0|n,0|r)},dynCall_vi:function(e,t){t|=0,K[1&(e|=0)](0|t)}}}(e.Na,e.Oa,buffer);e._curve25519_donna=Z._curve25519_donna;var Da=e._free=Z._free;e.runPostSets=Z.runPostSets;var cb=e._i64Add=Z._i64Add,ab=e._bitshift64Ashr=Z._bitshift64Ashr,bb=e._i64Subtract=Z._i64Subtract,db=e._memset=Z._memset,ua=e._malloc=Z._malloc,gc=e._memcpy=Z._memcpy,fb=e._bitshift64Lshr=Z._bitshift64Lshr;e._fflush=Z._fflush,e.___errno_location=Z.___errno_location;var gb=e._bitshift64Shl=Z._bitshift64Shl;function xc(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}e.dynCall_ii=Z.dynCall_ii,e.dynCall_iiii=Z.dynCall_iiii,e.dynCall_vi=Z.dynCall_vi,n.W=Z.stackAlloc,n.na=Z.stackSave,n.X=Z.stackRestore,n.md=Z.establishStackSpace,n.cb=Z.setTempRet0,n.Ua=Z.getTempRet0,xc.prototype=Error(),xc.prototype.constructor=xc;var Yc=null,Xa=function t(){e.calledRun||$c(),e.calledRun||(Xa=t)};function $c(t){function n(){if(!e.calledRun&&(e.calledRun=!0,!A)){if(xa||(xa=!0,Oa(Qa)),Oa(Ra),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e._main&&bd&&e.callMain(t),e.postRun)for("function"==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)Ua(e.postRun.shift());Oa(Sa)}}if(t=t||e.arguments,null===Yc&&(Yc=Date.now()),!(0<L)){if(e.preRun)for("function"==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)Ta(e.preRun.shift());Oa(Pa),0<L||e.calledRun||(e.setStatus?(e.setStatus("Running..."),setTimeout((function(){setTimeout((function(){e.setStatus("")}),1),n()}),1)):n())}}function ad(t,n){if(!n||!e.noExitRuntime)throw!e.noExitRuntime&&(A=!0,m=void 0,Oa(K),e.onExit)&&e.onExit(t),new xc(t)}e.callMain=e.jd=function(t){function n(){for(var e=0;3>e;e++)i.push(0)}assert(0==L,"cannot call main when async dependencies remain! (listen on __ATMAIN__)"),assert(0==Pa.length,"cannot call main when preRun functions remain to be called"),t=t||[],xa||(xa=!0,Oa(Qa));var r=t.length+1,i=[G(Va(e.thisProgram),"i8",0)];n();for(var a=0;a<r-1;a+=1)i.push(G(Va(t[a]),"i8",0)),n();i.push(0),i=G(i,"i32",0);try{ad(e._main(r,i,0),!0)}catch(t){if(!(t instanceof xc)){if("SimulateInfiniteLoop"!=t)throw t&&"object"==typeof t&&t.stack&&e.S("exception thrown: "+[t,t.stack]),t;e.noExitRuntime=!0}}},e.run=e.run=$c,e.exit=e.exit=ad;var cd=[];function z(t){void 0!==t?(e.print(t),e.S(t),t=JSON.stringify(t)):t="",A=!0;var n="abort("+t+") at "+Ea()+"\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.";throw cd&&cd.forEach((function(e){n=e(n,t)})),n}if(e.abort=e.abort=z,e.preInit)for("function"==typeof e.preInit&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();var bd=!0;e.noInitialRun&&(bd=!1),$c(),module.exports=e},694114:()=>{
/*! modernizr 3.11.8 (Custom Build) | MIT *
 * https://modernizr.com/download/?-adownload-cssanimations-csstransitions-exiforientation-serviceworker-webp-domprefixes-hasevent-prefixed-prefixes-setclasses-testallprops-testprop !*/
!function(e,t,n,r){function i(e,t){return typeof e===t}function a(e){var t=v.className,n=S._config.classPrefix||"";if(T&&(t=t.baseVal),S._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}S._config.enableClasses&&(e.length>0&&(t+=" "+n+e.join(" "+n)),T?v.className.baseVal=t:v.className=t)}function o(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):T?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}function s(e,t){return!!~(""+e).indexOf(t)}function l(e,t,r,i){var a,s,l,c,u="modernizr",d=o("div"),p=function(){var e=n.body;return e||((e=o(T?"svg":"body")).fake=!0),e}();if(parseInt(r,10))for(;r--;)(l=o("div")).id=i?i[r]:u+(r+1),d.appendChild(l);return(a=o("style")).type="text/css",a.id="s"+u,(p.fake?p:d).appendChild(a),p.appendChild(d),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(n.createTextNode(e)),d.id=u,p.fake&&(p.style.background="",p.style.overflow="hidden",c=v.style.overflow,v.style.overflow="hidden",v.appendChild(p)),s=t(d,e),p.fake&&p.parentNode?(p.parentNode.removeChild(p),v.style.overflow=c,v.offsetHeight):d.parentNode.removeChild(d),!!s}function c(e){return e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()})).replace(/^ms-/,"-ms-")}function u(e,n){var i=e.length;if("CSS"in t&&"supports"in t.CSS){for(;i--;)if(t.CSS.supports(c(e[i]),n))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];i--;)a.push("("+c(e[i])+":"+n+")");return l("@supports ("+(a=a.join(" or "))+") { #modernizr { position: absolute; } }",(function(e){return"absolute"===function(e,n,r){var i;if("getComputedStyle"in t){i=getComputedStyle.call(t,e,n);var a=t.console;null!==i?r&&(i=i.getPropertyValue(r)):a&&a[a.error?"error":"log"].call(a,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}else i=!n&&e.currentStyle&&e.currentStyle[r];return i}(e,null,"position")}))}return r}function d(e){return e.replace(/([a-z])-([a-z])/g,(function(e,t,n){return t+n.toUpperCase()})).replace(/^-/,"")}function p(e,t,n,a){function l(){p&&(delete I.style,delete I.modElem)}if(a=!i(a,"undefined")&&a,!i(n,"undefined")){var c=u(e,n);if(!i(c,"undefined"))return c}for(var p,f,_,h,g,m=["modernizr","tspan","samp"];!I.style&&m.length;)p=!0,I.modElem=o(m.shift()),I.style=I.modElem.style;for(_=e.length,f=0;f<_;f++)if(h=e[f],g=I.style[h],s(h,"-")&&(h=d(h)),I.style[h]!==r){if(a||i(n,"undefined"))return l(),"pfx"!==t||h;try{I.style[h]=n}catch(e){}if(I.style[h]!==g)return l(),"pfx"!==t||h}return l(),!1}function f(e,t){return function(){return e.apply(t,arguments)}}function _(e,t,n,r,a){var o=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+O.join(o+" ")+o).split(" ");return i(t,"string")||i(t,"undefined")?p(s,t,r,a):function(e,t,n){var r;for(var a in e)if(e[a]in t)return!1===n?e[a]:i(r=t[e[a]],"function")?f(r,n||t):r;return!1}(s=(e+" "+A.join(o+" ")+o).split(" "),t,n)}function h(e,t,n){return _(e,r,r,t,n)}function g(e,t){if("object"==typeof e)for(var n in e)w(e,n)&&g(n,e[n]);else{var r=(e=e.toLowerCase()).split("."),i=S[r[0]];if(2===r.length&&(i=i[r[1]]),void 0!==i)return S;t="function"==typeof t?t():t,1===r.length?S[r[0]]=t:(!S[r[0]]||S[r[0]]instanceof Boolean||(S[r[0]]=new Boolean(S[r[0]])),S[r[0]][r[1]]=t),a([(t&&!1!==t?"":"no-")+r.join("-")]),S._trigger(e,t)}return S}var m=[],y={_version:"3.11.8",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout((function(){t(n[e])}),0)},addTest:function(e,t,n){m.push({name:e,fn:t,options:n})},addAsyncTest:function(e){m.push({name:null,fn:e})}},S=function(){};S.prototype=y,S=new S;var E=[],v=n.documentElement,T="svg"===v.nodeName.toLowerCase(),C="Moz O ms Webkit",A=y._config.usePrefixes?C.toLowerCase().split(" "):[];y._domPrefixes=A;var b=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];y._prefixes=b;var P=function(){var e=!("onblur"in v);return function(t,n){var i;return!!t&&(n&&"string"!=typeof n||(n=o(n||"div")),!(i=(t="on"+t)in n)&&e&&(n.setAttribute||(n=o("div")),n.setAttribute(t,""),i="function"==typeof n[t],n[t]!==r&&(n[t]=r),n.removeAttribute(t)),i)}}();y.hasEvent=P;var O=y._config.usePrefixes?C.split(" "):[];y._cssomPrefixes=O;var M={elem:o("modernizr")};S._q.push((function(){delete M.elem}));var I={style:M.elem.style};S._q.unshift((function(){delete I.style})),y.testAllProps=_;var w,R=function(e){var n,i=b.length,a=t.CSSRule;if(void 0===a)return r;if(!e)return!1;if((n=(e=e.replace(/^@/,"")).replace(/-/g,"_").toUpperCase()+"_RULE")in a)return"@"+e;for(var o=0;o<i;o++){var s=b[o];if(s.toUpperCase()+"_"+n in a)return"@-"+s.toLowerCase()+"-"+e}return!1};y.atRule=R,y.prefixed=function(e,t,n){return 0===e.indexOf("@")?R(e):(-1!==e.indexOf("-")&&(e=d(e)),t?_(e,t,n):_(e,"pfx"))},y.testAllProps=h,y.testProp=function(e,t,n){return p([e],r,t,n)},function(){var e={}.hasOwnProperty;w=i(e,"undefined")||i(e.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(t,n){return e.call(t,n)}}(),y._l={},y.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),S.hasOwnProperty(e)&&setTimeout((function(){S._trigger(e,S[e])}),0)},y._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout((function(){var e;for(e=0;e<n.length;e++)(0,n[e])(t)}),0),delete this._l[e]}},S._q.push((function(){y.addTest=g})),S.addAsyncTest((function(){function e(e,t,n){function r(t){var r=!(!t||"load"!==t.type)&&1===i.width;g(e,"webp"===e&&r?new Boolean(r):r),n&&n(t)}var i=new Image;i.onerror=r,i.onload=r,i.src=t}var t=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],n=t.shift();e(n.name,n.uri,(function(n){if(n&&"load"===n.type)for(var r=0;r<t.length;r++)e(t[r].name,t[r].uri)}))})),S.addTest("serviceworker","serviceWorker"in navigator),S.addAsyncTest((function(){var e=new Image;e.onerror=function(){g("exiforientation",!1)},e.onload=function(){g("exiforientation",2!==e.width)},e.src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAiRXhpZgAASUkqAAgAAAABABIBAwABAAAABgASAAAAAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAABAAIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+/iiiigD/2Q=="})),S.addTest("adownload",!t.externalHost&&"download"in o("a")),S.addTest("cssanimations",h("animationName","a",!0)),S.addTest("csstransitions",h("transition","all",!0)),function(){var e,t,n,r,a,o;for(var s in m)if(m.hasOwnProperty(s)){if(e=[],(t=m[s]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(r=i(t.fn,"function")?t.fn():t.fn,a=0;a<e.length;a++)1===(o=e[a].split(".")).length?S[o[0]]=r:(S[o[0]]&&(!S[o[0]]||S[o[0]]instanceof Boolean)||(S[o[0]]=new Boolean(S[o[0]])),S[o[0]][o[1]]=r),E.push((r?"":"no-")+o.join("-"))}}(),a(E),delete y.addTest,delete y.addAsyncTest;for(var N=0;N<S._q.length;N++)S._q[N]();e.Modernizr=S}(window,window,document)},637360:e=>{var t;!function(){function e(e){if(this.mode=r.MODE_8BIT_BYTE,this.data=e,this.parsedData=[],e instanceof ArrayBuffer)this.parsedData=new Int8Array(e);else{for(var t=0,n=this.data.length;t<n;t++){var i=[],a=this.data.charCodeAt(t);a>65536?(i[0]=240|(1835008&a)>>>18,i[1]=128|(258048&a)>>>12,i[2]=128|(4032&a)>>>6,i[3]=128|63&a):a>2048?(i[0]=224|(61440&a)>>>12,i[1]=128|(4032&a)>>>6,i[2]=128|63&a):a>128?(i[0]=192|(1984&a)>>>6,i[1]=128|63&a):i[0]=a,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}}function n(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}},n.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=n.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t){for(var n=-1;n<=7;n++)if(!(e+n<=-1||this.moduleCount<=e+n))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[e+n][t+r]=0<=n&&n<=6&&(0==r||6==r)||0<=r&&r<=6&&(0==n||6==n)||2<=n&&n<=4&&2<=r&&r<=4)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=f.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n);this.make();for(var i=0;i<this.modules.length;i++)for(var a=1*i,o=0;o<this.modules[i].length;o++){var s=1*o;this.modules[i][o]&&(r.beginFill(0,100),r.moveTo(s,a),r.lineTo(s+1,a),r.lineTo(s+1,a+1),r.lineTo(s,a+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupPositionAdjustPattern:function(){for(var e=f.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(null==this.modules[r][i])for(var a=-2;a<=2;a++)for(var o=-2;o<=2;o++)this.modules[r+a][i+o]=-2==a||2==a||-2==o||2==o||0==a&&0==o}},setupTypeNumber:function(e){for(var t=f.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(n=0;n<18;n++){r=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,r=f.getBCHTypeInfo(n),i=0;i<15;i++){var a=!e&&1==(r>>i&1);i<6?this.modules[i][8]=a:i<8?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(i=0;i<15;i++){a=!e&&1==(r>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=a:i<9?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,i=7,a=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var s=0;s<2;s++)if(null==this.modules[r][o-s]){var l=!1;a<e.length&&(l=1==(e[a]>>>i&1)),f.getMask(t,r,o-s)&&(l=!l),this.modules[r][o-s]=l,-1==--i&&(a++,i=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},n.PAD0=236,n.PAD1=17,n.createData=function(e,t,r){for(var i=m.getRSBlocks(e,t),a=new y,o=0;o<r.length;o++){var s=r[o];a.put(s.mode,4),a.put(s.getLength(),f.getLengthInBits(s.mode,e)),s.write(a)}var l=0;for(o=0;o<i.length;o++)l+=i[o].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");for(a.getLengthInBits()+4<=8*l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*l||(a.put(n.PAD0,8),a.getLengthInBits()>=8*l));)a.put(n.PAD1,8);return n.createBytes(a,i)},n.createBytes=function(e,t){for(var n=0,r=0,i=0,a=new Array(t.length),o=new Array(t.length),s=0;s<t.length;s++){var l=t[s].dataCount,c=t[s].totalCount-l;r=Math.max(r,l),i=Math.max(i,c),a[s]=new Array(l);for(var u=0;u<a[s].length;u++)a[s][u]=255&e.buffer[u+n];n+=l;var d=f.getErrorCorrectPolynomial(c),p=new g(a[s],d.getLength()-1).mod(d);o[s]=new Array(d.getLength()-1);for(u=0;u<o[s].length;u++){var _=u+p.getLength()-o[s].length;o[s][u]=_>=0?p.get(_):0}}var h=0;for(u=0;u<t.length;u++)h+=t[u].totalCount;var m=new Array(h),y=0;for(u=0;u<r;u++)for(s=0;s<t.length;s++)u<a[s].length&&(m[y++]=a[s][u]);for(u=0;u<i;u++)for(s=0;s<t.length;s++)u<o[s].length&&(m[y++]=o[s][u]);return m};for(var r={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},i={L:1,M:0,Q:3,H:2},a=0,o=1,s=2,l=3,c=4,u=5,d=6,p=7,f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;f.getBCHDigit(t)-f.getBCHDigit(f.G15)>=0;)t^=f.G15<<f.getBCHDigit(t)-f.getBCHDigit(f.G15);return(e<<10|t)^f.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;f.getBCHDigit(t)-f.getBCHDigit(f.G18)>=0;)t^=f.G18<<f.getBCHDigit(t)-f.getBCHDigit(f.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return f.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case a:return(t+n)%2==0;case o:return t%2==0;case s:return n%3==0;case l:return(t+n)%3==0;case c:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case u:return t*n%2+t*n%3==0;case d:return(t*n%2+t*n%3)%2==0;case p:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new g([1],0),n=0;n<e;n++)t=t.multiply(new g([1,_.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case r.MODE_NUMBER:return 10;case r.MODE_ALPHA_NUM:return 9;case r.MODE_8BIT_BYTE:case r.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case r.MODE_NUMBER:return 12;case r.MODE_ALPHA_NUM:return 11;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case r.MODE_NUMBER:return 14;case r.MODE_ALPHA_NUM:return 13;case r.MODE_8BIT_BYTE:return 16;case r.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;r<t;r++)for(var i=0;i<t;i++){for(var a=0,o=e.isDark(r,i),s=-1;s<=1;s++)if(!(r+s<0||t<=r+s))for(var l=-1;l<=1;l++)i+l<0||t<=i+l||0==s&&0==l||o==e.isDark(r+s,i+l)&&a++;a>5&&(n+=3+a-5)}for(r=0;r<t-1;r++)for(i=0;i<t-1;i++){var c=0;e.isDark(r,i)&&c++,e.isDark(r+1,i)&&c++,e.isDark(r,i+1)&&c++,e.isDark(r+1,i+1)&&c++,0!=c&&4!=c||(n+=3)}for(r=0;r<t;r++)for(i=0;i<t-6;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(i=0;i<t;i++)for(r=0;r<t-6;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);var u=0;for(i=0;i<t;i++)for(r=0;r<t;r++)e.isDark(r,i)&&u++;return n+=10*(Math.abs(100*u/t/t-50)/5)}},_={glog:function(e){if(e<1)throw new Error("glog("+e+")");return _.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return _.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},h=0;h<8;h++)_.EXP_TABLE[h]=1<<h;for(h=8;h<256;h++)_.EXP_TABLE[h]=_.EXP_TABLE[h-4]^_.EXP_TABLE[h-5]^_.EXP_TABLE[h-6]^_.EXP_TABLE[h-8];for(h=0;h<255;h++)_.LOG_TABLE[_.EXP_TABLE[h]]=h;function g(e,t){if(null==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function m(e,t){this.totalCount=e,this.dataCount=t}function y(){this.buffer=[],this.length=0}g.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<e.getLength();r++)t[n+r]^=_.gexp(_.glog(this.get(n))+_.glog(e.get(r)));return new g(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=_.glog(this.get(0))-_.glog(e.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<e.getLength();r++)n[r]^=_.gexp(_.glog(e.get(r))+t);return new g(n,0).mod(e)}},m.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],m.getRSBlocks=function(e,t){var n=m.getRsBlockTable(e,t);if(null==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var r=n.length/3,i=[],a=0;a<r;a++)for(var o=n[3*a+0],s=n[3*a+1],l=n[3*a+2],c=0;c<o;c++)i.push(new m(s,l));return i},m.getRsBlockTable=function(e,t){switch(t){case i.L:return m.RS_BLOCK_TABLE[4*(e-1)+0];case i.M:return m.RS_BLOCK_TABLE[4*(e-1)+1];case i.Q:return m.RS_BLOCK_TABLE[4*(e-1)+2];case i.H:return m.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},y.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var S=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],E=function(e,t){this._bIsPainted=!1,this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,this._elCanvas.setAttribute("aria-label","Scan me!"),this._elCanvas.setAttribute("role","img"),e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};function v(e,t){for(var n=1,r=e instanceof ArrayBuffer?e.byteLength:function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e.length?3:0)}(e),a=0,o=S.length;a<=o;a++){var s=0;switch(t){case i.L:s=S[a][0];break;case i.M:s=S[a][1];break;case i.Q:s=S[a][2];break;case i.H:s=S[a][3]}if(r<=s)break;n++}if(n>S.length)throw new Error("Too long data");return n}E.prototype.draw=function(e){var t=this._oContext,n=this._htOption,r=e.getModuleCount(),i=n.width/r,a=n.height/r,o=Math.round(i),s=Math.round(a);this.clear();for(var l=0;l<r;l++)for(var c=0;c<r;c++){var u=e.isDark(l,c),d=c*i,p=l*a;t.strokeStyle=u?n.colorDark:n.colorLight,t.lineWidth=1,t.fillStyle=u?n.colorDark:n.colorLight,t.fillRect(d,p,i,a),t.strokeRect(Math.floor(d)+.5,Math.floor(p)+.5,o,s),t.strokeRect(Math.ceil(d)-.5,Math.ceil(p)-.5,o,s)}this._bIsPainted=!0},E.prototype.isPainted=function(){return this._bIsPainted},E.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},E.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},(t=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:i.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._el=e,this._oQRCode=null,this._oDrawing=new E(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new n(v(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode)},t.prototype.clear=function(){this._oDrawing.clear()},t.CorrectLevel=i}(),e.exports=t},6906:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.styleSheet=t.StyleXSheet=void 0;var r,i=(r=n(441143))&&r.__esModule?r:{default:r};function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o="__fb-light-mode",s="__fb-dark-mode";function l(e,t){const n=[];n.push("".concat(e," {"));for(const e in t){const r=t[e];n.push("  --".concat(e,": ").concat(r,";"))}return n.push("}"),n.join("\n")}const c=/var\(--(.*?)\)/g;class u{constructor(e){var t;a(this,"rootTheme",void 0),a(this,"rootDarkTheme",void 0),a(this,"supportsVariables",void 0),a(this,"rules",void 0),a(this,"injected",void 0),a(this,"tag",void 0),a(this,"ruleForPriority",void 0),this.tag=null,this.injected=!1,this.ruleForPriority=new Map,this.rules=[],this.rootTheme=e.rootTheme,this.rootDarkTheme=e.rootDarkTheme,this.supportsVariables=null!==(t=e.supportsVariables)&&void 0!==t?t:null!=n.g.CSS&&null!=n.g.CSS.supports&&n.g.CSS.supports("--fake-var:0")}getVariableMatch(){return c}isHeadless(){var e,t;return null==this.tag||null==(null===(e=n.g)||void 0===e||null===(t=e.document)||void 0===t?void 0:t.body)}getTag(){const{tag:e}=this;return(0,i.default)(null!=e,"expected tag"),e}getCSS(){return this.rules.join("\n")}getRulePosition(e){return this.rules.indexOf(e)}getRuleCount(){return this.rules.length}inject(){var e;this.injected||(this.injected=!0,null!=(null===(e=n.g.document)||void 0===e?void 0:e.body)?(this.tag=function(){const e=document.createElement("style");return e.setAttribute("type","text/css"),e.setAttribute("data-styled","true"),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}(),this.injectTheme()):this.injectTheme())}injectTheme(){null!=this.rootTheme&&this.insert(l(":root, .".concat(o),this.rootTheme),0),null!=this.rootDarkTheme&&this.insert(l(".".concat(s,":root, .").concat(s),this.rootDarkTheme),0)}__injectCustomThemeForTesting(e,t){null!=t&&this.insert(l(e,t),0)}delete(e){const t=this.rules.indexOf(e);if((0,i.default)(t>=0,"Couldn't find the index for rule %s",e),this.rules.splice(t,1),this.isHeadless())return;const n=this.getTag().sheet;(0,i.default)(n,"expected sheet"),n.deleteRule(t)}normalizeRule(e){const{rootTheme:t}=this;return this.supportsVariables||null==t?e:e.replace(c,((e,n)=>t[n]))}getInsertPositionForPriority(e){const t=this.ruleForPriority.get(e);if(null!=t)return this.rules.indexOf(t)+1;const n=Array.from(this.ruleForPriority.keys()).sort(((e,t)=>t-e)).filter((t=>t>e?1:0));if(0===n.length)return this.getRuleCount();const r=n.pop();return this.rules.indexOf(this.ruleForPriority.get(r))}insert(e,t,n){if(!1===this.injected&&this.inject(),null!=n)return this.insert(d(e,"html:not([dir='rtl'])"),t),void this.insert(d(n,"html[dir='rtl']"),t);const r=e;if(this.rules.includes(r))return;const i=this.normalizeRule(r),a=this.getInsertPositionForPriority(t);if(this.rules.splice(a,0,i),this.ruleForPriority.set(t,i),this.isHeadless())return;const o=this.getTag().sheet;if(null!=o)try{o.insertRule(i,a)}catch(e){}}}function d(e,t){if(!e.startsWith("@"))return"".concat(t," ").concat(e);const n=e.indexOf("{"),r=e.slice(0,n+1),i=e.slice(n+1);return"".concat(r).concat(t," ").concat(i)}t.StyleXSheet=u,a(u,"LIGHT_MODE_CLASS_NAME",o),a(u,"DARK_MODE_CLASS_NAME",s);const p=new u({supportsVariables:!0,rootTheme:{},rootDarkTheme:{}});t.styleSheet=p},156720:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(6906);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){for(var t=e.reverse(),n={};t.length;){var r=t.pop();if(Array.isArray(r))for(var i=r.length-1;i>=0;i--)t.push(r[i]);else{var a=r;if(null!=a&&"object"==typeof a)for(var o in a){var s=a[o];if("string"==typeof s)n[o]=s;else if("object"==typeof s){var l;n[o]=null!==(l=n[o])&&void 0!==l?l:{},Object.assign(n[o],s)}}}}return n}function l(...e){var t=s(e),n="";for(var r in t)if(Boolean(t[r]))if("string"==typeof t[r])n+=n?" "+t[r]:t[r];else if("object"==typeof t[r]){var i=t[r];for(var a in i){var o=i[a];n+=n?" "+o:o}}return n}l.compose=function(...e){return s(e)},l.create=function(e){throw new Error("stylex.create should never be called. It should be compiled away.")},l.keyframes=e=>{throw new Error("stylex.keyframes should never be called")},l.inject=(e,t,n=null)=>{r.styleSheet.insert(e,t,n)},l.dedupe=(...e)=>l(...e),l.absoluteFill={bottom:0,boxSizing:"border-box",end:0,position:"absolute",start:0,top:0},l.absoluteCenter={boxSizing:"border-box",left:"50%",position:"absolute",top:"50%",transform:"translate(-50%, -50%)"},l.blockBase={borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"block",flexGrow:1,flexShrink:1,margin:0,padding:0,position:"relative",zIndex:0},l.inlineBase=a(a({},l.blockBase),{},{display:"inline"}),l.buttonBase={appearance:"none",backgroundColor:"transparent",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",margin:0,padding:0,position:"relative",textAlign:"inherit",zIndex:0},l.flexBase={alignItems:"stretch",borderStyle:"solid",borderWidth:0,boxSizing:"border-box",display:"flex",flexDirection:"column",flexGrow:1,flexShrink:1,justifyContent:"space-between",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",zIndex:0},l.flexInlineBase=a(a({},l.flexBase),{},{display:"inline-flex"}),l.linkBase={backgroundColor:"transparent",backgroundImage:"none",boxSizing:"border-box",color:"inherit",cursor:"pointer",position:"relative",textDecoration:"none",zIndex:0},l.listBase={boxSizing:"border-box",listStyle:"none",marginBottom:0,marginTop:0,paddingStart:0},l.visuallyHidden={clip:"rect(0, 0, 0, 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",width:1};var c=l;t.default=c},329127:(e,t,n)=>{var r={"./af.json":[788789,8288],"./ar.json":[758854,8801],"./az.json":[248758,1967],"./bg.json":[60624,1234],"./bn.json":[393511,677],"./ca.json":[498922,4451],"./cs.json":[740097,3539],"./da.json":[536117,9626],"./de.json":[203313,88],"./el.json":[824689,3004],"./en.json":[790084,7494],"./es.json":[996598,4739],"./et.json":[857633,9599],"./fa.json":[341076,4853],"./fi.json":[551701,9789],"./fil.json":[146387,3565],"./fr.json":[512785,7334],"./gu.json":[450387,1244],"./he.json":[190626,2422],"./hi.json":[727605,8606],"./hr.json":[454047,3853],"./hu.json":[792922,1389],"./id.json":[975608,4132],"./it.json":[554800,5881],"./ja.json":[366189,5608],"./kk.json":[247681,4260],"./kn.json":[678930,6700],"./ko.json":[728076,7020],"./lt.json":[337885,4169],"./lv.json":[622798,7938],"./mk.json":[579265,1592],"./ml.json":[607208,4794],"./mr.json":[830163,2771],"./ms.json":[13390,9911],"./nb.json":[549057,4046],"./nl.json":[223129,7055],"./pa.json":[466384,6032],"./pl.json":[775495,9566],"./pt.json":[508897,1992],"./ro.json":[864267,8945],"./ru.json":[534813,887],"./sk.json":[575785,7163],"./sl.json":[665608,7626],"./sq.json":[455915,6098],"./sr.json":[895742,2967],"./sv.json":[281244,4768],"./sw.json":[178923,6606],"./ta.json":[217574,3721],"./te.json":[896564,4771],"./th.json":[338728,5955],"./tr.json":[938704,8962],"./uk.json":[495304,5282],"./ur.json":[727814,2619],"./uz.json":[518192,7654],"./vi.json":[822521,5315],"./zh-CN.json":[859978,4680],"./zh-HK.json":[217133,7920],"./zh-TW.json":[937439,3421]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,3)))}i.keys=()=>Object.keys(r),i.id=329127,e.exports=i},826299:(e,t,n)=>{var r={"./af":[650164,6365],"./af.js":[650164,6365],"./ar":[489511,8054],"./ar-XB":[612326,9995],"./ar-XB.js":[612326,9995],"./ar.js":[489511,8054],"./az":[204345,7072],"./az.js":[204345,7072],"./bg":[174774,7102],"./bg.js":[174774,7102],"./bn":[274342,8700],"./bn.js":[274342,8700],"./ca":[900654,5632],"./ca.js":[900654,5632],"./cs":[664654,165],"./cs.js":[664654,165],"./da":[603435,1628],"./da.js":[603435,1628],"./de":[655170,7216],"./de.js":[655170,7216],"./el":[431977,1204],"./el.js":[431977,1204],"./en":[677407,6933],"./en.js":[677407,6933],"./es":[282834,673],"./es.js":[282834,673],"./et":[965644,792],"./et.js":[965644,792],"./fa":[732949,9999],"./fa.js":[732949,9999],"./fi":[470971,9613],"./fi.js":[470971,9613],"./fil":[94399,907],"./fil.js":[94399,907],"./fr":[261945,6293],"./fr.js":[261945,6293],"./gu":[496432,6038],"./gu.js":[496432,6038],"./he":[844756,5729],"./he.js":[844756,5729],"./hi":[927135,3722],"./hi.js":[927135,3722],"./hr":[666762,5708],"./hr.js":[666762,5708],"./hu":[310728,2556],"./hu.js":[310728,2556],"./id":[418626,5128],"./id.js":[418626,5128],"./it":[347959,2830],"./it.js":[347959,2830],"./ja":[816186,5182],"./ja.js":[816186,5182],"./kk":[185821,9719],"./kk.js":[185821,9719],"./kn":[137038,155],"./kn.js":[137038,155],"./ko":[268736,820],"./ko.js":[268736,820],"./lt":[878935,1529],"./lt.js":[878935,1529],"./lv":[723480,4708],"./lv.js":[723480,4708],"./mk":[932209,6651],"./mk.js":[932209,6651],"./ml":[227102,6655],"./ml.js":[227102,6655],"./mr":[423268,1248],"./mr.js":[423268,1248],"./ms":[184545,5443],"./ms.js":[184545,5443],"./nb":[815070,7749],"./nb.js":[815070,7749],"./nl":[464606,9750],"./nl.js":[464606,9750],"./pa":[131818,9815],"./pa.js":[131818,9815],"./pl":[398120,8628],"./pl.js":[398120,8628],"./pt":[693710,6953],"./pt-BR":[770626,2091],"./pt-BR.js":[770626,2091],"./pt.js":[693710,6953],"./ro":[149526,7162],"./ro.js":[149526,7162],"./ru":[538976,8292],"./ru.js":[538976,8292],"./sk":[724928,1770],"./sk.js":[724928,1770],"./sl":[565516,4259],"./sl.js":[565516,4259],"./sq":[825177,9737],"./sq.js":[825177,9737],"./sr":[24165,6331],"./sr.js":[24165,6331],"./sv":[423012,2944],"./sv.js":[423012,2944],"./sw":[56916,3998],"./sw.js":[56916,3998],"./ta":[111227,2739],"./ta.js":[111227,2739],"./te":[724939,5650],"./te.js":[724939,5650],"./th":[234086,2135],"./th.js":[234086,2135],"./tr":[838953,248],"./tr.js":[838953,248],"./uk":[254945,906],"./uk.js":[254945,906],"./ur":[167882,4361],"./ur.js":[167882,4361],"./uz":[137754,4873],"./uz.js":[137754,4873],"./vi":[879973,8598],"./vi.js":[879973,8598],"./zh-CN":[98537,6483],"./zh-CN.js":[98537,6483],"./zh-HK":[172511,1081],"./zh-HK.js":[172511,1081],"./zh-TW":[370468,7542],"./zh-TW.js":[370468,7542]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n(i)))}i.keys=()=>Object.keys(r),i.id=826299,e.exports=i},519922:(e,t,n)=>{var r={"./af":[736249,3748],"./af.js":[736249,3748],"./ar":[896951,1473],"./ar-DZ":[31883,6884],"./ar-DZ.js":[31883,6884],"./ar-KW":[385371,6282],"./ar-KW.js":[385371,6282],"./ar-LY":[725108,5671],"./ar-LY.js":[725108,5671],"./ar-MA":[822992,2966],"./ar-MA.js":[822992,2966],"./ar-SA":[514344,9646],"./ar-SA.js":[514344,9646],"./ar-TN":[960476,9289],"./ar-TN.js":[960476,9289],"./ar-XB":[161547,3934],"./ar-XB.js":[161547,3934],"./ar.js":[896951,1473],"./az":[558317,5740],"./az.js":[558317,5740],"./bn":[979307,7728],"./bn.js":[979307,7728],"./ca":[172669,9817],"./ca.js":[172669,9817],"./cs":[604388,2023],"./cs.js":[604388,2023],"./da":[982098,7315],"./da.js":[982098,7315],"./de":[96264,5862],"./de.js":[96264,5862],"./el":[157882,1055],"./el.js":[157882,1055],"./en-AU":[482248,8678],"./en-AU.js":[482248,8678],"./en-CA":[218526,4616],"./en-CA.js":[218526,4616],"./en-GB":[487123,9227],"./en-GB.js":[487123,9227],"./en-IE":[240296,2979],"./en-IE.js":[240296,2979],"./en-NZ":[666060,3892],"./en-NZ.js":[666060,3892],"./es":[171689,1791],"./es-DO":[568592,2394],"./es-DO.js":[568592,2394],"./es.js":[171689,1791],"./et":[73429,4473],"./et.js":[73429,4473],"./fa":[306940,7662],"./fa.js":[306940,7662],"./fi":[263191,7386],"./fi.js":[263191,7386],"./fr":[281189,2445],"./fr-CA":[607908,9765],"./fr-CA.js":[607908,9765],"./fr-CH":[909925,8799],"./fr-CH.js":[909925,8799],"./fr.js":[281189,2445],"./gu":[562021,4468],"./gu.js":[562021,4468],"./he":[755897,5027],"./he.js":[755897,5027],"./hi":[55467,6709],"./hi.js":[55467,6709],"./hr":[223077,1381],"./hr.js":[223077,1381],"./hu":[885678,4339],"./hu.js":[885678,4339],"./id":[37827,6511],"./id.js":[37827,6511],"./it":[22365,5247],"./it.js":[22365,5247],"./kk":[165897,7074],"./kk.js":[165897,7074],"./kn":[223124,6568],"./kn.js":[223124,6568],"./ko":[295770,4818],"./ko.js":[295770,4818],"./lt":[66191,6920],"./lt.js":[66191,6920],"./mk":[604942,9545],"./mk.js":[604942,9545],"./ml":[228472,3113],"./ml.js":[228472,3113],"./mr":[284561,3422],"./mr.js":[284561,3422],"./ms":[795938,7739],"./ms-MY":[665012,1520],"./ms-MY.js":[665012,1520],"./ms.js":[795938,7739],"./nb":[498457,5959],"./nb.js":[498457,5959],"./nl":[668623,319],"./nl.js":[668623,319],"./pa-IN":[630837,8132],"./pa-IN.js":[630837,8132],"./pl":[940938,4980],"./pl.js":[940938,4980],"./pt":[80432,9116],"./pt-BR":[140725,6547],"./pt-BR.js":[140725,6547],"./pt.js":[80432,9116],"./ro":[146828,3569],"./ro.js":[146828,3569],"./ru":[284381,2957],"./ru.js":[284381,2957],"./sk":[331453,5965],"./sk.js":[331453,5965],"./sl":[696918,3501],"./sl.js":[696918,3501],"./sq":[546987,6496],"./sq.js":[546987,6496],"./sr":[207467,5170],"./sr-CYRL":[705879,5790],"./sr-CYRL.js":[705879,5790],"./sr.js":[207467,5170],"./sv":[338312,1069],"./sv.js":[338312,1069],"./sw":[547638,2017],"./sw.js":[547638,2017],"./ta":[750995,8634],"./ta.js":[750995,8634],"./te":[370008,3370],"./te.js":[370008,3370],"./th":[608448,951],"./th.js":[608448,951],"./tr":[247120,9313],"./tr.js":[247120,9313],"./uk":[875997,9682],"./uk.js":[875997,9682],"./ur":[98563,6163],"./ur.js":[98563,6163],"./uz":[716183,3017],"./uz-LATN":[300075,8117],"./uz-LATN.js":[300075,8117],"./uz.js":[716183,3017],"./zh-CN":[183718,3047],"./zh-CN.js":[183718,3047],"./zh-TW":[857924,5125],"./zh-TW.js":[857924,5125]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return n.e(t[1]).then((()=>n(i)))}i.keys=()=>Object.keys(r),i.id=519922,e.exports=i},47466:e=>{"use strict";e.exports=JSON.parse('{"application/":{"applixware":"aw","atom+xml":"atom","atomcat+xml":"atomcat","atomsvc+xml":"atomsvc","ccxml+xml":"ccxml","cdmi-":{"capability":"cdmia","container":"cdmic","domain":"cdmid","object":"cdmio","queue":"cdmiq"},"davmount+xml":"davmount","docbook+xml":"dbk","dssc+der":"dssc","dssc+xml":"xdssc","ecmascript":"ecma","emma+xml":"emma","epub+zip":"epub","exi":"exi","font-":{"tdpfr":"pfr","woff":"woff"},"gml+xml":"gml","gpx+xml":"gpx","gxf":"gxf","hyperstudio":"stk","inkml+xml":["ink","inkml"],"ipfix":"ipfix","java-":{"archive":"jar","vm":"class","serialized-object":"ser"},"javascript":"js","json":"json","jsonml+json":"jsonml","lost+xml":"lostxml","mac-":{"binhex40":"hqx","compactpro":"cpt"},"mads+xml":"mads","marc":"mrc","marcxml+xml":"mrcx","mathematica":["ma","nb","mb"],"mathml+xml":"mathml","mbox":"mbox","mediaservercontrol+xml":"mscml","metalink+xml":"metalink","metalink4+xml":"meta4","mets+xml":"mets","mods+xml":"mods","mp21":["m21","mp21"],"mp4":"mp4s","msword":["doc","dot"],"mxf":"mxf","oda":"oda","ogg":"ogx","omdoc+xml":"omdoc","onenote":["onetoc","onetoc2","onetmp","onepkg"],"oxps":"oxps","pdf":"pdf","pgp-":{"encrypted":"pgp","signature":["asc","sig"]},"pkcs10":"p10","pkcs7-":{"mime":["p7m","p7c"],"signature":"p7s"},"pkcs8":"p8","pkix-":{"cert":"cer","crl":"crl","pkipath":"pkipath","attr-cert":"ac"},"pkixcmp":"pki","pls+xml":"pls","postscript":["ai","eps","ps"],"pskc+xml":"pskcxml","rdf+xml":"rdf","reginfo+xml":"rif","resource-":{"lists+xml":"rl","lists-diff+xml":"rld"},"rpki-":{"ghostbusters":"gbr","manifest":"mft","roa":"roa"},"rsd+xml":"rsd","rss+xml":"rss","rtf":"rtf","sbml+xml":"sbml","scvp-":{"cv-":{"request":"scq","response":"scs"},"vp-":{"request":"spq","response":"spp"}},"sdp":"sdp","set-":{"payment-initiation":"setpay","registration-initiation":"setreg"},"shf+xml":"shf","smil+xml":["smi","smil"],"sparql-":{"query":"rq","results+xml":"srx"},"srgs":"gram","srgs+xml":"grxml","sru+xml":"sru","ssdl+xml":"ssdl","ssml+xml":"ssml","tei+xml":["tei","teicorpus"],"thraud+xml":"tfi","vnd.":{"acucobol":"acu","acucorp":["atc","acutc"],"adobe.":{"fxp":["fxp","fxpl"],"xdp+xml":"xdp","xfdf":"xfdf","formscentral.fcdt":"fcdt","air-application-installer-package+zip":"air"},"apple.":{"installer+xml":"mpkg","mpegurl":"m3u8"},"audiograph":"aep","bmi":"bmi","businessobjects":"rep","chemdraw+xml":"cdxml","cinderella":"cdy","claymore":"cla","commonspace":"csp","cosmocaller":"cmc","crick.":{"clicker":"clkx","clicker.":{"keyboard":"clkk","palette":"clkp","template":"clkt","wordbank":"clkw"}},"curl.":{"car":"car","pcurl":"pcurl"},"dart":"dart","dece.":{"data":["uvf","uvvf","uvd","uvvd"],"ttml+xml":["uvt","uvvt"],"unspecified":["uvx","uvvx"],"zip":["uvz","uvvz"]},"dna":"dna","dpgraph":"dpg","dreamfactory":"dfac","dvb.":{"ait":"ait","service":"svc"},"dynageo":"geo","enliven":"nml","epson.":{"esf":"esf","msf":"msf","quickanime":"qam","salt":"slt","ssf":"ssf"},"eszigno3+xml":["es3","et3"],"ezpix-":{"album":"ez2","package":"ez3"},"fdf":"fdf","fdsn.":{"mseed":"mseed","seed":["seed","dataless"]},"flographit":"gph","framemaker":["fm","frame","maker","book"],"frogans.":{"fnc":"fnc","ltf":"ltf"},"fujitsu.":{"oasys":"oas","oasys2":"oa2","oasys3":"oa3","oasysgp":"fg5","oasysprs":"bh2"},"fujixerox.":{"ddd":"ddd","docuworks":"xdw","docuworks.binder":"xbd"},"fuzzysheet":"fzs","geogebra.":{"file":"ggb","tool":"ggt"},"geonext":"gxt","geoplan":"g2w","geospace":"g3w","gmx":"gmx","grafeq":["gqf","gqs"],"groove-":{"account":"gac","help":"ghf","injector":"grv","tool-":{"message":"gtm","template":"tpl"},"vcard":"vcg","identity-message":"gim"},"hal+xml":"hal","hbci":"hbci","hp-":{"hpgl":"hpgl","hpid":"hpid","hps":"hps","jlyt":"jlt","pcl":"pcl","pclxl":"pclxl"},"ibm.":{"minipay":"mpy","modcap":["afp","listafp","list3820"],"rights-management":"irm","secure-container":"sc"},"iccprofile":["icc","icm"],"igloader":"igl","immervision-":{"ivp":"ivp","ivu":"ivu"},"intergeo":"i2g","intu.":{"qbo":"qbo","qfx":"qfx"},"jam":"jam","jisp":"jisp","kahootz":["ktz","ktr"],"kde.":{"karbon":"karbon","kchart":"chrt","kformula":"kfo","kivio":"flw","kontour":"kon","kpresenter":["kpr","kpt"],"kspread":"ksp","kword":["kwd","kwt"]},"kenameaapp":"htke","kidspiration":"kia","kinar":["kne","knp"],"koan":["skp","skd","skt","skm"],"lotus-":{"approach":"apr","freelance":"pre","notes":"nsf","organizer":"org","screencam":"scm","wordpro":"lwp","1-2-3":"123"},"mcd":"mcd","medcalcdata":"mc1","mfer":"mwf","mfmp":"mfm","micrografx.":{"flo":"flo","igx":"igx"},"mif":"mif","mobius.":{"daf":"daf","dis":"dis","mbk":"mbk","mqy":"mqy","msl":"msl","plc":"plc","txf":"txf"},"mophun.":{"application":"mpn","certificate":"mpc"},"ms-":{"artgalry":"cil","excel":["xls","xlm","xla","xlc","xlt","xlw"],"excel.":{"sheet.":{"macroenabled.12":"xlsm","binary.macroenabled.12":"xlsb"},"addin.macroenabled.12":"xlam","template.macroenabled.12":"xltm"},"fontobject":"eot","htmlhelp":"chm","ims":"ims","lrm":"lrm","outlook":"msg","officetheme":"thmx","pki.":{"seccat":"cat","stl":"stl"},"powerpoint":["ppt","pps","pot"],"powerpoint.":{"addin.macroenabled.12":"ppam","presentation.macroenabled.12":"pptm","slide.macroenabled.12":"sldm","slideshow.macroenabled.12":"ppsm","template.macroenabled.12":"potm"},"project":["mpp","mpt"],"word.":{"document.macroenabled.12":"docm","template.macroenabled.12":"dotm"},"works":["wps","wks","wcm","wdb"],"wpl":"wpl","xpsdocument":"xps","cab-compressed":"cab"},"mseq":"mseq","musician":"mus","mynfc":"taglet","nitf":["ntf","nitf"],"noblenet-":{"directory":"nnd","sealer":"nns","web":"nnw"},"nokia.":{"radio-":{"preset":"rpst","presets":"rpss"},"n-gage.":{"data":"ngdat","symbian.install":"n-gage"}},"novadigm.":{"edm":"edm","edx":"edx","ext":"ext"},"osgi.":{"dp":"dp","subsystem":"esa"},"palm":["pdb","pqa","oprc"],"pawaafile":"paw","pg.":{"format":"str","osasli":"ei6"},"picsel":"efif","pocketlearn":"plf","powerbuilder6":"pbd","recordare.":{"musicxml":"mxl","musicxml+xml":"musicxml"},"rn-":{"realmedia":"rm","realmedia-vbr":"rmvb"},"seemail":"see","sema":"sema","semd":"semd","semf":"semf","smaf":"mmf","spotfire.":{"dxp":"dxp","sfs":"sfs"},"stardivision.":{"calc":"sdc","draw":"sda","impress":"sdd","math":"smf","writer":["sdw","vor"],"writer-global":"sgl"},"stepmania.":{"package":"smzip","stepchart":"sm"},"svd":"svd","syncml+xml":"xsm","syncml.":{"dm+wbxml":"bdm","dm+xml":"xdm"},"trueapp":"tra","ufdl":["ufd","ufdl"],"umajin":"umj","unity":"unityweb","uoml+xml":"uoml","vcx":"vcx","visio":["vsd","vst","vss","vsw"],"visionary":"vis","vsf":"vsf","Webd.":{"wbxml":"wbxml","wmlc":"wmlc","wmlscriptc":"wmlsc"},"webturbo":"wtb","wordperfect":"wpd","wqd":"wqd","xara":"xar","xfdl":"xfdl","yamaha.":{"hv-":{"dic":"hvd","script":"hvs","voice":"hvp"},"openscoreformat":"osf","smaf-":{"audio":"saf","phrase":"spf"},"openscoreformat.osfpvg+xml":"osfpvg"},"zul":["zir","zirz"],"3gpp2.tcap":"tcap","accpac.simply.":{"aso":"aso","imp":"imp"},"ahead.space":"ahead","airzip.filesecure.":{"azf":"azf","azs":"azs"},"amazon.ebook":"azw","americandynamics.acc":"acc","amiga.ami":"ami","anser-web-":{"certificate-issue-initiation":"cii","funds-transfer-initiation":"fti"},"aristanetworks.swi":"swi","blueice.multipass":"mpm","cloanto.rp9":"rp9","clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"cluetrust.cartomobile-":{"config":"c11amc","config-pkg":"c11amz"},"contact.cmsg":"cdbcmsg","criticaltools.wbs+xml":"wbs","ctc-posml":"pml","cups-ppd":"ppd","dolby.mlp":"mlp","ds-keypoint":"kpxx","ecowin.chart":"mag","fluxtime.clip":"ftc","fsc.weblaunch":"fsc","genomatix.tuxedo":"txd","geometry-explorer":["gex","gre"],"google-earth.":{"kml+xml":"kml","kmz":"kmz"},"handheld-entertainment+xml":"zmm","insors.igm":"igm","intercon.formnet":["xpw","xpx"],"ipunplugged.rcprofile":"rcprofile","irepository.package+xml":"irp","is-xpr":"xpr","isac.fcs":"fcs","kodak-descriptor":"sse","las.las+xml":"lasxml","macports.portpkg":"portpkg","mediastation.cdkey":"cdkey","mozilla.xul+xml":"xul","muvee.style":"msty","neurolanguage.nlu":"nlu","oasis.opendocument.":{"chart":"odc","database":"odb","formula":"odf","graphics":"odg","image":"odi","presentation":"odp","spreadsheet":"ods","text":"odt","text-":{"master":"odm","template":"ott","web":"oth"},"chart-template":"otc","formula-template":"odft","graphics-template":"otg","image-template":"oti","presentation-template":"otp","spreadsheet-template":"ots"},"olpc-sugar":"xo","oma.dd2+xml":"dd2","openofficeorg.extension":"oxt","openxmlformats-officedocument.":{"presentationml.":{"presentation":"pptx","slide":"sldx","slideshow":"ppsx","template":"potx"},"spreadsheetml.":{"sheet":"xlsx","template":"xltx"},"wordprocessingml.":{"document":"docx","template":"dotx"}},"pmi.widget":"wg","previewsystems.box":"box","proteus.magazine":"mgz","pvi.ptid1":"ptid","quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"realvnc.bed":"bed","rig.cryptonote":"cryptonote","rim.cod":"cod","route66.link66+xml":"link66","sailingtracker.track":"st","shana.informed.":{"formdata":"ifm","formtemplate":"itp","interchange":"iif","package":"ipk"},"simtech-mindmapper":["twd","twds"],"smart.teacher":"teacher","solent.sdkm+xml":["sdkm","sdkd"],"sun.xml.":{"calc":"sxc","draw":"sxd","impress":"sxi","math":"sxm","writer":"sxw","writer.":{"global":"sxg","template":"stw"},"calc.template":"stc","draw.template":"std","impress.template":"sti"},"sus-calendar":["sus","susp"],"symbian.install":["sis","sisx"],"tcpdump.pcap":["pcap","cap","dmp"],"tmobile-livetv":"tmo","trid.tpt":"tpt","triscape.mxs":"mxs","uiq.theme":"utz","wolfram.player":"nbp","wt.stf":"stf","zzazz.deck+xml":"zaz","3gpp.pic-bw-":{"large":"plb","small":"psb","var":"pvb"},"3m.post-it-notes":"pwn","android.package-archive":"apk","antix.game-component":"atx","astraea-software.iota":"iota","chipnuts.karaoke-mmd":"mmd","data-vision.rdz":"rdz","denovo.fcselayout-link":"fe_launch","hhe.lesson-player":"les","hydrostatix.sof-data":"sfd-hdstx","jcp.javame.midlet-rms":"rms","joost.joda-archive":"joda","llamagraphics.life-balance.":{"desktop":"lbd","exchange+xml":"lbe"},"osgeo.mapguide.package":"mgp","publishare-delta-tree":"qps","tao.intent-module-archive":"tao","yellowriver-custom-menu":"cmp"},"voicexml+xml":"vxml","widget":"wgt","winhlp":"hlp","wsdl+xml":"wsdl","wspolicy+xml":"wspolicy","x-":{"abiword":"abw","authorware-":{"bin":["aab","x32","u32","vox"],"map":"aam","seg":"aas"},"bcpio":"bcpio","bittorrent":"torrent","blorb":["blb","blorb"],"bzip":"bz","bzip2":["bz2","boz"],"cbr":["cbr","cba","cbt","cbz","cb7"],"cdlink":"vcd","chat":"chat","conference":"nsc","cpio":"cpio","csh":"csh","director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"doom":"wad","dtbncx+xml":"ncx","dtbook+xml":"dtb","dtbresource+xml":"res","dvi":"dvi","envoy":"evy","eva":"eva","font-":{"bdf":"bdf","ghostscript":"gsf","otf":"otf","pcf":"pcf","snf":"snf","ttf":["ttf","ttc"],"type1":["pfa","pfb","pfm","afm"],"linux-psf":"psf"},"freearc":"arc","futuresplash":"spl","glulx":"ulx","gnumeric":"gnumeric","gtar":"gtar","hdf":"hdf","latex":"latex","mie":"mie","ms-":{"application":"application","shortcut":"lnk","wmd":"wmd","wmz":"wmz","xbap":"xbap"},"msaccess":"mdb","msbinder":"obd","mscardfile":"crd","msclip":"clp","msdownload":["exe","dll","com","bat","msi"],"msmediaview":["mvb","m13","m14"],"msmetafile":["wmf","wmz","emf","emz"],"msmoney":"mny","mspublisher":"pub","msschedule":"scd","msterminal":"trm","mswrite":"wri","netcdf":["nc","cdf"],"nzb":"nzb","pkcs12":["p12","pfx"],"pkcs7-":{"certificates":["p7b","spc"],"certreqresp":"p7r"},"sh":"sh","shar":"shar","sql":"sql","stuffit":"sit","stuffitx":"sitx","subrip":"srt","sv4cpio":"sv4cpio","sv4crc":"sv4crc","tads":"gam","tar":"tar","tcl":"tcl","tex":"tex","texinfo":["texinfo","texi"],"tgif":"obj","ustar":"ustar","xfig":"fig","xliff+xml":"xlf","xpinstall":"xpi","xz":"xz","zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"7z-compressed":"7z","ace-compressed":"ace","apple-diskimage":"dmg","cfs-compressed":"cfs","chess-pgn":"pgn","debian-package":["deb","udeb"],"dgc-compressed":"dgc","gca-compressed":"gca","gramps-xml":"gramps","install-instructions":"install","iso9660-image":"iso","lzh-compressed":["lzh","lha"],"mobipocket-ebook":["prc","mobi"],"rar-compressed":"rar","shockwave-flash":"swf","silverlight-app":"xap","t3vm-image":"t3","tex-tfm":"tfm","wais-source":"src","java-jnlp-file":"jnlp","research-info-systems":"ris","x509-ca-cert":["der","crt"]},"xaml+xml":"xaml","xenc+xml":"xenc","xhtml+xml":["xhtml","xht"],"xml":["xml","xsl"],"xop+xml":"xop","xproc+xml":"xpl","xslt+xml":"xslt","xspf+xml":"xspf","xv+xml":["mxml","xhvml","xvml","xvm"],"yang":"yang","yin+xml":"yin","zip":"zip","andrew-inset":"ez","cu-seeme":"cu","octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"oebps-package+xml":"opf","pics-rules":"prf","prs.cww":"cww","rls-services+xml":"rs","timestamped-data":"tsd","xcap-diff+xml":"xdf","xml-dtd":"dtd","patch-ops-error+xml":"xer","relax-ng-compact-syntax":"rnc"},"audio/":{"adpcm":"adp","basic":["au","snd"],"midi":["mid","midi","kar","rmi"],"mp4":["m4a","mp4a"],"mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"ogg":["oga","ogg","spx"],"s3m":"s3m","silk":"sil","vnd.":{"dra":"dra","dts":"dts","nuera.":{"ecelp4800":"ecelp4800","ecelp7470":"ecelp7470","ecelp9600":"ecelp9600"},"rip":"rip","dece.audio":["uva","uvva"],"digital-winds":"eol","dts.hd":"dtshd","lucent.voice":"lvp","ms-playready.media.pya":"pya"},"webm":"weba","x-":{"aac":"aac","aiff":["aif","aiff","aifc"],"caf":"caf","flac":"flac","matroska":"mka","mpegurl":"m3u","ms-":{"wax":"wax","wma":"wma"},"pn-":{"realaudio":["ram","ra"],"realaudio-plugin":"rmp"},"wav":"wav"},"xm":"xm"},"image/":{"bmp":"bmp","cgm":"cgm","g3fax":"g3","gif":"gif","ief":"ief","jpeg":["jpeg","jpg","jpe"],"ktx":"ktx","png":"png","sgi":"sgi","svg+xml":["svg","svgz"],"tiff":["tiff","tif"],"vnd.":{"djvu":["djvu","djv"],"dwg":"dwg","dxf":"dxf","fastbidsheet":"fbs","fpx":"fpx","fst":"fst","ms-":{"modi":"mdi","photo":"wdp"},"xiff":"xif","adobe.photoshop":"psd","dece.graphic":["uvi","uvvi","uvg","uvvg"],"dvb.subtitle":"sub","fujixerox.edmics-":{"mmr":"mmr","rlc":"rlc"},"net-fpx":"npx","wap.wbmp":"wbmp"},"webp":"webp","x-":{"3ds":"3ds","cmx":"cmx","freehand":["fh","fhc","fh4","fh5","fh7"],"icon":"ico","pcx":"pcx","pict":["pic","pct"],"portable-":{"anymap":"pnm","bitmap":"pbm","graymap":"pgm","pixmap":"ppm"},"rgb":"rgb","tga":"tga","xbitmap":"xbm","xpixmap":"xpm","xwindowdump":"xwd","cmu-raster":"ras","mrsid-image":"sid"},"prs.btif":"btif"},"model/":{"iges":["igs","iges"],"mesh":["msh","mesh","silo"],"vnd.":{"collada+xml":"dae","dwf":"dwf","gdl":"gdl","gtw":"gtw","mts":"mts","vtu":"vtu"},"vrml":["wrl","vrml"],"x3d+binary":["x3db","x3dbz"],"x3d+vrml":["x3dv","x3dvz"],"x3d+xml":["x3d","x3dz"]},"text/":{"calendar":["ics","ifb"],"css":"css","csv":"csv","html":["html","htm"],"n3":"n3","plain":["txt","text","conf","def","list","log","in"],"richtext":"rtx","sgml":["sgml","sgm"],"troff":["t","tr","roff","man","me","ms"],"turtle":"ttl","vcard":"vcard","vnd.":{"curl":"curl","curl.":{"dcurl":"dcurl","mcurl":"mcurl","scurl":"scurl"},"fly":"fly","graphviz":"gv","in3d.":{"3dml":"3dml","spot":"spot"},"wap.":{"wml":"wml","wmlscript":"wmls"},"dvb.subtitle":"sub","fmi.flexstor":"flx","sun.j2me.app-descriptor":"jad"},"x-":{"asm":["s","asm"],"c":["c","cc","cxx","cpp","h","hh","dic"],"fortran":["f","for","f77","f90"],"nfo":"nfo","opml":"opml","pascal":["p","pas"],"setext":"etx","sfv":"sfv","uuencode":"uu","vcalendar":"vcs","vcard":"vcf","java-source":"java"},"cache-manifest":"appcache","uri-list":["uri","uris","urls"],"prs.lines.tag":"dsc","tab-separated-values":"tsv"},"video/":{"3gpp":"3gp","3gpp2":"3g2","h261":"h261","h263":"h263","h264":"h264","jpeg":"jpgv","jpm":["jpm","jpgm"],"mj2":["mj2","mjp2"],"mp4":["mp4","mp4v","mpg4"],"mpeg":["mpeg","mpg","mpe","m1v","m2v"],"ogg":"ogv","quicktime":["qt","mov"],"vnd.":{"dece.":{"hd":["uvh","uvvh"],"mobile":["uvm","uvvm"],"pd":["uvp","uvvp"],"sd":["uvs","uvvs"],"video":["uvv","uvvv"]},"fvt":"fvt","mpegurl":["mxu","m4u"],"vivo":"viv","dvb.file":"dvb","uvvu.mp4":["uvu","uvvu"],"ms-playready.media.pyv":"pyv"},"webm":"webm","x-":{"f4v":"f4v","fli":"fli","flv":"flv","m4v":"m4v","matroska":["mkv","mk3d","mks"],"mng":"mng","ms-":{"asf":["asf","asx"],"vob":"vob","wm":"wm","wmv":"wmv","wmx":"wmx","wvx":"wvx"},"msvideo":"avi","smv":"smv","sgi-movie":"movie"}},"chemical/x-":{"cdx":"cdx","cif":"cif","cmdf":"cmdf","cml":"cml","csml":"csml","xyz":"xyz"},"message/rfc822":["eml","mime"],"x-conference/x-cooltalk":"ice"}')},830614:e=>{"use strict";e.exports=JSON.parse('{"prefixHash":"67f736e03050b4d0ed3779b0edbf88c7"}')},201429:e=>{"use strict";e.exports=JSON.parse('{"🤝🏻":"🤝","🤝🏼":"🤝","🤝🏽":"🤝","🤝🏾":"🤝","🤝🏿":"🤝","👯🏻":"👯","👯🏼":"👯","👯🏽":"👯","👯🏾":"👯","👯🏿":"👯","👯🏻‍♂":"👯‍♂","👯🏼‍♂":"👯‍♂","👯🏽‍♂":"👯‍♂","👯🏾‍♂":"👯‍♂","👯🏿‍♂":"👯‍♂"}')},243756:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r=[["","Open the product context menu","Turn off send as sticker","Turn on send as sticker","__count__ @ message","Changing __count__ label","The label could not be updated","__count__ label changed","Couldn't block __participant__","__participant__ blocked","Blocking __participant__","Couldn't delete broadcast list.","Broadcast list deleted","Deleting broadcast list","Couldn't archive chat.","Chat archived","Archiving chat","Couldn't clear chat.","Chat cleared","Clearing chat","Couldn't delete chat.","Chat deleted","Deleting chat","Couldn't mark chat as read.","Couldn't mark chat as unread.","Marked as read","Marked as unread","Marking as read","Marking as unread","Couldn't mute chat.","Chat muted","Muting chat","Couldn't pin chat","You can only pin up to 3 chats.","Chat pinned","Pinning chat","Couldn't unarchive chat.","Chat unarchived","Unarchiving chat","Unmute","Couldn't unmute chat.","Chat unmuted","Unmuting chat","Couldn't unpin chat","Chat unpinned","Unpinning chat","Couldn't create group.","Please enter a shorter subject.","Can't add more than __max__ participants","Created group","Creating group","Couldn't delete group.","Group deleted","Deleting group","Couldn't exit group.","Exited group","Exiting group","Couldn't remove group icon.","Group icon removed","Removing group icon","Group icon set","Couldn't set group icon.","Setting group icon","Couldn't mute group.","Group muted","Muting group","Couldn't rename group.","Group renamed to __subject__","Renaming group","Group subject can't be empty","Couldn't unmute group.","Group unmuted","Unmuting group","Marking as not spam","Couldn't mark as not spam","Marked as not spam","Couldn't delete message because the message may have expired","Couldn't delete message","__count__ message deleted","Deleting message","Couldn't star message because the message may have expired","Couldn't star message","__count__ message starred","Starring message","Couldn't unstar all messages","Couldn't unstar message because the message may have expired","Couldn't unstar message","__count__ message unstarred","All messages unstarred","Unstarring message","Unstarring all messages","Couldn't add __participantNames__.","You added __participantNames__.","Adding __participantNames__.","Removing __participantNames__ as an admin failed.","__participantNames__ is no longer a group admin.","Removing __participantNames__ as a group admin.","They are no longer in this group.","You can't add this participant because they left the group recently.","Couldn't make __participantNames__ an admin.","__participantNames__ is now a group admin.","Making __participantNames__ a group admin.","Couldn't remove __participantNames__.","You removed __participantNames__.","Removing __participantNames__.","Couldn't remove profile photo.","Profile photo removed","Removing profile photo","Profile photo set","Couldn't set profile photo.","Setting profile photo","Your name can't be empty","Your name changed","Couldn't change your name.","Changing your name","Reporting spam","Couldn't report spam","Reported spam","About can't be empty","About changed","Couldn't change About.","Changing About…","Try again.","Couldn't unblock __participant__","__participant__ unblocked","Unblocking __participant__","Undo","Add a caption…","Blocked contacts will no longer be able to call you or send you messages","Add blocked contact","Add to a group","Add group icon","Add profile photo","Drag the image to adjust","Archive chat","No archived chats","Archived chats","Document","__count__ Page","Contact","__number__ audio file you tried adding has no content.","Your browser doesn’t support audio playback.","__number__ audio you tried adding is larger than the __maxSize__ limit.","__businessName__ used other companies to store and manage this message.","__businessName__ used Facebook and other companies to store and manage this message.","This message was delivered directly from __businessName__.","This message was delivered directly to __businessName__.","__businessName__ used Facebook to store and manage this message.","Block","List of contacts that you have blocked","No blocked contacts yet","Blocked contacts","Broadcast list deleted","Browser not supported","End Time","Start Time","This verified business is not in your contact list.","Confirmed as __businessName__","End Time","This name will be visible to your WhatsApp customers and can be edited from the app on your mobile device.","Something went wrong","An error occurred while saving.  Please try again.","__verified__ as __businessName__","Use Here","__count__ message couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support it.","No messages could be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.","__count__ message couldn't be forwarded because the file is missing.","__count__ message couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support it.","Can't Load WhatsApp","Qty __quantity__","Received cart","__updated__ Item Updated","View all","Change group icon","Change profile photo","Charge your phone to keep using WhatsApp","Archived","You are not an admin","No Internet connection","Clear messages","click here for group info","click here for contact info","Update WhatsApp","Click to reload QR code","Click to save, ESC to cancel","Click to update WhatsApp","Close chat","__count__ item","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_unauthorized_media__.","We reviewed this collection again and confirmed its name violates __collections_rejected_policy_weapons__.","","","Add __participant__ to “__subject__” group?","Add __participants__ to “__subject__” group?","You are closing WhatsApp.","Some messages can’t be forwarded, do you want to forward rest of the messages?","Can't forward all messages","Forward to __chat__?","Log out?","Make __participant__ an admin for “__subject__” group?","Remove __participant__ from “__subject__” group?","Send __count__ contact to “__chat__”?","Send __count__ contact to “__chat__”?","Send __count__ contact to “__chat__”?","Unblock __chat__ and forward messages?","Unblock __contact__","Unmute this chat?","Unmute this group?","Connecting…","Connecting to WhatsApp","Connecting","Block __contact__","__number__ group in common","About and phone number","Unblock __contact__","Loading About…","View contact","__number__ contact that you tried to add has no content.","The contact that you tried to add is larger than the __maxSize__ limit.","Older messages may be available","Use WhatsApp on your phone to search messages from before __date__.","Use WhatsApp on your phone to see the complete chat history.","Search for messages with __chatName__.","WhatsApp message","Default","Delete chat","Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete this label?","Delete message","Delete message?","Tell us about your issue","Please Update WhatsApp","New version available","Desktop Settings","Update","To continue using WhatsApp, click Update and install the latest version.","Couldn't Update Automatically","Downloading an update to WhatsApp. This may take several minutes. WhatsApp will automatically update and restart when the download finishes.","Updating WhatsApp","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after they’re sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after they’re sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after they’re sent. Click to learn more.","__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ day after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hour after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minute after they’re sent. Click to learn more.","You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ second after they’re sent. Click to learn more.","Dismiss","Docs","__count__ Doc","“__name__” downloaded.","__number__ document you tried adding has no content.","__number__ document you tried adding is larger than the __maxSize__ limit.","End-to-end encrypted","Add text to your image…","Turn on desktop notifications","& "," • ",", ","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","__name__ turned off disappearing messages.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","Disappearing messages were turned on. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","You turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","__name__ turned off disappearing messages. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ day after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hour after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minute after they're sent. Click to change.","__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ second after they're sent. Click to change.","Turning on this setting will make new messages disappear from this chat after 7 days. Recipients can still save these messages elsewhere.","Turning on this setting will make new messages disappear from this chat after a selected amount of time. Recipients can still save these messages elsewhere.","All new messages will disappear from this chat __number__ day after they're sent.","All new messages will disappear from this chat __number__ hour after they're sent.","All new messages will disappear from this chat __number__ minute after they're sent.","All new messages will disappear from this chat __number__ second after they're sent.","Anyone in this chat can change this setting.","Group admins control who can change this setting.","This message will disappear from this chat __number__ day after they're sent.","This message will disappear from this chat __number__ hour after they're sent.","This message will disappear from this chat __number__ minute after they're sent.","This message will disappear from this chat __number__ second after they're sent.","Off","On","__number__ day","__number__ hour","__number__ minute","__number__ second","Wait until the message finishes sending and displays a checkmark before forwarding.","Wait until this message is fully delivered before forwarding.","Unable to forward unsent message.","Can’t Forward","__number__ file you tried adding has no content.","__count__ file failed to be downloaded because it's no longer on your phone.","__number__ file could not be added.","__number__ file you tried adding is not supported.","__number__ file you tried adding is larger than the __maxSize__ limit.","B","GB","kB","MB","Forward","You can only share with up to __count__ chat","Forwarded many times. You can only share with up to __count__ chat.","Forward message","Forward message to","Forwarded __count__ time","Found a contact card for this number. View contact card?","Older results may be available","Microsoft Edge","Google Chrome","Mozilla Firefox","Opera","Safari (macOS 11+ Only)","Custom GIF animations are currently not supported. Please use provided GIF selection feature.","Incoming calls off. Click to restore.","Alerts and sounds off. Click to restore.","Notifications enabled","You were added by someone who's not in your contacts","Group deleted","Cancel","Checking invite link","__count__ contact","Join group","Anyone with WhatsApp can follow this link to join this group. Only share it with people you trust.","__count__ participant","You can't view this group's invite link because you're not an admin.","This invite link doesn't match any WhatsApp groups.","Are you sure you want to reset the invite link for __groupName__? If you reset the link, no one will be able to use it to join this group.","Resetting the invite link for __groupName__.","Send link to","Joining group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Joining group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't join group","Viewing and revoking group invites from Desktop is not yet available on the multi-device beta. Use your phone instead.","Viewing and revoking group invites from Web is not yet available on the multi-device beta. Use your phone instead.","Can't view group invite details",'"__A__"','__A__"__B__" & "__C__"','"__A__," __B__','"__A__" & "__B__"',"Group muted","Type contact name","__count__ other","View all (__more__)","__count__ more","Group Subject","__number__ invited","Couldn't add __participant__. You can invite them privately to join this group.","Reset invite for __participant__? If you reset the invite, __participant__ won't be able to use it to join this group.","You can’t take a photo because it looks like your computer doesn’t have a camera. Try connecting one or if you have one connected, try restarting your browser.","Camera Not Found","Allow camera","You can’t record a Voice Message because it looks like your computer doesn’t have a microphone. Try connecting one or if you have one connected, try restarting your browser.","Microphone Not Found","Allow microphone","Help","Message from __author__","__unreadCount__ New Message","You'll be logged out after several minutes of inactivity","__number__ image you tried adding has no content.","__number__ image you tried adding is larger than the __maxSize__ limit.","Check your phone to answer","WhatsApp group video call from __name__","WhatsApp group voice call from __name__","WhatsApp video call from __name__","WhatsApp voice call from __name__","WhatsApp connects to your phone to sync messages. To reduce data usage, connect your phone to Wi-Fi.","With this update, your phone won’t need to stay online to use WhatsApp on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","With this update, your phone won’t need to stay online to use WhatsApp Business on web, desktop or other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone won’t need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version expires in __num_days__ day. With the update, your phone won’t need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone won’t need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","This version will expire today at __time__. With the update, your phone won’t need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__","WhatsApp is available for Mac. __get_it_here__.","Make calls from desktop with WhatsApp for Mac. __get_it_here__.","WhatsApp is available for Windows. __get_it_here__.","Make calls from desktop with WhatsApp for Windows. __get_it_here__.","Keep your phone connected","Expires at __time__","Expires in __number__ day","__count__ item","Search in __labelName__...","Learn more","Links","__count__ Link","Accurate to __accuracy__ M","__count__ people","Last updated __date__ at __time__","Last updated today at __time__","Last updated __date__ at __time__","Last updated yesterday at __time__","Live until __time__","__hours__h left","__hours__h __minutes__m left","__minutes__m left","__sharers__ is sharing live location","__name__ is sharing live location","__count__ person is sharing live location","You are sharing live location","You and __name__ are sharing live location","You and __count__ other person are sharing live location","__name__ stopped sharing","Updated __hours__h ago","Updated __hours__h __minutes__m ago","Updated __minutes__m ago","load earlier messages…","load recent messages…","Loading…","loading messages…","Log in","Menu __android_menu_icon__","Need help to get started?","Settings __iphone_settings_icon__","Tap __android_menu__ or __iphone_settings__ and select __whatsapp_web_menu_item__","Tap on __login_step_3_md_link_device__","WhatsApp Web","More than 1GB storage usage detected. Please be aware that remaining storage is low.","Low storage warning","Make sure your computer has an active Internet connection.","Manage","Mark as read","Mark as unread","Downloading messages: __progress__%","This version will expire today at __time__. Update to use WhatsApp Web without keeping your phone online.","This version will expire today at __time__. Update to use WhatsApp Desktop without keeping your phone online.","Media","Add a caption","This file was changed from original.","Blocked","Help","Keep me signed in","Log out","Make group admin","Notifications","Profile","Profile","Remove","Settings","Attach","Menu","This audio is too large. You can send audio up to __maxSize__.","This document is too large. You can send documents up to __maxSize__.","This file is too large. You can send files up to __maxSize__.","This image is too large. You can send images up to __maxSize__.","Message info","Delivered","Delivered to","Played","Played by","Read","Read by","__count__ remaining","Couldn't find message","The message you’re pasting is too long. Try shortening it or sending it in multiple parts.","Message Too Long","This video is too large. You can send videos up to __maxSize__.","Can’t play this Voice Message because it's no longer on your phone.","Voice Message Unavailable","Can’t download this document because it's no longer on your phone.","Document Unavailable","Can’t view this GIF because it's no longer on your phone.","GIF Unavailable","Media Message Unavailable","Can’t view this photo because it's no longer on your phone.","Photo Unavailable","Can’t play this video because it's no longer on your phone.","Video Unavailable","Phone number shared via url is invalid.","Send message to","__contactName__ and __count__ other contact","__count__ contact","You can only send up to __count__ contact","Mute “__name__” for…","__A__, __B__","__A__, and __B__","__A__, __B__","__A__ and __B__","Archive Chat","WhatsApp needed to restart because of a problem.","Problem Detected","Delete Chat","Delete Group","Exit Group","Log Out","Mark as Read","Mark as Unread","Chat","Help","Terms and Privacy Policy","Next Chat","Previous Chat","Window","Bring All to Front","Minimize","Zoom","Mute","New Chat","New Group","Profile and About","Unarchive Chat","Cancel Mute","This video is unavailable. Please try again.","New chat","New group","Next","No contacts","No Docs","No groups","No Links","No Media","No result found for '__labelName__'","No starred messages","Not spam","Notifications","__number__ of __totalNumber__","+__number__","OK, got it","Start WhatsApp at Login","Order Detail","Your Order","__subtotal__ (estimated)","Qty __quantity__","__total__ (estimated total)","Already blocked","Order #__order__","Update now to use WhatsApp Web on other devices without keeping your phone online.","WhatsApp is open on another computer or browser. Click “Use Here” to use WhatsApp in this window.","Pin chat","Waiting for this message. This may take a while.","Previous","__count__ contact excluded","__count__ Product","This photo is too small. Please select a photo with height and width of at least __size__ pixel.","Couldn't send this Voice Message.","…","This is not your username or pin. This name will be visible to your WhatsApp contacts.","Group • __groupName__","All","__count__ reactions weren't sent","Reconnect","Remove","Remove this group's icon?",'Remove label "__labelName__" from __count__ item',"Remove photo","Remove your profile photo?","Report __contactInfo__","Report spam","Click to resend","Retry Now","Retrying…","Retrying in __duration__…","Retrying in __number__ second…","Save","Scan Database Usage","Search…","Search contacts","Search Emoji","Search GIFs via __service__","Search groups","Search Messages","No chats, contacts or messages found","No contacts found","No groups found","No messages found","No results found for '__keyword__'","Search or start new chat","Looking for chats, contacts or messages…","Looking for messages…","Learn which chats are end to end encrypted","Show security notifications","See __count__ archived chat","__count__ selected","Photo set to send as sticker","Send contact","Send contacts","send","Feedback/Question about WhatsApp","Email address","Confirm email address","Please enter a valid email address","The email addresses do not match","Subject","Feedback sent","Please enter a subject.","Contact us","__count__ Screenshot Maximum","Please add more to your description","To verify, send a message to __name__ and try again.","The sender is not in your contact list","Settings","__days__d","__hours__h","__minutes__m","__seconds__s","Some of your messages are still sending.","Star message","No starred messages","Starred messages","Created by __name__","Subject","This group is no longer available. Please contact __support__ for help.","__count__ suspicious link","Take photo","You'll be able to use WhatsApp again in __duration__","You're temporarily banned from WhatsApp because you sent too many messages to people who don’t have __phone__ in their address books.","You're temporarily banned from WhatsApp because you created too many groups with people who don’t have __phone__ in their address books.","__time__ left","Maximum number of files uploaded. __number__ file has been ignored.","Trying to reach phone","Turn off all desktop notifications for:","Unarchive chat","Unblock","Unblock __contact__?","Unblock Contact","Unpin chat","__count__ @ message not synced","__count__ unread message","Unstar","Unstar all messages?","Unstar message","Until __date__ at __time__","Until today at __time__","Until tomorrow at __time__","Until __day__ at __time__","Untitled","Download Microsoft Edge","Update Google Chrome","Update Mozilla Firefox","Update Safari","Update Samsung Internet","WhatsApp is out of date. Updating now…","Updating","Your phone will no longer need to stay online to use WhatsApp on web, desktop or other devices. __learn_more__","Your phone will no longer need to stay online to use WhatsApp Business on web, desktop or other devices. __learn_more__","Upload photo","__participants__ joined using your invite","You invited __participants__","Version __version__","__number__ video you tried adding has no content.","Your browser doesn’t support video playback.","__number__ video you tried adding is larger than the __maxSize__ limit.","View Contact Card","This view once photo has expired. Please ask __name__ to re-send it.","This view once video has expired. Please ask __name__ to re-send it.","View photo","Viewed by __count__","Stop screen sharing","Start screen sharing","You can turn on your camera after __callee__ answers","Your call will end in a few seconds because your microphone and sound output device were disconnected.","Your call will end in a few seconds because your microphone was disconnected.","__name__'s camera and mic are off","__name__'s camera is off","__name__'s mic is muted","__name__ is requesting to switch to a video call","Your call will end in a few seconds because your sound output device was disconnected.","You can turn off your camera after __callee__ answers","Please contact us with the make and model of your camera. ","Call cannot be placed for more than __count__ participant","You can only call up to __count__ contact","__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.","__count__ others","__callee__ is in a country where WhatsApp Calling is unavailable","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is unable to receive WhatsApp calls at this time.","Couldn't place call: __callee__ is unable to receive WhatsApp calls.","Couldn't place call: __callee__ is not registered on WhatsApp","Couldn't place call: __callee__ is unable to receive WhatsApp video calls at this time.","WhatsApp will use your computer's camera for video calls and taking photos. You can always change this later in your computer's settings.","WhatsApp will use your computer's microphone for calls and voice messages. You can always change this later in your computer's settings.","__contactName__ - WhatsApp voice call","__contactName__ - WhatsApp video call","Chat wallpaper set","Set Chat Wallpaper","Your security code with __contactName__ changed because they registered WhatsApp on their phone again.","Your security code with __contactName__ changed because you logged into a new device.","Your security code with __contactName__ changed because there was a login on a new device of yours.","Your security code with __contactName__ changed because there was a login on this device.",'WhatsApp has verified that this is the official business account of "__businessName__".',"WhatsApp has verified that this is the official business account of __businessName__. This account is saved with a different name in your contacts.","Your security code could not be verified with __contactName__. Click to learn more.","Verify your security code with __contactName__ because there was an error with their list of linked devices.","You can't send messages to this group because you're no longer a participant.","Can't send a message to blocked contact __contact__.","Your security code with __contactName__ changed because there was a login or logout from one or more of their devices.","Your security code with __contactName__ changed because there was a login or logout from one or more of your devices.","Muted","Messages to this chat are secured with end-to-end encryption. __businessName__ may use another company to store, read and respond to your messages. Click to learn more.","online","last seen __date__ at __time__","last seen today at __time__","last seen __date__ at __time__","last seen yesterday at __time__","__participant__ is typing…","__participant__ is recording audio…","Audio","Contact","__count__ page","Document","Photo","Location","Video","Voice message","Delete group","Delete broadcast list","Download “__name__”","Exit","Frequently Contacted","__name__ changed this group's settings to allow all participants to send messages to this group.","__name__ changed this group's settings to allow only admins to send messages to this group.","__name__ created group “__subject__”","__name__ created this group","An admin created group “__subject__”","You created group “__subject__”","You created this group","Created __date__ at __time__","Created __date__ at __time__","Group created by __name__, on __date__ at __time__","Group created by you, on __date__ at __time__","Created today at __time__","Created today at __time__","Group created by __name__, today at __time__","Group created by you, today at __time__","Created __day__ at __time__","Created __day__ at __time__","Created yesterday at __time__","Created yesterday at __time__","Group created by __name__, yesterday at __time__","Group created by you, yesterday at __time__","__name__ changed the group description. Click to view.","__name__ changed the group description.","__name__ reset this group's invite link. Click to view the new invite link.","__name__ changed this group's settings to allow messages that have been forwarded many times.","__name__ changed this group's settings to not allow messages that have been forwarded many times.","__name__ was added","__name__ changed their phone number to a new number.","__name__ changed to __new_number__","__participants__ is no longer an admin","__name__ joined via an invite link","You joined via an invite link","__name__ left","__participants__ is now an admin","__name__ was removed","__name__ added __participants__","__name__ added you","__name__ removed __participants__","__name__ removed you","A participant added __participants__","A participant removed __participants__","You added __participants__","You removed __participants__","__name__ changed this group's settings to allow all participants to edit this group's info.","__name__ changed this group's settings to allow only admins to edit this group's info.","__name__ changed the subject to “__subject__”","A participant changed the subject to “__subject__”","You changed the subject to “__subject__”","__num__ invite sent","Groups","Groups in common","Messages to this chat and calls are secured with end-to-end encryption, which means that WhatsApp and third parties can’t read or listen to them. __businessName__ may use a service to store, read and respond to your messages and calls. Contact __businessName__ for information on their privacy practices.","__name__ added to the list","__name__ removed from the list","__name__ and possibly other group participants are using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message this group.","__name__ is using an old version of WhatsApp that cannot receive messages sent from web/desktop using the multi-device beta. Use your phone to message them.","This happened likely because __contactName__ or you recently changed which devices you use WhatsApp on. Please verify the security code again.","Your security code with __contactName__ changed","To verify that messages and calls with __contactName__ are end-to-end encrypted, open this screen on your phone, and follow the instructions.","To verify that messages and calls with __contactName__ are end-to-end encrypted, scan or upload this code on their device. You can also compare the number above instead.","About","Messages","Missed group video call at __time__","Missed group voice call at __time__","Missed video call","Missed video call at __time__","Missed voice call","Missed voice call at __time__","The business account for __businessName__ has registered as a standard user account and may no longer belong to the business.","Other contacts","__count__ participant","To receive a payment from __senderName__, set up your payment account on your phone.","__contactName__ canceled their payment request for __currencyAndAmount__","You canceled your payment request to __contactName__ for __currencyAndAmount__","__contactName__ declined your payment request for __currencyAndAmount__.","You declined __contactName__'s payment request for __currencyAndAmount__.","__senderName__'s payment request for __currencyAndAmount__ to you expired.","Your payment request to __receiverName__ for __currencyAndAmount__ expired.","You notified __receiverName__ that you are trying to send a payment.","You can now send __receiverName__ a payment.","__invitee__ has set up payments","You invited __otherUser__ to use payments","__otherUser__ invited you to use payments","Requested from __receiverName__","Requested __amount__ from You","__senderName__ requested __amount__ from You","__senderName__ requested __amount__ from __receiverName__","Sent __amount__ to You","__senderName__ sent __amount__ to You","__senderName__ sent __amount__ to __receiverName__","Sent to __receiverName__","Pending (expires __timeSpan__)","__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.","__senderName__'s payment __relativeTime__ is complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__ __relativeTime__ couldn't complete.","Your payment to __receiverName__  was refunded __relativeTime__.","on __date__","__name__ changed this group's icon","You changed this group's icon","__name__ deleted this group's icon","You deleted this group's icon","Preview","OFFICIAL ANNOUNCEMENTS","Recent chats","__count__ recipient","Your security code with __contactName__ changed because there was a logout from one of their devices.","Your security code with __contactName__ changed because there was a logout from one of your devices.","Your security code with __contactName__ changed. Click to learn more.","Your security code with __name__ changed because they registered WhatsApp on their phone again.","Your security code with __name__ changed because there was a registration on a new device of yours.","Select messages",'WhatsApp has verified that this is the official business account of "__businessName__". This business uses WhatsApp Business, which allows them to add their opening hours, address, website and catalog of products or services.','This chat is with the verified business account for "__businessName__". Click for more info.','This chat is with the business account for "__businessName__". Click for more info.',"__businessName__ may be a business account, but WhatsApp hasn’t verified their name yet.",'The business account you’re chatting with is now verified as "__businessName__". Click for more info.','The business account you’re chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account you’re chatting with is no longer verified as "__businessName__". Click for more info.','WhatsApp is no longer able to verify that this is the account for "__businessName__".','The business account you’re chatting with is no longer confirmed as "__businessName__". Click for more info.','WhatsApp is no longer able to confirm that this is the account for "__businessName__".','This account has registered as a business account and WhatsApp has confirmed that this is the account for "__businessName__".',"__businessName__ registered as a business account, but WhatsApp hasn’t verified their name yet.",'The business account you\'re chatting with belongs to "__businessName__".',"To chat with __contact__, review and accept WhatsApp’s updated terms and privacy policy on your phone.","__date__ at __time__","today at __time__","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.","The business account you're chatting with may belong to __businessName__. WhatsApp hasn't verified their name yet.","To help you connect with businesses, we have verified that the business account you're chatting with belongs to __businessName__.",'You opened "Verify security code" for the wrong phone number. Open it for the correct number to verify __contact__.','__contact__ opened "Verify security code" for the wrong phone number. Ask __contact__ to open it for your phone number.',"yesterday at __time__","You","You created a broadcast list with __count__ recipient","To use WhatsApp, update __chrome_update__ or use __firefox_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Google Chrome __min_version_chrome__+","To use WhatsApp, update __edge_homepage__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","WhatsApp works with Microsoft Edge __min_version_edge__+","To use WhatsApp, update __firefox_update__ or use __chrome_homepage__, __safari_homepage__, __edge_homepage__ or __opera_homepage__.","WhatsApp works with Mozilla Firefox __min_version_firefox__+","WhatsApp group invite","WhatsApp","To use WhatsApp, update __safari_update__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","To use all of WhatsApp's features like photo capturing and Voice Message recording, we recommend using __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","Using Safari","WhatsApp works with Safari __min_version_safari__+","To use WhatsApp, update __samsung_update__ or use __chrome_homepage__, __firefox_homepage__ or __opera_homepage__.","WhatsApp works with Samsung Internet __min_version_samsung__+","WhatsApp","Send and receive WhatsApp messages right from your computer.","WhatsApp is open in another window. Click “Use Here” to use WhatsApp in this window.","Quickly send and receive WhatsApp messages right from your computer.","We recommend using WhatsApp with one of the following browsers:","WhatsApp also supports:","You can't add more than __count__ labels","Go to Commerce Manager to update your shop."],{4:"__count__ @ messages",5:"Changing __count__ labels",6:"Some labels could not be updated",7:"__count__ labels changed",76:"Couldn't delete __count__ messages because the messages may have expired",77:"Couldn't delete messages",78:"__count__ messages deleted",79:"Deleting messages",80:"Couldn't star messages because the messages may have expired",81:"Couldn't star messages",82:"__count__ messages starred",83:"Starring messages",85:"Couldn't unstar messages because the messages may have expired",86:"Couldn't unstar messages",87:"__count__ messages unstarred",89:"Unstarring messages",91:"Couldn't add __participantNames__.",92:"You added __participantNames__.",93:"Adding __participantNames__.",94:"Removing __participantNames__ as admins failed.",95:"__participantNames__ are no longer group admins.",96:"Removing __participantNames__ as group admins.",97:"They are no longer in this group.",98:"You can't add these participants because they left the group recently.",99:"Couldn't make __participantNames__ admins.",100:"__participantNames__ are now group admins.",101:"Making __participantNames__ group admins.",102:"Couldn't remove __participantNames__.",103:"You removed __participantNames__.",104:"Removing __participantNames__.",138:"__count__ Pages",140:"__number__ audio files you tried adding have no content.",142:"__number__ audio files you tried adding are larger than the __maxSize__ limit.",164:"__count__ messages couldn't be forwarded because __contact__ is on a version of WhatsApp that doesn't support them.",166:"__count__ messages couldn't be forwarded because the file is missing.",167:"__count__ messages couldn't be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.",171:"__updated__ Items Updated",187:"__count__ items",201:"Send __count__ contacts to “__chat__”?",202:"Send __count__ contacts to “__chat__”?",203:"Send __count__ contacts to “__chat__”?",212:"__number__ groups in common",217:"__number__ contacts that you tried to add have no content.",218:"The contacts that you tried to add are larger than the __maxSize__ limit.",226:"Deleting a label removes it from all messages, contacts, and from the list of labels. Are you sure you want to delete these labels?",227:"Delete messages",228:"Delete messages?",238:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after they’re sent. Click to learn more.",239:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after they’re sent. Click to learn more.",240:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after they’re sent. Click to learn more.",241:"__name__ uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after they’re sent. Click to learn more.",242:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ days after they’re sent. Click to learn more.",243:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ hours after they’re sent. Click to learn more.",244:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ minutes after they’re sent. Click to learn more.",245:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat __number__ seconds after they’re sent. Click to learn more.",248:"__count__ Docs",250:"__number__ documents you tried adding have no content.",251:"__number__ documents you tried adding are larger than the __maxSize__ limit.",258:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent.",259:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent.",260:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent.",261:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent.",262:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",263:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",264:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",265:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",267:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent.",268:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent.",269:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent.",270:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent.",271:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",272:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",273:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",274:"Disappearing messages were turned on. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",275:"You turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",276:"You turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",277:"You turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",278:"You turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",280:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ days after they're sent. Click to change.",281:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ hours after they're sent. Click to change.",282:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ minutes after they're sent. Click to change.",283:"__name__ turned on disappearing messages. All new messages will disappear from this chat __number__ seconds after they're sent. Click to change.",286:"All new messages will disappear from this chat __number__ days after they're sent.",287:"All new messages will disappear from this chat __number__ hours after they're sent.",288:"All new messages will disappear from this chat __number__ minutes after they're sent.",289:"All new messages will disappear from this chat __number__ seconds after they're sent.",292:"This message will disappear from this chat __number__ days after they're sent.",293:"This message will disappear from this chat __number__ hours after they're sent.",294:"This message will disappear from this chat __number__ minutes after they're sent.",295:"This message will disappear from this chat __number__ seconds after they're sent.",298:"__number__ days",299:"__number__ hours",300:"__number__ minutes",301:"__number__ seconds",302:"Wait until the messages finish sending and displays a checkmark before forwarding.",306:"__number__ files you tried adding have no content.",307:"__count__ files failed to be downloaded because they are no longer on your phone.",308:"__number__ files could not be added.",309:"__number__ files you tried adding are not supported.",310:"__number__ files you tried adding are larger than the __maxSize__ limit.",316:"You can only share with up to __count__ chats",317:"Forwarded many times. You can only share with up to __count__ chats.",318:"Forward messages",319:"Forward messages to",320:"Forwarded __count__ times",321:"Found contact cards for this number. View contact cards?",336:"__count__ contacts",339:"__count__ participants",357:"__count__ others",359:"__count__ more",362:"Couldn't add __participant__. You can invite them privately to join this group.",372:"__unreadCount__ New Messages",374:"__number__ images you tried adding have no content.",375:"__number__ images you tried adding are larger than the __maxSize__ limit.",384:"This version expires in __num_days__ days. With the update, your phone won’t need to stay online to use WhatsApp on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",385:"This version expires in __num_days__ days. With the update, your phone won’t need to stay online to use WhatsApp Business on other devices. Up to 4 linked devices and 1 phone can be used at the same time. __learn_more__",394:"Expires in __number__ days",395:"__count__ items",399:"__count__ Links",400:"Accurate to __accuracy__ M",401:"__count__ people",406:"Live until __time__",407:"__hours__h left",409:"__minutes__m left",410:"__sharers__ are sharing live location",412:"__count__ people are sharing live location",415:"You and __count__ others are sharing live location",417:"Updated __hours__h ago",419:"Updated __minutes__m ago",466:"__count__ remaining",484:"__contactName__ and __count__ other contacts",485:"__count__ contacts",486:"You can only send up to __count__ contacts",545:"__count__ contacts excluded",546:"__count__ Products",547:"This photo is too small. Please select a photo with height and width of at least __size__ pixels.",552:"All",553:"__count__ reactions weren't sent",557:'Remove label "__labelName__" from __count__ items',566:"Retrying in __number__ seconds…",585:"See __count__ archived chats",586:"__count__ selected",600:"__count__ Screenshots Maximum",605:"__days__d",606:"__hours__h",607:"__minutes__m",608:"__seconds__s",610:"Star messages",616:"__count__ suspicious links",621:"__time__ left",622:"Maximum number of files uploaded. __number__ files have been ignored.",630:"__count__ @ messages not synced",631:"__count__ unread messages",634:"Unstar messages",650:"__participants__ joined using your invite",651:"You invited __participants__",653:"__number__ videos you tried adding have no content.",655:"__number__ videos you tried adding are larger than the __maxSize__ limit.",656:"View Contact Cards",673:"Call cannot be placed for more than __count__ participants",674:"You can only call up to __count__ contacts",675:"__callee__ couldn't be added to the call, because they are using an old version of WhatsApp or an incompatible device.",676:"__count__ others",712:"__count__ pages",752:"__participants__ are no longer admins",756:"__participants__ are now admins",771:"__num__ invites sent",775:"__name__ were added to the list",776:"__name__ were removed from the list",785:"Missed group video call at __time__",786:"Missed group voice call at __time__",788:"Missed video call at __time__",790:"Missed voice call at __time__",793:"__count__ participants",795:"__contactName__ canceled their payment request for __currencyAndAmount__",796:"You canceled your payment request to __contactName__ for __currencyAndAmount__",797:"__contactName__ declined your payment request for __currencyAndAmount__.",798:"You declined __contactName__'s payment request for __currencyAndAmount__.",799:"__senderName__'s payment request for __currencyAndAmount__ to you expired.",800:"Your payment request to __receiverName__ for __currencyAndAmount__ expired.",807:"Requested __amount__ from You",808:"__senderName__ requested __amount__ from You",809:"__senderName__ requested __amount__ from __receiverName__",810:"Sent __amount__ to You",811:"__senderName__ sent __amount__ to You",812:"__senderName__ sent __amount__ to __receiverName__",815:"__senderName__ sent you __currencyAndAmount__. Use WhatsApp on your phone to accept this transaction.",828:"__count__ recipients",860:"You created a broadcast list with __count__ recipients"}]},311609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Offline=t.Disconnected=t.BufferTooLargeError=void 0;var r=n(640265);const i=(0,r.customError)("BufferTooLarge",!1);t.BufferTooLargeError=i;const a=(0,r.customError)("Disconnected",!1);t.Disconnected=a;const o=(0,r.customError)("Offline",!1,a);t.Offline=o},348338:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AckParser=void 0,t.ackMatchesTemplate=function(e,t){return e.id===t.id&&(void 0===t.class||e.class===t.class)&&(void 0===t.type||e.type===t.type)&&(void 0===t.from||a(e.from,t.from))&&(void 0===t.participant||e.participant===t.participant)&&(void 0===t.ts||e.ts===t.ts)},t.fromJidsAreEqual=a;var r=n(252230);const i=new(n(471914).WapParser)("ack",(e=>(e.assertTag("ack"),{id:e.attrString("id"),ts:e.maybeAttrString("t"),class:e.attrString("class"),type:e.maybeAttrString("type"),from:e.attrJidWithType(),participant:e.hasAttr("participant")?e.attrDeviceJid("participant"):null})));function a(e,t){if((0,r.extractFromJid)(e)===t)return!0;if(null!=e.userJid)return(0,r.defaultDeviceJidForUser)(e.userJid)===t;if(null!=e.deviceJid){const{deviceJid:n}=e;return 0===(0,r.extractDeviceId)(n)&&(0,r.extractUserJid)(n)===t}return!1}t.AckParser=i},736184:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDeadSocketTimer=function(){h&&h.deadSocketTimer.cancel()},t.castStanza=function(e){const t=b("castStanza");t.socket?t.castStanza(e):__LOG__(2)`Comms has no open socket`},t.closeSocket=function(){const e=b("closeSocket").socket;e&&(__LOG__(2)`closeSocket called`,e.close())},t.forceResetSocketLoop=function(){b("forceResetSocketLoop").socketLoop.reset()},t.getComms=function(){return h},t.isSocketConnected=E,t.maybeResetSocketLoop=function(){E()||b("maybeResetSocketLoop").socketLoop.reset()},t.onStreamErrorReceived=function(){b("onStreamErrorReceived").socketLoop.cancelReset()},t.openSocketLoop=S,t.resetStateForTests=function(){h=null,g=new d.Resolvable,m=1},t.sendIq=function(e,t){return C(e,!1).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqErrorParser=function(e,t,n){return C(e,!1).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendIqIfConnectedWithin=function(e,t,n){return C(e,!1,n).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqIfConnectedWithinErrorParser=function(e,t,n,r){return C(e,!1,n).then((e=>(0,c.parseIqResponse)(e,t,r)))},t.sendIqWithoutRetry=function(e,t){return C(e,!0).then((e=>(0,c.parseIqResponse)(e,t)))},t.sendIqWithoutRetryErrorParser=function(e,t,n){return C(e,!0).then((e=>(0,c.parseIqResponse)(e,t,n)))},t.sendPing=function(){return A.apply(this,arguments)},t.sendSmaxIq=function(e){return C(e,!1)},t.sendStanzaAndReturnAck=T,t.sendStanzaAndWaitForAck=function(e,t){return T(e,t).then((()=>{}))},t.singletonOrThrowIfUninitialized=b,t.socketLoopIteration=v,t.startComms=function(e,t,n,r){if(h)return;h=new y(e,t,n,r),setTimeout(S,0)},t.startHandlingRequests=function(){return b("startHandlingRequests").startHandlingRequests()},t.stopComms=function(){const e=b("stopComms");e.socketLoop.endWithValue(),e.socket&&e.socket.close();h=null},t.waitForConnection=function(){b("waitForConnection").sendPing(),g||(g=new d.Resolvable);return g.promise};var i=r(n(311504)),a=n(348338),o=n(147151),s=n(311609),l=n(320221),c=n(637329),u=n(72287),d=n(88156),p=n(287040),f=n(657319),_=n(831914);n(471914);let h=null,g=null,m=1;class y{constructor(e,t,n,r){var i,a;this.nextSocketId=1,this.pendingIqs=new Map,this.ackHandlers=[],this._recvBlocker=new d.Resolvable,this.activePing=null,this._pending=new Set,this.socketId=0,this.socket=null,this.softCloseSocket=null,this.handleStanza=(e,t,n)=>{const r=P(e);if(null!=r){const t=this.pendingIqs.get(r);t?(this.pendingIqs.delete(r),t.resolve(e),this.maybeScheduleHealthCheck()):__LOG__(4,void 0,new Error)`handleIq no handler for iq with id ${r}`}else{if("ack"!==e.tag)return"failure"===e.tag&&this.config.shouldBlockReceivingUntilSuccess?this._handleStanza(e,t,n):this._recvBlocker.promise.then((()=>this._handleStanza(e,t,n)));this.handleAck(e)}return"NO_ACK"},this.healthCheckTimer=new f.ShiftTimer((()=>{this.socketId&&this.sendPing()})),this.deadSocketTimer=new f.ShiftTimer((e=>{__LOG__(2)`Comms: Socket ${e} expired`,e===this.socketId&&this.softCloseSocket&&this.softCloseSocket()})),this._handleStanza=e,this.sendPing=t,this.onConnectionChange=(0,l.notifyConnectionChangeFactory)(null!==(i=n.handlers.onConnectionChange)&&void 0!==i?i:()=>{},null!==(a=n.handlers.onOptimisticConnectionChange)&&void 0!==a?a:()=>{}),this.gzipInflate=r,this.config=n,this.socketLoop=new u.PromiseRetryLoop({name:"MainSocketLoop",code:v,timer:{jitter:.1,max:n.maxSocketLoopWaitTime,algo:{type:"fibonacci",first:1e4,second:1e4},relativeDelay:!0},resetDelay:3e4})}filterPending(e){const t=[];function n(n){e(n)&&t.push(n)}return this.pendingIqs.forEach(n),this.ackHandlers.forEach(n),t}sendPendingIq(e){const{timeoutId:t}=e;null!=t&&(clearTimeout(t),e.timeoutId=void 0),this.callStanza(e.stanza)}callStanzaAsync(e){var t=this;return(0,i.default)((function*(){return yield t.callStanza(e)}))()}callStanza(e){const t=this.castStanza(e);return this.deadSocketTimer.onOrBefore(this.config.deadSocketTime,this.socketId),this.healthCheckTimer.cancel(),t}castStanzaAsync(e){var t=this;return(0,i.default)((function*(){return yield t.castStanza(e)}))()}castStanza(e){var t,n;null===(t=(n=this.config.handlers).onBeforeCastStanza)||void 0===t||t.call(n,e);const r=this.socketOrThrow("castStanza");try{return r.sendFrame((0,_.encodeStanza)(e)).then((()=>{var t,n;null===(t=(n=this.config.handlers).onCastStanza)||void 0===t||t.call(n,e)})).catch((e=>{if(__LOG__(4,void 0,new Error)`castStanza async error ${e}`,e instanceof s.BufferTooLargeError)return Promise.reject(e)}))}catch(e){__LOG__(4,void 0,new Error)`castStanza error ${e}`}return Promise.resolve()}socketOrThrow(e){const t=this.socket;if(t)return t;throw new Error(`Comms.${e} called while no socket`)}startHandlingRequests(){return __LOG__(2)`Comms.startHandlingRequests`,this._recvBlocker.resolve(),this._recvBlocker.promise.then((()=>{}))}parseAndHandleStanza(e,t){e===this.socketId&&(this.deadSocketTimer.cancel(),g&&(g.resolve(),g=null));const n=(0,_.decodeStanza)(t,this.gzipInflate).catch((e=>{throw __LOG__(4,void 0,new Error)`Failure parsing stanza!`,e})).then((n=>{var r,i;null===(r=(i=this.config.handlers).onHandleStanza)||void 0===r||r.call(i,n,e,t.byteLength);const a=this.activePing;return a&&a.socketId===e&&a.stanzaId===P(n)?(this.activePing=null,a.handler.resolve(n),this.maybeScheduleHealthCheck(),"NO_ACK"):this.handleStanza(n,e,t.byteLength)})).then((t=>{if(e===this.socketId){if("CLOSE_SOCKET"===t){__LOG__(2)`Comms: job response is CLOSE_SOCKET`;const e=this.socket;e&&e.close()}else"NO_ACK"===t||this.castStanza(t);return"NO_ACK"}}));this._pending.add(n),n.finally((()=>{this._pending.delete(n)}))}handleAck(e){const t=this.ackHandlers;let n=-1,r=null;for(;!r&&++n<t.length;)r=t[n].parseAndTest(e);if(r){var i,a;const s=t[n];(0,o.removeIndexWithoutPreservingOrder)(t,n),null===(i=(a=this.config.handlers).onHandleAck)||void 0===i||i.call(a,e),s.resolve(r),this.maybeScheduleHealthCheck()}else __LOG__(3)`handleAck: unrecognized ${e}`}removeHandler(e){if("iq"===e.type){const t=e.stanza.attrs.id;if(!t||"string"!=typeof t)return;if(!this.pendingIqs.delete(t))return}else{e.type;const t=this.ackHandlers.indexOf(e);if(-1===t)return;(0,o.removeIndexWithoutPreservingOrder)(this.ackHandlers,t)}e.resolve(Promise.reject(new s.Disconnected))}maybeScheduleHealthCheck(){if(this.healthCheckTimer.isScheduled())return;if(this.activePing||this.ackHandlers.length||this.pendingIqs.size)return;const e=this.config.healthCheckInterval,t=Math.ceil(1e3*e*(1+Math.random()));this.healthCheckTimer.onOrBefore(t)}}function S(){b("openSocketLoop").socketLoop.start()}function E(){var e;return!!(null===(e=h)||void 0===e?void 0:e.socket)}function v(){var e,t;const n=b("socketLoopIteration"),r=n.nextSocketId++;return __LOG__(2)`Comms: Socket ${r} opening`,null===(e=(t=n.config.handlers).onSocketLoopIteration)||void 0===e||e.call(t),n.config.openChatSocket((()=>{n.onConnectionChange("in_handshake")})).then((0,p.onResult)((e=>{var t,i,a,o;null===(t=(i=n.config.handlers).onSocketOpen)||void 0===t||t.call(i);const s=new d.Resolvable;return __LOG__(2)`Comms: Socket ${r} opened`,n.socketId=r,n.socket=e,n.softCloseSocket=()=>{n.softCloseSocket=null,n.socket&&n.config.shouldCloseStaleSocket&&(n.socket.close(),n.socket=null),s.resolve()},n.socketLoop.resetTimeoutAfter(1e4),n.deadSocketTimer.cancel(),n.maybeScheduleHealthCheck(),e.setOnFrame((e=>n.parseAndHandleStanza(r,e))),e.setOnClose((()=>{var e,t;__LOG__(2)`Comms: Socket ${r} closed`,n.activePing&&r===n.activePing.socketId&&(n.activePing.handler.resolve(),n.activePing=null),n.filterPending((e=>e.attachedToSocketId===r)).forEach((e=>{n.removeHandler(e)})),r===n.socketId&&(n.socketId=0,n.socket=null,n.onConnectionChange("disconnected"),null===(e=(t=n.config.handlers).onDisconnect)||void 0===e||e.call(t),s.resolve())})),n.onConnectionChange("connected"),null===(a=(o=n.config.handlers).onConnect)||void 0===a||a.call(o),n.filterPending((e=>!e.attachedToSocketId)).sort(((e,t)=>e.orderedId-t.orderedId)).forEach((e=>{"iq"===e.type?n.sendPendingIq(e):n.callStanza(e.stanza)})),s.promise}))).then((0,p.catchError)((e=>{switch(e){case"max-hunters":__LOG__(3)`socketLoopIteration socket closed while in noise handshake using treasureHunt strategy`;break;case"disconnected":__LOG__(3)`socketLoopIteration socket disconnected while in noise handshake`}}))).catch((e=>{e instanceof s.Disconnected?__LOG__(2)`socketLoopIteration socket closed while in noise handshake`:__LOG__(4,void 0,new Error)`socketLoopIteration failed ${e}`}))}function T(e,t){return new Promise((n=>{const r=b("sendStanzaAndWaitForAck"),i={type:"ack",parseAndTest:e=>{const n=a.AckParser.parse(e);return!n.error&&(0,a.ackMatchesTemplate)(n.success,t)?e:null},resolve:n,stanza:e,attachedToSocketId:0,orderedId:m++};r.ackHandlers.push(i),r.socket?r.callStanza(e).catch((e=>{const t=r.ackHandlers.indexOf(i);-1!==t&&((0,o.removeIndexWithoutPreservingOrder)(r.ackHandlers,t),i.resolve(Promise.reject(e)))})):__LOG__(2)`Comms has no open socket, will send stanza when socket opens`}))}function C(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((r=>{var i,a,o,l;const c=b("sendIq"),u=e.attrs.id;if(!u||"string"!=typeof u)throw new Error(`Comms:sendIq given iq without id: ${String(e)}`);null===(i=(a=c.config.handlers).onBeforeSendIq)||void 0===i||i.call(a,e);const d=c.socketId;if(t&&!d)return void r(Promise.reject(new s.Offline));let p;n>0&&(p=setTimeout((()=>{const e=c.pendingIqs.get(u);e?c.removeHandler(e):r(Promise.reject(new Error(`Comms:_sendIq unexisting stanza to be cancelled: ${u}`)))}),1e3*n));const f={type:"iq",resolve:r,stanza:e,attachedToSocketId:t?d:0,orderedId:m++,timeoutId:p};c.pendingIqs.set(u,f),null===(o=(l=c.config.handlers).onSendIq)||void 0===o||o.call(l,e),c.socket?c.sendPendingIq(f):__LOG__(2)`Comms has no open socket, will resend iq when socket opens`}))}function A(){return(A=(0,i.default)((function*(e,t){const n=b("sendPing"),r=e.attrs.id;if(!r||"string"!=typeof r)return Promise.reject(new Error(`Comms:sendPing given iq without id: ${String(e)}`));if(!n.socketId)return __LOG__(2)`sendPing when socket dead`,Promise.resolve();if(n.activePing&&n.activePing.socketId===n.socketId)return __LOG__(2)`sendPing ping still pending`,Promise.resolve();n.activePing&&n.activePing.handler.resolve();const i=new d.Resolvable;n.activePing={socketId:n.socketId,stanzaId:r,handler:i},n.callStanza(e);const a=yield i.promise;return a&&(0,c.parseIqResponse)(a,t)}))).apply(this,arguments)}function b(e){if(h)return h;throw new Error(`Comms::${e} called before startComms`)}function P(e){if("iq"===e.tag){const t=e.attrs.type;if("result"===t||"error"===t)return(0,_.decodeAsString)(e.attrs.id)||null}return null}},320221:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.notifyConnectionChangeFactory=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15e3;const r={timeoutID:null,connectionStatus:"disconnected",optimismLevel:"optimist"},i=()=>{const{optimismLevel:e,connectionStatus:i}=r;"optimist"===e?r.timeoutID=setTimeout((()=>{r.optimismLevel="realist",t(i)}),n):t(i)};return n=>{r.connectionStatus=n,"disconnected"===n||"in_handshake"===n?i():(null!=r.timeoutID&&(clearTimeout(r.timeoutID),r.timeoutID=null),t(n)),e(n)}}},634308:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmppParsingFailure=t.ParsableWapNode=void 0;var r=n(108584),i=n(252230),a=n(608243),o=n(591560),s=n(917793),l=n(892844),c=n(831914),u=n(245506);class d extends Error{constructor(e,t){super(`XmppParsingFailure: ${e}: ${t}`),this.name="XmppParsingFailure",this.parser=e,this.reason=t}}t.XmppParsingFailure=d;class p extends o.ParsableXmlNode{constructor(e,t){super(e,t)}assertFromServer(){const e=this.attrString("from");e!==i.WA_SERVER_JID_SUFFIX&&this.throw(`to have "from"="s.whatsapp.net", but instead has "${e}"`)}attrUserJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return null==n.userJid?this.throw(`to have "${e}"={UserJid}, but instead has "${t}"`):n.userJid}attrPhoneUserJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return"phoneUser"===n.jidType?n.userJid:this.throw(`to have "${e}"={PhoneUserJid}, but instead has "${t}"`)}attrLidUserJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return"lidUser"===n.jidType?n.userJid:this.throw(`to have "${e}"={LidUserJid}, but instead has "${t}"`)}maybeAttrUserJid(e){return this.hasAttr(e)?this.attrUserJid(e):null}maybeAttrPhoneUserJid(e){return this.hasAttr(e)?this.attrPhoneUserJid(e):null}maybeAttrLidUserJid(e){return this.hasAttr(e)?this.attrLidUserJid(e):null}attrGroupJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return null==n.groupJid?this.throw(`to have "${e}"={GroupJid}, but instead has "${t}"`):n.groupJid}maybeAttrGroupJid(e){return this.hasAttr(e)?this.attrGroupJid(e):null}attrChatJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return null!=n.userJid?n.userJid:null!=n.groupJid?n.groupJid:this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrPhoneChatJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return"phoneUser"===n.jidType?n.userJid:"group"===n.jidType?n.groupJid:this.throw(`to have "${e}"={ChatJid}, but instead has "${t}"`)}attrDeviceJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return null!=n.deviceJid?n.deviceJid:null!=n.userJid?(0,i.defaultDeviceJidForUser)(n.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${t}"`)}attrPhoneDeviceJid(e){const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return"phoneDevice"===n.jidType?n.deviceJid:"phoneUser"===n.jidType?(0,i.defaultPhoneDeviceJidForUser)(n.userJid):this.throw(`to have "${e}"={DeviceJid}, but instead has "${t}"`)}attrDeviceId(e){const t=this.attrInt(e);return(0,i.interpretAsDeviceId)(t)}attrFromJidChat(){const e=this.attrJidWithType();switch(e.jidType){case"msgrUser":{const t=e.userJid,n=(0,i.defaultDeviceJidForUser)(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneUser":{const t=e.userJid,n=(0,i.defaultDeviceJidForUser)(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"lidUser":{const t=e.userJid,n=(0,i.defaultLidDeviceJidForLidUserJid)(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneDevice":{const t=e.deviceJid;return{type:"device",chat:(0,i.extractUserJid)(t),deviceJid:t,author:t}}case"msgrDevice":{const t=e.deviceJid;return{type:"device",chat:(0,i.extractUserJid)(t),deviceJid:t,author:t}}case"lidDevice":{const t=e.deviceJid;return{type:"device",chat:(0,i.extractUserJid)(t),deviceJid:t,author:t}}case"group":{const t=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:t}}case"broadcast":{const t=this.hasAttr("participant")?this.attrDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:(0,i.extractUserJid)(t),author:t}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw("attrFromJidChat should not be used with a status jid")}}attrFromJidPhoneChat(){const e=this.attrJidWithType();switch(e.jidType){case"phoneUser":{const t=e.userJid,n=(0,i.defaultPhoneDeviceJidForUser)(t);return{type:"device",chat:t,deviceJid:n,author:n}}case"phoneDevice":{const t=e.deviceJid;return{type:"device",chat:(0,i.extractPhoneUserJid)(t),deviceJid:t,author:t}}case"group":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"group",chat:e.groupJid,groupJid:e.groupJid,author:t}}case"broadcast":{const t=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==t?this.throw("expected to have participant JID for group"):{type:"broadcast",broadcastJid:e.broadcastJid,chat:(0,i.extractPhoneUserJid)(t),author:t}}case"call":throw __LOG__(4,void 0,new Error)`ParsableWapNode: attrFromJid() is called with ${e.callJid}`,new Error("ParsableWapNode: attrFromJid() does not support CallJid");default:return e.jidType,this.throw(`attrFromJidChat should not be used with jid of type ${e.jidType}`)}}attrFromPhoneJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==e?this.throw("to have participant for status msg"):{type:"status",author:e}}return this.attrFromJidPhoneChat()}attrFromJid(){if("status"===this.attrJidWithType().jidType){const e=this.hasAttr("participant")?this.attrPhoneDeviceJid("participant"):null;return null==e?this.throw("to have participant for status msg"):{type:"status",author:e}}return this.attrFromJidChat()}attrJidWithType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return"unknown"===n.jidType?this.throw(`to have "${e}"={Jid}, but instead has "${t}"`):n}attrWapJid(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"from";const t=this.attrString(e),n=(0,i.interpretAndValidateJid)(t);return"unknown"===n.jidType?u.WapJid.create(null,t):(0,c.JID)((0,i.extractFromJid)(n))}attrLongInt(e){const t=this.attrString(e);return(0,a.decimalStringToLongInt)(t)}attrTime(e){return(0,l.castToUnixTime)(this.attrInt(e))}attrFutureTime(e){const t=this.attrInt(e);return(0,l.futureUnixTime)(t)}contentString(){if(this.hasChildren())return this.throw("to have string content, but has children instead");if(this.hasContent()){const e=new r.Binary(this.contentBytes());return e.readString(e.size())}return this.throw("to have content")}decodeAsString(e){return(0,c.decodeAsString)(e)}contentSerializedPubKey(){return this.hasContent()?(0,s.serializeIdentity)(this.contentBytes()):this.throw("to have content")}createParseError(e){return new d(this.name(),`expected <${this.tag()}> ${e}`)}throw(e){throw this.createParseError(e)}}t.ParsableWapNode=p},637329:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIqResponse=function(e,t,n){const a=e.content;if(a&&Array.isArray(a)&&a[0]){const t=a[0];if("error"===t.tag){const a=t.attrs||{};let o;n&&(o="function"==typeof n?n(e):n.parseOrThrow(t));const s=o;return{success:!1,errorCode:parseInt(a.code,10),errorText:(0,r.decodeAsString)(a.text)||"",errorType:(0,r.decodeAsString)(a.type)||"",errorBackoff:parseInt(a.backoff,10),toString:i,customError:s}}}return"function"==typeof t?{success:!0,result:t(e)}:{success:!0,result:t.parseOrThrow(e)}};var r=n(831914);n(471914);function i(){return`IqError ${this.errorCode}: ${this.errorText}`}},831914:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.BIG_ENDIAN_CONTENT=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e;const r=new Uint8Array(t);for(let e=t-1;e>=0;e--)r[e]=255&n,n>>>=8;return r},t.BROADCAST_JID=function(e){return $(e)},t.CALL_JID=function(e){return $(e)},t.CUSTOM_STRING=function(e){return e},t.DEVICE_JID=function(e){return $(e)},t.DOMAIN_JID=z,t.DROP_ATTR=void 0,t.GROUP_JID=function(e){return $(e)},t.G_US=void 0,t.INT=function(e){return e.toString()},t.JID=$,t.LONG_INT=function(e){return(0,s.longIntToDecimalString)(e)},t.MAYBE_CUSTOM_STRING=function(e){if(null==e)return T;return e},t.PARTICIPANT_JID=function(e){return"status"===e.type||"group"===e.type||"broadcast"===e.type?$(e.author):T},t.STANZA_ID=function(e){return e},t.S_WHATSAPP_NET=t.STATUS_BROADCAST=void 0,t.TO_JID=function(e){return $(V(e))},t.TO_WAP_JID=function(e){return"phoneDevice"===e.jidType||"msgrDevice"===e.jidType||"lidDevice"===e.jidType?$(e.deviceJid):"phoneUser"===e.jidType||"msgrUser"===e.jidType||"lidUser"===e.jidType?$(e.userJid):"group"===e.jidType?$(e.groupJid):"status"===e.jidType?$(e.statusJid):"call"===e.jidType?$(e.callJid):(e.jidType,$(e.broadcastJid))},t.USER_JID=function(e){return $(e)},t.WapNode=void 0,t.decodeAsString=function(e){if(e instanceof c.WapJid)return e.toString();return e},t.decodeStanza=function(e,t){const n=new a.Binary(e);if(2&n.readUint8())return __LOG__(2)`Decoding compressed stanza`,t(n.readByteArray()).then((e=>Y(new a.Binary(e))));return Promise.resolve(Y(n))},t.enableXMLFormat=function(){O=!0},t.encodeStanza=function(e){const t=e instanceof M?e:R(e),n=new a.Binary;N(t,n);const r=n.readByteArray(),i=new Uint8Array(1+r.length);return i[0]=0,i.set(r,1),i},t.extractParticipantJid=function(e){switch(e.type){case"group":case"status":case"broadcast":return e.author;default:return e.type,null}},t.extractToJid=V,t.generateId=function(){if(!E){const e=new Uint16Array(2);self.crypto.getRandomValues(e),E=`${String(e[0])}.${String(e[1])}-`}return`${E}${v++}`},t.makeStanza=R,t.makeWapNode=I,t.wap=void 0;var i=r(n(184973)),a=n(108584),o=n(252230),s=n(608243),l=n(127498),c=n(245506),u=r(n(517890)),d=n(974277);const p=o.MSGR_USER_DOMAIN.replace("@",""),f=o.WA_USER_DOMAIN.replace("@",""),_=o.LID_DOMAIN.replace("@",""),h=[236,237,238,239],g=248,m=249,y=["0","1","2","3","4","5","6","7","8","9","-",".","�","�","�","�"],S=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];let E="",v=1;const T={sentinel:"DROP_ATTR"};t.DROP_ATTR=T;const C=c.WapJid.create(null,"g.us");t.G_US=C;const A=c.WapJid.create(null,o.WA_SERVER_JID_SUFFIX);t.S_WHATSAPP_NET=A;const b=c.WapJid.create("status","broadcast");t.STATUS_BROADCAST=b;const P={};let O=!1;class M{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=n}toString(){let e="<"+this.tag;e+=(0,d.attrsToString)(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:e+=t?`>${(0,d.uint8ArrayToDebugString)(t)}</${this.tag}>`:" />",O&&(e=(0,u.default)(e)),e}}function I(e,t,n){let r=null;if(t&&null!=t.children)throw new Error('Children should not be passed via props (see eslint check "react/no-children-props")');if(Array.isArray(n))r=n.filter(Boolean);else if("string"==typeof n)r=a.Binary.build(n).readByteArray();else if(n instanceof ArrayBuffer)r=new Uint8Array(n);else if(n instanceof Uint8Array)r=n;else{const e=[];for(let t=2;t<arguments.length;t++){const n=arguments[t];n&&e.push(n)}r=e}Array.isArray(r)&&0===r.length&&(r=null);const i={};if(t){const n=t;Object.keys(n).forEach((t=>{const r=n[t];if(null==r)throw new Error(`Attr ${t} in <${e}> is null`);r!==T&&(i[t]=r)}))}return new M(e,i,r)}t.WapNode=M;const w=I;function R(e){let t=e.content;return Array.isArray(t)?t=t.map(R):"string"==typeof t&&(t=a.Binary.build(t).readByteArray()),new M(e.tag,e.attrs||P,t)}function N(e,t){if(null==e)t.writeUint8(0);else if(e instanceof M)L(e,t);else if(e instanceof c.WapJid)!function(e,t){const n=e.getInnerJid();if(n.type===c.WAP_JID_SUBTYPE.JID_U){const{user:e,device:r,domainType:i}=n;t.writeUint8(247),t.writeUint8(i),t.writeUint8(r),N(e,t)}else if(n.type===c.WAP_JID_SUBTYPE.JID_FB){const{user:e,device:r}=n;t.writeUint8(246),N(e,t),t.writeUint16(r),N(f,t)}else{const{user:e,server:r}=n;t.writeUint8(250),null!=e?N(e,t):t.writeUint8(0),N(r,t)}}(e,t);else if("string"==typeof e)G(e,t);else{if(!(e instanceof Uint8Array))throw new Error("Invalid payload type "+typeof e);!function(e,t){B(e.length,t),t.writeByteArray(e)}(e,t)}}function L(e,t){if(void 0===e.tag)return t.writeUint8(g),void t.writeUint8(0);let n=1;e.attrs&&(n+=2*Object.keys(e.attrs).length),e.content&&n++,n<256?(t.writeUint8(g),t.writeUint8(n)):n<65536&&(t.writeUint8(m),t.writeUint16(n)),N(e.tag,t),e.attrs&&Object.keys(e.attrs).forEach((n=>{G(n,t),N(e.attrs[n],t)}));const r=e.content;if(Array.isArray(r)){r.length<256?(t.writeUint8(g),t.writeUint8(r.length)):r.length<65536&&(t.writeUint8(m),t.writeUint16(r.length));for(let e=0;e<r.length;e++)L(r[e],t)}else r&&N(r,t)}let D,k;function U(e){const t=new Map;for(let n=0;n<e.length;n++)t.set(e[n],n);return t}function G(e,t){if(""===e)return t.writeUint8(252),void t.writeUint8(0);null==D&&(D=U(l.SINGLE_BYTE_TOKEN));const n=D.get(e);if(null!=n)return void t.writeUint8(n+1);if(null==k){k=[];for(let e=0;e<l.DICTIONARIES.length;++e)k.push(U(l.DICTIONARIES[e]))}for(let n=0;n<k.length;++n){const r=k[n].get(e);if(null!=r)return t.writeUint8(h[n]),void t.writeUint8(r)}const r=(0,a.numUtf8Bytes)(e);if(r<128){if(!/[^0-9.-]+?/.exec(e))return void x(e,255,t);if(!/[^0-9A-F]+?/.exec(e))return void x(e,251,t)}B(r,t),t.writeString(e)}function x(e,t,n){const r=e.length%2==1;n.writeUint8(t);let i=Math.ceil(e.length/2);r&&(i|=128),n.writeUint8(i);let a=0;for(let r=0;r<e.length;r++){const i=e.charCodeAt(r);let o=null;if(48<=i&&i<=57?o=i-48:255===t?45===i?o=10:46===i&&(o=11):251===t&&65<=i&&i<=70&&(o=i-55),null==o)throw new Error(`Cannot nibble encode ${i}`);r%2==0?(a=o<<4,r===e.length-1&&(a|=15,n.writeUint8(a))):(a|=o,n.writeUint8(a))}}function B(e,t){if(e<256)t.writeUint8(252),t.writeUint8(e);else if(e<1048576)t.writeUint8(253),t.writeUint8(e>>>16&255),t.writeUint8(e>>>8&255),t.writeUint8(255&e);else{if(!(e<4294967296))throw new Error(`Binary with length ${e} is too big for WAP protocol`);t.writeUint8(254),t.writeUint32(e)}}function F(e,t){const n=e.readUint8();if(0===n)return null;if(n===g)return j(e,e.readUint8());if(n===m)return j(e,e.readUint16());if(252===n){const n=e.readUint8();return W(e,n,t)}if(253===n){const n=e.readUint8(),r=e.readUint8(),i=e.readUint8();return W(e,((15&n)<<16)+(r<<8)+i,t)}if(254===n){const n=e.readUint32();return W(e,n,t)}if(250===n)return function(e){const t=function(e){const t=F(e,!0);if(null!=t&&"string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}(e),n=K(e);return c.WapJid.create(t,n)}(e);if(246===n)return function(e){const t=K(e),n=e.readUint16();return K(e),c.WapJid.createFbJid(t,n)}(e);if(247===n)return function(e){let t=null;const n=e.readUint8();if(0===n)t=c.DOMAIN_TYPE.WHATSAPP;else{if(1!==n)throw new Error(`decodeJidU - Invalid domain type encoding ${n}`);t=c.DOMAIN_TYPE.LID}const r=e.readUint8(),i=K(e);return c.WapJid.createJidU(i,t,r)}(e);if(255===n){const t=e.readUint8();return H(e,y,t>>>7,127&t)}if(251===n){const t=e.readUint8();return H(e,S,t>>>7,127&t)}if(n<=0||n>=240)throw new Error("Unable to decode WAP buffer");if(n>=236&&n<=239){const t=n-236,r=l.DICTIONARIES[t];if(void 0===r)throw new Error(`Missing WAP dictionary ${t}`);const i=e.readUint8(),a=r[i];if(void 0===a)throw new Error(`Invalid value index ${i} in dict ${t}`);return a}const r=l.SINGLE_BYTE_TOKEN[n-1];if(void 0===r)throw new Error(`Undefined token with index ${n}`);return r}function j(e,t){const n=[];for(let r=0;r<t;r++)n.push(Y(e));return n}function Y(e){const t=e.readUint8();let n,r;if(t===g)n=e.readUint8();else{if(t!==m)throw new Error(`Failed to decode node since type byte ${String(t)} is invalid`);n=e.readUint16()}let i=null;if(0===n)throw new Error("Failed to decode node, list cannot be empty");const a=K(e);for(n-=1;n>1;){r||(r={});const t=K(e),i=F(e,!0);r[t]=i,n-=2}return 1===n&&(i=F(e,!1),i instanceof c.WapJid&&(i=String(i))),new M(a,r,i)}function K(e){const t=F(e,!0);if("string"!=typeof t)throw new Error(`Decode string got invalid value ${String(t)}, string expected`);return t}function W(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e.readString(t):e.readByteArray(t)}function H(e,t,n,r){const i=new Array(2*r-n);for(let n=0;n<i.length-1;n+=2){const r=e.readUint8();i[n]=t[r>>>4],i[n+1]=t[15&r]}if(n){const n=e.readUint8();i[i.length-1]=t[n>>>4]}return i.join("")}function V(e){switch(e.type){case"group":return e.groupJid;case"status":return o.STATUS_JID;case"device":return e.deviceJid;default:return e.type,e.broadcastJid}}function $(e){const t=(0,o.validateDomainJid)(e);if(null!=t)return z(t);let[n,r]=e.split("@"),i=null,a=null;if(r!==f&&r!==p&&r!==_||-1!==n.indexOf(":")&&([n,i]=n.split(":"),a=parseInt(i,10)),r===p)return c.WapJid.createFbJid(n,a);const s=r===_?c.DOMAIN_TYPE.LID:c.DOMAIN_TYPE.WHATSAPP;return null!=a&&0!==a?c.WapJid.createJidU(n,s,a):c.WapJid.create(n,r)}function z(e){return"s.whatsapp.net"===e?A:"g.us"===e?C:(0,i.default)(e)}t.wap=w},127498:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SINGLE_BYTE_TOKEN=t.DICT_VERSION=t.DICTIONARY_3_TOKEN=t.DICTIONARY_2_TOKEN=t.DICTIONARY_1_TOKEN=t.DICTIONARY_0_TOKEN=t.DICTIONARIES=void 0;t.DICT_VERSION=2;t.SINGLE_BYTE_TOKEN=["xmlstreamstart","xmlstreamend","s.whatsapp.net","type","participant","from","receipt","id","broadcast","status","message","notification","notify","to","jid","user","class","offline","g.us","result","mediatype","enc","skmsg","off_cnt","xmlns","presence","participants","ack","t","iq","device_hash","read","value","media","picture","chatstate","unavailable","text","urn:xmpp:whatsapp:push","devices","verified_name","contact","composing","edge_routing","routing_info","item","image","verified_level","get","fallback_hostname","2","media_conn","1","v","handshake","fallback_class","count","config","offline_preview","download_buckets","w:profile:picture","set","creation","location","fallback_ip4","msg","urn:xmpp:ping","fallback_ip6","call-creator","relaylatency","success","subscribe","video","business_hours_config","platform","hostname","version","unknown","0","ping","hash","edit","subject","max_buckets","download","delivery","props","sticker","name","last","contacts","business","primary","preview","w:p","pkmsg","call-id","retry","prop","call","auth_ttl","available","relay_id","last_id","day_of_week","w","host","seen","bits","list","atn","upload","is_new","w:stats","key","paused","specific_hours","multicast","stream:error","mmg.whatsapp.net","code","deny","played","profile","fna","device-list","close_time","latency","gcm","pop","audio","26","w:web","open_time","error","auth","ip4","update","profile_options","config_value","category","catalog_not_created","00","config_code","mode","catalog_status","ip6","blocklist","registration","7","web","fail","w:m","cart_enabled","ttl","gif","300","device_orientation","identity","query","401","media-gig2-1.cdn.whatsapp.net","in","3","te2","add","fallback","categories","ptt","encrypt","notice","thumbnail-document","item-not-found","12","thumbnail-image","stage","thumbnail-link","usync","out","thumbnail-video","8","01","context","sidelist","thumbnail-gif","terminate","not-authorized","orientation","dhash","capability","side_list","md-app-state","description","serial","readreceipts","te","business_hours","md-msg-hist","tag","attribute_padding","document","open_24h","delete","expiration","active","prev_v_id","true","passive","index","4","conflict","remove","w:gp2","config_expo_key","screen_height","replaced","02","screen_width","uploadfieldstat","2:47DEQpj8","media-bog1-1.cdn.whatsapp.net","encopt","url","catalog_exists","keygen","rate","offer","opus","media-mia3-1.cdn.whatsapp.net","privacy","media-mia3-2.cdn.whatsapp.net","signature","preaccept","token_id","media-eze1-1.cdn.whatsapp.net"];const n=["media-for1-1.cdn.whatsapp.net","relay","media-gru2-2.cdn.whatsapp.net","uncompressed","medium","voip_settings","device","reason","media-lim1-1.cdn.whatsapp.net","media-qro1-2.cdn.whatsapp.net","media-gru1-2.cdn.whatsapp.net","action","features","media-gru2-1.cdn.whatsapp.net","media-gru1-1.cdn.whatsapp.net","media-otp1-1.cdn.whatsapp.net","kyc-id","priority","phash","mute","token","100","media-qro1-1.cdn.whatsapp.net","none","media-mrs2-2.cdn.whatsapp.net","sign_credential","03","media-mrs2-1.cdn.whatsapp.net","protocol","timezone","transport","eph_setting","1080","original_dimensions","media-frx5-1.cdn.whatsapp.net","background","disable","original_image_url","5","transaction-id","direct_path","103","appointment_only","request_image_url","peer_pid","address","105","104","102","media-cdt1-1.cdn.whatsapp.net","101","109","110","106","background_location","v_id","sync","status-old","111","107","ppic","media-scl2-1.cdn.whatsapp.net","business_profile","108","invite","04","audio_duration","media-mct1-1.cdn.whatsapp.net","media-cdg2-1.cdn.whatsapp.net","media-los2-1.cdn.whatsapp.net","invis","net","voip_payload_type","status-revoke-delay","404","state","use_correct_order_for_hmac_sha1","ver","media-mad1-1.cdn.whatsapp.net","order","540","skey","blinded_credential","android","contact_remove","enable_downlink_relay_latency_only","duration","enable_vid_one_way_codec_nego","6","media-sof1-1.cdn.whatsapp.net","accept","all","signed_credential","media-atl3-1.cdn.whatsapp.net","media-lhr8-1.cdn.whatsapp.net","website","05","latitude","media-dfw5-1.cdn.whatsapp.net","forbidden","enable_audio_piggyback_network_mtu_fix","media-dfw5-2.cdn.whatsapp.net","note.m4r","media-atl3-2.cdn.whatsapp.net","jb_nack_discard_count_fix","longitude","Opening.m4r","media-arn2-1.cdn.whatsapp.net","email","timestamp","admin","media-pmo1-1.cdn.whatsapp.net","America/Sao_Paulo","contact_add","media-sin6-1.cdn.whatsapp.net","interactive","8000","acs_public_key","sigquit_anr_detector_release_rollover_percent","media.fmed1-2.fna.whatsapp.net","groupadd","enabled_for_video_upgrade","latency_update_threshold","media-frt3-2.cdn.whatsapp.net","calls_row_constraint_layout","media.fgbb2-1.fna.whatsapp.net","mms4_media_retry_notification_encryption_enabled","timeout","media-sin6-3.cdn.whatsapp.net","audio_nack_jitter_multiplier","jb_discard_count_adjust_pct_rc","audio_reserve_bps","delta","account_sync","default","media.fjed4-6.fna.whatsapp.net","06","lock_video_orientation","media-frt3-1.cdn.whatsapp.net","w:g2","media-sin6-2.cdn.whatsapp.net","audio_nack_algo_mask","media.fgbb2-2.fna.whatsapp.net","media.fmed1-1.fna.whatsapp.net","cond_range_target_bitrate","mms4_server_error_receipt_encryption_enabled","vid_rc_dyn","fri","cart_v1_1_order_message_changes_enabled","reg_push","jb_hist_deposit_value","privatestats","media.fist7-2.fna.whatsapp.net","thu","jb_discard_count_adjust_pct","mon","group_call_video_maximization_enabled","mms_cat_v1_forward_hot_override_enabled","audio_nack_new_rtt","media.fsub2-3.fna.whatsapp.net","media_upload_aggressive_retry_exponential_backoff_enabled","tue","wed","media.fruh4-2.fna.whatsapp.net","audio_nack_max_seq_req","max_rtp_audio_packet_resends","jb_hist_max_cdf_value","07","audio_nack_max_jb_delay","mms_forward_partially_downloaded_video","media-lcy1-1.cdn.whatsapp.net","resume","jb_inband_fec_aware","new_commerce_entry_point_enabled","480","payments_upi_generate_qr_amount_limit","sigquit_anr_detector_rollover_percent","media.fsdu2-1.fna.whatsapp.net","fbns","aud_pkt_reorder_pct","dec","stop_probing_before_accept_send","media_upload_max_aggressive_retries","edit_business_profile_new_mode_enabled","media.fhex4-1.fna.whatsapp.net","media.fjed4-3.fna.whatsapp.net","sigquit_anr_detector_64bit_rollover_percent","cond_range_ema_jb_last_delay","watls_enable_early_data_http_get","media.fsdu2-2.fna.whatsapp.net","message_qr_disambiguation_enabled","media-mxp1-1.cdn.whatsapp.net","sat","vertical","media.fruh4-5.fna.whatsapp.net","200","media-sof1-2.cdn.whatsapp.net","-1","height","product_catalog_hide_show_items_enabled","deep_copy_frm_last","tsoffline","vp8/h.264","media.fgye5-3.fna.whatsapp.net","media.ftuc1-2.fna.whatsapp.net","smb_upsell_chat_banner_enabled","canonical","08","9",".","media.fgyd4-4.fna.whatsapp.net","media.fsti4-1.fna.whatsapp.net","mms_vcache_aggregation_enabled","mms_hot_content_timespan_in_seconds","nse_ver","rte","third_party_sticker_web_sync","cond_range_target_total_bitrate","media_upload_aggressive_retry_enabled","instrument_spam_report_enabled","disable_reconnect_tone","move_media_folder_from_sister_app","one_tap_calling_in_group_chat_size","10","storage_mgmt_banner_threshold_mb","enable_backup_passive_mode","sharechat_inline_player_enabled","media.fcnq2-1.fna.whatsapp.net","media.fhex4-2.fna.whatsapp.net","media.fist6-3.fna.whatsapp.net","ephemeral_drop_column_stage","reconnecting_after_network_change_threshold_ms","media-lhr8-2.cdn.whatsapp.net","cond_jb_last_delay_ema_alpha","entry_point_block_logging_enabled","critical_event_upload_log_config","respect_initial_bitrate_estimate","smaller_image_thumbs_status_enabled","media.fbtz1-4.fna.whatsapp.net","media.fjed4-1.fna.whatsapp.net","width","720","enable_frame_dropper","enable_one_side_mode","urn:xmpp:whatsapp:dirty","new_sticker_animation_behavior_v2","media.flim3-2.fna.whatsapp.net","media.fuio6-2.fna.whatsapp.net","skip_forced_signaling","dleq_proof","status_video_max_bitrate","lazy_send_probing_req","enhanced_storage_management","android_privatestats_endpoint_dit_enabled","media.fscl13-2.fna.whatsapp.net","video_duration"];t.DICTIONARY_0_TOKEN=n;const r=["group_call_discoverability_enabled","media.faep9-2.fna.whatsapp.net","msgr","bloks_loggedin_access_app_id","db_status_migration_step","watls_prefer_ip6","jabber:iq:privacy","68","media.fsaw1-11.fna.whatsapp.net","mms4_media_conn_persist_enabled","animated_stickers_thread_clean_up","media.fcgk3-2.fna.whatsapp.net","media.fcgk4-6.fna.whatsapp.net","media.fgye5-2.fna.whatsapp.net","media.flpb1-1.fna.whatsapp.net","media.fsub2-1.fna.whatsapp.net","media.fuio6-3.fna.whatsapp.net","not-allowed","partial_pjpeg_bw_threshold","cap_estimated_bitrate","mms_chatd_resume_check_over_thrift","smb_upsell_business_profile_enabled","product_catalog_webclient","groups","sigquit_anr_detector_release_updated_rollout","syncd_key_rotation_enabled","media.fdmm2-1.fna.whatsapp.net","media-hou1-1.cdn.whatsapp.net","remove_old_chat_notifications","smb_biztools_deeplink_enabled","use_downloadable_filters_int","group_qr_codes_enabled","max_receipt_processing_time","optimistic_image_processing_enabled","smaller_video_thumbs_status_enabled","watls_early_data","reconnecting_before_relay_failover_threshold_ms","cond_range_packet_loss_pct","groups_privacy_blacklist","status-revoke-drop","stickers_animated_thumbnail_download","dedupe_transcode_shared_images","dedupe_transcode_shared_videos","media.fcnq2-2.fna.whatsapp.net","media.fgyd4-1.fna.whatsapp.net","media.fist7-1.fna.whatsapp.net","media.flim3-3.fna.whatsapp.net","add_contact_by_qr_enabled","https://faq.whatsapp.com/payments","multicast_limit_global","sticker_notification_preview","smb_better_catalog_list_adapters_enabled","bloks_use_minscript_android","pen_smoothing_enabled","media.fcgk4-5.fna.whatsapp.net","media.fevn1-3.fna.whatsapp.net","media.fpoj7-1.fna.whatsapp.net","media-arn2-2.cdn.whatsapp.net","reconnecting_before_network_change_threshold_ms","android_media_use_fresco_for_gifs","cond_in_congestion","status_image_max_edge","sticker_search_enabled","starred_stickers_web_sync","db_blank_me_jid_migration_step","media.fist6-2.fna.whatsapp.net","media.ftuc1-1.fna.whatsapp.net","09","anr_fast_logs_upload_rollout","camera_core_integration_enabled","11","third_party_sticker_caching","thread_dump_contact_support","wam_privatestats_enabled","vcard_as_document_size_kb","maxfpp","fbip","ephemeral_allow_group_members","media-bom1-2.cdn.whatsapp.net","media-xsp1-1.cdn.whatsapp.net","disable_prewarm","frequently_forwarded_max","media.fbtz1-5.fna.whatsapp.net","media.fevn7-1.fna.whatsapp.net","media.fgyd4-2.fna.whatsapp.net","sticker_tray_animation_fully_visible_items","green_alert_banner_duration","reconnecting_after_p2p_failover_threshold_ms","connected","share_biz_vcard_enabled","stickers_animation","0a","1200","WhatsApp","group_description_length","p_v_id","payments_upi_intent_transaction_limit","frequently_forwarded_messages","media-xsp1-2.cdn.whatsapp.net","media.faep8-1.fna.whatsapp.net","media.faep8-2.fna.whatsapp.net","media.faep9-1.fna.whatsapp.net","media.fdmm2-2.fna.whatsapp.net","media.fgzt3-1.fna.whatsapp.net","media.flim4-2.fna.whatsapp.net","media.frao1-1.fna.whatsapp.net","media.fscl9-2.fna.whatsapp.net","media.fsub2-2.fna.whatsapp.net","superadmin","media.fbog10-1.fna.whatsapp.net","media.fcgh28-1.fna.whatsapp.net","media.fjdo10-1.fna.whatsapp.net","third_party_animated_sticker_import","delay_fec","attachment_picker_refresh","android_linked_devices_re_auth_enabled","rc_dyn","green_alert_block_jitter","add_contact_logging_enabled","biz_message_logging_enabled","conversation_media_preview_v2","media-jnb1-1.cdn.whatsapp.net","ab_key","media.fcgk4-2.fna.whatsapp.net","media.fevn1-1.fna.whatsapp.net","media.fist6-1.fna.whatsapp.net","media.fruh4-4.fna.whatsapp.net","media.fsti4-2.fna.whatsapp.net","mms_vcard_autodownload_size_kb","watls_enabled","notif_ch_override_off","media.fsaw1-14.fna.whatsapp.net","media.fscl13-1.fna.whatsapp.net","db_group_participant_migration_step","1020","cond_range_sterm_rtt","invites_logging_enabled","triggered_block_enabled","group_call_max_participants","media-iad3-1.cdn.whatsapp.net","product_catalog_open_deeplink","shops_required_tos_version","image_max_kbytes","cond_low_quality_vid_mode","db_receipt_migration_step","jb_early_prob_hist_shrink","media.fdmm2-3.fna.whatsapp.net","media.fdmm2-4.fna.whatsapp.net","media.fruh4-1.fna.whatsapp.net","media.fsaw2-2.fna.whatsapp.net","remove_geolocation_videos","new_animation_behavior","fieldstats_beacon_chance","403","authkey_reset_on_ban","continuous_ptt_playback","reconnecting_after_relay_failover_threshold_ms","false","group","sun","conversation_swipe_to_reply","ephemeral_messages_setting","smaller_video_thumbs_enabled","md_device_sync_enabled","bloks_shops_pdp_url_regex","lasso_integration_enabled","media-bom1-1.cdn.whatsapp.net","new_backup_format_enabled","256","media.faep6-1.fna.whatsapp.net","media.fasr1-1.fna.whatsapp.net","media.fbtz1-7.fna.whatsapp.net","media.fesb4-1.fna.whatsapp.net","media.fjdo1-2.fna.whatsapp.net","media.frba2-1.fna.whatsapp.net","watls_no_dns","600","db_broadcast_me_jid_migration_step","new_wam_runtime_enabled","group_update","enhanced_block_enabled","sync_wifi_threshold_kb","mms_download_nc_cat","bloks_minification_enabled","ephemeral_messages_enabled","reject","voip_outgoing_xml_signaling","creator","dl_bw","payments_request_messages","target_bitrate","bloks_rendercore_enabled","media-hbe1-1.cdn.whatsapp.net","media-hel3-1.cdn.whatsapp.net","media-kut2-2.cdn.whatsapp.net","media-lax3-1.cdn.whatsapp.net","media-lax3-2.cdn.whatsapp.net","sticker_pack_deeplink_enabled","hq_image_bw_threshold","status_info","voip","dedupe_transcode_videos","grp_uii_cleanup","linked_device_max_count","media.flim1-1.fna.whatsapp.net","media.fsaw2-1.fna.whatsapp.net","reconnecting_after_call_active_threshold_ms","1140","catalog_pdp_new_design","media.fbtz1-10.fna.whatsapp.net","media.fsaw1-15.fna.whatsapp.net","0b","consumer_rc_provider","mms_async_fast_forward_ttl","jb_eff_size_fix","voip_incoming_xml_signaling","media_provider_share_by_uuid","suspicious_links","dedupe_transcode_images","green_alert_modal_start","media-cgk1-1.cdn.whatsapp.net","media-lga3-1.cdn.whatsapp.net","template_doc_mime_types","important_messages","user_add","vcard_max_size_kb","media.fada2-1.fna.whatsapp.net","media.fbog2-5.fna.whatsapp.net","media.fbtz1-3.fna.whatsapp.net","media.fcgk3-1.fna.whatsapp.net","media.fcgk7-1.fna.whatsapp.net","media.flim1-3.fna.whatsapp.net","media.fscl9-1.fna.whatsapp.net","ctwa_context_enterprise_enabled","media.fsaw1-13.fna.whatsapp.net","media.fuio11-2.fna.whatsapp.net","status_collapse_muted","db_migration_level_force","recent_stickers_web_sync","bloks_session_state","bloks_shops_enabled","green_alert_setting_deep_links_enabled","restrict_groups","battery","green_alert_block_start","refresh","ctwa_context_enabled","md_messaging_enabled","status_image_quality","md_blocklist_v2_server","media-del1-1.cdn.whatsapp.net","13","userrate","a_v_id","cond_rtt_ema_alpha","invalid"];t.DICTIONARY_1_TOKEN=r;const i=["media.fada1-1.fna.whatsapp.net","media.fadb3-2.fna.whatsapp.net","media.fbhz2-1.fna.whatsapp.net","media.fcor2-1.fna.whatsapp.net","media.fjed4-2.fna.whatsapp.net","media.flhe4-1.fna.whatsapp.net","media.frak1-2.fna.whatsapp.net","media.fsub6-3.fna.whatsapp.net","media.fsub6-7.fna.whatsapp.net","media.fvvi1-1.fna.whatsapp.net","search_v5_eligible","wam_real_time_enabled","report_disk_event","max_tx_rott_based_bitrate","product","media.fjdo10-2.fna.whatsapp.net","video_frame_crc_sample_interval","media_max_autodownload","15","h.264","wam_privatestats_buffer_count","md_phash_v2_enabled","account_transfer_enabled","business_product_catalog","enable_non_dyn_codec_param_fix","is_user_under_epd_jurisdiction","media.fbog2-4.fna.whatsapp.net","media.fbtz1-2.fna.whatsapp.net","media.fcfc1-1.fna.whatsapp.net","media.fjed4-5.fna.whatsapp.net","media.flhe4-2.fna.whatsapp.net","media.flim1-2.fna.whatsapp.net","media.flos5-1.fna.whatsapp.net","android_key_store_auth_ver","010","anr_process_monitor","delete_old_auth_key","media.fcor10-3.fna.whatsapp.net","storage_usage_enabled","android_camera2_support_level","dirty","consumer_content_provider","status_video_max_duration","0c","bloks_cache_enabled","media.fadb2-2.fna.whatsapp.net","media.fbko1-1.fna.whatsapp.net","media.fbtz1-9.fna.whatsapp.net","media.fcgk4-4.fna.whatsapp.net","media.fesb4-2.fna.whatsapp.net","media.fevn1-2.fna.whatsapp.net","media.fist2-4.fna.whatsapp.net","media.fjdo1-1.fna.whatsapp.net","media.fruh4-6.fna.whatsapp.net","media.fsrg5-1.fna.whatsapp.net","media.fsub6-6.fna.whatsapp.net","minfpp","5000","locales","video_max_bitrate","use_new_auth_key","bloks_http_enabled","heartbeat_interval","media.fbog11-1.fna.whatsapp.net","ephemeral_group_query_ts","fec_nack","search_in_storage_usage","c","media-amt2-1.cdn.whatsapp.net","linked_devices_ui_enabled","14","async_data_load_on_startup","voip_incoming_xml_ack","16","db_migration_step","init_bwe","max_participants","wam_buffer_count","media.fada2-2.fna.whatsapp.net","media.fadb3-1.fna.whatsapp.net","media.fcor2-2.fna.whatsapp.net","media.fdiy1-2.fna.whatsapp.net","media.frba3-2.fna.whatsapp.net","media.fsaw2-3.fna.whatsapp.net","1280","status_grid_enabled","w:biz","product_catalog_deeplink","media.fgye10-2.fna.whatsapp.net","media.fuio11-1.fna.whatsapp.net","optimistic_upload","work_manager_init","lc","catalog_message","cond_net_medium","enable_periodical_aud_rr_processing","cond_range_ema_rtt","media-tir2-1.cdn.whatsapp.net","frame_ms","group_invite_sending","payments_web_enabled","wallpapers_v2","0d","browser","hq_image_max_edge","image_edit_zoom","linked_devices_re_auth_enabled","media.faly3-2.fna.whatsapp.net","media.fdoh5-3.fna.whatsapp.net","media.fesb3-1.fna.whatsapp.net","media.fknu1-1.fna.whatsapp.net","media.fmex3-1.fna.whatsapp.net","media.fruh4-3.fna.whatsapp.net","255","web_upgrade_to_md_modal","audio_piggyback_timeout_msec","enable_audio_oob_fec_feature","from_ip","image_max_edge","message_qr_enabled","powersave","receipt_pre_acking","video_max_edge","full","011","012","enable_audio_oob_fec_for_sender","md_voip_enabled","enable_privatestats","max_fec_ratio","payments_cs_faq_url","media-xsp1-3.cdn.whatsapp.net","hq_image_quality","media.fasr1-2.fna.whatsapp.net","media.fbog3-1.fna.whatsapp.net","media.ffjr1-6.fna.whatsapp.net","media.fist2-3.fna.whatsapp.net","media.flim4-3.fna.whatsapp.net","media.fpbc2-4.fna.whatsapp.net","media.fpku1-1.fna.whatsapp.net","media.frba1-1.fna.whatsapp.net","media.fudi1-1.fna.whatsapp.net","media.fvvi1-2.fna.whatsapp.net","gcm_fg_service","enable_dec_ltr_size_check","clear","lg","media.fgru11-1.fna.whatsapp.net","18","media-lga3-2.cdn.whatsapp.net","pkey","0e","max_subject","cond_range_lterm_rtt","announcement_groups","biz_profile_options","s_t","media.fabv2-1.fna.whatsapp.net","media.fcai3-1.fna.whatsapp.net","media.fcgh1-1.fna.whatsapp.net","media.fctg1-4.fna.whatsapp.net","media.fdiy1-1.fna.whatsapp.net","media.fisb4-1.fna.whatsapp.net","media.fpku1-2.fna.whatsapp.net","media.fros9-1.fna.whatsapp.net","status_v3_text","usync_sidelist","17","announcement","...","md_group_notification","0f","animated_pack_in_store","013","America/Mexico_City","1260","media-ams4-1.cdn.whatsapp.net","media-cgk1-2.cdn.whatsapp.net","media-cpt1-1.cdn.whatsapp.net","media-maa2-1.cdn.whatsapp.net","media.fgye10-1.fna.whatsapp.net","e","catalog_cart","hfm_string_changes","init_bitrate","packless_hsm","group_info","America/Belem","50","960","cond_range_bwe","decode","encode","media.fada1-8.fna.whatsapp.net","media.fadb1-2.fna.whatsapp.net","media.fasu6-1.fna.whatsapp.net","media.fbog4-1.fna.whatsapp.net","media.fcgk9-2.fna.whatsapp.net","media.fdoh5-2.fna.whatsapp.net","media.ffjr1-2.fna.whatsapp.net","media.fgua1-1.fna.whatsapp.net","media.fgye1-1.fna.whatsapp.net","media.fist1-4.fna.whatsapp.net","media.fpbc2-2.fna.whatsapp.net","media.fres2-1.fna.whatsapp.net","media.fsdq1-2.fna.whatsapp.net","media.fsub6-5.fna.whatsapp.net","profilo_enabled","template_hsm","use_disorder_prefetching_timer","video_codec_priority","vpx_max_qp","ptt_reduce_recording_delay","25","iphone","Windows","s_o","Africa/Lagos","abt","media-kut2-1.cdn.whatsapp.net","media-mba1-1.cdn.whatsapp.net","media-mxp1-2.cdn.whatsapp.net","md_blocklist_v2","url_text","enable_short_offset","group_join_permissions","enable_audio_piggyback_feature","image_quality","media.fcgk7-2.fna.whatsapp.net","media.fcgk8-2.fna.whatsapp.net","media.fclo7-1.fna.whatsapp.net","media.fcmn1-1.fna.whatsapp.net","media.feoh1-1.fna.whatsapp.net","media.fgyd4-3.fna.whatsapp.net","media.fjed4-4.fna.whatsapp.net","media.flim1-4.fna.whatsapp.net","media.flim2-4.fna.whatsapp.net","media.fplu6-1.fna.whatsapp.net","media.frak1-1.fna.whatsapp.net","media.fsdq1-1.fna.whatsapp.net","to_ip","015","vp8","19","21","1320","auth_key_ver","message_processing_dedup","server-error","wap4_enabled","420","014","cond_range_rtt","ptt_fast_lock_enabled","media-ort2-1.cdn.whatsapp.net","fwd_ui_start_ts"];t.DICTIONARY_2_TOKEN=i;const a=["contact_blacklist","Asia/Jakarta","media.fepa10-1.fna.whatsapp.net","media.fmex10-3.fna.whatsapp.net","disorder_prefetching_start_when_empty","America/Bogota","use_local_probing_rx_bitrate","America/Argentina/Buenos_Aires","cross_post","media.fabb1-1.fna.whatsapp.net","media.fbog4-2.fna.whatsapp.net","media.fcgk9-1.fna.whatsapp.net","media.fcmn2-1.fna.whatsapp.net","media.fdel3-1.fna.whatsapp.net","media.ffjr1-1.fna.whatsapp.net","media.fgdl5-1.fna.whatsapp.net","media.flpb1-2.fna.whatsapp.net","media.fmex2-1.fna.whatsapp.net","media.frba2-2.fna.whatsapp.net","media.fros2-2.fna.whatsapp.net","media.fruh2-1.fna.whatsapp.net","media.fybz2-2.fna.whatsapp.net","options","20","a","017","018","mute_always","user_notice","Asia/Kolkata","gif_provider","locked","media-gua1-1.cdn.whatsapp.net","piggyback_exclude_force_flush","24","media.frec39-1.fna.whatsapp.net","user_remove","file_max_size","cond_packet_loss_pct_ema_alpha","media.facc1-1.fna.whatsapp.net","media.fadb2-1.fna.whatsapp.net","media.faly3-1.fna.whatsapp.net","media.fbdo6-2.fna.whatsapp.net","media.fcmn2-2.fna.whatsapp.net","media.fctg1-3.fna.whatsapp.net","media.ffez1-2.fna.whatsapp.net","media.fist1-3.fna.whatsapp.net","media.fist2-2.fna.whatsapp.net","media.flim2-2.fna.whatsapp.net","media.fmct2-3.fna.whatsapp.net","media.fpei3-1.fna.whatsapp.net","media.frba3-1.fna.whatsapp.net","media.fsdu8-2.fna.whatsapp.net","media.fstu2-1.fna.whatsapp.net","media_type","receipt_agg","016","enable_pli_for_crc_mismatch","live","enc_rekey","frskmsg","d","media.fdel11-2.fna.whatsapp.net","proto","2250","audio_piggyback_enable_cache","skip_nack_if_ltrp_sent","mark_dtx_jb_frames","web_service_delay","7282","catalog_send_all","outgoing","360","30","LIMITED","019","audio_picker","bpv2_phase","media.fada1-7.fna.whatsapp.net","media.faep7-1.fna.whatsapp.net","media.fbko1-2.fna.whatsapp.net","media.fbni1-2.fna.whatsapp.net","media.fbtz1-1.fna.whatsapp.net","media.fbtz1-8.fna.whatsapp.net","media.fcjs3-1.fna.whatsapp.net","media.fesb3-2.fna.whatsapp.net","media.fgdl5-4.fna.whatsapp.net","media.fist2-1.fna.whatsapp.net","media.flhe2-2.fna.whatsapp.net","media.flim2-1.fna.whatsapp.net","media.fmex1-1.fna.whatsapp.net","media.fpat3-2.fna.whatsapp.net","media.fpat3-3.fna.whatsapp.net","media.fros2-1.fna.whatsapp.net","media.fsdu8-1.fna.whatsapp.net","media.fsub3-2.fna.whatsapp.net","payments_chat_plugin","cond_congestion_no_rtcp_thr","green_alert","not-a-biz","..","shops_pdp_urls_config","source","media-dus1-1.cdn.whatsapp.net","mute_video","01b","currency","max_keys","resume_check","contact_array","qr_scanning","23","b","media.fbfh15-1.fna.whatsapp.net","media.flim22-1.fna.whatsapp.net","media.fsdu11-1.fna.whatsapp.net","media.fsdu15-1.fna.whatsapp.net","Chrome","fts_version","60","media.fada1-6.fna.whatsapp.net","media.faep4-2.fna.whatsapp.net","media.fbaq5-1.fna.whatsapp.net","media.fbni1-1.fna.whatsapp.net","media.fcai3-2.fna.whatsapp.net","media.fdel3-2.fna.whatsapp.net","media.fdmm3-2.fna.whatsapp.net","media.fhex3-1.fna.whatsapp.net","media.fisb4-2.fna.whatsapp.net","media.fkhi5-2.fna.whatsapp.net","media.flos2-1.fna.whatsapp.net","media.fmct2-1.fna.whatsapp.net","media.fntr7-1.fna.whatsapp.net","media.frak3-1.fna.whatsapp.net","media.fruh5-2.fna.whatsapp.net","media.fsub6-1.fna.whatsapp.net","media.fuab1-2.fna.whatsapp.net","media.fuio1-1.fna.whatsapp.net","media.fver1-1.fna.whatsapp.net","media.fymy1-1.fna.whatsapp.net","product_catalog","1380","audio_oob_fec_max_pkts","22","254","media-ort2-2.cdn.whatsapp.net","media-sjc3-1.cdn.whatsapp.net","1600","01a","01c","405","key_frame_interval","body","media.fcgh20-1.fna.whatsapp.net","media.fesb10-2.fna.whatsapp.net","125","2000","media.fbsb1-1.fna.whatsapp.net","media.fcmn3-2.fna.whatsapp.net","media.fcpq1-1.fna.whatsapp.net","media.fdel1-2.fna.whatsapp.net","media.ffor2-1.fna.whatsapp.net","media.fgdl1-4.fna.whatsapp.net","media.fhex2-1.fna.whatsapp.net","media.fist1-2.fna.whatsapp.net","media.fjed5-2.fna.whatsapp.net","media.flim6-4.fna.whatsapp.net","media.flos2-2.fna.whatsapp.net","media.fntr6-2.fna.whatsapp.net","media.fpku3-2.fna.whatsapp.net","media.fros8-1.fna.whatsapp.net","media.fymy1-2.fna.whatsapp.net","ul_bw","ltrp_qp_offset","request","nack","dtx_delay_state_reset","timeoffline","28","01f","32","enable_ltr_pool","wa_msys_crypto","01d","58","dtx_freeze_hg_update","nack_if_rpsi_throttled","253","840","media.famd15-1.fna.whatsapp.net","media.fbog17-2.fna.whatsapp.net","media.fcai19-2.fna.whatsapp.net","media.fcai21-4.fna.whatsapp.net","media.fesb10-4.fna.whatsapp.net","media.fesb10-5.fna.whatsapp.net","media.fmaa12-1.fna.whatsapp.net","media.fmex11-3.fna.whatsapp.net","media.fpoa33-1.fna.whatsapp.net","1050","021","clean","cond_range_ema_packet_loss_pct","media.fadb6-5.fna.whatsapp.net","media.faqp4-1.fna.whatsapp.net","media.fbaq3-1.fna.whatsapp.net","media.fbel2-1.fna.whatsapp.net","media.fblr4-2.fna.whatsapp.net","media.fclo8-1.fna.whatsapp.net","media.fcoo1-2.fna.whatsapp.net","media.ffjr1-4.fna.whatsapp.net","media.ffor9-1.fna.whatsapp.net","media.fisb3-1.fna.whatsapp.net","media.fkhi2-2.fna.whatsapp.net","media.fkhi4-1.fna.whatsapp.net","media.fpbc1-2.fna.whatsapp.net","media.fruh2-2.fna.whatsapp.net","media.fruh5-1.fna.whatsapp.net","media.fsub3-1.fna.whatsapp.net","payments_transaction_limit","252","27","29","tintagel","01e","237","780","callee_updated_payload","020","257","price","025","239","payments_cs_phone_number","mediaretry","w:auth:backup:token","Glass.caf","max_bitrate","240","251","660","media.fbog16-1.fna.whatsapp.net","media.fcgh21-1.fna.whatsapp.net","media.fkul19-2.fna.whatsapp.net","media.flim21-2.fna.whatsapp.net","media.fmex10-4.fna.whatsapp.net","64","33","34","35","interruption","media.fabv3-1.fna.whatsapp.net","media.fadb6-1.fna.whatsapp.net","media.fagr1-1.fna.whatsapp.net","media.famd1-1.fna.whatsapp.net","media.famm6-1.fna.whatsapp.net","media.faqp2-3.fna.whatsapp.net"];t.DICTIONARY_3_TOKEN=a;const o=[n,r,i,a];t.DICTIONARIES=o},245506:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapJid=t.WAP_JID_SUBTYPE=t.DOMAIN_TYPE=void 0;var r=n(252230);const i={JID:0,JID_U:1,JID_AD:1,JID_FB:3};t.WAP_JID_SUBTYPE=i;const a=n(654302)({WHATSAPP:0,LID:1});t.DOMAIN_TYPE=a;class o{constructor(e){this._jid=e}static createAD(e,t,n){return new o({type:i.JID_AD,user:e,device:null==n?0:n,agent:null==t?0:t,domainType:a.WHATSAPP})}static createJidU(e,t,n){return new o({type:i.JID_U,user:e,device:null==n?0:n,domainType:null==t?a.WHATSAPP:t})}static createFbJid(e,t){return new o({type:i.JID_FB,user:e,device:null==t?0:t})}static create(e,t){return new o({type:i.JID,user:e,server:t})}toString(){if(this._jid.type===i.JID_AD||this._jid.type===i.JID_U){const{user:e,device:t,domainType:n}=this._jid,i=n===a.WHATSAPP?r.WA_USER_JID_SUFFIX:r.LID_SUFFIX;return 0===t?`${e}@${i}`:`${e}:${t}@${i}`}if(this._jid.type===i.JID_FB){const{user:e,device:t}=this._jid;return`${e}:${t}@${r.MSGR_USER_JID_SUFFIX}`}{this._jid.type;const{user:e,server:t}=this._jid;return null!=e?`${e}@${t}`:t}}getInnerJid(){return this._jid}}t.WapJid=o},471914:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WapParser=void 0;var r=n(634308);t.WapParser=class{constructor(e,t){this._name=e,this._parser=t}parse(e){const t=new r.ParsableWapNode(this._name,e);try{return{success:this._parser(t)}}catch(e){if(e instanceof r.XmppParsingFailure)return{error:e};throw e}}parseOrThrow(e){const t=this.parse(e);if(t.error)throw new Error(String(t.error));return t.success}}},271610:(e,t)=>{"use strict";function n(e){return 16*parseInt((e+15)/16,10)}Object.defineProperty(t,"__esModule",{value:!0}),t.alignChunkLengthsToMultipleOfAesBlockSize=function(e,t){const r=[];let i=0,a=0,o=0;for(let s=0;s<e.length;++s){if(i+=e[s],s===e.length-1&&null!=t){i>a?r.push(t-a):(r.pop(),r.push(t-o));break}if(i>a){const e=n(i-a);o=a,r.push(e),a+=e}}return r},t.alignChunkSizeToMultipleAesBlockSize=n},541996:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.calculateFilehash=function(e){return(0,r.sha256Base64)(e)};var r=n(273045)},442658:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_MEDIA_KEY_TTL=void 0,t.isMediaKeyReusable=function(e){const t=Math.floor(Math.random()*i);return null!=e&&(0,r.happenedWithin)(e,a+t)};var r=n(892844);const i=r.DAY_SECONDS,a=2*r.DAY_SECONDS;t.MMS_MEDIA_KEY_TTL=a},31224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaConnParser=void 0;var r=n(166881);const i=new(n(471914).WapParser)("mediaConnParser",(e=>{var t,n;const r=e.child("media_conn");return{hosts:r.mapChildrenWithTag("host",o),authToken:r.attrString("auth"),authTTL:r.hasAttr("auth_ttl")?r.attrFutureTime("auth_ttl"):null,authExpires:r.attrFutureTime("ttl"),maxBuckets:r.hasAttr("max_buckets")?r.attrInt("max_buckets"):null,maxManualRetry:null!==(t=r.maybeAttrInt("max_manual_retry",0,4))&&void 0!==t?t:3,maxAutoDownloadRetry:null!==(n=r.maybeAttrInt("max_auto_download_retry",0,4))&&void 0!==n?n:3}}));function a(e){var t,n;if(e.hasAttr("fallback_hostname"))return{domain:e.attrString("fallback_hostname"),class:e.maybeAttrString("fallback_class"),ip4:null!==(t=e.maybeAttrString("fallback_ip4"))&&void 0!==t?t:void 0,ip6:null!==(n=e.maybeAttrString("fallback_ip6"))&&void 0!==n?n:void 0}}function o(e){var t,n,r,i;return{domain:e.attrString("hostname"),fallback:a(e),uploadable:s(e,"upload"),downloadable:s(e,"download"),isFallback:"fallback"===e.maybeAttrString("type"),downloadBuckets:null!==(t=null===(n=e.maybeChild("download_buckets"))||void 0===n?void 0:n.mapChildren((e=>parseInt(e.tag(),10))))&&void 0!==t?t:[],class:e.maybeAttrString("class"),ip4:null!==(r=e.maybeAttrString("ip4"))&&void 0!==r?r:void 0,ip6:null!==(i=e.maybeAttrString("ip6"))&&void 0!==i?i:void 0}}function s(e,t){return e.hasChild(t)?e.child(t).mapChildren((e=>{const t=e.tag();return(0,r.castToServerMediaType)(t)})).filter(Boolean):r.SERVER_MEDIA}t.mediaConnParser=i},166881:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_MEDIA=void 0,t.castToServerMediaType=function(e){switch(e){case"image":case"sticker":case"ptt":case"audio":case"document":case"video":case"gif":case"ppic":case"md-app-state":case"md-msg-hist":case"kyc-id":case"thumbnail-image":case"thumbnail-video":case"thumbnail-gif":case"thumbnail-document":case"thumbnail-link":case"payment-bg-image":case"novi-video":case"novi-image":case"template":case"product":case"product-catalog-image":case"xma-image":case"biz-cover-photo":return e;default:return null}};t.SERVER_MEDIA=["image","sticker","ptt","audio","document","video","gif","ppic","md-app-state","md-msg-hist","kyc-id","template","thumbnail-image","thumbnail-video","thumbnail-gif","thumbnail-document","thumbnail-link","payment-bg-image","novi-video","novi-image","product","product-catalog-image","xma-image","biz-cover-photo"]},117525:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SocketClosed=t.FrameSocket=void 0;var r=n(108584),i=n(311609);class a extends Error{constructor(e){const t="SocketClosed";super(null!=e?e:t),this.name=t}}t.SocketClosed=a;function o(e){if(e.size()<3)return!1;return s(e)<=e.size()}function s(e){return e.readUint8()<<16|e.readUint16()}t.FrameSocket=class{constructor(e,t){this._incoming=new r.Binary,this.closed=!1,this._draining=!1,this.onFrame=null,this.onClose=null,this._handleData=e=>{this._incoming.writeByteArray(e),this.convertBufferedToFrames()},this._handleClose=()=>{if(this._incoming.peek(o))return __LOG__(2)`FrameSocket closed, waiting for pending processing`,void(this._draining=!0);this._doClose()},this._doClose=()=>{if(this.closed)return;__LOG__(2)`FrameSocket closed`,this._draining=!1,this.closed=!0;const e=this.onClose;e&&e()},this._handleError=()=>{},this._introToSend=t,this._socket=e,e.onData=this._handleData,e.onClose=this._handleClose,e.onError=this._handleError}sendFrame(e){if(this._draining)return;this.throwIfClosed();const t=this._introToSend,n=e.byteLength,r=this._socket.dataToSend;t?(this._introToSend=null,r.ensureAdditionalCapacity(t.length+3+n),r.writeByteArray(t)):r.ensureAdditionalCapacity(3+n),r.writeUint8(n>>16),r.writeUint16(65535&n),r.write(e),this._assertMaxPayloadSize(),this._socket.requestSend()}_assertMaxPayloadSize(){const e=this._socket.dataToSend.size();if((2097151&e)!==e)throw this._socket.dataToSend.readBuffer(),new i.BufferTooLargeError(`Buffer too large: ${e}`)}convertBufferedToFrames(){const e=this._incoming;let t=this.onFrame;for(;t&&e.peek(o);){const n=s(e);__LOG__(2)`FrameSocket.onFrame(${n} bytes)`;t(e.readByteArray(n)),t=this.onFrame}this._draining&&!e.peek(o)&&this._doClose(),t&&e.size()&&__LOG__(2)`FrameSocket: queueing partial frame of ${e.size()} bytes`}throwIfClosed(){if(this.closed)throw new a}close(){this._socket.close()}}},110095:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseHandshake=void 0;var r=n(108584),i=n(181576),a=n(273045),o=n(311609),s=n(543891),l=n(88156);const c=Promise.reject("UNINITIALIZED HANDSHAKE"),u=new Uint8Array(0);c.catch((()=>{}));function d(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["encrypt","decrypt"];return self.crypto.subtle.importKey("raw",new Uint8Array(e),"AES-GCM",!1,t)}function f(e,t){return(0,i.extractWithSaltAndExpand)(t,new Uint8Array(e),"",64).then((e=>[e.slice(0,32),e.slice(32)]))}function _(e){e.catch((()=>{}))}t.NoiseHandshake=class{constructor(e){this._hash=c,this._salt=c,this._cryptoKey=c,this._counter=0,this._socket=e,this._rejectOnClose=new l.Resolvable,e.onClose=()=>{this._rejectOnClose.reject(new o.Disconnected("NoiseHandshake: SocketClosed"))},_(this._rejectOnClose.promise)}start(e,t){const n=r.Binary.build(e).readBuffer(),i=32===n.byteLength?Promise.resolve(n):(0,a.sha256)(n);this._hash=i,this._salt=i,this._cryptoKey=i.then(p),this.authenticate(t)}sendAndReceive(e){const t=this._socket,n=new Promise((n=>{t.onFrame=e=>{t.onFrame=null,n(e)},t.sendFrame(e)}));return this._orRejectOnClose(n)}send(e){this._socket.sendFrame(e)}authenticate(e){this._hash=Promise.all([this._hash,e]).then((e=>{let[t,n]=e;const i=r.Binary.build(t,n).readByteArray();return(0,a.sha256)(i)}))}encrypt(e){const t=this._counter++,n=Promise.all([this._cryptoKey,this._hash,e]).then((e=>{let[n,r,i]=e;return function(e,t,n,r){return self.crypto.subtle.encrypt({name:"AES-GCM",iv:d(t),additionalData:n?new Uint8Array(n):u},e,r)}(n,t,r,i)}));return this.authenticate(n),this._orRejectOnClose(n)}decrypt(e){const t=this._counter++,n=Promise.all([this._cryptoKey,this._hash]).then((n=>{let[r,i]=n;return function(e,t,n,r){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:d(t),additionalData:n?new Uint8Array(n):u},e,r)}(r,t,i,e)}));return this.authenticate(e),this._orRejectOnClose(n)}finish(){const e=this._salt.then((e=>f(e,new Uint8Array(0)))).then((e=>{let[t,n]=e;return Promise.all([p(t,["encrypt"]),p(n,["decrypt"])])})).then((e=>{let[t,n]=e;return new s.NoiseSocket(this._socket,t,n)}));return this._orRejectOnClose(e)}mixIntoKey(e){this._counter=0;const t=Promise.all([this._salt,e]).then((e=>{let[t,n]=e;return f(t,new Uint8Array(n))}));this._salt=t.then((e=>e[0])),this._cryptoKey=t.then((e=>p(e[1]))),_(this._salt),_(this._cryptoKey)}_orRejectOnClose(e){return Promise.race([e,this._rejectOnClose.promise]).then((e=>this._rejectOnClose.resolveWasCalled()?this._rejectOnClose.promise:e))}}},543891:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseSocket=void 0;var i=r(n(311504)),a=n(927870);const o=Promise.reject("UNINITIALIZED HANDSHAKE"),s=new Uint8Array(0);o.catch((()=>{}));function l(e){const t=new ArrayBuffer(12);return new DataView(t).setUint32(8,e),new Uint8Array(t)}t.NoiseSocket=class{constructor(e,t,n){this._incoming=[],this._readQueue=new a.PromiseQueue,this._sendQueue=new a.PromiseQueue,this._readCounter=0,this._writeCounter=0,this._draining=!1,this._sendCiphertextFrame=e=>{this._socket.closed?__LOG__(2)`NoiseSocket socket closed while encrypting frame`:this._socket.sendFrame(e)},this._handleCiphertext=e=>{const t=this._readCounter++;this._readQueue.enqueueHandlers(function(e,t,n,r){return self.crypto.subtle.decrypt({name:"AES-GCM",iv:l(t),additionalData:n?new Uint8Array(n):s},e,r)}(this._readKey,t,void 0,e),this._handlePlaintext)},this._handleOnClose=()=>{this._draining=!0,this._readQueue.wait().then((()=>{this._draining=!1;const e=this._onClose;e&&e()}))},this._handlePlaintext=e=>{this._onFrame?this._onFrame(e):this._incoming.push(e)},this._socket=e,this._writeKey=t,this._readKey=n,e.onFrame=this._handleCiphertext,this._socket.onClose=this._handleOnClose,e.convertBufferedToFrames()}sendFrameAsync(e){var t=this;return(0,i.default)((function*(){return yield t.sendFrame(e)}))()}sendFrame(e){if(this._draining)return Promise.resolve();this._socket.throwIfClosed();const t=this._writeCounter++;return this._sendQueue.enqueueHandlers((n=this._writeKey,r=t,i=void 0,a=e,self.crypto.subtle.encrypt({name:"AES-GCM",iv:l(r),additionalData:i?new Uint8Array(i):s},n,a)),this._sendCiphertextFrame);var n,r,i,a}setOnFrame(e){this._onFrame=e}setOnClose(e){this._onClose=e}close(){this._socket.close()}}},944396:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleError=function(e){return a.parse(e),"NO_ACK"};var r=n(471914);const i=479,a=new r.WapParser("errorParser",(e=>{e.assertTag("error");const t=e.attrInt("code");switch(t){case i:return __LOG__(4,void 0,new Error,!0)`Invalid stanza sent (smax-invalid)`,void SEND_LOGS("smax-invalid");default:return function(e){__LOG__(4,void 0,new Error,!0)`Unknown error code: ${e}`,SEND_LOGS("unknown-error-code")}(t)}}))},370910:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var i=r(n(73982)),a=n(401390);const o=(0,i.default)({},null);t.MessageKeySpec=o,o.internalSpec={remoteJid:[1,a.TYPES.STRING],fromMe:[2,a.TYPES.BOOL],id:[3,a.TYPES.STRING],participant:[4,a.TYPES.STRING]}},550073:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdVersionSpec=t.SyncdValueSpec=t.SyncdSnapshotSpec=t.SyncdRecordSpec=t.SyncdPatchSpec=t.SyncdMutationsSpec=t.SyncdMutationSpec=t.SyncdMutation$SyncdOperation=t.SyncdIndexSpec=t.KeyIdSpec=t.ExternalBlobReferenceSpec=t.ExitCodeSpec=void 0;var i=r(n(73982)),a=n(401390);const o=n(654302)({SET:0,REMOVE:1});t.SyncdMutation$SyncdOperation=o;const s=(0,i.default)({},null);t.SyncdVersionSpec=s;const l=(0,i.default)({},null);t.ExitCodeSpec=l;const c=(0,i.default)({},null);t.SyncdIndexSpec=c;const u=(0,i.default)({},null);t.SyncdValueSpec=u;const d=(0,i.default)({},null);t.KeyIdSpec=d;const p=(0,i.default)({},null);t.SyncdRecordSpec=p;const f=(0,i.default)({},null);t.ExternalBlobReferenceSpec=f;const _=(0,i.default)({},null);t.SyncdSnapshotSpec=_;const h=(0,i.default)({},null);t.SyncdMutationsSpec=h;const g=(0,i.default)({},null);t.SyncdMutationSpec=g;const m=(0,i.default)({},null);t.SyncdPatchSpec=m,s.internalSpec={version:[1,a.TYPES.UINT64]},l.internalSpec={code:[1,a.TYPES.UINT64],text:[2,a.TYPES.STRING]},c.internalSpec={blob:[1,a.TYPES.BYTES]},u.internalSpec={blob:[1,a.TYPES.BYTES]},d.internalSpec={id:[1,a.TYPES.BYTES]},p.internalSpec={index:[1,a.TYPES.MESSAGE,c],value:[2,a.TYPES.MESSAGE,u],keyId:[3,a.TYPES.MESSAGE,d]},f.internalSpec={mediaKey:[1,a.TYPES.BYTES],directPath:[2,a.TYPES.STRING],handle:[3,a.TYPES.STRING],fileSizeBytes:[4,a.TYPES.UINT64],fileSha256:[5,a.TYPES.BYTES],fileEncSha256:[6,a.TYPES.BYTES]},_.internalSpec={version:[1,a.TYPES.MESSAGE,s],records:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,p],mac:[3,a.TYPES.BYTES],keyId:[4,a.TYPES.MESSAGE,d]},h.internalSpec={mutations:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,g]},g.internalSpec={operation:[1,a.TYPES.ENUM,o],record:[2,a.TYPES.MESSAGE,p]},m.internalSpec={version:[1,a.TYPES.MESSAGE,s],mutations:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,g],externalMutations:[3,a.TYPES.MESSAGE,f],snapshotMac:[4,a.TYPES.BYTES],patchMac:[5,a.TYPES.BYTES],keyId:[6,a.TYPES.MESSAGE,d],exitCode:[7,a.TYPES.MESSAGE,l],deviceIndex:[8,a.TYPES.UINT32]}},381:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionValueSpec=t.SyncActionValue$UserStatusMuteActionSpec=t.SyncActionValue$UnarchiveChatsSettingSpec=t.SyncActionValue$TimeFormatActionSpec=t.SyncActionValue$SyncActionMessageSpec=t.SyncActionValue$SyncActionMessageRangeSpec=t.SyncActionValue$SubscriptionActionSpec=t.SyncActionValue$StickerActionSpec=t.SyncActionValue$StarActionSpec=t.SyncActionValue$SecurityNotificationSettingSpec=t.SyncActionValue$RecentEmojiWeightsActionSpec=t.SyncActionValue$QuickReplyActionSpec=t.SyncActionValue$PushNameSettingSpec=t.SyncActionValue$PrimaryVersionActionSpec=t.SyncActionValue$PrimaryFeatureSpec=t.SyncActionValue$PinActionSpec=t.SyncActionValue$NuxActionSpec=t.SyncActionValue$MuteActionSpec=t.SyncActionValue$MarkChatAsReadActionSpec=t.SyncActionValue$LocaleSettingSpec=t.SyncActionValue$LabelEditActionSpec=t.SyncActionValue$LabelAssociationActionSpec=t.SyncActionValue$KeyExpirationSpec=t.SyncActionValue$DeleteMessageForMeActionSpec=t.SyncActionValue$DeleteChatActionSpec=t.SyncActionValue$ContactActionSpec=t.SyncActionValue$ClearChatActionSpec=t.SyncActionValue$ArchiveChatActionSpec=t.SyncActionValue$AndroidUnsupportedActionsSpec=t.SyncActionValue$AgentActionSpec=t.SyncActionDataSpec=t.RecentEmojiWeightSpec=void 0;var i=r(n(73982)),a=n(401390),o=n(370910);const s=(0,i.default)({},null);t.RecentEmojiWeightSpec=s;const l=(0,i.default)({},null);t.SyncActionValueSpec=l;const c=(0,i.default)({},null);t.SyncActionValue$StickerActionSpec=c;const u=(0,i.default)({},null);t.SyncActionValue$PrimaryVersionActionSpec=u;const d=(0,i.default)({},null);t.SyncActionValue$NuxActionSpec=d;const p=(0,i.default)({},null);t.SyncActionValue$TimeFormatActionSpec=p;const f=(0,i.default)({},null);t.SyncActionValue$UserStatusMuteActionSpec=f;const _=(0,i.default)({},null);t.SyncActionValue$SubscriptionActionSpec=_;const h=(0,i.default)({},null);t.SyncActionValue$AgentActionSpec=h;const g=(0,i.default)({},null);t.SyncActionValue$AndroidUnsupportedActionsSpec=g;const m=(0,i.default)({},null);t.SyncActionValue$PrimaryFeatureSpec=m;const y=(0,i.default)({},null);t.SyncActionValue$KeyExpirationSpec=y;const S=(0,i.default)({},null);t.SyncActionValue$SyncActionMessageSpec=S;const E=(0,i.default)({},null);t.SyncActionValue$SyncActionMessageRangeSpec=E;const v=(0,i.default)({},null);t.SyncActionValue$UnarchiveChatsSettingSpec=v;const T=(0,i.default)({},null);t.SyncActionValue$DeleteChatActionSpec=T;const C=(0,i.default)({},null);t.SyncActionValue$ClearChatActionSpec=C;const A=(0,i.default)({},null);t.SyncActionValue$MarkChatAsReadActionSpec=A;const b=(0,i.default)({},null);t.SyncActionValue$DeleteMessageForMeActionSpec=b;const P=(0,i.default)({},null);t.SyncActionValue$ArchiveChatActionSpec=P;const O=(0,i.default)({},null);t.SyncActionValue$RecentEmojiWeightsActionSpec=O;const M=(0,i.default)({},null);t.SyncActionValue$LabelEditActionSpec=M;const I=(0,i.default)({},null);t.SyncActionValue$LabelAssociationActionSpec=I;const w=(0,i.default)({},null);t.SyncActionValue$QuickReplyActionSpec=w;const R=(0,i.default)({},null);t.SyncActionValue$LocaleSettingSpec=R;const N=(0,i.default)({},null);t.SyncActionValue$PushNameSettingSpec=N;const L=(0,i.default)({},null);t.SyncActionValue$SecurityNotificationSettingSpec=L;const D=(0,i.default)({},null);t.SyncActionValue$PinActionSpec=D;const k=(0,i.default)({},null);t.SyncActionValue$MuteActionSpec=k;const U=(0,i.default)({},null);t.SyncActionValue$ContactActionSpec=U;const G=(0,i.default)({},null);t.SyncActionValue$StarActionSpec=G;const x=(0,i.default)({},null);t.SyncActionDataSpec=x,s.internalSpec={emoji:[1,a.TYPES.STRING],weight:[2,a.TYPES.FLOAT]},l.internalSpec={timestamp:[1,a.TYPES.INT64],starAction:[2,a.TYPES.MESSAGE,G],contactAction:[3,a.TYPES.MESSAGE,U],muteAction:[4,a.TYPES.MESSAGE,k],pinAction:[5,a.TYPES.MESSAGE,D],securityNotificationSetting:[6,a.TYPES.MESSAGE,L],pushNameSetting:[7,a.TYPES.MESSAGE,N],quickReplyAction:[8,a.TYPES.MESSAGE,w],recentEmojiWeightsAction:[11,a.TYPES.MESSAGE,O],labelEditAction:[14,a.TYPES.MESSAGE,M],labelAssociationAction:[15,a.TYPES.MESSAGE,I],localeSetting:[16,a.TYPES.MESSAGE,R],archiveChatAction:[17,a.TYPES.MESSAGE,P],deleteMessageForMeAction:[18,a.TYPES.MESSAGE,b],keyExpiration:[19,a.TYPES.MESSAGE,y],markChatAsReadAction:[20,a.TYPES.MESSAGE,A],clearChatAction:[21,a.TYPES.MESSAGE,C],deleteChatAction:[22,a.TYPES.MESSAGE,T],unarchiveChatsSetting:[23,a.TYPES.MESSAGE,v],primaryFeature:[24,a.TYPES.MESSAGE,m],androidUnsupportedActions:[26,a.TYPES.MESSAGE,g],agentAction:[27,a.TYPES.MESSAGE,h],subscriptionAction:[28,a.TYPES.MESSAGE,_],userStatusMuteAction:[29,a.TYPES.MESSAGE,f],timeFormatAction:[30,a.TYPES.MESSAGE,p],nuxAction:[31,a.TYPES.MESSAGE,d],primaryVersionAction:[32,a.TYPES.MESSAGE,u],stickerAction:[33,a.TYPES.MESSAGE,c]},c.internalSpec={url:[1,a.TYPES.STRING],fileEncSha256:[2,a.TYPES.BYTES],mediaKey:[3,a.TYPES.BYTES],mimetype:[4,a.TYPES.STRING],height:[5,a.TYPES.UINT32],width:[6,a.TYPES.UINT32],directPath:[7,a.TYPES.STRING],fileLength:[8,a.TYPES.UINT64],isFavorite:[9,a.TYPES.BOOL],deviceIdHint:[10,a.TYPES.UINT32]},u.internalSpec={version:[1,a.TYPES.STRING]},d.internalSpec={acknowledged:[1,a.TYPES.BOOL]},p.internalSpec={isTwentyFourHourFormatEnabled:[1,a.TYPES.BOOL]},f.internalSpec={muted:[1,a.TYPES.BOOL]},_.internalSpec={isDeactivated:[1,a.TYPES.BOOL],isAutoRenewing:[2,a.TYPES.BOOL],expirationDate:[3,a.TYPES.INT64]},h.internalSpec={name:[1,a.TYPES.STRING],deviceID:[2,a.TYPES.INT32],isDeleted:[3,a.TYPES.BOOL]},g.internalSpec={allowed:[1,a.TYPES.BOOL]},m.internalSpec={flags:[1,a.FLAGS.REPEATED|a.TYPES.STRING]},y.internalSpec={expiredKeyEpoch:[1,a.TYPES.INT32]},S.internalSpec={key:[1,a.TYPES.MESSAGE,o.MessageKeySpec],timestamp:[2,a.TYPES.INT64]},E.internalSpec={lastMessageTimestamp:[1,a.TYPES.INT64],lastSystemMessageTimestamp:[2,a.TYPES.INT64],messages:[3,a.FLAGS.REPEATED|a.TYPES.MESSAGE,S]},v.internalSpec={unarchiveChats:[1,a.TYPES.BOOL]},T.internalSpec={messageRange:[1,a.TYPES.MESSAGE,E]},C.internalSpec={messageRange:[1,a.TYPES.MESSAGE,E]},A.internalSpec={read:[1,a.TYPES.BOOL],messageRange:[2,a.TYPES.MESSAGE,E]},b.internalSpec={deleteMedia:[1,a.TYPES.BOOL],messageTimestamp:[2,a.TYPES.INT64]},P.internalSpec={archived:[1,a.TYPES.BOOL],messageRange:[2,a.TYPES.MESSAGE,E]},O.internalSpec={weights:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,s]},M.internalSpec={name:[1,a.TYPES.STRING],color:[2,a.TYPES.INT32],predefinedId:[3,a.TYPES.INT32],deleted:[4,a.TYPES.BOOL]},I.internalSpec={labeled:[1,a.TYPES.BOOL]},w.internalSpec={shortcut:[1,a.TYPES.STRING],message:[2,a.TYPES.STRING],keywords:[3,a.FLAGS.REPEATED|a.TYPES.STRING],count:[4,a.TYPES.INT32],deleted:[5,a.TYPES.BOOL]},R.internalSpec={locale:[1,a.TYPES.STRING]},N.internalSpec={name:[1,a.TYPES.STRING]},L.internalSpec={showNotification:[1,a.TYPES.BOOL]},D.internalSpec={pinned:[1,a.TYPES.BOOL]},k.internalSpec={muted:[1,a.TYPES.BOOL],muteEndTimestamp:[2,a.TYPES.INT64]},U.internalSpec={fullName:[1,a.TYPES.STRING],firstName:[2,a.TYPES.STRING]},G.internalSpec={starred:[1,a.TYPES.BOOL]},x.internalSpec={index:[1,a.TYPES.BYTES],value:[2,a.TYPES.MESSAGE,l],padding:[3,a.TYPES.BYTES],version:[4,a.TYPES.INT32]}},250087:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.getAbPropsProtocol=function(){return s.apply(this,arguments)};var i=r(n(311504)),a=n(287040),o=n(27467);function s(){return(s=(0,i.default)((function*(e){const t=yield(0,o.sendGetExperimentConfigRPC)({propsHash:e});if("GetExperimentConfigResponseSuccess"===t.name){const{propsAbKey:e,propsHash:n,propsRefresh:r,propsRefreshId:i,propsProp:o}=t.value;return(0,a.makeResult)({abKey:e,hash:n,refresh:r,refreshId:i,props:l(o)})}return __LOG__(3)`getAbPropsProtocol failed ${t.value}`,(0,a.makeError)()}))).apply(this,arguments)}function l(e){const t=[];return e.forEach((e=>{let{experimentOrSamplingConfigMixinGroup:n}=e;var r;"ExperimentConfig"===n.name&&t.push({configCode:n.value.configCode,configValue:n.value.configValue,configExpoKey:null===(r=n.value.configExpoKey)||void 0===r?void 0:r.toString()})})),t}},439277:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.sendPassiveModeIq=function(){return s.apply(this,arguments)};var i=r(n(311504)),a=n(695856),o=n(198390);function s(){return(s=(0,i.default)((function*(e){"active"===e?yield(0,a.sendActiveIQRPC)():yield(0,o.sendPassiveIQRPC)(),__LOG__(2)`sendPassiveModeIq: passive mode set to '${e}'`}))).apply(this,arguments)}},836229:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.logKeysInfoInIntern=function(){return I.apply(this,arguments)},t.markCollectionsForSync=A,t.reportWam=function(){return M.apply(this,arguments)},t.stateMachineTick=L,t.syncBlockedCollections=function(){const e=u.default.getCollectionsInStateBlocked();return __LOG__(2)`syncd: sync blocked collections: ${e}`,u.default.moveCollectionsToDirty(e),E=new Set([...Array.from(E),...Array.from(S)]),__LOG__(2)`syncd: syncBlockedCollections:
\tmoving blocked collections to dirty: [${e}]
\tadding inflight collections to pending: [${Array.from(S)}]`,w()},t.syncPendingMutationsAndBlockedCollections=function(){return k.apply(this,arguments)};var i=r(n(311504)),a=n(266543),o=n(852455),s=n(896005),l=n(532442),c=n(41007),u=(n(777651),r(n(611634))),d=n(960362),p=(n(463109),n(900669)),f=n(549334),_=n(912019),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(607414));function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}const m=36e5;let y,S=new Set,E=new Set,v=!1,T=0,C=0;function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){const n=null!=t?yield P(e,t):e;return __LOG__(2)`syncd: marking for sync: ${n}`,n.forEach((e=>{const t=u.default.getCollectionState(e);__LOG__(2)`syncd: ${e} state before sync: ${t}`,t===d.CollectionSyncState.UpToDate?u.default.moveCollectionsToDirty([e]):t===d.CollectionSyncState.Dirty&&(E=new Set([...Array.from(E),e]))})),yield u.default.persistToDb(),w()}))).apply(this,arguments)}function P(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){__LOG__(2)`syncd: start filter collections: ${e}`;const n=yield(0,o.bulkGetCollectionVersionsInTransaction)(e),r=new Map(e.map(((e,t)=>{var r;return[e,null===(r=n[t])||void 0===r?void 0:r.version]})));return e.filter((e=>{const n=r.get(e);if(null==n)return __LOG__(2)`syncd: local version for ${e} missing; will mark for sync.`,!0;const i=t.get(e);return null==i?(__LOG__(2)`syncd: server version for ${e} missing; will mark for sync.`,!0):n<i?(__LOG__(2)`syncd: local version (${n}) for ${e} less than server version (${i}); will mark for sync.`,!0):(__LOG__(2)`syncd: local version (${n})for ${e} >= server version (${i}); will not mark for sync.`,!1)}))}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(){const e=yield(0,c.countSyncActionsInTransaction)();h.setStoredMutationCount(e);const t=yield(0,c.getSyncActionsByActionStatesInTransaction)([d.SyncActionState.Malformed]);h.setInvalidActionCount(t.length);const n=yield(0,c.getSyncActionsByActionStatesInTransaction)([d.SyncActionState.Unsupported]);h.setUnsupportedActionCount(n.length);const r=yield(0,s.getMissingKeyCountTransaction)();h.setMissingKeyCount(r)}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(){}))).apply(this,arguments)}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(){if((0,p.isSyncdDisabled)())return Promise.resolve();const e=u.default.getCollectionsInStateDirty();__LOG__(2)`syncd: dirty collections: ${e}`;const t=new Set(e.filter((e=>!S.has(e))));if(0===t.size)return __LOG__(2)`syncd: no collections to sync`,Promise.resolve();let n=[];try{S=new Set([...Array.from(S),...Array.from(t)]),__LOG__(2)`syncd: initiate server sync`,n=yield(0,_.serverSync)(Array.from(t)),__LOG__(2)`syncd: server sync successful`;const e=n.filter((e=>e.state===d.CollectionState.ErrorRetry));e.length>0&&(C=e[0].serverBackoff||0,T=0),D(n)}catch(e){__LOG__(2)`syncd: exception during sync(): ${e}`,u.default.moveCollectionsToFiniteRetry(Array.from(t))}finally{__LOG__(2)`syncd: cleanup after sync()`,u.default.persistToDb(),S=new Set(Array.from(S).filter((e=>!t.has(e)))),L(),(0,a.getDbImpls)().handleSyncCompleted(n)}}))).apply(this,arguments)}function N(){if((0,p.isSyncdDisabled)())return;const e=new Set(u.default.getCollectionsInStateRetry());var t,n;0!==e.size&&(y=setTimeout((0,i.default)((function*(){try{v=!0,T+=1,__LOG__(2)`syncd: initiate server sync retry`;const t=yield(0,_.serverSync)(Array.from(e));__LOG__(2)`syncd: server sync retry successful`,D(t)}catch(t){__LOG__(2)`syncd: exception during handleRetry(): ${t}`,u.default.moveCollectionsToFiniteRetry(Array.from(e))}finally{__LOG__(2)`syncd: cleanup after handleRetry()`,function(){const e=u.default.getExpiredCollections();e.length>0&&(u.default.moveCollectionsToFatal(e),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: expired collections`,SEND_LOGS("syncd: fatal error: expired collections"),(0,f.reportSyncdFatalError)(f.SyncdFatalErrorType.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D))}(),u.default.persistToDb(),v=!1,L()}})),(t=T,n=C,Math.min(Math.max(2**t*1e3,n),m))))}function L(){__LOG__(2)`syncd: state machine tick`,u.default.getCollectionsInStateDirty().length>0&&(E=new Set(Array.from(E).filter((e=>S.has(e)))),w());const e=u.default.getCollectionsInStateRetry();if(e.length>0){if(v)return void __LOG__(2)`syncd: retry is in flight`;null!=y&&clearTimeout(y),E=new Set(Array.from(E).filter((t=>!e.includes(t)))),N()}u.default.getCollectionsInStateFatal().length>0&&(0,a.getDbImpls)().handleSyncdFatal(u.default.getCollectionsInStateFatal())}function D(e){return e.forEach((e=>e.state!==d.CollectionState.Success||E.has(e.name)?e.state===d.CollectionState.ErrorRetry?((0,f.reportSyncdCriticalBootstrapStage)(f.SyncdCriticalBootstrapStageType.ENTERED_RETRY_MODE),u.default.moveCollectionsToFiniteRetry([e.name])):e.state===d.CollectionState.ErrorFatal?u.default.moveCollectionsToFatal([e.name]):e.state!==d.CollectionState.Blocked||E.has(e.name)?void 0:u.default.moveCollectionsToBlocked([e.name]):u.default.moveCollectionsToUpToDate([e.name])))}function k(){return(k=(0,i.default)((function*(){__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections`;const e=yield(0,l.getAllSyncPendingMutationsInTransaction)(),t=u.default.getCollectionsInStateBlocked();u.default.moveCollectionsToDirty(t);const n=e.map((e=>e.collection)).concat(t);n.length>0&&(__LOG__(2)`syncd: syncPendingMutationsAndBlockedCollections: [${n}]`,A(n))}))).apply(this,arguments)}},278009:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.checkLtHash=function(){return w.apply(this,arguments)},t.computeLtHash=M,t.computeLtHashAndValidatePatch=function(){return E.apply(this,arguments)},t.computeLtHashAndValidateSnapshot=function(){return S.apply(this,arguments)},t.computeOutgoingSnapshotAndPatchMacs=function(){return O.apply(this,arguments)},t.logMacsInSnapshot=D;var i=r(n(311504)),a=n(266543),o=n(400899),s=n(607589),l=n(852455),c=n(41007),u=n(569719),d=n(550073),p=n(960362),f=n(662109),_=n(463109),h=n(266313),g=n(549334);function m(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r="string"==typeof e?e:(0,_.arrayBufferToHexPadded)(e),i="string"==typeof t?t:(0,_.arrayBufferToHexPadded)(t),a=n?-16:0;return`${r.slice(a)}:${i.slice(a)}`}const y=new TextDecoder;function S(){return(S=(0,i.default)((function*(e,t){const{mac:n,version:r,keyId:i,records:s}=t,l=yield(0,a.getDbImpls)().getSyncKeyData(i.id);if(!l)throw new h.SyncdMissingKeyError;const c=new Map(s.map((e=>[(0,_.arrayBufferToHexPadded)(e.index.blob),(0,f.valueMacFromIndexAndValueCipherText)(e.value.blob)])));__LOG__(2)`syncd:
${e} snapshot macsToAdd:
    ${Array.from(c.entries()).map((e=>{let[t,n]=e;return m(t,n)})).join("\n\t")}`;const u=yield o.LT_HASH_ANTI_TAMPERING.add(o.EMPTY_LT_HASH,Array.from(c.values())),{snapshotMacKey:d}=yield(0,f.generateEncryptionKeys)(l),p=(0,_.to64BitNetworkOrder)(r.version),g=(0,_.toUtf8)(e).buffer;return __LOG__(2)`syncd: validating snapshot mac for ${e} snapshot v${r.version}:
ltHash: ${(0,_.arrayBufferToHexPadded)(u)}
encoded version: ${(0,_.arrayBufferToHexPadded)(p)}
encoded collection: ${(0,_.arrayBufferToHexPadded)(g)}
expected snapshotMAC: ${(0,_.arrayBufferToHexPadded)(n)}`,yield C(e,n,d,u,p,g,!0,s.length,t.version.version),u}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,n){const{version:r,mutations:o,snapshotMac:s,patchMac:l,keyId:c}=t,u=c.id,p=yield(0,a.getDbImpls)().getSyncKeyData(u);if(!p)throw new h.SyncdMissingKeyError;const{snapshotMacKey:g,patchMacKey:y}=yield(0,f.generateEncryptionKeys)(p),S=o.map((e=>({operation:e.operation,indexMac:e.record.index.blob,valueMac:(0,f.valueMacFromIndexAndValueCipherText)(e.record.value.blob)}))),E=yield M(e,S,n),v=(0,_.to64BitNetworkOrder)(r.version),T=(0,_.toUtf8)(e).buffer;__LOG__(2)`syncd: validating snapshot and patch mac for ${e} v${r.version}:
expected snapshotMAC: ${(0,_.arrayBufferToHexPadded)(s)}
expected patchMAC: ${(0,_.arrayBufferToHexPadded)(l)}
encoded version: ${(0,_.arrayBufferToHexPadded)(v)}
encoded collection: ${(0,_.arrayBufferToHexPadded)(T)}
key ID: ${(0,_.arrayBufferToHexPadded)(u)}`;try{yield b(e,l,y,s,S.map((e=>e.valueMac)),v,T,o.length,r.version),yield C(e,s,g,E,v,T,!1,o.length,r.version)}catch(e){throw yield function(){return A.apply(this,arguments)}(),e}return E;function A(){return(A=(0,i.default)((function*(){const t=yield D(e,!1),n=new Map(t.map((e=>{let{indexMac:t,valueMac:n}=e;return[(0,_.arrayBufferToHexPadded)(t),(0,_.arrayBufferToHexPadded)(n)]})));__LOG__(2)`syncd: error on incoming records:
\t${S.map((e=>{let{operation:t,indexMac:r,valueMac:i}=e;return`${t===d.SyncdMutation$SyncdOperation.SET?"set":"remove"} | ${m(r,i,!1)} | ${n.has((0,_.arrayBufferToHexPadded)(r))?"found":"did not find"} indexMAC in the above logged macs`})).join("\n\t")}`}))).apply(this,arguments)}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const n=yield(0,l.getCollectionVersionInTransaction)(e).then((e=>{var t;return null!==(t=null==e?void 0:e.version)&&void 0!==t?t:0}));if(n!==t-1){const r=n>t-1?"greater-than-expected":"less-than-expected";throw __LOG__(3,void 0,void 0,!0)`syncd: ${e} received patch v${t} !== latest local version (v${n}) + 1`,SEND_LOGS(`syncd-version-check-error-local-version-${r}`),new h.SyncdRetryableError(`syncd-version-check-error-local-version-${r}`)}const r=yield(0,l.getCollectionVersionLtHashInTransaction)(e);if((0,s.arrayBuffersEqual)(r,o.EMPTY_LT_HASH))throw __LOG__(3,void 0,void 0,!0)`syncd: empty local lthash found when processing ${e} patch v${t}`,SEND_LOGS("syncd-empty-lthash-on-mac-mismatch"),new h.SyncdRetryableError("empty lthash")}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,r,i,a,o,l,c){const u=yield(0,f.generateSnapshotMac)(n,r,i,a);if(!(0,s.arrayBuffersEqual)(u,t)){yield v(e,c);const t=o?g.SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:g.SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_PATCH;throw(0,g.reportSyncdFatalError)(t,e,l,c),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate snapshot mac.`,SEND_LOGS("syncd: unable to validate snapshot mac."),new h.SyncdFatalError("unable to validate snapshot mac")}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,n,r,i,a,o,l,c){const u=yield(0,f.generatePatchMac)(n,r,i,a,o);if(!(0,s.arrayBuffersEqual)(u,t))throw yield v(e,c),(0,g.reportSyncdFatalError)(g.SyncdFatalErrorType.MAC_MISMATCH_PATCH,e,l,c),__LOG__(3,void 0,void 0,!0)`syncd: unable to validate patch mac.`,SEND_LOGS("syncd: unable to validate patch mac."),new h.SyncdFatalError("unable to validate patch mac")}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t,n,r){const i=(yield(0,l.getCollectionVersionInTransaction)(e).then((e=>{var t;return null!==(t=null==e?void 0:e.version)&&void 0!==t?t:p.DEFAULT_COLLECTION_VERSION})))+1,{patchMacKey:a,snapshotMacKey:o}=yield(0,f.generateEncryptionKeys)(r),s=(0,_.to64BitNetworkOrder)(i),c=(0,_.toUtf8)(e).buffer,u=yield(0,f.generateSnapshotMac)(o,t,s,c),d=yield(0,f.generatePatchMac)(a,u,n.map((e=>e.valueMac)),s,c);return __LOG__(2)`syncd: computing snapshot and patch macs for outgoing patch ${e} v${i}:
encoded version: ${(0,_.arrayBufferToHexPadded)(s)}
encoded collection: ${(0,_.arrayBufferToHexPadded)(c)}
snapshotMAC: ${(0,_.arrayBufferToHexPadded)(u)}
patchMAC: ${(0,_.arrayBufferToHexPadded)(d)}`,{snapshotMac:u,patchMac:d}}))).apply(this,arguments)}function M(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t,n){const r=yield(0,l.getCollectionVersionLtHashInTransaction)(e),s=yield N(t.map((e=>e.indexMac))),c=new Map,p=new Map,f=new Map;yield(0,u.promiseEach)(t,function(){var t=(0,i.default)((function*(t){const{indexMac:r,valueMac:i,operation:o}=t,l=y.decode(r),u=s.get(l);if(u)o===d.SyncdMutation$SyncdOperation.REMOVE?p.set((0,_.arrayBufferToHexPadded)(r),u):f.set((0,_.arrayBufferToHexPadded)(r),u);else if(o===d.SyncdMutation$SyncdOperation.REMOVE){const t=yield function(e){if(null==n)return Promise.resolve(null);return n(e)}(r);var h,m;if(null!=t)p.set((0,_.arrayBufferToHexPadded)(r),t),__LOG__(3,void 0,void 0,!0,["non-sad"])`syncd: had to use fallbackQueryForValueMac in collection ${e} for platform ${null!==(h=(0,a.getDbImpls)().getPrimaryPlatform())&&void 0!==h?h:"[empty]"}: ${(0,_.arrayBufferToHexPadded)(r).slice(-16)}
}`,SEND_LOGS("syncd: fallback query");else(0,g.reportSyncdCriticalEvent)(g.SyncdCriticalEventType.MISSING_MUTATION_TO_REMOVE,e),__LOG__(3)`syncd: missing indexMAC in sync-actions table for REMOVE mutation in collection ${e} for platform ${null!==(m=(0,a.getDbImpls)().getPrimaryPlatform())&&void 0!==m?m:"[empty]"}:
${(0,_.arrayBufferToHexPadded)(r).slice(-16)}`}o===d.SyncdMutation$SyncdOperation.SET&&c.set((0,_.arrayBufferToHexPadded)(r),i)}));return function(){return t.apply(this,arguments)}}());const h=yield o.LT_HASH_ANTI_TAMPERING.subtractThenAdd(r,Array.from(c.values()),Array.from(p.values()).concat(Array.from(f.values())));return __LOG__(2)`syncd: computing ltHash for ${e}:
currentLtHash: ${(0,_.arrayBufferToHexPadded)(r)}
macsToAdd:
    ${Array.from(c.entries()).map((e=>{let[t,n]=e;return m(t,n)})).join("\n\t")}
macsToRemove:
    ${Array.from(p.entries()).map((e=>{let[t,n]=e;return m(t,n)})).join("\n\t")}
macsToOverwrite (also remove):
    ${Array.from(f.entries()).map((e=>{let[t,n]=e;return m(t,n)})).join("\n\t")}
newLtHash: ${(0,_.arrayBufferToHexPadded)(h)}`,h}))).apply(this,arguments)}function w(){return(w=(0,i.default)((function*(){const e=yield(0,a.runInTransaction)(["SyncActionStore","CollectionVersionStore"],function(){var e=(0,i.default)((function*(e){let{SyncActionStore:t,CollectionVersionStore:n}=e;const r=yield n.getAll();return Promise.all(r.map(function(){var e=(0,i.default)((function*(e){let{collection:n,ltHash:r}=e;return{collection:n,ltHash:r,mutations:yield t.getByCollections([n])}}));return function(){return e.apply(this,arguments)}}()))}));return function(){return e.apply(this,arguments)}}());yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){let{collection:t,ltHash:n,mutations:r}=e;const i=yield R(r);(0,s.arrayBuffersEqual)(n,i)||(__LOG__(4,!0,new Error,!0)`syncd: failed LtHash check for ${t}`,SEND_LOGS("LtHash check failed"))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function R(e){const t=new Map(e.map((e=>[(0,_.arrayBufferToHexPadded)(e.indexMac),e.valueMac])));return o.LT_HASH_ANTI_TAMPERING.add(o.EMPTY_LT_HASH,Array.from(t.values()))}function N(){return L.apply(this,arguments)}function L(){return(L=(0,i.default)((function*(e){const t=yield(0,c.getSyncActionsByIndexMacsInTransaction)(e);return new Map(t.map((e=>[y.decode(e.indexMac),e.valueMac])))}))).apply(this,arguments)}function D(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=t?20:1;__LOG__(2)`syncd: logMacs: ${e}: prepare`;const[r,i]=yield(0,a.runInTransaction)(["SyncActionStore","CollectionVersionStore"],(t=>{let{SyncActionStore:n,CollectionVersionStore:r}=t;return Promise.all([r.get(e).then((e=>null==e?void 0:e.version)),n.getByCollections([e])])}));if(__LOG__(2)`syncd: current snapshot ${e} v${r} with ${i.length} mutations:`,t&&i.length>100)return i;const o=i.reduce(((e,r,i)=>(i%n==0&&e.push(""),e[e.length-1]+=m(r.indexMac,r.valueMac,t)+" | ",e)),[]);return o.forEach((e=>__LOG__(2)`|${e}`)),i}))).apply(this,arguments)}},960362:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncModelType=t.SyncDataType=t.SyncActionState=t.MIN_PATCH_SIZE=t.MIN_INLINE_MUTATIONS=t.MAX_PATCH_SIZE=t.MAX_INLINE_MUTATIONS=t.LABEL_ASSOCIATION_SYNC_VERSION=t.FINITE_FAILURE_EXPIRY_DURATION=t.DEFAULT_COLLECTION_VERSION=t.ConflictResolutionState=t.CollectionSyncState=t.CollectionState=t.CollectionName=t.BACKOFF_MIN_TIMEOUT=t.BACKOFF_MAX_TIMEOUT=t.BACKOFF_BASE=t.Actions=void 0;var r=n(892844);t.BACKOFF_MIN_TIMEOUT=1e3;t.BACKOFF_MAX_TIMEOUT=36e5;t.BACKOFF_BASE=2;const i=2*r.DAY_MILLISECONDS;t.FINITE_FAILURE_EXPIRY_DURATION=i;t.MIN_INLINE_MUTATIONS=100;t.MAX_INLINE_MUTATIONS=2e3;t.MIN_PATCH_SIZE=10;t.MAX_PATCH_SIZE=100;t.DEFAULT_COLLECTION_VERSION=0;t.LABEL_ASSOCIATION_SYNC_VERSION=3;const a=n(654302)({Star:"star",Contact:"contact",Mute:"mute",PinDEPRECATED:"pin",Pin:"pin_v1",SettingPushName:"setting_pushName",LabelEdit:"label_edit",LabelMessage:"label_message",LabelJid:"label_jid",QuickReply:"quick_reply",LocaleSetting:"setting_locale",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChat:"clearChat",DeleteMessageForMe:"deleteMessageForMe",Sentinel:"sentinel",UnarchiveChatsSetting:"setting_unarchiveChats",DeleteChat:"deleteChat",AndroidUnsupportedActions:"android_unsupported_actions",PrimaryFeature:"primary_feature",Subscription:"subscription",Nux:"nux",Agent:"deviceAgent",TimeFormat:"time_format",MuteStatusSync:"userStatusMute"});t.Actions=a;const o=n(654302)({Regular:"regular",RegularLow:"regular_low",RegularHigh:"regular_high",CriticalBlock:"critical_block",CriticalUnblockLow:"critical_unblock_low"});t.CollectionName=o;const s=n(654302).Mirrored(["Success","SuccessHasMore","Conflict","ConflictHasMore","ErrorRetry","ErrorFatal","Blocked"]);t.CollectionState=s;const l=n(654302).Mirrored(["UpToDate","Dirty","FailingFiniteRetry","Fatal","Blocked"]);t.CollectionSyncState=l;const c=n(654302).Mirrored(["Success","Malformed","Orphan","Unsupported","Skipped","Failed"]);t.SyncActionState=c;const u=n(654302)({Msg:"Msg",Chat:"Chat"});t.SyncModelType=u;const d=n(654302).Mirrored(["ApplyRemoteAndDropLocal","SkipRemote","SkipRemoteAndDropLocal"]);t.ConflictResolutionState=d;const p=n(654302).Mirrored(["Patch","Snapshot","Local"]);t.SyncDataType=p},900669:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSyncdDisabled=function(){return(0,r.getDbImpls)().getSyncDisabled()};var r=n(266543)},266313:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdRetryableError=t.SyncdMissingKeyError=t.SyncdFatalError=void 0;class n extends Error{constructor(){super(...arguments),this.name="SyncdMissingKeyError"}}t.SyncdMissingKeyError=n;class r extends Error{constructor(e,t){super(e),this.name="SyncdRetryableError",this.backoff=t,this.message=e}}t.SyncdRetryableError=r;class i extends Error{constructor(e){super(e),this.name="SyncdFatalError",this.message=e}}t.SyncdFatalError=i},134719:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAllOrphansAndUnsupported=function(){return g.apply(this,arguments)},t.checkOrphanChats=p,t.checkOrphanMessages=u,t.checkOrphanMutations=function(){return c.apply(this,arguments)};var i=r(n(311504)),a=n(41007),o=n(788036),s=n(960362),l=n(900669);function c(){return(c=(0,i.default)((function*(e,t){if((0,l.isSyncdDisabled)())return Promise.resolve();yield Promise.all([u(e),p(t)])}))).apply(this,arguments)}function u(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){yield _(e,s.SyncModelType.Msg)}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){yield _(e,s.SyncModelType.Chat)}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t){if((0,l.isSyncdDisabled)())return Promise.resolve();const n=yield(0,a.getSyncActionsByModelInfosInTransaction)(e.map((e=>[e,t,s.SyncActionState.Orphan])));yield(0,o.applyIndividualMutations)(n)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){if((0,l.isSyncdDisabled)())return Promise.resolve();__LOG__(2)`syncd: start applyAllOrphansAndUnsupported`;const e=yield(0,a.getSyncActionsByActionStatesInTransaction)([s.SyncActionState.Orphan,s.SyncActionState.Unsupported]);yield(0,o.applyIndividualMutations)(e),__LOG__(2)`syncd: end applyAllOrphansAndUnsupported`}))).apply(this,arguments)}},366181:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.syncResponseParser=void 0;var i=r(n(73982)),a=n(960362),o=n(452518),s=n(266313),l=n(549334);const c=new(n(471914).WapParser)("syncResponseParser",(e=>{__LOG__(2)`syncd: start parsing syncd collections`;const t=[];return e.child("sync").mapChildrenWithTag("collection",(e=>{const n=(0,i.default)({},null),r=a.CollectionName.cast(e.attrString("name"));if(!r)throw new s.SyncdFatalError("invalid collection name");n.name=r,n.state=function(e,t){if(!e.hasAttr("type")||"error"!==e.attrString("type"))return e.hasAttr("has_more_patches")?(__LOG__(2)`syncd: collection ${t} got server code has_mode_patches`,a.CollectionState.SuccessHasMore):(__LOG__(2)`syncd: collection ${t} did not get server error`,a.CollectionState.Success);{const n=e.child("error"),r=n.attrString("code"),i=n.attrString("text");switch(__LOG__(2)`syncd: collection ${t} got server error: ${r}`,r){case"409":return e.hasAttr("has_more_patches")?a.CollectionState.ConflictHasMore:a.CollectionState.Conflict;case"400":return(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.XMPP_BAD_REQUEST_FOR_COLLECTION),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;case"404":return(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.XMPP_NOT_FOUND_FOR_COLLECTION),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: fatal error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorFatal;default:return __LOG__(3,void 0,void 0,!0)`syncd: retryable error: collection ${String(t)} throws ${i}`,SEND_LOGS(`syncd: retryable error: collection ${String(t)} throws ${i}`),a.CollectionState.ErrorRetry}}}(e,n.name),e.hasAttr("version")&&(n.version=parseInt(e.attrString("version"),10)),e.hasChild("patches")&&(n.patches=e.child("patches").mapChildrenWithTag("patch",(e=>(0,o.decodeSyncdPatch)(r,e.contentBytes())))),e.hasChild("snapshot")&&(n.snapshot=(0,o.decodeExternalBlobReference)(r,e.child("snapshot").contentBytes())),t.push(n),null==n.version&&null==n.patches&&null==n.snapshot&&__LOG__(2)`syncd: collection ${r} has no version, patches or snapshot`,__LOG__(2)`syncd: successfully parsed collection ${r}`})),t}));t.syncResponseParser=c},912019:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.serverSync=function(){return h.apply(this,arguments)};var i=r(n(311504)),a=n(736184),o=n(532442),s=n(788036),l=n(960362),c=n(266313),u=n(549334),d=r(n(657391)),p=n(366181),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(607414));function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function h(){return(h=(0,i.default)((function*(e){let t=[],n=[...e],r=0;for(;(r<5||n.length>0&&r<500)&&0!==n.length;){const{doneCollections:e,refetchCollections:i}=yield g(n);n=i,t=t.concat(e),r++}return n.length>0&&(__LOG__(4,void 0,new Error,!0,["syncd"])`syncd: reached max iterations for collections: ${n}`,SEND_LOGS("syncd: max iteration"),t=t.concat(n.map((e=>({state:l.CollectionState.ErrorRetry,name:e}))))),t}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){if(0===e.length)return{doneCollections:[],refetchCollections:[]};try{const{collectionDetails:t,localCollectionVersions:n,collectionsToUpload:r}=yield y(e);r.length>0&&__LOG__(2)`syncd: deferred local mutation upload for ${r}`,__LOG__(2)`syncd: local collection versions:`,n.forEach(((e,t)=>{__LOG__(2)`\n\t${t} v${null!=e?e:"(undefined)}"}`}));const a=[],c=[];t.forEach((e=>{switch(e.state){case l.CollectionState.ErrorRetry:case l.CollectionState.ErrorFatal:case l.CollectionState.Blocked:return void c.push(e);default:a.push(e)}e.state!==l.CollectionState.Conflict&&e.state!==l.CollectionState.ConflictHasMore||f.incConflict()})),__LOG__(2)`syncd: start apply collections: ${a.map((e=>e.name))}`;const d=new u.SyncdEventFlow,p=yield Promise.all(a.map((e=>(0,s.applyAppStateSyncResponse)(e,n.get(e.name),d))));d.end(),__LOG__(2)`syncd: end apply collections: ${a.map((e=>e.name))}`;const _=[];return yield Promise.all(p.map(function(){var e=(0,i.default)((function*(e){if(e.state===l.CollectionState.Conflict){(yield(0,o.getSyncPendingMutationsByCollectionInTransaction)(e.name)).length>0?_.push(e.name):(e.state=l.CollectionState.Success,c.push(e))}else e.state===l.CollectionState.ConflictHasMore||e.state===l.CollectionState.SuccessHasMore||e.state===l.CollectionState.Success&&r.some((t=>t===e.name))?_.push(e.name):c.push(e)}));return function(){return e.apply(this,arguments)}}())),{doneCollections:c,refetchCollections:_}}catch(t){if(t instanceof c.SyncdFatalError){__LOG__(4,void 0,new Error,!0)`syncd: fatal error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: fatal error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:l.CollectionState.ErrorFatal,name:e}))),refetchCollections:[]}}__LOG__(3,void 0,void 0,!0)`syncd: retryable error: syncd global throws ${t.message}`,SEND_LOGS(`syncd: retryable error: syncd global throws ${t.message}`);return{doneCollections:e.map((e=>({state:l.CollectionState.ErrorRetry,name:e,serverBackoff:t.errorBackoff}))),refetchCollections:[]}}}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const{syncIqNode:t,collectionWithPendingMutationsIds:n,collectionWithEncryptedMutations:r,localCollectionVersions:i,collectionsToSkip:o}=yield(0,d.default)(e);(0,u.reportSyncdCriticalBootstrapStage)(u.SyncdCriticalBootstrapStageType.REQUEST_BUILT),__LOG__(2)`syncd: sending sync request for collections: ${e.map((e=>{var t,r,a;return`\n\t${e} v${null!==(t=i.get(e))&&void 0!==t?t:"(undefined)"} ${(null!==(r=null===(a=n.get(e))||void 0===a?void 0:a.length)&&void 0!==r?r:0)>0&&null!=i.get(e)?" with local changes":""}`}))}`;const s=yield(0,a.sendIq)(t,p.syncResponseParser);if(__LOG__(2)`syncd: completed network operation for collections: ${e}`,(0,u.reportSyncdCriticalBootstrapStage)(u.SyncdCriticalBootstrapStageType.RESPONSE_RECEIVED),s.success){(0,u.reportSyncdCriticalBootstrapStage)(u.SyncdCriticalBootstrapStageType.RESPONSE_PARSED_VALID);const e=s.result;return __LOG__(2)`syncd: received sync response for collections: ${e.map((e=>{let t=`\n${e.name}`;return null!=e.version&&(t+=`\n\tupdated to version ${e.version}`),null!=e.snapshot&&(t+="\n\tcontains snapshot"),null!=e.patches&&(t+=`\n\tcontains ${e.patches.length} patches`),t}))}`,e.forEach((e=>{const t=n.get(e.name);t&&(e.syncedPendingMutationsId=t);const i=r.get(e.name);i&&(e.syncedEncryptedMutations=i)})),{collectionDetails:e,localCollectionVersions:i,collectionsToUpload:o}}const{errorCode:l,errorText:c,errorBackoff:f}=s;throw E(l,c,f)}))).apply(this,arguments)}function E(e,t,n){switch(e){case 400:return(0,u.reportSyncdFatalError)(u.SyncdFatalErrorType.XMPP_BAD_REQUEST_GLOBAL_ERROR),new c.SyncdFatalError(t);case 404:return(0,u.reportSyncdFatalError)(u.SyncdFatalErrorType.XMPP_NOT_FOUND_GLOBAL_ERROR),new c.SyncdFatalError(t);case 405:return(0,u.reportSyncdFatalError)(u.SyncdFatalErrorType.XMPP_BAD_METHOD_GLOBAL_ERROR),new c.SyncdFatalError(t);case 406:return(0,u.reportSyncdFatalError)(u.SyncdFatalErrorType.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR),new c.SyncdFatalError(t);default:return new c.SyncdRetryableError(t,n)}}},631325:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncActionBase=void 0;var r=n(960362);t.SyncActionBase=class{getChatJidAndMessageKey(){}resolveConflicts(e,t){return t.timestamp>=e.timestamp?Promise.resolve(r.ConflictResolutionState.ApplyRemoteAndDropLocal):Promise.resolve(r.ConflictResolutionState.SkipRemote)}dropMutationDueToCrossIndexConflict(){return Promise.resolve(!1)}}},788036:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.applyAppStateSyncResponse=function(){return L.apply(this,arguments)},t.applyIndividualMutations=function(){return N.apply(this,arguments)};var i=r(n(73982)),a=r(n(311504)),o=n(266543),s=n(607589),l=n(852455),c=n(896005),u=n(41007),d=n(608243),p=r(n(145095)),f=n(550073),_=n(381),h=n(278009),g=n(408708),m=n(365926),y=n(960362),S=n(709520),E=n(266313),v=n(808221),T=n(549334),C=n(317809),A=n(859115),b=n(949206),P=r(n(979889)),O=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(607414)),M=n(892844),I=n(484902);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(w=function(e){return e?n:t})(e)}const R=new ArrayBuffer(128);function N(){return(N=(0,a.default)((function*(e){if(0===e.length)return Promise.resolve();__LOG__(2)`syncd: start applyIndividualMutations`;const t=(0,g.syncActionsToDecryptedMutation)(e).reduce(((e,t)=>{var n;const r=null!==(n=e.get(t.collection))&&void 0!==n?n:[];return r.push(t),e.set(t.collection,r),e}),new Map),n=Array.from(t.keys()).map(function(){var e=(0,a.default)((function*(e){__LOG__(2)`syncd: apply individual mutations for collection ${e}`;const n=t.get(e);if(void 0===n)return;const{setMutationsToPersist:r,pendingMutationsToDrop:i}=yield z(e,n,y.SyncDataType.Local,null),s=r.map((e=>({action:e.action,actionState:e.actionState,binarySyncData:e.binarySyncData,collection:e.collection,index:e.index,keyId:e.keyId,modelId:e.modelId,modelType:e.modelType,timestamp:e.timestamp,version:e.version})));__LOG__(2)`syncd: end apply individual mutations for collection ${e}`,yield(0,o.runInTransaction)(["SyncActionStore","PendingMutationStore"],function(){var e=(0,a.default)((function*(e){let{SyncActionStore:t,PendingMutationStore:n}=e;yield t.bulkUpdate(s),yield n.bulkRemove(i)}));return function(){return e.apply(this,arguments)}}()),__LOG__(2)`syncd: end update db after apply individual mutations for collection ${e}`}));return function(){return e.apply(this,arguments)}}());yield Promise.all(n),__LOG__(2)`syncd: end applyIndividualMutations`}))).apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e,t,n){const{name:r,version:i,patches:a,snapshot:s,syncedPendingMutationsId:u,syncedEncryptedMutations:d}=e;__LOG__(2)`syncd: start applying collection ${r}`;try{var p,f;null==n||n.mark("external_mutations_download_start",{patchCount:null===(p=e.patches)||void 0===p?void 0:p.length,snapshotSizeBytes:null===(f=e.snapshot)||void 0===f?void 0:f.fileSizeBytes});const[_,g]=yield U(r,a,s,t);null==n||n.mark("external_mutations_download_end",{patchesWithMutationsCount:null==g?void 0:g.length,snapshotRecordsCount:null==_?void 0:_.records.length});const y=performance.now();if(null!=_)yield F(r,_,g,n),__LOG__(2)`syncd: ${r} snapshot and patches applied successfully`;else if(null!=g){const e=Math.min.apply(Math,g.map((e=>e.version.version)));if(null!=t&&e>t+1&&g.length>0){const n=yield(0,c.getAllMissingKeysInTransaction)();if(__LOG__(2)`syncd: missing keys: [${n.map((e=>e.keyHex+":"+e.timestamp))}]`,__LOG__(2)`syncd: has missing patches. collection: ${r}, localVersion: ${t},
minPatch: ${e}`,__LOG__(4,void 0,new Error,!0)`syncd: has missing patches`,SEND_LOGS("syncd: has missing patches"),(0,o.getConfig)().syncdShouldFatalOnMissingPatch())throw(0,T.reportSyncdFatalError)(T.SyncdFatalErrorType.SERVER_DID_NOT_SEND_ALL_PATCHES,r,void 0,null!=t?t:0),new E.SyncdFatalError("syncd: has missing patches")}yield W(r,g,n),__LOG__(2)`syncd: ${r} patches applied successfully`}else null!=i?(yield D(r,i,u,d),__LOG__(2)`syncd: ${r} v${i} uploaded successfully`):((0,m.isBootstrap)(t)&&(yield(0,l.updateCollectionVersionAndLtHashInTransaction)(r,0,R)),__LOG__(2)`syncd: sync ${r} but there are no updates`);const S=Math.floor(performance.now()-y);return __LOG__(2)`syncd: applyAppStateSyncResponse: finished applying ${r} in ${S}ms`,(g||_)&&(0,m.isBootstrap)(t)&&!(0,m.isCriticalCollection)(r)&&(0,T.reportSyncdBootstrapDataApplied)(r,null!=_?T.SyncdBootstrapDataAppliedSnapshotUsed.SNAPSHOT_USED:T.SyncdBootstrapDataAppliedSnapshotUsed.SNAPSHOT_NOT_USED,S),yield(0,h.logMacsInSnapshot)(e.name),e}catch(e){const t=e.message;return e instanceof E.SyncdMissingKeyError?(__LOG__(3)`syncd: key error: ${r} missing keys`,{name:r,state:y.CollectionState.Blocked}):e instanceof E.SyncdFatalError?(__LOG__(4,void 0,new Error,!0)`syncd: fatal error: ${r} throws ${t}`,SEND_LOGS(`syncd: fatal error: ${String(r)} throws ${t}`),{name:r,state:y.CollectionState.ErrorFatal}):(__LOG__(3,void 0,void 0,!0)`syncd: retryable error: ${r} throws ${t}`,SEND_LOGS(`syncd: retryable error: ${String(r)} throws ${t}`),{name:r,state:y.CollectionState.ErrorRetry})}}))).apply(this,arguments)}function D(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t,n,r){var i;yield(0,h.logMacsInSnapshot)(e);const s=r.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),c=yield(0,h.computeLtHash)(e,s),u=(0,g.encryptedUploadMutationsToSyncActions)(r.filter((e=>e.operation===f.SyncdMutation$SyncdOperation.SET)),y.SyncActionState.Success),d=null!==(i=yield(0,l.getCollectionVersionInTransaction)(e).then((e=>null==e?void 0:e.version)))&&void 0!==i?i:0;t!==d+1&&(__LOG__(4,void 0,new Error,!0)`syncd: _uploadSuccessful: unexpected server version (${t}) after patch upload, expected ${d+1}`,SEND_LOGS("syncd: unexpected server version after patch upload")),__LOG__(2)`syncd: _uploadSuccessful: write to db for ${e}`,yield(0,o.runInTransaction)(["SyncActionStore","PendingMutationStore","CollectionVersionStore"],function(){var r=(0,a.default)((function*(r){let{SyncActionStore:i,PendingMutationStore:a,CollectionVersionStore:o}=r;yield i.bulkSet(u),yield a.bulkRemove(n),yield o.updateVersionAndLtHash(e,t,c)}));return function(){return r.apply(this,arguments)}}()),__LOG__(2)`syncd: end _uploadSuccessful for ${e}`}))).apply(this,arguments)}function U(){return G.apply(this,arguments)}function G(){return(G=(0,a.default)((function*(e,t,n,r){let i=Promise.resolve(),o=0;const s=(0,M.unixTimeMs)();if(null!=n){const t=P.default.validateExternalBlobReference(e,n);o+=(0,d.numberOrThrowIfTooLarge)(t.fileSizeBytes||0),__LOG__(2)`syncd: download snapshot for ${e}`,i=(0,C.downloadSnapshot)(e,t)}let l,c,u=Promise.resolve();if(null!=t){const n=t.map((t=>P.default.validatePatchProtobuf(e,t)));u=Promise.all(n.map(function(){var t=(0,a.default)((function*(t){let n=t.mutations||[];const r=t.externalMutations;return r&&(__LOG__(2)`syncd: download patch for ${e}`,n=yield(0,C.downloadExternalPatch)(e,r),__LOG__(2)`syncd: ${e}'s external patch downloaded`,o+=(0,d.numberOrThrowIfTooLarge)(r.fileSizeBytes||0)),{mutations:n,version:t.version,snapshotMac:t.snapshotMac,patchMac:t.patchMac,keyId:t.keyId,exitCode:t.exitCode,deviceIndex:t.deviceIndex}}));return function(){return t.apply(this,arguments)}}()))}try{[l,c]=yield Promise.all([i,u]),(0,m.isBootstrap)(r)&&(0,T.reportSyncdBootstrapAppStateDownloadMetric)({collection:e,downloadStartTs:s,downloadSize:o,isSuccess:"success"})}catch(t){throw(0,m.isBootstrap)(r)&&(0,T.reportSyncdBootstrapAppStateDownloadMetric)({collection:e,downloadStartTs:s,downloadSize:o,isSuccess:"failure"}),t}return[l,c]}))).apply(this,arguments)}function x(e){return{measuredComputeLtHashAndValidateSnapshot:function(){var t=(0,a.default)((function*(t,n){null==e||e.mark("anti_tampering_start",{source:y.SyncDataType.Snapshot});const r=yield(0,h.computeLtHashAndValidateSnapshot)(t,n);return null==e||e.mark("anti_tampering_end",{source:y.SyncDataType.Snapshot}),r}));return function(){return t.apply(this,arguments)}}(),measuredTryDecryptSnapshot:function(){var t=(0,a.default)((function*(t,n){null==e||e.mark("decryption_start",{source:y.SyncDataType.Snapshot});const r=yield(0,S.tryDecryptSnapshot)(t,n);return null==e||e.mark("decryption_end",{source:y.SyncDataType.Snapshot}),r}));return function(){return t.apply(this,arguments)}}()}}function B(e){return{measuredComputeLtHashAndValidatePatch:function(){var t=(0,a.default)((function*(t,n,r){null==e||e.mark("anti_tampering_start",{source:y.SyncDataType.Patch});const i=yield(0,h.computeLtHashAndValidatePatch)(t,n,r);return null==e||e.mark("anti_tampering_end",{source:y.SyncDataType.Patch}),i}));return function(){return t.apply(this,arguments)}}(),measuredTryDecryptPatch:function(){var t=(0,a.default)((function*(t,n){null==e||e.mark("decryption_start",{source:y.SyncDataType.Patch});const r=yield(0,S.tryDecryptPatch)(t,n);return null==e||e.mark("decryption_end",{source:y.SyncDataType.Patch}),r}));return function(){return t.apply(this,arguments)}}()}}function F(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e,t,n,r){yield(0,h.logMacsInSnapshot)(e);try{const{measuredComputeLtHashAndValidateSnapshot:n,measuredTryDecryptSnapshot:i}=x(r);null==r||r.mark("apply_start",{source:y.SyncDataType.Snapshot,snapshotRecordsCount:t.records.length}),__LOG__(2)`syncd: start validate ${e}'s snapshot`;const s=yield n(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot validated`;const l=yield i(e,t);__LOG__(2)`syncd: collection ${e}'s snapshot decrypted`,O.addMutationCount(t.records.length),(0,T.reportSyncdDecryptedMutations)(T.SyncdDecryptMutationsType.SNAPSHOT_MUTATIONS,l),(0,b.validateNoSameIndexForMultipleMutations)(e,l,y.SyncDataType.Snapshot);const c=t.version.version,{setMutationsToPersist:u,pendingMutationsToDrop:d}=yield z(e,l,y.SyncDataType.Snapshot,r);__LOG__(2)`syncd: processed ${l.length} mutations in snapshot of collection ${e} v${c}`,__LOG__(2)`syncd: collection ${e}'s snapshot v${c} applied`,null==r||r.mark("update_DB_start",{source:y.SyncDataType.Snapshot,setMutationsToPersistCount:u.length,pendingMutationsToDropCount:d.length}),yield(0,o.runInTransaction)(["SyncActionStore","PendingMutationStore","CollectionVersionStore"],function(){var t=(0,a.default)((function*(t){let{SyncActionStore:n,PendingMutationStore:r,CollectionVersionStore:i}=t;yield n.bulkSet(u),yield r.bulkRemove(d),yield i.updateVersionAndLtHash(e,c,s)}));return function(){return t.apply(this,arguments)}}()),null==r||r.mark("update_DB_end",{source:y.SyncDataType.Snapshot}),__LOG__(2)`syncd: completed applying snapshot for ${e}`,null==r||r.mark("apply_end",{source:y.SyncDataType.Snapshot,decryptedMutationsCount:l.length})}catch(n){throw n instanceof E.SyncdMissingKeyError&&(yield(0,v.handleMissingKeysInSnapshot)(e,t)),n}n&&(null==r||r.mark("apply_start",{source:y.SyncDataType.Patch,patchCount:n.length}),yield W(e,n,r),null==r||r.mark("apply_end",{source:y.SyncDataType.Patch,patchCount:n.length}))}))).apply(this,arguments)}function Y(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e){if(e>(0,o.getConfig)().syncdMaxMutationsToProcessDuringResume()){const t=Date.now();__LOG__(2)`syncd: patches have ${e} mutations, wait for UI unblock`,yield(0,o.getDbImpls)().handleSyncDelayApplyingPatchUntilUIUnblocks(),__LOG__(2)`syncd: UI is unblocked, waited for ${Date.now()-t}ms`}}))).apply(this,arguments)}function W(){return H.apply(this,arguments)}function H(){return(H=(0,a.default)((function*(e,t,n){if(0===t.length)return __LOG__(2)`syncd: no patches for collection ${e}`,Promise.resolve();(0,b.validateNoDuplicatePatchVersionInCollection)(e,t),t.sort(((e,t)=>e.version.version>t.version.version?1:-1));try{const r=t.reduce(((e,t)=>e+t.mutations.length),0);yield Y(r);for(let r=0;r<t.length;r++)yield V(e,t[r],n)}catch(n){throw n instanceof E.SyncdMissingKeyError&&(yield(0,v.handleMissingKeysInPatches)(e,t)),n}}))).apply(this,arguments)}function V(){return $.apply(this,arguments)}function $(){return($=(0,a.default)((function*(e,t,n){if(yield(0,h.logMacsInSnapshot)(e),t.exitCode){var r;const n=t.exitCode.code;switch(n){case 100:(0,T.reportSyncdFatalError)(T.SyncdFatalErrorType.TERMINAL_PATCH_MISSING_DATA,e);break;case 101:(0,T.reportSyncdFatalError)(T.SyncdFatalErrorType.TERMINAL_PATCH_DESERIALIZATION_ERROR,e);break;default:(0,T.reportSyncdFatalError)(T.SyncdFatalErrorType.TERMINAL_PATCH_UNKNOWN,e)}throw new E.SyncdFatalError(`received terminal patch with exit code:  ${String(n)} text: ${String(null===(r=t.exitCode)||void 0===r?void 0:r.text)}  `)}(0,o.getDbImpls)().handleSyncBeforeApplyPatch(t);const i=t.mutations.filter((e=>e.operation===f.SyncdMutation$SyncdOperation.SET)).length,l=t.mutations.length-i;__LOG__(2)`syncd: applying patch ${e} v${t.version.version} from device ${t.deviceIndex}
SET count: ${i}
REMOVE count: ${l}`,0===i&&0===l&&(__LOG__(3,void 0,void 0,!0)`syncd: ${e}: empty patch found`,SEND_LOGS(`syncd: ${e}: empty patch found`));const{measuredComputeLtHashAndValidatePatch:c,measuredTryDecryptPatch:d}=B(n),p=yield c(e,t,(function(){return P.apply(this,arguments)}));__LOG__(2)`syncd: completed computeLtHashAndValidatePatch for ${e} v${t.version.version}`;const _=yield d(e,t);(0,T.reportSyncdDecryptedMutations)(T.SyncdDecryptMutationsType.PATCH_MUTATIONS,_),O.addMutationCount(_.length),(0,b.validateNoSameIndexForMultipleMutations)(e,_,y.SyncDataType.Patch);const g=Z(_),m=g.filter((e=>e.operation===f.SyncdMutation$SyncdOperation.REMOVE));yield J(e,m),__LOG__(2)`syncd: completed _applyRemoveMutations for ${e} v${t.version.version}`;const S=g.filter((e=>e.operation===f.SyncdMutation$SyncdOperation.SET)),{setMutationsToPersist:v,pendingMutationsToDrop:C}=yield z(e,S,y.SyncDataType.Patch,n);__LOG__(2)`syncd: processed ${_.length} mutations in patch version ${t.version.version} of collection ${e}`,null==n||n.mark("update_DB_start",{source:y.SyncDataType.Patch,setMutationsToPersistCount:v.length,pendingMutationsToDropCount:C.length});const A=t.version.version;function P(){return(P=(0,a.default)((function*(t){var n;return null===(n=(yield(0,u.getSyncActionsByCollectionsInTransaction)([e])).filter((e=>(0,s.arrayBuffersEqual)(t,e.indexMac))).pop())||void 0===n?void 0:n.valueMac}))).apply(this,arguments)}yield(0,o.runInTransaction)(["SyncActionStore","PendingMutationStore","CollectionVersionStore"],function(){var t=(0,a.default)((function*(t){let{SyncActionStore:n,PendingMutationStore:r,CollectionVersionStore:i}=t;yield n.bulkRemove(m.map((e=>e.index))),yield n.bulkSet(v),yield r.bulkRemove(C),yield i.updateVersionAndLtHash(e,A,p)}));return function(){return t.apply(this,arguments)}}()),null==n||n.mark("update_DB_end",{source:y.SyncDataType.Patch}),__LOG__(2)`syncd: completed final transaction in _applyPatch for ${e} v${t.version.version}`}))).apply(this,arguments)}function z(){return q.apply(this,arguments)}function q(){return(q=(0,a.default)((function*(e,t,n,r){(0,T.reportSyncdCriticalBootstrapStage)(T.SyncdCriticalBootstrapStageType.ABOUT_TO_APPLY_MUTATIONS);const a=n===y.SyncDataType.Local?" (individual mutations)":"",o=[],s=(0,b.validateAndTypeSetMutations)(e,t),{supportedMutations:l,unsupportedMutations:c}=ee(e,s);c.forEach((e=>o.push((0,g.setMutationToSyncAction)(e,y.SyncActionState.Unsupported)))),null==r||r.mark("conflict_resolution_start",{source:n,collectionName:e,count:l.length});const{remoteMutationsToApply:u,pendingMutationsToDrop:d}=yield(0,A.resolveConflict)(e,l),f=l.filter((e=>!u.includes(e)));null==r||r.mark("conflict_resolution_end",{source:n,collectionName:e,apply:u.length,drop:f.length}),f.forEach((e=>o.push((0,g.setMutationToSyncAction)(e,y.SyncActionState.Skipped,e.actionName)))),null==r||r.mark("apply_set_mutations_start",{source:n,collectionName:e,count:u.length});const h=te(u);for(let t=0;t<h.length;t++){const n=h[t][0].actionHandler,r=h[t].map((e=>{let t;return t=e.binarySyncData?(0,p.default)((0,I.decodeProtobuf)(_.SyncActionDataSpec,e.binarySyncData).value,"decodeProtobuf(SyncActionDataSpec, m.binarySyncData).value"):(0,I.decodeProtobuf)(_.SyncActionValueSpec,e.binarySyncAction),{operation:"set",indexParts:e.indexArr,value:t,timestamp:e.timestamp}}));let i=[],s=!1;try{__LOG__(2)`syncd: before apply mutation batch for ${e}. mutations count: ${r.length}  ${a}`,i=yield n.applyMutations(r,{setMutationsPendingToPersist:o,allSupportedSetMutations:u})}catch(t){if(t instanceof E.SyncdFatalError||e===y.CollectionName.CriticalBlock)throw t;s=!0,__LOG__(3)`synd: catching error during _applySetMutations: ${t}`}__LOG__(2)`syncd: after apply mutation batch for ${e}  ${a}`;for(let e=0;e<h[t].length;e++){var m,S;const n=s?y.SyncActionState.Failed:i[e].actionState;o.push((0,g.setMutationToSyncAction)(h[t][e],n,h[t][e].actionName,s||null===(m=i[e].orphanModel)||void 0===m?void 0:m.modelId,s||null===(S=i[e].orphanModel)||void 0===S?void 0:S.modelType))}}const v=o.reduce(((e,t)=>{const n=t.actionState;return null==e[n]&&(e[n]=0),e[n]++,e}),{});return null==r||r.mark("apply_set_mutations_end",(0,i.default)({source:n,collectionName:e,count:u.length},v)),(0,T.reportSyncdCriticalBootstrapStage)(T.SyncdCriticalBootstrapStageType.APPLIED_MUTATIONS),__LOG__(2)`syncd: completed apply set mutations for ${e}  ${a}`,{setMutationsToPersist:o,pendingMutationsToDrop:d}}))).apply(this,arguments)}function J(){return Q.apply(this,arguments)}function Q(){return(Q=(0,a.default)((function*(e,t){const{supportedMutations:n}=X(t),r=te(n);__LOG__(2)`syncd: before apply remove mutations for ${e}`;for(let t=0;t<r.length;t++){const n=r[t][0].actionHandler;yield n.applyMutations(r[t].map((t=>({operation:"remove",indexParts:ne(e,t.index)}))),{setMutationsPendingToPersist:[],allSupportedSetMutations:[]})}__LOG__(2)`syncd: after apply remove mutations for ${e}`}))).apply(this,arguments)}function X(e){const t=[],n=[];return e.forEach((e=>{if(e.version>(0,o.getDbImpls)().getSyncMaxSupportedVersion())return void n.push(e);const r=ne(e.collection,e.index),i=y.Actions.cast(r[0]);if(!i)return __LOG__(3)`syncd: invalid action ${r[0]}`,void n.push(e);const a=(0,o.getDbImpls)().getSyncActionHandler(i);if(!a)return __LOG__(3)`syncd: no handler for action ${i}`,void n.push(e);t.push({collection:e.collection,index:e.index,indexMac:e.indexMac,keyId:e.keyId,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version,indexArr:r,actionName:i,actionHandler:a})})),{supportedMutations:t,unsupportedMutations:n}}function Z(e){const t=e.filter((e=>e.operation===f.SyncdMutation$SyncdOperation.SET)),n=new Set(t.map((e=>e.index)));return e.filter((e=>e.operation===f.SyncdMutation$SyncdOperation.REMOVE)).forEach((e=>{n.has(e.index)||t.push(e)})),t}function ee(e,t){const n=[],r=[];return t.forEach((t=>{if(t.version>(0,o.getDbImpls)().getSyncMaxSupportedVersion())return void r.push(t);const i=ne(e,t.index),a=y.Actions.cast(i[0]);if(!a)return __LOG__(3)`syncd: invalid action ${i[0]}`,void r.push(t);const s=(0,o.getDbImpls)().getSyncActionHandler(a);if(!s)return __LOG__(3)`syncd: no handler for action ${a}`,void r.push(t);n.push({collection:t.collection,index:t.index,indexMac:t.indexMac,keyId:t.keyId,timestamp:t.timestamp,binarySyncData:t.binarySyncData,valueMac:t.valueMac,version:t.version,indexArr:i,actionName:a,actionHandler:s})})),{supportedMutations:n,unsupportedMutations:r}}function te(e){return e.reduce(((e,t)=>(0!==e.length&&t.actionName===e[e.length-1][0].actionName?e[e.length-1].push(t):e.push([t]),e)),[])}function ne(e,t){try{const e=JSON.parse(t);if(e.length<1)throw new Error;return e}catch(t){throw(0,T.reportSyncdFatalError)(T.SyncdFatalErrorType.INVALID_ACTION_INDEX,e),new E.SyncdFatalError("invalid action index")}}},408708:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptedUploadMutationsToSyncActions=function(e,t){return e.map((e=>{const n=s(e.binarySyncAction);return{index:e.index,action:e.action,binarySyncData:n,actionState:t,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp}}))},t.setMutationToSyncAction=function(e,t,n,r,i){return{index:e.index,binarySyncData:e.binarySyncData,version:e.version,keyId:e.keyId,indexMac:e.indexMac,valueMac:e.valueMac,collection:e.collection,timestamp:e.timestamp,action:n,actionState:t,modelId:r,modelType:null!=i?i:void 0}},t.syncActionToSyncData=s,t.syncActionsToDecryptedMutation=function(e){return e.map((e=>({collection:e.collection,index:e.index,action:e.action,indexMac:e.indexMac,keyId:e.keyId,operation:r.SyncdMutation$SyncdOperation.SET,binarySyncData:e.binarySyncData,valueMac:e.valueMac,version:e.version})))};var r=n(550073),i=n(381),a=n(484902),o=n(760980);function s(e){const t=(0,a.decodeProtobuf)(i.SyncActionValueSpec,e);return(0,o.encodeProtobuf)(i.SyncActionDataSpec,{value:t}).readBuffer()}},611634:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(311504)),a=n(852455),o=n(960362),s=n(892844);class l{static loadStatesFromDb(){var e=this;return(0,i.default)((function*(){(yield(0,a.getAllCollectionVersionsInTransaction)()).forEach((t=>e.collectionStates.set(t.collection,{collection:t.collection,state:t.state,finiteFailureStartTime:t.finiteFailureStartTime})))}))()}static persistToDb(){const e=[];return this.collectionStates.forEach((t=>e.push(t))),__LOG__(2)`syncd: state machine persistToDb. states:`,e.forEach((e=>{const t=null==e.finiteFailureStartTime?"":`(failure start: ${e.finiteFailureStartTime})`;__LOG__(2)`syncd: ${e.collection}: ${e.state} ${t}`})),(0,a.bulkUpdateCollectionVersionInTransaction)(e)}static clean(){this.collectionStates=new Map}static getCollectionState(e){const t=this.collectionStates.get(e);return t?t.state:(this.moveCollectionsToUpToDate([e]),o.CollectionSyncState.UpToDate)}static getCollectionsInStateDirty(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Dirty&&e.push(t.collection)})),e}static getCollectionsInStateRetry(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.FailingFiniteRetry&&e.push(t.collection)})),e}static getCollectionsInStateFatal(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Fatal&&e.push(t.collection)})),e}static getCollectionsInStateBlocked(){const e=[];return this.collectionStates.forEach((t=>{t.state===o.CollectionSyncState.Blocked&&e.push(t.collection)})),e}static moveCollectionsToUpToDate(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.UpToDate,finiteFailureStartTime:void 0})))}static moveCollectionsToDirty(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Dirty,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static moveCollectionsToFiniteRetry(e){e.forEach((e=>{var t,n;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.FailingFiniteRetry,finiteFailureStartTime:null!==(t=null===(n=this.collectionStates.get(e))||void 0===n?void 0:n.finiteFailureStartTime)&&void 0!==t?t:(0,s.unixTimeMs)()})}))}static moveCollectionsToFatal(e){e.forEach((e=>this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Fatal})))}static moveCollectionsToBlocked(e){e.forEach((e=>{var t;return this.collectionStates.set(e,{collection:e,state:o.CollectionSyncState.Blocked,finiteFailureStartTime:null===(t=this.collectionStates.get(e))||void 0===t?void 0:t.finiteFailureStartTime})}))}static getExpiredCollections(){const e=[];return this.collectionStates.forEach((t=>{if(t.state===o.CollectionSyncState.FailingFiniteRetry){let n;null==t.finiteFailureStartTime?(n=1/0,__LOG__(3)`Collection ${t.collection} is in finite retry state with no failure start time`):n=t.finiteFailureStartTime;n+o.FINITE_FAILURE_EXPIRY_DURATION<(0,s.unixTimeMs)()&&e.push(t.collection)}})),e}static getCollectionMinFailureTime(){const e=Array.from(this.collectionStates.values()).filter((e=>e.state===o.CollectionSyncState.FailingFiniteRetry)).map((e=>e.finiteFailureStartTime)).filter(Boolean);return 0===e.length?null:Math.min(...e)}}t.default=l,l.collectionStates=new Map},452518:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeExternalBlobReference=function(e,t){try{return(0,s.decodeProtobuf)(r.ExternalBlobReferenceSpec,t)}catch(t){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED,e),new a.SyncdFatalError("external blob reference protobuf deserialization failed")}},t.decodeSyncActionData=function(e,t){try{return(0,s.decodeProtobuf)(i.SyncActionDataSpec,t)}catch(t){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED,e),new a.SyncdFatalError("action data protobuf deserialization failed")}},t.decodeSyncdMutations=function(e,t){try{return(0,s.decodeProtobuf)(r.SyncdMutationsSpec,t)}catch(t){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED,e),new a.SyncdFatalError("mutations protobuf deserialization failed")}},t.decodeSyncdPatch=function(e,t){try{return(0,s.decodeProtobuf)(r.SyncdPatchSpec,t)}catch(t){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.PATCH_PROTOBUF_DESERIALIZATION_FAILED,e),new a.SyncdFatalError("patch protobuf deserialization failed")}},t.decodeSyncdSnapshot=function(e,t){try{return(0,s.decodeProtobuf)(r.SyncdSnapshotSpec,t)}catch(t){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED,e),new a.SyncdFatalError("snapshot protobuf deserialization failed")}};var r=n(550073),i=n(381),a=n(266313),o=n(549334),s=n(484902)},709520:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.tryDecryptPatch=function(){return m.apply(this,arguments)},t.tryDecryptSnapshot=function(){return g.apply(this,arguments)};var i=r(n(311504)),a=n(266543),o=n(607589),s=n(550073),l=n(662109),c=n(632458),u=n(463109),d=n(452518),p=n(266313),f=n(549334),_=r(n(742352));const h=new TextDecoder;function g(){return(g=(0,i.default)((function*(e,t){return yield Promise.all(t.records.map((t=>y(e,s.SyncdMutation$SyncdOperation.SET,t))))}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){return yield Promise.all(t.mutations.map((t=>y(e,t.operation,t.record))))}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n){const r=n.keyId.id,i=yield(0,a.getDbImpls)().getSyncKeyData(r);if(!i){if(t===s.SyncdMutation$SyncdOperation.REMOVE)throw new p.SyncdFatalError("no key data for remove mutations");throw new p.SyncdMissingKeyError}const{syncAction:o,indexMac:l,valueMac:c,indexValueBinary:u}=yield E(e,r,i,t,n),{index:d,version:f}=o;return{index:h.decode(d),action:null,version:f,keyId:r,operation:t,indexMac:l,valueMac:c,collection:e,binarySyncData:u}}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,n,r,i){const a=i.index.blob,s=i.value.blob,h=(0,l.valueMacFromIndexAndValueCipherText)(s),g=(0,u.split)(s,c.IV_LENGTH,s.byteLength-c.MAC_LENGTH-c.IV_LENGTH),m=g[0],y=g[1],S=g[2],E=yield(0,l.generateEncryptionKeys)(n),{indexKey:v,valueEncryptionKey:T,valueMacKey:C}=E,A=(0,u.combine)([m,y]),b=(0,l.generateAssociatedData)(r,t),P=yield(0,l.generateMac)(b,A,C);if(!(0,o.arrayBuffersEqual)(S,P))throw(0,f.reportSyncdFatalError)(f.SyncdFatalErrorType.DECRYPTION_FAILED,e),new p.SyncdFatalError("decryption failure: valueMAC mismatch");const O=yield(0,l.decryptCipherText)(new Uint8Array(m),T,y),M=(0,d.decodeSyncActionData)(e,O),I=_.default.validateSyncActionDataProtobuf(e,M),w=yield(0,l.generateIndexMac)(v,I.index);if(!(0,o.arrayBuffersEqual)(a,w))throw(0,f.reportSyncdFatalError)(f.SyncdFatalErrorType.DECRYPTION_FAILED,e),new p.SyncdFatalError("decryption failure: indexMAC mismatch");return{syncAction:I,indexMac:a,valueMac:h,indexValueBinary:O}}))).apply(this,arguments)}},317809:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadExternalPatch=function(){return c.apply(this,arguments)},t.downloadSnapshot=function(){return l.apply(this,arguments)};var i=r(n(311504)),a=n(266543),o=n(452518),s=r(n(979889));function l(){return(l=(0,i.default)((function*(e,t){const n=yield(0,a.getDbImpls)().downloadSyncBlob(t,"snapshot",e),r=(0,o.decodeSyncdSnapshot)(e,n);return s.default.validateSnapshotProtobuf(e,r)}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t){const n=yield(0,a.getDbImpls)().downloadSyncBlob(t,"patch",e);return(0,o.decodeSyncdMutations)(e,n).mutations.map((t=>s.default.validateMutationProtobuf(e,t)))}))).apply(this,arguments)}},859115:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.resolveConflict=function(){return u.apply(this,arguments)};var i=r(n(311504)),a=n(532442),o=n(960362),s=n(488483);function l(){return c.apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t){const n=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const n=t.get(e.index);if(n){const t=e.actionHandler;return{remoteMutationIndex:e.index,conflictResolutionState:yield t.resolveConflicts(n,e)}}}));return function(){return e.apply(this,arguments)}}())),r=new Map;return n.forEach((e=>{e&&r.set(e.remoteMutationIndex,e.conflictResolutionState)})),r}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){const n=[];let r=[];const i=yield(0,a.getSyncPendingMutationsByCollectionInTransaction)(e),c=new Map(i.map((e=>[e.index,e]))),u=yield l(t,c);t.forEach((e=>{const t=u.get(e.index);if(t)switch(t){case o.ConflictResolutionState.SkipRemote:break;case o.ConflictResolutionState.ApplyRemoteAndDropLocal:n.push(e),r=r.concat(i.filter((t=>t.index===e.index)));break;case o.ConflictResolutionState.SkipRemoteAndDropLocal:r=r.concat(i.filter((t=>t.index===e.index)))}else n.push(e)}));const d=(0,s.sort)(n),p=[];for(let e=0;e<d.length;e++){const t=d[e].actionHandler;(yield t.dropMutationDueToCrossIndexConflict(d[e],c))||p.push(d[e])}return{remoteMutationsToApply:p,pendingMutationsToDrop:r.map((e=>e.id)).filter(Boolean)}}))).apply(this,arguments)}},488483:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t._setDependency=function(e,t){s.set(e,t)},t.sort=function(e){const t=[],n=[];try{return e.forEach((r=>{t.push(r);const i=s.get(r.actionName);null!=i&&e.forEach((e=>{e!==r&&i.includes(e.actionName)&&function(e,t){const n=e.actionHandler.getChatJidAndMessageKey(e),r=t.actionHandler.getChatJidAndMessageKey(t);if(n&&r)return n.chatJid===r.chatJid&&(null==n.messageKey||null==r.messageKey||n.messageKey===r.messageKey);return!1}(e,r)&&(e.timestamp<r.timestamp?n.push([e,r]):n.push([r,e]))}))})),o.default.array(t,n)}catch(e){throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH),new i.SyncdFatalError("cyclic mutation dependency in patch")}};n(960362);var i=n(266313),a=n(549334),o=r(n(150944));const s=new Map},949206:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateAndTypeSetMutations=function(e,t){return t.map((t=>{const n=(0,c.decodeProtobuf)(a.SyncActionDataSpec,t.binarySyncData).value;if(!n)throw(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.MISSING_ACTION_VALUE,e),new s.SyncdFatalError("missing action value");const i=(0,r.maybeNumberOrThrowIfTooLarge)(n.timestamp);if(null==i)throw(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.MISSING_ACTION_TIMESTAMP,e),new s.SyncdFatalError("missing action timestamp");return{index:t.index,version:t.version,keyId:t.keyId,indexMac:t.indexMac,valueMac:t.valueMac,collection:t.collection,binarySyncData:t.binarySyncData,timestamp:i}}))},t.validateNoDuplicatePatchVersionInCollection=function(e,t){const n=new Set;t.forEach((t=>{const r=t.version.version;if(n.has(r))throw(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.DUPLICATE_PATCH_VERSION_IN_COLLECTION,e),new s.SyncdFatalError("duplicate patch version in collection");n.add(r)}))},t.validateNoSameIndexForMultipleMutations=function(e,t,n){const r=new Set,a=new Set;t.forEach((t=>{let c=!1;if(t.operation===i.SyncdMutation$SyncdOperation.SET&&(r.has(t.index)?c=!0:r.add(t.index)),t.operation===i.SyncdMutation$SyncdOperation.REMOVE&&(a.has(t.index)?c=!0:a.add(t.index)),c)switch(n){case o.SyncDataType.Patch:throw(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH,e),new s.SyncdFatalError("same index for multiple mutations in patch");case o.SyncDataType.Snapshot:throw(0,l.reportSyncdFatalError)(l.SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT,e),new s.SyncdFatalError("same index for multiple mutations in snapshot");case o.SyncDataType.Local:__LOG__(3)`validation not required for local mutations`}}))};var r=n(608243),i=n(550073),a=n(381),o=n(960362),s=n(266313),l=n(549334),c=n(484902)},979889:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(608243),i=n(266313),a=n(549334);class o{static validateSnapshotProtobuf(e,t){const{version:n,records:s,mac:l,keyId:c}=t,u=null==n?void 0:n.version;if(!n||null==u)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_SNAPSHOT_VERSION,e),new i.SyncdFatalError("missing snapshot version");const d=s.map((t=>o.validateRecordProtobuf(e,t)));if(!l)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_SNAPSHOT_MAC,e),new i.SyncdFatalError("missing snapshot mac");const p=o.validateKeyIdProtobuf(e,c,a.SyncdFatalErrorType.MISSING_SNAPSHOT_KEY_ID);return{version:{version:(0,r.numberOrThrowIfTooLarge)(u)},records:d,mac:l,keyId:p}}static validatePatchProtobuf(e,t){const{version:n,mutations:s,externalMutations:l,snapshotMac:c,patchMac:u,keyId:d,exitCode:p,deviceIndex:f}=t,_=null==n?void 0:n.version;if(!n||null==_)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_PATCH_VERSION,e),new i.SyncdFatalError("missing patch version");if(s&&s.length>0&&l)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS,e),new i.SyncdFatalError("patch with both inline and external mutations");if(!c)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_PATCH_SNAPSHOT_MAC,e),new i.SyncdFatalError("missing patch snapshot mac");if(!u)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_PATCH_MAC,e),new i.SyncdFatalError("missing patch mac");const h=o.validateKeyIdProtobuf(e,d,a.SyncdFatalErrorType.MISSING_PATCH_KEY_ID);if(l){const t=o.validateExternalBlobReference(e,l);return{version:{version:(0,r.numberOrThrowIfTooLarge)(_)},mutations:void 0,externalMutations:t,snapshotMac:c,patchMac:u,keyId:h,deviceIndex:f}}const g=s.map((t=>o.validateMutationProtobuf(e,t)));return{version:{version:(0,r.numberOrThrowIfTooLarge)(_)},mutations:g,externalMutations:void 0,exitCode:p,snapshotMac:c,patchMac:u,keyId:h,deviceIndex:f}}static validateExternalBlobReference(e,t){const{mediaKey:n,directPath:r,handle:o,fileSizeBytes:s,fileSha256:l,fileEncSha256:c}=t;if(!n)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY,e),new i.SyncdFatalError("missing external blob reference media key");if(null==r)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH,e),new i.SyncdFatalError("missing external blob reference direct path");if(!l)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256,e),new i.SyncdFatalError("missing external blob reference file SHA256");if(!c)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256,e),new i.SyncdFatalError("missing external blob reference file enc SHA256");return{mediaKey:n,directPath:r,handle:o,fileSizeBytes:s,fileSha256:l,fileEncSha256:c}}static validateMutationProtobuf(e,t){const{operation:n,record:r}=t;if(null==n)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_MUTATION_OPERATION,e),new i.SyncdFatalError("missing mutation operation");if(!r)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_MUTATION_RECORD,e),new i.SyncdFatalError("missing mutation record");return{operation:n,record:o.validateRecordProtobuf(e,r)}}static validateRecordProtobuf(e,t){const{index:n,value:r,keyId:s}=t,l=null==n?void 0:n.blob,c=null==r?void 0:r.blob;if(!n||!l)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_MUTATION_INDEX,e),new i.SyncdFatalError("missing mutation index");if(!r||!c)throw(0,a.reportSyncdFatalError)(a.SyncdFatalErrorType.MISSING_MUTATION_VALUE,e),new i.SyncdFatalError("missing mutation value");return{index:{blob:l},value:{blob:c},keyId:o.validateKeyIdProtobuf(e,s,a.SyncdFatalErrorType.MISSING_MUTATION_KEY_ID)}}static validateKeyIdProtobuf(e,t,n){const r=null==t?void 0:t.id;if(!t||!r)throw(0,a.reportSyncdFatalError)(n,e),new i.SyncdFatalError("missing mutation key id");return{id:r}}}t.default=o},742352:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(266313),i=n(549334);t.default=class{static validateSyncActionDataProtobuf(e,t){const{index:n,value:a,padding:o,version:s}=t;if(!n)throw(0,i.reportSyncdFatalError)(i.SyncdFatalErrorType.MISSING_ACTION_INDEX,e),new r.SyncdFatalError("missing action index");if(null==s)throw(0,i.reportSyncdFatalError)(i.SyncdFatalErrorType.MISSING_ACTION_VERSION,e),new r.SyncdFatalError("missing action version");return{index:n,value:a,padding:o,version:s}}}},662109:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decryptCipherText=function(e,t,n){return(0,i.aesCbcDecrypt)(t,e,n)},t.generateAssociatedData=function(e,t){let n;switch(e){case s.SyncdMutation$SyncdOperation.SET:n=l.OPERATION_SET_HEX;break;case s.SyncdMutation$SyncdOperation.REMOVE:n=l.OPERATION_REMOVE_HEX}if(n){const e=new Uint8Array([parseInt(n,16)]).buffer,r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),r.buffer}throw new Error("invalid mutation operation value")},t.generateCipherText=function(e,t,n){return(0,i.aesCbcEncrypt)(t,n,e)},t.generateEncryptionKeys=void 0,t.generateIndexMac=function(e,t){return(0,a.hmacSha256)(new Uint8Array(e),new Uint8Array(t))},t.generateMac=function(e,t,n){const r=new Uint8Array(l.OCTET_LENGTH);r.set([e.byteLength],r.byteLength-1);const i=(0,u.combine)([e,t,r.buffer]);return(0,a.hmacSha512)(n,i,l.MAC_LENGTH)},t.generatePadding=function(e,t){const n=Math.max(0,l.MAX_OF_MIN_DATA_LENGTH-e-t),r=new Uint8Array(n);return self.crypto.getRandomValues(r),r.buffer},t.generatePatchMac=function(e,t,n,r,i){return(0,a.hmacSha256)(e,(0,u.combine)([t,...n,r,i]))},t.generateSnapshotMac=function(e,t,n,r){return(0,a.hmacSha256)(e,(0,u.combine)([t,n,r]))},t.valueMacFromIndexAndValueCipherText=function(e){const t=e.byteLength;return new Uint8Array(e).slice(t-l.MAC_LENGTH).buffer};var r=n(615688),i=n(781484),a=n(411141),o=n(135174),s=n(550073),l=n(632458),c=n(240184),u=n(463109);const d=(0,o.memoizeWithArgs)(c.generateEncryptionKeysUnmemoized,r.encodeB64);t.generateEncryptionKeys=d},632458:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_MAC_KEY_LENGTH=t.VALUE_MAC_KEY_END=t.VALUE_ENCRYPTION_KEY_LENGTH=t.VALUE_ENCRYPTION_KEY_END=t.SNAPSHOT_MAC_KEY_LENGTH=t.SNAPSHOT_MAC_KEY_END=t.PATCH_MAC_KEY_LENGTH=t.PATCH_MAC_KEY_END=t.OPERATION_SET_HEX=t.OPERATION_REMOVE_HEX=t.OCTET_LENGTH=t.MAX_OF_MIN_DATA_LENGTH=t.MAC_LENGTH=t.IV_LENGTH=t.INDEX_KEY_LENGTH=t.INDEX_KEY_END=t.HKDF_INFO=t.EMPTY_MUTATION_MAC=t.DERIVED_KEY_LENGTH=void 0;t.HKDF_INFO="WhatsApp Mutation Keys";t.DERIVED_KEY_LENGTH=160;t.INDEX_KEY_LENGTH=32;t.VALUE_ENCRYPTION_KEY_LENGTH=32;t.VALUE_MAC_KEY_LENGTH=32;t.SNAPSHOT_MAC_KEY_LENGTH=32;t.PATCH_MAC_KEY_LENGTH=32;t.INDEX_KEY_END=32;t.VALUE_ENCRYPTION_KEY_END=64;t.VALUE_MAC_KEY_END=96;t.SNAPSHOT_MAC_KEY_END=128;t.PATCH_MAC_KEY_END=160;t.OPERATION_SET_HEX="0x01";t.OPERATION_REMOVE_HEX="0x02";t.MAX_OF_MIN_DATA_LENGTH=0;t.MAC_LENGTH=32;t.OCTET_LENGTH=8;t.IV_LENGTH=16;const n=new ArrayBuffer(32);t.EMPTY_MUTATION_MAC=n},240184:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEncryptionKeysUnmemoized=function(){return s.apply(this,arguments)};var i=r(n(311504)),a=n(181576),o=n(632458);function s(){return(s=(0,i.default)((function*(e){const t=yield l(e);return{indexKey:t.slice(0,o.INDEX_KEY_END),valueEncryptionKey:t.slice(o.INDEX_KEY_END,o.VALUE_ENCRYPTION_KEY_END),valueMacKey:t.slice(o.VALUE_ENCRYPTION_KEY_END,o.VALUE_MAC_KEY_END),snapshotMacKey:t.slice(o.VALUE_MAC_KEY_END,o.SNAPSHOT_MAC_KEY_END),patchMacKey:t.slice(o.SNAPSHOT_MAC_KEY_END,o.PATCH_MAC_KEY_END)}}))).apply(this,arguments)}function l(e){return(0,a.extractAndExpand)(e,o.HKDF_INFO,o.DERIVED_KEY_LENGTH)}},463109:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16))).toString().replace(/,/g," ")},t.arrayBufferToHexPadded=function(e){return Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("")},t.combine=function(e){if(0===e.length)throw new Error("buffers length is zero");if(1===e.length)return e[0];const t=e.map((e=>e.byteLength)).reduce(((e,t)=>e+t)),n=new Uint8Array(t);let r,i=0;for(r=0;r<e.length;r++)n.set(new Uint8Array(e[r]),i),i+=e[r].byteLength;return n.buffer},t.hexToUint8Array=function(e){return Uint8Array.from(e.split(" ").map((e=>parseInt(e,16))))},t.split=function(e,t,n){if(t<0||n<0)throw new Error("buffers length is zero");const r=new Array(3),i=new Uint8Array(e);return r[0]=i.slice(0,t).buffer,r[1]=i.slice(t,t+n).buffer,r[2]=i.slice(t+n).buffer,r},t.to64BitNetworkOrder=function(e){const t=new ArrayBuffer(8);return new DataView(t).setUint32(4,e,!1),t},t.toUtf8=function(e){return n.encode(e)};const n=new TextEncoder},808221:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMissingKeysInPatches=function(){return p.apply(this,arguments)},t.handleMissingKeysInSnapshot=function(){return d.apply(this,arguments)};var i=r(n(311504)),a=n(266543),o=n(607589),s=n(777651),l=(n(960362),n(463109)),c=n(266313);const u=new ArrayBuffer(0);function d(){return(d=(0,i.default)((function*(e,t){const n=new Set,r=(yield(0,s.getAllSyncKeysInTransaction)()).map((e=>(0,l.arrayBufferToHex)(e.keyId)));t.records.forEach((e=>{const t=e.keyId.id;if((0,o.arrayBuffersEqual)(t,u))throw new c.SyncdFatalError("snapshot has empty key");const i=(0,l.arrayBufferToHex)(t);r.includes(i)||n.add(i)})),__LOG__(2)`syncd: collection ${e}'s snapshot has missing keys ${Array.from(n)}`,yield(0,a.getDbImpls)().handleMissingSyncKeys(n)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=new Set,r=(yield(0,s.getAllSyncKeysInTransaction)()).map((e=>(0,l.arrayBufferToHex)(e.keyId)));t.forEach((e=>{const t=e.keyId.id;if((0,o.arrayBuffersEqual)(t,u))throw new c.SyncdFatalError("syncd: patch has empty key. patch device id: ${p.deviceIndex}");const i=(0,l.arrayBufferToHex)(t);r.includes(i)||(__LOG__(2)`syncd: handleMissingKeysInPatches: missing key: keyId: ${i}, patch version: ${e.version.version}, patch device id: ${e.deviceIndex}`,n.add(i))})),__LOG__(2)`syncd: collection ${e}'s patches has missing keys ${Array.from(n)}`,yield(0,a.getDbImpls)().handleMissingSyncKeys(n)}))).apply(this,arguments)}},353771:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDeviceId=function(e){return new DataView(e).getUint16(0)},t.getKeyEpoch=function(e){return new DataView(e).getUint32(2)}},395395:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMutation=function(){return y.apply(this,arguments)};var i=r(n(73982)),a=r(n(311504)),o=n(676100),s=n(266543),l=n(41007),c=n(550073),u=n(381),d=n(662109),p=n(632458),f=n(463109),_=n(266313),h=n(549334),g=n(333999),m=n(484902);function y(){return(y=(0,a.default)((function*(e,t){const{index:n,operation:r}=e;let a=t.keyId,o=t.keyData;switch(r){case c.SyncdMutation$SyncdOperation.SET:break;case c.SyncdMutation$SyncdOperation.REMOVE:{const e=yield(0,l.getSyncActionInTransaction)(n);if(!e)throw new _.SyncdFatalError("no corresponding set mutation");const t=e.keyId,r=yield(0,s.getDbImpls)().getSyncKeyData(t);if(null==r)throw new _.SyncdFatalError("no key data for corresponding mutation");a=t,o=r}}const{indexMac:u,indexAndValueCipherText:p}=yield S(e,a,o),f=(0,d.valueMacFromIndexAndValueCipherText)(p);return(0,i.default)((0,i.default)({},e),{},{keyId:a,keyData:o,indexMac:u,indexAndValueCipherText:p,valueMac:f})}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,n){try{const{index:r,binarySyncAction:i,operation:a,version:s}=e,l=(0,o.stringToArrayBuffer)(r),c=yield(0,d.generateEncryptionKeys)(n),{indexKey:u,valueEncryptionKey:_,valueMacKey:h}=c,g=yield self.crypto.getRandomValues(new Uint8Array(p.IV_LENGTH)),m=v(l,i,(0,d.generatePadding)(l.byteLength,i.byteLength),s),y=yield(0,d.generateCipherText)(g,_,m),S=(0,d.generateAssociatedData)(a,t),E=yield(0,d.generateMac)(S,y,h),T=(0,f.combine)([y,E]);return{indexMac:yield(0,d.generateIndexMac)(u,l),indexAndValueCipherText:T}}catch(e){throw(0,h.reportSyncdFatalError)(h.SyncdFatalErrorType.ENCRYPTION_FAILED),new _.SyncdFatalError("encryption failure")}}))).apply(this,arguments)}function v(e,t,n,r){return(0,g.encodeSyncActionData)({index:e,value:(0,m.decodeProtobuf)(u.SyncActionValueSpec,t),padding:n,version:r})}},268798:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exceedInlineMutationCount=function(e){const t=Math.min(2e3,Math.max((0,r.getConfig)().syncdInlineMutationsMaxCount(),100));return e.length>t},t.exceedPatchProtobufSize=function(e){const t=1e3*Math.min(100,Math.max((0,r.getConfig)().syncdPatchProtobufMaxSize(),10));return e.byteLength>t};var r=n(266543)},657391:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=r(n(311504)),a=n(532442),o=n(878424),s=n(629831);function l(){return(l=(0,i.default)((function*(e){const t=new Map,n=new Map;yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const r=yield(0,a.getSyncPendingMutationsByCollectionInTransaction)(e),i=r.map((e=>e.id)).filter(Boolean);n.set(e,i);const o=(0,s.compactPatch)(r);t.set(e,o)}));return function(){return e.apply(this,arguments)}}()));const r=yield(0,o.buildSyncIqNode)(t);return{syncIqNode:r.syncIqNode,collectionWithPendingMutationsIds:n,collectionWithEncryptedMutations:r.collectionWithEncryptedMutations,localCollectionVersions:r.localCollectionVersions,collectionsToSkip:r.collectionsToSkip}}))).apply(this,arguments)}},878424:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t._generateMutationsToUpload=k,t.buildSyncIqNode=function(){return C.apply(this,arguments)};var i=r(n(311504)),a=n(615688),o=n(266543),s=n(607589),l=n(852455),c=n(41007),u=n(252230),d=n(541996),p=n(550073),f=n(278009),_=n(960362),h=n(395395),g=n(353771),m=n(268798),y=n(164423),S=n(333999),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=T(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(607414)),v=n(831914);function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(T=function(e){return e?n:t})(e)}function C(){return(C=(0,i.default)((function*(e){const{collectionNodes:t,collectionWithEncryptedMutations:n,localCollectionVersions:r,collectionsToSkip:i}=yield A(e);return{syncIqNode:(0,v.wap)("iq",{to:v.S_WHATSAPP_NET,xmlns:"w:sync:app:state",type:"set",id:(0,v.generateId)()},(0,v.wap)("sync",null,t)),collectionWithEncryptedMutations:n,localCollectionVersions:r,collectionsToSkip:i}}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){__LOG__(2)`syncd: start _buildCollectionNodes`;const t=[],n=function(){var e=(0,i.default)((function*(e,n){const r=yield(0,l.getCollectionVersionInTransaction)(e).then((e=>null==e?void 0:e.version));let i,a;if(null!=n&&n.length>0)if(null==r)__LOG__(2)`syncd: skipping ${e} in sync iq patch because initial full sync
is incomplete`,t.push(e);else{const{patchNode:t,encryptedMutations:r}=yield P(e,n);i=t,a=r}return{collection:e,version:r,patchNode:i,encryptedMutations:a}}));return function(){return e.apply(this,arguments)}}(),r=new Map,a=new Map,o=[];e.forEach(((e,t)=>o.push(n(t,e))));const s=(yield Promise.all(o)).map((e=>{const{collection:t,version:n,patchNode:i,encryptedMutations:o}=e;return o&&a.set(t,o),r.set(t,n),(0,v.wap)("collection",{name:(0,v.CUSTOM_STRING)(t),version:(0,v.INT)(null!=n?n:_.DEFAULT_COLLECTION_VERSION),return_snapshot:void 0===n?"true":"false"},i)}));return __LOG__(2)`syncd: end _buildCollectionNodes`,{collectionNodes:s,collectionWithEncryptedMutations:a,localCollectionVersions:r,collectionsToSkip:t}}))).apply(this,arguments)}function P(){return O.apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){const n=yield(0,o.getDbImpls)().getSyncActiveKey(!M(t)),r=(yield k(e,t,n)).map((e=>(0,h.encryptMutation)(e,n))),a=yield Promise.all(r),s=a.map((e=>({indexMac:e.indexMac,valueMac:e.valueMac,operation:e.operation}))),l=yield(0,f.computeLtHash)(e,s),{snapshotMac:c,patchMac:u}=yield(0,f.computeOutgoingSnapshotAndPatchMacs)(e,l,a,n.keyData),d=a.map((e=>D(e.keyId,e.operation,e.indexMac,e.indexAndValueCipherText))),p=L(d),_=function(){var e=(0,i.default)((function*(){const e=yield(0,o.getDbImpls)().uploadSyncExternalPatch(p);return R(yield I(e,p),n.keyId,c,u)}));return function(){return e.apply(this,arguments)}}();let g;(0,m.exceedInlineMutationCount)(d)?g=yield _():(g=N(d,n.keyId,c,u),(0,m.exceedPatchProtobufSize)(g)&&(g=yield _()));return{patchNode:(0,v.wap)("patch",null,g),encryptedMutations:a}}))).apply(this,arguments)}function M(e){return(0,o.getDbImpls)().getLogoutInProgress&&e.some((e=>JSON.parse(e.index)[0]===_.Actions.Sentinel))}function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t){const{mediaKey:n,directPath:r,encFilehash:i,handle:o}=e;if(!o)throw new Error("Missing handle after uploading external patch to mms4");const s=yield(0,d.calculateFilehash)(t);return{mediaKey:(0,a.decodeB64)(n),directPath:r,handle:o,fileSizeBytes:t.byteLength,fileSha256:(0,a.decodeB64)(s),fileEncSha256:(0,a.decodeB64)(i)}}))).apply(this,arguments)}function R(e,t,n,r){const i=(0,o.getConfig)().syncdPatchDeviceIndexIncluded()?(0,u.extractDeviceId)((0,o.getMyDeviceJid)()):void 0;return(0,S.encodeSyncdPatch)({keyId:{id:t},externalMutations:e,snapshotMac:n,patchMac:r,deviceIndex:i})}function N(e,t,n,r){const i=(0,o.getConfig)().syncdPatchDeviceIndexIncluded()?(0,u.extractDeviceId)((0,o.getMyDeviceJid)()):void 0;return(0,S.encodeSyncdPatch)({keyId:{id:t},mutations:e,snapshotMac:n,patchMac:r,deviceIndex:i})}function L(e){return(0,S.encodeSyncdMutations)({mutations:e})}function D(e,t,n,r){return{operation:t,record:{keyId:{id:e},index:{blob:n},value:{blob:r}}}}function k(){return U.apply(this,arguments)}function U(){return(U=(0,i.default)((function*(e,t,n){const r=yield(0,c.getSyncActionsByCollectionsInTransaction)([e]);let i=t;const a=G(r,t,n.keyId);i=i.concat(a);const o=x(r,i,n.keyId);return E.addKeyRotationRemoveCount(o.length),i=i.concat(o),i}))).apply(this,arguments)}function G(e,t,n){let r=e.filter((e=>!t.map((e=>e.index)).includes(e.index)&&!(0,s.arrayBuffersEqual)(e.keyId,n)));r=function(e,t){const n=e.map(((e,n)=>({index:n,sortValue:t(e),value:e})));return n.sort(((e,t)=>{const n=e.sortValue,r=t.sortValue;return n>r?1:n<r?-1:e.index-t.index})),n.map((e=>e.value))}(r,(e=>(0,g.getKeyEpoch)(e.keyId)));const i=Math.min(5,Math.max(1,(0,o.getConfig)().syncdAdditionalMutations()));return r=r.slice(0,i),(0,y.syncActionsToPendingMutations)(r,p.SyncdMutation$SyncdOperation.SET)}function x(e,t,n){const r=t.map((e=>e.index)),i=e.filter((e=>r.includes(e.index))).filter((e=>!(0,s.arrayBuffersEqual)(e.keyId,n)));return(0,y.syncActionsToPendingMutations)(i,p.SyncdMutation$SyncdOperation.REMOVE)}},164423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncActionsToPendingMutations=function(e,t){return e.map((e=>{const n=(0,i.decodeProtobuf)(r.SyncActionDataSpec,e.binarySyncData).value,o=(0,a.encodeProtobuf)(r.SyncActionValueSpec,n).readBuffer();return{collection:e.collection,index:e.index,binarySyncAction:o,operation:t,version:e.version,timestamp:e.timestamp,action:e.action}}))};var r=n(381),i=n(484902),a=n(760980)},629831:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compactPatch=function(e){return function(e,t){const n=new Set;return e.filter((e=>{const r=t(e);return!n.has(r)&&(n.add(r),!0)}))}(e.reverse(),(e=>e.index)).reverse()}},333999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSyncActionData=function(e){try{return(0,s.encodeProtobuf)(i.SyncActionDataSpec,e).readBuffer()}catch(e){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED),new a.SyncdFatalError("action data protobuf serialization failed")}},t.encodeSyncdMutations=function(e){try{return(0,s.encodeProtobuf)(r.SyncdMutationsSpec,e).readBuffer()}catch(e){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED),new a.SyncdFatalError("mutations protobuf serialization failed")}},t.encodeSyncdPatch=function(e){try{return(0,s.encodeProtobuf)(r.SyncdPatchSpec,e).readBuffer()}catch(e){throw(0,o.reportSyncdFatalError)(o.SyncdFatalErrorType.PATCH_PROTOBUF_SERIALIZATION_FAILED),new a.SyncdFatalError("patch protobuf serialization failed")}};var r=n(550073),i=n(381),a=n(266313),o=n(549334),s=n(760980)},852455:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGetCollectionVersionsInTransaction=function(e){return(0,r.runInTransaction)(["CollectionVersionStore"],(t=>{let{CollectionVersionStore:n}=t;return n.bulkGet(e)}))},t.bulkUpdateCollectionVersionInTransaction=function(e){return(0,r.runInTransaction)(["CollectionVersionStore"],(t=>{let{CollectionVersionStore:n}=t;return n.bulkUpdate(e)}))},t.getAllCollectionVersionsInTransaction=function(){return(0,r.runInTransaction)(["CollectionVersionStore"],(e=>{let{CollectionVersionStore:t}=e;return t.getAll()}))},t.getCollectionVersionInTransaction=function(e){return(0,r.runInTransaction)(["CollectionVersionStore"],(t=>{let{CollectionVersionStore:n}=t;return n.get(e)}))},t.getCollectionVersionLtHash=a,t.getCollectionVersionLtHashInTransaction=function(e){return(0,r.runInTransaction)(["CollectionVersionStore"],(t=>{let{CollectionVersionStore:n}=t;return a({CollectionVersionStore:n},e)}))},t.updateCollectionVersionAndLtHashInTransaction=function(e,t,n){return(0,r.runInTransaction)(["CollectionVersionStore"],(r=>{let{CollectionVersionStore:i}=r;return i.updateVersionAndLtHash(e,t,n)}))};var r=n(266543),i=n(400899);function a(e,t){let{CollectionVersionStore:n}=e;return n.get(t).then((e=>{var t;return null!==(t=null==e?void 0:e.ltHash)&&void 0!==t?t:new ArrayBuffer(i.KEY_LENGTH_BYTES)}))}},896005:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllMissingKeysInTransaction=function(){return(0,r.runInTransaction)(["MissingKeyStore"],(e=>{let{MissingKeyStore:t}=e;return t.getAll()}))},t.getMissingKeyCountTransaction=function(){return(0,r.runInTransaction)(["MissingKeyStore"],(e=>{let{MissingKeyStore:t}=e;return t.count()}))};var r=n(266543)},532442:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllSyncPendingMutationsInTransaction=function(){return(0,r.runInTransaction)(["PendingMutationStore"],(e=>{let{PendingMutationStore:t}=e;return t.getAll()}))},t.getSyncPendingMutationsByCollectionInTransaction=function(e){return(0,r.runInTransaction)(["PendingMutationStore"],(t=>{let{PendingMutationStore:n}=t;return n.getByCollection(e)}))};var r=n(266543)},41007:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bulkUpdateSyncActionsInTransaction=function(e){return(0,r.runInTransaction)(["SyncActionStore"],(t=>{let{SyncActionStore:n}=t;return n.bulkUpdate(e)}))},t.countSyncActionsInTransaction=function(){return(0,r.runInTransaction)(["SyncActionStore"],(e=>{let{SyncActionStore:t}=e;return t.count()}))},t.getAllSyncActions=function(){return(0,r.runInTransaction)(["SyncActionStore"],(e=>{let{SyncActionStore:t}=e;return t.getAll()}))},t.getSyncActionInTransaction=function(e){return(0,r.runInTransaction)(["SyncActionStore"],(t=>{let{SyncActionStore:n}=t;return n.get(e)}))},t.getSyncActionsByActionStatesInTransaction=function(e){return(0,r.runInTransaction)(["SyncActionStore"],(t=>{let{SyncActionStore:n}=t;return n.getByActionStates(e)}))},t.getSyncActionsByCollectionsInTransaction=function(e){return(0,r.runInTransaction)(["SyncActionStore"],(t=>{let{SyncActionStore:n}=t;return n.getByCollections(e)}))},t.getSyncActionsByIndexMacsInTransaction=function(e){return(0,r.runInTransaction)(["SyncActionStore"],(t=>{let{SyncActionStore:n}=t;return n.getByIndexMacs(e)}))},t.getSyncActionsByModelInfosInTransaction=function(e){return(0,r.runInTransaction)(["SyncActionStore"],(t=>{let{SyncActionStore:n}=t;return n.getByModelInfos(e)}))};var r=n(266543)},777651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAllSyncKeysInTransaction=function(){return(0,r.runInTransaction)(["SyncKeyStore"],(e=>{let{SyncKeyStore:t}=e;return t.getAll()}))};var r=n(266543)},365926:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBootstrap=function(e){return null==e},t.isCriticalCollection=function(e){switch(e){case r.CollectionName.CriticalBlock:case r.CollectionName.CriticalUnblockLow:return!0;case r.CollectionName.Regular:case r.CollectionName.RegularHigh:case r.CollectionName.RegularLow:return!1}};var r=n(960362)},549334:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdFatalErrorType=t.SyncdEventFlow=t.SyncdDecryptMutationsType=t.SyncdCriticalEventType=t.SyncdCriticalBootstrapStageType=t.SyncdBootstrapDataAppliedSnapshotUsed=void 0,t.constructAnnotationsFromContext=g,t.convertSyncdBootstrapAppStateDownloadFromAnnotations=function(e){var t,n,r,i;const a=null==e||null===(t=e.string)||void 0===t?void 0:t.collection,s=null==e||null===(n=e.int)||void 0===n?void 0:n.downloadSize,l=null==e||null===(r=e.int)||void 0===r?void 0:r.downloadStartTs,c=null==e||null===(i=e.bool)||void 0===i?void 0:i.isSuccess;if(null==a)return __LOG__(4,void 0,new Error)`syncd: missing collection for bootstrap app state download metric`,null;if(null==l)return __LOG__(4,void 0,new Error)`syncd: missing downloadStartTs for bootstrap app state download metric`,null;if(null==c)return __LOG__(4,void 0,new Error)`syncd: missing isSuccess for bootstrap app state download metric`,null;const u=o.CollectionName.cast(a);if(null==u)return __LOG__(4,void 0,new Error)`syncd: unknown collection ${a} for bootstrap app state download metric`,null;return{collection:u,downloadStartTs:l,downloadSize:s,isSuccess:c?"success":"failure"}},t.convertSyncdBootstrapDataAppliedFromAnnotations=function(e){var t,n,r;const i=null==e||null===(t=e.string)||void 0===t?void 0:t.collection,a=null==e||null===(n=e.bool)||void 0===n?void 0:n.snapshot,s=null==e||null===(r=e.int)||void 0===r?void 0:r.durationMs;if(null==i)return __LOG__(4,void 0,new Error)`syncd: missing collection for bootstrap data applied event`,null;if(null==a)return __LOG__(4,void 0,new Error)`syncd: missing snapshotUsed for bootstrap data applied event`,null;if(null==s)return __LOG__(4,void 0,new Error)`syncd: missing durationMs for bootstrap data applied event`,null;const l=o.CollectionName.cast(i);if(null==l)return __LOG__(4,void 0,new Error)`syncd: unknown collection ${i} for bootstrap data applied event`,null;const c=a?p.SNAPSHOT_USED:p.SNAPSHOT_NOT_USED;return{collection:l,snapshotUsed:c,durationMs:s}},t.convertSyncdCriticalBootstrapStageFromAnnotations=function(e){var t;const n=null==e||null===(t=e.string)||void 0===t?void 0:t.criticalBootstrapStage;if(null==n)return __LOG__(4,void 0,new Error)`syncd: missing bootstrap stage for critical bootstrap stage`,null;const r=u.cast(n);if(null==r)return __LOG__(4,void 0,new Error)`syncd: unknown bootstrap stage: ${n} for critical bootstrap stage`,null;return{type:r}},t.convertSyncdCriticalEventFromAnnotations=function(e){var t,n;const r=null==e||null===(t=e.string)||void 0===t?void 0:t.criticalEventCode;if(null==r)return __LOG__(4,void 0,new Error)`syncd: missing error code for critical event`,null;const i=c.cast(r);if(null==i)return __LOG__(4,void 0,new Error)`syncd: unknown error code: ${r} for critical event`,null;return{type:i,collection:o.CollectionName.cast(null==e||null===(n=e.string)||void 0===n?void 0:n.collection)}},t.convertSyncdCriticalEventToAnnotations=h,t.convertSyncdDecryptMutationsMetricsFromAnnotations=function(e){var t,n,r,i;const a=null==e||null===(t=e.string)||void 0===t?void 0:t.mutationType,o=null==e||null===(n=e.int)||void 0===n?void 0:n.count,s=null==e||null===(r=e.int)||void 0===r?void 0:r.totalAdditionalMessagesCount,l=null==e||null===(i=e.int_array)||void 0===i?void 0:i.messageRangeLengths;if(null==a)return __LOG__(4,void 0,new Error)`syncd: missing type for DecryptMutations`,null;if(null==o)return __LOG__(4,void 0,new Error)`syncd: missing count for DecryptMutations`,null;if(null==s)return __LOG__(4,void 0,new Error)`syncd: missing totalAdditionalMessagesCount for DecryptMutations`,null;if(null==l)return __LOG__(4,void 0,new Error)`syncd: missing decryptedMutationMessageRangeCountArray for DecryptMutations`,null;const c=d.cast(a);if(null==c)return __LOG__(4,void 0,new Error)`syncd: unknown SyncdDecryptMutationsType for DecryptMutations`,null;return{type:c,count:o,totalAdditionalMessagesCount:s,decryptedMutationMessageRangeCountArray:l}},t.convertSyncdFatalErrorFromAnnotations=function(e){var t,n,r,i;const a=null==e||null===(t=e.string)||void 0===t?void 0:t.errorCode;if(null==a)return __LOG__(4,void 0,new Error)`syncd: missing error code for syncd fatal error`,null;const s=l.cast(a);if(null==s)return __LOG__(4,void 0,new Error)`syncd: unknown error code: ${a} for syncd fatal error`,null;return{type:s,collection:o.CollectionName.cast(null==e||null===(n=e.string)||void 0===n?void 0:n.collection),patchSnapshotMutationCount:null==e||null===(r=e.int)||void 0===r?void 0:r.patchSnapshotMutationCount,patchVersion:null==e||null===(i=e.int)||void 0===i?void 0:i.patchVersion}},t.reportSyncdBootstrapAppStateDownloadMetric=function(e){const t=(0,i.startMetric)(r.PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD);"success"!==e.isSuccess?t.endFail("syncd error: Error downloading snapshot or patches",_(e)):t.endSuccess(_(e))},t.reportSyncdBootstrapDataApplied=function(e,t,n){(0,i.startMetric)(r.PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED).endSuccess((a={collection:e,snapshotUsed:t,durationMs:n},{string:{collection:a.collection},bool:{snapshot:a.snapshotUsed===p.SNAPSHOT_USED},int:{durationMs:a.durationMs}}));var a},t.reportSyncdCriticalBootstrapStage=f,t.reportSyncdCriticalEvent=function(e,t){(0,i.startMetric)(r.PRE_METRIC.SYNCD_CRITICAL_EVENT).endFail("syncd critical event: "+e,h({type:e,collection:t}))},t.reportSyncdDecryptedMutations=function(e,t){f(u.MUTATIONS_DECRYPTED),(0,i.startMetric)(r.PRE_METRIC.SYNCD_DECRYPT_MUTATIONS).endSuccess(function(e){const{type:t,mutations:n}=e;let r,i=0;const o=[];return n.forEach((e=>{const{binarySyncData:t}=e,n=(0,s.decodeProtobuf)(a.SyncActionDataSpec,t).value;null!=n&&(n.archiveChatAction?r=n.archiveChatAction.messageRange:n.markChatAsReadAction?r=n.markChatAsReadAction.messageRange:n.clearChatAction?r=n.clearChatAction.messageRange:n.deleteChatAction&&(r=n.deleteChatAction.messageRange),null!=r&&(i+=r.messages.length,o.push(r.messages.length)))})),{string:{mutationType:t},int:{count:n.length,totalAdditionalMessagesCount:i},int_array:{messageRangeLengths:o}}}({type:e,mutations:t}))},t.reportSyncdFatalError=function(e,t,n,a){(0,i.startMetric)(r.PRE_METRIC.SYNCD_FATAL_ERROR).endFail("syncd fatal error: "+e,function(e){const{type:t,collection:n,patchSnapshotMutationCount:r,patchVersion:i}=e;return{string:{errorCode:t,collection:null==n?null:n},int:{patchSnapshotMutationCount:r,patchVersion:i}}}({type:e,collection:t,patchSnapshotMutationCount:n,patchVersion:a}))};var r=n(400796),i=n(157662),a=n(381),o=n(960362),s=n(484902);const l=n(654302)({PATCH_PROTOBUF_SERIALIZATION_FAILED:"PATCH_PROTOBUF_SERIALIZATION_FAILED",MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:"MUTATIONS_PROTOBUF_SERIALIZATION_FAILED",ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:"ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED",ENCRYPTION_FAILED:"ENCRYPTION_FAILED",MISSING_SNAPSHOT_VERSION:"MISSING_SNAPSHOT_VERSION",MISSING_SNAPSHOT_MAC:"MISSING_SNAPSHOT_MAC",MISSING_SNAPSHOT_KEY_ID:"MISSING_SNAPSHOT_KEY_ID",MISSING_PATCH_VERSION:"MISSING_PATCH_VERSION",PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:"PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS",MISSING_PATCH_SNAPSHOT_MAC:"MISSING_PATCH_SNAPSHOT_MAC",MISSING_PATCH_MAC:"MISSING_PATCH_MAC",MISSING_PATCH_KEY_ID:"MISSING_PATCH_KEY_ID",MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:"MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY",MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:"MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH",MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:"MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256",MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:"MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256",MISSING_MUTATION_OPERATION:"MISSING_MUTATION_OPERATION",MISSING_MUTATION_RECORD:"MISSING_MUTATION_RECORD",MISSING_MUTATION_INDEX:"MISSING_MUTATION_INDEX",MISSING_MUTATION_VALUE:"MISSING_MUTATION_VALUE",MISSING_MUTATION_KEY_ID:"MISSING_MUTATION_KEY_ID",EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:"EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED",SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:"SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED",PATCH_PROTOBUF_DESERIALIZATION_FAILED:"PATCH_PROTOBUF_DESERIALIZATION_FAILED",MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:"MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED",ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:"ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED",MISSING_ACTION_INDEX:"MISSING_ACTION_INDEX",MISSING_ACTION_VERSION:"MISSING_ACTION_VERSION",SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:"SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT",SNAPSHOT_MAC_MISMATCH_IN_PATCH:"SNAPSHOT_MAC_MISMATCH_IN_PATCH",MAC_MISMATCH_PATCH:"MAC_MISMATCH_PATCH",DECRYPTION_FAILED:"DECRYPTION_FAILED",DUPLICATE_PATCH_VERSION_IN_COLLECTION:"DUPLICATE_PATCH_VERSION_IN_COLLECTION",SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:"SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH",SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:"SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT",MISSING_ACTION_VALUE:"MISSING_ACTION_VALUE",MISSING_ACTION_TIMESTAMP:"MISSING_ACTION_TIMESTAMP",XMPP_BAD_REQUEST_FOR_COLLECTION:"XMPP_BAD_REQUEST_FOR_COLLECTION",XMPP_NOT_FOUND_FOR_COLLECTION:"XMPP_NOT_FOUND_FOR_COLLECTION",CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:"CYCLIC_MUTATION_DEPENDENCY_IN_PATCH",SERVER_DID_NOT_SEND_ALL_PATCHES:"SERVER_DID_NOT_SEND_ALL_PATCHES",TERMINAL_PATCH_MISSING_DATA:"TERMINAL_PATCH_MISSING_DATA",TERMINAL_PATCH_DESERIALIZATION_ERROR:"TERMINAL_PATCH_DESERIALIZATION_ERROR",TERMINAL_PATCH_UNKNOWN:"TERMINAL_PATCH_UNKNOWN",INVALID_ACTION_INDEX:"INVALID_ACTION_INDEX",XMPP_BAD_REQUEST_GLOBAL_ERROR:"XMPP_BAD_REQUEST_GLOBAL_ERROR",XMPP_NOT_FOUND_GLOBAL_ERROR:"XMPP_NOT_FOUND_GLOBAL_ERROR",XMPP_BAD_METHOD_GLOBAL_ERROR:"XMPP_BAD_METHOD_GLOBAL_ERROR",XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:"XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR",TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:"TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D"});t.SyncdFatalErrorType=l;const c=n(654302)({MISSING_MUTATION_TO_REMOVE:"MISSING_MUTATION_TO_REMOVE"});t.SyncdCriticalEventType=c;const u=n(654302)({ABOUT_TO_APPLY_MUTATIONS:"ABOUT_TO_APPLY_MUTATIONS",APPLIED_MUTATIONS:"APPLIED_MUTATIONS",MUTATIONS_DECRYPTED:"MUTATIONS_DECRYPTED",REQUEST_BUILT:"REQUEST_BUILT",RESPONSE_RECEIVED:"RESPONSE_RECEIVED",RESPONSE_PARSED_VALID:"RESPONSE_PARSED_VALID",ENTERED_RETRY_MODE:"ENTERED_RETRY_MODE"});t.SyncdCriticalBootstrapStageType=u;const d=n(654302)({PATCH_MUTATIONS:"PATCH_MUTATIONS",SNAPSHOT_MUTATIONS:"SNAPSHOT_MUTATIONS"});t.SyncdDecryptMutationsType=d;const p=n(654302)({SNAPSHOT_USED:"SNAPSHOT_USED",SNAPSHOT_NOT_USED:"SNAPSHOT_NOT_USED"});function f(e){(0,i.startMetric)(r.PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE).endSuccess({string:{criticalBootstrapStage:{type:e}.type}})}function _(e){const{collection:t,downloadSize:n,downloadStartTs:r,isSuccess:i}=e;return{string:{collection:t},int:{downloadSize:n,downloadStartTs:r},bool:{isSuccess:"success"===i}}}function h(e){return{string:{criticalEventCode:e.type,collection:null==e.collection?null:e.collection}}}function g(e){const t={};return Object.keys(e).forEach((n=>{"number"==typeof e[n]?(null==t.int&&(t.int={}),t.int[n]=e[n]):"string"==typeof e[n]&&(null==t.string&&(t.string={}),t.string[n]=e[n])})),Object.keys(t).length>0?t:void 0}t.SyncdBootstrapDataAppliedSnapshotUsed=p;t.SyncdEventFlow=class{constructor(){this.event=(0,i.startMetric)(r.PRE_METRIC.SYNCD)}end(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.event.endFail("syncd failed"):this.event.endSuccess()}mark(e,t){this.event.addPoint(e,g(t))}}},607414:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.addKeyRotationRemoveCount=function(e){if(0===e)return;l.keyRotationRemoveCount+=e,d()},t.addMutationCount=function(e){if(0===e)return;l.mutationCount+=e,d()},t.addUnsetActionCount=function(e){if(0===e)return;l.unsetActionCount+=e,d()},t.clear=u,t.convertAppStateSyncDailyFromAnnotations=function(e){var t,n,r,i,a,o,s,l;return{mutationCount:(null==e||null===(t=e.int)||void 0===t?void 0:t.mutationCount)||0,invalidActionCount:(null==e||null===(n=e.int)||void 0===n?void 0:n.invalidActionCount)||0,unsupportedActionCount:(null==e||null===(r=e.int)||void 0===r?void 0:r.unsupportedActionCount)||0,keyRotationRemoveCount:(null==e||null===(i=e.int)||void 0===i?void 0:i.keyRotationRemoveCount)||0,storedMutationCount:(null==e||null===(a=e.int)||void 0===a?void 0:a.storedMutationCount)||0,uploadConflictCount:(null==e||null===(o=e.int)||void 0===o?void 0:o.uploadConflictCount)||0,unsetActionCount:(null==e||null===(s=e.int)||void 0===s?void 0:s.unsetActionCount)||0,missingKeyCount:(null==e||null===(l=e.int)||void 0===l?void 0:l.missingKeyCount)||0}},t.forceCommitAppState=function(){c.isScheduled()&&c.forceRunNow()},t.incConflict=function(){l.uploadConflictCount++,d()},t.setInvalidActionCount=function(e){l.invalidActionCount=e,d()},t.setMissingKeyCount=function(e){l.missingKeyCount=e,d()},t.setStoredMutationCount=function(e){l.storedMutationCount=e,d()},t.setUnsupportedActionCount=function(e){l.unsupportedActionCount=e,d()};var i=r(n(73982)),a=n(400796),o=n(157662),s=n(657319);let l={mutationCount:0,invalidActionCount:0,unsupportedActionCount:0,keyRotationRemoveCount:0,storedMutationCount:0,uploadConflictCount:0,unsetActionCount:0,missingKeyCount:0};const c=new s.ShiftTimer((function(){const e=(t=l,{int:(0,i.default)({},t)});var t;u(),(0,o.startMetric)(a.PRE_METRIC.APP_STATE_SYNC_DAILY).endSuccess(e)}));function u(){l={mutationCount:0,invalidActionCount:0,unsupportedActionCount:0,keyRotationRemoveCount:0,storedMutationCount:0,uploadConflictCount:0,unsetActionCount:0,missingKeyCount:0}}function d(){c.onOrBefore(3e5)}},597245:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(e){return(0,p.redeemPrivateStatsToken)().then((t=>t?{result:t}:g(e).then((e=>{const t=(0,i.default)({},e),{result:n}=e;return n?(0,p.savePrivateStatsToken)(n).then((()=>t)):t}))))},t.issuePrivateStatsToken=g;var i=r(n(73982)),a=n(108584),o=n(736184),s=n(463482),l=n(311609),c=n(72287),u=n(892844),d=n(647957),p=n(936376),f=n(831914),_=n(471914);const h=new _.WapParser("issuePrivateStatsToken",(e=>{const t=e.child("sign_credential");return{signedCredential:t.child("signed_credential").contentBytes(),acsPublicKey:t.child("acs_public_key").contentBytes()}}));function g(e){const t=(0,u.monotonicTime)(),n={overallStartTime:t,retryStartTime:t,retryAttemptsLeft:3},r=new Uint8Array(32);self.crypto.getRandomValues(r);const p=new Uint8Array(32);self.crypto.getRandomValues(p);const _=(0,d.blindToken)(r,p),g=new c.PromiseRetryLoop({name:"issuePrivateStatsToken",timer:{algo:{type:"exponential",first:250},max:1e3},code:t=>{n.retryAttemptsLeft<3&&(n.retryStartTime=(0,u.monotonicTime)());const c=(0,f.wap)("iq",{xmlns:"privatestats",id:(0,f.generateId)(),type:"get",to:f.S_WHATSAPP_NET},(0,f.wap)("sign_credential",{version:"1"},(0,f.wap)("blinded_credential",null,_)));return(e||o.sendIqWithoutRetry)(c,h).then((e=>{if(!e.success){const r=function(e){switch(e.errorCode){case 400:return"bad-request";case 500:return"internal-server-error";case 501:return"feature-not-implemented";case 503:return"service-unavailable";default:return"unknown"}}(e);return __LOG__(3)`issuePrivateStatsToken: failed ${r}`,void("internal-server-error"!==r||n.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},n),{},{result:r})}):n.retryAttemptsLeft--)}const{signedCredential:o,acsPublicKey:l}=e.result,c=(0,d.unblindToken)(o,p,l);if(null==c)return __LOG__(3)`issuePrivateStatsToken: failed to unblind the signed token`,void t({result:null,metric:(0,i.default)((0,i.default)({},n),{},{result:"decryption-error"})});const u=a.Binary.build(r,c),f=(0,s.hash)(u.readByteArray());t({result:{token:r,sharedSecret:f},metric:(0,i.default)((0,i.default)({},n),{},{result:"success"})})})).catch((e=>{if(!(e instanceof l.Disconnected))return Promise.reject(e);__LOG__(3)`issuePrivateStatsToken: Disconnected`,n.retryAttemptsLeft<=0?t({result:null,metric:(0,i.default)((0,i.default)({},n),{},{result:"disconnected"})}):n.retryAttemptsLeft--}))}});return g.start(),g.promise()}},714604:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFinishedPrivateStatsBuffers=function(e){return(0,c.getFinishedStreamBuffers)("private").then((t=>v(t,e)))},t.upload_UNSAFE_INTERNAL_DO_NOT_USE=v;var i=r(n(311504)),a=n(615688),o=n(411141),s=n(72287),l=n(892844),c=n(936376);const u="https://dit.whatsapp.net/deidentified_telemetry",d="245118376424571|3e7d275052f1522bf3200afcf53841a7",p="WAMEventBuffer.dat",f=111e3,_=3067002,h=3067003,g=3067004;function m(e){return{result:e.result,httpResponseCode:e.httpResponseCode,uploadTime:(0,l.monotonicTimeSince)(e.uploadStartTime)}}function y(){return(y=(0,i.default)((function*(e,t,n,r){if((yield(0,c.privateStatsKillSwitchGetBlockedToken)())===d)return __LOG__(2)`Removing private stats buffer without submitting it (kill switch)`,(0,c.removeBufferByKey)(n.key).then((()=>{e()}));const i=(0,l.monotonicTime)(),s=yield r();if(null==s)return __LOG__(4,void 0,new Error)`Couldn't get token to submit a private stats buffer`,void e();const f=new FormData;f.append("access_token",d);const _=yield(0,o.hmacSha256)(s.sharedSecret,n.content),h=(0,a.encodeB64UrlSafe)(s.token,!0),g=(0,a.encodeB64UrlSafe)(_,!0);let m;f.append("credential",`${h}+${g}`),f.append("message",new Blob([n.content],{type:"application/octet-stream"}),p),f.append("meta_data",JSON.stringify({t:(0,l.unixTime)(),p:0}));try{m=yield fetch(u,{method:"POST",body:f,"Content-Type":"multipart/form-data"})}catch(e){return __LOG__(3)`Upload of a private stats buffer failed: ${e}`,void t({uploadStartTime:i,result:"error-other"})}const y=m.status,E=t=>{e({uploadStartTime:i,httpResponseCode:y,result:t})},v=e=>{t({uploadStartTime:i,httpResponseCode:y,result:e})};switch(y){case 200:return(0,c.removeBufferByKey)(n.key).then((()=>{E("success")}));case 429:return void E("error-server-other");case 401:return Promise.all([(0,c.privateStatsKillSwitchSet)(d),(0,c.removeBufferByKey)(n.key)]).then((()=>{E("error-access-token")}));case 400:{const{result:n,shouldRetry:r}=yield S(m),a={uploadStartTime:i,httpResponseCode:y,result:n};return void("retry"===r?t(a):e(a))}case 500:return void v("error-server-other")}__LOG__(3)`Unsupported response status code from PrivateStats upload request: ${y}`,v("error-other")}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){const t=yield e.json().catch((()=>{}));if("object"!=typeof t)return __LOG__(3)`Unable to parse error response 400 from PrivateStats upload request or parsed response is not an object`,{result:"error-other",shouldRetry:"retry"};const{error:n}=t;if("object"!=typeof n)return __LOG__(3)`Incorrect or missing error entry in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};const{code:r,error_subcode:i}=n;if("number"!=typeof r||"number"!=typeof i)return __LOG__(3)`Incorrect code or subcode in the error response 400 from PrivateStats upload request`,{result:"error-other",shouldRetry:"retry"};switch(r){case 9:return{result:"error-server-other",shouldRetry:"no-retry"};case f:switch(i){case _:return{result:"error-parsing",shouldRetry:"retry"};case h:return{result:"error-decoding",shouldRetry:"retry"};case g:return{result:"error-credential",shouldRetry:"retry"};default:return __LOG__(3)`Unsupported subcode value in the error response 400 from PrivateStats upload request: ${i}`,{result:"error-other",shouldRetry:"retry"}}default:return __LOG__(3)`Unsupported code value in the error response 400 from PrivateStats upload request: ${r}`,{result:"error-other",shouldRetry:"retry"}}}))).apply(this,arguments)}function v(e,t){const n=e.map((e=>{let n=3;const r=[],i=new s.PromiseRetryLoop({name:"uploadPrivateStatsBuffer",timer:{algo:{type:"exponential",first:250},max:1e3},code:i=>function(){return y.apply(this,arguments)}(i,(e=>{const t=m(e);r.push(t),n<=0?i():n--}),e,t)});return i.start(),i.promise().then((t=>{if(null!=t){const e=m(t);r.push(e)}return{uploadedBufferKey:"success"===(null==t?void 0:t.result)?e.key:null,metrics:r}}))}));return Promise.all(n).then((e=>{const t=e.reduce(((e,t)=>(e.push(...t.metrics),e)),[]);return{uploadedBufferKeys:e.reduce(((e,t)=>(null!=t.uploadedBufferKey&&e.push(t.uploadedBufferKey),e)),[]),metrics:t}}))}},702486:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_HANDLED=t.DynamicRouter=void 0;const n={sentinel:"RESPONSE_NAMESPACE"},r={sentinel:"NOT_HANDLED"};t.NOT_HANDLED=r;function i(e,t){const r=t.namespace;return r===n?a:e.get(r)}function a(e,t,n){n(t)}function o(e){if(null!=e&&("object"==typeof e||"function"==typeof e)){const t=e.then;return"function"==typeof t?t:null}return null}t.DynamicRouter=class{constructor(){var e=this;this._basePromise=Promise.resolve(),this._handlers=new Map,this._handlerChangeCount=0,this._firstRoute=null,this._nextRoute=null,this._lastRoute=null,this.fireAndForget=function(t,n,r){var i;let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];null===(i=e._onRouteCalled)||void 0===i||i.call(e,t,n,r),e._schedule(t,n,r,null,a)},this.sendAndReceive=function(t,r,i){var a;let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return null===(a=e._onRouteCalled)||void 0===a||a.call(e,t,r,i),new Promise(((a,l)=>{e._schedule(t,r,i,(t=>{try{const r=o(t);r?r.call(t,(t=>{e._schedule(n,"",t,a,s)}),(t=>{e._schedule(n,"",t,l,!1)})):e._schedule(n,"",t,a,s)}catch(t){e._schedule(n,"",t,l,!1)}}),s)}))},this._run=()=>{let e=this._nextRoute;if(!e)return;const t=this._handlers;let n;for(;e&&!(n=i(t,e));)this._nextRoute=e=e.nextRoute;if(!e||!n)return;const a=this._runHandler(n,e);let o=!0;if(a!==r){const t=e.prevRoute,n=e.nextRoute;this._nextRoute===e&&(this._nextRoute=n),t?t.nextRoute=n:this._firstRoute=n,n?n.prevRoute=t:(o=!1,this._lastRoute=t)}return o&&this._basePromise.then(this._run),a}}hasHandlerForNamespace(e){return this._handlers.has(e)}getHandledNamespaces(){return Array.from(this._handlers.keys())}setOnRouteCalled(e){this._onRouteCalled=e}setNamespaceHandler(e,t){const n=this._handlers,r=n.get(e);if(r!==t&&(++this._handlerChangeCount,n.set(e,t),!r)){const e=this._firstRoute;e&&(this._nextRoute||this._basePromise.then(this._run),this._nextRoute=e)}}setHandlers(e,t){this.setNamespaceHandler(e,(function(e,n,r){const i=t[e](n);r&&r(i)}))}_schedule(e,t,n,r,a){const o=this._lastRoute,s={namespace:e,route:t,arg:n,resolver:r,prevRoute:o,nextRoute:null,silentLog:a};this._lastRoute=s;let l=!0;o?(o.nextRoute=s,l=!this._nextRoute):this._firstRoute=s,l&&i(this._handlers,s)&&(this._nextRoute=s,this._basePromise.then(this._run))}_runHandler(e,t){const{route:n,arg:i,resolver:a,silentLog:o}=t,s=this._handlerChangeCount;let l=null,c=null;try{l=e(n,i,a,o)}catch(e){c=Promise.reject(e)}if(l===r){if(s!==this._handlerChangeCount)return r;c=Promise.reject(new Error("DynamicRouter: NOT_HANDLED can only be used when updating handlers"))}if(!a)return c;c&&a(c)}}},400796:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRE_METRIC=void 0;const r=n(654302)({DECRYPT_MESSAGE_FINAL:"decrypt_message_final",FRANKING_VALIDATION:"franking_validation",GET_DEVICES:"get_devices",MEDIA_DOWNLOAD:"media_download",MEDIA_UPLOAD:"media_upload",MESSAGE_DECRYPTION:"message_decryption",MESSAGE_ENCRYPTION:"message_encryption",OFFLINE_QUEUE:"offline_queue",OFFLINE_RETRY:"offline_retry",QUERY_GROUP:"query_group",QUERY_GROUPS:"query_groups",RETRY_RECEIPTS_SENT:"retry_receipts_sent",SAVE_SESSION_RETRIES:"save_session_retries",SAVE_SIGNAL_SESSION_RETRIES:"save_signal_session_retries",SYNCD_FATAL_ERROR:"syncd_fatal_error",SYNCD_CRITICAL_EVENT:"syncd_critical_event",SYNCD_CRITICAL_BOOTSTRAP_STAGE:"syncd_critical_bootstrap_stage",SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:"syncd_bootstrap_app_state_download",SYNCD_DECRYPT_MUTATIONS:"syncd_decrypt_mutations",SYNCD_BOOTSTRAP_DATA_APPLIED:"syncd_bootstrap_data_applied",APP_STATE_SYNC_DAILY:"app_state_sync_daily",SYNCD:"syncd",SEND_MESSAGE:"send_message",RECEIVE_MESSAGE:"receive_message"});t.PRE_METRIC=r},157662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clear=void 0,t.startMetric=function(e,t,n){null==n&&r++;const i=null!=n?n:r;a(null==n?{name:e,stage:"START",instanceKey:i,annotations:t}:{name:e,stage:"RESUME",instanceKey:i,annotations:t});return{addPoint(t,n){a({name:e,stage:"POINT",reason:t,instanceKey:i,annotations:n})},endSuccess(t){a({name:e,stage:"SUCCESS",instanceKey:i,annotations:t})},endFail(t,n){a({name:e,stage:"FAIL",reason:t,instanceKey:i,annotations:n})}}},t.subscribe=void 0;n(400796);let r=0;const i=function(){const e=[];return{subscribe:function(t){e.push(t)},notify:function(t){0===e.length&&__LOG__(4,void 0,new Error)`[PRE] There are no subscribers to PRE events`,e.forEach((e=>{e(t)}))},clear:function(){__LOG__(3)`Removing all listeners from PRE_METRICS`,e.length=0}}}(),a=i.notify,o=i.clear;t.clear=o;const s=i.subscribe;t.subscribe=s},494694:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QplSampleMethod=void 0;const r=n(654302)({EVENT_BASED_SAMPLING:1,USER_BASED_SAMPLING:3});t.QplSampleMethod=r},865366:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markerEnded=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=`${e}|${t}`;n.delete(i),r.delete(i)},t.validateAnnotations=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const a=`${e}|${t}`,o=n.get(a)||0;let s=0;function l(n,r){return s+=r,!(s+o>1e3)||(null==i||i.annotationSizeLimitExceeded(e,t,n),!1)}function c(n){for(let r=0;r<n.length;r++)return!(n[r].length>50)||(null==i||i.annotationKeyTooLong(e,t,n[r]),!1)}if(null==r?void 0:r.bool){const e=Object.keys(r.bool);if(!l("bool",e.length)||!c(e))return!1}if(null==r?void 0:r.int){const e=Object.keys(r.int);if(!l("int",e.length)||!c(e))return!1}if(null==r?void 0:r.double){const e=Object.keys(r.double);if(!l("double",e.length)||!c(e))return!1}if(null==r?void 0:r.bool_array){const e=r.bool_array,t=Object.keys(e);for(let n=0;n<t.length;n++){const r=e[t[n]];if(r&&!l(t[n],r.length))return!1}if(!c(t))return!1}if(null==r?void 0:r.int_array){const e=r.int_array,t=Object.keys(e);for(let n=0;n<t.length;n++){const r=e[t[n]];if(r&&!l(t[n],r.length))return!1}if(!c(t))return!1}if(null==r?void 0:r.double_array){const e=r.double_array,t=Object.keys(e);for(let n=0;n<t.length&&r.double_array;n++){const r=e[t[n]];if(r&&!l(t[n],r.length))return!1}if(!c(t))return!1}if(null==r?void 0:r.string){const e=r.string,t=Object.keys(e);for(let n=0;n<t.length&&r.string;n++){const r=e[t[n]];if(null!=r&&!l(t[n],r.length))return!1}if(!c(t))return!1}if(null==r?void 0:r.string_array){const e=r.string_array,t=Object.keys(e);for(let n=0;n<t.length&&r.string_array;n++){const r=e[t[n]];if(r)for(let e=0;e<r.length;e++)if(!l(t[n],r[e].length))return!1}if(!c(t))return!1}return n.set(a,o+s),!0},t.validatePoints=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(n.length>50)return null==i||i.pointNameTooLong(e,t,n),!1;const a=`${e}|${t}`,o=r.get(a)||0;if(o+1>1e3)return null==i||i.maxPointCountExceeded(e,t),!1;return r.set(a,o+1),!0};const n=new Map,r=new Map},656457:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.QplNetwork=void 0,t.createPayload=l,t.defaultQplNetwork=function(e){u?e&&__LOG__(3)`Default Network already init`:u=new c(e);return u};var i=r(n(311504)),a=n(266543),o=n(451897),s=n(892844);function l(e,t){return JSON.stringify(e)+"\n"+t.map((function(e){return delete e.app_version,delete e.app_build_number,void 0===e.wa_ab_key2&&(e.wa_ab_key2="abkey"),JSON.stringify(e)})).join("\n")}class c{constructor(e){var t,n,r,o,s,l,c,u,d,p,f,_;this._qplEndpoint=null!==(t=null!==(n=null==e?void 0:e.qplEndpoint)&&void 0!==n?n:null===(r=(0,a.getQplConfig)())||void 0===r?void 0:r.endpoint)&&void 0!==t?t:"",this._qplAccessToken=null!==(o=null!==(s=null==e?void 0:e.qplAccessToken)&&void 0!==s?s:null===(l=(0,a.getQplConfig)())||void 0===l?void 0:l.accessToken)&&void 0!==o?o:"",this._qplAppId=null!==(c=null!==(u=null==e?void 0:e.qplAppId)&&void 0!==u?u:null===(d=(0,a.getQplConfig)())||void 0===d?void 0:d.appId)&&void 0!==c?c:"",this._instrumentForJestE2E=null!==(p=null==e?void 0:e.instrumentForJestE2E)&&void 0!==p&&p,this._isDev=null!==(f=null==e?void 0:e.isDev)&&void 0!==f&&f,this._restInterface=null!==(_=null==e?void 0:e.restInterface)&&void 0!==_?_:{post:(e,t)=>fetch(e,{method:"POST",body:t}).then(function(){var e=(0,i.default)((function*(e){const t=yield e.text();return{status:e.status,responseText:t}}));return function(){return e.apply(this,arguments)}}())}}sendEventsOverNetwork(e){var t=this;return(0,i.default)((function*(){if(t._instrumentForJestE2E){const t=window.__je2e_recordQPLMarker;null!=t&&"function"==typeof t&&e.forEach(t)}const n=t._isDev?{is_employee:"true"}:{},r=t._qplEndpoint,i=new FormData;i.append("access_token",t._qplAccessToken),i.append("app_id",t._qplAppId),void 0===t._fakeUserId&&(t._fakeUserId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString()),i.append("user_id",t._fakeUserId),i.append("upload_time",(0,s.unixTime)().toString()),i.append("batch_info",JSON.stringify(n));const a={};if(e.forEach((e=>{void 0!==e.app_version&&(a[e.app_version]?a[e.app_version].push(e):a[e.app_version]=[e])})),0===Object.keys(a).length)return;Object.keys(a).map((e=>a[e])).forEach((e=>{const t={app_version:e[0].app_version,app_build_number:e[0].app_build_number};i.append("batches[]",function(e,t,n){const r=new Blob(e,n||{});return r.name=t,r}([l(t,e)],"qpldata.txt"))}));const c=yield t._restInterface.post(r,i);if(__LOG__(2,void 0,void 0,void 0,["qpl"])`qpl_networkSendEventsOverNetwork, completed Request`,200!==c.status)throw new o.QplServerStatusCodeError(c.status,`Failed call to QPL endpoint: ${t._qplEndpoint}, response: ${c.responseText}`)}))()}}let u;t.QplNetwork=c},476715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inplaceTruncateEventPrecision=function(e,t){const n=1e6*t;e.duration_ns=Math.round(e.duration_ns/n)*n,e.points&&e.points.map((e=>{e.timeSinceStart=Math.round(e.timeSinceStart/t)*t}))}},451897:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogMarkerType=t.QuickLogActionType=t.QplServerStatusCodeError=t.QplInstanceKeyOptions=t.QPLDataEventLevel=void 0;const r=n(654302)({SUCCESS:2,FAIL:3,CANCEL:4,ABORTED:105});t.QuickLogActionType=r;const i=n(654302)({REGULAR:1,USER_FLOW:2});t.QuickLogMarkerType=i;const a=n(654302).Mirrored(["AUTO_INCREMENT","MANUAL_INCREMENT","REUSE_INSTANCE"]);t.QplInstanceKeyOptions=a;const o=n(654302)({FATAL:1,ERROR:3,CRITICAL:4,WARN:5,INFO:7,DEBUG:9});t.QPLDataEventLevel=o;class s extends Error{constructor(e,t){super(t),this.name="QplServerStatusCodeError",this.name="QplServerStatusCodeError",this.status=e,this.statusCode=e}}t.QplServerStatusCodeError=s},607279:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.forceQplUpload=function(){T()},t.start=function(){return S.apply(this,arguments)};var i=r(n(311504)),a=n(413959),o=n(72287),s=n(451897);const l=1e3,c=1e4,u="exponential",d=100,p=4,f=6e4,_=9e5;let h,g,m,y;function S(){return(S=(0,i.default)((function*(e,t){var n,r,o,s,l,c;g=null!==(n=t.instrumentForJestE2E)&&void 0!==n&&n,h=t.healthLogger,m=t.storageApi,y||(y={sendEvents:e.sendEvents,isQplEnabled:e.isQplEnabled,startDelayInMs:1e3*(null!==(r=e.startDelayInSeconds)&&void 0!==r?r:300),intervalInMs:1e3*(null!==(o=e.intervalInSeconds)&&void 0!==o?o:86400),minRetryDelayInMs:1e3*(null!==(s=e.minRetryDelayInSeconds)&&void 0!==s?s:f),maxRetryDelayInMs:1e3*(null!==(l=e.maxRetryDelayInSeconds)&&void 0!==l?l:_),maxRetryAttemptsCount:null!==(c=e.maxRetryAttemptsCount)&&void 0!==c?c:p},g&&(y={sendEvents:e.sendEvents,isQplEnabled:()=>!0,intervalInMs:50,maxRetryAttemptsCount:5,maxRetryDelayInMs:100,minRetryDelayInMs:50,startDelayInMs:50}),yield(0,a.delayMs)(y.startDelayInMs),yield T(),setInterval((0,i.default)((function*(){yield T()})),y.intervalInMs))}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){const e=y.minRetryDelayInMs+Math.floor(Math.random()*(y.maxRetryDelayInMs-y.minRetryDelayInMs));yield(0,a.delayMs)(e)}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(y.isQplEnabled())try{const e=yield m.getRowCount();let t=0;for(;t<e;){const e=yield m.getFromBottom(d);yield A(e);const n=e[0].id||0,r=e[e.length-1].id||0;yield m.deleteRange(n,r),t+=e.length}}catch(n){var t;if(e<y.maxRetryAttemptsCount)yield E(),T(e+1);else __LOG__(4,!0,new Error,!0)`QPL Uploader, error during upload session, error: ${n}`,SEND_LOGS("QPL Uploader upload session failed"),null===(t=h)||void 0===t||t.errorUploadingChunk(n)}}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e){const t=new o.PromiseRetryLoop({name:"QplUploadChunk",timer:{algo:{type:u,first:l},max:c},code:t=>(e[0].id,e[e.length-1].id,y.sendEvents(e).then((()=>{t()})).catch((e=>{if(e instanceof s.QplServerStatusCodeError)switch(e.statusCode){case 500:__LOG__(3)`QPL Uploader uploadChunk, retriable error: ${e.message}`;break;default:t()}throw e})))});t.start(),yield t.promise()}))).apply(this,arguments)}},500628:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.QPL=void 0;var i=n(494694),a=r(n(36579)),o=n(865366),s=n(476715),l=n(451897);let c;class u{static setAllowListDevVerboseLogging(e){this.allowListDevVerboseLogging=e}static setStartupAllowListEventFilter(e){this._startupAllowListEventFilter=e}static setQplReducePrecisionMapMs(e){this._qplReducePrecisionMapMs=e}static resetQplSettings(){this._qplSettings=this._SETTINGS_ON_STARTUP}static setIsDev(e){e&&"function"==typeof e&&(this.isDev=e)}static setEnumConversion(e){this._enumConversion=e}static setStorageApi(e){this._storageApi=e}static setHealthLogger(e){this._healthLogger=e}static init(e,t,n){this._qplSettings={sendEvent:e,isQplEnabled:n,getEventDetails:t}}static getInstance(){return c||(c=new a.default(this._qplSettingsDecorator)),c}static setInstance(e){c=e}static clearInstance(){c=null,Object.assign(this._qplSettings,this._SETTINGS_ON_STARTUP),u.markerInstanceHelper.clear()}static getNextMarkerInstanceValue(e){u.markerInstanceHelper.get(e)||u.markerInstanceHelper.set(e,this._instanceKeyGenerator());const t=u.markerInstanceHelper.get(e),n=void 0!==t?t.next().value:0;return void 0!==n?n:0}static*_instanceKeyGenerator(){let e=0;for(;;)yield e++}static throwKillswitch(e){this._qplSettings.isQplEnabled=()=>!e,this.isDev()}static clearStorage(){this._storageApi.clear()}static logActiveQplMarkers(){const e=u.getInstance().getActiveMarkerIDs({type:l.QuickLogMarkerType.REGULAR});e.length&&e.forEach((e=>{var t,n;const r=null===(t=(n=this._enumConversion).getName)||void 0===t?void 0:t.call(n,e);__LOG__(3)`QPL [${r}] There are ${this._numberOfMarkersOpen(e)} active markers remaining. You need to call markerEnd`}))}static markerStart(e,t){var n,r,i,a;this.isDev()&&this.allowListDevVerboseLogging.includes(e)&&(null===(n=(r=this._enumConversion).getName)||void 0===n||n.call(r,e),this._qplSettings.isQplEnabled()||__LOG__(3)`QPL [${null===(i=(a=this._enumConversion).getName)||void 0===i?void 0:i.call(a,e)}] markerStart called but killSwitch is ON, this call will be ignored, no marker will be instantiated`);let s;if(s=(null==t?void 0:t.instanceKeyOption)===l.QplInstanceKeyOptions.AUTO_INCREMENT?u.getNextMarkerInstanceValue(e):void 0!==(null==t?void 0:t.instanceKey)?t.instanceKey:0,null==t?void 0:t.closePreviousInstanceWithAction){const n=[l.QplInstanceKeyOptions.AUTO_INCREMENT,l.QplInstanceKeyOptions.MANUAL_INCREMENT].includes(t.instanceKeyOption)?s-1:s;if(this._markerInstanceExists(e,n)){const r=t.closePreviousInstanceWithAction||l.QuickLogActionType.ABORTED;var c,d;if(this.isDev()&&this.allowListDevVerboseLogging.includes(e))null===(c=(d=this._enumConversion).getName)||void 0===c||c.call(d,e);u.markerEnd(e,r,{instanceKey:n})}}if(this._markerExists(e)){const t=this._numberOfMarkersOpen(e);var p,f,_,h,g,m;if(t<this._SOFT_MAX_CONCURRENT_OPEN_MARKERS){if(this.isDev()&&this.allowListDevVerboseLogging.includes(e))__LOG__(3,void 0,void 0,void 0,["qpl"])`QPL [${null===(p=(f=this._enumConversion).getName)||void 0===p?void 0:p.call(f,e)}] is already opened ${t} time(s), attempting ${t+1}, not a problem if intended`}else __LOG__(3,void 0,void 0,!0,["qpl"])`QPL [${null===(_=(h=this._enumConversion).getName)||void 0===_?void 0:_.call(h,e)}] already has ${t} open markers`,SEND_LOGS(`QPL [${(null===(g=(m=this._enumConversion).getName)||void 0===g?void 0:g.call(m,e))||"unknown"}] has ${this._SOFT_MAX_CONCURRENT_OPEN_MARKERS} or more open markers`)}if(u.getInstance().markerStart(e,s),(null==t?void 0:t.annotations)&&(0,o.validateAnnotations)(e,s,t.annotations,this._healthLogger)){const n=t.annotations;u.getInstance().markerAnnotate(e,n,{instanceKey:s})}return{instanceKey:s,annotate:t=>{u.markerAnnotate(e,t,{instanceKey:s})},addPoint:(t,n)=>{u.markerPoint(e,t,{data:null==n?void 0:n.data,instanceKey:s})},end:t=>{u.markerEnd(e,t,{instanceKey:s})},drop:()=>{u.markerDrop(e,{instanceKey:s})}}}static markerAnnotate(e,t,n){var r,i;this.isDev()&&this.allowListDevVerboseLogging.includes(e)&&(null===(r=(i=this._enumConversion).getName)||void 0===r||r.call(i,e),this._warnIfMarkerDoesntExist(e,n?n.instanceKey:0,"markerAnnotate"));(0,o.validateAnnotations)(e,null==n?void 0:n.instanceKey,t,this._healthLogger)&&u.getInstance().markerAnnotate(e,t,{instanceKey:null==n?void 0:n.instanceKey})}static markerPoint(e,t,n){var r,i;this.isDev()&&this.allowListDevVerboseLogging.includes(e)&&(null===(r=(i=this._enumConversion).getName)||void 0===r||r.call(i,e),n&&JSON.stringify(n),this._warnIfMarkerDoesntExist(e,n?n.instanceKey:0,"markerPoint"));(null==n?void 0:n.data)&&(0,o.validateAnnotations)(e,n.instanceKey,n.data,this._healthLogger),(0,o.validatePoints)(e,(null==n?void 0:n.instanceKey)||0,t,this._healthLogger)&&u.getInstance().markerPoint(e,t,n)}static markerEnd(e,t,n){var r,i;this.isDev()&&this.allowListDevVerboseLogging.includes(e)&&(null===(r=(i=this._enumConversion).getName)||void 0===r||r.call(i,e),l.QuickLogActionType.getName(t),this._warnIfMarkerDoesntExist(e,null==n?void 0:n.instanceKey,"markerEnd"));u.getInstance().markerEnd(e,t,null==n?void 0:n.instanceKey),(0,o.markerEnded)(e,null==n?void 0:n.instanceKey)}static markerDrop(e,t){var n,r;this.isDev()&&this.allowListDevVerboseLogging.includes(e)&&(null===(n=(r=this._enumConversion).getName)||void 0===n||n.call(r,e),this._warnIfMarkerDoesntExist(e,null==t?void 0:t.instanceKey,"markerDrop"));u.getInstance().markerDrop(e,null==t?void 0:t.instanceKey),(0,o.markerEnded)(e,null==t?void 0:t.instanceKey)}static getActiveMarkerIDs(e){return u.getInstance().getActiveMarkerIDs({type:e.type})}static getMarker(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.getInstance().getMarker(e,t)}static getMarkerInstances(e){return u.getInstance().getMarkerInstances(e)}static _markerExists(e){const t=u.getMarkerInstances(e);return!!t&&0!==t.size}static _markerInstanceExists(e,t){const n=u.getMarkerInstances(e);return!!n&&void 0!==n.get(t)}static _numberOfMarkersOpen(e){const t=u.getMarkerInstances(e);return t?t.size:0}static _warnIfMarkerDoesntExist(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;var r,i;this._markerInstanceExists(e,t)||__LOG__(3)`QPL [${null===(r=(i=this._enumConversion).getName)||void 0===r?void 0:r.call(i,e)}] calling ${n} without a corresponding open marker for instance: ${t}`}}t.QPL=u,u._defaultSettings={sendEvent:e=>{if(u.isDev()){var t,n;const r=null===(t=(n=u._enumConversion).cast)||void 0===t?void 0:t.call(n,e.marker_id);null!=r&&u.allowListDevVerboseLogging.includes(r)}return u._storageApi.add([e]),Promise.resolve()},getEventDetails:e=>({sampleRate:u._startupAllowListEventFilter.includes(e)?1:0,samplingMethod:i.QplSampleMethod.EVENT_BASED_SAMPLING}),isQplEnabled:()=>!0},u._SETTINGS_ON_STARTUP={sendEvent:e=>{if(u.isDev()){var t,n;const r=null===(t=(n=u._enumConversion).cast)||void 0===t?void 0:t.call(n,e.marker_id);null!=r&&u.allowListDevVerboseLogging.includes(r)}return u._storageApi.add([e]),Promise.resolve()},getEventDetails:e=>({sampleRate:u._startupAllowListEventFilter.includes(e)?1:0,samplingMethod:i.QplSampleMethod.EVENT_BASED_SAMPLING}),isQplEnabled:()=>!1},u._qplSettingsDecorator={performanceNow:()=>performance.now(),moduleLoadTimestamp:performance.now(),logger:{debug:()=>{},warn:()=>{}},sendEvent:(e,t)=>{const n=u._qplReducePrecisionMapMs.get(e.marker_id);return null!=n&&0!==n&&(0,s.inplaceTruncateEventPrecision)(e,n),u._qplSettings.sendEvent(e,t)},quickLogConfigHelper:{getEventDetails:e=>u._qplSettings.getEventDetails(e),isKillswitchOn:()=>!u._qplSettings.isQplEnabled()}},u.markerInstanceHelper=new Map,u._SOFT_MAX_CONCURRENT_OPEN_MARKERS=100,u._startupAllowListEventFilter=[],u.allowListDevVerboseLogging=[],u.isDev=()=>!1,u._qplReducePrecisionMapMs=new Map,u.resetQplSettings()},36579:(e,t,n)=>{"use strict";var r=n(307914),i=r(n(73982)),a=r(n(140674));function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});const s=Object.freeze({TRUST_CLIENT_REPORTED_SAMPLE_RATE:1}),l=Object.freeze({API_CALL:27787270,CRASH_RESILIENCE:27787276,LOCKLESS_IS_MARKER_ON_ACCURACY:27787269,LOCKLESS_MARKER_START:27787266,LOCKLESS_QUEUE_SIZE:27787265,LOCKLESS_STARTED_MARKERS_MAP_COLLISIONS:27787273,LOSS_TRACKING_MARKER_RECEIVED:27787272,LOSS_TRACKING_MARKER_STARTED:27787271,QPL_CONFIG_LOAD:27799150,QPL_CONFIG_SAVE:27791744,QPL_HEARTBEAT_HARDCODED_CONFIG:27792138,QPL_HEARTBEAT_SEVER_CONFIG:27803336,USAGE:27791726,ZERO_SAMPLE_RATE_DUE_MISSING_CONFIG:27787268,ZERO_SAMPLE_RATE_DUE_MISSING_EVENT_IN_CONFIG:27787267}),c=Object.freeze({REGULAR:1,USER_FLOW:2});function u(e,t){const n=t-e;if(0===n)return"0";const[r,i]=n.toFixed(6).split(".",2);return"0"===r?i.replace(/^0+/,""):r+i}function d(e,t,n,r){const a=t[e];if(!a||0===Object.entries(a).length)return null;const o={};return Object.keys(a).forEach((e=>{const t=a[e];null==t||0===t.length?delete a[e]:o[e]=r?r(t):t})),{[e]:(0,i.default)((0,i.default)({},null==n?void 0:n[e]),o)}}function p(e,t){if(null==e)return t;const n=(0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)((0,i.default)({},t),d("string",e,t)),d("int",e,t,Math.trunc)),d("double",e,t)),d("bool",e,t)),d("string_array",e,t)),d("int_array",e,t,(e=>e.map(Math.trunc)))),d("double_array",e,t)),d("bool_array",e,t));return Object.keys(n).forEach((e=>{const t=n[e];null!=t&&0!==Object.entries(t).length||delete n[e]})),0!==Object.entries(n).length?n:null}function f(e,t){if(!t)return e;const n={};return t.string&&(n.annotations=t.string),t.int&&(n.annotations_int=t.int),t.double&&(n.annotations_double=t.double),t.bool&&(n.annotations_bool=t.bool),t.string_array&&(n.annotations_string_array=t.string_array),t.int_array&&(n.annotations_int_array=t.int_array),t.double_array&&(n.annotations_double_array=t.double_array),t.bool_array&&(n.annotations_bool_array=t.bool_array),(0,i.default)((0,i.default)({},e),n)}const _=new Map([[1,"random_sampling"],[3,"per_user"]]);function h(e,t){return 0!==e&&(e<=1||("string"==typeof t?0==(n=t,((0,a.default)(n)>>>0)%e):Math.random()*e<=1));var n}class g{constructor(e){let t;o(this,"_settings",void 0),o(this,"_nextListenerId",1),o(this,"_defaultSampleRate",100),o(this,"_listeners",new Map),o(this,"_listenersWithMarker",new Map),o(this,"_debuggingId",void 0),o(this,"_logger",void 0),o(this,"_markerSampleRate",{}),o(this,"activeMarkers",new Map),this._settings=e,this._logger=e.logger,this._listenersWithMarker=null!==(t=e.listenersWithMarker)&&void 0!==t?t:new Map}getMarker(e,t){const n=this._getMarkerInstances(e);if(!n)return null;const r=n.get(t);return r||null}getMarkerInstances(e){return this._getMarkerInstances(e)}_getMarkerInstances(e){let t;return(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())?null:this.activeMarkers.get(e)}addMarker(e,t,n){let r=this.activeMarkers.get(e);r||(r=new Map,this.activeMarkers.set(e,r)),r.set(t,n)}deleteMarker(e,t){let n;null===(n=this.activeMarkers.get(e))||void 0===n||n.delete(t)}markerStart(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentTimestamp(),{cancelOnUnload:i=!1,trackedForLoss:a=!1,type:o=c.REGULAR,samplingBasis:s=null}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(t=this._settings.quickLogConfigHelper)||void 0===t?void 0:t.isKillswitchOn())return;this.getMarker(e,n)&&this._logger.warn(`Duplicate QPL markerId: ${e} & instanceKey: ${n}`);const[u,d,p]=this._getSamplingPolicy(e,s),f={passesSampling:u,timestamp:r,sampleRate:d,samplingMethod:p,points:[],cancelOnUnload:i,trackedForLoss:a,type:o};this._listeners.forEach((t=>{t.onMarkerStart(e,n,r)})),this._listenersWithMarker.forEach((t=>{t.onMarkerStartWithMarker(e,n,r,f)})),u&&this.addMarker(e,n,f),u&&!0===a&&this._uploadEvent({marker_id:l.LOSS_TRACKING_MARKER_STARTED,action_id:0,sample_rate:1,annotations_int:{tracked_marker_id:e},marker_type:c.REGULAR})}markerAnnotate(e,t){let{instanceKey:n=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((r=>{Object.keys(t).forEach((i=>{const a=t[i];a&&Object.keys(a).forEach((t=>{r.onAnnotation(e,n,t,a[t])}))}))}));const r=this.getMarker(e,n);r&&(r.annotations=p(t,r.annotations))}markerPoint(e,t){let{instanceKey:n=0,data:r,timestamp:i=this.currentTimestamp()}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._listeners.forEach((a=>{let o;return a.onMarkerPoint(e,n,t,null==r||null===(o=r.string)||void 0===o?void 0:o.__key,i)}));const a=this.getMarker(e,n);if(!a)return;const o={name:t,timeSinceStart:Math.trunc(i-a.timestamp)},s=p(r);s&&(o.data=s),a.points.push(o)}markerEnd(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.currentTimestamp();this._listeners.forEach((i=>i.onMarkerEnd(t,e,n,r)));const a=this.getMarker(e,n);if(a){if(a.passesSampling){if(!0!==a.timestampIsApproximate){const o=a.type===c.USER_FLOW?a.points:function(e){return Array.from(new Set(e.map((e=>e.name)))).map((t=>e.find((e=>e.name===t)))).filter(Boolean)}(a.points),l=function(e,t){return!0===t?(0,i.default)((0,i.default)({},e),{},{tracked_for_loss:!0}):e}(f({marker_id:e,action_id:t,instance_id:n,sample_rate:a.sampleRate,method:_.get(a.samplingMethod),duration_ns:u(a.timestamp,r),points:o,metadata:{application_analytics:{time_since_qpl_module_init:r-this._settings.moduleLoadTimestamp}},marker_type:a.type,flags:s.TRUST_CLIENT_REPORTED_SAMPLE_RATE},a.annotations),a.trackedForLoss);this._uploadEvent(l)}this._debuggingId===e&&this._settings.onDebuggingIdEnded&&this._settings.onDebuggingIdEnded()}this.deleteMarker(e,n)}}markerDrop(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.deleteMarker(e,t);const n=this.currentTimestamp();this._listeners.forEach((r=>{r.onMarkerDrop&&r.onMarkerDrop(e,t,n)}))}markEvent(e,t,n){let r,{timestamp:i=this.currentTimestamp(),annotations:a}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(null===(r=this._settings.quickLogConfigHelper)||void 0===r?void 0:r.isKillswitchOn())return;const[o,l,u]=this._getSamplingPolicy(e);if(!o)return;const d=p("function"==typeof a?a():a),h={marker_id:e,action_id:0,instance_id:0,sample_rate:l,method:_.get(u),da_type:t,da_level:n,metadata:{application_analytics:{time_since_qpl_module_init:i-this._settings.moduleLoadTimestamp}},marker_type:c.REGULAR,flags:s.TRUST_CLIENT_REPORTED_SAMPLE_RATE};this._uploadEvent(f(h,d))}dropAllMarkers(){this.activeMarkers.clear()}setAlwaysOnSampleRate(e,t){this._markerSampleRate[e]=t}currentTimestamp(){return this._settings.performanceNow()}enableDebug(e){this._debuggingId=parseInt(e,10)}disableDebug(){this._debuggingId=null}addListener(e){const t=this._nextListenerId++;return this._listeners.set(t,e),{dispose:()=>{this._listeners.delete(t)}}}_getSamplingPolicy(e,t){let n,r,i,a,o;if(this._settings.unsampleAllEvents&&this._settings.unsampleAllEvents()||this._debuggingId===e)return[!0,1,1];const s=null!==(n=null===(r=this._settings.quickLogConfigHelper)||void 0===r?void 0:r.getEventDetails(e))&&void 0!==n?n:{sampleRate:0,samplingMethod:1};if(null==this._markerSampleRate[e]&&0!==s.sampleRate&&3===s.samplingMethod){let e;return[!0,null!==(e=s.sampleRate)&&void 0!==e?e:1,3]}const l=null!==(i=null!==(a=this._markerSampleRate[e])&&void 0!==a?a:s.sampleRate)&&void 0!==i?i:this._defaultSampleRate,c=null!==(o=s.samplingMethod)&&void 0!==o?o:1;return[h(l,t),l,c]}_uploadEvent(e){const t=this._settings.decorateEventBeforeUpload?this._settings.decorateEventBeforeUpload(e):e;this._settings.sendEvent(e,t)}getActiveMarkerIDs(e){let{type:t}=e;const n=new Set;return this.activeMarkers.forEach(((e,r)=>{e.forEach((e=>{e.type===t&&n.add(r)}))})),Array.from(n)}forEachMarkerInstance(e,t){const n=this._getMarkerInstances(e);if(n)for(const e of n.keys())t(e)}}var m,y;o(g,"normalizeAnnotations",p),function(e){e[e.REGULAR=1]="REGULAR",e[e.USER_FLOW=2]="USER_FLOW"}(t.QPLMarkerType||(t.QPLMarkerType={})),(m=t.QuickLogActionType||(t.QuickLogActionType={}))[m.SUCCESS=2]="SUCCESS",m[m.FAIL=3]="FAIL",m[m.CANCEL=4]="CANCEL",(y=t.QPLDataEventLevel||(t.QPLDataEventLevel={}))[y.FATAL=1]="FATAL",y[y.ERROR=3]="ERROR",y[y.CRITICAL=4]="CRITICAL",y[y.WARN=5]="WARN",y[y.INFO=7]="INFO",y[y.DEBUG=9]="DEBUG",t.default=g},140674:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=-1;for(let r=0,i=e.length;r<i;r++)t=t>>>8^n[255&(t^e.charCodeAt(r))];return~t};let n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];Int32Array&&(n=new Int32Array(n))},781484:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.AesCbcStream=void 0,t.aesCbcDecrypt=_,t.aesCbcDecryptSplit=function(e,t){return Promise.resolve().then((()=>{const n=t.slice(0,16),r=t.slice(16);return _(e,n,r)}))},t.aesCbcEncrypt=function(e,t,n){return Promise.resolve().then((()=>{const r=p(n),i=u(r);return Promise.resolve(d(e)).then((e=>self.crypto.subtle.encrypt(i,e,t))).then((e=>(0,s.concatTypedArrays)(Uint8Array,[r,new Uint8Array(e)]).buffer))}))},t.aesCbcEncryptWithChunking=function(){return h.apply(this,arguments)};var i=r(n(311504)),a=n(108584),o=n(846269),s=n(660977);const l=16,c=16777216;function u(e){return{name:"AES-CBC",iv:(0,o.castTypedArrays)(Uint8Array,e)}}function d(e){return self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["encrypt"])}function p(e){if(e)return(0,o.castTypedArrays)(Uint8Array,e);const t=new Uint8Array(16);return self.crypto.getRandomValues(t),t}function f(e){const t=e.byteLength,n=l-t%l;return Number.isNaN(n)?t:t+n}function _(e,t,n){const r=u(t);return Promise.resolve(self.crypto.subtle.importKey("raw",(0,o.castTypedArrays)(Uint8Array,e),"AES-CBC",!1,["decrypt"])).then((e=>self.crypto.subtle.decrypt(r,e,n)))}function h(){return(h=(0,i.default)((function*(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c;if(r%l!=0)throw new Error(`chunkSize must be a multiple of 16, ${r} received`);const i=yield d(e),a=new Uint8Array(t),o=Math.ceil(a.byteLength/r),s=p(n),_=new Uint8Array(f(a)+s.byteLength);_.set(s);for(let e,t,n=0,l=s;n<o;n++){const c=n===o-1,d=n*r;e=a.subarray(d,d+r),t=yield self.crypto.subtle.encrypt(u(l),i,e).then((e=>c?new Uint8Array(e):new Uint8Array(e).subarray(0,-16))),_.set(t,s.byteLength+n*r),l=t.slice(-16)}return _.buffer}))).apply(this,arguments)}t.AesCbcStream=class{constructor(e,t,n,r){this._input=null,this._finished=!1,this._output=e,this._type=t,this._rawKey=n;const i={name:"AES-CBC",iv:r};this._promise=self.crypto.subtle.importKey("raw",n,"AES-CBC",!1,[t]).then((e=>({algo:i,key:e})))}append(e){let t;this._throwIfFinished("append");const n=this._input;if(n)if(n.writeByteArray(e),n.size()>1024){const e=n.size()%l;t=n.readByteArray(n.size()-e),n.size()||(this._input=null)}else t=null;else if(e.length>1024){const n=e.length%l;n?(this._input=new a.Binary(e),t=this._input.readByteArray(e.length-n)):t=e}else this._input=new a.Binary(e),t=null;const r=t;return r&&(this._promise=this._promise.then((e=>{let{key:t,algo:n}=e;if("encrypt"===this._type)return self.crypto.subtle.encrypt(n,t,r).then((e=>(this._output.writeByteArray(new Uint8Array(e,0,e.byteLength-l)),new Uint8Array(e,e.byteLength-32,l))));{const e=r.slice(-16);return self.crypto.subtle.decrypt(n,t,r).then((t=>(this._output.writeBuffer(t),e)))}})).then((e=>{const t={name:"AES-CBC",iv:e};return self.crypto.subtle.importKey("raw",this._rawKey,"AES-CBC",!1,[this._type]).then((e=>({algo:t,key:e})))}))),this._promise.then((()=>{}))}finalize(e){let t;if(this._throwIfFinished("finalize"),this._input?(e&&this._input.writeByteArray(e),t=this._input.readByteArray(),this._input=null):e&&(t=e),t){const e=t;return this._promise.then((t=>{let{algo:n,key:r}=t;return"encrypt"===this._type?self.crypto.subtle.encrypt(n,r,e):self.crypto.subtle.decrypt(n,r,e)})).then((e=>{this._output.writeBuffer(e)}))}return this._promise.then((()=>{}))}_throwIfFinished(e){if(this._finished)throw new Error(`AesCbcStream.${e} called after finalize`)}}},223847:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.gcmDecrypt=function(){return s.apply(this,arguments)},t.gcmEncrypt=function(){return o.apply(this,arguments)};var i=r(n(311504)),a=n(108584);function o(){return(o=(0,i.default)((function*(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16;return self.crypto.subtle.encrypt({name:"AES-GCM",iv:c(t),additionalData:c(r),tagLength:8*i},yield l(e),n)}))).apply(this,arguments)}function s(){return(s=(0,i.default)((function*(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:16;return self.crypto.subtle.decrypt({name:"AES-GCM",iv:c(t),additionalData:c(r),tagLength:8*i},yield l(e),n)}))).apply(this,arguments)}function l(e){return self.crypto.subtle.importKey("raw",e,"AES-GCM",!1,["encrypt","decrypt"])}function c(e){if(e instanceof Uint8Array)return e;if("string"==typeof e){const t=new a.Binary;return t.writeString(e),t.readByteArray()}return new Uint8Array(e)}},30141:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allocate=o,t.elligator=C,t.fieldElement=s,t.hashSha512=function(e,t,n){r.lowlevel.crypto_hash(e,t,n)},t.hashToPoint=function(e){return a((()=>function(e){const{unpack25519:t}=r.lowlevel,n=(0,r.hash)(e),i=(128&n[31])>>7;n[31]&=127;const a=s();t(a,n);const l=s();C(l,a);const c=d();!function(e,t,n){const{unpack25519:i,M:a}=r.lowlevel,l=s();i(l,v);const c=s();!function(e,t){const{Z:n,A:i,M:a}=r.lowlevel,o=u(),l=s(),c=s(),d=s();n(l,t,o),i(c,t,o),b(d,c),a(e,l,d)}(c,t);const d=s();h(d,t);const p=s();!function(e,t){const{unpack25519:n,pow2523:i,M:a,S:o}=r.lowlevel,l=s();n(l,m);const c=s();i(c,t);const u=s();a(u,t,c);const d=s();o(d,u);const p=s();a(p,u,l),g(u,p,1^(f=d,_=t,P(f,_)?0:1)),e.set(u);var f,_}(p,d);const f=s();a(f,t,l);const _=s();b(_,p);const S=s();a(S,f,_);const E=s();y(E,S),g(S,E,function(e){const{pack25519:t}=r.lowlevel,n=o(Uint8Array,32);return t(n,e),1&n[0]}(S)^n),e[0].set(S),e[1].set(c),e[2].set(u()),a(e[3],e[0],e[1])}(c,l,i);const f=d();return function(e,t){const n=[s(),s(),s(),s()],i=p();(function(e,t){const n=p();(function(e,t){e[0].set(t[0]),e[1].set(t[1]),e[2].set(t[2])})(n,t),E(e,n)})(n,t),S(i,n),E(n,i),S(i,n),E(n,i),function(e,t){const{M:n}=r.lowlevel;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3]),n(e[3],t[0],t[1])}(e,n)}(f,c),f}(e)))},t.inv25519=b,t.modL=l,t.p3Element=d,t.pack=A,t.reduce=function(e,t){for(let n=0;n<64;++n)t[n]=e[n],e[n]=0;l(e,t),t.fill(0)},t.runInAllocationScope=a,t.scalarmultBase=function(e,t){const n=[s(),s(),s(),s()];r.lowlevel.scalarbase(n,t),A(e,n)},t.unpack=function(e,t){const n=d();if(0!==O(n,t))return-1;return function(e,t){y(e[0],t[0]),e[1].set(t[1]),e[2].set(t[2]),y(e[3],t[3])}(e,n),0},t.unpackneg=O;var r=n(463482);let i=null;function a(e){const t=i;i=[];try{return e()}finally{var n;(null!==(n=i)&&void 0!==n?n:[]).forEach((e=>{e.fill(0)})),i=t}}function o(e,t){if(null==i)throw new Error("allocate called outside of active scope");return new e(t)}function s(e){const t=o(Float64Array,16);if(e){if(e.length>16)throw new Error("Incorrect initialiser array provided to the fieldElement");for(let n=0;n<e.length;n++)t[n]=e[n]}return t}function l(e,t){r.lowlevel.modL(e,t)}const c=()=>s([0]),u=()=>s([1]);function d(){return[s(),s(),s(),s()]}function p(){return[s(),s(),s()]}function f(e,t){let n=0,r=t;for(;r>0;){const t=r%65536;e[n]=t,r=(r-t)/65536,n++}}function _(e,t){const{S:n,M:i}=r.lowlevel,a=s([2]),o=s();n(o,t),i(e,a,o)}function h(e,t){const{S:n,M:i,A:a}=r.lowlevel,o=c(),l=u(),d=s(),p=s(),_=s(),h=s();f(o,486662),n(d,t),i(p,o,t),a(_,d,p),a(h,_,l),i(e,t,h)}function g(e,t,n){1===n&&e.set(t)}const m=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function y(e,t){const{Z:n}=r.lowlevel;n(e,c(),t)}function S(e,t){const{M:n}=r.lowlevel;n(e[0],t[0],t[3]),n(e[1],t[1],t[2]),n(e[2],t[2],t[3])}function E(e,t){const{S:n,A:i,Z:a}=r.lowlevel;n(e[0],t[0]),n(e[2],t[1]),_(e[3],t[2]),i(e[1],t[0],t[1]);const o=s();n(o,e[1]),i(e[1],e[2],e[0]),a(e[2],e[2],e[0]),a(e[0],o,e[1]),a(e[3],e[3],e[2])}const v=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function T(e,t){const{M:n,A:i}=r.lowlevel,a=u(),o=c();f(o,486662);const l=s();_(l,t);const d=s();i(d,l,a);const p=s();b(p,d);const m=s();n(m,p,o);const S=s();y(S,m);const E=s();h(E,S);const v=function(e){const{S:t,M:n,pow2523:i,pack25519:a}=r.lowlevel,o=s(),l=s(),c=s(),u=s(),d=s();i(o,e),t(l,o),t(c,l),n(u,c,e),n(d,u,e);const p=new Uint8Array(32);return a(p,d),1&p[31]}(E),T=s([0]);g(T,o,v);const C=s();i(C,S,T);const A=s();y(A,C),g(C,A,v),e.set(C)}function C(e,t){return a((()=>T(e,t)))}function A(e,t){const n=s(),i=s(),a=s(),{M:o,pack25519:l}=r.lowlevel;b(a,t[2]),o(n,t[0],a),o(i,t[1],a),l(e,i);const c=new Uint8Array(32);l(c,n),e[31]^=(1&c[0])<<7}function b(e,t){const n=s();n.set(t);const{M:i,S:a}=r.lowlevel;for(let e=253;e>=0;--e)a(n,n),2!==e&&4!==e&&i(n,n,t);e.set(n)}function P(e,t){const{pack25519:n,crypto_verify_32:i}=r.lowlevel,a=new Uint8Array(32),o=new Uint8Array(32);return n(a,e),n(o,t),i(a,0,o,0)}function O(e,t){const{set25519:n,S:i,M:a,Z:o,A:l,D:d,unpack25519:p,pow2523:f}=r.lowlevel,_=s(),h=s(),g=s(),m=s(),y=s(),S=s(),E=s();return n(e[2],u()),p(e[1],t),i(g,e[1]),a(m,g,d),o(g,g,e[2]),l(m,e[2],m),i(y,m),i(S,y),a(E,S,y),a(_,E,g),a(_,_,m),f(_,_),a(_,_,g),a(_,_,m),a(_,_,m),a(e[0],_,m),i(h,e[0]),a(h,h,m),P(h,g)&&a(e[0],e[0],s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])),i(h,e[0]),a(h,h,m),P(h,g)?-1:(function(e){const{pack25519:t}=r.lowlevel,n=new Uint8Array(32);return t(n,e),1&n[0]}(e[0])===t[31]>>7&&o(e[0],c(),e[0]),a(e[3],e[0],e[1]),0)}},181576:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expand=o,t.extractAndExpand=function(e,t,n){return(0,i.extractSha256)(null,e).then((e=>o(new Uint8Array(e),t,n)))},t.extractWithSaltAndExpand=function(e,t,n,r){return(0,i.extractSha256)(t,e).then((e=>o(new Uint8Array(e),n,r)))};var r=n(108584),i=n(411141);const a=255*i.SHA256_BYTE_LENGTH;function o(e,t,n){if(n<0||n>a)return Promise.reject(new Error(`HKDF::expand given bad length ${n}`));let o;const s=Math.ceil(n/i.SHA256_BYTE_LENGTH),l=r.Binary.build(t).readByteArray(),c=new r.Binary;let u=(0,i.encodeKeySha256)(e).then((e=>(o=e,new Uint8Array(0))));for(let e=1;e<=s;e++)u=u.then((t=>(0,i.sign)(o,r.Binary.build(t,l,e).readByteArray()))).then((e=>{const t=new Uint8Array(e);return c.writeByteArray(t),t}));return u.then((()=>c.readBuffer(n)))}},411141:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SHA256_BYTE_LENGTH=t.DEFAULT_SALT=void 0,t.encodeKeySha256=function(e){return l(a,e)},t.extractSha256=function(e,t){return l(a,null!=e?e:i).then((e=>c(e,t)))},t.hmacSha1=function(e,t,n){return l(s,e).then((e=>c(e,t,n)))},t.hmacSha256=function(e,t,n){return l(a,e).then((e=>c(e,t,n)))},t.hmacSha512=function(e,t,n){return l(o,e).then((e=>c(e,t,n)))},t.sign=c;var r=n(846269);t.SHA256_BYTE_LENGTH=32;const i=new Uint8Array(32);t.DEFAULT_SALT=i;const a={name:"HMAC",hash:"SHA-256"},o={name:"HMAC",hash:"SHA-512"},s={name:"HMAC",hash:"SHA-1"};function l(e,t){const n=(0,r.castTypedArrays)(Uint8Array,t);return self.crypto.subtle.importKey("raw",n,e,!1,["sign"]).then((t=>({key:t,algo:e})))}function c(e,t,n){let{key:r,algo:i}=e;return self.crypto.subtle.sign(i,r,t).then((e=>null!=n&&0!==n?e.slice(0,n):e))}},400899:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.LtHash16=t.LT_HASH_ANTI_TAMPERING=t.KEY_LENGTH_BYTES=t.EMPTY_LT_HASH=void 0;var i=r(n(311504)),a=n(181576);const o=128;t.KEY_LENGTH_BYTES=o;const s=new ArrayBuffer(o);t.EMPTY_LT_HASH=s;class l{constructor(e){this.salt=e}add(e,t){var n=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return n._addSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtract(e,t){var n=this;return t.reduce(function(){var e=(0,i.default)((function*(e,t){return n._subtractSingle(yield e,t)}));return function(){return e.apply(this,arguments)}}(),Promise.resolve(e))}subtractThenAdd(e,t,n){var r=this;return(0,i.default)((function*(){return r.add(yield r.subtract(e,n),t)}))()}_addSingle(e,t){var n=this;return(0,i.default)((function*(){const r=yield(0,a.extractAndExpand)(t,n.salt,o);return n.performPointwiseWithOverflow(e,r,((e,t)=>e+t))}))()}_subtractSingle(e,t){var n=this;return(0,i.default)((function*(){const r=yield(0,a.extractAndExpand)(t,n.salt,o);return n.performPointwiseWithOverflow(e,r,((e,t)=>e-t))}))()}performPointwiseWithOverflow(e,t,n){const r=new DataView(e),i=new DataView(t),a=new ArrayBuffer(r.byteLength),o=new DataView(a);for(let e=0;e<r.byteLength;e+=2)o.setUint16(e,n(r.getUint16(e,!0),i.getUint16(e,!0)),!0);return a}}t.LtHash16=l;const c=new l("WhatsApp Patch Integrity");t.LT_HASH_ANTI_TAMPERING=c},645563:(e,t)=>{"use strict";function n(e,t){for(let n=0;n<t;n++)e.writeUint8(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.unpadPkcs7=function(e){if(0===e.length)throw new Error("unpadPkcs7 given empty bytes");const t=e[e.length-1];if(t>e.length)throw new Error(`unpadPkcs7 given ${e.length} bytes, but pad is ${t}`);return new Uint8Array(e.buffer,e.byteOffset,e.length-t)},t.writePad=n,t.writeRandomPad=function(e){const t=new Uint8Array(1);do{self.crypto.getRandomValues(t)}while(0===t[0]);n(e,t[0])},t.writeRandomPadMax16=function(e){const t=new Uint8Array(1);self.crypto.getRandomValues(t),n(e,1+(15&t[0]))}},463482:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"hash",{enumerable:!0,get:function(){return r.hash}}),t.lowlevel=t.keypairFromSecretKey=t.keyPair=void 0,Object.defineProperty(t,"scalarMult",{enumerable:!0,get:function(){return r.scalarMult}}),t.signDetachedVerify=void 0,Object.defineProperty(t,"verify",{enumerable:!0,get:function(){return r.verify}});var r=n(214462);const i={scalarbase:r.lowlevel.scalarbase,crypto_hash:r.lowlevel.crypto_hash,modL:r.lowlevel.modL,pack25519:r.lowlevel.pack25519,S:r.lowlevel.S,M:r.lowlevel.M,A:r.lowlevel.A,Z:r.lowlevel.Z,D:r.lowlevel.D,unpack25519:r.lowlevel.unpack25519,pow2523:r.lowlevel.pow2523,crypto_verify_32:r.lowlevel.crypto_verify_32,set25519:r.lowlevel.set25519,add:r.lowlevel.add,scalarmult:r.lowlevel.scalarmult};t.lowlevel=i;const a=r.box.keyPair.fromSecretKey;t.keypairFromSecretKey=a;const o=r.box.keyPair;t.keyPair=o;const s=r.sign.detached.verify;t.signDetachedVerify=s},273045:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sha256=i,t.sha256Base64=function(e){return Promise.resolve(i(e).then(r.encodeB64))};var r=n(615688);function i(e){return Promise.resolve(self.crypto.subtle.digest({name:"SHA-256"},e))}},607589:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBuffersEqual=function(e,t){return i(new Uint8Array(e),new Uint8Array(t))},t.randomNumberLessThan=function(e){if(e!==(0|e))throw new Error("bound must be int32");if(e<=0)throw new Error("bound must not be positive");const t=new Int32Array(1),n=e*Math.floor((-1>>>1)/e);let r=-1;for(;-1===r;){self.crypto.getRandomValues(t);const i=t[0]>>>1;i<n&&(r=i%e)}return r},t.uint8ArraysEqual=i;var r=n(463482);function i(e,t){return 0===e.length&&0===t.length||(0,r.verify)(e,t)}},363426:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UseCaseSecretModificationType=void 0,t.createUseCaseSecret=function(e){const{messageSecret:t,stanzaId:n,parentMsgSender:a,modificationSender:o,modificationType:s}=e,l=r.Binary.build(n,a,o,s).readBuffer();return(0,i.extractAndExpand)(t instanceof ArrayBuffer?new Uint8Array(t):t,l,32)};var r=n(108584),i=n(181576);const a=n(654302)({POLL_VOTE:"Poll Vote"});t.UseCaseSecretModificationType=a},196573:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.addMessageIds=function(e,t){if(null!=t){const n=new Set;[e.ids,t].forEach((e=>e.forEach((e=>{n.has(e)||n.add(e)})))),e.ids=Array.from(n.values())}},t.buildEntry=function(e,t){if(!e||0===e.length)throw new Error("FtsIndexEntry: Expected non-empty blindIndices in constructor");return{ids:(0,i.default)(t,"ids"),prefixes:e,token:e[e.length-1]}};var i=r(n(145095))},844152:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildEntry=function(e,t,n,r){return{id:e,chatId:t,token:n,timestamp:r}}},514056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildDBEntry=function(e,t,n,r,i){return{ftsRowId:e,id:t,chatId:n,timestamp:r,prefixes:i}},t.buildEntry=function(e,t,n,r){return{id:e,chatId:t,timestamp:n,prefixes:r}}},266543:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=function(){return o().config},t.getDbImpls=function(){return o().db},t.getJidUtilsApi=function(){return o().jidUtils},t.getMyDeviceJid=function(){var e;const t=null===(e=o().myJids)||void 0===e?void 0:e.deviceJid;if(null==t)throw(0,i.default)("Trying to access myDeviceJid, but it's not set");return t},t.getMyUserJid=function(){var e;const t=null===(e=o().myJids)||void 0===e?void 0:e.userJid;if(null==t)throw(0,i.default)("Trying to access myUserJid, but it's not set");return t},t.getQplConfig=function(){return o().qpl},t.runInTransaction=function(e,t){return o().runInTransaction(e,t)},t.setGlobals=function(e){a=e},t.setMyJids=function(e){o().myJids=e};var i=r(n(124935));let a=null;function o(){if(null==a)throw(0,i.default)("Trying to access WAGlobals before being set");return a}},124935:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new Error(e);if(void 0===t.stack)try{throw t}catch(e){}return t}},918269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnsatisfiableJobRequirement=t.JobRequirement=void 0,t.joinRequirements=function(e,t){const n=e.filter((e=>!e.isSatisfiable()));if(n.length>0){const e=n.map((e=>e.name));return r=>(null==t||t("unsatisfiable",e,r),n[0].waitUntilSatisfied())}let r=e.map((()=>Promise.resolve())),i=Promise.resolve(),a=null;const o=()=>{if(r.every(((t,n)=>t===e[n].waitUntilSatisfied())))return void(a=null);const t=[],n=e.map((e=>{const n=e.waitUntilSatisfied();return e.isSatisfied()||(t.push(e.name),n.then((()=>{const n=t.indexOf(e.name);t.splice(n,1)}))),n}));return r=n,a=t,Promise.all(n).then(o)};return e=>{if(null==a){const e=o();null!=e&&(i=i.then((()=>e)))}return null==t||t(null==a?"satisfied":"unsatisfied",a,e),i}};class n{constructor(e){this._waitingOn=Promise.resolve(),this._satisfied=!0,this._newBlockers=null,this._blockersFinished=()=>{const e=this._newBlockers;if(null!=e)return this._newBlockers=null,Promise.all(e).then(this._blockersFinished);this._satisfied=!0},this.name=e}addBlocker(e){const t=e.catch((e=>{__LOG__(4,void 0,new Error,!0)`JobRequirement[${this.name}] blocker errored ${e}`,SEND_LOGS("job-blocker-rejected")}));if(this._satisfied)this._satisfied=!1,this._waitingOn=Promise.all([this._waitingOn,t]).then(this._blockersFinished);else{const e=this._newBlockers;null!=e?e.push(t):this._newBlockers=[t]}}waitUntilSatisfied(){return this._waitingOn}isSatisfied(){return this._satisfied}isSatisfiable(){return!0}}t.JobRequirement=n;t.UnsatisfiableJobRequirement=class extends n{constructor(e){super(e),super.addBlocker(new Promise((()=>{})))}addBlocker(){}isSatisfiable(){return!1}}},247901:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.UNSTARTED_JOB=t.RetryOnBackoff=t.RequiresPage=t.PersistedJobManager=t.InterruptJob=t.FINISHED_JOB=void 0;var i=r(n(311504)),a=n(918269),o=n(237178),s=n(892844);class l{constructor(e){this.feature=e}toString(){return`RequiresPage: ${this.feature}`}}t.RequiresPage=l;class c{constructor(e){this.backoffOptions=e}toString(){return"RetryOnBackoff"}}t.RetryOnBackoff=c;class u{constructor(e){this.result=e}}t.InterruptJob=u;const d="$unstarted";t.UNSTARTED_JOB=d;const p="$finished";t.FINISHED_JOB=p;function f(e){return`Job[${e.jobId}] (${e.type})`}function _(e){return`Job[${e.jobId}] (${e.type}.${e.step})`}function h(e,t,n){"unsatisfiable"===e?__LOG__(2)`${_(n)} halting because of ${t}`:"unsatisfied"===e&&__LOG__(2)`${_(n)} waiting on ${t}`}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{jobStartTime:e.startTime,afterCrash:t,interruptJob:m}}function m(e){return new u(e)}t.PersistedJobManager=class{constructor(e){const{isRestartAfterCrash:t,accessors:n,unfinishedJobEntries:r}=e,i=new Map,a=r.then((e=>{const r=[],a=[];return e.forEach((e=>{e.stepHardStartCountAfterTimeout>=5?r.push(e):a.push(e)})),Promise.all(r.map((e=>{var t;return __LOG__(4,void 0,new Error,!0)`${t=e,`[Job ${t.type}] `}: stuck on the step ${e.step}, aborting the job`,SEND_LOGS(`job-stuck-${e.type}`),n.deletePersistedJob(e.jobId)}))).then((()=>{a.forEach((e=>{i.has(e.jobId)||(__LOG__(2)`${f(e)}: restarting`,i.set(e.jobId,this._runJob(e,t)))}))}))}));this.implementationLoaders=new Map,this.implementations=new Map,this.stepBlockers=new WeakMap,this.accessors=n,this.activeJobs=i,this.initialJobsPromise=a,this.listeners=e.listeners,this.deprecatedJobs=e.deprecatedJobs}loadAndRunJobFromId(e){const t=this.activeJobs.get(e);if(null!=t)return t;const n=this._loadAndRunJobFromId(e);return this.activeJobs.set(e,n),n}_loadAndRunJobFromId(e){var t=this;return(0,i.default)((function*(){const{initialJobsPromise:n,accessors:r}=t;yield n;const i=yield r.readPersistedJob(e);return i?t._runJob(i,!1):(__LOG__(4,void 0,new Error,!0)`Persisted job missing for given ID`,SEND_LOGS("missing-job-entry"),null)}))()}_getJobImplementation(e){const{implementations:t,implementationLoaders:n}=this,r=t.get(e);if(r)return r;const i=n.get(e);if(!i)return null;const a=i();return t.set(e,a),a}_waitForBlockers(e,t){if(null==t||0===t.length)return Promise.resolve();const{stepBlockers:n}=this;let r=n.get(t);return null==r&&(r=(0,a.joinRequirements)(t.map((e=>e())),h),n.set(t,r)),r(e)}_runRemainingSteps(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;const{step:i}=e,a=t.findIndex((e=>e.stepName===i)),{requirements:o,code:l}=t[a].info(e.current,e.original,g(e,n));let c=this._waitForBlockers(e,o);return r&&(c=c.then(r)),c.then((()=>(__LOG__(2)`${_(e)}: running step`,l(e.current,e.original,g(e,n))))).then((r=>{if(r instanceof u)return __LOG__(2)`${_(e)}: InterruptJob`,r.result;const i=a+1;if(i>=t.length)return r;const o=t[i];return e.step=o.stepName,e.current=r,e.stepHardStartCountAfterTimeout=0,e.stepFirstStartTime=(0,s.unixTime)(),e.stepUnexpectedErrorCount=0,e.waitUntil=null,e.backedOffCount=0,this.accessors.updatePersistedJob(e).then((()=>this._runRemainingSteps(e,t,n)))}))}_runJob(e,t){var n=this;return(0,i.default)((function*(){var r;const{accessors:a,activeJobs:u,deprecatedJobs:h,listeners:{onJobFinished:m,onJobStarted:y}}=n;let S=yield n._getJobImplementation(e.type);const E=h[e.type];if(!S){if(!E)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}. Maybe it should have been put to the deprecated list?`,SEND_LOGS("missing-job-implementation"),yield a.deletePersistedJob(e.jobId),null;if("NOOP"===E)return __LOG__(3)`No implementation for deprecated ${e.type}, job deleted`,yield a.deletePersistedJob(e.jobId),null;S=yield E()}const v=S;E&&__LOG__(2)`Running deprecated job ${e.type}`;const T=null!==(r=e.stepFirstStartTime)&&void 0!==r?r:(0,s.unixTime)();if(e.stepFirstStartTime=T,e.stepUnexpectedErrorCount=e.stepUnexpectedErrorCount||0,e.backedOffCount=e.backedOffCount||0,e.step===p){let t=e.waitUntil;const r=(0,s.secondsUntil)(T);return null!=t&&(0,s.isInFuture)(t)&&r>0&&(__LOG__(2)`${f(e)}: skew detected, adjusting accordingly`,t=(0,s.castToUnixTime)(t-r),(0,s.isInFuture)(t)&&(e.stepFirstStartTime=(0,s.castToUnixTime)(T-r),e.waitUntil=t,yield n.accessors.updatePersistedJob(e))),null!=t&&(0,s.isInFuture)(t)||(__LOG__(2)`${f(e)}: removing completed, expired job from db`,yield a.deletePersistedJob(e.jobId)),u.delete(e.jobId),e.current}const C=e.step!==d?S.find((t=>t.stepName===e.step)):S[0];if(!C)return __LOG__(4,void 0,new Error,!0)`No implementation for ${e.type}.${e.step}`,SEND_LOGS("missing-job-step"),yield a.deletePersistedJob(e.jobId),null;e.step=C.stepName;const A=()=>{const r=e.waitUntil;let i=Promise.resolve();if(null!=r){const t=(0,s.futureUnixTime)(s.DAY_SECONDS);r>t?(__LOG__(2)`${_(e)}: trim wait from ${r} to ${t}`,e.waitUntil=t,i=n.accessors.updatePersistedJob(e).then((()=>(0,s.delayUntil)(t)))):(__LOG__(2)`${_(e)}: delaying until ${r}`,i=(0,s.delayUntil)(r))}return i.then((()=>n._runRemainingSteps(e,v,t,(()=>(e.waitUntil=null,(0,s.happenedWithin)(T,s.DAY_SECONDS)||e.stepHardStartCountAfterTimeout++,n.accessors.updatePersistedJob(e)))).catch((t=>{if(t instanceof l)return __LOG__(2)`${_(e)}: requires page`,e.stepHardStartCountAfterTimeout>0&&(--e.stepHardStartCountAfterTimeout,n.accessors.updatePersistedJob(e)),new Promise((()=>{}));if(t instanceof c){__LOG__(2)`${_(e)}: RetryOnBackoff`;const r=(0,o.getDelay)(++e.backedOffCount,t.backoffOptions);return e.waitUntil=(0,s.futureUnixTime)(Math.ceil(r/1e3)),e.stepHardStartCountAfterTimeout>0&&--e.stepHardStartCountAfterTimeout,n.accessors.updatePersistedJob(e).then(A)}if(e.stepUnexpectedErrorCount<1)return __LOG__(3)`${_(e)}: Unhandled exception. Tried ${e.stepUnexpectedErrorCount} times`,e.stepUnexpectedErrorCount++,n.accessors.updatePersistedJob(e).then(A);throw t}))))},b=A(),P=b.then(function(){var t=(0,i.default)((function*(t){__LOG__(2)`${_(e)}: finished job`;let r=null;try{r=m(e.jobId,e.type,e.original,t)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobFinished for ${e.type} threw exception ${t}`,SEND_LOGS("onJobFinished-threw")}null!=r&&r>0?(e.waitUntil=(0,s.futureUnixTime)(Math.ceil(r/1e3)),e.step=p,e.current=t,e.stepFirstStartTime=(0,s.unixTime)(),yield n.accessors.updatePersistedJob(e)):(yield a.deletePersistedJob(e.jobId),u.delete(e.jobId))}));return function(){return t.apply(this,arguments)}}(),function(){var n=(0,i.default)((function*(n){__LOG__(4,void 0,new Error,!0)`${e.type} failed with error ${n}`,SEND_LOGS(`job-threw-exception-${e.type}`);const r=v.find((t=>t.stepName===e.step));if(r){const n=r.info(e.current,e.original,g(e,t));null!=n.stopRetryIf&&(yield n.stopRetryIf.onStopRetry(e.current,e.original,g(e,t)))}else __LOG__(4,void 0,new Error)`${e.type}: ${e.step} step not found`;yield a.deletePersistedJob(e.jobId),u.delete(e.jobId)}));return function(){return n.apply(this,arguments)}}());try{y(e.jobId,e.type,e.original)}catch(t){__LOG__(4,void 0,new Error,!0)`onJobStarted for ${e.type} threw exception ${t}`,SEND_LOGS("onJobStarted-threw")}return P.then((()=>b))}))()}addPersistedJobImplementation(e,t){const{implementationLoaders:n,deprecatedJobs:r}=this;if(n.has(e))return __LOG__(4,void 0,new Error,!0)`addPersistedJobImplementation called twice for ${e}`,void SEND_LOGS("repeat-job-loader");r&&r[e],n.set(e,t)}fireAndForget(e){this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}waitUntilPersisted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;this.loadAndRunJobFromId(t)}))}waitUntilCompleted(e){return this.accessors.maybeCreateJob(e).then((e=>{let{id:t}=e;return this.loadAndRunJobFromId(t)}))}}},524674:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JOB_PRIORITY=t.DEFAULT_JOB_TIMEOUT_MS=t.DEFAULT_JOB_PRIORITY=t.DEFAULT_CONCURRENCY=void 0;const r=n(654302)({SKIP:"SKIP_PRIORITIZATION",UI_ACTION:"UI_ACTION",LOW:"LOW",HIGH:"HIGH"});t.JOB_PRIORITY=r;t.DEFAULT_CONCURRENCY=1;const i=r.LOW;t.DEFAULT_JOB_PRIORITY=i;t.DEFAULT_JOB_TIMEOUT_MS=1e4},673091:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.WAConcurrentBucketJobQueue=void 0;var i=r(n(311504)),a=r(n(73982)),o=n(640265),s=n(787614),l=n(524674),c=n(501297),u=r(n(145095)),d=n(638284);const p=new Map([[l.JOB_PRIORITY.HIGH,5],[l.JOB_PRIORITY.LOW,1]]);t.WAConcurrentBucketJobQueue=class{constructor(){this._isInitialized=!1}init(e,t){var n,r,i;if(this._isInitialized)throw new Error("WAConcurrentBucketJobQueue has already initialized");this._maxThreadsCount=e.maxConcurrency,this._availableThreadsCount=e.maxConcurrency,this._jobLogger=t,this._jobQuotaConfig=null!==(n=e.jobPrioritiesQuota)&&void 0!==n?n:p,this._remainingJobCountMap=new Map(this._jobQuotaConfig),this._jobBucketsMap=new Map;const a=new c.BaseJobBucket({jobMaxConcurrencyMap:null!==(r=e.maxConcurrencyPerJob)&&void 0!==r?r:{}}),o=new c.LowJobBucket({jobMaxConcurrencyMap:null!==(i=e.maxConcurrencyPerJob)&&void 0!==i?i:{}});this._jobBucketsMap.set(l.JOB_PRIORITY.UI_ACTION,a),this._jobBucketsMap.set(l.JOB_PRIORITY.HIGH,a),this._jobBucketsMap.set(l.JOB_PRIORITY.LOW,o),this._isInitialized=!0}updateConfig(e){var t;this._availableThreadsCount+=e.maxConcurrency-this._maxThreadsCount,this._maxThreadsCount=e.maxConcurrency,this._jobBucketsMap.forEach((t=>{var n;return t.updateConfig({jobMaxConcurrencyMap:null!==(n=e.maxConcurrencyPerJob)&&void 0!==n?n:{}})})),this._jobQuotaConfig=null!==(t=e.jobPrioritiesQuota)&&void 0!==t?t:p,__LOG__(2)`[job-orchestator]: updated WAConcurrentBucketJobQueue config`}isInitialized(){return this._isInitialized}clearQueue(){if(!this._isInitialized)throw new Error("WAConcurrentBucketJobQueue not initialized");this._jobBucketsMap.forEach((e=>e.clear()))}enqueue(e,t,n){var r=this;if(!this._isInitialized)return Promise.reject(new Error("WAConcurrentBucketJobQueue not initialized"));let c,u;const d=new Promise(((e,t)=>{c=e,u=t})),p=(0,a.default)({priority:l.DEFAULT_JOB_PRIORITY},n),f=this._getJobBucketByType(p.priority);if(!f)return Promise.reject(new Error(`WAConcurrentBucketJobQueue no bucket for job with name ${e} was found.`));const _=`${p.priority}-${(0,s.randomHex)(8).substr(0,64)}`,h=f.add(e,p,_,(0,i.default)((function*(){try{r._jobLogger.logJobStarted(_);const e=yield r._promiseTimeoutWrapper(t(),null==n?void 0:n.maxTimeoutMs);r._jobLogger.logJobCompleted(_),c(e)}catch(e){e instanceof o.TimeoutError?r._jobLogger.logJobTimeout(_):r._jobLogger.logJobError(_),u(e)}})));return this._jobLogger.logJobCreated({jobId:_,jobName:e,jobPriority:p.priority,pendingJobsCount:f.count()}),n&&n.priority===l.JOB_PRIORITY.UI_ACTION&&this._runJobTask(h),this._runJobTasks(),d}_getJobBucketByType(e){return this._jobBucketsMap.get(e)}_getJobsRemainingQuota(e){var t;return null!==(t=this._remainingJobCountMap.get(e))&&void 0!==t?t:0}_refreshJobsRemainingQuota(){this._remainingJobCountMap=new Map(this._jobQuotaConfig)}_getNextJobBucket(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=null,n=0;return this._jobBucketsMap.forEach(((e,r)=>{n+=this._getJobsRemainingQuota(r),null==t&&e.count()>0&&this._getJobsRemainingQuota(r)>0&&(t=e)})),null!=t&&0!==n||this._refreshJobsRemainingQuota(),null==t&&e?this._getNextJobBucket(!1):t}_getJobBucketByJobId(e){const t=this._getJobBucketTypeByJobId(e);return(0,u.default)(this._jobBucketsMap.get(t),"this._jobBucketsMap.get((type: JOB_PRIORITY))")}_getJobBucketTypeByJobId(e){const t=e.split("-")[0],n=l.JOB_PRIORITY.cast(t);if(!n)throw new Error(`ConcurrentBucketQueue cannot extract known job priority type from id: ${e}`);return n}_decrementJobsQuota(e){const t=this._getJobBucketTypeByJobId(e);this._getJobsRemainingQuota(t)>0?this._remainingJobCountMap.set(t,this._getJobsRemainingQuota(t)-1):this._remainingJobCountMap.set(t,0)}_runJobTasks(){for(;this._availableThreadsCount>0;){const e=this._getNextJobBucket(),t=null==e?void 0:e.next();if(null==t)break;t.forEach((e=>{this._decrementJobsQuota(e.jobId),this._runJobTask(e)}))}}_promiseTimeoutWrapper(e,t){return void 0!==t?(0,d.promiseTimeout)(e,t):e}_runJobTask(e){var t=this;return(0,i.default)((function*(){const n=t._getJobBucketByJobId(e.jobId);t._availableThreadsCount--,n.markJobTaskPending(e);const{run:r,jobId:i,jobName:a}=e;try{var s;yield t._promiseTimeoutWrapper(r(),void 0===(null===(s=e.jobInfo)||void 0===s?void 0:s.maxTimeoutMs)?l.DEFAULT_JOB_TIMEOUT_MS:void 0)}catch(e){if(!(e instanceof o.TimeoutError))throw e;t._jobLogger.logJobTimeout(i),__LOG__(2)`[job-orchestator]: ${a} exceeding the timeout, release the thread.`}finally{t._availableThreadsCount++,n.markJobTaskDone(i),setTimeout((()=>t._runJobTasks()),0)}}))()}}},292882:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.WAConcurrentPreemptiveJobQueue=void 0;var i=r(n(311504)),a=r(n(73982)),o=n(640265),s=n(787614),l=n(524674),c=n(638284);t.WAConcurrentPreemptiveJobQueue=class{constructor(){this._isInitialized=!1,this._tasks=[],this._pendingTasks=[]}init(e,t){var n;if(this._isInitialized)throw new Error("ConcurrentPreemptiveJobQueue has already initialized");this._maxThreadsCount=e.maxConcurrency,this._availableThreadsCount=e.maxConcurrency,this._jobMaxConcurrency=null!==(n=e.maxConcurrencyPerJob)&&void 0!==n?n:{},this._jobLogger=t,this._isInitialized=!0}updateConfig(e){var t;this._availableThreadsCount+=e.maxConcurrency-this._maxThreadsCount,this._maxThreadsCount=e.maxConcurrency,this._jobMaxConcurrency=null!==(t=e.maxConcurrencyPerJob)&&void 0!==t?t:{},__LOG__(2)`[job-orchestator]: updated ConcurrentPreemptiveJobQueue config`}isInitialized(){return this._isInitialized}clearQueue(){if(!this._isInitialized)throw new Error("ConcurrentPreemptiveJobQueue not initialized");this._tasks=[],this._pendingTasks=[]}enqueue(e,t,n){var r=this;if(!this._isInitialized)return Promise.reject(new Error("ConcurrentPreemptiveJobQueue not initialized"));let c,u;const d=new Promise(((e,t)=>{c=e,u=t})),p=(0,a.default)({priority:l.DEFAULT_JOB_PRIORITY},n),f=(0,s.randomHex)(8).substr(0,64),_=this._addJobTask(e,p,f,(0,i.default)((function*(){try{r._jobLogger.logJobStarted(f);const e=yield r._promiseTimeoutWrapper(t(),null==n?void 0:n.maxTimeoutMs);r._jobLogger.logJobCompleted(f),c(e)}catch(e){e instanceof o.TimeoutError?r._jobLogger.logJobTimeout(f):r._jobLogger.logJobError(f),u(e)}})));return n&&n.priority===l.JOB_PRIORITY.UI_ACTION&&this._runJobTask(_),this._runJobTasks(),d}_runJobTasks(){for(;this._availableThreadsCount>0;){const e=this._getNextJobTask();if(null==e)break;this._runJobTask(e)}}_promiseTimeoutWrapper(e,t){return void 0!==t?(0,c.promiseTimeout)(e,t):e}_runJobTask(e){var t=this;return(0,i.default)((function*(){t._availableThreadsCount--,t._markJobTaskPending(e);const{run:n,jobId:r,jobName:i}=e;try{var a;yield t._promiseTimeoutWrapper(n(),void 0===(null===(a=e.jobInfo)||void 0===a?void 0:a.maxTimeoutMs)?l.DEFAULT_JOB_TIMEOUT_MS:void 0)}catch(e){if(!(e instanceof o.TimeoutError))throw e;t._jobLogger.logJobTimeout(r),__LOG__(2)`[job-orchestator]: ${i} exceeding the timeout, release the thread.`}finally{t._availableThreadsCount++,t._markJobTaskDone(r),setTimeout((()=>t._runJobTasks()),0)}}))()}_addJobTask(e,t,n,r){const i={jobId:n,jobInfo:t,jobName:e,run:r};return this._jobLogger.logJobCreated({jobId:n,jobName:e,jobPriority:t.priority,pendingJobsCount:this._tasks.length}),this._tasks.push(i),i}_markJobTaskPending(e){this._pendingTasks.includes((t=>t.jobId===e.jobId))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskPending found jobId: ${e.jobId} in pending tasks`,SEND_LOGS("JobOrchestrator::markJobTaskPending")),this._pendingTasks.push(e),this._tasks=this._tasks.filter((t=>t.jobId!==e.jobId))}_markJobTaskDone(e){this._pendingTasks=this._pendingTasks.filter((t=>t.jobId!==e)),this._tasks.includes((t=>t.jobId===e))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskDone found jobId: ${e} in scheduled tasks`,SEND_LOGS("JobOrchestrator::markJobTaskDone"))}_getNextJobTask(){if(0===this._tasks.length)return null;const e=this._pendingTasks.reduce(((e,t)=>{var n;const r=null!==(n=e.get(t.jobName))&&void 0!==n?n:0;return e.set(t.jobName,r+1),e}),new Map);return this._tasks.filter((t=>{var n,r;return(null!==(n=e.get(t.jobName))&&void 0!==n?n:0)<(null!==(r=this._jobMaxConcurrency[t.jobName])&&void 0!==r?r:1)}))[0]}}},184708:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.WADefaultJobNoQueue=void 0;var i=r(n(311504)),a=n(787614),o=n(524674);t.WADefaultJobNoQueue=class{constructor(){this._isInitialized=!1}init(e,t){if(this._isInitialized)throw new Error("DefaultNoQueue has already initialized");this._jobLogger=t,this._isInitialized=!0}updateConfig(){}isInitialized(){return this._isInitialized}clearQueue(){}enqueue(e,t,n){var r=this;return(0,i.default)((function*(){var i;const s=(0,a.randomHex)(8).substr(0,64);r._jobLogger.logJobCreated({jobId:s,jobName:e,jobPriority:null!==(i=null==n?void 0:n.priority)&&void 0!==i?i:o.JOB_PRIORITY.LOW,pendingJobsCount:0});try{r._jobLogger.logJobStarted(s);const e=yield t();return r._jobLogger.logJobCompleted(s),e}catch(e){throw r._jobLogger.logJobError(s),e}}))()}}},501297:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LowJobBucket=t.BaseJobBucket=void 0;var r=n(524674);class i{constructor(e){var t;this.tasks=[],this.pendingTasks=[],this.jobMaxConcurrency=null!==(t=e.jobMaxConcurrencyMap)&&void 0!==t?t:{}}updateConfig(e){var t;this.jobMaxConcurrency=null!==(t=e.jobMaxConcurrencyMap)&&void 0!==t?t:{}}next(){if(0===this.tasks.length)return null;const e=this.pendingTasks.reduce(((e,t)=>{var n;const r=null!==(n=e.get(t.jobName))&&void 0!==n?n:0;return e.set(t.jobName,r+1),e}),new Map),t=this.tasks.filter((t=>{var n,i;return(null!==(n=e.get(t.jobName))&&void 0!==n?n:0)<(null!==(i=this.jobMaxConcurrency[t.jobName])&&void 0!==i?i:r.DEFAULT_CONCURRENCY)}));return t.length>0?[t[0]]:null}add(e,t,n,r){const i={jobId:n,jobInfo:t,jobName:e,run:r};return this.tasks.push(i),i}markJobTaskPending(e){this.pendingTasks.includes((t=>t.jobId===e.jobId))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskPending found jobId: ${e.jobId} in pending tasks`,SEND_LOGS("JobOrchestrator::markJobTaskPending")),this.pendingTasks.push(e),this.tasks=this.tasks.filter((t=>t.jobId!==e.jobId))}markJobTaskDone(e){this.pendingTasks=this.pendingTasks.filter((t=>t.jobId!==e)),this.tasks.includes((t=>t.jobId===e))&&(__LOG__(4,void 0,new Error,!0)`Assertion failed::markJobTaskDone found jobId: ${e} in scheduled tasks`,SEND_LOGS("JobOrchestrator::markJobTaskDone"))}count(){return this.tasks.length}pendingCount(){return this.pendingTasks.length}clear(){this.tasks=[],this.pendingTasks=[]}}t.BaseJobBucket=i;t.LowJobBucket=class extends i{next(){var e,t;if(0===this.tasks.length)return null;const n=this.pendingTasks.reduce(((e,t)=>{var n;const r=null!==(n=e.get(t.jobName))&&void 0!==n?n:0;return e.set(t.jobName,r+1),e}),new Map),r=this.tasks.filter((e=>{var t,r;return(null!==(t=n.get(e.jobName))&&void 0!==t?t:0)<(null!==(r=this.jobMaxConcurrency[e.jobName])&&void 0!==r?r:1)}));if(0===r.length)return null;const i=null!==(e=this.jobMaxConcurrency[r[0].jobName])&&void 0!==e?e:1,a=null!==(t=n.get(r[0].jobName))&&void 0!==t?t:0;if(i>1&&a<i){const e=r.filter((e=>e.jobName===r[0].jobName)),t=Math.min(e.length,i-a);return e.slice(0,t)}return[r[0]]}}},389385:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AbortError=t.ABORT_ERROR=void 0,t.catchAbort=function(e){return t=>{if(t.name===a)return e(t);throw t}};var r=n(640265);class i extends((0,r.customError)("AbortError")){}t.AbortError=i;const a="AbortError";t.ABORT_ERROR=a},60411:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){return(0,o.default)(e,function(){var r=(0,i.default)((function*(r){if(r.signal.aborted)throw new a.AbortError;const i=e(r),o=yield t.get(i,r);if(r.signal.aborted)throw new a.AbortError;if(null!=o)return o;const s=yield n(r);if(r.signal.aborted)throw new a.AbortError;return yield t.set(i,s,r),s}));return function(){return r.apply(this,arguments)}}())};var i=r(n(311504)),a=n(389385),o=r(n(901577))},352613:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncSleep=o,t.asyncSleepAfterGivenLoopIteration=function(){return a.apply(this,arguments)};var i=r(n(311504));function a(){return(a=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;e>0&&e%t==0&&(yield o(n))}))).apply(this,arguments)}function o(e){return new Promise((t=>setTimeout(t,e)))}},265587:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(e,t){const{signal:n,timeoutIterator:r,timeoutIncludesTaskDuration:l}=(0,i.default)((0,i.default)({},s),e);return(0,o.default)((e=>{let{retry:n,failCount:i}=e;return new Promise(((e,o)=>{const s=Date.now();try{t((function(e){return Promise.reject(new a.default(e))}),i).then(e).catch(c)}catch(e){return void c(e)}function c(e){if(!(e instanceof a.default))return void o(e);const t=r.next();if(t.done)return void o(e.source);const i=Date.now()-s,c=l?Math.max(t.value-i,0):t.value;n(c)}}))}),n)},t.defaults=void 0;var i=r(n(73982)),a=r(n(187435)),o=r(n(432309));const s=Object.freeze({timeoutIncludesTaskDuration:!0});t.defaults=s},918925:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.backoff=function(){return c.apply(this,arguments)};var i=r(n(73982)),a=r(n(311504)),o=n(413959),s=r(n(187435));const l={retries:1/0};function c(){return(c=(0,a.default)((function*(e,t){const{delay:n,signal:r,retries:a}=(0,i.default)((0,i.default)({},l),e);let c=0,u=Date.now(),d=null;const p=e=>Promise.reject(new s.default(e));try{return u=Date.now(),yield t(p,c,r)}catch(f){if(c++,!(f instanceof s.default))throw f;d=f}for(;c<=a;){const e=n({iterationCount:c,taskDuration:Date.now()-u});yield(0,o.delayMs)(e,r);try{return u=Date.now(),yield t(p,c,r)}catch(f){if(c++,!(f instanceof s.default))throw f;d=f}}if(!d)throw new Error("assert: backoff completed without error or result");const f=undefined;throw d.source}))).apply(this,arguments)}},639876:(e,t)=>{"use strict";function n(e,t){let{delayMs:n,maxSize:r}=e,i=null;function a(e){return i&&i.args===e&&(i=null),t(e)}const o=()=>{if(null==i)return Promise.resolve();const e=i;return i=null,clearTimeout(e.timer),e.run(),e.batchPromise};return{accept:e=>{if(i)i.args.push(e);else{let t;const r=[e],o=new Promise((e=>{t=()=>{e(r)}})).then(a);i={args:r,batchPromise:o,run:t,timer:setTimeout(t,n)}}if(null==i)throw new Error("activeBatch should not be null here");const{args:t,batchPromise:s}=i,l=t.length-1;return null!=r&&t.length>=r&&o(),s.then((e=>e[l]))},runActiveBatch:o}}Object.defineProperty(t,"__esModule",{value:!0}),t.batch=function(e,t){const r=n(e,t);return e=>r.accept(e)},t.createSimpleBatcher=n},730844:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(311504)),a=r(n(73982)),o=r(n(145095)),s=r(n(109006));t.default=class{constructor(e,t){this._concurrency=e,this._groupLimits=t,this._runningTasksByGroup=new Map,this._enqueuedTasksByGroup=new Map}clearQueue(){this._enqueuedTasksByGroup.clear(),this._runningTasksByGroup.clear()}enqueue(e,t){let n,r;const o=new Promise(((e,t)=>{n=e,r=t}));var s;return this._doEnqueue((0,a.default)((0,a.default)({},t),{},{run:(s=(0,i.default)((function*(){try{const t=yield e();n(t)}catch(e){r(e)}})),function(){return s.apply(this,arguments)})})),this._runTasks(),o}_doEnqueue(e){this._getOrCreatePriorityQueueForGroup(e.group).push(e)}_doDequeue(){return this._getHighestPriorityAmongGroups()}_runTasks(){for(;this._getRunningTasksCount()<this._concurrency;){const e=this._doDequeue();if(null==e)break;this._runTask(e)}}_runTask(e){var t=this;return(0,i.default)((function*(){const{run:n,signal:r,group:i}=e,a=t._getRunningTasksForGroup(i);if(null==r?void 0:r.aborted)setTimeout((()=>t._runTasks()),0);else{a.add(e);try{yield n()}finally{a.delete(e),setTimeout((()=>t._runTasks()),0)}}}))()}_getHighestPriorityAmongGroups(){for(const e of this._enqueuedTasksByGroup.values()){const t=e.peek();if(t&&!this._isFullOfGroup(t.group))return e.pull()}return null}_getRunningTasksCount(){let e=0;for(const t of this._runningTasksByGroup.values())e+=t.size;return e}getEnqueuedTasksCount(){let e=0;for(const t of this._enqueuedTasksByGroup.values())e+=t.size();return e}_getRunningTasksForGroup(e){if(!this._runningTasksByGroup.has(e)){const t=new Set;return this._runningTasksByGroup.set(e,t),t}return(0,o.default)(this._runningTasksByGroup.get(e),"this._runningTasksByGroup.get(group)")}_isFullOfGroup(e){const t=this._runningTasksByGroup.get(e);return null!=t&&t.size>=this._getLimitForGroup(e)}_getOrCreatePriorityQueueForGroup(e){if(!this._enqueuedTasksByGroup.has(e)){const t=new s.default((e=>e.priority));this._enqueuedTasksByGroup.set(e,t)}return(0,o.default)(this._enqueuedTasksByGroup.get(e),"this._enqueuedTasksByGroup.get(group)")}_getLimitForGroup(e){const t=this._groupLimits[e];return null==t?1/0:t}}},757491:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.exponentialBackoff=function(e,t){const n=(0,a.default)((0,a.default)({},c),e),{signal:r,timeoutIncludesTaskDuration:u}=n,d=(0,i.default)(n,l),p=(0,s.exponentialBackoffIterator)(d);return(0,o.backoff)({signal:r,timeoutIterator:p,timeoutIncludesTaskDuration:u},t)};var i=r(n(222666)),a=r(n(73982)),o=n(265587),s=n(662971);const l=["signal","timeoutIncludesTaskDuration"],c=(0,a.default)((0,a.default)({},s.defaults),o.defaults)},450796:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filteredCatch=function(e,t){return n=>{if(Array.isArray(e)?e.some((e=>n instanceof e)):n instanceof e)return t(n);throw n}}},627722:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(389385),o=i(n(747259));t.default=class{constructor(){this._lastPromise=Promise.resolve(),this._controller=new r,this._pending=[]}enqueue(e){e.catch((()=>{}));const t=()=>e,n=this._controller.signal;this._lastPromise=this._lastPromise.then(t,t);const r=(0,o.default)(this._lastPromise,n).catch((0,a.catchAbort)((e=>{var t;throw null!==(t=this._cancellationError)&&void 0!==t?t:e})));return this._pending.push(r),r.finally((()=>{this._pending.length>0&&this._pending[0]===r&&this._pending.shift()}))}cancelAll(e){this._cancellationError=e,this._pending=[],this._controller.abort(),this._controller=new r}}},901577:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=new Map;return function(i){if(i.signal.aborted)return Promise.reject(new o.AbortError);const c=e.call(this,i);let u=n.get(c);if(null==u||u.aggregator.signal.aborted){const e=new l.default,r=(0,a.default)((0,a.default)({},i),{},{signal:e.signal});u={aggregator:e,promise:t.call(this,r).finally((()=>{e.dispose(),n.delete(c)}))},n.set(c,u)}const d=i.signal||(new r).signal;return u.aggregator.add(d),(0,s.default)(u.promise,d)}};var a=i(n(73982)),o=n(389385),s=i(n(747259)),l=i(n(444325))},856:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseAny=function(e){if(0===e.length)return Promise.reject(new r.AggregateError([]));return Promise.all(e.map(i)).then((e=>{throw new r.AggregateError(e)}),(e=>e))};var r=n(640265);function i(e){return new Promise(((t,n)=>Promise.resolve(e).then(n,t)))}},237178:(e,t)=>{"use strict";function n(e){const{relativeDelay:t=!1}=e;let n=null;const a=i(e.algo);return function(){const i=n;if(null==i)return n=t?Date.now():0,0;let o=r(e,a());if(t){const e=Date.now(),t=e-i;t>0&&(o=Math.max(0,o-t)),n=e}return o}}function r(e,t){let{max:n,min:r,jitter:i=.1}=e,a=t;return null!=n&&a>n&&(a=n),null!=r&&a<r&&(a=r),0!==i&&(a=Math.ceil(a*(1+i*Math.random()))),a}function i(e){switch(e.type){case"fibonacci":return function(e){let t=e.second-e.first,n=e.first-t;return function(){const e=t+n;return n=t,t=e,e}}(e);case"exponential":return function(e){const{base:t=2}=e;let n=e.first;return function(){const e=n;return n*=t,e}}(e);case"constant":return function(e){const t=e.delay;return function(){return t}}(e);case"adjust":return function(e){const{toMs:t,backoff:n}=e,r=i(n);return function(){return t(r())}}(e);default:throw new Error(`makeTimeFunc unrecognized backoff ${e.type}`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseTimer=function(e){const t=n(e);return function(e){return new Promise((n=>{const r=t();r>0?setTimeout(n,r,e):n(e)}))}},t.createTimer=n,t.getDelay=function(e,t){if(0===e)return 0;const n=i(t.algo);for(let t=1;t<e;t++)n();return r(t,n())}},918569:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class n{constructor(e){this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()}}t.default=class{constructor(e,t){let{maxCached:n=10,maxAge:r=1/0,shouldCache:i}=t;this._cache={},this._maxCached=n,this._maxAge=r,this._createPromiseFunc=e,this._shouldCacheFunc=i}getOrRun(e){const t=this._cache;if(this._maxAge!==1/0){const e=Date.now()-this._maxAge,n=Object.keys(t);for(let r=0;r<n.length;r++){const i=n[r];t[i].createdTime<e&&delete t[i]}}const r=t[e];if(r)return r.lastUsedTime=+Date.now(),r.promise;const i=Object.keys(t);if(i.length>=this._maxCached){let e,n;for(let r=0;r<i.length;r++){const a=i[r],o=t[a];(null==n||o.lastUsedTime<n)&&(n=o.lastUsedTime,e=a)}null!=e&&delete t[e]}for(var a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];const l=this._createPromiseFunc.apply(void 0,[e,...o]);return t[e]=new n(l),l.then((t=>{const n=this._shouldCacheFunc;n&&this._cache[e]===l&&!n(t)&&delete this._cache[e]})).catch((()=>{this._cache[e]===l&&delete this._cache[e]})),l}isCached(e){const t=this._cache[e];if(t){let e=!0;if(this._maxAge!==1/0){const n=Date.now()-this._maxAge;e=t.createdTime>=n}return e&&Boolean(t)}return!1}}},418412:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseCallSync=function(e,t){try{for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Promise.resolve(e.apply(t,r))}catch(e){return Promise.reject(e)}}},413959:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.delayMs=function(e,t){return new Promise(((n,i)=>{if(null==t?void 0:t.aborted)throw new r.AbortError;const a=setTimeout((function(){null==t||t.removeEventListener("abort",o),n()}),e);function o(){null==t||t.removeEventListener("abort",o),clearTimeout(a),i(new r.AbortError)}null==t||t.addEventListener("abort",o)}))},t.withTimeout=function(e,t,n){return new Promise(((r,i)=>{const a=setTimeout((()=>{try{r(n())}catch(e){i(e)}}),t);e.then((e=>{clearTimeout(a),r(e)}),(e=>{clearTimeout(a),i(e)}))}))};var r=n(389385)},569719:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseEach=void 0;var i=r(n(311504));const a=function(){var e=(0,i.default)((function*(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(yield t(e[r]));return n}));return function(){return e.apply(this,arguments)}}();t.promiseEach=a},904352:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseLoop=function(){return a.apply(this,arguments)};var i=r(n(311504));function a(){return(a=(0,i.default)((function*(e,t){let n,r=!1;const i=e=>{r=!0,n=e};let a=0,o=t;for(;!r;)o=yield e(i,o,a),a++;return n}))).apply(this,arguments)}},367602:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseProps=function(e){const t=Object.keys(e);return Promise.all(t.map((t=>e[t]))).then((function(e){const n={};for(let r=0;r<e.length;r++)n[t[r]]=e[r];return n}))}},927870:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueMap=t.PromiseQueue=void 0;t.PromiseQueue=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._promise=Promise.resolve(),this._maxDelay=e}wait(){return this._promise}enqueueHandlers(e,t,r){const i=this._promise.then((()=>e)).then(t,r),a=i.then();return this._promise=n(i,this._maxDelay),a}enqueue(e){const t=this._promise.then(e),r=t.then();return this._promise=n(t,this._maxDelay),r}};function n(e,t){return t>=0?new Promise((n=>{const r=()=>{n()};e.then(r,r),setTimeout(r,t)})):e.then(r,r)}function r(){}t.PromiseQueueMap=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._map=new Map,this._maxDelay=e}waitIfPending(e){return this._map.get(e)}wait(e){return this._map.get(e)||Promise.resolve()}enqueueHandlers(e,t,n,r){const i=this.wait(e).then((()=>t)).then(n,r);return this._addToMap(e,i)}enqueue(e,t){const n=this.wait(e).then(t);return this._addToMap(e,n)}_addToMap(e,t){const r=t.then();let i;const a=()=>{this._map.get(e)===i&&this._map.delete(e)};return i=n(t,this._maxDelay).then(a,a),this._map.set(e,i),r}}},747259:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==t)return e;let n;const i=t.aborted?Promise.reject(new r.AbortError):new Promise(((e,i)=>{const a=()=>{i(new r.AbortError)};t.addEventListener("abort",a),n=()=>{t.removeEventListener("abort",a)}}));return Promise.race([i,e]).finally((()=>{var e;null===(e=n)||void 0===e||e(),n=null}))};var r=n(389385)},166751:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.promiseReduce=void 0;var i=r(n(311504));const a=function(){var e=(0,i.default)((function*(e,t,n){let r=n;const i=e.length;for(let n=0;n<i;n++)r=yield t(r,e[n],n);return r}));return function(){return e.apply(this,arguments)}}();t.promiseReduce=a},72287:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseRetryLoop=void 0;var r=n(237178),i=n(413959),a=n(88156);t.PromiseRetryLoop=class{constructor(e){this._resolvable=new a.Resolvable,this._promise=null,this._resetTime=null,this._currentLoopIdentificator=0,this.endWithValue=e=>{this._currentLoopIdentificator++,this._resolvable.resolve(e)},this._options=e}resetTimeoutAfter(e){this._resetTime=Date.now()+e}cancelReset(){this._resetTime=null}reset(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: resetting ${this._options.name}`,this._currentLoopIdentificator++,this._runLoop())}start(){this._resolvable.resolveWasCalled()||(__LOG__(2)`PromiseRetryLoop: starting ${this._options.name}`,0!==this._currentLoopIdentificator&&__LOG__(4,void 0,new Error)`PromiseRetryLoop was called several times. You may have race conditions`,this._currentLoopIdentificator++,this._runLoop())}_runLoop(){const e=this._options,t=this._currentLoopIdentificator;let n=(0,r.createTimer)(this._options.timer);n();const a=()=>{if(this._resolvable.resolveWasCalled())return;if(t!==this._currentLoopIdentificator)return;const o=Date.now();return this._promise=(0,e.code)(this.endWithValue).then((()=>{if(this._resolvable.resolveWasCalled())return;const{resetDelay:t}=e;(void 0!==t&&Date.now()>=o+t||null!=this._resetTime&&this._resetTime<=Date.now())&&(__LOG__(2)`PromiseRetryLoop: resetting ${e.name}`,n=(0,r.createTimer)(this._options.timer)),this._resetTime=null;const s=n();return __LOG__(2)`PromiseRetryLoop: retrying ${e.name} in ${s}ms`,(0,i.delayMs)(s).then(a)})),this._promise};this._promise=Promise.resolve().then(a)}promise(){return this._resolvable.resolveWasCalled()?this._resolvable.promise:this._promise?Promise.race([this._resolvable.promise,this._promise.then((()=>this._resolvable.promise))]):Promise.reject(new Error(`PromiseRetryLoop ${this._options.name} had promise() called before start()`))}}},638284:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseTimeout=void 0;var r=n(640265);t.promiseTimeout=(e,t,n)=>{let i=null,a=null;const o=new Promise(((e,o)=>{a=o,i=setTimeout((()=>{o(new r.TimeoutError(n)),clearTimeout(i)}),t)}));return Promise.race([e,o]).finally((()=>{a&&a(new Error),clearTimeout(i)}))}},920461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.promiseWrapSync=function(e){return function(){try{return Promise.resolve(e.apply(this,arguments))}catch(e){return Promise.reject(e)}}}},71197:(e,t,n)=>{"use strict";var r=n(280366).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n;const i=new r;if(e.some((e=>e.aborted)))i.abort();else{n=()=>{for(const n of e)n.removeEventListener("abort",t);n=null};const t=()=>{var e;null===(e=n)||void 0===e||e(),i.abort()};for(const n of e)n.addEventListener("abort",t)}return t(i.signal).finally((()=>{var e;null===(e=n)||void 0===e||e()}))}},88156:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resolvable=void 0;t.Resolvable=class{constructor(){this._isResolved=!1,this.promise=new Promise((e=>{this._resolve=e}))}resolve(e){this._isResolved=!0,this._resolve(e)}reject(e){this.resolve(Promise.reject(e))}resolveWasCalled(){return this._isResolved}}},432309:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return new Promise(((n,i)=>{let a,o=0,s=!1;if(t){const e=()=>{t.removeEventListener("abort",e),s=!0,null!=a&&clearTimeout(a),i(new r.AbortError)};if(t.aborted)return void e();t.addEventListener("abort",e)}!function t(){let r=!1,l=!1;a=null;try{const c=e({retry:e=>{if(!s&&!l){if(r=!0,o++,null==e)return t();a=setTimeout(t,e)}},failCount:o});if(!(c instanceof Promise))throw new TypeError("task must return a promise");c.then((e=>{s||r||(l=!0,n(e))})).catch((e=>{s||r||(l=!0,i(e))}))}catch(e){if(s||r)return;i(e)}}()}))};var r=n(389385)},187435:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(640265);class i extends((0,r.customError)("RetryableError")){constructor(e){super("see error at this.source"),this.source=e}}t.default=i},297197:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Semaphore=void 0;t.Semaphore=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._count=0,this._queue=[],this._size=e}acquire(){return new Promise(((e,t)=>{this._performAcquisition(e,t)}))}availablePermits(){return this._size-this._count}_performRelease(){this._count--,this._dequeue()}_performAcquisition(e,t){if(this._count<this._size){this._count++;let t=!1;e({release:()=>{if(t)throw new Error("Permit has already been released");t=!0,this._performRelease()}})}else this._enqueue(e,t)}_enqueue(e,t){this._queue.push([e,t])}_dequeue(){if(0===this._queue.length)return;const[e,t]=this._queue.shift();this._performAcquisition(e,t)}}},444325:(e,t,n)=>{"use strict";var r=n(280366).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(){this._disposed=!1,this._controller=new r,this._signals=new Set,this.signal=this._controller.signal,this._handleAbort=e=>{this.delete(e.currentTarget),this._checkAborted()}}add(){this._throwIfDisposed();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(const e of t)e.aborted||(e.addEventListener("abort",this._handleAbort),this._signals.add(e));this._checkAborted()}_checkAborted(){if(this._disposed)return;Array.from(this._signals).every((e=>e.aborted))&&(this.dispose(),this._controller.abort())}delete(){this._throwIfDisposed(),this._delete(...arguments)}_delete(){let e=!1;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const t of n)this._signals.delete(t)&&(e=!0,t.removeEventListener("abort",this._handleAbort));e&&this._checkAborted()}_throwIfDisposed(){if(this._disposed)throw new Error("Attempt to modify disposed SignalAggregator")}dispose(){if(!this._disposed){this._disposed=!0;for(const e of this._signals)this._delete(e)}}}},74121:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=y;const n="undefined"!=typeof Promise?Promise:null,r="function"==typeof setImmediate?setImmediate:null;let i=0;const a=[],o=[],s=[],l={sentinel:"CONTINUE_AS_IF_NO_HANDLER"},c={sentinel:"RETRY_ASYNCHRONOUSLY"},u={sentinel:"TO_STRING"},d={sentinel:"DID_ERROR"};let p=null;const f=[],_=64,h=128,g=512,m="undefined"==typeof self?void 0:self;function y(e,t){this._flags=0,this._value=void 0,this._onFulfilled=void 0,this._onRejected=void 0,this._context=void 0,this._resolveLevel=0,this._control=void 0,this.x=void 0,this._thenableParent=null,this._parent=void 0,this._child=void 0,this._children=void 0,this.control=void 0,t&&(this._context=t.this),"function"==typeof e&&(this._onFulfilled=e,this._flags|=4,this._flags|=256,Y(e,this._context,(e=>R(this,0,!0,!1,e)),(e=>R(this,0,!1,!1,e))))}let S,E;function v(e){if(void 0===e)return S;if(I(e))return e;{const t=new y;return R(t,0,!0,!1,e),H(t,g),t}}function T(e){const t=new y;return t._value=e,H(t,514),f.push(t),t}function C(e){let t="";if(e._flags&h){t=(e._onFulfilled||e._onRejected).call(e._context,u)}else if(e._control)t=`.addRawControl(${e._control.name}, ${e._control.foo})`;else if(16&e._flags)t=`.endWithControls(${Object.keys(e.control)})`;else if(e._flags&g)t=1&e._flags?`Promise.resolve(${void 0===e._value?"":e._value})`:`Promise.reject(${void 0===e._value?"":e._value})`;else if(256&e._flags)switch(3&e._flags){case 2:case 0:case 1:t=`new Promise(${e._onFulfilled})`}else e._onFulfilled&&e._onRejected?t=`.then(${e._onFulfilled}, ${e._onRejected})`:e._onFulfilled?t=`.then(${e._onFulfilled})`:e._onRejected&&(t=`.catch(${e._onRejected})`);return t}function A(e){this.message=e,this.stack=new Error(e||this.name).stack}function b(){0===i&&(o.length||f.length)&&(i=1,E||(E=function(){let e,t,i=0;return"undefined"==typeof MutationObserver||m&&m.navigator&&m.navigator.standalone?n?function(){n.resolve().then(B)}:"function"==typeof r?function(){r(B)}:function(){setTimeout(B,0)}:(e=document.createTextNode(""),t=new MutationObserver(B),t.observe(e,{characterData:!0}),function(){e.data=i=1-i})}()),E())}function P(e,t){H(e,8),t._parent=e,e._children?e._children.push(t):e._child?(e._children=[e._child,t],e._child=void 0):e._child=t}function O(e){if(e&&("object"==typeof e||"function"==typeof e)){let t;try{t=e.then}catch(e){return p=e,d}if("function"==typeof t)return t}}function M(e){if(!e||I(e))return e;const t=O(e);if(t===d)return T(p);if(t){const n=new y((function(n,r){t.call(e,n,r)}));return n._thenableParent=e,n}return e}function I(e){return e instanceof y}function w(e,t,n){const r=I(e=M(e));let i,a,o,s,u=!1;if(r){if(!(3&e._flags))return H(e.then(t,n),32);H(e,8),u=!!(e._flags&_),o=e._context,i=1&e._flags?t:n,a=e._value}else i=t,a=e;if(!i)return v(e).then();if(a=W(i,o,a,!0),a===d)s=T(p);else{if(a===c)return v(e).then(t,n);if(a===l)return r?e.then():v(e);s=v(a)}return u&&(s=s.cancellable()),void 0!==o&&(s=s.then(),s._context=o),s}function R(e,t,n,r,i){if(t!==e._resolveLevel)return;const a=++e._resolveLevel;if(H(e,4),e._thenableParent=null,n)if(i===e)e._parent=void 0,U(e,!1,r,new TypeError("promise resolved to itself"));else if(I(i)){const t=3&i._flags;0===t?P(i,e):(e._parent=i,H(e,1024),H(i,8),U(e,1===t,r,i._value))}else{const t=O(i);t===d?(e._parent=void 0,U(e,!1,r,p)):t?(e._parent=void 0,e._thenableParent=i,Y(t,i,(t=>R(e,a,!0,!1,t)),(t=>R(e,a,!1,!1,t)))):U(e,!0,r,i)}else U(e,!1,r,i)}function N(e,t,n,r,i){t===e._resolveLevel&&(L(e),R(e,t,n,r,i))}function L(e){if(e._parent){const t=e._parent;if(e._parent=void 0,t._child===e)t._child=void 0;else if(t._children){const n=t._children;for(let t=0;t<n.length;t++)if(n[t]===e){n.splice(t,1);break}0===n.length&&(t._children=void 0)}}}function D(e){if(null==e)throw new Error(`Invalid .catch guard ${e}`);if("function"==typeof e)return e;if("object"==typeof e)throw new Error("Object guards in .catch are currently unsupported");return function(t){return t===e}}function k(e,t){return function(n,r){return n===u?`.catch(..., ${t})`:e&&!function(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r===Error||r.prototype instanceof Error){if(t instanceof r)return!0}else if(r(t))return!0}return!1}(e,n)?l:r?c:t.call(this,n)}}function U(e,t,n,r){if(H(e,4|(t?1:2)),e._value=r,e._child)G(e._child,t,n,r),e._child=void 0;else if(e._children){const i=e._children;e._children=void 0;for(let e=0;e<i.length;e++)G(i[e],t,n,r)}else t||8&e._flags||f.push(e)}function G(e,t,n,r){e._resolveLevel++;const i=K(e,t);if(i&&32&e._flags){H(e,4);const a=W(i,e._context,r,!0);if(a!==c)return void(a===d?(e._parent=void 0,U(e,!1,n,p)):a===l?U(e,t,n,r):(e._parent=void 0,R(e,e._resolveLevel,!0,n,a)));e._flags&=-5}i?((n?s:o).push(e),b()):U(e,t,n,r)}function x(e,t){for(;0!==e.length;)t.push(e.pop())}function B(){for(;0!==a.length||0!==o.length;){0===a.length&&x(o,a);const e=a.pop(),t=e._parent;let n=!!(t&&1&t._flags),r=t&&t._value;const i=K(e,n);if(H(e,4),i){let t;do{t=W(i,e._context,r,!1)}while(t===c);t===d?(r=p,n=!1,e._parent=void 0):t!==l&&(r=t,n=!0,e._parent=void 0)}3&e._flags||(R(e,e._resolveLevel,n,!0,r),x(s,a))}for(i--;0!==f.length;){const e=f.pop();8&e._flags||j(e,e._value)}}y.resolve=v,y.reject=T,y.prototype.then=function(e,t){"function"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0);const n=new y;n._onFulfilled=e,n._onRejected=t,n._context=this._context,this._flags&_&&H(n,_);const r=3&this._flags;return 0===r?P(this,n):(H(this,8),(1===r?e:t)?(n._parent=this,o.push(n),b()):(n._parent=this,H(n,r),n._value=this._value,2===r&&f.push(n))),n},y.prototype.catch=function(e){const t=arguments.length-1;if(0===t)return this.then(void 0,e);const n=new Array(t);for(let e=0;e<t;e++)n[e]=D(arguments[e]);const r=k(n,arguments[t]),i=w(this,void 0,r);return i._onRejected&&H(i,h),i},y.all=function(e){return new y((function(t,n){let r=e.length;if(0===r)return void t([]);const i=new Array(e.length);function a(e){if(0==--r){const n=[];for(let t=0;t<i.length;t++){const r=i[t];n.push(r&&3&r._flags?r._value:e)}t(n)}return e}for(let t=0;t<e.length;t++)i[t]=w(e[t],a,n)}))},y.allSettled=function(e){return new y((function(t){const n=Array.from(e);let r=n.length;if(0===r)return void t([]);const i=new Array(n.length);function a(e){return function(n){const a=e?{status:"rejected",reason:n}:{status:"fulfilled",value:n};if(0==--r){const e=[];for(let t=0;t<i.length;t++){const n=i[t];e.push(n&&3&n._flags?n._value:a)}t(e)}return a}}const o=a(!1),s=a(!0);for(let e=0;e<n.length;e++)i[e]=w(n[e],o,s)}))},y.race=function(e){const t=M(e);if(I(t)){const e=t.then((e=>y.race(e)));return e._context=void 0,e._flags&=-65,e}return new y((function(e,n){for(let r=0;r<t.length;r++){const i=M(t[r]);if(!I(i)||3&i._flags)for(e(i),r++;r<t.length;r++){const e=t[r];I(e)&&H(e,8)}else i.then(e,n)}}))},y.prototype.toString=function(){const e=[];let t;for(let n=this,r=!1;n;n=n._parent){t=n,!r&&3&n._flags&&(r=!0,n._flags&g||(1&n._flags?e.push(`[resolved value: ${n._value}]`):e.push(`[rejected reason: ${n._value}]`)));let i=C(n);1024&n._flags&&(i=`~${i}`),e.push(i)}return e.reverse(),768&t._flags||(e[0]=`[Promise]${e[0]}`),e.join("\n")},y.prototype.finally=function(e){function t(t){return t===u?`.finally(${e})`:(e.call(this),l)}return H(this.then(t,t),h)},A.prototype=Object.create(Error.prototype,{name:{value:"AbortError"}}),y.CancellationError=A,y.prototype.cancellable=function(){return H(this.then(),_)},y.prototype.cancel=function(e){let t;for(let e=this;e&&!(3&e._flags);e=e._parent)e._flags&_&&(t=e);if(t)if(void 0===e&&(e=new A),K(t,!1)){const n=new y;L(t),P(n,t),N(n,0,!1,!1,e)}else N(t,t._resolveLevel,!1,!1,e)};const F=null==(null==m?void 0:m.dispatchEvent)?null:class extends Event{constructor(e,t){super(e,{cancelable:!0}),Object.defineProperties(this,{promise:{value:t.promise,enumerable:!0},reason:{value:t.reason,enumerable:!0}})}};function j(e,t){if(null!=(null==m?void 0:m.dispatchEvent)){const n=new F("unhandledrejection",{promise:e,reason:t});if(m.dispatchEvent(n),!m.PromiseRejectionEvent&&m.onunhandledrejection)try{m.onunhandledrejection(n)}catch(e){}}else"undefined"!=typeof process&&null!=process.emit?process.emit("unhandledRejection",t,e):console.error(`StackPromise did not catch ${t}`,e,t)}function Y(e,t,n,r){try{e.call(t,n,r)}catch(e){r(e)}}function K(e,t){if(!(4&e._flags))return t?e._onFulfilled:e._onRejected}function W(e,t,n,r){try{return r?e.call(t,n,!0):e.call(t,n)}catch(e){return p=e,d}}function H(e,t){return e._flags|=t,e}S=new y,R(S,0,!0,!1,void 0)},234497:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProtoInternalSpec=function(e){if(null==e.internalSpec)throw new Error("Protobuf spec does not have internalSpec.");return e.internalSpec}},608243:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decimalStringToLongInt=function(e){if(!/^-?\d+$/.test(e))throw __LOG__(2)`"${e}" is not a valid decimal string`,new Error("decimalStringToLongInt is given an invalid decimal string");const t="-"===e[0],n=e.replace(/^-?0*/,""),i=n.length;if(i<16||16===i&&n<="9007199254740991")return t?-Number(n):Number(n);if(i>20||20===i&&n>"18446744073709551615"||t&&(i>19||19===i&&n>"9223372036854775807"))throw __LOG__(2)`"${e}" is over 64 bits`,new Error("decimalStringToHexLong is given value over 64 bits");let a=0,o=0;for(let e=0;e<i;e++)a=10*a+Number(n[e]),o=10*o+Math.floor(a/4294967296),a%=4294967296;return(0,r.createHexLongFrom32Bits)(o,a,t)},t.isBiggerLongInt=function(e,t){if("number"==typeof e&&"number"==typeof t)return e>t;const n="number"==typeof e?(0,r.hexLongFromNumber)(e):e,i="number"==typeof t?(0,r.hexLongFromNumber)(t):t;return(0,r.isBiggerHexLong)(n,i)},t.longIntToDecimalString=function(e){if("number"==typeof e)return e.toString(10);const t=(0,r.hexLongToHex)(e),n=[0];let i=0;for(let e=0;e<t.length;e++){i=(0,r.hexAt)(t,e);for(let e=0;e<n.length;e++)n[e]=16*n[e]+i,i=n[e]/10|0,n[e]%=10;for(;i>0;)n.push(i%10),i=i/10|0}const a=n.reverse().join("");return(0,r.hexLongIsNegative)(e)?"-"+a:a},t.maybeNumberOrThrowIfTooLarge=void 0,t.numberOrThrowIfTooLarge=i;var r=n(787614);function i(e){if("number"!=typeof e)throw __LOG__(2)`${e} is not a safe integer`,new Error("numberOrThrowIfTooLarge is given a non-safe integer");return e}t.maybeNumberOrThrowIfTooLarge=e=>null==e?e:i(e)},442098:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spec=void 0,t.compileSpec=function(e){if(e.internalCompiledSpec)return e.internalCompiledSpec;const t=e.internalSpec;if(!t)throw new Error(`Message Class ${String(e)} does not have internalSpec`);const n=e.internalDefaults||{},o=Object.keys(t).filter((e=>e!==r.KEYS.ONEOF)),s=new Array(o.length),l=[],c=[],u=new Array(o.length),d=t[r.KEYS.ONEOF]||{};o.sort(((e,n)=>{const r=a(t,e),i=a(t,n);return r[0]-i[0]}));for(let e=0;e<o.length;e++){const i=o[e],d=a(t,i);u[e]=n[i];const p=d[1],f=d[0];if(l.push(f),c.push(p),(p&r.TYPE_MASK)===r.TYPES.MESSAGE)s[e]=d[2];else if((p&r.TYPE_MASK)===r.TYPES.ENUM){const t=d[2];if("function"==typeof t.cast)s[e]=t;else{let n,r=!0,i=0;for(const e in t)r&&e!==i++&&(r=!1);if(r){n=[];for(let e=0;e<i;e++)n.push(!0)}else{n={};for(const e in t)n[t[e]]=!0}s[e]=n}}else s[e]=null}const p={};for(const e in d)d[e].forEach((t=>{p[t]||(p[t]=[]),p[t].push(e)}));const f=t[r.KEYS.RESERVED]&&t[r.KEYS.RESERVED][r.KEYS.RESERVED_TAGS],_=t[r.KEYS.RESERVED]&&t[r.KEYS.RESERVED][r.KEYS.RESERVED_FIELDS],h=new i(o,l,c,u,s,d,p,f,_);return e.internalCompiledSpec=h,h};var r=n(401390);class i{constructor(e,t,n,r,i,a,o,s,l){this.names=e,this.fields=t,this.types=n,this.defaults=r,this.meta=i,this.oneofToFields=a,this.fieldToOneof=o,this.reservedTags=s?s.reduce(((e,t)=>(e[t]=!0,e)),{}):{},this.reservedFields=l?l.reduce(((e,t)=>(e[t]=!0,e)),{}):{}}}function a(e,t){const n=e[t];if(null==n)throw new Error(`fieldData of ${t} is missing`);return n}t.Spec=i},401390:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_MASK=t.TYPES=t.KEYS=t.FLAGS=t.ENC=void 0;t.FLAGS={REPEATED:64,PACKED:128,REQUIRED:256};t.TYPE_MASK=31;t.TYPES={INT32:1,INT64:2,UINT32:3,UINT64:4,SINT32:5,SINT64:6,BOOL:7,ENUM:8,FIXED64:9,SFIXED64:10,DOUBLE:11,STRING:12,BYTES:13,MESSAGE:14,FIXED32:15,SFIXED32:16,FLOAT:17};t.ENC={VARINT:0,BIT64:1,BINARY:2,BIT32:5};t.KEYS={ONEOF:"__oneofs__",RESERVED:"__reserved__",RESERVED_TAGS:"tags",RESERVED_FIELDS:"fields"}},172058:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.typeToEncType=function(e){if(e&a.PACKED)return l.BINARY;const t=e&s;return t<=o.ENUM?l.VARINT:t<=o.DOUBLE?l.BIT64:t<=o.MESSAGE?l.BINARY:l.BIT32};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(401390));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}const{FLAGS:a,TYPES:o,TYPE_MASK:s,ENC:l}=r},649259:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequirements=l,t.checkValid=function(e,t){l(e,t);const n=h(t,e);if(n)throw n.path.reverse(),new TypeError(`Invalid value at ${n.path.join(".")}: ${n.error}`)};var i=r(n(133344)),a=n(442098),o=n(401390);const s=Number.MAX_SAFE_INTEGER;function l(e,t){const n=c(e,t);if(n)throw n.reverse(),new TypeError(`Message missing required value ${n.join(".")}`)}function c(e,t){const{names:n,types:r,meta:s}=(0,a.compileSpec)(e);let l;for(let e=0;e<r.length&&!l;e++){const a=r[e],u=n[e],d=(0,i.default)(t,u)?t[u]:void 0;if(a&o.FLAGS.REQUIRED&&null==d)l=[u];else if((a&o.TYPE_MASK)===o.TYPES.MESSAGE&&a&o.FLAGS.REPEATED&&null!=d){const t=s[e];let n;for(n=0;n<d.length&&!l;n++)l=c(t,d[n]);l&&l.push(`${u}[${n}]`)}else(a&o.TYPE_MASK)===o.TYPES.MESSAGE&&null!=d&&(l=c(s[e],d),l&&l.push(u))}return l}function u(e,t,n){return"string"==typeof e?!/^-?0x[0-9a-f]{16}$/i.test(e)&&(__LOG__(2)`"${f(e)}" is not a valid long`,{path:[],error:"value must be a hex string of the form '0x123...' or '-0x123...' where the tail is always 16 characters long"}):d(e,t,n)}function d(e,t,n){return"number"!=typeof e||e!=e||Math.floor(e)!==e?(__LOG__(2)`"${f(e)}" is not a valid int`,{path:[],error:"value must be an int"}):(e<t||e>=n)&&(__LOG__(2)`"${f(e)}" is out of range`,{path:[],error:"value is out of range"})}function p(e,t,n){return e?void 0:(__LOG__(2)`"${f(n)}" is not ${t}`,{path:[],error:"value is invalid"})}function f(e){return"string"==typeof e?`"${e}"`:Array.isArray(e)?`[${e.join(", ")}]`:`${e}`}const _=[void 0,e=>d(e,-2147483648,2147483648),e=>u(e,-s,s+1),e=>d(e,0,4294967296),e=>u(e,0,s+1),e=>d(e,-2147483648,2147483648),e=>u(e,-s,s+1),e=>p("boolean"==typeof e,"boolean",e),(e,t)=>p("number"==typeof e&&(t[e]||void 0!==t.cast(e)),"in enum",e),e=>u(e,0,s+1),e=>u(e,-s,s+1),e=>p("number"==typeof e,"number",e),e=>p("string"==typeof e,"string",e),e=>p(e instanceof ArrayBuffer||e instanceof Uint8Array,"ArrayBuffer or Uint8Array",e),h,e=>d(e,0,4294967296),e=>d(e,-2147483648,2147483648),e=>p("number"==typeof e,"number",e)];function h(e,t){const{names:n,fields:r,types:i,meta:s,oneofToFields:l,fieldToOneof:c,reservedTags:u,reservedFields:d}=(0,a.compileSpec)(t);let p;for(let t=0;t<n.length&&!p;t++){const a=n[t],h=i[t],g=e[a],m=h&o.TYPE_MASK,y=_[m];if(void 0===y)throw new Error(`Can not find the validator for type ${m}`);if(h&(o.FLAGS.PACKED|o.FLAGS.REPEATED)&&null!=g)if(Array.isArray(g)){const e=s[t];for(let t=0;t<g.length&&!p;t++)p=y(g[t],e),p&&p.path.push(`${a}[${t}]`)}else __LOG__(2)`"${f(g)}" is not an array`,p={path:[a],error:"repeated field must be array"};else if(null!=g){p=y(g,s[t]),p&&p.path.push(a);const n=c[a];n&&n.forEach((t=>{l[t].filter((e=>e!==a)).forEach((n=>{void 0!==e[n]&&(p={path:[t],error:`oneof has fields '${a}' and '${n}' set`})}))})),u[r[t]]&&(p={path:[a],error:`tag ${r[t]} is reserved`}),d[a]&&(p={path:[a],error:"field name is reserved"})}}return p}},484902:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeProtobuf=function(e,t){const n=new a.Binary(t),r=y(e,n,void 0,!1);return(0,d.checkRequirements)(e,r),r},t.decodeProtobufWithUnknowns=function(e,t){const n=new a.Binary(t),r=y(e,n,void 0,!0);return(0,d.checkRequirements)(e,r),r},t.getUnknownFields=function(e){return(0,o.default)(e,"$$unsafeUnknownFields")?e.$$unsafeUnknownFields:null};var i=r(n(73982)),a=n(108584),o=r(n(133344)),s=n(787614),l=n(442098),c=n(401390),u=n(172058),d=n(649259);function p(e,t,n){if(e!==(0,u.typeToEncType)(t))throw new Error(`FormatError: ${n} encoded with wire type ${e}`)}function f(e,t,n){switch(t){case c.TYPES.INT32:return _(n,-2147483648,2147483648,e,a.parseInt64OrThrow);case c.TYPES.INT64:return n.readVarInt(h);case c.TYPES.UINT32:return _(n,0,4294967296,e,a.parseUint64OrThrow);case c.TYPES.UINT64:return n.readVarInt(g);case c.TYPES.SINT32:{const t=_(n,0,4294967296,e,a.parseInt64OrThrow);return 1&t?~(t>>>1):t>>>1}case c.TYPES.SINT64:return n.readVarInt(m);case c.TYPES.BOOL:return!!_(n,0,2,e,a.parseUint64OrThrow);case c.TYPES.ENUM:return n.readVarInt(a.parseInt64OrThrow);case c.TYPES.FIXED64:return n.readLong(g,!0);case c.TYPES.SFIXED64:return n.readLong(h,!0);case c.TYPES.DOUBLE:return n.readFloat64(!0);case c.TYPES.STRING:return n.readString(n.readVarInt(a.parseUint64OrThrow));case c.TYPES.BYTES:return n.readBuffer(n.readVarInt(a.parseUint64OrThrow));case c.TYPES.FIXED32:return n.readUint32(!0);case c.TYPES.SFIXED32:return n.readInt32(!0);case c.TYPES.FLOAT:return n.readFloat32(!0)}}function _(e,t,n,r,i){const a=e.readVarInt(i);if(a<t||a>=n)throw new Error(`FormatError: ${r} encoded with out-of-range value ${a}`);return a}function h(e,t){if((0,a.longFitsInDouble)(!0,e,t)){return 4294967296*e+S(t)}{const n=e<0;let r;r=n?0===t?-e:~e:e;const i=n?-t:t;return(0,s.createHexLongFrom32Bits)(r,i,n)}}function g(e,t){if((0,a.longFitsInDouble)(!1,e,t)){return 4294967296*S(e)+S(t)}return(0,s.createHexLongFrom32Bits)(e,t)}function m(e,t){let n=e>>>1,r=e<<31|t>>>1;return 1&t&&(n=~n,r=~r),h(n,r)}function y(e,t,n,r){var o;const{names:s,fields:u,types:d,meta:h,oneofToFields:g,fieldToOneof:m,reservedTags:S,reservedFields:E}=(0,l.compileSpec)(e),{internalDefaults:v}=e,T=n||(0,i.default)({},v)||{};T.$$unknownFieldCount=null!==(o=null==n?void 0:n.$$unknownFieldCount)&&void 0!==o?o:0;for(let e=0;e<s.length;e++)d[e]&c.FLAGS.REPEATED&&(T[s[e]]=[]);let C=0;const A=u.length>0;let b=u[0];for(;t.size();){const e=_(t,0,4294967296,"field and enc type",a.parseInt64OrThrow),n=7&e,i=e>>>3;if(A&&i!==b){const e=C;do{++C===u.length&&(C=0),b=u[C]}while(i!==b&&C!==e)}if(A&&i===b){const e=s[C],o=d[C];p(n,o,e);const l=o&c.TYPE_MASK,u=h[C];if(o&c.FLAGS.PACKED){const n=t.readVarInt(a.parseUint64OrThrow),r=t.readBinary(n);for(;r.size();){var P;const t=f(e,l,r);(l!==c.TYPES.ENUM||u[t]||void 0!==(null===(P=u.cast)||void 0===P?void 0:P.call(u,t)))&&T[e].push(t)}}else if(l===c.TYPES.MESSAGE){const n=t.readVarInt(a.parseUint64OrThrow),i=t.readBinary(n);if(o&c.FLAGS.REPEATED)T[e].push(y(u,i,void 0,r));else{const t=T[e];T[e]=y(u,i,t,r)}}else{var O;const n=f(e,l,t);(l!==c.TYPES.ENUM||u[n]||void 0!==(null===(O=u.cast)||void 0===O?void 0:O.call(u,n)))&&(o&c.FLAGS.REPEATED?T[e].push(n):T[e]=n)}const _=m[e];_&&void 0!==T[e]&&_.forEach((t=>{g[t].filter((t=>t!==e)).forEach((e=>{delete T[e]}))})),(S[i]||E[e])&&delete T[e]}else if(T.$$unknownFieldCount++,r){let e;switch(T.$$unsafeUnknownFields||(T.$$unsafeUnknownFields={}),n){case c.ENC.VARINT:e=t.readVarInt(a.parseInt64OrThrow);break;case c.ENC.BIT64:e=t.readBinary(8);break;case c.ENC.BINARY:e=t.readBinary(t.readVarInt(a.parseUint64OrThrow));break;case c.ENC.BIT32:e=t.readBinary(4)}T.$$unsafeUnknownFields[i]=e}else n===c.ENC.VARINT?t.readVarInt(a.parseInt64OrThrow):n===c.ENC.BIT64?t.advance(8):n===c.ENC.BINARY?t.advance(t.readVarInt(a.parseUint64OrThrow)):n===c.ENC.BIT32&&t.advance(4)}return T}function S(e){return e>=0?e:4294967296+e}},760980:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encodeErrorInfo=function(){return void 0!==c?`Last encoded value for ${c}`:"No information known"},t.encodeProtobuf=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.Binary;return(0,l.checkValid)(e,t),h(n,t,e),c=void 0,n};var r=n(108584),i=n(787614),a=n(442098),o=n(401390),s=n(172058),l=n(649259);let c;function u(e,t){e.writeVarInt(t)}function d(e,t){if("number"==typeof t&&t<4503599627370496&&t>=-4503599627370496)e.writeVarInt(t>=0?2*t:2*-t-1);else{const n=new r.Binary;let a;"number"==typeof t?(a=t<0,n.writeVarInt(a?-t:t)):(a=(0,i.hexLongIsNegative)(t),n.writeVarIntFromHexLong(a?(0,i.negateHexLong)(t):t));const o=n.peek((()=>n.readByteArray())),s=o.byteLength;if(a){let e,t=0;do{e=o[t],o[t]=128&e|(127&e)-1&127,t++}while(255===o[t-1])}let l=a?1:0;for(let e=0;e<s;e++){const t=o[e],n=128&t|(63&t)<<1|l;l=(64&t)>>6,o[e]=n}1===l&&(o[s-1]|=128,n.writeInt8(1)),e.writeBinary(n)}}function p(e,t){"number"==typeof t?e.writeVarInt(t):e.writeVarIntFromHexLong(t)}const f=[void 0,u,p,u,p,d,d,(e,t)=>{e.writeVarInt(t?1:0)},u,(e,t)=>{"number"==typeof t?e.writeUint64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{"number"==typeof t?e.writeInt64(t,!0):e.writeHexLong(t,!0)},(e,t)=>{e.writeFloat64(t,!0)},function(e,t){e.writeVarInt((0,r.numUtf8Bytes)(t)),e.writeString(t)},function(e,t){e.writeVarInt(t.byteLength),e.writeBuffer(t)},function(e,t,n){e.writeWithVarIntLength(((e,t)=>h(e,t,n)),t)},(e,t)=>{e.writeUint32(t,!0)},(e,t)=>{e.writeInt32(t,!0)},(e,t)=>{e.writeFloat32(t,!0)}],_=f.map((e=>{if(null!=e)return(e,n)=>{e.writeWithVarIntLength(t,n)};function t(t,n){for(let r=0;r<n.length;r++)e(t,n[r])}}));function h(e,t,n){const{names:r,fields:i,types:l,meta:u}=(0,a.compileSpec)(n),{internalDefaults:d}=n;for(let n=0;n<r.length;n++){const a=r[n];let p=t[a];if(null==p&&d&&(p=d[a]),null!=p){c=a;const t=i[n],r=l[n],d=r&o.TYPE_MASK,h=u[n],g=8*t|(0,s.typeToEncType)(r);if(r&o.FLAGS.PACKED){if(p.length>0){e.writeVarInt(g);(0,_[d])(e,p,h)}}else if(r&o.FLAGS.REPEATED)for(let t=0;t<p.length;t++){e.writeVarInt(g);(0,f[d])(e,p[t],h)}else{e.writeVarInt(g);(0,f[d])(e,p,h)}}}}},917793:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_TYPE=void 0,t.castToPreKeyId=f,t.castToSerializedPubKey=_,t.deserializePreKey=function(e){try{const{id:t,publicKey:n,privateKey:r}=(0,o.decodeProtobuf)(i.PreKeyRecordStructureSpec,e);return null==t||null==n||null==r?null:{id:f(t),keyPair:u((0,a.toBytes)(r,32),_(new Uint8Array(n)))}}catch(e){return null}},t.ecdh=function(e,t){return(0,r.scalarMult)(e,t.subarray(1)).buffer},t.makeKeyPair=c,t.makeKeyPairFrom=function(e){const{publicKey:t,secretKey:n}=(0,r.keypairFromSecretKey)(e);return l((0,a.ensureSize)(t,32),(0,a.ensureSize)(n,32))},t.makeKeyPairFromArrayBuffers=function(e,t){return{publicKey:(0,a.toBytes)(e,32),privateKey:(0,a.toBytes)(t,32)}},t.makeKeyPairFromSerialized=u,t.makePreKeys=function(e,t){let n=(e-1)%s;n<=0&&(n+=s);const r=[];for(let e=0;e<t;e++){const e=n===s?1:n+1,t=c(),o=(0,a.encodeSignalProto)(i.PreKeyRecordStructureSpec,{id:e,publicKey:p(t),privateKey:t.privateKey});r.push({plainObject:{id:e,keyPair:t},record:o}),n=e}return r},t.makeRawSenderKey=function(){const e=(0,a.makeBytes)(32);return self.crypto.getRandomValues(e),e},t.makeSerializedKeyPair=function(){const e=c();return d(e.privateKey,p(e))},t.makeSerializedKeyPairFrom=d,t.serializeIdentity=function(e){const t=(0,a.makeBytes)(33);return t[0]=5,t.set((0,a.ensureSize)(e,32),1),t},t.serializePubKey=p,t.toSerializedKeyPair=function(e){return d(e.privateKey,p(e))};var r=n(463482),i=n(893638),a=n(427764),o=n(484902);t.KEY_TYPE=5;const s=16777215;function l(e,t){return{publicKey:e,privateKey:t}}function c(){const{publicKey:e,secretKey:t}=(0,r.keyPair)();return t[0]&=248,t[31]=64|63&t[31],l((0,a.ensureSize)(e,32),(0,a.ensureSize)(t,32))}function u(e,t){return l((0,a.sliceBytes)(t,1,32),e)}function d(e,t){return{serializedPubKey:t,privateKey:e}}function p(e){const t=(0,a.makeBytes)(33);return t[0]=5,t.set(e.publicKey,1),t}function f(e){return(0,a.ensureIntInRange)(e,1,s)}function _(e){if(0===e.length||5!==e[0])throw new Error("Unrecognized public key type");return(0,a.ensureSize)(e,33)}},427764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HMAC_SHA256=t.AES_CBC=void 0,t.areSessionHashesEqual=function(e,t){return(0,i.arrayBuffersEqual)(e,t)},t.castRegistrationId=function(e){return u(e)},t.castSenderKeyId=function(e){return u(e)},t.castToByteEncoded=function(e){return e},t.castToSessionHash=function(e){return e},t.decodeSignalProto=function(e,t,n){return n((0,a.decodeProtobuf)(e,t))},t.encodeSignalProto=function(e,t){return(0,o.encodeProtobuf)(e,t).readByteArray()},t.ensureIntInRange=u,t.ensureSize=c,t.hkdf=function(e,t,n,i){return(0,r.extractWithSaltAndExpand)(e,t,n,i).then((e=>new Uint8Array(e)))},t.makeBytes=function(e){return new Uint8Array(e)},t.makeCryptoKey=function(e,t){let n,r;"hmac-sha256"===t?(n=l,r=["sign"]):(n=s,r=["encrypt","decrypt"]);return self.crypto.subtle.importKey("raw",e,n,!1,r)},t.makeRegistrationId=function(e){const t="extendedRange"===e?2147483646:16380;return(0,i.randomNumberLessThan)(t)+1},t.makeSenderKeyId=function(){return(0,i.randomNumberLessThan)(-1>>>1)+1},t.readBytes=function(e,t){return e.readByteArray(t)},t.sliceBytes=function(e,t,n){if(e.length-t<n)throw new Error(`Can not split off ${n} bytes from index ${t} of ${e.length} bytes`);return e.slice(t,t+n)},t.toBuffer=function(e){const t=e.buffer,n=e.byteOffset,r=e.length;return 0===n&&r===t.byteLength?t:t.slice(n,n+r)},t.toBytes=function(e,t){return c(new Uint8Array(e),t)};var r=n(181576),i=n(607589),a=n(484902),o=n(760980);const s={name:"AES-CBC"};t.AES_CBC=s;const l={name:"HMAC",hash:"SHA-256"};function c(e,t){if(e.length!==t)throw new Error(`Signal expected ${t} bytes, given ${e.length}`);return e}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967296;if("number"==typeof e&&t<=e&&e<n&&Math.floor(e)===e)return e;throw new Error(`Expected integer in range [${t}, ${n}), given ${String(e)}`)}t.HMAC_SHA256=l},893638:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignedPreKeyRecordStructureSpec=t.SessionStructureSpec=t.SenderSigningKeySpec=t.SenderMessageKeySpec=t.SenderKeyStateStructureSpec=t.SenderKeyRecordStructureSpec=t.SenderChainKeySpec=t.RecordStructureSpec=t.PreKeyRecordStructureSpec=t.PendingPreKeySpec=t.PendingKeyExchangeSpec=t.MessageKeySpec=t.IdentityKeyPairStructureSpec=t.ChainSpec=t.ChainKeySpec=void 0;var r=n(401390);const i={};t.SessionStructureSpec=i;const a={};t.PendingPreKeySpec=a;const o={};t.PendingKeyExchangeSpec=o;const s={};t.ChainSpec=s;const l={};t.MessageKeySpec=l;const c={};t.ChainKeySpec=c;const u={};t.RecordStructureSpec=u;const d={};t.PreKeyRecordStructureSpec=d;const p={};t.SignedPreKeyRecordStructureSpec=p;const f={};t.IdentityKeyPairStructureSpec=f;const _={};t.SenderKeyStateStructureSpec=_;const h={};t.SenderSigningKeySpec=h;const g={};t.SenderMessageKeySpec=g;const m={};t.SenderChainKeySpec=m;const y={};t.SenderKeyRecordStructureSpec=y,i.internalSpec={sessionVersion:[1,r.TYPES.UINT32],localIdentityPublic:[2,r.TYPES.BYTES],remoteIdentityPublic:[3,r.TYPES.BYTES],rootKey:[4,r.TYPES.BYTES],previousCounter:[5,r.TYPES.UINT32],senderChain:[6,r.TYPES.MESSAGE,s],receiverChains:[7,r.FLAGS.REPEATED|r.TYPES.MESSAGE,s],pendingKeyExchange:[8,r.TYPES.MESSAGE,o],pendingPreKey:[9,r.TYPES.MESSAGE,a],remoteRegistrationId:[10,r.TYPES.UINT32],localRegistrationId:[11,r.TYPES.UINT32],needsRefresh:[12,r.TYPES.BOOL],aliceBaseKey:[13,r.TYPES.BYTES]},a.internalSpec={preKeyId:[1,r.TYPES.UINT32],signedPreKeyId:[3,r.TYPES.INT32],baseKey:[2,r.TYPES.BYTES]},o.internalSpec={sequence:[1,r.TYPES.UINT32],localBaseKey:[2,r.TYPES.BYTES],localBaseKeyPrivate:[3,r.TYPES.BYTES],localRatchetKey:[4,r.TYPES.BYTES],localRatchetKeyPrivate:[5,r.TYPES.BYTES],localIdentityKey:[7,r.TYPES.BYTES],localIdentityKeyPrivate:[8,r.TYPES.BYTES]},s.internalSpec={senderRatchetKey:[1,r.TYPES.BYTES],senderRatchetKeyPrivate:[2,r.TYPES.BYTES],chainKey:[3,r.TYPES.MESSAGE,c],messageKeys:[4,r.FLAGS.REPEATED|r.TYPES.MESSAGE,l]},l.internalSpec={index:[1,r.TYPES.UINT32],cipherKey:[2,r.TYPES.BYTES],macKey:[3,r.TYPES.BYTES],iv:[4,r.TYPES.BYTES]},c.internalSpec={index:[1,r.TYPES.UINT32],key:[2,r.TYPES.BYTES]},u.internalSpec={currentSession:[1,r.TYPES.MESSAGE,i],previousSessions:[2,r.FLAGS.REPEATED|r.TYPES.MESSAGE,i]},d.internalSpec={id:[1,r.TYPES.UINT32],publicKey:[2,r.TYPES.BYTES],privateKey:[3,r.TYPES.BYTES]},p.internalSpec={id:[1,r.TYPES.UINT32],publicKey:[2,r.TYPES.BYTES],privateKey:[3,r.TYPES.BYTES],signature:[4,r.TYPES.BYTES],timestamp:[5,r.TYPES.FIXED64]},f.internalSpec={publicKey:[1,r.TYPES.BYTES],privateKey:[2,r.TYPES.BYTES]},_.internalSpec={senderKeyId:[1,r.TYPES.UINT32],senderChainKey:[2,r.TYPES.MESSAGE,m],senderSigningKey:[3,r.TYPES.MESSAGE,h],senderMessageKeys:[4,r.FLAGS.REPEATED|r.TYPES.MESSAGE,g]},h.internalSpec={public:[1,r.TYPES.BYTES],private:[2,r.TYPES.BYTES]},g.internalSpec={iteration:[1,r.TYPES.UINT32],seed:[2,r.TYPES.BYTES]},m.internalSpec={iteration:[1,r.TYPES.UINT32],seed:[2,r.TYPES.BYTES]},y.internalSpec={senderKeyStates:[1,r.FLAGS.REPEATED|r.TYPES.MESSAGE,_]}},27467:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.sendGetExperimentConfigRPC=function(){return p.apply(this,arguments)};var i=r(n(311504)),a=n(736184),o=n(735905),s=n(427999),l=n(304276),c=n(43034),u=n(775305),d=n(766162);function p(){return(p=(0,i.default)((function*(e){const t=(0,c.makeGetExperimentConfigRequest)(e),n=yield(0,a.sendSmaxIq)(t),r=(0,l.parseGetExperimentConfigResponseSuccess)(n,t);if(r.success)return{name:"GetExperimentConfigResponseSuccess",value:r.value};const i=(0,o.parseGetExperimentConfigResponseErrorNoRetry)(n,t);if(i.success)return{name:"GetExperimentConfigResponseErrorNoRetry",value:i.value};const p=(0,s.parseGetExperimentConfigResponseErrorRetry)(n,t);if(p.success)return{name:"GetExperimentConfigResponseErrorRetry",value:p.value};throw new u.SmaxParsingFailure((0,d.errorMessageRpcParsing)("GetExperimentConfig",{Success:r,ErrorNoRetry:i,ErrorRetry:p}))}))).apply(this,arguments)}},625083:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseExperimentConfigMixin=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const n=(0,i.attrIntRange)(e,"config_code",1,void 0);if(!n.success)return n;const a=(0,i.attrString)(e,"config_value");if(!a.success)return a;const o=(0,i.optional)(i.attrIntRange,e,"config_expo_key",0,void 0);if(!o.success)return o;return(0,r.makeResult)({configCode:n.value,configValue:a.value,configExpoKey:o.value})};var r=n(287040),i=n(308790)},394445:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseExperimentOrSamplingConfigMixinGroup=function(e){const t=(0,i.parseExperimentConfigMixin)(e);if(t.success)return(0,r.makeResult)({name:"ExperimentConfig",value:t.value});const n=(0,a.parseSamplingConfigMixin)(e);if(n.success)return(0,r.makeResult)({name:"SamplingConfig",value:n.value});return(0,o.errorMixinDisjunction)(e,["ExperimentConfig","SamplingConfig"],[t,n])};var r=n(287040),i=n(625083),a=n(17329),o=n(308790)},735905:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseErrorNoRetry=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const s=(0,o.flattenedChildWithTag)(e,"error");if(!s.success)return s;const l=(0,a.parseIQErrorResponseMixin)(e,t);if(!l.success)return l;const c=(0,i.parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup)(s.value);if(!c.success)return c;return(0,r.makeResult)({iQErrorResponseMixin:l.value,errorIQErrorBadRequestOrFeatureNotImplementedMixinGroup:c.value})};var r=n(287040),i=n(776223),a=n(742606),o=n(308790)},427999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseErrorRetry=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const s=(0,o.flattenedChildWithTag)(e,"error");if(!s.success)return s;const l=(0,i.parseIQErrorInternalServerErrorMixin)(s.value);if(!l.success)return l;const c=(0,a.parseIQErrorResponseMixin)(e,t);if(!c.success)return c;return(0,r.makeResult)({errorIQErrorInternalServerErrorMixin:l.value,iQErrorResponseMixin:c.value})};var r=n(287040),i=n(249336),a=n(742606),o=n(308790)},304276:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseGetExperimentConfigResponseSuccess=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const i=(0,o.flattenedChildWithTag)(e,"props");if(!i.success)return i;const l=(0,o.literal)(o.attrString,i.value,"protocol","1");if(!l.success)return l;const c=(0,o.optional)(o.attrString,i.value,"ab_key");if(!c.success)return c;const u=(0,o.optional)(o.attrString,i.value,"hash");if(!u.success)return u;const d=(0,o.optional)(o.attrIntRange,i.value,"refresh",0,void 0);if(!d.success)return d;const p=(0,o.optional)(o.attrIntRange,i.value,"refresh_id",0,void 0);if(!p.success)return p;const f=(0,a.parseIQResultResponseMixin)(e,t);if(!f.success)return f;const _=(0,o.mapChildrenWithTag)(i.value,"prop",0,1/0,s);if(!_.success)return _;return(0,r.makeResult)({propsProtocol:l.value,propsAbKey:c.value,propsHash:u.value,propsRefresh:d.value,propsRefreshId:p.value,iQResultResponseMixin:f.value,propsProp:_.value})},t.parseGetExperimentConfigResponseSuccessPropsProp=s;var r=n(287040),i=n(394445),a=n(818568),o=n(308790);function s(e){const t=(0,o.assertTag)(e,"prop");if(!t.success)return t;const n=(0,i.parseExperimentOrSamplingConfigMixinGroup)(e);return n.success?(0,r.makeResult)({experimentOrSamplingConfigMixinGroup:n.value}):n}},592523:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorBadRequestMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.literal)(i.attrString,e,"text","bad-request");if(!n.success)return n;const a=(0,i.literal)(i.attrString,e,"code","400");if(!a.success)return a;return(0,r.makeResult)({text:n.value,code:a.value})};var r=n(287040),i=n(308790)},776223:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorBadRequestOrFeatureNotImplementedMixinGroup=function(e){const t=(0,i.parseIQErrorBadRequestMixin)(e);if(t.success)return(0,r.makeResult)({name:"IQErrorBadRequest",value:t.value});const n=(0,a.parseIQErrorFeatureNotImplementedMixin)(e);if(n.success)return(0,r.makeResult)({name:"IQErrorFeatureNotImplemented",value:n.value});return(0,o.errorMixinDisjunction)(e,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[t,n])};var r=n(287040),i=n(592523),a=n(406965),o=n(308790)},406965:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorFeatureNotImplementedMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.literal)(i.attrString,e,"text","feature-not-implemented");if(!n.success)return n;const a=(0,i.literal)(i.attrString,e,"code","501");if(!a.success)return a;return(0,r.makeResult)({text:n.value,code:a.value})};var r=n(287040),i=n(308790)},249336:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorInternalServerErrorMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.literal)(i.attrString,e,"text","internal-server-error");if(!n.success)return n;const a=(0,i.literal)(i.attrString,e,"code","500");if(!a.success)return a;return(0,r.makeResult)({text:n.value,code:a.value})};var r=n(287040),i=n(308790)},742606:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorResponseMixin=function(e,t){const n=(0,a.assertTag)(e,"iq");if(!n.success)return n;const o=(0,i.attrStringFromReference)(t,["id"]);if(!o.success)return o;const s=(0,a.literal)(a.attrString,e,"id",o.value);if(!s.success)return s;const l=(0,i.attrStringFromReference)(t,["to"]);if(!l.success)return l;const c=(0,a.literal)(a.attrString,e,"from",l.value);if(!c.success)return c;const u=(0,a.literal)(a.attrString,e,"type","error");if(!u.success)return u;return(0,r.makeResult)({type:u.value})};var r=n(287040),i=n(387794),a=n(308790)},818568:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQResultResponseMixin=function(e,t){const n=(0,a.assertTag)(e,"iq");if(!n.success)return n;const o=(0,i.attrStringFromReference)(t,["id"]);if(!o.success)return o;const s=(0,a.literal)(a.attrString,e,"id",o.value);if(!s.success)return s;const l=(0,i.attrStringFromReference)(t,["to"]);if(!l.success)return l;const c=(0,a.literal)(a.attrString,e,"from",l.value);if(!c.success)return c;const u=(0,a.literal)(a.attrString,e,"type","result");if(!u.success)return u;return(0,r.makeResult)({type:u.value})};var r=n(287040),i=n(387794),a=n(308790)},17329:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSamplingConfigMixin=function(e){const t=(0,i.assertTag)(e,"prop");if(!t.success)return t;const n=(0,i.attrIntRange)(e,"event_code",1,void 0);if(!n.success)return n;const a=(0,i.attrIntRange)(e,"sampling_weight",-1e4,1e4);if(!a.success)return a;return(0,r.makeResult)({eventCode:n.value,samplingWeight:a.value})};var r=n(287040),i=n(308790)},648347:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBaseIQGetRequestMixin=function(e){const t=(0,r.smax)("iq",{id:(0,a.generateId)(),type:"get"});return(0,i.mergeStanzas)(e,t)};var r=n(432609),i=n(905128),a=n(831914)},43034:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetExperimentConfigRequest=function(e){const{propsHash:t}=e;return(0,a.mergeBaseIQGetRequestMixin)((0,i.smax)("iq",{xmlns:"abt",to:o.S_WHATSAPP_NET},(0,i.smax)("props",{protocol:"1",hash:(0,r.OPTIONAL)(o.CUSTOM_STRING,t)})))};var r=n(915322),i=n(432609),a=n(648347),o=n(831914)},695856:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.sendActiveIQRPC=function(){return u.apply(this,arguments)};var i=r(n(311504)),a=n(736184),o=n(261737),s=n(361738),l=n(775305),c=n(766162);function u(){return(u=(0,i.default)((function*(){const e=(0,s.makeActiveIQRequest)(),t=yield(0,a.sendSmaxIq)(e),n=(0,o.parseActiveIQResponseSuccess)(t,e);if(n.success)return{name:"ActiveIQResponseSuccess",value:n.value};throw new l.SmaxParsingFailure((0,c.errorMessageRpcParsing)("ActiveIQ",{Success:n}))}))).apply(this,arguments)}},198390:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.sendPassiveIQRPC=function(){return u.apply(this,arguments)};var i=r(n(311504)),a=n(736184),o=n(289215),s=n(422282),l=n(775305),c=n(766162);function u(){return(u=(0,i.default)((function*(){const e=(0,s.makePassiveIQRequest)(),t=yield(0,a.sendSmaxIq)(e),n=(0,o.parsePassiveIQResponseSuccess)(t,e);if(n.success)return{name:"PassiveIQResponseSuccess",value:n.value};throw new l.SmaxParsingFailure((0,c.errorMessageRpcParsing)("PassiveIQ",{Success:n}))}))).apply(this,arguments)}},261737:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseActiveIQResponseSuccess=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const s=(0,o.flattenedChildWithTag)(e,"active");if(!s.success)return s;const l=(0,a.attrStringFromReference)(t,["id"]);if(!l.success)return l;const c=(0,o.literal)(o.attrString,e,"id",l.value);if(!c.success)return c;const u=(0,o.literal)(o.attrString,e,"type","result");if(!u.success)return u;const d=(0,i.literalJid)(i.attrDomainJid,e,"from","s.whatsapp.net");if(!d.success)return d;return(0,r.makeResult)({type:u.value,from:d.value})};var r=n(287040),i=n(876780),a=n(387794),o=n(308790)},289215:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parsePassiveIQResponseSuccess=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const s=(0,o.flattenedChildWithTag)(e,"passive");if(!s.success)return s;const l=(0,a.attrStringFromReference)(t,["id"]);if(!l.success)return l;const c=(0,o.literal)(o.attrString,e,"id",l.value);if(!c.success)return c;const u=(0,o.literal)(o.attrString,e,"type","result");if(!u.success)return u;const d=(0,i.literalJid)(i.attrDomainJid,e,"from","s.whatsapp.net");if(!d.success)return d;return(0,r.makeResult)({type:u.value,from:d.value})};var r=n(287040),i=n(876780),a=n(387794),o=n(308790)},361738:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeActiveIQRequest=function(){return(0,r.smax)("iq",{id:(0,i.generateId)(),type:"set",xmlns:"passive",to:i.S_WHATSAPP_NET},(0,r.smax)("active",null))};var r=n(432609),i=n(831914)},422282:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makePassiveIQRequest=function(){return(0,r.smax)("iq",{id:(0,i.generateId)(),type:"set",xmlns:"passive",to:i.S_WHATSAPP_NET},(0,r.smax)("passive",null))};var r=n(432609),i=n(831914)},482443:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBaseIQGetRequestMixin=function(e){const t=(0,r.smax)("iq",{id:(0,a.generateId)(),type:"get"});return(0,i.mergeStanzas)(e,t)};var r=n(432609),i=n(905128),a=n(831914)},26262:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetV1Request=function(){return(0,i.mergeBaseIQGetRequestMixin)((0,r.smax)("iq",{to:a.S_WHATSAPP_NET,xmlns:"w"},(0,r.smax)("props",null)))};var r=n(432609),i=n(482443),a=n(831914)},8285:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.sendSendBufferRPC=function(){return p.apply(this,arguments)};var i=r(n(311504)),a=n(736184),o=n(279804),s=n(204939),l=n(660164),c=n(705209),u=n(775305),d=n(766162);function p(){return(p=(0,i.default)((function*(e){const t=(0,c.makeSendBufferRequest)(e),n=yield(0,a.sendSmaxIq)(t),r=(0,l.parseSendBufferResponseSuccess)(n,t);if(r.success)return{name:"SendBufferResponseSuccess",value:r.value};const i=(0,o.parseSendBufferResponseErrorNoRetry)(n,t);if(i.success)return{name:"SendBufferResponseErrorNoRetry",value:i.value};const p=(0,s.parseSendBufferResponseErrorRetry)(n,t);if(p.success)return{name:"SendBufferResponseErrorRetry",value:p.value};throw new u.SmaxParsingFailure((0,d.errorMessageRpcParsing)("SendBuffer",{Success:r,ErrorNoRetry:i,ErrorRetry:p}))}))).apply(this,arguments)}},410191:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorBadRequestMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.literal)(i.attrString,e,"text","bad-request");if(!n.success)return n;const a=(0,i.literal)(i.attrString,e,"code","400");if(!a.success)return a;return(0,r.makeResult)({text:n.value,code:a.value})};var r=n(287040),i=n(308790)},556234:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorBadRequestOrNotAcceptableOrFeatureNotImplementedMixinGroup=function(e){const t=(0,i.parseIQErrorBadRequestMixin)(e);if(t.success)return(0,r.makeResult)({name:"IQErrorBadRequest",value:t.value});const n=(0,o.parseIQErrorNotAcceptableMixin)(e);if(n.success)return(0,r.makeResult)({name:"IQErrorNotAcceptable",value:n.value});const l=(0,a.parseIQErrorFeatureNotImplementedMixin)(e);if(l.success)return(0,r.makeResult)({name:"IQErrorFeatureNotImplemented",value:l.value});return(0,s.errorMixinDisjunction)(e,["IQErrorBadRequest","IQErrorNotAcceptable","IQErrorFeatureNotImplemented"],[t,n,l])};var r=n(287040),i=n(410191),a=n(262076),o=n(24447),s=n(308790)},262076:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorFeatureNotImplementedMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.literal)(i.attrString,e,"text","feature-not-implemented");if(!n.success)return n;const a=(0,i.literal)(i.attrString,e,"code","501");if(!a.success)return a;return(0,r.makeResult)({text:n.value,code:a.value})};var r=n(287040),i=n(308790)},24447:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorNotAcceptableField=a,t.parseIQErrorNotAcceptableMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.optionalChildWithTag)(e,"field",a);if(!n.success)return n;const o=(0,i.literal)(i.attrString,e,"text","not-acceptable");if(!o.success)return o;const s=(0,i.literal)(i.attrString,e,"code","406");if(!s.success)return s;return(0,r.makeResult)({text:o.value,code:s.value,field:n.value})};var r=n(287040),i=n(308790);function a(e){const t=(0,i.assertTag)(e,"field");if(!t.success)return t;const n=(0,i.attrString)(e,"name");if(!n.success)return n;const a=(0,i.attrString)(e,"reason");return a.success?(0,r.makeResult)({name:n.value,reason:a.value}):a}},221697:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorResponseMixin=function(e,t){const n=(0,a.assertTag)(e,"iq");if(!n.success)return n;const o=(0,i.attrStringFromReference)(t,["id"]);if(!o.success)return o;const s=(0,a.literal)(a.attrString,e,"id",o.value);if(!s.success)return s;const l=(0,i.attrStringFromReference)(t,["to"]);if(!l.success)return l;const c=(0,a.literal)(a.attrString,e,"from",l.value);if(!c.success)return c;const u=(0,a.literal)(a.attrString,e,"type","error");if(!u.success)return u;return(0,r.makeResult)({type:u.value})};var r=n(287040),i=n(387794),a=n(308790)},928212:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQErrorServiceUnavailableMixin=function(e){const t=(0,i.assertTag)(e,"error");if(!t.success)return t;const n=(0,i.literal)(i.attrString,e,"text","service-unavailable");if(!n.success)return n;const a=(0,i.literal)(i.attrString,e,"code","503");if(!a.success)return a;return(0,r.makeResult)({text:n.value,code:a.value})};var r=n(287040),i=n(308790)},560004:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseIQResultResponseMixin=function(e,t){const n=(0,a.assertTag)(e,"iq");if(!n.success)return n;const o=(0,i.attrStringFromReference)(t,["id"]);if(!o.success)return o;const s=(0,a.literal)(a.attrString,e,"id",o.value);if(!s.success)return s;const l=(0,i.attrStringFromReference)(t,["to"]);if(!l.success)return l;const c=(0,a.literal)(a.attrString,e,"from",l.value);if(!c.success)return c;const u=(0,a.literal)(a.attrString,e,"type","result");if(!u.success)return u;return(0,r.makeResult)({type:u.value})};var r=n(287040),i=n(387794),a=n(308790)},279804:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSendBufferResponseErrorNoRetry=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const s=(0,o.flattenedChildWithTag)(e,"error");if(!s.success)return s;const l=(0,a.parseIQErrorResponseMixin)(e,t);if(!l.success)return l;const c=(0,i.parseIQErrorBadRequestOrNotAcceptableOrFeatureNotImplementedMixinGroup)(s.value);if(!c.success)return c;return(0,r.makeResult)({iQErrorResponseMixin:l.value,errorIQErrorBadRequestOrNotAcceptableOrFeatureNotImplementedMixinGroup:c.value})};var r=n(287040),i=n(556234),a=n(221697),o=n(308790)},204939:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSendBufferResponseErrorRetry=function(e,t){const n=(0,o.assertTag)(e,"iq");if(!n.success)return n;const s=(0,o.flattenedChildWithTag)(e,"error");if(!s.success)return s;const l=(0,a.parseIQErrorServiceUnavailableMixin)(s.value);if(!l.success)return l;const c=(0,i.parseIQErrorResponseMixin)(e,t);if(!c.success)return c;return(0,r.makeResult)({errorIQErrorServiceUnavailableMixin:l.value,iQErrorResponseMixin:c.value})};var r=n(287040),i=n(221697),a=n(928212),o=n(308790)},660164:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseSendBufferResponseSuccess=function(e,t){const n=(0,a.assertTag)(e,"iq");if(!n.success)return n;const o=(0,i.parseIQResultResponseMixin)(e,t);if(!o.success)return o;return(0,r.makeResult)({iQResultResponseMixin:o.value})};var r=n(287040),i=n(560004),a=n(308790)},350063:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBaseIQSetRequestMixin=function(e){const t=(0,r.smax)("iq",{id:(0,a.generateId)(),type:"set"});return(0,i.mergeStanzas)(e,t)};var r=n(432609),i=n(905128),a=n(831914)},807598:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeBufferMixin=function(e,t){const n=function(e){const{addElementValue:t}=e;return(0,r.smax)("add",null,t)}(t);return(0,i.mergeStanzas)(e,n)};var r=n(432609),i=n(905128)},705209:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeSendBufferRequest=function(e){const{addT:t,bufferMixinArgs:n}=e;return(0,i.mergeBaseIQSetRequestMixin)((0,r.smax)("iq",{xmlns:"w:stats",to:o.S_WHATSAPP_NET},(0,a.mergeBufferMixin)((0,r.smax)("add",{t:(0,o.INT)(t)}),n)))};var r=n(432609),i=n(350063),a=n(807598),o=n(831914)},876780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.attrBroadcastJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateBroadcastJid,"BroadcastJid")},t.attrCallJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateCallJid,"CallJid")},t.attrDeviceJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateDeviceJid,"DeviceJid")},t.attrDomainJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateDomainJid,"DomainJid")},t.attrGroupJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateGroupJid,"GroupJid")},t.attrJidEnum=function(e,t,n){const r=(0,a.attrString)(e,t);if(!r.success)return r;const{validators:o,typeName:s}=n;for(let e=0;e<o.length;e++){const t=o[e](r.value);if(null!=t)return(0,i.makeResult)(t)}return(0,a.errorMessage)(e,`to have "${t}"={${s}}, but instead has "${r.value}"`)},t.attrStatusJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateStatusJid,"StatusJid")},t.attrUserJid=function(e,t){return(0,a.attrValidate)(e,t,r.validateUserJid,"UserJid")},t.literalJid=function(e,t,n,r){const i=e(t,n);if(!i.success)return i;if(i.value===r)return i;return(0,a.errorMessage)(t,`to have "${n}"={${r}}, but instead has "${i.value}"`)},t.optionalLiteralJid=function(e,t,n,r){const i=(0,a.optional)(e,t,n);if(!i.success)return i;if(null==i.value||i.value===r)return i;return(0,a.errorMessage)(t,`to have "${n}"={${r}}, but instead has "${i.value}"`)};var r=n(252230),i=n(287040),a=n(308790)},387794:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.attrStringFromReference=s,t.contentStringFromReference=function(e,t){const n=l(e,t);if(!n.success)return c(n);const r=(0,o.contentString)(n.value);if(!r.success)return c(r);return r},t.optionalAttrStringFromReference=function(e,t){return function(e,t){const n=l(e,t);return n.success&&(0,i.default)(n.value.attrs,t[t.length-1])}(e,t)?s(e,t):o.voidSuccess};var i=r(n(133344)),a=n(287040),o=n(308790);function s(e,t){const n=l(e,t);if(!n.success)return c(n);const r=(0,o.attrString)(n.value,t[t.length-1]);return r.success?r:c(r)}function l(e,t){const n=t.length;let r=e;for(let e=0;e<n-1;e++){const n=t[e],i=(0,o.flattenedChildWithTag)(r,n);if(!i.success)return i;r=i.value}return(0,a.makeResult)(r)}function c(e){return(0,a.makeError)(`in the reference, ${e.error}`)}},308790:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.assertAttr=function(e,t,n){const r=d(e,t);if(!r.success)return r;if(r.value!==n)return E(e,`to have "${t}"="${n}", but instead has "${r.value}"`);return u},t.assertTag=function(e,t){if(e.tag!==t)return E(e,`to be <${t}>`);return u},t.attrInt=_,t.attrIntRange=function(e,t,n,r){const i=_(e,t);if(!i.success)return i;const a=i.value;if(void 0!==n&&a<n)return E(e,`to have "${t}"={at least ${n}} but has value ${a}`);if(void 0!==r&&a>r)return E(e,`to have "${t}"={at most ${r}} but has value ${a}`);return(0,l.makeResult)(a)},t.attrString=d,t.attrStringEnum=function(e,t,n){const r=d(e,t);if(!r.success)return r;const i=n[r.value];if(null!=i)return(0,l.makeResult)(i);const a=Object.values(n).join("|");return E(e,`to have "${t}"={${a}}, but instead has "${r.value}"`)},t.attrValidate=p,t.childWithTag=function(e,t,n){const r=g(e,t,n);if(!r.success)return r;const i=r.value;if(null==i)return E(e,`to have 1 child <${t}>, but found 0`);return(0,l.makeResult)(i)},t.contentBytes=S,t.contentBytesRange=function(e,t,n){const r=S(e);if(!r.success)return r;const i=r.value.length;if(void 0!==t&&i<t)return E(e,`to have binary content at least ${t} bytes but has ${i} bytes`);if(void 0!==n&&i>n)return E(e,`to have binary content at most ${n} bytes but has ${i} bytes`);return(0,l.makeResult)(r.value)},t.contentInt=function(e){return f(e,T,"integer")},t.contentLiteralBytes=function(e,t){const n=S(e);if(!n.success)return n;if((0,o.uint8ArraysEqual)(n.value,t))return(0,l.makeResult)(t);return E(e,`to have content ":binary:${(0,i.encodeB64)(t)}", but instead has ":binary:${(0,i.encodeB64)(n.value)}"`)},t.contentString=y,t.contentStringEnum=function(e,t){const n=y(e);if(!n.success)return n;const r=t[n.value];if(null!=r)return(0,l.makeResult)(r);const i=Object.values(t).join("|");return E(e,`to have content "${i}", but instead has "${n.value}"`)},t.contentValidate=f,t.countChildrenWithTag=function(e,t,n,r,i){const a=A(e,t,n,r);if(!a.success)return a;const o=a.value.length;for(let e=0;e<o;e++){const t=i(a.value[e]);if(!t.success)return t}return(0,l.makeResult)(o)},t.emptyObject=void 0,t.errorMessage=E,t.errorMixinDisjunction=function(e,t,n){const r=t.map(((e,t)=>`${e}: ${n[t].error}`));return E(e,[`to match any of following mixins: ${t.join(", ")}, but all mixins failed.`,...r].join(" "))},t.flattenedChildWithTag=function(e,t){const n=h(e,t);if(!n.success)return n;if(null==n.value)return E(e,`to have 1 child <${t}>, but found 0`);return(0,l.makeResult)(n.value)},t.identity=function(e){return e},t.literal=function(e,t,n,r){const i=e(t,n);if(!i.success)return i;if(i.value===r)return(0,l.makeResult)(r);return E(t,`to have "${n}"={${r}}, but instead has "${i.value}"`)},t.literalContent=function(e,t,n){const r=e(t);if(!r.success)return r;if(r.value===n)return(0,l.makeResult)(n);return E(t,`to have content "${n}", but instead has "${r.value}"`)},t.mapChildrenWithTag=function(e,t,n,r,i){const a=A(e,t,n,r);if(!a.success)return a;const o=[];for(let e=0;e<a.value.length;e++){const t=i(a.value[e]);if(!t.success)return t;o.push(t.value)}return(0,l.makeResult)(o)},t.optional=m,t.optionalChild=h,t.optionalChildWithTag=g,t.optionalLiteral=function(e,t,n,r){if(null==r)return u;const i=m(e,t,n);if(!i.success)return i;if(i.value===r)return(0,l.makeResult)(r);if(null==i.value)return u;return E(t,`to have "${n}"={${r}}, but instead has "${i.value}"`)},t.voidSuccess=void 0;var i=n(615688),a=n(108584),o=n(607589),s=r(n(133344)),l=n(287040),c=n(245506);const u=(0,l.makeResult)();function d(e,t){return v(e,t)?function(e,t){if(t instanceof c.WapJid)return(0,l.makeResult)(t.toString());if("string"==typeof t)return(0,l.makeResult)(t);return E(e,`decodeAsString: attribute is ${typeof t} not a string: ${String(t)}`)}(e,e.attrs[t]):E(e,`to have attribute "${t}"`)}function p(e,t,n,r){const i=d(e,t);if(!i.success)return i;const a=n(i.value);return null!=a?(0,l.makeResult)(a):E(e,`to have "${t}"={${r}}, but instead has "${i.value}"`)}function f(e,t,n){const r=y(e);if(!r.success)return r;const i=t(r.value);return null!=i?(0,l.makeResult)(i):E(e,`to have ${n} content, but instead has "${r.value}"`)}function _(e,t){return p(e,t,T,"integer")}function h(e,t){const n=C(e);if(!n.success)return n;const r=n.value;if(null==r)return u;let i=null;for(let n=0;n<r.length;n++){const a=r[n];if(a.tag===t){if(null!=i)return E(e,`to have 1 child <${t}>, but found more than 1`);i=a}}return(0,l.makeResult)(i)}function g(e,t,n){const r=h(e,t);return r.success?null==r.value?u:n(r.value):r}function m(e,t,n,r,i){return v(t,n)?e(t,n,r,i):u}function y(e){const t=S(e);if(!t.success)return t;try{const e=new a.Binary(t.value),n=e.readString(e.size());return(0,l.makeResult)(n)}catch(t){return E(e,`to have string content, but run into decoding error: ${t.message}`)}}function S(e){const{content:t}=e;return null==t?E(e,"to have content"):Array.isArray(t)?E(e,"to have content, but has children instead"):(0,l.makeResult)(t)}function E(e,t){return(0,l.makeError)(`expected <${e.tag}>: ${t}`)}function v(e,t){return(0,s.default)(e.attrs,t)}function T(e){const t=parseInt(e,10);return Number.isNaN(t)?null:t}function C(e){const t=e.content;return t instanceof Uint8Array?E(e,"to have children"):(0,l.makeResult)(t)}function A(e,t,n,r){const i=C(e);if(!i.success)return i;const a=i.value;if(null==a)return 0!==n?E(e,`to have at least ${n} <${t}> children, but found 0`):(0,l.makeResult)([]);const o=[];for(let e=0;e<a.length;e++){const n=a[e];n.tag===t&&o.push(n)}const s=o.length;return s<n?E(e,`to have at least ${n} <${t}> children, but found ${s}`):s>r?E(e,`to have at most ${r} <${t}> children, but found ${s}`):(0,l.makeResult)(o)}t.voidSuccess=u;t.emptyObject={}},915322:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OPTIONAL=function(e,t){return null==t?r.DROP_ATTR:e(t)},t.OPTIONAL_LITERAL=function(e,t){return t?e:r.DROP_ATTR};var r=n(831914)},432609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.smax=void 0;const r=n(831914).wap;t.smax=r},905128:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeStanzas=o,t.optionalMerge=function(e,t,n,r){if(null!=n)return e(t,n,r);return t};var r=n(676100),i=n(245506);const a="smax$any";function o(e,t){return function(e,t){const n=e.tag,r=t.tag;if(r===a)return;if(n!==r)throw new Error(`tag mismatch: ${n} != ${r}`)}(e,t),function(e,t){const n=e.attrs,r=t.attrs;Object.keys(r).forEach((e=>{const t=r[e],a=n[e];if(null!=t&&null!=a){if(function(e,t){if("string"==typeof e&&"string"==typeof t)return e===t;if(e instanceof i.WapJid&&t instanceof i.WapJid)return e.toString()===t.toString();return!1}(t,a))return;throw new Error(`conflict for key: ${e}`)}n[e]=t}))}(e,t),t.content instanceof Uint8Array?function(e,t){const n=e.content;if(n instanceof Uint8Array){if(!(0,r.uint8ArraysEqualUNSAFE)(n,t))throw new Error("elementValue mismatch: bytes dose not equal");return}if(null!=n)throw new Error("elementValue mismatch: destination has children");e.content=t}(e,t.content):null!=t.content&&function(e,t){const n=e.content;if(n instanceof Uint8Array)throw new Error("children mismatch: destination has element value");if(null==n||0===n.length)return void(e.content=t);if(!function(e,t){const n=s(t),r=s(e),i=Object.keys(n);for(let e=0;e<i.length;e++){const t=i[e],a=n[t],o=r[t];if(null!=a&&null!=o&&a!==o)return!1}return!0}(n,t))throw new Error("children mismatch: child counts are not compatible");const r=[],i=Array.from(n);t.forEach((e=>{const t=i.findIndex((t=>t.tag===e.tag));if(-1===t)r.push(e);else{const n=o(i.splice(t,1)[0],e);r.push(n)}})),i.forEach((e=>r.push(e))),e.content=r}(e,t.content),e}function s(e){return e.reduce(((e,t)=>{const n=t.tag,r=e[n];return e[n]=null==r?1:r+1,e}),{})}},775305:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SmaxParsingFailure=void 0;class n extends Error{constructor(){super(...arguments),this.name="SmaxParsingFailure"}}t.SmaxParsingFailure=n},766162:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorMessageRpcParsing=function(e,t){const n=Object.keys(t).map((e=>`Tried <response name="${e}">, but failed with ${t[e].error}.`)).join(" ");return`Failed to parse the response of <rpc name="${e}">. ${n}`}},676100:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferMod=function(e,t){const n=new Uint8Array(e);if(t>8388607)throw new Error("Divisor is too big");let r=0;for(let e=0;e<n.length;++e)r=((r<<8)+n[e])%t;return r},t.arrayBufferToString=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},t.arrayBuffersEqualUNSAFE=function(e,t){const r=new Uint8Array(e),i=new Uint8Array(t);return n(r,i)},t.concatBuffers=function(e){const t=e.map((e=>new Uint8Array(e))),n=t.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(n);return t.reduce(((e,t)=>(r.set(t,e),e+t.byteLength)),0),r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)},t.largeStringToArrayBuffer=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e5;return new Promise((n=>{const r=e.length,i=new ArrayBuffer(r),a=new Uint8Array(i);let o=0;requestAnimationFrame((function s(){const l=Math.min(o+t,r);for(;o<l;)a[o]=e.charCodeAt(o),o++;if(o===r)return void n(i);requestAnimationFrame(s)}))}))},t.stringToArrayBuffer=function(e){const t=new ArrayBuffer(e.length),n=new Uint8Array(t);let r,i;for(r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return n.buffer},t.uint8ArraysEqualUNSAFE=n;function n(e,t){if(e.byteLength!==t.byteLength)return!1;for(let n=0;n!==e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}},147151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeIndexWithoutPreservingOrder=function(e,t){const n=e.pop();t<e.length&&(e[t]=n)}},184973:e=>{e.exports=function(e){throw new Error(`Impossible value, the default statement should never be reached for value: ${e}`)}},180284:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expBackoff=i,t.expDelaySec=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return(0,r.delayMs)(Math.floor(1e3*i(e,t,n,a)))};var r=n(413959);function i(e,t,n){let r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1;return r=0===e?n||0:2**e,Number.isFinite(t)&&r>t&&(r=t),"number"==typeof n&&Number.isFinite(n)&&r<n&&(r=n),i&&(r*=1+i*Math.random()),r}},615688:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BASE64_DATA_URL_SCHEME=void 0,t.decodeB64=function(e){const t=a(e,43,47,61);if(t)return t.buffer;throw new Error("Base64.decode given invalid string")},t.decodeB64ToJsArray=function(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):a(e,43,47,61);return t&&Array.from(t)},t.decodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=a(e,45,95,t?61:-1);if(n)return n.buffer;throw new Error("Base64.decode given invalid string")},t.encodeB64=function(e){return r(e,43,47,!0)},t.encodeB64UrlSafe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r(e,45,95,t)},t.sizeWhenB64Decoded=function(e){return Math.floor(3*e.length/4)};const n=3e3;function r(e,t,r,a){const o=Array.isArray(e)||e instanceof ArrayBuffer?new Uint8Array(e):e;if(o.length<=n)return i(o,t,r,a);{const e=[];for(let s=0;s<o.length;s+=n)e.push(i(o.subarray(s,s+n),t,r,a));return e.join("")}}function i(e,t,n,r){const i=Math.ceil(4*e.length/3),a=4*Math.ceil(e.length/3),o=new Array(a);for(let t=0,n=0;t<a;t+=4,n+=3){const r=e[n]<<16|e[n+1]<<8|e[n+2];o[t]=r>>18,o[t+1]=r>>12&63,o[t+2]=r>>6&63,o[t+3]=63&r}for(let e=0;e<i;e++){const r=o[e];o[e]=r<26?65+r:r<52?71+r:r<62?r-4:62===r?t:n}for(let e=i;e<a;e++)o[e]=61;const s=String.fromCharCode.apply(String,o);return r?s:s.substring(0,i)}function a(e,t,n,r){let i=e.length;const a=new Int32Array(i+i%4);for(let o=0;o<i;o++){const s=e.charCodeAt(o);if(65<=s&&s<=90)a[o]=s-65;else if(97<=s&&s<=122)a[o]=s-71;else if(48<=s&&s<=57)a[o]=s+4;else if(s===t)a[o]=62;else{if(s!==n){if(s===r){i=o;break}return null!=self.ERROR&&__LOG__(4,void 0,new Error)`Found unexpected character code while decoding B64 at index ${o}, length ${i}: ${s}`,null}a[o]=63}}const o=a.length/4;for(let e=0,t=0;e<o;e++,t+=4)a[e]=a[t]<<18|a[t+1]<<12|a[t+2]<<6|a[t+3];const s=Math.floor(3*i/4),l=new Uint8Array(s);let c=0,u=0;for(;u+3<=s;c++,u+=3){const e=a[c];l[u]=e>>16,l[u+1]=e>>8&255,l[u+2]=255&e}switch(s-u){case 2:l[u]=a[c]>>16,l[u+1]=a[c]>>8&255;break;case 1:l[u]=a[c]>>16}return l}t.BASE64_DATA_URL_SCHEME="data:image/jpeg;base64,"},108584:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binary=void 0,t.longFitsInDouble=d,t.numUtf8Bytes=u,t.parseInt64OrThrow=K,t.parseUint64OrThrow=W;var r=n(787614);const i=65533,a=new Uint8Array(10),o=new Uint8Array(0);class s{constructor(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.write=function(){for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];"string"==typeof n?e.writeString(n):"number"==typeof n?e.writeUint8(n):n instanceof s?e.writeBinary(n):n instanceof ArrayBuffer?e.writeBuffer(n):n instanceof Uint8Array&&e.writeByteArray(n)}},t instanceof ArrayBuffer?(this._buffer=new Uint8Array(t),this._readEndIndex=this._writeIndex=t.byteLength):t instanceof Uint8Array&&(this._buffer=t,this._readEndIndex=this._writeIndex=t.length),this._bytesTrashed=0,this._earliestIndex=this._readIndex=0,this._view=null,this._littleEndian=n,this._hiddenReads=0,this._hiddenWrites=0}size(){return this._readEndIndex-this._readIndex}peek(e,t){this._hiddenReads++;const n=this._readIndex,r=this._bytesTrashed;try{return e(this,t)}finally{this._hiddenReads--,this._readIndex=n-(this._bytesTrashed-r)}}advance(e){this._shiftReadOrThrow(e)}readWithViewParser(e,t,n,r){return t(this._getView(),this._shiftReadOrThrow(e),e,n,r)}readWithBytesParser(e,t,n,r){return t(this._buffer,this._shiftReadOrThrow(e),e,n,r)}readUint8(){return p(this,1,_,!1)}readInt8(){return p(this,1,_,!0)}readUint16(){return p(this,2,h,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt32(){return p(this,4,g,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint32(){return p(this,4,m,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readInt64(){return p(this,8,y,K,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readUint64(){return p(this,8,y,W,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readLong(e){return p(this,8,y,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}readFloat32(){return p(this,4,S,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readFloat64(){return p(this,8,E,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._littleEndian)}readVarInt(e){const t=f(this,0,v,this.size());return f(this,t,T,e)}readBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new ArrayBuffer(0):f(this,e,C)}readByteArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size();return 0===e?new Uint8Array(0):f(this,e,A)}readBinary(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.size(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;if(0===e)return new s(void 0,t);const n=f(this,e,A);return new s(n,t)}indexOf(e){if(0===e.length)return 0;const t=this._buffer,n=this._readEndIndex,r=this._readIndex;let i=0,a=r;for(let o=r;o<n;o++)if(t[o]===e[i]){if(0===i&&(a=o),i++,i===e.byteLength)return o-r-e.byteLength+1}else i>0&&(i=0,o=a);return-1}readString(e){return f(this,e,b)}ensureCapacity(e){this._maybeReallocate(this._readIndex+e)}ensureAdditionalCapacity(e){this._maybeReallocate(this._writeIndex+e)}writeToView(e,t,n,r){const i=this._shiftWriteMaybeReallocate(e);return t(this._getView(),i,e,n,r)}writeToBytes(e,t,n,r){const i=this._shiftWriteMaybeReallocate(e);return t(this._buffer,i,e,n,r)}writeUint8(e){j(e,0,256,"uint8"),O(this,1,M,e,!1)}writeInt8(e){j(e,-128,128,"signed int8"),O(this,1,M,e,!0)}writeUint16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,0,65536,"uint16"),P(this,2,I,e,t)}writeInt16(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,-32768,32768,"signed int16"),P(this,2,w,e,t)}writeUint32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,0,4294967296,"uint32"),P(this,4,R,e,t)}writeInt32(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,-2147483648,2147483648,"signed int32"),P(this,4,N,e,t)}writeUint64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,0,0x10000000000000000,"uint64"),P(this,8,L,e,t)}writeInt64(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian;j(e,-0x8000000000000000,0x8000000000000000,"signed int64"),P(this,8,L,e,t)}writeFloat32(e){P(this,4,D,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeFloat64(e){P(this,8,k,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeVarInt(e){j(e,-0x8000000000000000,0x8000000000000000,"varint (signed int64)");const t=e<0,n=t?-e:e;let r=Math.floor(n/4294967296),i=n-4294967296*r;t&&(r=~r,0===i?r++:i=-i);O(this,F(r,i),U,r,i)}writeVarIntFromHexLong(e){const t=(0,r.hexLongIsNegative)(e),n=t?(0,r.negateHexLong)(e):e,i=(0,r.hexLongToHex)(n);let a=0,o=0;for(let e=0;e<r.NUM_HEX_IN_LONG;e++)a=a<<4|o>>>28,o=o<<4|(0,r.hexAt)(i,e);t&&(a=~a,0===o?a++:o=-o);O(this,F(a,o),U,a,o)}writeBinary(e){const t=e.peek((e=>e.readByteArray()));if(t.length){const e=this._shiftWriteMaybeReallocate(t.length);this._buffer.set(t,e)}}writeBuffer(e){this.writeByteArray(new Uint8Array(e))}writeByteArray(e){const t=this._shiftWriteMaybeReallocate(e.length);this._buffer.set(e,t)}writeBufferView(e){this.writeByteArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}writeString(e){O(this,u(e),G,e)}writeHexLong(e){P(this,8,x,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._littleEndian)}writeBytes(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let e=0;e<t.length;e++)j(t[e],0,256,"byte");O(this,t.length,B,t)}writeAtomically(e,t){this._hiddenWrites++;let n=this._writeIndex,r=this._bytesTrashed;try{const i=e(this,t);return n=this._writeIndex,r=this._bytesTrashed,i}finally{this._hiddenWrites--,this._writeIndex=n-(this._bytesTrashed-r)}}writeWithVarIntLength(e,t){const n=this._writeIndex,r=this.writeAtomically(e,t),i=this._writeIndex;this.writeVarInt(i-n);const o=this._writeIndex-i,s=this._buffer;for(let e=0;e<o;e++)a[e]=s[i+e];for(let e=i-1;e>=n;e--)s[e+o]=s[e];for(let e=0;e<o;e++)s[n+e]=a[e];return r}static build(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=0;for(let e=0;e<t.length;e++){const n=t[e];"string"==typeof n?r+=u(n):"number"==typeof n?r++:n instanceof s?r+=n.size():n instanceof ArrayBuffer?r+=n.byteLength:n instanceof Uint8Array&&(r+=n.length)}const i=new s;return i.ensureCapacity(r),i.write.apply(i,arguments),i}_getView(){return this._view||(this._view=new DataView(this._buffer.buffer,this._buffer.byteOffset))}_shiftReadOrThrow(e){if(e<0)throw new Error("ReadError: given negative number of bytes to read");const t=this._readIndex,n=t+e;if(n>this._readEndIndex)throw new Error(t===this._readEndIndex?"ReadError: tried to read from depleted binary":"ReadError: tried to read beyond end of binary");return this._readIndex=n,this._hiddenReads||(this._earliestIndex=n),t}_maybeReallocate(e){const t=this._buffer;if(e<=t.length)return e;{const n=this._earliestIndex,r=e-n,i=Math.max(r,2*(t.length-n),64),a=new Uint8Array(i);return n?(a.set(t.subarray(n)),this._bytesTrashed+=n,this._readIndex-=n,this._readEndIndex-=n,this._writeIndex-=n,this._earliestIndex=0):a.set(t),this._buffer=a,this._view=null,r}}_shiftWriteMaybeReallocate(e){const t=this._maybeReallocate(this._writeIndex+e),n=this._writeIndex;return this._writeIndex=t,this._hiddenWrites||(this._readEndIndex=t),n}}t.Binary=s;let l="",c=0;function u(e){if(e===l)return c;const t=e.length;let n=0;for(let r=0;r<t;r++){const i=e.charCodeAt(r);if(i<128)n++;else if(i<2048)n+=2;else if(i<55296||57344<=i&&i<=65535)n+=3;else if(55296<=i&&i<56320&&r+1!==t){const t=e.charCodeAt(r+1);56320<=t&&t<57344?(r++,n+=4):n+=3}else n+=3}return l=e,c=n}function d(e,t,n){const r=t>>21;if(e){const e=Boolean(2097151&t||n);return 0===r||-1===r&&e}return 0===r}function p(e,t,n,r,i){return e.readWithViewParser(t,n,r,i)}function f(e,t,n,r,i){return e.readWithBytesParser(t,n,r,i)}function _(e,t,n,r){return r?e.getInt8(t):e.getUint8(t)}function h(e,t,n,r){return e.getUint16(t,r)}function g(e,t,n,r){return e.getInt32(t,r)}function m(e,t,n,r){return e.getUint32(t,r)}function y(e,t,n,r,i){return r(e.getInt32(i?t+4:t,i),e.getInt32(i?t:t+4,i))}function S(e,t,n,r){return e.getFloat32(t,r)}function E(e,t,n,r){return e.getFloat64(t,r)}function v(e,t,n,r){const i=Math.min(r,10);let a=0,o=128;for(;a<i&&128&o;)o=e[t+a++];if(10===a&&o>1)throw new Error("ParseError: varint exceeds 64 bits");return 128&o?a+1:a}function T(e,t,n,r){let i=0,a=0,o=n;10===n&&(o--,a=1&e[t+o]);for(let n=o-1;n>=0;n--)i=i<<7|a>>>25,a=a<<7|127&e[t+n];return r(i,a)}function C(e,t,n){const r=t+e.byteOffset,i=e.buffer;return 0===r&&n===i.byteLength?i:i.slice(r,r+n)}function A(e,t,n){return e.subarray(t,t+n)}function b(e,t,n){const r=t+n;let a=[],o=null;for(let n=t;n<r;n++){a.length>5e3&&(o||(o=[]),o.push(String.fromCharCode.apply(String,a)),a=[]);const t=0|e[n];if(0==(128&t))a.push(t);else if(192==(224&t)){const o=H(e,n+1,r);if(o){n++;const e=(31&t)<<6|63&o;e>=128?a.push(e):a.push(i)}else a.push(i)}else if(224==(240&t)){const o=H(e,n+1,r),s=H(e,n+2,r);if(o&&s){n+=2;const e=(15&t)<<12|(63&o)<<6|63&s;e>=2048&&!(55296<=e&&e<57344)?a.push(e):a.push(i)}else o?(n++,a.push(i)):a.push(i)}else if(240==(248&t)){const o=H(e,n+1,r),s=H(e,n+2,r),l=H(e,n+3,r);if(o&&s&&l){n+=3;const e=(7&t)<<18|(63&o)<<12|(63&s)<<6|63&l;if(e>=65536&&e<=1114111){const t=e-65536;a.push(55296|t>>10,56320|1023&t)}else a.push(i)}else o&&s?(n+=2,a.push(i)):o?(n++,a.push(i)):a.push(i)}else a.push(i)}const s=String.fromCharCode.apply(String,a);return o?(o.push(s),o.join("")):s}function P(e,t,n,r,i){return e.writeToView(t,n,r,i)}function O(e,t,n,r,i){return e.writeToBytes(t,n,r,i)}function M(e,t,n,r){e[t]=r}function I(e,t,n,r,i){e.setUint16(t,r,i)}function w(e,t,n,r,i){e.setInt16(t,r,i)}function R(e,t,n,r,i){e.setUint32(t,r,i)}function N(e,t,n,r,i){e.setInt32(t,r,i)}function L(e,t,n,r,i){const a=r<0,o=a?-r:r;let s=Math.floor(o/4294967296),l=o-4294967296*s;a&&(s=~s,0===l?s++:l=-l),e.setUint32(i?t+4:t,s,i),e.setUint32(i?t:t+4,l,i)}function D(e,t,n,r,i){e.setFloat32(t,r,i)}function k(e,t,n,r,i){e.setFloat64(t,r,i)}function U(e,t,n,r,i){let a=r,o=i;const s=t+n-1;for(let n=t;n<s;n++)e[n]=128|127&o,o=a<<25|o>>>7,a>>>=7;e[s]=o}function G(e,t,n,r){let i=t;const a=r.length;for(let t=0;t<a;t++){const n=r.charCodeAt(t);if(n<128)e[i++]=n;else if(n<2048)e[i++]=192|n>>6,e[i++]=128|63&n;else if(n<55296||57344<=n)e[i++]=224|n>>12,e[i++]=128|n>>6&63,e[i++]=128|63&n;else if(55296<=n&&n<56320&&t+1!==a){const a=r.charCodeAt(t+1);if(56320<=a&&a<57344){t++;const r=65536+((1023&n)<<10|1023&a);e[i++]=240|r>>18,e[i++]=128|r>>12&63,e[i++]=128|r>>6&63,e[i++]=128|63&r}else e[i++]=239,e[i++]=191,e[i++]=189}else e[i++]=239,e[i++]=191,e[i++]=189}}function x(e,t,n,i,a){const o=(0,r.hexLongIsNegative)(i),s=(0,r.hexLongToHex)(i);let l=0,c=0;for(let e=0;e<16;e++)l=l<<4|c>>>28,c=c<<4|(0,r.hexAt)(s,e);o&&(l=~l,0===c?l++:c=-c),e.setUint32(a?t+4:t,l,a),e.setUint32(a?t:t+4,c,a)}function B(e,t,n,r){for(let i=0;i<n;i++)e[t+i]=r[i]}function F(e,t){let n,r;for(e?(n=5,r=e>>>3):(n=1,r=t>>>7);r;)n++,r>>>=7;return n}function j(e,t,n,r){if("number"!=typeof e||e!=e||Math.floor(e)!==e||e<t||e>=n)throw new TypeError("string"==typeof e?`WriteError: string "${e}" is not a valid ${r}`:`WriteError: ${String(e)} is not a valid ${r}`)}function Y(e,t,n){let r;r=t>=0||e?t:4294967296+t;const i=4294967296*r+(n>=0?n:4294967296+n);if(!d(e,t,n))throw new Error(`ReadError: integer exceeded 53 bits (${i})`);return i}function K(e,t){return Y(!0,e,t)}function W(e,t){return Y(!1,e,t)}function H(e,t,n){if(t>=n)return 0;const r=0|e[t];return 128==(192&r)?r:0}},51239:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intToBytes=function(e,t){let n=t;const r=new Uint8Array(e);for(let t=e-1;t>=0;t--)r[t]=255&n,n>>>=8;return r},t.uint8ArrayToBuffer=function(e){return e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset)}},842341:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n=[];n[34]="ES",n[49]="DE",n[52]="MX",n[44]="GB",n[966]="SA",n[39]="IT",n[93]="AF",n[355]="AL",n[213]="DZ",n[376]="AD",n[244]="AO",n[54]="AR",n[374]="AM",n[297]="AW",n[61]="AU",n[43]="AT",n[994]="AZ",n[973]="BH",n[880]="BD",n[375]="BY",n[32]="BE",n[501]="BZ",n[229]="BJ",n[975]="BT",n[591]="BO",n[387]="BA",n[267]="BW",n[55]="BR",n[246]="IO",n[673]="BN",n[359]="BG",n[226]="BF",n[257]="BI",n[225]="CI",n[855]="KH",n[237]="CM",n[238]="CV",n[236]="CF",n[235]="TD",n[56]="CL",n[86]="CN",n[57]="CO",n[269]="KM",n[242]="CG",n[243]="CD",n[682]="CK",n[506]="CR",n[385]="HR",n[53]="CU",n[599]="CW",n[357]="CY",n[420]="CZ",n[45]="DK",n[253]="DJ",n[593]="EC",n[20]="EG",n[503]="SV",n[240]="GQ",n[291]="ER",n[372]="EE",n[251]="ET",n[298]="FO",n[679]="FJ",n[358]="FI",n[33]="FR",n[594]="GF",n[689]="PF",n[241]="GA",n[220]="GM",n[995]="GE",n[233]="GH",n[350]="GI",n[30]="GR",n[299]="GL",n[590]="GP",n[502]="GT",n[224]="GN",n[245]="GW",n[592]="GY",n[509]="HT",n[504]="HN",n[852]="HK",n[36]="HU",n[354]="IS",n[91]="IN",n[62]="ID",n[98]="IR",n[964]="IQ",n[353]="IE",n[972]="IL",n[81]="JP",n[962]="JO",n[254]="KE",n[965]="KW",n[996]="KG",n[856]="LA",n[371]="LV",n[961]="LB",n[266]="LS",n[231]="LR",n[218]="LY",n[423]="LI",n[370]="LT",n[352]="LU",n[853]="MO",n[389]="MK",n[261]="MG",n[265]="MW",n[60]="MY",n[960]="MV",n[223]="ML",n[356]="MT",n[692]="MH",n[596]="MQ",n[222]="MR",n[230]="MU",n[691]="FM",n[373]="MD",n[377]="MC",n[976]="MN",n[382]="ME",n[212]="MA",n[258]="MZ",n[95]="MM",n[264]="NA",n[674]="NR",n[977]="NP",n[31]="NL",n[687]="NC",n[64]="NZ",n[505]="NI",n[227]="NE",n[234]="NG",n[672]="NF",n[850]="KP",n[47]="NO",n[968]="OM",n[92]="PK",n[680]="PW",n[970]="PS",n[507]="PA",n[675]="PG",n[595]="PY",n[51]="PE",n[63]="PH",n[48]="PL",n[351]="PT",n[974]="QA",n[40]="RO",n[7]="RU",n[250]="RW",n[262]="RE",n[508]="PM",n[685]="WS",n[378]="SM",n[221]="SN",n[381]="RS",n[248]="SC",n[232]="SL",n[65]="SG",n[421]="SK",n[386]="SI",n[677]="SB",n[252]="SO",n[27]="ZA",n[82]="KR",n[211]="SS",n[94]="LK",n[249]="SD",n[597]="SR",n[268]="SZ",n[46]="SE",n[41]="CH",n[963]="SY",n[239]="ST",n[886]="TW",n[992]="TJ",n[255]="TZ",n[66]="TH",n[670]="TL",n[228]="TG",n[676]="TO",n[216]="TN",n[90]="TR",n[993]="TM",n[256]="UG",n[380]="UA",n[971]="AE",n[1]="US",n[598]="UY",n[998]="UZ",n[678]="VU",n[58]="VE",n[84]="VN",n[681]="WF",n[967]="YE",n[260]="ZM",n[263]="ZW",n[383]="XK";var r=n;t.default=r},81574:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={1:'[334,-1,"($1) $2-$3"],10',20:'["Ah","[23]"],[334,"1[0125]|[89]00"],["Bg","1[35]|[4-6]|[89][2-9]"],[9,10]',211:"333,9",212:'["[5-7]BF","5(2[015-7]|3[0-4])|[67]",1],["[58]CE",["5(2[2-489]|3[5-9]|92)|892","5(2([2-48]|9[0-7])|3([5-79]|8[0-7])|924)|892"],1],["5DD",["5(29|38)","5(29|38)[89]"],1],["[5]BBBB","5(4[067]|5[03])"],["8[09];G","8(0|9[013-9])",1],9',213:'["[5-8]BBBB","[5-8]"],["9ACBB",9],9',216:"233,8",218:'[27,"[25-79]",1],9',220:"34,7",221:'[2322,"[379]"],[3222,8],9',222:'"[2-48]ABBB",8',223:'[2222,"[246-9]"],8',224:'[2222,3],[3222,"[67]"],[8,9]',225:"2222,8",226:'[2222,"[025-7]"],8',227:'[233,"08"],[2222,"[0289]"],8',228:'[2222,"[279]"],8',229:"2222,8",230:'[34,"[2-46]|8[013]"],[44,5],[7,8]',231:'[133,"[45]"],[233,2],[234,"[23578]"],[7,8,9]',232:"26,8",233:'[234,"[235]"],9',234:'["CCd","[7-9]"],["CDe","[78]"],["CEf","[78]"],10',235:"2222,8",236:"2222,8",237:'[2222,88],[12222,"[26]"],[8,9]',238:"322,7",239:"34,7",240:'[333,"[235]"],[36,"[89]"],9',241:"[2222,0],8",242:'[234,"[02]"],[144,8],9',243:'[234,1],[333,"[89]"],9',244:'[333,"[29]"],9',245:'[333,"44|9[567]"],[34,40],[7,9]',246:"[34,3],7",247:"5",248:'[133,"[246]"],7',249:'[234,"[19]"],9',250:'["2BCC",2],["[7-9]BCC","[7-9]"],9',251:'"[1-59]ACD",9',252:'[17,"24|[67]"],["BA{5,7}","15|28|6[1-35-9]|799|9[2-9]"],[333,"3[59]|4[89]|6[24-6]|79|8[08]|90"],[8,9]',253:"2222,8",254:'["BA{5,7}","[24-6]"],[36,7],["CCd","[89]"],9',255:'["[24]ACD","[24]"],["[67]BCC","[67]"],["[89]BBD","[89]"],9',256:'[45,[202,2024]],[36,"[27-9]|4(6[45]|[7-9])"],[27,"[34]"],9',257:"2222,8",258:'["[28]ACd","2|8[2-7]"],["80ACC",80],9',260:'["[29]AG","[29]"],["800;CC",8],9',261:'[2232,"[23]"],9',262:'"[268]BBBB",9',263:'["7ACd",7],["86BCC","86[24]"],["CCd","2(1[39]|2[0157]|6[14]|7[35]|84)|329"],["[235]ACd","[23]9|54"],["[25]CA{3,5}",["(25|54)8","258[23]|5483"]],["8CF",86],["80ACD",80],[9,10]',264:'["8ACD","8[1235]"],["6ACd",6],["870;CC",870],9',265:'["2BCC",2],[3222,"[1789]"],9',266:"44,8",267:'["7ACC",7],8',268:'[44,"[027]"],8',269:"322,7",27:'[333,860],[234,"[1-9]"],9',290:"[4,5]",291:"133,7",297:"34,7",298:"6,6",299:"222,6",30:'[244,"21|7"],[46,"2(2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])"],[334,"[2689]"],10',31:'["[1-578]ACD","1[035]|2[0346]|3[03568]|4[0356]|5[0358]|7|8[4578]"],["[1-5]BCC","1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],["6;H","6[0-57-9]"],["66;G",66],["[89]0AA{4,7}","80|9"],[9,11]',32:"[3222,4],9",33:'[3222,8],[12222,"[1-79]"],9',34:'["[89]00;CC","[89]00"],["[5-9]BBBB","[568]|[79][0-8]"],9',350:"[35,2],8",351:'["2ACD","2[12]"],["[2-46-9]BCC","2[3-9]|[346-9]"],9',352:'[2223,20],[333,6],["BBBBb","2([0367]|4[3-8])"],["BBBA{1,5}","[3-57]|8[13-9]|9(0[89]|[2-579])|(2|80)[2-9]"],9',353:'["AdD",1],["BCd","[2569]|4[1-69]|7[14]"],[333,70],[333,81],[234,"[78]"],[433,1],[2134,8],[244,4],9',354:'[34,"[4-9]"],["3BCC",3],[7,8,9]',355:'["6[6-9];CD",6],9',356:'[44,"[2357-9]"],8',357:"26,8",358:'["CA{3,7}","([1-3]00|[6-8]0)"],["116C",116],["BA{4,10}","[14]|2[09]|50|7[135]"],["AA{4,11}","[25689][1-8]|3"],[6,7,8,9,10,11]',359:'[333,999],["BCd","48|8[7-9]|9[08]"],9',36:'["BCd","[2-9]"],9',370:'[134,"52[0-79]"],[323,"[7-9]"],[26,"37|4([15]|6[1-8])"],[35,"[3-6]"],8',371:'[233,"[269]|8[01]"],8',372:'["[3-79]BD",["[369]|4[3-8]|5([0-2]|5[0-478]|6[45])|7[1-9]","[369]|4[3-8]|5([02]|1([0-8]|95)|5[0-478]|6(4[0-4]|5[1-589]))|7[1-9]"]],["70;BD",70],["8000;CC",[800,8000]],["[458]Cd",["40|5|8(00|[1-5])","40|5|8(00[1-9]|[1-5])"]],[7,8]',373:'[233,"22|3"],["[25-7]BBC","2[13-9]|[5-7]"],["[89]BE","[89]"],8',374:'[26,"1|47"],[26,"4[1349]|[5-7]|9[1-9]"],[35,"[23]"],[323,"8|90"],8',375:'[2322,["17[0-3589]|2[4-9]|[34]","17([02358]|1[0-2]|9[0189])|2[4-9]|[34]"],"$1 $2-$3-$4"],[3222,["1(5[24]|6[235]|7[467])|2(1[246]|2[25]|3[26])","1(5[24]|6(2|3[04-9]|5[0346-9])|7([46]|7[37-9]))|2(1[246]|2[25]|3[26])"],"$1 $2-$3-$4"],[423,["1(5[169]|6[3-5]|7[179])|2(1[35]|2[34]|3[3-5])","1(5[169]|6(3[1-3]|4|5[125])|7(1[3-9]|7[0-24-6]|9[2-7]))|2(1[35]|2[34]|3[3-5])"],"$1 $2-$3"],["[89]BCD","8[01]|9"],["82ADD",82],["800;BA{2,4}",800],9',376:'[33,"[135-9]"],[44,1],[333,6],[6,9]',377:'[2222,"[39]"],[233,4],["6;BBBB",6],[332,8],[8,9]',378:'[2222,"[5-7]"],["0549;F",0,"($1) $2"],8',379:"10",380:'[333,["6[12][29]|(3[1-8]|4[136-8]|5[12457]|6[49])2|(56|65)[24]","6[12][29]|(35|4[1378]|5[12457]|6[49])2|(56|65)[24]|(3[1-46-8]|46)2[013-9]"]],[234,["4[45][0-5]|5(0|6[37])|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]","4[45][0-5]|5(0|6(3[14-7]|7))|6([12][018]|[36-8])|7|89|9[1-9]|(48|57)[0137-9]"]],[45,"[3-6]"],["CCd","[89]"],9',381:'["[23]BA{4,9}","(2[389]|39)0"],["[1-3]AA{5,10}","1|2([0-24-7]|[389][1-9])|3([0-8]|9[1-9])"],["6AA{6,8}",6],["[89]BA{3,9}","[89]"],["7[26];A{4,9}","7[26]"],["7[08]AA{4,9}","7[08]"],[8,9,10]',382:'[233,"[2-57-9]|6[036-9]"],[8,9]',383:'[233,"[23][89]|4[3-79]"],[35,"[89]00"],333,8',385:'["1;DC",1],["[2-5]ACd","[2-5]"],["9ACd",9],["[67]ACd","[67]"],["80[01];Bc",8],["80[01];CC",8],[8,9]',386:'[1322,"[12]|3[24-8]|4[24-8]|5[2-8]|7[3-8]"],["[3-7]ACC","[37][01]|4[0139]|51|6"],["[89][09];A{3,6}","[89][09]"],["[58]BE","59|8[1-3]"],8',387:'[233,"6[1-356]|[7-9]"],[233,"[3-5]","$1 $2-$3"],[2223,6],[8,9]',389:'["2;CD",2],["[347]ACC","[347]"],["[58]BABB","[58]"],8',39:'["BdD","0[26]|55"],["0[26];DE","0[26]"],["0BdD","0[13-57-9][0159]"],["CA{3,6}",["0[13-57-9][0159]|8(03|4[17]|9[245])","0[13-57-9][0159]|8(03|4[17]|9(2|[45][0-4]))"]],["0CCD","0[13-57-9][2-46-8]"],["0CA{2,6}","0[13-57-9][2-46-8]"],["CCd",["[13]|8(00|4[08]|9[59])","[13]|8(00|4[08]|9(5[5-9]|9))"]],[344,3],[9,10]',40:'[234,"[23]1"],[333,"[23][3-7]|[7-9]"],9',41:'["[2-9]ACBB","[2-7]|[89]1"],["[89]BCC","8[047]|90"],[32322,860],9',420:'["[2-9]BCC","[2-8]|9[015-7]"],["96ACCC",96],["9ACCC","9[36]"],9',421:'["2;CCB",2,"$1/$2 $3 $4"],["[3-5]ACBB","[3-5]","$1/$2 $3 $4"],["[689]BCC","[689]"],9',423:'[322,"[237-9]"],[234,69],[333,6],7',43:'["1;A{3,12}",1],["5ADA{4,7}","5[079]"],["CA{3,10}","316|46|51|732|6(5[0-3579]|[6-9])|7([28]0)|[89]"],["DA{3,9}","2|3(1[1-578]|[3-8])|4[2378]|5[2-6]|6([12]|4[1-9]|5[468])|7(2[1-8]|35|4[1-8]|[5-79])"],[10,11,12,13]',44:'["Ee",["1(38|5[23]|69|76|94)","1((38|69)7|5(24|39)|768|946)","1(3873|5(242|39[4-6])|(697|768)[347]|9467)"]],["Df","1([2-69][02-9]|[78])"],[244,["[25]|7(0|6[024-9])","[25]|7(0|6([04-9]|2[356]))"]],[46,7],[334,"[1389]"],10',45:"2222,8",46:'["8;ccB",8],["[1-69]AcBB","1[013689]|2[0136]|3[1356]|4[0246]|54|6[03]|90"],[3222,"1[2457]|2([247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6([124-689]|7[0-2])|9([125-8]|3[0-5]|4[0-3])"],["7ACBB",7],["9[034]ABBC","9[034]"],[32322,"25[245]|67[3-6]"],9',47:'["[489]BBC","[489]"],["[235-7]ABBB","[235-7]"],8',48:'[2322,"[14]|2[0-57-9]|3[2-4]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145]"],[333,"26|39|5[0137]|6[0469]|7[02389]|8[08]"],9',49:'["BA{3,13}","3[02]|40|[68]9"],["CA{3,12}",["2(0[1-389]|1[124]|2[18]|3[14])|3([35-9][15]|4[015])|906|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(0[1-389]|12[0-8])|3([35-9][15]|4[015])|906|2([13][14]|2[18])|(2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"]],["DA{2,11}",["[24-6]|3([3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(3(0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(2[135]|4[13578]|9[1346])|5(0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(2[1-7]|4[145]|6[1-5]|7[1-4])|8(21|3[1468]|6|7[1467]|8[136])|9(0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(47|60)[1356]|3(3[46]|46|5[49])[1246]|3[4579]3[1357]"]],[34,138],["EA{2,10}",3],["CA{5,11}",181],["CAA{4,10}","1(3|80)|9"],["Ch","1[67]"],["CA{7,12}",8],[56,[185,1850,18500]],[344,7],[47,"18[68]"],[56,"15[0568]"],[47,"15[1279]"],[38,18],["CBh","1(6[023]|7)"],[427,"15[279]"],[328,15],[7,8,9,10,11,12]',500:"5",501:'[34,"[2-8]",1],["0;800;DC",0,1],7',502:'[44,"[2-7]"],[434,1],8',503:'[44,"[267]"],[344,"[89]"],8',504:'[44,"[237-9]",1],8',505:"44,8",506:'[44,"[24-7]|8[3-9]"],[334,"[89]0",1],8',507:"[44,6,1],8",508:'"[45]ABB",6',509:"224,8",51:"[333,9],9",52:'[244,"33|5[56]|81"],[334,"[2-9]"],[1244,"1(33|5[56]|81)"],[1334,1],[10,11]',53:'["Ag",7],["BA{4,6}","[2-4]"],[17,5],8',54:'[424,["2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(2[24-9]|3[1-59]|47)","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5[56][46]|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(4[35][56]|58[45]|8([38]5|54|76))[4-6]","2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|58|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|54(4|5[13-7]|6[89])|86[3-6]))|2(2[24-9]|3[1-59]|47)|38([58][78]|7[378])|3(454|85[56])[46]|3(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2-$3"],[244,1,"$1 $2-$3"],[334,"[23]","$1 $2-$3"],[334,"[68]",1],[1424,["9(2[2-469]|3[3-578])","9(2(2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(2([23]02|6([25]|4[6-8])|9([02356]|4[02568]|72|8[23]))|3(3[28]|4([04679]|3[5-8]|5[4-68]|8[2379])|5([2467]|3[237]|8[2-5])|7[1-578]|8([2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(2[24-9]|3[1-59]|47)","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5[2-6])|72|8[23]))|3(3[28]|4([04679]|3[78]|5(4[46]|8)|8[2379])|5([2467]|3[237]|8[23])|7[1-578]|8([2469]|3[278]|5([56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4[35][56]|58[45]|8([38]5|54|76))[4-6]","9(2([23]02|6([25]|4(64|[78]))|9([02356]|4([0268]|5([24-6]|3[2-5]))|72|8[23]))|3(3[28]|4([04679]|3(5(4[0-25689]|[56])|[78])|5(4[46]|8)|8[2379])|5([2467]|3[237]|8([23]|4([45]|60)|5(4[0-39]|5|64)))|7[1-578]|8([2469]|3[278]|5(4(4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(6[3-6]|[78]))))|92(2[24-9]|3[1-59]|47)|93(4(36|5[56])|8([38]5|76))[4-6]"],"$1 $2 $3-$4"],[1244,91,"$1 $2 $3-$4"],[1334,9,"$1 $2 $3-$4"],[10,11]',55:'[244,"[1-9][1-9]","$1 $2-$3"],[254,"([14689][1-9]|2[12478]|3[1-578]|5[1-5]|7[13-579])9","$1 $2-$3"],["[3589]00;cD","[3589]00"],[10,11]',56:'[144,"2[23]"],[234,"[357]|4[1-35]|6[13-57]"],["9;DD",9],["44;CD",44],["[68]00;Cd","60|8"],["600;CBC",60],["1230;CD",1],[54,219],9',57:'[17,["1(8[2-9]|9[0-3]|[2-7])|[24-8]","1(8[2-9]|9(09|[1-3])|[2-7])|[24-8]"]],[37,3],["1;CG",["1(80|9[04])","1(800|9(0[01]|4[78]))"]],[8,10]',58:"[37,-1,1],10",590:'["[56]90;BD",-1,"$1 $2-$3"],9',591:'[17,"[23]|4[46]"],[8,"[67]"],[324,8],8',592:"34,7",593:'[134,"[247]|[356][2-8]",1],[234,9],["1800;Cd",1],[8,9]',594:"3222,9",595:'["BCd","([26]1|3[289]|4[124678]|7[123]|8[1236])"],["CA{3,6}","[2-9]0"],[36,"9[1-9]"],[234,8700],[333,"[2-8][1-9]"],9',596:"3222,9",597:'[34,"[6-8]",1],7',598:'[233,9],[44,"[24]"],8',599:'[34,"[13-7]"],["9;CD",9],[7,8]',60:'["3;DD",3,"$1-$2 $3"],["[18]ACd","1[02-46-9][1-9]|8","$1-$2 $3"],["1;[36-8]00;BD","1[36-8]0",1],["11;DD",11,"$1-$2 $3"],["15[49];CD",15,"$1-$2 $3"],[9,10]',61:'["BCA{2,4}",16],[333,"14|[45]"],[144,"[2378]"],[433,"1(30|[89])"],9',62:'["BA{5,9}","2[124]|[36]1"],["CA{5,7}",800],["CA{5,8}","[2-79]"],["CdC","8[1-35-9]",1],["CA{6,8}",1],[334,804],[3133,80],["CDe",8,1],[2434,0],[9,10,11,12]',63:'["DA{4,6}",["3(23|39|46)|4(2[3-6]|[35]9|4[26]|76)|544|88[245]|(52|64|86)2","3(230|397|461)|4(2(35|[46]4|51)|396|4(22|63)|59[347]|76[15])|5(221|446)|642[23]|8(622|8([24]2|5[13]))"]],[334,"[89]"],[434,1],["DbCD",1],10',64:'[323,"[89]0"],[134,"24|[346]|7[2-57-9]|9[2-9]","$1-$2 $3"],["CCd","2(10|74)|[59]|80"],["BdD","2[028]"],["BCA{3,5}","2([169]|7[0-35-9])|7|86"],[8,9,10]',65:'["[3689]CD","[369]|8[1-9]"],["1[89]00;CD","1[89]"],["7000;DC",70],["800;CD",80],8',66:'["BCd","14|[3-9]"],[433,1],9',670:"[44,7],8",672:"[24,1],[15,3],[5,6]",673:'"[2-578]BD",7',674:"34,7",675:'[34,"[13-689]|27"],[44,"20|7"],[7,8]',676:'[34,"7[5-9]|8[47-9]"],[43,0],7',677:'[25,"[7-9]"],7',678:'[34,"[579]"],7',679:'[34,"[35-9]"],[434,0],7',680:"34,7",681:"222,6",682:"23,5",683:"4",685:'["8Bd",8],["7AE",7],[6,7]',686:"8",687:'[222,"[2-46-9]|5[0-4]","$1.$2.$3"],6',688:"[6,7]",689:'[2222,"4[09]|8[79]"],[222,44],[6,8]',690:"[4,5,6,7]",691:"34,7",692:"[34,-1,1],7",7:'[4222,["7(1[0-8]|2[1-9])","7(1([0-6]2|7|8[27])|2(1[23]|[2-9]2))","7(1([0-6]2|7|8[27])|2(13[03-69]|62[013-9]))|72[1-57-9]2"]],[5122,["7(1[0-68]|2[1-9])","7(1([06][3-6]|[18]|2[35]|[3-5][3-5])|2([13][3-5]|[24-689]|7[457]))","7(1(0([356]|4[023])|[18]|2(3[013-9]|5)|3[45]|43[013-79]|5(3[1-8]|4[1-7]|5)|6(3[0-35-9]|[4-6]))|2(1(3[178]|[45])|[24-689]|3[35]|7[457]))|7(14|23)4[0-8]|71(33|45)[1-79]"]],[334,7],[3322,"[3489]","$1 $2-$3-$4"],10',81:'[334,800,1],["DBd","0077",1],[424,"0088",1],["DCd","00(37|66)",1],["DDe","00(37|66)",1],["DEf","00(37|66)",1],["DFg","00(37|66)",1],[244,"[2579]0|80[1-9]",1],10',82:'["AdD",2,1],[234,"60|8",1],["BdD","[1346]|5[1-5]",1],[244,"[57]",1],[533,["003","0030"]],[254,5,1],["EdD",0],[5234,0],[9,10]',84:'[244,"2[48]"],[343,"2[0-35-79]"],["[89]ACBB","8(8|9[89])|9"],["1[2689]ACD","1([26]|8[68]|99)"],["[3578]ACD","[357]|8[1-5]"],["86[89];CC","86[89]"],["1[89]00;A{4,6}",["1[89]0","1[89]00"]],[9,10]',850:"[334,1],10",852:'[44,"[235-7]|[89](0[1-9]|[1-9])"],["800;CC",800],["900;BCC",900],["900;A{2,5}",900],8',853:'"[268]CD",8',855:'["BCd","[1-9]"],[433,1],[8,9]',856:"[2233,2],10",86:'["21;DA{4,6}",21],[344,"3(11|7[179])|4([15]1|3[1-35])|5(1|2[37]|3[12]|51|7[13-79]|9[15])|7(31|5[457]|6[09]|91)|8([57]1|98)"],[434,[807,8078]],[344,"1[3-578]"],["10800;CD",[108,1080,10800]],["Ch",950],11',880:'["CA{3,7}","3([67]|8[013-9])|4(6[168]|7|[89][18])|5(6[128]|9)|6(28|4[14]|5)|7[2-589]|8(0[014-9]|[12])|9[358]|(3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(44|66)[01346-9]",1],["DA{3,6}","[13-9]",1],10',886:'["AdD","[25][2-8]|[346]|7[1-9]|8[237-9]"],[234,"[258]"],[333,9],[244,7],9',90:'[334,"512|8[0589]|90"],[3322,["5([0-59]|61)","5([0-59]|616)","5([0-59]|6161)"]],[3322,"[24][1-8]|3[1-9]"],10',91:'[55,["600|7([02-8]|19|9[037-9])|8(0[015-9]|[1-9]|20)|9","600|7([078]|19[0-5]|2([02356-9]|[14][017-9]|9[389])|3([025-9]|1[07-9]|[34][017-9])|4([0-35689]|[47][017-9])|5([02346-9]|1[017-9]|5[017-9])|6([02-9]|1[0-257-9])|9([089]|31|7[02-9]))|8(0([01589]|6[67]|7[02-9])|1([0-57-9]|6[07-9])|2(0[078]|[14][07-9]|[235-9])|3([0357-9]|[126][07-9]|4[1-9])|[45]|6([02457-9]|[136][07-9])|7([078][07-9]|[1-69])|8([0-25-9]|3[07-9]|4[047-9])|9([02-9]|1[027-9]))|9","600|7(0|19[0-5]|2([0235679]|[14][017-9]|8([0-569]|[78][089])|9[389])|3([05-8]|1([089]|7[5-9])|2([5-8]|[0-49][089])|3[017-9]|4([07-9]|11)|9([01689]|[2345][089]|40|7[0189]))|4([056]|1([0135-9]|[23][089]|2[089]|4[089])|2(0[089]|[1-7][089]|[89])|3([0-8][089]|9)|4([089]|11|7[02-8])|7([089]|11|7[02-8])|8([0-24-7][089]|[389])|9([0-7][089]|[89]))|5([0346-9]|1[017-9]|2([03-9]|[12][089])|5[017-9])|6([0346-9]|1[0-257-9]|2([0-4].|[5-9][089])|5([0-367][089]|[4589]))|7(0([02-9]|1[089])|[1-9])|8([0-79]|8(0[0189]|11|8[013-9]|9))|9([089]|313|7([02-8]|9[07-9])))|8(0([01589]|6[67]|7([02-8]|9[05-9]))|1([02-57-9]|1([0-35-9]|4[0-46-9])|6([089]|7[02-8]))|2(0([08]|7[02])|[14]([089]|7[02-8])|[235-9])|3([0357-9]|1([089]|7[02-6])|2([09]|77|8[0-689])|4[1-9]|6([089]|7[02-7]))|[45]|6([02457-9]|1([089]|7[02-8])|3([089]|7[02358])|6([08]|7[02-8]|9[01]))|7(0[07-9]|[1-69]|7([089]|7[02-8])|8([089]|7[02-8]))|8([0-25-9]|3([089]|7[02-8])|4([0489]|7[02-68]))|9([02-9]|1([0289]|7[2-6])))|9"]],[244,"11|2[02]|33|4[04]|79[1-9]|80[2-46]"],[334,"1(2[0-249]|3[0-25]|4[145]|[569][14]|7[1257]|8[1346]|[68][1-9])|2(1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568]|9[14])|3(26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(1[025]|[36][25]|22|4[28]|5[12]|[78]1|9[15])|6(12|[2345]1|57|6[13]|7[14]|80)|7(12|2[14]|3[134]|4[47]|5[15]|[67]1|88)|8(16|2[014]|3[126]|6[136]|7[078]|8[34]|91)"],[433,"1([23579]|[468][1-9])|[2-8]"],[2343,"008"],[334,140],[424,[160,1600]],["DA{2,4};D",[180,1800]],["DdD",[186,1860]],[4333,"18[06]"],10',92:'["Bh","(2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],["Cg",["2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(2[3-8]|98)|(2(3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(2[2-689]|3[23578]|4[3478]|5[2356])|9(22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"]],[55,58],[37,3],[2333,"2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],[3333,"[24-9]"],10',93:'["[2-7]ACD","[2-7]"],9',94:'[234,7],[333,"[1-689]"],9',95:'["ACd","[12]"],["BCd","[4-7]|8[1-35]"],["ACA{4,6}","9(2[0-4]|[35-9]|4[137-9])"],[144,2],[334,8],[1333,92],[154,9],[8,9,10]',960:'[34,"[3467]|9([1-9]|0[1-9])",1],[334,"[89]00"],7',961:'[133,"[13-69]|7([2-57]|62|8[0-7]|9[04-9])|8[02-9]"],[233,"[7-9]"],[7,8]',962:'["7;DD","7[457-9]"],["Cf","70|8[0158]|9"],9',963:'["BCd","[1-5]"],["9BCC",9],9',964:'["BCd","[2-6]"],[334,7],[9,10]',965:'["Dd","[169]|2([235]|4[1-35-9])|52"],[35,"[25]"],8',966:'[45,9],[234,1],[234,5],["CCd",81],[334,8],9',967:'["7BCC","7[0137]"],9',968:'["CA{4,6}","[58]"],[26,2],[44,"[79]"],8',970:'["5[69]ACC",5],["1[78]00;CC","1[78]"],9',971:'["CA{2,9}","60|8"],[315,"[479]"],[234,5],9',972:'[234,"[57]",1],[433,12,1],[46,159,1],[1333,"1[7-9]",1],["CbCD",15,"$1-$2 $3-$4"],9',973:"44,8",974:'["[3-7]CD","[3-7]"],8',975:'[2222,"1|77"],8',976:'["[12]ABD","[12]1"],["[12]2Af","[12]2[1-3]"],["[12]CE",["[12](27|[3-5])","[12](27|[3-5].)2"]],[44,"[57-9]"],["[12]De",["[12](27|[3-5])","[12](27|[3-5].)[4-9]"]],8',977:'["9BG","9(6[013]|7[245]|8)",1],10',98:'[244,"[1-8]"],["CCd",9],10',992:'[612,[331,3317]],[324,"[34]7|91[78]"],[414,3],[234,"[457-9]"],9',993:'[2222,12,"$1 $2-$3-$4"],[26,6],[3122,"13|[2-5]","$1 $2-$3-$4"],8',994:'[3222,9],[2322,["[12]|365","[12]|365","[12]|365([0-46-9]|5[0-35-9])"]],[2322,"[3-8]"],9',995:'[3222,"[348]"],[333,7],[3222,5],9',996:'[45,"3(1[346]|[24-79])"],[333,"[235-79]"],["CCAc",8],9',998:'[2322,"[679]"],[7,8,9]'}},559002:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndMac=function(e,t,n){return(0,o.aesCbcEncrypt)(e,new Uint8Array(n)).then((e=>(0,s.hmacSha256)(t,e).then((t=>a.Binary.build(t,e).readBuffer()))))},t.macAndDecrypt=function(e,t,n){return Promise.resolve(new Uint8Array(n)).then((n=>{const r=(0,i.encodeB64)(n.subarray(0,32)),a=n.subarray(32);return(0,s.hmacSha256)(t,a).then((t=>{const n=(0,i.encodeB64)(t);if(r!==n)throw __LOG__(3)`crypto:macAndDecrypt HMAC don't match ${r} vs. ${n}`,new Error("macAndDecrypt HMAC mismatch");return(0,o.aesCbcDecryptSplit)(e,a)}))}))},t.removeEncryptedPadding=function(e,t){const n=e.slice(-t.byteLength);if((0,r.arrayBuffersEqualUNSAFE)(n,t))return e.slice(0,e.byteLength-t.byteLength);return e};var r=n(676100),i=n(615688),a=n(108584),o=n(781484),s=n(411141)},640265:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedError=t.UnimplementedMethod=t.TimeoutError=t.HttpError=t.AggregateError=void 0,t.customError=r,t.hasSupressedQuotaExceededError=function(){return l},t.obtainErrorSummary=function(e){return JSON.stringify(e,Object.getOwnPropertyNames(e))},t.supressQuotaExceededError=function(e){if(null==e||"QuotaExceededError"!==e.name)throw e;l=!0};const n=Object.create(Error.prototype,{constructor:{value:void 0,writable:!0,configurable:!0}});function r(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;function i(n){const r=Error.call(this,n);this.message=n,r.name=e,this.name=e,t&&(this.stack=r.stack)}return i.prototype=Object.create(r?r.prototype:n),i.prototype.constructor=i,i}class i extends(r("AggregateError",!0)){constructor(e,t){super(null!=t&&t.length>0?t:function(e){return 0===e.length?"No errors":1===e.length?e[0].message:e.map((e=>"- "+e.message)).join("\n")}(e)),this.errors=e}}t.AggregateError=i;class a extends(r("TimeoutError",!1)){}t.TimeoutError=a;class o extends(r("HttpError",!1)){constructor(e,t){super(e),this.code=t}}t.HttpError=o;class s extends(r("UnimplementedMethod")){}t.UnimplementedMethod=s;let l=!1;class c extends Error{constructor(e,t){super(e),this.inner=t}}t.WrappedError=c},772651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GzipWrapper=void 0,t.createDeflate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new i(e)},t.inflate=function(e){return(0,r.decompressSync)(e)};var r=n(256856);class i extends r.Gzip{constructor(e){super(e),this._chunks=[],this.ondata=(e,t)=>{if(this._chunks.push(e),!t)return;let n=0;this._chunks.forEach((e=>{n+=e.length}));const r=new Uint8Array(n);let i=0;this._chunks.forEach((e=>{r.set(e,i),i+=e.length})),this._result=r}}push(e,t){if(null!=this._result)throw new Error("Tried to push chunk to compressor after final block");e instanceof Uint8Array?super.push(e,t):e instanceof ArrayBuffer?super.push(new Uint8Array(e),t):super.push((0,r.strToU8)(e),t)}result(){if(null==this._result)throw new Error("Tried to access result before adding final block");return this._result}}t.GzipWrapper=i},133344:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},132176:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null===e)return"null";switch(typeof e){case"undefined":return"undefined";case"number":return`n:${e}`;case"string":return`s:${e}`;case"boolean":return`b:${e.toString()}`;case"object":{let t=n.get(e);return null==t&&(t=r++,n.set(e,t)),`o:${t}`}default:throw new Error("Unsupported type")}};const n=new WeakMap;let r=0},787614:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NUM_HEX_IN_LONG=t.HEX_LOWER=void 0,t.bytesToBuffer=function(e){const t=e.buffer;return 0===e.byteOffset&&e.length===t.byteLength?t:t.slice(e.byteOffset,e.byteOffset+e.length)},t.bytesToDebugString=function(e){let t=!0,n=e.length;for(;t&&n;){const r=e[--n];t=32<=r&&r<127}return t?JSON.stringify(String.fromCharCode.apply(String,e)):i(e)},t.createHexLong=s,t.createHexLongFrom32Bits=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=p(e),i=p(t);return`${n?"-":""}0x${r}${i}`},t.hexAt=a,t.hexLongFromNumber=function(e){const t=e<0;return s(t?(-e).toString(16):e.toString(16),t)},t.hexLongIsNegative=u,t.hexLongToHex=c,t.hexOrThrow=o,t.isBiggerHexLong=function(e,t){const n=u(e),r=u(t);if(n!==r)return!n;const i=c(e)>c(t);return n?!i:i},t.negateHexLong=function(e){return u(e)?e.slice(1):"-"+e},t.parseHex=function(e){const t=o(e);if(t.length%2!=0)throw new Error(`parseHex given hex "${t}" which is not a multiple of 8-bits.`);const n=new Uint8Array(t.length>>1);for(let e=0,r=0;e<t.length;e+=2,r++)n[r]=a(t,e)<<4|a(t,e+1);return n.buffer},t.randomHex=function(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t),i(t)},t.toHex=i,t.toLowerCaseHex=function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];t.push(r[i>>4],r[15&i])}return String.fromCharCode.apply(String,t)};t.NUM_HEX_IN_LONG=16;const n=[48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70],r=[48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102];function i(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r];t.push(n[i>>4],n[15&i])}return String.fromCharCode.apply(String,t)}function a(e,t){const n=e.charCodeAt(t);return n<=57?n-48:n<=70?10+n-65:10+n-97}function o(e){if(/[^0-9a-fA-F]/.test(e))throw new Error(`"${e}" is not a valid hex`);return e}function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=o(e);return d(n,16),`${t?"-":""}0x${l(n,16)}`}function l(e,t){const n=t-e.length;let r=e;for(let e=0;e<n;e++)r="0"+r;return r}function c(e){return e.substring(e.indexOf("0x")+2)}function u(e){return"-"===e[0]}function d(e,t){if(e.length>t)throw new Error(`"${e}" is longer than ${4*t} bits.`)}function p(e){if(e>4294967295||e<-4294967296)throw new Error("uint32ToLowerCaseHex given number over 32 bits");return l((e>=0?e:4294967296+e).toString(16),8)}t.HEX_LOWER=r},989181:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inflatePhoneRegex=function(e){let t;t="number"==typeof e?String(e).split("").map((e=>".".repeat(Number(e)))).join(")("):e.replace(/;|[a-zA-Z]+/g,(e=>";"===e?")(":e.split("").map((e=>{const t=e.charCodeAt(0);return t>=97?".".repeat(t-96)+"?":".".repeat(t-64)})).join(")(")));return`(${t})`}},252230:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.WA_USER_JID_SUFFIX=t.WA_USER_DOMAIN=t.WA_SERVER_JID_SUFFIX=t.SURVEY_USER_JID=t.STATUS_JID=t.PSA_JID=t.MSGR_USER_JID_SUFFIX=t.MSGR_USER_DOMAIN=t.LID_SUFFIX=t.LID_DOMAIN=t.DEFAULT_DEVICE_ID=t.AUTHOR_SYSTEM=t.AUTHOR_ME=void 0,t.asChatJid=function(e){return e===s?null:e},t.asMulticastJid=function(e){return null==I(e)?e:null},t.asPhoneChatJid=function(e){return e===s?null:e},t.asStatusJid=function(e){return e===s?s:null},t.authorAsPhoneUserJid=function(e){if(e===a||e===o)return null;if(!e.endsWith(_))return null;return e},t.authorAsUserJid=function(e){if(e===a||e===o)return null;return e},t.authorToUserId=function(e,t){return e===a||e===o?t:P(e)},t.createJidUtils=function(e){let{platform:t}=e;const n="msgr"===t?u:_;return{toUserJid:function(e){return`${e}${n}`},getUserDomain:function(){return n},getGroupCallDomain:function(){return"@call"}}},t.defaultDeviceJidForUser=function(e){return`${A(e)}:0${B(e)}`},t.defaultLidDeviceJidForLidUserJid=function(e){return b(e,0)},t.defaultMsgrDeviceJidForUser=function(e){return`${A(e)}:0@msgr`},t.defaultPhoneDeviceJidForUser=function(e){return`${A(e)}:0@s.whatsapp.net`},t.extractDeviceIDParts=O,t.extractDeviceId=M,t.extractFromJid=L,t.extractJidFromJidWithType=function(e){return"phoneDevice"===e.jidType||"lidDevice"===e.jidType||"msgrDevice"===e.jidType?e.deviceJid:"lidUser"===e.jidType||"msgrUser"===e.jidType||"phoneUser"===e.jidType?e.userJid:"group"===e.jidType?e.groupJid:"status"===e.jidType?e.statusJid:"call"===e.jidType?e.callJid:(e.jidType,e.broadcastJid)},t.extractPhoneUserJid=function(e){return R(e)},t.extractUserId=P,t.extractUserJid=R,t.fullFormDeviceJidString=function(e){const{user:t,agent:n="0",device:r="0",server:i}=N(e);return`${t}.${n}:${r}@${i}`},t.getGroupDomain=function(){return l},t.getMsgrUserDomain=function(){return u},t.getServerDomain=function(){return"@s.whatsapp.net"},t.getWhatsappUserDomain=function(){return _},t.groupIdFromJid=function(e){if(e.endsWith(l))return e.slice(0,-l.length);throw new Error(`groupId called with non-group jid "${e}"`)},t.interpretAndValidateJid=D,t.interpretAsDeviceId=function(e){return e},t.interpretAsGroupJid=U,t.interpretAsNumber=function(e){return e},t.interpretAsPhoneUserJid=function(e){return e.endsWith(_)?e:null},t.interpretAsUserJid=I,t.isAuthorMe=function(e){return"@me"===e},t.isAuthorSystem=function(e){return"@system"===e},t.isPrimaryDevice=function(e){return 0===M(e)},t.lidFromLidUserJid=w,t.maybeSanitizeLogLineText=function(e){if(!e.includes("@"))return e;return e.replace(T,k)},t.parseJidParts=N,t.phoneNumberFromJid=function(e){if(!e.endsWith(_))throw new Error(`phoneNumberFromJid called with non-user jid "${e}"`);return e.slice(0,-_.length)},t.sanitizeJidForLogging=k,t.stripAgentIdFromPhoneDeviceJid=function(e){const{user:t,device:n="0",server:r}=N(e);return`${t}:${n}@${r}`},t.switchOnChatJidType=G,t.switchOnJidType=function(e,t){if(e===s)return t.status();return G(e,{phoneUser:t.phoneUser,msgrUser:t.msgrUser,lidUser:t.lidUser,group:t.group})},t.switchOnMsgrChatJidType=function(e,t){if(e.endsWith(u))return t.user(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)},t.switchOnMulticastJidType=function(e,t){if(e===s)return t.multicast(s);return x(e,{user:t.user,group:t.multicast})},t.switchOnPhoneChatJidType=x,t.switchOnPhoneJidType=function(e,t){if(e===s)return t.status();return x(e,{user:t.user,group:t.group})},t.toBroadcastJid=function(e){return`${e}@broadcast`},t.toDeviceJid=function(e,t){return`${A(e)}:${t}${B(e)}`},t.toGroupJid=function(e){if(e.endsWith(l))return e;return`${e}@g.us`},t.toLidDeviceJid=b,t.toLidUserJid=function(e){return`${e}@lid`},t.toMsgrDeviceJid=function(e,t){return`${A(e)}:${t}@msgr`},t.toMsgrUserJid=C,t.toPhoneDeviceJid=function(e,t){return`${A(e)}:${t}@s.whatsapp.net`},t.toPhoneUserJid=function(e){return`${e}@s.whatsapp.net`},t.unsafeCoerceToDeviceId=z,t.unsafeCoerceToDeviceJid=F,t.unsafeCoerceToGroupJid=$,t.unsafeCoerceToLidDeviceJid=K,t.unsafeCoerceToMsgrDeviceJid=Y,t.unsafeCoerceToMsgrUserJid=V,t.unsafeCoerceToPhoneDeviceJid=j,t.unsafeCoerceToPhoneUserJid=H,t.unsafeCoerceToUserJid=W,t.userIdFromJid=A,t.validateBroadcastJid=function(e){return E.test(e)?e:null},t.validateCallJid=function(e){return v.test(e)?e:null},t.validateDeviceJid=function(e){return h.test(e)||d.test(e)||S.test(e)?e:null},t.validateDomainJid=function(e){return"s.whatsapp.net"===e||"g.us"===e?e:null},t.validateGroupJid=function(e){return c.test(e)?e:null},t.validateStatusJid=function(e){return"status@broadcast"===e?e:null},t.validateUserJid=function(e){if(g.test(e)||p.test(e)||y.test(e))return e;if(f.test(e)){return C(e.substr(0,e.indexOf(":")))}return null};var i=r(n(184973));t.DEFAULT_DEVICE_ID=0;const a="@me";t.AUTHOR_ME=a;const o="@system";t.AUTHOR_SYSTEM=o;const s="status@broadcast";t.STATUS_JID=s;t.PSA_JID="0@s.whatsapp.net";const l="@g.us",c=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,u="@msgr";t.MSGR_USER_DOMAIN=u;t.MSGR_USER_JID_SUFFIX="msgr";const d=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,p=/^([1-9][0-9]{0,19})@msgr$/,f=/^([1-9][0-9]{0,19})(:0)?@msgr$/;t.WA_SERVER_JID_SUFFIX="s.whatsapp.net";const _="@s.whatsapp.net";t.WA_USER_DOMAIN=_;t.WA_USER_JID_SUFFIX="s.whatsapp.net";const h=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,g=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,m="@lid";t.LID_DOMAIN=m;t.LID_SUFFIX="lid";const y=/^([1-9][0-9]{0,14})@lid$/,S=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,E=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,v=/^([0-9a-fA-F]{18,32})@call$/;t.SURVEY_USER_JID="16505361212@s.whatsapp.net";const T=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function C(e){return`${e}@msgr`}function A(e){if(e.endsWith(_))return e.slice(0,-_.length);if(e.endsWith(u))return e.slice(0,-u.length);if(e.endsWith(m))return e.slice(0,-m.length);throw new Error(`userIdFromJid called with non-user jid "${e}"`)}function b(e,t){return`${w(e)}:${t}@lid`}function P(e){return e.split("@")[0]}function O(e){const t=e.split("@")[0].split(":"),n=t[0],r=t[1];return{userId:n,deviceID:parseInt(r,10)}}function M(e){return O(e).deviceID}function I(e){return e.endsWith(_)||e.endsWith(u)||e.endsWith(m)?e:null}function w(e){if(!e.endsWith(m))throw new Error(`lidFromLidUserJid called with non-LidUserJid "${e}"`);return e.slice(0,-m.length)}function R(e){const t=e.split("@");let n=t[0];const r=t[1];return n=n.split(":")[0],n=n.split(".")[0],`${n}@${r}`}function N(e){const[t,n]=e.split("@"),[r,i]=t.split(":"),[a,o]=r.split(".");return{user:a,device:i,agent:o,server:n}}function L(e){switch(e.jidType){case"lidUser":case"msgrUser":case"phoneUser":return e.userJid;case"group":return e.groupJid;case"status":return e.statusJid;case"lidDevice":case"msgrDevice":case"phoneDevice":return e.deviceJid;case"broadcast":return e.broadcastJid;case"call":return e.callJid;default:return(0,i.default)(e.jidType)}}function D(e){if(e===s)return{jidType:"status",statusJid:s};if(g.test(e))return{jidType:"phoneUser",userJid:e};if(p.test(e))return{jidType:"msgrUser",userJid:e};if(f.test(e)){return{jidType:"msgrUser",userJid:C(e.substr(0,e.indexOf(":")))}}return h.test(e)?{jidType:"phoneDevice",deviceJid:e}:d.test(e)?{jidType:"msgrDevice",deviceJid:e}:c.test(e)?{jidType:"group",groupJid:e.endsWith(l)?e:`${e}@g.us`}:E.test(e)?{jidType:"broadcast",broadcastJid:e}:v.test(e)?{jidType:"call",callJid:e}:y.test(e)?{jidType:"lidUser",userJid:e}:S.test(e)?{jidType:"lidDevice",deviceJid:e}:{jidType:"unknown"}}function k(e){const t=D(e);return"unknown"===t.jidType?e:"status"===t.jidType?t.statusJid:(t.jidType,L(t).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3"))}function U(e){return e.endsWith(l)?e:null}function G(e,t){if(e.endsWith(_))return t.phoneUser(e);if(e.endsWith(u))return t.msgrUser(e);if(e.endsWith(m))return t.lidUser(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function x(e,t){if(e.endsWith(_))return t.user(e);if(null!=U(e))return t.group(e);throw new Error(`Can not switch on chat jid ${e}`)}function B(e){if(e.endsWith(_))return _;if(e.endsWith(u))return u;if(e.endsWith(m))return m;throw new Error(`userDomainFromJid called with non-user jid "${e}"`)}function F(e){return e}function j(e){return e}function Y(e){return e}function K(e){return e}function W(e){return e}function H(e){return e}function V(e){return e}function $(e){return e}function z(e){return e}},611782:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(615688),i=(0,n(135174).memoizeWithArgs)((function(e){return(0,r.encodeB64)(function(e,t){let n,r,i,o;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let d=1732584193,p=-271733879,f=-1732584194,_=271733878;for(let t=0;t<e.length;t+=16)n=d,r=p,i=f,o=_,d=s(d,p,f,_,e[t],7,-680876936),_=s(_,d,p,f,e[t+1],12,-389564586),f=s(f,_,d,p,e[t+2],17,606105819),p=s(p,f,_,d,e[t+3],22,-1044525330),d=s(d,p,f,_,e[t+4],7,-176418897),_=s(_,d,p,f,e[t+5],12,1200080426),f=s(f,_,d,p,e[t+6],17,-1473231341),p=s(p,f,_,d,e[t+7],22,-45705983),d=s(d,p,f,_,e[t+8],7,1770035416),_=s(_,d,p,f,e[t+9],12,-1958414417),f=s(f,_,d,p,e[t+10],17,-42063),p=s(p,f,_,d,e[t+11],22,-1990404162),d=s(d,p,f,_,e[t+12],7,1804603682),_=s(_,d,p,f,e[t+13],12,-40341101),f=s(f,_,d,p,e[t+14],17,-1502002290),p=s(p,f,_,d,e[t+15],22,1236535329),d=l(d,p,f,_,e[t+1],5,-165796510),_=l(_,d,p,f,e[t+6],9,-1069501632),f=l(f,_,d,p,e[t+11],14,643717713),p=l(p,f,_,d,e[t],20,-373897302),d=l(d,p,f,_,e[t+5],5,-701558691),_=l(_,d,p,f,e[t+10],9,38016083),f=l(f,_,d,p,e[t+15],14,-660478335),p=l(p,f,_,d,e[t+4],20,-405537848),d=l(d,p,f,_,e[t+9],5,568446438),_=l(_,d,p,f,e[t+14],9,-1019803690),f=l(f,_,d,p,e[t+3],14,-187363961),p=l(p,f,_,d,e[t+8],20,1163531501),d=l(d,p,f,_,e[t+13],5,-1444681467),_=l(_,d,p,f,e[t+2],9,-51403784),f=l(f,_,d,p,e[t+7],14,1735328473),p=l(p,f,_,d,e[t+12],20,-1926607734),d=c(d,p,f,_,e[t+5],4,-378558),_=c(_,d,p,f,e[t+8],11,-2022574463),f=c(f,_,d,p,e[t+11],16,1839030562),p=c(p,f,_,d,e[t+14],23,-35309556),d=c(d,p,f,_,e[t+1],4,-1530992060),_=c(_,d,p,f,e[t+4],11,1272893353),f=c(f,_,d,p,e[t+7],16,-155497632),p=c(p,f,_,d,e[t+10],23,-1094730640),d=c(d,p,f,_,e[t+13],4,681279174),_=c(_,d,p,f,e[t],11,-358537222),f=c(f,_,d,p,e[t+3],16,-722521979),p=c(p,f,_,d,e[t+6],23,76029189),d=c(d,p,f,_,e[t+9],4,-640364487),_=c(_,d,p,f,e[t+12],11,-421815835),f=c(f,_,d,p,e[t+15],16,530742520),p=c(p,f,_,d,e[t+2],23,-995338651),d=u(d,p,f,_,e[t],6,-198630844),_=u(_,d,p,f,e[t+7],10,1126891415),f=u(f,_,d,p,e[t+14],15,-1416354905),p=u(p,f,_,d,e[t+5],21,-57434055),d=u(d,p,f,_,e[t+12],6,1700485571),_=u(_,d,p,f,e[t+3],10,-1894986606),f=u(f,_,d,p,e[t+10],15,-1051523),p=u(p,f,_,d,e[t+1],21,-2054922799),d=u(d,p,f,_,e[t+8],6,1873313359),_=u(_,d,p,f,e[t+15],10,-30611744),f=u(f,_,d,p,e[t+6],15,-1560198380),p=u(p,f,_,d,e[t+13],21,1309151649),d=u(d,p,f,_,e[t+4],6,-145523070),_=u(_,d,p,f,e[t+11],10,-1120210379),f=u(f,_,d,p,e[t+2],15,718787259),p=u(p,f,_,d,e[t+9],21,-343485551),d=a(d,n),p=a(p,r),f=a(f,i),_=a(_,o);return new Uint8Array([255&d,d>>>8&255,d>>>16&255,d>>>24&255,255&p,p>>>8&255,p>>>16&255,p>>>24&255,255&f,f>>>8&255,f>>>16&255,f>>>24&255,255&_,_>>>8&255,_>>>16&255,_>>>24&255])}(function(e){let t;const n=[];for(n[(e.length>>2)-1]=0,t=0;t<n.length;t+=1)n[t]=0;const r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n}(e),8*e.length))}),(e=>e));function a(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function o(e,t,n,r,i,o){return a((s=a(a(t,e),a(r,o)))<<(l=i)|s>>>32-l,n);var s,l}function s(e,t,n,r,i,a,s){return o(t&n|~t&r,e,t,i,a,s)}function l(e,t,n,r,i,a,s){return o(t&r|n&~r,e,t,i,a,s)}function c(e,t,n,r,i,a,s){return o(t^n^r,e,t,i,a,s)}function u(e,t,n,r,i,a,s){return o(n^(t|~r),e,t,i,a,s)}t.default=i},145095:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(null==e)throw new Error(`Unexpected null or undefined: ${t}`);return e}},5298:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=n;const r=function(){if(t===n){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];t=e.call(this,...i)}return t};return r.reset=()=>{t=n},r};const n={}},240277:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDigits=function(e){const t=e.match(/\d+/g);return null!=t?t.join(""):""},t.findCC=p,t.formatPhone=f,t.formattedPhoneNumber=function(e){return f((0,o.phoneNumberFromJid)(e))},t.isPotentiallyPhoneNumber=function(e){return _.test(e)},t.isPotentiallyValid=function(e,t){if(!/^\d+$/.test(t))return!1;const n=u[e]||d(e);if(!n)return!1;return"number"==typeof n.lengths?n.lengths===t.length:n.lengths.includes(t.length)},t.phoneCC=function(e){return p(e)};var i=r(n(81574)),a=n(989181),o=n(252230);const s=/^(1|2[07]|3[0-469]|4[013-9]|5[1-8]|6[0-6]|7|8[1246]|9[0-58])/,l=new Map;class c{constructor(e){let t;if(Array.isArray(e)){t=e[0];let n=e[1];null!=n&&-1!==n&&(Array.isArray(n)||(n=[n]),this._leadins=n.map((function(e){return new RegExp("^("+e+")")}))),this._formatString=e[2]}else t=e;this._regex=new RegExp(`^${(0,a.inflatePhoneRegex)(t)}$`)}testAndFormat(e){if(!this._regex.test(e)||!this._checkLeadins(e))return!1;if("string"==typeof this._formatString)return e.replace(this._regex,this._formatString);const t=this._regex.exec(e);return null!=t?t.slice(1).join(null!=this._formatString?"-":" "):void 0}_checkLeadins(e){return!this._leadins||this._leadins.some((function(t){return t.test(e)}))}}const u={};function d(e){const t=null!=i.default[e]?JSON.parse(`[${i.default[e]}]`):null;if(null==t)return null;const n=t.pop();return u[e]={lengths:n,formats:t.map((function(e){return new c(e)}))}}function p(e){const t=e.match(s);return t?t[0]:e.length>=3?e.substring(0,3):e}function f(e){let t=l.get(e);return null==t&&(t=function(e){const t=e.length>0&&"+"===e[0]?e.substring(1):e,n=p(t);if(!n)return t;const r=t.substring(n.length),i=u[n]||d(n);if(!i)return"+"+n+" "+r;const a=i.formats;for(let e=0;e<a.length;e++){const t=a[e].testAndFormat(r);if(null!=t&&!1!==t&&""!==t)return"+"+n+" "+t}return"+"+n+" "+r}(e),l.set(e,t)),t}const _=/^\+*[\d ()]+$/},287040:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.asyncChain=function(e,t){if(e.success)return t(e.value);return Promise.resolve(a(e.error))},t.asyncMapError=c,t.asyncMapResult=s,t.catchError=function(e){return function(){var t=(0,i.default)((function*(t){yield c(t,e)}));return function(){return t.apply(this,arguments)}}()},t.chain=function(e,t){if(e.success)return t(e.value);return a(e.error)},t.makeError=a,t.makeResult=o,t.mapError=function(e,t){if(e.success)return o(e.value);return a(t(e.error))},t.mapResult=function(e,t){if(!e.success)return a(e.error);return o(t(e.value))},t.onResult=function(e){return t=>s(t,e)};var i=r(n(311504));function a(e){return{success:!1,error:e}}function o(e){return{success:!0,value:e}}function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e,t){if(!e.success)return a(e.error);return o(yield t(e.value))}))).apply(this,arguments)}function c(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){if(e.success)return o(e.value);return a(yield t(e.error))}))).apply(this,arguments)}},657319:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShiftTimer=void 0;function n(e){if(!(e>=0))throw new Error("ShiftTimer must be given delay >= 0")}t.ShiftTimer=class{constructor(e){this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,this._run=()=>{const e=this._arg,t=this._foo;this._rafId=0,this._timer=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0,t(e)},this.onOrBefore=(e,t)=>{n(e);const r=Date.now()+e,i=this._upperBound;if(0!==i&&i<r)return;const a=this._lowerBound;0!==a&&r<a||(this._upperBound=r,this._rafId||this._timer&&!(r<this.ts)||this._setDelay(r,e,t))},this.forceRunNow=e=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._arg=e,this._run()},this.cancel=()=>{this._timer&&clearTimeout(this._timer),this._rafId&&cancelAnimationFrame(this._rafId),this._timer=0,this._rafId=0,this.ts=0,this._timerTs=0,this._upperBound=0,this._lowerBound=0,this._arg=void 0},this._foo=e}onOrBeforeRepaint(e){if(this._rafId)return;const t=Date.now(),n=this._lowerBound;if(0!==n&&t<n)return;const r=this._upperBound;(0===r||t<r)&&(this._upperBound=t),this._timer&&(clearTimeout(this._timer),this._timer=0),(!this.ts||this.ts>t)&&(this.ts=t),this._arg=e,this._rafId=requestAnimationFrame(this._run)}onOrAfter(e,t){n(e);const r=Date.now()+e,i=this._lowerBound;if(0!==i&&r<i)return;const a=this._upperBound;0!==a&&a<r||(this._lowerBound=r,(!this._timer||this.ts<r)&&this._setDelay(r,e,t))}debounce(e,t){n(e),this._debounce(Date.now(),e,t)}debounceAndCap(e,t,r){n(e),n(t);const i=Date.now(),a=i+t,o=this._lowerBound,s=this._upperBound;(0===o||o<=a)&&(0===s||a<s)&&(this._upperBound=a),this._debounce(i,e,r)}forceRunNowIfScheduled(){this._timer?(clearTimeout(this._timer),this._run()):this._rafId&&(cancelAnimationFrame(this._rafId),this._run())}isScheduled(){return 0!==this._timer||0!==this._rafId}_debounce(e,t,n){const r=e+t,i=this._lowerBound;if(0!==i&&r<i)return;const a=this.ts,o=this._upperBound;0!==o&&o<r?a<o&&this._setDelay(o,o-e,n):a<r&&this._setDelay(r,t,n)}_setDelay(e,t,n){if(this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._arg=n,this.ts=e,this._timer){const t=e-this._timerTs;if(-16<t&&t<16)return;clearTimeout(this._timer)}this._timer=setTimeout(this._run,t),this._timerTs=e}}},802821:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DO_NOT_RESCHEDULE=void 0,t.awaitTaskPromise=function(e){return l("awaitTaskPromise").awaitTaskPromise(e)},t.deactivate=function(e){s(e,i.DUMMY_UNIXTIME)},t.getScheduledTime=function(e){return l("getScheduledTime").getScheduledTime(e)},t.registerTask=function(e,t){l("registerTask").registerTask(e,t)},t.reschedule=s,t.rescheduleNow=function(e){s(e,(0,i.unixTime)())},t.startScheduler=function(e){__LOG__(2)`startScheduler invoked`,o||(o=new a(e))};var r=n(237178),i=n(892844);t.DO_NOT_RESCHEDULE="no_reschedule";class a{constructor(e){this._started=!1,this._resolvers={},this._timers={},this._timeoutIDs={},this._taskImplementations=new Map,this._scheduledTimeResolver=e.scheduledTimeResolver}_startTask(e){const t=this._taskImplementations.get(e);null!=t?this._scheduledTimeResolver.get(e).then((n=>{const r=null==n;if(!r&&n===i.DUMMY_UNIXTIME)return void __LOG__(2)`Task ${e} deactivated`;let a=null==n?0:1e3*n-(0,i.unixTimeMs)();a=Math.max(0,a),a=Math.min(a,~(1<<31)),__LOG__(2)`Scheduling task ${e} in ${a}ms`,this._timeoutIDs[e]=setTimeout((()=>{delete this._timeoutIDs[e],__LOG__(2)`Firing task ${e}`,t(r).then((t=>{if("no_reschedule"===t)return new Promise((()=>{}));let n;return t===i.DUMMY_UNIXTIME?(__LOG__(2)`Task ${e} complete, deactivating`,delete this._timers[e],n=i.DUMMY_UNIXTIME):t>=0?(__LOG__(2)`Task ${e} complete, waiting ${t}`,delete this._timers[e],n=(0,i.futureUnixTime)(t)):(__LOG__(2)`Task ${e} will try again later`,n=this._getNextRun(e)),this._scheduledTimeResolver.set(e,n)})).then((()=>{this._startTask(e),this._resolvers[e]&&(this._resolvers[e].forEach((e=>e())),delete this._resolvers[e])})).catch((t=>(__LOG__(2)`Task ${e} failed, try again later: ${t}`,this._scheduledTimeResolver.set(e,this._getNextRun(e)).then((()=>{this._startTask(e)})))))}),a)})):__LOG__(4,void 0,new Error)`Tried to start task ${e} before registering its implementation`}_getNextRun(e){return this._timers[e]||(this._timers[e]=(0,r.createTimer)({jitter:.1,max:1e3*i.HOUR_SECONDS,algo:{type:"fibonacci",first:1e3,second:2e3}})),(0,i.futureUnixTime)(Math.round(this._timers[e]()/1e3))}_registerResolver(e,t){this._resolvers[e]||(this._resolvers[e]=[]),this._resolvers[e].push(t)}awaitTaskPromise(e){return new Promise((t=>{this._registerResolver(e,t)}))}reschedule(e,t){this._started?(this._scheduledTimeResolver.set(e,t),null!=this._timeoutIDs[e]&&clearTimeout(this._timeoutIDs[e]),this._startTask(e)):this._scheduledTimeResolver.set(e,t)}registerTask(e,t){this._started||(this._started=!0),this._taskImplementations.set(e,t),this._startTask(e)}getScheduledTime(e){return this._scheduledTimeResolver.get(e)}}let o=null;function s(e,t){l("reschedule").reschedule(e,t)}function l(e){if(o)return o;throw new Error(`TaskScheduler::${e} called before startScheduler`)}},892844:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.YEAR_SECONDS=t.WEEK_SECONDS=t.WEEK_MILLISECONDS=t.MonotonicTimer=t.MINUTE_MILLISECONDS=t.MAX_INT=t.HOUR_SECONDS=t.HOUR_MILLISECONDS=t.DUMMY_UNIXTIME=t.DAY_SECONDS=t.DAY_MILLISECONDS=void 0,t.cappedMillisecondsUntil=_,t.castLongIntToUnixTime=function(e){return"number"!=typeof e?(0,r.hexLongIsNegative)(e)?u:c:f(e)},t.castToUnixTime=f,t.delayUntil=function(e){const t=_(e);return new Promise((e=>{setTimeout(e,t)}))},t.futureUnixTime=function(e,t){const n=null!=t?t:h();return f(Math.ceil(n+Math.max(e,0)))},t.getClockSkew=function(){return p},t.happenedWithin=function(e,t){return S(h(),e,t)},t.happenedWithinAt=S,t.isInFuture=function(e){return g(e)>0},t.isOverflowTime=function(e){return e<u||e>c},t.isWithinNext24h=function(e){return e-h()<=a},t.midnight=function(){return f((new Date).setHours(0,0,0,0)/1e3-p)},t.midnightOn=function(e){return f(E(e).setHours(0,0,0,0)/1e3-p)},t.monotonicTime=m,t.monotonicTimeSince=y,t.oldest=function(e,t){return e<t?e:t},t.pastUnixTime=function(e,t){const n=null!=t?t:h();return f(Math.ceil(n-Math.max(e,0)))},t.performanceAbsoluteNow=function(){return Date.now()},t.sameDay=function(e,t){if(Math.abs(e-t)>a)return!1;const n=d.time===e?d.day:E(e+p).getDay(),r=d.time===t?d.day:E(t+p).getDay();return d.time=t,d.day=r,n===r},t.secondsUntil=g,t.setClockSkew=function(e){p=e},t.timeSince_USE_ONLY_IF_APPROVED=function(e){return Math.max(h()-e,0)},t.timeoutFor=function(e,t){const n=h(),r=Math.max(e+t-n,0);return Math.min(1e3*r,~(1<<31))},t.toDate=E,t.toHttpHeaderDate=function(e){return E(e).toUTCString()},t.unixTime=h,t.unixTimeMs=function(){return Date.now()-1e3*p},t.unixTimeWithoutClockSkewCorrection=function(){return f(Date.now()/1e3)},t.unskewedDate_USE_ONLY_IF_APPROVED=function(){return new Date};var r=n(787614);const i=3600;t.HOUR_SECONDS=i;const a=86400;t.DAY_SECONDS=a;t.WEEK_SECONDS=604800;t.YEAR_SECONDS=31536e3;t.MINUTE_MILLISECONDS=6e4;const o=36e5;t.HOUR_MILLISECONDS=o;const s=864e5;t.DAY_MILLISECONDS=s;t.WEEK_MILLISECONDS=6048e5;const l=1<<31;t.DUMMY_UNIXTIME=l;const c=2147483647;t.MAX_INT=c;const u=-2147483647,d={time:0,day:-4};let p=0;function f(e){return Math.max(u,Math.min(0|e,c))}function _(e){const t=Math.max(e-h(),0);return Math.min(1e3*t,~(1<<31))}function h(){return f(Date.now()/1e3-p)}function g(e){return Math.max(e-h(),0)}function m(){return performance.now()}function y(e){return Math.floor(performance.now()-e)}function S(e,t,n){return Math.abs(e-t)<=n}function E(e){return new Date(1e3*e)}t.MonotonicTimer=class{constructor(){const e=m();this._initTime=e,this._startTime=e}reset(){this._startTime=m()}elapsed(){return y(this._startTime)}cumulative(){return y(this._initTime)}}},551737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBoolean=function(e){return"boolean"==typeof e},t.isFunction=function(e){return"function"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e}},832428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatArrayBuffers=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(r);let a=0;return t.forEach((e=>{i.set(new Uint8Array(e),a),a+=e.byteLength})),i.buffer}},530138:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=[],r=e.length,i=t.length,a=Math.max(r,i);for(let o=0;o<a;o++)o<r&&n.push(e[o]),o<i&&n.push(t[o]);return n}},348206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayMoveMutate=t.arrayMove=void 0;const n=function(e,t,n){const r=n<0?e.length+n:n,i=e.splice(t,1)[0];e.splice(r,0,i)};t.arrayMoveMutate=n;t.arrayMove=function(e,t,r){const i=e.slice();return n(i,t,r),i}},263116:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n,r=!1;for(n=0;n<e.length;n++)if(e[n]===t){r=!0;break}if(r){const t=e[n];e.splice(n,1),e.unshift(t)}}},713752:(e,t)=>{"use strict";function n(e,t){return e===t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;if(e===t)return!0;if(e.length!==t.length)return!1;return e.every(((e,n)=>r(e,t[n])))}},420177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.b64Equal=function(e,t){const n=e.length,r=t.length;switch(n-r){case-2:return 61===t.charCodeAt(n)&&61===t.charCodeAt(n+1)&&t.substr(0,n)===e;case-1:return 61===t.charCodeAt(n)&&t.substr(0,n)===e;case 0:return e===t;case 1:return 61===e.charCodeAt(r)&&e.substr(0,r)===t;case 2:return 61===e.charCodeAt(r)&&61===e.charCodeAt(r+1)&&e.substr(0,r)===t;default:return!1}}},613353:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=atob(e);let r=0;for(let e=0;e<n.length;e++){const i=n.charCodeAt(e);r=((r<<4)+(i>>4))%t,r=((r<<4)+(15&i))%t}return r}},278403:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return null;const t=e.replace(/\s+$/,"");e!==t&&Math.random()<1e-5&&(__LOG__(3,void 0,void 0,!0)`base64 sanitized due to extra whitespace`,SEND_LOGS("media-key-sanitize"));return t}},827194:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}},293131:(e,t,n)=>{"use strict";let r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.dir=function(e){!function(){if(r)return;const e=n(912182).D,t=e.length/2;r=new Int32Array(t),i=new Int32Array(t);for(let n=0,a=0;n<t;n++,a+=2)r[n]=e[a]+(0===n?0:r[n-1]),i[n]=e[a+1]}();for(let t=0;t<e.length;t++){let n=0|e.charCodeAt(t);if(55296<=n&&n<56320){if(++t===e.length)break;const r=e.charCodeAt(t);if(!(56320<=r&&r<57344))continue;n=65536+((1023&n)<<10|1023&r)}else if(56320<=n&&n<57344)continue;if(n<r[0])continue;const a=0|r.length;let o=0,s=a-1|0;for(;o<s;){const e=s+o>>1;if(r[e]>n)s=e-1|0;else{if(r[e+1]>n){s=e;break}o=e+1|0}}const l=i[s],c=r[s]+Math.abs(l)|0;if(n<c)return l<0?"rtl":"ltr"}return}},912182:(e,t)=>{"use strict";t.D=void 0;t.D=[65,26,32,26,73,1,11,1,5,1,6,23,24,31,32,449,451,7,21,2,16,5,14,1,130,4,6,2,4,4,5,1,7,1,2,3,4,1,2,20,21,83,84,140,147,166,167,38,40,49,55,-1,46,-1,2,-1,3,-1,3,-1,2,-56,64,-1,3,-1,2,-1,14,-48,82,-3,4,-101,116,-2,9,-2,12,-23,24,-30,57,-91,102,-58,67,-2,6,-3,4,-24,28,-1,10,-1,4,-1,6,-43,46,-119,167,55,56,1,2,4,12,4,5,3,10,10,12,29,30,2,3,8,10,2,4,22,23,7,8,1,4,4,7,4,10,2,4,2,3,1,9,1,5,2,3,3,7,12,14,7,8,2,7,1,2,6,10,2,4,22,23,7,8,2,3,2,3,2,6,3,27,4,5,1,8,10,12,3,4,1,13,1,2,9,10,3,4,22,23,7,8,2,3,5,8,4,12,1,2,2,5,1,16,2,6,11,19,1,9,2,3,8,10,2,4,22,23,7,8,2,3,5,8,2,3,1,7,2,4,2,12,1,5,2,3,3,7,18,29,1,2,6,9,3,4,4,7,2,3,1,2,2,5,2,5,3,6,12,16,2,3,2,5,3,4,3,6,1,7,1,15,13,27,3,4,8,9,3,4,23,24,16,19,1,4,4,23,3,8,2,6,10,17,1,8,2,3,11,12,3,4,23,24,10,11,5,8,8,9,3,4,2,11,2,9,1,2,2,6,10,11,2,17,11,12,3,4,41,43,4,9,3,4,3,4,2,6,14,18,26,28,2,3,18,21,24,25,9,10,1,3,7,15,3,9,8,14,10,12,3,15,48,49,2,14,7,15,13,50,2,3,1,2,5,6,24,25,1,2,10,11,2,11,1,3,5,6,1,10,10,12,4,36,24,26,27,28,1,2,1,6,10,11,36,54,1,6,1,3,5,54,8,9,6,7,13,50,45,49,1,7,1,3,2,4,25,27,4,7,16,20,13,14,2,4,6,7,15,16,40,41,1,6,1,3,377,378,4,6,7,8,1,2,4,6,41,42,4,6,33,34,4,6,7,8,1,2,4,6,15,16,57,58,4,6,67,72,29,32,16,32,86,88,6,9,639,640,26,31,89,96,13,14,4,18,18,21,2,11,18,32,13,14,3,18,52,54,1,8,8,9,2,13,7,8,1,4,10,48,10,16,89,96,5,7,34,35,1,6,70,80,31,35,4,6,3,7,2,3,6,19,40,42,5,16,44,48,26,32,11,48,23,25,2,5,56,57,1,10,1,2,2,10,6,19,10,16,10,16,14,100,48,49,1,6,1,2,5,6,9,13,27,36,9,14,32,36,2,4,1,4,56,57,1,3,3,4,1,4,2,10,48,56,2,7,15,18,60,67,43,45,11,22,1,14,1,8,4,5,6,7,3,5,1,6,192,256,278,280,6,8,38,40,6,8,8,9,1,2,1,2,1,2,31,33,53,54,7,8,1,4,3,4,7,10,4,6,6,10,13,18,3,4,7,24,1,1,-1,98,1,14,1,17,13,114,1,5,1,3,10,11,1,4,5,11,1,2,1,2,1,2,4,5,11,13,4,9,5,9,2,18,41,470,69,95,1,263,78,528,1,340,256,1024,47,48,47,48,133,139,4,7,2,14,38,39,1,6,1,3,56,63,2,17,23,32,7,8,7,8,7,8,7,8,7,8,7,8,7,8,7,557,3,28,9,13,2,3,5,7,5,9,86,92,3,4,90,91,4,9,43,44,94,95,48,96,45,48,48,64,28,31,50,65,12,16,167,171,99,101,31,32,6592,6656,20989,20992,1165,1232,317,320,28,48,47,64,30,32,80,82,6,48,102,103,55,57,9,51,13,14,3,4,4,5,25,27,1,9,8,16,52,64,68,78,12,36,13,14,38,46,25,36,2,13,30,36,48,49,2,6,2,4,16,17,11,15,7,8,25,26,41,47,2,4,2,13,3,4,8,9,1,3,10,12,32,33,51,52,1,4,2,4,5,7,1,2,1,25,17,19,8,19,6,8,6,8,6,15,7,8,7,8,58,64,117,118,2,3,4,7,10,16,11172,11184,23,27,49,2101,6766,6768,106,144,7,19,5,10,-1,2,-10,11,-532,534,-144,176,-13,14,-2,114,-143,177,26,32,26,37,89,92,6,8,6,8,6,8,3,38,12,13,26,27,19,20,2,3,15,17,14,48,123,128,1,2,1,5,45,48,9,86,2,67,45,176,29,32,49,96,36,45,30,35,38,48,30,31,37,41,14,56,158,160,10,16,36,40,36,40,40,48,52,63,1,145,311,320,22,32,8,160,-287,288,-225,228,-1,3,-5,9,-40,43,-4,5,-165,167,-82,89,-484,488,-8,18,-294,325,-44,46,-153,164,-175,175,1,2,54,69,7,31,10,28,49,53,2,4,7,18,1,3,25,32,10,19,36,41,1,10,18,26,35,36,3,14,52,61,10,14,2,3,16,17,20,31,18,19,28,31,2,3,1,3,6,72,7,8,1,2,4,5,15,16,11,17,47,48,3,16,10,18,2,3,8,10,2,4,22,23,7,8,2,3,5,8,3,4,4,6,2,4,3,5,1,7,1,6,7,163,56,64,2,5,1,2,21,22,1,2,3,33,51,57,1,2,4,6,1,3,4,12,10,176,50,56,4,6,1,3,27,63,51,59,2,3,1,3,4,15,10,48,43,44,1,2,2,8,1,2,1,8,10,64,27,32,2,6,1,10,16,208,47,56,1,3,1,101,83,95,8,10,1,3,8,9,2,3,30,31,2,6,1,2,4,5,3,12,10,80,8,10,42,50,4,5,4,31,1,7,2,4,40,46,2,6,8,17,1,7,2,5,46,59,1,3,9,38,57,320,9,10,38,52,8,18,29,32,32,57,1,8,1,3,1,76,7,8,2,3,38,59,1,10,10,16,6,7,2,3,37,41,2,3,1,2,1,8,10,320,19,21,4,187,1,16,21,63,923,1025,111,112,5,16,196,2944,1071,1072,9,4048,583,9216,569,576,31,32,10,14,2,98,30,37,1,11,48,55,15,25,10,11,7,8,21,26,19,707,91,192,75,80,56,67,13,77,2,3,1,13,2,16,6136,6144,1238,1280,9,8960,287,336,3,20,4,12,396,2704,107,112,13,16,9,16,10,12,1,3,1,4961,246,256,39,41,62,65,9,25,2,9,30,34,59,306,20,128,25,160,85,86,71,72,2,4,1,3,2,4,4,5,12,13,1,2,7,8,65,66,4,6,8,9,7,8,28,29,4,5,5,6,1,4,7,8,340,342,51,52,57,58,57,58,57,58,57,58,8,60,512,567,4,54,8,9,14,15,7,1659,45,55,7,9,10,14,2,370,44,48,10,1296,-208,215,-109,116,-1445,1447,-270,542,31,32,58,64,61,118,29,42,44,48,9,16,2,3504,42718,42752,4149,4160,222,224,5762,5776,7473,10576,542,2048,4939,786432,65534,65536,65534]},948447:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){if(e<=0)throw new RangeError("BitArray:numBits should be positive");this._numBits=e,this._array=new Uint8Array(Math.ceil(this._numBits/8))}get(e){const[t,n]=this._getArrayIndexOffset(e);return Boolean(this._array[t]>>n&1)}set(e){const[t,n]=this._getArrayIndexOffset(e);this._array[t]|=1<<n}unset(e){const[t,n]=this._getArrayIndexOffset(e);this._array[t]&=~(1<<n)}toggle(e){const[t,n]=this._getArrayIndexOffset(e);this._array[t]^=1<<n}clear(){this._array=new Uint8Array(Math.ceil(this._numBits/8))}toArray(){const e=[];for(let t=0;t<this._numBits;t++)e.push(this.get(t));return e}toString(){return this.toArray().map((e=>e?"1":"0")).join("")}get length(){return this._numBits}_getArrayIndexOffset(e){if(e<0||e>=this._numBits)throw new RangeError("BitArray:index out of bounds");const t=Math.floor(e/8);return[t,e-8*t]}}},229690:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(145095));class a{constructor(e,t,n){this.key=e,this.value=t,this.timestamp=null!=n?n:Date.now(),this.prev=void 0,this.next=void 0}}class o{constructor(){this.start=new a(null,null),this.end=new a(null,null),this.start.next=this.end,this.end.prev=this.start}append(e,t){const n=new a(e,t),r=this.end,o=(0,i.default)(this.end.prev,"this.end.prev");return n.next=r,n.prev=o,r.prev=n,o.next=n,n}prepend(e,t){const n=new a(e,t),r=this.start,o=(0,i.default)(this.start.next,"this.start.next");return n.prev=r,n.next=o,r.next=n,o.prev=n,n}popEnd(){const e=(0,i.default)(this.end.prev,"this.end.prev");if(e===this.start)return;const t=(0,i.default)(e.prev,"entry.prev"),n=(0,i.default)(e.next,"entry.next");return t.next=n,n.prev=t,e.next=void 0,e.prev=void 0,e}popFront(){const e=(0,i.default)(this.start.next,"this.start.next");if(e===this.end)return;const t=(0,i.default)(e.prev,"entry.prev"),n=(0,i.default)(e.next,"entry.next");return t.next=n,n.prev=t,e.next=void 0,e.prev=void 0,e}peekFront(){const e=(0,i.default)(this.start.next,"this.start.next");if(e!==this.end)return e}peekEnd(){const e=(0,i.default)(this.end.prev,"this.end.prev");if(e!==this.start)return e}remove(e){const t=(0,i.default)(e.prev,"entry.prev"),n=(0,i.default)(e.next,"entry.next");return t.next=n,n.prev=t,e.next=void 0,e.prev=void 0,e}stats(){let e=this.start,t=0;for(;e!==this.end;)e=(0,i.default)(e.next,"entry.next"),t+=1;return t-1}}t.default=class{constructor(){this.keyMap=new Map,this.entryList=new o}lookup(e){const t=this.keyMap.get(e);if(t){this.entryList.remove(t);const e=this.entryList.append(t.key,t.value);return this.keyMap.set(e.key,e),t.value}}add(e,t){let n=this.keyMap.get(e);return n?n.value=t:(n=this.entryList.append(e,t),this.keyMap.set(e,n)),t}expireKeys(e){let t=this.entryList.peekFront();for(;t&&t.timestamp<e;)this.entryList.popFront(),this.keyMap.delete(t.key),t=this.entryList.peekFront()}printStats(){console.log("========================== STATS ============================="),console.log("entry list: ",this.entryList.stats()),console.log("map keys: ",this.keyMap.size)}}},142430:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LruCache=void 0;var r=n(657319);class i{constructor(e,t){this.key=e,this.value=t,this.prev=null,this.next=null}}t.LruCache=class{constructor(e){var t;this._keyToNode=new Map,this.purgeNow=()=>{for(let e=this._dummyTail.prev;this._currentSize>this._sizeLimit&&e!==this._dummyHead;e=e?e.prev:null){if(null==e)throw new Error("The linked list is not constructed properly.");const{key:t,value:n}=e;this._shouldEvict(t,n)&&(this.delete(t),this._onEvict&&this._onEvict(t,n))}this._onPurge&&this._onPurge(this._keyToNode)},this._sizeLimit=e.sizeLimit,this._getSize=e.getSize,this._onPurge=e.onPurge,this._shouldEvict=null!==(t=e.shouldEvict)&&void 0!==t?t:()=>!0,this._onEvict=e.onEvict,this._onAdd=e.onAdd,this._onDelete=e.onDelete,this._currentSize=0,this._dummyHead=new i("dummy-head",null),this._dummyTail=new i("dummy-tail",null),this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._purgeTimer=new r.ShiftTimer((()=>this.purgeNow()))}get(e){if(!this._keyToNode.has(e))return null;const t=this._keyToNode.get(e);if(null==t)return null;const n=t.prev,r=t.next;n&&(n.next=r),r&&(r.prev=n);const i=this._dummyHead.next;if(null==i)throw new Error("The linked list is not constructed properly.");return this._dummyHead.next=t,i.prev=t,t.prev=this._dummyHead,t.next=i,t.value}has(e){return this._keyToNode.has(e)}touch(e){this.get(e)}put(e,t){0!==this._sizeLimit&&(this._getSize(t)>this._sizeLimit?__LOG__(3)`Blob size is larger than the limit of the whole store.`:(this.delete(e),this._add(e,t),this.schedulePurge()))}_add(e,t){const n=new i(e,t);this._keyToNode.set(e,n);const r=this._dummyHead.next;if(null==r)throw new Error("The linked list is not constructed properly.");this._dummyHead.next=n,r.prev=n,n.prev=this._dummyHead,n.next=r,this._currentSize+=this._getSize(t),this._onAdd&&this._onAdd(e,t)}delete(e){if(!this._keyToNode.has(e))return;const t=this._keyToNode.get(e);if(null==t)return;this._currentSize-=this._getSize(t.value);const n=t.prev,r=t.next;n&&(n.next=r),r&&(r.prev=n),this._keyToNode.delete(e),this._onDelete&&this._onDelete(e,t.value)}clear(){this._keyToNode.clear(),this._currentSize=0,this._dummyHead.next=this._dummyTail,this._dummyTail.prev=this._dummyHead,this._onClear&&this._onClear()}schedulePurge(){this._purgeTimer.onOrBefore(1e3)}}},109006:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t){this._valueFn=e,this._heap=[],this._load(t)}size(){return this._heap.length}_load(e){(null==e?void 0:e.length)&&e.forEach((e=>{this.push(e)}))}_swap(e,t){const n=this._heap[t];this._heap[t]=this._heap[e],this._heap[e]=n}_siftUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0===e)return;const t=this._getParent(e),n=2*t+1,r=2*t+2,i=this._heap.length;if(e>=i)return;let a=this._getVal(t),o=t;if(n<i){const e=this._getVal(n);a>e&&(o=n,a=e)}if(r<i){a>this._getVal(r)&&(o=r)}o!==t&&(this._swap(o,t),this._siftUp(t))}_doHeapify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=2*e+1,n=2*e+2,r=this._heap.length;if(e>=r)return;let i=this._getVal(e),a=e;if(t<r){const e=this._getVal(t);i>e&&(a=t,i=e)}if(n<r){i>this._getVal(n)&&(a=n)}a!==e&&this._swap(a,e),t<r&&this._doHeapify(t),n<r&&this._doHeapify(n)}_getVal(e){return this._valueFn(this._heap[e])}_getParent(e){return e%2==0?(e-2)/2:(e-1)/2}push(e){this._heap.push(e);const t=this._heap.length-1;this._siftUp(t)}pull(){const e=this._heap.shift();return this.heapify(),e}heapify(){this._doHeapify(0)}peek(){return this._heap[0]}}},355205:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(145095));class a{constructor(e){this._children={},this._indices=[],e&&(this._data=e)}static fromBackwardsStrings(e,t){return e.reduce(((e,t,n)=>e.addBackwardsString(t,n)),new a(t))._optimize()}addBackwardsString(e,t){let n=e.length-1,r=this;for(;n>=0;){const i=e.charAt(n);r._addIndex(t),r=r.get(i)||r.set(i,new a),n--}return r._addIndex(t),this}static fromForwardsStrings(e,t){return e.reduce(((e,t,n)=>e.addForwardsString(t,n)),new a(t))._optimize()}addForwardsString(e,t){let n=0,r=this;for(;n<e.length;){const i=e.charAt(n);r._addIndex(t),r=r.get(i)||r.set(i,new a),n++}return r._addIndex(t),this}set(e,t){return this._children[e]=t,t}get(e){return this._children[e]}getChildren(){return Object.keys(this._children).map((e=>({prefix:e,node:(0,i.default)(this.get(e),"this.get(prefix)")})))}hasChildren(){return!function(e){for(const t in e)return!1;return!0}(this._children)}search(e){const t=this._data;if(!t)return[];let n=this;for(let t=0;t<e.length&&n;t++){const r=e[t];n=n.get(r)}if(!n)return[];return n.getIndices().map((e=>t[e]))}_addIndex(e){this._indices.push(e)}getIndices(){const e=this._indices,t=Object.keys(this._children);return 1===t.length&&0===this._indices.length?this._children[t[0]].getIndices():e}_optimize(){if(!this.hasChildren())return this;const e=Object.keys(this._children),t=this._children[e[0]]._indices;return e.forEach((e=>{this._children[e]._optimize()})),1===e.length&&this._indices.length===t.length&&(this._indices=[]),this}testOnlyGetChildrenProperty(){return this._children}testOnlyGetIndicesProperty(){return this._indices}}t.default=a},863438:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;return e.every(((e,n)=>e===t[n]))}},662971:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.defaults=void 0,t.exponentialBackoffIterator=function*(e){const{factor:t,jitter:n,maxTimeout:r,minTimeout:s,retries:l}=(0,i.default)((0,i.default)({},o),e);let c=0;for(const e of(0,a.default)(t)){if(c++,c>l)return;const t=Math.random()*n*2-n+1;yield Math.min(s*e*t,r)}};var i=r(n(73982)),a=r(n(903691));const o={factor:2,jitter:0,maxTimeout:1/0};t.defaults=o},903691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function*(e){let t=1;for(;;)yield t,t*=e}},685396:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filterIterator=function*(e,t){let n=0;for(const r of e)t(r,n)&&(yield r),n++},t.first=function(e){for(const t of e)return t;return},t.iteratorFromArray=function*(e){for(const t of e)yield t},t.mapIterator=function*(e,t){let n=0;for(const r of e)yield t(r,n),n++},t.rangeIterator=function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(0===n)throw new TypeError("Step can't be zero.");if(n>0){if(e>t)return;for(let r=e;r<t;r+=n)yield r}else{if(e<t)return;for(let r=e;r>t;r+=n)yield r}},t.takeIterator=function*(e,t){if(t<0)throw new TypeError("Count must be a positive integer");let n=0;for(const r of e){if(n>=t)return;yield r,n++}}},60248:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.findLink=C,t.findLinks=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!v.test(e))return[];E.lastIndex=0;const n=[];let r;for(;r=T(e);){const e=A(r,t);e&&n.push(e)}return n},t.validateEmail=function(e){const t=C(e);return!t||t.url!==e||"mailto:"!==t.scheme||null==t.username||""===t.username||null!=t.params&&""!==t.params||null!=t.anchor&&""!==t.anchor?null:t};var i=n(147193),a=r(n(728770));const o=Array.from(i.TLD).join("|"),s=/^https?:\/\/$/gi,l="\\w|[^\\s\0-«»‘’“”]|%[0-9a-f][0-9a-f]",c=`${o}|xn--(?:${l})+`,u=`(?:${l})|(?:${l})(?:${l}|-)*(?:${l})`,d=`(?:${l}|[^\\s%])`,p=`[@!.?,(\\[{<«‘“:]*(?!${d}|#)`,f="0-9a-z!#$%&'*+/=?^_`{|}~\\-",_=`(^|\\W\\.|[^/\\w.]|_)((?:http|https)://|mailto:)?(${`\\b\\w[${f}]*(?:\\.[${f}]+)*`}@)?(${`(?!_)(?:(?:${u})\\.)+(${c})(?!\\.${u})`})(?:(?!${u})|(?=_))(?:(?=[^:/?#])|(:\\d{1,5})?(${`/${d}*?`})?(${`\\?(?!${p})${d}*?`})?(${`#${d}*?`})?(?=${p}))`,h=7,g=8,m=9,y=new Map([[34,34],[41,40],[62,60],[93,91],[125,123],[187,171],[8217,8216],[8221,8220]]),S=new Map([[34,34],[40,41],[60,62],[91,93],[123,125],[171,187],[8216,8217],[8220,8221]]),E=new RegExp(`${_}`,"ig"),v=new RegExp(`\\.(?:${c})`,"i");function T(e){try{return E.exec(e)}catch(t){return __LOG__(4,void 0,new Error,!0)`text size: ${e.length}, error: ${String(t)}`,SEND_LOGS("linkify-regex-error"),null}}function C(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return v.test(e)?(E.lastIndex=0,A(T(e),t)):null}function A(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;const n=e[1].length;let r=e[0];const o=e.index+n,{index:l}=e,c="_"===e[1];if(c&&l-1&&/\S/.test(e.input[l-1]))return null;const u=e[5];if(u&&u.startsWith("xn--")&&!i.TLD.has(a.default.toUnicode(u)))return null;if(e[6]){const t=parseInt(e[6].slice(1),10);if("0"===e[6][1]||!(0<t&&t<65536))return null}const d=[m,g,h].find((t=>e&&e[t]))||0;if(d){const t=[];let i=e[d];"_"===i.slice(-1)&&"_"===r[o-1]&&(r=r.slice(0,-1),e[d]=i=i.slice(0,-1));let a=0,s=0;for(let e=0;e<i.length;e++){const n=i.charCodeAt(e);n===s?(s=t.pop()||0,0===s&&(a=e)):S.has(n)?(0!==s&&t.push(s),s=S.get(n)):y.has(n)||0===s&&(a=e)}if(a!==i.length-1){const t=e.slice(2,d);t.splice(3,1),r=t.filter((e=>e)).join("")+i.slice(0,a+1),E.lastIndex=o+r.length}else r=r.slice(n)}else r=r.slice(n);let p=r,f=e[2];const _=Boolean(f&&f.match(s));if(t&&!_)return null;f?f=f.toLowerCase():(f=0===p.toLowerCase().indexOf("irc.")?"irc://":0===p.toLowerCase().indexOf("ftp.")?"ftp://":e[3]?"mailto:":"http://",p=f+p);const v=e[4];return{href:p,url:r,index:o,input:e.input,scheme:f,username:e[3],domain:v,port:e[6],path:e[h],params:e[g],anchor:e[m],isHttp:_}}},147193:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TLD=void 0;const n=new Set(["abb","abbott","abudhabi","ac","academy","accountants","ad","ads","adult","ae","aero","af","afl","africa","ag","agency","ai","aig","al","am","amsterdam","anz","ao","apartments","app","aq","ar","army","art","as","asia","at","au","auction","audi","audio","auto","autos","aw","aws","ax","axa","az","ba","baby","band","bank","bar","barclays","basketball","bb","bbva","bd","be","beauty","beer","berlin","best","bet","bf","bg","bh","bi","bible","bid","bike","bingo","bio","biz","bj","black","blog","blue","bm","bmw","bn","bnpparibas","bo","bond","bot","boutique","box","br","bradesco","broker","brussels","bs","bt","build","builders","business","buzz","bw","by","bz","bzh","ca","cab","cafe","cam","camera","camp","canon","capital","car","cards","care","career","careers","cars","casa","cash","casino","cat","cc","cd","center","ceo","cern","cf","cfd","cg","ch","chat","cheap","church","ci","city","ck","cl","claims","click","clinic","clothing","cloud","club","cm","cn","co","coach","codes","coffee","com","community","company","condos","consulting","contact","contractors","cool","coop","country","coupons","courses","cpa","cr","credit","cricket","crs","cu","cv","cw","cx","cy","cyou","cz","dance","date","dating","day","de","deals","delivery","dental","dentist","desi","design","dev","dhl","diamonds","diet","digital","direct","directory","discount","dj","dk","dm","do","doctor","dog","domains","download","dvag","dz","earth","ec","eco","edu","education","ee","eg","email","energy","engineer","engineering","equipment","es","estate","et","eu","eus","events","exchange","expert","express","fail","faith","family","fan","fans","farm","fashion","fi","film","finance","financial","fish","fishing","fit","fitness","fj","flights","flowers","fm","fo","football","forex","forum","foundation","fr","frl","fun","fund","futbol","fyi","ga","gal","gallery","game","games","garden","gay","gd","gdn","ge","gent","gg","gh","gi","gift","gifts","gives","gl","glass","gle","global","gm","gmbh","gold","golf","goog","google","gop","gov","gp","gq","gr","graphics","gratis","green","group","gs","gt","guide","guru","gy","hair","hamburg","haus","health","healthcare","help","hk","hn","holdings","holiday","homes","horse","hospital","host","hosting","hot","house","how","hr","ht","hu","icu","id","ie","il","im","immo","in","inc","info","ink","institute","insure","int","international","investments","io","iq","ir","is","ist","istanbul","it","java","je","jewelry","jm","jo","jobs","jp","ke","kg","kh","ki","kim","kitchen","kiwi","kn","kp","kpmg","kpn","kr","krd","kred","kw","ky","kz","la","land","lat","law","lawyer","lb","lc","leclerc","legal","lgbt","li","lidl","life","limited","limo","link","live","lk","llc","loan","loans","lol","london","love","lr","ls","lt","ltd","ltda","lu","luxe","lv","ly","ma","madrid","makeup","management","market","marketing","markets","mba","mc","md","me","media","melbourne","men","menu","mg","miami","mil","mk","ml","mm","mn","mo","mobi","moda","moe","mom","monash","money","monster","mortgage","moscow","movie","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","navy","nc","ne","net","network","neustar","new","news","nf","ng","ngo","ni","nico","ninja","nl","no","np","nr","nrw","ntt","nu","nyc","nz","observer","om","one","ong","onl","online","ooo","org","ovh","pa","page","paris","partners","parts","party","pay","pe","pet","pf","pg","ph","pharmacy","photo","photography","photos","physio","pics","pictet","pictures","pink","pioneer","pizza","pk","pl","place","plus","pm","pn","poker","porn","post","pr","press","pro","productions","promo","properties","ps","pt","pub","pw","py","qa","quebec","quest","racing","radio","re","realtor","recipes","red","ren","rent","repair","report","rest","restaurant","review","reviews","rio","rip","ro","rocks","rodeo","rs","ru","run","rw","sa","sale","salon","sap","saxo","sb","sbi","sbs","sc","school","science","scot","sd","se","security","services","sex","sexy","sg","sh","sharp","shiksha","shoes","shop","shopping","show","si","site","sk","ski","skin","sky","sl","sm","sn","sncf","so","social","softbank","software","solar","solutions","sony","soy","space","sport","spot","sr","srl","st","statebank","storage","store","stream","studio","study","style","su","sucks","supply","support","surf","sv","swiss","sx","sy","sydney","systems","sz","taipei","tatar","tax","taxi","tc","td","team","tech","technology","tel","tf","tg","th","tickets","tienda","tips","tires","tj","tk","tl","tm","tn","to","today","tokyo","tools","top","tours","town","toyota","toys","tr","trade","trading","training","travel","tt","tube","tv","tw","tz","ua","ug","uk","university","uno","us","uy","uz","va","vc","ve","vegas","ventures","vet","vg","vi","video","vin","vip","vision","vn","vote","voto","vu","wales","wang","watch","webcam","weber","website","wedding","wf","wien","wiki","win","wine","work","works","world","ws","wtf","xin","xyz","yandex","ye","yoga","yokohama","youtube","yt","za","zip","zm","zone","zw","бел","дети","москва","онлайн","орг","рус","рф","сайт","укр","קום","شبكة","भारत","భారత్","移动"]);t.TLD=n},135174:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoizeCache=r,t.clearAllMemoizeCache=function(){n.forEach((e=>e.clear()))},t.memoizeWithArgs=function(e,t){let n;return function(){n||(n=r());const i=t(...arguments);let a=n.get(i);return null==a&&(a=e(...arguments),n.set(i,a)),a}};const n=[];function r(){const e=new Map;return n.push(e),e}},570185:(e,t)=>{"use strict";function n(e,t){const r=function(){for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];const o=t?t.apply(this,i):i[0];if(null==o)return e.apply(this,i);const s=r.cache;if(s.has(o))return s.get(o);const l=e.apply(this,i);return r.cache=s.set(o,l)||s,l};return r.cache=new(n.Cache||Map),r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n.Cache=Map;var r=n;t.default=r},782594:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default,n=null;const r=function(r){return null!=n&&t(n.params,r)?n.params=r:n={params:r,result:e.call(this,r)},n.result};return r.clear=()=>{n=null},r};var i=r(n(94474))},729984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNonZeroNumber=function(e){return null!=e&&0!==e&&!isNaN(e)}},465345:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n,r){n(t).forEach((t=>e(t,n,r))),r(t)}},209384:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return/\s\s+/.test(e)?e.replace(/\s\s+/g,(e=>{let n="";for(let r=0;r<e.length;r++){n+=!0===t&&"\n"===e[r]?"\n":" "}return n})):e}},665023:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.astralRange=void 0,t.length=function(e){const t=e.match(n);return t?t.length:0},t.substring=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const i=e.match(n);if(!i)return"";return i.slice(Math.max(0,t),Math.max(0,r)).join("")},t.toArray=function(e){return e.match(n)||[]};const n=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]?|[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g;t.astralRange=n},164331:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.codePointAt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e.codePointAt)return e.codePointAt(t);let n=e.charCodeAt(t);if(n>=55296&&n<=56319){const r=e.charCodeAt(t+1);r>=56320&&r<=57343&&(n=65536+(n-55296<<10)+(r-56320))}return n},t.firstNCodepoints=function(e,t){return i(e||"",0,t)},t.firstNEncodedBytes=function(e,t){if(null==t)return e;if(encodeURI(e).length<=t)return e;let n=0;const r=a(e),o=r.length;for(let a=0;a<o;a++){const o=r[a],s=encodeURI(o).length;if(n+s>t)return i(e,0,a);n+=s}return e},t.numCodepoints=function(e){return(0,r.length)(e||"")},t.substring=i,t.toArray=a;var r=n(665023);function i(e,t,n){if(null==e||""===e)return"";const i=t||0,a=null==n?1/0:n;return e.length,0===i&&a===1/0?e:e.length>=5e3&&a/e.length<=.5?function(e,t,n){const i=new RegExp(r.astralRange);let a,o="",s=0;do{a=i.exec(e),a&&(o+=a[0]),s++}while(a&&s<n);return o}(e,0,a):(0,r.substring)(e,i,a)}function a(e,t,n){const i=e||"",a=t||0,o=null==n?1/0:n;return i.length>=5e3&&o/i.length<=.5?function(e,t,n){const i=new RegExp(r.astralRange),a=[];let o;do{o=i.exec(e),o&&a.push(o[0])}while(o&&a.length<n);return a}(i,0,o):(0,r.toArray)(i).slice(a,o)}},282572:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,n,s){const l=e.split(".");let p,f=!1;if(l.forEach((e=>{if(f=!e.match(d),f){if(p)return null;p=e}})),null==p||f)return null;const _=[];let h=!0;const g=(0,i.toArray)(p);for(let e=0;e<g.length;e++){const t=g[e];if(h=h&&u(t),!h&&a[t]){if(_.length>=2)return null;_.push(t)}}if(h)return c(n)||c(t)||s.some((e=>function(e){return o.has(e)}(e)))?null:new Set(g);if(!_.length)return null;const m=_.filter((e=>{const i=a[e];if(null==i)return!1;if(s.some((e=>i.includes(e))))return!1;const o=new Set;for(let e=0;e<i.length;e++){const t=r.LANGUAGE_TO_REGIONS[i[e]];if(null!=t)for(let e=0;e<t.length;e++)o.add(t[e])}return!o.has(n)&&!o.has(t)}));return m.length?new Set(m):null};var r=n(536349),i=n(665023);const a={í:["ast","ksf","bas","ca","cs","dua","nl","ee","ewo","fo","fr","gl","kl","hu","is","ga","dyo","kea","kkj","nmg","lkt","lag","ln","lu","mas","nnh","jgo","pt","qu","seh","sk","es","to","vai","vi","wae","cy","fy","yav","yo"],î:["af","agq","bss","bfd","bas","bkv","btt","nl","igb","ewo","fr","fur","gaj","gby","kl","jab","atg","jbu","kkj","naq","ksh","ku","nmb","lmp","ln","mda","mg","mas","mzm","jgo","nin","ann","ro","sg","scn","srn","yer","tr","wa","cy","yav","yle"],ü:["agg","ast","az","br","ca","co","cs","nl","etr","et","fr","gl","de","tof","god","hu","tbd","geb","ksh","kup","nds","lb","arn","oc","sg","sk","es","gsw","dts","tr","tk","vo","wa","wae","fy","yll"],ċ:["mt"],ī:["agq","bss","bfd","bas","bkv","btt","ddn","igb","kjy","ich","gux","haw","jab","iby","idu","jbu","kub","nmg","lv","mda","mi","mas","mql","nin","prg","gd","to","yba","yav"],ı:["az","crh","tr"],ļ:["lv"],ł:["dsb","nv","pl","hsb"],š:["bs","hr","cs","dzg","et","fi","smn","geb","khq","ses","kun","lkt","lv","lt","dsb","se","nso","prg","sr","sh","sms","sk","sl","taq","twq","tuq","hsb","wqe","dje"],ƙ:["ckl","ank","ha","ikx","kai","hia","mbu","anc","nin","pip","tal","tan","wja","wji"],ǀ:["naq"],ǁ:["naq"],ȯ:["liv"],ɑ:["fmp","dud","tmh"],ɓ:["fub","yay","bkc","bjt","bcn","bas","bsq","bmq","fue","bys","bwr","cky","fuq","ckl","asg","dbq","dnj","dgh","dow","dua","enn","ff","gby","gba","gmm","ank","gde","gkp","jgk","ha","hbb","ikx","kkj","hig","kzr","kai","kpe","nmg","hia","ffm","mbo","mbu","mif","mzm","mua","sur","anc","fuv","nin","dgi","pbi","pip","fuf","cla","sav","srr","sld","sok","tal","tan","yer","ttr","tik","kdl","tsw","vai","vut","wja","wji","fuh","gnd"],ḍ:["tzm","kab","okr","shi","tmh","taq"],ṛ:["tzm","kab","shi"],ṭ:["tzm","kab","shi","tmh","taq"],ẉ:[],ạ:["izi","yaz","blt","vi"],ẹ:["yay","bom","bin","mfn","dzg","igb","enn","gkn","iby","ikk","ikw","izi","okr","yaz","blt","tan","tuq","vi","yo"],ị:["avu","mfn","igb","enn","iby","ig","ige","ikk","ikw","izi","okr","blt","tan","vi"]},o=new Set(["abq","ab","ady","av","az","ba","be","bs","bg","bua","ce","ckt","cu","cv","crh","dar","dng","myv","evn","gag","inh","kbd","xal","krc","kaa","kk","kjh","kca","ky","kv","koi","kpy","kum","lbe","lez","mk","mns","chm","mdf","mn","ttt","gld","yrk","nog","os","ru","rue","sr","sh","cjs","alt","tab","tg","tt","tkr","tk","tyv","ude","udm","uk","uz","mrj","sah"]),s=new Set(["374","994","375","387","359","995","7","383","996","389","373","976","382","381","992","993","380","998"]),l="авгекмнорстухшщьѕіјѡѵүһӏԁԛԝԧꚙ";function c(e){return s.has(e)}function u(e){return l.includes(e)}const d=new RegExp("^[a-z0-9-]+$")},536349:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LANGUAGE_TO_REGIONS=void 0;t.LANGUAGE_TO_REGIONS={fub:["237","235","234"],af:["237","27"],agq:["237"],yay:["234"],bss:["237"],agg:["675"],ast:["34"],avu:["243","211"],az:["994"],bkc:["237","241"],ksf:["237"],bfd:["237"],bjt:["221"],bcn:["234"],bas:["237"],bsq:["231"],bkv:["234"],bom:["234"],btt:["234"],bin:["234"],bmq:["226","223"],bs:["387","385","383","382","381"],fue:["229","228"],br:["33"],bys:["234"],bwr:["234"],cky:["234"],ca:["376","33","39","34"],tzm:["212"],fuq:["234"],ckl:["234"],asg:["234"],co:["33","39"],crh:["7"],hr:["387","385","383","382","381"],mfn:["234"],cs:["420","421"],dbq:["237","234"],dnj:["225","231"],dzg:["235","227"],ddn:["229"],dgh:["234"],dow:["237"],dua:["229"],nl:["297","32","599","31","1","597"],igb:["234"],etr:["675"],enn:["234"],kgy:["675"],et:["372"],ich:["234"],ee:["229","233","228"],ewo:["237"],fo:["298"],fmp:["237"],fi:["358","46"],fr:["32","229","226","257","237","1","236","242","243","235","269","253","240","33","241","509","225","352","261","223","377","227","250","221","248","41","228","678"],fur:["39"],ff:["237","224","222","221"],gaj:["675"],gl:["34"],gby:["234"],gba:["236"],gmm:["237"],de:["43","32","49","423","352","41"],tof:["675"],god:["225"],ank:["234"],gkn:["234"],gux:["229","226","227","228"],gde:["237","234"],gkp:["224"],kl:["299"],jgk:["234"],ha:["229","237","235","233","225","227","234","249","228"],haw:["1"],hbb:["234"],hu:["36"],dud:["234"],jab:["234"],iby:["234"],is:["354"],idu:["234"],ig:["240"],ige:["234"],ikx:["256"],ikk:["234"],ikq:["234"],smn:["358"],ga:["353","44"],atg:["234"],izi:["234"],dyo:["220","221"],jbu:["237","234"],kab:["213"],kea:["238"],tbd:["675"],hig:["234"],kai:["234"],kkj:["237","236","242"],kzr:["237","235"],naq:["264"],geb:["675"],okr:["234"],ksh:["49"],ses:["223"],khq:["223"],kun:["291","251"],kup:["675"],kub:["237","234"],kpe:["224","231"],nmg:["237","240"],ku:["963","90"],lkt:["1"],hia:["234"],lag:["255"],lv:["371"],lmp:["237"],ln:["242","243"],liv:[],lt:["370"],yaz:["234"],nds:["55","49","31"],dsb:["49"],lu:["243"],lb:["32","33","49","352"],mda:["234"],mb:["261"],mt:["356"],mi:["64"],arn:["56"],mas:["254","255"],ffm:["223"],mql:["229","228"],mbo:["237"],mbu:["234"],mif:["237"],mzm:["234"],mua:["237","235"],sur:["234"],nv:["1"],anc:["234"],nnh:["237"],jgo:["237"],fuv:["237","234"],nin:["234"],dgi:["226"],se:["358","46","47"],nso:["27"],ann:["234"],oc:["33","39","377","34"],pbi:["237"],pip:["234"],pl:["48"],pt:["244","55","238","240","245","853","258","351","239","670"],prg:[],fuf:["224","223","221","232"],qu:["54","591","57","593","51"],ro:["373","40"],cla:["234"],sav:["221"],sg:["236","235","243"],gd:["44"],seh:["258"],sr:["387","385","383","382","381"],sh:["387","385","383","382","381"],srr:["220","221"],sch:["39"],sld:["226"],sms:["358"],sk:["420","421"],sl:["386"],sok:["235"],es:["54","501","591","56","57","506","53","593","503","240","502","504","52","505","507","595","51","34","1","598","58"],srn:["597"],gsw:["43","33","49","423","41"],shi:["212"],tal:["234"],tmh:["223"],taq:["226","223"],tan:["234"],twq:["227"],blt:["856","84"],yer:["234"],tuq:["235","218","227","234"],ttr:["234"],tik:["237"],to:["676"],dts:["223"],kdl:["234"],tsw:["234"],tr:["90"],tk:["993"],hsb:["49"],vai:["231","232"],vi:["855","84"],vo:[],vut:["237","234"],wja:["234"],wa:["32"],wae:["43","39","423","41"],wji:["234"],cy:["44"],fy:["31"],fuh:["229","226","227"],yba:["234"],yav:["237"],yle:["675"],yll:["675"],yo:["229","234"],dje:["227"],gnd:["237"]}},53659:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findSuspiciousCharacters=function(e,t,n,o){const s=e.match(a),l=s&&s[1];if(null==l)return null;const c=(0,i.phoneCC)(n),u="whatsapp"===t?"":(0,i.phoneCC)(t),d=o.map((e=>e.toLowerCase()));return(0,r.findSuspiciousCharacters)(l,u,c,d)};var r=n(282572),i=n(240277);const a=/^(?:https?:\/\/)?([^/?#]+)(?:[/?#]|$)/i},846269:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.castTypedArrays=function(e,t){if(t instanceof e)return t;if("string"==typeof t)return new e((0,r.decodeB64)(t));return new e(t)};var r=n(615688)},660977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.concatTypedArrays=function(e,t){const n=t.reduce(((e,t)=>e+t.length),0),r=new e(n);let i=0;return t.forEach((e=>{r.set(e,i),i+=e.length})),r}},591560:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.ParsableXmlNode=void 0,t.convertBytesToUint=o;var i=r(n(133344)),a=n(56225);function o(e,t){let n=0;for(let r=0;r<t;r++)n=256*n+e[r];return n}t.ParsableXmlNode=class{constructor(e,t){this._name=e,this._node=t,this._children=Array.isArray(t.content)?t.content.map((t=>new this.constructor(e,t))):null}name(){return this._name}node(){return this._node}hasAttr(e){return(0,i.default)(this._node.attrs,e)}assertTag(e){this._node.tag!==e&&this.throw(`to be <${e}>`)}tag(){return this._node.tag}maybeChild(e){const t=this._children;if(!t)return null;for(let n=0;n<t.length;n++)if(t[n].tag()===e)return t[n];return null}hasChild(e){return!!this.maybeChild(e)}child(e){const t=this.maybeChild(e);return t||this.throw(`to have child <${e}>`)}assertAttr(e,t){const n=this.attrString(e);n!==t&&this.throw(`to have "${e}"="${t}", but instead has "${n}"`)}attrString(e){return(0,i.default)(this._node.attrs,e)?this.decodeAsString(this._node.attrs[e]):this.throw(`to have attribute "${e}"`)}forEachAttributeKey(e){const t=this._node.attrs;Object.keys(t).forEach((t=>e(t)))}maybeAttrString(e){return this.hasAttr(e)?this.decodeAsString(this._node.attrs[e]):null}maybeAttrInt(e,t,n){return this.hasAttr(e)?this.attrInt(e,t,n):null}attrEnumValues(e,t,n){const r=new Set(t),i=this.attrString(e);if(!r.has(i)){if(null!=n)return n;const t=Array.from(r).join("|");return this.throw(`to have "${e}"={${t}} but has value "${i}"`)}return i}attrEnum(e,t){const n=this.attrString(e);if(!(0,i.default)(t,n)){const r=Object.keys(t).join("|");return this.throw(`to have "${e}"={${r}} but has value "${n}"`)}return t[n]}attrEnumOrNullIfUnknown(e,t){const n=this.attrString(e);return(0,i.default)(t,n)?t[n]:null}attrEnumOrDefault(e,t,n){return this.hasAttr(e)?this.attrEnum(e,t):n}attrInt(e,t,n){const r=this.attrString(e);return this._parseInt(r,e,t,n)}_parseInt(e,t,n,r){const i=parseInt(e,10);return Number.isNaN(i)?this.throw(`to have "${t}"={integer} but has value "${e}"`):void 0!==n&&i<n?this.throw(`to have "${t}"={at least ${n}} but has value ${i}`):void 0!==r&&i>=r?this.throw(`to have "${t}"={below ${r}} but has value ${i}`):i}forEachChild(e){const t=this._children;if(t)t.forEach((t=>e(t)));else if(null!=this._node.content)return this.throw("to have children")}forEachChildWithTag(e,t){this.forEachChild((n=>{n.tag()===e&&t(n)}))}mapChildren(e){const t=this._children;return t||null==this._node.content?t?t.map((t=>e(t))):[]:this.throw("to have children")}mapChildrenWithTag(e,t){const n=this._children;return n||null==this._node.content?n?n.filter((t=>t.tag()===e)).map((e=>t(e))):[]:this.throw("to have children")}mapFirstChild(e){const t=this._children;return t&&0!==t.length?e(t[0]):this.throw("to have children")}hasContent(){return!this._children&&!!this._node.content}hasChildren(){return null!=this._children}getChildren(){return this._children}getNode(){return this._node}unsafeSetChildren(e){this._children=e}unsafeSetNodeContent(e){this._node.content=e}contentUint(e){return o(this.contentBytes(e),e)}contentBytes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;if(this._children)return this.throw("to have binary content, but has children instead");if(null!=this._node.content){const t=this._node.content;return-1!==e&&t.length!==e?this.throw(`to be ${e} bytes, but got ${t.length} instead`):t}return this.throw("to have content")}contentString(){return this._children?this.throw("to have string content, but has children instead"):null!=this._node.content?this._node.content:this.throw("to have content")}contentInt(e,t){const n=this.contentString();return this._parseInt(n,"content",e,t)}contentEnum(e){const t=this.contentString();if(!(0,i.default)(e,t)){const n=Object.keys(e).join("|");return this.throw(`to have content {${n}} but has value "${t}"`)}return e[t]}decodeAsString(e){if("string"!=typeof e)throw new Error(`decodeAsString: attribute is ${typeof e} not a string: ${e}`);return e}throw(e){throw new a.XmlParsingFailure(this._name,`expected <${this._node.tag}> ${e}`)}toString(){return this._node.toString()}}},517890:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns:/g,"~::~xmlns:").replace(/\s*xmlns=/g,"~::~xmlns=").split("~::~"),n=t.length;let r=!1,i=0,a="",o=0;const s=["\n"];for(o=0;o<100;o++)s.push(s[o]+"    ");const l=function(e,t){const n=/^<[\w:\-.,]+/.exec(e[t-1]),r=/^<\/[\w:\-.,]+/.exec(e[t]);return null!=n&&null!=r&&n[0]===r[0]};for(o=0;o<n;o++)t[o].search(/<!/)>-1?(a+=s[i]+t[o],r=!0,(t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1||t[o].search(/!DOCTYPE/)>-1)&&(r=!1)):t[o].search(/-->/)>-1||t[o].search(/\]>/)>-1?(a+=t[o],r=!1):l(t,o)?(a+=t[o],r||i--):t[o].search(/<\w/)>-1&&-1===t[o].search(/<\//)&&-1===t[o].search(/\/>/)?a=a+=r?t[o]:s[i++]+t[o]:t[o].search(/<\w/)>-1&&t[o].search(/<\//)>-1?a=a+=r?t[o]:s[i]+t[o]:t[o].search(/<\//)>-1?a=a+=r?t[o]:s[--i]+t[o]:t[o].search(/\/>/)>-1?a=a+=r?t[o]:s[i]+t[o]:t[o].search(/<\?/)>-1||t[o].search(/xmlns:/)>-1||t[o].search(/xmlns=/)>-1?a+=s[i]+t[o]:a+=t[o];return"\n"===a[0]?a.slice(1):a}},974277:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlNode=void 0,t.attrsToString=a,t.uint8ArrayToDebugString=o;var r=n(787614);const i={};function a(e){const t=Object.keys(e);let n="";for(let r=0;r<t.length;r++){const i=t[r];n+=` ${i}="${e[i].toString()}"`}return n}function o(e){let t="";return t=0===e.length?"\x3c!-- empty binary --\x3e":e.length<50?(0,r.bytesToDebugString)(e):`\x3c!-- ${e.length} bytes --\x3e`,t}t.XmlNode=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.tag=e,this.attrs=t,this.content=n}toString(){let e="<"+this.tag;e+=a(this.attrs);const t=this.content;return Array.isArray(t)?e+=`>${t.map(String).join("")}</${this.tag}>`:t instanceof Uint8Array?e+=`>${o(t)}</${this.tag}>`:e+=null!=t?`>${String(t)}</${this.tag}>`:" />",e}}},56225:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XmlParsingFailure=void 0;t.XmlParsingFailure=class{constructor(e,t){this.parser=e,this.reason=t}toString(){return`XmlParsingFailure: ${this.parser}: ${this.reason}`}}},628970:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=void 0;var r=n(569719),i=n(657319),a=n(321282);t.PRIVATE_STATS_DEFAULT_PS_ID_KEY_HASH_INT=113760892;const o={putBuffer:()=>Promise.resolve()};t.Wam=class{constructor(e){this._pending=[],this._globals=new Map,this._initialized=!1,this._buffers=new Map,this._streamId=-1,this._sink=o,this._getNextSequenceNumber=null,this.deinitialize=()=>{this._initialized=!1,this._pending=[],this._globals.clear(),this._buffers=new Map,this._streamId=-1,this._sink=o,this.serializePending.cancel(),this.finalizeBuffers.cancel()},this.enqueueEvent=(e,t,n,r,i,a)=>{this._pending.push({type:1,id:e,commitTime:t,psIdIntValue:n,weight:i,fields:r,resolve:a}),this._initialized&&this.serializePending.onOrBefore(3e3)},this.enqueueAttributesUpdate=e=>{const t={type:2,delta:[]};e.forEach(((e,n)=>{void 0!==e&&t.delta.push([n,e])})),t.delta.length>0&&(__LOG__(2)`WAM: Enqueued ${t.delta.length} attribute keys for update`,this._pending.push(t))},this.finalizeBuffers=new i.ShiftTimer((()=>{this._finalizeBuffers()})),this.serializePending=new i.ShiftTimer((()=>{this._serializePending()})),this.forceSerializePending=()=>{this._initialized&&this._hasPendingEvents()&&this.serializePending.forceRunNow()},this._channel=e}initialize(e,t,n,r){if(this._initialized)return __LOG__(4,void 0,new Error,!0)`WAM: Failed to initialize already initialized WAM`,void SEND_LOGS("wam-initialize");this._options=r,this._streamId=e,this._sink=n,this._getNextSequenceNumber=t,this._hasPendingEvents()&&this.serializePending.forceRunNow(),this._initialized=!0,__LOG__(2)`WAM: Initialized with stream id ${this._streamId}`}_finalizeBuffers(){this._buffers.forEach((e=>{e.finalize()})),this._buffers.size>0&&this.serializePending.onOrBefore(3e3)}_getKeyHashIntForSequence(e){var t;return(null===(t=this._options)||void 0===t?void 0:t.multipleSequences)?0===e?"null-psid":e:"regular"}_maybeCreateNewBuffer(e){let t=this._buffers.get(e);if(t)return t;const n=this._getKeyHashIntForSequence(e);if(null==this._getNextSequenceNumber)return __LOG__(4,void 0,new Error,!0)`WAM: Sequence number generator not initialised for channel ${this._channel}`,void SEND_LOGS("wam-serializePending");const r=this._getNextSequenceNumber(n);if(t=new a.WamBuffer(this._channel,this._streamId,r,this._globals),this._buffers.set(e,t),"regular"!==e)if(null==this._privateStatsIds)__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats ids`,SEND_LOGS("wam-serializePending");else{const n=0===e?"none":this._privateStatsIds.get(e);null==n?(__LOG__(4,void 0,new Error,!0)`WAM: Tried to create a private buffer without setting private stats id`,SEND_LOGS("wam-serializePending")):t.writeGlobal(6005,n)}return t}_serializePending(){const e=[];this.finalizeBuffers.onOrBefore(3e5);const t=new Map;let n=-1;this._pending.forEach(((r,i)=>{if(1===r.type){let o=!0;t.forEach((e=>{(0,a.canWriteGlobal)(e)||(o=!1)}));const s=(0,a.canWriteEvent)(r.fields);if(s&&o){let e;"regular"===this._channel?e=this._maybeCreateNewBuffer("regular"):(this._channel,null==r.psIdIntValue?(__LOG__(4,void 0,new Error,!0)`A WAM event in channel private was dropped before serialization. Reason: missing psIdIntValue in the event payload`,SEND_LOGS("wam-serializePending")):e=this._maybeCreateNewBuffer(r.psIdIntValue)),null!=e&&(t.forEach(((e,t)=>{const n=this._globals.get(t);void 0!==n&&n===e||(this._buffers.forEach((n=>n.writeGlobal(t,e))),this._globals.set(t,e))})),t.clear(),e.writeEvent(r.commitTime,r.id,r.fields,r.weight))}else __LOG__(3)`A WAM event in channel ${this._channel} was dropped before serialization. Event correct: ${s}, pending attributes correct: ${o}`;null!=r.resolve&&e.push(r.resolve),n=i}else{r.type;for(let e=0;e<r.delta.length;++e){const[n,i]=r.delta[e];t.set(n,i)}}}));let i=!1;this._buffers.forEach((e=>{(e.isFinalized()||e.getSize()>65536)&&(i=!0)}));const o=[];this._buffers.forEach(((e,t)=>{e.hasEvents()?o.push([e.getKey(),e.peek(),this._getKeyHashIntForSequence(t)]):__LOG__(3)`Skipping putting buffer to sink, as it does not contain any events`}));const s=(0,r.promiseEach)(o,(e=>{let[t,n,r]=e;return this._sink.putBuffer(t,n,i,r)})).then((()=>{e.forEach((e=>{e()}))}));return this._pending=this._pending.slice(n+1),i&&(this._buffers=new Map,this.finalizeBuffers.cancel()),s}_hasPendingEvents(){return this._pending.length>0&&this._pending.some((e=>1===e.type))}isInitialized(){return this._initialized}updatePrivateStatsIds(e){if("private"!==this._channel)return __LOG__(4,void 0,new Error,!0)`WAM: Tried to set private stats ids on a non-private channel`,void SEND_LOGS("wam-updatePrivateStatsIds");this._privateStatsIds=e}}},321282:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamBuffer=void 0,t.canWriteEvent=function(e){const t=c(e);for(let n=0;n<=t;n+=3){const t=e[n+2];if(null!=t){if(e[n+1]===i.TYPES.INT&&isNaN(t))return!1}}return!0},t.canWriteGlobal=function(e){if("number"==typeof e)return!isNaN(e);return!0};var r=n(108584),i=n(368518);function a(e,t,n,r){0===r?l(e,t,16|n):1===r?l(e,t,32|n):-128<=r&&r<128?(l(e,t,48|n),e.writeInt8(r)):-32768<=r&&r<32768?(l(e,t,64|n),e.writeInt16(r)):-2147483648<=r&&r<2147483648?(l(e,t,80|n),e.writeInt32(r)):(l(e,t,96|n),e.writeInt64(r))}function o(e,t,n,r){l(e,t,112|n),e.writeFloat64(r)}function s(e,t,n,i){const a=(0,r.numUtf8Bytes)(i);a<256?(l(e,t,128|n),e.writeUint8(a)):a<65536?(l(e,t,144|n),e.writeUint16(a)):(l(e,t,160|n),e.writeUint32(a)),e.writeString(i)}function l(e,t,n){t<256?(e.writeUint8(n),e.writeUint8(t)):(e.writeUint8(8|n),e.writeUint16(t))}function c(e){let t=-1;for(let n=0;n<e.length;n+=3)null!=e[n+2]&&(t=n);return t}t.WamBuffer=class{constructor(e,t,n,i){this._finalized=!1,this._hasEvents=!1;const a=new r.Binary(void 0,!0);switch(a.writeString("WAM"),a.writeUint8(5),a.writeUint8(t),a.writeUint16(n),e){case"regular":a.writeUint8(0);break;default:a.writeUint8(2)}this._channel=e,this._buffer=a,this._sequenceNumber=n,this._streamId=t,i.forEach(((e,t)=>{this.writeGlobal(t,e)}))}writeGlobal(e,t){if(null!=t)if("string"==typeof t)s(this._buffer,e,0,t);else if("number"==typeof t)a(this._buffer,e,0,t);else{if("boolean"!=typeof t)throw new Error("Incorrect value type "+typeof t);a(this._buffer,e,0,t?1:0)}else l(this._buffer,e,0)}writeEvent(e,t,n,r){const l=this._buffer;a(l,47,0,Math.floor(e/1e3));const u=c(n);a(l,t,-1===u?5:1,r);for(let e=0;e<=u;e+=3){const t=n[e+2];if(null!=t){const r=n[e],c=n[e+1],d=e===u?6:2;c===i.TYPES.INT?a(l,r,d,t):c===i.TYPES.BOOL?a(l,r,d,t?1:0):c===i.TYPES.STRING?s(l,r,d,t):o(l,r,d,t)}}this._hasEvents=!0}getKey(){return{streamId:this._streamId,sequenceNumber:this._sequenceNumber,channel:this._channel}}getSize(){return this._buffer.size()}peek(){return this._buffer.peek((e=>e.readByteArray()))}isFinalized(){return this._finalized}finalize(){this._finalized=!0}hasEvents(){return this._hasEvents}}},442114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeChannelManager=function(){null!=r&&r.close()},t.getChannelManager=function(){null==r&&(r=new n);return r};class n{constructor(){this._sinkIsBusy=new Map,this._initializedChannel=new Map}getChannelInitialized(e){return this._initializedChannel.get(e)||!1}setChannelInitialized(e){this._initializedChannel.set(e,!0)}isSinkBusy(e){return this._sinkIsBusy.get(e)||!1}setSinkBusy(e,t){this._sinkIsBusy.set(e,t)}close(){this._sinkIsBusy.forEach(((e,t)=>{this._sinkIsBusy.set(t,!1)})),this._initializedChannel.forEach(((e,t)=>{this._initializedChannel.set(t,!1)}))}}let r},507879:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinitializeWAM=function(){s().deinitialize()},t.enableDebugMode=function(){a=!0},t.forceFlushBuffers=function(){s().forceFlushBuffers()},t.initializeWAM=function(e,t,n,r,i){s().initialize(n,e,t,r,i)},t.log=function(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();s().enqueueEvent(e,t,l,n,(0,i.appendRawFields)(r,a),o)},t.logAsync=function(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;const l=Date.now();return new Promise((c=>{s().enqueueEvent(e,t,l,n,(0,i.appendRawFields)(r,a),o,c)}))},t.logAttributes=function(e,t){const n=(0,i.getDeltaFromAttributes)(e);if(null==n)return;const{deltaRegular:r,deltaPrivate:a}=n;r.size>0&&s().enqueueAttributesUpdate("regular",r);a.size>0&&s().enqueueAttributesUpdate("private",a)},t.rotateBuffers=function(){s().rotateBuffers()},t.updatePrivateStatsIds=function(e){s().updatePrivateStatsIds(e)};var r=n(926305),i=n(956521);let a=!1,o=null;function s(){return o||(o=new r.WamManager),o}},926305:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WamManager=void 0;var r=n(628970);class i{constructor(e){this._sequenceNumbers=new Map,this._options=e}_setSequenceNumber(e,t){null==t||0===t||t<0?this._sequenceNumbers.set(e,"uninitialized"):this._sequenceNumbers.set(e,t)}initializeForChannel(e,t){t.forEach(((t,n)=>{var r;if("regular"===e&&"regular"===n)this._setSequenceNumber(n,t);else if("private"===e&&"regular"!==n)this._setSequenceNumber(n,t);else if("private"!==e||(null===(r=this._options)||void 0===r?void 0:r.multipleSequences)){var i;__LOG__(4,void 0,new Error)`SequenceNumberGenerator::initializeForChannel: Incorrect combination of parameters: ${e} ${n} ${null===(i=this._options)||void 0===i?void 0:i.multipleSequences}`}else this._setSequenceNumber(n,t)}))}next(e){const t=this._sequenceNumbers.get(e);let n;return null==t||"uninitialized"===t?n=1:(n=t+1,n>65535&&(n=1)),this._sequenceNumbers.set(e,n),n}}t.WamManager=class{constructor(){this._wamInstances=new Map,this._sequenceNumberGenerator=null}getWamInstance(e){let t=this._wamInstances.get(e);return t||(t=new r.Wam(e),this._wamInstances.set(e,t)),t}initialize(e,t,n,r,a){const o=this.getWamInstance(e);if(o.isInitialized())return void __LOG__(3)`WAM instance for channel ${e} has already been initialized`;null==this._sequenceNumberGenerator&&(this._sequenceNumberGenerator=new i(a));const s=this._sequenceNumberGenerator;this._sequenceNumberGenerator.initializeForChannel(e,n),o.initialize(t,(e=>s.next(e)),r,a)}deinitialize(){this._wamInstances.forEach(((e,t)=>{e.isInitialized()&&(__LOG__(2)`WamManager: Deinitializing WAM Channel ${t}`,e.deinitialize())})),this._sequenceNumberGenerator=null}enqueueEvent(e,t,n,r,i,a,o){this.getWamInstance(e).enqueueEvent(t,n,r,i,a,o)}enqueueAttributesUpdate(e,t){this.getWamInstance(e).enqueueAttributesUpdate(t)}updatePrivateStatsIds(e){this.getWamInstance("private").updatePrivateStatsIds(e)}forceFlushBuffers(){this._wamInstances.forEach((e=>{e.forceSerializePending()}))}rotateBuffers(){this._wamInstances.forEach((e=>{e.finalizeBuffers.forceRunNow()}))}}},647957:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.blindToken=function(e,t){return(0,r.runInAllocationScope)((()=>{const n=(0,r.p3Element)(),o=(0,r.allocate)(Uint8Array,32);o.set(t),a(o),i.lowlevel.scalarbase(n,o);const s=(0,r.hashToPoint)(e);(0,i.lowlevel.add)(s,n);const l=new Uint8Array(32);return(0,r.pack)(l,s),l}))},t.unblindToken=function(e,t,n){return(0,r.runInAllocationScope)((()=>{const o=(0,r.p3Element)();if((0,r.unpack)(o,e))return null;const s=(0,r.p3Element)();if(0!==(0,r.unpackneg)(s,n))return null;const l=(0,r.allocate)(Uint8Array,32);l.set(t),a(l);const c=(0,r.p3Element)();i.lowlevel.scalarmult(c,s,l);(0,i.lowlevel.add)(o,c);const u=new Uint8Array(32);return(0,r.pack)(u,o),u}))};var r=n(30141),i=n(463482);function a(e){e[0]&=248,e[31]&=127,e[31]|=64}},936376:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStorage=function(){(0,a.deinitializeWAM)(),(0,i.closeChannelManager)(),l=null,s=null},t.getFinishedStreamBuffers=function(e){return c("getFinishedStreamBuffers").getBuffers().then((t=>(0,o.getFinishedBuffers)(e,t)))},t.initializeWAMSink=function(e,t,n,r){const l=c("initializeWAMSink"),u=(0,i.getChannelManager)();if(u.getChannelInitialized(t))return Promise.resolve();u.setChannelInitialized(t);const d=l.getStreamId(e),p={putBuffer(e,r,i,a){if(u.isSinkBusy(t))return __LOG__(3)`WamStorage: Sink flush did not happen within timeout, buffer is not saved`,Promise.resolve();u.setSinkBusy(t,!0);const{bufferKey:s,meta:c,bufferRow:p}=(0,o.asBufferEntry)(e,t,d,r,i);return l.saveBuffer(c,p,a).then((()=>{const t=[e.streamId,e.sequenceNumber];__LOG__(2)`WamStorage: Successfully put buffer ${t} to sink`,i&&(n(),__LOG__(2)`WamStorage: Buffer ${s} is scheduled for send`)})).finally((()=>{u.setSinkBusy(t,!1)}))}};null==s&&(s=l.finishBuffer(d));return s.then((()=>{if(l.getStartingSequenceNumbers)return l.getStartingSequenceRow,l.getStartingSequenceNumbers(t,d);if(l.getStartingSequenceRow,null==r?void 0:r.multipleSequences)throw new Error("getStartingSequenceRow must not used when enabling support for multiple sequences");return l.getStartingSequenceRow(d).then((e=>{const t=(0,o.getSequenceNumber)(e),n=new Map;return n.set("regular",t),n}))})).then((e=>{(0,a.initializeWAM)(d,e,t,p,r),"private"===t&&l.updatePrivateStatsIds&&l.updatePrivateStatsIds().then(a.updatePrivateStatsIds)}))},t.nukeMetrics=function(){return c("nukeMetrics").nukeMetrics()},t.privateStatsKillSwitchGetBlockedToken=function(){const e=c("privateStatsKillSwitchGetBlockedToken");if(!e.privateStatsKillSwitchGetBlockedToken)throw new Error("privateStatsKillSwitchGetBlockedToken not implemented for WAM DB");return e.privateStatsKillSwitchGetBlockedToken()},t.privateStatsKillSwitchSet=function(e){const t=c("privateStatsKillSwitchSet");if(!t.privateStatsKillSwitchSet)throw new Error("privateStatsKillSwitchSet not implemented for WAM DB");return t.privateStatsKillSwitchSet(e)},t.redeemPrivateStatsToken=function(){const e=c("getPrivateStatsToken");if(!e.redeemPrivateStatsToken)throw new Error("redeemPrivateStatsToken not implemented for WAM DB");return e.redeemPrivateStatsToken(d)},t.removeBufferByKey=function(e){return c("removeBufferByKey").removeBufferByKey(e)},t.savePrivateStatsToken=function(e){const t=c("savePrivateStatsToken");if(!t.savePrivateStatsToken)throw new Error("savePrivateStatsToken not implemented for WAM DB");return t.savePrivateStatsToken(e)},t.startWamStorage=function(e){null==l?l=e:(__LOG__(3,void 0,void 0,!0)`startWamStorage: called again`,SEND_LOGS("startWamStorage"))};var r=n(892844),i=n(442114),a=n(507879),o=n(956521);let s=null,l=null;function c(e){if(l)return l;throw new Error(`WamStorage::${e} called before startWamStorage`)}const u=r.DAY_SECONDS,d=(e,t)=>{const n={maxRedeemCount:null!=(null==t?void 0:t.maxRedeemCount)&&0!==t.maxRedeemCount?t.maxRedeemCount:64,maxExpirySeconds:null!=(null==t?void 0:t.maxExpirySeconds)&&0!==t.maxExpirySeconds?t.maxExpirySeconds:u};return(0,r.happenedWithin)(e.creationTs,n.maxExpirySeconds)?!(e.redeemCount>=n.maxRedeemCount)||(__LOG__(2)`The private stats token was redeemed maximum number of time. The client shall re-issue a new one`,!1):(__LOG__(2)`The private stats token expired. The client shall re-issue a new one`,!1)}},368518:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPES=void 0;t.TYPES={INT:0,BOOL:1,STRING:2,FLOAT:3}},956521:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendRawFields=function(e,t){if(null==t||0===t.length)return e;const n=new Map;for(let t=0;t<e.length;t+=3){const r=e[t];n.set(r,t)}for(let r=0;r<t.length;++r){const[i,o,s]=t[r];if(null==s)continue;const l=n.get(i);if(null!=l){if(void 0!==e[l+2])continue}a[o]===typeof s&&(null==l?(n.set(i,e.length),e.push(i,o,s)):e[l+2]=s)}return e},t.asBufferEntry=function(e,t,n,i,a){const o=function(e){return JSON.stringify([e.streamId,e.sequenceNumber,e.channel])}(e);return{bufferKey:o,meta:{streamId:e.streamId,sequenceNumber:e.sequenceNumber},bufferRow:{key:o,channel:t,streamId:n,buffer:(0,r.encodeB64)(i),finished:a}}},t.getDeltaFromAttributes=function(e){const t=new Map,n=new Map;for(let r=0;r<e.length;r+=4){const a=e[r],o=e[r+1],s=e[r+2],l=e[r+3];if(s===i.TYPES.FLOAT)throw new Error("Float attributes are currently not supported in runtime");if(!Array.isArray(a))return __LOG__(4,void 0,new Error,!0)`logAttributes WAM channel is not an array`,void SEND_LOGS("wam-log-attributes");a.includes("regular")&&t.set(o,l),a.includes("private")&&n.set(o,l)}return{deltaRegular:t,deltaPrivate:n}},t.getFinishedBuffers=function(e,t){const n=[];return t.forEach((t=>{const{channel:i}=t;if(null==i){if("regular"!==e)return}else if(i!==e)return;if(t.finished){const e=new Uint8Array((0,r.decodeB64)(t.buffer)),i=t.key;n.push({key:i,content:e})}})),n},t.getSequenceNumber=function(e){let t=null;e&&(t=e.sequenceNumber);return t};var r=n(615688),i=n(368518);const a={[i.TYPES.INT]:"number",[i.TYPES.FLOAT]:"number",[i.TYPES.STRING]:"string",[i.TYPES.BOOL]:"boolean"}},151631:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(108584),a=n(565885),o=r(n(789350));let s,l=0;t.default=class{constructor(e){this.oggBlob=e}generateBlob(){return this.oggBlobToWAVBlob(this.oggBlob,1)}oggBlobToWAVBlob(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return new Promise((n=>{const r=new o.default,i=[],c=[],u=(l++,s||new window.AudioContext),d={outputBufferSampleRate:u.sampleRate,bufferLength:4096};r.onmessage=e=>{if(null==e.data){for(let e=0;e<t;e++)i.forEach((t=>{const n=t[e]||t[0];for(let e=0;e<n.length;e++)c.push(n[e])}));const e=this.encodeWAV(c,u,t),r=new Blob([e.readByteArray()],{type:"audio/wav"});l--,0===l&&s&&(s.close&&s.close(),s=void 0),n(r)}else i.push(e.data),t=i[0].length},r.postMessage({command:"decode-init",config:d}),(0,a.blobToArrayBuffer)(e).then((e=>{r.postMessage({command:"decode",pages:new Uint8Array(e)}),r.postMessage({command:"decode-done"})})).catch((e=>{__LOG__(3)`Player::oggBlobToWAVBlob error: ${e}`}))}))}encodeWAV(e,t,n){const r=new i.Binary(void 0,!0);r.ensureCapacity(44+2*e.length),r.writeString("RIFF"),r.writeUint32(36+2*e.length),r.writeString("WAVE"),r.writeString("fmt "),r.writeUint32(16),r.writeUint16(1),r.writeUint16(n),r.writeUint32(t.sampleRate),r.writeUint32(t.sampleRate*n*2),r.writeUint16(2*n),r.writeUint16(16),r.writeString("data"),r.writeUint32(2*e.length);for(let t=0;t<e.length;t++){let n=Math.max(-1,Math.min(e[t],1));n*=n>0?32767:32768,r.writeInt16(Math.floor(n))}return r}}},75396:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.attributeAgentToMessage=function(e){if((0,c.isMultiDeviceAgentsEnabled)()&&null==e.agentId){const t=(0,u.getMe)();if(null!=t){const n=p.AgentCollection.getByDeviceId(t.getDeviceId());null!=n&&(e.agentId=n.id)}}},t.initializeAgentLog=function(){if(!(0,c.isMultiDeviceAgentsLoggingEnabled)())return;const e=(0,u.assertGetMe)().getDeviceId(),t=l.default.persistentExpiringId();s.Cmd.on("logout",(()=>{E({browserId:t,companionMdId:e,logoutTimestamp:(0,o.unixTimeWithoutClockSkewCorrection)(),multideviceAction:d.default.MULTIDEVICE_ACTION_TYPE.LOGOUT},!0)}));const n=p.AgentCollection.getByDeviceId(e);if(null!=n)return y=n.id,void v({browserId:t,companionMdId:e});s.Cmd.on(s.APP_STATE_SYNC_COMPLETED,(()=>{const n=p.AgentCollection.getByDeviceId(e);null!=(null==n?void 0:n.id)&&null==y&&(y=n.id,v({browserId:t,companionMdId:e}))}))},t.logMessageInfo=function(e){const t=null!=e?p.AgentCollection.get(e):void 0;E({browserId:l.default.persistentExpiringId(),agentId:null==t?void 0:t.id,companionMdId:null==t?void 0:t.deviceId,multideviceAction:d.default.MULTIDEVICE_ACTION_TYPE.MESSAGE_INFO})},t.setShouldLogAgentLogin=function(e){S=e},t.updateUnattributedMessages=function(){return m.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(892844),s=n(781572),l=r(n(379264)),c=n(408139),u=n(978820),d=r(n(11339)),p=n(672894),f=n(139976),_=n(559871),h=n(290981);function g(e){var t;return e.author.user!==(null===(t=(0,u.getMaybeMeUser)())||void 0===t?void 0:t.user)||!e.author.isCompanion()}function m(){return(m=(0,a.default)((function*(e,t){if(g(e))return;const n=e.author.getDeviceId(),r=p.AgentCollection.getByDeviceId(n);if(null==r){const e=t.map((e=>({id:e.id.toString(),deviceId:n})));return f.UnattributedMessageCollection.add(e),void e.forEach((()=>{}))}const i=t.map((e=>_.MsgCollection.get(e.id))).filter(Boolean).filter((e=>null==e.agentId)),a=String(r.id);i.forEach((e=>{e.agentId=a}));const o=i.map((e=>({id:e.id.toString(),agentId:a})));yield(0,h.getTable)().bulkCreateOrMerge(o)}))).apply(this,arguments)}let y,S;function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,c.isMultiDeviceAgentsLoggingEnabled)()&&new d.default.MdExpansionAgentBrowserMdId((0,i.default)({agentId:y},e)).commit(t)}function v(e){null!=S&&E((0,i.default)((0,i.default)((0,i.default)({},e),S),{},{multideviceAction:d.default.MULTIDEVICE_ACTION_TYPE.LOGIN}))}},708727:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessChange=void 0;var r=n(317239),i=n(118146);t.handleBusinessChange=e=>{const t=(0,i.unproxy)(e),{businessProfile:a,id:o}=t,s=t.isBusiness||t.isMe&&r.Conn.isSMB;s&&!a?t.addChild("businessProfile",n(493581).BusinessProfileCollection.gadd(o)):!s&&a&&(t.stopListening(a),t.businessProfile=void 0,a.delete())}},990553:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){if(e===l.BUSINESS_CATEGORY_EMPTY_STR_ID)return(0,s.queryBusinessCategories)("");return(0,s.queryBusinessCategories)(e)},t.queryBusinessProfile=function(e,t){return(0,o.queryBusinessProfile)(e,t)},t.queryBusinessPublicKey=function(e){return(0,o.queryBusinessPublicKey)(e)},t.queryCustomUrlPaths=function(e){return(0,o.queryCustomUrlPaths)(e)},t.querySignedUserInfo=function(){return u.apply(this,arguments)},t.updateCartEnabled=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(978820),o=n(779235),s=n(740346),l=n(132742);function c(){return(c=(0,i.default)((function*(e){const t=n(493581).BusinessProfileCollection,r=yield(0,o.updateCartEnabled)(e),i=t.getValid((0,a.getMeUser)()),s=null==i?void 0:i.profileOptions;i&&s&&(s.cartEnabled=r,t.add(i,{merge:!0}))}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){const{phoneNumber:t,phoneNumberSignature:n,phoneNumberSignatureExpiration:r,businessDomain:i}=yield(0,o.querySignedUserInfo)(e);if(null==t||null==r||null==n||null==i)throw new Error("Unexpected null or undefined");return{phoneNumber:t,phoneNumberSignature:n,phoneNumberSignatureExpiration:r,businessDomain:i}}))).apply(this,arguments)}},163619:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(810635),o=n(707122),s=n(108197),l=n(555452);function c(){return(c=(0,i.default)((function*(e,t,n){const r=p(t),i=p(n),a=[d(e,r,i),u(e,r,i)];yield Promise.all(a.map((t=>t?(0,o.handleSingleMsgMD)(e,t):null)))}))).apply(this,arguments)}function u(e,t,n){if(!0===(0,l.getGlobalSecurityNotifications)())return t===s.ReducedPrivacyMode.E2EE&&n!==s.ReducedPrivacyMode.E2EE?(0,a.genEncryptNotificationMsg)(e,"e2e_identity_unavailable"):void 0}function d(e,t,n){if(t!==n)switch(n){case s.ReducedPrivacyMode.E2EE:return(0,a.genEncryptNotificationMsg)(e,"encrypt_now");case s.ReducedPrivacyMode.BSP:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_bsp");case s.ReducedPrivacyMode.FB:return(0,a.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_to_fb")}}function p(e){return(0,s.getReducedPrivacyMode)(e.isBusiness&&e.isEnterprise?e.privacyMode:null)}},895697:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.addProduct)(e,t,n)},t.appealProduct=function(e,t){return(0,s.appealProduct)(e,t)},t.createBusinessCatalog=function(){return(0,s.createCatalog)()},t.deleteProducts=function(e){return(0,s.deleteProducts)(e)},t.editProduct=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return(0,s.editProduct)(e,t,n)},t.queryCatalog=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return(0,s.queryCatalog)(e,t,n,r,i,a,o)},t.queryProduct=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;return(0,s.queryProduct)(e,t,n,r,i,a)},t.queryProductList=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,i=arguments.length>4?arguments[4]:void 0;return(0,s.queryProductList)(e,t,n,r,i)},t.reportProduct=function(e,t,n){return(0,s.reportProduct)(e,t,n)},t.sendProductToChat=function(e,t,n){const{catalogWid:s}=e;if(!t)return;const d=t.productCollection.get(e.id),p=d?(0,c.unproxy)(d):(0,c.unproxy)(e);if(!p)return;const f=p.getProductImageCollectionHead(),_=null==f?void 0:f.mediaData;if(!_)return;(0,a.findChat)(s).then((function(e){r.Cmd.openChatFromUnread(e).then((t=>{if(t){const t=(0,c.unproxy)((0,u.createProductInquiry)(p,s,_,null==n?void 0:n.session.toString()));e.composeQuotedMsg=t,l.ComposeBoxActions.focus(e),window.innerWidth<=o.LAYOUT_2COLUMNS_MAX_WIDTH&&i.DrawerManager.closeDrawerRight()}}))}))};var r=n(781572),i=n(141455),a=n(211739),o=n(941906),s=(n(665397),n(621374)),l=n(188172),c=n(118146),u=n(17304)},641399:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateProductListHeaderImageRejected=function(e,t){var n,i,a;const o=r.MsgCollection.get(t),s=null==o||null===(n=o.list)||void 0===n||null===(i=n.productListInfo)||void 0===i||null===(a=i.headerImage)||void 0===a?void 0:a.productId;e.id===s&&null!=o&&(o.productHeaderImageRejected=!0)};var r=n(559871)},738815:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyContactBusinessProps=void 0,t.updateContactsWithVerifiedNames=p;var i=r(n(348926)),a=r(n(145095)),o=n(88555),s=n(745454),l=n(49714),c=n(393170),u=n(719380),d=n(468708);function p(e,t){const n={};for(const t of e){const{id:e}=t;n[e.user]=t}for(const e of t){const{id:t}=e,r=n[t.user],i=Boolean(r),{level:a,name:o,isApi:s,privacyMode:l}=r||{},c={isBusiness:i,isEnterprise:Boolean(s),verifiedLevel:_(a),verifiedName:o,privacyMode:l};e.set(c)}}const f=function(){var e=(0,i.default)((function*(){if((0,o.isLegacyWebdBackend)())return;p((yield(0,d.getAllVerifiedNames)()).map((e=>{let{id:t,name:n,level:r,isApi:i,privacyMode:o}=e;return{id:(0,s.createUserWid)(t),name:n,level:r,isApi:i,privacyMode:o?{actualActors:(0,a.default)(l.ActualActorsEnumType.cast(o.actualActors),"ActualActorsEnumType.cast(privacyMode.actualActors)"),hostStorage:(0,a.default)(l.HostStorageEnumType.cast(o.hostStorage),"HostStorageEnumType.cast(privacyMode.hostStorage)"),privacyModeTs:o.privacyModeTs}:null}})),u.ContactCollection.toArray())}));return function(){return e.apply(this,arguments)}}();function _(e){if(null!=e){switch(e){case"unknown":return c.VERIFIED_LEVEL.UNKNOWN;case"low":return c.VERIFIED_LEVEL.LOW;case"high":return c.VERIFIED_LEVEL.HIGH}return c.VERIFIED_LEVEL.UNKNOWN}}t.applyContactBusinessProps=f},880617:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndUpdateContactPropertiesOnNewChat=function(){return f.apply(this,arguments)},t.updateVerifiedInfo=d;var i=r(n(348926)),a=n(88555),o=n(738815),s=n(264687),l=n(57547),c=n(719380),u=n(468708);function d(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=e.id,{name:r,level:i,isApi:l,serial:c}=t,d=t.privacyMode;(0,a.isMDBackend)()&&null!=d&&(yield(0,s.handlePrivacyModeTransition)(n,d,null,!0)),(0,o.updateContactsWithVerifiedNames)([{id:n,name:r,level:i,isApi:l,privacyMode:d}],[e]),yield(0,u.createOrUpdateVerifiedBusinessName)({id:n.user,level:i,serial:c,name:r,isApi:l,privacyMode:d?{actualActors:d.actualActors,hostStorage:d.hostStorage,privacyModeTs:d.privacyModeTs}:null})}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){if((0,a.isMDBackend)()){const t=yield(0,l.queryExists)(e);if(null==t)return;const{bizInfo:n}=t;if(n){const t=c.ContactCollection.get(e);if(null==t)return __LOG__(4,void 0,new Error,!0)`queryAndUpdateContactPropertiesOnNewChat contact does not exist ${""}`,void SEND_LOGS("queryAndUpdateContactPropertiesOnNewChat contact does not exist");yield d(t,n.verifiedName)}}}))).apply(this,arguments)}},929723:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedNameSync=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(738815),s=n(264687),l=n(785808);function c(){return(c=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)()||0===e.length)return;yield e.map((e=>{let{id:t,verifiedName:{privacyMode:r}}=e;if(null==r)return;const i=n(669951).ChatCollection.get(t);return null!=i&&!0!==i.shouldAppearInList?(0,s.handlePrivacyModeTransition)(t,r,i,!0):void 0}));const t=e.map((e=>{let{id:t,verifiedName:{level:n,serial:r,name:i,isApi:a,privacyMode:o}}=e;return{id:t.user,level:n,serial:r,name:i,isApi:a,privacyMode:o?{actualActors:o.actualActors,hostStorage:o.hostStorage,privacyModeTs:o.privacyModeTs}:null}}));yield(0,l.getTable)().bulkCreateOrReplace(t),yield(0,o.applyContactBusinessProps)()}))).apply(this,arguments)}},516413:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getWidfromPath=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(492574),o=n(275261),s=n(745454);function l(){return(l=(0,i.default)((function*(e){try{const t=yield(0,o.getUserByCustomURL)(e);return(0,s.createUserWid)(t.user.jid)}catch(e){if(e instanceof a.ServerStatusCodeError)return null;throw e}}))).apply(this,arguments)}},802331:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrder=function(e,t){return(0,r.createOrder)(e,t)},t.queryOrder=function(e,t,n,i,a){return(0,r.queryOrder)(e,t,n,i,a)};var r=n(968825)},133374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return("function"==typeof BigInt?BigInt:Number)(String(Date.now())+Math.random().toFixed(4).slice(-4)).toString(36).toUpperCase()}},211739:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.findChat=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(389385),o=n(991829),s=n(909025);function l(){return(l=(0,i.default)((function*(e,t,n){if(null==n?void 0:n.aborted)throw new a.AbortError;const r=yield(0,s.getExisting)(e);if(r)return r;if(null==n?void 0:n.aborted)throw new a.AbortError;return yield(0,o.create)(e,{createdLocally:!0},{forceUsync:t})}))).apply(this,arguments)}},750180:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createChatOnNewMsg=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(108197),o=n(991829),s=n(719380);function l(){return(l=(0,i.default)((function*(e,t,n){if(!e.isUserNotPSA())return;const r=s.ContactCollection.gadd(e);(0,a.comparePrivacyMode)(n,r.privacyMode)>0&&(r.privacyMode=n),yield(0,o.create)(e,{createdLocally:!1},{firstIncomingMsg:t,nextPrivacyMode:r.privacyMode})}))).apply(this,arguments)}},366517:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearPresence=function(e){e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"));e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.typing=!1},t.markComposing=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.typing){const t=e.id;(0,o.sendChatStateComposing)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence composing error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,a.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),u)}e.typing=!0,e.pausedTimerId&&clearTimeout(e.pausedTimerId);e.pausedTimerId=setTimeout((()=>d(e)),2500)}((0,l.unproxy)(e))},t.markPaused=function(e){return d((0,l.unproxy)(e))},t.markRecording=function(e){return function(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&!e.recording){const t=e.id;(0,o.sendChatStateRecording)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence recording error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,a.ProtoVersionUndefined],(()=>{}))),e.presenceResendTimerId=setTimeout((()=>p(e)),u)}e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId"));e.recording=!0,e.typing=!1}((0,l.unproxy)(e))},t.presenceOnlineChanged=function(e){e.presence.isOnline?p(e):e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId"))},t.sendPresenceAvailable=function(){(0,s.setPresenceAvailable)()},t.sendPresenceUnavailable=function(){(0,s.setPresenceUnavailable)()};var r=n(450796),i=n(492574),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),o=n(476931),s=n(102253),l=n(118146);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}const u=1e4;function d(e){if((e.presence.isOnline||e.isGroup||e.isPresenceUnknown())&&(e.typing||e.recording)){const t=e.id;(0,o.sendChatStatePaused)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence paused error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,a.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId&&(clearTimeout(e.presenceResendTimerId),e.unset("presenceResendTimerId")),e.pausedTimerId&&(clearTimeout(e.pausedTimerId),e.unset("pausedTimerId")),e.typing=e.recording=!1}function p(e){const t=e.id;if(e.recording)(0,o.sendChatStateRecording)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend recording error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,a.ProtoVersionUndefined],(()=>{})));else{if(!e.typing)return void e.unset("presenceResendTimerId");(0,o.sendChatStateComposing)(t).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(e=>{e.status>=400&&__LOG__(3)`models:chat send presence resend composing error ${t.toString()}`}))).catch((0,r.filteredCatch)([i.WebdDrop,a.ProtoVersionUndefined],(()=>{})))}e.presenceResendTimerId=setTimeout((()=>p(e)),u)}},382019:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearChat=S,t.clearMessagesInChatModel=E,t.createEncryptionSystemMessage=function(e,t){if((0,s.isLegacyWebdBackend)())return Promise.resolve();if(t)return Promise.resolve();const{handleSingleMsgMD:r}=n(707122),i=(0,l.default)(e.id,e.contact.privacyMode);return r(i.from,i)},t.sendClear=function(e,t){return y((0,h.unproxy)(e),t)};var i=r(n(348926)),a=n(450796),o=n(492574),s=n(88555),l=r(n(329224)),c=n(408139),u=n(694816),d=n(391177),p=n(358871),f=r(n(914296)),_=n(446331),h=n(118146),g=n(548360),m=n(785893);function y(e,t){const{promises:r}=e;if(r.sendClear)return r.sendClear;const h=e.getLastMsgKeyForAction(),v=r.sendClear=(0,d.sendClear)(e,h,t),T=new _.ActionType(f.default.t(19)),C=v.then(function(){var t=(0,i.default)((function*(){const t=n(461957).ConversationEndOfHistoryTransferModelPropType;return e.endOfHistoryTransferType=t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY,yield(0,p.updateLocal)(e.id,{endOfHistoryTransferType:t.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY}),(0,s.isMDBackend)()&&!(0,c.clearOrDeleteChatSyncEnabled)()?new _.ActionType(g.fbt._("Chat cleared from this device",null,{hk:"1XIeYe"})):new _.ActionType(f.default.t(18))}));return function(){return t.apply(this,arguments)}}()).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(e=>{if(e.status>=400)return new _.ActionType(f.default.t(17))}))).catch((()=>(__LOG__(3)`models:chat:sendClear dropped`,new _.ActionType(f.default.t(17),{actionText:f.default.t(122),actionHandler:()=>y(e,t)}))));return u.ToastManager.open((0,m.jsx)(_.ActionToast,{id:(0,_.genId)(),initialAction:T,pendingAction:C})),v.then((r=>{if(!r._duplicate)if((0,s.isMDBackend)()){if(!(0,c.clearOrDeleteChatSyncEnabled)()){S(e,t);const{handleSingleMsgMD:r}=n(707122),i=(0,l.default)(e.id,e.contact.privacyMode);return r(i.from,i)}r.result&&E(e,r.result)}else S(e,t)})).catch((0,a.filteredCatch)(o.ServerStatusCodeError,(()=>{}))).finally((()=>{r.sendClear=null}))}function S(e,t){if(e){const n=e.getLastMsgKeyForAction(),r=n?e.msgs.get(n):void 0;e.deleteMsgsBeforeMsgInclusive(r,t)}}function E(e,t){e&&t&&e.deleteMessages(t)}},623631:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addAndSendMsgToChat=function(e,t,r){return function(e,t){let r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const o=Promise.resolve(t).then((t=>{const i=n(559871).MsgCollection,o=(0,a.default)({},t),p=(0,f.getContactPrivacyMode)(e.id);null!=p&&(o.privacyModeWhenSent=p);const{attributeAgentToMessage:_}=n(75396);_(o);const g=i.add(o)[0];if(g){var S;(0,s.isMDBackend)()&&(g.wamMessageSendPerfReporter=new h.MessageSendPerfReporter(g.to,g.getWamMediaType(),g.getWamMessageType())),r=(0,c.default)(g,e);const t=r?[r,o]:[o];return null===(S=g.wamMessageSendPerfReporter)||void 0===S||S.startSavedStage(),(0,y.storeMessages)(t,e.id).then((()=>{var e;if(null===(e=g.wamMessageSendPerfReporter)||void 0===e||e.postSavedStage(),g.type===d.MSG_TYPE.GROUPS_V4_INVITE){const e=parseInt(g.inviteCodeExp,10);return(0,n(393717).revokeGroupInvitesV4)(g.from.toString(),g.to.toString(),g.inviteGrp,e).then((()=>(0,m.persistGroupInviteV4Msg)(g.id.toString(),{id:g.id.toString(),from:g.from.toString(),to:g.to.toString(),groupId:g.inviteGrp,expiration:e,expired:l.Clock.globalUnixTime()>=e})))}})).then((()=>g.waitForPrep().then((()=>g))))}throw new u.ModelCreateError("Msg",o)})),p=e.addQueue.enqueue(o).then((t=>{var n;return null===(n=t.wamMessageSendPerfReporter)||void 0===n||n.startRenderedStage(),r&&e.msgs.add(r),e.msgs.add(t)[0]})).then((e=>{var t;return null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.postRenderedStage(),e})),_=i?p.then(i).then((()=>p)):p,g=E(e,_);return[p,g]}((0,g.unproxy)(e),t,r)},t.resendMsgToChat=function(e,t){return E((0,g.unproxy)(e),t)};var i=r(n(348926)),a=r(n(81109)),o=n(524674),s=n(88555),l=n(40234),c=r(n(526947)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),d=n(115461),p=n(879274),f=n(108197),_=n(745042),h=(n(20551),n(751708)),g=n(118146),m=n(562415),y=n(584886);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){if((0,s.isMDBackend)()&&e.isGroup){const t=n(963928).default;yield t.find(e.id)}return new p.NonPersistJob("sendMessage",(0,i.default)((function*(){const n=yield e.sendQueue.enqueue(t);return(0,_.sendMsgRecord)(n)})),{priority:o.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}},45775:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageReport=function(e){const t=(0,h.unproxy)(e);return S(t.chat,u.SpamFlow.MessageMenu,(0,_.genId)(),t)},t.sendMessageReportBlock=function(e){return function(e){const{senderObj:t,chat:n}=e,{promises:r}=n;if(r.reportMessageBlock)return r.reportMessageBlock;const i=S(n,u.SpamFlow.MessageMenu,(0,_.genId)(),e);return r.reportMessageBlock=i.then((()=>(0,o.blockContact)(t))).catch((()=>{})).finally((()=>{r.reportMessageBlock=null})),r.reportMessageBlock}((0,h.unproxy)(e))},t.sendNotSpam=function(e,t){return E((0,h.unproxy)(e),t)},t.sendSpamBlockClear=function(e,t){return function(e,t){const{promises:n,isGroup:r,contact:i}=e;if(n.reportSpamBlockClear)return n.reportSpamBlockClear;if(r)return Promise.reject(new l.ActionError);const a=S(e,t);return n.reportSpamBlockClear=a.then((()=>(0,o.blockContact)(i))).then((()=>(0,c.sendClear)(e,!1))).catch((()=>{})).finally((()=>{n.reportSpamBlockClear=null})),n.reportSpamBlockClear}((0,h.unproxy)(e),t)},t.sendSpamExitClear=function(e,t){return function(e,t){const{promises:n,isGroup:r,isReadOnly:i}=e;if(n.reportSpamExitClear)return n.reportSpamExitClear;if(!r)return Promise.reject(new l.ActionError);let a;const o=S(e,t);if(i)a=o;else{const t=(0,s.sendExitGroup)(e);a=Promise.all([o,t])}return n.reportSpamExitClear=a.then((()=>(0,c.sendClear)(e,!1))).catch((()=>{})).finally((()=>{n.reportSpamExitClear=null})),n.reportSpamExitClear}((0,h.unproxy)(e),t)},t.sendSpamReport=function(e,t){return S((0,h.unproxy)(e),t)};var i=n(450796),a=n(492574),o=n(48826),s=n(525510),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),c=n(382019),u=n(387674),d=n(694816),p=n(526707),f=r(n(914296)),_=n(446331),h=n(118146),g=n(548360),m=n(785893);function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}function S(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,_.genId)(),r=arguments.length>3?arguments[3]:void 0;const{promises:o}=e;if(o.sendSpamReport)return o.sendSpamReport;let s;s=o.sendSpamReport=null!=r?(0,p.sendMessageReport)(r,t):(0,p.sendSpamReport)(e,t);const l=g.fbt._("Couldn't send report",null,{hk:"1pi8YP"}),c=new _.ActionType(g.fbt._("Sending report",null,{hk:"4lEUEy"})),u=s.then((()=>new _.ActionType(g.fbt._("Report sent",null,{hk:"1nhiB7"})))).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(()=>new _.ActionType(l)))).catch((()=>(__LOG__(3)`models:chat:sendSpamReport dropped`,new _.ActionType(l,{actionText:g.fbt._("Try again.",null,{hk:"4vumLV"}),actionHandler:()=>S(e,t,n,r)}))));return d.ToastManager.open((0,m.jsx)(_.ActionToast,{id:n,initialAction:c,pendingAction:u})),s.finally((()=>{o.sendSpamReport=null}))}function E(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,_.genId)();const{promises:r,notSpam:o}=e;if(o)return Promise.resolve();if(r.sendNotSpam)return r.sendNotSpam;const s=r.sendNotSpam=(0,p.sendNotSpam)(e);if(t){const r=new _.ActionType(f.default.t(73)),o=s.then((()=>new _.ActionType(f.default.t(75)))).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(()=>new _.ActionType(f.default.t(74))))).catch((()=>(__LOG__(3)`models:chat:sendNotSpam dropped`,new _.ActionType(f.default.t(74),{actionText:f.default.t(122),actionHandler:()=>E(e,t,n)}))));d.ToastManager.open((0,m.jsx)(_.ActionToast,{id:n,initialAction:r,pendingAction:o}))}return s.then((()=>{e.set({notSpam:!0})})).finally((()=>{e.isTrusted(),r.sendNotSpam=null}))}},289488:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendTcToken=function(){return d.apply(this,arguments)},t.sendTcTokenWhenDeviceIdentityChange=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(892844),o=n(40234),s=n(804008),l=n(564603),c=n(669951),u=n(776214);function d(){return(d=(0,i.default)((function*(e){if(!e.isUserNotPSA())return;const t=c.ChatCollection.get(e);if(null!=t&&(0,l.shouldSendNewToken)(t.tcTokenSenderTimestamp))try{const n=(0,a.castToUnixTime)(o.Clock.globalUnixTime());yield(0,s.setPrivacyTokens)(e,[s.TokenType.TrustedContact],n);const r={tcTokenSenderTimestamp:n};t.set(r),yield(0,u.getChatTable)().merge(e.toString(),r)}catch(e){__LOG__(3,!0,void 0,!0)`sendTcToken failed - ${e}`,SEND_LOGS("send-tc-token-failed")}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=c.ChatCollection.get(e);if(null==t)return;const n=t.tcTokenSenderTimestamp;if(null!=n&&!(0,l.isTokenExpired)(n,l.TcTokenMode.Sender))try{yield(0,s.setPrivacyTokens)(e,[s.TokenType.TrustedContact],(0,a.castToUnixTime)(n))}catch(e){__LOG__(3,!0,void 0,!0)`sendTcTokenWhenDeviceIdentityChange failed - ${e}`,SEND_LOGS("send-tc-token-device-identity-change-failed")}}))).apply(this,arguments)}},547159:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.unstarAllMessages=function(e,t){return f(e,t?(0,u.unproxy)(t):t)};var i=n(450796),a=n(492574),o=n(694816),s=n(469694),l=r(n(914296)),c=n(446331),u=n(118146),d=n(719011),p=n(785893);function f(e,t){const r=n(669951).ChatCollection,u=t?t.promises:r.promises,_=t?t.id:void 0;if(u.sendUnstarAll)return u.sendUnstarAll;const h=u.sendUnstarAll=(0,s.sendUnstarAll)(e,_),g=new c.ActionType(l.default.t(90)),m=h.then((()=>new c.ActionType(l.default.t(88)))).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(e=>{if(e.statusCode>=400)return new c.ActionType(l.default.t(84))}))).catch((()=>(__LOG__(3)`models:chat:sendUnstarAll dropped`,new c.ActionType(l.default.t(84),{actionText:l.default.t(122),actionHandler:()=>f(e,t)}))));return o.ToastManager.open((0,p.jsx)(c.ActionToast,{id:(0,c.genId)(),initialAction:g,pendingAction:m})),h.then((()=>{e.forEach((e=>{e.set("star",!1)})),t?(0,d.removeStarredMsgs)(e):(d.AllStarredMsgsCollection.reset(),r.forEach((e=>{e.starredMsgs&&e.starredMsgs.reset()})))})).finally((()=>{u.sendUnstarAll=null}))}},797970:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setTcToken=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(676100),o=n(909025),s=n(776214),l=n(724319);function c(){return(c=(0,i.default)((function*(e,t,n){if(null==n)return;if(!e.isUserNotPSA())return;const r=yield(0,o.getExisting)(e);if(null==r)return void(yield(0,l.createOrUpdateOrphanTcToken)(e.toString(),{tcToken:n,tcTokenTimestamp:t}));if(null!=r.tcToken&&(0,a.arrayBuffersEqualUNSAFE)(r.tcToken,n)||null!=r.tcTokenTimestamp&&r.tcTokenTimestamp>t)return;const i={tcToken:n,tcTokenTimestamp:t};r.set(i),yield(0,s.getChatTable)().merge(e.toString(),i)}))).apply(this,arguments)}},691102:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setTcTokenSenderTimestamp=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(909025),o=n(776214),s=n(724319);function l(){return(l=(0,i.default)((function*(e,t){if(!e.isUserNotPSA())return;const n=yield(0,a.getExisting)(e);if(null==n)return void(yield(0,s.createOrUpdateOrphanTcToken)(e.toString(),{tcTokenSenderTimestamp:t}));if(null!=n.tcTokenSenderTimestamp&&n.tcTokenSenderTimestamp>t)return;const r={tcTokenSenderTimestamp:t};n.set(r),yield(0,o.getChatTable)().merge(e.toString(),r)}))).apply(this,arguments)}},14571:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteDatabaseForLastReactionPreview=function(){return c.apply(this,arguments)},t.deleteModelsForLastReactionPreview=function(e){if(!(0,a.showReactionChatListPreview)())return;const t=new Set(e.map((e=>o.default.fromString(e).remote.toString()))),r=n(669951).ChatCollection;t.forEach((t=>{var n;const i=r.get(t);null!=i&&e.includes(null===(n=i.lastReactionPreview)||void 0===n?void 0:n.parentMsgKey)&&i.unset("lastReactionPreview")}))},t.updateDatabaseForLastReactionPreview=function(e){if(!(0,a.showReactionChatListPreview)())return Promise.resolve();return(0,l.bulkUpdateChatLastReactionPreview)(e)},t.updateModelsForLastReactionPreview=function(e){if(!(0,a.showReactionChatListPreview)())return;const t=n(669951).ChatCollection;e.forEach(((e,n)=>{const r=t.get(n);null!=r&&r.set({lastReactionPreview:e})}))};var i=r(n(348926)),a=n(408139),o=r(n(465212)),s=n(900267),l=n(448285);function c(){return(c=(0,i.default)((function*(e){if(!(0,a.showReactionChatListPreview)())return Promise.resolve();const t=new Set(e.map((e=>o.default.fromString(e).remote.toString()))),n=yield(0,s.bulkGetChatLastReactionPreviewMap)(Array.from(t)),r=new Map;n.forEach(((t,n)=>{e.includes(null==t?void 0:t.parentMsgKey)&&r.set(n,void 0)})),yield(0,l.bulkUpdateChatLastReactionPreview)(r)}))).apply(this,arguments)}},561498:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearUnreadMentions=function(e){var t;(0,o.isGroupCatchUpEnabled)()&&e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.unreadMentionMetadata.reset())},t.markSeen=v,t.markUnread=function(e,t){return C((0,h.unproxy)(e),t)},t.markUnseen=T,t.sendSeen=E,t.updateUnreadCountMD=M;var i=r(n(348926)),a=n(450796),o=n(227101),s=n(492574),l=n(88555),c=r(n(364369)),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),d=n(694816),p=n(297848),f=r(n(914296)),_=n(446331),h=n(118146),g=n(608080),m=n(448285),y=n(785893);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function E(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return A((0,h.unproxy)(e),t).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{__LOG__(3)`sendSeen: got status ${e.status}`})))}function v(e,t,n){return function(){return O.apply(this,arguments)}((0,h.unproxy)(e),t,n)}function T(e){!function(e){0!==e.unreadCount&&e.unreadCount!==c.default.MARKED_AS_UNREAD||(e.active&&(e.markedUnread=!0),(0,p.markConversationUnseen)(e.id).then((()=>{e.unreadCount=c.default.MARKED_AS_UNREAD})))}((0,h.unproxy)(e))}function C(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,_.genId)();t?e.active&&(e.markedUnread=!0):e.markedUnread=!1;const{promises:r}=e;if(r.markUnread)return r.markUnread;const i=r.markUnread=t?b(e):A(e),o=t?new _.ActionType(f.default.t(28)):new _.ActionType(f.default.t(27)),l=i.then((()=>{const r=t?f.default.t(26):f.default.t(25);return new _.ActionType(r,{actionText:f.default.t(126),actionHandler:()=>C(e,!t,n)})})).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{if(e.status>=400)return t?new _.ActionType(f.default.t(24)):new _.ActionType(f.default.t(23));throw new Error("invalid response status")}))).catch((()=>{const r=t?f.default.t(24):f.default.t(23);return new _.ActionType(r,{actionText:f.default.t(122),actionHandler:()=>C(e,t,n)})}));return d.ToastManager.open((0,y.jsx)(_.ActionToast,{id:n,initialAction:o,pendingAction:l})),i.then((()=>{})).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{__LOG__(3)`markUnread: got status ${e.status}`}))).finally((()=>{r.markUnread=null}))}function A(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.markedUnread||0===e.unreadCount)return String(e.markedUnread),e.unreadCount,Promise.resolve();if(!g.Stream.available&&t)return e.listenToOnce(g.Stream,"change:available",(()=>E(e))),Promise.resolve();e.unreadCount,e.pendingSeenCount;const n=e.unreadCount-e.pendingSeenCount,r=-1===e.unreadCount&&-1===n;if(n<=0&&!r)return Promise.resolve();e.disableUnreadAnchor=!0,e.pendingSeenCount=e.unreadCount,e.unreadCount;const i=()=>{e.pendingSeenCount=e.pendingSeenCount-n,e.pendingSeenCount,e.pendingSeenCount<0&&(__LOG__(3)`models:chat:sendSeen unread ${e.unreadCount} pending: ${e.pendingSeenCount} delta: ${n}`,e.pendingSeenCount=0)},o=e.getLastMsgKeyForAction();return(0,p.sendConversationSeen)(e,o,n).then((t=>{(0,l.isMDBackend)()?M(e,n):t._duplicate?i():v(e,n,!0)})).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>(i(),Promise.reject(e))))).catch((0,a.filteredCatch)([s.WebdDrop,u.ProtoVersionUndefined],(()=>{i(),__LOG__(3)`models:chat:sendConversationSeen dropped`}))).then((()=>{}))}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e){const t=e.getLastMsgKeyForAction();try{yield(0,p.sendConversationUnseen)(e.id,t),T(e)}catch(t){return(0,a.filteredCatch)(s.ServerStatusCodeError,(t=>(e.markedUnread=!1,Promise.reject(t))))(t)}}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];String(t);let r=null;null!=t?t>0&&t<=e.unreadCount?r=e.unreadCount-t:-1===t&&e.unreadCount<=0&&(r=0):r=0;const i=null==r?Promise.resolve():(0,p.markConversationSeen)(e.id,r);if(yield i,null!=t&&n){const n=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,n),e.pendingSeenCount}null!=r&&(e.unreadCount=r),e.unreadMsgAnchor=void 0,e.markedUnread=!1}))).apply(this,arguments)}function M(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{unreadCount:r}=yield(0,m.getChatMeta)(e.id);if(e.unreadCount,e.unreadCount=r,e.unreadMsgAnchor=void 0,e.markedUnread=!1,n){const n=e.pendingSeenCount-t;e.pendingSeenCount=Math.max(0,n)}}))).apply(this,arguments)}},461827:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.shouldEnableArchiveV2=function(){if((0,i.isMDBackend)())return!1;const e=n(669951).ChatCollection.filter((e=>e.archive));return(0,a.archiveV2Supported)()&&!s.default.archive.enabled&&1===e.length},t.shouldUnarchiveChat=function(e){if((0,a.archiveV2Supported)()){if(s.default.showArchiveV2)return!1;if((0,i.isLegacyWebdBackend)()&&!s.default.archive.enabled&&!e)return(0,o.setArchiveEnabledSetting)(!0),!1}return!0},t.shouldUnarchiveChatOnReaction=function(e,t,n){if(e&&!t&&""!==n)return!(0,a.archiveV2Supported)()||!s.default.showArchiveV2;return!1};var i=n(88555),a=n(408139),o=n(438914),s=r(n(268132))},986505:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(358871),o=n(524606),s=n(124175),l=n(714777),c=n(776290);function u(){return(u=(0,i.default)((function*(e,t,n){var r,i;let u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.maybeUpdateEphemeralSetting should not be called for group ${e.id.toString()}`,SEND_LOGS("handle-ephemeral-sync-response"),!1;if(!(0,l.isEphemeralDurationAllowed)(t))return __LOG__(2)`chat.maybeUpdateEphemeralSetting called with invalid setting ${t} seconds for chat ${e.id.toString()}`,!1;const d=null!==(r=e.ephemeralSettingTimestamp)&&void 0!==r?r:0,p=null!==(i=e.ephemeralDuration)&&void 0!==i?i:0,f=e.id,_=(0,c.shouldUpdateEphemeralSetting)({oldDuration:p,oldSettingTimestamp:d,newDuration:t,newSettingTimestamp:n,chatId:f});return _&&(yield(0,a.updateLocal)(e.id,{ephemeralDuration:t,ephemeralSettingTimestamp:n,disappearingModeInitiator:o.DisappearingModeInitiator.ChangedInChat}),p!==t&&u&&(yield(0,s.generateEphemeralSystemMessage)(e,t)),e.ephemeralDuration=t,e.ephemeralSettingTimestamp=n,e.disappearingModeInitiator=o.DisappearingModeInitiator.ChangedInChat,__LOG__(2)`chat.maybeUpdateEphemeralSetting updated chatId=${e.id.toString()} ephemeralDuration=${t} ephemeralSettingTimestamp=${n}`),_}))).apply(this,arguments)}},984145:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.isGroup)return __LOG__(4,void 0,new Error,!0)`chat.updateEphemeralSettingTimestamp should not be called for group ${e.id.toString()}`,void SEND_LOGS("update-ephemeral-setting-timestamp");(0,r.updateLocal)(e.id,{ephemeralSettingTimestamp:t}).then((()=>{e.ephemeralSettingTimestamp=t,__LOG__(2)`chat.updateEphemeralSettingTimestamp chatId=${e.id.toString()} ephemeralSettingTimestamp=${t}`}))};var r=n(358871)},702242:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{chat:t,undelivered:n,canForward:r,cannotForward:o}=e;const s=r.length-n.length,l=o.length+n.length;if(s>0)return n.length?o.length?t.isUser?i.default.t(167,{count:l,_plural:l,contact:t.formattedTitle}):i.default.t(167,{count:l,_plural:l}):i.default.t(166,{count:l,_plural:l}):i.default.t(164,{count:l,_plural:l,contact:t.formattedTitle});if(n.length)return o.length?t.isUser?a.fbt._("No messages could be forwarded because the file is missing or {contact} is on a version of WhatsApp that doesn't support them.",[a.fbt._param("contact",t.formattedTitle)],{hk:"1dNF4S"}):a.fbt._("No messages could be forwarded because the file is missing or __contact__ is on a version of WhatsApp that doesn't support them.",null,{hk:"11bRZ3"}):a.fbt._("No messages could be forwarded because the file is missing.",null,{hk:"1dn9Vk"});if(!t.isUser)return i.default.t(165);return i.default.t(165,{contact:t.formattedTitle})};var i=r(n(914296)),a=n(548360)},428233:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(640265);class i extends((0,r.customError)("ForwardError")){constructor(e){super(),this.reasons=e}}t.default=i},153492:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.databaseUpdatesForSubgroupLink=function(e,t){return u(e,t,!0)},t.databaseUpdatesForSubgroupUnlink=function(e,t){return u(e,t,!1)},t.forceFetchProfilePics=function(e){e.forEach((e=>{const t=c.ProfilePicThumbCollection.get(e.toString());null!=t&&t.markStale({eurl:!0}),c.ProfilePicThumbCollection.find(e)}))},t.partitionSubgroups=d,t.updateModelsForSubgroupLink=function(e,t){const{unjoinedSubgroups:n,joinedSubgroups:r}=d(t);(0,s.updateUnjoinedSubgroupsInCollection)(n,e),(0,s.updateJoinedSubgroupsInCollection)(r,e);l.default.assertGet(e).set({lastActivityTimestamp:i.Clock.globalUnixTime()})},t.updateModelsForSubgroupUnlink=function(e,t){const{unjoinedSubgroups:n,joinedSubgroups:r}=d(t);(0,s.updateUnjoinedSubgroupsInCollection)(n,e,!1),(0,s.updateJoinedSubgroupsInCollection)(r,e,!1)};var i=n(40234),a=n(381321),o=n(550445),s=n(312889),l=r(n(963928)),c=n(582039);function u(e,t,n){t.forEach((t=>{t.parentGroupId=n?e:void 0}));const{joinedSubgroups:r,unjoinedSubgroups:i}=d(t);return[...r.map((t=>(0,a.persistGroupMetadata)(t.id,{parentGroup:n?e.toString():void 0}))),(0,o.updateUnjoinedSubgroupsJob)(i,e,n)]}function d(e){return e.reduce(((e,t)=>((0,s.determineUnjoined)(t.id)?e.unjoinedSubgroups=e.unjoinedSubgroups.concat(t):e.joinedSubgroups=e.joinedSubgroups.concat(t),e)),{joinedSubgroups:[],unjoinedSubgroups:[]})}},146033:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatCollection=function(){return n(669951).ChatCollection},t.groupMetaDataCollection=function(){return n(963928).default},t.unjoinedSubgroupMetaDataCollection=function(){return n(873213).default}},888904:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.upgradeToCommunity=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(257243),o=n(40234),s=n(56080),l=n(711597);function c(){return(c=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=(0,a.getABPropConfigValue)("parent_group_query_ts");if(!e&&-1===t)return yield u(),void __LOG__(2)`upgradeToCommunity: parentGroupQueryTs (${t}), force-fetched groups and set isCommunityDiscovered to true`;const n=(0,l.getIsCommunityDiscovered)();if(n)return;if(e)return(0,l.setIsCommunityDiscovered)(!0),void __LOG__(2)`upgradeToCommunity: isInitialBootstrap is true, set isCommunityDiscovered to true`;const r=o.Clock.globalUnixTime();if(0===t||r<t)(0,l.setIsCommunityDiscovered)(!0),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${t}), set isCommunityDiscovered to true`;else try{yield u(),__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${t}), fetched groups and set isCommunityDiscovered to true`}catch(e){__LOG__(2)`upgradeToCommunity: currentTs (${r}), parentGroupQueryTs (${t}), fetched groups and failed, kept isCommunityDiscovered at false`}}))).apply(this,arguments)}function u(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){yield(0,s.queryAndUpdateAllGroupMetadata)(),(0,l.setIsCommunityDiscovered)(!0)}))).apply(this,arguments)}},312889:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUnjoinedSubgroupsInCollection=function(e,t){const n=(0,o.unjoinedSubgroupMetaDataCollection)().filter((e=>e.parentGroupId.equals(t))).map((e=>e.id)).filter((t=>!e.includes(t)));(0,o.unjoinedSubgroupMetaDataCollection)().remove(n)},t.dbAsUpdate=function(e){const t={},{id:n,parentGroup:r,subjectTime:i}=e;n&&(t.id=(0,c.createWid)(n));r&&(t.parentGroup=(0,c.createWid)(r));null!=i&&(t.subjectTime=i);return(0,a.default)((0,a.default)({},e),t)},t.determineUnjoined=m,t.getUnjoinedGroupIds=y,t.getUnjoinedSubgroups=function(e){const t=y(e.map((e=>{let{id:t}=e;return t})));return e.filter((e=>t.includes(e.id)))},t.subgroupJoinedToUnjoined=function(e,t){const n=(0,o.chatCollection)().get(t.toString()),r=null==n?void 0:n.groupMetadata;if(null==n||null==r)return;const i={id:t,subject:n.formattedTitle,defaultSubgroup:!!r.defaultSubgroup,parentGroupId:e.id};(0,l.updateUnjoinedSubgroupsJob)([i],e.id),h([i],e.id),g([i],e.id,!1),(0,s.persistGroupMetadata)(t,{parentGroup:void 0})},t.subgroupUnjoinedToJoined=function(e,t){(0,u.removeUnjoinedSubgroupMetadataFromStorage)(t),_(t),f(e),p(e)},t.unlinkParentGroup=function(e,t){(0,o.groupMetaDataCollection)().add({id:t,parentGroup:null},{merge:!0}),p(e)},t.updateJoinedSubgroups=p,t.updateJoinedSubgroupsInCollection=g,t.updateUnjoinedSubgroups=f,t.updateUnjoinedSubgroupsInCollection=h;var i=r(n(506479)),a=r(n(81109)),o=n(146033),s=n(381321),l=n(550445),c=n(745454),u=n(395716);const d=["subject","subjectTime"];function p(e){e.joinedSubgroups=(0,o.groupMetaDataCollection)().filter((t=>{var n;return(null===(n=t.parentGroup)||void 0===n?void 0:n.equals(e.id))&&t.participants.iAmMember()})).map((e=>e.id))}function f(e){e.unjoinedSubgroups=(0,o.unjoinedSubgroupMetaDataCollection)().filter((t=>t.parentGroupId.equals(e.id))).map((e=>e.id))}function _(e){(0,o.unjoinedSubgroupMetaDataCollection)().remove(e.toString())}function h(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.forEach((e=>{if(!n)return void _(e.id);let{subject:r,subjectTime:i}=e;const s=(0,o.unjoinedSubgroupMetaDataCollection)().get(e.id.toString());s&&(s.subjectTime||0)>(i||0)&&(r=s.subject,i=s.subjectTime),(0,o.unjoinedSubgroupMetaDataCollection)().add((0,a.default)((0,a.default)({},e),{},{parentGroupId:t,subject:r,subjectTime:i}),{merge:!0})})),f((0,o.groupMetaDataCollection)().assertGet(t.toString()))}function g(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.forEach((e=>{const{subject:r,subjectTime:s}=e,l=(0,i.default)(e,d);(0,o.groupMetaDataCollection)().add((0,a.default)((0,a.default)({},l),{},{parentGroup:n?t:null}),{merge:!0})})),p((0,o.groupMetaDataCollection)().assertGet(t.toString()))}function m(e){var t;const n=(0,o.chatCollection)().get(e.toString());return null==n||!(null===(t=n.groupMetadata)||void 0===t?void 0:t.participants.iAmMember())}function y(e){return e.filter((e=>m(e)))}},476195:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPushnameLocally=function(e){i.Conn.pushname=e,(0,r.setPushname)(e)};var r=n(555452),i=n(317239)},47406:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMeToContacts=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(272441),o=n(978820),s=n(546582),l=n(4233);function c(){return(c=(0,i.default)((function*(){const e=yield(0,s.requireContactCollection)(),t=(0,o.getMaybeMeUser)(),n=(0,a.toPhoneUserJid)(t.user);yield(0,l.getTable)().createOrMerge(n,{id:n}),e.gadd(t)}))).apply(this,arguments)}},48826:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockContact=function(e){return p((0,u.unproxy)(e),!0)},t.unblockContact=function(e){return p((0,u.unproxy)(e),!1)};var i=n(492574),a=n(694816),o=n(130312),s=r(n(914296)),l=n(446331),c=n(132826),u=n(118146),d=n(785893);function p(e,t,n){const{id:r}=e,u=e.isBlocked();if(t&&u||!t&&!u)return Promise.resolve();const f=(0,o.sendSetBlock)(t,r).then((e=>{e&&(t?c.BlocklistCollection.add({id:r}):c.BlocklistCollection.remove(r))}));return function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,l.genId)();const o={participant:e.formattedName},c=n?new l.ActionType(s.default.t(10,o)):new l.ActionType(s.default.t(125,o)),u=t.then((()=>{const t=n?s.default.t(9,o):s.default.t(124,o);return new l.ActionType(t,{actionText:s.default.t(126),actionHandler:()=>p(e,!n,r)})})).catch((t=>{if(!(t instanceof i.ServerStatusCodeError)){__LOG__(3)`action:setBlock dropped`;const t=n?s.default.t(8,o):s.default.t(123,o);throw new l.ActionType(t,{actionText:s.default.t(122),actionHandler:()=>p(e,n,r)})}if(t.statusCode>=400)throw n?new l.ActionType(s.default.t(8,o)):new l.ActionType(s.default.t(123,o))}));a.ToastManager.open((0,d.jsx)(l.ActionToast,{id:r,initialAction:c,pendingAction:u}))}(e,f,t,n),f}},125946:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.mungePSAContact=function(e){if(Array.isArray(e)){const t=e.findIndex((e=>e&&i.default.isPSA(e.id))),n=e[t];t>-1&&n&&(n.name=a.default.t(868),n.shortName=a.default.t(868))}};var i=r(n(389867)),a=r(n(914296))},670119:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(640265);class i extends((0,r.customError)("ContactBlocked")){constructor(e,t){super(e),this.contact=t}}t.default=i},988376:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactFindQuery=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(813042),s=n(125946),l=r(n(656891)),c=n(801255);function u(){return(u=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)()){const t=performance.now(),r={},i=yield l.default.contactFindQuery(e.retry,(e=>{r.binarySize=e.binarySize}));if("preempted"===i.data)return Promise.reject(new c.CollectionSilentQueryError("contacts preempted"));r.count=i.data.length,r.timing=Math.ceil(performance.now()-t);const a=n(719380).ContactCollection;return a.trigger(o.COLLECTION_HAS_SYNCED,r),(0,s.mungePSAContact)(i.data),i.checksum&&(a.setChecksum(i.checksum),__LOG__(2)`Store:Contact:query update checksum ${i.checksum}`),Promise.resolve(i.data)}return Promise.reject(new Error("This call is only supported in non-MD mode"))}))).apply(this,arguments)}},966464:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getOrQueryUsyncInfo=function(){return _.apply(this,arguments)},t.usyncContactCached=function(){return new a.default(u.queryPhoneExists,{maxCached:100,maxAge:36e4,shouldCache:e=>!!e})};var i=r(n(348926)),a=r(n(918569)),o=n(227101),s=r(n(131038)),l=n(438184),c=r(n(572639)),u=n(57547),d=n(669951),p=n(719380),f=n(991036);function _(){return(_=(0,i.default)((function*(e){const t=p.ContactCollection.get(e);var n,r;if(null!=t&&(null!=t.name||null!=d.ChatCollection.get(e)))return Promise.resolve({wid:e,biz:t.isBusiness,bizInfo:t.isBusiness?{verifiedName:{level:(0,s.default)(t.verifiedLevel),serial:null,name:t.verifiedName,isApi:Boolean(t.isEnterprise),privacyMode:t.privacyMode}}:null,disappearingMode:(0,o.isDisappearingModeEnabled)()?{duration:null!==(n=t.disappearingModeDuration)&&void 0!==n?n:0,settingTimestamp:null!==(r=t.disappearingModeSettingTimestamp)&&void 0!==r?r:0}:null});const i=yield(0,u.queryExists)(e);if(i){const{biz:n,bizInfo:r,disappearingMode:a}=i;return l.LegacyPhoneFeatures.supportsFeature(l.LegacyPhoneFeatures.F.QUERY_VNAME)&&n&&(0,c.default)(e,r),(0,o.isDisappearingModeEnabled)()&&a&&null!=t&&(0,f.updateDisappearingMode)(e,a.duration,a.settingTimestamp),i}return Promise.reject(new Error("Invalid number"))}))).apply(this,arguments)}},961552:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryIdentity=function(e){const t=(0,o.unproxy)(e),{verificationBinary:n,verificationString:r,id:l}=t;if(n&&r)return Promise.resolve();if(t.promises.queryIdentity)return t.promises.queryIdentity;if((0,i.isLegacyWebdBackend)())return void(t.promises.queryIdentity=a.default.queryIdentity(l).then((t=>{s(e,t)})).catch((e=>{__LOG__(3)`models:contact:queryIdentity error: ${String(e)}`})).finally((()=>{t.promises.queryIdentity=null})));return Promise.reject(new Error("This call is only supported in non-MD mode"))},t.updateIdentity=s;var i=n(88555),a=r(n(656891)),o=n(118146);function s(e,t){const n=(0,o.unproxy)(e);null!=t.status&&t.status>=400?(n.unset("verificationBinary"),n.unset("verificationString")):(n.verificationBinary=t.binary,n.verificationString=t.string)}},122367:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addLiveLocation=function(e,t){const n=(0,r.unproxy)(e);n.liveLocations||(n.liveLocations=[]);const{liveLocations:i}=n;i.push(t)},t.removeLiveLocation=function(e,t){const n=(0,r.unproxy)(e),{liveLocations:i}=n;if(!i)return;for(let e=i.length-1;e>=0;e--)if(i[e]===t){i.splice(e,1);break}0===i.length&&(n.liveLocations=null)};var r=n(118146)},585665:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCopyPhoneNumber=function(e,t,n){(0,i.default)(e),o.ToastManager.open((0,f.jsx)(c.Toast,{msg:p.fbt._("Copied to clipboard.",null,{hk:"3JjQpO"}),id:(0,c.genId)()})),new l.default.PsPhoneNumberHyperlink({phoneNumHyperlinkAction:l.default.PHONE_NUM_HYPERLINK_ACTION_TYPE.CLICK_COPY_PHONE_NUMBER,isPhoneNumHyperlinkOwner:n,phoneNumberStatusOnWa:Boolean(t)}).commit()},t.handleOpenChat=function(e,t,n){a.ModalManager.open((0,f.jsx)(d.OpenChatFlow,{chatId:t,onSuccess:e=>{_(e,n)},msgText:null}),{transition:"modal-flow"}),new l.default.PsPhoneNumberHyperlink({phoneNumHyperlinkAction:l.default.PHONE_NUM_HYPERLINK_ACTION_TYPE.CLICK_MESSAGE_ON_WHATSAPP,isPhoneNumHyperlinkOwner:(0,s.isMeAccount)(t),phoneNumberStatusOnWa:!0}).commit()},t.logClickOnPhoneNumber=function(e,t){new l.default.PsPhoneNumberHyperlink({phoneNumHyperlinkAction:l.default.PHONE_NUM_HYPERLINK_ACTION_TYPE.CLICK_PHONE_NUM_HYPERLINK,isPhoneNumHyperlinkOwner:t,phoneNumberStatusOnWa:Boolean(e)}).commit()},t.logCloseDialog=function(e,t){new l.default.PsPhoneNumberHyperlink({phoneNumHyperlinkAction:l.default.PHONE_NUM_HYPERLINK_ACTION_TYPE.CLOSE_DIALOG_BOX,isPhoneNumHyperlinkOwner:t,phoneNumberStatusOnWa:Boolean(e)}).commit()},t.logMessageSentByPhoneNumber=_;var i=r(n(688755)),a=n(914597),o=n(694816),s=n(978820),l=r(n(11339)),c=n(950452),u=n(188172),d=n(761585),p=n(548360),f=n(785893);function _(e,t){e&&u.ComposeBoxActions.addMsgSendingLogAttributes(e,{handleOnce(){new l.default.PsPhoneNumberHyperlink({phoneNumHyperlinkAction:l.default.PHONE_NUM_HYPERLINK_ACTION_TYPE.MESSAGE_SENT,isPhoneNumHyperlinkOwner:t,phoneNumberStatusOnWa:!0}).commit()}})}},300016:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProfilePic=function(e){return g((0,p.unproxy)(e))},t.setProfilePic=function(e,t,n){return h((0,p.unproxy)(e),t,n)};var i=n(450796),a=n(492574),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),s=n(694816),l=n(978820),c=n(78426),u=r(n(914296)),d=n(446331),p=n(118146),f=n(785893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function h(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,d.genId)();const{id:p}=e;if(!e.canSet())return Promise.reject(new o.ActionError);const _=(0,c.sendSetPicture)(p,t,n);e.pendingPic=t;const g=(0,l.getMaybeMeUser)(),m=p.equals(g)?new d.ActionType(u.default.t(110)):new d.ActionType(u.default.t(62)),y=_.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:setPicture dropped`,p.equals(g)?new d.ActionType(u.default.t(109)):new d.ActionType(u.default.t(61))})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(i=>{if(i.status>=400){const i=p.equals(g)?u.default.t(109):u.default.t(61);return new d.ActionType(i,{actionText:u.default.t(122),actionHandler:()=>h(e,t,n,r)})}}))).then((()=>p.equals(g)?new d.ActionType(u.default.t(108)):new d.ActionType(u.default.t(60))));return s.ToastManager.open((0,f.jsx)(d.ActionToast,{id:r,initialAction:m,pendingAction:y})),_.then((t=>{t._duplicate||e.set({tag:t.tag,eurl:t.eurl,token:t.token})})).finally((()=>{e.pendingPic=void 0}))}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,d.genId)();const{id:n}=e;if(!e.canDelete())return Promise.reject(new o.ActionError);const r=(0,c.requestDeletePicture)(n);e.pendingPic=e.fallbackType;const p=(0,l.getMaybeMeUser)(),_=n.equals(p)?new d.ActionType(u.default.t(107)):new d.ActionType(u.default.t(59)),h=r.catch((()=>{throw __LOG__(3)`models:ProfilePicThumb:deletePicture dropped`,n.equals(p)?new d.ActionType(u.default.t(105)):new d.ActionType(u.default.t(57))})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(r=>{if(r.status>=400){const r=n.equals(p)?u.default.t(105):u.default.t(57);return new d.ActionType(r,{actionText:u.default.t(122),actionHandler:()=>g(e,t)})}}))).then((()=>n.equals(p)?new d.ActionType(u.default.t(106)):new d.ActionType(u.default.t(58))));return s.ToastManager.open((0,f.jsx)(d.ActionToast,{id:t,initialAction:_,pendingAction:h})),r.then((t=>{t._duplicate||e.set({tag:void 0,eurl:void 0})})).finally((()=>{e.pendingPic=void 0}))}},832440:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resyncContacts=function(e){void 0!==l.ContactCollection.checksum&&void 0!==e&&(l.ContactCollection.checksum!==e?l.ContactCollection.findQuery({retry:!0}).then((e=>{if(Array.isArray(e)){(0,o.mungePSAContact)(e),__LOG__(2)`Store:Contact:resync success`;const t=(0,s.getContactsToRemove)(e);let n=Promise.resolve();if((0,a.isMDBackend)()&&t.length){const e=t.map((e=>e.id.toString()));n=(0,c.getContactTable)().bulkRemove(e).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from contact table failed`,SEND_LOGS("bulkRemove from contact table failed when resyncing contacts"),new Error("bulkRemove from contact table failed")}))}n.then((()=>{t.forEach((e=>{e.unset("name"),e.unset("shortName")}))}))}else __LOG__(3)`Store:Contact.resync error ${JSON.stringify(e)}`})).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{}))):__LOG__(2)`Store:Contact:resync checksum match`)};var r=n(450796),i=n(492574),a=n(88555),o=n(125946),s=n(188129),l=n(719380),c=n(776214)},577741:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSecurityCodeChangedNotifications=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(708154),o=n(88555),s=n(810635),l=n(365063),c=n(262240),u=n(555452),d=n(745454),p=r(n(729783)),f=n(776214);function _(){return(_=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,o.isLegacyWebdBackend)())return;const{notifications:n,chatIds:r}=yield h(e);if(0!==n.length){if(!t){Promise.all(n.map((e=>(e.recvFresh=!0,e.isNewMsg=!0,(0,a.frontendSendAndReceive)("processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})))));const e=yield(0,l.encryptMultipleDBMsgs)(n);return(0,c.storeEncryptedDBMessages)(e,r,!1)}p.default.addOfflineMessage(n.map((e=>({msg:e}))))}}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t={notifications:[],chatIds:[]};if(!(0,u.getGlobalSecurityNotifications)())return t;let n=[];try{const t=yield(0,f.getChatTable)().get(String(e));n=(yield(0,f.getParticipantTable)().equals(["participants"],String(e))).map((e=>(0,d.createWid)(e.groupId))),t&&n.push((0,d.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chats failed")}const r=n.map((t=>(0,s.genSecurityCodeNotificationMsg)(t,e)));return t.notifications=r,t.chatIds=n.map(String),t}))).apply(this,arguments)}},994059:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(){return _.apply(this,arguments)},t.setMyStatus=h;var i=r(n(348926)),a=n(551737),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),s=n(694816),l=n(978820),c=n(546898),u=r(n(914296)),d=n(446331),p=n(785893);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function _(){return(_=(0,i.default)((function*(e){const t=yield(0,c.getStatus)(e),r={id:e};if((0,a.isNumber)(t.status))switch(t.status){case 429:case 401:case 403:case 404:case 304:r.stale=!0;const t=n(46133).StatusCollection.get(e);t&&!(0,a.isString)(t.status)&&(r.status="");break;default:r.status=""}else{let i=t.status;if(t.stale){const t=n(46133).StatusCollection.get(e);t&&(i=t.status)}r.status=i}return r}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,d.genId)(),r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=e.trim();if(!i)return Promise.reject(new o.ActionError);const a=(0,c.setMyStatus)(i),f=new d.ActionType(u.default.t(121)),_=(0,l.getMaybeMeUser)(),g=n(46133).StatusCollection,m=g.assertGet(_).status,y=a.then((e=>{if(200===e.status){const e=r?void 0:{actionText:u.default.t(126),actionHandler:()=>h(m,t,!0)};return new d.ActionType(u.default.t(119),e)}if(e.status>=400)return new d.ActionType(u.default.t(120))})).catch((()=>{throw __LOG__(3)`models:statusCollection:setMyStatus dropped`,new d.ActionType(u.default.t(120),{actionText:u.default.t(122),actionHandler:()=>h(e,t)})}));s.ToastManager.open((0,p.jsx)(d.ActionToast,{id:t,initialAction:f,pendingAction:y}));const S=yield a;200!==S.status||S._duplicate||(g.assertGet(_).status=e)}))).apply(this,arguments)}},269666:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGenerateDeviceNotifications=function(){return g.apply(this,arguments)},t.createAndStoreDeviceNotifications=function(){return h.apply(this,arguments)},t.generateDeviceNotifications=f;var i=r(n(348926)),a=n(252230),o=n(257243),s=n(810635),l=n(555452),c=n(978820),u=n(745454),d=n(776214),p=n(390641);function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n){const r={notifications:[],chatIds:[]};if(!(0,l.getGlobalSecurityNotifications)())return r;if((0,o.getABPropConfigValue)("adv_v2_m6"))return r;if(!(t.length>0||n.length>0))return r;let i=[];if(e.equals((0,c.getMeUser)()))try{(yield(0,d.getChatTable)().all()).forEach((e=>{e.id!==a.STATUS_JID&&i.push((0,u.createWid)(e.id))}))}catch(e){throw __LOG__(4,!0,new Error,!0)`get all from chat table failed`,SEND_LOGS("get all from chat table failed when creating device notification"),new Error("get all from chat table failed")}else try{const t=yield(0,d.getChatTable)().get(String(e)),n=yield(0,d.getParticipantTable)().equals(["participants"],String(e));i=n.map((e=>(0,u.createWid)(e.groupId))),t&&i.push((0,u.createWid)(t.id))}catch(e){throw __LOG__(4,!0,new Error,!0)`get chats failed`,SEND_LOGS("get chats failed when creating device notification"),new Error("get chays failed")}const p=i.map((r=>(0,s.genDeviceNotificationMsg)(r,e,t,n)));return r.notifications=p,r.chatIds=i.map(String),r}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){const{notifications:r}=yield f(e,t,n);yield Promise.all(r.map((e=>(0,p.storeMessageInTransaction)([e]))))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){let t=[];const n=new Set;if((0,l.getGlobalSecurityNotifications)()){(yield Promise.all(e.map((e=>{let{wid:t,added:n,removed:r,isNewRecord:i}=e;return i?Promise.resolve(null):f(t,n,r)})))).forEach((e=>{e&&(t=t.concat(e.notifications),e.chatIds.forEach((e=>n.add(e))))}))}return t.length>0?{notifications:t,chatIds:Array.from(n)}:{notifications:[],chatIds:[]}}))).apply(this,arguments)}},468728:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceNotification=function(e){let{wid:t,devices:n,type:r}=e;if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));if(null==r)return Promise.reject(new Error("handleADVDeviceNotification: notification without type"));return function(){return g.apply(this,arguments)}(t,n,r)},t.handleADVDeviceSyncResult=function(e){if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));return function(){return m.apply(this,arguments)}(e)},t.handleADVDeviceUpdateForMessage=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=n(257243),o=n(931219),s=n(88555),l=n(138062),c=n(827398),u=n(797976),d=n(572841),p=r(n(876883)),f=n(209108),_=n(325397);function h(){return(h=(0,i.default)((function*(e,t,n,r,i){let l,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return(0,s.isLegacyWebdBackend)()?Promise.reject(new Error("This call is only supported in MD mode")):((0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(l=yield(0,o.getLastADVDeviceInfoCheckTime)()),(0,c.handleADVDeviceUpdateForMessage)(e,t,n,r,i,u,l))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t,r){let i=null;if("add"===r){const t=yield p.default.loadIdentityKey((0,d.createSignalAddress)(e).toString());i=t?(0,l.toCurveKeyPubKey)((0,d.strToBuffer)(t)):null}const s=yield(0,f.getDeviceRecord)(e);let c;(0,a.getABPropConfigValue)("adv_v2_m4_m5")&&(c=yield(0,o.getLastADVDeviceInfoCheckTime)());const _=(0,n(583604).handleDeviceNotification)(e,r,t,i,s,c);if(_)return _.clearRecord&&(yield(0,u.clearDeviceRecord)(e,(null==s?void 0:s.devices)||[])),(0,u.bulkApplyDeviceUpdate)([{wid:e,update:_.update,currentRecord:s}])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){__LOG__(2)`handleADVDeviceSyncResultImpl: start to handling ${e.length} updates`;const t=e.map((e=>e.wid)),r=e.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})),i=yield p.default.bulkLoadIdentityKey(r.map((e=>(0,d.createSignalAddress)(e.wid).toString()))),a=new Map;r.forEach(((e,t)=>{a.set((0,_.createDeviceListPK)(e.wid),i[t])}));const o=yield(0,f.bulkGetDeviceRecord)(t),s=[],c=[],h=n(583604).handleADVSyncResult;e.forEach(((e,t)=>{const n=a.get((0,_.createDeviceListPK)(e.wid)),r=n?(0,l.toCurveKeyPubKey)((0,d.strToBuffer)(n)):null,i=o[t],u=h(e.wid,e.devices,r,i);null!=u&&(u.clearRecord?(s.push({wid:e.wid,currentList:(null==i?void 0:i.devices)||[]}),c.push({wid:e.wid,currentRecord:{id:(0,_.createDeviceListPK)(e.wid),deleted:!0},update:u.update})):c.push({wid:e.wid,currentRecord:i,update:u.update}))})),yield Promise.all(s.map((e=>{let{wid:t,currentList:n}=e;return(0,u.clearDeviceRecord)(t,n)}))),yield(0,u.bulkApplyDeviceUpdate)(c)}))).apply(this,arguments)}},797976:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkApplyDeviceUpdate=function(){return E.apply(this,arguments)},t.clearDeviceRecord=function(){return S.apply(this,arguments)};var i=r(n(348926)),a=r(n(291966)),o=n(252230),s=n(708154),l=n(269666),c=n(365063),u=n(262240),d=n(965824),p=n(978820),f=n(745454),_=r(n(729783)),h=n(793932),g=n(209108),m=n(614748),y=n(325397);function S(){return(S=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];yield Promise.all(t.filter((e=>e.id!==o.DEFAULT_DEVICE_ID)).map((t=>C((0,f.createDeviceWidFromUserAndDevice)(e.user,e.server,t.id)))));const r=[],a=t.map((e=>e.id)).filter((e=>e!==o.DEFAULT_DEVICE_ID)),{encryptedNotifications:s,chatIds:l}=yield v([{wid:e,added:r,removed:a,isNewRecord:!1}],n);yield(0,m.getDeviceUpdateLock)((0,i.default)((function*(){const t=s.length>0?(0,u.storeEncryptedDBMessages)(s,l,!1):Promise.resolve(),n=(0,d.updateGroupParticipantsInTransaction)(e,r,a),i=(0,g.createOrReplaceDeviceRecord)({id:(0,y.createDeviceListPK)(e),deleted:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`remove from device list table failed`,SEND_LOGS("remove from device list table failed when clearing device record"),new Error("remove from device list table failed")}));yield Promise.all([t,n,i])})),s.length>0)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=[],r=[];let s=!1;e.forEach((e=>{let{wid:t,update:i,currentRecord:l}=e;const{devices:c}=i,u=c.map((e=>e.id)),d=l&&!l.deleted?l.devices.map((e=>e.id)):[],_=(0,a.default)(u,d).filter((e=>e!==o.DEFAULT_DEVICE_ID)),h=(0,a.default)(d,u).filter((e=>e!==o.DEFAULT_DEVICE_ID));n.push({wid:t,added:_,removed:h,isNewRecord:null==l}),h.forEach((e=>{r.push((0,f.createDeviceWidFromUserAndDevice)(t.user,t.server,e))})),(0,y.createDeviceListPK)(t)===(0,y.createDeviceListPK)((0,p.getMeUser)())&&h.length>0&&(s=!0)}));const{encryptedNotifications:l,chatIds:c}=yield v(n,t);Promise.all(r.map((e=>C(e)))),yield(0,m.getDeviceUpdateLock)((0,i.default)((function*(){const t=l.length>0?(0,u.storeEncryptedDBMessages)(l,c,!1):Promise.resolve(),r=(0,d.bulkUpdateGroupParticipantsInTransaction)(n),i=(0,g.bulkCreateOrReplaceDeviceRecord)(e.map((e=>e.update))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into device list table failed`,SEND_LOGS("bulkCreateOrReplace into device list table failed when applying device update"),new Error("bulkCreateOrReplace into device list table failed")})),a=s?i.then((()=>(0,h.updateMissingKeyDevices)().catch((e=>{__LOG__(3)`syncd: updateMissingKeyDevices failed with error:
${e}`})))):Promise.resolve();yield Promise.all([t,r,i,a])})),l.length>0,s)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){const{notifications:n,chatIds:r}=yield(0,l.bulkGenerateDeviceNotifications)(e);if(!t){const e=yield(0,c.encryptMultipleDBMsgs)(n);return b(n),{chatIds:r,encryptedNotifications:e}}return _.default.addOfflineMessage(n.map((e=>({msg:e})))),{chatIds:[],encryptedNotifications:[]}}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const{deleteDeviceSenderKey:t,deleteRemoteInfo:r}=n(71553);try{yield Promise.all([r(e),t(e)])}catch(t){__LOG__(2)`handleDevicesNotification: failed to clean the signal info for ${e.user}`}}))).apply(this,arguments)}function b(e){return Promise.all(e.map((e=>(e.recvFresh=!0,e.isNewMsg=!0,(0,s.frontendSendAndReceive)("processMultipleMessages",{chatId:e.from,msgObjs:[e],meta:{add:"after",isHistory:!1}})))))}},965824:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkUpdateGroupParticipantsInTransaction=function(){return _.apply(this,arguments)},t.updateGroupParticipantsInTransaction=function(){return f.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(408139),l=n(978820),c=n(745454),u=n(731958),d=r(n(11339)),p=n(776214);function f(){return(f=(0,a.default)((function*(e,t,n){const r=(yield(0,p.getParticipantTable)().equals(["participants"],String(e))).map((r=>{let a=r.rotateKey;const o=new Map(r.senderKey);return(0,s.rotateSenderKeyIfSentEnabled)()?(n.forEach((t=>{var n;const r=String((0,c.createDeviceWidFromUserAndDevice)(e.user,e.server,t));a=a||null!==(n=o.get(r))&&void 0!==n&&n,o.delete(r)})),a&&o.forEach(((e,t)=>o.set(t,!1)))):(n.forEach((t=>{o.delete(String((0,c.createDeviceWidFromUserAndDevice)(e.user,e.server,t)))})),n.length>0&&(a=!0)),t.forEach((t=>{o.set(String((0,c.createDeviceWidFromUserAndDevice)(e.user,e.server,t)),!1)})),h(e,a,r,t,n),(0,i.default)((0,i.default)({},r),{},{senderKey:o,rotateKey:a})}));return(0,p.getParticipantTable)().bulkCreateOrReplace(r)}))).apply(this,arguments)}function _(){return(_=(0,a.default)((function*(e){if(0===e.length)return;const t=yield(0,p.getParticipantTable)().anyOf(["participants"],e.map((e=>String(e.wid))));if(0===t.length)return;const n=new Map;e.forEach((e=>{n.set(String(e.wid),e)}));const r=t.map((e=>{let t=e.rotateKey;const r=new Map(e.senderKey);return e.participants.forEach((i=>{const a=n.get(i);if(!a)return;const{wid:o,added:l,removed:u}=a;(0,s.rotateSenderKeyIfSentEnabled)()?(u.forEach((e=>{var n;const i=String((0,c.createDeviceWidFromUserAndDevice)(a.wid.user,a.wid.server,e));t=t||null!==(n=r.get(i))&&void 0!==n&&n,r.delete(i)})),t&&r.forEach(((e,t)=>r.set(t,!1)))):(u.forEach((e=>{r.delete(String((0,c.createDeviceWidFromUserAndDevice)(a.wid.user,a.wid.server,e)))})),u.length>0&&(t=!0)),l.forEach((e=>{r.set(String((0,c.createDeviceWidFromUserAndDevice)(a.wid.user,a.wid.server,e)),!1)})),h(o,t,e,l,u)})),(0,i.default)((0,i.default)({},e),{},{senderKey:r,rotateKey:t})}));return(0,p.getParticipantTable)().bulkCreateOrReplace(r)}))).apply(this,arguments)}function h(e,t,n,r,i){if(t&&!n.rotateKey){var a;let t;t=i.includes(o.DEFAULT_DEVICE_ID)&&r.includes(o.DEFAULT_DEVICE_ID)?d.default.EXPIRY_REASON.IDENTITY_CHANGE:(null===(a=(0,l.getMaybeMeUser)())||void 0===a?void 0:a.equals(e))?d.default.EXPIRY_REASON.PEER_COMPANION_UNPAIR:d.default.EXPIRY_REASON.OTHER_DEVICE_UNPAIR,(0,u.postSenderKeyExpiredMetric)({chatId:n.groupId,deviceCount:n.senderKey.size,expiryReason:t})}}},429567:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeExpectedTsForDeviceRecord=function(e,t,n){const r=null==t?void 0:t.timestamp;if(null==r)return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};let i,o,s;null==t||t.deleted||(i=t.expectedTs,o=t.expectedTsLastDeviceJobTs,s=t.expectedTsUpdateTs);return a(e,r,n,i,o,s)},t.computeNewExpectedTs=a,t.shouldClearExpectedTs=function(e,t,n,i){if(!(0,r.getABPropConfigValue)("adv_v2_m4_m5"))return!1;if(null==n||n.deleted)return!1;if(null==n.expectedTs)return!1;if(e>=n.expectedTs)return!0;if(e<n.expectedTs&&t===n.expectedTs&&null!=i&&(null==n.expectedTsLastDeviceJobTs||i>n.expectedTsLastDeviceJobTs))return!0;return!1};var r=n(257243),i=n(40234);function a(e,t,n,a,o,s){if(!(0,r.getABPropConfigValue)("adv_v2_m4_m5"))return{expectedTs:void 0,expectedTsLastDeviceJobTs:void 0,expectedTsUpdateTs:void 0};const l={expectedTs:a,expectedTsLastDeviceJobTs:o,expectedTsUpdateTs:s};return t>=e||null!=a&&a>=e||(l.expectedTs=e,l.expectedTsLastDeviceJobTs=n,(null==a||t>=a)&&(l.expectedTsUpdateTs=i.Clock.localUnixTime())),l}},876867:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleICDCData=function(e,t,n){if((0,p.isLegacyWebdBackend)())return Promise.reject(new Error("handleICDCData: not supported for non md"));if(null==n||!(0,u.getABPropConfigValue)("adv_v2_m4_m5"))return Promise.resolve();return m.enqueue((()=>function(){return y.apply(this,arguments)}(e,t,n)))};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(608243),l=n(927870),c=n(892844),u=n(257243),d=n(931219),p=n(88555),f=n(429567),_=n(978820),h=n(583604),g=n(209108);const m=new l.PromiseQueue;function y(){return(y=(0,a.default)((function*(e,t,n){const{deviceListMetadata:r}=n;if(null==r)return void __LOG__(2,void 0,void 0,void 0,["handleICDCData"])`get empty device list metadata`;if((null==e.device||e.device===o.DEFAULT_DEVICE_ID)&&null!=r.senderTimestamp&&null==r.senderKeyHash){const t=(0,s.numberOrThrowIfTooLarge)(r.senderTimestamp)+1;return void(0,h.handleADVSyncResult)(e,{deviceList:[{id:o.DEFAULT_DEVICE_ID,keyIndex:0}],keyIndex:{ts:(0,c.castToUnixTime)(t),signedKeyIndexBytes:null}},null,null)}const a=[],l=e.user===(0,_.getMeUser)().user;a.push({id:e,ts:r.senderTimestamp}),l&&null!=t&&a.push({id:t,ts:r.recipientTimestamp});const u=yield(0,d.getLastADVDeviceInfoCheckTime)(),p=yield(0,g.bulkGetDeviceRecord)(a.map((e=>e.id))),m=[];return p.forEach(((e,t)=>{const n=a[t].ts;if(null==e||e.deleted||null==n)return;const r=(0,f.computeExpectedTsForDeviceRecord)((0,s.numberOrThrowIfTooLarge)(n),e,u);r.expectedTs===e.expectedTs&&r.expectedTsLastDeviceJobTs===e.expectedTsLastDeviceJobTs&&e.expectedTsUpdateTs==e.expectedTsUpdateTs||(__LOG__(2)`handleICDCData: update expectd timestamp for ${e.id}`,m.push((0,i.default)((0,i.default)({},e),r)))})),m.length>0?(0,g.bulkCreateOrReplaceDeviceRecord)(m):void 0}))).apply(this,arguments)}},463130:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleListReset=function(){return m.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=n(608243),s=n(892844),l=n(257243),c=n(138062),u=n(429567),d=n(797976),p=n(745454),f=n(572841),_=n(454753),h=n(325397),g=r(n(441143));function m(){return(m=(0,i.default)((function*(e,t,n,r,i){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0;const{rawId:S,timestamp:E,keyIndex:v}=t,T=(0,o.numberOrThrowIfTooLarge)(E),C=(0,l.getABPropConfigValue)("adv_v2_m4_m5"),A=e.device;(0,g.default)(null!=A&&A!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const b=(0,p.toUserWid)(e);let P=0;if(C&&(P=(null==i?void 0:i.timestamp)||(0,s.pastUnixTime)(((0,l.getABPropConfigValue)("num_days_key_index_list_expiration")-1)*s.DAY_SECONDS)),null!=i&&!i.deleted){if(i.timestamp>T)throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");yield(0,d.clearDeviceRecord)(b,i.devices,m)}n&&(yield(0,_.getSignalProtocolStore)().saveIdentity((0,f.createSignalAddress)(b).toString(),(0,c.toSignalCurvePubKey)(n)));const O={id:(0,h.createDeviceListPK)(e),rawId:S,timestamp:P,devices:[{id:A,keyIndex:v},{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],validIndexes:null,currentIndex:null,deleted:!1};if(C){const e=(0,u.computeExpectedTsForDeviceRecord)(T,O,y);O.expectedTs=e.expectedTs,O.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,O.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,d.bulkApplyDeviceUpdate)([{wid:b,update:O,currentRecord:null}],m),yield(0,_.getSignalProtocolStore)().saveIdentity((0,f.createSignalAddress)(e).toString(),(0,c.toSignalCurvePubKey)(r))}))).apply(this,arguments)}},503905:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleNoListReset=function(){return g.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(608243),l=n(257243),c=n(138062),u=n(429567),d=n(797976),p=n(745454),f=n(572841),_=n(454753),h=r(n(441143));function g(){return(g=(0,a.default)((function*(e,t,n,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5?arguments[5]:void 0;const{timestamp:m,keyIndex:y}=t,S=(0,s.numberOrThrowIfTooLarge)(m),E=e.device;if((0,h.default)(null!=E&&E!==o.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device"),r.timestamp>=S&&r.validIndexes&&!r.validIndexes.includes(y))throw new Error("handleADVDeviceIdentity: out-of-order timestamp detected");const v=new Map(r.devices.map((e=>[e.id,e.keyIndex])));if(!v.has(E)||v.get(E)!==y){v.set(E,y);const t=Array.from(v.entries()).map((e=>{let[t,n]=e;return{id:t,keyIndex:n}})),o=(0,i.default)((0,i.default)({},r),{},{devices:t,deleted:!1});if((0,l.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,u.computeExpectedTsForDeviceRecord)(S,o,g);o.expectedTs=e.expectedTs,o.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,o.expectedTsUpdateTs=e.expectedTsUpdateTs}yield(0,d.bulkApplyDeviceUpdate)([{wid:(0,p.toUserWid)(e),update:o,currentRecord:r}],a),yield(0,_.getSignalProtocolStore)().saveIdentity((0,f.createSignalAddress)(e).toString(),(0,c.toSignalCurvePubKey)(n))}}))).apply(this,arguments)}},827398:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVDeviceUpdateForMessage=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=n(463130),s=n(503905),l=n(745454),c=n(572841),u=n(209108),d=r(n(441143));function p(){return(p=(0,i.default)((function*(e,t,n,r,i){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const{rawId:_,timestamp:h,keyIndex:g}=t;(0,d.default)(null!=_,"handleADVDeviceIdentity: rawId of deviceIdentity should not be null"),(0,d.default)(null!=h,"handleADVDeviceIdentity: timestamp of deviceIdentity should not be null"),(0,d.default)(null!=g,"handleADVDeviceIdentity: keyIndex of deviceIdentity should not be null");const m={rawId:_,timestamp:h,keyIndex:g},y=e.device;(0,d.default)(null!=y&&y!==a.DEFAULT_DEVICE_ID,"handleADVDeviceIdentity: called for primary device");const S=(0,l.toUserWid)(e),E=yield(0,u.getDeviceRecord)(S),v=null==n||null!=r&&!(0,c.bufferEqual)(n,r);return!E||E.deleted||E.rawId!==_||v?(0,o.handleListReset)(e,m,v?r:null,i,E,p,f):(0,s.handleNoListReset)(e,m,i,E,p,f)}))).apply(this,arguments)}},330729:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decodeSignedKeyIndexBytes=function(e,t){let n,o;try{n=(0,a.decodeProtobuf)(i.ADVSignedKeyIndexListSpec,t)}catch(e){return null}if(!(0,r.verifyKeyIndexListAccountSignature)(n,e))return null;try{o=(0,a.decodeProtobuf)(i.ADVKeyIndexListSpec,n.details)}catch(e){return null}const{timestamp:s,rawId:l,validIndexes:c,currentIndex:u}=o;if(null==s)return null;if(null==l)return null;return{timestamp:s,rawId:l,validIndexes:c,currentIndex:u}};var r=n(946308),i=n(361438),a=n(484902)},578521:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleDeviceAddNotification=function(e,t,n,r,i,d,p){if(!d||d.deleted)return null;if(n<d.timestamp)return null;if(null==i)return null;const f=(0,l.decodeSignedKeyIndexBytes)(i,r);if(!f)return null;const _=f.rawId,h=(0,o.numberOrThrowIfTooLarge)(f.timestamp);if(h!==n)return null;let g=!1,m=null;const y=d.timestamp;d.rawId!==_?g=!0:m=d.devices;const S=new Set(f.validIndexes),E=f.currentIndex||0,v=null==m?[]:m.filter((e=>e.id!==a.DEFAULT_DEVICE_ID&&(S.has(e.keyIndex)||e.keyIndex>E)));t.forEach((e=>{const{id:t,keyIndex:n}=e;t!==a.DEFAULT_DEVICE_ID&&null!=n&&S.has(n)&&v.push({id:t,keyIndex:n})})),v.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0});const T={id:(0,u.createDeviceListPK)(e),rawId:_,timestamp:y,validIndexes:Array.from(S),devices:v,currentIndex:f.currentIndex,deleted:!1};if((0,s.getABPropConfigValue)("adv_v2_m4_m5")){const e=(0,c.computeExpectedTsForDeviceRecord)(h,T,p);T.expectedTs=e.expectedTs,T.expectedTsLastDeviceJobTs=e.expectedTsLastDeviceJobTs,T.expectedTsUpdateTs=e.expectedTsUpdateTs}return{update:T,clearRecord:g}},t.handleDeviceRemoveNotification=function(e,t,n){if(null==n||n.deleted)return null;if(t<n.timestamp)return null;const r=new Map(e.map((e=>[e.id,e.keyIndex]))),o=n.devices.filter((e=>{if(e.id!==a.DEFAULT_DEVICE_ID){const t=r.get(e.id);return null==t||t!==e.keyIndex}return!1}));return o.push({id:a.DEFAULT_DEVICE_ID,keyIndex:0}),{update:(0,i.default)((0,i.default)({},n),{},{devices:o}),clearRecord:!1}};var i=r(n(81109)),a=n(252230),o=n(608243),s=n(257243),l=n(330729),c=n(429567),u=n(325397)},515043:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleKeyIndexResult=function(e,t,n,l,c,u,d,p){if(null!=(null==u?void 0:u.timestamp)&&n<u.timestamp)return null;if(null==c)return null;const f=(0,a.decodeSignedKeyIndexBytes)(c,l);if(!f)return null;const _=f.rawId,h=(0,i.numberOrThrowIfTooLarge)(f.timestamp);if(h!==n)return null;let g=!1,m=null,y=t;u&&!u.deleted&&(null==y&&(y=u.devices),u.rawId!==_?g=!0:m=u.devices);const S=new Map,E=new Set(f.validIndexes),v=f.currentIndex||0;y&&y.forEach((e=>{null!=e.keyIndex&&E.has(e.keyIndex)&&S.set(e.id,e.keyIndex)}));null!=m&&m.forEach((e=>{e.keyIndex>v&&S.set(e.id,e.keyIndex)}));S.set(r.DEFAULT_DEVICE_ID,0);const T=Array.from(S.entries()).map((e=>{let[t,n]=e;return{id:t,keyIndex:n}})),C={id:(0,s.createDeviceListPK)(e),rawId:_,timestamp:h,validIndexes:Array.from(E),devices:T,currentIndex:f.currentIndex,deleted:!1};g||(0,o.shouldClearExpectedTs)(h,p,u,d)||u&&!u.deleted&&(C.expectedTs=u.expectedTs,C.expectedTsLastDeviceJobTs=u.expectedTsLastDeviceJobTs,C.expectedTsUpdateTs=u.expectedTsUpdateTs);return{update:C,clearRecord:g}};var r=n(252230),i=n(608243),a=n(330729),o=n(429567),s=n(325397)},669843:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleOmittedResult=function(e,t,n,r){if(!t||t.deleted)return null;if(null!=e&&e<t.timestamp)return null;const s=(0,i.default)({},t);null!=e&&(s.timestamp=e,(0,o.shouldClearExpectedTs)(e,n,t,r)&&(s.expectedTs=void 0,s.expectedTsLastDeviceJobTs=void 0,s.expectedTsUpdateTs=void 0));return s.devices=[{id:a.DEFAULT_DEVICE_ID,keyIndex:0}],{update:s,clearRecord:!1}};var i=r(n(81109)),a=n(252230),o=n(429567)},583604:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleADVSyncResult=function(e,t,n,r,a){const{deviceList:l,keyIndex:c}=t;if(null==c||null==c.signedKeyIndexBytes)return null!=l&&l.some((e=>e.id!==i.DEFAULT_DEVICE_ID))?void __LOG__(2)`processADVSyncResult: drop response with companion device but no keyIndexbytes`:(0,s.handleOmittedResult)(null==c?void 0:c.ts,r,null==c?void 0:c.expectedTs,a);const{ts:u,expectedTs:d,signedKeyIndexBytes:p}=c;return(0,o.handleKeyIndexResult)(e,l,u,p,n,r,a,d)},t.handleDeviceNotification=function(e,t,n,r,i,o){const{deviceList:s,keyIndex:c}=n;(0,l.default)(null!=s,`handleDeviceNotification: device list should not be none for device ${t} notification`),(0,l.default)(null!=c,`handleDeviceNotification: keyIndex should not be none for device ${t} notification`);const{ts:u,signedKeyIndexBytes:d}=c;if("add"===t)return(0,l.default)(null!=d,`handleDeviceNotification: signedKeyIndexBytes should not be none for device ${t} notification`),(0,a.handleDeviceAddNotification)(e,s,u,d,r,i,o);if("remove"===t)return(0,a.handleDeviceRemoveNotification)(s,c.ts,i)};var i=n(252230),a=n(578521),o=n(515043),s=n(669843),l=r(n(441143))},652402:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDeviceRecordForIdentityChange=m,t.handleNewIdentity=function(){return g.apply(this,arguments)},t.handleSelfPrimaryIdentityChange=function(){if((0,o.isLegacyWebdBackend)())return;__LOG__(4,void 0,new Error,!0)`handleNewIdentity: ignore identity change for your own primary device`,SEND_LOGS("self-identity-change");const e=n(765044).Socket,t=n(788950).LogoutReason;e.logout(!1,t.PrimaryIdentityKeyChange)};var i=r(n(348926)),a=n(252230),o=n(88555),s=n(269666),l=n(272441),c=n(289488),u=n(965824),d=n(745454),p=r(n(869153)),f=n(209108),_=n(799069),h=n(325397);function g(){return(g=(0,i.default)((function*(e){var t;if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));const r=self.libsignal.SignalProtocolAddress.fromString(e).getName(),i=(0,d.createWid)((0,l.toPhoneUserJid)(r)),u=null!==(t=i.device)&&void 0!==t?t:a.DEFAULT_DEVICE_ID,p=(0,d.toUserWid)(i);if(u===a.DEFAULT_DEVICE_ID){const{Voip:e}=yield Promise.resolve().then(n.bind(n,84356));e.notifyDeviceIdentityChangedOrDeleted(i,!0);const t=n(577741).addSecurityCodeChangedNotifications;yield m(p),yield t(p),(0,c.sendTcTokenWhenDeviceIdentityChange)(p)}else yield(0,s.createAndStoreDeviceNotifications)(p,[u],[u])}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("clearDeviceRecordForIdentityChange: This call is only supported in MD mode"));const r=[a.DEFAULT_DEVICE_ID],i=[a.DEFAULT_DEVICE_ID];if(t)p.default.addOfflinePendingDevice(String(e),null),yield(0,_.getStorage)().lock(["participant"],(()=>(0,u.updateGroupParticipantsInTransaction)(e,i,r)));else{const t=yield(0,f.getDeviceRecord)(e);t&&!t.deleted&&t.devices.forEach((e=>{e.id!==a.DEFAULT_DEVICE_ID&&r.push(e.id)}));const o=n(959060).Session;Promise.all(r.map((t=>t===a.DEFAULT_DEVICE_ID?Promise.resolve():o.deleteRemoteInfo((0,d.createDeviceWidFromUserAndDevice)(e.user,e.server,t))))),yield Promise.all([(0,_.getStorage)().lock(["participant"],(()=>(0,u.updateGroupParticipantsInTransaction)(e,i,r))),(0,f.createOrReplaceDeviceRecord)({id:(0,h.createDeviceListPK)(e),deleted:!0})])}}))).apply(this,arguments)}},833601:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;return v(e,t,n,r,void 0,i,a)},t.sendForNeededAddRequest=T;var i=r(n(81109)),a=n(450796),o=n(787614),s=n(492574),l=n(781572),c=n(211739),u=n(300016),d=n(694816),p=n(745454),f=n(79583),_=r(n(914296)),h=n(446331),g=n(188172),m=n(719380),y=n(582039),S=n(548360),E=n(785893);function v(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,h.genId)(),p=arguments.length>5?arguments[5]:void 0,m=arguments.length>6?arguments[6]:void 0;const C=r.map((e=>e.id)),A=void 0,b=(0,f.sendCreateGroup)(e,C,A,(0,o.randomHex)(8),!1,!1,p,m),P=new h.ActionType(_.default.t(50)),O=b.then((t=>(T(t,e,A),new h.ActionType(_.default.t(49))))).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>406===e.status?new h.ActionType(_.default.t(46)+" "+_.default.t(47)):429===e.status?new h.ActionType(_.default.t(46)+" "+S.fbt._("You've created too many groups too quickly. Try again later.",null,{hk:"2fN2Us"}).toString()):void 0))).catch((()=>(__LOG__(3)`models:chatCollection:createGroup dropped`,new h.ActionType(_.default.t(46),{actionText:_.default.t(122),actionHandler:()=>v(e,t,n,r,i,p)}))));return d.ToastManager.open((0,E.jsx)(h.ActionToast,{id:i,initialAction:P,pendingAction:O})),b.then((e=>{if(null==m&&e.gid&&(0,c.findChat)(e.gid).then((e=>{l.Cmd.openChatBottom(e).then((t=>{t&&g.ComposeBoxActions.focus(e)}))})),!e._duplicate&&t&&n){const r=y.ProfilePicThumbCollection.gadd(e.gid);return(0,u.setProfilePic)(r,t,n).then((()=>e.gid))}return e._duplicate&&__LOG__(3)`createGroup failed to set picture.`,e.gid})).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(()=>{})))}function T(e,t,n,r){if(!e.participants)return;const a=r||e.gid;a||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Group add request was provided with undefined gid"));const o=e.participants.reduce(((e,t)=>{const n=Object.keys(t)[0];if("403"!==t[n].code)return e;const r=(0,p.createWid)(n),a=m.ContactCollection.gadd(r,{silent:!0});return[...e,(0,i.default)((0,i.default)({},t[n]),{},{contact:a})]}),[]);o.length>0&&a&&l.Cmd.openGroupV4InviteRequestFlow(o,a,t,n)}},525510:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.localExitGroup=g,t.sendExitGroup=function(e){return h((0,p.unproxy)(e))};var i=n(450796),a=n(492574),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),s=n(694816),l=n(978820),c=n(990447),u=r(n(914296)),d=n(446331),p=n(118146),f=n(785893);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function h(e){const{isGroup:t,promises:n}=e;if(!t)return Promise.reject(new o.ActionError);if(n.sendExit)return n.sendExit;const r=n.sendExit=(0,c.sendExitGroup)(e.id),l=new d.ActionType(u.default.t(56)),p=r.then((function(){return new d.ActionType(u.default.t(55))})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(e=>{if(e.status>=400)return new d.ActionType(u.default.t(54))}))).catch((function(){return __LOG__(3)`actions:chat:sendExit dropped`,new d.ActionType(u.default.t(54),{actionText:u.default.t(122),actionHandler:()=>h(e)})}));return s.ToastManager.open((0,f.jsx)(d.ActionToast,{id:(0,d.genId)(),initialAction:l,pendingAction:p})),r.then((t=>{t._duplicate||g(e)})).finally((()=>{n.sendExit=null})).catch((0,i.filteredCatch)(a.ServerStatusCodeError,(()=>{})))}function g(e){var t;e.isGroup&&(null===(t=e.groupMetadata)||void 0===t||t.participants.remove((0,l.getMaybeMeUser)()),(0,c.markExited)(e.id).then((()=>{e.isReadOnly=!0})).catch((e=>{throw __LOG__(4,!0,new Error,!0)`failed to merge chat table`,SEND_LOGS("failed to merge chat table when exiting group: "+e),new Error("failed to merge chat table")})))}},56080:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateGroupMetadataModel=A,t.queryAndUpdateAllGroupMetadata=function(){return y.apply(this,arguments)},t.queryAndUpdateGroupMetadataById=function(){return S.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(40234),s=n(368082),l=n(395486),c=n(639133),u=n(677345),d=n(707122),p=n(769315),f=n(233776),_=n(810790),h=r(n(963928)),g=n(543201),m=n(68638);function y(){return(y=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((0,a.isLegacyWebdBackend)())return Promise.resolve();const t=yield(0,c.queryAllGroups)(),n=yield(0,g.injectPastParticipantsFromDB)(t);n&&(n.forEach((t=>{A(t),e&&T(t)})),yield(0,s.updateGroupMetadataTableJob)(n),yield(0,s.updateGroupParticipantTableWithoutDeviceSyncJob)(n),e&&(yield E(n)))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){if((0,a.isLegacyWebdBackend)())return Promise.resolve();const n=yield(0,l.queryGroupJob)(e,t),[r]=yield(0,g.injectPastParticipantsFromDB)([n]);yield(0,s.updateGroupParticipantTableWithoutDeviceSyncJob)([r]),A(r)}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){__LOG__(2,void 0,void 0,void 0,["GroupUpdateGroupEndOfHistorySyncFlag"])`Start updateGroupEndOfHistorySyncFlag`;const t=n(461957).ConversationEndOfHistoryTransferModelPropType,r=(0,f.getInitialGroupPhashMap)(),i=n(669951).ChatCollection,a=[];e.forEach((e=>{if(i.get(e.id.toString()))return;null==(null==r?void 0:r[e.id.toString()])&&a.push({unreadCount:0,muteExpiration:0,id:e.id,endOfHistoryTransferType:t.NOT_INCLUDED_IN_HIST_SYNC})})),i.add(a,{merge:!0}),yield(0,m.getTable)().bulkCreate(a.map((e=>{let{endOfHistoryTransferType:t,id:n}=e;return{endOfHistoryTransferType:t,id:n.toString(),unreadCount:0,muteExpiration:0}}))).catch((e=>{__LOG__(2,void 0,void 0,void 0,["GroupUpdateGroupEndOfHistorySyncFlag"])`One ore more chat create failed for group not synced in initial sync with error: ${e.message} `})),__LOG__(2,void 0,void 0,void 0,["GroupUpdateGroupEndOfHistorySyncFlag"])`Completed updateGroupEndOfHistorySyncFlag`}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){const t=(0,f.getInitialGroupPhash)(e.id.toString());if(null==t)return;const n=yield(0,p.phashV1)(e.participants.map((e=>e.id))),r=n.substring(2);null!=t&&t!==n&&t!==r&&(0,d.handleSingleMsgMD)(e.id,(0,u.genIntialPhashMismatchMsg)(e.id,o.Clock.globalUnixTime()))}))).apply(this,arguments)}function A(e){var t,n,r,i,a;(0,_.updateSubject)(e.id,e.subject),h.default.gadd({id:e.id,owner:e.owner,creation:e.creation,desc:e.desc,descId:e.descId,descOwner:e.descOwner,descTime:e.descTime,restrict:e.restrict||!1,announce:e.announce||!1,noFrequentlyForwarded:e.noFrequentlyForwarded||!1,ephemeralDuration:e.ephemeralDuration||0,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,participants:e.participants,pastParticipants:e.pastParticipants,support:null!==(t=e.support)&&void 0!==t&&t,suspended:null!==(n=e.suspended)&&void 0!==n&&n,terminated:null!==(r=e.terminated)&&void 0!==r&&r,isParentGroup:null!==(i=e.isParentGroup)&&void 0!==i&&i,parentGroup:e.parentGroup,defaultSubgroup:null!==(a=e.defaultSubgroup)&&void 0!==a&&a,deviceStale:!0,size:e.size})}},93949:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.maybeQueryGroupDevice=function(){return h.apply(this,arguments)},t.queryGroupFromPhone=function(){return f.apply(this,arguments)},t.queryGroupInviteInfo=function(){return _.apply(this,arguments)};var i=r(n(506479)),a=r(n(348926)),o=r(n(781629)),s=n(88555),l=n(550111),c=n(810790),u=n(719380),d=r(n(614423));const p=["status","subject","parentGroupSubject"];function f(){return(f=(0,a.default)((function*(e){const t=yield(0,c.groupMetadataFindFromPhone)(e);return"ok"===t.status?t.data:"missing"!==t.status?"error"===t.status?(__LOG__(3)`model:GroupMetadata:find error ${t.info}`,Promise.reject(new Error("model:GroupMetadata:find error"))):void 0:void(0,o.default)((()=>{n(669951).ChatCollection.assertGet(e).delete()}))}))).apply(this,arguments)}function _(){return(_=(0,a.default)((function*(e){const t=yield(0,c.sendQueryGroupInvite)(e),{status:r,subject:a,parentGroupSubject:o}=t,s=(0,i.default)(t,p),l=new d.default(s);u.ContactCollection.gadd(l.id);const f=n(669951).ChatCollection.get(l.id);return{status:r,subject:a,groupMetadata:l,inGroup:!!f&&!f.isReadOnly,parentGroupSubject:o}}))).apply(this,arguments)}function h(){return(h=(0,a.default)((function*(e){if((0,s.isLegacyWebdBackend)())return Promise.resolve();if(e.deviceStale){if(e.deviceQueryPromise)return __LOG__(2)`maybeQueryGroupDevice: ${e.id} - skip duplicate query`,e.deviceQueryPromise;__LOG__(2)`maybeQueryGroupDevice: ${e.id} - start query device`,e.deviceQueryPromise=(0,l.syncDeviceListJob)(e.participants.map((e=>e.id)));try{yield e.deviceQueryPromise,e.deviceStale=!1,__LOG__(2)`maybeQueryGroupDevice: ${e.id} - complete query device`}finally{e.deviceQueryPromise=null}}}))).apply(this,arguments)}},114949:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateModelForGroupAction=function(e,t){var n;const{chatId:r}=e,_=d.ChatCollection.get(r);if(!_)return Promise.resolve();const h=(0,i.default)(_.groupMetadata,"chat.groupMetadata"),{author:g,ts:m}=e;switch(t.actionType){case o.GROUP_ACTIONS.SUBJECT:const r={name:t.subject};_.contact.set(r);break;case o.GROUP_ACTIONS.LINKED_GROUP_PROMOTE:case o.GROUP_ACTIONS.LINKED_GROUP_DEMOTE:const i=t.participants.map((e=>({id:e,isAdmin:"linked_group_promote"===t.actionType})));if(t.jid){p.default.assertGet(t.jid).participants.add(i,{merge:!0})}break;case o.GROUP_ACTIONS.ADD:case o.GROUP_ACTIONS.PROMOTE:case o.GROUP_ACTIONS.DEMOTE:const S=t.participants.map((e=>({id:e,isAdmin:"promote"===t.actionType})));if(h.participants.add(S,{merge:!0}),"add"===t.actionType&&((0,c.pastParticipantsDbEnabled)()&&t.participants.forEach((e=>{h.pastParticipants.remove(e),(0,u.isMeAccount)(e)&&h.pastParticipants.reset()})),t.participants.forEach((e=>{p.default.trigger(`group_participant_change_${e.toString()}`,_.id)}))),(0,l.communityAdminPromotionOneTimePromptEnabled)()&&h.groupType===f.GroupType.COMMUNITY){const e=(0,u.getMaybeMeUser)();e&&t.participants.find((t=>t.equals(e)))&&(t.actionType!==o.GROUP_ACTIONS.PROMOTE&&t.actionType!==o.GROUP_ACTIONS.DEMOTE||h.set({acknowledgedCadminPromotion:!1}))}break;case o.GROUP_ACTIONS.REMOVE:t.participants.forEach((t=>{h.participants.remove(t),(0,c.pastParticipantsDbEnabled)()&&h.pastParticipants.add({id:t,leaveTs:m,leaveReason:t.equals(e.author)?s.LeaveReason.Left:s.LeaveReason.Removed})})),t.participants.forEach((e=>{p.default.trigger(`group_participant_change_${e.toString()}`,_.id)}));break;case o.GROUP_ACTIONS.MODIFY:if(g&&t.participants&&t.participants.length>0){const e=t.participants[0],n=h.participants.remove(g);let r=!1,i=!1;n.length&&n[0]&&(r=n[0].isAdmin,i=n[0].isSuperAdmin);const a={id:e,isAdmin:r,isSuperAdmin:i};h.participants.add(a)}break;case o.GROUP_ACTIONS.INVITE_CODE:t.code?h.inviteCode=t.code:__LOG__(3)`model:chat:handleGroupAction:invalid invite code: ${t.code} for ${_.id.toString()}`;break;case o.GROUP_ACTIONS.DESC_ADD:h.set({desc:t.desc,descId:t.descId,descTime:t.descTime,descOwner:null==g?void 0:g.toString()});break;case o.GROUP_ACTIONS.DESC_REMOVE:if(h.descId===t.descId){h.set({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0});break}break;case o.GROUP_ACTIONS.RESTRICT:h.restrict=!!t.value;break;case o.GROUP_ACTIONS.SUSPEND:h.suspended=!!t.value;break;case o.GROUP_ACTIONS.ANNOUNCE:h.announce=!!t.value;break;case o.GROUP_ACTIONS.NO_FORWARD:h.noFrequentlyForwarded=!!t.value;break;case o.GROUP_ACTIONS.EPHEMERAL:h.ephemeralDuration=t.duration;break;case o.GROUP_ACTIONS.REVOKE_INVITE:break;case o.GROUP_ACTIONS.DELETE:if(h.terminated=!0,t.reason===o.DELETE_REASON.INTEGRITY_DELETE_PARENT){h.suspended=!0;const e=h.parentGroup;if(e){var y;const t=d.ChatCollection.get(e);null==t||null===(y=t.groupMetadata)||void 0===y||y.set({terminated:!0,suspended:!0})}}break;case o.GROUP_ACTIONS.GROWTH_UNLOCKED:h.growthLockExpiration=void 0,h.growthLockType=void 0;break;case o.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===t.type&&(h.growthLockExpiration=t.expiration,h.growthLockType=t.type);break;case o.GROUP_ACTIONS.PARENT_GROUP_LINK:h.parentGroup=t.groupDatas[0].id;break;case o.GROUP_ACTIONS.SUB_GROUP_LINK:(0,a.updateModelsForSubgroupLink)(_.id,t.groupDatas);break;case o.GROUP_ACTIONS.SIBLING_GROUP_LINK:h.parentGroup&&(0,a.updateModelsForSubgroupLink)(h.parentGroup,t.groupDatas);break;case o.GROUP_ACTIONS.PARENT_GROUP_UNLINK:h.parentGroup=void 0;break;case o.GROUP_ACTIONS.SUB_GROUP_UNLINK:(0,a.updateModelsForSubgroupUnlink)(_.id,t.groupDatas);break;case o.GROUP_ACTIONS.SIBLING_GROUP_UNLINK:h.parentGroup&&(0,a.updateModelsForSubgroupUnlink)(h.parentGroup,t.groupDatas);break;case o.GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK:h.parentGroup=void 0;const E=t.groupDatas[0].id,v=d.ChatCollection.get(E);null==v||null===(n=v.groupMetadata)||void 0===n||n.set({terminated:!0,suspended:!0});break;case o.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE:case o.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupAction`}return Promise.resolve()};var i=r(n(145095)),a=n(153492),o=n(795720),s=n(681398),l=n(408139),c=n(879662),u=n(978820),d=n(669951),p=r(n(963928)),f=n(455981)},421414:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupCreation=function(e,t,n){if((0,a.isLegacyWebdBackend)())return Promise.reject(new Error("handleGroupCreation: should not be called in wap mode"));return function(){return m.apply(this,arguments)}(e,t,n)};var i=r(n(348926)),a=n(88555),o=n(368082),s=n(487944),l=n(408139),c=n(467019),u=n(978820),d=n(506736),p=n(991829),f=n(909025),_=n(810790),h=r(n(11339)),g=n(719380);function m(){return(m=(0,i.default)((function*(e,t){var n,r,i;let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];__LOG__(2,void 0,void 0,void 0,["groups"])`inside handleGroupCreationMD`;const{chatId:m,author:y,pushname:S}=e,{id:E,participants:v,pvId:T,subject:C,creation:A}=t;null!=e.author&&e.author.equals((0,u.getMaybeMeUser)())||new h.default.GroupJoinC({}).commit(),y&&S&&(0,d.updatePushname)(y,S,a),yield Promise.all([(0,s.updateParticipantsJob)(E,v,T,a),(0,o.updateGroupMetadataTableJob)([t])]),__LOG__(2,void 0,void 0,void 0,["groups"])`updated GroupMetadata and participants tables`;let b=yield(0,f.getExisting)(m);var P;if(b)(0,_.updateSubject)(m,C),null===(P=b.groupMetadata)||void 0===P||P.set(t);else if(b=yield(0,p.create)(m,{t:A,pendingInitialLoading:!1,createdLocally:!1},{createdOffline:a}),!a){var O;null===(O=b.groupMetadata)||void 0===O||O.set(t),__LOG__(2,void 0,void 0,void 0,["groups"])`updated chat model and table`;g.ContactCollection.gadd(E).set({name:C}),__LOG__(2,void 0,void 0,void 0,["groups"])`updated contact name`}const M=(null!==(n=null===(r=b.groupMetadata)||void 0===r?void 0:r.participants)&&void 0!==n?n:[]).length,I=null===(i=b.groupMetadata)||void 0===i?void 0:i.announce;!a&&!I&&M&&(0,l.sendKeyDistributionMsgToNewGroups)()&&M>=(0,l.sendKeyDistributionMsgMinGroupSize)()&&(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message`,(0,c.sendKeyDistributionMsg)(b).then((()=>{__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message: done`})).catch((e=>{__LOG__(3,void 0,void 0,void 0,["groups"])`handleGroupCreationMD sending key distribution message failed: ${e}`})))}))).apply(this,arguments)}},190013:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(e,t,n,r){return(0,s.sendJoinGroupViaInviteV4)(e,t,n,r)},t.queryGroupInviteV4Info=function(){return u.apply(this,arguments)},t.revokeGroupInviteV4=function(e,t){return(0,s.sendRevokeGroupInviteV4)(e,t)};var i=r(n(348926)),a=n(769315),o=n(745454),s=n(364808),l=n(669951),c=n(719380);function u(){return(u=(0,i.default)((function*(e,t,r,i){let u=null;const d=n(963928).default.get(r);return d&&(u=yield(0,a.phashV1)(d.participants.map((e=>e.id)))),(0,s.sendQueryGroupInviteV4)(e,t,r,i,u).then((e=>{if(null!=e.status&&e.status>0)return e;if(null!=e.id)return c.ContactCollection.gadd(e.id),e;const t=n(963928).default.assertGet((0,o.createWidFromWidLike)(r)),i=l.ChatCollection.assertGet(t.id).contact.name;return{id:t.id,owner:t.owner,creation:t.creation,desc:t.desc,descId:t.descId,descOwner:t.descOwner,descTime:t.descTime,restrict:t.restrict,announce:t.announce,ephemeralDuration:t.ephemeralDuration,membershipApprovalMode:t.membershipApprovalMode,growthLockExpiration:t.growthLockExpiration,growthLockType:t.growthLockType,noFrequentlyForwarded:t.noFrequentlyForwarded,subject:i,participants:t.participants.map((e=>({id:e.id,isAdmin:e.isAdmin,isSuperAdmin:e.isSuperAdmin})))}}))}))).apply(this,arguments)}},624206:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(0,r.getMaybeMeUser)().equals(e.id)){const n=i.PresenceCollection.get(e.id);n&&("unsubscribe"===e.type?n.set({isSubscribed:!1,stale:!0}):(a(n,e),t&&n.set({stale:!1})))}return Promise.resolve()};var r=n(978820),i=n(868315);function a(e,t){let n,r=!1;if(void 0===t.type?t.type=e.chatstate.type||"unavailable":"paused"===t.type&&(r=!0,t.type="available"),e.isGroup&&"available"!==t.type&&(t.updateTime=Date.now()),e.isGroup){if(!t.participant)return;t.id=t.participant,t.participant=void 0,n=e.chatstates.gadd(t.id)}else n=e.chatstate;r&&"composing"!==n.type&&"recording"!==n.type||n.set(t),n.expireTimerId&&clearTimeout(n.expireTimerId),"composing"===n.type||"recording"===n.type?n.expireTimerId=setTimeout((()=>function(e){const t=e.type;"composing"!==t&&"recording"!==t||(e.type="available")}(n)),25e3):n.expireTimerId=void 0;const i=e.forceDisplay||e.isOnline||e.isUser&&!e.chatstate.deny;e.set({hasData:!0,isSubscribed:!0,forceDisplay:i})}},373232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.changeProfilePicThumb=function(e,t){return r.ProfilePicThumbCollection.imageChanged(e,t),Promise.resolve()};var r=n(582039)},276816:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){return s||(s=(0,a.queryServerProps)().then((e=>{o.ServerProps.updateProps(e),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps Start ---`,Object.keys(o.ServerProps.attributes).forEach((e=>{__LOG__(2,void 0,void 0,void 0,["serverprops"])`key: ${e}, value: ${o.ServerProps.attributes[e]}, type: ${typeof o.ServerProps.attributes[e]}`})),__LOG__(2,void 0,void 0,void 0,["serverprops"])`--- Print ServerProps End ---`})).catch((0,r.filteredCatch)(i.ServerStatusCodeError,(()=>{}))).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{}))).finally((()=>{s=null})),s)};var r=n(450796),i=n(492574),a=n(804121),o=n(964551);let s},272720:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphanAck=function(){return g.apply(this,arguments)},t.updateMsgAck=_;var i=r(n(348926)),a=n(535470),o=n(708154),s=n(88555),l=n(264687),c=r(n(303441)),u=r(n(389867)),d=n(745454),p=n(925680),f=n(559871);function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n){const{ack:r,t:i,from:p,to:f}=n,{remote:_,id:h}=e.id;if(e.updateAck(r,i),(0,s.isMDBackend)()){const{deliveryPrivacyMode:t}=n;r===a.ACK.RECEIVED&&null!=t&&e.isSentByMe&&(yield(0,l.handlePrivacyModeTransition)(_,t).catch((()=>{__LOG__(4,void 0,new Error,!0)`msg ack: handlePrivacyModeTransition failed`,SEND_LOGS("msg ack: handlePrivacyModeTransition failed")})),yield(0,c.default)(e,t))}if(yield(0,o.frontendSendAndReceive)("updateLastReceipt",{wid:_,t:i}),u.default.isUser(_)){if(yield(0,o.frontendSendAndReceive)("updateMsgInfo",{id:h,from:p,to:f,ack:r,participant:_,t:i}),t&&u.default.isBroadcast(t)){const e=t instanceof u.default?t:(0,d.createWid)(t);yield(0,o.frontendSendAndReceive)("updateMsgInfo",{id:h,from:p,to:e,ack:r,participant:_,t:i})}}else u.default.isStatusV3(_)&&(yield(0,o.frontendSendAndReceive)("updateMsgInfo",{id:h,from:p,to:_,ack:r,participant:f,t:i}))}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const n=f.MsgCollection.get(e);if(!n)return Promise.reject(new Error(`processOrphanAck: no msg found for id ${e.toString()}`));try{const e=yield(0,p.getHighestAck)(n);if(!e||e.ack===n.ack)return;return _(n,t,e)}catch(e){__LOG__(4,void 0,new Error)`Assertion failed: processOrphanAck failed!`}}))).apply(this,arguments)}},272729:(e,t,n)=>{"use strict";var r=n(595318);t.v7=function(){return T.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=n(645563),s=n(892844),l=n(824214),c=n(536051),u=n(96759),d=n(115461),p=n(978820),f=r(n(389867)),_=n(49714),h=n(529805),g=n(124808),m=n(290981),y=n(484902);function S(e){let t;const n=e.id.remote,r={externalId:e.id.id,ts:(0,s.castToUnixTime)(e.t),edit:-1,isHsm:!1,count:null,chat:n,pushname:null};var i;f.default.isGroup(n)?t=(0,a.default)((0,a.default)({},r),{},{type:_.MESSAGE_TYPE.GROUP,author:null!==(i=e.author)&&void 0!==i?i:(0,p.getMeUser)(),isDirect:!1}):t=(0,a.default)((0,a.default)({},r),{},{author:e.from,type:_.MESSAGE_TYPE.CHAT});return{msgInfo:t,e2eInfoType:l.CiphertextType.Msg,paymentInfo:null,bizInfo:{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null}}}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){try{var t,r;const i=(0,c.messageFromDbRow)(e);if(!(0,h.isKeepInChatReadEnabled)())return null;const{msgInfo:a,e2eInfoType:s,paymentInfo:l,bizInfo:p}=S(i);if(null==i.futureproofBuffer)return null;const f=(0,o.unpadPkcs7)(new Uint8Array(i.futureproofBuffer)),_=(0,y.decodeProtobuf)(g.MessageSpec,f);if(null==(null===(t=_.keepInChatMessage)||void 0===t?void 0:t.keepType)||null==(null===(r=_.keepInChatMessage)||void 0===r?void 0:r.key))return __LOG__(3)`reparseKeepInChatFutureProof: KeepInChat failed validation due to missing keepType or key in proto`,null;const m=n(1201).parseMessage,E=yield m(a,s,_,l,p,i.futureproofBuffer);return null==E.renderableMsgs||null==E.renderableMsgs[0]||E.renderableMsgs[0].type!==d.MSG_TYPE.KEEP_IN_CHAT?(__LOG__(4,void 0,new Error)`reparseKeepInChatFutureProof: unexpected renderableMsgs`,null):(yield(0,u.processKeepInChatMsg)(E.renderableMsgs[0]),i)}catch(e){return __LOG__(4,void 0,new Error)`reparseKeepInChatFutureProof: reparse error`,null}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){try{const t=e.filter((e=>e.type===d.MSG_TYPE.UNKNOWN&&e.subtype===d.MSG_TYPE.KEEP_IN_CHAT)),n=(yield Promise.all(t.map((e=>E(e))))).filter(Boolean);if(0===n.length)return;const r=n.map((e=>e.id.toString()));yield(0,m.getTable)().bulkRemove(r)}catch(e){__LOG__(4,void 0,new Error)`reparseKeepInChatFutureProof: processKeepInChatAndDeleteFP error`}}))).apply(this,arguments)}},701283:(e,t,n)=>{"use strict";var r=n(595318);t.o0=function(){return A.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=n(645563),s=n(892844),l=n(824214),c=n(536051),u=n(408139),d=n(115461),p=n(837398),f=n(14571),_=n(978820),h=r(n(389867)),g=n(49714),m=n(124808),y=n(799069),S=n(484902),E=n(900267);function v(e){let t;const n=e.id.remote,r={externalId:e.id.id,ts:(0,s.castToUnixTime)(e.t),edit:-1,isHsm:!1,count:null,chat:n,pushname:null};var i;h.default.isGroup(n)?t=(0,a.default)((0,a.default)({},r),{},{type:g.MESSAGE_TYPE.GROUP,author:null!==(i=e.author)&&void 0!==i?i:(0,_.getMeUser)(),isDirect:!1}):t=(0,a.default)((0,a.default)({},r),{},{author:e.from,type:g.MESSAGE_TYPE.CHAT});return{msgInfo:t,e2eInfoType:l.CiphertextType.Msg,paymentInfo:null,bizInfo:{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null}}}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){try{const t=(0,c.messageFromDbRow)(e),r=t.id.remote;if(!(0,u.receiveReactionsEnabled)())return null;if(!h.default.isGroup(r)&&!h.default.isUser(r))return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: Reaction FutureProof msg.chat is an unexpected type`,null;const{msgInfo:i,e2eInfoType:a,paymentInfo:s,bizInfo:l}=v(t);if(null==t.futureproofBuffer)return null;const p=(0,o.unpadPkcs7)(new Uint8Array(t.futureproofBuffer)),f=(0,S.decodeProtobuf)(m.MessageSpec,p);if(null==f.reactionMessage)return __LOG__(3)`reparseReactionFutureProof: Reaction failed validation due to missing ReactionMessage in proto`,null;const _=n(1201).parseMessage,g=yield _(i,a,f,s,l,t.futureproofBuffer);if(null==g.renderableMsgs||null==g.renderableMsgs[0]||g.renderableMsgs[0].type!==d.MSG_TYPE.REACTION)return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: unexpected renderableMsgs`,null;const y=n(867811).createReactionsRow;return yield y(g.renderableMsgs[0],i)}catch(e){return __LOG__(4,void 0,new Error)`reparseReactionFutureProof: reparse error`,null}}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){try{let t=[];const r=e.filter((e=>e.type===d.MSG_TYPE.UNKNOWN&&e.subtype===d.MSG_TYPE.REACTION)),a=(yield Promise.all(r.map((e=>T(e))))).filter(Boolean);if(0===a.length)return;const o=a.map((e=>e.msgKey));let s;(0,u.showReactionChatListPreview)()?yield(0,y.getStorage)().lock(["message","reactions","chat"],function(){var e=(0,i.default)((function*(e){let[n,r,i]=e;t=yield(0,p.addOrUpdateReactionsDBBulk)(a),yield n.bulkRemove(o),(0,u.showReactionChatListPreview)()&&(s=yield(0,E.filterChatsWithReactionPreviewUpdates)(t),s.size>0&&(yield(0,f.updateDatabaseForLastReactionPreview)(s)))}));return function(){return e.apply(this,arguments)}}()):yield(0,y.getStorage)().lock(["message","reactions"],function(){var e=(0,i.default)((function*(e){let[n,r]=e;t=yield(0,p.addOrUpdateReactionsDBBulk)(a),yield n.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()),s&&s.size>0&&(0,u.showReactionChatListPreview)()&&(0,f.updateModelsForLastReactionPreview)(s),t.forEach((e=>{(0,p.addOrUpdateReactionsModelCollection)(e,!1)})),o.forEach((e=>{const t=n(559871).MsgCollection.get(e);null==t||t.delete()}))}catch(e){__LOG__(4,void 0,new Error)`reparseReactionFutureProof: storeReactionsAndDeleteFP error`}}))).apply(this,arguments)}},264687:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePrivacyModeTransition=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=r(n(163619)),o=n(393170),s=n(468708);function l(){return(l=(0,i.default)((function*(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e.isUserNotPSA())return;let l=r;if(null==l){const t=n(909025).getExisting;l=yield t(e)}if(null==l)return;const c=l.contact;if(null!=c.privacyMode&&c.privacyMode.privacyModeTs>=t.privacyModeTs)return;const u={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===o.VERIFIED_LEVEL.HIGH,isBusiness:c.isBusiness,isEnterprise:c.isEnterprise,privacyMode:c.privacyMode},d={verifiedName:c.verifiedName,isVerifiedHigh:c.verifiedLevel===o.VERIFIED_LEVEL.HIGH,isBusiness:!0,isEnterprise:!0,privacyMode:t};c.set({isBusiness:!0,isEnterprise:!0,privacyMode:t}),yield Promise.all([i?null:(0,s.createOrUpdateVerifiedBusinessName)({id:c.id.user,isApi:!0,privacyMode:{actualActors:t.actualActors,hostStorage:t.hostStorage,privacyModeTs:t.privacyModeTs}},s.VerifiedBusinessNameUpdateType.Merge),(0,a.default)(c.id,u,d)])}))).apply(this,arguments)}},96759:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.keepMessage=function(e){return D(e,S.KeepType.KEEP_FOR_ALL)},t.keepMessageLocal=w,t.processKeepInChatMsg=function(){return x.apply(this,arguments)},t.undoKeepMessage=function(){return G.apply(this,arguments)},t.undoKeepMessageLocal=N;var i=r(n(81109)),a=r(n(348926)),o=n(524674),s=r(n(145095)),l=n(40234),c=n(781572),u=n(237540),d=r(n(465212)),p=n(115461),f=n(879274),_=n(745042),h=(n(20551),n(978820)),g=n(745454),m=n(932107),y=n(197563),S=n(124808),E=n(70500),v=r(n(11339)),T=n(485807),C=n(137700),A=n(669951),b=n(17304),P=n(559871),O=n(584886),M=n(837626),I=n(529805);function w(){return R.apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e,t,n){const r={kicState:M.KeepInChatState.KEPT,kicTimestamp:n};yield(0,y.updateLocal)(e.id,(0,i.default)((0,i.default)({},r),{},{kicKey:t.toString()})),e.set((0,i.default)((0,i.default)({},r),{},{kicKey:t}))}))).apply(this,arguments)}function N(){return L.apply(this,arguments)}function L(){return(L=(0,a.default)((function*(e,t,n){const r={kicState:M.KeepInChatState.UNKEPT,kicTimestamp:n};yield(0,y.updateLocal)(e.id,(0,i.default)((0,i.default)({},r),{},{kicKey:t.toString()})),e.set((0,i.default)((0,i.default)({},r),{},{kicKey:t}))}))).apply(this,arguments)}function D(){return k.apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e,t){var n,r,i;const s=(0,h.assertGetMeUser)(),c=new d.default({fromMe:!0,remote:e.chat.id,id:d.default.newId(),participant:e.chat.isGroup?s:void 0});switch(t){case S.KeepType.KEEP_FOR_ALL:w(e,c,l.Clock.globalUnixTime());const a=new v.default.DisappearingMessageKeepInChat({kicActionName:v.default.KIC_ACTION_NAME_TYPE.KEEP_MESSAGE,isAGroup:e.isGroupMsg,messagesSelected:1,mediaType:e.getWamMediaType(),chatEphemeralityDuration:null!==(n=e.chat.getEphemeralSetting())&&void 0!==n?n:0,kicActor:e.isSentByMe?v.default.KIC_ACTOR_TYPE.SENDER:v.default.KIC_ACTOR_TYPE.RECIPIENT,threadId:yield(0,m.getChatThreadID)(e.chat.id.toJid())});var u,g;if(e.isGroupMsg)a.set({isAdmin:null===(u=e.chat.groupMetadata)||void 0===u||null===(g=u.participants.get(s))||void 0===g?void 0:g.isAdmin});a.commit();break;case S.KeepType.UNDO_KEEP_FOR_ALL:N(e,c,l.Clock.globalUnixTime());const o=new v.default.DisappearingMessageKeepInChat({kicActionName:v.default.KIC_ACTION_NAME_TYPE.UNKEEP_MESSAGE,isAGroup:e.isGroupMsg,messagesSelected:1,mediaType:e.getWamMediaType(),chatEphemeralityDuration:null!==(r=e.chat.getEphemeralSetting())&&void 0!==r?r:0,keptDelta:U(e.kicTimestamp),messageExpiryTimer:null!==(i=e.timeUntilExpiration())&&void 0!==i?i:0,messageExpiredOnUnkeep:e.isExpired(),kicActor:e.isSentByMe?v.default.KIC_ACTOR_TYPE.SENDER:v.default.KIC_ACTOR_TYPE.RECIPIENT,threadId:yield(0,m.getChatThreadID)(e.chat.id.toJid())});var y,T;if(e.isGroupMsg)o.set({isAdmin:null===(y=e.chat.groupMetadata)||void 0===y||null===(T=y.participants.get(s))||void 0===T?void 0:T.isAdmin});o.commit();break;default:__LOG__(4,void 0,new Error,!0)`sendKeepInChatMessage: trying to send unknown keepType ${t}`,SEND_LOGS("sending-unknown-keeptype")}const C={id:c,from:s,to:e.chat.id,t:l.Clock.globalUnixTime(),type:p.MSG_TYPE.KEEP_IN_CHAT,keepType:t,keptMessageKey:e.id},A=new b.Msg(C);return A.wamMessageSendReporter=new E.MessageSendReporter(A),new f.NonPersistJob("sendMessage",(0,a.default)((function*(){return yield(0,_.sendMsgRecord)(A)})),{priority:o.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}function U(e){return Math.round((l.Clock.globalUnixTime()-(0,s.default)(e,"kicTimestamp"))/3600)}function G(){return(G=(0,a.default)((function*(e,t){const n=yield D(e,S.KeepType.UNDO_KEEP_FOR_ALL);return null!=t&&t.deleteExpired&&e.isExpired()&&c.Cmd.sendDeleteMsgs(e.chat,[e],!1,null,null),n}))).apply(this,arguments)}function x(){return(x=(0,a.default)((function*(e){const t=yield(0,O.getMsgByMsgKey)(e.keptMessageKey),r=A.ChatCollection.get(e.id.remote);let i;if(r&&(i=yield(0,m.getChatThreadID)(r.id.toJid())),null==t){__LOG__(4,void 0,new Error)`KIC: cannot find associated message ${e}`,B(e,r,i);const{storeMessageOrphans:t}=n(469440);return void t([e],(e=>e.keptMessageKey))}if(t.isRevoke)return __LOG__(4,void 0,new Error)`KIC: cannot keep/unkeep message because associated message is revoked ${e}`,void F(e,t,r,i);let a=P.MsgCollection.get(e.keptMessageKey);if(!a){const{messages:t}=yield P.MsgCollection.getMessagesById([e.keptMessageKey.toString()]);a=t[0]}switch((0,g.toUserWid)((0,u.getSender)(e)),e.keepType){case S.KeepType.KEEP_FOR_ALL:T.WANotificationController.triggerNotification(new C.WAKeepInChatNotification({keepInChatMessage:e,parentMessage:a})),yield w(a,e.id,e.t),j(e,a,v.default.KIC_REQUEST_TYPE_TYPE.KEEP,r,i);break;case S.KeepType.UNDO_KEEP_FOR_ALL:yield N(a,e.id,e.t),j(e,a,v.default.KIC_REQUEST_TYPE_TYPE.UNKEEP,r,i);break;default:__LOG__(4,void 0,new Error,!0)`KIC: unknown keepType ${e}`,SEND_LOGS("processed-unknown-keeptype")}}))).apply(this,arguments)}function B(e,t,n){const r=new v.default.KeepInChatPerf({response:v.default.RESPONSE_TYPE.ERROR,requestSendTime:e.t,kicErrorCode:v.default.KIC_ERROR_CODE_TYPE.MESSAGE_MISSING,chatEphemeralityDuration:(null==t?void 0:t.getEphemeralSetting())||0});null!=n&&r.set({threadId:n});const i=(0,I.parseKeepTypeToMetric)(e.keepType);i&&r.set({kicRequestType:i}),r.commit()}function F(e,t,n,r){const i=new v.default.KeepInChatPerf({response:v.default.RESPONSE_TYPE.ERROR,requestSendTime:e.t,kicErrorCode:v.default.KIC_ERROR_CODE_TYPE.MESSAGE_REVOKED,kicMessageEphemeralityDuration:(null==t?void 0:t.ephemeralDuration)||0,chatEphemeralityDuration:(null==n?void 0:n.getEphemeralSetting())||0}),a=(0,I.parseKeepTypeToMetric)(e.keepType);a&&i.set({kicRequestType:a}),null!=r&&i.set({threadId:r}),i.commit()}function j(e,t,n,r,i){const a=new v.default.KeepInChatPerf({kicRequestType:n,response:v.default.RESPONSE_TYPE.SUCCESS,requestSendTime:e.t,kicErrorCode:v.default.KIC_ERROR_CODE_TYPE.NONE,kicMessageEphemeralityDuration:(null==t?void 0:t.ephemeralDuration)||0,chatEphemeralityDuration:(null==r?void 0:r.getEphemeralSetting())||0});null!=i&&a.set({threadId:i}),a.commit()}},219534:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateMsgInfo=function(e,t,n,r){if((0,a.isLegacyWebdBackend)())return function(e,t,n,r){const a=e.id;if(!o.default.isUser(a.remote)){if(t!==i.ACK.RECEIVED){const t=e.delivery.get(n);t&&e.delivery.remove(t)}if(t!==i.ACK.READ){const t=e.read.get(n);t&&e.read.remove(t)}if(t!==i.ACK.PLAYED){const t=e.played.get(n);t&&e.played.remove(t)}}t===i.ACK.PLAYED?(e.played.get(n)||(e.playedRemaining-=1),e.played.add({id:n,t:r})):t===i.ACK.READ?(e.read.get(n)||(e.readRemaining-=1),e.read.add({id:n,t:r})):t===i.ACK.RECEIVED&&(e.delivery.get(n)||(e.deliveryRemaining-=1),e.delivery.add({id:n,t:r}))}((0,s.unproxy)(e),t,n,r);return function(e,t,n,r){const a=e.id;o.default.isUser(a.remote)?function(e,t,n,r){t===i.ACK.PLAYED?(e.played.get(n)||(e.playedRemaining-=1),e.played.add({id:n,t:r})):t===i.ACK.READ?(e.read.get(n)||(e.readRemaining-=1),e.read.add({id:n,t:r})):t===i.ACK.RECEIVED&&(e.delivery.get(n)||(e.deliveryRemaining-=1),e.delivery.add({id:n,t:r}))}(e,t,n,r):function(e,t,n,r){let a=i.ACK.CLOCK;e.played.get(n)?a=i.ACK.PLAYED:e.read.get(n)?a=i.ACK.READ:e.delivery.get(n)&&(a=i.ACK.RECEIVED);if(t<=a)return;if(t>i.ACK.RECEIVED){const t=e.delivery.get(n);t?e.delivery.remove(t):e.deliveryRemaining-=1}if(t>i.ACK.READ){const t=e.read.get(n);t?e.read.remove(t):e.readRemaining-=1}t===i.ACK.PLAYED?(e.played.get(n)||(e.playedRemaining-=1),e.played.add({id:n,t:r})):t===i.ACK.READ?(e.read.get(n)||(e.readRemaining-=1),e.read.add({id:n,t:r})):t===i.ACK.RECEIVED&&(e.delivery.get(n)||(e.deliveryRemaining-=1),e.delivery.add({id:n,t:r}))}(e,t,n,r)}((0,s.unproxy)(e),t,n,r)};var i=n(535470),a=n(88555),o=r(n(389867)),s=n(118146)},100629:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.cancelOrDeclinePaymentRequest=function(){return s.apply(this,arguments)},t.fulfillPaymentRequest=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(536051),o=n(390641);function s(){return(s=(0,i.default)((function*(e){const t=n(559871).MsgCollection,r=new t.constructor.model(e),i=yield(0,o.processPaymentMessages)([r]);i&&i.forEach((n=>{const r=t.get(n.id);r?r.set((0,a.messageFromDbRow)(n),{merge:!0}):n.id===e.id.toString()&&(e.type=n.type,e.templateParams=n.templateParams)}))}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=n(559871).MsgCollection,r=new t.constructor.model(e),i=yield(0,o.processPaymentMessages)([r]);i&&i.forEach((e=>{const n=t.get(e.id);n&&n.set((0,a.messageFromDbRow)(e),{merge:!0})}))}))).apply(this,arguments)}},702040:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._processMultipleMessages=function(){return P.apply(this,arguments)};var i=r(n(348926)),a=r(n(355662)),o=n(88555),s=n(310206),l=n(40234),c=r(n(864452)),u=n(438184),d=n(408139),p=n(115461),f=n(555452),_=n(978820),h=r(n(389867)),g=n(871473),m=r(n(961516)),y=n(778986),S=n(58668),E=n(432554),v=n(492671),T=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(554676)),C=n(964551),A=n(191692);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}function P(){return(P=(0,i.default)((function*(e,t,r,i){const{filteredRecs:b,reorderRecs:P,updates:M}=(0,c.default)(e,t,r,i);yield Promise.all(M);const I=n(669951).ChatCollection,w=n(211739).findChat,R=n(559871).MsgCollection;if(0===b.length&&0===P.length){if(e&&r.pendingMsgsDone){const t=I.get(e);t&&(t.pendingMsgs=!1)}return t.map((e=>R.get(e.id))).filter((e=>e))}if(!e)return O(b).then((()=>t.map((e=>R.get(e.id))).filter((e=>e&&!!e.chat))));let N;const L=t[0];if(h.default.isStatusV3(e)){const e=L.id.fromMe?(0,_.getMaybeMeUser)():L.author;N=n(459387).StatusV3Collection.find(e)}else N=w(e);const D=yield N,k=yield O(b),U="after"===r.add||"last"===r.add,G=!r.isHistory;let x,B,F=!1;if("unread"===r.add?(x=i,D.msgChunks.push(x),B=r.firstUnreadKey):"last"===r.add&&r.resume?(x=i,F=!0):x="function"==typeof i?i():i,(0,a.default)(t,k,P,D,U,x||D.msgs,B,F),r.pendingMsgsDone&&(D.pendingMsgs=!1),G&&h.default.isBroadcast(e)&&!h.default.isStatusV3(e)&&k.forEach((function(e){e&&e.recvFresh&&!e.isNotification&&T.broadcastFanout(e)})),u.LegacyPhoneFeatures.supportsFeature(u.LegacyPhoneFeatures.F.RECENT_EMOJI_SYNC))for(let e=0;e<k.length;e++){const t=k[e];if(t.isNewMsg&&t.isSentByMe&&t.containsEmoji){v.RecentEmojiCollection.throttledSync();break}}if((0,o.isMDBackend)()&&C.ServerProps.webServerStickerPanel){const e=k.map((e=>{if(!(e.isSentByMe&&e.type===p.MSG_TYPE.STICKER))return;const{mediaData:t,mediaObject:n}=e,r=e.id.toString(),i=null==n?void 0:n.entries.entries[0];return[{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:(null==i?void 0:i.encFilehash)||t.encFilehash,mediaKey:(null==i?void 0:i.mediaKey)||t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:l.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:S.OUTWARD_TYPES.STICKER,index:0},e.t,r]})).filter(Boolean);n(249264).RecentStickerCollectionMd.enqueue(e)}if((0,d.isRecentStickersEnabled)()){const e=k.map((e=>{if(!(e.isNewMsg&&e.isSentByMe&&e.type===p.MSG_TYPE.STICKER))return;const{mediaData:t}=e;return{id:t.filehash,directPath:t.directPath,filehash:t.filehash,encFilehash:t.encFilehash,mediaKey:t.mediaKey,mediaKeyTimestamp:null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:l.Clock.globalUnixTime(),width:t.fullWidth,height:t.fullHeight,size:t.size,mimetype:t.mimetype,type:S.OUTWARD_TYPES.STICKER,index:0}})).filter(Boolean);A.RecentStickerCollection.enqueue(e)}if((0,d.webMediaAutoDownloadEnabled)()&&!h.default.isStatusV3(e)&&k.map((e=>e.asAutoDownloadableMedia)).filter(Boolean).forEach((e=>{g.AutoDownloadQueue.enqueue(e,g.AUTO_DOWNLOAD_TYPES.MEDIA)})),C.ServerProps.webDownloadDocumentThumbMmsEnabled&&k.map((e=>e.asDoc)).filter(Boolean).forEach((e=>{(0,d.webMediaAutoDownloadEnabled)()?g.AutoDownloadQueue.enqueue(e,g.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,m.default)({msg:e,isPreload:!0})})),k.map((e=>e.asUrl)).filter(Boolean).forEach((e=>{(0,E.hqLinkPreviewExpired)(e.t)||((0,d.webMediaAutoDownloadEnabled)()?g.AutoDownloadQueue.enqueue(e,g.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,m.default)({msg:e,isPreload:!0}))})),(0,s.isFeatureEnabled)("download_status_thumb_mms")&&h.default.isStatusV3(e)){const e=(0,f.getLastStatusUsage)();(null==e||Date.now()-e<12096e5)&&k.map((e=>e.asImage||e.asVideo)).filter(Boolean).forEach((e=>{(0,d.webMediaAutoDownloadEnabled)()?g.AutoDownloadQueue.enqueue(e,g.AUTO_DOWNLOAD_TYPES.MMS_THUMBNAIL):(0,y.downloadStatusV3Thumbnail)({msg:e,isPreload:!0})}))}return t.map((e=>R.get(e.id))).filter((e=>e))}))).apply(this,arguments)}function O(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){let t=n(559871).MsgCollection.add(e,{merge:!0});return(0,o.isMDBackend)()&&(t=t.filter(((t,n)=>(null==t&&(__LOG__(4,void 0,new Error,!0)`Get empty message with id ${e[n].id}.`,SEND_LOGS("msgPrepWork-empty-message")),null!=t)))),yield Promise.all(t.map((e=>e.waitForPrep().catch((e=>{__LOG__(4,void 0,new Error,!0)`Assertion failed! ${String(e)}`,SEND_LOGS("bad-msg-prep")}))))),t}))).apply(this,arguments)}},837398:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addOrUpdateReactions=function(){return O.apply(this,arguments)},t.addOrUpdateReactionsDB=A,t.addOrUpdateReactionsDBBulk=function(e){return(0,S.createOrUpdateReactions)(e)},t.addOrUpdateReactionsModelCollection=b,t.checkUpdateForOrphanReactions=function(){return F.apply(this,arguments)},t.deleteAllReactionsOfMsg=function(){return M.apply(this,arguments)},t.markReactionsAsRead=function(){return I.apply(this,arguments)},t.markReactionsAsReadByMessageKeys=function(){return U.apply(this,arguments)},t.resendUpdateFailedPropsForSentReactionsDBAndModel=function(){return w.apply(this,arguments)},t.updateFailedPropsForSentReactionsCollection=k,t.updateFailedPropsForSentReactionsDB=L,t.updateFailedPropsForSentReactionsDBAndModel=R;var i=r(n(506479)),a=r(n(348926)),o=n(524674),s=n(535470),l=n(781572),c=r(n(465212)),u=n(879274),d=n(867811),p=n(348918),f=n(461827),_=n(978820),h=n(15665),g=n(485807),m=n(257162),y=n(215565),S=n(307394),E=n(727485),v=n(979491),T=n(916551);const C=["senderUserJid"];function A(e){return(0,S.createOrUpdateReactions)([e])}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t){const{parentMsgKey:r}=e,{WAReactionNotification:i,nonHydratedShouldMuteReactionNotification:a}=n(747751),o=t&&!a(e);let s;if(s=o?yield m.ReactionsCollection.find(r):m.ReactionsCollection.get(r),s){m.ReactionsCollection.addOrUpdateReaction(e);const t=s.reactions.length>0;yield(0,h.updateHasReactionInParent)(r,t)}else e.reactionText!==d.REVOKED_REACTION_TEXT&&(yield(0,h.updateHasReactionInParent)(r,!0));if(o){const t=new i({reactionMsg:e});g.WANotificationController.triggerNotification(t)}const u=(0,d.isReactionByMe)(e.senderUserJid),p=c.default.fromString(r),_=p.fromMe;if((0,f.shouldUnarchiveChatOnReaction)(_,u,e.reactionText)){const e=n(669951).ChatCollection.get(p.remote.toString());e&&l.Cmd.archiveChat(e,!1,!1)}}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e,t){const[n]=yield A(e);if(n)return b(n,t),n}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e){yield(0,E.deleteReactionsByParentMessageKey)(e.toString());m.ReactionsCollection.get(e)&&m.ReactionsCollection.deleteReactionsByParentMessageKey(e)}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e){yield(0,p.sendReactionReadReceipts)(e),yield(0,v.markReactionRowsAsRead)(x(e)),m.ReactionsCollection.markReactionsAsRead(B(e))}))).apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){const{senderUserJid:t}=e,r=(0,i.default)(e,C),a=m.ReactionsCollection.getExistingSenderModelFromReactionDetails(r);if(null==a)return void __LOG__(4,void 0,new Error)`WAWebReactionsUtils:resendUpdateFailedPropsForSentReactionsDBAndModel Reactions model not found for this message id`;const l=(0,_.getMaybeMeUser)(),c=e.parentMsgKey.remote,d=a.timestamp,p={id:e.msgKey,reactionParentKey:e.parentMsgKey,type:"reaction",t:Math.floor(d/1e3),from:l,to:c,self:"out",local:!0,ack:s.ACK.CLOCK,reactionText:e.reactionText,reactionTimestamp:d},{Msg:f}=n(17304),h=new f(p),g={ack:s.ACK.CLOCK,isSendFailure:!1};yield R(e,g.ack,g.isSendFailure);const{sendMsgRecord:y}=n(745042);return new u.NonPersistJob("sendMessage",(()=>y(h)),{priority:o.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}))).apply(this,arguments)}function R(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e,t,n){yield L(e,t,n),k(e,t,n)}))).apply(this,arguments)}function L(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t,n){const r=x([e])[0];yield(0,T.updateFailedPropsForSentReactions)({reaction:r,ack:t,isSendFailure:n})}))).apply(this,arguments)}function k(e,t,n){const r=B([e])[0];m.ReactionsCollection.updateFailedPropsForExistingSentReaction(r,t,n)}function U(){return(U=(0,a.default)((function*(e){const t=yield(0,v.markReactionsAsReadByMessageKeysInStore)(e);t&&m.ReactionsCollection.markReactionsAsRead(G(t))}))).apply(this,arguments)}function G(e){return e.map((e=>{let{parentMsgKey:t,msgKey:n,reactionText:r}=e;return{parentMsgKey:c.default.fromString(t),msgKey:c.default.fromString(n),reactionText:r}}))}function x(e){return e.map((e=>{let{parentMsgKey:t,senderUserJid:n}=e;return{parentMsgKey:t.toString(),senderUserJid:n}}))}function B(e){return e.map((e=>{let{parentMsgKey:t,msgKey:n,reactionText:r}=e;return{parentMsgKey:t,msgKey:n,reactionText:r}}))}function F(){return(F=(0,a.default)((function*(e){try{(yield(0,y.changeOrphanStateReactions)(e)).forEach((e=>{m.ReactionsCollection.get(e.parentMsgKey)&&m.ReactionsCollection.addOrUpdateReaction(e)}))}catch(e){__LOG__(3)`checkUpdateForOrphanReactions: error ${e}`}}))).apply(this,arguments)}},318457:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.revoke=k,t.sendRevoke=function(e,t,r){return function(e,t,r){if(t===d.Revoke.Sender&&!e.id.fromMe)return Promise.reject(new Error("revoking received message"));let a;(0,l.isMDBackend)()&&e.id.remote.isGroup()&&(a=(0,v.getMeUser)());const s=new f.default({id:f.default.newId(),remote:e.id.remote,fromMe:!0,participant:a}),c=function(e){switch(e){case d.Revoke.Sender:return"sender_revoke";case d.Revoke.Admin:return"admin_revoke"}}(t),p=u.Clock.globalUnixTime(),m={id:s,from:(0,v.getMeUser)(),to:e.id.remote,t:p,type:_.MSG_TYPE.PROTOCOL,subtype:c,protocolMessageKey:e.id,clearMedia:!!r,local:!0,revokeDuration:p-e.t,revokeTimestamp:p},T=new I.Msg(m);(0,l.isMDBackend)()&&(T.wamMessageSendPerfReporter=new P.MessageSendPerfReporter(T.to,T.getWamMediaType(),T.getWamMessageType()),T.wamMessageSendPerfReporter.setIsRevokeMessage(!0));return new h.NonPersistJob("sendMessage",(0,i.default)((function*(){try{var t,r;null===(t=T.wamMessageSendPerfReporter)||void 0===t||t.startSavedStage(),yield(0,N.storeMessages)([m],e.chat.id),null===(r=T.wamMessageSendPerfReporter)||void 0===r||r.postSavedStage()}catch(e){throw __LOG__(4,!0,new Error,!0)`_sendRevoke: failed to storeMessages into storage`,SEND_LOGS("storeMessages failed"),e}return(yield(0,y.sendMsgRecord)(T))===S.SendMsgResult.OK?(new O.default.SendRevokeMessage({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),revokeSendDelay:T.revokeDuration}).commit(),(0,N.processRevokeMsgs)([{revokeMsgKey:e.id,newMsgKey:s,timestamp:e.t,revokeTimestamp:p,subtype:c,sender:(0,v.getMeUser)()}]).then((0,i.default)((function*(){const t=n(203292).getJobManager;return(0,E.deleteModelsForLastReactionPreview)([e.id.toString()]),yield t().waitUntilPersisted(g.jobSerializers.deleteAddOns(e.chat.id.toString(),[e.id.toString()])),k(e,{msgKey:s,subtype:c,sender:(0,v.getMeUser)(),revokeTimestamp:p}),S.SendMsgResult.OK})))):Promise.resolve(S.SendMsgResult.ERROR_UNKNOWN)})),{priority:o.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted()}((0,M.unproxy)(e),t,r)};var i=r(n(348926)),a=r(n(604788)),o=n(524674),s=n(227101),l=n(88555),c=n(716055),u=n(40234),d=n(781572),p=n(408139),f=r(n(465212)),_=n(115461),h=n(879274),g=n(453168),m=n(586031),y=n(745042),S=n(20551),E=n(14571),v=n(978820),T=r(n(389867)),C=n(111902),A=r(n(169048)),b=D(n(778986)),P=n(751708),O=r(n(11339)),M=n(118146),I=n(17304),w=D(n(554676)),R=n(448285),N=n(584886);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}function D(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function k(e,t){return function(e,t){var r;const i="admin_revoke"===t.subtype;if(i&&!(0,p.adminRevokeReceiverEnabled)())return void __LOG__(2)`revoke: admin revoke feature is disabled, ${e.id.toString()} has not been revoked`;if(i||(0,s.isSenderRevokeWindowReceiverEnabled)()){if(!(u.Clock.globalUnixTime()-e.t<=m.REVOKE_WINDOW_V2+m.REVOKE_WINDOW_V2_RECEIVER_MARGIN))return void __LOG__(2)`revoke: outside of revoke window, ${e.id.toString()} has not been revoked`}n(316770).LabelCollection.removeAllLabelsMD(e),w.typeIsMms(e)&&b.deregisterMsg(e);e.chat&&e.chat.removeFromCollection(e);e.trigger("revoked");const o=e.getCollection(),d=e.id;e.msgChunk&&e.msgChunk.replaceId(d,t.msgKey);o.replaceId(d,t.msgKey);const f=null===(r=e.chat)||void 0===r?void 0:r.isUnreadMsg(e),h={id:t.msgKey,type:_.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",revokeSender:t.sender,revokeTimestamp:t.revokeTimestamp,body:void 0,caption:void 0,clientUrl:void 0,deprecatedMms3Url:void 0,loc:void 0,lat:void 0,lng:void 0,isLive:void 0,accuracy:void 0,speed:void 0,degrees:void 0,comment:void 0,sequence:void 0,shareDuration:void 0,finalLat:void 0,finalLng:void 0,finalAccuracy:void 0,finalThumbnail:void 0,finalSpeed:void 0,finalDegrees:void 0,finalTimeOffset:void 0,title:void 0,description:void 0,canonicalUrl:void 0,matchedText:void 0,thumbnail:void 0,richPreviewType:void 0,doNotPlayInline:void 0,quotedMsg:void 0,quotedStanzaID:void 0,quotedRemoteJid:void 0,quotedParticipant:void 0,mediaData:void 0,mentionedJidList:void 0,vcardList:void 0,star:!1,kicState:void 0,kicTimestamp:void 0,kicKey:void 0};e.set(h),e.trigger("change:msgKey",{newKey:t.msgKey,oldKey:d}),e.chat&&((0,c.updateMediasCountOnMsg)(e.chat,e,!0),d.equals(e.chat.lastReceivedKey)&&(0,C.setLastReceivedKey)(e.chat.id,t.msgKey).then((()=>{e.chat.lastReceivedKey=t.msgKey})),e.chat.composeQuotedMsg===e&&(e.chat.composeQuotedMsg=null),(0,s.isSenderRevokeUiEnabled)()&&f&&(e.chat.unreadCount=Math.max(e.chat.unreadCount-1,0),(0,R.reduceChatUnreadCount)(e.chat.id.toString())));e.isLive&&n(985865).LiveLocationCollection.removeMsg(e);if(T.default.isBroadcast(d.remote)){const r=w.getBroadcastFanoutKeys(d),i=w.getBroadcastFanoutKeys(t.msgKey);if(!r||!i||r.length!==i.length)return void __LOG__(2)`cannot fanout revoke: ${String(r)} ${String(i)}`;if((0,a.default)(r,i).forEach((e=>{const n=o.get(e[0]);n&&k(n,{msgKey:e[1],subtype:t.subtype,sender:t.sender})})),(0,l.isLegacyWebdBackend)())return;A.default.purge([String(e.rowId)]).catch((()=>{}));const s=n(203292).getJobManager,c=e.chat?e.chat.id.toString():e.id.remote.toString();(0,E.deleteModelsForLastReactionPreview)([d.toString()]),s().fireAndForget(g.jobSerializers.deleteAddOns(c.toString(),[d.toString()]))}}((0,M.unproxy)(e),t)}},586031:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=t.REVOKE_WINDOW_V2=t.REVOKE_WINDOW=void 0;t.REVOKE_WINDOW=4096;t.REVOKE_WINDOW_V2=216e3;t.REVOKE_WINDOW_V2_RECEIVER_MARGIN=43200},899747:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.revokeAllStatusPSA=function(){const e=a.StatusV3Collection.getPSAStatus();if(!e)return Promise.resolve();const t=e.msgs.map((e=>e.id.toString()));return s(e,t)},t.revokeStatusPSA=function(e){const t=a.StatusV3Collection.getPSAStatus();if(!t)return Promise.resolve();const n=t.msgs.filter((t=>t.campaignId===e)).map((e=>e.id.toString()));return s(t,n)};var i=r(n(348926)),a=n(459387),o=n(584886);function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e,t){t.length>0&&(e.revokeMsgs(t),yield(0,o.removeMessagesFromHistory)(t),__LOG__(2,void 0,void 0,void 0,["revoke-status-psa"])`revokeStatusPSA completed`)}))).apply(this,arguments)}},467019:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendKeyDistributionMsg=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=r(n(465212)),o=n(978820),s=n(745454),l=r(n(963928));function c(){return(c=(0,i.default)((function*(e){if(!e.isGroup)return Promise.reject(new Error("[messaging] sendKeyDistributionMsg: only group chats are supported`"));const t=e.id,r=(0,o.getMaybeMeUser)(),i=new a.default({from:r,to:t,id:a.default.newId(),participant:(0,s.toUserWid)(r),selfDir:"out"});yield l.default.find(e.id);const{encryptAndSendKeyDistributionMsg:c}=n(925080);return c(i)}))).apply(this,arguments)}},745042:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgRecord=function(e){return e.wamMessageSendReporter=e.wamMessageSendReporter||new P.MessageSendReporter(e),(0,s.promiseCallSync)((()=>{const t=e.id,r=n(211739).findChat;let s;r(t.remote).then((e=>{e.isTrusted()||(0,S.sendNotSpam)(e).catch((()=>{}))})),T.default.isBroadcast(e.to)&&(s=(0,w.broadcastFanout)(e)),e.isNewMsg=!0;const P=e.type===h.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(e.subtype),L=e.type===h.MSG_TYPE.REACTION&&e.reactionText===m.REVOKED_REACTION_TEXT;if(!e.isGroupMsg&&!P&&!L&&M.BlocklistCollection.get(e.to))return Promise.reject(new f.default("Contact is blocked",I.ContactCollection.assertGet(e.to)));let D;P||(D=new O.default.WebcMessageSend({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),messageIsForward:Boolean(e.isForwarded)}));const k=n(559871).MsgCollection;return r(e.id.remote).then((t=>((0,E.sendSeen)(t),e.type===h.MSG_TYPE.REACTION||P||k.trigger(p.default.NEW_MSG_SENT),(0,l.promiseProps)({reply:(0,A.sendMsgRecord)(e),chat:t})))).then((n=>{var a;let{reply:o,chat:l}=n;const u=t.remote,d=(0,v.getMaybeMeUser)(),p=t.fromMe&&(0,v.isMePrimary)(t.remote)?3:o.data?o.data.ack:1;if(e.updateAck(p,o.t),e.type===h.MSG_TYPE.REACTION){const t={parentMsgKey:e.reactionParentKey,msgKey:e.id,reactionText:e.reactionText,senderUserJid:e.from.toString()},{senderUserJid:n}=t,r=(0,i.default)(t,N);R.ReactionsCollection.shouldUpdateAck(r,p)&&(0,g.updateFailedPropsForSentReactionsDBAndModel)(t,p)}return D&&(D.markMessageSendT(),D.commit()),(0,b.logMessageSendForChatThreadLogging)(e),null===(a=e.wamMessageSendReporter)||void 0===a||a.postSuccess(),[h.MSG_TYPE.PROTOCOL,h.MSG_TYPE.REACTION].includes(e.type)||(0,C.setLastReceivedKey)(l.id,t).then((()=>{l.lastReceivedKey=t})),k.updateLastReceipt(u,o.t),T.default.isBroadcast(u)&&(s?s.forEach((e=>{const n=new _.default({from:d,to:e,id:t.id}),i=k.get(n);i&&(i.ack=c.ACK.SENT,k.updateLastReceipt(e,i.t),null==i.ephemeralStartTimestamp&&i.updateEphemeralStartTimestamp(i.t),r(e).then((e=>{(0,C.setLastReceivedKey)(e.id,n).then((()=>{e.lastReceivedKey=n}))})))})):__LOG__(2)`model:msg:createRecord bclist server ack, no recipients`),y.SendMsgResult.OK})).catch((0,o.filteredCatch)(u.ServerStatusCodeError,(t=>{var n;(408!==t.status&&(__LOG__(4,void 0,new Error,!0)`Phone responded ${t.status}`,SEND_LOGS("send-not-200")),(0,d.isMDBackend)())&&(null===(n=e.wamMessageSendReporter)||void 0===n||n.postFailure({result:O.default.MESSAGE_SEND_RESULT_TYPE.ERROR_NETWORK,isTerminal:!1}));return y.SendMsgResult.ERROR_NETWORK}))).catch((0,o.filteredCatch)(a.BufferTooLargeError,(()=>{var t;(0,d.isMDBackend)()&&(null===(t=e.wamMessageSendReporter)||void 0===t||t.postFailure({result:O.default.MESSAGE_SEND_RESULT_TYPE.ERROR_PAYLOAD_TOO_BIG,isTerminal:!0}));return y.SendMsgResult.ERROR_UNKNOWN}))).catch((t=>{var n;(__LOG__(3)`model:msg:createRecord dropped msg: ${e.id.toString()}`,__LOG__(4,void 0,new Error,!0)`Got error ${String(t)}`,SEND_LOGS("send-msg-error"),(0,d.isMDBackend)())&&(null===(n=e.wamMessageSendReporter)||void 0===n||n.postFailure({result:O.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,isTerminal:!0}));return y.SendMsgResult.ERROR_UNKNOWN}))})).finally((()=>{e.sendDeferred&&e.sendDeferred.resolve(),e.wamMessageSendReporter=null}))};var i=r(n(506479)),a=n(311609),o=n(450796),s=n(418412),l=n(367602),c=n(535470),u=n(492574),d=n(88555),p=r(n(364369)),f=r(n(670119)),_=r(n(465212)),h=n(115461),g=n(837398),m=n(867811),y=n(20551),S=n(45775),E=n(561498),v=n(978820),T=r(n(389867)),C=n(111902),A=n(390298),b=n(184746),P=n(70500),O=r(n(11339)),M=n(132826),I=n(719380),w=n(554676),R=n(257162);const N=["senderUserJid"]},20551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SendMsgResult=void 0;const r=n(76672).Mirrored(["OK","ERROR_NETWORK","ERROR_EXPIRED","ERROR_CANCELLED","ERROR_UPLOAD","ERROR_UNKNOWN"]);t.SendMsgResult=r},303441:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(108197),o=r(n(389867)),s=n(421224),l=n(290981);function c(){return(c=(0,i.default)((function*(e,t){if(!o.default.isUser(e.id.remote))return;const n=e.privacyModeWhenSent;if(null!=n&&n.privacyModeTs>t.privacyModeTs)return;const r=(0,a.getReducedPrivacyMode)(t);if(r===(0,a.getReducedPrivacyMode)(n))return;if(null!=e.bizPrivacyStatus)return void __LOG__(3)`msg.bizPrivacyStatus exist already, we can not assign a new value anymore`;const i=u(r);e.bizPrivacyStatus=i,yield(0,l.getTable)().merge(e.id.toString(),{bizPrivacyStatus:i})}))).apply(this,arguments)}function u(e){switch(e){case a.ReducedPrivacyMode.E2EE:return s.WebMessageInfo$BizPrivacyStatus.E2EE;case a.ReducedPrivacyMode.BSP:return s.WebMessageInfo$BizPrivacyStatus.BSP;case a.ReducedPrivacyMode.FB:return s.WebMessageInfo$BizPrivacyStatus.FB}}},707122:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleInitialSyncMsgs=function(e){const t={add:"last",isHistory:!0},r=Object.keys(e).map((n=>(0,u.frontendSendAndReceive)("processMultipleMessages",{chatId:(0,C.createWid)(n),msgObjs:e[n].msgs,meta:t,chatMsgsCollection:null})));return Promise.all([...r,(0,b.storeInitialSyncMessages)(e)]).then((()=>{const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].msgs.map((e=>e.id.toString())))));return(0,g.receiveReactionsEnabled)()&&(0,E.checkUpdateForOrphanReactions)(t),(0,c.checkOrphanMutations)(t,Object.keys(e))})).then((()=>{if((0,g.parseWMIReaction)()){const t=Array.prototype.concat(...Object.keys(e).map((t=>e[t].reactionMessages)));return(0,n(953348).storeReactionMsgBulk)(t)}})).then((()=>{if((0,S.isPollVoteProcessingEnabled)())return Promise.all(Array.prototype.concat(...Object.keys(e).map((t=>e[t].pollVotes)))).then((e=>{const t=Array.prototype.concat(...e);return(0,n(953348).storePollVotesBulk)(t)}))})).then((()=>{})).catch((0,o.filteredCatch)(d.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleMsgsMD=function(e,t){const n=t.length;if(!n)return Promise.resolve();if(!(e instanceof T.default))return Promise.resolve();const r={add:"before",isHistory:!0};for(let e=0;e<n;e++){t[e].invis=!0}return(0,u.frontendFireAndForget)("msgCollectionTrigger",{name:"handle:msg_history",args:{count:t.length}}),(0,b.storeMessages)(t,e,!0).then((()=>{const n=t.map((e=>e.id.toString()));(0,c.checkOrphanMutations)(n,[e.toString()]),(0,g.receiveReactionsEnabled)()&&(0,E.checkUpdateForOrphanReactions)(n)})).then((()=>(0,u.frontendSendAndReceive)("processMultipleMessages",{chatId:e,msgObjs:t,meta:r,chatMsgsCollection:null}))).catch((0,o.filteredCatch)(d.LogoutDrop,(()=>{}))).catch((t=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${n} Chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`,SEND_LOGS("msg_handler for MD: error storing/processing multiple messages")}))},t.handleProgressiveHistorySyncMsgs=function(){return I.apply(this,arguments)},t.handleSingleMsgMD=function(){return M.apply(this,arguments)};var i=r(n(348926)),a=n(180284),o=n(450796),s=n(413959),l=n(904352),c=n(134719),u=n(708154),d=n(492574),p=n(276167),f=n(40234),_=n(960834),h=n(572556),g=n(408139),m=n(115461),y=n(453168),S=n(758180),E=n(837398),v=n(14571),T=r(n(389867)),C=n(745454),A=n(562415),b=n(584886),P=n(390641),O=n(649831);function M(){return(M=(0,i.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const S={add:"after",update:r,isHistory:!1},C=t.type===m.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(t.subtype);let M=t;if(!C){const e=yield(0,O.applyOrphanRevoke)([M]);if(0===e.length)return;M=e[0]}const I=yield(0,_.handleForActiveMessageRange)(e,M);if(I.has(h.ActiveRangeHandlerAction.DropMessage))return;const w=I.has(h.ActiveRangeHandlerAction.SkipUI);try{T.default.isStatusV3(e)&&(yield(0,u.frontendSendAndReceive)("handleStatusV3Update",{rawMsg:M,checksum:null,isMsgUpdate:!1})),yield(0,l.promiseLoop)(function(){var t=(0,i.default)((function*(t,i,o){const l=(0,s.delayMs)((0,a.expBackoff)(o,12e4,1e3,.1));try{if(r)yield(0,b.updateMessage)(M),__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`placeholder populate successful`;else if(C){yield(0,b.processRevokeMsgs)([{revokeMsgKey:M.protocolMessageKey,newMsgKey:M.id,timestamp:M.t,subtype:M.subtype,sender:M.author,revokeTimestamp:M.t}]),(0,v.deleteModelsForLastReactionPreview)([M.protocolMessageKey.toString()]);const t=n(203292).getJobManager;yield t().waitUntilPersisted(y.jobSerializers.deleteAddOns(e.toString(),[M.protocolMessageKey.toString()]))}else try{yield(0,b.storeMessages)([M],e),M.type===m.MSG_TYPE.CIPHERTEXT&&(0,p.addPlaceHolderAction)(M)}catch(e){if(!(e instanceof b.DuplicateMessageError))throw e;M.type===m.MSG_TYPE.CIPHERTEXT?__LOG__(2)`processPlaceholderMsg: skip creating duplicate placeholder`:(__LOG__(2)`storeMessages loop: detect resend message`,yield(0,b.updateMessage)(M),S.update=!0)}if(M.type===m.MSG_TYPE.GROUPS_V4_INVITE){const e=M.id.toString();yield(0,A.persistGroupInviteV4Msg)(e,{id:e,from:M.from.toString(),to:M.to.toString(),groupId:M.inviteGrp,expiration:parseInt(M.inviteCodeExp,10),expired:f.Clock.globalUnixTime()>=parseInt(M.inviteCodeExp,10)})}__LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop`,t()}catch(e){return __LOG__(2,void 0,void 0,void 0,["handleSingleMsgMD"])`storeMessages loop: failed with error ${e}.`,o>3?(__LOG__(3)`storeMessages loop: Gave up after ${o} tries`,Promise.reject(e)):l}}));return function(){return t.apply(this,arguments)}}()),__LOG__(2,void 0,void 0,void 0,["messaging"])`handleSingleMsgMD: msgId::${M.id.id}, write message to db done, overwrite: ${r}, skipUI: ${w}`;try{yield(0,c.checkOrphanMutations)([M.id.toString()],[e.toString()]),(0,g.receiveReactionsEnabled)()&&(yield(0,E.checkUpdateForOrphanReactions)([M.id.toString()]))}catch(t){__LOG__(4,void 0,new Error)`handleSingleMsgMD: checkOrphanMutations failed during handleSingleMsgMD for: ${String(M.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}w||(M.recvFresh=!0,M.isNewMsg=!0,yield(0,u.frontendSendAndReceive)("processMultipleMessages",{chatId:e,msgObjs:[M],meta:S,chatMsgsCollection:null,preserveOrder:o}))}catch(t){if(t instanceof d.LogoutDrop)return;if(t instanceof P.PreviousMsgNotPlaceholderError)return void __LOG__(3)`Msg: ${String(M.id)} chat: ${String(e)} Error: PreviousMsgNotPlaceholderError`;__LOG__(3,void 0,void 0,void 0,["messaging"])`Msg: ${String(M.id)} chat: ${String(e)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}}))).apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e,t,r,i,a){return yield Promise.resolve(),(0,b.storeRecentAndFullHistSyncMessages)(e,t,!0,!0).then((()=>{const n=t.map((e=>e)),r=e.map((e=>e.id.toString()));return(0,g.receiveReactionsEnabled)()&&(0,E.checkUpdateForOrphanReactions)(r),(0,c.checkOrphanMutations)(r,n)})).then((()=>{if((0,g.parseWMIReaction)()){return(0,n(953348).storeReactionMsgBulk)(r)}})).then((()=>{if((0,S.isPollVoteProcessingEnabled)())return Promise.all(i).then((e=>{const t=Array.prototype.concat(...e);return(0,n(953348).storePollVotesBulk)(t)}))})).then((()=>{const e=n(669951).ChatCollection;a.forEach((t=>{if(!t||!t.id||!t.id.remote)return;const n=t.id.remote,r=e.get(n);r&&0===r.msgs.length&&!r.pendingInitialLoading&&(0,u.frontendFireAndForget)("processMultipleMessages",{chatId:n,msgObjs:[t],meta:{add:"last",isHistory:!0},chatMsgsCollection:null})}))})).catch((0,o.filteredCatch)(d.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("handleProgressiveHistorySyncMsgs: error storing/processing multiple messages")}))}))).apply(this,arguments)}},257123:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RangeContain=void 0,t.checkAndRemoveActiveMessageRanges=function(e,t){(0,a.getActiveMessageRanges)(e.remote.toString()).then((n=>{n.forEach((n=>{if([o.ActiveRangeAction.Archive,o.ActiveRangeAction.MarkChatAsRead].includes(n.action)&&l(n.actionValue.messageRange,{id:e,t})===s.DOES_NOT_CONTAIN)return(0,a.removeActiveMessageRange)(e.remote.toString(),n.action)}))}))},t.rangeContainsMessage=l;var r=n(608243),i=n(819937),a=n(438342),o=n(569702);const s=n(76672).Mirrored(["DOES_NOT_CONTAIN","CONTAINS_BY_TIMESTAMP","CONTAINS_BY_ADDITIONAL"]);function l(e,t){if(null==e)return __LOG__(3)`syncd: missing message range from row.`,s.DOES_NOT_CONTAIN;const{messages:n,lastMessageTimestamp:a}=e,o=(0,i.maybeMillisecondsToSeconds)(null!=a?a:0);if(o!==(null!=a?a:0)&&(__LOG__(2,void 0,void 0,!0)`syncd: last message timestamp was converted to seconds from ${a}`,SEND_LOGS("syncd: last message timestamp was converted to seconds",.1)),null!=t.t&&t.t<(0,r.numberOrThrowIfTooLarge)(o))return s.CONTAINS_BY_TIMESTAMP;const l=t.id;for(const{key:e}of n)if(null!=e&&null!=l&&e.id===l.id)return s.CONTAINS_BY_ADDITIONAL;return s.DOES_NOT_CONTAIN}t.RangeContain=s},960834:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForActiveMessageRange=T,t.handleOfflineForMessageRange=function(){return A.apply(this,arguments)};var i=r(n(348926)),a=n(381),o=n(257123),s=(n(572556),function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(890946))),l=n(115461),c=n(745454),u=r(n(273407)),d=n(293824),p=n(438342),f=n(569702),_=n(484902);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}const g=new Set,m=e=>e.reduce(((e,t)=>new Set([...Array.from(e),...Array.from(t)])),new Set);function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n){let r=null;switch(e.action){case f.ActiveRangeAction.Archive:return e.actionValue.archived?yield s.handleForArchive(e,n):yield s.handleForUnarchive(e,n),g;case f.ActiveRangeAction.MarkChatAsRead:return yield s.handleForMarkAsReadUnread(e,n,!!e.actionValue.read),g;case f.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case f.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return r=s.handleForClearChat(e,n),r?new Set([r]):g;case f.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case f.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return(yield E(t.id))?g:(r=s.handleForClearChat(e,n),r?new Set([r]):g);case f.ActiveRangeAction.DeleteChatDeleteMedia:case f.ActiveRangeAction.DeleteChatKeepMedia:return r=s.handleForDeleteChat(e,n),r?new Set([r]):g}return __LOG__(3)`handleMessageContainment called with unknwon message range action action: ${e.action}`,g}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=(0,d.constructStarMsgKeyFromMsgKey)(e),n=yield u.default.getSyncAction(t);if(n){var r;const e=(0,_.decodeProtobuf)(a.SyncActionDataSpec,n.binarySyncData).value;return(null==e||null===(r=e.starAction)||void 0===r?void 0:r.starred)||!1}return!1}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){if(l.SYSTEM_MESSAGE_TYPES.includes(t.type))return g;const n=(yield(0,p.getActiveMessageRanges)(e.toString())).map((e=>[e,(0,o.rangeContainsMessage)(e.actionValue.messageRange,t)])),r=n.filter((e=>{let[,t]=e;return t===o.RangeContain.CONTAINS_BY_ADDITIONAL})).map((e=>{let[t]=e;return t}));r.forEach((e=>{e.remainingMessages--})),yield(0,p.bulkUpdateActiveMessageRanges)(r);const i=n.map((e=>{let[n,r]=e;return y(n,t,r)})),a=yield Promise.all(i);return m(a)}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{if(l.SYSTEM_MESSAGE_TYPES.includes(e.type)||l.ADDON_MESSAGE_TYPES.includes(e.type))return;const n=t.get(e.id.remote.toString());(null==n||n.t<e.t)&&t.set(e.id.remote.toString(),e)})),yield Promise.all(Array.from(t.entries()).map((e=>{let[t,n]=e;return T((0,c.createWid)(t),n)})))}))).apply(this,arguments)}},572556:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeHandlerAction=void 0;const r=n(76672).Mirrored(["DropMessage","SkipUI"]);t.ActiveRangeHandlerAction=r},890946:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleForArchive=function(){return d.apply(this,arguments)},t.handleForClearChat=function(e,t){switch(t){case a.RangeContain.CONTAINS_BY_TIMESTAMP:case a.RangeContain.CONTAINS_BY_ADDITIONAL:return o.ActiveRangeHandlerAction.DropMessage;case a.RangeContain.DOES_NOT_CONTAIN:}},t.handleForDeleteChat=function(e,t){switch(t){case a.RangeContain.CONTAINS_BY_TIMESTAMP:case a.RangeContain.CONTAINS_BY_ADDITIONAL:return o.ActiveRangeHandlerAction.DropMessage;case a.RangeContain.DOES_NOT_CONTAIN:}},t.handleForMarkAsReadUnread=function(){return f.apply(this,arguments)},t.handleForUnarchive=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(257123),o=n(572556),s=n(408139),l=n(745454),c=r(n(268132)),u=n(438342);function d(){return(d=(0,i.default)((function*(e,t){if(t===a.RangeContain.DOES_NOT_CONTAIN){const t=n(774362).default;(0,s.archiveV2Supported)()&&c.default.showArchiveV2||t.setArchive([{id:e.chatId,archive:!1}]),yield(0,u.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){t!==a.RangeContain.DOES_NOT_CONTAIN&&0!==e.remainingMessages||(yield(0,u.removeActiveMessageRange)(e.chatId,e.action))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,r){if(t===a.RangeContain.DOES_NOT_CONTAIN)yield(0,u.removeActiveMessageRange)(e.chatId,e.action);else if(0===e.remainingMessages){const t=n(669951).ChatCollection.get((0,l.createWid)(e.chatId));if(t){const e=n(561498);r?e.markSeen(t):e.markUnseen(t)}yield(0,u.removeActiveMessageRange)(e.chatId,e.action)}}))).apply(this,arguments)}},62290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processPollUpdateMsgsOnline=function(e){return(0,i.processPollUpdateMsgs)(e,r.upsertVotesModelCollection)};var r=n(217806),i=n(390641)},217806:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.upsertVotesModelCollection=function(e){const t=(0,r.maxPerGroup)(e,(e=>e.senderTimestampMs),i.getVoteKey),n=[],l=[];for(const e of t){const t=s.PollVoteCollection.getForParent(e.parentMsgKey).getVoteFromSender(e.sender);null!=t&&(t.senderTimestampMs>e.senderTimestampMs||t.msgKey.equals(e.msgKey))||(null!=t&&n.push(t),(0,a.isUnvote)(e)||l.push(new o.PollVote({id:`!!${e.msgKey.toString()}`,msgKey:e.msgKey,parentMsgKey:e.parentMsgKey,selectedOptionLocalIds:e.selectedOptionLocalIds,senderTimestampMs:e.senderTimestampMs,sender:e.sender})))}l.length>0&&s.PollVoteCollection.add(l);n.length>0&&s.PollVoteCollection.remove(n)};var r=n(634114),i=n(887426),a=n(962959),o=n(988258),s=n(90585)},355662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,a,o,s,l){const c=function(e,t,n,r,i){const a={},o={};let s,l,c,u=n.length,d=i;if(0===u)return{msgs:t,collection:d};for(s=0;s<u;s++)l=n[s],o[l.id]=l;for(u=t.length,s=0;s<u;s++)l=t[s],l&&(a[l.id]=l);const p=[];for(u=e.length,s=0;s<u;s++)if(l=e[s],l&&(c=a[l.id],c&&p.push(c),c=o[l.id],c))if(c.recvFresh)p.push(c),r.removeMsg(c),c.unset("recvFresh");else{const e=r.getAllCMCs().find((function(e){return e.get(c.id)}));i&&e===i||(e?(e.forEach((function(e){p.push(e),delete o[e.id]})),e===r.msgs?(r.replaceMsgsCollection(i),d=r.msgs):(r.notifyMsgCollectionMerge(i,e,i),r.removeMsgsCollection(e))):(__LOG__(3)`models:Msg:reorder trying to merge CMC of orphaned message ${l.id}`,p.push(o[l.id])))}return{msgs:p,collection:d}}(e,t,n,i,o);r.addRecordsToChat(c.msgs,i,a,c.collection,s,l)};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(554676));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}},864452:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){const w=[],N=[],L=[],D=n(559871).MsgCollection,k=n(669951).ChatCollection;let U=0;t.forEach((function(t){var G;t.id instanceof y.default||(U++,t.id=new y.default({from:t.from,to:t.to,id:t.id,participant:t.participant,selfDir:t.self})),(0,s.isString)(e)&&T.default.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<l.ACK.CLOCK&&(t.ack=l.ACK.CLOCK),null!=t.hydratedButtons&&((G=t).buttons=new I.TemplateButtonCollection,G.buttons.add(G.hydratedButtons.map(((e,t)=>{var n,r;const i=`${null!=e.index?e.index:t}`;return e.quickReplyButton?new M.default({id:i,displayText:e.quickReplyButton.displayText,selectionId:e.quickReplyButton.id,subtype:"quick_reply"}):e.callButton?new M.default({id:i,displayText:e.callButton.displayText,phoneNumber:e.callButton.phoneNumber,subtype:"call"}):new M.default({id:i,displayText:null===(n=e.urlButton)||void 0===n?void 0:n.displayText,url:null===(r=e.urlButton)||void 0===r?void 0:r.url,subtype:"url"})})))),null!=t.dynamicReplyButtons&&function(e){e.replyButtons=new b.ButtonCollection,e.replyButtons.add(e.dynamicReplyButtons.map((e=>{let{buttonId:t,buttonText:n}=e;return new A.default({id:t,displayText:null==n?void 0:n.displayText})})))}(t);let x=D.get(t.id);if(t.type===S.MSG_TYPE.PROTOCOL&&"ephemeral_setting"!==t.subtype&&"share_phone_number"!==t.subtype)switch(t.subtype){case"admin_revoke":if(x=D.get(t.protocolMessageKey),x)if(x.isGroupMsg)if(T.default.equals(x.id.remote,t.id.remote)){__LOG__(2)`getMsgUpdates: admin revoked ${x.id.toString()}`;const e=new P.Msg(t);if((0,g.adminRevokeReceiverEnabled)()){const t=(0,o.default)(x.chat.groupMetadata,"m.chat.groupMetadata"),n=t.participants.get(e.sender);if(!n||!n.isAdmin){if(t.participants.add({id:e.sender,isAdmin:!0},{merge:!0}),!n){const t={actionType:f.GROUP_ACTIONS.ADD,participants:[e.sender],isLinkedGroupJoin:!1,isInvite:!1},n=(0,p.genGroupNotificationMsg)({author:void 0,chatId:x.chat.id,ts:e.t},t);(0,m.handleSingleMsgMD)(n.from,n)}(0,d.markGroupParticipantStale)({group:x.chat.id})}}(0,v.revoke)(x,{msgKey:e.id,subtype:e.subtype,sender:e.sender,revokeTimestamp:e.t})}else __LOG__(2)`getMsgUpdates: ${x.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke came for the different group than the original message was in`;else __LOG__(2)`getMsgUpdates: ${x.id.toString()} has not been revoked`,__LOG__(4,void 0,new Error)`getMsgUpdates: admin revoke was sent to a non-group chat`;break;case"sender_revoke":if(x=D.get(t.protocolMessageKey),x){const r=new P.Msg(t);T.default.equals(x.sender,r.sender)?(__LOG__(2)`getMsgUpdates: sender revoked ${x.id.toString()}`,T.default.isStatusV3(e)&&x.msgChunk&&x.msgChunk.remove(x),(0,v.revoke)(x,{msgKey:r.id,subtype:r.subtype,sender:r.sender,revokeTimestamp:r.t}),T.default.isStatusV3(e)&&n(459387).StatusV3Collection.find(x.sender).then((e=>{var t,n;if(_.LegacyPhoneFeatures.supportsFeature(_.LegacyPhoneFeatures.F.QUERY_STATUS_V_3_THUMBNAIL)&&(null===(t=x)||void 0===t||null===(n=t.msgChunk)||void 0===n?void 0:n.length)!==e.totalCount){if((0,c.isMDBackend)())throw new Error("Webd.statusQueryThumbnail is only supported in non-MD mode");C.default.statusQueryThumbnail(e.id)}}))):__LOG__(3)`getMsgUpdates: sender revoke: sender mismatch: ${r.id.toString()} <> ${x.id.toString()}`}break;case"ephemeral_sync_response":const r=k.get(t.id.remote);r&&(0,h.default)(r,t.ephemeralDuration,t.ephemeralSettingTimestamp);break;default:__LOG__(2)`unknown protocolMessage ${t.id.toString()}`}else if(x&&!x.asRevoked){t.ack<x.ack&&delete t.ack;for(const e in t)t.hasOwnProperty(e)&&void 0===t[e]&&delete t[e];t.id.fromMe&&!x.deprecatedMms3Url&&t.deprecatedMms3Url&&(t.phoneUploading=!1),r.isHistory&&(t.isNewMsg=!1);const e=x.t?(0,a.default)(t,["t","id","from","to"]):t,n=x.applyUpdate(e).then((()=>x));if(L.push(n),T.default.isBroadcast(x.id.remote)){const t=O.getBroadcastFanoutKeys(x);t&&t.forEach((t=>{const n=D.get(t);n&&L.push(n.applyUpdate(e).then((()=>x)))}))}r.isHistory&&(x.recvFresh||i)&&!x.search?(__LOG__(3)`model:Msg:handle:processMM:${x.recvFresh?"dup:":"overlap:"}${String(x.id)}`,N.push(x)):r.isHistory&&x.search?(x.search=!1,__LOG__(3)`model:Msg:handle:processMM load search as history ${String(x.id)}`,w.push({id:x.id})):"search"===r.add&&w.push({id:x.id})}else{"payment_action_request_declined"===t.subtype||"payment_transaction_request_cancelled"===t.subtype?L.push((0,E.cancelOrDeclinePaymentRequest)(t)):t.type===S.MSG_TYPE.PAYMENT&&"send"===t.subtype&&L.push((0,E.fulfillPaymentRequest)(t)),O.typeIsMms(t)&&!t.deprecatedMms3Url&&(t.phoneUploading=t.id.fromMe&&t.ack===l.ACK.CLOCK);const e=k.get(t.id.remote);"search"===r.add&&(t.search=!0),(0,u.isUnreadTypeMsg)(t)&&t.id.fromMe&&t.ack===l.ACK.CLOCK&&(t.isSendFailure=!0),r.update||w.push(t),!r.isHistory&&"search"!==r.add&&e&&L.push(function(){return R.apply(this,arguments)}(t,e)),t.ephemeralOutOfSync&&__LOG__(2)`ephemeralOutOfSync msgId=${t.id.toString()} chatId=${null==e?void 0:e.id.toString()}`}})),U>0&&__LOG__(2)`_processMultipleMessages: el.id is not a MsgKey: ${U} of ${t.length} messages`;return{filteredRecs:w,reorderRecs:N,updates:L}};var i=r(n(348926)),a=r(n(957557)),o=r(n(145095)),s=n(551737),l=n(535470),c=n(88555),u=n(237540),d=n(571059),p=n(677345),f=n(795720),_=n(438184),h=r(n(986505)),g=n(408139),m=n(707122),y=r(n(465212)),S=n(115461),E=n(100629),v=n(318457),T=r(n(389867)),C=r(n(656891)),A=r(n(315871)),b=n(47688),P=n(17304),O=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(554676)),M=r(n(311897)),I=n(682988);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(w=function(e){return e?n:t})(e)}function R(){return(R=(0,i.default)((function*(e,t){if(!e.isNewMsg||!e.recvFresh)return __LOG__(3,void 0,void 0,!0)`processLiveMessage should not be called with history message id ${e.id.toString()}`,SEND_LOGS("bad-process-live-message-call"),Promise.resolve();if(e.type===S.MSG_TYPE.GP2&&"delete"===e.subtype&&(t.isReadOnly=!0),t.isUser){var n;const a=null!==(n=e.ephemeralDuration)&&void 0!==n?n:0;let o,s=!1;e.type===S.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===e.subtype?o=e.t:e.ephemeralSettingTimestamp&&(o=e.ephemeralSettingTimestamp,s=!0);let l=!1;if(null!=o&&(l=yield(0,h.default)(t,a,o,s)),(0,c.isMDBackend)()&&!(0,u.isNotificationType)(e.type,e.subtype)){var r,i;const n=null!==(r=e.ephemeralDuration)&&void 0!==r?r:0,a=null!==(i=t.getEphemeralSetting())&&void 0!==i?i:0;e.ephemeralOutOfSync=n!==a&&!l}}}))).apply(this,arguments)}},649891:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncPrivacyDisallowedLists=s,t.syncSinglePrivacyDisallowedList=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(809540),o=n(861319);function s(){return l.apply(this,arguments)}function l(){return(l=(0,i.default)((function*(e){const t=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){return{type:e,response:yield(0,a.queryPrivacyDisallowedList)(e)}}));return function(){return e.apply(this,arguments)}}())),n=[];return t.forEach((e=>{const{status:t,users:r,dhash:i}=e.response;"mismatch"===t&&null!=r&&null!=i&&n.push({id:e.type,disallowedList:r.map((e=>e.toString())),dhash:i})})),yield(0,o.getTable)().bulkCreateOrReplace(n),n}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){yield s([e])}))).apply(this,arguments)}},859557:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleOfflineNotifications=function(e){},t.subscribePushManager=function(){return a.apply(this,arguments)},t.unsubscribePushManager=function(){return o.apply(this,arguments)};var i=r(n(348926));n(615688),n(257243),n(268539),n(860334);function a(){return(a=(0,i.default)((function*(){}))).apply(this,arguments)}function o(){return(o=(0,i.default)((function*(){return!1}))).apply(this,arguments)}},438914:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setArchiveClassicSetting=function(e){if((0,l.isLegacyWebdBackend)())return m(e);return __LOG__(4,void 0,new Error)`Settings:setArchiveClassicSetting is not supported on MD Companion device.`,Promise.resolve()},t.setArchiveEnabledSetting=function(e){if((0,l.isLegacyWebdBackend)())return __LOG__(2)`Settings:setArchiveEnabledSetting value to ${e}`,void(_.default.archive.enabled!==e&&(_.default.archive=(0,a.default)((0,a.default)({},_.default.archive),{},{enabled:e})));__LOG__(4,void 0,new Error)`Settings:setArchiveEnabledSetting is not supported on MD Companion device.`};var i=r(n(348926)),a=r(n(81109)),o=n(450796),s=n(492574),l=n(88555),c=n(694816),u=r(n(656891)),d=r(n(914296)),p=r(n(11339)),f=n(446331),_=r(n(268132)),h=n(548360),g=n(785893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,f.genId)();__LOG__(2)`Settings:setArchiveClassicSetting value to ${e}`;const n=u.default.setArchiveSetting(e).then((e=>{if(e.status&&200!==e.status)throw new s.ServerStatusCodeError(e.status)})),r=new f.ActionType(h.fbt._("Changing archive setting",null,{hk:"4s5LmI"})),i=Boolean(_.default.archive.classic),l=n.then((()=>{__LOG__(2)`Settings:setArchiveClassicSetting:success value sucessfully set to ${e}`;const n=e?h.fbt._("Archived chats will unarchive when you receive a new message.",null,{hk:"2VniT0"}):h.fbt._("Archived chats will remain archived when you receive a new message.",null,{hk:"4C3WnP"});return new f.ActionType(n,{actionText:d.default.t(126),actionHandler:()=>m(i,t)})})).catch((0,o.filteredCatch)(s.ServerStatusCodeError,(e=>{if(__LOG__(3)`models:settings:setArchiveClassicSetting failed with server error`,e.status>=400)return new f.ActionType(h.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}))}))).catch((()=>{throw __LOG__(3)`models:settings:setArchiveClassicSetting dropped`,new f.ActionType(h.fbt._("Couldn't change archive setting.",null,{hk:"qovF4"}),{actionText:d.default.t(122),actionHandler:()=>m(e,t)})}));c.ToastManager.open((0,g.jsx)(f.ActionToast,{id:t,initialAction:r,pendingAction:l})),yield n,_.default.archive.classic!==e&&(new p.default.ArchiveSettings({keepChatsArchived:e}).commit(),_.default.archive=(0,a.default)((0,a.default)({},_.default.archive),{},{classic:e}))}))).apply(this,arguments)}},279628:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFirstPartyStickerPack=function(){return S.apply(this,arguments)},t.fetchFirstPartyStickerPacks=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),o=r(n(506631)),s=r(n(177853)),l=r(n(376139)),c=n(978820),u=r(n(914296)),d=n(92059),p=r(n(11339));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}const _="https://static.whatsapp.net/sticker";function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const n=l.default.build(_,e),r=yield(0,o.default)(n,{signal:t.signal}),i=new p.default.StickerCommonQueryToStaticServer;if(i.set({httpResponseCode:r.status,params:new s.default(e).toString(),queryType:p.default.QUERY_TYPE.STICKER_PACK_DATA}),i.commit(),!r.ok)throw new a.InvalidServerResponseError(n,r.status.toString(),"Invalid response from WhatsApp stickers endpoint");const c=yield r.json();if(null==c||0===c.length)throw new a.InvalidServerResponseError(n,r.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(c)}`);return c}))).apply(this,arguments)}function m(e,t){const n={id:e["sticker-pack-id"],name:e.name,publisher:e.publisher,description:e.description,fileSize:Number(e["file-size"]),imageDataHash:e["image-data-hash"],animated:1===e.animated,previewImageIds:e["preview-image-ids"],trayImageId:e["tray-image-id"],trayImagePreview:e["tray-image-preview"]};return null!=t&&(n.index=t),n}function y(){return(y=(0,i.default)((function*(e){var t;const n=u.default.getLocale(),r=(0,d.getCountryShortcodeByPhone)(null===(t=(0,c.getMaybeMeUser)())||void 0===t?void 0:t.user)||"default";return(yield h({cat:"sticker_store_data",id:"all",lg:n,country:r},{signal:e.signal})).map(((e,t)=>m(e,t)))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){const t=u.default.getLocale(),n={cat:"sticker_pack_data",id:e.id,lg:t};return m((yield h(n,{signal:e.signal}))[0])}))).apply(this,arguments)}},973336:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchFirstPartyStickers=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=d(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),o=r(n(506631)),s=r(n(177853)),l=r(n(376139)),c=r(n(914296)),u=r(n(11339));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(d=function(e){return e?n:t})(e)}const p="https://static.whatsapp.net/sticker";function f(){return(f=(0,i.default)((function*(e,t){const n={cat:"sticker_pack_data",id:e,lg:c.default.getLocale()},r=l.default.build(p,n),i=yield(0,o.default)(r,{signal:null==t?void 0:t.signal}),d=new u.default.StickerCommonQueryToStaticServer;if(d.set({httpResponseCode:i.status,params:new s.default(n).toString(),queryType:u.default.QUERY_TYPE.STICKER_PACK_DATA}),d.commit(),!i.ok)throw new a.InvalidServerResponseError(r,i.status.toString(),"Invalid response from WhatsApp stickers endpoint");const f=yield i.json();if(null==f||0===f.length)throw new a.InvalidServerResponseError(r,i.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(f)}`);return f[0].stickers.map(((e,t)=>({mimetype:e.mimetype,width:e.width,height:e.height,index:t,filehash:e["file-hash"],directPath:e["direct-path"],mediaKey:e["media-key"],id:e["file-hash"],deprecatedMms3Url:e.url,encFilehash:e["enc-file-hash"],mediaKeyTimestamp:0})))}))).apply(this,arguments)}},900769:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.searchFirstPartyStickers=function(){return g.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),s=r(n(506631)),l=r(n(177853)),c=r(n(376139)),u=n(978820),d=n(92059),p=r(n(11339)),f=n(689867);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const h="https://static.whatsapp.net/sticker";function g(){return(g=(0,a.default)((function*(e,t){var n;const r=(0,d.getCountryShortcodeByPhone)(null===(n=(0,u.getMaybeMeUser)())||void 0===n?void 0:n.user)||"default";let a=0,_=0;for(;a<=250;)a+=3+encodeURIComponent(e[_++]).length;const g=e.slice(0,_-1).join(","),m={country:r},y=c.default.build(h,(0,i.default)({cat:"sticker_search",terms:g},m)),S=yield(0,s.default)(y,{signal:null==t?void 0:t.signal}),E=new p.default.StickerCommonQueryToStaticServer;if(E.set({httpResponseCode:S.status,params:new l.default(m).toString(),queryType:p.default.QUERY_TYPE.STICKER_SEARCH}),E.commit(),!S.ok)throw new o.InvalidServerResponseError(y,S.status.toString(),"Invalid response from WhatsApp stickers endpoint");const v=yield S.json();if(null==v)throw new o.InvalidServerResponseError(y,S.status.toString(),`Invalid response from WhatsApp stickers endpoint: ${JSON.stringify(v)}`);return v.map(((e,t)=>new f.StickerModel({mimetype:e.mimetype,width:e.width,height:e.height,filehash:e["file-hash"],directPath:e["direct-path"],mediaKey:e["media-key"],id:e["file-hash"],encFilehash:e["enc-file-hash"],mediaKeyTimestamp:0,index:t})))}))).apply(this,arguments)}},383674:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceipt=function(e){return(0,r.prepareRetryReceiptBridge)(e)},t.queryCall=function(e,t){return(0,r.sendQueryCallBridge)(e,t)},t.sendCallEnd=function(e,t){return(0,r.sendCallEndBridge)(e,t)},t.sendCallOffer=function(e){return(0,r.sendCallOfferBridge)(e)},t.sendCallSignalingMsg=function(e,t){return(0,r.sendCallSignalingMsgBridge)(e,t)},t.sendEncRekey=function(e){return(0,r.sendEncRekeyBridge)(e)};var r=n(270308)},997335:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,s,l){if(__LOG__(2)`voip:handleIncomingCallOfferNotice: callId ${t}`,r.Clock.globalUnixTime()-n>45)return void __LOG__(2)`voip:handleIncomingCallOfferNotice: Ignoring stale offer_notice`;o.CallCollection.add({id:t,isVideo:s,isGroup:l,offerTime:n,canHandleLocally:!1,peerJid:e},{merge:!0}),i.Cmd.alertCall((0,a.toUserWid)(e),t,s,l,!1),setTimeout((()=>{i.Cmd.cancelCall(e);const n=o.CallCollection.get(t);n&&o.CallCollection.remove(n)}),45e3)};var r=n(40234),i=n(781572),a=n(745454),o=n(160868)},61014:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleIncomingCallOffer=function(e,t){if(p.CallCollection.processIncomingCall(e.call_id,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:e.isVideoCall?(0,u.isVideoCallEnabled)():(0,u.isVoiceCallEnabled)(),offerTime:e.t}),!function(e){return e?(0,u.isVideoCallEnabled)():(0,u.isVoiceCallEnabled)()}(e.isVideoCall))return void c.Voip.handleIncomingSignalingMessage(e,t);const n=e.call_id;p.CallCollection.pendingOffers[n]=new a.Resolvable,p.CallCollection.pendingOffers[n].resolve(Promise.all([(0,o.default)(e,t),c.Voip.getNumParticipantsFromCallOffer(t)]).then((r=>{let[{result:i,retryCount:a},o]=r,l=!0;switch(o>0&&(__LOG__(4,void 0,new Error)`voip:incoming: Ignoring call offer since group calling is disabled`,l=!1),l=e.isVideoCall?l&&(0,u.isVideoCallEnabled)():l&&(0,u.isVoiceCallEnabled)(),i){case s.E2EProcessResult.SUCCESS:!function(e,t,n){const r=e.call_id;p.CallCollection.processIncomingCall(r,e.peer_jid,{isVideo:e.isVideoCall,canHandleLocally:null!=n&&n,offerTime:e.t}),!1===n&&p.CallCollection.cleanupPendingOffer(r);c.Voip.handleIncomingSignalingMessage(e,t)}(e,t,l);break;case s.E2EProcessResult.RETRY:__LOG__(2)`voip:handleIncomingCallOffer reject call because of enc retry`,function(){f.apply(this,arguments)}(e,a);break;case s.E2EProcessResult.PARSE_ERROR:__LOG__(2)`voip:handleIncomingCallOffer ending call because of enc parse error`,c.Voip.endCall(n);break;default:throw new Error("invalid e2e result type")}})).finally((()=>{delete p.CallCollection.pendingOffers[n]})))},t.handleIncomingEncRekey=function(e,t){c.Voip.handleIncomingSignalingMessage(e,t)},t.handleIncomingSignalingMsg=function(e,t){c.Voip.handleIncomingSignalingMessage(e,t)};var i=r(n(348926)),a=n(88156),o=r(n(437880)),s=n(49714),l=n(640623),c=n(84356),u=n(669594),d=n(445473),p=n(160868);function f(){return(f=(0,i.default)((function*(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=yield l.waSignalStore.getRegistrationInfo();if(!i)throw Error("No registration info found");const{registrationId:a}=i,o=r+1;c.Voip.rejectCallWithoutCallCtx(e.call_id,null===(t=e.peer_jid)||void 0===t?void 0:t.toString({legacy:!0}),null===(n=e.call_creator)||void 0===n?void 0:n.toString({legacy:!0}),d.ENC_RETRY_RECEIPT_ATTRS.SINGLE_PARTICIPANT,o,a),5===o&&(__LOG__(2)`voip:rejectCallWithReasonEnc max retry reached, uploading fieldstats`,c.Voip.processMissedIncomingCallMaxRetry(e))}))).apply(this,arguments)}},708154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.frontendFireAndForget=function(e,t){((e,t,r)=>{if(!n)throw new Error("fireAndForget called before setApi!");n.fireAndForget(e,t,r)})("event",e,t)},t.frontendSendAndReceive=function(e,t){return((e,t,r)=>{if(!n)return Promise.reject(new Error("sendAndReceive called before setApi!"));return n.sendAndReceive(e,t,r)})("event",e,t)},t.setApi=function(e){n=e};let n=null},554003:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logoutAfterValidationFail=function(){new a.ShiftTimer((()=>{g()})).onOrAfter(1e3)},t.resetCompanionReg=function(){f=!1,_=!1},t.startInitialHistorySyncTimeout=function(){null==y&&(y=setTimeout(h,18e4),o.Cmd.on("on_initial_chat_synced",(()=>{clearTimeout(y)})))},t.startLogin=function(){if(f||_)return;(0,u.setDeviceLinkPairStage)(d.default.MD_LINK_DEVICE_COMPANION_STAGE.FIRST_CONNECT),f=!0,(0,l.clearADVSecretKey)(),(0,c.setIsConnectedAsRegistered)(!0),n(252771).restartBackend()},t.startLogout=g;var i=r(n(348926)),a=n(657319),o=n(781572),s=n(788950),l=n(946308),c=n(909530),u=n(991214),d=r(n(11339)),p=n(765044);let f=!1,_=!1;function h(){__LOG__(4,void 0,new Error)`logout due to initial history sync timeout`,p.Socket.logout(!1,s.LogoutReason.HistorySyncTimeout)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){f||_||(_=!0,yield p.Socket.clearCredentialsAndStoredData(),(0,l.clearADVSecretKey)(),n(252771).restartBackend())}))).apply(this,arguments)}let y},252771:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.restartBackend=function(){(0,a.stopComms)(),ee()},t.startBackend=ee;var i=r(n(348926)),a=(n(615688),n(108584),n(736184)),o=n(772651),s=n(638284),l=n(439277),c=n(257243),u=n(464358),d=n(95060),p=n(246007),f=n(931219),_=n(75396),h=n(738815),g=n(217869),m=n(781572),y=n(209635),S=r(n(532473)),E=n(312779),v=n(624256),T=n(438184),C=n(854602),A=n(788950),b=n(888904),P=n(203292),O=(r(n(506631)),n(38892)),M=n(276816),I=r(n(595023)),w=n(81245),R=n(757936),N=n(536037),L=(n(826066),n(751288)),D=(r(n(376139)),n(978820)),k=n(711597),U=n(798972),G=n(640623),x=n(238804),B=r(n(169048)),F=n(92059),j=n(991214),Y=r(n(11339)),K=n(977959),W=n(546582),H=n(115578),V=n(634771),$=n(748694),z=n(964551),q=n(765044),J=n(776214),Q=n(736163),X=n(685417),Z=n(93771);function ee(){return te.apply(this,arguments)}function te(){return(te=(0,i.default)((function*(){if(!G.waSignalStore.getRegistrationInfo())return void __LOG__(2)`startBackendRegistered: chatd user not registered`;__LOG__(2)`[startBackend]: connected as ${(0,D.assertGetMe)()}`;try{yield(0,s.promiseTimeout)(Promise.all([(0,J.initialize)()]),2e4),yield(0,s.promiseTimeout)((0,X.initialize)(),2e4)}catch(e){m.Cmd.storageInitializationError()}(0,u.isABPropsAfterFirstSync)()&&(yield(0,c.updateABPropsFromStorage)());const e=yield(0,Z.getTable)().count(),t=yield G.waSignalStore.getServerHasPreKeys(),n=(0,y.getCommsConfig)({passive:e>0||!t,pull:!0});yield ie(),yield(0,a.startComms)(S.default,E.sendPing,n,(e=>Promise.resolve((0,o.inflate)(e)))),yield(0,a.waitForConnection)();{const n=[];e>0&&n.push((0,U.sendAndClearDanglingReceipts)()),t||((0,j.setDeviceLinkPairStage)(Y.default.MD_LINK_DEVICE_COMPANION_STAGE.UPLOAD_PREKEYS),n.push((0,L.uploadPreKeys)().catch((e=>{__LOG__(4,!0,new Error,!0)`error while uploading prekeys, ${e}`,SEND_LOGS("error while uploading prekeys"),(0,j.commitDeviceLinkEvent)(-1)})))),yield Promise.all(n),(0,j.setDeviceLinkPairStage)(Y.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE),(0,j.commitDeviceLinkEvent)(),yield(0,l.sendPassiveModeIq)("active")}V.PrimaryFeatures.initializeFromLocalStorage(),(0,u.isABPropsAfterFirstSync)()||(yield(0,d.syncABPropsTask)()),ne(),yield(0,x.initialize)(),$.PrimaryForceUpgrade.setup(),yield(0,g.initChatThreadLogging)(),yield(0,P.startWebPersistedJobManager)(),yield(0,a.startHandlingRequests)();const r=!I.default.isCriticalDataSynced();r?yield I.default.syncCriticalData():__LOG__(2)`[bootstrap] need to sync critical data: false`,yield v.DbEncKeyStore.waitForFinalDbMsgEncKey(),null==z.ServerProps.serverPropsVersion&&(yield(0,M.queryServerProps)()),(0,p.compareServerPropsAndABProps)(),re(),N.TosManager.run(),(0,O.startQPL)(),(0,b.upgradeToCommunity)(r),(0,H.initialize)()}))).apply(this,arguments)}function ne(){var e;const t=null===(e=(0,D.getMaybeMeUser)())||void 0===e?void 0:e.user;t&&K.Wam.set(Y.default.METRICS.getGlobal("psCountryCode"),(0,F.getCountryShortcodeByPhone)(t))}function re(){(0,h.applyContactBusinessProps)(),(0,Q.restoreLabels)(),(0,Q.restoreQuickReplies)(),(0,Q.restoreLabelAssociations)(),(0,Q.restoreCarts)(),(0,Q.restoreArchiveV2Settings)(),(0,Q.restoreAgents)().then(_.initializeAgentLog)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,i.default)((function*(){const e=n(555452),t=n(656891).default,{loadProtoVersions:r}=n(877113),i=e.getVersion(),a=(null==i?void 0:i.protoVersion)||[0,17];yield r(),T.LegacyPhoneFeatures.setVersion(a),t.setVersion(a,10,"EAEYASACKAEwAjgBQAFIAVgBYAFoAXgBmAEBoAEBqAEBsAECuAEBwAEByAEB0AEA2AEB4AEC8AED+AEDgAIDkAIDmAIAqAIDsAIAuAIDwAIB"),z.ServerProps.updateSelectiveProps({groupDescLength:512,multicastLimitGlobal:5,frequentlyForwardedMax:5,stickers:1})}))).apply(this,arguments)}m.Cmd.on("main_stream_mode_ready",(()=>{try{I.default.continueProgressiveHistorySyncProcessing(),B.default.startIndexer().catch((()=>{})),(0,W.requireStatusV3Collection)().then((e=>{e.sync()})),(0,R.registerTasks)(),(0,w.runSyncDirtyContactsJob)(),(0,Q.restoreRecentStickers)(),(0,Q.restoreFavoriteStickers)(),(0,f.scheduleAdvDeviceInfoCheck)()}catch(e){__LOG__(2)`debug setup failed:`}})),m.Cmd.on("storage_initialization_error",(0,i.default)((function*(){((0,k.isRegistered)()||(0,C.getPrevLogoutReasonCode)()!==A.LOGOUT_REASON_CODE.CLIENT_FATAL)&&(__LOG__(2)`storage initialization error, logging out`,yield q.Socket.clearCredentialsAndStoredData(A.LogoutReason.ClientFatalError),m.Cmd.logout())}))),T.LegacyPhoneFeatures.on(T.FEATURE_CHANGE_EVENT,(()=>{(0,Q.updateGKFeatures)()}))},595023:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(81109)),o=n(413959),s=n(836229),l=n(960362),c=n(892844),u=n(970467),d=n(781572),p=n(624256),f=n(788950),_=r(n(379264)),h=n(16292),g=n(56080),m=n(984598),y=n(550111),S=n(711597),E=n(440126),v=r(n(273407)),T=n(289751),C=n(388432),A=r(n(652991)),b=r(n(11339)),P=n(115772),O=n(765044),M=n(141037);const I=n(76672).Mirrored(["NotStarted","InProcess","Completed"]),w={initialChatHistory:!1,readReceipts:!1,syncdCritical:!1},R={initialChatHistoryTotalMsg:-1,initialChatHistoryTotalChats:-1};const N=new class{constructor(){this._criticalState={},this._debugOnlyState={},this._progressiveHistorySyncRemainingIteration=25,this._progressiveHistorySyncInFlight=!1,this._allCriticalDataSynced=!1,this._syncDCriticalDataTimeout=null,this.initState()}initState(){this._criticalState=(0,a.default)({},w),this._debugOnlyState=(0,a.default)({},R),this._syncDCriticalDataState=I.NotStarted,this._syncDNonCriticalDataState=I.NotStarted}_isCriticalSyncDoneThisSession(){for(const e in this._criticalState)if(!this._criticalState[e])return!1;return!0}_setSynced(e){__LOG__(2)`[bootstrap] completed sync for ${e}`,this._criticalState[e]=!0,this._isCriticalSyncDoneThisSession()&&(__LOG__(2)`[bootstrap] critical sync done`,(0,S.setAllCriticalDataSynced)(),d.Cmd.criticalSyncDone(),A.default.initOrUpdateTracking(b.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),this.syncNonCriticalData())}_syncContactsInChunks(e,t){return(0,i.default)((function*(){__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${e?t.length+1:0} chunks of contacts during the inital sync`,null!=e&&(yield(0,m.syncContactListJob)(Array.from(e),!1));for(let e=0;e<t.length;e++){const n=Array.from(t[e]);yield(0,o.delayMs)(2e4),yield(0,m.syncContactListJob)(n)}__LOG__(2,void 0,void 0,void 0,["contact-sync"])`inital contact sync completes`}))()}_syncDeviceList(e){if(null==e)return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`syncMostRecentDevices has no contact to sync during bootstrap`,Promise.resolve();__LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync ${e.size} contacts for device info during the initial sync`;const t=Array.from(e);return(0,y.syncDeviceListJob)(t,null,null).catch((e=>{__LOG__(4,!0,new Error,!0)`Sync device failed`,SEND_LOGS("Sync device failed: "+e)}))}setReadReceiptsSynced(){this._setSynced("readReceipts")}setInitialChatHistorySynced(){this._setSynced("initialChatHistory")}setSyncDCriticalSynced(){this._syncDCriticalDataState=I.Completed,this._criticalState.syncdCritical||this._setSynced("syncdCritical")}syncNonCriticalData(){let e=[];(0,g.queryAndUpdateAllGroupMetadata)(!0).then((()=>{e=(0,h.getAllContactsFromChatCollectionIntoChunks)(),this._syncDeviceList(e[0]),(0,h.getAndUpdateNonAddressBookContacts)()})).then((()=>{setTimeout(function(){this._syncContactsInChunks(e[0],e.slice(1,e.length))}.bind(this),4e4)})),(0,E.getAndUpdateStatus)(),(0,u.getAndUpdateProfilePicture)(),(0,u.updateBlocklist)(),this._syncDNonCriticalDataState=I.InProcess,(0,s.markCollectionsForSync)([l.CollectionName.Regular,l.CollectionName.RegularLow,l.CollectionName.RegularHigh]).then((()=>{this._syncDNonCriticalDataState=I.Completed}))}markInitialHistorySyncCountDebugStats(e,t){this._debugOnlyState={initialChatHistoryTotalMsg:e,initialChatHistoryTotalChats:t}}isSyncDCriticalDataSyncInProcess(){return this._syncDCriticalDataState===I.InProcess}isSyncDBootstrapInProcess(){return this._syncDCriticalDataState===I.InProcess||this._syncDNonCriticalDataState===I.InProcess}_initCriticalDataTimeoutIfNeeded(){var e=this;null==this._syncDCriticalDataTimeout&&(__LOG__(2)`[bootstrap] setting critical data syncd timeout (${180})`,this._syncDCriticalDataTimeout=setTimeout((0,i.default)((function*(){(yield e._isSyncDCriticalDataComplete())||(__LOG__(2)`[bootstrap] syncd critical data timeout exceeded, logging out`,yield(0,P.forceFlushAllWamBuffers)(),O.Socket.logout(!1,f.LogoutReason.SyncdTimeout)),(0,S.getInitialHistorySyncComplete)()||(__LOG__(2)`[bootstrap] history sync critical data timeout exceeded, logging out`,yield(0,P.forceFlushAllWamBuffers)(),O.Socket.logout(!1,f.LogoutReason.HistorySyncTimeout)),__LOG__(2)`[bootstrap] all critical data synced within timeout period`})),18e4))}_isSyncDCriticalDataComplete(){return(0,i.default)((function*(){const e=yield v.default.getSyncActionsRows(["action"],[l.Actions.SettingPushName]);return e.length>0&&null!=e.find((e=>e.actionState===l.SyncActionState.Success))}))()}setSyncDCriticalDataSyncCompleted(){var e=this;return(0,i.default)((function*(){null!=e._syncDCriticalDataTimeout&&(yield new b.default.MdBootstrapDataApplied({mdBootstrapPayloadType:b.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL,mdBootstrapSource:b.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield C.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,c.unixTimeMs)()}).commit(!0))}))()}getCriticialSyncDebugSummary(){return this.isCriticalDataSynced()?"-------\nAll critical data synced\n-------\n\n":`-------\n Initial history sync complete: ${(0,S.getHistorySyncStatus)()?"true":this._criticalState.initialChatHistory.toString()}\n Initial msgs: ${this._debugOnlyState.initialChatHistoryTotalMsg}, initial chats: ${this._debugOnlyState.initialChatHistoryTotalChats}\n Receipt sync complete: ${this._criticalState.readReceipts.toString()} \n Critical collection sync complete: ${this._criticalState.syncdCritical.toString()} \n-------\n`}isCriticalDataSynced(){return this._allCriticalDataSynced=this._allCriticalDataSynced||(0,S.getAllCriticalDataSynced)(),this._allCriticalDataSynced}syncCriticalData(){var e=this;return(0,i.default)((function*(){A.default.initOrUpdateTracking(b.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING),__LOG__(2)`[bootstrap] need to sync critical data: true`,__LOG__(2)`[bootstrap] ${e.getCriticialSyncDebugSummary()}`,__LOG__(2)`[bootstrap] syncing my device list`;const t=(0,y.syncMyDeviceListJob)(),n=(0,u.updatePrivacySettings)().then((()=>{e.setReadReceiptsSynced()})).catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync privacy settings ${e.stack}`,SEND_LOGS("failed to update privacy settings from privacy request to webd"),O.Socket.logout(!1,f.LogoutReason.AccountSyncError)}));(0,T.updateSyncdDisabledDueToFatalFlag)(!1),e._initCriticalDataTimeoutIfNeeded(),e._syncDCriticalDataState=I.InProcess;const r=t.then((()=>(0,s.markCollectionsForSync)([l.CollectionName.CriticalBlock,l.CollectionName.CriticalUnblockLow]))).then((0,i.default)((function*(){e._criticalState.syncdCritical||(yield e._isSyncDCriticalDataComplete())&&(e.setSyncDCriticalSynced(),yield e.setSyncDCriticalDataSyncCompleted())})));(0,S.getInitialHistorySyncComplete)()&&e.setInitialChatHistorySynced();const a=(0,u.updateDefaultDisappearingMode)().catch((e=>{__LOG__(4,!0,new Error,!0)`failed to sync default disappearing mode ${e.stack}`,SEND_LOGS("failed initial sync of default disappearing mode")}));yield Promise.all([n,r,a])}))()}continueProgressiveHistorySyncProcessing(){__LOG__(2)`[history sync] continueProgressiveHistorySyncProcessing`;const e="Safari"!==_.default.info().name;this._initNextProgressiveHistorySyncRunLoop(e)}_progressiveHistorySyncRun(){var e=this;return(0,i.default)((function*(){if(!e._allCriticalDataSynced&&!0!==e._criticalState.initialChatHistory)return __LOG__(2)`[history sync] Skip processLoop, until initial sync is complete`,void e._progressiveHistorySyncRemainingIteration++;if(!d.Cmd.isMainStreamReadyMd)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Skip processLoop, until main is loaded`,void e._progressiveHistorySyncRemainingIteration++;const t=yield(0,M.fetchNextHitorySyncChunkForProcessing)();if(!t)return;__LOG__(2)`[history sync] processLoop picked up chunk`,e._progressiveHistorySyncRemainingIteration++;const r=n(819655).handleHistorySyncChunk;yield r(t)}))()}_initNextProgressiveHistorySyncRunLoop(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,i.default)((function*(){if(t&&e._progressiveHistorySyncRemainingIteration++,!e._progressiveHistorySyncInFlight&&e._progressiveHistorySyncRemainingIteration>0){e._progressiveHistorySyncRemainingIteration--,e._progressiveHistorySyncInFlight=!0;try{yield p.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield e._progressiveHistorySyncRun()}catch(e){__LOG__(4,void 0,new Error)`[History sync] _progressiveHistorySyncRun failed with ${null==e?void 0:e.message}, stack: ${null==e?void 0:e.stack}`}e._progressiveHistorySyncInFlight=!1,yield new Promise((e=>setTimeout(e,2e4))),e._initNextProgressiveHistorySyncRunLoop()}}))()}};d.Cmd.on("on_initial_chat_synced",(()=>{N.setInitialChatHistorySynced()})),d.Cmd.on("logout",(()=>{N.initState()}));var L=N;t.default=L},22469:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.toCoreAckTemplate=function(e){const t=(0,a.extractJidFromJidWithType)((0,o.widToJidWithType)(e.from)),n=null==e.participant?null:(0,o.widToDeviceJid)(e.participant);return(0,i.default)((0,i.default)({},e),{},{from:t,participant:n})};var i=r(n(81109)),a=n(272441),o=n(79196)},209635:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getCommsConfig=function(e){const t=e||{passive:!1,pull:!1};return{openChatSocket:e=>(0,s.default)(t).then((n=>(e(),t.passive=!1,n))),healthCheckInterval:15,deadSocketTime:2e4,maxSocketLoopWaitTime:9e5,shouldCloseStaleSocket:!0,shouldBlockReceivingUntilSuccess:!0,handlers:{onConnect:()=>{(0,o.isRegistered)()&&(i.Cmd.setSocketState(l.SOCKET_STATE.CONNECTED),i.Cmd.openSocketStream())},onDisconnect:()=>{i.Cmd.socketStreamDisconnected()},onSocketOpen:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.PAIRING)},onSocketLoopIteration:()=>{i.Cmd.setSocketState(l.SOCKET_STATE.OPENING)},onConnectionChange:()=>{},onOptimisticConnectionChange:()=>{},onCastStanza:()=>{},onHandleAck:e=>{(0,a.default)(e)},onHandleStanza:()=>{},onSendIq:()=>{}}}};var i=n(781572),a=r(n(406170)),o=(n(914597),n(711597)),s=r(n(185726)),l=n(662583);n(785893)},532473:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return W.apply(this,arguments)};var i=r(n(348926)),a=n(944396),o=n(252230),s=n(634308),l=n(831914),c=n(145823),u=n(440126),d=n(896429),p=r(n(683558)),f=r(n(569277)),_=n(927514),h=r(n(781367)),g=n(58626),m=r(n(364054)),y=n(492419),S=n(546462),E=r(n(686741)),v=r(n(470605)),T=r(n(617234)),C=r(n(270569)),A=n(528237),b=r(n(450404)),P=r(n(458645)),O=r(n(227258)),M=r(n(465347)),I=r(n(846007)),w=r(n(826445)),R=n(802276),N=r(n(788388)),L=n(779711),D=n(856545),k=n(725773),U=r(n(687183)),G=r(n(795681)),x=n(102634),B=n(583490),F=r(n(71419)),j=r(n(698539));function Y(){return K.apply(this,arguments)}function K(){return(K=(0,i.default)((function*(e,t,n){const{attrs:r}=e;if(r.offline){const e=parseInt(r.t,10);A.OfflineMessageHandler.newOfflineStanza(e,n)}switch(e.tag){case"iq":return H(e);case"receipt":try{return V(e)?yield(0,B.handleCallReceipt)(e):"retry"===r.type?yield(0,L.handleMessageRetryRequest)(e):"enc_rekey_retry"===r.type?yield(0,F.default)(e):yield(0,T.default)(e)}catch(e){if(e instanceof s.XmppParsingFailure)return(0,l.wap)("ack",{class:"receipt",id:r.id,to:r.from||l.DROP_ATTR,type:r.type||l.DROP_ATTR,error:"487"});throw e}case"notification":try{switch(r.type){case"server_sync":return yield(0,k.handleServerSyncNotification)(e);case"w:gp2":return yield(0,y.handleGroupNotification)(e);case"picture":return yield(0,R.handleProfilePicNotificationJob)(e);case"business":return yield(0,d.handleBusinessNotificationJob)(e);case"contacts":return yield(0,f.default)(e);case"devices":return yield(0,_.handleDevicesNotification)(e);case"disappearing_mode":return yield(0,g.handleDisappearingModeNotificationJob)(e);case"mediaretry":return yield(0,v.default)(e);case"encrypt":{const n=e.content;if(!Array.isArray(n)||!n.length)break;switch(n[0].tag){case"count":return yield(0,M.default)(e,t);case"identity":return yield(0,S.handleE2eIdentityChange)(e);case"digest":return yield(0,h.default)(e)}break}case"server":return yield(0,D.handleServerNotification)(e);case"status":return yield(0,c.handleAboutNotification)(e);case"account_sync":return yield(0,u.handleAccountSyncNotification)(e);case"pay":return yield(0,O.default)(e);case"psa":return null!=r.from&&r.from.toString()===o.PSA_JID?yield(0,j.default)(e):yield(0,N.default)(e);case"privacy_token":return yield(0,w.default)(e)}}catch(e){if(e instanceof s.XmppParsingFailure)return(0,l.wap)("ack",{class:"notification",id:r.id,type:r.type||l.DROP_ATTR,error:"487"});throw e}if(__LOG__(3)`Comms.handleStanza unrecognized notification stanza ${e.toString()}`,r.hasOwnProperty("id"))return(0,l.wap)("ack",{class:"notification",id:r.id,type:r.type||l.DROP_ATTR,error:"487"});break;case"chatstate":return(0,p.default)(e);case"presence":return(0,I.default)(e);case"message":try{return yield(0,C.default)(e)}catch(e){if(e instanceof s.XmppParsingFailure)return(0,l.wap)("ack",{class:"message",id:r.id,to:r.from,type:r.type||l.DROP_ATTR,error:"487"});throw e}case"ib":return(0,E.default)(e);case"stream:error":return(0,U.default)(e);case"failure":return(0,m.default)(e);case"success":return(0,G.default)(e);case"call":return(0,x.handleCall)(e);case"error":return(0,a.handleError)(e)}__LOG__(3)`Comms.handleStanza unrecognized stanza ${e.toString()}`}))).apply(this,arguments)}function W(){return(W=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=yield Promise.resolve(Y(e,t,n));return null==r?"NO_ACK":r}))).apply(this,arguments)}function H(e){const{attrs:t,content:n}=e;if("urn:xmpp:ping"===t.xmlns)return(0,l.wap)("iq",{type:"result",to:t.from});if("md"!==t.xmlns)throw new Error(`handleIq unrecognized ${e.toString()}`);if(!Array.isArray(n)||!n.length)return;switch(n[0].tag){case"pair-device":return(0,b.default)(e);case"pair-success":return(0,P.default)(e)}}function V(e){if(Array.isArray(e.content)&&e.content.length>0){const t=e.content[0].tag;return"offer"===t||"accept"===t||"reject"===t}return!1}},406170:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{id:t,from:n,t:r}=e.attrs;"message"===e.attrs.class&&function(){d.apply(this,arguments)}(String(t),(0,c.createWid)(String(n)),parseInt(r,10))};var i=r(n(348926)),a=n(257123),o=n(861948),s=r(n(465212)),l=n(115461),c=n(745454),u=n(290981);function d(){return(d=(0,i.default)((function*(e,t,n){const r=new s.default({fromMe:!0,remote:t,id:e}),i=String(r);try{const e=yield(0,u.getTable)().get(i);if((null==e?void 0:e.type)===l.MSG_TYPE.REACTION)return;const r=o.MessagePropertyType.cast(null==e?void 0:e.messageRangeIndex.split("_")[1]);(0,u.getTable)().merge(i,{messageRangeIndex:(0,o.craftMessageRangeIndex)(t.toString(),!1,r===o.MessagePropertyType.SystemMessage,n)})}catch(e){throw __LOG__(4,!0,new Error,!0)`processAckForOutgoingMessage: failed to update in storage`,SEND_LOGS("message processAckForOutgoingMessage failed"),e}(0,a.checkAndRemoveActiveMessageRanges)(r,n)}))).apply(this,arguments)}},312779:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockSendPing=function(){return c.apply(this,arguments)},t.sendPing=function(){const e=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,s.generateId)()},(0,s.wap)("ping",null));(0,a.sendPing)(e,l).then((e=>{(null==e?void 0:e.success)&&u(e.result)}))};var i=r(n(348926)),a=n(736184),o=n(892844),s=n(831914);const l=new(n(471914).WapParser)("ping",(e=>e.attrTime("t")));function c(){return(c=(0,i.default)((function*(){const e=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:p",type:"get",id:(0,s.generateId)()},(0,s.wap)("ping",null)),t=yield(0,a.sendPing)(e,l);(null==t?void 0:t.success)&&u(t.result)}))).apply(this,arguments)}function u(e){const t=Math.round(Date.now()/1e3-e);(0,o.setClockSkew)(t)}},696055:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CHAT_JID=function(e){if(!(e instanceof o.default&&(e.isUser()||e.isGroup()||e.isBroadcast())))throw Error(`CHAT_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,e.getJidServer())},t.DEVICE_JID=function(e){if(!(e instanceof o.default&&e.isUser()))throw Error(`DEVICE_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.createJidU(e.user,l(e),e.device)},t.GROUP_CALL_JID=function(e){if(!(e instanceof o.default&&e.isGroupCall()))throw Error(`GROUP_CALL_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,s.Domains.CALL)},t.GROUP_JID=function(e){if(!(e instanceof o.default&&e.isGroup()))throw Error(`GROUP_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,s.Domains.G_US)},t.JID=function(e){if(!(e instanceof o.default))throw Error(`JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);if(null!=e.device&&0!==e.device)return a.WapJid.createJidU(e.user,l(e),e.device);return a.WapJid.create(e.user,e.getJidServer())},t.USER_JID=function(e){if(!(e instanceof o.default&&e.isUser()))throw Error(`USER_JID: invalid jid type: ${e instanceof o.default?e.toString():"Not an instance of WID"}`);return a.WapJid.create(e.user,e.getJidServer())},t.wapNodeToVoipXml=t.voipXmlToWapNode=void 0;var i=n(831914),a=n(245506),o=r(n(389867)),s=n(447685);function l(e){return"lid"===e.server?a.DOMAIN_TYPE.LID:a.DOMAIN_TYPE.WHATSAPP}t.voipXmlToWapNode=e=>{if(!e||!Array.isArray(e)||3!==e.length)throw Error("Invalid VOIP xml node");return function e(t){if(!t)return null;if(Array.isArray(t)){const n=t[0],r=t[1];let o;r&&Object.keys(r).map((e=>{o||(o={});let t=r[e];if(!t)throw Error("Attribute value is null");if("object"==typeof t){if(t.type!==a.WAP_JID_SUBTYPE.JID&&!a.WAP_JID_SUBTYPE.JID_AD&&!a.WAP_JID_SUBTYPE.JID_U)throw Error("Invalid attribute value type");t=new a.WapJid(t)}o[e]=t}));const s=t[2];let l=null;Array.isArray(s)&&s.length>0&&(l="number"==typeof s[0]?new Uint8Array(s):s.map(e).filter((e=>e)));const c=l;return new i.WapNode(n,o,c)}return t}(e)};t.wapNodeToVoipXml=e=>function e(t){const n=[];return n.push(t.tag),n.push(t.attrs||{}),Array.isArray(t.content)&&0===t.content.filter((e=>!Array.isArray(e)))?n.push(t.content):Array.isArray(t.content)?n.push(t.content.map((t=>e(t)))):null!=t.content?t.content instanceof Uint8Array?n.push(Array.from(t.content)):n.push(t.content):n.push(null),n}(e)},138062:(e,t,n)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.keyPair=function(e){let t;void 0===e?(t=new Uint8Array(32),self.crypto.getRandomValues(t)):t=new Uint8Array(e);return t[0]&=248,t[31]&=127,t[31]|=64,l({pubKey:32,privKey:t,basepoint:i},(function(e){const n=r._curve25519_donna(e.pubKey,e.privKey,e.basepoint);if(n)throw new Error(`Curve25519:keyPair Error Code ${n}`);return{pubKey:s(e.pubKey,32),privKey:t.buffer}}))},t.sharedSecret=function(e,t){return Promise.resolve().then((()=>l({sharedKey:32,pubKey:e,privKey:t},(function(e){const t=r._curve25519_donna(e.sharedKey,e.privKey,e.pubKey);if(t)throw new Error(`Curve25519:sharedSecret Error Code ${t}`);return s(e.sharedKey,32)}))))},t.toCurveKeyPair=function(e){if(33!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=new Uint8Array(32),n=new Uint8Array(32);return t.set(new Uint8Array(e.pubKey).subarray(1)),n.set(new Uint8Array(e.privKey)),{pubKey:t.buffer,privKey:n.buffer}},t.toCurveKeyPubKey=function(e){if(33!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(32);return t.set(new Uint8Array(e).subarray(1)),t.buffer},t.toSignalCurveKeyPair=function(e){if(32!==e.pubKey.byteLength||32!==e.privKey.byteLength)throw new Error("Invalid key pair type");const t=a(e.pubKey),n=new Uint8Array(32);return n.set(new Uint8Array(e.privKey)),{pubKey:t,privKey:n.buffer}},t.toSignalCurvePubKey=a,t.verifySignature=function(e,t,n){if(32!==e.byteLength)throw new Error(`Invalid public key length: ${e.byteLength}`);const r=new Uint8Array(33);r[0]=5,r.set(e,1);return!1===self.libsignal.Curve.verifySignature(r,t,n)};const i=new Uint8Array(32);i[0]=9;function a(e){if(32!==e.byteLength)throw new Error("Invalid key type");const t=new Uint8Array(33);return t[0]=5,t.set(new Uint8Array(e),1),t.buffer}function o(e){if("number"==typeof e)return r._malloc(e);const t=new Uint8Array(e.buffer||e),n=r._malloc(t.length);return r.HEAPU8.set(t,n),n}function s(e,t){const n=new Uint8Array(t);return n.set(r.HEAPU8.subarray(e,e+t)),n.buffer}function l(e,t){r||(r=n(123098));const i={};try{for(const t in e)i[t]=o(e[t]);return t(i)}finally{for(const e in i)r._free(i[e])}}},845831:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteEncKeysAndCache=function(){return d.apply(this,arguments)},t.generateFinalDbEncryptionAndFtsKeyForInvoker=function(e){return(0,s.get)().generateFinalDbEncryptionAndFtsKey(e)},t.initEncSalt=function(){return c.apply(this,arguments)},t.initEncSaltForInvoker=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(781572),o=n(624256),s=n(277303);let l=null;function c(){return(c=(0,i.default)((function*(){if(null==l){const e=n(276559).nx;l=e()}const e=yield l;if(e&&e.constructor===Uint8Array)return o.DbEncKeyStore.init(e)}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){if(null==l){const e=n(276559).nx;l=e()}const e=yield l;e&&e.constructor===Uint8Array&&(0,s.get)().initDatabaseEncnKey(e)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){yield Promise.all([o.DbEncKeyStore.deleteKeys(),(0,s.get)().deleteDbEncKeyCache()])}))).apply(this,arguments)}a.Cmd.on("logout",(()=>{l=Promise.resolve(null)}))},276559:(e,t,n)=>{"use strict";t.cn=function(){(0,a.setWebEncSalt)(null)},t.nx=function(){const e=!!(0,i.getMaybeMeUser)();let t=null;e||(t=new Uint8Array(128),self.crypto.getRandomValues(t),t=btoa(String.fromCharCode(...Array.from(new Uint8Array(t)))),(0,a.setWebEncSalt)(t));t=(0,a.getWebEncSalt)(),null==t&&(__LOG__(4,void 0,new Error)`[DB ENC CRITICAL ERROR] null returned for local enc salt`,o.Socket.logout(!1,r.LogoutReason.MissingEncSalt));return t=Uint8Array.from(atob(t),(e=>e.charCodeAt(0))),Promise.resolve(t)};var r=n(788950),i=n(978820),a=n(711597),o=n(765044)},379923:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_IV_SIZE=void 0,t.decryptMediaRetryNotification=function(){return f.apply(this,arguments)},t.encryptServerErrorReceipt=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(108584),o=n(223847),s=n(181576),l=n(16258),c=n(484902),u=n(760980);function d(e){__LOG__(2)`encodeServerErrorReceipt`;const t=new a.Binary;return(0,u.encodeProtobuf)(l.ServerErrorReceiptSpec,e,t),t.readByteArray()}function p(){return(p=(0,i.default)((function*(e,t,n){const r=yield _(e),i=(null==n?void 0:n.slice())||h(),a=d({stanzaId:t});return{ciphertext:yield(0,o.gcmEncrypt)(r,i,a,t),iv:i}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t,n,r){const i=yield _(e),a=yield(0,o.gcmDecrypt)(i,n,r,t);return(0,c.decodeProtobuf)(l.MediaRetryNotificationSpec,a)}))).apply(this,arguments)}t.ENC_IV_SIZE=12;function _(e){return(0,s.extractAndExpand)(e,"WhatsApp Media Retry Notification",32)}function h(){const e=new Uint8Array(12);return self.crypto.getRandomValues(e),e}},79653:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptPollVote=function(){return p.apply(this,arguments)},t.encryptPollVote=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(223847),o=n(363426),s=n(79196),l=n(124808),c=n(484902),u=n(760980);function d(){return(d=(0,i.default)((function*(e){const{vote:t,messageSecret:n,iv:r,stanzaId:i,pollCreationSender:c,voteSender:d}=e,p=(0,s.widToUserJid)(d),f=yield(0,o.createUseCaseSecret)({messageSecret:n,stanzaId:i,parentMsgSender:(0,s.widToUserJid)(c),modificationSender:p,modificationType:o.UseCaseSecretModificationType.POLL_VOTE}),_=(0,u.encodeProtobuf)(l.Message$PollVoteMessageSpec,t).readBuffer();return(0,a.gcmEncrypt)(f,r,_,`${i}\0${p}`)}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const{encryptedVote:t,messageSecret:n,iv:r,stanzaId:i,pollCreationSender:u,voteSender:d}=e,p=(0,s.widToUserJid)(d),f=yield(0,o.createUseCaseSecret)({messageSecret:n,stanzaId:i,parentMsgSender:(0,s.widToUserJid)(u),modificationSender:p,modificationType:o.UseCaseSecretModificationType.POLL_VOTE}),_=yield(0,a.gcmDecrypt)(f,r,t,`${i}\0${p}`);return(0,c.decodeProtobuf)(l.Message$PollVoteMessageSpec,_)}))).apply(this,arguments)}},217869:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getChatThreadID=function(){return m.apply(this,arguments)},t.getChatThreadLoggingStateDebug=function(){},t.handleActivitiesForChatThreadLogging=function(e){var t,n;return __LOG__(2)`chat_thread_logging: handling ${e.length} message(s)`,null!==(t=null===(n=p())||void 0===n?void 0:n.eventStore.handleMessages(e))&&void 0!==t?t:Promise.resolve()},t.initChatThreadLogging=function(){return f.apply(this,arguments)},t.setThreadDsTimeframeOffset=function(){return _.apply(this,arguments)},t.setThreadIdUserSecret=function(e){var t,n;return __LOG__(2)`chat_thread_logging: setting thread_id_user_secret`,null!==(t=null===(n=p())||void 0===n?void 0:n.metadataStore.setSecret(e))&&void 0!==t?t:Promise.resolve(!1)},t.uploadChatThreadLoggingEvents=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=n(892844),o=n(257243),s=n(666890),l=n(724722),c=n(961926),u=n(324700);let d=null;function p(){return null==d&&__LOG__(4,void 0,new Error)`getChatThreadLoggingState: init incomplete!`,d}function f(){return(f=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=e&&(yield(0,o.getABPropConfigValue)("message_count_logging_md_enabled")),n=new c.ChatThreadLoggingMetadataLocalStorage,r=t?new s.ChatThreadLoggingEventStoreImpl(n):{handleMessages:()=>Promise.resolve(),getEvent:()=>Promise.resolve(),getBeforeInclusive:()=>Promise.resolve([]),deleteBeforeInclusive:()=>Promise.resolve(0)},i=t?new l.ChatThreadLoggingEventUploaderImpl(n,r):{uploadEvents:()=>Promise.resolve(0)},a=yield n.getOffset();return null!=a&&g(a),d={metadataStore:n,eventStore:r,eventUploader:i},Promise.resolve(d)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){var t,n;__LOG__(2)`chat_thread_logging: setting offset`;const r=null!==(t=yield null===(n=p())||void 0===n?void 0:n.metadataStore.setOffset(e))&&void 0!==t&&t;return r&&g(e),r}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){var t,n,r;if(null==(yield null===(t=p())||void 0===t?void 0:t.metadataStore.getOffset()))return void __LOG__(2)`chat_thread_logging: attempting to upload but offset is unset.`;null!=(yield null===(n=p())||void 0===n?void 0:n.metadataStore.getSecret())?yield null===(r=p())||void 0===r?void 0:r.eventUploader.uploadEvents(e):__LOG__(2)`chat_thread_logging: attempting to upload but secret is unset.`}))).apply(this,arguments)}function g(e){const t=(0,a.unixTime)();let n=t-t%86400+e-t;n<0&&(n+=a.DAY_SECONDS),setTimeout((0,i.default)((function*(){var t;yield null===(t=p())||void 0===t?void 0:t.eventUploader.uploadEvents(),g(e)})),1e3*n)}function m(){return(m=(0,i.default)((function*(e,t){const n=yield p(),r=yield null==n?void 0:n.metadataStore.getSecret();if(null==r)throw __LOG__(4,void 0,new Error,!0)`chat_thread_logging: cannot get chat thread ID because secret is unset.`,SEND_LOGS("ctl-secret-unset"),new Error("chat_thread_logging: cannot get chat thread ID because secret is unset.");const i=(0,u.getThreadDs)(null!=t?t:(0,a.unixTime)());return(0,u.generateThreadID)(r,e,i)}))).apply(this,arguments)}},777495:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FLAG_FIELD_NAMES=t.FLAG_FIELDS=void 0,t.toMaybeBoolFlagActionType=function(e){if(!r.hasOwnProperty(e))return null;return e};const n={isCartAddClicked:!1,isCtaOnPdpClicked:!1,isCommerceViewed:!1},r=Object.freeze(n);t.FLAG_FIELDS=r;const i=Object.freeze(Object.keys(n));t.FLAG_FIELD_NAMES=i},329948:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COUNT_FIELD_NAMES=t.COUNT_FIELDS=void 0,t.toMaybeCountActionType=function(e){if(!r.hasOwnProperty(e))return null;return e};const n={profileViews:0,statusViews:0,statusReplies:0,groupMembershipReplies:0,groupPrivateReplies:0,profileReplies:0,chatOverflowClicks:0,pdpViews:0,ordersSent:0,repliesSent:0},r=Object.freeze(n);t.COUNT_FIELDS=r;const i=Object.freeze(Object.keys(n));t.COUNT_FIELD_NAMES=i},666890:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventStoreImpl=void 0,t._computeStartTs=function(e,t){const n=t%s.DAY_SECONDS,r=t-n;if(n>e)return r+e;return r-s.DAY_SECONDS+e};var i=r(n(81109)),a=r(n(348926)),o=n(657319),s=n(892844),l=n(777495),c=n(329948),u=n(324700),d=r(n(389867)),p=n(745454),f=n(460112),_=n(835673);t.ChatThreadLoggingEventStoreImpl=class{constructor(e,t){this.metadataStore=e,this._getExistingChat=n(909025).getExisting,this._cachedChanges=new Map,this._updateIntervalSeconds=null!=t?t:5,this._shiftTimer=new o.ShiftTimer((()=>{this._flush()}))}handleMessages(e){var t=this;return(0,a.default)((function*(){const n=yield t.metadataStore.getOffset();if(null==n)return void __LOG__(2)`ChatThreadLoggingEventStoreImpl: handleMessages: offset unset.`;const r=yield t.metadataStore.getLastUploadedStartTs();__LOG__(2)`ChatThreadLoggingEventStoreImpl: lastUploadedStartTs=${r}`,e.forEach((e=>{if(!(0,u.shouldUpdateChatEvent)(n,e.ts,r))return;const a=(0,u.computeStartTs)(n,e.ts),o=e.chatId.toString({legacy:!0}),s=o+"_"+String(a),d=t._cachedChanges.get(s),p=null!=d?d:(0,i.default)((0,i.default)((0,i.default)({},c.COUNT_FIELDS),l.FLAG_FIELDS),{},{startTs:a,chatId:o,addMsgsSent:0,addMsgsReceived:0,addViewOnceMsgsSent:0,addViewOnceMsgsReceived:0,addViewOnceMsgsOpened:0,addCallOffersSent:0,addCallOffersReceived:0,addTotalCallDuration:0,addCommerceMsgsSent:0,addCommerceMsgsReceived:0,addPdpInquiriesSent:0});null==d&&t._cachedChanges.set(s,p);const f=(0,c.toMaybeCountActionType)(e.activityType),_=(0,l.toMaybeBoolFlagActionType)(e.activityType);if(null!=f)p[f]+=1;else if(null!=_)p[_]=void 0===e.boolValue||e.boolValue;else switch(e.activityType){case"msgSend":p.addMsgsSent+=1,e.isViewOnce&&(p.addViewOnceMsgsSent+=1),!0===e.isCommerceMessage&&(p.addCommerceMsgsSent+=1),!0===e.isPdpInquiry&&(p.addPdpInquiriesSent+=1),e.isReply&&(p.repliesSent+=1);break;case"msgReceive":p.addMsgsReceived+=1,e.isViewOnce&&(p.addViewOnceMsgsReceived+=1),!0===e.isCommerceMessage&&(p.addCommerceMsgsReceived+=1);break;case"viewOnceOpen":p.addViewOnceMsgsOpened+=1;break;case"voipCall":e.outgoing?p.addCallOffersSent+=1:p.addCallOffersReceived+=1,p.addTotalCallDuration+=e.durationInSeconds;break;default:__LOG__(3)`Passed event store info type not valid: ${e.activityType}`}})),yield t._setFlushIfNecessary()}))()}_setFlushIfNecessary(){this._shiftTimer.onOrBefore(1e3*this._updateIntervalSeconds)}_flush(){var e=this;return(0,a.default)((function*(){const t=Array.from(e._cachedChanges.values());e._cachedChanges.clear(),yield(0,f.createOrUpdateChatEvents)(t)}))()}_populateEvents(e){var t=this;return(0,a.default)((function*(){const n=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return[e,yield t._getExistingChat((0,p.createWid)(e.chatId))]}));return function(){return e.apply(this,arguments)}}()));return Promise.all(n.map(function(){var e=(0,a.default)((function*(e){var t,n,r,a,o,s,l,c;let[f,h]=e;const g=d.default.isGroup(f.chatId),m=g?{isAGroup:g,groupSize:null!==(t=null==h||null===(n=h.groupMetadata)||void 0===n?void 0:n.participants.length)&&void 0!==t?t:1}:{isAGroup:g,isAContact:yield(0,_.isAddressBookContact)(f.chatId)},y=(null!==(r=null==h?void 0:h.pin)&&void 0!==r?r:0)>0,S=null!==(a=null==h?void 0:h.archive)&&void 0!==a&&a,E=null!==(o=null==h?void 0:h.getStarredMsgs().length)&&void 0!==o?o:0,v=null!==(s=null==h?void 0:h.unreadCount)&&void 0!==s?s:0,T=0!==(null!==(l=null==h?void 0:h.muteExpiration)&&void 0!==l?l:0),C=(null==h||null===(c=h.contact)||void 0===c?void 0:c.isBusiness)?yield(0,u.getBizCatalogType)((0,p.createWid)(f.chatId)):null;return(0,i.default)((0,i.default)({},f),{},{isPinned:y,isArchived:S,contactInfo:m,messagesStarred:E,messagesUnread:v,isMuted:T,bizCatalogType:C})}));return function(){return e.apply(this,arguments)}}()))}))()}getEvent(e,t){var n=this;return(0,a.default)((function*(){n._cachedChanges.size>0&&(yield n._flush());const r=yield(0,f.getChatEvent)(e,t);return null==r?null:(yield n._populateEvents([r]))[0]}))()}getBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),t._populateEvents(yield(0,f.getBeforeInclusive)(e))}))()}deleteBeforeInclusive(e){var t=this;return(0,a.default)((function*(){return t._cachedChanges.size>0&&(yield t._flush()),(0,f.deleteBeforeInclusive)(e)}))()}}},724722:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingEventUploaderImpl=void 0;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(892844),l=n(777495),c=n(329948),u=n(324700),d=r(n(11339));t.ChatThreadLoggingEventUploaderImpl=class{constructor(e,t){this.eventStore=t,this.metadataStore=e}uploadEvents(e){var t=this;return(0,a.default)((function*(){var n,r;const p=null===(n=null==e?void 0:e.purgeAfter)||void 0===n||n,f=yield t.metadataStore.getOffset();if(null==f)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: offset not in store!`,-1;const _=null!==(r=null==e?void 0:e.lastStartTs)&&void 0!==r?r:(0,u.computeStartTs)(f,(0,s.unixTime)()-s.DAY_SECONDS);if(null==t.secret){const e=yield t.metadataStore.getSecret();if(null==e)return __LOG__(3)`ChatThreadLoggingBatchEventUploader: secret not in store!`,-1;t.secret=e}const h=yield t.eventStore.getBeforeInclusive(_);try{yield Promise.all(h.map(function(){var e=(0,a.default)((function*(e){const n=(0,u.getThreadDs)(e.startTs),r=e.contactInfo;new d.default.ChatMessageCounts((0,i.default)((0,i.default)((0,i.default)({},c.COUNT_FIELD_NAMES.reduce(((t,n)=>(t[n]=e[n],t)),{})),l.FLAG_FIELD_NAMES.reduce(((t,n)=>(t[n]=e[n],t)),{})),{},{messagesSent:e.msgsSent,messagesReceived:e.msgsReceived,viewOnceMessagesSent:e.viewOnceMsgsSent,viewOnceMessagesReceived:e.viewOnceMsgsReceived,viewOnceMessagesOpened:e.viewOnceMessagesOpened,threadDs:n,threadId:yield(0,u.generateThreadID)((0,o.default)(t.secret,"_this.secret"),e.chatId,n),isAGroup:e.contactInfo.isAGroup,groupSize:r.isAGroup?r.groupSize:void 0,isAContact:r.isAGroup?void 0:r.isAContact,isArchived:e.isArchived,isPinned:e.isPinned,messagesStarred:e.messagesStarred,messagesUnread:e.messagesUnread,chatMuted:e.isMuted?d.default.CHAT_MUTED_TYPE.MUTED_NO_NOTIFICATIONS:d.default.CHAT_MUTED_TYPE.NOT_MUTED,callOffersSent:e.callOffersSent,callOffersReceived:e.callOffersReceived,totalCallDuration:e.totalCallDuration})).commit()}));return function(){return e.apply(this,arguments)}}()))}catch(e){__LOG__(4,void 0,new Error,!0)`chat_thread_logging: error uploading events: ${e.toString()}`,SEND_LOGS("thread-logging-upload-failure")}if(p){const e=yield t.eventStore.deleteBeforeInclusive(_);e!==h.length&&__LOG__(4,void 0,new Error)`uploadEvents: uploaded ${h.length} events but only deleted ${e} (they should be the same!)`}return yield t.metadataStore.setLastUploadedStartTs(_),h.length}))()}}},961926:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatThreadLoggingMetadataLocalStorage=void 0;var r=n(615688),i=n(711597);t.ChatThreadLoggingMetadataLocalStorage=class{constructor(){null==(0,i.getChatThreadLoggingLastUploadedStartTs)()&&(0,i.setChatThreadLoggingLastUploadedStartTs)(0)}setOffset(e){return(0,i.setChatThreadLoggingOffset)(e),Promise.resolve(!0)}getOffset(){return Promise.resolve((0,i.getChatThreadLoggingOffset)())}setSecret(e){return(0,i.setChatThreadLoggingSecretB64)((0,r.encodeB64)(e)),Promise.resolve(!0)}getSecret(){const e=(0,i.getChatThreadLoggingSecretB64)();return null==e?Promise.resolve():Promise.resolve((0,r.decodeB64)(e))}setLastUploadedStartTs(e){return(0,i.setChatThreadLoggingLastUploadedStartTs)(e),Promise.resolve(!0)}getLastUploadedStartTs(){var e;return Promise.resolve(null!==(e=(0,i.getChatThreadLoggingLastUploadedStartTs)())&&void 0!==e?e:0)}}},324700:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeStartTs=f,t.generateThreadID=function(){return p.apply(this,arguments)},t.getBizCatalogType=function(){return _.apply(this,arguments)},t.getThreadDs=function(e){return(0,s.toDate)((0,s.castToUnixTime)(e-8*s.HOUR_SECONDS)).toISOString().split("T")[0].replace(/-/g,"/")},t.shouldUpdateChatEvent=function(e,t,n){return f(e,t)>n};var i=r(n(348926)),a=n(615688),o=n(411141),s=n(892844),l=n(779235),c=n(393170);const u=new TextEncoder,d=e=>u.encode(e).buffer;function p(){return(p=(0,i.default)((function*(e,t,n){const r=d(t+n),i=yield(0,o.hmacSha256)(e,r);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function f(e,t){const n=t%s.DAY_SECONDS,r=t-n;return n>=e?r+e:r-s.DAY_SECONDS+e}function _(){return(_=(0,i.default)((function*(e){var t,n;let r;try{r=yield(0,l.queryBusinessProfile)([{wid:e}])}catch(e){return __LOG__(4,!0,new Error,!0)`Thread Logging: Failed to query business profile to set "biz_catalog_type"`,SEND_LOGS("query-business-profile-fail"),null}const i=r[0];if(!i)return null;const a=null===(t=i.profile)||void 0===t||null===(n=t.profile_options)||void 0===n?void 0:n.commerce_experience;return a===c.COMMERCE_EXPERIENCE_TYPES.CATALOG?"native":a===c.COMMERCE_EXPERIENCE_TYPES.SHOP?"shop":null}))).apply(this,arguments)}},866e3:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistContactUpdateBatched=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(639876),s=n(4233);const l=(0,o.batch)({delayMs:3e3},function(){var e=(0,a.default)((function*(e){return yield function(){return c.apply(this,arguments)}(e),e.map((()=>{}))}));return function(){return e.apply(this,arguments)}}());function c(){return(c=(0,a.default)((function*(e){const t=Array.from(e.reduce(((e,t)=>{var n;return e.set(t.id,(0,i.default)((0,i.default)({},null!==(n=e.get(t.id))&&void 0!==n?n:{}),t)),e}),new Map).values());yield(0,s.getTable)().bulkCreateOrMerge(t)}))).apply(this,arguments)}t.persistContactUpdateBatched=l},963388:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getFanOutList=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(978820),o=n(745454),s=n(209108);function l(){return(l=(0,i.default)((function*(e){let{wids:t}=e;const n=yield(0,s.getDeviceIds)(t),r=new Map;return n.forEach(((e,n)=>{if(e){const{devices:t}=e;t.forEach((t=>{const n=(0,o.createDeviceWidFromDeviceListPk)(e.id,t);(0,a.isMeDevice)(n)||r.set(n.toString(),n)}))}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`getFanOutList: no device is found, just send to the primary device`;const e=(0,o.toUserWid)(t[n]);(0,a.isMeAccount)(e)||r.set(e.toString(),e)}})),Array.from(r.values())}))).apply(this,arguments)}},520824:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistCommunityLink=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i={chatId:e,subgroups:t,action:n};if(r)return d(i);return c([i])};var i=r(n(348926)),a=n(639876),o=n(994493),s=n(776214),l=n(807528);function c(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){const t=new Map,n=new Map;e.forEach((e=>{switch(e.subgroups.forEach((e=>{n.set(String(e.id),null)})),e.action){case o.CommunityLinkOperation.SiblingGroupLink:case o.CommunityLinkOperation.SiblingGroupUnlink:t.set(String(e.chatId),null)}})),(yield(0,s.getGroupMetadataTable)().bulkGet(Array.from(t.keys()))).forEach((e=>{e&&null!=e.parentGroup&&t.set(e.id,String(e.parentGroup))})),(yield(0,s.getChatTable)().bulkGet(Array.from(n.keys()))).forEach((e=>{e&&n.set(e.id,e)}));const r=new Map,i=new Map,a=new Set;e.forEach((e=>{let s=null,l=!1;switch(e.action){case o.CommunityLinkOperation.SiblingGroupLink:s=t.get(String(e.chatId)),l=!0;break;case o.CommunityLinkOperation.SiblingGroupUnlink:s=t.get(String(e.chatId)),l=!1;break;case o.CommunityLinkOperation.SubGroupLink:s=String(e.chatId),l=!0;break;case o.CommunityLinkOperation.SubGroupUnlink:s=String(e.chatId),l=!1}null!=s&&((e,t,o)=>{t.forEach((t=>{const s=String(t.id),l=n.get(s);if(null==l||l.isReadOnly)if(o){var c;a.delete(s);const n={id:s,subject:t.subject,subjectTime:null!==(c=t.subjectTime)&&void 0!==c?c:0,parentGroup:e},r=i.get(s);r&&r.subjectTime>n.subjectTime&&(n.subject=r.subject,n.subjectTime=r.subjectTime),i.set(s,n)}else i.delete(s),a.add(s);else r.set(s,{id:s,parentGroup:o?e:void 0})}))})(s,e.subgroups,l)})),yield Promise.all([(0,s.getGroupMetadataTable)().bulkCreateOrMerge(Array.from(r.values())),(0,l.getTable)().bulkRemove(Array.from(a)),(0,l.getTable)().bulkGet(Array.from(i.keys())).then((e=>(e.forEach((e=>{if(!e)return;const t=i.get(e.id);t&&null!=e.subjectTime&&e.subjectTime>t.subjectTime&&(t.subjectTime=e.subjectTime,t.subject=e.subject)})),(0,l.getTable)().bulkCreateOrMerge(Array.from(i.values())))))])}))).apply(this,arguments)}const d=(0,a.batch)({delayMs:5e3},function(){var e=(0,i.default)((function*(e){return yield c(e),Promise.resolve(e.map((()=>{})))}));return function(){return e.apply(this,arguments)}}())},571059:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupParticipant=function(){return A.apply(this,arguments)},t.markGroupParticipantStale=function(e){let{group:t}=e;return(0,g.getStorage)().lock(["participant"],(e=>{let[n]=e;return n.merge(String(t),{stale:s.STALE_TYPES.PARTICIPANT})}))},t.modifyGroupParticipant=function(e){let{group:t,oldId:n,newId:r,prevVersion:o,newVersion:l}=e;const c=String(t);return(0,g.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[t]=e;const a=yield t.get(c);if(!a)throw new s.GroupUnSyncedError(`modifyGroupParticipant: group participant info missing for group ${c}`);if(a.version&&(null==o||o!==a.version))throw new s.GroupUnSyncedError(`modifyGroupParticipant: prev version info missing for group ${c}`);return t.createOrReplace(function(e,t,n,r){const a=String(t),o=String(n),s=new Map(e.senderKey),l=e.participants.filter((e=>e!==a)).concat(o);Array.from(s.keys()).forEach((e=>{const n=(0,p.createWid)(e).user;t.user===n?s.delete(e):s.set(e,!1)})),s.set(o,!1);const c=e.admins.map((e=>e===a?o:e));return(0,i.default)((0,i.default)({},e),{},{participants:l,senderKey:s,admins:c,version:r,rotateKey:!0})}(a,n,r,l))}));return function(){return e.apply(this,arguments)}}())},t.removeParticipantInfo=v,t.replaceParticipants=function(e){let{group:t,participants:n,admins:r,deviceIds:i,version:a}=e;const o=t.toString();return(0,g.getStorage)().lock(["participant"],(e=>{let[t]=e;return t.get(o).then((e=>e?t.createOrReplace(function(e,t,n,r,i){let a=e.rotateKey;const o=e.senderKey,s=new Map;r.forEach((e=>{if(e.equals((0,d.assertGetMe)()))return;const t=String(e),n=o.get(t);null==n?s.set(t,!1):(s.set(t,n),o.delete(t))})),0!==o.size&&(a=!0);return{groupId:e.groupId,senderKey:s,participants:t.map(String),pastParticipants:e.pastParticipants,admins:n.map(String),rotateKey:a,version:i}}(e,n,r,i,a)):t.create(function(e,t,n,r,i){const a=new Map;return r.forEach((e=>{if(e.equals((0,d.assertGetMe)()))return;const t=String(e);a.has(t)||a.set(t,!1)})),{groupId:e,senderKey:a,participants:t.map(String),pastParticipants:[],admins:n.map(String),rotateKey:!1,version:i}}(o,n,r,i,a))))}))},t.updateCommunityParticipants=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)return S({id:String(e),data:t});const{participants:r}=t,i=e.toString();return(0,g.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[n]=e;const a=yield n.get(i);if(!a)throw new s.GroupUnSyncedError(`updateCommunityParticipants: group participant info missing for group ${i}, action ${t.action}`);switch(t.action){case s.PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE:return n.createOrReplace(C(a,r,s.PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE));case s.PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE:return n.createOrReplace(C(a,r,s.PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE));default:throw new Error(`updateCommunityParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}())},t.updateGroupParticipantTableWithoutDeviceSync=function(){return m.apply(this,arguments)},t.updateParticipants=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)return y({id:String(e),data:t});const{participants:r,version:i,prevVersion:o}=t,l=e.toString();return(0,g.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[n]=e;const a=yield n.get(l);if(!a)throw new s.GroupUnSyncedError(`updateParticipants: group participant info missing for group ${l}, action ${t.action}`);if(a.version&&(null==o||o!==a.version))throw new s.GroupUnSyncedError(`updateParticipants: prevVersion info missing for group ${l}, action ${t.action}`);switch(t.action){case s.PARTICIPANT_OPERATION.ADD:return n.createOrReplace(E(a,r,t.deviceIds,i));case s.PARTICIPANT_OPERATION.REMOVE:return n.createOrReplace(v(a,r,t.timestamp,t.author,i));case s.PARTICIPANT_OPERATION.DEMOTE:return n.createOrReplace(T(a,r,i,s.PARTICIPANT_OPERATION.DEMOTE));case s.PARTICIPANT_OPERATION.PROMOTE:return n.createOrReplace(T(a,r,i,s.PARTICIPANT_OPERATION.PROMOTE));default:throw new Error(`updateParticipants: failed with unknown action ${t.action}`)}}));return function(){return e.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(348926)),o=n(639876),s=n(104622),l=n(681398),c=n(408139),u=n(879662),d=n(978820),p=n(745454),f=n(731958),_=r(n(11339)),h=n(776214),g=n(799069);function m(){return(m=(0,a.default)((function*(e){let{groupInfos:t}=e;const n=yield(0,h.getParticipantTable)().bulkGet(t.map((e=>e.id.toString()))),r=new Map;n.forEach((e=>e&&r.set(e.groupId,e.senderKey)));const i=t.map((e=>{var t;const n=[],i=[],a=e.id.toString(),o=r.get(a)||new Map;null===(t=e.participants)||void 0===t||t.forEach((e=>{e.isAdmin&&i.push(e.id),n.push(e.id),o.set(String(e.id),!1)}));let l=[];var c,d;(0,u.pastParticipantsDbEnabled)()&&(l=null!==(c=null===(d=e.pastParticipants)||void 0===d?void 0:d.map((e=>{let{id:t,leaveTs:n,leaveReason:r}=e;return{jid:t.toString(),leaveTs:n,leaveReason:r}})))&&void 0!==c?c:[]);return{groupId:a,participants:n.map(String),pastParticipants:l,admins:i.map(String),senderKey:o,rotateKey:!1,staleType:s.STALE_TYPES.DEVICE}}));return(0,h.getParticipantTable)().bulkCreateOrReplace(i)}))).apply(this,arguments)}const y=(0,o.batch)({delayMs:3e3},function(){var e=(0,a.default)((function*(e){const t=Array.from(new Set(e.map((e=>e.id))));return yield(0,g.getStorage)().lock(["participant"],function(){var n=(0,a.default)((function*(n){let[r]=n;const i=new Map((yield r.bulkGet(t)).filter(Boolean).map((e=>[e.groupId,e])));return e.forEach((e=>{let{id:t,data:n}=e;const r=i.get(t);if(!r)return void __LOG__(2)`updateParticipantsBatched: no local record found for group ${t}`;const{participants:a,version:o,prevVersion:l}=n;if(null!=r.version&&(null==l||l!==r.version))return __LOG__(2)`updateParticipantsBatched: out-of-order group notification for ${t}, action: ${n.action}`,void(r.deviceSyncComplete=!1);let c=null;switch(n.action){case s.PARTICIPANT_OPERATION.ADD:c=E(r,a,n.deviceIds,o);break;case s.PARTICIPANT_OPERATION.REMOVE:c=v(r,a,n.timestamp,n.author,o);break;case s.PARTICIPANT_OPERATION.DEMOTE:c=T(r,a,o,s.PARTICIPANT_OPERATION.DEMOTE);break;case s.PARTICIPANT_OPERATION.PROMOTE:c=T(r,a,o,s.PARTICIPANT_OPERATION.PROMOTE);break;default:__LOG__(2)`updateParticipants: failed with unknown action ${n.action}`}null!=c&&i.set(c.groupId,c)})),r.bulkCreateOrReplace(Array.from(i.values()))}));return function(){return n.apply(this,arguments)}}()),e.map((()=>{}))}));return function(){return e.apply(this,arguments)}}()),S=(0,o.batch)({delayMs:3e3},function(){var e=(0,a.default)((function*(e){const t=Array.from(new Set(e.map((e=>e.id))));return yield(0,g.getStorage)().lock(["participant"],function(){var n=(0,a.default)((function*(n){let[r]=n;const i=new Map((yield r.bulkGet(t)).filter(Boolean).map((e=>[e.groupId,e])));return e.forEach((e=>{let{id:t,data:n}=e;const r=i.get(t);if(!r)return void __LOG__(2)`updateCommunityParticipantsBatched: no local record found for group ${t}`;const{participants:a}=n;let o=null;switch(n.action){case s.PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE:o=C(r,a,s.PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE);break;case s.PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE:o=C(r,a,s.PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE);break;default:__LOG__(2)`updateCommunityParticipantsBatched: failed with unknown action ${n.action}`}null!=o&&i.set(o.groupId,o)})),r.bulkCreateOrReplace(Array.from(i.values()))}));return function(){return n.apply(this,arguments)}}()),e.map((()=>{}))}));return function(){return e.apply(this,arguments)}}());function E(e,t,n,r){const i=new Map(e.senderKey);n.forEach((e=>{if(e.equals((0,d.assertGetMe)()))return;const t=String(e);i.set(t,!1)}));const a=t.map(String);let o=e.pastParticipants;var s,l;(0,u.pastParticipantsDbEnabled)()&&(o=null!==(s=null===(l=o)||void 0===l?void 0:l.filter((e=>!a.includes(e.jid))))&&void 0!==s?s:[]);return{groupId:e.groupId,senderKey:i,participants:e.participants.concat(a),pastParticipants:o,admins:e.admins,rotateKey:e.rotateKey,version:r,staleType:e.staleType}}function v(e,t,n,r,i){const a=new Map(e.senderKey);let o=!(0,c.rotateSenderKeyIfSentEnabled)()||e.rotateKey;a.forEach(((e,n)=>{const r=(0,p.createWid)(n).user;t.some((e=>e.user===r))&&(o=o||e,a.delete(n))})),o&&a.forEach(((e,t)=>a.set(t,!1)));const s=t.map(String);let d=e.pastParticipants;var h,g;(0,u.pastParticipantsDbEnabled)()&&(d=null===(h=d)||void 0===h?void 0:h.concat(null!==(g=t.map((e=>({jid:e.toString(),leaveTs:n,leaveReason:e.equals(r)?l.LeaveReason.Left:l.LeaveReason.Removed}))))&&void 0!==g?g:[]));return!e.rotateKey&&o&&(0,f.postSenderKeyExpiredMetric)({chatId:e.groupId,deviceCount:e.senderKey.size,expiryReason:_.default.EXPIRY_REASON.USER_LEAVE}),{groupId:e.groupId,senderKey:a,participants:e.participants.filter((e=>!s.includes(e))),pastParticipants:d,admins:e.admins.filter((e=>!s.includes(e))),rotateKey:o,version:i,staleType:e.staleType}}function T(e,t,n,r){let i=e.admins;const a=t.map(String);return r===s.PARTICIPANT_OPERATION.DEMOTE?i=e.admins.filter((e=>!a.includes(e))):r===s.PARTICIPANT_OPERATION.PROMOTE&&(i=e.admins.concat(a)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,pastParticipants:e.pastParticipants,admins:i,rotateKey:e.rotateKey,version:n,staleType:e.staleType}}function C(e,t,n){let r=e.admins;const i=t.map(String);return n===s.PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE?r=e.admins.filter((e=>!i.includes(e))):n===s.PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE&&(r=e.admins.concat(i)),{groupId:e.groupId,senderKey:e.senderKey,participants:e.participants,pastParticipants:e.pastParticipants,admins:r,rotateKey:e.rotateKey,version:e.version,staleType:e.staleType}}function A(){return(A=(0,a.default)((function*(e){var t;let{groupWid:n}=e;const r=yield(0,h.getParticipantTable)().get(String(n));if(!r)return null;const i=new Set(r.admins),a=r.participants.map((e=>({id:(0,p.createWid)(e),isAdmin:i.has(e),isSuperAdmin:!1})));let o=[];var l,c;(0,u.pastParticipantsDbEnabled)()&&(o=null!==(l=null===(c=r.pastParticipants)||void 0===c?void 0:c.map((e=>{let{jid:t,leaveTs:n,leaveReason:r}=e;return{id:(0,p.createWid)(t),leaveTs:n,leaveReason:r}})))&&void 0!==l?l:[]);const d=null==r.deviceSyncComplete||r.deviceSyncComplete?void 0:s.STALE_TYPES.PARTICIPANT;return{participants:a,pastParticipants:o,staleType:null!==(t=r.staleType)&&void 0!==t?t:d}}))).apply(this,arguments)}},381321:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetadata=function(){return p.apply(this,arguments)},t.getGroupMetadataFromStorage=function(e){if((0,s.isMDBackend)())return(0,u.getStorage)().lock(["group-metadata","participant"],function(){var t=(0,a.default)((function*(t){let[n,r]=t;const i=yield n.get(e.toString());if(i){const t=yield r.get(e.toString());if(null==t?void 0:t.deviceSyncComplete){var a,o,s,c;__LOG__(2,void 0,void 0,void 0,["groups"])`found groupMetadata in storage for group id ${e.toString()}`;const n=new Set(t.admins);return{id:e,owner:i.owner&&(0,l.createWid)(i.owner),creation:i.creation,desc:i.desc,descId:i.descId,descOwner:i.descOwner&&(0,l.createWid)(i.descOwner),descTime:i.descTime,restrict:i.restrict||!1,announce:i.announce||!1,noFrequentlyForwarded:i.noFrequentlyForwarded||!1,ephemeralDuration:i.ephemeralDuration||0,participants:null===(a=t.participants)||void 0===a?void 0:a.map((e=>({id:(0,l.createWid)(e),isAdmin:n.has(e),isSuperAdmin:!1}))),pastParticipants:null===(o=t.pastParticipants)||void 0===o?void 0:o.map((e=>{let{jid:t,leaveTs:n,leaveReason:r}=e;return{id:(0,l.createWid)(t),leaveTs:n,leaveReason:r}})),subject:i.subject,support:!0===i.support,lastActivityTimestamp:null!==(s=i.lastActivityTimestamp)&&void 0!==s?s:0,lastSeenActivityTimestamp:null!==(c=i.lastSeenActivityTimestamp)&&void 0!==c?c:0}}}return __LOG__(2,void 0,void 0,void 0,["groups"])`did not find groupMetadata in storage for group id ${e.toString()}`,null}));return function(){return t.apply(this,arguments)}}());return Promise.resolve(null)},t.persistGroupMetadata=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,s.isMDBackend)())return n?f((0,i.default)({id:e.toString()},t)):(0,c.getGroupMetadataTable)().createOrMerge(e.toString(),(0,i.default)({id:e.toString()},t));return Promise.resolve()},t.updateGroupMetadataTable=function(){return d.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(639876),s=n(88555),l=n(745454),c=n(776214),u=n(799069);function d(){return(d=(0,a.default)((function*(e){let{groupInfos:t}=e,n=[];yield(0,u.getStorage)().lock(["group-metadata"],function(){var e=(0,a.default)((function*(e){let[r]=e;const a=yield r.bulkGet(t.map((e=>e.id.toString())));return n=t.map(((e,t)=>{var n,r,o,s,l,c,u,d;const p=a[t];let f={subject:e.subject,subjectTime:e.subjectTime||0},_={announce:e.announce,a_v_id:e.a_v_id||0},h={desc:e.desc,descId:e.descId,descOwner:null===(n=e.descOwner)||void 0===n?void 0:n.toString(),descTime:e.descTime||0};if(p){const e=p.subjectTime||0,t=p.a_v_id||0,n=p.descTime||0;e>f.subjectTime&&(f={subject:p.subject,subjectTime:e}),t>_.a_v_id&&(_={announce:p.announce,a_v_id:t}),n>h.descTime&&(h={desc:p.desc,descId:p.descId,descOwner:p.descOwner,descTime:n})}return(0,i.default)((0,i.default)((0,i.default)({id:e.id.toString(),creation:e.creation,owner:null===(r=e.owner)||void 0===r?void 0:r.toString(),restrict:e.restrict,noFrequentlyForwarded:e.noFrequentlyForwarded,ephemeralDuration:e.ephemeralDuration||0,membershipApprovalMode:e.membershipApprovalMode,growthLockExpiration:e.growthLockExpiration,growthLockType:e.growthLockType,size:e.size||0,support:null!==(o=e.support)&&void 0!==o&&o,suspended:null!==(s=e.suspended)&&void 0!==s&&s,terminated:null!==(l=e.terminated)&&void 0!==l&&l,parentGroup:null===(c=e.parentGroup)||void 0===c?void 0:c.toString(),isParentGroup:e.isParentGroup,defaultSubgroup:e.defaultSubgroup,lastActivityTimestamp:null!==(u=null==p?void 0:p.lastActivityTimestamp)&&void 0!==u?u:0,lastSeenActivityTimestamp:null!==(d=null==p?void 0:p.lastSeenActivityTimestamp)&&void 0!==d?d:0},f),h),_)})),r.bulkCreateOrMerge(n)}));return function(){return e.apply(this,arguments)}}())}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){var t,n,r,i,a;let{groupWid:o}=e;const s=yield(0,c.getGroupMetadataTable)().get(String(o));return s?{id:o,owner:null==s.owner?null:(0,l.createWid)(s.owner),creation:s.creation,desc:null!==(t=s.desc)&&void 0!==t?t:void 0,descId:null!==(n=s.descId)&&void 0!==n?n:void 0,descOwner:null==s.descOwner?null:(0,l.createWid)(s.descOwner),descTime:null!==(r=s.descTime)&&void 0!==r?r:void 0,restrict:s.restrict||!1,announce:s.announce||!1,noFrequentlyForwarded:s.noFrequentlyForwarded||!1,ephemeralDuration:s.ephemeralDuration||0,subject:s.subject,support:!0===s.support,lastActivityTimestamp:null!==(i=s.lastActivityTimestamp)&&void 0!==i?i:0,lastSeenActivityTimestamp:null!==(a=s.lastSeenActivityTimestamp)&&void 0!==a?a:0}:null}))).apply(this,arguments)}const f=(0,o.batch)({delayMs:3e3},function(){var e=(0,a.default)((function*(e){const t=Array.from(e.reduce(((e,t)=>{var n;return e.set(t.id,(0,i.default)((0,i.default)({},null!==(n=e.get(t.id))&&void 0!==n?n:{}),t)),e}),new Map).values());return yield(0,c.getGroupMetadataTable)().bulkCreateOrMerge(t),e.map((()=>{}))}));return function(){return e.apply(this,arguments)}}())},365063:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DroppingMsgRowDueToLogout=void 0,t.encryptMultipleDBMsgs=function(){return h.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(352613),s=n(624256),l=n(536051),c=n(861948),u=r(n(652991)),d=n(776214),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(995726));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}class _ extends Error{constructor(){super(...arguments),this.name="DroppingMsgRowDueToLogout"}}function h(){return(h=(0,a.default)((function*(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(yield s.DbEncKeyStore.waitForFinalDbMsgEncKey(),yield new Promise((e=>setTimeout(e,0))),n){t=[];for(let n=0;n<e.length;n++)try{const r=e[n],i=yield g(r,n);t.push(i)}catch(e){if(e instanceof _)throw e;__LOG__(4,void 0,new Error,void 0,["message-store"])`processAndEncryptSingleMsgRow with throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}}else t=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){return yield g(e).catch((e=>{if(e instanceof _)throw e;__LOG__(4,void 0,new Error,void 0,["message-store"])`processAndEncryptSingleMsgRow without throttle failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`})).finally((()=>{}))}));return function(){return e.apply(this,arguments)}}())),t=t.filter(Boolean);return t}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=(0,a.default)((function*(e,t){if(u.default.isLogoutInProgress)return Promise.reject(new _);null!=t&&(yield(0,o.asyncSleepAfterGivenLoopIteration)(t,35,100));const n=(0,d.getMessageTable)(),r=(0,c.getVcardWids)(e),a=(0,l.dbRowFromMessage)(e),s=yield n.preflightEncryptSingleRecord((0,i.default)({},a));return[(0,i.default)((0,i.default)((0,i.default)({},a),s),{},{vcardWAids:r}),!!(null==p?void 0:p.findLink(e.body,!0))]}))).apply(this,arguments)}t.DroppingMsgRowDueToLogout=_},70826:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistNewMessagesInBulk=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=n(227101),s=n(237540),l=n(365063),c=n(262240),u=n(68638),d=n(799069);function p(){return(p=(0,i.default)((function*(e,t){const[n,r]=yield Promise.all([f(e),(0,l.encryptMultipleDBMsgs)(e,!1)]);yield(0,d.getStorage)().lock(["chat","message","fts-indexing-queue"],function(){var e=(0,i.default)((function*(e){let[i,a,o]=e;yield i.bulkCreateOrMerge(n),yield(0,c.storeEncryptedDBMessages)(r,t,!1)}));return function(){return e.apply(this,arguments)}}())}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{const n=e.id,r=n.remote.toString();if(r!==a.STATUS_JID&&(0,s.isUnreadTypeMsg)(e)){const i=t.get(r)||{unread:0,t:0,unreadMentionsOfMe:[]};if(!n.fromMe&&(i.unread+=1,(0,o.isGroupCatchUpEnabled)()&&(0,s.isImportantMessage)(e))){const t={id:e.id.toString(),timestamp:e.t};i.unreadMentionsOfMe?i.unreadMentionsOfMe.push(t):i.unreadMentionsOfMe=[t]}e.t>i.t&&(i.t=Math.max(e.t,i.t)),t.set(r,i)}}));const n=Array.from(t.keys()),r=(yield(0,u.getTable)().bulkGet(n)).map(((e,r)=>{var i;const a=n[r],s=t.get(a),l=(null==s?void 0:s.unread)||0,c=Math.max(0,e?e.unreadCount:0);let u=(null==s?void 0:s.t)||void 0;e&&null!=e.t&&(null==u||e.t>u)&&(u=e.t);let d=[],p=null!==(i=null==e?void 0:e.archiveAtMentionViewedInDrawer)&&void 0!==i&&i;if((0,o.isGroupCatchUpEnabled)()){var f,_;const t=null!==(f=null==s?void 0:s.unreadMentionsOfMe)&&void 0!==f?f:[],n=null!==(_=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==_?_:[];t.length>0&&(p=!1),d=t.concat(n)}return{id:a,unreadCount:c+l,t:u,unreadMentionsOfMe:d,archiveAtMentionViewedInDrawer:p}}));return __LOG__(2)`[offline-resume][msg-cache]: storing chat updates: ${JSON.stringify(r)}`,r}))).apply(this,arguments)}},207601:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.compressPollOptions=function(e){return null==e?void 0:e.slice().sort(((e,t)=>e.localId-t.localId)).map(((e,t)=>{let{localId:n,name:r}=e;return(0,a.default)(n===t,"Unexpected local ID"),{name:r}}))},t.expandPollOptions=function(e){return null==e?void 0:e.map(((e,t)=>{let{name:n}=e;return{name:(0,i.default)(n,"name"),localId:t}}))};var i=r(n(145095)),a=r(n(441143))},536051:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.dbRowFromMessage=function(e){var t;let n=(0,i.default)({},e);e.quotedMsg&&(n.quotedMsg=(0,i.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(n.quotedMsg.paymentNoteMsg=(0,i.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(n.paymentNoteMsg=(0,i.default)({},e.paymentNoteMsg));e.from&&(n.from=e.from.toString());return p.forEach((e=>{null!=n[e]&&(n[e]=n[e].toString())})),delete n.notifyName,delete n.local,delete n.isNewMsg,delete n.clearMedia,delete n.multicast,delete n.urlNumber,delete n.urlText,delete n.linkPreview,delete n.star,delete n.forwardedFromWeb,n=function(e){var t,n,r;const i={currentMsg:{},quotedMsg:{}};if(null===(t=e.paymentNoteMsg)||void 0===t?void 0:t.body){var s;i.currentMsg.paymentNoteMsgBody=e.paymentNoteMsg.body,null===(s=e.paymentNoteMsg)||void 0===s||delete s.body}(null===(n=e.quotedMsg)||void 0===n||null===(r=n.paymentNoteMsg)||void 0===r?void 0:r.body)&&(i.quotedMsg.paymentNoteMsgBody=e.quotedMsg.paymentNoteMsg.body,delete e.quotedMsg.paymentNoteMsg.body);o.MSG_OPAQUE_DATA_KEYS.forEach((t=>{i.currentMsg[t]=e[t],delete e[t]})),i.currentMsg.pollOptions=(0,a.compressPollOptions)(e.pollOptions),delete e.pollOptions,e.quotedMsg&&(o.MSG_OPAQUE_DATA_KEYS.forEach((t=>{i.quotedMsg[t]=e.quotedMsg[t],delete e.quotedMsg[t]})),i.quotedMsg.pollOptions=(0,a.compressPollOptions)(e.quotedMsg.pollOptions),delete e.quotedMsg.pollOptions);const c=(0,d.encodeProtobuf)(l.MsgRowOpaqueDataSpec,i);return e.msgRowOpaqueData=c.readBuffer(),e}(n),n},t.messageFromDbRow=function(e){var t;let n=(0,i.default)({},e);e.quotedMsg&&(n.quotedMsg=(0,i.default)({},e.quotedMsg));(null===(t=e.quotedMsg)||void 0===t?void 0:t.paymentNoteMsg)&&(n.quotedMsg.paymentNoteMsg=(0,i.default)({},e.quotedMsg.paymentNoteMsg));e.paymentNoteMsg&&(n.paymentNoteMsg=(0,i.default)({},e.paymentNoteMsg));e.paymentBackground&&(n.paymentBackground=(0,i.default)({},e.paymentBackground));n.star=void 0!==n.isStarred,n.isMdHistoryMsg=n.rowId<1e9,delete n.internalId,delete n.isStarred,delete n.count,delete n.hasLink,delete n.isMediaMsg,delete n.isDocMsg,delete n.expiredTimestamp,delete n.pendingReadReceipt,n=function(e){const t=(0,u.decodeProtobuf)(l.MsgRowOpaqueDataSpec,e.msgRowOpaqueData);if(t.currentMsg){var n,r;if(t.currentMsg.paymentNoteMsgBody&&e.paymentNoteMsg)e.paymentNoteMsg.body=null===(r=t.currentMsg)||void 0===r?void 0:r.paymentNoteMsgBody;o.MSG_OPAQUE_DATA_KEYS.forEach((n=>{var r;e[n]=null===(r=t.currentMsg)||void 0===r?void 0:r[n]})),e.pollOptions=(0,a.expandPollOptions)(null===(n=t.currentMsg)||void 0===n?void 0:n.pollOptions)}if(e.quotedMsg&&t.quotedMsg){var i;t.quotedMsg.paymentNoteMsgBody&&(e.quotedMsg.paymentNoteMsg.body=t.quotedMsg.paymentNoteMsgBody),o.MSG_OPAQUE_DATA_KEYS.forEach((n=>{var r;e.quotedMsg[n]=null===(r=t.quotedMsg)||void 0===r?void 0:r[n]})),e.quotedMsg.pollOptions=(0,a.expandPollOptions)(null===(i=t.quotedMsg)||void 0===i?void 0:i.pollOptions)}return e}(n),(0,c.hydrateWids)(n),p.forEach((e=>{null!=n[e]&&(n[e]=s.default.from(n[e]))})),null!=n.messageSecret&&(n.messageSecret=new Uint8Array(n.messageSecret));return n};var i=r(n(81109)),a=n(207601),o=n(42672),s=r(n(465212)),l=n(682348),c=n(464448),u=n(484902),d=n(760980);const p=["id","protocolMessageKey","paymentRequestMessageKey","keptMessageKey","pollUpdateParentKey","kicKey"]},861948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePropertyType=void 0,t.beginningOfChat=function(e){return`${e.toString()}_/`},t.craftInternalId=function(e,t){const n=i(t);return`${e}_${n}_m`},t.craftMessageRangeIndex=function(e,t,n,a){let o;o=n?r.SystemMessage:t?r.IncomingChatMessage:r.Outgoing;return`${e}_${o}_${null!=a?i(a):""}`},t.endOfChat=function(e){return`${e.toString()}_g`},t.getInChatMsgId=function(e){return a(e.split("_")[1])},t.getVcardWids=function(e){let t=[];if("vcard"===e.type)t=[e.body];else{if("multi_vcard"!==e.type)return;t=e.vcardList.map((e=>e.vcard))}const{parseVcard:r,vcardWids:i}=n(893778);return t.filter(Boolean).reduce(((e,t)=>{const n=i(r(t));return e.concat(n.map((e=>e.toString())))}),[])},t.undoOrderPreservingHex=a;const r=n(76672)({IncomingChatMessage:"1",Outgoing:"2",SystemMessage:"3"});function i(e){const t=e.toString(16);return(t.length-1).toString(16)+t}function a(e){return parseInt(e.substring(1),16)}t.MessagePropertyType=r},42672:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MSG_OPAQUE_DATA_KEYS=void 0;t.MSG_OPAQUE_DATA_KEYS=["body","caption","clientUrl","loc","lng","isLive","lat","paymentAmount1000","canonicalUrl","matchedText","title","description","futureproofBuffer","messageSecret","pollName","pollSelectableOptionsCount","pollUpdateParentKey","encPollVote","senderTimestampMs"]},262240:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeEncryptedDBMessages=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,_.getStorage)().lock(["message"],function(){var r=(0,a.default)((function*(r){let[i]=r;const a=yield i.all({reverse:!n,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?E:e[0])),o={};yield Promise.all(t.map((e=>{const t=(0,d.createWid)(e),r=(0,l.beginningOfChat)(t),a=(0,l.endOfChat)(t);return i.between(["internalId"],r,a,{limit:1,reverse:!n,returnKeyType:"keys"}).then((e=>o[t.toString()]=0===e.length?E:(0,l.getInChatMsgId)(e[0])))})));const s=n?-1:1,u=e.map(((e,t)=>{let[r,i]=e;n&&(r.isMdHistoryMsg=!0);const l=c.default.fromString(r.id),u=l.remote.toString(),d=o[u]+1*s;o[u]=d;const p=!n&&v(l,r);return T(r,u,i,a+s*(t+1),d,p)}));return i.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(u).catch((e=>{if(n&&e instanceof h.default.BulkError)return __LOG__(4,void 0,new Error)`[storeEncryptedMessage] BulkError in bulkCreate, retrying with bulk create or replace`,i.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(u);throw e})).then((()=>u))}));return function(){return r.apply(this,arguments)}}()).then((e=>{h.default.ignoreTransaction((()=>{(0,f.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)})))).then((()=>{null==m||m.default.index().catch((()=>{}))}))}))}))};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(237540),l=n(861948),c=r(n(465212)),u=n(115461),d=n(745454),p=n(6901),f=n(144936),_=n(799069),h=r(n(986128)),g=S(n(765044)),m=S(n(169048));function y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(y=function(e){return e?n:t})(e)}function S(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=y(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const E=1e9;function v(e,t){if(e.fromMe||e.remote.isStatusV3())return!1;const n=(0,s.eventTypeFromMsgType)(t);return"a"===n||"d"===n}function T(e,t,n,r,a,s){const d=[u.MSG_TYPE.IMAGE,u.MSG_TYPE.VIDEO,u.MSG_TYPE.AUDIO].includes(e.type),p=(0,i.default)((0,i.default)({},e),{},{vcardWAids:e.vcardWAids||(0,l.getVcardWids)(e),id:e.id.toString(),isStarred:e.star?r:void 0,hasLink:"chat"===e.type&&n?r:void 0,isMediaMsg:d?r:void 0,isDocMsg:e.type===u.MSG_TYPE.DOCUMENT?r:void 0,expiredTimestamp:C(e)});null!=r&&(p.rowId=r),null!=a&&(p.internalId=(0,l.craftInternalId)(t,a)),s&&t!==o.STATUS_JID&&(p.pendingReadReceipt=1);let f=e.c2sTimestamp;var _;e.id.fromMe&&g&&!g.Socket.hasSynced?f=null!==(_=e.c2sTimestamp)&&void 0!==_?_:e.t:f=e.t;try{e.type!==u.MSG_TYPE.REACTION&&(p.messageRangeIndex=(0,l.craftMessageRangeIndex)(t,!c.default.fromString(e.id).fromMe,u.SYSTEM_MESSAGE_TYPES.includes(e.type),f))}catch(e){__LOG__(4,void 0,new Error)`[process-msg] craftMessageRangeIndex failed with error ${e}`}return p}function C(e){const{ephemeralDuration:t,ephemeralStartTimestamp:n,t:r,subtype:i,id:{fromMe:a}}=e,o=(0,p.getEphemeralExpirationTimestamp)(t,n,r,i,a);return null!=o?o:void 0}},994493:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommunityLinkOperation=void 0;const r=n(76672).Mirrored(["SubGroupLink","SiblingGroupLink","SubGroupUnlink","SiblingGroupUnlink"]);t.CommunityLinkOperation=r},104622:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STALE_TYPES=t.PARTICIPANT_OPERATION=t.GroupUnSyncedError=void 0;const n=Object.freeze({ADD:"add",REMOVE:"remove",DEMOTE:"demote",PROMOTE:"promote",LINKED_GROUP_PROMOTE:"linked_group_promote",LINKED_GROUP_DEMOTE:"linked_group_demote"});t.PARTICIPANT_OPERATION=n;const r=Object.freeze({DEVICE:"device",PARTICIPANT:"participant"});t.STALE_TYPES=r;class i extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}t.GroupUnSyncedError=i},773184:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WHATSAPP_GRAPHQL_ENDPOINT=t.WHATSAPP_GRAPHQL_ACCESS_TOKEN=void 0;t.WHATSAPP_GRAPHQL_ENDPOINT="https://graph.whatsapp.com/graphql/catalog";t.WHATSAPP_GRAPHQL_ACCESS_TOKEN="WA|787118555984857|7bb1544a3599aa180ac9a3f7688ba243"},207312:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PersistedQueries=void 0;t.PersistedQueries={WAWebQueryCatalogHasCategoriesQuery:"5247905281934978",WAWebQueryCatalogProductQuery:"5778676335477886",WAWebQueryCatalogQuery:"3834942146629345",WAWebQueryProductCollectionsQuery:"7638104259594449",WAWebQueryProductListCatalogJobQuery:"5450770124962699",WAWebQueryProductSingleCollectionQuery:"7756986321039261",queryProductListCatalogQuery:"5127568407281377"}},248089:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GraphQLServerError=void 0;class n extends Error{constructor(e){super(),this.name="GraphQLServerError",this.source=e}}t.GraphQLServerError=n},801321:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchQuery=function(){return c.apply(this,arguments)},t.graphql=function(){throw new Error("Invariant Violation")},t.graphqlWWWTODO=function(){throw new Error("Invariant Violation")};var i=r(n(506479)),a=r(n(348926)),o=n(248089),s=n(352148);const l=["eventLogger"];function c(){return(c=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{eventLogger:r}=n,a=(0,i.default)(n,l);const{fetchQuery:c}=yield(0,s.requireRelayRuntime)();try{const n=yield c(yield(0,s.getEnvironment)(),e,t,a).toPromise();return null==r||r.success(),n}catch(e){throw e instanceof o.GraphQLServerError&&(null==r||r.failure(e.source.errors)),e}}))).apply(this,arguments)}},352148:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEnvironment=function(){return d.apply(this,arguments)},t.requireRelayRuntime=c;var i=r(n(348926)),a=r(n(140682)),o=n(773184),s=n(207312),l=n(248089);function c(){return n.e(4815).then(n.t.bind(n,244311,23))}let u;function d(){return(d=(0,i.default)((function*(){if(null!=u)return u;const{Environment:e,Network:t,RecordSource:n,Store:r}=yield c(),d={Accept:"application/json","Content-Type":"application/json"},p=function(){var e=(0,i.default)((function*(e,t){const n={access_token:o.WHATSAPP_GRAPHQL_ACCESS_TOKEN,doc_id:s.PersistedQueries[e.name],variables:t,lang:a.default.get()},r=yield fetch(o.WHATSAPP_GRAPHQL_ENDPOINT,{method:"POST",headers:d,body:JSON.stringify(n)});if(!r.ok)throw new l.GraphQLServerError({errors:[{code:r.status,message:r.statusText}]});const i=yield r.json();if(null!=(null==i?void 0:i.errors))throw new l.GraphQLServerError({errors:i.errors});return i}));return function(){return e.apply(this,arguments)}}();return u=new e({network:t.create(p),store:new r(new n)}),u}))).apply(this,arguments)}},299805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){throw new Error("Invariant Violation")}},972666:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseErrorFields=void 0;const r=new(n(471914).WapParser)("parseErrorFields",(e=>{const t=[];return e.forEachChildWithTag("field",(e=>{const n=e.hasAttr("detail")?e.maybeAttrString("detail"):null;t.push({name:e.attrString("name"),reason:e.attrString("reason"),detail:n})})),t}));t.parseErrorFields=r},876972:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.maybeChild("address"),n=t?t.contentString():void 0,r=e.maybeChild("description"),o=r?r.contentString():void 0,s=e.maybeChild("email"),l=s?s.contentString():void 0,c=e.maybeChild("latitude"),u=c?parseFloat(c.contentString()):void 0,d=e.maybeChild("longitude"),p=d?parseFloat(d.contentString()):void 0,f=e.maybeChild("vertical");let _;if(f){const e=f.maybeAttrString("canonical"),t=f.hasContent()?f.contentString():void 0;_={name:t,canonical:e}}const h=[];e.forEachChildWithTag("website",(e=>{h.push(e.contentString())}));const g=[],m=e.maybeChild("categories");m&&m.forEachChildWithTag("category",(e=>{const t=e.attrString("id");g.push({id:t,localized_display_name:e.contentString()})}));let y;const S=e.maybeChild("business_hours");if(S){const e=S.maybeAttrString("timezone"),t=[];S.forEachChildWithTag("business_hours_config",(e=>{t.push({day_of_week:e.attrString("day_of_week"),mode:e.attrString("mode"),open_time:e.hasAttr("open_time")?parseInt(e.attrString("open_time"),10):0,close_time:e.hasAttr("close_time")?parseInt(e.attrString("close_time"),10):0})})),y={config:t,timezone:e}}let E;const v=e.maybeChild("profile_options");if(v){E={};const e=v.maybeChild("commerce_experience");var T;if(e)E.commerce_experience=null!==(T=a.COMMERCE_EXPERIENCE_TYPES.cast(e.contentString()))&&void 0!==T?T:a.COMMERCE_EXPERIENCE_TYPES.NONE;const t=v.maybeChild("cart_enabled");t&&(E.cart_enabled="true"===t.contentString());const n=v.maybeChild("shop_url");n&&(E.shop_url=n.contentString());const r=v.maybeChild("commerce_manager_url");r&&(E.commerce_manager_url=r.contentString());const i=v.maybeChild("is_banned");i&&(E.is_banned="true"===i.contentString());const o=v.maybeChild("direct_connection");o&&(E.direct_connection="true"===o.contentString())}const C=e.maybeChild("direct_connection");let A;if(C){const e=C.maybeChild("default_postcode");A={enabled:"true"===C.maybeAttrString("enabled"),defaultPostcode:e?{code:e.attrString("code"),locationName:e.attrString("location_name")}:void 0}}const b=e.maybeChild("catalog_status"),P=b?b.attrString("status"):void 0;let O={},M={},I=!1;const w=e.maybeChild("linked_accounts");if(w){I=!0;const e=w.maybeChild("fb_page");if(e){const t=e.maybeChild("display_name"),n=e.maybeChild("likes");O={displayName:null==t?void 0:t.contentString(),likes:null==n?void 0:n.contentString(),id:e.maybeAttrString("id")}}const t=w.maybeChild("ig_professional");if(t){const e=t.maybeChild("ig_handle"),n=t.maybeChild("followers");M={handle:null==e?void 0:e.contentString(),followers:null==n?void 0:n.contentString()}}}const R=e.maybeChild("cover_photo"),N=R?{id:R.attrString("id"),url:new URL(R.contentString())}:void 0,L={address:n,description:o,email:l,latitude:u,longitude:p,vertical:_,website:h,categories:g,business_hours:y,catalog_status:P,profile_options:E,fbPage:O,igProfessional:M,isProfileLinked:I,directConnection:A,cover_photo:N};return(0,i.default)(L)};var i=r(n(134842)),a=n(393170)},377651:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.attrEnum("verified_level",r.MSG_VERIFIED_LEVEL),n=e.hasContent()?e.contentBytes():null,o=e.maybeAttrString("serial"),{serial:s,name:l,isApi:c}=n&&function(e){const t=(0,a.getParsedProtoObjects)(e);if(null==t?void 0:t.details){const{name:e,serial:n,isApi:r}=(0,a.extractCertificateDetailsParams)(t.details);return{name:e,serial:String(n),isApi:r}}}(n)||{},u=i.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),d=i.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),p=e.maybeAttrInt("privacy_mode_ts");return{level:t,serial:o||s,name:l,isApi:!0===c,privacyMode:null!=u&&null!=d&&null!=p?{actualActors:u,hostStorage:d,privacyModeTs:p}:null}};var r=n(312037),i=n(49714),a=n(251836)},469845:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getCustomUrlPaths=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055);const u=new s.WapParser("customURLResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("custom_urls"),n=[];return t.forEachChildWithTag("custom_url",(e=>{const t=e.maybeChild("path");if(t){const e=t.contentString();null!=e&&n.push(e)}})),{paths:n}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{smax_id:"78",xmlns:"fb:thrift_iq",type:"get",to:o.S_WHATSAPP_NET,id:(0,o.generateId)()},(0,o.wap)("user",{jid:(0,c.JID)(e)})),n=yield(0,a.sendIq)(t,u);if(!n.success||!n.result)throw new l.ServerStatusCodeError(n.errorCode,n.errorText);return n.result}))).apply(this,arguments)}},275261:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getUserByCustomURL=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574);const c=new s.WapParser("customURLResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return{user:{jid:e.child("user").attrUserJid("jid")}}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{smax_id:"79",xmlns:"fb:thrift_iq",type:"get",to:o.S_WHATSAPP_NET,id:(0,o.generateId)()},(0,o.wap)("custom_url",null,(0,o.wap)("path",null,e))),n=yield(0,a.sendIq)(t,c);if(!n.success)throw new l.ServerStatusCodeError(n.errorCode,n.errorText);return n.result}))).apply(this,arguments)}},591097:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.cartItemToNode=d,t.createOrderMD=function(){return p.apply(this,arguments)},t.createOrderResponse=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055);const u=new s.WapParser("createOrderResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("order"),n=t.attrString("id"),r=t.attrString("token"),i=t.maybeChild("price"),a={},o=null==i?void 0:i.maybeChild("subtotal");o&&(a.subtotal=o.contentString());const s=null==i?void 0:i.maybeChild("total");s&&(a.total=s.contentString());const l=null==i?void 0:i.maybeChild("currency");l&&(a.currency=l.contentString());const c=null==i?void 0:i.maybeChild("price_status");return c&&(a.price_status=c.contentString()),{id:n,token:r,price:a}}));function d(e){const t=null!=e.priceAmount1000?(0,o.wap)("price",null,e.priceAmount1000.toString()):void 0,n=e.currency?(0,o.wap)("currency",null,e.currency):void 0;return(0,o.wap)("product",null,(0,o.wap)("id",null,e.id),(0,o.wap)("name",null,e.name),t,n,(0,o.wap)("quantity",null,e.quantity.toString()))}function p(){return(p=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,smax_id:"10",xmlns:"fb:thrift_iq",id:(0,o.generateId)(),type:"set"},(0,o.wap)("order",{op:(0,o.CUSTOM_STRING)("create"),biz_jid:(0,c.USER_JID)(e)},t.map((e=>d(e))).concat(n?(0,o.wap)("direct_connection_encrypted_info",null,n):[]))),i=yield(0,a.sendIq)(r,u);if(i.success)return i.result;if(451===i.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}t.createOrderResponse=u},879327:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryOrder=function(){return d.apply(this,arguments)},t.queryOrderResponse=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(408139);const u=new s.WapParser("queryOrderResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("order"),n=t.hasAttr("creation_ts")?t.attrTime("creation_ts"):null,r=t.maybeChild("price"),i=null==r?void 0:r.maybeChild("subtotal"),a=i?parseInt(i.contentString(),10):null,o=null==r?void 0:r.maybeChild("currency"),s=o?o.contentString():null,l=null==r?void 0:r.maybeChild("tax"),c=l?parseInt(l.contentString(),10):null,u=null==r?void 0:r.maybeChild("total"),d=u?parseInt(u.contentString(),10):null,p=[];return t.forEachChildWithTag("product",(e=>{const t=e.child("id").contentString(),n=e.child("name").contentString(),r=e.maybeChild("price"),i=r?parseInt(r.contentString(),10):null,a=e.maybeChild("quantity"),o=a?parseInt(a.contentString(),10):null,s=e.maybeChild("currency"),l=s?s.contentString():null;let c=null,u=null;const d=e.maybeChild("image");if(null!=d){const e=d.maybeChild("url");u=e&&e.hasContent()?e.contentString():null;const t=d.maybeChild("id");c=t&&t.hasContent()?t.contentString():null}p.push({id:t,price:i,thumbnailId:c,thumbnailUrl:u,currency:l,name:n,quantity:o})})),{currency:s,createdAt:n,products:p,subtotal:a,total:d,tax:c}}));function d(){return(d=(0,i.default)((function*(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if((0,c.commerceFeaturesDisabledBySanctions)())return Promise.reject(new l.E451);const s=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,smax_id:"5",xmlns:"fb:thrift_iq",id:(0,o.generateId)(),type:"get"},(0,o.wap)("order",{op:(0,o.CUSTOM_STRING)("get"),id:(0,o.CUSTOM_STRING)(e)},(0,o.wap)("image_dimensions",null,(0,o.wap)("width",null,t.toString()),(0,o.wap)("height",null,n.toString())),(0,o.wap)("token",null,r),i?(0,o.wap)("direct_connection_encrypted_info",null,i):null)),d=yield(0,a.sendIq)(s,u);if(d.success)return d.result;if(451===d.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(d.errorCode)}))).apply(this,arguments)}t.queryOrderResponse=u},816179:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProductMD=function(){return f.apply(this,arguments)},t.addProductResponse=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(413335),u=n(972666),d=n(408139);const p=new s.WapParser("addProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_add").child("product");return(0,c.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,n){if((0,d.commerceFeaturesDisabledBySanctions)())throw new l.E451;const r=(0,o.wap)("iq",{id:(0,o.generateId)(),to:o.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,o.wap)("product_catalog_add",{v:"1"},(0,c.productModelToNode)(e),(0,o.wap)("width",null,t.toString()),(0,o.wap)("height",null,n.toString()))),i=yield(0,a.sendIqErrorParser)(r,p,u.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new l.E451;throw null!=i.customError?new l.CatalogEditServerError(i.errorCode,i.customError):new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}t.addProductResponse=p},360622:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.appealProductMD=function(){return d.apply(this,arguments)},t.appealProductResponse=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(408139);const u=new s.WapParser("appealProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("response").child("success").contentString()}));function d(){return(d=(0,i.default)((function*(e,t){if((0,c.commerceFeaturesDisabledBySanctions)())throw new l.E451;const n=(0,o.wap)("iq",{id:(0,o.generateId)(),to:o.S_WHATSAPP_NET,type:"set",xmlns:"fb:thrift_iq"},(0,o.wap)("request",{type:"appeal_product"},(0,o.wap)("reason",null,t),(0,o.wap)("id",null,e))),r=yield(0,a.sendIq)(n,u);if(r.success)return r.result;if(451===r.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}t.appealProductResponse=u},988132:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProductsMD=function(){return d.apply(this,arguments)},t.productDeleteResponse=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(408139);const u=new s.WapParser("productDeleteResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return{deletedCount:e.child("product_catalog_delete").attrInt("deleted_count")}}));function d(){return(d=(0,i.default)((function*(e){if((0,c.commerceFeaturesDisabledBySanctions)())throw new l.E451;const t=(0,o.wap)("iq",{id:(0,o.generateId)(),to:o.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,o.wap)("product_catalog_delete",{v:"1"},e.map((e=>(0,o.wap)("product",null,(0,o.wap)("id",null,e)))))),n=yield(0,a.sendIq)(t,u);if(n.success)return n.result;if(451===n.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}t.productDeleteResponse=u},665945:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(413335),u=n(972666),d=n(408139);const p=new s.WapParser("editProductResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog_edit").child("product");return(0,c.parseProductNode)(t)}));function f(){return(f=(0,i.default)((function*(e,t,n){if((0,d.commerceFeaturesDisabledBySanctions)())throw new l.E451;const r=(0,o.wap)("iq",{id:(0,o.generateId)(),to:o.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,o.wap)("product_catalog_edit",{v:"1"},(0,c.productModelToNode)(e),(0,o.wap)("width",null,t.toString()),(0,o.wap)("height",null,n.toString()))),i=yield(0,a.sendIqErrorParser)(r,p,u.parseErrorFields);if(i.success)return i.result;if(451===i.errorCode)throw new l.E451;throw i.customError?new l.CatalogEditServerError(i.errorCode,i.customError):new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},413335:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseLegacyProductErrorReason=function(e){if(null!=e){const t=Object.keys(e)[0];return[{name:t,reason:e[t]||"",detail:e.detail}]}return[]},t.parseProductNode=void 0,t.productModelToNode=function(e){var t,n;const r=e.id?(0,a.wap)("id",null,e.id.toString()):void 0,l=e.description?(0,a.wap)("description",null,e.description):void 0,u=e.url?(0,a.wap)("url",null,e.url):void 0,d=e.retailerId?(0,a.wap)("retailer_id",null,e.retailerId):void 0,p=null!=e.priceAmount1000?(0,a.wap)("currency",null,e.currency):void 0,f=null!=e.priceAmount1000?(0,a.wap)("price",null,e.priceAmount1000.toString()):void 0,_=[(0,a.wap)("image",null,(0,a.wap)("url",null,e.imageCdnUrl))].concat(null===(t=e.additionalImageCdnUrl)||void 0===t?void 0:t.map((e=>(0,a.wap)("image",null,(0,a.wap)("url",null,e))))),h=function(e){var t,n,r,i,s,l;const{isExempt:c,hasCountryCodeOrigin:u,hasImporterName:d,hasImporterAddress:p}=(0,o.scanComplianceInfoForMissingData)(e);return!c&&(u||d||p)?(0,a.wap)("compliance_info",null,u?(0,a.wap)("country_code_origin",null,null==e?void 0:e.countryCodeOrigin):void 0,d?(0,a.wap)("importer_name",null,null==e?void 0:e.importerName):void 0,p?(0,a.wap)("importer_address",null,(null==e||null===(t=e.importerAddress)||void 0===t?void 0:t.street1)?(0,a.wap)("street1",null,e.importerAddress.street1):void 0,(null==e||null===(n=e.importerAddress)||void 0===n?void 0:n.street2)?(0,a.wap)("street2",null,e.importerAddress.street2):void 0,(null==e||null===(r=e.importerAddress)||void 0===r?void 0:r.city)?(0,a.wap)("city",null,e.importerAddress.city):void 0,(null==e||null===(i=e.importerAddress)||void 0===i?void 0:i.region)?(0,a.wap)("region",null,e.importerAddress.region):void 0,(null==e||null===(s=e.importerAddress)||void 0===s?void 0:s.postalCode)?(0,a.wap)("postal_code",null,e.importerAddress.postalCode):void 0,(null==e||null===(l=e.importerAddress)||void 0===l?void 0:l.countryCode)?(0,a.wap)("country_code",null,e.importerAddress.countryCode):void 0):void 0):void 0}(e.complianceInfo),g=(0,i.default)({is_hidden:e.isHidden?"true":"false"},(null===(n=e.complianceInfo)||void 0===n?void 0:n.countryCodeOrigin)===String(s.SyntheticCountryCode.NotApplicable)?{compliance_category:c.ProductComplianceCategory.CountryOriginExempt}:void 0);return(0,a.wap)("product",g,r,(0,a.wap)("name",null,e.name),l,u,d,(0,a.wap)("media",null,_),f,p,h)};var i=r(n(81109)),a=n(831914),o=n(374316),s=n(509978),l=n(109581),c=n(906822);t.parseProductNode=e=>{var t,n,r;const a=e.child("id").contentString(),o=e.maybeChild("url");let u="";o&&o.hasContent()&&(u=o.contentString());const d=e.child("name").contentString(),p=null!==(t=e.maybeAttrString("availability"))&&void 0!==t?t:c.ProductAvailability.UNKNOWN;let f=l.MAX_QUANTITY;const _=e.maybeAttrString("max_available");null!=_&&(f=Number(_));const h=e.maybeChild("max_available"),g=null==h?void 0:h.contentString();null!=g&&(f=Number(g));const m=e.maybeChild("description"),y=m?m.contentString():"",S=e.maybeChild("belongs_to"),E="true"===(null==S?void 0:S.contentString())||!1,v=[],T=[],C=[],A=e.child("media");let b=!0;A.forEachChildWithTag("image",(e=>{if(b)b=!1,v.push({key:"requested",value:e.child("request_image_url").contentString()}),v.push({key:"full",value:e.child("original_image_url").contentString()}),C.push(e.child("id").contentString());else{const t=[];t.push({key:"requested",value:e.child("request_image_url").contentString()}),t.push({key:"full",value:e.child("original_image_url").contentString()}),T.push(t),C.push(e.child("id").contentString())}}));const P=e.maybeChild("status_info"),O=(null==P?void 0:P.child("status").contentString())||"APPROVED",M=null==P||null===(n=P.maybeChild("can_appeal"))||void 0===n?void 0:n.contentString(),I=e.maybeChild("currency"),w=I?I.contentString():void 0,R=e.maybeChild("price"),N=null==R?void 0:R.contentString(),L=e.maybeChild("retailer_id"),D=L?L.contentString():"",k=!!e.hasAttr("is_hidden")&&"true"===e.attrString("is_hidden"),U=e.hasAttr("compliance_category")?c.ProductComplianceCategory.cast(e.attrString("compliance_category")):c.ProductComplianceCategory.Default,G=e.maybeChild("sale_price"),x=G?(0,i.default)({sale_price:null===(r=G.maybeChild("price"))||void 0===r?void 0:r.contentString()},G.hasChild("start_date")&&G.hasChild("end_date")?{sale_start_date:G.child("start_date").contentString(),sale_end_date:G.child("end_date").contentString()}:null):null,B=(0,i.default)({id:a,is_hidden:k,url:u,name:d,description:y,availability:p,max_available:f,additional_image_cdn_urls:T,image_cdn_urls:v,capability_to_review_status:[{key:"WHATSAPP",value:O}],whatsapp_product_can_appeal:"true"===M,image_hashes_for_whatsapp:C,currency:w,price:N,retailer_id:D,checkmark:E},x),F=e.maybeChild("compliance_info");return U===c.ProductComplianceCategory.CountryOriginExempt?B.compliance_info={country_code_origin:String(s.SyntheticCountryCode.NotApplicable)}:F&&(B.compliance_info=function(e){var t;const n=e.child("country_code_origin").contentString(),r=null===(t=e.maybeChild("importer_name"))||void 0===t?void 0:t.contentString(),i=e.maybeChild("importer_address"),a={country_code_origin:n,importer_name:r};var o,s,l;i&&(a.importer_address={street1:i.child("street1").contentString(),street2:null===(o=i.maybeChild("street2"))||void 0===o?void 0:o.contentString(),postal_code:null===(s=i.maybeChild("postal_code"))||void 0===s?void 0:s.contentString(),city:i.child("city").contentString(),region:null===(l=i.maybeChild("region"))||void 0===l?void 0:l.contentString(),country_code:i.child("country_code").contentString()});return a}(F)),B}},100068:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(408139);const u=new s.WapParser("visibilitySetResponse",(e=>{e.assertTag("iq"),e.assertFromServer()}));function d(){return(d=(0,i.default)((function*(e){if((0,c.commerceFeaturesDisabledBySanctions)())throw new l.E451;const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",smax_id:"23",id:(0,o.generateId)()},(0,o.wap)("product_visibility_update",{v:"1"},e.map((e=>(0,o.wap)("product",{is_hidden:e.isHidden?"true":"false"},(0,o.wap)("id",null,e.productId)))))),n=yield(0,a.sendIq)(t,u);if(n.success)return n.result;if(451===n.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}},235586:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductCatalog=function(){return d.apply(this,arguments)},t.productCatalogCreateResponse=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(408139);const u=new s.WapParser("productCatalogCreateResponse",(e=>{e.assertTag("iq"),e.assertFromServer(),e.child("product_catalog_create")}));function d(){return(d=(0,i.default)((function*(){if((0,c.commerceFeaturesDisabledBySanctions)())throw new l.E451;const e=(0,o.wap)("iq",{id:(0,o.generateId)(),to:o.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog"},(0,o.wap)("product_catalog_create",{version:"1"})),t=yield(0,a.sendIq)(e,u);if(t.success)return t.result;if(451===t.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(t.errorCode)}))).apply(this,arguments)}t.productCatalogCreateResponse=u},907779:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseProductGraphQL=function(e){var t,n,r,p,f,_,h,g,m;let{status_info:y,sale_price:S,availability:E,compliance_info:v}=e,T=(0,a.default)(e,u);const[C,...A]=null!==(t=null===(n=T.media)||void 0===n?void 0:n.images)&&void 0!==t?t:[],b=(0,i.default)((0,i.default)({id:(0,o.default)(T.id,"product.id"),retailer_id:null!==(r=T.retailer_id)&&void 0!==r?r:"",name:(0,o.default)(T.name,"product.name"),description:null!==(p=T.description)&&void 0!==p?p:"",url:null!==(f=T.url)&&void 0!==f?f:"",currency:T.currency,price:T.price,is_hidden:"ISHIDDEN_TRUE"===T.is_hidden,max_available:null!==(_=T.max_available)&&void 0!==_?_:l.MAX_QUANTITY,availability:E&&E in d?d[E]:c.ProductAvailability.UNKNOWN},null!=(null==S?void 0:S.price)?(0,i.default)({sale_price:S.price},null!=S.start_date&&null!=S.end_date?{sale_start_date:S.start_date,sale_end_date:S.end_date}:null):null),{},{checkmark:"true"===T.belongs_to,image_hashes_for_whatsapp:(null!==(h=null===(g=T.media)||void 0===g?void 0:g.images)&&void 0!==h?h:[]).map((e=>(0,o.default)(e.id,"img.id"))),image_cdn_urls:C?[{key:"requested",value:(0,o.default)(C.request_image_url,"firstImage.request_image_url")},{key:"full",value:(0,o.default)(C.original_image_url,"firstImage.original_image_url")}]:[],additional_image_cdn_urls:A.map((e=>[{key:"requested",value:(0,o.default)(e.request_image_url,"img.request_image_url")},{key:"full",value:(0,o.default)(e.original_image_url,"img.original_image_url")}])),whatsapp_product_can_appeal:"true"===(null==y?void 0:y.can_appeal),capability_to_review_status:[{key:"WHATSAPP",value:null!==(m=null==y?void 0:y.status)&&void 0!==m?m:"APPROVED"}]});if(null!=v){var P,O,M,I,w;const{importer_address:e}=v;b.compliance_info="COMPLIANCECATEGORY_COUNTRYORIGINEXEMPT"===T.compliance_category?{country_code_origin:s.SyntheticCountryCode.NotApplicable}:{country_code_origin:null!==(P=v.country_code_origin)&&void 0!==P?P:void 0,importer_name:null!==(O=v.importer_name)&&void 0!==O?O:void 0,importer_address:{street1:(0,o.default)(null==e?void 0:e.street1,"importerAddress?.street1"),street2:null!==(M=null==e?void 0:e.street2)&&void 0!==M?M:void 0,postal_code:null!==(I=null==e?void 0:e.postal_code)&&void 0!==I?I:void 0,city:(0,o.default)(null==e?void 0:e.city,"importerAddress?.city"),region:null!==(w=null==e?void 0:e.region)&&void 0!==w?w:void 0,country_code:(0,o.default)(null==e?void 0:e.country_code,"importerAddress?.country_code")}}}return b};var i=r(n(81109)),a=r(n(506479)),o=r(n(145095)),s=(n(801321),n(509978)),l=n(109581),c=n(906822);const u=["status_info","sale_price","availability","compliance_info"];const d={AVAILABILITY_INSTOCK:c.ProductAvailability.IN_STOCK,AVAILABILITY_OUTOFSTOCK:c.ProductAvailability.OUT_OF_STOCK}},732624:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCatalogEventLogger=t.GRAPHQL_CATALOG_ENDPOINT=void 0;var i=r(n(11339));const a=i.default.GRAPHQL_CATALOG_ENDPOINT;t.GRAPHQL_CATALOG_ENDPOINT=a;t.createCatalogEventLogger=e=>{const t=new i.default.GraphqlCatalogRequest({graphqlCatalogEndpoint:e});return{success:()=>{t.set({graphqlErrorCode:-1,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.SUCCESS}),t.commit()},failure:e=>{let[n]=e;t.set({graphqlErrorCode:n.code,graphqlRequestResult:i.default.GRAPHQL_REQUEST_RESULT.FAILURE}),t.commit()}}}},409465:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionReorderOutOfSyncError=t.CollectionReorderError=void 0,t.appealCollection=function(){return P.apply(this,arguments)},t.createCollection=function(){return v.apply(this,arguments)},t.deleteCollection=function(){return C.apply(this,arguments)},t.editCollection=function(){return A.apply(this,arguments)},t.querySingleCollectionIQ=t.queryCollectionsIQ=t.parseCollectionStatusInfoNode=void 0,t.reorderCollection=function(){return w.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(640265),s=n(831914),l=n(471914),c=n(492574),u=n(413335),d=n(696055),p=n(408139);const f=e=>{var t,n,r;return{status:e.child("status").contentString(),canAppeal:"true"===(null===(t=e.maybeChild("can_appeal"))||void 0===t?void 0:t.contentString().toLowerCase()),rejectReason:null===(n=e.maybeChild("reject_reason"))||void 0===n?void 0:n.contentString(),commerceUrl:null===(r=e.maybeChild("commerce_url"))||void 0===r?void 0:r.contentString()}};t.parseCollectionStatusInfoNode=f;const _=e=>{var t;const n=e.maybeChild("status_info"),r=n?f(n):void 0,i=(null==r?void 0:r.status)||"APPROVED",a=!!r&&r.canAppeal,o={id:e.child("id").contentString(),name:e.child("name").contentString(),isHidden:"TRUE"===(null===(t=e.maybeChild("is_hidden"))||void 0===t?void 0:t.contentString()),rejectReason:null==r?void 0:r.rejectReason,commerceUrl:null==r?void 0:r.commerceUrl,totalItemsCount:0,products:[],reviewStatus:i,canAppeal:a};return e.forEachChildWithTag("product",(e=>{o.products.push((0,u.parseProductNode)(e))})),o},h=new l.WapParser("collectionsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collections"),n=[];t.forEachChildWithTag("collection",(e=>{n.push(_(e))}));const r=t.child("paging").child("after"),i=r.hasContent()?r.contentString():"";return{collections:n,afterCursor:i}})),g=function(){var e=(0,i.default)((function*(e){let{catalogWid:t,afterCursor:n,limit:r,productsCount:i,width:o,height:l,directConnectionEncryptedInfo:u=null}=e;if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const f=n?(0,s.wap)("after",null,n):void 0,_=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,s.generateId)(),smax_id:"35"},(0,s.wap)("collections",{biz_jid:(0,d.DEVICE_JID)(t)},(0,s.wap)("collection_limit",null,r.toString()),(0,s.wap)("item_limit",null,i.toString()),(0,s.wap)("width",null,o.toString()),(0,s.wap)("height",null,l.toString()),f,u?(0,s.wap)("direct_connection_encrypted_info",null,u):null)),g=yield(0,a.sendIq)(_,h);if(g.success)return g.result;if(404===g.errorCode)return{collections:[],afterCursor:""};if(451===g.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(g.errorCode)}));return function(){return e.apply(this,arguments)}}();t.queryCollectionsIQ=g;const m=new l.WapParser("singleCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),n=_(t),r=t.child("paging").child("after");return{collections:[n],afterCursor:r.hasContent()?r.contentString():""}})),y=function(){var e=(0,i.default)((function*(e){let{catalogWid:t,collectionId:n,afterCursor:r,limit:i,width:o,height:l,directConnectionEncryptedInfo:u=null}=e;if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const f=r?(0,s.wap)("after",null,r):void 0,_=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,s.generateId)(),smax_id:"30"},(0,s.wap)("collection",{biz_jid:(0,d.DEVICE_JID)(t),id:(0,s.CUSTOM_STRING)(n)},(0,s.wap)("limit",null,i.toString()),(0,s.wap)("width",null,o.toString()),(0,s.wap)("height",null,l.toString()),f,u?(0,s.wap)("direct_connection_encrypted_info",null,u):null)),h=yield(0,a.sendIq)(_,m);if(h.success)return h.result;if(451===h.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(h.errorCode)}));return function(){return e.apply(this,arguments)}}();t.querySingleCollectionIQ=y;const S=new l.WapParser("createOrEditCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("collection"),n=t.child("id").contentString(),r=t.maybeChild("status_info");return{id:n,reviewStatus:r?f(r).status:"APPROVED"}})),E=new l.WapParser("createOrEditCollectionResponseErrorParser",(e=>{const t=e.attrString("code"),n=e.attrString("text"),r=e.maybeChild("field");return{code:t,text:n,fieldName:null==r?void 0:r.attrString("name"),fieldReason:null==r?void 0:r.attrString("reason")}}));function v(){return(v=(0,i.default)((function*(e,t,n){if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const r=[];r.push((0,s.wap)("name",null,e)),r.push(...t.map((e=>(0,s.wap)("product",null,(0,s.wap)("id",null,e))))),r.push((0,s.wap)("catalog_session_id",null,n));const i=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,s.generateId)(),smax_id:"36"},(0,s.wap)("collection",{op:"create"},r)),o=yield(0,a.sendIqErrorParser)(i,S,E);if(o.success)return o.result;if(451===o.errorCode)throw new c.E451;throw o.customError}))).apply(this,arguments)}const T=new l.WapParser("deleteCollectionResponse",(e=>{e.assertTag("iq");const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function C(){return(C=(0,i.default)((function*(e,t){if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const n=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,s.generateId)(),smax_id:"43"},(0,s.wap)("collections",{op:"delete"},(0,s.wap)("id",null,e),(0,s.wap)("catalog_session_id",null,t))),r=yield(0,a.sendIq)(n,T);if(!r.success){if(451===r.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(r.errorCode)}if(!r.result)throw new c.ServerStatusCodeError(500)}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,r,i,o){if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const l=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,type:"set",xmlns:"w:biz:catalog",id:(0,s.generateId)(),smax_id:"40"},(0,s.wap)("collection",{op:"update"},(0,s.wap)("id",null,e),t?(0,s.wap)("name",null,t):void 0,r.length>0?(0,s.wap)("add",null,r.map((e=>(0,s.wap)("id",null,e)))):void 0,i.length>0?(0,s.wap)("remove",null,i.map((e=>(0,s.wap)("id",null,e)))):void 0,(0,s.wap)("catalog_session_id",null,o))),u=yield(0,a.sendIqErrorParser)(l,S,E);if(u.success)return u.result;if(451===u.errorCode)throw new c.E451;throw u.customError}))).apply(this,arguments)}const b=new l.WapParser("appealCollectionResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));function P(){return(P=(0,i.default)((function*(e,t){if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const n=t?(0,s.wap)("reason",null,t):void 0,r=(0,s.wap)("iq",{id:(0,s.generateId)(),to:s.S_WHATSAPP_NET,xmlns:"w:biz:catalog",type:"set",smax_id:"48"},(0,s.wap)("collection",{op:"appeal",id:(0,s.CUSTOM_STRING)(e)},n)),i=yield(0,a.sendIq)(r,b);if(i.success)return i.result;if(451===i.errorCode)throw new c.E451;throw new c.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}const O=new l.WapParser("reorderCollectionResponse",(e=>{e.assertTag("iq");const t=e.maybeChild("response");return null!=(null==t?void 0:t.maybeChild("success"))}));class M extends((0,o.customError)("CollectionReorderError",!0,Error)){constructor(){super("CollectionReorderError")}}t.CollectionReorderError=M;const I=n(76672)({ProductOutOfOrder:457,IndexOutOfBound:458});function w(){return(w=(0,i.default)((function*(e){if((0,p.commerceFeaturesDisabledBySanctions)())throw new c.E451;const t=(0,s.wap)("iq",{id:(0,s.generateId)(),to:s.S_WHATSAPP_NET,xmlns:"w:biz:catalog",type:"set",smax_id:"92"},(0,s.wap)("collections",{op:"update"},(0,s.wap)("move",null,e.map((e=>{let[t,n,r]=e;return(0,s.wap)("id",{from_index:(0,s.CUSTOM_STRING)(n.toString()),to_index:(0,s.CUSTOM_STRING)(r.toString())},t)}))))),n=yield(0,a.sendIq)(t,O);if(n.success)return n.result;if(451===n.errorCode)throw new c.E451;if([I.IndexOutOfBound,I.ProductOutOfOrder].includes(n.errorCode))throw new M;throw new c.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}t.CollectionReorderOutOfSyncError=I},615925:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(348926)),o=n(736184),s=r(n(653872)),l=n(831914),c=n(471914),u=n(492574),d=n(413335),p=n(907779),f=n(732624),_=n(696055),h=n(248089),g=n(408139),m=n(801321),y=n(978820);const S=new c.WapParser("catalogResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog"),n=[];t.forEachChildWithTag("product",(e=>{e.maybeChild("id")&&n.push((0,d.parseProductNode)(e))}));const r=t.child("paging"),i=r.child("before"),a=i.hasContent()?i.contentString():"",o=r.child("after"),s=o.hasContent()?o.contentString():"";return{data:n,paging:{cursors:{after:s,before:a}}}}));const E=function(){var e=(0,a.default)((function*(e){let{catalogWid:t,afterCursor:n,limit:r,width:i,height:a,checkmarkCollectionId:s,allowShopSource:c,directConnectionEncryptedInfo:d=null}=e;if((0,g.commerceFeaturesDisabledBySanctions)())throw new u.E451;const p=n?(0,l.wap)("after",null,n):void 0,f=s?(0,l.wap)("belongs_to",null,(0,l.wap)("collection_id",null,s)):void 0,h=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,l.generateId)()},(0,l.wap)("product_catalog",{jid:(0,_.DEVICE_JID)(t),allow_shop_source:(m=c,m?"true":"false")},(0,l.wap)("limit",null,r.toString()),(0,l.wap)("width",null,i.toString()),(0,l.wap)("height",null,a.toString()),p,f,d?(0,l.wap)("direct_connection_encrypted_info",null,d):null));var m;const y=yield(0,o.sendIq)(h,S);if(y.success)return y.result;if(451===y.errorCode)throw new u.E451;throw new u.ServerStatusCodeError(y.errorCode)}));return function(){return e.apply(this,arguments)}}(),v=function(){var e=(0,a.default)((function*(e){if((0,g.commerceFeaturesDisabledBySanctions)())throw new u.E451;try{var t,r,a;const{catalogWid:o,afterCursor:s,limit:l,width:c,height:u,checkmarkCollectionId:d,allowShopSource:_,directConnectionEncryptedInfo:h}=e,g=yield(0,m.fetchQuery)(void 0!==i?i:i=n(57973),{request:{product_catalog:{jid:o.toString(),allow_shop_source:_?"ALLOWSHOPSOURCE_TRUE":"ALLOWSHOPSOURCE_FALSE",width:String(c),height:String(u),direct_connection_encrypted_info:h,limit:String(l),after:s,catalog_session_id:d}}},{eventLogger:(0,f.createCatalogEventLogger)(f.GRAPHQL_CATALOG_ENDPOINT.GET_CATALOG)}),{paging:y,products:S}=(null==g||null===(t=g.xwa_product_catalog_get_product_catalog)||void 0===t?void 0:t.product_catalog)||{};return{data:S.map(p.parseProductGraphQL),paging:{cursors:{before:null!==(r=null==y?void 0:y.before)&&void 0!==r?r:"",after:null!==(a=null==y?void 0:y.after)&&void 0!==a?a:""}}}}catch(t){return t instanceof h.GraphQLServerError&&(0,s.default)(t),__LOG__(3)`GraphQL: Failed fetching xwa_product_catalog_get_product_catalog query. Falling back to IQ.`,E(e)}}));return function(){return e.apply(this,arguments)}}();var T=e=>((0,g.graphQLForCatalogM1Enabled)()&&!(0,y.getMaybeMeUser)().equals(e.catalogWid)?v:E)(e);t.default=T},904684:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryCatalogHasCategories=void 0;var i,a=r(n(348926)),o=r(n(653872)),s=n(732624),l=n(248089),c=n(801321);r(n(299805));const u=function(){var e=(0,a.default)((function*(e){let{catalogWid:t,directConnectionEncryptedInfo:r,imageDimensions:a={width:100,height:100},sessionId:u}=e;try{var d;const e=yield(0,c.fetchQuery)(void 0!==i?i:i=n(286631),{request:{categories:{biz_jid:t.toString(),direct_connection_encrypted_info:r,image_dimensions:a,catalog_session_id:u}}},{eventLogger:(0,s.createCatalogEventLogger)(s.GRAPHQL_CATALOG_ENDPOINT.GET_CATEGORIES)});return Boolean(null==e||null===(d=e.xwa_product_catalog_get_categories)||void 0===d?void 0:d.categories.length)}catch(e){if(e instanceof l.GraphQLServerError){const[t]=e.source.errors||[];if(2498052===(null==t?void 0:t.code))return!1;(0,o.default)(e)}return __LOG__(3)`GraphQL: Failed fetching xwa_product_catalog_get_categories query.`,!1}}));return function(){return e.apply(this,arguments)}}();t.queryCatalogHasCategories=u},681588:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(348926)),o=n(736184),s=r(n(653872)),l=r(n(145095)),c=n(831914),u=n(471914),d=n(492574),p=n(413335),f=n(907779),_=n(732624),h=n(696055),g=n(248089),m=n(408139),y=n(801321),S=n(978820);r(n(299805));const E=new u.WapParser("productResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("product_catalog").child("product");return(0,p.parseProductNode)(t)})),v=function(){var e=(0,a.default)((function*(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;if((0,m.commerceFeaturesDisabledBySanctions)())throw new d.E451;const s=(0,c.wap)("iq",{to:c.S_WHATSAPP_NET,type:"get",xmlns:"w:biz:catalog",id:(0,c.generateId)()},(0,c.wap)("product",{jid:(0,h.DEVICE_JID)(e)},(0,c.wap)("product_id",null,t),(0,c.wap)("width",null,n.toString()),(0,c.wap)("height",null,r.toString()),i?(0,c.wap)("fetch_compliance_info",null,i.toString()):void 0,a?(0,c.wap)("direct_connection_encrypted_info",null,a):null)),l=yield(0,o.sendIq)(s,E);if(l.success)return{data:l.result};if(404===l.errorCode)return{error:"NOT_FOUND"};throw 451===l.errorCode?new d.E451:new d.ServerStatusCodeError(l.errorCode)}));return function(){return e.apply(this,arguments)}}(),T=function(){var e=(0,a.default)((function*(){if((0,m.commerceFeaturesDisabledBySanctions)())throw new d.E451;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const[a,o,c,u,p=!1,h=null]=t;try{var S,E;const e=yield(0,y.fetchQuery)(void 0!==i?i:i=n(803349),{request:{product:{jid:a.toString(),product_id:o,width:String(c),height:String(u),fetch_compliance_info:String(p),direct_connection_encrypted_info:h}}},{eventLogger:(0,_.createCatalogEventLogger)(_.GRAPHQL_CATALOG_ENDPOINT.GET_PRODUCT)}),t=(0,l.default)(null==e||null===(S=e.xwa_product_catalog_get_product)||void 0===S||null===(E=S.product_catalog)||void 0===E?void 0:E.product,"data?.xwa_product_catalog_get_product?.product_catalog?.product");return{data:(0,f.parseProductGraphQL)(t)}}catch(e){if(e instanceof g.GraphQLServerError){var T;const[t]=(null===(T=e.source)||void 0===T?void 0:T.errors)||[];if(2498052===(null==t?void 0:t.code))return{error:"NOT_FOUND"};(0,s.default)(e)}return __LOG__(3)`GraphQL: Failed fetching xwa_product_catalog_get_product query. Falling back to IQ.`,v(...t)}}));return function(){return e.apply(this,arguments)}}();var C=function(){var e;return((0,m.graphQLForCatalogM1Enabled)()&&!(null===(e=(0,S.getMaybeMeUser)())||void 0===e?void 0:e.equals(arguments.length<=0?void 0:arguments[0]))?T:v)(...arguments)};t.default=C},999909:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(348926)),o=r(n(653872)),s=n(492574),l=n(907779),c=n(732624),u=n(248089),d=n(408139),p=n(409465),f=n(801321),_=n(978820);r(n(299805));const h=function(){var e=(0,a.default)((function*(e){if((0,d.commerceFeaturesDisabledBySanctions)())throw new s.E451;try{const{catalogWid:t,afterCursor:r,limit:a,productsCount:o,width:s,height:u,directConnectionEncryptedInfo:d}=e,p=yield(0,f.fetchQuery)(void 0!==i?i:i=n(652830),{request:{collections:{biz_jid:t.toString(),collection_limit:String(a),item_limit:String(o),after:r,width:String(s),height:String(u),direct_connection_encrypted_info:d}}},{eventLogger:(0,c.createCatalogEventLogger)(c.GRAPHQL_CATALOG_ENDPOINT.GET_COLLECTIONS)}),{collections:_,paging:h}=(null==p?void 0:p.xwa_product_catalog_get_collections)||{};return{afterCursor:(null==h?void 0:h.after)||"",collections:_.map((e=>{let{id:t,name:n,status_info:r,products:i}=e;return{id:t||"",name:n||"",canAppeal:"true"===(null==r?void 0:r.can_appeal),isHidden:!1,reviewStatus:(null==r?void 0:r.status)||"APPROVED",totalItemsCount:0,products:i.map(l.parseProductGraphQL),rejectReason:null==r?void 0:r.reject_reason,commerceUrl:null==r?void 0:r.commerce_url}}))}}catch(n){if(n instanceof u.GraphQLServerError){var t;const[e]=(null===(t=n.source)||void 0===t?void 0:t.errors)||[];if(2498052===(null==e?void 0:e.code))return{collections:[],afterCursor:""};(0,o.default)(n)}return __LOG__(3)`GraphQL: Failed fetching xwa_product_catalog_get_collections query. Falling back to IQ.`,(0,p.queryCollectionsIQ)(e)}}));return function(){return e.apply(this,arguments)}}(),g=e=>{let{catalogWid:t}=e;return(0,d.graphQLForCollectionM2Enabled)()&&!(0,_.getMaybeMeUser)().equals(t)};var m=function(){return(g(...arguments)?h:p.queryCollectionsIQ)(...arguments)};t.default=m},79622:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,a=r(n(348926)),o=r(n(653872)),s=n(492574),l=n(907779),c=n(732624),u=n(248089),d=n(408139),p=n(409465),f=n(801321),_=n(978820);const h=function(){var e=(0,a.default)((function*(e){if((0,d.commerceFeaturesDisabledBySanctions)())throw new s.E451;try{const{catalogWid:t,collectionId:r,afterCursor:a,limit:o,width:s,height:u,directConnectionEncryptedInfo:d}=e,p=yield(0,f.fetchQuery)(void 0!==i?i:i=n(486686),{request:{collection:{biz_jid:t.toString(),id:r,limit:String(o),after:a,width:String(s),height:String(u),direct_connection_encrypted_info:d}}},{eventLogger:(0,c.createCatalogEventLogger)(c.GRAPHQL_CATALOG_ENDPOINT.GET_SINGLE_COLLECTION)}),{collection:_,paging:h}=(null==p?void 0:p.xwa_product_catalog_get_single_collection)||{},{id:g,name:m,status_info:y,products:S}=_||{};return{afterCursor:(null==h?void 0:h.after)||"",collections:[{id:g||"",name:m||"",canAppeal:"true"===(null==y?void 0:y.can_appeal),isHidden:!1,reviewStatus:(null==y?void 0:y.status)||"APPROVED",totalItemsCount:0,products:S.map(l.parseProductGraphQL),rejectReason:null==y?void 0:y.reject_reason,commerceUrl:null==y?void 0:y.commerce_url}]}}catch(t){return t instanceof u.GraphQLServerError&&(0,o.default)(t),__LOG__(3)`GraphQL: Failed fetching xwa_product_catalog_get_single_collection query. Falling back to IQ.`,(0,p.querySingleCollectionIQ)(e)}}));return function(){return e.apply(this,arguments)}}(),g=e=>{let{catalogWid:t}=e;return(0,d.graphQLForCollectionM2Enabled)()&&!(0,_.getMaybeMeUser)().equals(t)};var m=function(){return(g(...arguments)?h:p.querySingleCollectionIQ)(...arguments)};t.default=m},559175:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055),u=n(408139);const d=new s.WapParser("reportProductResponse",(e=>{e.assertTag("iq"),e.assertAttr("type","result")}));function p(){return(p=(0,i.default)((function*(e,t,n){if((0,u.commerceFeaturesDisabledBySanctions)())throw new l.E451;const r=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",type:"set",id:(0,o.generateId)()},(0,o.wap)("request",{type:"report_product",biz_jid:(0,c.USER_JID)(e)},n?(0,o.wap)("reason",null,n):void 0,(0,o.wap)("id",null,t))),i=yield(0,a.sendIq)(r,d);if(!i.success){if(451===i.errorCode)throw new l.E451;throw new l.ServerStatusCodeError(i.errorCode)}}))).apply(this,arguments)}},286631:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"WAWebQueryCatalogHasCategoriesQuery",selections:r=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetCategoriesResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_categories",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetCategoriesResponseSuccessCategoryWithSubCategories",kind:"LinkedField",name:"categories",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"WAWebQueryCatalogHasCategoriesQuery",selections:r},params:{id:"WAWebQueryCatalogHasCategoriesQuery",metadata:{},name:"WAWebQueryCatalogHasCategoriesQuery",operationKind:"query",text:null}};var n,r;t.hash="05cf640c4ace8fe9368dfe9c9768bcd9",e.exports=t},803349:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"WAWebQueryCatalogProductQuery",selections:a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetProductResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogGetProductResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWACatalogProduct",kind:"LinkedField",name:"product",plural:!1,selections:[r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_available",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"WAWebQueryCatalogProductQuery",selections:a},params:{id:"WAWebQueryCatalogProductQuery",metadata:{},name:"WAWebQueryCatalogProductQuery",operationKind:"query",text:null}};var n,r,i,a;t.hash="1cfd9c20421504c7dcc5c2a615b9ea63",e.exports=t},57973:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"WAWebQueryCatalogQuery",selections:a=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_product_catalog",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogGetResponseSuccessProductCatalog",kind:"LinkedField",name:"product_catalog",plural:!1,selections:[{alias:null,args:null,concreteType:"XWACatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_available",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWACatalogPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"WAWebQueryCatalogQuery",selections:a},params:{id:"WAWebQueryCatalogQuery",metadata:{},name:"WAWebQueryCatalogQuery",operationKind:"query",text:null}};var n,r,i,a;t.hash="66429da6768590d7b59a5cb5971ac827",e.exports=t},652830:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"WAWebQueryProductCollectionsQuery",selections:l=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetCollectionsResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_collections",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},{alias:null,args:null,concreteType:"XWACatalogProductCollection",kind:"LinkedField",name:"collections",plural:!0,selections:[r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogCollectionStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[a={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"reject_reason",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commerce_url",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWACatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_available",storageKey:null},i,{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[o,a],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWACatalogPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"WAWebQueryProductCollectionsQuery",selections:l},params:{id:"WAWebQueryProductCollectionsQuery",metadata:{},name:"WAWebQueryProductCollectionsQuery",operationKind:"query",text:null}};var n,r,i,a,o,s,l;t.hash="12a9551193361530e95abb2b4c1b32a4",e.exports=t},486686:e=>{"use strict";const t={fragment:{argumentDefinitions:n=[{defaultValue:null,kind:"LocalArgument",name:"request"}],kind:"Fragment",metadata:null,name:"WAWebQueryProductSingleCollectionQuery",selections:l=[{alias:null,args:[{kind:"Variable",name:"request",variableName:"request"}],concreteType:"XWAProductCatalogGetSingleCollectionResponseSuccess",kind:"LinkedField",name:"xwa_product_catalog_get_single_collection",plural:!1,selections:[{alias:null,args:null,concreteType:"XWACatalogProductCollection",kind:"LinkedField",name:"collection",plural:!1,selections:[r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogCollectionStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[a={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"can_appeal",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"reject_reason",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commerce_url",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWACatalogProduct",kind:"LinkedField",name:"products",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"retailer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"availability",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_available",storageKey:null},i,{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"price",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductStatusInfo",kind:"LinkedField",name:"status_info",plural:!1,selections:[o,a],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductSalePrice",kind:"LinkedField",name:"sale_price",plural:!1,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"start_date",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"end_date",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductMedia",kind:"LinkedField",name:"media",plural:!1,selections:[{alias:null,args:null,concreteType:"XWAProductCatalogProductMediaImage",kind:"LinkedField",name:"images",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"original_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_image_url",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"belongs_to",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"compliance_category",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfo",kind:"LinkedField",name:"compliance_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"country_code_origin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"importer_name",storageKey:null},{alias:null,args:null,concreteType:"XWAProductCatalogProductComplianceInfoImporterAddress",kind:"LinkedField",name:"importer_address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"street1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"street2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XWACatalogPaging",kind:"LinkedField",name:"paging",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"after",storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:n,kind:"Operation",name:"WAWebQueryProductSingleCollectionQuery",selections:l},params:{id:"WAWebQueryProductSingleCollectionQuery",metadata:{},name:"WAWebQueryProductSingleCollectionQuery",operationKind:"query",text:null}};var n,r,i,a,o,s,l;t.hash="04369b38de2207faebf29136d50b8819",e.exports=t},461561:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCoverPhoto=function(){return h.apply(this,arguments)},t.editBusinessProfile=function(){return f.apply(this,arguments)},t.sendCoverPhoto=function(){return _.apply(this,arguments)},t.updateCartEnabled=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574);const c=new s.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer()})),u=new s.WapParser("commerceSettingsResponse",(e=>{e.assertTag("iq"),e.assertFromServer();return"true"===e.child("commerce_settings").child("cart").attrString("enabled")}));function d(e){let{note:t,timezone:n,config:r}=e;const i=[];for(const e in r){const t=r[e],{mode:n,hours:a}=t;if(a)for(const[t,r]of a)i.push({day_of_week:e,mode:n,open_time:t,close_time:r});else i.push({day_of_week:e,mode:n})}const a=[];return t&&a.push((0,o.wap)("business_hours_note",null,t)),a.push(...i.map((e=>(0,o.wap)("business_hours_config",{day_of_week:(0,o.CUSTOM_STRING)(e.day_of_week),mode:e.mode,open_time:e.open_time?(0,o.CUSTOM_STRING)(e.open_time.toString()):o.DROP_ATTR,close_time:e.close_time?(0,o.CUSTOM_STRING)(e.close_time.toString()):o.DROP_ATTR})))),(0,o.wap)("business_hours",{timezone:n?(0,o.CUSTOM_STRING)(n):o.DROP_ATTR},a)}function p(){return(p=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,smax_id:"25",xmlns:"fb:thrift_iq",id:(0,o.generateId)(),type:"set"},(0,o.wap)("commerce_settings",null,(0,o.wap)("cart",{enabled:(0,o.CUSTOM_STRING)(e.toString())}))),n=yield(0,a.sendIq)(t,u);if(n.success)return n.result;throw new l.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){let{address:t,description:n,categories:r,email:i,website:s,businessHours:u}=e;const p=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,o.generateId)(),type:"set"},(0,o.wap)("business_profile",{v:"3",mutation_type:"delta"},void 0!==t?(0,o.wap)("address",null,t):null,void 0!==n?(0,o.wap)("description",null,n):null,void 0!==i?(0,o.wap)("email",null,i):null,s&&0===s.length?(0,o.wap)("website",null):null,s&&s.length>0?(0,o.wap)("website",null,s[0]):null,s&&s.length>1?(0,o.wap)("website",null,s[1]):null,r?(0,o.wap)("categories",null,r.map((e=>(0,o.wap)("category",{id:(0,o.CUSTOM_STRING)(e.id)})))):null,u?d(u):null)),f=yield(0,a.sendIq)(p,c);if(!f.success)throw new l.ServerStatusCodeError(f.errorCode)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n){const r=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,o.generateId)(),type:"set"},(0,o.wap)("business_profile",{v:"3",mutation_type:"delta"},(0,o.wap)("cover_photo",{op:"update",id:(0,o.CUSTOM_STRING)(e.toString()),ts:(0,o.CUSTOM_STRING)(t.toString()),token:(0,o.CUSTOM_STRING)(n)}))),i=yield(0,a.sendIq)(r,c);if(!i.success)throw new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,o.generateId)(),type:"set"},(0,o.wap)("business_profile",{v:"3",mutation_type:"delta"},(0,o.wap)("cover_photo",{op:"delete",id:(0,o.CUSTOM_STRING)(e.toString())}))),n=yield(0,a.sendIq)(t,c);if(!n.success)throw new l.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}},51486:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMerchantCompliance=function(){return f.apply(this,arguments)},t.setMerchantCompliance=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=n(736184),s=n(831914),l=n(471914),c=n(492574),u=n(696055);const d=e=>{var t,n,r;return{email:(null==e||null===(t=e.maybeChild("email"))||void 0===t?void 0:t.contentString())||"",landline_number:(null==e||null===(n=e.maybeChild("landline_number"))||void 0===n?void 0:n.contentString())||"",mobile_number:(null==e||null===(r=e.maybeChild("mobile_number"))||void 0===r?void 0:r.contentString())||""}},p=new l.WapParser("merchantComplianceResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.forEachChildWithTag("merchant_info",(e=>{var n,r,i,o;const s=(null===(n=e.maybeChild("entity_name"))||void 0===n?void 0:n.contentString())||"",l=(null===(r=e.maybeChild("entity_type"))||void 0===r?void 0:r.contentString())||"",c=null===(i=e.maybeChild("entity_type_custom"))||void 0===i?void 0:i.contentString(),u="true"===e.attrString("is_registered"),p=e.maybeChild("customer_care_details"),f=e.maybeChild("grievance_officer_details"),_=(0,a.default)({},d(p)),h=(0,a.default)({name:(null==f||null===(o=f.maybeChild("name"))||void 0===o?void 0:o.contentString())||""},d(f));t.push({entity_name:s,entity_type:l,is_registered:u,entity_type_custom:c,customer_care_details:_,grievance_officer_details:h})})),t}));function f(){return(f=(0,i.default)((function*(e){const t=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,s.generateId)(),type:"get",smax_id:"53"},e.map((e=>(0,s.wap)("merchant_info",{jid:(0,u.USER_JID)(e.wid)})))),n=yield(0,o.sendIq)(t,p);if(n.success)return n.result;throw new c.ServerStatusCodeError(n.errorCode)}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){let{entityName:e,entityType:t,isRegistered:n,entityTypeCustom:r,customerCareDetails:i,grievanceOfficerDetails:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const l=(0,s.wap)("iq",{to:s.S_WHATSAPP_NET,xmlns:"w:biz:merchant_info",id:(0,s.generateId)(),type:"set",smax_id:"54"},(0,s.wap)("merchant_info",{is_registered:n?"true":"false"},void 0!==e?(0,s.wap)("entity_name",null,e):null,void 0!==t?(0,s.wap)("entity_type",null,t):null,void 0!==r?(0,s.wap)("entity_type_custom",null,r):null,i?(0,s.wap)("customer_care_details",null,void 0!==i.email?(0,s.wap)("email",null,i.email):null,void 0!==i.landlineNumber?(0,s.wap)("landline_number",null,i.landlineNumber):null,void 0!==i.mobileNumber?(0,s.wap)("mobile_number",null,i.mobileNumber):null):null,a?(0,s.wap)("grievance_officer_details",null,void 0!==a.name?(0,s.wap)("name",null,a.name):null,void 0!==a.email?(0,s.wap)("email",null,a.email):null,void 0!==a.landlineNumber?(0,s.wap)("landline_number",null,a.landlineNumber):null,void 0!==a.mobileNumber?(0,s.wap)("mobile_number",null,a.mobileNumber):null):null)),u=yield(0,o.sendIq)(l,p);if(u.success)return u.result;throw new c.ServerStatusCodeError(u.errorCode)}))).apply(this,arguments)}},545063:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574);const c=new s.WapParser("businessCategoriesResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("response"),n=[];let r="";try{const e=t.maybeChild("not_a_biz");null==e||e.forEachChildWithTag("category",(e=>{r=e.attrString("id")}));t.child("categories").forEachChildWithTag("category",(e=>{const t=e.attrString("id"),i=e.contentString();n.push({id:t,localized_display_name:i,not_a_biz:!!r.length&&t===r})}))}catch(e){}return{categories:n,notABizId:r}}));function u(){return(u=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t?"profile_typeahead":"typeahead",r=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"fb:thrift_iq",id:(0,o.generateId)(),type:"get"},(0,o.wap)("request",{op:(0,o.CUSTOM_STRING)(n),type:"catkit",v:"1"},(0,o.wap)("query",null,e))),i=yield(0,a.sendIq)(r,c);if(i.success)return i.result;throw new l.ServerStatusCodeError(i.errorCode)}))).apply(this,arguments)}},32428:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=r(n(876972)),u=n(696055),d=n(181663);const p=new s.WapParser("businessProfileResponse",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("business_profile"),n=[];return t.forEachChildWithTag("profile",(e=>{const t=(0,d.jidWithTypeToWid)(e.attrJidWithType("jid")),r=e.attrString("tag"),i=(0,c.default)(e);Object.keys(i).length?n.push({wid:t,tag:r,profile:i}):n.push({wid:t,tag:r})})),n}));function f(){return(f=(0,i.default)((function*(e,t){const n=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"w:biz",id:(0,o.generateId)(),type:"get"},(0,o.wap)("business_profile",{v:(0,o.INT)(t)},e.map((e=>(0,o.wap)("profile",{jid:(0,u.USER_JID)(e.wid),tag:null!=e.tag?(0,o.INT)(e.tag):o.DROP_ATTR}))))),r=yield(0,a.sendIq)(n,p);if(r.success)return r.result;throw new l.ServerStatusCodeError(r.errorCode)}))).apply(this,arguments)}},260976:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryTosState=function(){return u.apply(this,arguments)},t.resetTosState=function(){return d.apply(this,arguments)},t.updateTosState=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574);const c=new s.WapParser("tosNotices",(e=>{e.assertTag("iq"),e.assertFromServer();const t=e.child("tos"),n={refresh:t.attrInt("refresh"),notice:[]};return t.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),r=e.attrString("id");n.notice.push({id:r,state:t})})),(n.refresh>259200||n.refresh<7200)&&(n.refresh=86400),n}));function u(){return(u=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{xmlns:"tos",id:(0,o.generateId)(),type:"get",to:o.S_WHATSAPP_NET},(0,o.wap)("request",null,e.map((e=>(0,o.wap)("notice",{id:(0,o.CUSTOM_STRING)(e)}))))),n=yield(0,a.sendIq)(t,c);if(n.success)return n.result;throw new l.ServerStatusCodeError(n.errorCode,n.errorText)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=new s.WapParser("tosNoticesSet",(()=>{})),n=(0,o.wap)("iq",{xmlns:"tos",id:(0,o.generateId)(),type:"set",to:o.S_WHATSAPP_NET},(0,o.wap)("request",{type:"session_update"},e.map((e=>(0,o.wap)("notice",{id:(0,o.CUSTOM_STRING)(e)})))));yield(0,a.sendIq)(n,t)}))).apply(this,arguments)}},145823:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleAboutNotification=function(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){switch(__LOG__(2)`handleAboutNotification: received ${e.type}
for ${e.from.toString()}`,e.type){case u.SIDE_LIST_CHANGE:break;case u.CHANGE:const t=c.StatusCollection.get(e.from);t?t.status=e.content:__LOG__(3)`handleAboutNotification: get status update for unknown contact ${e.from}`;break;default:__LOG__(3)`handleAboutNotification: unhandled notification of
type ${e.type}`}return(0,a.wap)("ack",{id:(0,a.CUSTOM_STRING)(e.stanzaId),to:"change"===e.type?(0,s.JID)(e.from):(0,a.CUSTOM_STRING)(e.from),class:"notification",type:"status"})}(t.success)};var i=r(n(81109)),a=n(831914),o=n(471914),s=n(696055),l=n(181663),c=n(46133);const u=Object.freeze({CHANGE:"change",SIDE_LIST_CHANGE:"sideListChange",UNKNOWN:"unknown"});t.NOTIFICATION_TYPE=u;const d=new o.WapParser("incomingAboutNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id")},n=e.hasChild("set")&&e.child("set");if(n&&!n.hasAttr("hash"))return(0,i.default)({type:u.CHANGE,from:(0,l.userJidToUserWid)(e.attrUserJid("from")),pushname:e.attrString("notify"),content:n.contentString(),ts:e.attrTime("t")},t);let r=u.UNKNOWN;return n&&n.hasAttr("hash")&&(r=u.SIDE_LIST_CHANGE),(0,i.default)({type:r,from:e.attrString("from")},t)}))},440126:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndUpdateStatus=I,t.getDeviceSyncInputs=R,t.handleAccountSyncNotification=function(){return L.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=n(252230),s=n(831914),l=n(471914),c=n(227101),u=n(970467),d=n(88555),p=n(781572),f=n(696055),_=r(n(238383)),h=n(887935),g=n(468728),m=n(181663),y=n(978820),S=n(745454),E=r(n(869153)),v=n(528237),T=n(640623),C=n(572841),A=n(46133),b=n(991036),P=n(446308);const O=e=>{const t=e.maybeChild("key-index-list"),n=null==t?null:{ts:t.attrTime("ts"),signedKeyIndexBytes:t.hasContent()?t.contentBytes():null,expectedTs:t.hasAttr("expected_ts")?t.attrTime("expected_ts"):void 0},r=e.mapChildrenWithTag("device",(e=>({id:(0,S.createWid)(e.attrDeviceJid("jid")).device||o.DEFAULT_DEVICE_ID,keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null})));return 0===r.length?null:{deviceList:r,keyIndex:n}},M=new l.WapParser("incomingAccountSyncNotification",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),ts:e.attrTime("t"),from:(0,m.deviceJidToDeviceWid)(e.attrDeviceJid("from"))};if(e.hasChild("status")){const n=e.child("status"),r=n.hasAttr("action")?n.attrString("action"):void 0;return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.STATUS,action:r},t)}if(e.hasChild("privacy"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.PRIVACY},t);if(e.hasChild("devices"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.DEVICES,devices:O(e.child("devices"))},t);if(e.hasChild("blocklist"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.BLOCKLIST},t);if(e.hasChild("picture"))return(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.PICTURE},t);if(e.hasChild("tos")){const n=e.child("tos"),r=[];return n.forEachChildWithTag("notice",(e=>{const t="false"!==e.maybeAttrString("state"),n=e.attrString("id");r.push({id:n,state:t})})),(0,a.default)({type:u.ACCOUNT_SYNC_TYPE.TOS,notices:r},t)}if(e.hasChild("disappearing_mode")){const n=e.child("disappearing_mode");let r,i,o;return n.hasAttr("action")?r=n.attrString("action"):(i=n.attrInt("duration"),o=n.attrInt("t")),(0,a.default)((0,a.default)({},t),{},{type:u.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE,action:r,disappearingModeDuration:i,disappearingModeSettingTimestamp:o})}throw e.createParseError("notification type not supported")}));function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(){const e=(0,y.assertGetMe)(),t=yield(0,_.default)(e);if(t.error)return __LOG__(3)`getStatus failed for ${e}: failed ${t.error.errorCode} : ${t.error.errorText}`,Promise.reject(t.error.errorText);const n=t.status;n&&(A.StatusCollection.assertGet((0,y.getMaybeMeUser)()).status=n)}))).apply(this,arguments)}function R(){return N.apply(this,arguments)}function N(){return(N=(0,i.default)((function*(e){let{wid:t,devices:n}=e;const r=(0,y.getMaybeMeLidUser)(),i={wid:t,devices:n};if(null==r)return[i];const a=(0,y.getMeUser)();if(!t.isSameAccount(a))return __LOG__(4,void 0,new Error,!0)`wid-is-not-self`,SEND_LOGS("wid-is-not-self"),[i];const[o,s]=yield T.waSignalStore.bulkGetIdentity([(0,C.createSignalAddress)(a).toString(),(0,C.createSignalAddress)(r).toString()]);return null==s&&null!=o&&(yield T.waSignalStore.putIdentity((0,C.createSignalAddress)(r).toString(),o)),[i,{wid:r,devices:n}]}))).apply(this,arguments)}function L(){return(L=(0,i.default)((function*(e){const t=M.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,r=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n.stanzaId),to:(0,f.JID)(n.from),class:"notification",type:"account_sync"});switch(n.type){case u.ACCOUNT_SYNC_TYPE.STATUS:yield I();break;case u.ACCOUNT_SYNC_TYPE.DEVICES:if((0,d.isMDBackend)()){if(!v.OfflineMessageHandler.isResumeFromRestartComplete())return E.default.addOfflinePendingDevice(n.from.toString(),r),"NO_ACK";if(v.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,P.addUserToPendingDeviceSync)([n.from.toString()]),r}const e=n.devices;if(e){const t=yield R({wid:(0,S.toUserWid)(n.from),devices:e});yield(0,g.handleADVDeviceSyncResult)(t)}else yield(0,u.getDevices)("notification");break;case u.ACCOUNT_SYNC_TYPE.PICTURE:yield(0,u.getAndUpdateProfilePicture)();break;case u.ACCOUNT_SYNC_TYPE.PRIVACY:p.Cmd.onAccountSyncForPrivacy(yield(0,u.updatePrivacySettings)());break;case u.ACCOUNT_SYNC_TYPE.BLOCKLIST:(0,u.updateBlocklist)();break;case u.ACCOUNT_SYNC_TYPE.TOS:n.notices&&(0,u.updateTosState)(n.notices);break;case u.ACCOUNT_SYNC_TYPE.DISAPPEARING_MODE:if((0,c.isDisappearingModeEnabled)()){const{action:e,from:t}=n;let r=n.disappearingModeDuration,i=n.disappearingModeSettingTimestamp;if("modify"===e){const e=yield(0,h.getDisappearingMode)(t);null==e.error&&null!=e.disappearingModeDuration&&null!=e.disappearingModeSettingTimestamp&&(r=e.disappearingModeDuration,i=e.disappearingModeSettingTimestamp)}null!=r&&null!=i&&(yield(0,b.updateDisappearingMode)(t,r,i));break}default:__LOG__(2)`account sync notification of type ${n.type} not supported`}return r}))).apply(this,arguments)}},997760:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleVerifiedBusinessNameNotificationContact=function(){return A.apply(this,arguments)},t.handleVerifiedBusinessNameNotificationHash=function(){return C.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=r(n(163619)),c=n(738815),u=r(n(377651)),d=n(696055),p=n(9961),f=n(393170),_=n(719380),h=n(468708),g=n(799069);function m(e,t,n,r,i){const a=_.ContactCollection.get(e);return null!=a&&(0,c.updateContactsWithVerifiedNames)([{id:e,name:n,level:t,isApi:r,privacyMode:i}],[a]),Promise.resolve()}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){yield(0,g.getStorage)().lock(["verified-business-name"],(()=>(0,h.createOrUpdateVerifiedBusinessName)({id:e.wid.user,level:e.level,serial:parseInt(e.serial||"0",10),name:e.verifiedName,isApi:e.isApi,privacyMode:e.privacyMode?{actualActors:e.privacyMode.actualActors,hostStorage:e.privacyMode.hostStorage,privacyModeTs:e.privacyMode.privacyModeTs}:null})));const t=[],n=_.ContactCollection.get(e.wid);null!=n&&t.push((0,l.default)(e.wid,{verifiedName:n.verifiedName,isVerifiedHigh:n.verifiedLevel===f.VERIFIED_LEVEL.HIGH,isBusiness:n.isBusiness,isEnterprise:n.isEnterprise,privacyMode:n.privacyMode},{verifiedName:e.verifiedName,isVerifiedHigh:"high"===e.level,isBusiness:!0,isEnterprise:e.isApi,privacyMode:e.privacyMode})),t.push(m(e.wid,e.level,e.verifiedName,e.isApi,e.privacyMode)),yield Promise.all(t)}))).apply(this,arguments)}const E=new s.WapParser("verifiedNameParser",(e=>(0,u.default)(e.child("verified_name"))));function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"get",xmlns:"w:biz",id:(0,o.generateId)()},(0,o.wap)("verified_name",{jid:(0,d.DEVICE_JID)(e)})),n=yield(0,a.sendIq)(t,E);if(!n.success){if(404===n.errorCode)return void __LOG__(3)`verified name notification not found`;throw new Error("Could not send IQ in retrieveBusinessDetails")}return n.result}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){if("verified_name_hash"!==e.type)throw Error("Invalid notification type");const t=_.ContactCollection.resolveWidsFromHash(e.hash);if(!t)return!1;const n=yield Promise.all(t.map(function(){var e=(0,i.default)((function*(e){return{wid:e,verifiedName:yield v(e)}}));return function(){return e.apply(this,arguments)}}()));return n.length&&(yield Promise.all(n.map((t=>{let{wid:n,verifiedName:r}=t;if(r){const{name:t,level:i,serial:a,isApi:o,privacyMode:s}=r;return y({wid:n,verifiedName:t,level:i,stanzaId:e.stanzaId,ts:e.ts,serial:a,isApi:o,privacyMode:s})}if(void 0===r)return(0,p.handleBusinessRemoval)(n,e.stanzaId,e.ts)})))),!0}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){let{jid:t,stanzaId:n,ts:r,verifiedName:i}=e;const{serial:a="",level:o,isApi:s,privacyMode:l}=i;let c=i.name;var u;if(!c)if(null!=(null===(u=_.ContactCollection.get(t))||void 0===u?void 0:u.verifiedName)){var d;c=(null===(d=_.ContactCollection.get(t))||void 0===d?void 0:d.verifiedName)||""}else{const e=yield v(t);if(!e)return;c=e.name}return y({verifiedName:c,level:o,stanzaId:n,ts:r,wid:t,serial:a,isApi:s,privacyMode:l})}))).apply(this,arguments)}},896429:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessNotification=E,t.handleBusinessNotificationJob=function(e){const t=(0,m.isNotifSchedulerEnabled)()?o.JOB_PRIORITY.LOW:o.JOB_PRIORITY.SKIP;return(0,p.NonPersistJob)("handleBusinessNotification",(e=>E(e.node)),{priority:t}).waitUntilCompleted({node:e})};var i=r(n(348926)),a=r(n(81109)),o=n(524674),s=n(831914),l=n(471914),c=r(n(876972)),u=r(n(377651)),d=n(181663),p=n(879274),f=n(997760),_=n(991337),h=n(9961),g=n(880537),m=n(458464);const y=new l.WapParser("businessNotificationParser",(e=>{e.assertTag("notification");const t={stanzaId:e.attrString("id"),from:e.attrWapJid("from"),ts:e.attrTime("t")};let n;if(e.hasChild("remove"))return n=e.child("remove"),n.hasAttr("jid")?(0,a.default)({type:"remove_jid",jid:(0,d.chatJidToChatWid)(n.attrChatJid("jid"))},t):(0,a.default)({type:"remove_hash",hash:n.attrString("hash")},t);if(e.hasChild("verified_name"))return n=e.child("verified_name"),n.hasAttr("jid")?(0,a.default)({type:"verified_name_jid",jid:(0,d.chatJidToChatWid)(n.attrChatJid("jid")),verifiedName:(0,u.default)(n)},t):(0,a.default)({type:"verified_name_hash",hash:n.attrString("hash")},t);if(e.hasChild("profile")){const n=e.child("profile"),r=n.maybeAttrString("hash");if(r)return(0,a.default)({type:"profile_hash",hash:r},t);const i=(0,c.default)(n);return(0,a.default)({type:"profile",profile:i},t)}if(e.hasChild("product_catalog")){const n=e.child("product_catalog");if(n.hasChild("product")){const e=[];return n.forEachChildWithTag("product",(t=>{const n=t.child("id").contentString();e.push(n)})),(0,a.default)({type:"product",productsIds:e},t)}if(n.hasChild("collection")){const e=[],r=[];return n.forEachChildWithTag("collection",(t=>{if(t.hasChild("status_info")){var n,i;const a={reviewStatus:t.child("status_info").child("status").contentString(),rejectReason:null===(n=t.child("status_info").maybeChild("reject_reason"))||void 0===n?void 0:n.contentString(),commerceUrl:null===(i=t.child("status_info").maybeChild("commerce_url"))||void 0===i?void 0:i.contentString()};e.push(t.attrString("id")),r.push(a)}})),(0,a.default)({type:"collection",collectionIds:e,reviewStatuses:r},t)}}return(0,a.default)({type:"unknown"},t)}));function S(e,t,n){return n?(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e),to:t,class:"notification",type:"business"},(0,s.wap)("user",{side_list:"out"})):(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e),to:t,class:"notification",type:"business"})}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=y.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const n=t.success;switch(n.type){case"verified_name_hash":const e=yield(0,f.handleVerifiedBusinessNameNotificationHash)(n);return S(n.stanzaId,n.from,!e);case"verified_name_jid":return yield(0,f.handleVerifiedBusinessNameNotificationContact)(n),S(n.stanzaId,n.from,!1);case"remove_hash":const t=yield(0,h.handleBusinessRemovalNotificationHash)(n);return S(n.stanzaId,n.from,!t);case"remove_jid":return yield(0,h.handleBusinessRemovalNotificationContact)(n),S(n.stanzaId,n.from,!1);case"profile":return(0,_.handleBusinessProfile)(n),S(n.stanzaId,n.from,!1);case"profile_hash":const r=yield(0,_.handleBusinessProfileHash)(n);return S(n.stanzaId,n.from,!r);case"product":return yield(0,g.handleProductNotification)(n.productsIds),S(n.stanzaId,n.from,!1);case"collection":return yield(0,g.handleCollectionNotification)(n),S(n.stanzaId,n.from,!1);default:return S(n.stanzaId,n.from,!1)}}))).apply(this,arguments)}},991337:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessProfileHash=t.handleBusinessProfile=void 0;var i=r(n(348926)),a=n(978820),o=n(745454),s=n(493581),l=n(794010),c=n(719380);t.handleBusinessProfile=e=>{let{from:t,profile:n}=e;const r=(0,o.createWidFromWidLike)(t.toString()),i=Boolean(s.BusinessProfileCollection.getValid(r)),c=(0,l.parseBusinessProfile)({id:r,profile:n,queryCatalog:!1,customUrlPaths:null}),u=s.BusinessProfileCollection.gaddUp(c);i?(0,a.isMeAccount)(r)&&s.BusinessProfileCollection.fetchBizProfile(r):u.stale=!0};const u=function(){var e=(0,i.default)((function*(e){let{hash:t}=e;const n=c.ContactCollection.resolveWidsFromHash(t);return!!n&&(yield Promise.all(n.map(function(){var e=(0,i.default)((function*(e){const t=Boolean(s.BusinessProfileCollection.getValid(e)),n=yield s.BusinessProfileCollection.update(e),r=Array.isArray(n)?n:[n];for(const e of r)t||(e.stale=!0)}));return function(){return e.apply(this,arguments)}}())),!0)}));return function(){return e.apply(this,arguments)}}();t.handleBusinessProfileHash=u},9961:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleBusinessRemoval=f,t.handleBusinessRemovalNotificationContact=function(){return g.apply(this,arguments)},t.handleBusinessRemovalNotificationHash=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=r(n(163619)),o=n(393170),s=n(719380),l=n(799069);function c(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){const n=yield e.get(t.user);if(null!=n)return n.isBusiness=!1,n.verifiedLevel=0,n.verifiedName="",e.merge(t.user,n)}))).apply(this,arguments)}function d(e,t){return e.remove(t.user)}const p={isVerifiedHigh:!1,isBusiness:!1,isEnterprise:!1};function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=s.ContactCollection.get(e),n=t?{verifiedName:t.verifiedName,isVerifiedHigh:t.verifiedLevel===o.VERIFIED_LEVEL.HIGH,isBusiness:t.isBusiness,isEnterprise:t.isEnterprise,privacyMode:t.privacyMode}:p;yield(0,l.getStorage)().lock(["contact","verified-business-name"],(t=>{let[n,r]=t;return Promise.all([c(n,e),d(r,e)])}));const r=s.ContactCollection.get(e);return null!=r&&r.set({isBusiness:!1,verifiedLevel:null,verifiedName:null}),(0,a.default)(e,n,p)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){if("remove_hash"!==e.type)throw Error("Invalid notification type");const t=s.ContactCollection.resolveWidsFromHash(e.hash);return!!t&&(yield Promise.all(t.map((t=>f(t,e.stanzaId,e.ts)))),!0)}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if("remove_jid"!==e.type)throw Error("Invalid notification type");yield f(e.jid,e.stanzaId,e.ts)}))).apply(this,arguments)}},880537:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCollectionNotification=function(e){const t=o.CatalogCollection.get((0,a.getMeUser)().toString());if(null==t?void 0:t.collections)for(let n=0;n<e.collectionIds.length;n++){const r=t.collections.get(e.collectionIds[n]);r&&r.set(e.reviewStatuses[n])}return Promise.resolve()},t.handleProductNotification=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=n(978820),o=n(599989);function s(){return(s=(0,i.default)((function*(e){const t=o.CatalogCollection.get((0,a.getMeUser)().toString());if(t){const n=[];e.forEach((e=>{n.push(t.refreshProduct(e))})),yield Promise.all(n)}}))).apply(this,arguments)}},683558:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,a.default)(t.success)};var i=n(471914),a=r(n(624206)),o=n(181663);const s=new i.WapParser("incomingChatStateParser",(e=>{let t;if(e.assertTag("chatstate"),e.hasChild("paused"))t="paused";else{if(!e.hasChild("composing"))return e.throw("Expected child of type paused or composing");t=e.child("composing").hasAttr("media")?"recording":"composing"}return{id:(0,o.chatJidToChatWid)(e.attrChatJid("from")),type:t,participant:e.hasAttr("participant")?(0,o.userJidToUserWid)(e.attrUserJid("participant")):void 0}}))},569277:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,y.isNotifSchedulerEnabled)()?o.JOB_PRIORITY.LOW:o.JOB_PRIORITY.SKIP;return(0,f.NonPersistJob)("handleContactNotification",(e=>function(){return w.apply(this,arguments)}(e.node)),{priority:t}).waitUntilCompleted({node:e})};var i=r(n(348926)),a=r(n(81109)),o=n(524674),s=r(n(145095)),l=n(831914),c=(n(245506),n(471914)),u=n(181663),d=n(707122),p=r(n(465212)),f=n(879274),_=n(373232),h=n(994059),g=n(978820),m=n(745454),y=n(458464),S=n(400189),E=n(669951),v=n(719380),T=n(868315),C=n(241601),A=n(46133),b=n(68638);const P=new c.WapParser("incomingContactsNotification",(e=>{e.assertTag("notification");const t=e.attrString("id"),n={from:e.attrWapJid("from"),ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:t};if(e.hasChild("update")){const t=e.child("update");if(t.hasAttr("jid"))return(0,a.default)({type:"update",jid:(0,u.userJidToUserWid)(t.attrUserJid("jid"))},n);if(t.hasAttr("hash")){const e=v.ContactCollection.findFirst((e=>{var n;return(null===(n=e.userhash)||void 0===n?void 0:n.slice(0,4))===t.attrString("hash")}));return null==e?(0,a.default)({type:"empty",jid:null},n):(0,a.default)({type:"update",jid:e.id},n)}return(0,a.default)({type:"empty",jid:null},n)}if(e.hasChild("add")){const t=e.child("add");return(0,a.default)({type:"add",hash:t.hasContent()?t.contentBytes():null,jid:null},n)}if(e.hasChild("remove")){const t=e.child("remove");return(0,a.default)({type:"remove",jid:(0,u.userJidToUserWid)(t.attrUserJid("jid"))},n)}if(e.hasChild("modify")){const t=e.child("modify");return(0,a.default)({type:"modify",jid:(0,u.userJidToUserWid)(t.attrUserJid("new")),oldJid:(0,u.userJidToUserWid)(t.attrUserJid("old"))},n)}if(e.hasChild("sync")){const t=e.child("sync");return(0,a.default)({type:"sync",after:t.attrTime("after"),jid:null},n)}return __LOG__(3)`Unexpected "contacts" notification`,(0,a.default)({type:"empty",jid:null},n)}));function O(e,t){const n=function(e,t){if("modify"!==t.type)throw new Error("Error: genContactChangeNotificationMsg invalid type");{const n=(0,g.getMeUser)(),r=(0,s.default)(t.oldJid,"notification.oldJid"),i=(0,s.default)(t.jid,"notification.jid");return{id:new p.default({remote:e,fromMe:!1,id:p.default.newId()}),from:e,subtype:"change_number",t:t.ts,to:n,type:"notification_template",templateParams:[r,i]}}}(e,t);return(0,d.handleSingleMsgMD)(e,n)}function M(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(e){if(e.oldJid){const t=e.oldJid,n=e.jid,r=[];E.ChatCollection.get(t)&&r.push({id:t.toString(),changeNumberNewJid:n.toString(),changeNumberOldJid:void 0});E.ChatCollection.get(n)&&r.push({id:n.toString(),changeNumberNewJid:void 0,changeNumberOldJid:t.toString()}),(0,b.getTable)().bulkCreateOrMerge(r).then((()=>{r.forEach((e=>{const t=E.ChatCollection.get(e.id);t&&(t.changeNumberNewJid=e.changeNumberNewJid?(0,m.createWid)(e.changeNumberNewJid):void 0,t.changeNumberOldJid=e.changeNumberOldJid?(0,m.createWid)(e.changeNumberOldJid):void 0)}))})),yield Promise.all([O(t,e),O(n,e)])}else __LOG__(2)`notification.oldJid is null`}))).apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e){const t=P.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const n=t.success,r=n.jid;switch(n.type){case"update":{if(!r)return __LOG__(3)`handleContactsNotification: an update command does not include jid`,i(n);const e=T.PresenceCollection.get(r);e&&e.reset();const t=A.StatusCollection.get(r),a=null==t?null:(0,h.getStatus)(r).then((e=>{t.set({status:e.status})})),o=(0,_.changeProfilePicThumb)(n.jid,C.PROFILE_PIC_COMMAND.SET);return yield Promise.all([o,a]),i(n)}case"modify":return yield M(n),i(n);case"sync":return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`received contact sync notification`,yield(0,S.contactSync)(),i(n);default:return __LOG__(2)`handleContactsNotification: unhandled notification of type ${n.type}`,i(n)}function i(e,t){return(0,l.wap)("ack",{id:(0,l.CUSTOM_STRING)(e.stanzaId),to:e.from,class:"notification",type:"contacts"},t)}}))).apply(this,arguments)}},927514:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICE_NOTIFICATION_TYPES=void 0,t.handleDevicesNotification=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=n(831914),o=n(471914),s=n(88555),l=n(696055),c=n(468728),u=n(181663),d=n(272441),p=n(550111),f=n(745454),_=r(n(869153)),h=n(528237),g=n(84356),m=n(446308);const y={add:"add",remove:"remove",update:"update"};t.DEVICE_NOTIFICATION_TYPES=y;const S=new o.WapParser("incomingDevicesNotification",(e=>{e.assertTag("notification"),e.assertTag("notification"),e.assertAttr("type","devices");let t,n,r,i=[];if(e.hasChild("remove"))n=y.remove,t=e.child("remove");else if(e.hasChild("add"))n=y.add,t=e.child("add");else{if(!e.hasChild("update"))throw __LOG__(3)`Unknown Devices Notification: Devices notification without "remove" and "add" nodes`,e.createParseError("Failed to parse devices notification");n=y.update,t=e.child("update")}if(n===y.add||n===y.remove){const a=t.maybeChild("key-index-list");if(!a)throw e.createParseError("key index node is required to handle device add or remove notification");const o=a.attrTime("ts");if(n===y.remove&&!o)throw e.createParseError("timestamp is required to handle device remove notification");r={ts:o,signedKeyIndexBytes:n===y.add?a.contentBytes():null};const s=t.child("device");i=[{id:(0,d.extractDeviceId)(s.attrDeviceJid("jid")),keyIndex:s.hasAttr("key-index")?s.attrInt("key-index"):null}]}return{type:n,stanzaId:e.attrString("id"),hash:t.attrString(n===y.update?"hash":"device_hash"),user:(0,u.deviceJidToUserWid)(e.attrDeviceJid("from")),deviceList:i,keyIndex:r}}));function E(){return(E=(0,i.default)((function*(e){const t=S.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const n=t.success,r=n.user,i=(0,a.wap)("ack",{to:(0,l.USER_JID)(n.user),id:(0,a.CUSTOM_STRING)(n.stanzaId),class:"notification"});if((0,s.isMDBackend)()){if(!h.OfflineMessageHandler.isResumeFromRestartComplete())return _.default.addOfflinePendingDevice(r.toString(),i),"NO_ACK";if(h.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress())return yield(0,m.addUserToPendingDeviceSync)([r.toString()]),i}const o={wid:r,devices:{deviceList:n.deviceList,keyIndex:n.keyIndex},type:n.type};if(n.type===y.add){try{yield(0,c.handleADVDeviceNotification)(o)}catch(e){__LOG__(3)`handleDevicesNotification - add error: ${e}`}return i}if(n.type===y.remove){try{var u;yield(0,c.handleADVDeviceNotification)(o);const e=(null===(u=n.deviceList)||void 0===u?void 0:u.map((e=>e.id)))||[];yield Promise.all(e.map((e=>{const t=(0,f.createDeviceWidFromUserAndDevice)(r.user,r.server,e);g.Voip.notifyDeviceIdentityChangedOrDeleted(t,!0)})))}catch(e){__LOG__(3)`handleDevicesNotification - remove error: ${e}`}return i}try{yield(0,p.syncDeviceListJob)([r],"notification",n.hash)}catch(e){__LOG__(3)`handleDevicesNotification - update error: ${e}`}return i}))).apply(this,arguments)}},781367:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=o.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,i=(0,r.wap)("ack",{to:r.S_WHATSAPP_NET,id:(0,r.CUSTOM_STRING)(n.stanzaId),class:"notification"});return(0,a.digestKey)().then((()=>i))};var r=n(831914),i=n(471914),a=n(934819);const o=new i.WapParser("digestKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),e.child("digest").assertTag("digest"),{stanzaId:e.attrString("id")})))},58626:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleDisappearingModeNotificationJob=function(e){const t=(0,p.isNotifSchedulerEnabled)()?a.JOB_PRIORITY.LOW:a.JOB_PRIORITY.SKIP;return(0,d.NonPersistJob)("handleDisappearingModeNotification",(()=>{const t=_.parse(e);return t.error?(__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error)):function(){return h.apply(this,arguments)}(t.success)}),{priority:t}).waitUntilCompleted({node:e})};var i=r(n(348926)),a=n(524674),o=n(831914),s=n(471914),l=n(227101),c=n(696055),u=n(181663),d=n(879274),p=n(458464),f=n(991036);const _=new s.WapParser("disappearingModeNotification",(e=>{e.assertTag("notification");const t=e.child("disappearing_mode");return{stanzaId:e.attrString("id"),from:(0,u.deviceJidToDeviceWid)(e.attrDeviceJid("from")),duration:t.attrInt("duration",0),ts:t.attrTime("t")}}));function h(){return(h=(0,i.default)((function*(e){let{duration:t,from:n,stanzaId:r,ts:i}=e;return __LOG__(2)`handleDisappearingModeNotification: received d=${t}:t=${i}
for ${n.toString()}`,(0,l.isDisappearingModeEnabled)()&&(yield(0,f.updateDisappearingMode)(n,t,i)),(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(r),to:(0,c.JID)(n),class:"notification",type:"disappearing_mode"})}))).apply(this,arguments)}},364054:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(471914),s=n(781572),l=n(400922),c=n(279101),u=n(826066),d=n(642448),p=n(765044);const f=new o.WapParser("failureParser",(e=>(e.assertTag("failure"),{reason:e.attrInt("reason",400,599),location:e.attrString("location"),code:e.hasAttr("code")?e.attrInt("code"):null,expire:e.hasAttr("expire")?e.attrInt("expire"):null})));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);switch(t.success.reason){case 401:case 403:case 406:__LOG__(2)`received failure stanza, reason: ${t.success.reason}, logging out`,yield p.Socket.clearCredentialsAndStoredData(),s.Cmd.logout();break;case 405:case 409:__LOG__(2)`Client too old or bad user agent, attempting to update the app`;"web"===c.PLATFORMS[d.WAM_PLATFORM]?l.Updater.update(u.SANITIZED_VERSION_STR,!1,0):l.Updater.update(void 0,!1,0,!1),(0,a.stopComms)();break;case 402:const{code:e,expire:n}=t.success;if(null==e||null==n)throw __LOG__(4,void 0,new Error)`Incorrect temporary ban data ${e} ${n}`,new Error("handleFailure: wrong temp ban data");s.Cmd.onTemporaryBan({banned:!0,code:e,expire:n});break;case 400:case 500:case 501:__LOG__(3)`handleFailure: got failure code ${t.success.reason}`;break;default:return __LOG__(3)`failure reason ${t.success.reason} not implemented yet`,Promise.reject(new Error(`failure reason ${t.success.reason} not implemented yet`))}}))).apply(this,arguments)}},492419:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupNotification=function(e){const t=M.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,r=!!n.offline&&!y.OfflineMessageHandler.isResumeFromRestartComplete();if((0,O.isGroupNotificationOptimizationEligible)(n,r)&&r)return(0,O.handleGroupNotificationV2)(n,r);return(0,_.handleMessage)(n.chatId.toString(),r,(0,i.default)((function*(){return yield Promise.all(n.actions.map((e=>function(){return R.apply(this,arguments)}(n,e,r)))),(0,o.wap)("ack",{to:(0,c.GROUP_JID)(n.chatId),id:(0,o.CUSTOM_STRING)(n.externalId),class:"notification",participant:n.author?(0,c.USER_JID)(n.author):o.DROP_ATTR})})))};var i=r(n(348926)),a=r(n(81109)),o=n(831914),s=n(471914),l=n(708154),c=n(696055),u=n(421414),d=n(677345),p=n(795720),f=n(181663),_=n(521522),h=n(408139),g=n(707122),m=n(978820),y=n(528237),S=r(n(729783)),E=n(346920),v=n(902182),T=n(970041),C=n(543201),A=n(68638),b=n(864632),P=n(239703),O=n(14748);const M=new s.WapParser("groupNotificationParser",(e=>{e.assertTag("notification"),e.hasAttr("to")&&e.assertAttr("to",(0,m.assertGetMe)().toJid());const t=(0,f.groupJidToWid)(e.attrGroupJid("from")),n=e.hasAttr("participant")?(0,f.userJidToUserWid)(e.attrUserJid("participant")):null,r=e.attrTime("t");function i(e){return{participants:e.mapChildrenWithTag("participant",(e=>(0,f.userJidToUserWid)(e.attrUserJid("jid")))),prevVersion:e.hasAttr("prev_v_id")?e.attrInt("prev_v_id"):void 0,version:e.hasAttr("v_id")?e.attrInt("v_id"):void 0}}function o(e){return{jid:e.hasAttr("jid")?(0,f.groupJidToWid)(e.attrGroupJid("jid")):void 0}}const s=e.mapChildren((t=>{const n=t.tag();switch(n){case P.GROUP_NOTIFICATION_TAG.CREATE:return function(e){const t=e.child("group"),n=t.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",E.GROUP_PARTICIPANT_TYPES,"participant");return{id:(0,f.userJidToUserWid)(e.attrUserJid("jid")),isSuperAdmin:t===E.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===E.GROUP_PARTICIPANT_TYPES.admin||t===E.GROUP_PARTICIPANT_TYPES.superadmin}})),r=function(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent())return{content:e.contentString(),id:t.attrString("id")}}}return null}(t),i=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(t),a=(0,v.extractLinkedParent)(t),o={subject:t.attrString("subject"),restrict:t.hasChild("locked"),announce:t.hasChild("announcement"),noFrequentlyForwarded:t.hasChild("no_frequently_forwarded"),ephemeralDuration:i?i.ephemeralDuration:void 0,owner:t.hasAttr("creator")?(0,f.userJidToUserWid)(t.attrUserJid("creator")):void 0,creation:t.attrTime("creation"),participants:n,desc:r?r.content:void 0,descId:r?r.id:void 0,subjectOwner:t.hasAttr("s_o")?(0,f.userJidToUserWid)(t.attrUserJid("s_o")):void 0,subjectTime:t.hasAttr("s_t")?t.attrTime("s_t"):void 0,support:t.hasChild("support"),pvId:t.attrInt("p_v_id"),isParentGroup:t.hasChild("parent"),parentGroup:a?a.parentGroup:void 0,defaultSubgroup:t.hasChild("default_sub_group")};return{actionType:P.GROUP_NOTIFICATION_TAG.CREATE,isInvite:e.hasAttr("reason")&&"invite"===e.attrString("reason"),isLinkedGroupJoin:e.hasAttr("reason")&&"linked_group_join"===e.attrString("reason"),groupInfo:o}}(t);case P.GROUP_NOTIFICATION_TAG.ADD:return(0,a.default)((0,a.default)({actionType:p.GROUP_ACTIONS.ADD},i(t)),{},{isInvite:t.hasAttr("reason")&&"invite"===t.attrString("reason"),isLinkedGroupJoin:t.hasAttr("reason")&&"linked_group_join"===t.attrString("reason")});case P.GROUP_NOTIFICATION_TAG.DELETE:const l={integrity_delete_parent:p.DELETE_REASON.INTEGRITY_DELETE_PARENT};return{actionType:p.GROUP_ACTIONS.DELETE,reason:t.hasAttr("reason")?l[t.attrString("reason")]:null};case P.GROUP_NOTIFICATION_TAG.REMOVE:return(0,a.default)({actionType:P.GROUP_NOTIFICATION_TAG.REMOVE},i(t));case P.GROUP_NOTIFICATION_TAG.PROMOTE:return(0,a.default)({actionType:P.GROUP_NOTIFICATION_TAG.PROMOTE},i(t));case P.GROUP_NOTIFICATION_TAG.DEMOTE:return(0,a.default)({actionType:P.GROUP_NOTIFICATION_TAG.DEMOTE},i(t));case P.GROUP_NOTIFICATION_TAG.LINKED_GROUP_PROMOTE:return(0,a.default)((0,a.default)({actionType:P.GROUP_NOTIFICATION_TAG.LINKED_GROUP_PROMOTE},i(t)),o(t));case P.GROUP_NOTIFICATION_TAG.LINKED_GROUP_DEMOTE:return(0,a.default)((0,a.default)({actionType:P.GROUP_NOTIFICATION_TAG.LINKED_GROUP_DEMOTE},i(t)),o(t));case P.GROUP_NOTIFICATION_TAG.MODIFY:return(0,a.default)({actionType:p.GROUP_ACTIONS.MODIFY},i(t));case P.GROUP_NOTIFICATION_TAG.SUBJECT:return{actionType:p.GROUP_ACTIONS.SUBJECT,subject:t.attrString("subject"),s_o:t.hasAttr("s_o")?(0,f.userJidToUserWid)(t.attrUserJid("s_o")):null,s_t:t.hasAttr("s_t")?t.attrTime("s_t"):null};case P.GROUP_NOTIFICATION_TAG.DESC:return t.hasChild("delete")?{actionType:p.GROUP_ACTIONS.DESC_REMOVE,descId:t.attrString("id")}:{actionType:p.GROUP_ACTIONS.DESC_ADD,descId:t.attrString("id"),desc:t.hasChild("body")?t.child("body").contentString():null,descTime:r};case P.GROUP_NOTIFICATION_TAG.SUSPENDED:return{actionType:p.GROUP_ACTIONS.SUSPEND,value:!0};case P.GROUP_NOTIFICATION_TAG.UNSUSPENDED:return{actionType:p.GROUP_ACTIONS.SUSPEND,value:!1};case P.GROUP_NOTIFICATION_TAG.LOCKED:return{actionType:p.GROUP_ACTIONS.RESTRICT,value:!0};case P.GROUP_NOTIFICATION_TAG.UNLOCKED:return{actionType:p.GROUP_ACTIONS.RESTRICT,value:!1};case P.GROUP_NOTIFICATION_TAG.ANNOUNCE:return{actionType:p.GROUP_ACTIONS.ANNOUNCE,value:!0};case P.GROUP_NOTIFICATION_TAG.NOT_ANNOUNCE:return{actionType:p.GROUP_ACTIONS.ANNOUNCE,value:!1};case P.GROUP_NOTIFICATION_TAG.NO_FREQUENTLY_FORWARDED:return{actionType:p.GROUP_ACTIONS.NO_FORWARD,value:!0};case P.GROUP_NOTIFICATION_TAG.FREQUENTLY_FORWARDED_OK:return{actionType:p.GROUP_ACTIONS.NO_FORWARD,value:!1};case P.GROUP_NOTIFICATION_TAG.INVITE:return{actionType:p.GROUP_ACTIONS.INVITE_CODE,code:t.attrString("code")};case P.GROUP_NOTIFICATION_TAG.EPHEMERAL:return{actionType:p.GROUP_ACTIONS.EPHEMERAL,duration:t.attrInt("expiration")};case P.GROUP_NOTIFICATION_TAG.NOT_EPHEMERAL:return{actionType:p.GROUP_ACTIONS.EPHEMERAL,duration:0};case P.GROUP_NOTIFICATION_TAG.REVOKE_INVITE:return{actionType:p.GROUP_ACTIONS.REVOKE_INVITE,participants:t.mapChildrenWithTag("participant",(e=>({id:(0,f.userJidToUserWid)(e.attrUserJid("jid")),expiration:e.attrInt("expiration")})))};case P.GROUP_NOTIFICATION_TAG.GROWTH_UNLOCKED:return{actionType:p.GROUP_ACTIONS.GROWTH_UNLOCKED};case P.GROUP_NOTIFICATION_TAG.GROWTH_LOCKED:return{actionType:p.GROUP_ACTIONS.GROWTH_LOCKED,expiration:t.attrInt("expiration"),type:t.attrString("type")};case P.GROUP_NOTIFICATION_TAG.LINK:{const e=t.attrString("link_type");return{actionType:{sub_group:p.GROUP_ACTIONS.SUB_GROUP_LINK,parent_group:p.GROUP_ACTIONS.PARENT_GROUP_LINK,sibling_group:p.GROUP_ACTIONS.SIBLING_GROUP_LINK}[e],groupDatas:t.mapChildrenWithTag("group",(e=>({id:(0,f.groupJidToWid)(e.attrGroupJid("jid")),subject:e.attrString("subject"),subjectTime:e.attrInt("s_t")})))}}case P.GROUP_NOTIFICATION_TAG.UNLINK:{const e=t.attrString("unlink_type"),n=t.hasAttr("unlink_reason")?t.attrString("unlink_reason"):null,r=t.mapChildrenWithTag("group",(e=>({id:(0,f.groupJidToWid)(e.attrGroupJid("jid")),subject:e.attrString("subject"),subjectTime:e.attrInt("s_t")})));if(n===p.DELETE_REASON.INTEGRITY_DELETE_PARENT&&"parent_group"===e)return{actionType:p.GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK,groupDatas:r};return{actionType:{sub_group:p.GROUP_ACTIONS.SUB_GROUP_UNLINK,parent_group:p.GROUP_ACTIONS.PARENT_GROUP_UNLINK,sibling_group:p.GROUP_ACTIONS.SIBLING_GROUP_UNLINK}[e],groupDatas:r}}case P.GROUP_NOTIFICATION_TAG.MEMBERSHIP_APPROVAL_MODE:var s;return{actionType:p.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE,value:"on"===(null===(s=t.child("group_join"))||void 0===s?void 0:s.attrString("state"))};case P.GROUP_NOTIFICATION_TAG.MEMBERSHIP_APPROVAL_REQUEST:return{actionType:p.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST};default:throw e.createParseError(`Unrecognized group action ${n}`)}}));return{externalId:e.attrString("id"),chatId:t,author:n,ts:e.attrTime("t"),pushname:e.hasAttr("notify")?e.attrString("notify"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null,actions:s}}));function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e){const[t,n]=yield Promise.all([(0,b.getTable)().get(e.toString()),(0,A.getTable)().get(e.toString())]);return!!t||!!n&&!!n.t}))).apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;__LOG__(2,void 0,void 0,void 0,["groups"])`handle action ${t.actionType}`;const r=[];try{if(t.actionType===P.GROUP_NOTIFICATION_TAG.CREATE){const i=(0,a.default)((0,a.default)({},t.groupInfo),{},{id:e.chatId}),o=yield I(i.id);__LOG__(2,void 0,void 0,void 0,["groups"])`group id ${i.id} exists in storage = ${o}`,yield(0,u.handleGroupCreation)(e,i,n);const s=(0,m.getMaybeMeUser)();if(__LOG__(2,void 0,void 0,void 0,["groups"])`handleGroupCreation done for group id ${i.id}`,o||r.push((0,d.genGroupCreationMsg)(e,i)),!s.equals(e.author)){const a={actionType:p.GROUP_ACTIONS.ADD,version:i.pvId,participants:[s],isInvite:t.isInvite,isLinkedGroupJoin:t.isLinkedGroupJoin};yield(0,T.updateDBForGroupAction)(e,a,n),N(e,a),r.push((0,d.genGroupNotificationMsg)(e,a))}const{ephemeralDuration:l}=i;e.author&&null!=e.ts&&null!=l&&l>0&&r.push((0,d.genGroupEphemeralSettingMsg)(e.chatId,e.ts,e.author,l));const{parentGroup:c,defaultSubgroup:f}=i;if((0,h.communitiesEnabled)()&&null!=c&&!0!==f){const t={actionType:p.GROUP_ACTIONS.PARENT_GROUP_LINK,groupDatas:[{id:c,subject:""}]};r.push((0,d.genGroupNotificationMsg)(e,t))}}else if(t.actionType===p.GROUP_ACTIONS.ADD){const i=(0,P.notAlreadyInGroup)(e.chatId,t.participants);yield(0,T.updateDBForGroupAction)(e,t,n),N(e,t),__LOG__(2,void 0,void 0,void 0,["groups"])`updateDBForGroupAction done for ${t}`,i.length&&r.push((0,d.genGroupNotificationMsg)(e,(0,a.default)((0,a.default)({},t),{},{participants:i})))}else if(t.actionType===p.GROUP_ACTIONS.LINKED_GROUP_PROMOTE){const i=t.jid,a=(0,m.getMaybeMeUser)();if(!i||!a)return;(yield(0,C.isCurrentUserGroupAdmin)(i.toString()))||(yield(0,T.updateDBForGroupAction)(e,t,n),N(e,t),__LOG__(2,void 0,void 0,void 0,["groups"])`updateDBForGroupAction done for ${t}`),r.push((0,d.genGroupNotificationMsg)(e,t))}else{const i=yield(0,P.shouldSkipGenMsg)(e,t);if(yield(0,T.updateDBForGroupAction)(e,t,n),N(e,t),__LOG__(2,void 0,void 0,void 0,["groups"])`updateDBForGroupAction done for ${t}`,!i){const n=yield(0,C.isCurrentUserGroupAdmin)(e.chatId.toString());r.push((0,d.genGroupNotificationMsg)((0,a.default)((0,a.default)({},e),{},{isAdmin:n}),t))}}n?S.default.addOfflineMessage(r.map((e=>({msg:e})))):yield Promise.all(r.map((e=>(0,g.handleSingleMsgMD)(e.from,e))))}catch(e){__LOG__(2)`handleGroupNotification: failed with ${e}`}}))).apply(this,arguments)}function N(e,t){return(0,l.frontendSendAndReceive)("updateModelForGroupAction",{groupMeta:e,groupAction:t})}},239703:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_NOTIFICATION_TAG=void 0,t.notAlreadyInGroup=function(e,t){var n;const r=null===(n=f.ChatCollection.get(e))||void 0===n?void 0:n.groupMetadata;if(!r)return t;const i=r.participants;return t.filter((e=>!i.get(e)))},t.shouldSkipGenMsg=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=n(257243),o=n(88555),s=n(40234),l=n(795720),c=n(408139),u=n(879662),d=n(978820),p=r(n(389867)),f=n(669951),_=n(455981),h=n(543201),g=n(864632);const m=Object.freeze({REMOVE:"remove",ADD:"add",DEMOTE:"demote",DELETE:"delete",PROMOTE:"promote",MODIFY:"modify",CREATE:"create",SUBJECT:"subject",DESC:"description",LOCKED:"locked",UNLOCKED:"unlocked",ANNOUNCE:"announcement",NOT_ANNOUNCE:"not_announcement",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",FREQUENTLY_FORWARDED_OK:"frequently_forwarded_ok",INVITE:"invite",EPHEMERAL:"ephemeral",NOT_EPHEMERAL:"not_ephemeral",REVOKE_INVITE:"revoke",SUSPENDED:"suspended",UNSUSPENDED:"unsuspended",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",LINK:"link",UNLINK:"unlink",LINKED_GROUP_PROMOTE:"linked_group_promote",LINKED_GROUP_DEMOTE:"linked_group_demote",MEMBERSHIP_APPROVAL_MODE:"membership_approval_mode",MEMBERSHIP_APPROVAL_REQUEST:"membership_approval_request"});function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){var n;const r=yield(0,g.getTable)().get(e);return!!r&&r.growthLockType===t&&(null!==(n=r.growthLockExpiration)&&void 0!==n?n:0)>s.Clock.globalUnixTime()}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){if(t.actionType===l.GROUP_ACTIONS.REVOKE_INVITE||t.actionType===l.GROUP_ACTIONS.SUSPEND)return!0;if(t.actionType===l.GROUP_ACTIONS.GROWTH_LOCKED||t.actionType===l.GROUP_ACTIONS.GROWTH_UNLOCKED){if(!((0,o.isMDBackend)()&&(0,a.getABPropConfigValue)("growth_lock_v0_enabled")))return!0;if(t.actionType===l.GROUP_ACTIONS.GROWTH_LOCKED){if("invite"!==t.type)return!0;if(yield y(e.chatId.toString(),t.type))return!0}return!(yield(0,h.isCurrentUserGroupAdmin)(e.chatId.toString()))}if((t.actionType===l.GROUP_ACTIONS.SUB_GROUP_LINK||t.actionType===l.GROUP_ACTIONS.PARENT_GROUP_LINK||t.actionType===l.GROUP_ACTIONS.SIBLING_GROUP_LINK)&&!(0,c.communitiesEnabled)())return!0;if((0,c.communitiesEnabled)()&&(t.actionType===l.GROUP_ACTIONS.PROMOTE||t.actionType===l.GROUP_ACTIONS.DEMOTE)){var n;const t=null===(n=f.ChatCollection.get(e.chatId))||void 0===n?void 0:n.groupMetadata;if((null==t?void 0:t.groupType)===_.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)return!0}if(t.actionType===l.GROUP_ACTIONS.LINKED_GROUP_DEMOTE&&1===t.participants.length&&!(0,d.isMeAccount)(t.participants[0])){if(!(yield(0,h.isCurrentUserGroupAdmin)(e.chatId.toString())))return!0}if((0,u.skipLeaveSystemMessageEnabled)()&&t.actionType===l.GROUP_ACTIONS.REMOVE&&1===t.participants.length&&p.default.equals(e.author,t.participants[0])){const t=yield(0,h.isCurrentUserGroupAdmin)(e.chatId.toString()),n=(0,d.isMeAccount)(e.author);if(!t||n)return!0}if(t.actionType===l.GROUP_ACTIONS.DELETE){var r;const n=null===(r=f.ChatCollection.get(e.chatId))||void 0===r?void 0:r.groupMetadata;if(t.reason===l.DELETE_REASON.INTEGRITY_DELETE_PARENT&&(null==n?void 0:n.groupType)===_.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&(0,a.getABPropConfigValue)("community_suspend_v0_enabled"))return!1;if((0,a.getABPropConfigValue)("group_suspend_v1_enabled"))return!0}return!(t.actionType!==l.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE&&t.actionType!==l.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST||(0,a.getABPropConfigValue)("group_join_request_m1"))}))).apply(this,arguments)}t.GROUP_NOTIFICATION_TAG=m},14748:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupNotificationV2=function(){return h.apply(this,arguments)},t.isGroupNotificationOptimizationEligible=function(e,t){return null!=g(e,t)};var i=r(n(81109)),a=r(n(348926)),o=n(831914),s=n(708154),l=n(696055),c=n(677345),u=n(521522),d=n(707122),p=n(970041),f=n(239703),_=r(n(729783));function h(){return(h=(0,a.default)((function*(e,t){const n=g(e,t);return null==n?(__LOG__(3)`no handler for group notification ${e.chatId.toString()}`,r()):(yield Promise.all([n.writeSystemMessages(),n.writeGroupInfoUpdates()]),r());function r(){return(0,o.wap)("ack",{to:(0,l.GROUP_JID)(e.chatId),id:(0,o.CUSTOM_STRING)(e.externalId),class:"notification",participant:e.author?(0,l.USER_JID)(e.author):o.DROP_ATTR})}}))).apply(this,arguments)}function g(e,t){const n=[];for(const t of e.actions){const r=l(e,t);if(null==r)return null;n.push(r)}return{writeSystemMessages:(o=(0,a.default)((function*(){yield Promise.all(n.map((e=>e.writeSystemMessages())))})),function(){return o.apply(this,arguments)}),writeGroupInfoUpdates:(r=(0,a.default)((function*(){yield Promise.all(n.map((e=>e.writeGroupInfoUpdates())))})),function(){return r.apply(this,arguments)})};var r,o;function l(e,n){let r=[];if(n.actionType===f.GROUP_NOTIFICATION_TAG.CREATE)return null;if(n.actionType===f.GROUP_NOTIFICATION_TAG.ADD){const t=(0,f.notAlreadyInGroup)(e.chatId,n.participants);t.length>0&&(r=[(0,c.genGroupNotificationMsg)(e,(0,i.default)((0,i.default)({},n),{},{participants:t}))])}else r=[(0,c.genGroupNotificationMsg)(e,n)];return{writeGroupInfoUpdates:(o=(0,a.default)((function*(){yield(0,p.updateDBForGroupAction)(e,n,t),(0,s.frontendSendAndReceive)("updateModelForGroupAction",{groupMeta:e,groupAction:n})})),function(){return o.apply(this,arguments)}),writeSystemMessages:()=>function(e,t,n,r){let i=()=>{};const o=new Promise((e=>i=e));return(0,u.handleMessage)(e.toString(),n,(0,a.default)((function*(){if(yield r())return void i();const e=s(t).then(i);return n?Promise.resolve():e}))),o;function s(){return l.apply(this,arguments)}function l(){return(l=(0,a.default)((function*(e){if(n)return _.default.addOfflineMessage(e.map((e=>({msg:e}))));yield Promise.all(e.map((e=>(0,d.handleSingleMsgMD)(e.from,e))))}))).apply(this,arguments)}}(e.chatId,r,t,(()=>(0,f.shouldSkipGenMsg)(e,n)))};var o}}},819655:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleHistorySyncChunk=se,t.handleHistorySyncNotification=function(){return oe.apply(this,arguments)};var a=i(n(81109)),o=i(n(348926)),s=n(352613),l=n(108584),c=n(772651),u=n(252230),d=n(608243),p=i(n(145095)),f=n(892844),_=n(257243),h=n(708154),g=n(461957),m=n(217869),y=n(781572),S=n(810635),E=n(138062),v=n(381321),T=n(923082),C=n(707122),A=i(n(465212)),b=i(n(681602)),P=i(n(355504)),O=n(310656),M=i(n(595023)),I=n(555452),w=n(978820),R=n(233776),N=n(711597),L=i(n(389867)),D=n(745454),k=n(49714),U=n(959474),G=n(273027),x=n(470127),B=n(1201),F=n(572841),j=i(n(876883)),Y=n(388432),K=i(n(656891)),W=i(n(570257)),H=n(524606),V=n(2259),$=n(826384),z=i(n(239436)),q=n(124808),J=n(573027),Q=i(n(11339)),X=n(719380),Z=i(n(963928)),ee=i(n(245077)),te=n(964551),ne=n(776214),re=n(141037),ie=n(68638),ae=n(484902);function oe(){return(oe=(0,o.default)((function*(e,t,n){if(!e)return;const{downloadOptions:r}=e;if(!r)return;const i=!!e.historySyncNotification.originalMessageId,o=i?e.historySyncNotification.originalMessageId:n,s={msgKey:new A.default({remote:t,fromMe:!0,id:o}).toString(),processed:0,downloadOptions:r,isReupload:1,historySyncStepStartedTs:(0,f.unixTimeMs)(),reuploadPending:!1,historySyncPayloadSize:e.historySyncNotification.fileLength};i&&e.historySyncNotification.syncType!==J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP||(s.syncType=e.historySyncNotification.syncType,s.chunkOrder=e.historySyncNotification.chunkOrder||0,s.isReupload=0);const l=s;switch(new Q.default.MdBootstrapHistoryDataReceived({mdBootstrapPayloadType:l.syncType===J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP?Q.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:Q.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapHistoryPayloadType:(0,U.getMetricHistorySyncPayloadType)(l.syncType),mdTimestamp:(0,f.unixTimeMs)(),mdSessionId:yield Y.MdSyncFieldStatsMeta.getMdSessionId()}).commit(),l.syncType){case J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP:case J.HistorySync$HistorySyncType.INITIAL_STATUS_V3:__LOG__(2)`[History sync initial sync received] ${pe(l)}`,se(l);break;case J.HistorySync$HistorySyncType.PUSH_NAME:return __LOG__(2)`[History sync initial pushname received] ${pe(l)}`,yield(0,re.enqueueNotification)((0,a.default)((0,a.default)({},l),{},{downloadOptions:(0,a.default)({},l.downloadOptions)}),!0),void se(l);default:__LOG__(2)`[History sync recent or full chunk received] adding chunk info to db: ${pe(l)}`,yield(0,re.enqueueNotification)(l)}M.default.continueProgressiveHistorySyncProcessing()}))).apply(this,arguments)}function se(){return le.apply(this,arguments)}function le(){return(le=(0,o.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(__LOG__(2,void 0,void 0,void 0,["History sync"])`handleHistorySyncChunk started for ${pe(e)}`,e.syncType===J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP&&!0===(0,N.getInitialHistorySyncComplete)())return void __LOG__(2,void 0,void 0,void 0,["History sync"])`Skip duplicate initial sync chunk ${pe(e)}`;if(e.syncType===J.HistorySync$HistorySyncType.INITIAL_STATUS_V3)try{const t=A.default.fromString(e.msgKey);(0,O.sendAggregateReceipts)(t.remote,O.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,(new Map).set(t.remote,[t.id]))}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: sending Status v3 receipt failed`}const i=e.syncType===J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP?Q.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:Q.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,h=new Q.default.MdBootstrapHistoryDataDownloaded({mdBootstrapPayloadType:i,mdBootstrapPayloadSize:e.historySyncPayloadSize}),m=e.syncType!==J.HistorySync$HistorySyncType.PUSH_NAME&&!i;h.mdSessionId=yield Y.MdSyncFieldStatsMeta.getMdSessionId();const v=yield Y.MdSyncFieldStatsMeta.getStorageEstimation();v.mdStorageQuotaBytes!==Y.STORAGE_QUOTA_UNAVAILABLE&&(h.mdStorageQuotaUsedBytes=v.mdStorageQuotaUsedBytes,h.mdStorageQuotaBytes=v.mdStorageQuotaBytes);let U=null;try{U=yield $.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new r).signal},e.downloadOptions))}catch(n){if(__LOG__(3)`history sync download failed`,n instanceof T.HttpNetworkError)return e.syncType===J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP&&t>0?(yield b.default.waitIfOffline({signal:(new r).signal}),__LOG__(3,void 0,void 0,void 0,["History sync"])`Initial sync download failed due to network error retry download`,se(e,t-1)):void(0,re.removeLocalFailureFromInFlightChunk)(e.msgKey);const i=A.default.fromString(e.msgKey);return fe(h,e.historySyncStepStartedTs,!1),(0,P.default)(i.remote,i.id,e.downloadOptions.mediaKey),void(yield(0,re.markChunkForReuploadPending)(e.msgKey))}e.downloadOptions.mediaKey="",m&&(yield new Promise((e=>setTimeout(e,1e3)))),h.mdBootstrapStepResult=Q.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS;const K=new l.Binary(U),Z=yield(0,c.inflate)(K.readByteArray());m&&(yield new Promise((e=>setTimeout(e,1e3))));const ee=(0,ae.decodeProtobuf)(J.HistorySyncSpec,Z);__LOG__(2)`[History sync chunk downloaded], ${pe(e)}`,m&&(yield new Promise((e=>setTimeout(e,1e3))));const ie=new Q.default.MdBootstrapDataApplied({mdBootstrapPayloadType:i,mdBootstrapSource:Q.default.MD_BOOTSTRAP_SOURCE.HISTORY});if(ie.mdSessionId=yield Y.MdSyncFieldStatsMeta.getMdSessionId(),e.syncType===J.HistorySync$HistorySyncType.INITIAL_STATUS_V3&&ee.statusV3Messages&&ee.statusV3Messages.length>0?(h.mdBootstrapMessagesCount=ee.statusV3Messages.length,fe(h,e.historySyncStepStartedTs,!0),ee.statusV3Messages.sort(((e,t)=>{let{messageTimestamp:n}=e,{messageTimestamp:r}=t;return(0,f.castToUnixTime)(parseInt(n,10))-(0,f.castToUnixTime)(parseInt(r,10))})),yield Promise.all(ee.statusV3Messages.map(function(){var e=(0,o.default)((function*(e){let t=null;if(!0===e.key.fromMe)t=(0,w.getMeUser)();else if(t=(0,D.createWid)((0,p.default)(e.participant,"msg.participant")),t.isLid()&&!(0,V.lidHistorySyncEnabled)())return;const n={type:k.MESSAGE_TYPE.OTHER_STATUS,externalId:(0,p.default)(e.key.id,"msg.key.id"),ts:(0,f.castToUnixTime)(parseInt(e.messageTimestamp,10)),edit:-1,isHsm:!1,count:null,chat:(0,D.createWid)(u.STATUS_JID),author:(0,p.default)(t,"author"),pushname:null,isDirect:!1},r=yield(0,B.parseMessage)(n,"skmsg",(0,p.default)(e.message,"msg.message"),void 0),i=r.renderableMsgs&&r.renderableMsgs;if(!i||1!==i.length)return Promise.resolve();const a=i[0];return"0@s.whatsapp.net"!==e.participant||(0,_.getABPropConfigValue)("web_status_psa_history_sync")&&null!=a.staticUrl?(0,C.handleSingleMsgMD)(a.id.remote,a,!1):Promise.resolve()}));return function(){return e.apply(this,arguments)}}())),yield(0,re.updateCurrentlyProcessed)(e.msgKey),ie.mdTimestamp=(0,f.unixTimeMs)(),ie.commit(),__LOG__(2)`[History sync storing Status V3 complete], ${pe(e,ee.statusV3Messages.length)}`):e.syncType!==J.HistorySync$HistorySyncType.PUSH_NAME&&(ee.conversations=ee.conversations.reduce(((e,t)=>{let n=null;try{n=(0,D.createWid)(t.id),n.isLid()&&!(0,V.lidHistorySyncEnabled)()&&(n=null)}catch(e){__LOG__(3,void 0,void 0,void 0,["History sync"])`history_sync_notification_handler: invalid wid`}return n?e.concat(t):e}),[])),e.syncType===J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP){const t={},n=(0,w.assertGetMe)(),r=(0,D.toUserWid)(n),i=n.getDeviceId(),a={},o={},s=[];let l=0;const c=[];ee.conversations.forEach((n=>{var u,p,f;const h=(0,D.createWid)(n.id);if(h.isLid()&&!(0,V.lidHistorySyncEnabled)())return;let m=[],y=[];l+=n.messages.length;let v=[];0===n.messages.length&&(t[n.id]=-1),n.pHash&&(o[n.id]=n.pHash),n.messages.forEach(((r,i)=>{i===n.messages.length-1&&(t[n.id]=r.msgOrderId);const a=_e(e,r.message);v.push(a),m=m.concat((0,x.parseWebMsgInfoReaction)(a)),y=y.concat((0,G.parseWebMsgInfoPollUpdates)(r.message,a))})),v=v.filter(Boolean).reverse();const T=n.contactPrimaryIdentityKey;if(T&&L.default.isUser(h)){const e=(0,F.createSignalAddress)((0,D.toUserWid)(h)).toString(),t=(0,F.bufferToStr)((0,E.toSignalCurvePubKey)(T));h.equals((0,w.getMeUser)())?he(e,t):c.push({identifier:e,identityKey:t})}const C=(0,I.getGlobalSecurityNotifications)()&&!(0,_.getABPropConfigValue)("adv_v2_m6");if(!h.isStatusV3()&&C){const e=(0,S.genDeviceNotificationMsg)(h,r,[i],[]);v.push(e)}let A;if(null!=(null===(u=n.disappearingMode)||void 0===u?void 0:u.initiator))switch(n.disappearingMode.initiator){case q.DisappearingMode$Initiator.CHANGED_IN_CHAT:A=H.DisappearingModeInitiator.ChangedInChat;break;case q.DisappearingMode$Initiator.INITIATED_BY_ME:A=H.DisappearingModeInitiator.InitiatedByMe;break;case q.DisappearingMode$Initiator.INITIATED_BY_OTHER:A=H.DisappearingModeInitiator.InitiatedByOther}const b=null!=n.tcToken&&null!=n.tcTokenTimestamp,P={t:(0,d.maybeNumberOrThrowIfTooLarge)(null!==(p=n.conversationTimestamp)&&void 0!==p?p:n.lastMsgTimestamp),id:h,unreadCount:n.unreadCount,ephemeralDuration:n.ephemeralExpiration,ephemeralSettingTimestamp:n.ephemeralSettingTimestamp,disappearingModeInitiator:A,endOfHistoryTransferType:null!==(f=n.endOfHistoryTransferType)&&void 0!==f?f:g.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE,name:n.name,notSpam:n.notSpam,pendingInitialLoading:!1,unreadMentionCount:n.unreadMentionCount,tcToken:b?n.tcToken:null,tcTokenTimestamp:b?n.tcTokenTimestamp:null,tcTokenSenderTimestamp:n.tcTokenSenderTimestamp};de(n,P.id),s.push(P),a[n.id]={chatInfo:P,msgs:v,reactionMessages:m,pollVotes:y}})),h.mdBootstrapMessagesCount=l,h.mdBootstrapChatsCount=ee.conversations.length,fe(h,e.historySyncStepStartedTs,!0),M.default.markInitialHistorySyncCountDebugStats(l,s.length);const u=ee.conversations.some((e=>void 0!==e.unreadMentionCount));(0,I.setUnreadMentionCountEnabled)(u),yield j.default.bulkCreateIdentity(c),yield(0,W.default)([{cmd:"preempt",response:s,binarySize:10}])||Promise.resolve(),yield(0,C.handleInitialSyncMsgs)(a),yield(0,re.updateCurrentlyProcessed)(e.msgKey),ie.mdTimestamp=(0,f.unixTimeMs)(),ie.commit(!0),__LOG__(2)`[History sync storing initial sync complete] ${pe(e,l,s.length)}`,yield me(ee),(0,R.setHistoryInitialSyncBoundry)(t),(0,R.setInitialGroupPhash)(o)}else if(e.syncType===J.HistorySync$HistorySyncType.PUSH_NAME){fe(h,e.historySyncStepStartedTs,!0);const t=ee.pushnames.map((e=>({id:e.id||"",pushname:e.pushname||""})));yield(0,ne.getContactTable)().bulkCreateOrMerge(t),yield(0,re.updateCurrentlyProcessed)(e.msgKey);const n=ee.pushnames.map((e=>{const t=(0,D.createWid)(e.id||""),n=X.ContactCollection.get(t);return{id:t,pushname:e.pushname||"",type:(null==n?void 0:n.type)||"out",name:null==n?void 0:n.name}}));X.ContactCollection.add(n,{merge:!0}),ie.mdTimestamp=(0,f.unixTimeMs)(),ie.commit(),__LOG__(2)`[History sync storing initial pushname complete] with ${ee.pushnames.length} records`}else if(e.syncType!==J.HistorySync$HistorySyncType.INITIAL_STATUS_V3){yield new Promise((e=>setTimeout(e,0)));const t=[];let r=[],i=[];const a=new Set,o=[],l=(0,R.getHistoryInitialSyncBoundry)();let c=0,u=0;for(let p=0;p<ee.conversations.length;p++){const f=ee.conversations[p],_=null==l?void 0:l[f.id];if(null!=_)for(let l=0;l<f.messages.length;l++){const p=(0,D.createWid)(f.id);if(p.isLid()&&!(0,V.lidHistorySyncEnabled)())continue;const h=n(669951).ChatCollection.get(p),m=(null==h?void 0:h.endOfHistoryTransferType)===g.ConversationEndOfHistoryTransferModelPropType.COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY;if(!h&&null!=_||h&&null==h.endOfHistoryTransferType||m){__LOG__(2,void 0,void 0,void 0,["History sync"])`One chat in sync payload ${pe(e)} is already marked as complete locally`;break}c++;const y=f.messages[l],S=(0,d.maybeNumberOrThrowIfTooLarge)(y.msgOrderId);if(null!=_&&-1!==_&&null!=S&&S>=_)continue;a.add(f.id);const E=_e(e,y.message);0===l&&E&&h&&0===h.msgs.length&&o.push(E),r=r.concat((0,x.parseWebMsgInfoReaction)(E)),i=i.concat((0,G.parseWebMsgInfoPollUpdates)(y.message,E)),E&&t.push(E),yield(0,s.asyncSleepAfterGivenLoopIteration)(u++,100)}}h.mdBootstrapMessagesCount=c,h.mdBootstrapChatsCount=ee.conversations.length,fe(h,e.historySyncStepStartedTs,!0),0!==t.length&&(yield(0,C.handleProgressiveHistorySyncMsgs)(t,Array.from(a),r,i,o)),(0,N.setLastHistorySycnedChunk)(e.syncType,e.chunkOrder),yield(0,re.updateCurrentlyProcessed)(e.msgKey);const p=new Set;ee.conversations.forEach((e=>{const t=(0,D.createWid)(e.id);if(t.isLid()&&!(0,V.lidHistorySyncEnabled)())return;p.add(t.toString());let n=null;return null!=(null==l?void 0:l[e.id])&&(n=e.endOfHistoryTransferType),null!=n?ce(t,n):void 0})),y.Cmd.onHistorySyncChunkProcessed(p),ie.mdTimestamp=(0,f.unixTimeMs)(),ie.commit(),__LOG__(2)`[History sync chunk storing recent or full chunk complete,  ${pe(e,c)}`}const oe=A.default.fromString(e.msgKey),le=new Map;var ue;le.set(oe.remote,[oe.id]),e.syncType!==J.HistorySync$HistorySyncType.INITIAL_STATUS_V3&&(0,O.sendAggregateReceipts)(oe.remote,O.RECEIPT_TYPE.HISTORY_SYNC_COMPLETION,void 0,le),yield(0,re.updateCurrentlyProcessed)(e.msgKey),te.ServerProps.webMdMmsSyncDeletionRequest&&null!=e.downloadOptions.encFilehash&&z.default.deleteMdHistorySyncBlob({directPath:e.downloadOptions.directPath,encFilehash:e.downloadOptions.encFilehash,signal:(new r).signal}).catch((()=>{__LOG__(3)`MMS client delete error`})),ue=ee.progress,e.syncType===J.HistorySync$HistorySyncType.INITIAL_BOOTSTRAP?((0,N.setInitialHistorySyncComplete)(),(0,N.setHistorySyncStatus)({initialCompleted:!0}),y.Cmd.onInitialChatHistorySynced()):e.syncType===J.HistorySync$HistorySyncType.RECENT&&100===ue?(__LOG__(2,void 0,void 0,void 0,["History sync"])`Recent history sync complete`,(0,R.setHistoryInitialSyncBoundry)({}),(0,N.setHistorySyncStatus)({recentCompleted:!0}),y.Cmd.onRecentChatHistorySynced()):e.syncType===J.HistorySync$HistorySyncType.FULL&&100===ue&&(__LOG__(2,void 0,void 0,void 0,["History sync"])`Full history sync complete`,(0,R.setHistoryInitialSyncBoundry)({}),(0,N.setHistorySyncStatus)({fullCompleted:!0}),y.Cmd.onFullChatHistorySynced())}))).apply(this,arguments)}function ce(){return ue.apply(this,arguments)}function ue(){return(ue=(0,o.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t,i={id:e,endOfHistoryTransferType:r};n&&(i.t=0),yield(0,h.frontendSendAndReceive)("chatCollectionAdd",{things:[i],options:{merge:!0}}),yield(0,ie.getTable)().merge(e.toString(),{endOfHistoryTransferType:r})}))).apply(this,arguments)}function de(e,t){if(null!=e.suspended||null!=e.terminated||null!=e.createdBy||null!=e.createdAt||null!=e.description||null!=e.support||null!=e.isParentGroup||null!=e.isDefaultSubgroup||null!=e.parentGroupId){var n,r,i;const o={id:t,subject:e.name,suspended:e.suspended,terminated:e.terminated,owner:null!=e.createdBy?(0,D.createWid)(e.createdBy):void 0,creation:e.createdAt,desc:e.description,support:e.support,isParentGroup:e.isParentGroup,defaultSubgroup:e.isDefaultSubgroup,parentGroup:null!=e.parentGroupId?(0,D.createWid)(e.parentGroupId):void 0,size:null!==(n=null===(r=e.participant)||void 0===r?void 0:r.length)&&void 0!==n?n:0};(0,v.persistGroupMetadata)(t,(0,a.default)((0,a.default)({},o),{},{id:o.id.toString(),owner:void 0!==o.owner?o.owner.toString():void 0,creation:void 0!==o.creation?Number(o.creation):void 0,parentGroup:void 0!==o.parentGroup?String(o.parentGroup):void 0}));const s=Z.default.add(o,{merge:!0})[0],l=null===(i=e.participant)||void 0===i?void 0:i.map((e=>{const t=e.rank===J.GroupParticipant$Rank.SUPERADMIN,n=e.rank===J.GroupParticipant$Rank.ADMIN;return new ee.default({id:(0,D.createWid)(e.userJid),isAdmin:n||t,isSuperAdmin:t})}));null==s||s.participants.add(l,{merge:!0})}}function pe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=(e.msgKey||"").split("_")[2];return` type_${e.syncType}_order_${null!=e.chunkOrder?e.chunkOrder:"none"}_isReupload_${e.isReupload||0}}, id: ${r} ## msgCount: ${t}, chatCount: ${n}`}function fe(e,t,n){e.mdTimestamp=(0,f.unixTimeMs)(),e.mdBootstrapStepDuration=(0,f.unixTimeMs)()-t,e.mdBootstrapStepResult=n?Q.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:Q.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,e.commit()}function _e(e,t){let n=null;try{if(n=K.default.parseWebMessageInfo(t,"after"),null!=n&&"ephemeral_setting"===n.subtype&&n.id.remote.equals((0,w.getMeUser)()))return null}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMessageInfo failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return n}function he(){return ge.apply(this,arguments)}function ge(){return(ge=(0,o.default)((function*(e,t){const n=yield j.default.loadIdentityKey(e);n&&n!==t&&(__LOG__(4,void 0,new Error,!0,["History sync"])`get changed self identity key from history sync,
exisiting length: ${n.length}, new length: ${t.length}`,SEND_LOGS("self-identity-change-from-history-sync"))}))).apply(this,arguments)}function me(e){let t=Promise.resolve(),n=Promise.resolve();return null!=e.threadIdUserSecret&&(t=(0,m.setThreadIdUserSecret)(e.threadIdUserSecret)),null!=e.threadDsTimeframeOffset&&(n=(0,m.setThreadDsTimeframeOffset)(e.threadDsTimeframeOffset)),Promise.all([t,n])}},546462:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleE2eIdentityChange=function(e){const t=E.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const{wid:n,stanzaId:r,delay:s,offline:u}=t.success,v=(0,o.wap)("ack",{to:(0,l.DEVICE_JID)(n),id:(0,o.CUSTOM_STRING)(r),class:"notification"});if(null!=n.device&&n.device!==a.DEFAULT_DEVICE_ID)return __LOG__(2)`handleNewIdentity: ignore identity change from companion device`,Promise.resolve(v);if((0,h.isMePrimary)(n))return(0,c.handleSelfPrimaryIdentityChange)(),Promise.resolve(v);const T=!!u&&!g.OfflineMessageHandler.isResumeFromRestartComplete();return(0,p.handleMessage)(String(n),T,(0,i.default)((function*(){yield(0,c.clearDeviceRecordForIdentityChange)(n,T);return(yield(0,S.getSignalProtocolStore)().loadIdentityKey((0,y.createSignalAddress)(n).toString()))&&(__LOG__(2)`handleE2eIdentityChange: ${n.toString()} has old identity, establishing new session`,yield m.Session.deleteRemoteInfo(n),(0,f.addSecurityCodeChangedNotifications)(n,T),(0,_.sendTcTokenWhenDeviceIdentityChange)(n),T||(null!=s?(0,d.ensureE2ESessionsWithDelay)([n],s):(0,d.ensureE2ESessions)([n]))),v})))};var i=r(n(348926)),a=n(252230),o=n(831914),s=n(471914),l=n(696055),c=n(652402),u=n(181663),d=n(466863),p=n(521522),f=n(577741),_=n(289488),h=n(978820),g=n(528237),m=n(959060),y=n(572841),S=n(454753);const E=new s.WapParser("identityChange",(e=>{e.assertTag("notification"),e.assertAttr("type","encrypt"),e.child("identity");const t=parseInt(e.maybeAttrString("delay"),10);return{wid:(0,u.deviceJidToDeviceWid)(e.attrDeviceJid("from")),stanzaId:e.attrString("id"),delay:isFinite(t)&&t>0?t:null,offline:e.hasAttr("offline")?e.attrString("offline"):null}}))},965341:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SUPPORTED_DIRTY_TYPE=t.SUPPORTED_DIRTY_PROTOCOLS=void 0,t.handleDirtyBits=function(){return T.apply(this,arguments)};var i=r(n(348926)),a=n(836229),o=n(960362),s=n(970467),l=n(735490),c=n(781572),u=r(n(355184)),d=n(56080),p=n(978820),f=r(n(869153)),_=n(528237),h=r(n(11339)),g=n(446308);const m={groups:"groups",account_sync:"account_sync",syncd_app_state:"syncd_app_state"};t.SUPPORTED_DIRTY_TYPE=m;function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((e=>s.ACCOUNT_SYNC_TYPE.cast(e))).filter(Boolean);return 0===t.length&&(t=Array.from(s.ACCOUNT_SYNC_TYPE.members())),Promise.all(t.map((e=>e===s.ACCOUNT_SYNC_TYPE.DEVICES?v():e===s.ACCOUNT_SYNC_TYPE.PICTURE?(0,s.getAndUpdateProfilePicture)():void(e===s.ACCOUNT_SYNC_TYPE.PRIVACY?(0,s.updatePrivacySettings)():e===s.ACCOUNT_SYNC_TYPE.BLOCKLIST&&(0,s.updateBlocklist)()))))}function S(e){return null!=e.patches&&e.patches.length>0||null!=e.snapshot}function E(){return c.Cmd.once(c.APP_STATE_SYNC_COMPLETED,(e=>{const t=e.some(S);new h.default.MdAppStateDirtyBits({dirtyBitsFalsePositive:!t}).commit()})),(0,a.markCollectionsForSync)(Array.from(o.CollectionName.members()))}function v(){const e=String((0,p.getMeUser)());return _.OfflineMessageHandler.isResumeFromRestartComplete()?_.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress()?(0,g.addUserToPendingDeviceSync)([e]):(0,s.getDevices)("notification"):(f.default.addOfflinePendingDevice(e,null),Promise.resolve())}function T(){return(T=(0,i.default)((function*(e){const{supported:t,unsupported:n,protocols:r}=e;__LOG__(2)`handleDirtyBits: handle dirty bits, supported: ${t.map((e=>e.type)).join(",")}, unsupported: ${n.map((e=>e.type)).join(",")}`;const i=[...n,...t];return yield Promise.all(t.map((e=>{const t=e.type;return t===m.groups?(0,u.default)().then((()=>(0,d.queryAndUpdateAllGroupMetadata)())):t===m.account_sync?y(r):t===m.syncd_app_state?E():void 0}))),(0,l.clearDirtyBits)(i)}))).apply(this,arguments)}t.SUPPORTED_DIRTY_PROTOCOLS={devices:"devices",picture:"picture",privacy:"privacy",blocklist:"blocklist"}},686741:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(471914),o=n(781572),s=n(536037),l=n(965341),c=n(189816),u=n(337222),d=n(528237),p=n(725773);const f=new a.WapParser("infoBulletinParser",(e=>{if(e.assertTag("ib"),e.assertFromServer(),e.hasChild(u.INFO_TYPE.DIRTY)){const t=[],n=[],r=[];return e.forEachChildWithTag(u.INFO_TYPE.DIRTY,(e=>{const i={type:e.attrString("type"),timestamp:e.attrInt("timestamp")};if("account_sync"===i.type){e.mapChildren((e=>e.tag())).forEach((e=>{l.SUPPORTED_DIRTY_PROTOCOLS.hasOwnProperty(e)&&r.push(e)})),n.push(i)}else l.SUPPORTED_DIRTY_TYPE.hasOwnProperty(i.type)?n.push(i):t.push(i)})),{type:u.INFO_TYPE.DIRTY,supported:n,unsupported:t,protocols:r}}if(e.hasChild(u.INFO_TYPE.ROUTING)){const t=e.child(u.INFO_TYPE.ROUTING);return{type:u.INFO_TYPE.ROUTING,edgeRouting:t.child("routing_info").contentBytes(),domain:t.hasChild("dns_domain")?t.child("dns_domain").contentEnum(c.DOMAINS):null}}if(e.hasChild(u.INFO_TYPE.DOWNGRADE))return{type:u.INFO_TYPE.DOWNGRADE};if(e.hasChild(u.INFO_TYPE.OFFLINE))return{count:e.child(u.INFO_TYPE.OFFLINE).attrInt("count"),type:u.INFO_TYPE.OFFLINE};if(e.hasChild(u.INFO_TYPE.OFFLINE_PREVIEW))return{count:{message:e.child(u.INFO_TYPE.OFFLINE_PREVIEW).attrInt("message"),receipt:e.child(u.INFO_TYPE.OFFLINE_PREVIEW).attrInt("receipt"),notification:e.child(u.INFO_TYPE.OFFLINE_PREVIEW).attrInt("notification")},type:u.INFO_TYPE.OFFLINE_PREVIEW};if(e.hasChild(u.INFO_TYPE.TOS)){const t=[];return e.child("tos").forEachChildWithTag("notice",(e=>{t.push(e.attrString("id"))})),{type:u.INFO_TYPE.TOS,noticeIds:t}}return null}));function _(){return(_=(0,i.default)((function*(e){const t=f.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const n=t.success;if(n)switch(n.type){case u.INFO_TYPE.DIRTY:return yield(0,l.handleDirtyBits)(n),"NO_ACK";case u.INFO_TYPE.ROUTING:return(0,c.handleRoutingInfo)(n),"NO_ACK";case u.INFO_TYPE.DOWNGRADE:return o.Cmd.downgradeWebclient(),"NO_ACK";case u.INFO_TYPE.OFFLINE:return d.OfflineMessageHandler.setOfflineSessionComplete(n.count),(0,p.reportOfflineNotifications)(),"NO_ACK";case u.INFO_TYPE.OFFLINE_PREVIEW:return yield d.OfflineMessageHandler.setOfflineMessagePreviewCounter(n.count),"NO_ACK";case u.INFO_TYPE.TOS:return s.TosManager.maybeUpdateServer(n.noticeIds),"NO_ACK"}else __LOG__(3)`handleInfoBulletin unrecognized info bulletin`}))).apply(this,arguments)}},189816:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAINS=void 0,t.handleRoutingInfo=function(e){let t=e.domain;if(!t){const e=(0,i.getRoutingInfo)();t=e?e.domain:a.fb}const n=(0,r.bytesToBuffer)(e.edgeRouting);(0,i.setRoutingInfo)({domain:t,edgeRouting:n}),__LOG__(2)`handleInfoBulletin setting and domain: ${t} and edgeRouting:`};var r=n(787614),i=n(711597);const a={fb:"fb",sl:"sl"};t.DOMAINS=a},337222:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INFO_TYPE=void 0;const n=Object.freeze({DIRTY:"dirty",DOWNGRADE:"downgrade_webclient",ROUTING:"edge_routing",OFFLINE:"offline",OFFLINE_PREVIEW:"offline_preview",TOS:"tos"});t.INFO_TYPE=n},470605:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=r(n(145095)),s=n(831914),l=n(471914),c=n(696055),u=n(379923),d=n(978820),p=n(303151),f=n(16258);const _=new l.WapParser("mediaRetryNotification",(e=>{e.assertTag("notification");const t=e.maybeChild("error");if(t)return{msgId:e.attrString("id"),ciphertext:null,iv:null,errorCode:f.MediaRetryNotification$ResultType.cast(t.attrInt("code"))};const n=e.child("encrypt");return{msgId:e.attrString("id"),ciphertext:n.child("enc_p").contentBytes(),iv:n.child("enc_iv").contentBytes(u.ENC_IV_SIZE),errorCode:null}}));function h(){return(h=(0,i.default)((function*(e){const t=_.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{msgId:n,errorCode:r}=t.success,i=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n),class:"notification",type:"mediaretry",to:(0,c.USER_JID)((0,d.getMeUser)())});if(null!=r)return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:n,result:r}),i;const{ciphertext:l,iv:f}=t.success,h=p.RequestMediaReuploadManager.getMediaKey(n);if(!h)return __LOG__(3)`handleMediaRetryNotification: mediaKey is not found for msgId ${n}`,i;const{stanzaId:g,directPath:m,result:y}=yield(0,u.decryptMediaRetryNotification)((0,a.decodeB64)(h),n,(0,o.default)(f,"iv"),(0,o.default)(l,"ciphertext"));if(g!==n)throw new Error("handleMediaRetryNotification: msg id does not match");return p.RequestMediaReuploadManager.resolveMediaReupload({msgId:n,result:y,directPath:m}),i}))).apply(this,arguments)}},306303:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageError=t.ReactionValidationError=t.PollVoteValidationErrorCode=t.PollVoteValidationError=t.PollUpdateValidationErrorCode=t.PollUpdateValidationError=t.PollCreationValidationWarningCode=t.PollCreationValidationErrorCode=t.PollCreationValidationError=t.DeviceSentMessageError=void 0;var i=n(640265),a=r(n(11339));class o extends((0,i.customError)("DeviceSentMessageError")){constructor(e,t){t===a.default.DSM_ERROR.MISSING_DSM?super("parseMessage: message should be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_SENDER?super("parseMessage: message should not be deviceSentMessage"):t===a.default.DSM_ERROR.INVALID_DSM?super("parseMessage: invalid deviceSentMessage"):super("parseMessage: unknown deviceSentMessage error"),new a.default.MdBadDeviceSentMessage({peerType:e,dsmError:t}).commit(),this.peerType=e,this.dsmError=t}}t.DeviceSentMessageError=o;class s extends((0,i.customError)("UnknownMessageError")){}t.UnknownMessageError=s;class l extends((0,i.customError)("ReactionValidationError")){}t.ReactionValidationError=l;const c=n(76672)({DUPLICATE_OPTIONS:"poll_creation_duplicate_options"});t.PollCreationValidationWarningCode=c;const u=n(76672)({INVALID_MESSAGE_SECRET:"poll_creation_invalid_message_secret",INVALID_NAME:"poll_creation_invalid_name",INVALID_OPTIONS_COUNT:"poll_creation_invalid_options_count",INVALID_OPTION:"poll_creation_invalid_option",INVALID_SELECTABLE_OPTIONS_COUNT:"poll_creation_invalid_selectable_options_count",MISSING_MESSAGE_SECRET:"poll_creation_missing_message_secret",MISSING_NAME:"poll_creation_missing_name",MISSING_OPTIONS:"poll_creation_missing_options",MISSING_SELECTABLE_OPTIONS_COUNT:"poll_creation_missing_selectable_options_count"});t.PollCreationValidationErrorCode=u;class d extends((0,i.customError)("PollCreationValidationError")){constructor(e){super(e),this.code=e}}t.PollCreationValidationError=d;const p=n(76672)({MESSAGE_STANZA_INVALID:"poll_update_message_stanza_invalid",INVALID_VOTE_ENC_IV:"poll_update_invalid_vote_enc_iv",MISSING_POLL_MESSAGE_KEY:"poll_update_missing_poll_message_key",MISSING_SENDER_TIMESTAMP:"poll_update_missing_sender_timestamp",MISSING_UPDATE:"poll_update_missing_update",MISSING_VOTE_ENC_IV:"poll_update_missing_vote_enc_iv",MISSING_VOTE_ENC_PAYLOAD:"poll_update_missing_vote_enc_payload",INVALID_RENDERABLE_MSG_COUNT:"invalid_renderable_msg_count"});t.PollUpdateValidationErrorCode=p;class f extends((0,i.customError)("PollUpdateValidationError")){constructor(e){super(e),this.code=e}}t.PollUpdateValidationError=f;const _=n(76672)({INVALID_MESSAGE_SECRET:"poll_vote_invalid_message_secret",INVALID_OPTION:"poll_vote_invalid_option",INVALID_OPTIONS_COUNT:"poll_vote_invalid_options_count",OPTION_NOT_FOUND:"poll_vote_option_not_found"});t.PollVoteValidationErrorCode=_;class h extends((0,i.customError)("PollVoteValidationError")){constructor(e){super(e),this.code=e}}t.PollVoteValidationError=h},49714:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PlaceholderType=t.MESSAGE_TYPE=t.HostStorageEnumType=t.E2EProcessResult=t.ActualActorsEnumType=void 0;const r=n(76672)({Self:1,Bsp:2});t.ActualActorsEnumType=r;const i=n(76672)({OnPremise:1,Facebook:2});t.HostStorageEnumType=i;const a=n(76672).Mirrored(["SUCCESS","RETRY","HSM_MISMATCH","BACKFILL","PARSE_ERROR","PARSE_VALIDATION_ERROR"]);t.E2EProcessResult=a;const o=n(76672).Mirrored(["E2E","FANOUT"]);t.PlaceholderType=o;const s=Object.freeze({CHAT:"chat",GROUP:"group",PEER_BROADCAST:"peer_broadcast",OTHER_BROADCAST:"other_broadcast",DIRECT_PEER_STATUS:"direct_peer_status",OTHER_STATUS:"other_status"});t.MESSAGE_TYPE=s},270569:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=c.incomingMsgParser.parse(e);if(t.error){const n=c.incomingMsgParserForAckOnly.parse(e);if(n.error)return Promise.reject(t.error);const{externalId:r,from:i,type:a}=n.success;return(0,p.sendAck)(r,i,a)}const n=t.success,{msgMeta:r,msgInfo:m}=n;m.clientReceivedTsMillis=(0,a.unixTimeMs)(),null!=m.offline&&(f.OfflineMessageHandler.addOfflinePendingMessage(),f.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete());f.OfflineMessageHandler.isResumeFromRestartComplete()&&delete n.msgInfo.offline;return(0,o.handleMessage)(m.chat.toString(),!!n.msgInfo.offline,(0,i.default)((function*(){if(m.msgProcessStartTsMillis=(0,a.unixTimeMs)(),r.isUnavailable)return __LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${m.externalId}, get fanout placeholder`,yield(0,u.processPlaceholderMsg)(m,l.PlaceholderType.FANOUT),void(0,d.sendReceipt)(m,r,{result:l.E2EProcessResult.BACKFILL});if(null!=m.offline){const e=yield f.OfflineMessageHandler.decryptOfflineMessage(n);e.result!==l.E2EProcessResult.SUCCESS||m.category===s.CATEGORY_PEER?(0,d.sendReceipt)(m,r,e):_.default.addOfflineMessage([{receiptInfo:{externalId:m.externalId,from:(0,g.getFrom)(m),author:m.author}}])}else{__LOG__(2,void 0,void 0,void 0,["messaging"])`handleMessage: msgId::${m.externalId}, start processing inline message`;const e=yield(0,h.decryptE2EPayload)(n);(0,d.sendReceipt)(m,r,e)}})))};var i=r(n(348926)),a=n(892844),o=n(521522),s=n(312037),l=n(49714),c=n(20365),u=n(953348),d=n(699353),p=n(542317),f=n(528237),_=r(n(729783)),h=n(145789),g=n(1201)},312037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POLL_TYPES=t.PAY_NODE_TYPES=t.MSG_VERIFIED_LEVEL=t.MSG_TYPES=t.HsmMismatchError=t.CATEGORY_PEER=void 0;var r=n(640265);t.MSG_TYPES={text:"text",media:"media",pay:"pay",poll:"poll",reaction:"reaction"};t.POLL_TYPES={creation:"creation",vote:"vote"};t.MSG_VERIFIED_LEVEL={high:"high",low:"low",unknown:"unknown"};t.CATEGORY_PEER="peer";class i extends((0,r.customError)("HSMMismatchError")){}t.HsmMismatchError=i;t.PAY_NODE_TYPES={send:"send",request:"request",futureproof:"futureproof","request-decline":"request-decline","request-cancel":"request-cancel",invite:"invite"}},548616:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logReceivedMessagesInWAM=function(e,t,n,r,_){(function(e,t,n,r,o){const _=(0,a.unixTimeMs)();e.forEach((e=>{const a=new f.Msg(e),h=new p.default.MessageReceive((0,i.default)({messageType:a.getWamMessageType(),messageMediaType:a.getWamMediaType(),messageIsInternational:a.isInternational,messageIsOffline:t,isViewOnce:Boolean(a.isViewOnce),isForwardedForward:Boolean(a.numTimesForwarded>1),isAReply:a.isReply()},(0,d.getGroupMetricsFromChatWid)(a.from)));if(!a.from.isGroup()){const e=(0,u.getDisappearingModeSettingForUser)(a.from);null!=e&&(h.senderDefaultDisappearingDuration=e.duration);const t=(0,c.getMaybeMeUser)(),n=(0,u.getDisappearingModeSettingForUser)(t);null!=n&&(h.receiverDefaultDisappearingDuration=n.duration)}a.isRevoke&&(h.revokeType="admin_revoke"===a.subtype?p.default.REVOKE_TYPE.ADMIN:p.default.REVOKE_TYPE.SENDER),null!=r&&(h.messageReceiveT0=r-n,h.messageReceiveT1=_-r,null!=o&&(h.messageQueueTime=o-r)),null!=a.ephemeralDuration&&a.ephemeralDuration>0&&(h.ephemeralityDuration=a.ephemeralDuration);const g=a.getWamDisappearingModeInitiator();null!=g&&(h.disappearingChatInitiator=g);const m=(0,d.getGroupTypeFromChatWid)(a.from);if(null!=m&&(h.typeOfGroup=m),h.commit(),a.chat&&!a.isSentByMe)if((0,s.shouldBlockByCountry)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.COUNTRY}).commit()}else if((0,l.shouldBlockByTos)(a.chat.contact)){new p.default.GatedMessageReceived({chatGatedReason:p.default.CHAT_GATED_REASON.TOS3}).commit()}}))})(e,t,n,r,_),function(e){(0,o.handleActivitiesForChatThreadLogging)(e.map((e=>{const t=new f.Msg(e);return{activityType:t.id.fromMe?"msgSend":"msgReceive",ts:t.t,chatId:t.id.remote,isViewOnce:t.isViewOnce,isCommerceMessage:t.isCommerceMsg,isReply:t.isReply()}})))}(e)};var i=r(n(81109)),a=n(892844),o=n(217869),s=n(49506),l=n(507134),c=n(978820),u=n(728307),d=n(542515),p=r(n(11339)),f=n(17304)},20365:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.incomingMsgParserForAckOnly=t.incomingMsgParser=void 0;var i=r(n(81109)),a=n(471914),o=n(824214),s=n(181663),l=n(978820),c=n(745454),u=n(312037),d=n(421224),p=n(202599),f=n(49714),_=n(775295),h=n(552586);const g=new a.WapParser("incomingMsgParser",(e=>{e.assertTag("message"),e.hasAttr("to")&&e.assertAttr("to",(0,l.assertGetMe)().toJid());const t=e.mapChildrenWithTag("enc",(e=>({e2eType:e.attrEnumValues("type",o.CiphertextType.members()),mediaType:o.MediaType.cast(e.maybeAttrString("mediatype")),ciphertext:e.contentBytes(),retryCount:e.hasAttr("count")?e.attrInt("count"):0,hideFail:"hide"===e.maybeAttrString("decrypt-fail")}))),n=e.maybeChild("device-identity"),r=n?n.contentBytes():null,a=function(e,t){const n={externalId:e.attrString("id"),ts:e.attrTime("t"),edit:e.hasAttr("edit")?e.attrInt("edit"):-1,isHsm:e.hasChild("hsm"),count:e.hasAttr("count")?e.attrInt("count"):null,pushname:e.hasAttr("notify")?e.attrString("notify"):null,displayName:e.hasAttr("display_name")?e.attrString("display_name"):null,senderPn:e.hasAttr("sender_pn")?(0,s.userJidToUserWid)(e.attrUserJid("sender_pn")):null,category:e.hasAttr("category")?e.attrString("category"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},r=(0,s.jidWithTypeToWid)(e.attrJidWithType("from")),a=e.hasAttr("participant")?(0,s.deviceJidToDeviceWid)(e.attrDeviceJid("participant")):null,u=e.hasAttr("recipient")?(0,s.userJidToUserWid)(e.attrUserJid("recipient")):null,d=t.every((e=>e.e2eType!==o.CiphertextType.Skmsg)),p=t.some((e=>e.retryCount>0));let _;const h={},g=e.maybeChild("participants");if(g){const e=[];g.forEachChildWithTag("to",(t=>{const n=(0,s.deviceJidToDeviceWid)(t.attrDeviceJid("jid")),r=t.maybeAttrString("eph_setting");e.push(n),null!=r&&(h[n.toString()]=r)})),_=e}if(r.isUser())return null!=u?(0,l.isMeAccount)(r)?(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.CHAT},n),{},{chat:(0,c.toUserWid)(u),author:r}):e.throw("recipient on non peer chat message"):(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.CHAT},n),{},{chat:(0,c.toUserWid)(r),author:r});if(r.isGroup())return null==a?e.throw("group message with no participant"):(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.GROUP},n),{},{chat:r,author:a,isDirect:d});if(r.isBroadcast()&&!r.isStatusV3()){if(null==a)return e.throw("broadcast message with no participant");if((0,l.isMeAccount)(a)){if(null==_){if(!p)return e.throw("peer broadcast message with no participants node");_=[]}return(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.PEER_BROADCAST},n),{},{chat:r,author:a,isDirect:d,bclParticipants:_,bclHashValidated:!1,bclEphSettings:h})}return(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.OTHER_BROADCAST},n),{},{chat:r,author:a,isDirect:d,ephSetting:e.maybeAttrString("eph_setting")})}if(r.isBroadcast()&&r.isStatusV3())return null==a?e.throw("status message with no participant"):(0,l.isMeAccount)(a)&&d?null==_?(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.DIRECT_PEER_STATUS},n),{},{chat:r,author:a,isDirect:d}):(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.DIRECT_PEER_STATUS},n),{},{chat:r,author:a,bclParticipants:_,bclHashValidated:!1}):(0,i.default)((0,i.default)({type:f.MESSAGE_TYPE.OTHER_STATUS},n),{},{chat:r,author:a,isDirect:d});return e.throw("Unrecognized message type")}(e,t);return{encs:t,msgInfo:a,msgMeta:function(e,t){const n=e.hasChild("unavailable");n||0!==t.length||e.throw("incomingMsgParser: to have enc node children");const r=e.attrEnum("type",u.MSG_TYPES),i=r===u.MSG_TYPES.poll?e.child("meta").attrEnumOrNullIfUnknown("polltype",u.POLL_TYPES):null;return{isUnavailable:n,type:r,pollType:i,rawTs:e.attrString("t"),urlNumber:e.hasChild("url_number"),urlText:e.hasChild("url_text")}}(e,t),bizInfo:function(e){const t=e.hasChild("verified_name")?e.child("verified_name").contentBytes():null,n=e.attrEnumOrDefault("verified_level",u.MSG_VERIFIED_LEVEL,null),r=e.hasAttr("verified_name")?e.attrInt("verified_name"):-1,i=e.maybeChild("biz");let a=null;if(null!=i){const e=f.ActualActorsEnumType.cast(i.maybeAttrInt("actual_actors")),t=f.HostStorageEnumType.cast(i.maybeAttrInt("host_storage")),n=i.maybeAttrInt("privacy_mode_ts");null!=e&&null!=t&&null!=n&&(a={actualActors:e,hostStorage:t,privacyModeTs:n})}const o=null==i?void 0:i.maybeAttrString("native_flow_name");return{verifiedNameCert:t,verifiedLevel:n,verifiedNameSerial:r,privacyMode:a,nativeFlowName:o}}(e),paymentInfo:function(e){let t=null;const n=e.hasChild("pay")?e.child("pay"):null,r=e.hasChild("transaction")?e.child("transaction"):null,i=(0,s.jidWithTypeToWid)(e.attrJidWithType("from")).isGroup(),a=e.hasAttr("participant")?(0,s.jidWithTypeToWid)(e.attrJidWithType("participant")):null;if((0,_.isNoviTransaction)(n)||(0,_.isNoviTransaction)(r))t={futureproofed:!0};else if(r){const e=(0,_.parseTransactionNode)(r);e&&(t=m(i,a,(0,c.createWid)(e.receiver.toString()))?{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts,txnStatus:(0,h.getPaymentTxnWebStatus)(e.status)}:{receiverJid:e.receiver.toString(),currency:e.currency,amount1000:e.amount1000,transactionTimestamp:e.ts})}else if(n){switch(n.attrEnum("type",u.PAY_NODE_TYPES)){case u.PAY_NODE_TYPES.send:const{amount1000:r,currency:o}=(0,p.getAmount1000AndCurrency)(n),s=n.hasAttr("receiver")?n.attrString("receiver"):e.attrString("recipient");t=m(i,a,(0,c.createWid)(s))?{receiverJid:s,currency:o,amount1000:r,transactionTimestamp:e.attrInt("t"),txnStatus:d.PaymentInfo$TxnStatus.INIT}:{receiverJid:s,currency:o,amount1000:r,transactionTimestamp:e.attrInt("t")};break;case u.PAY_NODE_TYPES.request:case u.PAY_NODE_TYPES.invite:}}return t}(e),deviceIdentity:r}}));function m(e,t,n){if(e&&null!=t&&null!=n){const e=(0,l.getMeUser)();if(!e.equals(t)&&!e.equals(n))return!1}return!0}t.incomingMsgParser=g;const y=new a.WapParser("incomingMsgParserForAckOnly",(e=>(e.assertTag("message"),{externalId:e.attrString("id"),from:(0,s.jidWithTypeToWid)(e.attrJidWithType("from")),type:e.attrEnum("type",u.MSG_TYPES)})));t.incomingMsgParserForAckOnly=y},953348:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.processDecryptedProto=function(){return ae.apply(this,arguments)},t.processPlaceholderMsg=function(){return le.apply(this,arguments)},t.processPollUpdateVoteMsg=fe,t.processReactionMsg=ce,t.processRenderableMsg=oe,t.storePollVotesBulk=function(){return he.apply(this,arguments)},t.storeReactionMsgBulk=function(){return ge.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(645563),s=n(272720),l=n(75396),c=n(880617),u=n(264687),d=n(876867),p=n(96759),f=n(408139),_=n(707122),h=n(115461),g=n(750180),m=n(758180),y=n(108197),S=n(62290),E=n(837398),v=n(867811),T=n(550111),C=n(14571),A=r(n(303441)),b=n(217806),P=n(555452),O=n(978820),M=n(745454),I=n(1201),w=ie(n(959060)),R=ie(n(99274)),N=n(697710),L=n(909025),D=n(124808),k=r(n(11339)),U=(n(17304),n(542618)),G=n(845222),x=n(584886),B=n(83113),F=n(484902),j=r(n(869153)),Y=n(306303),K=r(n(939505)),W=n(819655),H=n(765582),V=n(182568),$=n(312037),z=n(229331),q=n(49714),J=n(506736),Q=n(529805),X=n(548616),Z=r(n(729783)),ee=n(155552),te=n(900267),ne=n(122695);function re(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(re=function(e){return e?n:t})(e)}function ie(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=re(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function ae(){return(ae=(0,a.default)((function*(e,t,n,r,i){let a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=arguments.length>6?arguments[6]:void 0;const l=a?(0,o.unpadPkcs7)(new Uint8Array(e)):new Uint8Array(e),c=(0,F.decodeProtobuf)(D.MessageSpec,l);if(null==t.offline&&__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${t.externalId}, message decrypted: `,!t.isHsm&&c.highlyStructuredMessage)throw new $.HsmMismatchError;const u=(0,I.getFrom)(t);if(!(yield(0,ne.isFromKnownDevice)(t.author))){const e=(0,M.toUserWid)(t.author);throw null==t.offline?(0,T.syncDeviceListJob)([e],null,null):j.default.addOfflinePendingDevice(String(e),null),new Y.UnknownMessageError(`[messaging] msgId::${t.externalId}, processDecryptedProto: reject message from unknown device`)}if(t.type===q.MESSAGE_TYPE.PEER_BROADCAST&&r.retryCount>0){const e=yield(0,x.getMsgByMsgKey)((0,I.messageInfoToKey)(t));null!=(null==e?void 0:e.broadcastParticipants)&&(t.bclParticipants=e.broadcastParticipants,null!=e.broadcastEphSettings&&(t.bclEphSettings=e.broadcastEphSettings))}c.messageContextInfo&&(0,d.handleICDCData)(t.author,t.chat.isUser()?t.chat:null,c.messageContextInfo);const _=yield(0,I.parseMessage)(t,r.e2eType,c,n,i,e,r.hideFail);if(_.history)(0,W.handleHistorySyncNotification)(_.history,u,t.externalId);else if(_.securityNotificationEnabled)(0,P.setGlobalSecurityNotifications)(_.securityNotificationEnabled.isEnabled);else if(_.appStateSyncKeyShare)(0,V.handleAppStateSyncKeyShare)(_.appStateSyncKeyShare,u);else if(_.appStateSyncKeyRequest)yield(0,H.handleAppStateSyncKeyRequest)(_.appStateSyncKeyRequest,u);else{var g,y,S,E;let e=!1;if(null==_.deviceSent?e=!0:_.deviceSent.phash?e=yield(0,ne.validateBclHash)(_.deviceSent.phash,_.deviceSent.info):_.deviceSent.destination&&(e=yield(0,ne.validateMsgDestination)(_.deviceSent.destination,t)),!e)throw new Y.DeviceSentMessageError((0,I.getDeviceType)(t.author),k.default.DSM_ERROR.INVALID_DSM);if((0,f.receiveReactionsEnabled)()&&(null==s?void 0:s.type)===$.MSG_TYPES.reaction&&_.renderableMsgs.length>0){if(1!==_.renderableMsgs.length)throw new Y.ReactionValidationError("[messaging] Reaction failed validation due to renderableMsgs being more than 1");if(_.renderableMsgs[0].type!==h.MSG_TYPE.REACTION)throw new Y.ReactionValidationError("[messaging] Reaction failed validation due to missing ReactionMessage in proto")}if((null==s?void 0:s.type)===$.MSG_TYPES.poll&&(null==s?void 0:s.pollType)===$.POLL_TYPES.vote){if(_.renderableMsgs.length>1)throw new Y.PollUpdateValidationError(Y.PollUpdateValidationErrorCode.INVALID_RENDERABLE_MSG_COUNT);const[e]=_.renderableMsgs;if(null!=e){const t=e.type===h.MSG_TYPE.UNKNOWN&&e.subtype===h.MSG_TYPE.POLL_UPDATE,n=e.type===h.MSG_TYPE.POLL_UPDATE&&null!=e.encPollVote;if(!t&&!n)throw new Y.PollUpdateValidationError(Y.PollUpdateValidationErrorCode.MESSAGE_STANZA_INVALID)}}const a=[];if((0,f.receiveReactionsEnabled)()&&(null===(g=_.renderableMsgs[0])||void 0===g?void 0:g.type)===h.MSG_TYPE.REACTION)a.push(ce(_.renderableMsgs[0],t));else if((0,m.isPollsReceivingEnabled)()&&(null===(y=_.renderableMsgs[0])||void 0===y?void 0:y.type)===h.MSG_TYPE.POLL_UPDATE&&null!=(null===(S=_.renderableMsgs[0])||void 0===S?void 0:S.encPollVote))a.push(fe(_.renderableMsgs[0],t));else if((0,Q.isKeepInChatReadEnabled)()&&(null===(E=_.renderableMsgs[0])||void 0===E?void 0:E.type)===h.MSG_TYPE.KEEP_IN_CHAT)a.push((0,p.processKeepInChatMsg)(_.renderableMsgs[0]));else{const e=r.retryCount>0&&(0,I.placeholderCheck)(t);a.push(oe(_.renderableMsgs,t,n,i,e)),null!=_.storeMsg&&(0,x.storeMessages)([_.storeMsg],_.storeMsg.id.remote)}null!=_.senderKey&&a.push(w.Session.createGroupSignalSession(t.author,_.senderKey.groupId,_.senderKey.key)),t.pushname&&(0,J.updatePushname)(t.author,t.pushname,null!=t.offline),yield Promise.all(a),(0,X.logReceivedMessagesInWAM)(_.renderableMsgs,null!=t.offline,1e3*t.ts,t.clientReceivedTsMillis,t.msgProcessStartTsMillis)}}))).apply(this,arguments)}function oe(){return se.apply(this,arguments)}function se(){return(se=(0,a.default)((function*(e,t,r,o,d){if((0,N.isUnifiedMessageProcessingEnabled)())return R.processRenderableMessages(e,t,r,o,d);try{const r=(0,K.default)(t,o),p=null==r?e:e.map((e=>(0,i.default)((0,i.default)({},e),{},{privacyModeWhenSent:r})));if(t.offline)return void Z.default.addOfflineMessage(p.map((e=>({msg:e}))));const m=t.chat,S=n(669951).ChatCollection,E=m.isUserNotPSA(),v=E&&null==S.get(m),T=(0,y.getLatestPrivacyMode)(o.privacyMode,(0,y.getContactPrivacyMode)(m));try{if(E){const t=yield(0,L.getExisting)(m);if(null==t){const t=e[0];yield(0,g.createChatOnNewMsg)(m,t,T)}else null!=T&&(yield(0,u.handlePrivacyModeTransition)(m,T,t))}}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`createChatOnNewMsg or handlePrivacyModeTransition for ${m.toString()}, failed with error: ${e}`,SEND_LOGS("createChatOnNewMsg or handlePrivacyModeTransition failed")}if(t.author.isLid()&&(null!=t.displayName&&(0,G.createOrReplaceDisplayNames)([{lid:t.author.user,displayName:t.displayName}]),null!=t.senderPn&&(0,G.createOrReplaceLidPnMappings)([{lid:t.author.user,pn:t.senderPn.user}])),yield Promise.all(p.map(function(){var e=(0,a.default)((function*(e){yield(0,_.handleSingleMsgMD)(e.id.remote,e,d),(0,s.processOrphanAck)(e.id).catch((e=>{__LOG__(2)`processOrphanAck: msgId::${t.externalId}, failed with error: ${e}`,__LOG__(3,void 0,void 0,void 0,["messaging"])`processOrphanAck: failed`})),e.type===h.MSG_TYPE.PAYMENT&&"send"===e.subtype&&(0,ee.processOrphanPaymentNotifications)([e])}));return function(){return e.apply(this,arguments)}}())),yield Promise.all(e.map(U.processOrphansForNewMsg)),v&&(0,c.queryAndUpdateContactPropertiesOnNewChat)(m),E&&!(0,O.isMeAccount)(t.author)&&null!=T){const e=n(559871).MsgCollection;Promise.all(p.map((t=>{const n=e.get(t.id);if(n)return(0,A.default)(n,T)})))}(0,f.isMultiDeviceAgentsEnabled)()&&(yield(0,l.updateUnattributedMessages)(t,p))}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMsg: msgId::${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}}))).apply(this,arguments)}function le(){return(le=(0,a.default)((function*(e,t){if((0,N.isUnifiedMessageProcessingEnabled)())return R.processPlaceholderMessage(e,t);if(e.category!==$.CATEGORY_PEER)try{const n=yield(0,I.genPlaceholderMsg)(e,t);e.offline?Z.default.addOfflineMessage(n.map((e=>({msg:e})))):yield Promise.all(n.map(function(){var e=(0,a.default)((function*(e){const t=e.id.remote;yield(0,_.handleSingleMsgMD)(t,e)}));return function(){return e.apply(this,arguments)}}()))}catch(t){__LOG__(4,void 0,new Error,!0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, failed with error: ${t}`,SEND_LOGS("handle_msg: error storing/processing single message")}else __LOG__(2,void 0,void 0,void 0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, skip placeholder for peer message ${e.externalId}`}))).apply(this,arguments)}function ce(){return ue.apply(this,arguments)}function ue(){return(ue=(0,a.default)((function*(e,t){if((0,N.isUnifiedMessageProcessingEnabled)())return R.processReactionMessage(e,t);if(t.offline){const n={msg:e,receiptInfo:{from:e.from,author:t.author}};return void Z.default.addOfflineMessage([n])}const n=yield(0,v.createReactionsRow)(e,t);if(!n)return;String(e.id),String(e.reactionParentKey);const r=yield(0,E.addOrUpdateReactions)(n,!0);return r&&(0,f.showReactionChatListPreview)()&&(yield de([r])),(0,z.processReactionOrphanPeerReceipt)(e.id)}))).apply(this,arguments)}function de(){return pe.apply(this,arguments)}function pe(){return(pe=(0,a.default)((function*(e){const t=yield(0,te.filterChatsWithReactionPreviewUpdates)(e);t.size>0&&(yield(0,C.updateDatabaseForLastReactionPreview)(t),(0,C.updateModelsForLastReactionPreview)(t))}))).apply(this,arguments)}function fe(){return _e.apply(this,arguments)}function _e(){return(_e=(0,a.default)((function*(e,t){if(null==t.offline)yield(0,S.processPollUpdateMsgsOnline)([e]);else{const n={msg:e,receiptInfo:{from:e.from,author:t.author}};Z.default.addOfflineMessage([n])}}))).apply(this,arguments)}function he(){return(he=(0,a.default)((function*(e){(0,b.upsertVotesModelCollection)(e),yield(0,B.upsertVotes)(e)}))).apply(this,arguments)}function ge(){return(ge=(0,a.default)((function*(e){const t=e.map((e=>(0,v.webMsgInfoReactionTypeToReactionsRow)(e)));t.map((e=>`${e.msgKey.toString()} to ${e.parentMsgKey}`)).toString();const n=yield(0,E.addOrUpdateReactionsDBBulk)(t);return n&&(0,f.showReactionChatListPreview)()&&(yield de(n)),n}))).apply(this,arguments)}},699353:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendReceipt=function(e,t,n){const{externalId:f}=e,{rawTs:_,type:h}=t,g=(0,d.getFrom)(e),m=e.type===u.MESSAGE_TYPE.CHAT&&(0,l.isMeAccount)(e.author)?e.chat:null,y=e.type===u.MESSAGE_TYPE.CHAT?null:e.author,S=e.category===c.CATEGORY_PEER;switch(n.result){case u.E2EProcessResult.SUCCESS:return(0,o.sendDeliveryReceiptsAfterDecryption)(f,g,m,y,S,h);case u.E2EProcessResult.HSM_MISMATCH:return Promise.resolve();case u.E2EProcessResult.RETRY:const c=null==n.retryCount?1:n.retryCount+1,d=(0,s.sendRetryReceipt)(c,g,y,m,f,_,S);return(0,p.maybePostMessageHighRetryCountMetric)(c,e),d;default:return Promise.resolve((0,r.castStanza)((0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(f),class:"message",from:(0,a.DEVICE_JID)((0,l.assertGetMe)()),to:g?(0,a.JID)(g):i.DROP_ATTR,type:t.type,participant:y?(0,a.USER_JID)(y):i.DROP_ATTR})))}};var r=n(736184),i=n(831914),a=n(696055),o=n(987168),s=n(796109),l=n(978820),c=n(312037),u=n(49714),d=n(1201),p=n(881861)},542317:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendAck=function(e,t,n){return Promise.resolve((0,r.castStanza)((0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(e),class:"message",from:(0,a.DEVICE_JID)((0,o.assertGetMe)()),to:t?(0,a.JID)(t):i.DROP_ATTR,type:n})))};var r=n(736184),i=n(831914),a=n(696055),o=n(978820)},939505:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.type!==a.MESSAGE_TYPE.CHAT)return;if(!(0,i.isMeAccount)(e.author))return t.privacyMode;const n=t.privacyMode,o=(0,r.getContactPrivacyMode)(e.chat);return(0,r.getLatestPrivacyMode)(o,n)};var r=n(108197),i=n(978820),a=n(49714)},900267:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkGetChatLastReactionPreviewMap=u,t.filterChatsWithReactionPreviewUpdates=function(){return _.apply(this,arguments)},t.getChatdIdOfReaction=p,t.isReactionPreviewUpdateCandidate=l,t.isReactionTypeRevoke=c,t.isRevokingReaction=f;var i=r(n(348926)),a=r(n(465212)),o=n(867811),s=n(776214);function l(e){const t=a.default.fromString(e.parentMsgKey);return((0,o.isReactionByMe)(e.senderUserJid)||t.fromMe)&&1!==e.orphan}function c(e){return e.reactionText===o.REVOKED_REACTION_TEXT}function u(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const t=new Map;return(yield(0,s.getChatTable)().bulkGet(e)).forEach((e=>{null!=e&&t.set(e.id.toString(),e.lastReactionPreview)})),t}))).apply(this,arguments)}function p(e){return a.default.fromString(e.parentMsgKey).remote.toString()}function f(e,t){return!!c(e)&&(e.senderUserJid===t.senderUserJid&&e.parentMsgKey===t.parentMsgKey&&e.timestamp>=t.timestamp)}function _(){return(_=(0,i.default)((function*(e){const t=e.filter((e=>l(e))),n=new Map;if(!t.length)return n;const r=new Set(t.map((e=>a.default.fromString(e.parentMsgKey).remote.toString()))),i=yield u(Array.from(r));return t.forEach((e=>{const t=p(e),r=i.get(t),a=n.get(t),o=null!=a?a:r;c(e)?o&&f(e,o)&&e.timestamp>=o.timestamp&&n.set(t,void 0):o?e.timestamp>=o.timestamp&&n.set(t,e):n.set(t,e)})),n}))).apply(this,arguments)}},122695:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.isFromKnownDevice=function(){return d.apply(this,arguments)},t.validateBclHash=function(){return u.apply(this,arguments)},t.validateMsgDestination=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=n(769315),s=n(978820),l=n(209108);function c(){return(c=(0,i.default)((function*(e,t){var n;const r=t.chat;if(!e.equals(r))return __LOG__(4,void 0,new Error,!0)`encDestination: ${String(e)}, destination: ${r.toString()}`,SEND_LOGS("validateMsgDestination: drop due to the deviceSentMessage meta mismatch."),!1;const i=t.author;if(!(0,s.isMeAccount)(i))return __LOG__(4,void 0,new Error,!0)`sender: ${i.toString()}`,SEND_LOGS("validateMsgDestination: drop due to msg is not sent from your own device."),!1;const a=yield(0,l.hasDevice)(i,null!==(n=i.device)&&void 0!==n?n:0);return a||(__LOG__(4,void 0,new Error,!0)`no record found for sender: ${i.toString()}`,SEND_LOGS("validateMsgDestination:drop due to invalid device")),a}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){var n;const r=null!==(n=t.bclParticipants)&&void 0!==n?n:[],i=yield(0,o.phashV2)(r);return i!==e?(__LOG__(4,void 0,new Error,!0)`expected: ${e}, got: ${i}`,SEND_LOGS("validateBclHash: drop due to invalid hash."),!1):(t.bclHashValidated=!0,!0)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const t=null==e.device?a.DEFAULT_DEVICE_ID:e.device;if(t===a.DEFAULT_DEVICE_ID)return!0;const[n]=yield(0,l.getDeviceIds)([e]);return null!=n&&n.devices.includes(t)}))).apply(this,arguments)}},648309:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleChatSimpleReceipt=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=n(257243),o=n(535470),s=r(n(465212)),l=n(555452),c=n(978820),u=n(745454),d=n(229331),p=n(853575),f=n(528237),_=r(n(166545)),h=n(697710),g=n(832543),m=n(847124);function y(){return(y=(0,i.default)((function*(e){const{from:t,externalIds:n,ts:r,recipient:i,ackString:y,offline:E,biz:v}=e;let{ack:T}=e;const C=y===o.ACK_STRING.SENDER,A=!C&&(0,u.toUserWid)(t).equals((0,c.getMeUser)());let b;if(A||C){if(!i)throw __LOG__(3)`error: invalid sender/peer receipt without recipient`,new Error("handleChatSimpleReceipt: invalid sender/peer receipt without recipient");b=i}else{b=(0,u.toUserWid)(t);"none"===(0,l.getUserPrivacySettings)().readReceipts&&(T===o.ACK.READ||T===o.ACK.PLAYED&&(0,a.getABPropConfigValue)("played_self_enabled"))&&(T=o.ACK.RECEIVED)}const P=n.map((e=>new s.default({id:e,remote:b,fromMe:!A})));A&&T===o.ACK.PLAYED&&(0,d.handleViewOnceOpenedIfNecessary)(P);const O=P.map((e=>e.toString()));if(null!=E&&f.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),(0,h.isUnifiedReceiptProcessingEnabled)()){const e=null!=E&&!f.OfflineMessageHandler.isResumeFromRestartComplete();if(A){if(null!=i&&e&&(0,p.isReadOrPlayedReceipt)(y)&&n.length>0)return g.receiptBatcher.acceptPeerReceipt({ack:T,ts:r,msgKeys:O})}else g.receiptBatcher.acceptOtherReceipt({ack:T,ts:r,receiverId:t,msgKeys:O});e||(g.receiptBatcher.runActiveBatches(),S(A,C,P,b,T,r,v))}else if(null==E||f.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(S(A,C,P,b,T,r,v)),A||e.push((0,m.updateReceiptRecords)(T,r,t,O,v?{actualActors:v.actualActors,hostStorage:v.hostStorage,privacyModeTs:v.privacyModeTs}:null).catch((e=>{__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleChatSimpleReceipt: failed")}))),yield Promise.all(e)}else{if(!A)return _.default.addOfflineReceipt(T,r,t,O);if(null!=i&&(0,p.isReadOrPlayedReceipt)(y)&&n.length>0)return _.default.addOfflinePeerReceipt(r,O,T)}}))).apply(this,arguments)}function S(e,t,n,r,i,a,s){return i<o.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleChatSimpleReceipt: sender receipt from peer device ${r.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleChatSimpleReceipt: peer receipt from peer device ${r.toString()}`,i===o.ACK.READ?(0,d.updateChatPeerRead)(r,n):i===o.ACK.PLAYED?(0,d.updateMsgAcks)(n,i,a):Promise.resolve()):(0,d.updateMsgAcks)(n,i,a,s)}},284947:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleGroupSimpleReceipt=function(){return v.apply(this,arguments)};var i=r(n(348926)),a=n(535470),o=n(272720),s=n(219534),l=r(n(465212)),c=n(879274),u=n(978820),d=n(745454),p=n(229331),f=n(853575),_=n(528237),h=r(n(166545)),g=n(697710),m=n(832543),y=n(559871),S=n(617972),E=n(847124);function v(){return(v=(0,i.default)((function*(e){const{ack:t,from:n,externalIds:r,ts:o,ackString:s,participant:y,recipient:S,offline:v}=e;if(!y)throw __LOG__(4,void 0,new Error,!0)`error: got group ack without participant.`,SEND_LOGS("handleGroupSimpleReceipt: failed"),new Error("handleGroupSimpleReceipt: got group ack without participant.");const C=(0,u.getMeUser)(),A=(0,d.toUserWid)(y),b=s===a.ACK_STRING.SENDER,P=!b&&A.equals(C);let O;if(P){if(!S)throw __LOG__(3)`error: invalid sender/peer receipt without recipient`,new Error("handleGroupSimpleReceipt: invalid sender/peer receipt without recipient");O=S}else O=C;const M=r.map((e=>new l.default({id:e,remote:n,fromMe:!P,participant:O})));P&&t===a.ACK.PLAYED&&(0,p.handleViewOnceOpenedIfNecessary)(M);const I=M.map((e=>e.toString()));if(null!=v&&_.OfflineMessageHandler.offlineStanzaReceivedAfterCompelete(),(0,g.isUnifiedReceiptProcessingEnabled)()){const e=null!=v&&!_.OfflineMessageHandler.isResumeFromRestartComplete();if(P){if(null!=S&&e&&(0,f.isReadOrPlayedReceipt)(s)&&r.length>0)return m.receiptBatcher.acceptPeerReceipt({ack:t,ts:o,msgKeys:I})}else m.receiptBatcher.acceptOtherReceipt({ack:t,ts:o,receiverId:y,msgKeys:I});e||(m.receiptBatcher.runActiveBatches(),T(P,b,M,n,t,A,o))}else if(null==v||_.OfflineMessageHandler.isResumeFromRestartComplete()){const e=[];e.push(T(P,b,M,n,t,A,o)),P||e.push(new c.NonPersistJob("updateGroupReceiptRecords",(0,i.default)((function*(){try{yield(0,E.updateReceiptRecords)(t,o,y,I)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleGroupSimpleReceipt: failed")}}))).waitUntilCompleted()),yield Promise.all(e)}else{if(!P)return h.default.addOfflineReceipt(t,o,y,I);if(null!=S&&(0,f.isReadOrPlayedReceipt)(s)&&r.length>0)return h.default.addOfflinePeerReceipt(o,I,t)}}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,n,r,l,c,d){return l<a.ACK.RECEIVED?Promise.resolve():t?(__LOG__(2)`handleGroupSimpleReceipt: sender receipt from peer device ${r.toString()}`,Promise.resolve()):e?(__LOG__(2)`handleGroupSimpleReceipt: peer receipt from peer device ${r.toString()}`,l===a.ACK.READ&&(0,p.updateChatPeerRead)(r,n),l===a.ACK.PLAYED?(0,p.updateMsgAcks)(n,l,d):Promise.resolve()):void(yield Promise.all(n.map(function(){var e=(0,i.default)((function*(e){const t=y.MsgCollection.get(e);if(!t)return void __LOG__(2)`handleGroupSimpleReceipt: no message found for incoming ack, with msgKey:`;const n=yield S.MsgInfoCollection.find(e);return n||(__LOG__(3,void 0,void 0,!0)`Assertion failed! ${e.toString()}`,SEND_LOGS("handleGroupSimpleReceipt: no msgInfo found for msg:")),(0,s.updateMsgInfo)(n,l,c,d),l===a.ACK.RECEIVED&&0===n.deliveryRemaining||l===a.ACK.READ&&0===n.readRemaining||l===a.ACK.PLAYED&&0===n.playedRemaining?(0,o.updateMsgAck)(t,null,{from:(0,u.assertGetMe)(),to:r,ack:l,t:d}):void 0}));return function(){return e.apply(this,arguments)}}())))}))).apply(this,arguments)}},617234:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return S.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(535470),s=r(n(465212)),l=n(978820),c=r(n(389867)),u=n(648309),d=n(284947),p=n(778428),f=n(590756),_=n(528237),h=r(n(166545)),g=n(697710),m=n(832543),y=n(197563);function S(){return(S=(0,a.default)((function*(e){const t=p.msgReceiptParser.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;{const e=t.success,{ack:n,ackString:r,from:i,stanzaId:a}=e;if(e.type===p.RECEIPT_TYPE.SIMPLE){if(n===o.ACK.CONTENT_GONE)return(0,m.buildReceiptAckResponse)(i,a,r,null);let t=null;(0,g.isUnifiedReceiptProcessingEnabled)()?m.receiptBatcher.acceptReceiptAck({from:i,stanzaId:a,ackString:r,participant:e.participant}):null==e.offline||_.OfflineMessageHandler.isResumeFromRestartComplete()?t=(0,m.buildReceiptAckResponse)(i,a,r,e.participant):h.default.addOfflineReceiptAck(i,a,r,e.participant);try{__LOG__(2)`handleSimpleReceipt: got receipt ${e.ack} for msg ${e.stanzaId}`,yield E(e)}catch(t){__LOG__(3,void 0,void 0,void 0,["messaging"])`handleSimpleReceipt: got error for receipt ${e.ack} for msg ${e.stanzaId}: ${t}`}return t}if(e.type===p.RECEIPT_TYPE.AGGREGATE){const t=(0,m.buildReceiptAckResponse)(i,a,r,null);try{__LOG__(2)`handleAggregateReceipt: got ${e.receipts.length} receipts of ack type ${e.ack} for msg ${e.externalId}`,yield v(e)}catch(e){}return t}return __LOG__(4,void 0,new Error,!0)`type: ${e.type}`,SEND_LOGS("handleMsgReceipt: Invalid receipt type"),(0,m.buildReceiptAckResponse)(i,a,r,null)}}))).apply(this,arguments)}function E(e){const{from:t,ack:n,stanzaId:r,participant:a}=e;if(n===o.ACK.MD_DOWNGRADE){const e=new s.default({id:r,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,l.getMeUser)()});return(0,y.updateLocalAndModel)(e,{mdDowngrade:!(a&&c.default.isWid(a)&&a.isUser())||a.toString()})}if(n===o.ACK.PEER)return Promise.resolve();if(t.isStatusV3())return(0,f.handleStatusSimpleReceipt)(e);if(t.isUser())return(0,u.handleChatSimpleReceipt)(e);if(t.isGroup())return(0,d.handleGroupSimpleReceipt)(e);if(t.isBroadcast()){if(!e.participant)return __LOG__(4,void 0,new Error,!0)`error: missing participant for broadcast receipt ${t.toString()}`,SEND_LOGS("handleSimpleReceipt: failed"),Promise.reject(new Error(`handleSimpleReceipt: missing participant for broadcast receipt ${t.toString()}`));const n=(0,i.default)((0,i.default)({},e),{},{from:e.participant,participant:null});return(0,u.handleChatSimpleReceipt)(n)}return __LOG__(4,void 0,new Error,!0)`error: unsupported type for ${t.toString()}`,SEND_LOGS("handleSimpleReceipt: failed"),Promise.reject(new Error(`handleSimpleReceipt: unsupported type for ${t.toString()}`))}function v(e){const{ack:t,from:n}=e;return t===o.ACK.CONTENT_GONE?(__LOG__(4,void 0,new Error,!0)`error: reupload receipts cannot be aggregated`,SEND_LOGS("handleAggregateReceipt: failed"),Promise.reject(new Error("handleAggregateReceipt: failed"))):n.isGroup()||n.isBroadcast()?Promise.all(e.receipts.map((t=>E({type:p.RECEIPT_TYPE.SIMPLE,stanzaId:e.externalId,externalIds:[e.externalId],from:e.from,participant:t.participant,recipient:null,ts:t.ts,ack:e.ack,ackString:e.ackString,offline:e.offline,biz:null})))):(__LOG__(4,void 0,new Error,!0)`handleAggregateReceipt: aggregate receipts should come only from group, broadcast`,SEND_LOGS("handleAggregateReceipt: failed"),Promise.reject(new Error("handleAggregateReceipt: failed")))}},229331:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleViewOnceOpenedIfNecessary=function(e){e.forEach((e=>{const t=f.MsgCollection.get(e);(null==t?void 0:t.isViewOnce)&&(0,l.handleActivitiesForChatThreadLogging)([{activityType:"viewOnceOpen",ts:t.t,chatId:t.id.remote}])}))},t.processOrphanPeerReceipt=function(e){return S.enqueue((0,i.default)((function*(){const t=yield(0,g.getOrphanReceipt)(String(e));t?(null!=t[o.ACK_STRING.PLAYED]&&(__LOG__(2)`processOrphanPeerReceipt: orphan played ack found for incoming ${e}`,yield A([e],o.ACK.PLAYED,t[o.ACK_STRING.PLAYED])),null!=t[o.ACK_STRING.READ]&&(__LOG__(2)`processOrphanPeerReceipt: orphan read ack found for incoming ${e}`,T(e.remote,[e])),yield(0,g.removeOrphanReceipt)(String(e))):__LOG__(2)`processOrphanPeerReceipt: no orphan ack found for incoming ${e}`})))},t.processReactionOrphanPeerReceipt=function(e){return S.enqueue((0,i.default)((function*(){const t=yield(0,g.getOrphanReceipt)(String(e));t?(null!=t[o.ACK_STRING.READ]&&(__LOG__(2)`processReactionOrphanPeerReceipt: orphan read ack found for incoming ${e}`,(0,c.receiveReactionsEnabled)()&&(yield(0,d.markReactionsAsReadByMessageKeys)([u.default.fromString(t.msgKey)]))),yield(0,g.removeOrphanReceipt)(String(e))):__LOG__(2)`processReactionOrphanPeerReceipt: no orphan ack found for incoming ${e}`})))},t.updateChatPeerRead=T,t.updateMsgAcks=A;var i=r(n(348926)),a=n(927870),o=n(535470),s=n(257123),l=n(217869),c=n(408139),u=r(n(465212)),d=n(837398),p=n(561498),f=n(559871),_=n(438342),h=n(448285),g=n(940221),m=n(290981),y=n(672821);const S=new a.PromiseQueue;function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const n=(yield(0,_.getActiveMessageRanges)(e)).filter((e=>"markChatAsRead"===e.action&&!1===e.actionValue.read&&null!=e.actionValue.messageRange));if(0===n.length)return!0;const r=n[0];return t.some((e=>!(0,s.rangeContainsMessage)(r.actionValue.messageRange,{id:u.default.fromString(e.id),t:e.t})))}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){const r=t.map(String),i=[];let a=[],s=null;const l=yield(0,m.getTable)().bulkGet(r,!1),f=[];if(l.forEach(((e,t)=>{e?null==e.pendingReadReceipt||null!=e.rowId&&(null==s||e.rowId>s)&&(s=e.rowId):f.push(r[t])})),f.length>0&&((0,c.receiveReactionsEnabled)()&&(a=(yield(0,y.getTable)().anyOf(["msgKey"],f)).map((e=>e.msgKey)),__LOG__(2)`updateChatPeerRead: maybeOrphans ${f.length}`),f.forEach((e=>{a.includes(e)||i.push(e)}))),S.enqueue((()=>(__LOG__(2)`updateChatPeerRead: storing ${i.length} orphan acks`,(0,g.createOrUpdateOrphanReceipt)(o.ACK_STRING.READ,0,i)))),yield(0,h.markMessageAndChatAsRead)(s,String(e),!(yield E(e.toString(),l.filter(Boolean)))),(0,c.receiveReactionsEnabled)()&&a.length>0){const e=a.map((e=>u.default.fromString(e)));yield(0,d.markReactionsAsReadByMessageKeys)(e)}const _=n(669951).ChatCollection.get(e);_&&((0,p.updateUnreadCountMD)(_,0,!1),(0,p.clearUnreadMentions)(_))}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,r,i){const a=[],s=[],l=n(272720).updateMsgAck;e.forEach((e=>{const n=f.MsgCollection.get(e);n?s.push(l(n,null,{from:n.from,to:n.to,ack:t,t:r,deliveryPrivacyMode:o.ACK.RECEIVED===t?i:null})):(__LOG__(2)`updateMsgAcks: no message found for incoming ack, with msgKey: ${e}`,e.fromMe||a.push(e))})),a.length>0&&S.enqueue((()=>{__LOG__(2)`updateMsgAcks: store ${a.length} orphan acks`;let e=null;if(t===o.ACK.PLAYED?e=o.ACK_STRING.PLAYED:t===o.ACK.READ&&(e=o.ACK_STRING.READ),e)return(0,g.createOrUpdateOrphanReceipt)(e,r,a.map(String))})),yield Promise.all(s)}))).apply(this,arguments)}},778428:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgReceiptParser=t.RECEIPT_TYPE=void 0;var i=r(n(81109)),a=n(471914),o=n(535470),s=n(181663),l=n(978820),c=n(49714);const u={read:o.ACK.READ,played:o.ACK.PLAYED,inactive:o.ACK.INACTIVE,"server-error":o.ACK.CONTENT_GONE,"md-downgrade":o.ACK.MD_DOWNGRADE,sender:o.ACK.RECEIVED,"read-self":o.ACK.READ,"played-self":o.ACK.PLAYED,peer_msg:o.ACK.PEER},d={SIMPLE:"simple",AGGREGATE:"aggregate"};t.RECEIPT_TYPE=d;const p=new a.WapParser("incomingMsgReceiptParser",(e=>{e.assertTag("receipt"),e.hasAttr("to")&&e.assertAttr("to",(0,l.assertGetMe)().toJid());const t={ack:e.attrEnumOrDefault("type",u,o.ACK.RECEIVED),stanzaId:e.attrString("id"),from:(0,s.jidWithTypeToWid)(e.attrJidWithType("from")),ackString:e.hasAttr("type")?e.attrString("type"):null,offline:e.hasAttr("offline")?e.attrString("offline"):null},n=e.maybeChild("participants");return n?function(e,t){const n=t.mapChildrenWithTag("user",(e=>{try{const t=(0,s.deviceJidToDeviceWid)(e.attrDeviceJid("jid"));return{participant:t,ts:e.attrTime("t")}}catch(e){return null}})).filter((e=>null!=e));return(0,i.default)((0,i.default)({},e),{},{type:d.AGGREGATE,externalId:t.attrString("key"),receipts:n})}(t,n):function(e,t){const n=t.hasAttr("participant")?(0,s.deviceJidToDeviceWid)(t.attrDeviceJid("participant")):null,r=t.hasAttr("recipient")?(0,s.userJidToUserWid)(t.attrUserJid("recipient")):null;let a,o;a=t.hasChild("list")?t.child("list").mapChildrenWithTag("item",(e=>e.attrString("id"))):[];if(t.hasChild("biz")){const e=t.child("biz"),n=c.ActualActorsEnumType.cast(e.maybeAttrInt("actual_actors")),r=c.HostStorageEnumType.cast(e.maybeAttrInt("host_storage")),i=e.maybeAttrInt("privacy_mode_ts");null!=n&&null!=r&&null!=i&&(o={actualActors:n,hostStorage:r,privacyModeTs:i})}return a.push(e.stanzaId),(0,i.default)((0,i.default)({},e),{},{type:"simple",externalIds:a,participant:n,recipient:r,ts:t.attrTime("t"),biz:o})}(t,e)}));t.msgReceiptParser=p},590756:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleStatusSimpleReceipt=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=n(535470),s=n(219534),l=r(n(465212)),c=n(555452),u=n(978820),d=n(745454),p=n(229331),f=r(n(166545)),_=n(697710),h=n(832543),g=n(617972),m=n(459387),y=n(847124),S=n(528237);function E(){return(E=(0,i.default)((function*(e){const{externalIds:t,ts:n,ackString:r,ack:i,participant:s,recipient:p,offline:g}=e,m=t[0];if(!s)return __LOG__(4,void 0,new Error,!0)`error: got status ack without participant`,void SEND_LOGS("handleStatusSimpleReceipt: failed");const E=(0,u.getMeUser)(),T=(0,d.toUserWid)(s),C=T.equals(E),A="none"===(0,c.getUserPrivacySettings)().readReceipts;if(!C&&(A||r!==o.ACK_STRING.READ))return;const b=new l.default({id:m,remote:(0,d.createWid)(a.STATUS_JID),fromMe:!C,participant:null!=p?p:E}),P=[b.toString()],O=null!=g&&!S.OfflineMessageHandler.isResumeFromRestartComplete();if((0,_.isUnifiedReceiptProcessingEnabled)())return C&&O?h.receiptBatcher.acceptPeerReceipt({ts:n,msgKeys:P,ack:i}):(C||h.receiptBatcher.acceptOtherReceipt({ack:i,ts:n,receiverId:T,msgKeys:P}),void(O||(h.receiptBatcher.runActiveBatches(),v(C,b,T,n))));if(O){if(C)return f.default.addOfflinePeerReceipt(n,P,i);if(!C)return f.default.addOfflineReceipt(i,n,T,P)}if(!C)try{yield(0,y.updateReceiptRecords)(i,n,s,P)}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("handleStatusSimpleReceipt: failed")}yield v(C,b,T,n)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n,r){if(e){const e=m.StatusV3Collection.get(t.participant);e&&e.handleReadStatus(t)}else{const e=yield g.MsgInfoCollection.find(t);(0,s.updateMsgInfo)(e,o.ACK.READ,n,r)}yield(0,p.updateMsgAcks)([t],o.ACK.READ,r)}))).apply(this,arguments)}},853575:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isReadOrPlayedReceipt=function(e){return e===r.ACK_STRING.READ||e===r.ACK_STRING.READ_SELF||e===r.ACK_STRING.PLAYED||e===r.ACK_STRING.PLAYED_SELF};var r=n(535470)},458464:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNotifSchedulerEnabled=function(){return(0,r.getABPropConfigValue)("web_offline_resume_m3_enabled")},t.isPullModeEnabled=function(){return(0,r.getABPropConfigValue)("web_default_pull_mode_enabled")};var r=n(257243)},798972:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDanglingReceipts=d,t.sendAndClearDanglingReceipts=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(892844),o=n(312779),s=n(310656),l=n(745454),c=n(93771);function u(){return(u=(0,i.default)((function*(){const e=yield(0,c.getTable)().all(),t=new Map;e.forEach((e=>{const{receipts:n}=e;n.forEach((e=>{const n=(0,l.createWid)(e.from),r=(0,l.createWid)(e.author);let i=t.get(n);i||(i=new Map,t.set(n,i));let a=i.get(r);a||(a=[],i.set(r,a)),a.push(e.externalId)}))}));const n=String((0,a.unixTime)());yield Promise.all(Array.from(t.keys()).map((e=>{const r=t.get(e);if(r)return(0,s.sendAggregateReceipts)(e,s.RECEIPT_TYPE.DELIVERY,n,r)}))),yield d()}))).apply(this,arguments)}function d(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){yield(0,o.blockSendPing)(),yield(0,c.getTable)().clear()}))).apply(this,arguments)}},869153:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(736184),o=n(927870),s=n(657319),l=n(446308);var c=new class{constructor(){this.pendingDeviceCache=new Set,this.pendingAcks=[],this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new o.PromiseQueue}addOfflinePendingDevice(e,t){this.pendingDeviceCache.add(e),t&&this.pendingAcks.push(t),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][device-cache]: creating snapshot: schedule in ${3e3} ms`,this.snapshotTimer.onOrAfter(3e3))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.pendingDeviceCache),t=this.pendingAcks;__LOG__(2)`[offline-resume][device-cache]: creating snapshot for pending devices ${e.join(",")}`,this.checkpointQueue.enqueue((0,i.default)((function*(){yield(0,l.addUserToPendingDeviceSync)(e),t.forEach(a.castStanza),(0,a.cancelDeadSocketTimer)()}))),this.pendingDeviceCache=new Set,this.pendingAcks=[]}};t.default=c},528237:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineMessageHandlerImpl=t.OfflineMessageHandler=void 0;var i=r(n(348926)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(971446)),o=n(413959),s=n(904352),l=n(798972),c=n(781572),u=n(145789),d=n(736163),p=n(521522),f=r(n(729783)),_=n(890349),h=n(454753),g=r(n(166545)),m=n(49714),y=n(765044),S=n(446308),E=r(n(869153)),v=n(657319),T=n(788950),C=n(45607),A=n(453168),b=r(n(465212)),P=n(180284),O=n(885553),M=n(14571),I=n(797480),w=n(760324),R=n(155552),N=n(217869);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}const D=20,k=50,U=200,G=n(76672)({INIT:"INIT",RESUME_ON_RESTART:"RESUME_ON_RESTART",RESUME_WITH_OPEN_TAB:"RESUME_WITH_OPEN_TAB",COMPLETE:"COMPLETE"});class x{constructor(){this._offlineCompleteTimer=null,this._progressBarTimer=new v.ShiftTimer((()=>{c.Cmd.handleOfflineProgressUpdate(),this._progressBarTimer.onOrAfter(1e3)})),this.initState(),c.Cmd.on("logout",(()=>{this.initState()})),c.Cmd.on("open_socket_stream",(()=>{I.OfflineResumeReporter.logSocketConnectT()}))}initState(){this._offlineMessagePreviewCounter=-1,this._decryptedMessageCount=0,this._decryptionErrorCount=0,this._finishedDownloading=!1,this._hasMessagesToDownload=null,this._status=G.INIT,this._pendingMessageCount=0,this._isPendingPrevBatch=!1}setStatus(e){e===G.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] begin RESUME_WITH_OPEN_TAB`:e===G.RESUME_ON_RESTART?__LOG__(2)`[offline-resume][handler] begin RESUME_ON_RESTART`:e===G.COMPLETE&&(this._status===G.RESUME_WITH_OPEN_TAB?__LOG__(2)`[resume-resume] finished RESUME_WITH_OPEN_TAB`:__LOG__(2)`[offline-resume][handler] finished RESUME_ON_RESTART`),this._status=e}setOfflineMessagePreviewCounter(e){var t=this;return(0,i.default)((function*(){if(I.OfflineResumeReporter.logOfflinePreviewT(),t.isResumeFromRestartComplete()){__LOG__(2)`[offline-resume][handler] Offline session is complete when receiving offline preview ib.`,t._exceedResumeWithOpenTabLimit(e.message,e.receipt)&&(__LOG__(2)`[offline-resume][handler] restart client due to exceed the LIMIT, message: ${e.message}, receipt: ${e.receipt}`,j()),O.jsHaltDetector.restartDetection(),t.setStatus(G.RESUME_WITH_OPEN_TAB);const r=n(669951).ChatCollection;r.disableSortListener(),setTimeout((()=>{r.enableSortListener(!0)}),7e3)}else if(t._status===G.INIT)I.OfflineResumeReporter.logOfflineCount(e),t._hasMessagesToDownload=e.message>0,t._finishedDownloading=0===e.message,t._offlineMessagePreviewCounter=e.message,t._decryptedMessageCount=0,t._firstPreviewReceivedT=Date.now(),c.Cmd.handleOfflineProgressUpdate(),O.jsHaltDetector.restartDetection(),t.setStatus(G.RESUME_ON_RESTART),yield(0,h.enableMemSignalStore)(),t._startOfflineCompleteTimer(e.message,e.receipt),t._progressBarTimer.onOrAfter(1e3);else{const n=t._firstPreviewReceivedT;if(null!=n){const r=Date.now()-n;r<1e3?(__LOG__(2)`[offline-resume][handler] Accept multiple offline preview ibs during offline resume, delay ${r}.`,t._offlineMessagePreviewCounter+=e.message,t._hasMessagesToDownload=t._offlineMessagePreviewCounter>0,t._finishedDownloading=0===t._offlineMessagePreviewCounter,I.OfflineResumeReporter.logOfflineCount(e),c.Cmd.handleOfflineProgressUpdate()):__LOG__(2)`[offline-resume][handler] Reject multiple offline preview ib during offline resume, delay ${r}.`}t.refreshOfflineCompleteTimer()}}))()}getOfflineDeliveryProgress(){return this._finishedDownloading?100:-1===this._offlineMessagePreviewCounter?0:0===this._offlineMessagePreviewCounter?100:Math.min(Math.ceil(100*this._decryptedMessageCount/this._offlineMessagePreviewCounter),100)}isResumeOnSocketDisconnectInProgress(){return this._status===G.RESUME_WITH_OPEN_TAB}isResumeFromRestartComplete(){return this._status!==G.RESUME_ON_RESTART&&this._status!==G.INIT}getHasMessagesToDownload(){return this._hasMessagesToDownload}getFinishedDownloading(){return 100===this.getOfflineDeliveryProgress()}setOfflineSessionComplete(e){var t=this;return(0,i.default)((function*(){var r;return setTimeout((()=>{n(669951).ChatCollection.enableSortListener(!0)}),3e3),null===(r=t._offlineCompleteTimer)||void 0===r||r.cancel(),t._offlineCompleteTimer=null,t._status===G.COMPLETE?Promise.resolve():t._status===G.RESUME_WITH_OPEN_TAB?(yield(0,p.waitForOnlineMsgThread)(),yield(0,S.doPendingDeviceSync)(),t.setStatus(G.COMPLETE),Promise.resolve()):(t._hasMessagesToDownload=e>0,t._finishedDownloading=0===e,t.setStatus(G.COMPLETE),t._offlineStanzaCountAfterOfflineMarker=0,setTimeout((()=>{t._offlineStanzaCountAfterOfflineMarker>100&&(__LOG__(3)`[offline-resume][handler] ${t._offlineStanzaCountAfterOfflineMarker} received after offline completion marker. Refreshing window due to potential server issue.`,j())}),2e4),c.Cmd.handleOfflineProgressUpdate(),t._handleOfflineComplete())}))()}shouldUseOfflineResumeScreen(){return this._offlineMessagePreviewCounter>this._decryptedMessageCount}decryptOfflineMessage(e){var t=this;return(0,i.default)((function*(){const n=yield(0,u.decryptE2EPayload)(e);return t._decryptedMessageCount=t._decryptedMessageCount+1,n.result===m.E2EProcessResult.RETRY&&(t._decryptionErrorCount=t._decryptionErrorCount+1),t._pendingMessageCount-=1,t.maybeRequestMoreStanza(),n}))()}offlineStanzaReceivedAfterCompelete(){this.isResumeFromRestartComplete()&&(this._offlineStanzaCountAfterOfflineMarker=this._offlineStanzaCountAfterOfflineMarker+1)}addOfflinePendingMessage(){this.isResumeFromRestartComplete()||(this._pendingMessageCount+=1)}maybeRequestMoreStanza(){this.isResumeFromRestartComplete()||this._isPendingPrevBatch||this._pendingMessageCount<=200&&((0,C.sendBatchRequestIb)(200),this._isPendingPrevBatch=!0,__LOG__(2)`[offline-resume][adaptive] maybeRequestMoreStanza: request next batch, pending message ${this._pendingMessageCount}`)}newOfflineStanza(e,t){this._isPendingPrevBatch=!1,null==this._endBatchCheck&&(this._endBatchCheck=setTimeout((()=>{this.maybeRequestMoreStanza(),this._endBatchCheck=null,__LOG__(2)`[offline-resume][adaptive] _endBatchCheck: done`}),0)),this.refreshOfflineCompleteTimer(),I.OfflineResumeReporter.logAddOfflineSizeBytes(t),I.OfflineResumeReporter.logOldestStanzaTime(e)}refreshOfflineCompleteTimer(){this._offlineCompleteTimer&&this._offlineCompleteTimer.onOrAfter(6e4)}_startOfflineCompleteTimer(e,t){var n;null===(n=this._offlineCompleteTimer)||void 0===n||n.cancel(),this._offlineCompleteTimer=new v.ShiftTimer((()=>{this._status!==G.COMPLETE&&(__LOG__(2)`[offline-resume][handler]: offline session completed by timeout`,this.setOfflineSessionComplete(e+t),this._offlineCompleteTimer=null,I.OfflineResumeReporter.logMissedOfflineComplete())})),this._offlineCompleteTimer.onOrAfter(6e4)}_handleOfflineComplete(){var e=this;return(0,i.default)((function*(){yield(0,p.waitForOfflineMsgThread)(),e._finishedDownloading=!0,c.Cmd.handleOfflineProgressUpdate(),I.OfflineResumeReporter.logOfflineDecryptionErrorCount(e._decryptionErrorCount),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: waitForOfflineMsgThread done, total decryption error: ${e._decryptionErrorCount}`,e._decryptionErrorCount=0,yield function(){return F.apply(this,arguments)}(),__LOG__(2)`[offline-resume][handler] _onOfflineComplete: clearOfflineSnapShot done.`,(0,h.enablePersistSignalStore)(),(0,s.promiseLoop)(function(){var e=(0,i.default)((function*(e,t,n){const r=(0,o.delayMs)((0,P.expBackoff)(n,12e4,1e3,.1));try{return yield(0,l.clearDanglingReceipts)(),__LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: done.`,e()}catch(t){return __LOG__(2)`[offline-resume][handler] runReceiptCleanUpLoop: failed with error ${t}.`,n>3?(__LOG__(3)`[offline-resume][handler] runReceiptCleanUpLoop: Gave up clean up receipts ${n} tries`,e()):r}}));return function(){return e.apply(this,arguments)}}());try{const e=yield(0,w.pruneExpiredMessages)(),t=e.length;if(t>0){const t=n(203292).getJobManager,r=[],i=new Set;e.forEach((e=>{const t=e.id.toString();i.add(b.default.fromString(t).remote.toString()),r.push(t)}));const a=Array.from(i.values()).join(",").toString();(0,M.deleteModelsForLastReactionPreview)(r),yield t().waitUntilPersisted(A.jobSerializers.deleteAddOns(a,r))}__LOG__(2)`[offline-resume][handler] setOfflineSessionComplete: pruneExpiredMessages pruned ${t} msg(s)`}catch(e){throw __LOG__(4,void 0,new Error)`[offline-resume][handler] _onOfflineComplete: pruneExpiredMessages message failed with error: ${e}`,e}I.OfflineResumeReporter.logLastStanzaT();try{__LOG__(2)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages.`,yield Promise.all([(0,d.restoreChatsAndMessages)(),(0,d.restoreGroupsContactsAndProfilePics)()])}catch(e){__LOG__(4,!0,new Error,!0)`[offline-resume][handler] _onOfflineComplete: restoreChatsAndMessages failed with error ${e}.`,SEND_LOGS("offline-resume-fatal-error"),y.Socket.logout(!1,T.LogoutReason.ClientFatalError)}c.Cmd.readyForMainStreamMode(),I.OfflineResumeReporter.logMainScreenLoadT(),I.OfflineResumeReporter.commit(),a.setMainStreamModeReadyT(),(0,R.processAllOrphanPaymentNotifications)(),(0,N.uploadChatThreadLoggingEvents)(),setTimeout((()=>{(0,S.doPendingDeviceSync)()}),2e3)}))()}_exceedResumeWithOpenTabLimit(e,t){return e+t>U||e>D&&e+t>k}}t.OfflineMessageHandlerImpl=x;const B=new x;function F(){return(F=(0,i.default)((function*(){f.default.createSnapshot(),_.messageProcessorCache.createSnapshot(),g.default.createSnapshot(),E.default.createSnapshot(),yield Promise.all([_.messageProcessorCache.checkpointQueue.wait(),f.default.checkpointQueue.wait(),g.default.checkpointQueue.wait(),E.default.checkpointQueue.wait()])}))).apply(this,arguments)}function j(){var e;(null===(e=window.location)||void 0===e?void 0:e.reload)&&window.location.reload()}t.OfflineMessageHandler=B},729783:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(736184),o=r(n(145095)),s=n(927870),l=n(657319),c=n(892844),u=n(310656),d=n(671251),p=n(640623),f=n(246276),_=n(93771),h=n(677246);var g=new class{constructor(){this.cache=[],this.checkpointQueue=new s.PromiseQueue,this.nextCheckpointIndex=0,this.snapshotTimer=new l.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointPromises=new Map}addOfflineMessage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cache.push(...e);const n=this._getOrCreateCurrentCheckpointPromise();return t||this.cache.length-this.nextCheckpointIndex>=400?(this.createSnapshot(),n):n}_getOrCreateCurrentCheckpointPromise(){if(!this.checkpointPromises.has(this.nextCheckpointIndex)){let e=()=>{},t=()=>{};this.checkpointPromises.set(this.nextCheckpointIndex,{promise:new Promise(((n,r)=>{e=n,t=r})),markCheckpointDone:n=>{this.checkpointPromises.delete(this.nextCheckpointIndex),null==n?e():t(n)}})}return(0,o.default)(this.checkpointPromises.get(this.nextCheckpointIndex),"this.checkpointPromises.get(this.nextCheckpointIndex)").promise}_addToMessageTable(e,t){var n=this;return(0,i.default)((function*(){const r=[];for(let i=e;i<t;i++){const e=n.cache[i].msg;null!=e&&r.push(e)}yield(0,d.storeOfflineMsgs)(r)}))()}_sendAggregateReceipts(e,t){var n=this;return(0,i.default)((function*(){const r=new Map,i=[];for(let a=e;a<t;a++){const e=n.cache[a].msg,t=n.cache[a].receiptInfo;if(!t)continue;const o=t.externalId||(null==e?void 0:e.id.id);if(!o)continue;const{from:s,author:l}=t;let c=r.get(s);c||(c=new Map,r.set(s,c));let u=c.get(l);u||(u=[],c.set(l,u)),u.push(o),i.push({from:String(s),author:String(l),externalId:o})}const o=String((0,c.unixTime)());Promise.all(Array.from(r.keys()).map((e=>{const t=r.get(e);if(t)return(0,u.sendAggregateReceipts)(e,u.RECEIPT_TYPE.DELIVERY,o,t)}))),(0,a.cancelDeadSocketTimer)(),yield(0,_.getTable)().createOrReplace({receipts:i})}))()}createSnapshot(){var e,t,n=this;this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const r=this.nextCheckpointIndex,a=this.cache.length;if(this.nextCheckpointIndex=a,__LOG__(2)`[offline-resume][msg-cache]: creating snapshot for offline ${r} to ${a}`,r===a)return;const o=(0,f.getMemSignalStorage)().generateSnapshot(),s=null!==(e=null===(t=this.checkpointPromises.get(r))||void 0===t?void 0:t.markCheckpointDone)&&void 0!==e?e:()=>{__LOG__(4,void 0,new Error,!0)`OfflineMsgCache: missing doneFn`,SEND_LOGS("msg-cache-missing-doneFn")};this.checkpointQueue.enqueue((0,i.default)((function*(){try{yield n._addToMessageTable(r,a),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: messages done for ${r} - ${a}`,yield(0,h.getStorage)().lock(["session-store","identity-store","prekey-store","senderkey-store"],(0,i.default)((function*(){yield Promise.all([p.waSignalStore.bulkPutSession(o.sessionUpdate),p.waSignalStore.bulkPutIdentityKeyWithRowId(o.identityUpdate),p.waSignalStore.bulkPutSenderKey(o.senderKeyUpdate),p.waSignalStore.bulkRemovePreKey(o.preKeyRemove),p.waSignalStore.bulkRemoveSession(o.sessionRemove),p.waSignalStore.bulkRemoveIdentity(o.identityRemove)])}))),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: signal done for ${r} - ${a}`,yield n._sendAggregateReceipts(r,a),__LOG__(2)`[offline-resume][msg-cache]: creating snapshot: sending receipt done for ${r} - ${a}`}catch(e){return void s(e)}s()})))}};t.default=g},166545:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(736184),o=n(252230),s=n(927870),l=n(657319),c=n(831914),u=n(535470),d=n(696055),p=n(745454),f=n(799069),_=n(578956);const h=Object.freeze({[u.ACK.RECEIVED]:u.ACK_STRING.DELIVERY,[u.ACK.READ]:u.ACK_STRING.READ,[u.ACK.PLAYED]:u.ACK_STRING.PLAYED,[u.ACK.INACTIVE]:u.ACK_STRING.INACTIVE}),g=1e3;function m(e){return(0,_.getTable)().bulkCreate(e)}function y(e,t){if(null!=e&&null!=t)return Math.min(e,t);const n=null!=e?e:t;return null!=n?n:void 0}var S=new class{constructor(){this.peerReadCache=[],this.otherReceiptCache=new Map,this.receiptAckCache=[],this.snapshotTimer=new l.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointQueue=new s.PromiseQueue}addOfflinePeerReceipt(e,t,n){this.peerReadCache.push({ts:e,msgKeys:t,ack:n}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceipt(e,t,n,r){var i;const a=(0,p.toUserWid)(n).toString(),s=null!==(i=n.device)&&void 0!==i?i:o.DEFAULT_DEVICE_ID;r.forEach((n=>{const r=h[e];if(!r)return void __LOG__(3)`[offline-resume][receipt-cache]: not supported ack type ${e}`;const i=`${n},${a}`,o=this.otherReceiptCache.get(i);o?(r!==h[u.ACK.INACTIVE]&&(o[r]=y(o[r],t)),o.deviceDelivered.add(s)):this.otherReceiptCache.set(i,{[r]:t,deviceDelivered:new Set([s])})})),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}addOfflineReceiptAck(e,t,n,r){this.receiptAckCache.push({from:e,stanzaId:t,ackString:n,participant:r}),this.snapshotTimer.isScheduled()||(__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot: schedule in ${g} ms`,this.snapshotTimer.onOrAfter(g))}createSnapshot(){this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const e=Array.from(this.otherReceiptCache),t=this.peerReadCache,n=this.receiptAckCache;__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot for ${e.length} other, ${t.length} peer`,this.checkpointQueue.enqueue((0,i.default)((function*(){var r;yield Promise.all([(r=e,(0,f.getStorage)().lock(["message-info"],function(){var e=(0,i.default)((function*(e){let[t]=e;const n=yield t.bulkGet(r.map((e=>e[0].split(",")))),i=n.map(((e,t)=>{const[n,i]=r[t];if(!i)return null;if(!e){const[e,t]=n.split(",");return{delivery:i.delivery,read:i.read,played:i.played,msgKey:e,receiverUserJid:t,deviceDelivered:Array.from(i.deviceDelivered),deviceNotDelivered:[]}}const a=i.deviceDelivered;return e.deviceDelivered.forEach((e=>a.add(e))),{delivery:y(e.delivery,i.delivery),read:y(e.read,i.read),played:y(e.played,i.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(a),deviceNotDelivered:e.deviceNotDelivered.filter((e=>!a.has(e)))}}));return t.bulkCreateOrReplace(i)}));return function(){return e.apply(this,arguments)}}())),m(t)]),function(e){e.forEach((e=>{let{from:t,stanzaId:n,ackString:r,participant:i}=e;const o=(0,c.wap)("ack",{to:(0,d.JID)(t),id:(0,c.CUSTOM_STRING)(n),class:"receipt",type:(0,c.MAYBE_CUSTOM_STRING)(r),participant:i&&i!==t?(0,d.DEVICE_JID)(i):c.DROP_ATTR});(0,a.castStanza)(o),(0,a.cancelDeadSocketTimer)()})),__LOG__(2)`[offline-resume][receipt-cache] finish sending ${e.length} acks`}(n),__LOG__(2)`[offline-resume][receipt-cache]: creating snapshot done`}))),this.otherReceiptCache=new Map,this.peerReadCache=[],this.receiptAckCache=[]}};t.default=S},45607:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendBatchRequestIb=function(e){const t=(0,i.wap)("ib",null,(0,i.wap)("offline_batch",{count:(0,i.CUSTOM_STRING)(String(e))}));(0,r.castStanza)(t)};var r=n(736184),i=n(831914)},671251:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeOfflineMsgs=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=n(134719),o=n(276167),s=n(88555),l=n(70826),c=n(536051),u=n(960834),d=n(408139),p=n(115461),f=n(453168),_=n(758180),h=n(837398),g=n(17304),m=n(390641),y=n(649831),S=n(290981);function E(){return(E=(0,i.default)((function*(e){if(!(0,s.isLegacyWebdBackend)())try{const{newMsgs:t,replaceMsgs:n,revokeMsgs:r,paymentMsgs:i,reactionMsgs:o,chatsWithNewOfflineMsg:s,pollUpdateMsgs:c,removedPlaceholders:p}=yield C(e);__LOG__(2)`[offline-resume][msg-cache] storeOfflineMsgs: newMsgs: ${t.length}, replaceMsgs: ${n.length}, revokeMsgs: ${r.length}, paymentMsgs: ${i.length}`;const f=yield(0,y.applyOrphanRevoke)(t);yield(0,l.persistNewMessagesInBulk)(f,s),yield(0,S.getTable)().bulkCreateOrReplace(n),yield T(r),yield(0,m.processPaymentMessages)(i),yield(0,m.processReactionMsgs)(o),yield(0,m.processPollUpdateMsgs)(c),yield(0,u.handleOfflineForMessageRange)(e);const _=e.map((e=>e.id.toString()));try{yield(0,a.checkOrphanMutations)(_,s),(0,d.receiveReactionsEnabled)()&&(yield(0,h.checkUpdateForOrphanReactions)(_))}catch(t){__LOG__(4,void 0,new Error)`storeOfflineMessages: checkOrphanMutations failed during handleSingleMsgMD for: ${String(_.join(" "))} chat: ${String(e[0].id.remote)} Error: ${t.name}, message: ${t.message}, stack: ${t.stack}`}v(t,p)}catch(e){__LOG__(4,void 0,new Error)`[offline-resume] Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}}))).apply(this,arguments)}function v(e,t){e.forEach((e=>{b(e)&&(0,o.addPlaceHolderAction)(e)})),t.forEach((e=>{(0,o.populatePlaceHolderAction)(e)}))}function T(e){const t=[];return e.forEach((e=>{const n=new g.Msg(e);n.protocolMessageKey&&t.push({revokeMsgKey:n.protocolMessageKey,newMsgKey:n.id,timestamp:n.t,subtype:n.subtype,sender:n.sender,revokeTimestamp:n.t})})),(0,m.processRevokeMsgs)(t).then(function(){var e=(0,i.default)((function*(e){if(t.length>0){const e=[],r=new Set;t.forEach((t=>{e.push(t.revokeMsgKey.toString());const n=t.revokeMsgKey.remote.toString();r.add(n)}));const i=n(203292).getJobManager;yield i().waitUntilPersisted(f.jobSerializers.deleteAddOns(Array.from(r.values()).join(","),e))}return e}));return function(){return e.apply(this,arguments)}}())}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){const t=yield(0,S.getTable)().bulkGet(e.map((e=>String(e.id))),!1),n=[],r=[],i=[],a=[],o=[],s=[],l=new Set,u=new Map,f=new Map;return e.forEach(((e,h)=>{const g=String(e.id),m=t[h];if(m)if(b(m)){const t=(0,c.dbRowFromMessage)(e);t.t=m.t,t.internalId=m.internalId,t.rowId=m.rowId,r.push(t),f.set(g,m)}else n.push(e.id.id);else{const t=u.get(g);t&&!b(t)?n.push(e.id.id):(0,d.receiveReactionsEnabled)()&&e.type===p.MSG_TYPE.REACTION?a.push(e):(0,_.isPollsReceivingEnabled)()&&e.type===p.MSG_TYPE.POLL_UPDATE?s.push(e):["sender_revoke","admin_revoke"].includes(e.subtype)?i.push(e):e.type===p.MSG_TYPE.PAYMENT&&"send"===e.subtype||"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype?(o.push(e),u.set(g,e),l.add(String(e.id.remote))):(u.set(g,e),l.add(String(e.id.remote)))}})),n.length>0&&__LOG__(2)`[offline-resume] classifyOfflineMsgs: skip for ${n.length} duplicate messages, with id ${n}`,{newMsgs:Array.from(u.values()),chatsWithNewOfflineMsg:Array.from(l),removedPlaceholders:Array.from(f.values()),replaceMsgs:r,revokeMsgs:i,paymentMsgs:o,reactionMsgs:a,pollUpdateMsgs:s}}))).apply(this,arguments)}function b(e){return e.type===p.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype||e.type===p.MSG_TYPE.CIPHERTEXT}},450404:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success;if(n&&n.refs&&Array.isArray(n.refs)&&6===n.refs.length){const{refs:e,id:t}=n;(0,i.castStanza)((0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"result",id:(0,o.CUSTOM_STRING)(t)})),(0,d.generateADVSecretKey)(),h=e,g||(g=new a.ShiftTimer((()=>{if((0,u.isRegistered)()||!c.default.online||(0,l.isLegacyWebdBackend)())g&&g.cancel(),g=null;else if(h&&h.length){const e=6===h.length?6e4:2e4,t=h.shift();f.Conn.set({ref:t,refTTL:e}),_.Socket.state=p.SOCKET_STATE.UNPAIRED,g&&g.onOrAfter(e)}else g&&g.cancel(),g=null,_.Socket.state=p.SOCKET_STATE.UNPAIRED_IDLE}))),g.forceRunNow()}else __LOG__(3)`handlePairDevice: wrong pair device result received from server`};var i=n(736184),a=n(657319),o=n(831914),s=n(471914),l=n(88555),c=r(n(681602)),u=n(711597),d=n(946308),p=n(662583),f=n(317239),_=n(765044);let h=[],g=null;const m=new s.WapParser("pairDeviceParser",(e=>{e.assertTag("iq"),e.assertFromServer();const t=[];return e.child("pair-device").forEachChild((e=>{e.assertTag("ref"),t.push(e.contentString())})),{refs:t,id:e.attrString("id")}}))},458645:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return D.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(736184),s=n(411141),l=n(892844),c=n(831914),u=n(471914),d=n(75396),p=n(554003),f=n(138062),_=n(181663),h=n(788950),g=n(555452),m=n(978820),y=n(711597),S=n(745454),E=n(946308),v=n(640623),T=n(572841),C=n(361438),A=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=R(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(991214)),b=r(n(11339)),P=n(317239),O=n(765044),M=n(484902),I=n(760980),w=r(n(441143));function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(R=function(e){return e?n:t})(e)}let N=!1;const L=new u.WapParser("pairSuccessParser",(e=>{var t;e.assertTag("iq"),e.assertFromServer();const n=e.attrString("id"),r=e.child("pair-success"),i=null===(t=r.maybeChild("platform"))||void 0===t?void 0:t.maybeAttrString("name"),a=r.child("device"),o=r.child("device-identity").contentBytes(),s=r.maybeChild("biz"),l=s?s.attrString("name"):"";return{wid:(0,_.deviceJidToDeviceWid)(a.attrDeviceJid("jid")),id:n,deviceIdentityBytes:o,businessName:l,platform:i}}));function D(){return(D=(0,i.default)((function*(e){if(N||(0,y.isRegistered)())return;(0,g.getShowMdUpgradeCompleteMsg)()&&((0,g.setShowMdUpgradeCompleteMsg)(!1),(0,g.setForcedMdUpgradeComplete)(!1)),N=!0;const t=(0,l.unixTimeWithoutClockSkewCorrection)(),n=L.parse(e);if(n.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${n.error.toString()}`,N=!1,Promise.reject(n.error);try{(0,p.resetCompanionReg)(),(0,g.setHistorySyncEarliestDate)(t),(0,y.setPairingTimestamp)(t);const e=n.success,{id:r,wid:i,deviceIdentityBytes:l,platform:u}=e;P.Conn.blockStoreAdds=!1,u&&(P.Conn.platform=u);const _=(0,M.decodeProtobuf)(C.ADVSignedDeviceIdentityHMACSpec,l),h=_.details,O=_.hmac;(0,w.default)(null!=h&&null!=O,"ADVSignedDeviceIdentityHMAC should not have empty details or hmac");const R=(0,E.getADVSecretKey)(),L=yield(0,s.hmacSha256)(R,h),D=(0,a.encodeB64)(L);if(D!==(0,a.encodeB64)(O))return(0,o.castStanza)((0,c.wap)("iq",{to:c.S_WHATSAPP_NET,type:"error",id:(0,c.CUSTOM_STRING)(r)},(0,c.wap)("error",{code:"401",text:"not-authorized"}))),(0,p.logoutAfterValidationFail)(),void(N=!1);const k=(0,M.decodeProtobuf)(C.ADVSignedDeviceIdentitySpec,h),U=k.accountSignatureKey;(0,w.default)(null!=U,"accountSignatreKey should not be null");const G=k.accountSignature;(0,w.default)(null!=G,"accountSignature should not be null");const x=yield v.waSignalStore.getRegistrationInfo();(0,w.default)(null!=x,"Empty regInfo"),yield A.initDeviceLinkEvent(U,x.identityKeyPair.pubKey,t),A.setDeviceLinkPairStage(b.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_SUCCESS_RECEIVED);if(!(0,E.verifyDeviceIdentityAccountSignature)(k,x.identityKeyPair.pubKey))return(0,o.castStanza)((0,c.wap)("iq",{to:c.S_WHATSAPP_NET,type:"error",id:(0,c.CUSTOM_STRING)(r)},(0,c.wap)("error",{code:"401",text:"not-authorized"}))),A.commitDeviceLinkEvent(401),(0,p.logoutAfterValidationFail)(),void(N=!1);k.deviceSignature=(0,E.generateDeviceSignature)(k,x.identityKeyPair,U),yield v.waSignalStore.putIdentity((0,T.createSignalAddress)((0,S.toUserWid)(i)).toString(),(0,T.bufferToStr)((0,f.toSignalCurvePubKey)(U))),yield(0,E.setADVSignedIdentity)(k);const B=(0,M.decodeProtobuf)(C.ADVDeviceIdentitySpec,k.details).keyIndex;(0,w.default)(null!=B,"keyIndex should not be null"),k.accountSignatureKey=void 0;const F=(0,I.encodeProtobuf)(C.ADVSignedDeviceIdentitySpec,k).readByteArray();(0,o.castStanza)((0,c.wap)("iq",{to:c.S_WHATSAPP_NET,type:"result",id:(0,c.CUSTOM_STRING)(r)},(0,c.wap)("pair-device-sign",null,(0,c.wap)("device-identity",{"key-index":(0,c.INT)(B)},F)))),A.setDeviceLinkPairStage(b.default.MD_LINK_DEVICE_COMPANION_STAGE.PAIR_DEVICE_SIGN_SENT),(0,g.setMdOptedIn)(!0),(0,m.setMe)(i),(0,y.getInitialHistorySyncComplete)()||(0,p.startInitialHistorySyncTimeout)(),N=!1,(0,d.setShouldLogAgentLogin)({loginTimestamp:t})}catch(e){__LOG__(4,!0,new Error,!0)`error in handlePairSuccess, ${e}`,SEND_LOGS("error in handlePairSuccess"),(0,A.commitDeviceLinkEvent)(-1),O.Socket.logout(!1,h.LogoutReason.UnknownCompanion)}}))).apply(this,arguments)}},202599:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAmount1000AndCurrency=function(e){return function(e){if(e.hasChild("amount")){return function(e){e.assertTag("money");const t=parseFloat(e.attrString("value")),r=e.attrString("currency"),i=e.maybeAttrInt("offset");return{currency:r,amount1000:t*n/(null!=i&&0!==i?i:n)}}(e.child("amount").child("money"))}if(e.hasAttr("amount")){return{amount1000:parseFloat(e.attrString("amount"))*n,currency:e.attrString("currency")}}throw __LOG__(3)`Amount missing in pay or transaction node`,new Error("Amount missing in pay or transaction node")}(e)};const n=1e3},227258:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(155552).handlePaymentNotification;t.default=r},155552:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handlePaymentNotification=function(){return y.apply(this,arguments)},t.parseNotificationPaymentInfo=T,t.processAllOrphanPaymentNotifications=function(){return A.apply(this,arguments)},t.processOrphanPaymentNotifications=function(){return C.apply(this,arguments)},t.updateReceivedPaymentInfo=E;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(707122),l=r(n(465212)),c=n(1559),u=n(775295),d=n(552586),p=n(118146),f=n(17304),_=n(559871),h=n(584886),g=n(767050),m=n(845377);function y(){return(y=(0,a.default)((function*(e){if(e.content&&"invite"===e.content[0].tag)return S(e);const t=u.paymentNotificationParser.parse(e);if(t.error)throw __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,t.error;if(!t.success)return Promise.resolve();const n=t.success,r=(0,o.default)(n.msgKey,"info.msgKey"),a=_.MsgCollection.get(r),s=a?(0,p.unproxy)(a):yield(0,g.getMsgByMsgKey)(r);if(!s){__LOG__(3)`handlePaymentNotification: no msg found for id ${r.toString()}`;const e=(0,i.default)((0,i.default)({},n),{},{msgKey:r.toString()});return(0,m.getTable)().createOrReplace(e)}return E(s,n)}))).apply(this,arguments)}function S(e){const t=u.paymentInviteNotificationParser.parse(e);if(t.error)return __LOG__(2)`${t.error.toString()} parsing ${e.toString()}`,Promise.reject(t.error);if(!t.success)return Promise.resolve();const n=t.success;if("account-set-up"===n.type){const e=(0,c.genPaymentInviteAccoutSetupMsg)(n.from,n.timestamp);return(0,s.handleSingleMsgMD)(e.from,e)}return Promise.resolve()}function E(){return v.apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t){const n=[];T(e,t),n.push(e.id.toString());const r=[e instanceof f.Msg?e.toJSON():e];if(null!=e.paymentRequestMessageKey){const t=_.MsgCollection.get(e.paymentRequestMessageKey),n=t?(0,p.unproxy)(t):yield(0,g.getMsgByMsgKey)(e.paymentRequestMessageKey||"");n&&(n.paymentStatus=e.paymentStatus,n.paymentTxnStatus=(0,d.determinePaymentRequestFulfilledStatus)(e.paymentTxnStatus),r.push(n instanceof f.Msg?n.toJSON():n))}return(0,m.getTable)().bulkRemove(n).catch((()=>{__LOG__(4,void 0,new Error)`getOrphanPaymentNotificationTable bulkremove of ${n} failed. {e}`})),(0,h.updateExistingMessages)(r)}))).apply(this,arguments)}function T(e,t){t&&(null!=t.status&&(e.paymentStatus=(0,d.getPaymentWebStatus)(t.status,t.type),e.paymentTxnStatus=(0,d.getPaymentTxnWebStatus)(t.status)),e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,o.default)(t.amount1000,"mdPaymentInfo.amount1000"),e.paymentMessageReceiverJid=t.receiver,e.paymentTransactionTimestamp=(0,o.default)(t.ts,"mdPaymentInfo.ts"))}function C(){return(C=(0,a.default)((function*(e){const t=e.map((e=>e.id.toString())),n=yield(0,m.getTable)().bulkGet(t),r=new Map;e.forEach((e=>{r.set(e.id.toString(),e)})),n.forEach((e=>{if(e){const t=r.get(e.msgKey);if(!t)return;E(t,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:l.default.fromString(e.msgKey)})}}))}))).apply(this,arguments)}function A(){return(A=(0,a.default)((function*(){const e=yield(0,m.getTable)().all(),t=new Map,n=[];if(e.forEach((e=>{const r=_.MsgCollection.get(e.msgKey);r?E(r,{receiver:e.receiver,currency:e.currency,amount1000:e.amount1000,type:e.type,status:e.status,ts:e.ts,msgKey:l.default.fromString(e.msgKey)}):(t.set(e.msgKey,e),n.push(e.msgKey))})),n.length>0){const e=yield(0,g.getMsgsByMsgKey)(n);return e.forEach((e=>{const n=t.get(e.id.toString());n&&(e.paymentTxnStatus=(0,d.getPaymentTxnWebStatus)(n.status),e.paymentCurrency=n.currency||"",e.paymentAmount1000=(0,o.default)(n.amount1000,"notification.amount1000"),e.paymentMessageReceiverJid=n.receiver,e.paymentTransactionTimestamp=(0,o.default)(n.ts,"notification.ts"))})),(0,h.updateExistingMessages)(e)}}))).apply(this,arguments)}},775295:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.isNoviTransaction=u,t.parseTransactionNode=f,t.paymentNotificationParser=t.paymentInviteNotificationParser=void 0;var i=n(471914),a=n(181663),o=r(n(465212)),s=n(978820),l=n(202599),c=n(552586);function u(e){return!(!e||!e.hasAttr("service")||"NOVI"!==e.attrString("service").toUpperCase())}const d=new i.WapParser("paymentNotificationParser",(e=>{if(e.hasChild("transaction")){return f(e.child("transaction"))}return __LOG__(2)`No transaction node in the payment notification`,null}));t.paymentNotificationParser=d;const p=new i.WapParser("paymentInviteNotificationParser",(e=>{if(e.hasChild("invite")){const t=e.child("invite");return{type:t.maybeAttrString("type"),service:t.maybeAttrString("service"),inviteUsed:t.hasAttr("invite-used")?"1"===t.attrString("invite-used"):null,from:(0,a.chatJidToChatWid)(e.attrChatJid("from")),timestamp:e.attrTime("t")}}return __LOG__(2)`No invite node in the payment invite notification`,null}));function f(e){if(u(e))return __LOG__(2)`Payment notification from Novi not supported`,null;let t,n;const r=(0,s.getMeUser)(),i=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender")),d=(0,a.jidWithTypeToWid)(e.attrJidWithType("receiver")),p=r.equals(i);e.hasAttr("group")?(t=(0,a.jidWithTypeToWid)(e.attrJidWithType("group")),n=(0,a.jidWithTypeToWid)(e.attrJidWithType("sender"))):t=p?d:i;const f=new o.default({id:e.attrString("message-id"),fromMe:p,remote:t,participant:n}),_=(0,c.getPaymentTransactionType)(e.attrString("transaction-type"),f.fromMe),{amount1000:h,currency:g}=(0,l.getAmount1000AndCurrency)(e);return{receiver:d,currency:g,amount1000:h,status:(0,c.getNotificationTransactionStatus)(_,e.attrString("status")),ts:e.attrInt("ts"),type:_,msgKey:f}}t.paymentInviteNotificationParser=p},552586:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaymentTransactionTypeServerString=t.PaymentTransactionType=t.PaymentTransactionStatusServerString=t.NotificationTransactionStatus=void 0,t.determinePaymentRequestFulfilledStatus=function(e){if(function(e){return e===r.PaymentInfo$TxnStatus.COMPLETED||e===r.PaymentInfo$TxnStatus.SUCCESS}(e))return e;return r.PaymentInfo$TxnStatus.COLLECT_INIT},t.getNotificationTransactionStatus=function(e,t){if(!t)return a.STATUS_UNSET;const n=t.toUpperCase();switch(e){case i.TYPE_P2P_SENT:case i.TYPE_P2M_SENT:case i.TYPE_DEPOSIT:switch(n){case s.PENDING_RECEIVER_SETUP:return a.SEND_PAY_PENDING_RECEIVER;case s.FAILED_DA:return a.SEND_PAY_PENDING;case s.REFUND_FAILED_DA:return a.SEND_PAY_REFUND_PENDING;case s.FAILED_RISK:return a.SEND_PAY_FAILURE_RISK;case s.INITIAL:return a.SEND_PAY_INIT;case s.SUCCESS:case s.COMPLETED:return a.SEND_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.SEND_PAY_FAILURE;case s.REFUNDED:return a.SEND_PAY_REFUNDED;case s.REFUND_FAILED:return a.SEND_PAY_REFUND_FAILED;case s.FAILED_RECEIVER_PROCESSING:return a.SEND_PAY_FAILURE_RECEIVER;case s.REFUND_FAILED_PROCESSING:return a.SEND_PAY_REFUND_FAILED_PROCESSING;case s.FAILED_DA_FINAL:return a.SEND_PAY_PENDING_REFUND;case s.AUTH_CANCEL_FAILED_PROCESSING:return a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING;case s.AUTH_CANCEL_FAILED:return a.SEND_PAY_AUTH_CANCEL_FAILED;case s.AUTH_CANCELED:return a.SEND_PAY_AUTH_CANCELED;case s.EXPIRED:return a.SEND_PAY_EXPIRED;case s.IN_REVIEW:return a.SEND_PAY_IN_REVIEW;case s.PENDING:return a.SEND_PAY_PENDING_PROCESSING;case s.CANCELED:return a.SEND_PAY_USER_CANCELED}break;case i.TYPE_P2P_RCVD:case i.TYPE_P2M_RCVD:switch(n){case s.PENDING_SETUP:return a.RECV_PAY_PENDING_SETUP;case s.FAILED_DA:return a.RECV_PAY_PENDING;case s.FAILED_PROCESSING:return a.RECV_PAY_RETRY_ON_FAILURE;case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS;case s.FAILURE:case s.FAILED:return a.RECV_PAY_FAILURE;case s.EXPIRED:return a.RECV_PAY_EXPIRED;case s.FAILED_RISK:return a.RECV_PAY_FAILURE_RISK;case s.WITHDRAWAL_PROCESSING:return a.RECV_PAY_WITHDRAWAL_PROCESSING;case s.WITHDRAWAL_FAILURE:return a.RECV_PAY_WITHDRAWAL_FAILURE;case s.WITHDRAWAL_PERMANENT_FAILED:return a.RECV_PAY_WITHDRAWAL_PERMANENT_FAILED;case s.CANCELED:return a.RECV_PAY_SENDER_CANCELED}break;case i.TYPE_P2P_REQ_SENT:case i.TYPE_P2P_REQ_RCVD:switch(n){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SUCCESS;case s.COLLECT_FAILED:return a.REQUEST_PAY_FAILED;case s.COLLECT_FAILED_RISK:return a.REQUEST_PAY_FAILED_RISK;case s.COLLECT_REJECTED:return a.REQUEST_PAY_REJECTED;case s.COLLECT_EXPIRED:return a.REQUEST_PAY_EXPIRED;case s.COLLECT_CANCELED:return a.REQUEST_PAY_CANCELLED}break;case i.TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:switch(n){case s.COLLECT_SUCCESS:return a.REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS;case s.AUTH_SUCCESS:return a.SEND_PAY_AUTH_SUCCESS}break;case i.TYPE_REFUND:switch(n){case s.SUCCESS:case s.COMPLETED:return a.RECV_PAY_SUCCESS}break;case i.TYPE_WITHDRAWAL:switch(n){case s.PENDING:return a.WITHDRAWAL_PENDING;case s.IN_REVIEW:return a.WITHDRAWAL_IN_REVIEW;case s.SUCCESS:case s.COMPLETED:return a.WITHDRAWAL_SUCCESS;case s.FAILED:case s.DECLINED:return a.WITHDRAWAL_FAILED;case s.CANCELED:return a.WITHDRAWAL_USER_CANCELED;case s.EXPIRED:return a.WITHDRAWAL_EXPIRED;case s.WITHDRAWAL_ACTIVE:return a.WITHDRAWAL_ACTIVE}break;default:return a.STATUS_UNSET}return a.STATUS_UNSET},t.getPaymentTransactionType=function(e,t){if(e){const n=e.toLowerCase();switch(n){case o.TYPE_P2P:return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD;case o.TYPE_P2M:return t?i.TYPE_P2M_SENT:i.TYPE_P2M_RCVD;case o.TYPE_P2M_PAYOUT:return i.TYPE_P2M_PAYOUT;case o.TYPE_DEPOSIT:return i.TYPE_DEPOSIT;case o.TYPE_REFUND:return i.TYPE_REFUND;case o.TYPE_WITHDRAWAL:return i.TYPE_WITHDRAWAL;default:__LOG__(2)`parsePaymentTransactionType payment transaction string=${n}`}}return t?i.TYPE_P2P_SENT:i.TYPE_P2P_RCVD},t.getPaymentTxnWebStatus=function(e){if(null==e)return r.PaymentInfo$TxnStatus.UNKNOWN;switch(e){case a.RECV_PAY_EXPIRED:case a.SEND_PAY_EXPIRED:return r.PaymentInfo$TxnStatus.EXPIRED_TXN;case a.RECV_PAY_FAILURE:case a.SEND_PAY_FAILURE:return r.PaymentInfo$TxnStatus.FAILED;case a.RECV_PAY_INIT:case a.SEND_PAY_INIT:return r.PaymentInfo$TxnStatus.INIT;case a.RECV_PAY_PENDING_SETUP:return r.PaymentInfo$TxnStatus.PENDING_SETUP;case a.RECV_PAY_PENDING:case a.SEND_PAY_PENDING:return r.PaymentInfo$TxnStatus.FAILED_DA;case a.RECV_PAY_RETRY_ON_FAILURE:return r.PaymentInfo$TxnStatus.FAILED_PROCESSING;case a.RECV_PAY_SUCCESS:case a.SEND_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return r.PaymentInfo$TxnStatus.SUCCESS;case a.REQUEST_PAY_CANCELLED:return r.PaymentInfo$TxnStatus.COLLECT_CANCELED;case a.REQUEST_PAY_CANCELLING:return r.PaymentInfo$TxnStatus.COLLECT_CANCELLING;case a.REQUEST_PAY_EXPIRED:return r.PaymentInfo$TxnStatus.COLLECT_EXPIRED;case a.REQUEST_PAY_FAILED_RISK:return r.PaymentInfo$TxnStatus.COLLECT_FAILED_RISK;case a.REQUEST_PAY_FAILED:return r.PaymentInfo$TxnStatus.COLLECT_FAILED;case a.REQUEST_PAY_INIT:return r.PaymentInfo$TxnStatus.COLLECT_INIT;case a.REQUEST_PAY_REJECTED:return r.PaymentInfo$TxnStatus.COLLECT_REJECTED;case a.REQUEST_PAY_SUCCESS:return r.PaymentInfo$TxnStatus.COLLECT_SUCCESS;case a.SEND_PAY_AUTH_CANCELED:return r.PaymentInfo$TxnStatus.AUTH_CANCELED;case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return r.PaymentInfo$TxnStatus.AUTH_CANCEL_FAILED_PROCESSING;case a.SEND_PAY_AUTH_CANCEL_FAILED:return r.PaymentInfo$TxnStatus.AUTH_CANCEL_FAILED;case a.SEND_PAY_FAILURE_RECEIVER:return r.PaymentInfo$TxnStatus.FAILED_RECEIVER_PROCESSING;case a.SEND_PAY_FAILURE_RISK:case a.RECV_PAY_FAILURE_RISK:return r.PaymentInfo$TxnStatus.FAILED_RISK;case a.SEND_PAY_PENDING_RECEIVER:return r.PaymentInfo$TxnStatus.PENDING_RECEIVER_SETUP;case a.SEND_PAY_PENDING_REFUND:return r.PaymentInfo$TxnStatus.FAILED_DA_FINAL;case a.SEND_PAY_REFUNDED:return r.PaymentInfo$TxnStatus.REFUNDED_TXN;case a.SEND_PAY_REFUND_FAILED_PROCESSING:return r.PaymentInfo$TxnStatus.REFUND_FAILED_PROCESSING;case a.SEND_PAY_REFUND_FAILED:return r.PaymentInfo$TxnStatus.REFUND_FAILED;case a.SEND_PAY_REFUND_PENDING:return r.PaymentInfo$TxnStatus.REFUND_FAILED_DA;case a.SEND_PAY_IN_REVIEW:return r.PaymentInfo$TxnStatus.IN_REVIEW;case a.STATUS_UNSET:default:return r.PaymentInfo$TxnStatus.UNKNOWN}},t.getPaymentWebStatus=function(e,t){if(null==e)return r.PaymentInfo$Status.UNKNOWN_STATUS;switch(e){case a.SEND_PAY_INIT:case a.SEND_PAY_PENDING:case a.RECV_PAY_INIT:case a.RECV_PAY_PENDING:case a.RECV_PAY_RETRY_ON_FAILURE:case a.REQUEST_PAY_INIT:return r.PaymentInfo$Status.PROCESSING;case a.SEND_PAY_PENDING_RECEIVER:case a.SEND_PAY_FAILURE_RECEIVER:return r.PaymentInfo$Status.SENT;case a.REQUEST_PAY_SUCCESS:return t===i.TYPE_P2P_REQ_SENT?r.PaymentInfo$Status.WAITING_FOR_PAYER:r.PaymentInfo$Status.WAITING;case a.RECV_PAY_PENDING_SETUP:return r.PaymentInfo$Status.NEED_TO_ACCEPT;case a.SEND_PAY_SUCCESS:case a.RECV_PAY_SUCCESS:case a.REQUEST_PAY_FULFILLED:return r.PaymentInfo$Status.COMPLETE;case a.SEND_PAY_FAILURE:case a.SEND_PAY_FAILURE_RISK:case a.SEND_PAY_PENDING_REFUND:case a.SEND_PAY_REFUND_PENDING:case a.SEND_PAY_REFUND_FAILED:case a.SEND_PAY_REFUND_FAILED_PROCESSING:case a.RECV_PAY_FAILURE:case a.REQUEST_PAY_FAILED:case a.REQUEST_PAY_FAILED_RISK:return r.PaymentInfo$Status.COULD_NOT_COMPLETE;case a.SEND_PAY_REFUNDED:return r.PaymentInfo$Status.REFUNDED;case a.RECV_PAY_EXPIRED:case a.REQUEST_PAY_EXPIRED:case a.SEND_PAY_AUTH_CANCELED:case a.SEND_PAY_AUTH_CANCEL_FAILED:case a.SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:return r.PaymentInfo$Status.EXPIRED;case a.REQUEST_PAY_REJECTED:return r.PaymentInfo$Status.REJECTED;case a.REQUEST_PAY_CANCELLED:return r.PaymentInfo$Status.CANCELLED;case a.STATUS_UNSET:case a.REQUEST_PAY_CANCELLING:default:return r.PaymentInfo$Status.UNKNOWN_STATUS}};var r=n(421224);const i=n(76672)({TYPE_UNSET:0,TYPE_P2P_SENT:1,TYPE_P2P_RCVD:2,TYPE_P2P_GRP:3,TYPE_P2P_NO_INFO:4,TYPE_FUTURE:5,TYPE_P2P_REQ_SENT:10,TYPE_P2P_REQ_RCVD:20,TYPE_P2P_REQ_SCHEDULED_PAYMENT_RCVD:21,TYPE_P2P_REQ_GRP:30,TYPE_P2M_SENT:100,TYPE_P2M_RCVD:200,TYPE_P2M_PAYOUT:300,TYPE_MISSING_DETAILS:400,TYPE_DEPOSIT:500,TYPE_REFUND:600,TYPE_WITHDRAWAL:700});t.PaymentTransactionType=i;const a=n(76672)({STATUS_UNSET:0,REQUEST_PAY_INIT:11,REQUEST_PAY_SUCCESS:12,REQUEST_PAY_FAILED:13,REQUEST_PAY_FAILED_RISK:14,REQUEST_PAY_REJECTED:15,REQUEST_PAY_EXPIRED:16,REQUEST_PAY_FULFILLED:17,REQUEST_PAY_CANCELLED:18,REQUEST_PAY_CANCELLING:19,REQUEST_PAY_SCHEDULED_PAYMENT_SUCCESS:20,RECV_PAY_INIT:101,RECV_PAY_PENDING_SETUP:102,RECV_PAY_PENDING:103,RECV_PAY_RETRY_ON_FAILURE:104,RECV_PAY_FAILURE:105,RECV_PAY_SUCCESS:106,RECV_PAY_EXPIRED:107,RECV_PAY_FAILURE_RISK:108,RECV_PAY_WITHDRAWAL_PROCESSING:109,RECV_PAY_WITHDRAWAL_FAILURE:110,RECV_PAY_WITHDRAWAL_PERMANENT_FAILED:111,RECV_PAY_SENDER_CANCELED:112,SEND_PAY_INIT:401,SEND_PAY_PENDING_RECEIVER:402,SEND_PAY_PENDING:403,SEND_PAY_REFUND_PENDING:404,SEND_PAY_SUCCESS:405,SEND_PAY_FAILURE:406,SEND_PAY_FAILURE_RISK:407,SEND_PAY_REFUNDED:408,SEND_PAY_REFUND_FAILED:409,SEND_PAY_FAILURE_RECEIVER:410,SEND_PAY_REFUND_FAILED_PROCESSING:411,SEND_PAY_PENDING_REFUND:412,SEND_PAY_AUTH_CANCEL_FAILED_PROCESSING:413,SEND_PAY_AUTH_CANCEL_FAILED:414,SEND_PAY_AUTH_CANCELED:415,SEND_PAY_EXPIRED:416,SEND_PAY_AUTH_SUCCESS:417,SEND_PAY_AUTH_SUCCESS_CANCELING:418,SEND_PAY_IN_REVIEW:419,SEND_PAY_PENDING_PROCESSING:420,SEND_PAY_USER_CANCELED:421,WITHDRAWAL_INIT:601,WITHDRAWAL_PENDING:602,WITHDRAWAL_IN_REVIEW:603,WITHDRAWAL_SUCCESS:604,WITHDRAWAL_FAILED:605,WITHDRAWAL_USER_CANCELED:606,WITHDRAWAL_EXPIRED:607,WITHDRAWAL_ACTIVE:608});t.NotificationTransactionStatus=a;const o={TYPE_P2P:"p2p",TYPE_P2M:"p2m",TYPE_P2M_PAYOUT:"payout",TYPE_WITHDRAWAL:"withdrawal",TYPE_DEPOSIT:"deposit",TYPE_REFUND:"refund"};t.PaymentTransactionTypeServerString=o;const s={PENDING_RECEIVER_SETUP:"PENDING_RECEIVER_SETUP",PENDING_SETUP:"PENDING_SETUP",PENDING:"PENDING",INITIAL:"INITIAL",SUCCESS:"SUCCESS",COMPLETED:"COMPLETED",IN_REVIEW:"IN_REVIEW",FAILED:"FAILED",DECLINED:"DECLINED",FAILURE:"FAILURE",FAILED_RISK:"FAILED_RISK",FAILED_PROCESSING:"FAILED_PROCESSING",FAILED_RECEIVER_PROCESSING:"FAILED_RECEIVER_PROCESSING",REFUND_FAILED_PROCESSING:"REFUND_FAILED_PROCESSING",REFUNDED:"REFUNDED",REFUND_FAILED:"REFUND_FAILED",EXPIRED:"EXPIRED",CANCELED:"CANCELLED",AUTH_SUCCESS:"AUTH_SUCCESS",AUTH_CANCELED:"AUTH_CANCELED",AUTH_CANCEL_FAILED_PROCESSING:"AUTH_CANCEL_FAILED_PROCESSING",AUTH_CANCEL_FAILED:"AUTH_CANCEL_FAILED",COLLECT_SUCCESS:"COLLECT_SUCCESS",COLLECT_FAILED:"COLLECT_FAILED",COLLECT_REJECTED:"COLLECT_REJECTED",COLLECT_EXPIRED:"COLLECT_EXPIRED",COLLECT_CANCELED:"COLLECT_CANCELED",FAILED_DA:"FAILED_DA",FAILED_DA_FINAL:"FAILED_DA_FINAL",REFUND_FAILED_DA:"REFUND_FAILED_DA",COLLECT_FAILED_RISK:"COLLECT_FAILED_RISK",WITHDRAWAL_PROCESSING:"WITHDRAWAL_PROCESSING",WITHDRAWAL_FAILURE:"WITHDRAWAL_FAILURE",WITHDRAWAL_PERMANENT_FAILED:"WITHDRAWAL_PERMANENT_FAILED",WITHDRAWAL_ACTIVE:"WITHDRAWAL_ACTIVE"};t.PaymentTransactionStatusServerString=s},465347:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(831914),o=n(471914),s=r(n(355184)),l=n(751288),c=n(640623);const u=new Set,d=new o.WapParser("lowKeyParser",(e=>(e.assertTag("notification"),e.assertAttr("type","encrypt"),e.assertFromServer(),{stanzaId:e.attrString("id"),numRemaining:e.child("count").attrInt("value")})));function p(){return(p=(0,i.default)((function*(e,t){const n=d.parse(e);if(n.error)throw __LOG__(4,void 0,new Error)`handlePreKeyLow: Parsing Error: ${n.error.toString()}`,n.error;{const e=n.success,r=(0,a.wap)("ack",{to:a.S_WHATSAPP_NET,id:(0,a.CUSTOM_STRING)(e.stanzaId),class:"notification"});return u.has(t)?r:(u.add(t),c.waSignalStore.setServerHasPreKeys(!1),yield(0,s.default)(),(0,l.uploadPreKeys)().then((()=>r)).finally((()=>{u.delete(t)})))}}))).apply(this,arguments)}},846007:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=s.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return(0,a.default)(t.success)};var i=n(471914),a=r(n(624206)),o=n(181663);const s=new i.WapParser("incomingPresenceParser",(e=>{e.assertTag("presence");const t=e.attrEnumOrDefault("type",{available:"available",unavailable:"unavailable",unsubscribe:"unsubscribe"},"available"),n="deny"===e.maybeAttrString("last")||void 0;let r;return"unavailable"===t&&(e.hasAttr("last")?["deny","none","error"].includes(e.attrString("last"))||(r=e.attrTime("last")):r=Date.now()),{id:(0,o.chatJidToChatWid)(e.attrChatJid("from")),type:t,t:r,deny:n}}))},826445:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return m.apply(this,arguments)};var i=r(n(348926)),a=n(51239),o=n(831914),s=n(471914),l=n(257243),c=n(181663),u=n(797970),d=n(691102),p=n(978820),f=n(868315);const _=new s.WapParser("incomingPrivacyTokensParser",(e=>{e.assertTag("notification");const t=e.attrString("id"),n=e.attrUserJid("from"),r=e.child("tokens"),i=[];return r.forEachChildWithTag("token",(e=>{const t=e.attrString("type");switch(t){case"trusted_contact":i.push(function(e){return{type:"trusted_contact",content:(0,a.uint8ArrayToBuffer)(e.contentBytes()),ts:e.attrTime("t")}}(e));break;case"trusted_contact_outgoing":i.push(function(e){const t=e.attrUserJid("jid");return{type:"trusted_contact_outgoing",ts:e.attrTime("t"),jid:t}}(e));break;default:__LOG__(2)`incomingPrivacyTokensParser - receiving an unknow token: ${t}`}})),{id:t,from:n,privacyTokens:i}}));function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const{ts:n}=t,r=(0,c.userJidToUserWid)(e.from);if("trusted_contact_outgoing"===t.type&&(0,p.isMeAccount)(r)){const e=(0,c.userJidToUserWid)(t.jid);yield(0,d.setTcTokenSenderTimestamp)(e,n)}else"trusted_contact"===t.type&&(yield(0,u.setTcToken)(r,n,t.content),yield f.PresenceCollection.reSubscribeWhenActive(r))}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=_.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:n}=t,r=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(n.id),class:"notification",to:(0,o.JID)(n.from),type:"privacy_token"});return(0,l.getABPropConfigValue)("trusted_contacts")?(yield Promise.all(n.privacyTokens.map((e=>h(n,e)))),r):r}))).apply(this,arguments)}},802276:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleProfilePicNotificationJob=function(e){const t=(0,f.isNotifSchedulerEnabled)()?r.JOB_PRIORITY.LOW:r.JOB_PRIORITY.SKIP;return(0,u.NonPersistJob)("handleProfilePicNotification",(e=>function(e){const t=h.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success;let r=Promise.resolve();if(n.jid){const e=n.jid;switch(n.type){case"delete":case"set":const t="delete"===n.type?_.PROFILE_PIC_COMMAND.REMOVE:_.PROFILE_PIC_COMMAND.SET;r=(0,d.changeProfilePicThumb)(e,t).then((()=>{if(!e.isGroup())return;const r=(0,s.genGroupPicChangeNotificationMsg)(n.jid,t,n.ts,n.author||(0,p.getMeUser)());return(0,c.handleSingleMsgMD)(n.jid,r)}));break;case"request":break;default:__LOG__(3)`Invalid type received`}}return r.then((()=>(0,i.wap)("ack",{id:(0,i.CUSTOM_STRING)(n.stanzaId),to:(0,o.JID)(n.from),class:"notification",type:"picture"})))}(e.node)),{priority:t}).waitUntilCompleted({node:e})};var r=n(524674),i=n(831914),a=n(471914),o=n(696055),s=n(677345),l=n(181663),c=n(707122),u=n(879274),d=n(373232),p=n(978820),f=n(458464),_=n(241601);const h=new a.WapParser("incomingProfilePicNotificationParser",(e=>{let t,n;if(e.assertTag("notification"),e.hasChild("delete"))t="delete",n=e.child("delete");else if(e.hasChild("set"))t="set",n=e.child("set");else{if(!e.hasChild("request"))return e.throw("Expected child type to be one of: set, delete, request");t="request",n=e.child("request"),n.assertAttr("jid",(0,p.assertGetMe)().toJid())}const r=e.attrString("id");return n.hasAttr("jid")?{type:t,from:(0,l.chatJidToChatWid)(e.attrChatJid("from")),jid:(0,l.chatJidToChatWid)(n.attrChatJid("jid")),author:n.hasAttr("author")?(0,l.userJidToUserWid)(n.attrUserJid("author")):null,ts:e.attrTime("t"),rawTs:e.attrString("t"),stanzaId:r,picId:"set"===t?n.attrInt("id",1):0}:{from:(0,l.userJidToUserWid)(e.attrUserJid("from")),jid:null,type:t,hash:n.attrString("hash"),stanzaId:r}}))},788388:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return v.apply(this,arguments)};var i=r(n(348926)),a=n(51239),o=n(252230),s=n(831914),l=n(471914),c=n(257243),u=n(824214),d=n(696055),p=n(181663),f=n(899747),_=n(745454),h=n(49714),g=n(953348);const m=n(76672)({Image:"image",Video:"video",Text:"text"}),y=new l.WapParser("incomingCampaignParser",(e=>{e.assertTag("notification"),e.assertAttr("from",o.STATUS_JID);const t=e.attrString("id"),n=(0,p.userJidToUserWid)(e.attrUserJid("participant")),r=e.attrTime("t"),i=e.child("campaign"),s=i.hasChild("revoke"),l=i.attrString("id"),c=i.maybeAttrInt("duration"),u=i.mapChildrenWithTag("message",(e=>{const t=e.child("media");t.attrEnumValues("mediatype",m.members());return{id:e.attrString("id"),ts:r,body:(0,a.uint8ArrayToBuffer)(t.contentBytes())}}));return{participant:n,stanzaId:t,campaignId:l,campaignDuration:c,revoke:s,ts:r,messages:u}}));function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const{participant:n,campaignId:r,campaignDuration:i}=e,{id:a,ts:s,body:l}=t,c={type:h.MESSAGE_TYPE.OTHER_STATUS,externalId:a,ts:s,edit:-1,isHsm:!1,count:null,chat:(0,_.createWid)(o.STATUS_JID),author:n,pushname:null,isDirect:!1,campaignId:r,campaignDuration:i},d={retryCount:0,e2eType:u.CiphertextType.Msg,mediaType:u.MediaType.Photo,hideFail:!1};yield(0,g.processDecryptedProto)(l,c,null,d,{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null},!1)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const t=y.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:n}=t,r=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n.stanzaId),participant:(0,d.USER_JID)(n.participant),class:"notification",type:"psa",to:(0,d.JID)((0,_.createWid)(o.STATUS_JID))});return(0,c.getABPropConfigValue)("web_status_psa")?(n.revoke?yield(0,f.revokeStatusPSA)(n.campaignId):yield Promise.all(n.messages.map((e=>S(n,e)))),r):r}))).apply(this,arguments)}},506736:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updatePushname=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=(0,l.toUserWid)(e);return c.enqueue((0,i.default)((function*(){let e;n||(e=yield a(r,t)),(e||void 0===e)&&(__LOG__(2)`updatePushName: set pushname for ${String(r)}`,(0,s.persistContactUpdateBatched)({id:r.toString(),pushname:t}))})));function a(e,t){return(0,o.frontendSendAndReceive)("updatePushname",{contactId:e,pushname:t})}};var i=r(n(348926)),a=n(927870),o=n(708154),s=n(866e3),l=n(745454);const c=new a.PromiseQueue},779711:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_RETRY=void 0,t.handleMessageRetryRequest=function(e){const t=h.default.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success,{from:r,participant:a,recipient:l,retryCount:u,stanzaId:p}=n;if(null==p)return __LOG__(3)`Received null stanzaID when handling message retry request`,Promise.reject(new Error("Received null stanzaID when handling message retry request"));const f=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)(p),to:(0,s.JID)(r),participant:a?(0,s.DEVICE_JID)(a):o.DROP_ATTR,class:"receipt",type:"retry"}),g=C(r,l);if(!g)return Promise.resolve(f);return(0,c.handleMessage)(String(g),!1,(0,i.default)((function*(){const e=yield v(n);if(null==e)return f;const{originalMsgId:t,chat:i,requester:o,identityRowId:s}=e;try{const e=yield(0,_.getMsgIfAuthorized)(t,i,o,u,s);if(!e)return __LOG__(3)`handleMessageRetryRequest msg retry not authorized`,f;yield(0,d.sendRetry)(r,a,l,e,u)}catch(e){__LOG__(3)`handleMessageRetryRequest error: ${e}`}return f})))},t.handleVoipRetryRequest=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=n(831914),s=n(696055),l=n(466863),c=n(521522),u=n(420993),d=n(366590),p=n(978820),f=n(745454),_=n(628870),h=r(n(787423)),g=n(572841),m=r(n(876883)),y=r(n(11339)),S=n(209108);function E(){return(E=(0,i.default)((function*(e){return null!=(yield v(e))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){const{originalMsgId:t,from:n,participant:r,recipient:o,retryCount:s,offline:c}=e;if(s>=5)return void __LOG__(2)`handleRetryRequest refusing retry attempt #${s}`;const d=C(n,o);if(!d)return void __LOG__(3)`handleRetryRequest: no chat found for incoming retry request.`;const p=d.isUser()?n:r;if(!p)return void __LOG__(3)`handleRetryRequest: no requester found for incoming retry request.`;const f=p.device||0;try{return(yield(0,S.hasDevice)(p,f))?yield u.sendMsgQueueMap.enqueue(d.toString(),(0,i.default)((function*(){yield(0,_.updateLocalSession)(d,e),yield(0,l.ensureE2ESessions)([p]);const n=yield m.default.getIdentityRowId((0,g.createSignalAddress)(p).toString());return{originalMsgId:t,chat:d,requester:p,identityRowId:n}}))):(__LOG__(3)`handleRetryRequest: no device ${f} found for ${p.user} for incoming retry request .`,void new y.default.MdRetryFromUnknownDevice({offline:c,senderType:f===a.DEFAULT_DEVICE_ID?y.default.DEVICE_TYPE.PRIMARY:y.default.DEVICE_TYPE.COMPANION}).commit())}catch(e){__LOG__(3)`handleRetryRequest error: ${e}`}}))).apply(this,arguments)}function C(e,t){return e.isUser()?(0,f.toUserWid)(e).equals((0,p.getMeUser)())?t||(__LOG__(3)`getActualChatId: from is a peer device, but without recipient`,null):(0,f.toUserWid)(e):e}t.MAX_RETRY=5},628870:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgIfAuthorized=function(){return m.apply(this,arguments)},t.processKeyBundle=y,t.updateLocalSession=function(){return E.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(536051),s=r(n(465212)),l=n(115461),c=n(978820),u=n(745454),d=n(959060),p=r(n(11339)),f=n(17304),_=n(847124),h=n(543201),g=n(290981);function m(){return(m=(0,a.default)((function*(e,t,n,r,i){const a=new s.default({id:e,remote:t,fromMe:!0,participant:t.isUser()?void 0:(0,c.getMeUser)()}),u=yield(0,g.getTable)().get(String(a));if(!u)return __LOG__(3)`getMsgIfAuthorized: can not find msg ${a.toString()}.`,null;const d=u.type===l.MSG_TYPE.REVOKED?u.protocolMessageRowId:u.rowId;if(null==d)return __LOG__(3)`getMsgIfAuthorized: msg missing rowId ${a.toString()}.`,null;const h=yield(0,_.isRetryEligible)(a,n,i,d);__LOG__(2,void 0,void 0,void 0,["messaging"])`getMsgIfAuthorized: ${e}, ${String(n)} retry eligibility ${h}`;const m=new f.Msg((0,o.messageFromDbRow)(u));yield m.waitForPrep();let y=!1,S=p.default.RETRY_REJECT_REASON.OTHER;switch(m.type===l.MSG_TYPE.REVOKED&&(y=!0,m.type="protocol",m.subtype="admin"===m.subtype?"admin_revoke":"sender_revoke"),h){case _.RetryEligibilityResult.ELIGIBLE:return m;case _.RetryEligibilityResult.INELIGIBLE_ALREADY_DELIVERED:S=p.default.RETRY_REJECT_REASON.DOUBLE_CHECKMARK;break;case _.RetryEligibilityResult.INELIGIBLE_CHANGED_IDENTITY:S=p.default.RETRY_REJECT_REASON.IDENTITY_CHANGE;break;default:S=p.default.RETRY_REJECT_REASON.OTHER}return new p.default.E2eRetryReject({senderDeviceType:n.isCompanion()?p.default.DEVICE_TYPE.COMPANION:p.default.DEVICE_TYPE.PRIMARY,messageType:m.getWamMessageType(),msgRetryCount:r,retryRevoke:y,retryRejectReason:S}).commit(),null}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,a.default)((function*(e,t,n,r,a){return null!=n&&e&&e.key?a?null==r?(__LOG__(2)`processKeyBundle: missing session for retry`,yield d.Session.deleteRemoteInfo(t),!1):r!==n?(__LOG__(2)`processKeyBundle: delete session because reg does not match, saved: ${r}, received: ${n}`,yield d.Session.deleteRemoteInfo(t),!1):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield d.Session.createSignalSession((0,i.default)({wid:t,regId:n},e)),!0):(__LOG__(2)`processKeyBundle: update local session with the retry key bundle`,yield d.Session.createSignalSession((0,i.default)({wid:t,regId:n},e)),!0):(__LOG__(2)`processKeyBundle: skip due to missing key bundle`,!1)}))).apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t){const{from:r,keyBundle:i,offline:a,originalMsgId:o,participant:s,regId:l,retryCount:p}=t,f=s||r;if(__LOG__(2)`updateLocalSession: retryCount: ${p}, offline: ${a.toString()}, has keyBundle: ${(!!i).toString()}`,e.isGroup()){const t=n(669951).ChatCollection.get(e);t&&f&&(0,h.markForgetSenderKey)(t.id,[f])}const _=yield d.Session.getRemoteRegId(f);if((0,u.toUserWid)(f).equals((0,c.getMeUser)())&&_!==l)throw new Error(`updateLocalSession: detect registration Id change remote: ${l}, local: ${_} for peer device`);(yield y(i,f,l,_,a))||null!=_&&_!==l&&(__LOG__(2)`updateLocalSession: delete session because reg does not match, saved: ${_}, received: ${_}`,yield d.Session.deleteRemoteSession(f));if(2===p)return d.Session.saveSessionBaseKey(f,o);if(p>2){if(yield d.Session.hasSameBaseKey(f,o))return __LOG__(2)`updateLocalSession: delete local session due to same base key`,d.Session.deleteRemoteSession(f)}}))).apply(this,arguments)}},787423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(471914),i=n(181663),a=n(978820);var o=new r.WapParser("retryRequestParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","retry"),e.hasAttr("to")&&e.assertAttr("to",(0,a.assertGetMe)().toJid());const t=(0,i.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.hasAttr("participant")?(0,i.deviceJidToDeviceWid)(e.attrDeviceJid("participant")):null,r=e.hasAttr("recipient")?(0,i.deviceJidToUserWid)(e.attrDeviceJid("recipient")):null,o=e.child("retry"),s=e.maybeChild("keys");let l=null;if(null!=s){var c;const e=s.child("skey"),t=s.child("key");l={identity:s.child("identity").contentBytes(32),deviceIdentity:null===(c=s.maybeChild("device-identity"))||void 0===c?void 0:c.contentBytes(),skey:{id:e.child("id").contentUint(3),pubkey:e.child("value").contentBytes(32),signature:e.child("signature").contentBytes(64)},key:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32)}}}return{stanzaId:e.attrString("id"),originalMsgId:o.attrString("id"),ts:e.attrTime("t"),retryCount:o.hasAttr("count")?o.attrInt("count"):0,regId:e.child("registration").contentUint(4),offline:e.hasAttr("offline"),from:t,participant:n,recipient:r,keyBundle:l}}));t.default=o},856545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOTIFICATION_TYPE=void 0,t.handleServerNotification=function(e){const t=u.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){const t=(0,r.wap)("ack",{id:(0,r.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server",to:e.from});switch(e.type){case c.LOG:return o.upload({reason:"Server request",immediate:!0,force:!0,skipSampling:!1}),Promise.resolve(t);case c.PROPS:return(0,s.queryServerProps)().then((()=>t));case c.ABPROPS:return(0,a.syncABProps)(!1).then((()=>t));default:return __LOG__(3)`Unsupported notification with type "server",
blindly ack-ing it and doing nothing`,Promise.resolve(t)}}(t.success)};var r=n(831914),i=n(471914),a=n(95060),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(386374)),s=n(276816);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const c=Object.freeze({LOG:"log",PROPS:"props",ABPROPS:"abprops"});t.NOTIFICATION_TYPE=c;const u=new i.WapParser("incomingServerNotificationParser",(e=>{e.assertTag("notification");const t=e.attrString("id"),n=e.attrWapJid("from");return e.hasChild(c.LOG)?{type:c.LOG,stanzaId:t,from:n}:e.hasChild(c.PROPS)?{type:c.PROPS,stanzaId:t,from:n}:e.hasChild(c.ABPROPS)?{type:c.ABPROPS,stanzaId:t,from:n}:{type:null,stanzaId:t,from:n}}))},725773:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleServerSyncNotification=function(e){const t=p.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);return function(e){if(e.changedCollections){const t=new Map;for(const[n,r]of e.changedCollections){const e=o.CollectionName.cast(n);null!=e?t.set(e,r):__LOG__(3)`syncd: unknown collection name in notification: ${n}`}let n=Array.from(t.keys());e.offline&&n.forEach((e=>{const t=d.get(e);null!=t?d.set(e,t+1):d.set(e,1)})),__LOG__(2)`syncd: incoming sync notification for collections
${Array.from(t.entries()).map((e=>{let[t,n]=e;return`${t} v${n}`})).join("\n")}`,c.default.isSyncDCriticalDataSyncInProcess()&&(n=n.filter((e=>(0,a.isCriticalCollection)(e))),__LOG__(2)`syncd: filtered non critical collections during bootstrap. new collections: ${n}`),(0,i.markCollectionsForSync)(n,t)}return Promise.resolve((0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(e.stanzaId),class:"notification",type:"server_sync",to:s.S_WHATSAPP_NET}))}(t.success)},t.reportOfflineNotifications=function(){if(d.size<1)return;let e=0;Array.from(d.entries()).forEach((t=>{let[,n]=t;e+=n-1})),new u.default.MdAppStateOfflineNotifications({redundantCount:e}).commit(),d.clear()};var i=n(836229),a=n(365926),o=n(960362),s=n(831914),l=n(471914),c=r(n(595023)),u=r(n(11339));const d=new Map,p=new l.WapParser("serverSyncNotification",(e=>{if(e.assertTag("notification"),!e.hasChild("collection"))throw e.createParseError("Server sync notifcation does not contain any collections");const t=e.attrString("id"),n=new Map(e.mapChildrenWithTag("collection",(e=>[e.attrString("name"),e.attrInt("version")]))),r=e.hasAttr("offline");return e.attrString("from")!==s.S_WHATSAPP_NET.toString()&&__LOG__(4,void 0,new Error)`handleServerSyncNotification: "from" is not domain jid "s.whatsapp.net"`,{changedCollections:n,stanzaId:t,offline:r}}))},687183:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(471914),s=n(781572),l=n(554003),c=n(991214),u=n(765044);const d=new o.WapParser("streamErrorParser",(e=>{if(e.assertTag("stream:error"),!e.hasChild("conflict"))return e.hasAttr("code")?{type:"code",code:e.attrInt("code")}:e.hasChild("ack")?{type:"ack",id:e.child("ack").hasAttr("id")?e.child("ack").attrString("id"):null}:(__LOG__(3)`Unrecognized stream:error: ${e.toString()}`,{type:"other"});switch(e.child("conflict").attrString("type")){case"replaced":return{type:"replaced"};case"device_removed":default:return{type:"device_removed"}}}));function p(){return(p=(0,i.default)((function*(e){const t=d.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const n=t.success;if("code"===n.type&&n.code>=500&&n.code<600){if(515===n.code)return(0,l.startLogin)(),Promise.resolve("NO_ACK");if(516===n.code)return(0,c.commitDeviceLinkEvent)(516),(0,l.startLogout)(),Promise.resolve("NO_ACK");(0,a.onStreamErrorReceived)()}else{if("device_removed"===n.type)return s.Cmd.onStartingLogout(),(0,a.stopComms)(),yield u.Socket.clearCredentialsAndStoredData(),__LOG__(2)`stream error due to device removed, logging out`,s.Cmd.logout(),Promise.resolve("NO_ACK");if("replaced"===n.type)return(0,a.stopComms)(),Promise.resolve("NO_ACK")}return Promise.resolve("CLOSE_SOCKET")}))).apply(this,arguments)}},795681:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`handleSuccess: failed to parse ${t.error}`,Promise.reject(t.error);const n=t.success;(function(e){const t=Date.now()/1e3,n=Math.round(t-e),r=Math.round(n/3600);0!==r&&(0,s.getABPropConfigValue)("log_clock_skew")&&new h.default.ClockSkewDifferenceT({clockSkewHourly:-1*r}).commit();(0,a.setClockSkew)(n),l.Clock.setSkew(n)})(n.ts),function(e){const t=(0,f.getMaybeMeLid)();if(null==t&&null==e)return;if(null==t&&null!=e)return void(0,f.setMeLid)(e);if(null!=t&&null==e)return;if((0,i.default)(t,"lid").equals(e))return;(0,f.setMeLid)((0,i.default)(e,"nextLid"))}(null==n.lid?null:(0,_.createWid)(n.lid)),c.Cmd.onTemporaryBan({banned:!1});const r=n.companionEncStatic;if(d.DbEncKeyStore.generateFinalDbEncryptionAndFtsKey(r),(0,u.generateFinalDbEncryptionAndFtsKeyForInvoker)(r),null==g.ServerProps.serverPropsVersion||g.ServerProps.serverPropsVersion<n.propsVersion)return(0,p.queryServerProps)()};var i=r(n(145095)),a=n(892844),o=n(471914),s=n(257243),l=n(40234),c=n(781572),u=n(845831),d=n(624256),p=n(276816),f=n(978820),_=n(745454),h=r(n(11339)),g=n(964551);const m=new o.WapParser("successParser",(e=>(e.assertTag("success"),{ts:e.attrTime("t"),propsVersion:e.attrInt("props"),companionEncStatic:e.maybeAttrString("companion_enc_static")||"NULL",lid:e.maybeAttrString("lid")})))},102634:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleCall=function(e){const t=m.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{callCreator:n,from:r,message:i,payloadTag:o,stanzaId:c}=t.success,u=(0,s.wapNodeToVoipXml)(e),g={elapsed_msec:i.elapsed_msec,epoch_msec:i.epoch_msec,is_offline:i.is_offline,payload:u[2][0],peer_app_version:i.peer_app_version,peer_platform:i.peer_platform,peer_jid:i.peer_jid?i.peer_jid.toString({legacy:!0}):void 0},S=i.call_id;switch(i.type){case f.TYPE.OFFER:return y(r,c,S,n,i.type),(0,_.getDoNotDisturb)()&&!h.default.isFocused?__LOG__(2)`handleCall: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`:(0,l.handleIncomingCallOffer)(i,g),Promise.resolve("NO_ACK");case f.TYPE.ENC_REKEY:return(0,l.handleIncomingEncRekey)(i,g).then((e=>{let{shouldRetry:t,retryCount:a}=e;t?(0,d.default)(c,i,a):y(r,c,S,n,f.TYPE.ENC_REKEY)})),Promise.resolve("NO_ACK");case f.TYPE.ACCEPT:case f.TYPE.REJECT:return y(r,c,S,n,i.type),(0,l.handleIncomingSignalingMsg)(i,g),Promise.resolve("NO_ACK");case f.TYPE.OFFER_NOTICE:return(0,p.default)(e);default:return(0,l.handleIncomingSignalingMsg)(i,g),Promise.resolve(function(e,t,n){return(0,a.wap)("ack",{to:(0,s.JID)(e),id:(0,a.CUSTOM_STRING)(t),class:"call",type:(0,a.MAYBE_CUSTOM_STRING)(n)})}(r,c,o))}};var i=n(736184),a=n(831914),o=n(471914),s=n(696055),l=(r(n(364369)),n(61014)),c=n(181663),u=n(978820),d=r(n(317139)),p=r(n(766337)),f=n(445473),_=n(930351),h=r(n(29861));function g(e){return f.TYPE[e.tag().toUpperCase()]||f.TYPE.NONE}const m=new o.WapParser("callParser",(e=>{e.assertTag("call");const t=(0,c.jidWithTypeToWid)(e.attrJidWithType("from")),n=e.mapFirstChild((e=>e));if(n){const r=n.attrString("call-id"),i=(0,c.jidWithTypeToWid)(n.attrJidWithType("call-creator")),a={call_id:r,call_creator:i,peer_jid:t,peer_platform:e.hasAttr("platform")?e.attrString("platform"):void 0,peer_app_version:e.hasAttr("version")?e.attrString("version"):void 0,epoch_msec:e.hasAttr("t")?String(1e3*e.attrInt("t")):void 0,elapsed_msec:e.hasAttr("e")?String(1e3*e.attrInt("e")):void 0,type:g(n),common:{call_id:r,peer_jid:t.toString(),type:String(g(n))},isVideoCall:n.hasChild("video"),t:e.attrTime("t")};return{from:(0,c.jidWithTypeToWid)(e.attrJidWithType("from")),stanzaId:e.attrString("id"),payloadTag:n.tag(),message:a,callCreator:i}}throw new Error("Unrecognized call stanza")}));function y(e,t,n,r,o){let l;switch(o){case f.TYPE.OFFER:l=(0,a.wap)("offer",{"call-id":(0,a.CUSTOM_STRING)(n),"call-creator":(0,s.JID)(r)});break;case f.TYPE.ENC_REKEY:l=(0,a.wap)("enc_rekey",{"call-id":(0,a.CUSTOM_STRING)(n),"call-creator":(0,s.JID)(r)});break;case f.TYPE.ACCEPT:l=(0,a.wap)("accept",{"call-id":(0,a.CUSTOM_STRING)(n),"call-creator":(0,s.JID)(r)});break;case f.TYPE.REJECT:l=(0,a.wap)("reject",{"call-id":(0,a.CUSTOM_STRING)(n),"call-creator":(0,s.JID)(r)})}(0,i.castStanza)((0,a.wap)("receipt",{to:(0,s.JID)(e),id:(0,a.CUSTOM_STRING)(t),from:(0,s.JID)((0,u.getMaybeMeUser)())},l))}},583490:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleCallReceipt=function(e){const t=l.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.reject(t.error);const{stanzaId:n,type:i,from:o}=t.success;return Promise.resolve((0,r.wap)("ack",{id:(0,r.CUSTOM_STRING)(n),to:(0,a.JID)(o),from:(0,a.JID)((0,s.getMaybeMeUser)()),class:"receipt",type:(0,r.MAYBE_CUSTOM_STRING)(i)}))};var r=n(831914),i=n(471914),a=n(696055),o=n(181663),s=n(978820);const l=new i.WapParser("callReceiptParser",(e=>{e.assertTag("receipt");if(!(e.maybeChild("offer")||e.maybeChild("accept")||e.maybeChild("reject")))throw e.createParseError("Unrecognized call stanza");return{stanzaId:e.attrString("id"),type:e.hasAttr("type")?e.attrString("type"):null,from:(0,o.jidWithTypeToWid)(e.attrJidWithType("from"))}}))},71419:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=r(n(145095)),o=n(831914),s=n(471914),l=n(696055),c=n(181663),u=n(779711),d=n(84356);const p=new s.WapParser("rekeyRetryReceiptParser",(e=>{e.assertTag("receipt"),e.assertAttr("type","enc_rekey_retry");const t=e.child("enc_rekey");return{from:(0,c.jidWithTypeToWid)(e.attrJidWithType("from")),originalMsgId:t.attrString("call-id"),stanzaId:e.attrString("id"),retryCount:t.hasAttr("count")?t.attrInt("count"):0,regId:e.child("registration").contentUint(4),ts:null,participant:null,recipient:null,keyBundle:null,offline:!1}}));function f(){return(f=(0,i.default)((function*(e){const t=p.parse(e);if(t.error)throw __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const n=t.success,r=(0,o.wap)("ack",{id:(0,o.CUSTOM_STRING)((0,a.default)(n.stanzaId,"retryInfo.stanzaId")),to:(0,l.JID)(n.from),class:"receipt",type:"enc_rekey_retry"});try{return(yield(0,u.handleVoipRetryRequest)(n))?d.Voip.resendEncRekeyRetry(n.from.toString({legacy:!0,formatFull:!0}),n.retryCount):(__LOG__(3)`voip:handle_enc_rekey_retry_receipt: not sending enc_rekey retry`,d.Voip.endCall(n.originalMsgId)),r}catch(e){return __LOG__(3)`voip:handle_enc_rekey_retry_receipt: error while attempting to send enc_rekey retry`,r}}))).apply(this,arguments)}},766337:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=c.parse(e);if(t.error)return __LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,Promise.resolve("NO_ACK");const{stanzaId:n,fromWid:r,callCreator:a,callId:l,isGroup:u,isVideo:d,t:p}=t.success;return(0,s.default)(a,l,p,d,u),Promise.resolve((0,i.wap)("ack",{to:(0,o.JID)(r),id:(0,i.CUSTOM_STRING)(n),class:"call",type:(0,i.CUSTOM_STRING)("offer_notice")}))};var i=n(831914),a=n(471914),o=n(696055),s=r(n(997335)),l=n(181663);const c=new a.WapParser("callOfferNoticeParser",(e=>{e.assertTag("call");const t=e.attrString("id"),n=(0,l.jidWithTypeToWid)(e.attrJidWithType("from")),r=e.child("offer_notice");return{stanzaId:t,fromWid:n,callCreator:(0,l.deviceJidToDeviceWid)(r.attrDeviceJid("call-creator")),callId:r.attrString("call-id"),isGroup:"group"===r.attrString("type"),isVideo:"video"===r.attrString("media"),t:e.attrTime("t")}}))},698539:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=n(51239),o=n(252230),s=n(831914),l=n(471914),c=n(824214),u=n(696055),d=n(181663),p=n(745454),f=n(49714),_=n(953348);const h=new l.WapParser("incomingWAChatNotificationParser",(e=>{e.assertTag("notification"),e.assertAttr("from",o.PSA_JID);const t=e.attrString("id"),n=e.attrTime("t"),r=(0,d.userJidToUserWid)(e.attrUserJid("from")),i=e.child("messages").mapChildrenWithTag("message",(e=>({id:e.attrString("id"),ts:n,body:(0,a.uint8ArrayToBuffer)(e.contentBytes())})));return{participant:r,stanzaId:t,ts:n,messages:i}}));function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const{participant:n}=e,{id:r,ts:i,body:a}=t,s={type:f.MESSAGE_TYPE.OTHER_STATUS,externalId:r,ts:i,edit:-1,isHsm:!1,count:null,chat:(0,p.createWid)(o.PSA_JID),author:n,pushname:null,isDirect:!1},l={retryCount:0,e2eType:c.CiphertextType.Msg,mediaType:c.MediaType.Photo,hideFail:!1};yield(0,_.processDecryptedProto)(a,s,null,l,{nativeFlowName:null,verifiedNameSerial:null,verifiedLevel:null,verifiedNameCert:null,privacyMode:null},!1)}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const t=h.parse(e);if(t.error)throw __LOG__(2)`error while parsing: ${e.toString()}`,__LOG__(4,void 0,new Error)`Parsing Error: ${t.error.toString()}`,t.error;const{success:n}=t,r=(0,s.wap)("ack",{id:(0,s.CUSTOM_STRING)(n.stanzaId),class:"notification",type:"psa",to:(0,u.JID)((0,p.createWid)(o.PSA_JID))});return yield Promise.all(n.messages.map((e=>g(n,e)))),r}))).apply(this,arguments)}},251836:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractCertificateDetailsParams=function(e){return{serial:e.serial,name:e.verifiedName,isApi:"ent:wa"===e.issuer}},t.getParsedProtoObjects=function(e){if(!e)return null;const t=(0,i.decodeProtobuf)(r.VerifiedNameCertificateSpec,e);if(!t.details)throw new Error("verifyCertificate cert missing details");if(!t.signature)throw new Error("verifyCertificate cert missing signature");const n=(0,i.decodeProtobuf)(r.VerifiedNameCertificate$DetailsSpec,t.details);return{cert:t,details:n}};var r=n(691344),i=n(484902)},783754:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseABProps=function(e){const t=new Map;e.forEach((e=>{const{configCode:n,configValue:r,configExpoKey:i}=e;t.set(n,{configValue:r,configExpoKey:i})}));const n=new Map;return Object.keys(r.ABPropConfigs).map((e=>{const i=r.ABPropConfigs[e][0],a=t.get(i),o=null==a?void 0:a.configValue,s=null==a?void 0:a.configExpoKey;n.set(i,{configValue:o,configExpoKey:null==s?null:s.toString()})})),n};var r=n(73074)},95060:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncABProps=f,t.syncABPropsTask=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=n(250087),o=n(413959),s=n(257243),l=n(246440),c=n(464358),u=n(783754),d=n(781572),p=n(834541);function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){let e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&(e=(0,c.getHash)());const n=yield(0,a.getAbPropsProtocol)(e);if(!n.success)return!1;const{abKey:r,hash:i,refresh:o,props:s}=n.value,d=Date.now();if((0,l.updateGlobalABKey)(null!=r?r:""),(0,c.updateAttributesLocalStorage)(r,e,o,d),null==i)return!1;try{return yield(0,p.updateABPropConfigs)((0,u.parseABProps)(s)),!0}catch(e){__LOG__(4,!0,new Error,!0)`update ABProps config table failed`,SEND_LOGS("update ABProps config table failed when syncing ABProps")}return!1}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){const e=(0,c.isABPropsAfterFirstSync)();let t=3;for(;t-- >0;)try{if(yield f(e))return yield(0,s.updateABPropsFromStorage)(),void d.Cmd.onAbPropsUpdate()}catch(e){0===t&&(__LOG__(4,!0,new Error,!0)`failed to sync ABProps`,SEND_LOGS("failed to sync ABProps")),yield(0,o.delayMs)(1e4*Math.random())}}))).apply(this,arguments)}},268539:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPushServerSettings=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914);const s=new(n(471914).WapParser)("getPushServerSettings",(e=>{if(!e.hasChild("error")){__LOG__(2,void 0,void 0,void 0,["push-notification"])`getPushServerSettings: success`;return e.child("settings").attrString("webserverkey")}const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3,void 0,void 0,void 0,["push-notification"])`getPushServerSettingsRequest: server response with ${n}, ${r}`,{errorCode:n,errorText:r}})),l=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"get",xmlns:"urn:xmpp:whatsapp:push",id:(0,o.generateId)()},(0,o.wap)("settings",null));function c(){return(c=(0,i.default)((function*(){const e=yield(0,a.sendIq)(l,s);if(!e.success){const{errorCode:t,errorText:n}=e;return{errorCode:t,errorText:n}}return e.result}))).apply(this,arguments)}},860334:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setPushConfig=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(736184),s=r(n(145095)),l=n(831914);const c=new(n(471914).WapParser)("setPushConfig",(e=>{if(!e.hasChild("error"))return void __LOG__(2,void 0,void 0,void 0,["push-notification"])`setPushConfig: success`;const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3,void 0,void 0,void 0,["push-notification"])`setPushConfig: server response with ${n}, ${r}`,{errorCode:n,errorText:r}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:push",id:(0,l.generateId)()},(0,l.wap)("config",{platform:"web",endpoint:(0,l.CUSTOM_STRING)(e.endpoint),auth:(0,l.CUSTOM_STRING)((0,a.encodeB64)((0,s.default)(e.getKey("auth"),"pushSubscription.getKey('auth')"))),p256dh:(0,l.CUSTOM_STRING)((0,a.encodeB64)((0,s.default)(e.getKey("p256dh"),"pushSubscription.getKey('p256dh')")))})),n=yield(0,o.sendIq)(t,c);if(!n.success){const{errorCode:e,errorText:t}=n;return{errorCode:e,errorText:t}}return n.result}))).apply(this,arguments)}},174004:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,i.makeGetV1Request)();return(0,r.sendIq)(e,a)};var r=n(736184),i=n(26262);const a=new(n(471914).WapParser)("serverProps",(e=>{e.assertTag("iq"),e.assertAttr("from","s.whatsapp.net");const t=e.child("props"),n={serverPropsVersion:t.attrInt("version")};return t.forEachChildWithTag("prop",(e=>{switch(e.attrString("name")){case"web_ctwa_context_compose_enabled":n.ctwaContextCompose=1===e.attrInt("value");break;case"ctwa_context_enabled":n.ctwaContextRender=1===e.attrInt("value")?1:0;break;case"ephemeral_messages_allowed_values":n.ephemeralMessagesAllowedValues=e.attrString("value");break;case"frequently_forwarded_max":n.frequentlyForwardedMax=e.attrInt("value");break;case"frequently_forwarded_threshold":n.frequentlyForwardedThreshold=e.attrInt("value");break;case"web_gif_search":n.gifSearch=e.attrString("value");break;case"group_call_max_participants":n.groupCallMaxParticipants=e.attrInt("value",0);break;case"group_description_length":n.groupDescLength=e.attrInt("value");break;case"hfm_string_changes":n.hfmStringChanges=e.attrInt("value");break;case"image_max_edge":n.imageMaxEdge=e.attrInt("value");break;case"image_max_kbytes":n.imageMaxKBytes=e.attrInt("value");break;case"image_quality":n.imageQuality=e.attrInt("value")/100;break;case"max_participants":n.maxParticipants=e.attrInt("value");break;case"max_subject":n.maxSubject=e.attrInt("value");break;case"max_keys":n.maxKeys=e.attrInt("value");break;case"media":n.media=e.attrInt("value");break;case"multicast_limit_global":n.multicastLimitGlobal=e.attrInt("value");break;case"mute_always":n.muteAlways=e.attrInt("value");break;case"mms_media_key_ttl":n.mmsMediaKeyTTL=e.attrInt("value");break;case"wallpapers_v2":n.wallpapersV2=e.attrInt("value");break;case"web_shops_chat_header_button_enabled":n.webShopsChatHeaderButtonEnabled=1===e.attrInt("value",0);break;case"shops_hide_catalog_attachment_entrypoint":n.shopsHideCatalogAttachmentEntrypoint=1===e.attrInt("value",0);break;case"shops_header_dropdown_menu_item":n.shopsHeaderDropdownMenuItem=1===e.attrInt("value",0);break;case"shops_product_grid":n.shopsProductGrid=e.attrInt("value",0);break;case"mms_hot_content_timespan_in_seconds":n.mmsHotContentTimespan=e.attrInt("value");break;case"mms_vcache_aggregation_enabled":n.mmsVCacheAggregationEnabled=1===e.attrInt("value");break;case"mms_vcard_autodownload_size_kb":n.mmsVcardAutodownloadSizeKb=e.attrInt("value");break;case"product_media_attachments":n.productMediaAttachments=e.attrInt("value");break;case"status_video_max_duration":n.statusVideoMaxDuration=e.attrInt("value");break;case"syncd_inline_mutations_max_count":n.syncdInlineMutationsMaxCount=e.attrInt("value");break;case"syncd_patch_protobuf_max_size":n.syncdPatchProtobufMaxSize=e.attrInt("value");break;case"syncd_key_max_use_days":n.syncdKeyMaxUseDays=e.attrInt("value");break;case"syncd_wait_for_key_timeout_days":n.syncdWaitForKeyTimeoutDays=e.attrInt("value");break;case"syncd_additional_mutations":n.syncdAdditionalMutations=e.attrInt("value");break;case"syncd_sentinel_timeout_seconds":n.syncdSentinelTimeoutSeconds=e.attrInt("value");break;case"syncd_patch_device_index_included":n.syncdPatchDeviceIndexIncluded=1===e.attrInt("value");break;case"syncd_clear_chat_delete_chat_enabled":n.syncdClearChatDeleteChatEnabled=1===e.attrInt("value");break;case"md_pin_chat_enabled":n.syncdPinChatEnabled=1===e.attrInt("value");break;case"syncd_qpl_logging_enabled":n.syncdQPLLoggingEnabled=1===e.attrInt("value");break;case"template_doc_mime_types":n.templateDocMimeTypes=e.attrInt("value");break;case"web_biz_profile_options":n.webBizProfileOptions=e.attrInt("value");break;case"web_biz_profile_v3":n.webBizProfileV3=1===e.attrInt("value");break;case"vcard_as_document_size_kb":n.vcardAsDocumentSizeKb=e.attrInt("value");break;case"vcard_max_size_kb":n.vcardMaxSizeKb=e.attrInt("value");break;case"web_download_document_thumb_mms_enabled":n.webDownloadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_download_status_thumb_mms_enabled":n.webDownloadStatusThumbMmsEnabled=1===e.attrInt("value");break;case"web_send_document_thumb_in_message_disabled":n.webSendDocumentThumbInMessageDisabled=1===e.attrInt("value");break;case"web_upload_document_thumb_mms_enabled":n.webUploadDocumentThumbMmsEnabled=1===e.attrInt("value");break;case"web_list_message":n.webListMessage=1===e.attrInt("value");break;case"web_voip_mac_os_min_version":n.webVoipMacOsMinVersion=e.attrString("value");break;case"web_voip_windows_os_min_version":n.webVoipWindowsOsMinVersion=e.attrString("value");break;case"mms_cat_v1_forward_hot_override_enabled":n.mmsCatV1ForwardHotOverrideEnabled=1===e.attrInt("value");break;case"web_buttons_message_enabled":n.webButtonsMessage=1===e.attrInt("value");break;case"web_product_list_message_render_kill_switch":n.webProductListMessageRenderKillSwitch=1===e.attrInt("value");break;case"web_smb_upsell_in_biz_profile_enabled":n.webSMBUpsellInBizProfile=1===e.attrInt("value");break;case"ptt_conversation_waveform":n.pttConversationWaveform=1===e.attrInt("value");break;case"ptt_oot_playback":n.pttOotPlayback=1===e.attrInt("value");break;case"ptt_forwarded_features_enabled":n.pttForwardedFeaturesEnabled=1===e.attrInt("value");break;case"ptt_pausable_enabled":n.pttPausableEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_enabled":n.pttPlaybackSpeedEnabled=1===e.attrInt("value");break;case"ptt_playback_speed_hide_delay":n.pttPlaybackSpeedHideDelay=e.attrInt("value");break;case"web_product_list_message_page_size":n.webProductListMessagePageSize=e.attrInt("value");break;case"ptt_remember_play_position":n.pttRememberPlayPosition=1===e.attrInt("value");break;case"ptt_waveform_send":n.pttWaveformSend=1===e.attrInt("value");break;case"web_youtube_player_enhancements":n.webYouTubePlayerEnhancements=1===e.attrInt("value");break;case"web_server_sticker_panel":n.webServerStickerPanel=e.attrInt("value");break;case"web_collections_display_enabled":n.webCollectionsDisplay=1===e.attrInt("value");break;case"web_cart_on_off":n.webCartOnOffToggle=1===e.attrInt("value");break;case"web_product_list_message_enabled":n.webProductListMessage=1===e.attrInt("value");break;case"web_media_auto_download_enabled":n.webMediaAutoDownloadEnabled=1===e.attrInt("value");break;case"download_host_switching_enabled":n.downloadHostSwitchingEnabled=1===e.attrInt("value");break;case"upload_host_switching_enabled":n.uploadHostSwitchingEnabled=1===e.attrInt("value");break;case"web_is_direct_connection_for_plm_transparent":n.isDirectConnectionForPLMTransparent=1===e.attrInt("value");break;case"web_pip_redesign":n.webPipRedesign=1===e.attrInt("value");break;case"max_electron_file_size":n.maxElectronFileSize=e.attrInt("value");break;case"max_file_size":n.maxFileSize=e.attrInt("value");break;case"web_sticker_maker":n.stickerMaker=1===e.attrInt("value");break;case"web_md_migration_experience":n.webMdMigrationExperience=1===e.attrInt("value");break;case"web_log_upload_download_crashes":n.webLogUploadDownloadCrashes=1===e.attrInt("value");break;case"web_large_files_ui":n.webLargeFilesUi=1===e.attrInt("value");break;case"web_graphql_for_catalog_m1":n.webGraphQLForCatalogM1=1===e.attrInt("value");break;case"web_md_mms_sync_deletion_request":n.webMdMmsSyncDeletionRequest=1===e.attrInt("value");break;case"web_payment_background_enabled":n.webPaymentBackgroundEnabled=1===e.attrInt("value");break;case"win_uwp_deprecation_killswitch_enabled":n.winUwpDeprecationKillswitchEnabled=1===e.attrInt("value");break;case"streaming_upload_chunk_size":n.streamingUploadChunkSize=e.attrInt("value");break;case"web_legacy_users_should_update_primary_experience":n.webLegacyUsersShouldUpdatePrimaryExperience=1===e.attrInt("value")}})),n}))},862664:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getToken=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(297197),s=n(892844),l=r(n(11339)),c=n(597245);function u(e){const{result:t,overallStartTime:n,retryStartTime:r,retryAttemptsLeft:i}=e,a=function(e){switch(e){case"success":return l.default.SIGN_CREDENTIAL_RESULT.SUCCESS;case"bad-request":return l.default.SIGN_CREDENTIAL_RESULT.ERROR_BAD_REQUEST;case"internal-server-error":return l.default.SIGN_CREDENTIAL_RESULT.ERROR_SERVER;case"disconnected":return l.default.SIGN_CREDENTIAL_RESULT.ERROR_CLIENT_NETWORK;default:return l.default.SIGN_CREDENTIAL_RESULT.ERROR_OTHER}}(t);new l.default.SignCredential({signCredentialResult:a,overallT:(0,s.monotonicTimeSince)(n),signCredentialT:(0,s.monotonicTimeSince)(r),retryCount:3-i,waConnectedToChatd:"disconnected"!==t,applicationState:"visible"===document.visibilityState?l.default.APPLICATION_STATE.FOREGROUND:l.default.APPLICATION_STATE.BACKGROUND}).commit()}const d=new o.Semaphore(1);function p(){return(p=(0,i.default)((function*(){const e=yield d.acquire();try{const{result:t,metric:n}=yield(0,c.getToken)(a.sendIqWithoutRetry);return null!=n&&u(n),t||__LOG__(3)`Couldn't get a private stats token`,t}finally{e.release()}}))).apply(this,arguments)}},880121:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=r(n(348926)),a=n(8285);function o(){return(o=(0,i.default)((function*(e,t){__LOG__(2)`fieldStatsUpload:sendSendBufferRPC start`;const n=yield(0,a.sendSendBufferRPC)({addT:t,bufferMixinArgs:{addElementValue:e}});let r;if(__LOG__(2)`fieldStatsUpload:sendSendBufferRPC end`,"SendBufferResponseSuccess"===n.name)return __LOG__(2)`fieldStatsUpload:sendSendBufferRPC SendBufferResponseSuccess`,Promise.resolve();"SendBufferResponseErrorNoRetry"===n.name?r=n.value.errorIQErrorBadRequestOrNotAcceptableOrFeatureNotImplementedMixinGroup.value:(n.name,r=n.value.errorIQErrorServiceUnavailableMixin);const{code:i,text:o}=r;return{errorCode:parseInt(i,10),errorText:o}}))).apply(this,arguments)}},993614:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getSpamMessageProtobuf=E,t.reportSpam=function(){return C.apply(this,arguments)};var i=r(n(348926)),a=r(n(967154)),o=r(n(81109)),s=n(736184),l=n(831914),c=n(471914),u=n(760210),d=n(696055),p=n(615947),f=n(985947),_=n(115461),h=n(387674),g=n(978820),m=n(124808),y=n(284728),S=n(760980);function E(e){return null==e.buttonsMessage||null!=e.buttonsMessage.buttons&&(e.buttonsMessage=(0,o.default)((0,o.default)({},e.buttonsMessage),{},{buttons:e.buttonsMessage.buttons.map((e=>{if(e.nativeFlowInfo){var t;const n=JSON.parse(null!==(t=e.nativeFlowInfo.paramsJson)&&void 0!==t?t:"{}");return delete n.reference_id,delete n.total_amount,(0,o.default)((0,o.default)({},e),{},{nativeFlowInfo:(0,o.default)((0,o.default)({},e.nativeFlowInfo),{},{paramsJson:JSON.stringify(n)})})}return e}))})),e}function v(e,t){const n=[],r=e.isGroup?null:e.id;let i=[];if(null!=t){if(!h.SPAM_REPORT_SUPPORTED_MESSAGE_TYPES.has(t.type))return[];i=[t]}else i=function(e,t,n){const r=[],i=e.msgs.toArray().reverse();for(let a=0;a<i.length&&!(r.length>=t);a++){const t=i[a];if(h.SPAM_REPORT_SUPPORTED_MESSAGE_TYPES.has(t.type)&&!t.from.equals((0,g.getMaybeMeUser)())){if(n){if(e.isGroup&&!n.equals(t.author))continue;if(e.isUser&&!n.equals(t.from))continue}r.push(t)}}return r}(e,5,r);return i.forEach((t=>{let r,i,o,s;const c=t.t.toString(),h=t.isViewOnce&&!(0,y.isUnviewed)(t.safe());switch(t.type){case _.MSG_TYPE.UNKNOWN:s=null,r=l.DROP_ATTR,o=l.DROP_ATTR,i=(0,l.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString());break;case _.MSG_TYPE.CIPHERTEXT:s=null,r=l.DROP_ATTR,o=l.DROP_ATTR,i=l.DROP_ATTR;break;default:let e={};if(t.asMms){e=t.isUnsentPhoneMsg()||h||!t.mediaObject?{type:t.type}:t.avParams()}const n=E((0,p.createMsgProtobuf)(t,e)),a=(0,u.mediaTypeFromProtobuf)(n);s=h?null:(0,S.encodeProtobuf)(m.MessageSpec,n).readByteArray(),r=(0,f.typeAttributeFromProtobuf)(n),o=a?(0,l.CUSTOM_STRING)(a):l.DROP_ATTR,i=(0,l.CUSTOM_STRING)(u.CIPHERTEXT_VERSION.toString())}let g;const v={};if(h&&(v.deleted_reason=(0,y.isViewed)(t.safe())?"view_once_opened":"view_once_expired"),e.isGroup){let n=l.DROP_ATTR;t.author?n=(0,d.USER_JID)(t.author):t.from.isUser()&&(n=(0,d.USER_JID)(t.from)),g=(0,l.wap)("message",(0,a.default)({},v,{t:(0,l.CUSTOM_STRING)(c),from:(0,d.CHAT_JID)(e.id),participant:n,id:(0,l.CUSTOM_STRING)(t.id.id),type:r}),(0,l.wap)("raw",{v:i,mediatype:o},s))}else g=(0,l.wap)("message",(0,a.default)({},v,{t:(0,l.CUSTOM_STRING)(c),from:(0,d.USER_JID)(t.from),to:(0,d.USER_JID)(t.to),type:r,id:(0,l.CUSTOM_STRING)(t.id.id)}),t.multicast?(0,l.wap)("multicast",null):null,t.urlNumber?(0,l.wap)("url_number",null):null,t.urlText?(0,l.wap)("url_text",null):null,(0,l.wap)("raw",{v:i,mediatype:o},s));n.push(g)})),n}const T=new c.WapParser("reportUserSpam",(e=>{if(!e.hasChild("error"))return void __LOG__(2)`reportSpam: success`;const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3)`reportSpam: sever response with ${n}, ${r}`,{errorCode:n,errorText:r}}));function C(){return(C=(0,i.default)((function*(e,t,n){const r=v(e,n);let i;if(null!=n)i=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,l.generateId)()},(0,l.wap)("spam_list",{jid:e.isGroup?(0,d.GROUP_JID)(e.id):(0,d.USER_JID)(n.sender),subject:e.isGroup?(0,l.CUSTOM_STRING)(e.formattedTitle):l.DROP_ATTR,spam_flow:(0,l.CUSTOM_STRING)(String(t))},r));else if(!0===e.isParentGroup)i=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,l.generateId)()},(0,l.wap)("spam_list",{jid:(0,d.CHAT_JID)(e.id),spam_flow:(0,l.CUSTOM_STRING)(String(t))}));else if(e.isGroup){var a;const n=(null===(a=e.groupMetadata)||void 0===a?void 0:a.owner)&&(0,d.USER_JID)(e.groupMetadata.owner);i=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,l.generateId)()},(0,l.wap)("spam_list",{creator:n||l.DROP_ATTR,subject:(0,l.CUSTOM_STRING)(e.formattedTitle),jid:(0,d.CHAT_JID)(e.id),spam_flow:(0,l.CUSTOM_STRING)(String(t))},r))}else i=(0,l.wap)("iq",{to:l.S_WHATSAPP_NET,type:"set",xmlns:"spam",id:(0,l.generateId)()},(0,l.wap)("spam_list",{jid:(0,d.CHAT_JID)(e.id),spam_flow:(0,l.CUSTOM_STRING)(String(t))},r));const o=yield(0,s.sendIq)(i,T);if(!o.success){const{errorCode:e,errorText:t}=o;return __LOG__(3)`reportSpam: sever response with ${e}, ${t}`,{errorCode:e,errorText:t}}return o.result}))).apply(this,arguments)}},185509:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getInstance=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=e?f:_(),n=h();let r;if(E[t])return g(y,n)&&(y=n,E[t].updateConfig(n)),E[t];switch(t){case"preemptive":r=new a.WAConcurrentPreemptiveJobQueue;break;case"bucket":r=new i.WAConcurrentBucketJobQueue;break;case"v2":case"v1":default:r=new o.WADefaultJobNoQueue}return r.init(n,S()),E[t]=r,y=n,r};var i=n(673091),a=n(292882),o=n(184708),s=n(257243),l=n(88555),c=n(603485),u=r(n(652991)),d=r(n(11339));const p={maxConcurrency:1},f="default";function _(){return(0,l.isLegacyWebdBackend)()?f:(0,s.getABPropConfigValue)("web_orchestrator_enabled_version")}function h(){u.default.getCurrentScenario();return d.default.WEBC_SCENARIO_TYPE.IDLE,p}function g(e,t){var n,r,i,a;return e.maxConcurrency!==t.maxConcurrency||((null===(n=e.jobPrioritiesQuota)||void 0===n?void 0:n.size)!==(null===(r=t.jobPrioritiesQuota)||void 0===r?void 0:r.size)||(Object.keys(null!==(i=e.maxConcurrencyPerJob)&&void 0!==i?i:{}).length!==Object.keys(null!==(a=t.maxConcurrencyPerJob)&&void 0!==a?a:{}).length||JSON.stringify(e)!==JSON.stringify(t)))}let m,y=p;function S(){return m||(m=new c.JobStatsLogger),m}const E={}},840774:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobInfoEvent=void 0;n(524674),r(n(11339));t.JobInfoEvent=class{constructor(e,t,n,r){this.jobName=e,this.scenario=r,this.pendingJobsCount=n,this.jobPriority=t}logJobAdded(){this.webcJobAddedT=Date.now()}logJobStarted(){this.webcJobStartedT=Date.now()}logJobCompleted(e){this.webcJobCompletedT=Date.now(),this.jobResultType=e}}},603485:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.JobStatsLogger=void 0;r(n(81109)),n(840774),r(n(652991));var i=r(n(11339));t.JobStatsLogger=class{constructor(){this._jobEventMap=new Map}logJobCreated(e){}logJobStarted(e){}logJobCompleted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.COMPLETED)}logJobError(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ERROR)}logJobTimeout(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.TIMEOUT)}logJobAborted(e){this._logJobFinished(e,i.default.WEBC_JOB_RESULT_TYPE_CODE.ABORTED)}_logJobFinished(e,t){}_maybeCommitJobEvent(e){}}},879274:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NonPersistJob=function(e,t,n){if("function"!=typeof t)throw new Error("NonPersistJob got invalid function param");const a=(0,i.getInstance)((null==n?void 0:n.priority)===r.JOB_PRIORITY.SKIP);return{fireAndForget(){a.enqueue(e,(()=>t.apply(null,arguments)),n)},waitUntilCompleted(){return a.enqueue(e,(()=>t.apply(null,arguments)),n)}}};var r=n(524674),i=n(185509)},947666:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){!function(e,t){Object.keys(t).forEach((n=>{t.hasOwnProperty(n)&&e.addPersistedJobImplementation(n,t[n])}))}(e,{rotateKey:()=>n.e(99).then(n.bind(n,900099)).then((e=>e.default)),setAbout:()=>n.e(6834).then(n.bind(n,276834)).then((e=>e.default)),queryProductList:()=>n.e(1115).then(n.bind(n,711115)).then((e=>e.QueryProductListCatalog)),getPublicKey:()=>n.e(6119).then(n.bind(n,756119)).then((e=>e.QueryGetPublicKey)),getSignedUserInfo:()=>n.e(6637).then(n.bind(n,936637)).then((e=>e.QueryGetSignedUserInfo)),verifyPostcode:()=>n.e(4109).then(n.bind(n,484109)).then((e=>e.VerifyPostcode)),deleteReactions:()=>n.e(375).then(n.bind(n,470375)).then((e=>e.default)),deleteReactionsV2:()=>n.e(6442).then(n.bind(n,516442)).then((e=>e.deleteReactionsV2)),deleteAddOns:()=>n.e(6442).then(n.bind(n,516442)).then((e=>e.deleteAddOns)),sendRequestedKeyShare:()=>n.e(9366).then(n.bind(n,479366)).then((e=>e.default))})}},453168:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobSerializers=void 0;var r=n(492574),i=n(408139);const a={rotateKey:()=>({type:"rotateKey",args:{},uniqKey:"rotateKey"}),setAbout:e=>({type:"setAbout",args:{content:e},uniqKey:"setAbout"}),queryProductList(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if((0,i.commerceFeaturesDisabledBySanctions)())throw new r.E451;return{type:"queryProductList",args:{catalogWid:e.toString(),productIds:t,width:a,height:o,directConnectionEncryptedInfo:n},uniqKey:`queryProductList:${t.slice().sort().join(",")}:${a}:${o}`}},getPublicKey:e=>({type:"getPublicKey",args:{businessJid:e.toString()},uniqKey:`getPublicKey:${e.toString()}`}),getSignedUserInfo:e=>({type:"getSignedUserInfo",args:{businessJid:e.toString()},uniqKey:`getSignedUserInfo:${e.toString()}`}),verifyPostcode:(e,t)=>({type:"verifyPostcode",args:{businessJid:e.toString(),directConnectionEncryptedInfo:t},uniqKey:`verifyPostcode:${e.toString()}:${t}`}),deleteReactions:(e,t)=>({type:"deleteReactions",args:{chatId:e,parentMsgKeys:t},uniqKey:`deleteReactions:${e}`}),deleteReactionsV2:(e,t)=>({type:"deleteReactionsV2",args:{chatId:e,parentMsgKeys:t}}),deleteAddOns:(e,t)=>({type:"deleteAddOns",args:{chatId:e,parentMsgKeys:t}}),sendRequestedKeyShare:(e,t,n)=>({type:"sendRequestedKeyShare",args:{keys:e,orphanKeys:t,peerDeviceId:n.toString()}})};t.jobSerializers=a},203292:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getJobManager=function(){if(null==d)throw new Error("jobs manager has not been initialized");return d},t.maybeCreateJob=_,t.startWebPersistedJobManager=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(787614),o=n(247901),s=n(892844),l=r(n(947666)),c=n(216703),u=n(657267);let d=null;function p(){return(p=(0,i.default)((function*(){yield(0,c.initialize)();const e=(0,u.getTable)();d=new o.PersistedJobManager({accessors:f(),unfinishedJobEntries:e.all(),isRestartAfterCrash:!1,listeners:{onJobStarted:()=>{},onJobFinished:()=>null},deprecatedJobs:{}}),(0,l.default)(d)}))).apply(this,arguments)}function f(){return{deletePersistedJob:e=>(0,u.getTable)().remove(e),updatePersistedJob:e=>(0,u.getTable)().createOrReplace(e),readPersistedJob:e=>(0,u.getTable)().get(e),maybeCreateJob:_}}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){var t,n;const r=(0,u.getTable)(),i=JSON.stringify([e.type,null!==(t=e.uniqKey)&&void 0!==t?t:(0,a.randomHex)(32)]),l={type:e.type,uniqKey:i,startTime:(0,s.unixTime)(),version:null!==(n=e.version)&&void 0!==n?n:1,original:e.args,current:e.args,step:o.UNSTARTED_JOB,waitUntil:null,stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,backedOffCount:0};if(null==e.uniqKey)return r.createOrReplace(l).then((e=>({id:e,newlyCreated:!0})));const c=yield r.equals(["uniqKey"],[e.uniqKey]);if(0===c.length)return r.createOrReplace(l).then((e=>({id:e,newlyCreated:!0})));const d=[];let p=null;for(const e of c)e.step!==o.FINISHED_JOB?p=e:d.push(r.remove(e.jobId));return yield Promise.all(d),null!=p?{id:p.jobId,newlyCreated:!1}:r.createOrReplace(l).then((e=>({id:e,newlyCreated:!0})))}))).apply(this,arguments)}},308998:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroup=function(){return g.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(787614),s=n(831914),l=n(471914),c=n(492574),u=n(696055),d=n(181663),p=n(745454),f=n(346920),_=r(n(11339));const h=new l.WapParser("createGroupReplyParser",(e=>{var t;const n=e.child("group");let r;try{r=(0,p.createWid)(`${n.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=r)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");return{wid:r,subject:n.attrString("subject"),creator:(0,d.userJidToUserWid)(n.attrUserJid("creator")),ts:n.attrTime("creation"),participants:n.mapChildrenWithTag("participant",(e=>{const t=e.maybeChild("add_request");return{wid:(0,d.userJidToUserWid)(e.attrUserJid("jid")),error:e.hasAttr("error")?e.attrInt("error"):null,invite_code:t&&t.attrString("code"),invite_code_exp:t&&t.attrString("expiration"),type:e.attrEnumOrDefault("type",f.GROUP_PARTICIPANT_TYPES,"participant")}}))}}));function g(){return(g=(0,i.default)((function*(e,t,n,r){const i=(0,o.randomHex)(8),l=t.map((e=>(0,s.wap)("participant",{jid:(0,u.USER_JID)(e)})));null!=n&&0!==n&&l.unshift((0,s.wap)("ephemeral",{expiration:(0,s.INT)(n)})),null!=r&&l.unshift((0,s.wap)("linked_parent",{jid:(0,u.GROUP_JID)(r)}));const d=(0,s.wap)("iq",{to:s.G_US,type:"set",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("create",{subject:(0,s.CUSTOM_STRING)(e),key:(0,s.CUSTOM_STRING)(i)},l)),p=yield(0,a.sendIq)(d,h);return p.success?(new _.default.GroupCreateC({}).commit(),p.result):Promise.reject(new c.ServerStatusCodeError(p.errorCode,p.errorText))}))).apply(this,arguments)}},368082:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getGroupMetadataJob=function(e){return(0,o.NonPersistJob)("getGroupMetadata",(e=>(0,a.getGroupMetadata)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupWid:e})},t.getGroupParticipantJob=function(e){return(0,o.NonPersistJob)("getGroupParticipant",(e=>(0,i.getGroupParticipant)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupWid:e})},t.markGroupParticipantStaleJob=function(e){return(0,o.NonPersistJob)("markGroupParticipantStale",(e=>(0,i.markGroupParticipantStale)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e})},t.modifyGroupParticipantJob=function(e,t,n,a,s){return(0,o.NonPersistJob)("modifyGroupParticipant",(e=>(0,i.modifyGroupParticipant)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,oldId:t,newId:n,prevVersion:a,newVersion:s})},t.replaceParticipantsJob=function(e,t,n,a,s){return(0,o.NonPersistJob)("replaceParticipants",(e=>(0,i.replaceParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,admins:n,deviceIds:a,version:s})},t.updateGroupMetadataTableJob=function(e){return(0,o.NonPersistJob)("updateGroupMetadataTable",(e=>(0,a.updateGroupMetadataTable)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})},t.updateGroupParticipantTableWithoutDeviceSyncJob=function(e){return(0,o.NonPersistJob)("updateGroupParticipantTableWithoutDeviceSync",(e=>(0,i.updateGroupParticipantTableWithoutDeviceSync)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({groupInfos:e})};var r=n(524674),i=n(571059),a=n(381321),o=n(879274)},507280:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.leaveGroups=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055),u=n(181663);const d=new s.WapParser("leaveGroupResultParser",(e=>{e.assertAttr("type","result");return{groups:e.child("leave").mapChildren((e=>(0,u.groupJidToWid)(e.attrGroupJid("id"))))}}));function p(){return(p=(0,i.default)((function*(e){const t=e.map((e=>(0,o.wap)("group",{id:(0,c.GROUP_JID)(e)}))),n=(0,o.wap)("iq",{to:o.G_US,type:"set",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("leave",null,t)),r=yield(0,a.sendIq)(n,d);return r.success?r.result:Promise.reject(new l.ServerStatusCodeError(r.errorCode,r.errorText))}))).apply(this,arguments)}},160106:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getProfilePic=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055);const u={preview:"preview",image:"image"},d=new s.WapParser("profilePicParser",(e=>{const t=e.child("picture");return{id:t.attrInt("id"),type:t.attrEnum("type",u),url:t.attrString("url")}}));function p(){return(p=(0,i.default)((function*(e,t){e.isBroadcast()&&(__LOG__(4,!0,new Error,!0)`getProfilePic failed with a broadcast WID type target}`,SEND_LOGS("getProfilePic failed with a broadcast WID type target"));const{preview:n,invite:r,photoId:i,parentGroupId:s}=t;let u,p,f,_=null;null!=s?(u=(0,c.CHAT_JID)(s),p=o.DROP_ATTR,f="w:g2",_=(0,o.wap)("query_linked",{type:e===s?"parent_group":"sub_group",jid:(0,c.CHAT_JID)(e)})):(u=o.S_WHATSAPP_NET,p=(0,c.CHAT_JID)(e),f="w:profile:picture");const h=(0,o.wap)("iq",{to:u,target:p,type:"get",xmlns:f,id:(0,o.generateId)()},(0,o.wap)("picture",{invite:(0,o.MAYBE_CUSTOM_STRING)(r),type:n?"preview":o.DROP_ATTR,id:null!=i?(0,o.INT)(i):o.DROP_ATTR,query:"url"},_)),g=yield(0,a.sendIq)(h,d);if(!g.success)return Promise.reject(new l.ServerStatusCodeError(g.errorCode,g.errorText));const{id:m,url:y,type:S}=g.result;return __LOG__(2)`getProfilePic: ${e.toString()} ${m}, ${S}, ${y}`,{tag:m.toString(),eurl:y,type:S}}))).apply(this,arguments)}},487944:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipantsJob=function(e,t,n,o,s){return(0,i.NonPersistJob)("addParticipants",(e=>(0,a.addParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o,isOffline:s})},t.demoteCommunityParticipantsJob=function(e,t,n){return(0,i.NonPersistJob)("demoteCommunityParticipants",(e=>(0,a.demoteCommmunityParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,isOffline:n})},t.demoteParticipantsJob=function(e,t,n,o,s){return(0,i.NonPersistJob)("demoteParticipants",(e=>(0,a.demoteParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o,isOffline:s})},t.promoteCommunityParticipantsJob=function(e,t,n){return(0,i.NonPersistJob)("promoteCommunityParticipants",(e=>(0,a.promoteCommmunityParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,isOffline:n})},t.promoteParticipantsJob=function(e,t,n,o,s){return(0,i.NonPersistJob)("promoteParticipants",(e=>(0,a.promoteParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,prevVersion:o,isOffline:s})},t.removeParticipantsJob=function(e,t,n,o,s,l,c){return(0,i.NonPersistJob)("removeParticipants",(e=>(0,a.removeParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,timestamp:n,author:o,version:s,prevVersion:l,isOffline:c})},t.updateParticipantsJob=function(e,t,n,o){return(0,i.NonPersistJob)("updateParticipants",(e=>(0,a.updateParticipants)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({group:e,participants:t,version:n,isOffline:o})};var r=n(524674),i=n(879274),a=n(318615)},395486:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryGroupJob=function(e,t,n){return(0,o.NonPersistJob)("queryGroup",function(){var e=(0,i.default)((function*(e){const t=yield(0,l.queryGroup)(e);return t.id&&(yield Promise.all([(0,a.updateGroupMetadataTable)({groupInfos:[t]}),(0,s.updateParticipants)({group:t.id,participants:t.participants,version:t.pvId,isOffline:null})]),(0,c.clearAdminshipCache)(t.id.toString())),t}));return function(){return e.apply(this,arguments)}}()).waitUntilCompleted({groupWid:e,request:t,phash:n})};var i=r(n(348926)),a=n(381321),o=n(879274),s=n(318615),l=n(902182),c=n(543201)},639133:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAllGroups=function(){return f.apply(this,arguments)},t.queryGroupInvite=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(902182),u=n(543201);const d=new s.WapParser("queryGroupParser",(e=>e.hasChild("group")?(0,c.parseGroupNode)(e.child("group")):{phashMatch:!0})),p=new s.WapParser("queryAllGroupParser",(e=>e.child("groups").mapChildren(c.parseGroupNode)));function f(){return(f=(0,i.default)((function*(){const e=(0,o.wap)("iq",{to:o.G_US,type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("participating",null,(0,o.wap)("participants",null),(0,o.wap)("description",null)));(0,u.clearAdminshipCache)();const t=yield(0,a.sendIq)(e,p);return t.success?t.result:(__LOG__(2)`queryAllGroups failed: ${t.errorCode}:${t.errorType}`,Promise.reject(new l.ServerStatusCodeError(t.errorCode,t.errorText)))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.G_US,type:"get",xmlns:"w:g2",id:(0,o.generateId)()},(0,o.wap)("invite",{code:(0,o.CUSTOM_STRING)(e)})),n=yield(0,a.sendIq)(t,d);return n.success?n.result:(__LOG__(2)`queryGroupInvite failed: ${n.errorCode}:${n.errorType}`,Promise.reject(new l.ServerStatusCodeError(n.errorCode,n.errorText)))}))).apply(this,arguments)}},550445:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUnjoinedSubgroupsJob=function(e,t){return(0,i.NonPersistJob)("cleanUnjoinedSubgroups",(e=>(0,a.cleanUnjoinedSubgroups)(e)),{priority:r.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted({unjoinedSubgroupIds:e,parentGroupId:t})},t.updateUnjoinedSubgroupsJob=function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,i.NonPersistJob)("updateUnjoinedSubgroups",(e=>(0,a.updateUnjoinedSubgroups)(e)),{priority:r.JOB_PRIORITY.UI_ACTION}).waitUntilCompleted({unjoinedSubgroups:e,parentGroupId:t,link:n})};var r=n(524674),i=n(879274),a=n(395716)},116382:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.joinGroupViaInviteV4=function(){return h.apply(this,arguments)},t.queryGroupInviteV4=function(){return p.apply(this,arguments)},t.revokeGroupInviteV4=function(){return g.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(736184),s=n(831914),l=n(471914),c=n(181663),u=n(902182);const d=new l.WapParser("queryGroupInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}return e.hasChild("group")?{groupMetadata:(0,u.parseGroupNode)(e.child("group"))}:{phashMatch:!0}}));function p(){return(p=(0,a.default)((function*(e,t,n,r,a){const l=(0,s.wap)("iq",{to:(0,s.JID)(n),type:"get",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("query",{phash:(0,s.MAYBE_CUSTOM_STRING)(a)},(0,s.wap)("add_request",{code:(0,s.CUSTOM_STRING)(e),expiration:(0,s.CUSTOM_STRING)(t),admin:(0,s.CUSTOM_STRING)(r)}))),c=yield(0,o.sendIq)(l,d);if(!c.success)return __LOG__(2)`parsing failed for queryGroupInviteV4: ${JSON.stringify(c)}`,{status:500};const u=c.result,p={status:null!=u.errorCode&&u.errorCode>0?u.errorCode:200};return u.groupMetadata?(0,i.default)((0,i.default)({},p),{},{groupMetadata:u.groupMetadata}):p}))).apply(this,arguments)}const f=new l.WapParser("joinGroupViaInviteV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text"),groupId:(0,c.groupJidToWid)(t.attrGroupJid("from"))}}return{groupId:(0,c.groupJidToWid)(e.attrGroupJid("from"))}})),_=new l.WapParser("revokeGroupV4Parser",(e=>{if(e.hasChild("error")){const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.attrString("text")}}const t=e.child("revoke"),n=[];return t.mapChildrenWithTag("participant",(e=>{e.hasAttr("error")||n.push((0,c.userJidToUserWid)(e.attrUserJid("jid")))})),{revokedUsers:n}}));function h(){return(h=(0,a.default)((function*(e,t,n,r){const i=(0,s.wap)("iq",{to:(0,s.JID)(n),type:"set",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("accept",{code:(0,s.CUSTOM_STRING)(e),expiration:(0,s.CUSTOM_STRING)(t),admin:(0,s.CUSTOM_STRING)(r)})),a=yield(0,o.sendIq)(i,f);if(!a.success)return __LOG__(2)`joinGroupV4Parser: parsing failed ${a.errorCode}:${a.errorType}`,{status:500};const l=a.result;return{status:null!=l.errorCode&&l.errorCode>0?l.errorCode:200,gid:l.groupId}}))).apply(this,arguments)}function g(){return(g=(0,a.default)((function*(e,t){const n=(0,s.wap)("iq",{to:(0,s.JID)(t),type:"set",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("revoke",null,e.map((e=>(0,s.wap)("participant",{jid:(0,s.CUSTOM_STRING)(e)}))))),r=yield(0,o.sendIq)(n,_);if(!r.success)return __LOG__(2)`revokeGroupV4Parser: parsing failed ${r.errorCode}:${r.errorType}`,{status:500};const i=r.result;return{status:null!=i.errorCode&&i.errorCode>0?i.errorCode:200}}))).apply(this,arguments)}},934819:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.digestKey=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(736184),s=n(831914),l=n(471914),c=n(751288),u=n(640623);const d=new l.WapParser("digestResponseParser",(e=>{const t=e.child("digest"),n=t.child("skey");return{regId:t.child("registration").contentUint(4),type:t.child("type").contentUint(1),identity:t.child("identity").contentBytes(32),skey:{id:n.child("id").contentUint(3),pubkey:n.child("value").contentBytes(32),signature:n.child("signature").contentBytes(64)},keys:t.child("list").mapChildren((e=>e.contentUint(3))),hash:t.child("hash").contentBytes(20)}}));function p(){return(p=(0,i.default)((function*(){const e=(0,s.wap)("iq",{xmlns:"encrypt",type:"get",to:s.S_WHATSAPP_NET,id:(0,s.generateId)()},(0,s.wap)("digest",null)),t=yield(0,o.sendIq)(e,d);let n=null;if(t.success)try{yield f(t.result),n=!1}catch(e){n=!1}else{const e=t.errorCode;404===e?(__LOG__(3)`digestKey: no record found for current user`,n=!0):406===e?(__LOG__(3)`digestKey: malformed request`,n=!1):503===e?(__LOG__(3)`digestKey: service unavailable`,n=!1):(__LOG__(3)`digestKey: server error ${e}`,n=!1)}if(null!=n&&n)return __LOG__(2)`digestKey: validate key bundle failed, upload prekeys again`,(0,c.uploadPreKeys)()}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const[t,n]=yield Promise.all([u.waSignalStore.getRegistrationInfo(),u.waSignalStore.getSignedPreKey()]);if(!t||!n)throw new Error("validateLocalKeyBundle: No registration info is available");if(e.regId!==t.registrationId)throw new Error("validateLocalKeyBundle: registation id mismatch");const r=t.identityKeyPair.pubKey,o=n.keyPair.pubKey,s=r.byteLength+o.byteLength+n.signature.byteLength+32*e.keys.length,l=new Uint8Array(s);let c=0;[r,o,n.signature].forEach((e=>{l.set(new Uint8Array(e),c),c+=e.byteLength}));const d=e.keys.map(function(){var e=(0,i.default)((function*(e){const t=yield u.waSignalStore.getPreKeyById(e);if(!t)throw Error(`validateLocalKeyBundle: missing prekey record for id ${e}`);return t.keyPair.pubKey}));return function(){return e.apply(this,arguments)}}());(yield Promise.all(d)).forEach((e=>{l.set(new Uint8Array(e),c),c+=e.byteLength}));const p=yield self.crypto.subtle.digest("SHA-1",l),f=(0,a.encodeB64)(p),_=(0,a.encodeB64)(e.hash);if(f!==_)throw Error(`validateLocalKeyBundle: hash mismatch remote:${_} local:${f}`);__LOG__(2)`validateLocalKeyBundle: success`}))).apply(this,arguments)}},698712:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAndStoreIdentityKeys=function(){return _.apply(this,arguments)},t.getIdentityKeys=h;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(696055),c=n(138062),u=n(181663),d=n(572841),p=r(n(876883));const f=new s.WapParser("identityKeysParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");throw new Error(`identityKeysParser bad response: ${n} ${r}`)}return{type:e.child("type").contentBytes(1),identity:e.child("identity").contentBytes(32),user:(0,u.deviceJidToDeviceWid)(e.attrDeviceJid("jid"))}}))));function _(){return(_=(0,i.default)((function*(e){const t=yield p.default.bulkLoadIdentityKey(e.map((e=>String((0,d.createSignalAddress)(e))))),n=e.filter(((e,n)=>null==t[n]));if(0===n.length)return void __LOG__(2)`getAndStoreIdentityKeys: got 0 missing keys`;__LOG__(2)`getAndStoreIdentityKeys: query ${n.length} missing keys for ${e.length} contacts`;const r=(yield h(n)).map((e=>{const t=e.identity,n=(0,c.toSignalCurvePubKey)(t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset));return{identityKey:(0,d.bufferToStr)(n),identifier:(0,d.createSignalAddress)(e.user).toString()}}));return p.default.bulkCreateIdentity(r)}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=e.map((e=>(0,o.wap)("user",{jid:(0,l.DEVICE_JID)(e)}))),n=(0,o.wap)("iq",{xmlns:"encrypt",type:"get",to:o.S_WHATSAPP_NET,id:(0,o.generateId)()},(0,o.wap)("identity",null,t)),r=yield(0,a.sendIq)(n,f);if(!r.success)throw new Error(`getIdentityKeys bad response ${String(r)}`);return r.result}))).apply(this,arguments)}},466863:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ensureE2ESessions=E,t.ensureE2ESessionsWithDelay=function(e,t){const n=new l.ShiftTimer((()=>{E(e)}));e.forEach((e=>{y.set(String(e),n)})),n.onOrAfter(1e3*t)},t.establishE2ESession=T;var i=r(n(348926)),a=n(736184),o=n(252230),s=n(927870),l=n(657319),c=n(831914),u=n(471914),d=n(492574),p=n(696055),f=n(181663),_=n(408139),h=n(959060),g=n(572841),m=r(n(876883));const y=new Map,S=new s.PromiseQueueMap;function E(e){const t=e.map((e=>e.toString())).join();e.forEach((e=>{const t=y.get(e.toString());t&&(t.cancel(),y.delete(e.toString()))})),__LOG__(2)`ensureE2ESession ${t}`;const n=S.waitIfPending(t);if(n)return __LOG__(2)`ensureE2ESession deduped ${t}`,n;const r=h.Session.hasSignalSessions(e).then(function(){var t=(0,i.default)((function*(t){const n=e.filter(((e,n)=>!t[n]));if(n.length>0){const{depletedPrekeyCount:e}=yield T(n);return{missedPrekeyCount:n.length,depletedPrekeyCount:e}}return{missedPrekeyCount:0,depletedPrekeyCount:0}}));return function(){return t.apply(this,arguments)}}());return S.enqueueHandlers(t,r)}const v=new u.WapParser("e2eSessionParser",(e=>e.child("list").mapChildren((e=>{if(e.hasChild("error")){const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return new Error(`establishE2ESessionParser: list item error: ${n} ${r}`)}const t=e.child("skey"),n=e.hasChild("key")?e.child("key"):null,r=e.hasChild("device-identity")?e.child("device-identity").contentBytes():null;return{wid:(0,f.deviceJidToDeviceWid)(e.attrDeviceJid("jid")),regId:e.child("registration").contentUint(4),identity:e.child("identity").contentBytes(32),deviceIdentity:r,skey:{id:t.child("id").contentUint(3),pubkey:t.child("value").contentBytes(32),signature:t.child("signature").contentBytes(64)},key:n&&{id:n.child("id").contentUint(3),pubkey:n.child("value").contentBytes(32)}}}))));function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;const r=new s.PromiseQueue;let l=0,u=0;const f=e.map((e=>(0,c.wap)("user",{jid:(0,p.DEVICE_JID)(e),reason:t?"identity":c.DROP_ATTR}))),y=(0,c.wap)("iq",{id:(0,c.generateId)(),xmlns:"encrypt",type:"get",to:c.S_WHATSAPP_NET},(0,c.wap)("key",null,f)),S=yield(0,a.sendIq)(y,v);if(!S.success)throw new d.ServerStatusCodeError(S.errorCode,`establishE2ESession: server error: ${S.errorCode} ${S.errorText}`);const E=S.result;if(!E||E.length<=0)throw new Error("establishE2ESession: empty key info");if(r.enqueue((0,i.default)((function*(){const e=[],t=[];if(E.forEach((r=>{r instanceof Error?(__LOG__(3)`establishE2ESession: error: ${r}`,n=r):(null!=r.wid.device&&r.wid.device!==o.DEFAULT_DEVICE_ID?t.push(r):e.push(r),r.key||l++)})),0===e.length&&0===t.length)throw new Error("establishE2ESession: no keys in the response");if((0,_.prekeyFetchCacheWarmingUpEnabled)())try{const n=[...e,...t].map((e=>(0,g.createSignalAddress)(e.wid).toString()));yield m.default.bulkLoadIdentityKey(n),__LOG__(2)`establishE2ESession: warmed up identity cache: ${n.length} records`}catch(e){__LOG__(3)`establishE2ESession: failed to warm up identity cache: ${e}`}const r=e=>h.Session.createSignalSession(e).then((()=>{u++})).catch((t=>{__LOG__(4,void 0,new Error,!0)`createSignalSession: failed for device ${e.wid} with error ${t}`,SEND_LOGS("createSignalSession-fail")}));yield Promise.all(e.map((e=>r(e)))),yield Promise.all(t.map((e=>r(e))))}))).catch((e=>{__LOG__(3)`createSignalSession: error: ${e}`,n=e})),yield r.wait(),null!=n)throw n;return __LOG__(2)`establishE2ESession: successfully established ${u} E2E sessions out of ${e.length} requested`,{depletedPrekeyCount:l}}))).apply(this,arguments)}},751288:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadPreKeys=function(){const e=new o.PromiseRetryLoop({name:"uploadPreKeys",timer:m,code:e=>(0,i.default)((function*(){__LOG__(2)`uploadPreKeys: running`;const t=yield function(){return g.apply(this,arguments)}();!0===(null==t?void 0:t.success)?(__LOG__(2)`uploadPreKeys: done`,e()):__LOG__(2)`uploadPreKeys: retrying (after delay)`}))()});return e.start(),e.promise()};var i=r(n(348926)),a=n(736184),o=n(72287),s=n(831914),l=n(471914),c=r(n(364369)),u=n(640623),d=n(985614),p=n(21377),f=n(964551);const _={error:!1,result:!0},h=new l.WapParser("uploadPreKeyResParser",(e=>{e.assertTag("iq"),e.assertFromServer();if(e.attrEnum("type",_))return{success:!0};const t=e.child("error");return{errorCode:t.attrInt("code"),errorText:t.hasAttr("text")?t.attrString("text"):""}}));function g(){return(g=(0,i.default)((function*(){const e=f.ServerProps.maxKeys,[t,n]=yield Promise.all([u.waSignalStore.getRegistrationInfo(),u.waSignalStore.getSignedPreKey()]);if(!t||!n)throw new Error("No signal info is available");const{registrationId:r,identityKeyPair:i}=t,[o,l]=yield u.waSignalStore.getOrGenPreKeys(e,d.generatePreKeyPair).then((e=>{if(0===e.length)throw new Error("No preKey is available");return[(0,s.wap)("iq",{id:(0,s.generateId)(),xmlns:"encrypt",type:"set",to:s.S_WHATSAPP_NET},(0,s.wap)("registration",null,(0,s.BIG_ENDIAN_CONTENT)(r)),(0,s.wap)("type",null,c.default.KEY_BUNDLE_TYPE),(0,s.wap)("identity",null,i.pubKey),(0,s.wap)("list",null,e.map(p.xmppPreKey)),(0,p.xmppSignedPreKey)(n)),e[e.length-1].keyId]}));try{const t=yield(0,a.waitForConnection)().then((()=>u.waSignalStore.markKeyAsUploaded(l))).then((()=>(0,a.sendIqWithoutRetry)(o,h)));if(t.success)return u.waSignalStore.setServerHasPreKeys(!0),__LOG__(2)`_uploadPreKeys: ${e} keys uploaded, raw stanza size: ${o.toString().length}b`,{success:!0};const n=t.errorCode;return n>=500?__LOG__(3)`_uploadPreKeys: server requested backoff ${n} (count: ${e}, size: ${o.toString().length}b)`:406===n?__LOG__(3)`_uploadPreKeys: uploaded invalid keys (count: ${e}, size: ${o.toString().length}b)`:__LOG__(3)`_uploadPreKeys: unrecognized error ${n} (count: ${e}, size: ${o.toString().length}b)`,{errorCode:t.errorCode,errorText:t.errorText}}catch(t){__LOG__(3)`_uploadPreKeys: disconnected, unclear if on server: ${t} (count: ${e}, size: ${o.toString().length}b)`}}))).apply(this,arguments)}const m={algo:{type:"fibonacci",first:1e3,second:2e3},max:61e4}},520252:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.mapParsedMediaConn=f,t.queryMediaConn=function(e){const t=new Date,n=(0,l.unixTime)(),r=(0,c.wap)("iq",{to:c.S_WHATSAPP_NET,xmlns:"w:m",type:"set",id:(0,c.generateId)()},(0,c.wap)("media_conn",null)),d=(0,a.sendIq)(r,o.mediaConnParser).then((e=>{if(e.success){__LOG__(2)`backend:queryMediaConn: got ${e.result.hosts.length} hosts`;const{auth:r,authTTL:a,ttl:o,hosts:s,maxBuckets:l}=f(e.result);if(!r||null==o||!s||0===s.length)throw __LOG__(2)`backend:queryMediaConnections: auth exists ${String(!!r)}`,__LOG__(2)`backend:queryMediaConnections: ttl exists ${String(!!o)}`,__LOG__(2)`backend:queryMediaConnections: hosts exists ${String(!!s)}`,s&&__LOG__(2)`backend:queryMediaConnections: hosts.length ${s.length}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("backend:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");return(0,i.default)({queryStartTime:t,auth:r,hosts:s,ttl:o-n,maxBuckets:l},null!=a?{authTTL:a-n}:null)}if(__LOG__(4,void 0,new Error,!0)`response: ${e.errorCode} ${e.errorText}`,SEND_LOGS("backend:queryMediaConn: fail"),507===e.errorCode)throw new u.E507(e.errorText,e.errorBackoff);throw new u.ServerStatusCodeError(e.errorCode,e.errorText)}));return(0,s.default)(d,e)};var i=r(n(81109)),a=n(736184),o=n(31224),s=r(n(747259)),l=n(892844),c=n(831914),u=n(492574);function d(e){switch(e){case"kyc-id":case"novi-image":case"novi-video":case"thumbnail-gif":case"ppic":case"xma-image":return null;default:return e}}function p(e){return{hostname:e.domain,class:e.class,ips:[{ip4:e.ip4,ip6:e.ip6}]}}function f(e){var t,n;const r=e=>{const t=[],n=e.downloadable.map(d).filter(Boolean);n.length>0&&t.push({download:n});const r=e.uploadable.map(d).filter(Boolean);r.length>0&&t.push({upload:r});const i=e.downloadBuckets.map((e=>e.toString()));return null!=i&&i.length>0&&t.push({downloadBuckets:i}),t};return{hosts:e.hosts.map((e=>(0,i.default)((0,i.default)({},p(e)),{},{fallback:null!=e.fallback?p(e.fallback):void 0,type:e.isFallback?"fallback":"primary",rules:r(e)}))),auth:e.authToken,authTTL:null!==(t=e.authTTL)&&void 0!==t?t:void 0,ttl:e.authExpires,maxBuckets:null!==(n=e.maxBuckets)&&void 0!==n?n:void 0}}},987168:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterDecryption=function(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;if((0,s.isLegacyWebdBackend)())return Promise.resolve();const o=y(),l=(0,p.assertGetMe)(),c=!l.getDeviceId(),d=t.isUser()&&(0,f.toUserWid)(l).equals((0,f.toUserWid)(t))||null!=r&&(0,f.toUserWid)(l).equals((0,f.toUserWid)(r)),_=a===h.MSG_TYPES.reaction&&!d,S=!_&&((0,u.sendOnlyActiveReceiptsEnabled)()||d||o||c);let E=Promise.resolve();if(!S){const n={msgId:e,chatId:t.toString(),participantId:r?r.toString():null};E=(0,g.getInactiveReceiptTable)().createOrReplace(n)}return E.then((()=>{if(m(e,t,n,r,S,d,i),S)return(0,g.getInactiveReceiptTable)().remove(e)}))},t.sendDeliveryReceiptsAfterPresence=function(){if((0,s.isLegacyWebdBackend)())return Promise.resolve();return(0,g.getInactiveReceiptTable)().all().then(function(){var e=(0,i.default)((function*(e){const t=new Map,n=Date.now().toString();return e.forEach((e=>{const{msgId:n,chatId:r,participantId:i}=e,a=(0,f.createWid)(r),o=(i?(0,f.createWid)(i):null)||a;let s=t.get(a);s||(s=new Map,t.set(a,s));let l=s.get(o);l||(l=[],s.set(o,l)),l.push(n)})),yield Promise.all(Array.from(t.keys()).map((e=>{const r=t.get(e);if(r)return(0,d.sendAggregateReceipts)(e,d.RECEIPT_TYPE.DELIVERY,n,r)}))),(0,g.getInactiveReceiptTable)().bulkRemove(e.map((e=>e.msgId)))}));return function(){return e.apply(this,arguments)}}())};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(88555),l=n(696055),c=n(272441),u=n(408139),d=n(310656),p=n(978820),f=n(745454),_=n(79196),h=n(312037),g=n(776214);function m(e,t,n,r,i,s,u){let p=o.DROP_ATTR;u?p=(0,o.CUSTOM_STRING)(d.RECEIPT_TYPE.PEER_MSG):s?p=(0,o.CUSTOM_STRING)(d.RECEIPT_TYPE.SENDER):i||(p=(0,o.CUSTOM_STRING)(d.RECEIPT_TYPE.INACTIVE));const f=(0,c.extractJidFromJidWithType)((0,_.widToJidWithType)(t)),h=(0,o.wap)("receipt",{id:(0,o.CUSTOM_STRING)(e),to:(0,o.JID)(f),participant:(t.isGroup()||t.isBroadcast())&&r?(0,l.DEVICE_JID)(r):o.DROP_ATTR,recipient:!u&&s&&n?(0,l.USER_JID)(n):o.DROP_ATTR,type:p});(0,a.castStanza)(h)}function y(){return n(608080).Stream.available}},355504:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(736184),s=n(831914),l=n(22469),c=n(696055),u=n(379923);function d(){return(d=(0,i.default)((function*(e,t,n){const r=(0,a.decodeB64)(n),{ciphertext:i,iv:d}=yield(0,u.encryptServerErrorReceipt)(r,t),p=(0,s.wap)("receipt",{type:"server-error",to:(0,c.USER_JID)(e),id:(0,s.CUSTOM_STRING)(t),category:"peer"},(0,s.wap)("encrypt",null,(0,s.wap)("enc_p",null,i),(0,s.wap)("enc_iv",null,d)));return(0,o.sendStanzaAndWaitForAck)(p,(0,l.toCoreAckTemplate)({id:t,class:"receipt",type:"server-error",from:e,participant:null}))}))).apply(this,arguments)}},510749:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAggregateOfflineReceipts=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(892844),s=n(310656),l=n(93771);function c(){return(c=(0,i.default)((function*(e){const t=new Map,n=[];e.forEach((e=>{const r=e.msg,i=e.receiptInfo;if(!i)return;const a=i.externalId||(null==r?void 0:r.id.id);if(!a)return;const{from:o,author:s}=i;let l=t.get(o);l||(l=new Map,t.set(o,l));let c=l.get(s);c||(c=[],l.set(s,c)),c.push(a),n.push({from:String(o),author:String(s),externalId:a})}));const r=String((0,o.unixTime)());Promise.all(Array.from(t.keys()).map((e=>{const n=t.get(e);if(n)return(0,s.sendAggregateReceipts)(e,s.RECEIPT_TYPE.DELIVERY,r,n)}))),(0,a.cancelDeadSocketTimer)(),yield(0,l.getTable)().createOrReplace({receipts:n})}))).apply(this,arguments)}},348918:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getReadReceiptType=E,t.markChatRead=function(){return v.apply(this,arguments)},t.markStatusRead=function(){return T.apply(this,arguments)},t.sendReactionReadReceipts=function(){return C.apply(this,arguments)};var i=r(n(348926)),a=n(252230),o=r(n(145095)),s=n(892844),l=n(535470),c=n(276167),u=r(n(465212)),d=n(115461),p=n(468387),f=n(867811),_=n(310656),h=n(555452),g=n(745454),m=n(448285),y=n(290981);const S=(0,g.createWid)(a.STATUS_JID);function E(e,t){return e.isStatusV3()&&null!=t&&t.isPSA()?_.RECEIPT_TYPE.READ_SELF:e.isGroup()?_.RECEIPT_TYPE.READ:(0,h.getUserPrivacySettings)().readReceipts===p.ALL_NONE.none?_.RECEIPT_TYPE.READ_SELF:_.RECEIPT_TYPE.READ}function v(){return(v=(0,i.default)((function*(e,t){const n=Date.now().toString(),r=String(e.id),i=yield(0,y.getTable)().equals(["from","pendingReadReceipt"],[r,1],{shouldDecrypt:!1});i.sort(((e,t)=>(e.rowId||0)-(t.rowId||0)));const a=t?String(t):null;let o=i.length-1;if(a){for(;o>=0&&i[o].id!==a;o--);o<0&&(o=i.length-1)}let s=null;const l=[];for(;o>=0;o--){const e=i[o];null!=e.rowId&&(null==s||e.rowId>s)&&(s=e.rowId);const t=u.default.fromString(e.id);if(e.type===d.MSG_TYPE.CIPHERTEXT){(0,c.viewPlaceHolderAction)(e);continue}e.type===d.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype&&(0,c.viewPlaceHolderAction)(e);const n=e.broadcastId||e.from,r=e.author||e.from;l.push({id:t.id,sender:(0,g.createWidFromWidLike)(r),chat:(0,g.createWidFromWidLike)(n)})}const p=A(l);return yield Promise.all(Array.from(p.keys()).map((t=>{const r=p.get(t);if(!r)return;const i=E(e.id);return(0,_.sendAggregateReceipts)(t,i,n,r)}))),(0,m.markMessageAndChatAsRead)(s,r,!1)}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if("status"!==e.remote.user)return void __LOG__(3)`markStatusRead: message is not a status.`;if(e.fromMe)return;yield(0,_.sendAggregateReceipts)(S,E(S,(0,o.default)(e.participant,"msgKey.participant")),String(t),new Map([[(0,o.default)(e.participant,"msgKey.participant"),[e.id]]]));const n={ack:l.ACK.READ};e.participant&&e.participant.isPSA()&&(n.statusPSAReadTimestamp=t),yield(0,y.getTable)().merge(e.toString(),n)}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){const t=String((0,s.unixTime)()),n=A(e.filter((e=>!(0,f.isReactionByMe)(e.senderUserJid))).map((e=>({chat:e.msgKey.remote,sender:(0,g.createWidFromWidLike)(e.senderUserJid),id:e.msgKey.id}))));yield Promise.all(Array.from(n.keys()).map((e=>{const r=n.get(e);if(r)return(0,_.sendAggregateReceipts)(e,_.RECEIPT_TYPE.READ_SELF,t,r)})))}))).apply(this,arguments)}function A(e){const t=new Map;return e.forEach((e=>{var n,r;let{chat:i,sender:a,id:o}=e;const s=null!==(n=t.get(i))&&void 0!==n?n:new Map,l=null!==(r=s.get(a))&&void 0!==r?r:[];l.push(o),s.set(a,l),t.set(i,s)})),t}},310656:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RECEIPT_TYPE=t.RECEIPT_MSG_TYPE=void 0,t.sendAggregateReceipts=function(){return g.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(736184),s=n(831914),l=n(471914),c=n(22469),u=n(696055),d=n(468387),p=n(555452);const f=Object.freeze({INACTIVE:"inactive",SENDER:"sender",DELIVERY:"delivery",READ:"read",READ_SELF:"read-self",PLAYED:"played",PLAYED_SELF:"played-self",HISTORY_SYNC_COMPLETION:"hist_sync",SERVER_ERROR:"server-error",PEER_MSG:"peer_msg"});t.RECEIPT_TYPE=f;const _=Object.freeze({PEER:"peer"});t.RECEIPT_MSG_TYPE=_;const h=new l.WapParser("readReceiptAckParser",(e=>(e.assertTag("ack"),{readReceipts:e.hasAttr("readreceipts")?e.attrEnum("readreceipts",d.ALL_NONE):null})));function g(){return(g=(0,a.default)((function*(e,t,n,r,l,d){const _=t===f.READ||t===f.PLAYED||t===f.READ_SELF||t===f.PLAYED_SELF||t===f.HISTORY_SYNC_COMPLETION;yield Promise.all(Array.from(r.keys()).map((g=>{const m=r.get(g);if(!m||0===m.length)return;const y=e.isUser()?null:g,S=[];for(;m.length>0;){const r=m.splice(0,256);let g=null;r.length>1&&(g=(0,s.wap)("list",null,r.slice(1).map((e=>(0,s.wap)("item",{id:(0,s.CUSTOM_STRING)(e)})))));const E=(0,s.wap)("receipt",{to:(0,u.JID)(e),type:t===f.DELIVERY?s.DROP_ATTR:(0,s.CUSTOM_STRING)(t),msgtype:d?(0,s.CUSTOM_STRING)(d):s.DROP_ATTR,id:(0,s.CUSTOM_STRING)(r[0]),t:null!=n?(0,s.CUSTOM_STRING)(n):s.DROP_ATTR,participant:y?(0,u.DEVICE_JID)(y):s.DROP_ATTR,recipient:l?(0,u.USER_JID)(l):s.DROP_ATTR},g);if(_){const n=function(){var n=(0,a.default)((function*(){const n={id:r[0],from:e,class:"receipt",type:t,participant:y};if(t!==f.READ&&t!==f.READ_SELF)return(0,o.sendStanzaAndWaitForAck)(E,(0,c.toCoreAckTemplate)(n));{const e=yield(0,o.sendStanzaAndReturnAck)(E,(0,c.toCoreAckTemplate)(n)),t=h.parse(e);if(t.error)__LOG__(4,void 0,new Error,!0)`[messaging] sendAggregateReceipts: Invalid ack from server`,SEND_LOGS("Invalid-Receipt-Ack");else{const{readReceipts:e}=t.success;null!=e&&(0,p.setUserPrivacySettings)((0,i.default)((0,i.default)({},(0,p.getUserPrivacySettings)()),{},{readReceipts:e}))}}}));return function(){return n.apply(this,arguments)}}();S.push(n())}else S.push((0,o.castStanza)(E))}return Promise.all(S)})))}))).apply(this,arguments)}},796109:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareKeysForRetry=S,t.sendRetryReceipt=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(22469),l=n(696055),c=r(n(364369)),u=n(138062),d=n(978820),p=n(745454),f=n(946308),_=n(640623),h=n(985614),g=n(454753),m=n(21377);function y(){return(y=(0,i.default)((function*(e,t,n,r,i,c){let f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{const _=(0,g.getSignalProtocolStore)(),[h,m]=yield Promise.all([_.getLocalRegistrationId(),_.getIdentityKeyPair()]);if(null==h||null==m)throw new Error("No registration info found");const y=yield S(e,(0,u.toCurveKeyPair)(m));let E,v,T=o.DROP_ATTR,C=o.DROP_ATTR;if(t.isUser()){if(v=o.DROP_ATTR,E=(0,l.DEVICE_JID)(t),(0,d.getMeUser)().equals((0,p.toUserWid)(t)))if(f)T=(0,o.CUSTOM_STRING)("peer"),C=o.DROP_ATTR;else{if(!r)return Promise.reject(new Error("sendRetryReceipt: send retry to peer device without receipient"));C=(0,l.USER_JID)(r)}}else E=(0,l.CHAT_JID)(t),v=n?(0,l.DEVICE_JID)(n):o.DROP_ATTR;const A=(0,o.wap)("receipt",{id:(0,o.CUSTOM_STRING)(i),to:E,participant:v,recipient:C,type:"retry",category:T},(0,o.wap)("retry",{v:"1",count:(0,o.INT)(e),id:(0,o.CUSTOM_STRING)(i),t:(0,o.CUSTOM_STRING)(c)}),(0,o.wap)("registration",null,(0,o.BIG_ENDIAN_CONTENT)(h)),y);return(0,a.sendStanzaAndWaitForAck)(A,(0,s.toCoreAckTemplate)({id:i,class:"receipt",from:t,participant:n,type:"retry"}))}catch(e){__LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("sendRetryReceipt: error while creating or sending the retry message")}}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t){const[n,r]=yield v(e,t);return r&&(yield _.waSignalStore.markKeyAsUploaded(r.keyId),yield _.waSignalStore.markPreKeyAsDirectDistribution(r.keyId)),n}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){if(e<2)return Promise.resolve([null,null]);try{const[e,n,r]=yield Promise.all([_.waSignalStore.getSignedPreKey(),_.waSignalStore.getOrGenSinglePreKey(h.generatePreKeyPair),(0,f.getADVEncodedIdentity)().then((e=>(0,o.wap)("device-identity",null,e)))]);if(!e)throw new Error("Signed pre key is not available");return[(0,o.wap)("keys",null,(0,o.wap)("type",null,c.default.KEY_BUNDLE_TYPE),(0,o.wap)("identity",null,t.pubKey),(0,m.xmppPreKey)(n),(0,m.xmppSignedPreKey)(e),r),n]}catch(e){throw Error("Could not create keys section for retry")}}))).apply(this,arguments)}},800976:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(736184),s=n(831914),l=n(22469),c=n(696055),u=n(379923),d=n(978820);function p(){return(p=(0,i.default)((function*(e){const t=e.id.id,n=(0,a.decodeB64)(e.mediaKey),{ciphertext:r,iv:i}=yield(0,u.encryptServerErrorReceipt)(n,t),{chat:p}=e,f=(0,s.CUSTOM_STRING)(p.id.toString({legacy:!0})),_=p.isGroup||p.isBroadcast?(0,s.CUSTOM_STRING)(e.sender.toString({legacy:!0})):s.DROP_ATTR,h=(0,d.getMeUser)(),g=(0,s.wap)("receipt",{type:"server-error",to:(0,c.USER_JID)(h),id:(0,s.CUSTOM_STRING)(t)},(0,s.wap)("encrypt",null,(0,s.wap)("enc_p",null,r),(0,s.wap)("enc_iv",null,i)),(0,s.wap)("rmr",{jid:f,from_me:(0,s.CUSTOM_STRING)(String(e.isSentByMe)),participant:_}));return(0,o.sendStanzaAndWaitForAck)(g,(0,l.toCoreAckTemplate)({id:t,class:"receipt",type:"server-error",from:h,participant:null}))}))).apply(this,arguments)}},293350:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptMsgProtobuf=function(){return d.apply(this,arguments)},t.encryptMsgSenderKey=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(824214),o=n(760210),s=n(276802),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(959060)),c=r(n(11339));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(){return(d=(0,i.default)((function*(e,t,n){const r=(0,o.mediaTypeFromProtobuf)(n),i=new c.default.E2eMessageSend({e2eSuccessful:!0,e2eCiphertextVersion:o.CIPHERTEXT_VERSION,e2eDestination:(0,o.getMetricE2eDestination)(e),messageMediaType:r?(0,o.metricsMediaType)(r):c.default.MEDIA_TYPE.NONE,retryCount:t});try{const{type:t,ciphertext:r}=yield l.Cipher.encryptSignalProto(e,(0,s.encodeAndPad)(n));return i.e2eCiphertextType=(0,o.getMetricE2eCiphertextType)(t),{type:t,ciphertext:r}}catch(t){return i.e2eSuccessful=!1,i.weight=1,__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgProtobuf: encryption fail for ${e.toString()}, ${t}`))}finally{i.commit()}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,n){const r=new c.default.E2eMessageSend({e2eSuccessful:!0,e2eCiphertextType:(0,o.getMetricE2eCiphertextType)(a.CiphertextType.Skmsg),e2eCiphertextVersion:o.CIPHERTEXT_VERSION,e2eDestination:c.default.E2E_DESTINATION.GROUP,messageMediaType:n?(0,o.metricsMediaType)(n):c.default.MEDIA_TYPE.NONE,retryCount:0});try{return yield l.Cipher.encryptSenderKeyMsgSignalProto(e,t)}catch(t){return r.e2eSuccessful=!1,r.weight=1,__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`,Promise.reject(new Error(`[messaging] encryptMsgSenderKey: encryption fail for ${e.toString()}, ${t}`))}finally{r.commit()}}))).apply(this,arguments)}},682514:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyMsg=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(22469),s=n(615947),l=r(n(355184)),c=n(768470);function u(){return(u=(0,i.default)((function*(e){yield(0,l.default)(),__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendKeyMsg: sending ${e.id.toString()}`;const t=e.to,n=(0,s.createMsgProtobuf)(e),r=yield(0,c.createUserDeviceMsgStanza)(t,null,e,n,{type:c.MsgType.AppStateSync});return(0,a.sendStanzaAndWaitForAck)(r,(0,o.toCoreAckTemplate)({id:e.id.id,class:"message",from:t,participant:null}))}))).apply(this,arguments)}},768470:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgType=void 0,t.createGroupDeviceMsgStanza=function(){return v.apply(this,arguments)},t.createUserDeviceMsgStanza=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=n(831914),o=n(824214),s=n(760210),l=n(696055),c=n(615947),u=n(985947),d=n(293350),p=n(466863),f=n(978820),_=n(745454),h=n(946308),g=n(276802),m=n(454753),y=r(n(441143));const S=n(76672).Mirrored(["Retry","AppStateSync"]);function E(){return(E=(0,i.default)((function*(e,t,n,r,i){let a=r;return yield(0,p.ensureE2ESessions)([e]),(0,f.isMeAccount)(e)&&i.type!==S.AppStateSync?((0,y.default)(null!=t,"[messaging] createDeviceMsgStanza: no recipient for peer device message"),a=(0,c.createDeviceSentMessage)(r,t),yield(0,g.populateICDCMeta)((0,_.toUserWid)(t),a)):yield(0,g.populateICDCMeta)((0,_.toUserWid)(e),a),T(e,null,t,n,a,i)}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,n,r,i){if(yield(0,p.ensureE2ESessions)([t]),i.type===S.AppStateSync)return Promise.reject(new Error("[messaging] createGroupDeviceMsgStanza: not expect for App State Sync message"));const a=(0,f.isMeAccount)(t)?(0,c.createDeviceSentMessage)(r,e):r;return yield(0,g.populateICDCMeta)((0,_.toUserWid)(t),a),T(e,t,null,n,a,i)}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t,n,r,i,c){var p;const f=t||e,_=null!==(p=c.retryCount)&&void 0!==p?p:0,y=(0,s.mediaTypeFromProtobuf)(i),E=r.id,{type:v,ciphertext:T}=yield(0,d.encryptMsgProtobuf)(f,_,i);let C=null;if(v===o.CiphertextType.Pkmsg){const e=yield(0,h.getADVEncodedIdentity)();C=(0,a.wap)("device-identity",null,e)}c.type!==S.Retry&&(yield(0,g.updateIdentityRange)(E,[f])),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const A=(0,u.pollTypeAttributeFromProtobuf)(i),b=null==A?null:(0,a.wap)("meta",{polltype:A});return(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(E.id),to:(0,l.JID)(e),participant:t?(0,l.DEVICE_JID)(t):a.DROP_ATTR,recipient:n?(0,l.USER_JID)(n):a.DROP_ATTR,type:(0,u.typeAttributeFromProtobuf)(i),edit:(0,g.editAttribute)(i,r.subtype),category:c.type===S.AppStateSync?(0,a.CUSTOM_STRING)("peer"):a.DROP_ATTR,push_priority:c.type===S.AppStateSync?(0,a.CUSTOM_STRING)("high"):a.DROP_ATTR},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(v),count:0===_?a.DROP_ATTR:(0,a.INT)(_),mediatype:(0,s.encodeMaybeMediaType)(y),"decrypt-fail":(0,s.encodeMaybeDecryptFail)((0,u.decryptFailAttributeFromProtobuf)(i))},T),C,b)}))).apply(this,arguments)}t.MsgType=S},326892:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.FANOUT_TYPE=void 0,t.createFanoutMsgStanza=function(){return b.apply(this,arguments)};var i=r(n(348926)),a=n(831914),o=n(824214),s=n(760210),l=n(696055),c=n(615947),u=n(985947),d=n(293350),p=n(466863),f=n(978820),_=n(745454),h=n(946308),g=n(276802),m=n(454753),y=n(820017),S=r(n(11339)),E=n(719380),v=n(847124);const T=Object.freeze({CHAT:"chat",GROUP_DIRECT:"groupDirect"});function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,r){const p=(0,s.mediaTypeFromProtobuf)(n),h=(0,s.nativeFlowNameTypeFromProtobuf)(n);if(r.fanoutType===T.CHAT&&1===t.length&&(0,g.isPrimaryDevice)(t[0])){const{type:e,ciphertext:r}=yield(0,d.encryptMsgProtobuf)(t[0],0,n);return{shouldHaveIdentity:e===o.CiphertextType.Pkmsg,body:(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,s.encodeMaybeMediaType)(p),"decrypt-fail":(0,s.encodeMaybeDecryptFail)((0,u.decryptFailAttributeFromProtobuf)(n)),native_flow_name:(0,s.encodeMaybeNativeFlowName)(h)},r)}}let m=!1;const y=t.map(function(){var t=(0,i.default)((function*(t){const i=(0,f.isMeAccount)(t)?(0,c.createDeviceSentMessage)(n,e):n,y=r.fanoutType===T.GROUP_DIRECT?(0,_.toUserWid)(t):(0,_.toUserWid)(e);yield(0,g.populateICDCMeta)(y,i);try{const{type:e,ciphertext:r}=yield(0,d.encryptMsgProtobuf)(t,0,i);return e===o.CiphertextType.Pkmsg&&(m=!0),(0,a.wap)("to",{jid:(0,l.DEVICE_JID)(t)},(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(e),mediatype:(0,s.encodeMaybeMediaType)(p),"decrypt-fail":(0,s.encodeMaybeDecryptFail)((0,u.decryptFailAttributeFromProtobuf)(n)),native_flow_name:(0,s.encodeMaybeNativeFlowName)(h)},r))}catch(e){return __LOG__(3)`encryptAndSendUserMsg: encryption fail for ${String(t)}: ${e}`,(0,g.isPrimaryDevice)(t)&&(__LOG__(4,void 0,new Error,!0,["messaging"])`encryptAndSendUserMsg: encryption fail for primary device ${String(t)}`,SEND_LOGS("encryption-fail-for-primary-device")),null}}));return function(){return t.apply(this,arguments)}}()),S=(yield Promise.all(y)).filter((e=>null!=e));return S.length>0?{body:(0,a.wap)("participants",null,S),shouldHaveIdentity:m}:Promise.reject(new Error("[messaging] encryptAndSendUserMsg: encryption fail for all devices"))}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,n,r){var i,c;const d=e.to;try{var f,_;null===(f=e.wamMessageSendPerfReporter)||void 0===f||f.startPrekeysFetchStage();const t=yield(0,p.ensureE2ESessions)(n),i=null==t?void 0:t.missedPrekeyCount;var A;if(null!=i)null===(A=e.wamMessageSendPerfReporter)||void 0===A||A.setFetchedPrekeyCount(i);null===(_=e.wamMessageSendPerfReporter)||void 0===_||_.postPrekeysFetchStage(),(0,y.maybePostPrekeysDepletionMetric)({count:null==t?void 0:t.depletedPrekeyCount,prekeysFetchReason:S.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:r.fanoutType===T.CHAT?S.default.MESSAGE_TYPE.INDIVIDUAL:S.default.MESSAGE_TYPE.GROUP,chatId:d})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const b=e.id;let P=n;r.isResendingMsg&&(P=yield(0,g.filterDeviceWithChangedIdentity)(b,n));const O=P.map((e=>({msgKey:b,receiverId:e})));yield(0,v.createOrMergeReceiptRecords)(O),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startClientEncryptStage();const M=yield C(d,P,t,r);null===(c=e.wamMessageSendPerfReporter)||void 0===c||c.postClientEncryptStage();let I=null;if(r.fanoutType===T.GROUP_DIRECT){const e=(0,s.mediaTypeFromProtobuf)(t);I=(0,a.wap)("enc",{v:(0,a.CUSTOM_STRING)(s.CIPHERTEXT_VERSION.toString()),type:(0,a.CUSTOM_STRING)(o.CiphertextType.Skmsg),mediatype:(0,s.encodeMaybeMediaType)(e)})}let w=null;if(M.shouldHaveIdentity){const e=yield(0,h.getADVEncodedIdentity)();w=(0,a.wap)("device-identity",null,e)}const R=(0,u.getBizNativeFlowName)(t);let N;const L=E.ContactCollection.get(d),D=null==L?void 0:L.privacyMode;let k;null!=D&&(N=(0,a.wap)("biz",{host_storage:(0,a.INT)(D.hostStorage),actual_actors:(0,a.INT)(D.actualActors),privacy_mode_ts:(0,a.INT)(D.privacyModeTs),native_flow_name:(0,a.MAYBE_CUSTOM_STRING)(R)})),d.isLid()&&!(null==L?void 0:L.selfPnExposed)&&null!=(null==L?void 0:L.phoneJid)&&(k=L.phoneJid),null==N&&null!=R&&(N=(0,a.wap)("biz",{native_flow_name:(0,a.CUSTOM_STRING)(R)})),r.isResendingMsg||(yield(0,g.updateIdentityRange)(b,P)),yield(0,m.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const U=(0,u.pollTypeAttributeFromProtobuf)(t),G=null==U?null:(0,a.wap)("meta",{polltype:U}),{id:x}=b;return(0,a.wap)("message",{id:(0,a.CUSTOM_STRING)(x),to:(0,l.CHAT_JID)(d),type:(0,u.typeAttributeFromProtobuf)(t),edit:(0,g.editAttribute)(t,e.subtype),device_fanout:r.isResendingMsg?(0,a.CUSTOM_STRING)("false"):a.DROP_ATTR,recipient_pn:k?(0,l.USER_JID)(k):a.DROP_ATTR},M.body,I,w,N,G)}))).apply(this,arguments)}t.FANOUT_TYPE=T},925080:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendKeyDistributionMsg=function(e){if(!e.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!e.remote)return Promise.reject(new Error("[messaging] sending message without an remote id"));if(e.remote.isGroup()){const t=new p.MessageSendPerfReporter(e.remote,f.default.MEDIA_TYPE.NONE,f.default.MESSAGE_TYPE.GROUP);return t.setMessageIsInvisible(!0),(0,l.encryptAndSendGroupKeyDistributionMsg)(e).then((()=>{t.postWrittenWireStage()}))}return Promise.reject(new Error("[messaging] unsupported remote jid type"))},t.encryptAndSendMsg=function(e){const t=e.id,n=e.to;if(!t||!t.id)return Promise.reject(new Error("[messaging] sending message without an id"));if(!n)return Promise.reject(new Error("[messaging] sending message without an remote id"));(0,a.isMDBackend)()&&e.type===s.MSG_TYPE.STICKER&&null==e.deprecatedMms3Url&&(e.deprecatedMms3Url=_);let r;if(e.asMms){const t=e.isUnsentPhoneMsg();r=t?{type:e.type}:e.avParams(),(0,a.isMDBackend)()&&e.type===s.MSG_TYPE.STICKER&&!t&&null==r.url&&(r.url=_)}const l=(0,o.createMsgProtobuf)(e,r||{});if(n.isUser()){const t=(0,d.encryptAndSendUserMsg)(e,l);return(0,a.isMDBackend)()&&(0,i.getABPropConfigValue)("trusted_contacts_sender")&&(0,u.sendTcToken)(n),t}if(n.isGroup())return(0,c.encryptAndSendGroupMsg)(e,l);return Promise.reject(new Error("[messaging] unsupported remote jid type"))};var i=n(257243),a=n(88555),o=n(615947),s=n(115461),l=n(635855),c=n(677020),u=n(289488),d=n(734802),p=n(751708),f=r(n(11339));const _="https://web.whatsapp.net"},420993:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgQueueMap=void 0;const r=new(n(927870).PromiseQueueMap);t.sendMsgQueueMap=r},366590:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendRetry=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(22469),s=n(615947),l=n(768470),c=r(n(441143));function u(){return(u=(0,i.default)((function*(e,t,n,r,i){const u=r.id.id;let d;__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: id ${u} to ${e.toString()}, requester: ${(t||e).toString()}, count: ${i}`,r.asMms&&(d=r.isUnsentPhoneMsg()?{type:r.type}:r.avParams());const p=(0,s.createMsgProtobuf)(r,d||{}),f={type:l.MsgType.Retry,retryCount:i};let _;return e.isUser()?_=yield(0,l.createUserDeviceMsgStanza)(e,n,r,p,f):((0,c.default)(null!=t,"[messaging] sendRetry: no participant for group retry message"),_=yield(0,l.createGroupDeviceMsgStanza)(e,t,r,p,f)),__LOG__(2,void 0,void 0,void 0,["messaging"])`sendRetry: sending ${u} to ${e.toString()}`,(0,a.sendStanzaAndWaitForAck)(_,(0,o.toCoreAckTemplate)({id:u,class:"message",from:e,participant:t}))}))).apply(this,arguments)}},734802:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendUserMsg=function(){return g.apply(this,arguments)};var i=r(n(348926)),a=r(n(170735)),o=n(736184),s=n(40234),l=n(22469),c=n(963388),u=n(326892),d=n(550111),p=n(978820),f=n(276802),_=n(184746),h=r(n(11339));function g(){return(g=(0,i.default)((function*(e,t){var n;const{id:r,to:i}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: sending ${r}`;const a=i.isLid()&&null!==(n=(0,p.getMaybeMeLid)())&&void 0!==n?n:(0,p.assertGetMe)(),o=yield(0,c.getFanOutList)({wids:[i,a]}),l=yield S(e,t,o,{fanoutType:u.FANOUT_TYPE.CHAT}),{phash:_}=l;if(_){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: phash mismatch, got server phash ${_}`;const n=s.Clock.globalUnixTime();new h.default.MdDeviceSyncAck({chatType:h.default.MESSAGE_CHAT_TYPE.INDIVIDUAL,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,d.syncDeviceListJob)([i,a],"message",_).then((()=>m(e,t,o,n)))}return l}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,n,r){const{id:i,to:o}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending ${i.id}`;const l=(0,f.createMessageResendMetric)(e,(0,f.isRevokeMsg)(t));if(s.Clock.globalUnixTime()-r>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending due to 5 min timeout`,l.messageSendResult=h.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void l.commit();try{var g;const r=o.isLid()&&null!==(g=(0,p.getMaybeMeLid)())&&void 0!==g?g:(0,p.assertGetMe)(),i=yield(0,c.getFanOutList)({wids:[o,r]}),s=(0,a.default)(i,n,String);if(0===s.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip sending to the empty list`,l.messageSendResult=h.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void l.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resending to devices ${s.join(",")}`;const{phash:f}=yield S(e,t,s,{fanoutType:u.FANOUT_TYPE.CHAT,isResendingMsg:!0});f&&(0,d.syncDeviceListJob)([o,r],"message",f)}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: resend got error ${e} `,l.messageSendResult=h.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,l.commit(),e}(0,_.logSuccessfulMessageSend)(l),(0,_.logMessageSendForChatThreadLogging)(e)}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e,t,n,r){var i,a,s,c;null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startReadyToSendStage();const{id:d,to:p}=e,_=yield(0,u.createFanoutMsgStanza)(e,t,n,r);null===(a=e.wamMessageSendPerfReporter)||void 0===a||a.postReadyToSendStage(),null===(s=e.wamMessageSendPerfReporter)||void 0===s||s.startWrittenWireStage();const h=yield(0,o.sendStanzaAndReturnAck)(_,(0,l.toCoreAckTemplate)({id:d.id,class:"message",from:p,participant:null}));null===(c=e.wamMessageSendPerfReporter)||void 0===c||c.postWrittenWireStage(),e.wamMessageSendPerfReporter=null;const g=f.sendMsgAckSyncParser.parse(h);if(g.error)throw new Error("[messaging] sendMsgToDeviceList: Invalid ack from server");return g.success}))).apply(this,arguments)}},970565:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKeyDistributionMsg=function(){return g.apply(this,arguments)};var i=r(n(348926)),a=(n(824214),n(293350)),o=n(466863),s=n(408139),l=n(978820),c=n(745454),u=n(276802),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(959060)),p=n(820017),f=r(n(11339)),_=n(209108);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function g(){return(g=(0,i.default)((function*(e,t,n){var r,h,g,m,y;if(null==e||null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.startPrekeysFetchStage(),null==e||null===(h=e.wamMessageSendPerfReporter)||void 0===h||h.setFetchedPrekeyCount(0),null==e||null===(g=e.wamMessageSendPerfReporter)||void 0===g||g.setSenderKeyDistributionCount(n.length),0===n.length)return null==e||null===(m=e.wamMessageSendPerfReporter)||void 0===m||m.postPrekeysFetchStage(),null==e||null===(y=e.wamMessageSendPerfReporter)||void 0===y||y.startClientEncryptStage(),null;try{var S,E;const r=yield(0,o.ensureE2ESessions)(n),i=null==r?void 0:r.missedPrekeyCount;var v;if(null!=i)null==e||null===(v=e.wamMessageSendPerfReporter)||void 0===v||v.setFetchedPrekeyCount(i);null==e||null===(S=e.wamMessageSendPerfReporter)||void 0===S||S.postPrekeysFetchStage(),null==e||null===(E=e.wamMessageSendPerfReporter)||void 0===E||E.startClientEncryptStage(),(0,p.maybePostPrekeysDepletionMetric)({count:null==r?void 0:r.depletedPrekeyCount,prekeysFetchReason:f.default.PREKEYS_FETCH_CONTEXT.SEND_MESSAGE,messageType:f.default.MESSAGE_TYPE.GROUP,chatId:t})}catch(e){__LOG__(4,void 0,new Error,void 0,["messaging"])`ensureE2ESessions with error`}const T=yield d.Session.getGroupSenderKeyInfo(t),C={senderKeyDistributionMessage:{groupId:t.toString({legacy:!0}),axolotlSenderKeyDistributionMessage:T}};if((0,s.messageSendCacheWarmingUpEnabled)())try{yield(0,_.bulkGetDeviceRecord)([(0,l.getMeUser)(),...n.map(c.toUserWid)])}catch(e){__LOG__(3)`getKeyDistributionMsg: failed to warm up device cache: ${e}`}const A=n.map(function(){var e=(0,i.default)((function*(e){try{yield(0,u.populateICDCMeta)((0,c.toUserWid)(e),C);const t=yield(0,a.encryptMsgProtobuf)(e,0,C);return{type:t.type,ciphertext:t.ciphertext,participant:e}}catch(t){if(__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendUserMsg: encryption fail for ${e.toString()}, ${t}`,(0,u.isPrimaryDevice)(e))return Promise.reject(new Error(`[messaging] encryptAndSendUserMsg: encryption fail for primary device ${String(e)}`))}}));return function(){return e.apply(this,arguments)}}());return(yield Promise.all(A)).filter(Boolean)}))).apply(this,arguments)}},983522:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupDirectMsg=function(){return m.apply(this,arguments)},t.resendGroupMsg=y;var i=r(n(348926)),a=r(n(170735)),o=n(736184),s=n(40234),l=n(22469),c=n(963388),u=n(326892),d=n(550111),p=n(745454),f=n(276802),_=n(454753),h=n(184746),g=r(n(11339));function m(){return(m=(0,i.default)((function*(e,t,n){const r=e.to;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: sending ${e.id} with group ${r.toString()}`;const i=yield E(e,t,n,{fanoutType:u.FANOUT_TYPE.GROUP_DIRECT}),{phash:a}=i;if(a){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupDirectMsg: phash mismatch, got server phash ${a}`;const r=s.Clock.globalUnixTime();new g.default.MdDeviceSyncAck({chatType:g.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,f.isRevokeMsg)(t)}).commit(),(0,d.syncDeviceListJob)(n,"message",a).then((()=>y(e,t,n,r)))}return i}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n,r){__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: to ${e.to.toString()}`;const i=(0,f.createMessageResendMetric)(e,(0,f.isRevokeMsg)(t));if(s.Clock.globalUnixTime()-r>f.RESEND_TIMEOUT_IN_SECONDS)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendUserMsg: skip group resending due to 5 min timeout`,i.messageSendResult=g.default.MESSAGE_SEND_RESULT_TYPE.ERROR_EXPIRED,void i.commit();try{const r=Array.from(new Set(n.map((e=>e.user)))).map((e=>(0,p.createUserWid)(e))),o=yield(0,c.getFanOutList)({wids:r}),s=(0,a.default)(o,n,String);if(0===s.length)return __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: skip sending to the empty list`,i.messageSendResult=g.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,void i.commit();__LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resending to devices ${s.join(",")}`,yield E(e,t,s,{fanoutType:u.FANOUT_TYPE.GROUP_DIRECT,isResendingMsg:!0})}catch(e){throw __LOG__(2,void 0,void 0,void 0,["messaging"])`resendGroupMsg: resend got error ${e} `,i.messageSendResult=g.default.MESSAGE_SEND_RESULT_TYPE.ERROR_UNKNOWN,i.commit(),e}(0,h.logSuccessfulMessageSend)(i),(0,h.logMessageSendForChatThreadLogging)(e)}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t,n,r){var i,a,s;const{id:c,to:d}=e,p=yield(0,u.createFanoutMsgStanza)(e,t,n,r);yield(0,_.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postReadyToSendStage(),null===(a=e.wamMessageSendPerfReporter)||void 0===a||a.startWrittenWireStage();const h=yield(0,o.sendStanzaAndReturnAck)(p,(0,l.toCoreAckTemplate)({id:c.id,class:"message",from:d,participant:null}));null===(s=e.wamMessageSendPerfReporter)||void 0===s||s.postWrittenWireStage(),e.wamMessageSendPerfReporter=null;const g=f.sendMsgAckSyncParser.parse(h);return g.error?Promise.reject(new Error("[messaging] encryptAndSendGroupDirectMsg: Invalid ack from server")):g.success}))).apply(this,arguments)}},635855:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupKeyDistributionMsg=function(e){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupKeyDistributionMsg: sending ${e}`;const t=e.remote;return f.sendMsgQueueMap.enqueue(t.toString(),(()=>function(){return T.apply(this,arguments)}(e)))};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(824214),l=n(760210),c=n(22469),u=n(696055),d=n(970565),p=n(769315),f=n(420993),_=n(978820),h=n(946308),g=n(276802),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(959060)),y=n(454753),S=n(847124),E=n(543201);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function T(){return(T=(0,i.default)((function*(e){const{id:t}=e,n=e.remote,{skDistribList:r,skList:i,rotateKey:d}=yield(0,E.getGroupSenderKeyList)(n),[f,h]=yield C(n,r,d),m=i.concat(r);yield(0,g.updateIdentityRange)(e,m),yield(0,S.createOrMergeReceiptRecords)(m.map((t=>({msgKey:e,receiverId:t})))),yield(0,y.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const v=yield(0,p.phashV2)([...m,(0,_.assertGetMe)()]),T=(0,o.wap)("message",{id:(0,o.CUSTOM_STRING)(t),to:(0,u.CHAT_JID)(n),phash:(0,o.CUSTOM_STRING)(v),type:"text",device_fanout:(0,o.CUSTOM_STRING)("false")},(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,o.CUSTOM_STRING)(s.CiphertextType.Skmsg),"decrypt-fail":(0,o.CUSTOM_STRING)("hide")}),f,h),A=yield(0,a.sendStanzaAndReturnAck)(T,(0,c.toCoreAckTemplate)({id:t,class:"message",from:n,participant:null})),b=g.sendMsgAckSyncParser.parse(A);return b.error?(__LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"))):(yield(0,E.markHasSenderKey)(n,r),b.success)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n){n&&(yield m.Session.deleteGroupSenderKeyInfo(e));const r=yield(0,d.getKeyDistributionMsg)(null,e,t);let i=null,a=!1;r&&r.length>0&&(i=(0,o.wap)("participants",null,r.map((e=>{let{type:t,ciphertext:n,participant:r}=e;return t===s.CiphertextType.Pkmsg&&(a=!0),(0,o.wap)("to",{jid:(0,u.DEVICE_JID)(r)},(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),"decrypt-fail":(0,o.CUSTOM_STRING)("hide"),type:(0,o.CUSTOM_STRING)(t)},n))}))));let c=null;if(a){const e=yield(0,h.getADVEncodedIdentity)();c=(0,o.wap)("device-identity",null,e)}return[i,c]}))).apply(this,arguments)}},677020:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendGroupMsg=function(e,t){var n;const{id:r,to:a}=e;return __LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupMsg: queued ${r}`,null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.startWaitingToEncryptStage(),u.sendMsgQueueMap.enqueue(a.toString(),(0,i.default)((function*(){var n,i,o;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendGroupMsg: sending ${r}`,null===(n=e.wamMessageSendPerfReporter)||void 0===n||n.postWaitingToEncryptStage(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startReadyToSendStage();const{protocolMessage:u}=t;let f=null;if((null==u?void 0:u.type)===p.Message$ProtocolMessage$Type.REVOKE&&(null==u?void 0:u.key)){const{remoteJid:e,id:t,participant:n}=u.key;e&&t&&n&&(f=new s.default({remote:(0,d.createWid)(e),fromMe:!0,id:t,participant:(0,d.createWid)(n)}))}const _=yield function(){return g.apply(this,arguments)}(a,f);if(_.type===h.DIRECT){var m,y;const{deviceList:n}=_;return null===(m=e.wamMessageSendReporter)||void 0===m||m.setDeviceCount(n.length),null===(y=e.wamMessageSendPerfReporter)||void 0===y||y.setIsDirectedMessage(!0),(0,l.encryptAndSendGroupDirectMsg)(e,t,n)}const{senderKeyList:S}=_;return null===(o=e.wamMessageSendReporter)||void 0===o||o.setDeviceCount(S.skList.length+S.skDistribList.length),(0,c.encryptAndSendSenderKeyMsg)(e,t,S)})))};var i=r(n(348926)),a=n(88555),o=n(963388),s=r(n(465212)),l=n(983522),c=n(491898),u=n(420993),d=n(745454),p=n(124808),f=n(776214),_=n(543201);const h=Object.freeze({SKMSG:"skmsg",DIRECT:"direct"});function g(){return(g=(0,i.default)((function*(e,t){const n=yield(0,_.getGroupSenderKeyList)(e),r={senderKeyList:n,type:h.SKMSG};if(t&&(0,a.isMDBackend)()){const e=yield(0,f.getMsgInfoTable)().equals(["msgKey"],String(t));if(0===e.length)return r;const{skDistribList:i,skList:a}=n,s=new Set(i.concat(a).map((e=>String((0,d.toUserWid)(e))))),l=e.filter((e=>!s.has(e.receiverUserJid))).map((e=>(0,d.createWid)(e.receiverUserJid)));if(0===l.length)return r;const c=[...yield(0,o.getFanOutList)({wids:l}),...a,...i];return{type:h.DIRECT,deviceList:c}}return r}))).apply(this,arguments)}},491898:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.encryptAndSendSenderKeyMsg=function(){return R.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(824214),l=n(760210),c=n(40234),u=n(22469),d=n(696055),p=n(985947),f=n(293350),_=n(970565),h=n(769315),g=n(983522),m=n(555452),y=n(978820),S=n(946308),E=n(276802),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=M(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(959060)),T=n(454753),C=n(810790),A=r(n(11339)),b=n(847124),P=n(543201),O=n(290981);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(M=function(e){return e?n:t})(e)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t,n,r){var i;const a=(0,E.encodeAndPad)(r),c=(0,l.mediaTypeFromProtobuf)(r),u=yield(0,_.getKeyDistributionMsg)(e,t,n),h=yield(0,f.encryptMsgSenderKey)(t,a,c);null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.postClientEncryptStage();let g=null,m=!1;u&&u.length>0&&(g=(0,o.wap)("participants",null,u.map((e=>{let{type:t,ciphertext:n,participant:i}=e;return t===s.CiphertextType.Pkmsg&&(m=!0),(0,o.wap)("to",{jid:(0,d.DEVICE_JID)(i)},(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,o.CUSTOM_STRING)(t),"decrypt-fail":(0,l.encodeMaybeDecryptFail)((0,p.decryptFailAttributeFromProtobuf)(r))},n))}))));const y=(0,o.wap)("enc",{v:(0,o.CUSTOM_STRING)(l.CIPHERTEXT_VERSION.toString()),type:(0,o.CUSTOM_STRING)(s.CiphertextType.Skmsg),mediatype:(0,l.encodeMaybeMediaType)(c),"decrypt-fail":(0,l.encodeMaybeDecryptFail)((0,p.decryptFailAttributeFromProtobuf)(r))},h.ciphertext);let v=null;if(m){const e=yield(0,S.getADVEncodedIdentity)();v=(0,o.wap)("device-identity",null,e)}return[g,y,v]}))).apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e,t,n){var r,i,s;const{id:l,to:f}=e;__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: sending ${l}`;const{id:_}=l,{skDistribList:m,skList:S,rotateKey:M}=n;N(e);const w=S.concat(m),R=yield(0,h.phashV2)([...w,(0,y.assertGetMe)()]);yield(0,b.createOrMergeReceiptRecords)(w.map((e=>({msgKey:l,receiverId:e})))),M&&(yield v.Session.deleteGroupSenderKeyInfo(f));const[L,D,k]=yield I(e,f,m,t),U=(0,p.pollTypeAttributeFromProtobuf)(t),G=null==U?null:(0,o.wap)("meta",{polltype:U}),x=(0,o.wap)("message",{id:(0,o.CUSTOM_STRING)(_),to:(0,d.CHAT_JID)(f),phash:(0,o.CUSTOM_STRING)(R),type:(0,p.typeAttributeFromProtobuf)(t),edit:(0,E.editAttribute)(t,e.subtype)},L,D,k,G);yield(0,E.updateIdentityRange)(l,w),yield(0,T.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),null===(r=e.wamMessageSendPerfReporter)||void 0===r||r.postReadyToSendStage(),null===(i=e.wamMessageSendPerfReporter)||void 0===i||i.startWrittenWireStage();const B=yield(0,a.sendStanzaAndReturnAck)(x,(0,u.toCoreAckTemplate)({id:_,class:"message",from:f,participant:null}));null===(s=e.wamMessageSendPerfReporter)||void 0===s||s.postWrittenWireStage(),e.wamMessageSendPerfReporter=null;const F=E.sendMsgAckSyncParser.parse(B);if(F.error)return __LOG__(3,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: Invalid ack from server`,Promise.reject(new Error("[messaging] encryptAndSendSenderKeyMsg: Invalid ack from server"));yield(0,P.markHasSenderKey)(f,m);const{phash:j,count:Y}=F.success;if(j&&j!==R){__LOG__(2,void 0,void 0,void 0,["messaging"])`encryptAndSendSenderKeyMsg: phash mismatch, got server phash ${j}`;const n=c.Clock.globalUnixTime();new A.default.MdDeviceSyncAck({chatType:A.default.MESSAGE_CHAT_TYPE.GROUP,revoke:(0,E.isRevokeMsg)(t)}).commit(),(0,C.sendQueryGroup)(f).then((()=>{(0,g.resendGroupMsg)(e,t,w,n)}))}return null!=Y&&(0,O.getTable)().merge(String(l),{count:Y}),F.success}))).apply(this,arguments)}function N(e){var t;(0,m.markUserSentMessageToChat)(e.chat.id)&&(null===(t=e.wamMessageSendPerfReporter)||void 0===t||t.setMessageIsFirstUserMessage(!0))}},124578:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.blockUser=function(e){if(e.isPSA())return d(e,!0);return f(e,!0)},t.unblockUser=function(e){if(e.isPSA())return d(e,!1);return f(e,!1)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(696055),c=n(711597);const u=new s.WapParser("blockUseResponseParser",(e=>{if(e.hasChild("error")){const t=e.child("error"),n=t.attrInt("code"),r=t.attrString("text");return __LOG__(3)`blockUserResponseParser: server response with ${n}, ${r}`,{errorCode:n,errorText:r}}return __LOG__(2)`block/unblock user: success`,null}));function d(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=(0,o.wap)("iq",{xmlns:"w:comms:chat",to:o.S_WHATSAPP_NET,type:"set",id:(0,o.generateId)()},(0,o.wap)("blocking",{action:(0,o.CUSTOM_STRING)(t?"block":"unblock")})),r=yield(0,a.sendIq)(n,u);if(!r.success){const{errorCode:e,errorText:t}=r;return __LOG__(3)`blockUnblockPSAUser: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const n=(0,c.getBlocklistHash)(),r=(0,o.wap)("iq",{xmlns:"blocklist",to:o.S_WHATSAPP_NET,type:"set",id:(0,o.generateId)()},(0,o.wap)("item",{dhash:null!=n?(0,o.CUSTOM_STRING)(n):o.DROP_ATTR,action:(0,o.CUSTOM_STRING)(t?"block":"unblock"),jid:(0,l.JID)(e)})),i=yield(0,a.sendIq)(r,u);if(!i.success){const{errorCode:e,errorText:t}=i;return __LOG__(3)`blockUnblockUser: server response with ${e}, ${t}`,{errorCode:e,errorText:t}}}))).apply(this,arguments)}},205609:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(181663),c=n(711597);const u=new s.WapParser("blocklistParser",(e=>{const t={wids:[]};if(e.hasChild("error"))return function(e){const t=e&&e.maybeAttrString("code"),n=e&&e.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getBlocklist error: code ${t} text ${n}`,SEND_LOGS("getBlocklist")}(e.child("error")),t;e.assertAttr("type","result");const n=e.maybeChild("list");if(n){const e=n.maybeAttrString("dhash");e&&(t.dhash=e),n.hasChild("item")&&(t.wids=n.mapChildrenWithTag("item",(e=>(0,l.deviceJidToUserWid)(e.attrDeviceJid("jid"))))||[])}return t}));function d(){return(d=(0,i.default)((function*(){const e=(0,c.getBlocklistHash)(),t=(0,o.wap)("iq",{xmlns:"blocklist",to:o.S_WHATSAPP_NET,type:"get",id:(0,o.generateId)()},e?(0,o.wap)("item",{dhash:(0,o.CUSTOM_STRING)(e)}):null),n=yield(0,a.sendIq)(t,u);if(!n.success){const{errorCode:e,errorText:t}=n;return __LOG__(3)`fetchBlocklist: failed ${e}, ${t}`,{errorCode:e,errorText:t}}return n.result?n.result:Promise.reject(new Error("response does not have blocked list"))}))).apply(this,arguments)}},468807:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAndUpdateBlocklist=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(205609),o=n(711597),s=n(373382);function l(){return(l=(0,i.default)((function*(){__LOG__(2)`[blocklist] fetch blocklist using blocklist`;const e=yield(0,a.getBlocklist)();return null!=e.errorCode||(e.dhash?(__LOG__(2)`[blocklist] updating blocklist with ${e.wids.length||0} contact(s)`,(0,o.setBlocklistHash)(e.dhash),yield(0,s.updateBlocklist)(e.wids)):__LOG__(2)`[blocklist] no change in blocklist, skip update`),e}))).apply(this,arguments)}},887935:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingMode=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(33723),o=n(4e4),s=r(n(389867));function l(){return(l=(0,i.default)((function*(e){if(!s.default.isWid(e)||!e.isUser())return __LOG__(3)`getDisappearingMode: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new a.USyncQuery).withContext("interactive").withMode("query").withDisappearingModeProtocol().withUser((new o.USyncUser).withId(e)),n=yield t.execute();if(n.error.all||n.error.status){const t=n.error.all||n.error.status;return __LOG__(3)`getDisappearingMode: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const r=n.list;0!==r.length&&null!=r[0].disappearing_mode||Promise.reject(new Error("no disappearing_mode data returned for user"));const{duration:i,t:l}=r[0].disappearing_mode;return{id:e,disappearingModeDuration:i,disappearingModeSettingTimestamp:l}}))).apply(this,arguments)}},933756:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryDisappearingMode=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574);const c=new s.WapParser("dmParser",(e=>{const t=e.child("disappearing_mode");return{duration:t.attrInt("duration"),t:t.attrInt("t")}}));function u(){return(u=(0,i.default)((function*(){const e=(0,o.wap)("iq",{xmlns:"disappearing_mode",to:o.S_WHATSAPP_NET,type:"get",id:(0,o.generateId)()}),t=yield(0,a.sendIq)(e,c);if(!t.success)throw new l.ServerStatusCodeError(t.errorCode);return t.result}))).apply(this,arguments)}},224757:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n;switch(t){case"paused":n=(0,i.wap)("paused",null);break;case"composing":n=(0,i.wap)("composing",null);break;case"recording":n=(0,i.wap)("composing",{media:"audio"});break;default:throw new Error(`Impossible value, the default statement should never be reached for value: ${t}`)}return(0,r.castStanza)((0,i.wap)("chatstate",{to:(0,a.CHAT_JID)(e)},n))};var r=n(736184),i=n(831914),a=n(696055)},133233:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,r.castStanza)((0,i.wap)("presence",{type:e,name:(0,i.MAYBE_CUSTOM_STRING)(a.Conn.pushname)}))};var r=n(736184),i=n(831914),a=n(317239)},930228:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=e.isUser()&&null!=t&&(0,a.getABPropConfigValue)("trusted_contacts");return(0,r.castStanza)((0,i.wap)("presence",{id:(0,i.generateId)(),to:(0,o.CHAT_JID)(e),type:"subscribe"},n?(0,i.wap)("tctoken",null,t):null))};var r=n(736184),i=n(831914),a=n(257243),o=n(696055)},970467:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ACCOUNT_SYNC_TYPE=void 0,t.getAndUpdateProfilePicture=function(){const e=(0,a.default)(g.ProfilePicThumbCollection.get((0,_.getMeUser)()),"ProfilePicThumbCollection.get(getMeUser())");return g.ProfilePicThumbCollection.resyncPictures([e])},t.getDevices=function(e){return(0,u.syncDeviceListJob)((0,_.getMePNandLIDWids)(),e,null)},t.updateBlocklist=function(){return T.apply(this,arguments)},t.updateDefaultDisappearingMode=function(){return C.apply(this,arguments)},t.updatePrivacySettings=function(){return v.apply(this,arguments)},t.updateTosState=function(e){return e.forEach((e=>{p.TosManager.setState(e.id,e.state?"ACCEPTED":"NOT_ACCEPTED")})),Promise.resolve()};var i=r(n(348926)),a=r(n(145095)),o=n(468387),s=n(468807),l=n(933756),c=n(458967),u=n(550111),d=n(649891),p=n(536037),f=n(555452),_=n(978820),h=n(132826),g=n(582039),m=n(991036),y=n(861319);const S=n(76672)({BLOCKLIST:"blocklist",DEVICES:"devices",DISAPPEARING_MODE:"disappearing_mode",PICTURE:"picture",PRIVACY:"privacy",STATUS:"status",TOS:"tos"});function E(e,t){switch(t){case y.PrivacyDisallowedListType.About:return e.about===o.VISIBILITY.contact_blacklist;case y.PrivacyDisallowedListType.GroupAdd:return e.groupAdd===o.VISIBILITY.contact_blacklist;case y.PrivacyDisallowedListType.LastSeen:return e.lastSeen===o.VISIBILITY.contact_blacklist;case y.PrivacyDisallowedListType.ProfilePicture:return e.profilePicture===o.VISIBILITY.contact_blacklist}}function v(){return(v=(0,i.default)((function*(){const e=yield(0,c.getPrivacy)();(0,f.setUserPrivacySettings)(e);const t=[y.PrivacyDisallowedListType.About,y.PrivacyDisallowedListType.GroupAdd,y.PrivacyDisallowedListType.LastSeen,y.PrivacyDisallowedListType.ProfilePicture].filter((t=>E(e,t))),n=yield(0,d.syncPrivacyDisallowedLists)(t);return{privacySettings:e,privacyDisallowedRows:n}}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield(0,s.fetchAndUpdateBlocklist)();e.dhash&&(h.BlocklistCollection.toArray().forEach((e=>h.BlocklistCollection.remove(e))),e.wids&&e.wids.forEach((e=>{h.BlocklistCollection.gadd(e)})))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){const e=yield(0,l.queryDisappearingMode)();yield(0,m.updateDisappearingMode)((0,_.getMaybeMeUser)(),e.duration,e.t)}))).apply(this,arguments)}t.ACCOUNT_SYNC_TYPE=S},809540:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryPrivacyDisallowedList=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(181663);n(861319);const c=new s.WapParser("getPrivacyDisallowedListParser",(e=>{const t=e.child("privacy").maybeChild("list");if(null==t)return{status:"match"};return{status:"mismatch",users:t.mapChildren((e=>(0,l.deviceJidToUserWid)(e.attrDeviceJid("jid")))),dhash:t.attrString("dhash")}}));function u(){return(u=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"get",id:(0,o.generateId)(),xmlns:"privacy"},(0,o.wap)("privacy",null,(0,o.wap)("list",{name:(0,o.CUSTOM_STRING)(e),value:(0,o.CUSTOM_STRING)("contact_blacklist")}))),n=yield(0,a.sendIq)(t,c);if(n.success)return n.result;throw new Error("invalid response")}))).apply(this,arguments)}},458967:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPrivacy=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(468387);function c(e,t){const n=t.maybeChild("error"),r=n&&n.maybeAttrString("code"),i=n&&n.maybeAttrString("text");__LOG__(3,void 0,void 0,!0)`getPrivacy error: ${e} code ${r} text ${i}`,SEND_LOGS("getPrivacy")}const u=new s.WapParser("privacyParser",(e=>{e.assertAttr("type","result");const t={};return e.child("privacy").forEachChildWithTag("category",(e=>{switch(e.attrString("name")){case"readreceipts":{const n=e.attrEnum("value",l.ALL_NONE_WITH_ERROR);"error"!==n?t.readReceipts=n:c("readreceipts",e);break}case"last":{const n=e.attrEnum("value",l.VISIBILITY_WITH_ERROR);"error"!==n?t.lastSeen=n:c("last",e);break}case"profile":{const n=e.attrEnum("value",l.VISIBILITY_WITH_ERROR);"error"!==n?t.profilePicture=n:c("profile",e);break}case"status":{const n=e.attrEnum("value",l.VISIBILITY_WITH_ERROR);"error"!==n?t.about=n:c("status",e);break}case"groupadd":{const n=e.attrEnum("value",l.VISIBILITY_WITH_ERROR);"error"!==n?t.groupAdd=n:c("groupadd",e);break}default:c("unknown type",e)}})),t}));function d(){return(d=(0,i.default)((function*(){const e=(0,o.wap)("iq",{xmlns:"privacy",to:o.S_WHATSAPP_NET,type:"get",id:(0,o.generateId)()},(0,o.wap)("privacy",null)),t=yield(0,a.sendIq)(e,u);if(t.success)return t.result;throw new Error("invalid response")}))).apply(this,arguments)}},804008:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=void 0,t.setPrivacyTokens=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055);const u=new s.WapParser("setPrivacyTokensParser",(e=>({stanzaId:e.attrString("id")}))),d=n(76672)({TrustedContact:"trusted_contact"});function p(){return(p=(0,i.default)((function*(e,t,n){const r=t.map((t=>(0,o.wap)("token",{jid:(0,c.USER_JID)(e),t:(0,o.CUSTOM_STRING)(String(n)),type:(0,o.CUSTOM_STRING)(t)}))),i=yield(0,a.sendIq)((0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"set",xmlns:"privacy",id:(0,o.generateId)()},(0,o.wap)("tokens",null,r)),u);if(!i.success)throw new l.ServerStatusCodeError(i.errorCode,i.errorText)}))).apply(this,arguments)}t.TokenType=d},735490:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearDirtyBits=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914);const s=new(n(471914).WapParser)("cleanDirtyReplyParser",(e=>(e.assertAttr("type","result"),{})));function l(){return(l=(0,i.default)((function*(e){if(0===e.length)return;const t=e.map((e=>(0,o.wap)("clean",{type:(0,o.CUSTOM_STRING)(e.type),timestamp:(0,o.INT)(e.timestamp)}))),n=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"set",xmlns:"urn:xmpp:whatsapp:dirty",id:(0,o.generateId)()},t);try{yield(0,a.sendIq)(n,s),__LOG__(2)`clearDirtyBits: success for type: ${e.map((e=>e.type)).join(",")}`}catch(e){__LOG__(3)`clearDirtyBits: failed with error`}}))).apply(this,arguments)}},238383:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(33723),o=n(4e4),s=r(n(389867));function l(){return(l=(0,i.default)((function*(e){if(!s.default.isWid(e)||!e.isUser())return __LOG__(3)`getAbout: this method should only take user wid, instead it received: ${e}`,Promise.resolve({id:e});const t=(new a.USyncQuery).withContext("interactive").withMode("query").withStatusProtocol().withUser((new o.USyncUser).withId(e)),n=yield t.execute();if(n.error.all||n.error.status){const t=n.error.all||n.error.status;return __LOG__(3)`getAbout: failed ${t.errorCode} : ${t.errorText}`,{id:e,error:t}}const r=n.list;return r.length||Promise.reject(new Error("no status data returned for user")),{id:e,status:r[0].status}}))).apply(this,arguments)}},16292:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllContactsFromChatCollectionIntoChunks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;const t=[],n=[],r=new Set;let i=new Set;for(const a of l.ChatCollection.toArray())i.size===e&&(t.push(i),i=new Set),a.isBroadcast||(a.isGroup?n.push(a.id):r.has(a.id)||(i.add(a.id),r.add(a.id)));for(const s of n){var a,o;const n=l.ChatCollection.get(s)||{},c=null!==(a=null===(o=n.groupMetadata)||void 0===o?void 0:o.participants.toArray())&&void 0!==a?a:[];for(const n of c)i.size===e&&(t.push(i),i=new Set),r.has(n.id)||(i.add(n.id),r.add(n.id))}0!==i.size&&t.push(i);return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${t.length} chunks of contacts from chat collection, chunk size: ${e}`,t},t.getAndUpdateNonAddressBookContacts=function(){return g.apply(this,arguments)},t.getNonAddressBookContactsAndMarkAllContactsDirty=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=n(272441),o=r(n(389867)),s=n(745454),l=n(669951),c=n(776214),u=n(799069);function d(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){const e=new Set;return yield(0,c.getParticipantTable)().forEach((t=>{t.participants.forEach((t=>{e.add((0,a.toPhoneUserJid)((0,s.createWid)(t).user))}))})),yield(0,c.getChatTable)().forEach((t=>{o.default.isUser(t.id)&&e.add((0,a.toPhoneUserJid)((0,s.createWid)(t.id).user))})),__LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${e.size} contacts from chat and group participant tables`,Array.from(e)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=yield e.anyOf(["isAddressBookContact"],[1,0]),n=new Set(t.map((e=>e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`found ${n.size} contacts with set isAddressBookContact value from contact table`,n}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){const e=yield d();return(0,u.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield f(n),i=Array.from(e).map((e=>r.has(e)?{id:e,isContactSyncCompleted:0}:{id:e,isAddressBookContact:0,isContactSyncCompleted:0}));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${i.length} contacts dirty during the regular sync`,n.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){const e=yield d();return(0,u.getStorage)().lock(["contact"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield f(n),i=e.filter((e=>!r.has(e))).map((e=>({id:e,isAddressBookContact:0,isContactSyncCompleted:0})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`get ${i.length} non-address book contacts, mark dirty, and update the contact table during the inital sync`,n.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}},695434:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExist=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(227101),o=n(492574),s=n(33723),l=n(4e4),c=n(745454),u=n(2259),d=n(845222);function p(){return(p=(0,i.default)((function*(e){if("lid"===e.type&&!e.wid.isLid())throw new Error("queryExist is provided with invalid lid");const t=new s.USyncQuery;"phone"===e.type?(t.withContactProtocol(),t.withUser((new l.USyncUser).withPhone(e.phone))):t.withUser((new l.USyncUser).withId(e.wid)),(0,u.lidUsyncEnabled)()&&t.withLidProtocol(),t.withBusinessProtocol(),(0,a.isDisappearingModeEnabled)()&&t.withDisappearingModeProtocol();const n=yield t.execute(),r=n.error.all||n.error.contact;if(r)throw new o.ServerStatusCodeError(r.errorCode,r.errorText);const{list:i}=n;if(1!==i.length)return null;const{id:p,contact:f,business:_,disappearing_mode:h,lid:g}=i[0];if("phone"===e.type&&"in"!==(null==f?void 0:f.type))return null;const m={wid:p,biz:null!=_,bizInfo:_};return h&&(m.disappearingMode={duration:h.duration,settingTimestamp:h.t}),null!=g&&(yield(0,d.createOrReplaceLidPnMappings)([{pn:p.user,lid:(0,c.createUserWid)(g).user}])),m}))).apply(this,arguments)}},511659:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(492574),c=n(696055),u=r(n(389867));const d=new s.WapParser("photoResponseParser",(e=>{if(e.assertAttr("type","result"),e.hasChild("picture")){return{id:e.child("picture").attrInt("id")}}return{id:null}}));function p(){return(p=(0,i.default)((function*(e,t){const n=yield(0,a.sendIq)((0,o.wap)("iq",{to:o.S_WHATSAPP_NET,target:u.default.isGroup(e)?(0,c.CHAT_JID)(e):o.DROP_ATTR,type:"set",xmlns:"w:profile:picture",id:(0,o.generateId)()},t?(0,o.wap)("picture",{type:"image"},t):null),d);return n.success?{id:n.result.id}:Promise.reject(new l.ServerStatusCodeError(n.errorCode,n.errorText))}))).apply(this,arguments)}},445150:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,r.castStanza)((0,i.wap)("presence",{name:(0,i.MAYBE_CUSTOM_STRING)(e)}))};var r=n(736184),i=n(831914)},984598:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactListInChunksJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,i.NonPersistJob)("syncContactListInChunks",(e=>(0,a.syncContactListInChunks)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldDelayBetweenChunks:t})},t.syncContactListJob=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,i.NonPersistJob)("syncContactList",(e=>(0,a.syncContactList)(e)),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted({contactIds:e,shouldSyncDevice:t})};var r=n(524674),i=n(879274),a=n(633192)},81245:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getContactSyncRefreshSeconds=function(){var e;const t=null!==(e=(0,a.default)(s.default,"localStorage").getItem(l.KEYS.CONTACT_SYNC_REFRESH))&&void 0!==e?e:86400;return parseInt(t,10)},t.runSyncDirtyContactsJob=function(){(0,c.getShouldCheckContactSyncStatus)()&&setTimeout((function(){!function(){h.apply(this,arguments)}()}),6e4);(0,c.setShouldCheckContactSyncStatus)()},t.syncNewContact=function(e){_.push(e),f?f.debounce(1e3):(f=new o.ShiftTimer((()=>{if(!(0,c.isRegistered)())return;const e=_;_=[],f=null,__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start new contact sync for ${e.length} contacts`,(0,d.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0}).catch((e=>{__LOG__(4,!0,new Error,!0,["non-sad","contact-sync"])`syncNewContact: contact sync failed, error: ${e}`,SEND_LOGS("syncNewContact: contact sync failed")}))})),f.onOrBefore(2e4))};var i=r(n(348926)),a=r(n(145095)),o=n(657319),s=r(n(904285)),l=n(546718),c=n(711597),u=n(745454),d=n(633192),p=n(776214);let f=null,_=[];function h(){return(h=(0,i.default)((function*(){const e=(yield(0,p.getContactTable)().equals(["isContactSyncCompleted"],0)).map((e=>(0,u.createWid)(e.id)));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`sync dirty contacts, found ${e.length} contacts to sync`,(0,d.syncContactListInChunks)({contactIds:e,shouldDelayBetweenChunks:!0})}))).apply(this,arguments)}},931219:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.AdvToSystemBridgeImpl=void 0,t.getLastADVDeviceInfoCheckTime=T,t.runAdvDeviceInfoCheck=w,t.scheduleAdvDeviceInfoCheck=M;var i=r(n(348926)),a=n(252230),o=n(892844),s=n(257243),l=n(40234),c=n(788950),u=n(797976),d=n(978820),p=n(745454),f=r(n(11339)),_=n(765044),h=n(209108),g=n(760998),m=n(446308);const y=25*o.HOUR_SECONDS;class S{constructor(e){this.advToSystemBridge=e}run(e){var t=this;return(0,i.default)((function*(){const n=t.advToSystemBridge,r=yield n.getUsersForExpiration(e),{usersExpired:i,usersCloseToExpiration:a}=r;n.removeCompanions(i),n.sendADVStoredTimestampExpiredEvents(i,e);const o=Array.from(i.keys()).concat(Array.from(a.keys())).filter((e=>!n.canRemoveUserDevices(e)));return n.sendOrQueueDeviceUsyncQuery(o).catch((()=>{})),n.recordLocalTimestamp()}))()}}class E{getNumDaysKeyIndexListExpiration(){return(0,s.getABPropConfigValue)("num_days_key_index_list_expiration")}getNumDaysBeforeDeviceExpiryCheck(){return(0,s.getABPropConfigValue)("num_days_before_device_expiry_check")}getUsersForExpiration(e){var t=this;return(0,i.default)((function*(){const n=yield(0,h.getAllDeviceLists)(),r=yield T(),i=t.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS,s=new Map,l=new Map;return n.forEach((n=>{n.deleted||function(e){return 1===e.devices.length&&e.devices[0].id===a.DEFAULT_DEVICE_ID}(n)||(!function(e,t,n,r){if(e-n.timestamp>=t)return!0;if(null!=n.expectedTsUpdateTs)return e-n.expectedTsUpdateTs>=y&&n.expectedTsLastDeviceJobTs!==r;return!1}(e,i,n,r)?function(e,t,n){if(e-n.timestamp>=t)return!0;if(null!=n.expectedTs)return n.expectedTs>n.timestamp;return!1}(e,i-t.getNumDaysBeforeDeviceExpiryCheck()*o.DAY_SECONDS,n)&&l.set((0,p.createUserWid)(n.id),n):s.set((0,p.createUserWid)(n.id),n))})),{usersExpired:s,usersCloseToExpiration:l}}))()}sendADVStoredTimestampExpiredEvents(e,t){e.forEach((e=>{const n=t-(e.timestamp+this.getNumDaysKeyIndexListExpiration()*o.DAY_SECONDS);if(n<0)return;const r=Math.round(n/o.HOUR_SECONDS);new f.default.AdvStoredTimestampExpired({advExpireTimeInHours:r}).commit()}))}sendOrQueueDeviceUsyncQuery(e){return(0,i.default)((function*(){return yield(0,m.addUserToPendingDeviceSync)(e.map((e=>e.toString()))),(0,m.doPendingDeviceSync)()}))()}canRemoveUserDevices(){return!1}removeCompanions(e){return Array.from(e.entries()).some((e=>{let[t,n]=e;t.user,(0,d.getMeUser)().user}))?(__LOG__(2)`Logging out due to own expired device`,_.Socket.logout(!1,c.LogoutReason.InvalidAdvStatus),Promise.resolve()):Promise.all(Array.from(e.entries()).map((e=>{let[t,n]=e;return(0,u.clearDeviceRecord)(t,n.devices)})))}recordLocalTimestamp(){return Promise.resolve()}}let v;function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){if(null==v){yield(0,g.getTaskScheduledTime)("advDeviceInfoCheck")}return v}))).apply(this,arguments)}t.AdvToSystemBridgeImpl=E;const A=o.DAY_SECONDS,b="advDeviceInfoCheck";let P,O;function M(){return I.apply(this,arguments)}function I(){return(I=(0,i.default)((function*(){null!=P&&(clearTimeout(P),P=null);const e=l.Clock.localUnixTime(),t=yield T();let n=0,r=()=>Promise.resolve();null!=t&&(n=Math.max(A-(e-t),0),r=()=>(0,s.getABPropConfigValue)("adv_v2_m4_m5")?w():Promise.resolve()),P=setTimeout((0,i.default)((function*(){try{yield r()}catch(e){__LOG__(4,void 0,new Error,void 0,["adv_device_info_check"])`error running the adv device check job`}P=null,v=l.Clock.localUnixTime(),(0,g.updateTaskScheduledTime)(b,(0,o.castToUnixTime)(v)),M()})),1e3*n)}))).apply(this,arguments)}function w(){return null==O&&(O=new S(new E)),O.run(l.Clock.localUnixTime())}},550111:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncDeviceListJob=function(e,t,n){return(0,i.NonPersistJob)("syncDeviceList",(e=>(0,a.syncDeviceList)(e))).waitUntilCompleted({wids:e,context:t,phash:n})},t.syncMyDeviceListJob=function(){return(0,i.NonPersistJob)("syncMyDeviceList",(()=>(0,a.syncMyDeviceList)()),{priority:r.JOB_PRIORITY.SKIP}).waitUntilCompleted()};var r=n(524674),i=n(879274),a=n(264114)},36172:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.unpairDevice=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(696055),c=n(978820);const u=new s.WapParser("unpairResponse",(e=>{e.assertTag("iq"),e.assertFromServer();let t=200;return"error"===e.attrString("type")&&(t=e.child("error").attrInt("code")),{status:t}}));function d(){return(d=(0,i.default)((function*(e){const t=(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,type:"set",id:(0,o.generateId)(),xmlns:"md"},(0,o.wap)("remove-companion-device",{jid:(0,l.DEVICE_JID)((0,c.assertGetMe)()),reason:(0,o.CUSTOM_STRING)(e)})),n=yield(0,a.sendIq)(t,u);return n.success?{status:n.result.status}:{status:n.errorCode}}))).apply(this,arguments)}},382626:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.reportSyncdStatsJob=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(524674),o=n(257243),s=n(879274),l=n(435047),c=r(n(11339));function u(){return(u=(0,i.default)((function*(){if(yield(0,o.getABPropConfigValue)("md_app_state_report_md_sync_mutation_stats"))return new s.NonPersistJob("reportSyncdStats",(0,i.default)((function*(){const e=yield(0,l.generateActionStatCounts)();for(const t of e.values())new c.default.MdAppStateSyncMutationStats({syncdAction:t.action,applied:(0,l.convertToBucket)(t.applied),invalid:(0,l.convertToBucket)(t.invalid),orphan:(0,l.convertToBucket)(t.orphan),unsupported:(0,l.convertToBucket)(t.unsupported),failed:(0,l.convertToBucket)(t.failed)}).commit()})),{priority:a.JOB_PRIORITY.LOW}).waitUntilCompleted()}))).apply(this,arguments)}},641950:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.requestAllSyncdMissingKeysJob=function(){return new o.NonPersistJob("requestAllSyncdMissingKeys",(0,i.default)((function*(){yield(0,s.requestAllMissingKeys)(),setTimeout(l.setMissingKeyTimeout,2e4)})),{priority:a.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=r(n(348926)),a=n(524674),o=n(879274),s=n(284051),l=n(793932)},801580:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncdSyncAllCollectionsJob=function(){return new c.NonPersistJob("syncdSyncAllCollections",(0,i.default)((function*(){__LOG__(2)`syncd: periodic sync for all collection`,yield(0,o.markCollectionsForSync)([s.CollectionName.CriticalBlock,s.CollectionName.CriticalUnblockLow,s.CollectionName.Regular,s.CollectionName.RegularLow,s.CollectionName.RegularHigh]),(0,u.setLastPeriodicAppStateSyncTs)((0,l.unixTime)())})),{priority:a.JOB_PRIORITY.LOW}).waitUntilCompleted()};var i=r(n(348926)),a=n(524674),o=n(836229),s=n(960362),l=n(892844),c=n(879274),u=n(711597)},824214:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=t.DecryptFailType=t.CiphertextType=void 0;const r=n(76672)({Skmsg:"skmsg",Pkmsg:"pkmsg",Msg:"msg"});t.CiphertextType=r;const i=n(76672)({Photo:"photo",Video:"video",Audio:"audio",Ptt:"ptt",Location:"location",Contact:"contact",Document:"document",Url:"url",Call:"call",Gif:"gif",Future:"future",ContactArray:"contact_array",LiveLocation:"live_location",ProfilePic:"profile_pic",Sticker:"sticker",Hsm:"hsm",ProductImage:"product_image",Template:"template",MdAppState:"md_app_state",MdHistorySync:"md_history_sync",List:"list",ListResponse:"list_response",Button:"button",ButtonResponse:"button_response",Order:"order",Product:"product",NativeFlowResponse:"native_flow_response"});t.MediaType=i;const a=n(76672)({Hide:"hide",Show:"show"});t.DecryptFailType=a},760210:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CIPHERTEXT_VERSION=void 0,t.encodeMaybeDecryptFail=function(e){switch(e){case a.DecryptFailType.Show:return i.DROP_ATTR;case a.DecryptFailType.Hide:return(0,i.CUSTOM_STRING)("hide")}},t.encodeMaybeNativeFlowName=t.encodeMaybeMediaType=void 0,t.encodeMediaType=s,t.getMetricE2eCiphertextType=function(e){switch(e){case a.CiphertextType.Skmsg:return o.default.E2E_CIPHERTEXT_TYPE.SENDER_KEY_MESSAGE;case a.CiphertextType.Pkmsg:return o.default.E2E_CIPHERTEXT_TYPE.PREKEY_MESSAGE;case a.CiphertextType.Msg:return o.default.E2E_CIPHERTEXT_TYPE.MESSAGE}},t.getMetricE2eDestination=function(e){if(e.isUser())return o.default.E2E_DESTINATION.INDIVIDUAL;if(e.isGroup())return o.default.E2E_DESTINATION.GROUP;if(e.isStatusV3())return o.default.E2E_DESTINATION.STATUS;if(e.isBroadcast())return o.default.E2E_DESTINATION.LIST;throw new Error},t.maybeEncoder=l,t.mediaTypeFromProtobuf=function e(t){if(t.deviceSentMessage){const{message:n}=t.deviceSentMessage;return n?e(n):null}if(t.ephemeralMessage){const{message:n}=t.ephemeralMessage;return n?e(n):null}if(t.viewOnceMessage){const{message:n}=t.viewOnceMessage;return n?e(n):null}if(t.documentWithCaptionMessage){const{message:n}=t.documentWithCaptionMessage;return n?e(n):null}if(t.imageMessage)return a.MediaType.Photo;if(t.stickerMessage)return a.MediaType.Sticker;if(t.locationMessage)return a.MediaType.LiveLocation;if(t.contactMessage)return a.MediaType.Contact;if(t.contactsArrayMessage)return a.MediaType.ContactArray;if(t.documentMessage)return a.MediaType.Document;if(t.audioMessage)return t.audioMessage.ptt?a.MediaType.Ptt:a.MediaType.Audio;if(t.videoMessage)return t.videoMessage.gifPlayback?a.MediaType.Gif:a.MediaType.Video;if(t.buttonsMessage)return a.MediaType.Button;if(t.buttonsResponseMessage)return a.MediaType.ButtonResponse;if(t.listMessage)return a.MediaType.List;if(t.listResponseMessage)return a.MediaType.ListResponse;if(t.orderMessage)return a.MediaType.Order;if(t.productMessage)return a.MediaType.Product;if(t.groupInviteMessage)return a.MediaType.Url;if(t.interactiveResponseMessage)return a.MediaType.NativeFlowResponse;return null},t.metricsMediaType=function(e){switch(e){case a.MediaType.Photo:return o.default.MEDIA_TYPE.PHOTO;case a.MediaType.Video:return o.default.MEDIA_TYPE.VIDEO;case a.MediaType.Audio:return o.default.MEDIA_TYPE.AUDIO;case a.MediaType.Ptt:return o.default.MEDIA_TYPE.PTT;case a.MediaType.Location:return o.default.MEDIA_TYPE.LOCATION;case a.MediaType.Contact:return o.default.MEDIA_TYPE.CONTACT;case a.MediaType.Document:return o.default.MEDIA_TYPE.DOCUMENT;case a.MediaType.Url:return o.default.MEDIA_TYPE.URL;case a.MediaType.Call:return o.default.MEDIA_TYPE.CALL;case a.MediaType.Gif:return o.default.MEDIA_TYPE.GIF;case a.MediaType.Future:return o.default.MEDIA_TYPE.FUTURE;case a.MediaType.ContactArray:return o.default.MEDIA_TYPE.CONTACT_ARRAY;case a.MediaType.LiveLocation:return o.default.MEDIA_TYPE.LIVE_LOCATION;case a.MediaType.ProfilePic:return o.default.MEDIA_TYPE.PROFILE_PIC;case a.MediaType.Sticker:return o.default.MEDIA_TYPE.STICKER;case a.MediaType.Hsm:return o.default.MEDIA_TYPE.HSM;case a.MediaType.ProductImage:return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case a.MediaType.Template:return o.default.MEDIA_TYPE.TEMPLATE;case a.MediaType.MdAppState:return o.default.MEDIA_TYPE.MD_APP_STATE;case a.MediaType.MdHistorySync:return o.default.MEDIA_TYPE.MD_HISTORY_SYNC;case a.MediaType.List:return o.default.MEDIA_TYPE.LIST;case a.MediaType.ListResponse:return o.default.MEDIA_TYPE.LIST_REPLY;case a.MediaType.Button:return o.default.MEDIA_TYPE.BUTTON_MESSAGE;case a.MediaType.ButtonResponse:return o.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case a.MediaType.Order:return o.default.MEDIA_TYPE.ORDER;case a.MediaType.Product:return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case a.MediaType.NativeFlowResponse:return o.default.MEDIA_TYPE.INTERACTIVE_RESPONSE_NFM}},t.nativeFlowNameTypeFromProtobuf=function(e){var t;return e.interactiveResponseMessage?null===(t=e.interactiveResponseMessage.nativeFlowResponseMessage)||void 0===t?void 0:t.name:null};var i=n(831914),a=n(824214),o=r(n(11339));function s(e){const t=(()=>{switch(e){case a.MediaType.Photo:return"image";case a.MediaType.Video:return"video";case a.MediaType.Audio:return"audio";case a.MediaType.Ptt:return"ptt";case a.MediaType.Contact:return"vcard";case a.MediaType.Document:return"document";case a.MediaType.Gif:return"gif";case a.MediaType.ContactArray:return"contact_array";case a.MediaType.LiveLocation:return"livelocation";case a.MediaType.Sticker:return"sticker";case a.MediaType.List:return"list";case a.MediaType.ListResponse:return"list_response";case a.MediaType.ButtonResponse:return"buttons_response";case a.MediaType.Order:return"order";case a.MediaType.Product:return"product";case a.MediaType.Url:return"url";case a.MediaType.NativeFlowResponse:return"native_flow_response";default:return null}})();if(t)return(0,i.CUSTOM_STRING)(t);throw new Error("Unsupported type")}function l(e){return t=>null==t?i.DROP_ATTR:e(t)}t.CIPHERTEXT_VERSION=2;const c=l(s);t.encodeMaybeMediaType=c;const u=l((e=>(0,i.CUSTOM_STRING)(e)));t.encodeMaybeNativeFlowName=u},276167:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addPlaceHolderAction=function(e){u(e,{placeholderActionInd:c.default.PLACEHOLDER_ACTION.ADD}).commit()},t.populatePlaceHolderAction=function(e){u((0,o.messageFromDbRow)(e),{placeholderActionInd:c.default.PLACEHOLDER_ACTION.POPULATE}).commit()},t.viewPlaceHolderAction=function(e){u((0,o.messageFromDbRow)(e),{placeholderActionInd:c.default.PLACEHOLDER_ACTION.VIEW}).commit()};var i=r(n(81109)),a=n(892844),o=n(536051),s=r(n(389867)),l=n(542515),c=r(n(11339));function u(e,t){const r=new(n(17304).Msg)(e),o=new c.default.PlaceholderActivity((0,i.default)({placeholderChatTypeInd:d(r),placeholderTimePeriod:Math.max((0,a.unixTime)()-r.t,0),placeholderTypeInd:"fanout"===r.subtype?c.default.PLACEHOLDER_TYPE.FANOUT:c.default.PLACEHOLDER_TYPE.CIPHERTEXT,messageIsRevoke:Boolean(r.asRevoked),messageMediaType:r.getWamMediaType(),messageType:r.getWamMessageType()},t));return function(e,t){var r;const i=null===(r=e.chat)||void 0===r?void 0:r.id;if(null==i?void 0:i.isGroup()){const e=n(963928).default.get(i),r=null==e?void 0:e.cachedDeviceSizeBucket;null!=e&&Object.assign(t,(0,l.getGroupCountMetricsFromGroupMetadata)(e)),null!=r&&(t.deviceSizeBucket=r)}}(r,o),o}function d(e){const t=e.id.remote;return s.default.isGroup(t)?c.default.PLACEHOLDER_CHAT_TYPE.GROUP:s.default.isStatusV3(t)?c.default.PLACEHOLDER_CHAT_TYPE.STATUS:s.default.isBroadcast(t)?c.default.PLACEHOLDER_CHAT_TYPE.BROADCAST:s.default.isUser(t)?c.default.PLACEHOLDER_CHAT_TYPE.INDIVIDUAL:c.default.PLACEHOLDER_CHAT_TYPE.OTHER}},521522:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._online=void 0,t.handleMessage=function(){return f.apply(this,arguments)},t.waitForOfflineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return p.chatQueue.wait(e);return p.allChatQueue.wait()},t.waitForOnlineMsgThread=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e)return d.chatQueue.wait(e);return d.allChatQueue.wait()};var i=r(n(348926)),a=n(640265),o=n(927870),s=n(638284),l=r(n(355184)),c=n(528237);const u=2e4,d={allChatQueue:new o.PromiseQueue,chatQueue:new o.PromiseQueueMap};t._online=d;const p={allChatQueue:new o.PromiseQueue,chatQueue:new o.PromiseQueueMap};function f(){return(f=(0,i.default)((function*(e,t,n){return t&&!c.OfflineMessageHandler.isResumeFromRestartComplete()?p.allChatQueue.enqueue((()=>p.chatQueue.enqueue(e,(()=>(0,s.promiseTimeout)(n(),u).catch((e=>{if(!(e instanceof a.TimeoutError))throw e;__LOG__(2,void 0,void 0,void 0,["messaging"])`Offline chat queue MAX_MESSAGE_DELAY exceeded`})))))):(yield(0,l.default)(),d.allChatQueue.enqueue((()=>d.chatQueue.enqueue(e,(()=>(0,s.promiseTimeout)(n(),u).catch((e=>{if(!(e instanceof a.TimeoutError))throw e;__LOG__(2,void 0,void 0,void 0,["messaging"])`Online chat queue MAX_MESSAGE_DELAY exceeded`})))))))}))).apply(this,arguments)}},959474:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMetricHistorySyncPayloadType=function(e){switch(e){case 0:return i.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.INITIAL;case 1:return i.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.STATUS_V3;case 2:return i.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.FULL_HISTORY;case 3:return i.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.RECENT_HISTORY;default:return i.default.MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE.PUSHNAME}};var i=r(n(11339))},273027:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseWebMsgInfoPollUpdates=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(608243),o=r(n(145095)),s=n(396177),l=r(n(465212)),c=n(115461),u=n(758180),d=n(20853),p=n(978820),f=n(745454);function _(){return(_=(0,i.default)((function*(e,t){try{if(!(0,u.isPollsReceivingEnabled)())return[];if(null==e||null==e.pollUpdates)return[];if(null==t||t.type!==c.MSG_TYPE.POLL_CREATION)return[];const n=t,r=yield(0,s.createPollOptionLocalIdMap)(n.pollOptions);return e.pollUpdates.map((e=>{try{const t=(0,o.default)(e.pollUpdateMessageKey,"pollUpdate.pollUpdateMessageKey"),i=(0,o.default)(e.vote,"pollUpdate.vote"),s=new l.default({fromMe:(0,o.default)(t.fromMe,"pollUpdateMessageKey.fromMe"),remote:(0,f.createWid)((0,o.default)(t.remoteJid,"pollUpdateMessageKey.remoteJid")),id:(0,o.default)(t.id,"pollUpdateMessageKey.id"),participant:(0,o.default)(t.fromMe,"pollUpdateMessageKey.fromMe")?void 0:(0,f.createUserWid)((0,o.default)(t.participant,"pollUpdateMessageKey.participant"))}),c=(0,p.getMeUser)(),u=s.participant||s.remote,_=!0===s.fromMe?c:(0,f.toUserWid)(u);return(0,d.voteFromProtobuf)({voteProtobuf:i,pollVoteMsgKey:s,parentMsgKey:n.id,sender:_,senderTimestampMs:(0,a.numberOrThrowIfTooLarge)((0,o.default)(e.senderTimestampMs,"pollUpdate.senderTimestampMs")),pollOptionLocalIdMap:r})}catch(e){return __LOG__(4,void 0,new Error,!0)`[history sync] Failed to parse pollUpdate with error ${e}`,SEND_LOGS("parseWebMsgInfoPollUpdates-vote-parse-error"),null}})).filter(Boolean)}catch(e){return __LOG__(4,void 0,new Error,!0)`[history sync] parseWebMsgInfoPollUpdates failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`,SEND_LOGS("parseWebMsgInfoPollUpdates-error"),[]}}))).apply(this,arguments)}},470127:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.parseWebMsgInfoReaction=function(e){const t=[];try{(0,a.parseWMIReaction)()&&null!=e&&e.reactions.forEach((n=>{const{key:r,senderTimestampMs:a,text:c,unread:u}=n,d=(0,i.convertToTextWithoutSpecialEmojis)(null!=c?c:""),p=!!r.fromMe,f=(0,i.decodeJid)(r.remoteJid);let _;r.fromMe?f.isUser()||(_=(0,s.getMeUser)()):_=(0,i.decodeJid)(r.participant);const h=new o.default({id:r.id,fromMe:p,remote:f,participant:_}),g=(0,s.getMeUser)(),m=!0===p?g:_||f;null!=m&&m instanceof l.default?null==d?__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction:convertToTextWithoutSpecialEmojis reaction text is null.`:t.push({id:h,reactionTimestamp:a,reactionText:d,reactionParentKey:e.id,sender:m,unread:Boolean(u)}):__LOG__(4,void 0,new Error)`parseWebMsgInfoReaction: reaction sender should be a wid.`}))}catch(e){__LOG__(4,void 0,new Error)`[history sync] parseWebMsgInfoReaction failed with error ${null==e?void 0:e.name} and stack ${null==e?void 0:e.stack}`}return t};var i=n(363069),a=n(408139),o=r(n(465212)),s=n(978820),l=r(n(389867))},335283:(e,t,n)=>{"use strict";var r=n(595318);t.Z=function(){return A.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(252230),s=n(831914),l=n(824214),c=n(760210),u=n(22469),d=n(696055),p=r(n(364369)),f=n(466863),_=r(n(389867)),h=n(745454),g=n(946308),m=n(276802),y=T(n(959060)),S=n(454753),E=T(n(445473));function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}function T(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const{VOIP_LOG_COLOR:C}=p.default;function A(){return(A=(0,i.default)((function*(e,t){const n=e.common,r=(0,h.createWid)(n.peer_jid);if(_.default.isGroupCall(r))return b((0,s.CUSTOM_STRING)(n.peer_jid),r,e);try{return b(yield O(e,r,t),r,e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Failed to encrypt and send msg`}}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t,n){const r=(0,d.voipXmlToWapNode)(n.payload),i=(0,s.generateId)(),o=(0,s.wap)("call",{to:e,id:i},r);yield(0,S.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode();const l=yield(0,a.sendStanzaAndReturnAck)(o,(0,u.toCoreAckTemplate)({id:String(i),class:"call",from:t,participant:null}));return{payload:(0,d.wapNodeToVoipXml)(l),status:200}}))).apply(this,arguments)}function O(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,n){const r=e.payload[2].findIndex((e=>"destination"===e[0])),a=e.payload[2][r];if(a){e.payload[0]!==E.TYPE_STR.OFFER&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("call offer check"));const n=a[2].map((e=>{const t=e[1].jid;return(0,h.createDeviceWidFromUserAndDevice)(t.user,"c.us",t.device)}));try{yield(0,f.ensureE2ESessions)(n)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Could not establish E2E session with all deviceWids`}let r=!1,o=!1;return yield Promise.all(a[2].map(function(){var t=(0,i.default)((function*(t,i){if(I(t[2])){const a=L(t[2]),s=n[i];try{const{encNode:n,shouldHaveIdentity:r}=yield D(a,s,N(e.payload[2]));o=o||r,R(t[2],n)}catch(e){__LOG__(3)`voip:encryptMsgCallKey: Signal encryption failed for ${s.toString()}, ${e}`,r=!0}}}));return function(){return t.apply(this,arguments)}}())),r?(__LOG__(3)`voip:encryptMsgCallKey: Removing all enc nodes due to encryption failure`,a[2].forEach((e=>w(e)))):o&&(yield U(e.payload[2])),(0,d.USER_JID)(t)}if(!I(e.payload[2]))return(0,d.DEVICE_JID)(t);try{const e=[t];if(t.isCompanion()){const n=(0,h.createDeviceWidFromUserAndDevice)(t.user,t.server,o.DEFAULT_DEVICE_ID);e.unshift(n)}yield(0,f.ensureE2ESessions)(e)}catch(e){__LOG__(3)`voip:encryptAndSendSignalingMsg: Could not establish E2E session with deviceWid`}const s=L(e.payload[2]);let l,c;try{const n=yield D(s,t,N(e.payload[2]));l=n.encNode,c=n.shouldHaveIdentity}catch(e){if(n!==E.TYPE.OFFER)throw e;l=null,c=!1,__LOG__(3)`voip:encryptAndSendSignalingMsg: Sending offer without enc`}return R(e.payload[2],l),c&&(yield U(e.payload[2])),(0,d.DEVICE_JID)(t)}))).apply(this,arguments)}function I(e){if(null==e)return!1;return e.findIndex((e=>"enc"===e[0]))>=0}function w(e){if(null==e)return;const t=e.findIndex((e=>"enc"===e[0]));e.splice(t,1)}function R(e,t){const n=e.findIndex((e=>"enc"===e[0]));n>=0&&(e[n]=t)}function N(e){var t;const n=e.find((e=>"enc"===e[0])),r=null==n||null===(t=n[1])||void 0===t?void 0:t.count;return null!=r?r:0}function L(e){const t=e.find((e=>"enc"===e[0])),n=null==t?void 0:t[2];return{call:{callKey:null!=n?new Uint8Array(n):null}}}function D(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e,t,n){const{type:r,ciphertext:i}=yield y.Cipher.encryptSignalProto(t,(0,m.encodeAndPad)(e));return{encNode:(0,s.wap)("enc",{v:(0,s.CUSTOM_STRING)(c.CIPHERTEXT_VERSION.toString()),type:(0,s.CUSTOM_STRING)(r),count:(0,s.INT)(n)},i),shouldHaveIdentity:r===l.CiphertextType.Pkmsg}}))).apply(this,arguments)}function U(){return G.apply(this,arguments)}function G(){return(G=(0,i.default)((function*(e){const t=yield(0,g.getADVEncodedIdentity)();e.push((0,s.wap)("device-identity",null,t))}))).apply(this,arguments)}},901480:(e,t,n)=>{"use strict";var r=n(595318);t.Z=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=n(796109),o=n(640623);function s(){return(s=(0,i.default)((function*(e){var t;const n=yield o.waSignalStore.getRegistrationInfo();if(!n)throw Error("No registration info found");const{identityKeyPair:r}=n,i=null!==(t=e[1]&&parseInt(e[1].count,10))&&void 0!==t?t:0,s=yield(0,a.prepareKeysForRetry)(i,r);return s&&e[2]&&Array.isArray(e[2])&&e[2].push(s),e}))).apply(this,arguments)}},126489:(e,t,n)=>{"use strict";var r=n(595318);t.Z=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(22469),l=n(696055),c=n(466863),u=n(745454);function d(){return(d=(0,i.default)((function*(e){const t=e.common,n=(0,u.createWid)(t.peer_jid);let r,i;n.isGroupCall()?(r=(0,l.GROUP_CALL_JID)(n),i=Promise.resolve()):(r=(0,l.DEVICE_JID)(n),i=(0,c.ensureE2ESessions)([n])),yield i;const d=(0,l.voipXmlToWapNode)(e.payload),p=(0,o.generateId)(),f=(0,o.wap)("call",{to:r,id:p},d),_=yield(0,a.sendStanzaAndReturnAck)(f,(0,s.toCoreAckTemplate)({id:String(p),class:"call",from:n,participant:null}));return{payload:(0,l.wapNodeToVoipXml)(_),status:200}}))).apply(this,arguments)}},317139:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(736184),o=n(831914),s=n(696055),l=n(640623),c=n(445473);function u(){return(u=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=yield l.waSignalStore.getRegistrationInfo();if(!r)throw Error("No registration info found");const i=(0,o.wap)("receipt",{to:(0,s.DEVICE_JID)(t.peer_jid),id:(0,o.CUSTOM_STRING)(e),type:(0,o.CUSTOM_STRING)(c.ENC_RETRY_RECEIPT_ATTRS.GROUP_CALL)},(0,o.wap)("enc_rekey",{"call-creator":(0,s.DEVICE_JID)(t.call_creator),"call-id":(0,o.CUSTOM_STRING)(t.call_id),count:(0,o.INT)(n+1)}),(0,o.wap)("registration",null,(0,o.BIG_ENDIAN_CONTENT)(r.registrationId)));(0,a.castStanza)(i)}))).apply(this,arguments)}},437880:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=n(645563),o=n(450796),s=n(252230),l=r(n(145095)),c=n(824214),u=n(49714),d=n(946308),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(959060)),f=n(971674),_=n(124808),h=n(484902),g=r(n(441143));function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}function y(){return(y=(0,i.default)((function*(e,t){var n;const r=t.payload[2]&&t.payload[2].find((e=>"enc"===e[0])),i=e.peer_jid;if(!r||!i)return{result:u.E2EProcessResult.SUCCESS};let a=0;(null===(n=r[1])||void 0===n?void 0:n.count)&&(a=parseInt(r[1].count,10)||0);const o={e2eType:r[1].type,mediaType:null,ciphertext:new Uint8Array(r[2]),retryCount:a,hideFail:!1};try{const e=t.payload[2].find((e=>"device-identity"===e[0]));if(null!=i.device&&i.device!==s.DEFAULT_DEVICE_ID&&o.e2eType===c.CiphertextType.Pkmsg&&!e)return __LOG__(2)`voip:validateAndDecryptEnc: expected device-identity with pkmsg enc`,{result:u.E2EProcessResult.PARSE_ERROR};if(e){const t=new Uint8Array(e[2]);if(!(yield(0,d.validateADVwithEncs)(i,t,[o])))return{result:u.E2EProcessResult.PARSE_ERROR};__LOG__(2)`voip:validateAndDecryptEnc: successfully validated ADV device-identity`}const{result:n,decrypted:p}=yield S(o,i);return n===u.E2EProcessResult.SUCCESS&&(r[2]=Array.prototype.slice.call(new Uint8Array((0,l.default)(p,"decrypted")))),{result:n,retryCount:a}}catch(e){return __LOG__(3)`voip:validateAndDecryptEnc error`,{result:u.E2EProcessResult.PARSE_ERROR}}}))).apply(this,arguments)}function S(e,t){return(0,g.default)(e.e2eType!==c.CiphertextType.Skmsg,"VoIP enc type should not be skmsg"),p.Cipher.decryptSignalProto(t,e.e2eType,e.ciphertext).then((e=>{var t;const n=(0,a.unpadPkcs7)(new Uint8Array(e)),r=(0,h.decodeProtobuf)(_.MessageSpec,n);return(null===(t=r.call)||void 0===t?void 0:t.callKey)?{result:u.E2EProcessResult.SUCCESS,decrypted:r.call.callKey}:{result:u.E2EProcessResult.PARSE_ERROR}})).catch((0,o.filteredCatch)(f.SignalDecryptionError,(e=>(__LOG__(3)`voip:decryptSignalProto failed with decryption error; ${e}`,{result:u.E2EProcessResult.RETRY})))).catch((e=>(__LOG__(3)`voip:decryptSignalProto failed with unexpected error; ${e}`,{result:u.E2EProcessResult.PARSE_ERROR})))}},304182:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=t.CONTACT_SYNC_CHUNK_SIZE=void 0;t.CONTACT_SYNC_CHUNK_SIZE=500;t.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS=20},633192:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncContactList=O,t.syncContactListInChunks=function(){return P.apply(this,arguments)};var i=r(n(348926)),a=r(n(145095)),o=n(413959),s=n(892844),l=n(227101),c=n(929723),u=n(698712),d=n(468728),p=n(272441),f=r(n(904285)),_=n(769315),h=n(546718),g=n(33723),m=n(4e4),y=n(745454),S=n(304182),E=n(2259),v=n(46133),T=n(991036),C=n(776214),A=n(209108),b=n(845222);function P(){return(P=(0,i.default)((function*(e){let{contactIds:t,shouldDelayBetweenChunks:n}=e;const r=S.CONTACT_SYNC_CHUNK_SIZE;__LOG__(2,void 0,void 0,void 0,["contact-sync"])`start contact sync for ${t.length} contacts in ${Math.ceil(t.length/r)} chunks, each chunk size: ${r}`;for(let e=0;e<t.length;e+=r){const i=t.slice(e,e+r);n&&(yield(0,o.delayMs)(1e3*S.SYNC_CONTACT_CHUNK_INTERVAL_SECONDS)),yield O({contactIds:i,shouldSyncDevice:!0})}}))).apply(this,arguments)}function O(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){let{contactIds:t,shouldSyncDevice:n}=e;if(0===t.length)return;const r=yield F(t),i=(new g.USyncQuery).withContext("background").withMode("full").withBusinessProtocol().withStatusProtocol().withPictureProtocol();n&&i.withDeviceProtocol(),(0,l.isDisappearingModeEnabled)()&&i.withDisappearingModeProtocol(),(0,E.lidUsyncEnabled)()&&i.withLidProtocol(),r.forEach((e=>{i.withUser((new m.USyncUser).withId(e.id).withDeviceHash(String(e.hash)))}));let a=null,s=3,c=10*Math.random();for(;s-- >0;)try{a=yield i.execute();const e=a.error.all;var u;if(e)throw c=null!==(u=e.errorBackoff)&&void 0!==u?u:10*Math.random(),new Error(`syncContactList: error ${e.errorCode}: ${e.errorText}`);s=0}catch(e){0===s&&(__LOG__(4,!0,new Error,!0)`failed to execute usync query`,SEND_LOGS("failed to execute usync query: "+e)),yield(0,o.delayMs)(1e3*c)}if(null==a||a.error.all)return;const d=a.refresh,p=[];for(const e of Object.keys(d))p.push(d[e]);if(p.length>0){Y(Math.min(...p))}yield Promise.all([n?x(a):Promise.resolve(),(0,l.isDisappearingModeEnabled)()?w(a):Promise.resolve(),(0,E.lidUsyncEnabled)()?N(a):Promise.resolve(),I(a),D(a),U(a)]),yield G(t)}))).apply(this,arguments)}function I(e){const t=e.error.status;t?__LOG__(3)`handleSyncStatus: failed ${t.errorCode} : ${t.errorText}`:e.list.map((e=>{const t=v.StatusCollection.get(e.id);t&&e.status&&t.set({status:e.status})}))}function w(){return R.apply(this,arguments)}function R(){return(R=(0,i.default)((function*(e){const t=e.error.status;t?__LOG__(3)`handleDisappearingMode: failed ${t.errorCode} : ${t.errorText}`:yield Promise.all(e.list.map(function(){var e=(0,i.default)((function*(e){e.disappearing_mode&&(yield(0,T.updateDisappearingMode)(e.id,e.disappearing_mode.duration,e.disappearing_mode.t))}));return function(){return e.apply(this,arguments)}}()))}))).apply(this,arguments)}function N(){return L.apply(this,arguments)}function L(){return(L=(0,i.default)((function*(e){var t;const n=e.error.lid;n&&__LOG__(3)`handleLidSync: error ${n.errorCode}: ${n.errorText}`;const r=[...e.list,...null!==(t=e.sideList)&&void 0!==t?t:[]].filter((e=>{let{lid:t}=e;return"string"==typeof t}));yield(0,b.createOrReplaceLidPnMappings)(r.map((e=>{let{id:t,lid:n}=e;return{pn:t.user,lid:(0,y.createUserWid)(n).user}})))}))).apply(this,arguments)}function D(){return k.apply(this,arguments)}function k(){return(k=(0,i.default)((function*(e){const t=e.list.filter((e=>{let{business:t}=e;return Boolean(t)}));yield(0,c.handleVerifiedNameSync)(t.map((e=>{let{id:t,business:{verifiedName:n}}=e;return{id:t,verifiedName:n}})))}))).apply(this,arguments)}function U(e){const t=e.error.pictures;t&&__LOG__(3)`handleSyncProfilePictures: failed ${t.errorCode} : ${t.errorText}`}function G(e){const t=e.map((e=>({id:(0,p.toPhoneUserJid)(e.user),isContactSyncCompleted:1})));return __LOG__(2,void 0,void 0,void 0,["contact-sync"])`mark ${t.length} contacts completed for contact sync`,(0,C.getContactTable)().bulkCreateOrMerge(t)}function x(){return B.apply(this,arguments)}function B(){return(B=(0,i.default)((function*(e){const t=e.error.devices;t&&__LOG__(3)`handleSyncDevice: error ${t.errorCode}: ${t.errorText}`;const n=e.list.filter((e=>e.devices&&null!=e.devices.deviceList&&null!=e.devices.keyIndex&&!("errorCode"in e.devices))).map((e=>({wid:e.id,devices:e.devices})));return __LOG__(2)`handleSyncDevice: skipping ${e.list.length-n.length} out of ${e.list.length} records`,yield(0,u.getAndStoreIdentityKeys)(n.map((e=>e.wid))),(0,d.handleADVDeviceSyncResult)(n)}))).apply(this,arguments)}function F(){return j.apply(this,arguments)}function j(){return(j=(0,i.default)((function*(e){const t=(yield(0,A.getDeviceIds)(e)).map((e=>null==e?[]:e.devices.map((t=>(0,y.createDeviceWidFromDeviceListPk)(e.id,t))))),n=yield Promise.all(t.map((e=>0===e.length?"":(0,_.phashV2)(e))));return e.map(((e,t)=>({id:e,hash:n[t]})))}))).apply(this,arguments)}function Y(e){Number.isNaN(e)||e<=s.HOUR_SECONDS?__LOG__(3,void 0,void 0,void 0,["contact-sync"])`invalid contact sync refresh period: ${e}`:(__LOG__(2,void 0,void 0,void 0,["contact-sync"])`set contact sync refresh period: ${e}`,(0,a.default)(f.default,"localStorage").setItem(h.KEYS.CONTACT_SYNC_REFRESH,String(e)))}},960764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_ALERT_TYPE=void 0;const r=n(76672)({LOW_QUOTA_EXCEEDED:"low_quota_exceed",HIGH_QUOTA_EXCEEDED:"high_quota_exceed",NO_ALERT:"no_alert"});t.STORAGE_ALERT_TYPE=r},963236:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=r(n(348926));function a(){return(a=(0,i.default)((function*(){const e=navigator.storage;if(null==(null==e?void 0:e.estimate))return null;const t=yield e.estimate();let{usage:n,quota:r,usageDetails:i}=t;Number.isFinite(n)||(n=0),Number.isFinite(r)||(r=0);return{usage:n,quota:r,available:r-n,caches:null==i?void 0:i.caches}}))).apply(this,arguments)}},346920:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_PARTICIPANT_TYPES=void 0;t.GROUP_PARTICIPANT_TYPES={superadmin:"superadmin",admin:"admin",participant:"participant"}},318615:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addParticipants=function(){return d.apply(this,arguments)},t.demoteCommmunityParticipants=function(e){let{group:t,participants:n,isOffline:r}=e;return(0,a.updateCommunityParticipants)(t,{action:o.PARTICIPANT_OPERATION.LINKED_GROUP_DEMOTE,participants:n},r)},t.demoteParticipants=function(e){let{group:t,participants:n,version:r,prevVersion:i,isOffline:s}=e;if(null==r)return Promise.reject(new Error("demoteParticipants: incoming change missing version id"));return(0,a.updateParticipants)(t,{action:o.PARTICIPANT_OPERATION.DEMOTE,participants:n,version:r,prevVersion:i},s)},t.promoteCommmunityParticipants=function(e){let{group:t,participants:n,isOffline:r}=e;return(0,a.updateCommunityParticipants)(t,{action:o.PARTICIPANT_OPERATION.LINKED_GROUP_PROMOTE,participants:n},r)},t.promoteParticipants=function(e){let{group:t,participants:n,version:r,prevVersion:i,isOffline:s}=e;if(null==r)return Promise.reject(new Error("promoteParticipants: incoming change missing version id"));return(0,a.updateParticipants)(t,{action:o.PARTICIPANT_OPERATION.PROMOTE,participants:n,version:r,prevVersion:i},s)},t.removeParticipants=function(e){let{group:t,participants:n,timestamp:r,author:i,version:s,prevVersion:l,isOffline:c}=e;if(null==s)return Promise.reject(new Error("removeParticipants: incoming change missing version id"));return(0,a.updateParticipants)(t,{action:o.PARTICIPANT_OPERATION.REMOVE,participants:n,timestamp:r,author:i,version:s,prevVersion:l},c)},t.updateParticipants=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(571059),o=n(104622),s=n(745454),l=r(n(869153)),c=n(264114);function u(){return(u=(0,i.default)((function*(e){let{group:t,participants:n,version:r,isOffline:i}=e;const o=[],s=[];n.forEach((e=>{e.isAdmin&&s.push(e.id),o.push(e.id)}));const l=yield p(o,i);return(0,a.replaceParticipants)({group:t,participants:o,admins:s,deviceIds:l,version:r})}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){let{group:t,participants:n,version:r,prevVersion:i,isOffline:s}=e;if(null==r)throw new Error("addParticipants: incoming change missing version id");const l=yield p(n,s);return(0,a.updateParticipants)(t,{action:o.PARTICIPANT_OPERATION.ADD,participants:n,deviceIds:l,version:r,prevVersion:i},s)}))).apply(this,arguments)}function p(){return f.apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];if(t)return e.forEach((e=>{l.default.addOfflinePendingDevice(String(e))})),e;n=yield(0,c.syncAndGetDeviceList)(e);let r=[];return n.forEach(((t,n)=>{if(t){const{id:e,devices:n}=t;r=r.concat(n.map((t=>(0,s.createDeviceWidFromDeviceListPk)(e,t))))}else r.push(e[n])})),r}))).apply(this,arguments)}},902182:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.extractDescription=_,t.extractLinkedParent=h,t.parseGroupNode=g,t.queryGroup=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=n(736184),s=n(831914),l=n(471914),c=n(492574),u=n(696055),d=n(181663),p=n(745454),f=n(346920);function _(e){if(e.hasChild("description")){const t=e.child("description");if(t.hasChild("body")){const e=t.child("body");if(e.hasContent()){const n={desc:e.contentString(),descId:t.attrString("id")};return t.hasAttr("participant")&&(n.descOwner=(0,d.userJidToUserWid)(t.attrUserJid("participant"))),t.hasAttr("t")&&(n.descTime=t.attrTime("t")),n}}}return null}function h(e){const t=e.maybeChild("linked_parent"),n=null==t?void 0:t.maybeAttrGroupJid("jid");return null==n?null:{parentGroup:(0,d.groupJidToWid)(n),parentGroupSubject:null==t?void 0:t.maybeAttrString("subject")}}function g(e){var t,n,r,i,o;const s=_(e),l=function(e){const t={subject:e.attrString("subject")};return e.hasAttr("s_o")&&(t.subjectOwner=(0,d.userJidToUserWid)(e.attrUserJid("s_o"))),e.hasAttr("s_t")&&(t.subjectTime=e.attrTime("s_t")),t}(e),c=function(e){if(e.hasChild("ephemeral")){const t=e.child("ephemeral");if(t.hasAttr("expiration"))return{ephemeralDuration:t.attrInt("expiration")}}return null}(e),u=function(e){const t=e.maybeChild("growth_locked"),n=null==t?void 0:t.maybeAttrInt("expiration"),r=null==t?void 0:t.maybeAttrString("type");return null==n||null==r?null:{growthLockExpiration:n,growthLockType:r}}(e),g=h(e);let m;try{m=(0,p.createWid)(`${e.attrString("id")}@g.us`)}catch(e){}if(!(null===(t=m)||void 0===t?void 0:t.isGroup))throw Error("createGroupReplyParser: invalid group id");const y=e.mapChildrenWithTag("participant",(e=>{const t=e.attrEnumOrDefault("type",f.GROUP_PARTICIPANT_TYPES,f.GROUP_PARTICIPANT_TYPES.participant);return{id:(0,d.userJidToUserWid)(e.attrUserJid("jid")),isSuperAdmin:t===f.GROUP_PARTICIPANT_TYPES.superadmin,isAdmin:t===f.GROUP_PARTICIPANT_TYPES.admin||t===f.GROUP_PARTICIPANT_TYPES.superadmin}})),S={id:m,owner:e.hasAttr("creator")?(0,d.userJidToUserWid)(e.attrUserJid("creator")):void 0,creation:e.attrTime("creation"),restrict:e.hasChild("locked"),announce:e.hasChild("announcement"),noFrequentlyForwarded:e.hasChild("no_frequently_forwarded"),participants:y,pvId:e.hasAttr("p_v_id")?e.attrInt("p_v_id"):void 0,support:e.hasChild("support"),size:e.hasAttr("size")?e.attrInt("size"):void 0,suspended:e.hasChild("suspended"),isParentGroup:null!==(n=e.hasChild("parent"))&&void 0!==n?n:void 0,numSubgroups:null!==(r=null===(i=e.maybeChild("parent"))||void 0===i?void 0:i.maybeAttrInt("num_sub_groups"))&&void 0!==r?r:0,defaultSubgroup:null!==(o=e.hasChild("default_sub_group"))&&void 0!==o?o:void 0};return(0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)((0,a.default)({},S),s),c),u),l),g)}const m=new l.WapParser("queryGroupParser",(e=>e.hasChild("group")?g(e.child("group")):{phashMatch:!0}));function y(){return(y=(0,i.default)((function*(e){const{groupWid:t,request:n,phash:r}=e,i=(0,s.wap)("iq",{to:(0,u.GROUP_JID)(t),type:"get",xmlns:"w:g2",id:(0,s.generateId)()},(0,s.wap)("query",{request:n||s.DROP_ATTR,phash:(0,s.MAYBE_CUSTOM_STRING)(r)})),a=yield(0,o.sendIq)(i,m);if(!a.success)return __LOG__(2)`queryGroup failed: ${a.errorCode}:${a.errorType}`,Promise.reject(new c.ServerStatusCodeError(a.errorCode,a.errorText));const{result:l}=a;return l.phashMatch?Promise.reject(new Error("queryGroup: phash match case is not implemented!")):l}))).apply(this,arguments)}},970041:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateDBForGroupAction=function(){return C.apply(this,arguments)};var i=r(n(348926)),a=n(450796),o=r(n(145095)),s=n(40234),l=n(520824),c=n(994493),u=n(381321),d=n(104622),p=n(368082),f=n(487944),_=n(795720),h=n(408139),g=n(555452),m=n(978820),y=n(506736),S=n(393717),E=n(810790),v=n(455981),T=n(543201);function C(){return(C=(0,i.default)((function*(e,t){var r,i,E;let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];__LOG__(2,void 0,void 0,void 0,["groups"])`inside _handleGroupActionMD`;const{chatId:b,author:P,pushname:O,ts:M=Date.now()/1e3}=e;P&&O&&(0,y.updatePushname)(P,O,C);const I=[],w=n(669951).ChatCollection.get(b);function R(e){return(0,u.persistGroupMetadata)(b,e,C)}switch(t.actionType){case _.GROUP_ACTIONS.ADD:I.push((0,f.addParticipantsJob)(b,t.participants,t.version,t.prevVersion,C).catch((0,a.filteredCatch)(d.GroupUnSyncedError,(()=>{__LOG__(3)`addParticipants: out-of-sync group notification`,A(b,C)}))));break;case _.GROUP_ACTIONS.REMOVE:I.push((0,f.removeParticipantsJob)(b,t.participants,M,e.author,t.version,t.prevVersion,C).catch((0,a.filteredCatch)(d.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,A(b,C)}))));const n=(0,m.getMaybeMeUser)();n&&t.participants.find((e=>e.equals(n)))&&((0,g.removeUserSentMessageToChat)(b),(0,T.setAdminshipCache)(b.toString(),!1));break;case _.GROUP_ACTIONS.DEMOTE:{const e=(0,m.getMaybeMeUser)();var N;if(e&&t.participants.find((t=>t.equals(e))))(0,h.communityAdminPromotionOneTimePromptEnabled)()&&(null==w||null===(N=w.groupMetadata)||void 0===N?void 0:N.groupType)===v.GroupType.COMMUNITY&&I.push(R({acknowledgedCadminPromotion:!1})),(0,T.setAdminshipCache)(b.toString(),!1);I.push((0,f.demoteParticipantsJob)(b,t.participants,t.version,t.prevVersion,C).catch((0,a.filteredCatch)(d.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,A(b,C)}))));break}case _.GROUP_ACTIONS.PROMOTE:{const e=(0,m.getMaybeMeUser)();var L;if(e&&t.participants.find((t=>t.equals(e))))(0,h.communityAdminPromotionOneTimePromptEnabled)()&&(null==w||null===(L=w.groupMetadata)||void 0===L?void 0:L.groupType)===v.GroupType.COMMUNITY&&I.push(R({acknowledgedCadminPromotion:!1})),(0,T.setAdminshipCache)(b.toString(),!0);I.push((0,f.promoteParticipantsJob)(b,t.participants,t.version,t.prevVersion,C).catch((0,a.filteredCatch)(d.GroupUnSyncedError,(()=>{__LOG__(3)`removeParticipants: out-of-sync group notification`,A(b,C)}))));break}case _.GROUP_ACTIONS.LINKED_GROUP_PROMOTE:if(t.jid){const e=t.jid;I.push((0,f.promoteCommunityParticipantsJob)(e,t.participants,C).catch((0,a.filteredCatch)(d.GroupUnSyncedError,(()=>{__LOG__(3)`linkedGroupPromote: out-of-sync group notification`,A(e,C)}))))}break;case _.GROUP_ACTIONS.LINKED_GROUP_DEMOTE:if(t.jid){const e=t.jid;I.push((0,f.demoteCommunityParticipantsJob)(e,t.participants,C).catch((0,a.filteredCatch)(d.GroupUnSyncedError,(()=>{__LOG__(3)`linkedGroupDemote: out-of-sync group notification`,A(e,C)}))))}break;case _.GROUP_ACTIONS.REVOKE_INVITE:const y=null===(r=(0,m.getMaybeMeUser)())||void 0===r?void 0:r.toString();if(!y)return void __LOG__(3)`getMaybeMeUser returned null, can't process action ${t}`;const O=null==P?void 0:P.toString();let k=[];if(null==O)return void __LOG__(3)`Received revoke without an admin jid ${t}`;if(O===y)k=t.participants.map((e=>({from:y,to:e.id.toString(),groupId:b.toString(),expiration:e.expiration})));else{const e=t.participants.find((e=>e.id.toString()===y));if(!e)return __LOG__(4,void 0,new Error,!0)`Received group invite revokation from ${O}, but user not in participants list`,void SEND_LOGS("bad-revoke");k=[{from:O,to:y,groupId:b.toString(),expiration:e.expiration}]}yield Promise.all(k.map((e=>(0,S.revokeGroupInvitesV4)(e.from,e.to,e.groupId,e.expiration))));break;case _.GROUP_ACTIONS.MODIFY:if(1!==t.participants.length){__LOG__(3)`_handleGroupActionMD: participants length should be 1, but is ${t.participants.length}`;break}I.push((0,p.modifyGroupParticipantJob)(b,(0,o.default)(P,"author"),t.participants[0],null!==(i=t.prevVersion)&&void 0!==i?i:-1,null!==(E=t.version)&&void 0!==E?E:-1));break;case _.GROUP_ACTIONS.SUBJECT:I.push(R({subject:t.subject}));break;case _.GROUP_ACTIONS.DESC_ADD:I.push(R({desc:t.desc,descId:t.descId,descTime:t.descTime,descOwner:null==P?void 0:P.toString()}));break;case _.GROUP_ACTIONS.DESC_REMOVE:I.push(R({desc:void 0,descId:void 0,descTime:void 0,descOwner:void 0}));break;case _.GROUP_ACTIONS.RESTRICT:I.push(R({restrict:!!t.value}));break;case _.GROUP_ACTIONS.SUSPEND:I.push(R({suspended:!!t.value}));break;case _.GROUP_ACTIONS.ANNOUNCE:I.push(R({announce:!!t.value}));break;case _.GROUP_ACTIONS.NO_FORWARD:I.push(R({noFrequentlyForwarded:!!t.value}));break;case _.GROUP_ACTIONS.EPHEMERAL:I.push(R({ephemeralDuration:t.duration}));break;case _.GROUP_ACTIONS.INVITE_CODE:break;case _.GROUP_ACTIONS.DELETE:var D;if(t.reason===_.DELETE_REASON.INTEGRITY_DELETE_PARENT)I.push(R({suspended:!0,terminated:!0})),(null==w||null===(D=w.groupMetadata)||void 0===D?void 0:D.parentGroup)&&I.push((0,u.persistGroupMetadata)(w.groupMetadata.parentGroup,{suspended:!0,terminated:!0},C));else I.push(R({terminated:!0}));break;case _.GROUP_ACTIONS.GROWTH_UNLOCKED:I.push(R({growthLockExpiration:void 0,growthLockType:void 0}));break;case _.GROUP_ACTIONS.GROWTH_LOCKED:"invite"===t.type&&I.push(R({growthLockExpiration:t.expiration,growthLockType:t.type}));break;case _.GROUP_ACTIONS.PARENT_GROUP_LINK:const U=t.groupDatas[0].id;I.push(R({parentGroup:U.toString()}));break;case _.GROUP_ACTIONS.SUB_GROUP_LINK:I.push((0,l.persistCommunityLink)(b,t.groupDatas,c.CommunityLinkOperation.SubGroupLink,C),R({lastActivityTimestamp:s.Clock.globalUnixTime()}));break;case _.GROUP_ACTIONS.SIBLING_GROUP_LINK:I.push((0,l.persistCommunityLink)(b,t.groupDatas,c.CommunityLinkOperation.SiblingGroupLink,C));break;case _.GROUP_ACTIONS.PARENT_GROUP_UNLINK:I.push(R({parentGroup:void 0}));break;case _.GROUP_ACTIONS.SUB_GROUP_UNLINK:I.push((0,l.persistCommunityLink)(b,t.groupDatas,c.CommunityLinkOperation.SubGroupUnlink,C));break;case _.GROUP_ACTIONS.SIBLING_GROUP_UNLINK:I.push((0,l.persistCommunityLink)(b,t.groupDatas,c.CommunityLinkOperation.SiblingGroupUnlink,C));break;case _.GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK:I.push(R({parentGroup:void 0})),I.push((0,u.persistGroupMetadata)(t.groupDatas[0].id,{suspended:!0,terminated:!0},C));break;case _.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE:case _.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_REQUEST:break;default:__LOG__(4,void 0,new Error,void 0,["groups"])`unhandled group notif action in handleGroupActionMD for action ${JSON.stringify(t)}`}yield Promise.all(I),__LOG__(2,void 0,void 0,void 0,["groups"])`finished all storageTasks`}))).apply(this,arguments)}function A(e,t){return t?(0,p.markGroupParticipantStaleJob)(e):(0,E.sendQueryGroup)(e)}},946308:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearADVSecretKey=function(){(0,u.setADVSecretKey)(void 0)},t.generateADVSecretKey=function(){const e=new Uint8Array(32);self.crypto.getRandomValues(e);const t=(0,a.encodeB64)(e);return(0,u.setADVSecretKey)(t),t},t.generateDeviceSignature=function(e,t,n){const r=e.details,i=o.Binary.build(O,r,t.pubKey,n).readByteArray().buffer;return self.libsignal.Curve.calculateSignature(t.privKey,i)},t.getADVEncodedIdentity=function(){return I.apply(this,arguments)},t.getADVSecretKey=function(){const e=(0,u.getADVSecretKey)();if(null==e)throw new Error("MD secretKey is null or undefined");return e},t.setADVSignedIdentity=function(e){if(null==e)return Promise.reject(new Error("MD advSignedDeviceIdentity is null or undefined"));if(null==e.deviceSignature)return Promise.reject(new Error("MD advSignedDeviceIdentity is missing deviceSignature"));return p.waSignalStore.putADVSignedIdentity(e)},t.validateADVwithEncs=function(){return b.apply(this,arguments)},t.validateADVwithIdentityKey=C,t.verifyDeviceIdentityAccountSignature=w,t.verifyDeviceSignature=R,t.verifyKeyIndexListAccountSignature=function(e,t){const n=e.details,r=e.accountSignature;(0,E.default)(null!=r,"accountSignature should not be null");const i=o.Binary.build(M,n).readByteArray();return(0,c.verifySignature)(new Uint8Array(t),i,new Uint8Array(r))};var i=r(n(348926)),a=n(615688),o=n(108584),s=n(51239),l=n(824214),c=n(138062),u=n(711597),d=n(745454),p=n(640623),f=n(572841),_=n(454753),h=r(n(876883)),g=n(21377),m=n(361438),y=n(484902),S=n(760980),E=r(n(441143)),v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=T(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(468728));function T(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(T=function(e){return e?n:t})(e)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{const i=(0,s.uint8ArrayToBuffer)(n),a=yield(0,_.getSignalProtocolStore)().loadIdentityKey((0,f.createSignalAddress)(e).toString());if(a){const e=(0,c.toCurveKeyPubKey)((0,f.strToBuffer)(a));if((0,f.bufferEqual)(e,i))return!0}const o=(0,y.decodeProtobuf)(m.ADVSignedDeviceIdentitySpec,t);(0,E.default)(null!=o,"advSignedDeviceIdentity should not be null");const l=yield h.default.loadIdentityKey((0,f.createSignalAddress)((0,d.toUserWid)(e)).toString()),u=l?(0,c.toCurveKeyPubKey)((0,f.strToBuffer)(l)):null;if(!w(o,i,u))return __LOG__(3)`validateADVIdentity: invalid account signature`,!1;if(!R(o,i,u))return __LOG__(3)`validateADVIdentity: invalid device signature`,!1;const p=(0,y.decodeProtobuf)(m.ADVDeviceIdentitySpec,o.details);(0,E.default)(null!=p,"advDeviceIdentity should not be null");try{yield null==v?void 0:v.handleADVDeviceUpdateForMessage(e,p,u,o.accountSignatureKey,i,r)}catch(e){return __LOG__(3)`validateADVIdentity: process adv device identity failed`,!1}return __LOG__(2)`validateADVIdentity: successfully verified accountSignature and deviceSignature`,!0}catch(e){return __LOG__(3)`validateADVIdentity: failed`,!1}}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=n.find((e=>e.e2eType===l.CiphertextType.Pkmsg));if(!i)return!0;__LOG__(2)`validateADVwithEncs: start validate prekey msg `;try{(0,E.default)(null!=e,"author should not be null");const n=(0,g.extractIdentityKey)(i.ciphertext);(0,E.default)(null!=n,"identityKey should not be null");const a=yield C(e,t,new Uint8Array(n),r);return yield(0,_.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),a}catch(e){return __LOG__(3)`validateADVwithEncs: failed ${e}`,!1}}))).apply(this,arguments)}const P=new Uint8Array([6,0]),O=new Uint8Array([6,1]),M=new Uint8Array([6,2]);function I(){return(I=(0,i.default)((function*(){const e=yield p.waSignalStore.getADVSignedIdentity();if(null==e)throw new Error("MD advSignedDeviceIdentity is null or undefined");if(null==e.deviceSignature)throw new Error("MD advSignedDeviceIdentity is missing deviceSignature");return(0,S.encodeProtobuf)(m.ADVSignedDeviceIdentitySpec,e).readByteArray()}))).apply(this,arguments)}function w(e,t,n){const r=e.details,i=e.accountSignatureKey||n;(0,E.default)(null!=i,"accountSignatureKey should not be null");const a=e.accountSignature;(0,E.default)(null!=a,"accountSignature should not be null");const s=o.Binary.build(P,r,t).readByteArray();return(0,c.verifySignature)(new Uint8Array(i),s,new Uint8Array(a))}function R(e,t,n){const r=e.details,i=e.deviceSignature;(0,E.default)(null!=i,"deviceSignature should not be null");const a=e.accountSignatureKey||n;(0,E.default)(null!=a,"accountSignatureKey should not be null");const s=o.Binary.build(O,r,t,a).readByteArray();return(0,c.verifySignature)(new Uint8Array(t),s,new Uint8Array(i))}},518634:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.computeIdentityHash=y,t.getICDCMeta=function(){return m.apply(this,arguments)};var i=r(n(348926)),a=n(273045),o=n(252230),s=r(n(145095)),l=n(427764),c=n(892844),u=n(257243),d=n(138062),p=n(978820),f=n(745454),_=n(156592),h=r(n(876883)),g=n(209108);function m(){return(m=(0,i.default)((function*(e){if(!1===(0,u.getABPropConfigValue)("md_icdc_enabled"))return null;const t=yield(0,g.getDeviceRecord)(e);if(!t||t.deleted)return null;const n={keyHash:void 0,timestamp:void 0},{timestamp:r,devices:i,id:a}=t,l=i.some((e=>e.id!==o.DEFAULT_DEVICE_ID));if(l){const t=i.map((e=>[e.keyIndex,(0,f.createDeviceWidFromDeviceListPk)(a,e.id)])),r=[];let o=null;t.forEach((e=>{let[t,n]=e;(0,p.isMeDevice)(n)?o=t:r.push([t,n])}));const l=yield(0,_.getAllIdentityKeysBytes)(r.map((e=>{let[,t]=e;return t}))),c=[],u=[];if(l.forEach(((e,t)=>{null!=e&&(c.push(e),u.push(r[t][0]))})),(0,p.isMeAccount)(e)){const e=yield h.default.getIdentityKeyPair();if(!e)return null;c.push(new Uint8Array(e.pubKey)),u.push((0,s.default)(o,"myKeyIndex"))}const g=E();n.keyHash=yield y(c.map((e=>new Uint8Array((0,d.toCurveKeyPubKey)(e.buffer)))),g),u.length!==i.length&&(n.keyIndexes=u)}return(l||v(r))&&(n.timestamp=r),n}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t){const n=(0,_.identityKeysToBinary)(e),r=yield(0,a.sha256)(n),i=new Uint8Array(r);return(0,l.sliceBytes)(i,0,t)}))).apply(this,arguments)}function E(){const e=(0,u.getABPropConfigValue)("md_icdc_hash_length");return Math.max(e,8)}function v(e){return(0,c.unixTime)()-e<2592e3}},156592:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAllIdentityKeysBytes=u,t.getAllIdentityKeysBytesOrThrow=function(){return c.apply(this,arguments)},t.identityKeysToBinary=function(e){const t=new a.Binary;return e.sort(l).forEach((e=>{t.writeByteArray(e)})),t.readByteArray()};var i=r(n(348926)),a=n(108584),o=n(572841),s=r(n(876883));function l(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return e[n]-t[n];return e.length-t.length}function c(){return(c=(0,i.default)((function*(e){return(yield u(e)).map(((t,n)=>{if(null==t)throw new Error(`getAllIdentityKeys: missing identity key for device ${String(e[n])}`);return t}))}))).apply(this,arguments)}function u(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){return(yield s.default.bulkLoadIdentityKey(e.map((e=>(0,o.createSignalAddress)(e).toString())))).map((e=>null==e?null:new Uint8Array((0,o.strToBuffer)(e))))}))).apply(this,arguments)}},145789:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptE2EPayload=function(){return v.apply(this,arguments)};var i=r(n(348926)),a=n(450796),o=n(166751),s=n(824214),l=n(760210),c=n(1201),u=n(306303),d=n(312037),p=n(49714),f=n(946308),_=E(n(959060)),h=n(971674),g=n(454753),m=r(n(11339)),y=E(n(953348));function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function E(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function v(){return(v=(0,i.default)((function*(e){const{bizInfo:t,msgInfo:n,paymentInfo:r,deviceIdentity:s,encs:_,msgMeta:S}=e;if(null!=n.author.device&&0!==n.author.device){if(!(yield(0,f.validateADVwithEncs)(n.author,s,_,!!n.offline)))return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, validateADVIdentity failed`,{result:p.E2EProcessResult.RETRY,retryCount:_[0].retryCount}}const E=yield(0,o.promiseReduce)(e.encs,((e,o)=>{if(e.result!==p.E2EProcessResult.SUCCESS)return Promise.resolve(e);const s=(0,c.getFrom)(n),f=new m.default.E2eMessageRecv({e2eCiphertextType:(0,l.getMetricE2eCiphertextType)(o.e2eType),e2eCiphertextVersion:l.CIPHERTEXT_VERSION,e2eDestination:(0,l.getMetricE2eDestination)(s),e2eSuccessful:!1,messageMediaType:o.mediaType?(0,l.metricsMediaType)(o.mediaType):m.default.MEDIA_TYPE.NONE,retryCount:o.retryCount});return T(o,s,n.author).then(function(){var e=(0,i.default)((function*(e){f.e2eSuccessful=!0,f.weight=1e3,f.commit();const i={retryCount:o.retryCount,e2eType:o.e2eType,mediaType:o.mediaType,hideFail:o.hideFail};return __LOG__(2,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId} done`,yield y.processDecryptedProto(e,n,r,i,t,void 0,S),__LOG__(2,void 0,void 0,void 0,["messaging"])`processDecryptedProto: msgId::${n.externalId} done`,{result:p.E2EProcessResult.SUCCESS}}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([h.SignalDecryptionError,u.UnknownMessageError],function(){var e=(0,i.default)((function*(e){return __LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, ${e.toString()}`,f.weight=1,f.commit(),o.hideFail||(yield y.processPlaceholderMsg(n,p.PlaceholderType.E2E)),{result:p.E2EProcessResult.RETRY,retryCount:o.retryCount}}));return function(){return e.apply(this,arguments)}}())).catch((0,a.filteredCatch)(h.SignalMessageCounterError,(e=>(__LOG__(3,void 0,void 0,void 0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, signal counter error: ${e}`,{result:p.E2EProcessResult.SUCCESS})))).catch((0,a.filteredCatch)(d.HsmMismatchError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: hsm mismatch error"),f.weight=1,f.commit(),{result:p.E2EProcessResult.HSM_MISMATCH})))).catch((0,a.filteredCatch)(u.ReactionValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: ReactionValidationError"),{result:p.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((0,a.filteredCatch)(u.PollCreationValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging","polls"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, code: ${e.code}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: PollCreationValidationError"),{result:p.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((0,a.filteredCatch)(u.PollUpdateValidationError,(e=>(__LOG__(3,void 0,void 0,!0,["messaging","polls"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, code: ${e.code}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: PollUpdateValidationError"),{result:p.E2EProcessResult.PARSE_VALIDATION_ERROR})))).catch((e=>(__LOG__(3,void 0,void 0,!0,["messaging"])`decryptE2EPayload: msgId::${n.externalId}, error: ${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("handleMsg: parse decrypted message error"),f.weight=1,f.commit(),{result:p.E2EProcessResult.PARSE_ERROR})))}),{result:p.E2EProcessResult.SUCCESS});return yield(0,g.getSignalProtocolStore)().flushBufferToDiskIfNotMemOnlyMode(),E}))).apply(this,arguments)}function T(e,t,n){const{e2eType:r,ciphertext:i}=e;switch(r){case s.CiphertextType.Skmsg:return t.isGroup()||t.isBroadcast()?n?_.Cipher.decryptGroupSignalProto(t,n,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`)):Promise.reject(new Error(`['messaging'] decryptEnc: Can not do skmsg for non group ${t.toString()}`));case s.CiphertextType.Pkmsg:case s.CiphertextType.Msg:const e=t.isUser()?t:n;return e?_.Cipher.decryptSignalProto(e,r,i):Promise.reject(new Error(`['messaging'] decryptEnc: receive msg from ${t.toString()} without participant`))}}},1201:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPlaceholderMsg=function(){return R.apply(this,arguments)},t.generateBaseMsg=N,t.getDeviceType=U,t.getFrom=function(e){return e.type===m.MESSAGE_TYPE.CHAT?e.author:e.chat},t.messageInfoToKey=k,t.parseMessage=function(){return E.apply(this,arguments)},t.placeholderCheck=w;var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(535470),l=n(824214),c=r(n(465212)),u=n(115461),d=n(978820),p=r(n(389867)),f=n(745454),_=r(n(11339)),h=n(247343),g=n(306303),m=n(49714),y=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(363069));function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function E(){return(E=(0,a.default)((function*(e,t,n,r,i){var a,o,s,c;let u,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(null!=(null===(a=n.protocolMessage)||void 0===a?void 0:a.historySyncNotification)){u={history:y.parseMsgProto(n,N(e),"relay",r,void 0,void 0,i).historySyncMetaData}}else if(null!=(null===(o=n.protocolMessage)||void 0===o?void 0:o.initialSecurityNotificationSettingSync)){var _;u={securityNotificationEnabled:{isEnabled:null===(_=n.protocolMessage.initialSecurityNotificationSettingSync.securityNotificationEnabled)||void 0===_||_}}}else if(null!=(null===(s=n.protocolMessage)||void 0===s?void 0:s.appStateSyncKeyShare))u={appStateSyncKeyShare:n.protocolMessage.appStateSyncKeyShare};else if(null!=(null===(c=n.protocolMessage)||void 0===c?void 0:c.appStateSyncKeyRequest))u={appStateSyncKeyRequest:n.protocolMessage.appStateSyncKeyRequest};else switch(e.type){case m.MESSAGE_TYPE.CHAT:u=(0,d.isMeAccount)(e.author)?yield v(e,n,r,i,p,f):yield b(e,n,r,i,p,f);break;case m.MESSAGE_TYPE.GROUP:u=(0,d.isMeAccount)(e.author)&&e.isDirect?yield v(e,n,r,i,p,f):yield b(e,n,r,i,p,f);break;case m.MESSAGE_TYPE.PEER_BROADCAST:if(t===l.CiphertextType.Skmsg){if(!e.bclHashValidated)throw new Error("parseMessage: participants for peer broadcast message is not validated");u=yield b(e,n,r,i,p,f)}else u=yield C(e,n,r,i,p,f);break;case m.MESSAGE_TYPE.OTHER_BROADCAST:u=yield b(e,n,r,i,p,f);break;case m.MESSAGE_TYPE.DIRECT_PEER_STATUS:u=e.isDirect?yield v(e,n,r,i,p,f):yield C(e,n,r,i,p,f);break;case m.MESSAGE_TYPE.OTHER_STATUS:u=yield b(e,n,r,i,p,f);break;default:throw new Error("Unrecognized MESSAGE_TYPE")}return u}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{deviceSentMessage:s}=t;if(null==s)throw new g.DeviceSentMessageError(U(e.author),_.default.DSM_ERROR.MISSING_DSM);if(null==s.destinationJid)throw new g.DeviceSentMessageError(U(e.author),_.default.DSM_ERROR.INVALID_DSM);const{destinationJid:l}=s,c=yield O(e,s.message,n,r,a,o);return(0,i.default)({deviceSent:{destination:(0,f.createWid)(l)}},c)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,a.default)((function*(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const{deviceSentMessage:s}=t;if(null==s)throw new g.DeviceSentMessageError(U(e.author),_.default.DSM_ERROR.MISSING_DSM);if(null==s.phash)throw new g.DeviceSentMessageError(U(e.author),_.default.DSM_ERROR.INVALID_DSM);const{phash:l}=s,c=yield O(e,s.message,n,r,a,o);return(0,i.default)({deviceSent:{phash:l,info:e}},c)}))).apply(this,arguments)}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e,t,n,r,a){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(null!=t.deviceSentMessage)throw new g.DeviceSentMessageError(U(e.author),_.default.DSM_ERROR.INVALID_SENDER);const s=yield O(e,t,n,r,a,o);return(0,i.default)({deviceSent:null},s)}))).apply(this,arguments)}function O(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t,r,a,o){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(null==t)return{senderKey:null,storeMsg:null,renderableMsgs:[]};let l=y.parseMsgProto(t,N(e),"relay",r,void 0,void 0,a,e.edit);{var c;const e=n(471682).genDirectConnectionMessageModifiers;l=(0,i.default)((0,i.default)({},l),yield e(l.type,null===(c=l.list)||void 0===c?void 0:c.listType,l.businessOwnerJid))}const p=null!=t.senderKeyDistributionMessage?I(e,t.senderKeyDistributionMessage):null,f=l.type===u.MSG_TYPE.UNKNOWN&&null==p;let _=null;if(f&&(l.futureproofBuffer=o),e.type===m.MESSAGE_TYPE.OTHER_STATUS&&(l.campaignId=e.campaignId,l.campaignDuration=e.campaignDuration),e.type===m.MESSAGE_TYPE.PEER_BROADCAST&&(l.broadcastId=e.chat,l.broadcastParticipants=e.bclParticipants,l.broadcastEphSettings=e.bclEphSettings,_=l),e.type===m.MESSAGE_TYPE.OTHER_BROADCAST){l.broadcastId=e.chat;const t=e.ephSetting,n=l.ephemeralSharedSecret;if(null!=t&&null!=n){const{ephemeralDuration:r,ephemeralSettingTimestamp:i}=yield(0,h.decodeBroadcastEphemeralSetting)(e.chat,(0,d.getMeUser)(),e.author,t,n);l.ephemeralDuration=r,l.ephemeralSettingTimestamp=i}}const g=l.type===u.MSG_TYPE.UNKNOWN&&null==l.subtype,S=Boolean(g&&s);let E=[];return g&&null!=p||S?S&&__LOG__(2,void 0,void 0,void 0,["messaging"])`parseContentMessage: msgId::${e.externalId}: hide placeholder`:e.type===m.MESSAGE_TYPE.PEER_BROADCAST?E=yield L(l,e.bclParticipants,e.bclEphSettings):("payment_transaction_request_cancelled"!==l.subtype&&"payment_action_request_declined"!==l.subtype||null!=l.paymentRequestMessageKey)&&"non_renderable"!==l.subtype&&(E=[l]),{senderKey:p,storeMsg:_,renderableMsgs:E}}))).apply(this,arguments)}function I(e,t){if(!e.chat.isGroup()&&!e.chat.isBroadcast())throw new Error("should not have senderkey");const{groupId:n,axolotlSenderKeyDistributionMessage:r}=t;if(null==n||e.chat.toString({legacy:!0})!==n)throw new Error(`senderKeyDistributionMessage: from ${e.chat.toString()} mismatched to ${n||"null"}`);if(!r)throw new Error(`senderKeyDistributionMessage: from ${e.author.toString()} has no content`);return{groupId:n,key:r}}function w(e){return e.edit!==s.EDIT_ATTR.SENDER_REVOKE||e.type===m.MESSAGE_TYPE.PEER_BROADCAST}function R(){return(R=(0,a.default)((function*(e,t){if(!w(e))return[];const r=N(e);if(t===m.PlaceholderType.E2E?r.type=u.MSG_TYPE.CIPHERTEXT:(r.type=u.MSG_TYPE.CIPHERTEXT,r.subtype="fanout"),e.type===m.MESSAGE_TYPE.PEER_BROADCAST){r.broadcastParticipants=e.bclParticipants,r.broadcastEphSettings=e.bclEphSettings;(0,n(584886).storeMessages)([r],r.id.remote);if(e.edit===s.EDIT_ATTR.SENDER_REVOKE)return[];return yield L(r,e.bclParticipants)}return[r]}))).apply(this,arguments)}function N(e){const t=k(e),n=(0,d.getMeUser)(),r=t.fromMe&&n.equals(e.chat),i={id:t,from:t.fromMe?n:t.remote,to:t.fromMe?t.remote:n,type:u.MSG_TYPE.UNKNOWN,t:e.ts||0,ack:r?s.ACK.READ:s.ACK.SENT,author:!t.fromMe&&p.default.isGroup(t.remote)||p.default.isStatusV3(t.remote)?t.participant:void 0,broadcast:!1,notifyName:e.pushname||""};return null!=e.count&&(i.count=e.count),i}function L(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t,n){return(yield Promise.all(t.map(function(){var t=(0,a.default)((function*(t){let r,a,o;try{r=new c.default({remote:t,fromMe:!0,id:e.id.id})}catch(e){return __LOG__(3)`drop: cannot create MsgKey: ${e.stack}`,null}const s=n?n[t.toString()]:null,l=e.ephemeralSharedSecret,u=e.broadcastId;null!=u&&null!=s&&null!=l&&({ephemeralDuration:a,ephemeralSettingTimestamp:o}=yield(0,h.decodeBroadcastEphemeralSetting)(u,t,(0,d.getMeUser)(),s,l));const p=(0,i.default)((0,i.default)({},e),{},{id:r,from:(0,d.getMeUser)(),to:t,broadcast:!0,ephemeralDuration:a,ephemeralSettingTimestamp:o});return e.protocolMessageKey&&(p.protocolMessageKey=new c.default({remote:t,fromMe:!0,id:e.protocolMessageKey.id})),p}));return function(){return t.apply(this,arguments)}}()))).filter(Boolean)}))).apply(this,arguments)}function k(e){return e.type===m.MESSAGE_TYPE.OTHER_BROADCAST?new c.default({remote:(0,f.toUserWid)(e.author),fromMe:!1,id:e.externalId}):e.type===m.MESSAGE_TYPE.CHAT?new c.default({remote:e.chat,fromMe:(0,d.isMeAccount)(e.author),id:e.externalId}):new c.default({remote:e.chat,fromMe:(0,d.isMeAccount)(e.author),participant:(0,f.toUserWid)(e.author),id:e.externalId})}function U(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID?_.default.DEVICE_TYPE.PRIMARY:_.default.DEVICE_TYPE.COMPANION}},940357:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.extractPollVotes=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=r(n(145095)),o=n(237540),s=n(396177),l=n(79653),c=n(20853),u=n(745454),d=n(306303);function p(){return(p=(0,i.default)((function*(e){return(yield Promise.allSettled(Array.from(e.entries()).map((e=>{let[t,n]=e;return f(t,n)})))).map((e=>{switch(e.status){case"fulfilled":return e.value;case"rejected":const{reason:t}=e;if(t instanceof d.PollVoteValidationError)return __LOG__(4,void 0,new Error,!0)`Poll vote extraction failed: ${t.code}`,void SEND_LOGS(t.code);__LOG__(4,void 0,new Error,!0)`Poll vote extraction failed: ${t.message}\n${t.stack}`,SEND_LOGS("poll-vote-extraction-unknown-error")}})).filter(Boolean)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){const n=(0,a.default)(t.messageSecret,"parentMsg.messageSecret"),r=(0,a.default)(t.pollSelectableOptionsCount,"parentMsg.pollSelectableOptionsCount"),i=(0,a.default)(t.pollOptions,"parentMsg.pollOptions"),p=(0,a.default)(e.encPollVote,"pollUpdateMsg.encPollVote");if(32!==n.byteLength)throw new d.PollVoteValidationError(d.PollVoteValidationErrorCode.INVALID_MESSAGE_SECRET);const f=(0,u.toUserWid)((0,o.getSender)(e)),_=yield(0,l.decryptPollVote)({encryptedVote:p.encPayload,iv:p.encIv,messageSecret:n,stanzaId:t.id.id,pollCreationSender:(0,u.toUserWid)((0,o.getSender)(t)),voteSender:f}),h=_.selectedOptions.length;if(h>i.length||0!==r&&h>r)throw new d.PollVoteValidationError(d.PollVoteValidationErrorCode.INVALID_OPTIONS_COUNT);if(_.selectedOptions.some((e=>32!==e.byteLength)))throw new d.PollVoteValidationError(d.PollVoteValidationErrorCode.INVALID_OPTION);const g=yield(0,s.createPollOptionLocalIdMap)(i);if(!g.includesHashes(_.selectedOptions))throw new d.PollVoteValidationError(d.PollVoteValidationErrorCode.OPTION_NOT_FOUND);return(0,c.voteFromProtobuf)({voteProtobuf:_,pollVoteMsgKey:e.id,parentMsgKey:(0,a.default)(e.pollUpdateParentKey,"pollUpdateMsg.pollUpdateParentKey"),sender:f,senderTimestampMs:(0,a.default)(e.senderTimestampMs,"pollUpdateMsg.senderTimestampMs"),pollOptionLocalIdMap:g})}))).apply(this,arguments)}},627558:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeBytes=c,t.decodeUrl=function(e){return e&&!e.includes("/u/")?e:void 0},t.parseContactMessageProto=function(e,t){e.type=a.MSG_TYPE.VCARD,e.vcardFormattedName=t.displayName,e.body=t.vcard},t.parseContactsArrayMessageProto=function(e,t){const n=t.contacts;e.type=a.MSG_TYPE.MULTI_VCARD,e.vcardFormattedName=t.displayName,e.vcardList=Array.isArray(n)?n.map((e=>({displayName:e.displayName,vcard:e.vcard}))):[]},t.parseInviteGrpType=function(e){switch(e){case s.Message$ExtendedTextMessage$InviteLinkGroupType.PARENT:return l.GroupType.COMMUNITY;case s.Message$ExtendedTextMessage$InviteLinkGroupType.SUB:return l.GroupType.SUBGROUP;case s.Message$ExtendedTextMessage$InviteLinkGroupType.DEFAULT_SUB:return l.GroupType.DEFAULT_ANNOUNCEMENT_GROUP;default:return l.GroupType.DEFAULT}},t.parseLocationMessageProto=function(e,t){const n=t.name&&t.address?`${t.name}\n${t.address}`:t.name||t.address||"";e.type=a.MSG_TYPE.LOCATION,e.lat=void 0!==t.degreesLatitude?t.degreesLatitude:void 0,e.lng=void 0!==t.degreesLongitude?t.degreesLongitude:void 0,e.loc=n,e.body=c(t.jpegThumbnail)||"",e.clientUrl=t.url},t.validateRequiredMediaProperties=function(e,t){var n;if(Math.random()>.001)return;if(!e.id)return;if("status"===(null===(n=e.id.remote)||void 0===n?void 0:n.user)&&o.default.isPSA(e.author)&&!t.staticUrl)return;if(e.id.fromMe)return;const r=e.type;null==t.directPath&&null==t.fileEncSha256?(__LOG__(2,void 0,void 0,!0)`directPath and fileEncSha256 missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-direct-path-and-file-enc`)):null==t.directPath?(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-direct-path`)):null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-file-enc`));null==t.url&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) is missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-mms3-url`));null==t.mediaKey&&(__LOG__(2,void 0,void 0,!0)`mediaKey is missing from msg type ${r}`,SEND_LOGS(`${r}-message-missing-media-key`))};var i=n(615688),a=n(115461),o=r(n(389867)),s=n(124808),l=n(455981);function c(e){return e?(0,i.encodeB64)(e):void 0}},971446:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setMainStreamModeReadyT=function(){},t.setStartCommsT=function(){};n(555452)},276802:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RESEND_TIMEOUT_IN_SECONDS=void 0,t.createMessageResendMetric=function(e,t){const n=(0,i.default)({e2eBackfill:!0,messageType:e.getWamMessageType(),messageIsRevoke:t,messageSendResultIsTerminal:!1,isViewOnce:Boolean(e.isViewOnce),isAReply:e.isReply()},(0,y.getGroupMetricsFromChatWid)(e.to));return new S.default.MessageSend(n)},t.editAttribute=function(e,t){if(C(e)){const e="admin_revoke"===t?c.EDIT_ATTR.ADMIN_REVOKE:c.EDIT_ATTR.SENDER_REVOKE;return(0,s.CUSTOM_STRING)(String(e))}if(A(e))return(0,s.CUSTOM_STRING)(String(c.EDIT_ATTR.SENDER_REVOKE));if(function(e){return null!=e.keepInChatMessage&&null!=e.keepInChatMessage.key&&!0===e.keepInChatMessage.key.fromMe&&e.keepInChatMessage.keepType===m.KeepType.UNDO_KEEP_FOR_ALL}(e))return(0,s.CUSTOM_STRING)(String(c.EDIT_ATTR.SENDER_REVOKE));return s.DROP_ATTR},t.encodeAndPad=function(e){const t=(0,T.encodeProtobuf)(m.MessageSpec,e);return(0,h.writeRandomPadMax16)(t),t.readByteArray()},t.filterDeviceWithChangedIdentity=function(){return M.apply(this,arguments)},t.isPrimaryDevice=function(e){return null==e.device||e.device===o.DEFAULT_DEVICE_ID},t.isRevokeMsg=C,t.isRevokeReactionMsg=A,t.populateICDCMeta=function(){return P.apply(this,arguments)},t.sendMsgAckSyncParser=void 0,t.updateIdentityRange=function(){return O.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(831914),l=n(471914),c=n(535470),u=n(615947),d=n(867811),p=n(978820),f=n(745454),_=n(518634),h=n(572841),g=r(n(876883)),m=n(124808),y=n(542515),S=r(n(11339)),E=n(290981),v=n(325397),T=n(760980);function C(e){return null!=e.protocolMessage&&e.protocolMessage.type===m.Message$ProtocolMessage$Type.REVOKE}function A(e){return null!=e.reactionMessage&&e.reactionMessage.text===d.REVOKED_REACTION_TEXT}t.RESEND_TIMEOUT_IN_SECONDS=300;const b=new l.WapParser("sendMsgAckSyncParser",(e=>(e.assertTag("ack"),{t:e.attrTime("t"),sync:e.hasAttr("sync")?e.attrString("sync"):null,phash:e.hasAttr("phash")?e.attrString("phash"):null,count:e.hasAttr("count")?e.attrInt("count"):null})));function P(){return(P=(0,a.default)((function*(e,t){const n=(0,p.getMeUser)();let r,i;try{r=yield(0,_.getICDCMeta)(n)}catch(e){throw new S.default.AdvMetadataCreationFailure({advMetadataIsMe:!0}).commit(),e}try{i=e.equals(n)?null:yield(0,_.getICDCMeta)(e)}catch(e){throw new S.default.AdvMetadataCreationFailure({advMetadataIsMe:!1}).commit(),e}(0,u.populateMessageContextInfo)(t,r,i)}))).apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e,t){const n=yield(0,E.getTable)().get(String(e),!1);null!=(null==n?void 0:n.rowId)&&(yield g.default.updateIdentityRangeAfterEncryption(n.rowId,t.map((e=>(0,h.createSignalAddress)(e).toString()))))}))).apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e,t){const n=yield(0,E.getTable)().get(String(e),!1),r=null==n?void 0:n.rowId;if(null==r)return __LOG__(2)`filterDeviceWithChangedIdentity: get message with empty rowId`,[];const i=new Map;t.forEach((e=>{i.set((0,v.createDeviceListPK)(e),e)}));const a=Array.from(i.values()).map((e=>(0,f.createDeviceWidFromUserAndDevice)(e.user,e.server,o.DEFAULT_DEVICE_ID))),s=yield g.default.bulkGetIdentityRowId(a.map((e=>(0,h.createSignalAddress)(e).toString()))),l=new Set;return s.forEach(((e,t)=>{const n=a[t];(null==e||e>r)&&l.add((0,v.createDeviceListPK)(n))})),t.filter((e=>!l.has((0,v.createDeviceListPK)(e))))}))).apply(this,arguments)}t.sendMsgAckSyncParser=b},680168:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptGroupSignalProto=function(){return p.apply(this,arguments)},t.decryptSignalProto=function(){return u.apply(this,arguments)},t.encryptSenderKeyMsgSignalProto=function(){return f.apply(this,arguments)},t.encryptSignalProto=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(824214),o=n(978820),s=n(971674),l=n(454753),c=n(572841);function u(){return(u=(0,i.default)((function*(e,t,n){const r=new self.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e));try{const e=yield Promise.resolve(r);let i;switch(t){case a.CiphertextType.Pkmsg:i=yield e.decryptPreKeyWhisperMessage(n);break;case a.CiphertextType.Msg:i=yield e.decryptWhisperMessage(n);break;default:return Promise.reject(new Error(`decryptSignalProto: Received unsupported msg type ${t}`))}return i}catch(e){if(e&&"call_failure"===e.reason&&e.value&&"number"==typeof e.value.result)__LOG__(3)`decryptSignalProto error code ${e.value.result}`;else{if(e&&"MessageCounterError"===e.name)return Promise.reject(new s.SignalMessageCounterError(e));__LOG__(3)`decryptSignalProto js error ${e}`}return Promise.reject(new s.SignalDecryptionError(e))}}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){const n=yield new self.libsignal.SessionCipher((0,l.getSignalProtocolStore)(),(0,c.createSignalAddress)(e)),{type:r,body:i}=yield n.encrypt(t);return __LOG__(2)`encryptSignalProto complete, type=${r}`,{type:3===r?a.CiphertextType.Pkmsg:a.CiphertextType.Msg,ciphertext:(0,c.strToBuffer)(i)}}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,n){try{const r=yield new self.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)(t));return yield r.decryptSenderKeyMessage(n)}catch(e){if(e&&"MessageCounterError"===e.name)throw new s.SignalMessageCounterError(e);throw new s.SignalDecryptionError(e)}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const n=new self.libsignal.GroupCipher((0,l.getSignalProtocolStore)(),e.toString({legacy:!0}),(0,c.createSignalAddress)((0,o.assertGetMe)())),r=yield Promise.resolve(n).then((e=>e.encrypt(t)));return{ciphertext:(0,c.strToBuffer)(r)}}))).apply(this,arguments)}},971674:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalMessageCounterError=t.SignalDecryptionError=void 0;var r=n(640265);class i extends((0,r.customError)("SignalDecryptionError")){}t.SignalDecryptionError=i;class a extends((0,r.customError)("SignalMessageCounterError")){}t.SignalMessageCounterError=a},640623:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waSignalStore=void 0;var r=n(400318),i=n(677246);const a="signal_reg_id",o="signal_static_pubkey",s="signal_static_privkey",l="signal_next_pk_id",c="signal_last_spk_id",u="signal_first_unupload_pk_id",d="signal_sever_has_pre_keys",p="adv_signed_identity",f={name:"AES-CTR",length:128,counter:new Uint8Array(16)};function _(e){return self.crypto.subtle.generateKey({name:f.name,length:f.length},!1,["encrypt","decrypt"]).then((t=>self.crypto.subtle.encrypt(f,t,e).then((e=>({encKey:t,value:e})))))}function h(e){return self.crypto.subtle.decrypt(f,e.encKey,e.value)}const g=new class{constructor(){this.idToSignedPreKey=new Map}getMeta(e){return(0,r.getMetaTable)().get(e).then((e=>e?e.value:null))}putMeta(e){const t=(0,r.getMetaTable)(),n=e.map((e=>t.createOrReplace(e)));return Promise.all(n).then()}setServerHasPreKeys(e){this.putMeta([{key:d,value:e}])}getServerHasPreKeys(){return this.getMeta(d)}putADVSignedIdentity(e){return this.putMeta([{key:p,value:e}])}getADVSignedIdentity(){return this.getMeta(p)}getPreKeysByRange(e,t){return(0,r.getPreKeyTable)().greaterThan(["keyId"],e-1,{limit:t})}getPreKeyById(e){return(0,r.getPreKeyTable)().get(e)}removePreKeyById(e){return(0,r.getPreKeyTable)().remove(e)}bulkRemovePreKey(e){return(0,r.getPreKeyTable)().bulkRemove(e)}putPreKeys(e){const t=(0,r.getPreKeyTable)(),n=e.map((e=>{const{keyId:n,keyPair:r,isDirectDistribution:i}=e;return t.get(n).then((e=>{if(e)throw Error(`preKey id ${n} already exists`);return t.create({keyId:n,keyPair:r,isDirectDistribution:i})}))}));return Promise.all(n).then()}markPreKeyAsDirectDistribution(e){return(0,r.getPreKeyTable)().merge(e,{isDirectDistribution:1})}getSignedPreKey(){return this.getMeta(c).then((e=>this.getSignedPreKeyById(e)))}getSignedPreKeyById(e){if(this.idToSignedPreKey.has(e))return Promise.resolve(this.idToSignedPreKey.get(e));return(0,r.getSignedPreKeyTable)().get(e).then((t=>(this.idToSignedPreKey.set(e,t),t)))}putSignedPreKeys(e){const t=(0,r.getSignedPreKeyTable)(),n=e.map((e=>{const{keyId:n,keyPair:r,signature:i}=e;return t.get(n).then((e=>{if(e)throw Error(`signed preKey id ${n} already exists`);return t.create({keyId:n,keyPair:r,signature:i})}))}));return Promise.all(n).then()}putSession(e,t){return(0,r.getSessionTable)().createOrReplace({address:e,session:t})}bulkPutSession(e){return(0,r.getSessionTable)().bulkCreateOrReplace(e)}removeSession(e){return(0,r.getSessionTable)().remove(e)}bulkRemoveSession(e){return(0,r.getSessionTable)().bulkRemove(e)}getSession(e){return(0,r.getSessionTable)().get(e).then((e=>e?e.session:null))}bulkGetSession(e){return(0,r.getSessionTable)().bulkGet(e).then((e=>e.map((e=>e?e.session:null))))}putIdentity(e,t){return(0,r.getIdentityTable)().createOrReplace({identifier:e,identityKey:t})}bulkPutIdentity(e){return(0,r.getIdentityTable)().bulkCreateOrReplace(e)}bulkGetIdentity(e){return(0,r.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?e.identityKey:null))))}getIdentity(e){return(0,r.getIdentityTable)().get(e).then((e=>e?e.identityKey:null))}removeIdentity(e){return(0,r.getIdentityTable)().remove(e)}bulkRemoveIdentity(e){return(0,r.getIdentityTable)().bulkRemove(e)}getIdentityKeyWithRowId(e){return(0,r.getIdentityTable)().get(e).then((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))}bulkGetIdentityKeyWithRowId(e){return(0,r.getIdentityTable)().bulkGet(e).then((e=>e.map((e=>e?{identityKey:e.identityKey,rowId:e.rowId}:null))))}bulkPutIdentityKeyWithRowId(e){return(0,r.getIdentityTable)().bulkCreateOrReplace(e)}saveBaseKey(e,t,n){return(0,r.getBaseKeyTable)().createOrReplace({address:e,originalMsgId:t,baseKey:n})}loadBaseKey(e,t){return(0,r.getBaseKeyTable)().equals(["address","originalMsgId"],[e,t]).then((e=>e&&0!==e.length?e[0].baseKey:null))}deleteBaseKey(e,t){const n=(0,r.getBaseKeyTable)();return n.equals(["address","originalMsgId"],[e,t]).then((e=>{if(e&&0!==e.length)return n.remove(e[0].id)}))}putSenderKey(e,t,n){return(0,r.getSenderKeyTable)().createOrReplace({senderKeyName:e,senderId:t,senderKey:n})}bulkPutSenderKey(e){return(0,r.getSenderKeyTable)().bulkCreateOrReplace(e)}removeSenderKey(e){return(0,r.getSenderKeyTable)().remove(e)}getSenderKey(e){return(0,r.getSenderKeyTable)().get(e).then((e=>e?e.senderKey:null))}removeSenderKeyBySenderId(e){const t=(0,r.getSenderKeyTable)();return t.equals(["senderId"],e).then((e=>t.bulkRemove(e.map((e=>e.senderKeyName)))))}clearCredential(){const e=[(0,r.getIdentityTable)(),(0,r.getMetaTable)(),(0,r.getPreKeyTable)(),(0,r.getSessionTable)(),(0,r.getSignedPreKeyTable)()];return Promise.all(e.map((e=>e.clear()))).then((()=>{}))}getRegistrationInfo(){return null!=this.registrationInfo?Promise.resolve(this.registrationInfo):Promise.all([this.getMeta(a),this.getMeta(o),this.getMeta(s)]).then((e=>{let[t,n,r]=e;if(t&&n&&r)return Promise.all([h(n),h(r)]).then((e=>{let[n,r]=e;return this.registrationInfo={registrationId:t,identityKeyPair:{pubKey:n,privKey:r}},this.registrationInfo}))}))}setRegistrationInfo(e){return Promise.all([_(e.identityKeyPair.pubKey),_(e.identityKeyPair.privKey)]).then((t=>{let[n,r]=t;return Promise.all([this.putMeta([{key:a,value:e.registrationId},{key:o,value:n},{key:s,value:r}])]).then()}))}getOrGenPreKeys(e,t){return(0,i.getStorage)().lock(["signal-meta-store","prekey-store"],(()=>Promise.all([this.getMeta(u),this.getMeta(l)]).then((n=>{let[r,i]=n;const a=r||1,o=i||1,s=o-a,l=e-s;if(l<=0)return __LOG__(2)`getPreKeys: no prekey needs to be generated, avaliable: ${s}, need: ${e}`,this.getPreKeysByRange(a,e);const c=function(e,t){const n=[];for(let r=e;r<t;r++)n.push(r);return n}(o,o+l).map((e=>t(e)));return Promise.all(c).then((e=>this.savePreKeys(e))).then((()=>this.getPreKeysByRange(a,e)))}))))}getOrGenSinglePreKey(e){return this.getOrGenPreKeys(1,e).then((e=>{if(1!==e.length)throw Error("Expected to get exactly one key but got ${keys.length}");return e[0]}))}savePreKeys(e){if(0===e.length)return Promise.resolve();const t=e[e.length-1];return Promise.all([this.putMeta([{key:l,value:t.keyId+1}]),this.putPreKeys(e)]).then()}markKeyAsUploaded(e){return Promise.all([this.getMeta(u),this.getMeta(l)]).then((t=>{let[n,r]=t;if(e<0||!r||e>=r)throw Error(`markKeyAsUploaded: key ${e} is out of boundary.`);const i=n?Math.max(n,e+1):e+1;return this.putMeta([{key:u,value:i}])}))}rotateSignedPreKey(e,t){return(0,i.getStorage)().lock(["signal-meta-store","signed-prekey-store"],(()=>this.getMeta(c).then((n=>{const r=null==n?1:n+1;return t(e,r).then((e=>(this.putSignedPreKeys([e]),this.putMeta([{key:c,value:r}]),e)))}))))}};t.waSignalStore=g},572841:(e,t)=>{"use strict";function n(e,t){for(let n=0;n<t;n++)e.writeUint8(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.bufferEqual=function(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;const n=new DataView(e),r=new DataView(t);for(let e=0;e<n.byteLength;e++)if(n.getUint8(e)!==r.getUint8(e))return!1;return!0},t.bufferToStr=function(e){return new self.dcodeIO.ByteBuffer.wrap(e).toString("binary")},t.createSignalAddress=function(e){if(!(e.isUser()||e.isServer()||e.isPSA()))throw new Error(`Jid ${e.toString({legacy:!0})} is not fully qualified, jid.server should be "s.whatsapp.net"`);return new self.libsignal.SignalProtocolAddress(e.getSignalAddress(),0)},t.strToBuffer=function(e){return new self.dcodeIO.ByteBuffer.wrap(e,"binary").toArrayBuffer()},t.writePad=n,t.writeRandomPadMax16=function(e){const t=new Uint8Array(1);self.crypto.getRandomValues(t),n(e,1+(15&t[0]))}},959060:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=t.KeyGenerator=t.Cipher=void 0;var r=s(n(680168)),i=s(n(985614)),a=s(n(71553));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function s(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const l=i;t.KeyGenerator=l;const c=r;t.Cipher=c;const u=a;t.Session=u},985614:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateIdentityKeyPair=function(){return l.apply(this,arguments)},t.generatePreKeyPair=function(){return o.apply(this,arguments)},t.generateSignedKeyPair=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=n(138062);function o(){return(o=(0,i.default)((function*(e){const t=yield self.libsignal.KeyHelper.generatePreKey(e),{keyId:n,keyPair:r}=t;return{keyId:n,keyPair:(0,a.toCurveKeyPair)(r),isDirectDistribution:0}}))).apply(this,arguments)}function s(){return(s=(0,i.default)((function*(e,t){const n=yield self.libsignal.KeyHelper.generateSignedPreKey(e,t),{keyId:r,keyPair:i,signature:o}=n;return{keyId:r,keyPair:(0,a.toCurveKeyPair)(i),signature:o}}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){const e=yield self.libsignal.KeyHelper.generateIdentityKeyPair();return(0,a.toCurveKeyPair)(e)}))).apply(this,arguments)}},526987:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SignalStoreCache=void 0;var i=r(n(150361)),a=n(297197);t.SignalStoreCache=class{constructor(){this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.PrekeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.SenderKeyStore=new Map,this.Mutex={session:new a.Semaphore,identity:new a.Semaphore,senderKey:new a.Semaphore,preKey:new a.Semaphore},this.Dirty={session:new Set,identity:new Set,senderKey:new Set,preKey:new Set}}_generateSessionUpdate(){const e=[],t=[];return this.Dirty.session.forEach((n=>{const r=this.SessionStore.get(n);r&&(r.deleted?t.push(n):e.push({address:n,session:(0,i.default)(r.session)}))})),{update:e,remove:t}}_generateSenderKeyUpdate(){const e=[];return this.Dirty.senderKey.forEach((t=>{const n=this.SenderKeyStore.get(t);if(n){const r=t.split("::");2===r.length&&e.push({senderKeyName:t,senderId:r[1],senderKey:(0,i.default)(n)})}})),e}_generateIdentityUpdate(){const e=[],t=[];return this.Dirty.identity.forEach((n=>{const r=this.IdentityStore.get(n);r&&(r.deleted?t.push(n):e.push({identifier:n,identityKey:r.identityKey,rowId:r.rowId}))})),{update:e,remove:t}}_generatePreKeyUpdate(){const e=[];return this.Dirty.preKey.forEach((t=>{const n=this.PrekeyStore.get(t);(null==n?void 0:n.deleted)&&e.push(parseInt(t,10))})),e}generateCacheUpdate(){const e=this._generateIdentityUpdate(),t=this._generateSessionUpdate();return{sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this._generateSenderKeyUpdate(),preKeyRemove:this._generatePreKeyUpdate()}}clearDirty(){this.Dirty={session:new Set,identity:new Set,senderKey:new Set,preKey:new Set}}}},530962:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyIdentityKey=function(e){if(e instanceof ArrayBuffer)return(0,r.bufferToStr)(e);return e};var r=n(572841)},454753:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.enableMemSignalStore=function(){s=(0,o.isUnifiedSignalEnabled)()?n(199263).Z:i.default},t.enablePersistSignalStore=function(){s=a.default},t.getSignalProtocolStore=function(){return s};var i=r(n(508869)),a=r(n(876883)),o=n(697710);let s=a.default},508869:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(150361)),o=n(138062),s=n(978820),l=n(530962),c=n(640623),u=n(572841),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(652402));function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}var f=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfo=null,this.SignedPreKeyStore=new Map,this.SessionStore=new Map,this.IdentityStore=new Map,this.PrekeyStore=new Map,this.SenderKeyStore=new Map}getIdentityKeyPair(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield c.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.identityKeyPair)?(0,o.toSignalCurveKeyPair)(e.RegistrationInfo.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,i.default)((function*(){var t;return e.RegistrationInfo||(e.RegistrationInfo=yield c.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfo)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}loadIdentityKey(e){var t=this;return(0,i.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityStore.has(e)){const n=yield c.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityStore.set(e,n)}return(null===(n=t.IdentityStore.get(e))||void 0===n?void 0:n.identityKey)||void 0}))()}saveIdentity(e,t){var n=this;return(0,i.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to put identity key for undefined/null key"));const r=(0,l.stringifyIdentityKey)(t),i=yield n.loadIdentityKey(e);i&&i===r||(i&&e===(0,u.createSignalAddress)((0,s.getMeUser)()).toString()?null==d||d.handleSelfPrimaryIdentityChange():n.putIdentity(e,r))}))()}putIdentity(e,t){this.IdentityStore.set(e,{identityKey:t})}removeIdentity(e){return null==e?Promise.reject(new Error("Tried to remove identity key for undefined/null key")):(this.IdentityStore.set(e,{deleted:!0}),Promise.resolve())}loadPreKey(e){var t=this;return(0,i.default)((function*(){if(null==e)return;if(!t.PrekeyStore.has(e)){var n;const r=null===(n=yield c.waSignalStore.getPreKeyById(e))||void 0===n?void 0:n.keyPair;t.PrekeyStore.set(e,{keyPair:r})}const r=t.PrekeyStore.get(e);return(null==r?void 0:r.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):(this.PrekeyStore.set(e,{deleted:!0}),Promise.resolve())}loadSignedPreKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SignedPreKeyStore.has(e)){var n;const r=null===(n=yield c.waSignalStore.getSignedPreKeyById(e))||void 0===n?void 0:n.keyPair;t.SignedPreKeyStore.set(e,r)}return t.SignedPreKeyStore.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,i.default)((function*(){var n;if(null!=e){if(!t.SessionStore.has(e)){const n=yield c.waSignalStore.getSession(e);t.SessionStore.set(e,n?{session:n}:void 0)}return(null===(n=t.SessionStore.get(e))||void 0===n?void 0:n.session)||void 0}}))()}storeSession(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SessionStore.set(e,{session:t}),Promise.resolve())}removeSession(e){return null==e?Promise.reject(new Error("Tried to remove session without identifier")):(this.SessionStore.set(e,{deleted:!0}),Promise.resolve())}storeSenderKey(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this.SenderKeyStore.set(e,t),Promise.resolve())}loadSenderKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t.SenderKeyStore.has(e)){const n=yield c.waSignalStore.getSenderKey(e);t.SenderKeyStore.set(e,n)}return t.SenderKeyStore.get(e)||void 0}}))()}_generateSessionUpdate(){const e=[],t=[];return Array.from(this.SessionStore.keys()).forEach((n=>{const r=this.SessionStore.get(n);r&&(r.deleted?t.push(n):e.push({address:n,session:(0,a.default)(r.session)}))})),{update:e,remove:t}}_generateSenderKeyUpdate(){const e=[];return Array.from(this.SenderKeyStore.keys()).forEach((t=>{const n=this.SenderKeyStore.get(t);if(n){const r=t.split("::");2===r.length&&e.push({senderKeyName:t,senderId:r[1],senderKey:(0,a.default)(n)})}})),e}_generateIdentityUpdate(){const e=[],t=[];return Array.from(this.IdentityStore.keys()).forEach((n=>{const r=this.IdentityStore.get(n);r&&(r.deleted?t.push(n):e.push({identifier:n,identityKey:r.identityKey,rowId:r.rowId}))})),{update:e,remove:t}}_generatePreKeyUpdate(){const e=[];return Array.from(this.PrekeyStore.keys()).forEach((t=>{const n=this.PrekeyStore.get(t);(null==n?void 0:n.deleted)&&e.push(parseInt(t,10))})),e}generateSnapshot(){const e=this._generateIdentityUpdate(),t=this._generateSessionUpdate();return{sessionUpdate:t.update,sessionRemove:t.remove,identityUpdate:e.update,identityRemove:e.remove,senderKeyUpdate:this._generateSenderKeyUpdate(),preKeyRemove:this._generatePreKeyUpdate()}}flushBufferToDiskIfNotMemOnlyMode(){return Promise.resolve()}};t.default=f},876883:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(297197),s=n(138062),l=n(978820),c=n(530962),u=n(640623),d=n(572841),p=n(677246),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(652402));function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}var h=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache=new Map,this.SessionCache=new Map,this.SessionCacheDirtySet=new Set,this._sessionMutex=new o.Semaphore(1),this.IdentityCache=new Map,this.IdentityCacheDirtySet=new Set,this._identityMutex=new o.Semaphore(1)}getIdentityKeyPair(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.identityKeyPair)?(0,s.toSignalCurveKeyPair)(e.RegistrationInfoReadThruCache.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,a.default)((function*(){var t;return e.RegistrationInfoReadThruCache||(e.RegistrationInfoReadThruCache=yield u.waSignalStore.getRegistrationInfo()),(null===(t=e.RegistrationInfoReadThruCache)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}saveIdentity(e,t){var n=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to put identity key for undefined/null key");const r=(0,c.stringifyIdentityKey)(t),i=yield n.loadIdentityKey(e);if(!i||i!==r){if(i){if(e===(0,d.createSignalAddress)((0,l.getMeUser)()).toString())return void(null==f||f.handleSelfPrimaryIdentityChange());yield null==f?void 0:f.handleNewIdentity(e)}yield n.putIdentity(e,r)}}))()}_putIdentityImpl(e,t){const n=this.IdentityCache.get(e);this.IdentityCache.set(e,(0,i.default)((0,i.default)({},n),{},{identityKey:t})),this.IdentityCacheDirtySet.add(e)}putIdentity(e,t){var n=this;return(0,a.default)((function*(){const r=yield n._identityMutex.acquire();try{n._putIdentityImpl(e,t)}finally{r.release()}}))()}_loadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t.IdentityCache.has(e)){const n=yield u.waSignalStore.getIdentityKeyWithRowId(e);t.IdentityCache.set(e,n)}return(null===(n=t.IdentityCache.get(e))||void 0===n?void 0:n.identityKey)||void 0}))()}loadIdentityKey(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{return yield t._loadIdentityKeyImpl(e)}finally{n.release()}}))()}getIdentityRowId(e){var t=this;return(0,a.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");return yield t.loadIdentityKey(e),(null===(n=t.IdentityCache.get(e))||void 0===n?void 0:n.rowId)||void 0}))()}bulkGetIdentityRowId(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");return 0===e.length?[]:(yield t.bulkLoadIdentityKey(e),e.map((e=>{var n;return(null===(n=t.IdentityCache.get(e))||void 0===n?void 0:n.rowId)||void 0})))}))()}_bulkLoadIdentityKeyImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(0===e.length)return[];const n=new Array(e.length),r=[];if(e.forEach(((e,i)=>{var a;t.IdentityCache.has(e)?n[i]=null===(a=t.IdentityCache.get(e))||void 0===a?void 0:a.identityKey:r.push({id:e,pos:i})})),r.length>0){(yield u.waSignalStore.bulkGetIdentityKeyWithRowId(r.map((e=>e.id)))).forEach(((e,i)=>{const a=r[i];t.IdentityCache.set(a.id,e),n[a.pos]=null==e?void 0:e.identityKey}))}return n}))()}bulkLoadIdentityKey(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{return yield t._bulkLoadIdentityKeyImpl(e)}finally{n.release()}}))()}_bulkCreateIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)throw new Error("Tried to bulk put identity key with undefined/null");__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s): start`,yield(0,p.getStorage)().lock(["identity-store"],(0,a.default)((function*(){const n=e.map((e=>e.identifier)),r=yield t._bulkLoadIdentityKeyImpl(n),i=e.filter(((e,t)=>!r[t]));i.length>0&&(yield u.waSignalStore.bulkPutIdentity(i),i.forEach((e=>{let{identifier:n,identityKey:r}=e;t.IdentityCache.set(n,{identityKey:r})}))),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s) (new: ${i.length}): end`})))}))()}bulkCreateIdentity(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{yield t._bulkCreateIdentityImpl(e)}finally{n.release()}}))()}_removeIdentityImpl(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove identity key for undefined/null key"));yield u.waSignalStore.removeIdentity(e),t.IdentityCache.delete(e),t.IdentityCacheDirtySet.delete(e)}))()}removeIdentity(e){var t=this;return(0,a.default)((function*(){const n=yield t._identityMutex.acquire();try{yield t._removeIdentityImpl(e)}finally{n.release()}}))()}loadPreKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);const t=yield u.waSignalStore.getPreKeyById(e);return(null==t?void 0:t.keyPair)||void 0}))()}removePreKey(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):u.waSignalStore.removePreKeyById(e)}loadSignedPreKey(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SignedPreKeyStoreReadThruCache.has(e)){var n;const r=null===(n=yield u.waSignalStore.getSignedPreKeyById(e))||void 0===n?void 0:n.keyPair;t.SignedPreKeyStoreReadThruCache.set(e,r)}return t.SignedPreKeyStoreReadThruCache.get(e)||void 0}}))()}loadSession(e){var t=this;return(0,a.default)((function*(){if(null!=e){if(!t.SessionCache.has(e)){const n=yield u.waSignalStore.getSession(e);t.SessionCache.set(e,n)}return t.SessionCache.get(e)||void 0}}))()}_storeSessionImpl(e,t){if(null==e)throw new Error("Tried to put session without identifier");this.SessionCache.set(e,t),this.SessionCacheDirtySet.add(e)}storeSession(e,t){var n=this;return(0,a.default)((function*(){const r=yield n._sessionMutex.acquire();return n._storeSessionImpl(e,t),r.release(),Promise.resolve()}))()}removeSession(e){var t=this;return(0,a.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove session without identifier"));yield u.waSignalStore.removeSession(e),t.SessionCache.delete(e),t.SessionCacheDirtySet.delete(e)}))()}containSessions(e){var t=this;return(0,a.default)((function*(){const n=[];for(const r of e)t.SessionCache.has(r)||n.push(r);if(n.length>0){(yield u.waSignalStore.bulkGetSession(n)).forEach(((e,r)=>{const i=n[r];t.SessionCache.set(i,e)}))}return e.map((e=>!!t.SessionCache.get(e)))}))()}storeSenderKey(e,t){if(null==e)return Promise.reject(new Error("Tried to put senderKey without senderKeyName"));const n=e.split("::");if(n.length<2)return Promise.reject(new Error("Tried to put senderKey with invalid senderKeyName"));const r=n[1];return u.waSignalStore.putSenderKey(e,r,t)}loadSenderKey(e){return(0,a.default)((function*(){if(null==e)return Promise.resolve(void 0);return(yield u.waSignalStore.getSenderKey(e))||void 0}))()}deleteAllCache(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`deleteAllCache`,this.RegistrationInfoReadThruCache=null,this.SignedPreKeyStoreReadThruCache.clear(),this.SessionCache.clear(),this.IdentityCache.clear(),this.SessionCacheDirtySet.clear(),this.IdentityCacheDirtySet.clear()}_flushSessions(){var e=this;return(0,a.default)((function*(){if(0===e.SessionCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: get dirty updates for ${Array.from(e.SessionCacheDirtySet).join(",")}`;const t=[];e.SessionCacheDirtySet.forEach((n=>{const r=e.SessionCache.get(n);r&&t.push({address:n,session:r})})),t.length>0&&(yield u.waSignalStore.bulkPutSession(t)),e.SessionCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushSessions: ${t.length} flushed`}))()}_flushIdentities(){var e=this;return(0,a.default)((function*(){if(0===e.IdentityCacheDirtySet.size)return void __LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: no updates`;__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: get dirty updates for ${Array.from(e.IdentityCacheDirtySet).join(",")}`;const t=[];e.IdentityCacheDirtySet.forEach((n=>{const r=e.IdentityCache.get(n);r&&t.push((0,i.default)((0,i.default)({},r),{},{identifier:n}))})),t.length>0&&(yield u.waSignalStore.bulkPutIdentityKeyWithRowId(t)),e.IdentityCacheDirtySet.clear(),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`flushIdentities: ${t.length} flushed`}))()}flushBufferToDiskIfNotMemOnlyMode(){var e=this;return(0,a.default)((function*(){const t=yield e._sessionMutex.acquire(),n=yield e._identityMutex.acquire();try{yield(0,p.getStorage)().lock(["identity-store","session-store"],(()=>Promise.all([e._flushSessions(),e._flushIdentities()])))}finally{n.release(),t.release()}}))()}_updateIdentityRangeAfterEncryptionImpl(e,t){var n=this;return(0,a.default)((function*(){__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: start`,yield n._bulkLoadIdentityKeyImpl(t);const r=[];t.forEach((t=>{const i=n.IdentityCache.get(t);i&&(null==i.rowId||i.rowId>e)&&(n.IdentityCache.set(t,{identityKey:i.identityKey,rowId:e}),n.IdentityCacheDirtySet.add(t),r.push(t))})),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`updateIdentityRangeAfterEncryption: ${r.length} updated`}))()}updateIdentityRangeAfterEncryption(e,t){var n=this;return(0,a.default)((function*(){const r=yield n._identityMutex.acquire();try{yield n._updateIdentityRangeAfterEncryptionImpl(e,t)}finally{r.release()}}))()}};t.default=h},199263:(e,t,n)=>{"use strict";var r=n(595318);t.Z=void 0;var i=r(n(348926)),a=n(138062),o=n(978820),s=n(526987),l=n(530962),c=n(640623),u=n(572841),d=n(677246),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(652402));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}var _=new class{constructor(){this.Direction={SENDING:1,RECEIVING:2},this._cache=new s.SignalStoreCache}getIdentityKeyPair(){var e=this;return(0,i.default)((function*(){var t;return e._cache.RegistrationInfo||(e._cache.RegistrationInfo=yield c.waSignalStore.getRegistrationInfo()),(null===(t=e._cache.RegistrationInfo)||void 0===t?void 0:t.identityKeyPair)?(0,a.toSignalCurveKeyPair)(e._cache.RegistrationInfo.identityKeyPair):void 0}))()}getLocalRegistrationId(){var e=this;return(0,i.default)((function*(){var t;return e._cache.RegistrationInfo||(e._cache.RegistrationInfo=yield c.waSignalStore.getRegistrationInfo()),(null===(t=e._cache.RegistrationInfo)||void 0===t?void 0:t.registrationId)||void 0}))()}isTrustedIdentity(){return Promise.resolve(!0)}_loadIdentityKeyImpl(e){var t=this;return(0,i.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(!t._cache.IdentityStore.has(e)){const n=yield c.waSignalStore.getIdentityKeyWithRowId(e);t._cache.IdentityStore.set(e,n)}return(null===(n=t._cache.IdentityStore.get(e))||void 0===n?void 0:n.identityKey)||void 0}))()}loadIdentityKey(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.identity.acquire();try{return yield t._loadIdentityKeyImpl(e)}finally{n.release()}}))()}_putIdentityImpl(e,t){this._cache.IdentityStore.set(e,{identityKey:t}),this._cache.Dirty.identity.add(e)}putIdentity(e,t){var n=this;return(0,i.default)((function*(){const r=yield n._cache.Mutex.identity.acquire();try{n._putIdentityImpl(e,t)}finally{r.release()}}))()}saveIdentity(e,t){var n=this;return(0,i.default)((function*(){if(null==e)throw new Error("Tried to put identity key for undefined/null key");const r=(0,l.stringifyIdentityKey)(t),i=yield n.loadIdentityKey(e);if(!i||i!==r){if(i){if(e===(0,u.createSignalAddress)((0,o.getMeUser)()).toString())return void(null==p||p.handleSelfPrimaryIdentityChange());yield null==p?void 0:p.handleNewIdentity(e)}yield n.putIdentity(e,r)}}))()}getIdentityRowId(e){var t=this;return(0,i.default)((function*(){var n;if(null==e)throw new Error("Tried to get identity key for undefined/null key");return yield t.loadIdentityKey(e),(null===(n=t._cache.IdentityStore.get(e))||void 0===n?void 0:n.rowId)||void 0}))()}bulkGetIdentityRowId(e){var t=this;return(0,i.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");return 0===e.length?[]:(yield t.bulkLoadIdentityKey(e),e.map((e=>{var n;return(null===(n=t._cache.IdentityStore.get(e))||void 0===n?void 0:n.rowId)||void 0})))}))()}_bulkLoadIdentityKeyImpl(e){var t=this;return(0,i.default)((function*(){if(null==e)throw new Error("Tried to get identity key for undefined/null key");if(0===e.length)return[];const n=new Array(e.length),r=[];if(e.forEach(((e,i)=>{var a;t._cache.IdentityStore.has(e)?n[i]=null===(a=t._cache.IdentityStore.get(e))||void 0===a?void 0:a.identityKey:r.push({id:e,pos:i})})),r.length>0){(yield c.waSignalStore.bulkGetIdentityKeyWithRowId(r.map((e=>e.id)))).forEach(((e,i)=>{const a=r[i];t._cache.IdentityStore.set(a.id,e),n[a.pos]=null==e?void 0:e.identityKey}))}return n}))()}bulkLoadIdentityKey(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.identity.acquire();try{return yield t._bulkLoadIdentityKeyImpl(e)}finally{n.release()}}))()}_bulkCreateIdentityImpl(e){var t=this;return(0,i.default)((function*(){if(null==e)throw new Error("Tried to bulk put identity key with undefined/null");__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`[Signal][Identity][unified]bulkCreateIdentity: store ${e.length} value(s): start`,yield(0,d.getStorage)().lock(["identity-store"],(0,i.default)((function*(){const n=e.map((e=>e.identifier)),r=yield t._bulkLoadIdentityKeyImpl(n),i=e.filter(((e,t)=>!r[t]));i.length>0&&(yield c.waSignalStore.bulkPutIdentity(i),i.forEach((e=>{let{identifier:n,identityKey:r}=e;t._cache.IdentityStore.set(n,{identityKey:r})}))),__LOG__(2,void 0,void 0,void 0,["Persist protocol store"])`bulkCreateIdentity: store ${e.length} value(s) (new: ${i.length}): end`})))}))()}bulkCreateIdentity(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.identity.acquire();try{yield t._bulkCreateIdentityImpl(e)}finally{n.release()}}))()}_removeIdentityImpl(e){this._cache.IdentityStore.set(e,{deleted:!0}),this._cache.Dirty.identity.add(e)}removeIdentity(e){var t=this;return(0,i.default)((function*(){if(null==e)return Promise.reject(new Error("Tried to remove identity key for undefined/null key"));const n=yield t._cache.Mutex.identity.acquire();try{yield t._removeIdentityImpl(e)}finally{n.release()}}))()}_loadPreKeyImpl(e){var t=this;return(0,i.default)((function*(){if(null==e)return;if(!t._cache.PrekeyStore.has(e)){var n;const r=null===(n=yield c.waSignalStore.getPreKeyById(e))||void 0===n?void 0:n.keyPair;t._cache.PrekeyStore.set(e,{keyPair:r})}const r=t._cache.PrekeyStore.get(e);return(null==r?void 0:r.keyPair)||void 0}))()}loadPreKey(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.preKey.acquire();try{return yield t._loadPreKeyImpl(e)}finally{n.release()}}))()}_removePreKeyImpl(e){return null==e?Promise.reject(new Error("Tried to remove pre key without keyId")):(this._cache.PrekeyStore.set(e,{deleted:!0}),this._cache.Dirty.preKey.add(e),Promise.resolve())}removePreKey(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.preKey.acquire();try{yield t._removePreKeyImpl(e)}finally{n.release()}}))()}loadSignedPreKey(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t._cache.SignedPreKeyStore.has(e)){var n;const r=null===(n=yield c.waSignalStore.getSignedPreKeyById(e))||void 0===n?void 0:n.keyPair;t._cache.SignedPreKeyStore.set(e,r)}return t._cache.SignedPreKeyStore.get(e)||void 0}}))()}_loadSessionImpl(e){var t=this;return(0,i.default)((function*(){var n;if(null!=e){if(!t._cache.SessionStore.has(e)){const n=yield c.waSignalStore.getSession(e);t._cache.SessionStore.set(e,n?{session:n}:void 0)}return(null===(n=t._cache.SessionStore.get(e))||void 0===n?void 0:n.session)||void 0}}))()}loadSession(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.session.acquire();try{return yield t._loadSessionImpl(e)}finally{n.release()}}))()}_storeSessionImpl(e,t){if(null==e)throw new Error("Tried to put session without identifier");this._cache.SessionStore.set(e,{session:t}),this._cache.Dirty.session.add(e)}storeSession(e,t){var n=this;return(0,i.default)((function*(){const r=yield n._cache.Mutex.session.acquire();try{n._storeSessionImpl(e,t)}finally{r.release()}}))()}_removeSessionImpl(e){if(null==e)throw new Error("Tried to remove session without identifier");this._cache.SessionStore.set(e,{deleted:!0}),this._cache.Dirty.session.add(e)}removeSession(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.session.acquire();try{t._removeSessionImpl(e)}finally{n.release()}}))()}_containSessionsImpl(e){var t=this;return(0,i.default)((function*(){const n=[];for(const r of e)t._cache.SessionStore.has(r)||n.push(r);if(n.length>0){(yield c.waSignalStore.bulkGetSession(n)).forEach(((e,r)=>{const i=n[r];t._cache.SessionStore.set(i,e?{session:e}:void 0)}))}return e.map((e=>{const n=t._cache.SessionStore.get(e);return!(null!=n&&!(null==n?void 0:n.deleted))}))}))()}containSessions(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.session.acquire();try{return yield t._containSessionsImpl(e)}finally{n.release()}}))()}_storeSenderKeyImpl(e,t){return null==e?Promise.reject(new Error("Tried to put session without identifier")):(this._cache.SenderKeyStore.set(e,t),this._cache.Dirty.senderKey.add(e),Promise.resolve())}storeSenderKey(e,t){var n=this;return(0,i.default)((function*(){const r=yield n._cache.Mutex.senderKey.acquire();try{yield n._storeSenderKeyImpl(e,t)}finally{r.release()}}))()}_loadSenderKeyImpl(e){var t=this;return(0,i.default)((function*(){if(null!=e){if(!t._cache.SenderKeyStore.has(e)){const n=yield c.waSignalStore.getSenderKey(e);t._cache.SenderKeyStore.set(e,n)}return t._cache.SenderKeyStore.get(e)||void 0}}))()}loadSenderKey(e){var t=this;return(0,i.default)((function*(){const n=yield t._cache.Mutex.senderKey.acquire();try{return yield t._loadSenderKeyImpl(e)}finally{n.release()}}))()}generateSnapshot(){return this._cache.generateCacheUpdate()}flushBufferToDiskIfNotMemOnlyMode(){return Promise.resolve()}};t.Z=_},71553:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupSignalSession=function(){return S.apply(this,arguments)},t.createSignalSession=function(){return _.apply(this,arguments)},t.deleteDeviceSenderKey=function(e){const t=String((0,u.createSignalAddress)(e));return c.waSignalStore.removeSenderKeyBySenderId(t)},t.deleteGroupSenderKeyInfo=function(e){const t=(0,u.createSignalAddress)((0,l.assertGetMe)()),n=`${e.toString({legacy:!0})}::${t.toString()}`;return c.waSignalStore.removeSenderKey(n)},t.deleteRemoteInfo=function(){return g.apply(this,arguments)},t.deleteRemoteSession=function(e){const t=(0,u.createSignalAddress)(e).toString();return(0,d.getSignalProtocolStore)().removeSession(t)},t.getGroupSenderKeyInfo=function(){return E.apply(this,arguments)},t.getRemoteRegId=function(){return h.apply(this,arguments)},t.hasSameBaseKey=function(){return y.apply(this,arguments)},t.hasSignalSessions=function(e){return p.default.containSessions(e.map((e=>(0,u.createSignalAddress)(e).toString())))},t.saveSessionBaseKey=function(){return m.apply(this,arguments)};var i=r(n(348926)),a=n(108584),o=n(252230),s=n(138062),l=n(978820),c=n(640623),u=n(572841),d=n(454753),p=r(n(876883)),f=n(946308);function _(){return(_=(0,i.default)((function*(e){const{wid:t,identity:n,deviceIdentity:r}=e;if(__LOG__(2)`Signal::createSignalSession with `,null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID){if(!r)throw new Error("Signal::createSignalSession: expected device-identity in keyBundle for companion device");if(!(yield(0,f.validateADVwithIdentityKey)(t,r,n)))throw new Error("Signal::createSignalSession: invalid identityKey fetched")}let i,l,c;try{i=(0,s.toSignalCurvePubKey)(new a.Binary(e.identity).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid identityKey fetched"),e}try{l=(0,s.toSignalCurvePubKey)(new a.Binary(e.skey.pubkey).readBuffer())}catch(e){throw __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid signedPreKey fetched"),e}if(e.key)try{c=(0,s.toSignalCurvePubKey)(new a.Binary(e.key.pubkey).readBuffer())}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Signal::createSignalSession: invalid preKey fetched")}const d={registrationId:e.regId,identityKey:i,signedPreKey:{keyId:e.skey.id,publicKey:l,signature:new a.Binary(e.skey.signature).readBuffer()}};return e.key&&c&&(d.preKey={keyId:e.key.id,publicKey:c}),new self.libsignal.SessionBuilder(p.default,(0,u.createSignalAddress)(t)).processPreKey(d)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=new self.libsignal.SessionCipher(p.default,(0,u.createSignalAddress)(e));return(yield Promise.resolve(t)).getRemoteRegistrationId()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const t=(0,u.createSignalAddress)(e).toString();yield Promise.all([(0,d.getSignalProtocolStore)().removeIdentity(t),(0,d.getSignalProtocolStore)().removeSession(t)])}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const n=(0,u.createSignalAddress)(e),r=new self.libsignal.SessionInfo(p.default,n),i=yield r.getSessionBaseKey();i?yield c.waSignalStore.saveBaseKey(n.toString(),t,i):__LOG__(2)`saveSessionBaseKey: for ${t}, no basekey provided`}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){const n=(0,u.createSignalAddress)(e),r=new self.libsignal.SessionInfo(p.default,(0,u.createSignalAddress)(e)),[i,a]=yield Promise.all([r.getSessionBaseKey(),c.waSignalStore.loadBaseKey(n.toString(),t)]);return a?i?(0,u.bufferEqual)(a,i)?(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is same`,!0):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, savedBaseKey and sessionBaseKey is different `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no session has been saved locally `,!1):(__LOG__(2)`hasSameBaseKey: MsgId: ${t}, no base key has been saved locally `,!1)}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n){const r=new self.libsignal.GroupCipher((0,d.getSignalProtocolStore)(),t,(0,u.createSignalAddress)(e));return(yield Promise.resolve(r)).decryptSenderKeyDistributionMessage(n)}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){const t=new self.libsignal.GroupCipher(p.default,e.toString({legacy:!0}),(0,u.createSignalAddress)((0,l.assertGetMe)())),n=yield t.createSenderKeyDistributionMsg();return(0,u.strToBuffer)(n)}))).apply(this,arguments)}},21377:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractIdentityKey=function(e){const t=self.dcodeIO.ByteBuffer.wrap(e);t.readUint8();try{const e=self.libsignal.Protobuf.PreKeyWhisperMessage.decode(t);return(0,i.toCurveKeyPubKey)(e.identityKey.toArrayBuffer())}catch(e){return __LOG__(3)`extractIdentityKey: parse proto failed`,null}},t.xmppPreKey=function(e){return(0,r.wap)("key",null,(0,r.wap)("id",null,(0,r.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,r.wap)("value",null,e.keyPair.pubKey))},t.xmppSignedPreKey=function(e){return(0,r.wap)("skey",null,(0,r.wap)("id",null,(0,r.BIG_ENDIAN_CONTENT)(e.keyId,3)),(0,r.wap)("value",null,e.keyPair.pubKey),(0,r.wap)("signature",null,e.signature))};var r=n(831914),i=n(138062)},264114:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncAndGetDeviceList=function(){return v.apply(this,arguments)},t.syncDeviceList=g,t.syncMyDeviceList=function(){return E.apply(this,arguments)};var i=r(n(348926)),a=r(n(594654)),o=n(698712),s=n(468728),l=n(769315),c=n(978820),u=n(33723),d=n(4e4),p=n(745454),f=n(209108),_=n(325397);const h=new Map;function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){let{wids:t,context:n,phash:r}=e;if(null!=r){const e=(yield(0,f.getDeviceIds)(t)).map((e=>null==e?[]:e.devices.map((t=>(0,p.createDeviceWidFromDeviceListPk)(e.id,t))))),n=(0,a.default)(e,(e=>e));if(r===(yield(0,l.phashV2)(n)))return}const i=new Set,o=[];if(t.forEach((e=>{const t=h.get((0,_.createDeviceListPK)(e));t?i.add(t):o.push(e)})),0===o.length)return void(yield Promise.all(Array.from(i)));const s=y(o.map((e=>(0,_.createDeviceListPK)(e))),o,n);o.map((e=>{h.set((0,_.createDeviceListPK)(e),s)})),yield Promise.all([s,...Array.from(i)])}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e,t,n){try{const e=yield(0,f.getDeviceInfoForSync)(t),r=e.map((e=>null==e?[]:e.devices.map((t=>(0,p.createDeviceWidFromDeviceListPk)(e.id,t))))),i=yield Promise.all(r.map((e=>0===e.length?"":(0,l.phashV2)(e))));return T(t.map(((t,n)=>{var r,a;return{id:t,hash:i[n],ts:null===(r=e[n])||void 0===r?void 0:r.timestamp,expectedTs:null===(a=e[n])||void 0===a?void 0:a.expectedTs}})),n)}catch(e){__LOG__(4,void 0,new Error)`Failed to sync device list with error: ${e}`}finally{t.map((e=>{h.delete((0,_.createDeviceListPK)(e))}))}}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){yield g({wids:(0,c.getMePNandLIDWids)(),context:null,phash:null})}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){return yield g({wids:e,context:null,phash:null}),(0,f.getDeviceIds)(e)}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){if(0===e.length)return;const n=(new u.USyncQuery).withContext(t||"interactive").withDeviceProtocol();e.forEach((e=>{0!==e.id.user&&n.withUser((new d.USyncUser).withId(e.id).withDeviceHash(String(e.hash)).withTs(e.ts).withExpectedTs(e.expectedTs))}));const r=yield n.execute();if(r.error.all)throw new Error(`syncDeviceList: error ${r.error.all.errorCode}: ${r.error.all.errorText}`);r.error.devices&&__LOG__(3)`syncDeviceList: error ${r.error.devices.errorCode}: ${r.error.devices.errorText}`;let i=r.list.filter((e=>!("errorCode"in e.devices)));i=i.map((e=>({wid:e.id,devices:e.devices})));const a=i.filter((e=>{var t;return null===(t=e.devices.keyIndex)||void 0===t?void 0:t.signedKeyIndexBytes})).map((e=>e.wid));return __LOG__(2)`syncDeviceList: skipping ${r.list.length-a.length} out of ${r.list.length} records`,yield(0,o.getAndStoreIdentityKeys)(a),(0,s.handleADVDeviceSyncResult)(i)}))).apply(this,arguments)}},697710:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNoLoadingScreenEnabled=function(){return Boolean((0,r.getABPropConfigValue)("web_unified_flow")&s)},t.isUnifiedMessageProcessingEnabled=function(){return Boolean((0,r.getABPropConfigValue)("web_unified_flow")&a)},t.isUnifiedReceiptProcessingEnabled=function(){return Boolean((0,r.getABPropConfigValue)("web_unified_flow")&o)},t.isUnifiedSignalEnabled=function(){return Boolean((0,r.getABPropConfigValue)("web_unified_flow")&i)};var r=n(257243);const i=1,a=2,o=4,s=8},246276:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMemSignalStorage=function(){return(0,r.isUnifiedSignalEnabled)()?n(199263).Z:n(508869).default};var r=n(697710)},99274:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"processPlaceholderMessage",{enumerable:!0,get:function(){return r.processPlaceholderMessage}}),Object.defineProperty(t,"processReactionMessage",{enumerable:!0,get:function(){return a.processReactionMessage}}),Object.defineProperty(t,"processRenderableMessages",{enumerable:!0,get:function(){return i.processRenderableMessages}});var r=n(280115),i=n(39240),a=n(656575)},890349:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.messageProcessorCache=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(927870),s=n(657319),l=n(510749),c=n(246276),u=n(671251),d=n(640623),p=n(677246);const f=new class{constructor(){this.cache=[],this.checkpointQueue=new o.PromiseQueue,this.nextCheckpointIndex=0,this.snapshotTimer=new s.ShiftTimer((()=>{this.createSnapshot()})),this.checkpointPromises=new Map,this.flushImmediately=!1}addMessages(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.cache.push(...e);const n=this._getOrCreateCurrentCheckpointPromise();return t?(this.flushImmediately=!0,this.createSnapshot(),n):(this.flushImmediately=!1,this.cache.length-this.nextCheckpointIndex>=400?(this.createSnapshot(),n):n)}_getOrCreateCurrentCheckpointPromise(){if(!this.checkpointPromises.has(this.nextCheckpointIndex)){let e=()=>{},t=()=>{};this.checkpointPromises.set(this.nextCheckpointIndex,{promise:new Promise(((n,r)=>{e=n,t=r})),markCheckpointDone:n=>{this.checkpointPromises.delete(this.nextCheckpointIndex),null==n?e():t(n)}})}return(0,a.default)(this.checkpointPromises.get(this.nextCheckpointIndex),"this.checkpointPromises.get(this.nextCheckpointIndex)").promise}_addToMessageTable(e,t){var n=this;return(0,i.default)((function*(){const r=[];for(let i=e;i<t;i++){const e=n.cache[i].msg;null!=e&&r.push(e)}yield(0,u.storeOfflineMsgs)(r)}))()}createSnapshot(){var e,t,n=this;this.snapshotTimer.isScheduled()&&this.snapshotTimer.cancel();const r=this.nextCheckpointIndex,a=this.cache.length;if(this.nextCheckpointIndex=a,__LOG__(2)`[unify][message-cache]: creating snapshot for ${r} to ${a}`,r===a)return;const o=null!==(e=null===(t=this.checkpointPromises.get(r))||void 0===t?void 0:t.markCheckpointDone)&&void 0!==e?e:()=>{__LOG__(4,void 0,new Error,!0)`MessageProcessorCache: missing doneFn`,SEND_LOGS("message-cache-missing-doneFn")},s=(0,c.getMemSignalStorage)().generateSnapshot();this.checkpointQueue.enqueue((0,i.default)((function*(){try{yield n._addToMessageTable(r,a),__LOG__(2)`[unify][message-cache]: messages added to table for ${r} - ${a}`,yield(0,p.getStorage)().lock(["session-store","identity-store","prekey-store","senderkey-store"],(0,i.default)((function*(){yield Promise.all([d.waSignalStore.bulkPutSession(s.sessionUpdate),d.waSignalStore.bulkPutIdentityKeyWithRowId(s.identityUpdate),d.waSignalStore.bulkPutSenderKey(s.senderKeyUpdate),d.waSignalStore.bulkRemovePreKey(s.preKeyRemove),d.waSignalStore.bulkRemoveSession(s.sessionRemove),d.waSignalStore.bulkRemoveIdentity(s.identityRemove)])}))),__LOG__(2)`[unify][message-cache]: siganl key store updated for ${r} - ${a}`;const e=n.cache.slice(r,a);yield(0,l.sendAggregateOfflineReceipts)(e),__LOG__(2)`[unify][message-cache]: aggregate receipts sent for ${r} - ${a}`}catch(e){return void o(e)}o()})))}};t.messageProcessorCache=f},280115:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.processPlaceholderMessage=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(890349),o=n(405078),s=n(312037),l=n(1201);function c(){return(c=(0,i.default)((function*(e,t){if(e.category===s.CATEGORY_PEER)return void __LOG__(2,void 0,void 0,void 0,["messaging"])`processPlaceHolderMessage: msgId:${e.externalId}, skip placeholder for peer message`;const n=null!=e.offline;try{const r=yield(0,l.genPlaceholderMsg)(e,t);a.messageProcessorCache.addMessages(r.map((e=>({msg:e}))),!n).then((0,i.default)((function*(){n||(yield Promise.all(r.map(function(){var e=(0,i.default)((function*(e){const t=e.id.remote;yield(0,o.updateUI)(t,e)}));return function(){return e.apply(this,arguments)}}())))})))}catch(t){__LOG__(4,void 0,new Error,!0,["messaging"])`processPlaceholderMsg: msgId::${e.externalId}, failed with error: ${t}`,SEND_LOGS("handle_msg: error storing/processing single message")}}))).apply(this,arguments)}},656575:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.processReactionMessage=function(e,t){try{const n=null!=t.offline;s.messageProcessorCache.addMessages([{msg:e,receiptInfo:{from:e.from,author:t.author}}],!n).then((0,i.default)((function*(){if(!n)return yield function(){return c.apply(this,arguments)}(e,t),(0,l.processReactionOrphanPeerReceipt)(e.id)})))}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMessage: msgId:${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}return Promise.resolve()};var i=r(n(348926)),a=n(837398),o=n(867811),s=n(890349),l=n(229331);function c(){return(c=(0,i.default)((function*(e,t){const n=yield(0,o.createReactionsRow)(e,t);n&&(String(e.id),String(e.reactionParentKey),yield(0,a.addOrUpdateReactionsModelCollection)(n,!0))}))).apply(this,arguments)}},39240:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.processRenderableMessages=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=n(272720),o=n(75396),s=n(408139),l=n(115461),c=n(890349),u=n(405078),d=n(155552),p=n(542618);function f(){return(f=(0,i.default)((function*(e,t,n,r,f){try{const n=null!=t.offline;if(c.messageProcessorCache.addMessages(e.map((e=>({msg:e}))),!n).then((()=>Promise.all(e.map(p.processOrphansForNewMsg)))).catch((e=>{__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMessages write to DB from cache, failed with error: ${e}`,SEND_LOGS("processRenderableMessages write to DB from cache, failed")})),!n){const n=t.chat;yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){yield(0,u.updateUI)(n,e,f),(0,a.processOrphanAck)(e.id),e.type===l.MSG_TYPE.PAYMENT&&"send"===e.subtype&&(0,d.processOrphanPaymentNotifications)([e])}));return function(){return e.apply(this,arguments)}}())),(0,s.isMultiDeviceAgentsEnabled)()&&(yield(0,o.updateUnattributedMessages)(t,e))}}catch(e){__LOG__(4,void 0,new Error,!0,["messaging"])`processRenderableMessage: msgId:${t.externalId}, failed with error: ${e}`,SEND_LOGS("handle_msg: error storing/processing single message")}return Promise.resolve()}))).apply(this,arguments)}},832543:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildReceiptAckResponse=g,t.receiptBatcher=void 0;var i=r(n(348926)),a=n(639876),o=n(736184),s=n(252230),l=n(831914),c=n(535470),u=n(696055),d=n(745454),p=n(799069),f=n(578956);const _=Object.freeze({[c.ACK.RECEIVED]:c.ACK_STRING.DELIVERY,[c.ACK.READ]:c.ACK_STRING.READ,[c.ACK.PLAYED]:c.ACK_STRING.PLAYED,[c.ACK.INACTIVE]:c.ACK_STRING.INACTIVE}),h={delayMs:1e3};function g(e,t,n,r){return(0,l.wap)("ack",{to:(0,u.JID)(e),id:(0,l.CUSTOM_STRING)(t),class:"receipt",type:(0,l.MAYBE_CUSTOM_STRING)(n),participant:r&&r!==e?(0,u.DEVICE_JID)(r):l.DROP_ATTR})}function m(e,t){if(null!=e&&null!=t)return Math.min(e,t);const n=null!=e?e:t;return null!=n?n:void 0}const y=new class{constructor(){this._peerReceiptBatcher=(0,a.createSimpleBatcher)(h,(e=>this._processPeerReceipts(e))),this._otherReceiptBatcher=(0,a.createSimpleBatcher)(h,(e=>this._processOtherReceipts(e))),this._receiptAckBatcher=(0,a.createSimpleBatcher)(h,(e=>this._processReceiptAcks(e)))}acceptPeerReceipt(e){this._peerReceiptBatcher.accept(e)}acceptOtherReceipt(e){this._otherReceiptBatcher.accept(e)}acceptReceiptAck(e){this._receiptAckBatcher.accept(e)}runActiveBatches(){this._peerReceiptBatcher.runActiveBatch(),this._otherReceiptBatcher.runActiveBatch(),this._receiptAckBatcher.runActiveBatch()}_flattenAndDedupeOtherReceipts(e){const t=new Map;return e.forEach((e=>{var n;const{ack:r,ts:i,receiverId:a,msgKeys:o}=e,l=(0,d.toUserWid)(a).toString(),u=null!==(n=a.device)&&void 0!==n?n:s.DEFAULT_DEVICE_ID;o.forEach((e=>{const n=_[r];if(null==n)return void __LOG__(3)`[unify][batcher]: receipt has unsupported ack type ${r}`;const a=`${e},${l}`,o=t.get(a);o?(n!==_[c.ACK.INACTIVE]&&(o[n]=m(o[n],i)),o.deviceDelivered.add(u)):t.set(a,{[n]:i,deviceDelivered:new Set([u])})}))})),Array.from(t)}_processOtherReceipts(e){const t=this._flattenAndDedupeOtherReceipts(e);return(0,p.getStorage)().lock(["message-info"],function(){var n=(0,i.default)((function*(n){let[r]=n;const i=(yield r.bulkGet(t.map((e=>e[0].split(","))))).map(((e,n)=>{const[r,i]=t[n];if(!i)return null;if(!e){const[e,t]=r.split(",");return{delivery:i.delivery,read:i.read,played:i.played,msgKey:e,receiverUserJid:t,deviceDelivered:Array.from(i.deviceDelivered),deviceNotDelivered:[]}}const a=i.deviceDelivered;return e.deviceDelivered.forEach((e=>a.add(e))),{delivery:m(e.delivery,i.delivery),read:m(e.read,i.read),played:m(e.played,i.played),msgKey:e.msgKey,receiverUserJid:e.receiverUserJid,deviceDelivered:Array.from(a),deviceNotDelivered:e.deviceNotDelivered.filter((e=>!a.has(e)))}}));return yield r.bulkCreateOrReplace(i),e.map((()=>{}))}));return function(){return n.apply(this,arguments)}}())}_processPeerReceipts(e){return(0,i.default)((function*(){const t=e.map((e=>{const{ts:t,msgKeys:n,ack:r}=e;return{ts:t,msgKeys:n,ack:r}}));return yield(0,f.getTable)().bulkCreate(t),e.map((()=>{}))}))()}_processReceiptAcks(e){return(0,i.default)((function*(){return yield function(e){e.forEach((e=>{let{from:t,stanzaId:n,ackString:r,participant:i}=e;const a=g(t,n,r,i);(0,o.castStanza)(a),(0,o.cancelDeadSocketTimer)()})),__LOG__(2)`[unify][batcher] finish sending ${e.length} acks`}(e),e.map((()=>{}))}))()}};t.receiptBatcher=y},405078:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateUI=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(708154),o=n(492574),s=n(960834),l=n(572556),c=r(n(389867)),u=n(390641);function d(){return(d=(0,i.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=yield(0,s.handleForActiveMessageRange)(e,t);if(i.has(l.ActiveRangeHandlerAction.DropMessage))return;const d=i.has(l.ActiveRangeHandlerAction.SkipUI);try{c.default.isStatusV3(e)&&(yield(0,a.frontendSendAndReceive)("handleStatusV3Update",{rawMsg:t,checksum:null,isMsgUpdate:!1})),d||(t.recvFresh=!0,t.isNewMsg=!0,yield(0,a.frontendSendAndReceive)("processMultipleMessages",{chatId:e,msgObjs:[t],meta:{add:"after",update:n,isHistory:!1},chatMsgsCollection:null,preserveOrder:r}))}catch(n){if(n instanceof o.LogoutDrop)return;if(n instanceof u.PreviousMsgNotPlaceholderError)return void __LOG__(3)`Msg: ${String(t.id)} chat: ${String(e)} Error: PreviousMsgNotPlaceholderError`;__LOG__(3,void 0,void 0,void 0,["messaging"])`Msg: ${String(t.id)} chat: ${String(e)} Error: ${n.name}, message: ${n.message}, stack: ${n.stack}`}}))).apply(this,arguments)}},437039:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBuildHash=g,t.getClientPayloadForLogin=function(e){const t=(0,u.assertGetMe)(),n=(0,i.default)((0,i.default)({},h(e)),{},{username:parseInt(t.user,10),device:null!=t.device?t.device:0});return(0,_.encodeProtobuf)(p.ClientPayloadSpec,n).readByteArray()},t.getClientPayloadForRegistration=function(e,t,n){const r=g(),a=m(),s=(0,i.default)((0,i.default)({},h(n)),{},{devicePairingData:{buildHash:r,deviceProps:a,eRegid:(0,o.intToBytes)(4,e.registrationId),eKeytype:(0,o.intToBytes)(1,5),eIdent:e.identityKeyPair.pubKey,eSkeyId:(0,o.intToBytes)(3,t.keyId),eSkeyVal:t.keyPair.pubKey,eSkeySig:t.signature}});return(0,_.encodeProtobuf)(p.ClientPayloadSpec,s).readByteArray()},t.getCompanionProps=m,t.getPlatformTypeFromName=S,t.getUserAgent=y,t.getWebSubPlatform=E;var i=r(n(81109)),a=n(615688),o=n(51239),s=r(n(611782)),l=r(n(379264)),c=n(134898),u=n(978820),d=n(698263),p=n(384331),f=n(642448),_=n(760980);function h(e){var t,n;return{passive:null!==(t=null==e?void 0:e.passive)&&void 0!==t&&t,pull:null!==(n=null==e?void 0:e.pull)&&void 0!==n&&n,connectType:p.ClientPayload$ConnectType.WIFI_UNKNOWN,connectReason:p.ClientPayload$ConnectReason.USER_ACTIVATED,userAgent:y(),webInfo:{webSubPlatform:E()}}}function g(){const e=(0,a.decodeB64)((0,s.default)("2.2228.14"));return new Uint8Array(e)}function m(){const e=l.default.info();let t;if(e.version&&""!==e.version){const n=e.version.split(".");n.length>0&&e.version&&/^[0-9\.]+$/.test(e.version)&&(t={primary:parseInt(n[0],10),secondary:n.length>1?parseInt(n[1],10):void 0,tertiary:n.length>2?parseInt(n[2],10):void 0})}const n={os:e.os,version:t,platformType:S(e.name),requireFullSync:!1};return(0,_.encodeProtobuf)(d.DevicePropsSpec,n).readByteArray()}function y(){const e=c.deviceInfo.get(),t=p.ClientPayload$UserAgent$ReleaseChannel.RELEASE;return{appVersion:{primary:Number("2"),secondary:Number("2228"),tertiary:Number("14")},platform:p.ClientPayload$UserAgent$Platform.WEB,releaseChannel:t,mcc:e.mcc,mnc:e.mnc,osVersion:e.osVersion,manufacturer:e.manufacturer,device:e.device,osBuildNumber:e.osBuild,localeLanguageIso6391:e.lg,localeCountryIso31661Alpha2:e.lc}}function S(e){switch(e){case"Chrome":return d.DeviceProps$PlatformType.CHROME;case"Firefox":return d.DeviceProps$PlatformType.FIREFOX;case"IE":return d.DeviceProps$PlatformType.IE;case"Opera":return d.DeviceProps$PlatformType.OPERA;case"Safari":return d.DeviceProps$PlatformType.SAFARI;case"Edge":return d.DeviceProps$PlatformType.EDGE;case"electron":case"Desktop":return d.DeviceProps$PlatformType.DESKTOP;case"ipad":case"iPad":return d.DeviceProps$PlatformType.IPAD;case"tablet":case"Android tablet":return d.DeviceProps$PlatformType.ANDROID_TABLET;case"Ohana":return d.DeviceProps$PlatformType.OHANA;case"Aloha":return d.DeviceProps$PlatformType.ALOHA;case"Catalina":return d.DeviceProps$PlatformType.CATALINA;default:return d.DeviceProps$PlatformType.UNKNOWN}}function E(){switch(f.WAM_PLATFORM){case"WEB":return p.ClientPayload$WebInfo$WebSubPlatform.WEB_BROWSER;case"DARWIN":case"DARWIN_BETA":return p.ClientPayload$WebInfo$WebSubPlatform.DARWIN;case"WIN32":case"WIN32_BETA":return p.ClientPayload$WebInfo$WebSubPlatform.WIN32;case"MACSTORE":return p.ClientPayload$WebInfo$WebSubPlatform.APP_STORE;case"WINSTORE":return p.ClientPayload$WebInfo$WebSubPlatform.WIN_STORE;default:return}}},617327:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return t.catch((0,r.catchAbort)((()=>{}))).catch((function(t){e.cancel(t)})),t};var r=n(389385)},171520:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n={ROOT:1,THENABLE:2,FINALLY:3,META:4},r={PENDING:1,FULFILLED:2,REJECTED:3};function i(){let e,t;switch(this._parent=null,this._subs=[],this._catchTypes=null,this._onResolve=null,this._onReject=null,this.type=n.ROOT,this.state=r.PENDING,this.value=void 0,this._forceable=!1,this._cancellable=!1,arguments.length){case 0:break;case 1:e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new Error("TightPromise constructor with "+arguments.length+" arguments")}if(this.context=t,arguments.length>0)try{e.call(t,o.bind(this),s.bind(this))}catch(e){s.call(this,e)}}function a(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const a=new i;return a.type=n.THENABLE,a._onReject=arguments[arguments.length-1],arguments.length>1&&(a._catchTypes=Array.prototype.slice.call(arguments,0,arguments.length-1),a._catchTypes.forEach((function(e){if("function"!=typeof e)throw new Error("expected type, got "+e)}))),this._addChild(a),a}function o(e){var t;this.state===r.PENDING&&("object"!=typeof(t=e)&&"function"!=typeof t||"function"!=typeof t.then?(this.value=e,this.state=r.FULFILLED,this._notifySubs()):e.then(o.bind(this),s.bind(this)))}function s(e){this.state===r.PENDING&&(this.value=e,this.state=r.REJECTED,this._notifySubs())}i.STATE=r,i.TYPE=n,i.prototype={isPending:function(){return this.state===r.PENDING},then:function(e,t){if(!e&&!t)return this;const r=new i;return r.type=n.THENABLE,r._onResolve=e||null,r._onReject=t||null,this._addChild(r),r},catch:a,catchType:a,catchTypes:a,catchTypes3:a,catchEqualTo:a,finally:function(e){const t=new i;return t.type=n.FINALLY,t._onResolve=e,this._addChild(t),t},bind:function(e){const t=new i;return t.type=n.META,this._addChild(t),t.context=e,t},spread:function(e){return this.then((function(t){e.apply(this,t)}))},get:function(e){return this.then((function(t){return t[e]}))},forceable:function(){const e=new i;return e.context=this.context,e.type=n.META,this._addChild(e),e._forceable=!0,e},cancellable:function(){const e=new i;return e.context=this.context,e.type=n.META,this._addChild(e),e._cancellable=!0,e},force:function(e){if(this._forceable){let t=this;for(;t.type===n.META;){const e=t._parent;if(!(null==e?void 0:e._forceable)||e.state!==r.PENDING)break;t=e}o.call(this,e)}},cancel:function(e){let t=e;if(this._cancellable){t=t||new Promise.CancellationError;let e=this,n=!1;do{const t=e._parent;(null==t?void 0:t._cancellable)&&t.state===r.PENDING?e=t:n=!0}while(!n);s.call(e,t)}},loosen:function(){return Promise.resolve(this)},_run:function(e,t){let n;try{n=e.call(this.context,t)}catch(e){return void s.call(this,e)}o.call(this,n)},_handle:function(){if(this.state!==r.PENDING)return;const e=this._parent;switch(this.type){case n.THENABLE:if(e.state===r.FULFILLED){const t=this._onResolve;t?this._run(t,e.value):o.call(this,e.value)}else if(this._onReject){const t=this._catchTypes,n=t?t.length:0,r=e.value;if(0===n)return void this._run(this._onReject,r);for(let e=0;e<n;e++)if(r instanceof t[e])return void this._run(this._onReject,r);s.call(this,r)}else s.call(this,e.value);return;case n.FINALLY:try{this._onResolve.call(this.context)}catch(e){!function(e){setTimeout((function(e){throw e}),0,e)}(e)}default:e.state===r.FULFILLED?o.call(this,e.value):s.call(this,e.value)}},_addChild:function(e){e._parent=this,e.context=this.context,e._cancellable=this._cancellable,e.type===n.META&&(e._forceable=this._forceable),this.state===r.PENDING?this._subs.push(e):e._handle()},_notifySubs:function(){this._subs.forEach((function(e){e._handle()}))}},i.delay=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r,a;switch(arguments.length){case 0:r=0;break;case 1:r=arguments[0];break;default:r=arguments[1],a=arguments[0]}return new i((function(e){setTimeout(e.bind(null,a),r)}))},i.resolve=function(e){const t=new i;return o.call(t,e),t},i.reject=function(e){const t=new i;return s.call(t,e),t};var l=i;t.default=l},10151:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=D;var i=r(n(348926)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=R(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(971446)),o=n(765044),s=n(541080),l=n(708154),c=n(546582),u=n(88555),d=n(772651),p=n(555452),f=n(711597),_=n(736163),h=n(797480),g=n(845831),m=n(776214),y=n(400318),S=n(252771),E=r(n(532473)),v=n(312779),T=n(736184),C=n(183254),A=n(781572),b=r(n(467938)),P=r(n(652991)),O=n(662583),M=n(209635),I=n(909530),w=n(669393);function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(R=function(e){return e?n:t})(e)}function N(){return L.apply(this,arguments)}function L(){return(L=(0,i.default)((function*(){const e=(0,M.getCommsConfig)(void 0);return(0,T.startComms)(E.default,v.sendPing,e,(e=>Promise.resolve((0,d.inflate)(e)))),yield(0,T.waitForConnection)(),(0,T.startHandlingRequests)()}))).apply(this,arguments)}function D(e){const t=(0,s.makeBridge)();return(0,l.setApi)(t),(0,c.requireSetHandlers)().then((e=>e(t))),w.QPL.throwKillswitch((0,u.isLegacyWebdBackend)()),(0,u.isLegacyWebdBackend)()?(o.Socket.launch(e),Promise.resolve()):(0,g.initEncSalt)().then((()=>(0,g.initEncSaltForInvoker)())).then((()=>(0,y.initialize)())).then((()=>{})).catch((e=>{__LOG__(4,void 0,new Error,void 0,["launch_socket"])`storageInitializationError triggered logout: ${(null==e?void 0:e.message)||(null==e?void 0:e.name)}.`,A.Cmd.storageInitializationError()})).then((()=>{if(P.default.isLogoutInProgress)throw new Error("aborting launchSocket due to logout");return(0,f.isRegistered)()?(__LOG__(2)`[launch socket] launch socket for loggin`,(0,I.setIsConnectedAsRegistered)(!0),A.Cmd.initialLoadReady(),(0,m.initialize)().catch((()=>A.Cmd.storageInitializationError())).then((()=>{A.Cmd.incrementProgress(),(0,_.restoreImportantMetaData)()})).then((()=>(0,_.restoreBlocklist)())).then((()=>{A.Cmd.incrementProgress(),a.setStartCommsT(),(0,S.startBackend)()}))):(__LOG__(2)`[launch socket] launch socket for registration`,A.Cmd.incrementProgress(),h.OfflineResumeReporter.setIsInitialSync(),Promise.all([(0,C.refreshNoiseCredentials)(),(0,C.refreshSignalCredentials)()]).then((()=>{A.Cmd.incrementProgress(),N()})))}))}A.Cmd.on("md_downgrade_webclient",(0,i.default)((function*(){(0,T.stopComms)(),yield(0,g.deleteEncKeysAndCache)(),o.Socket.set({launched:!1,stream:O.SOCKET_STREAM.DISCONNECTED,mustExitLoop:!1,shouldUpgradeToMD:!1}),(0,p.setMdOptedIn)(!1),(0,u.switchToLegacyWebdBackend)(),o.Socket.initialize(),o.Socket.handler||o.Socket.registerHandler(b.default),D(!0)}))),A.Cmd.on("upgrade_to_md",(()=>{(0,u.switchToMDBackend)(),D(!0),(0,f.setUpgradeMdWamFlag)(!0)})),A.Cmd.on("upgrade_to_md_prod",(()=>{(0,u.switchToMDBackend)(),D(!0),(0,f.setUpgradeMdWamFlag)(!0)})),A.Cmd.on("md_refresh_qr",(()=>{(0,T.stopComms)(),N()})),A.Cmd.on("logout",(()=>{(0,u.isLegacyWebdBackend)()||D(!0)}))},185726:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,h.isRegistered)())return function(){return N.apply(this,arguments)}(e);return function(){return L.apply(this,arguments)}(e)};var i=r(n(348926)),a=n(615688),o=n(108584),s=n(117525),l=(n(787614),n(110095)),c=r(n(145095)),u=n(287040),d=n(127498),p=n(781572),f=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(138062)),_=n(134898),h=n(711597),g=n(484902),m=n(760980),y=n(437039),S=n(640623),E=r(n(733815)),v=n(824774),T=n(178155),C=r(n(312523)),A=n(765044);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}const P=new Uint8Array([87,65,6,d.DICT_VERSION]),O="Noise_XX_25519_AESGCM_SHA256\0\0\0\0";let M;function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(){const e=(0,h.getRoutingInfo)(),t=e?e.edgeRouting:null;let n=t?(0,a.encodeB64UrlSafe)(t):null;const r=new E.default({routingToken:n}),i=f.keyPair(),[c,u,d]=yield(0,C.default)(r,"change:socket").cancellable().then((()=>r.socket)).finally((()=>{r.deactivate()})).then((e=>{let n;if(t){const e=new o.Binary;e.write("ED",0,1),e.writeUint8(t.byteLength>>16),e.writeUint16(65535&t.byteLength),e.writeBuffer(t),n=e.readByteArray()}const r=n?o.Binary.build(n,P).readByteArray():P,a=new s.FrameSocket(e,r);M=new l.NoiseHandshake(a),M.start(O,P),__LOG__(2)`openChatSocket send hello`,M.authenticate(i.pubKey);const c={clientHello:{ephemeral:i.pubKey}};return M.sendAndReceive((0,m.encodeProtobuf)(T.HandshakeMessageSpec,c).readByteArray())})).then((e=>R(M,e,i)));return __LOG__(2)`verifying certificate`,(0,v.verifyChainCertificateWA6)(u,c),d}))).apply(this,arguments)}function R(e,t,n){__LOG__(2)`openChatSocket rcv hello`;const{serverHello:r}=(0,g.decodeProtobuf)(T.HandshakeMessageSpec,t);if(!r)throw new Error("ServerHello payload error");const{ephemeral:i,static:a,payload:o}=r;if(null==i||null==a||null==o)throw new Error("Missing server Ephemeral");e.authenticate(i),e.mixIntoKey(f.sharedSecret(i,n.privKey));const s=e.decrypt(a),l=s.then((e=>f.sharedSecret(e,n.privKey)));return e.mixIntoKey(l),Promise.all([s,e.decrypt(o),i])}function N(){return(N=(0,i.default)((function*(e){try{const t=yield _.waNoiseInfo.get(),n=yield I().then((n=>{p.Cmd.incrementProgress(),null==t&&(__LOG__(2,void 0,void 0,void 0,["Open Chat Socket"])`Unable to decrypt noise data`,A.Socket.logout(),(0,c.default)(t,"noiseData"));const r=(0,c.default)(t,"noiseData").staticKeyPair,i=(0,y.getClientPayloadForLogin)(e);return Promise.all([D(r,M,n),M.encrypt(Promise.resolve(i))])})).then((e=>{let[t,n]=e;return p.Cmd.incrementProgress(),M.send((0,m.encodeProtobuf)(T.HandshakeMessageSpec,{clientFinish:{static:t,payload:n}}).readByteArray()),M.finish()}));return p.Cmd.incrementProgress(),__LOG__(2)`openChatSocketForLogin success, resetting round`,(0,u.makeResult)(n)}catch(e){return __LOG__(3)`openChatSocketForLogin error ${e}`,(0,u.makeError)("disconnected")}}))).apply(this,arguments)}function L(){return(L=(0,i.default)((function*(e){try{const t=yield I().then((e=>Promise.all([S.waSignalStore.getRegistrationInfo(),S.waSignalStore.getSignedPreKey(),e]))).then(function(){var t=(0,i.default)((function*(t){let[n,r,i]=t;if(!r||!n)throw new Error("Invalid signal credentials");const a=(0,y.getClientPayloadForRegistration)(n,r,e),o=(0,c.default)(yield _.waNoiseInfo.get(),"yield waNoiseInfo.get()").staticKeyPair;return Promise.all([D(o,M,i),M.encrypt(Promise.resolve(a))])}));return function(){return t.apply(this,arguments)}}()).then((e=>{let[t,n]=e;return M.send((0,m.encodeProtobuf)(T.HandshakeMessageSpec,{clientFinish:{static:t,payload:n}}).readByteArray()),M.finish()}));return __LOG__(2)`openChatSocketForRegistration success, resetting round`,(0,u.makeResult)(t)}catch(e){return __LOG__(3)`openChatSocketForRegistration error ${e}`,(0,u.makeError)("disconnected")}}))).apply(this,arguments)}function D(e,t,n){const r=Promise.resolve(e.pubKey),i=t.encrypt(r);if(!n)return Promise.reject(new Error("staticAgreement called before serverKeys"));const a=f.sharedSecret(n,e.privKey);return t.mixIntoKey(a),i}},172006:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.openSocket=function(e){return new WebSocket(e)};r(n(145095)),n(957932),r(n(904285))},183254:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildUrl=function(e,t,n){if(!/^https:\/\/[-\w.]+\.\w+$/.test(e))throw new Error(`buildUrl given invalid host "${e}"`);if(!t.startsWith("/"))throw new Error(`buildUrl given invalid path "${t}"`);const r=n,i=`${e}${t}`;if(!r)return i;const a=Object.keys(r).map((e=>{let t=r[e];t instanceof ArrayBuffer&&(t=new Uint8Array(t));const n=t instanceof Uint8Array?Array.prototype.slice.call(t).map((e=>`%${e.toString(16)}`)).join(""):encodeURIComponent(t);return`${encodeURIComponent(e)}=${n}`}));if(a.length>0){const e=a.join("&");return i.includes("?")?`${i}&${e}`:`${i}?${e}`}return i},t.refreshNoiseCredentials=function(){const e=(0,o.keyPair)(),t=new Uint8Array(24);return self.crypto.getRandomValues(t),Promise.resolve(s.waNoiseInfo.set({recoveryToken:t.buffer,staticKeyPair:e}))},t.refreshSignalCredentials=function(){return d.apply(this,arguments)},t.setRoutingInfo=function(e,t){const n={domain:e,edgeRouting:t?(0,a.decodeB64)(t):null};return __LOG__(2)`set routingInfo:`,Promise.resolve((0,l.setRoutingInfo)(n))};var i=r(n(348926)),a=n(615688),o=n(138062),s=n(134898),l=n(711597),c=n(640623),u=n(985614);function d(){return(d=(0,i.default)((function*(){const e=self.libsignal.KeyHelper.generateRegistrationId();yield c.waSignalStore.clearCredential();const t=yield(0,u.generateIdentityKeyPair)();yield Promise.all([c.waSignalStore.setRegistrationInfo({registrationId:e,identityKeyPair:t}),c.waSignalStore.rotateSignedPreKey((0,o.toSignalCurveKeyPair)(t),u.generateSignedKeyPair)])}))).apply(this,arguments)}},662583:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WATCHED_SOCKET_STATE=t.SOCKET_STREAM=t.SOCKET_STATE=void 0;t.SOCKET_STATE={OPENING:"OPENING",PAIRING:"PAIRING",UNPAIRED:"UNPAIRED",UNPAIRED_IDLE:"UNPAIRED_IDLE",CONNECTED:"CONNECTED",TIMEOUT:"TIMEOUT",CONFLICT:"CONFLICT",UNLAUNCHED:"UNLAUNCHED",PROXYBLOCK:"PROXYBLOCK",TOS_BLOCK:"TOS_BLOCK",SMB_TOS_BLOCK:"SMB_TOS_BLOCK",DEPRECATED_VERSION:"DEPRECATED_VERSION",SCREEN_LOCKED:"SCREEN_LOCKED",LOCKED:"LOCKED"};t.SOCKET_STREAM={DISCONNECTED:"DISCONNECTED",SYNCING:"SYNCING",RESUMING:"RESUMING",CONNECTED:"CONNECTED"};t.WATCHED_SOCKET_STATE={OPEN:"OPEN",CLOSED:"CLOSED"}},794030:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(389385),o=n(108584),s=n(856),l=n(413959),c=n(767924),u=i(n(312523)),d=n(932533),p=n(885553),f=i(n(681602)),_=n(966567),h=n(12099),g=i(n(978144)),m=n(411290);const y=3e5,S=18e4,E=(0,_.fibonacci)(8e3,4e3,3e5);class v extends m.BaseModel{constructor(){super(...arguments),this.active=(0,m.prop)(!0),this.socket=(0,m.prop)(),this.sockets=(0,m.prop)(),this.pendingSocketPromiseCount=(0,m.prop)(0),this.attempts=(0,m.prop)(0),this.startId=(0,m.prop)(0),this.controller=(0,m.prop)(),this.retryTimestamp=(0,m.prop)(),this.tsListener=(0,m.prop)(),this.onerror=(0,m.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpener set to socket ${e.id}`,this.set({active:!1,socket:e}),f.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpener closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpener deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(f.default,"change:online",this._handleOnlineChange),this.listenTo(p.jsHaltDetector,c.JS_HALT_EVENT,this._handleJsHalt),this._handleOnlineChange()}attemptOpen(){if(!this.active)return __LOG__(2,void 0,void 0,!0)`attemptOpen called while not active!`,void SEND_LOGS("rogue-opener");const e=(0,h.open)({url:"wss://web.whatsapp.com/ws",msgParser:C});this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const n=function(){if(t)return Promise.resolve();t=!0;const e=(new r).signal;return f.default.checkOnline({signal:e})},i=new r;(0,l.delayMs)(6e3,i.signal).then((()=>n())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>n()))}poke(){this.controller&&this.controller.forceTimeout()}_handleOnlineChange(){if(!this.active)return;const e=this.controller,t=f.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpener:onlineController activating`,new _.Watchdog({waitAlgorithm:E,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpener:offlineController activating`;let e,t=0;return new _.Watchdog({waitAlgorithm:r=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpener:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpener:offline... heuristic poll`,e=T(r,[(0,d.waitForOnlineNaive)(),(0,u.default)(p.jsHaltDetector,c.JS_HALT_EVENT),(0,u.default)(n(608080).Stream,"change:available")]),y):(__LOG__(2)`SocketOpener:offline... wait for navigator`,t=0,e=T(r,[(0,d.waitForOnlineNaive)()]),y)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}_handleJsHalt(e){const t=this.controller;t&&e>S&&(__LOG__(2)`js halt longer than ${S} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function T(e,t){return(0,s.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}function C(e){const t=e.data;let n,r,i;if(t instanceof ArrayBuffer){let e;const a=[],s=new o.Binary(t);for(;44!==(e=s.readUint8());)a.push(e);n=String.fromCharCode.apply(String,a),r=s.readBuffer(),i=t.byteLength}else{if("string"!=typeof t)throw new Error("Unexpected message event type");{const e=t.indexOf(",");n=t.slice(0,e),r=t.slice(e+1),r=r?JSON.parse(r,g.default):void 0,i=new Blob([t]).size}}return{tag:n,data:r,binarySize:i}}var A=(0,m.defineModel)(v);t.default=A},733815:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(389385),o=n(856),s=n(413959),l=n(767924),c=i(n(312523)),u=n(932533),d=n(885553),p=i(n(681602)),f=n(966567),_=n(714350),h=n(411290);const g="wss://web.whatsapp.com/ws/chat",m=3e5,y=18e4,S=(0,f.fibonacci)(8e3,4e3,3e5);class E extends h.BaseModel{constructor(){super(...arguments),this.active=(0,h.prop)(!0),this.socket=(0,h.prop)(),this.sockets=(0,h.prop)(),this.pendingSocketPromiseCount=(0,h.prop)(0),this.attempts=(0,h.prop)(0),this.controller=(0,h.prop)(),this.retryTimestamp=(0,h.prop)(),this.tsListener=(0,h.prop)(),this.onerror=(0,h.prop)()}initialize(){this.sockets=[],new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((e=>{__LOG__(2)`SocketOpenerMD set to socket ${e.id}`,this.set({active:!1,socket:e}),p.default.online=!0})).finally((()=>{this.stopListening(),__LOG__(2)`SocketOpenerMD closing socket opener`,this.active=!1,this.sockets.forEach((e=>{e.cancel()}));const e=this.controller;e&&(e.deactivate(),this.controller=null)})).catch((0,a.catchAbort)((()=>{}))).catch((e=>{if(__LOG__(3)`SocketOpenerMD deadly error! ${String(e)}`,!this.onerror)throw e;this.onerror(e)})),this.tsListener=e=>{this.retryTimestamp=e.ts},this.listenTo(p.default,"change:online",this._handleOnlineChange),this.listenTo(d.jsHaltDetector,l.JS_HALT_EVENT,this._handleJsHalt),self.addEventListener("online",this._handleOnlineChange()),this._handleOnlineChange()}attemptOpen(){if(!this.active)return void __LOG__(2)`attemptOpen called while not active!`;const e=(0,_.open)(this.routingToken?`${g}?ED=${this.routingToken}`:g);this.attempts=this.sockets.push(e),this.pendingSocketPromiseCount++;let t=!1;const n=function(){if(t)return Promise.resolve();t=!0;const e=(new r).signal;return p.default.checkOnline({signal:e})},i=new r;(0,s.delayMs)(6e3,i.signal).then((()=>n())).catch((()=>{})),e.then(this._resolve).finally((()=>{this.pendingSocketPromiseCount--,i.abort()})).catch((0,a.catchAbort)((()=>{}))).catch((()=>n()))}poke(){this.controller&&this.controller.forceTimeout()}_handleOnlineChange(){if(!this.active)return;const e=this.controller,t=p.default.online?this.onlineController():this.offlineController();e&&(e.off("change:ts",this.tsListener),e.deactivate()),t.on("change:ts",this.tsListener),t.activate(),this.controller=t}onlineController(){return __LOG__(2)`SocketOpenerMD:onlineController activating`,new f.Watchdog({waitAlgorithm:S,jitter:.2,onActivated:()=>{this.attemptOpen()},onTimeout:()=>(this.attemptOpen(),!0)})}offlineController(){__LOG__(2)`SocketOpenerMD:offlineController activating`;let e,t=0;return new f.Watchdog({waitAlgorithm:r=>(e&&e.cancel(),navigator.onLine?t++<2?(__LOG__(2)`SocketOpenerMD:offline... quick poll`,e=null,6e3):(__LOG__(2)`SocketOpenerMD:offline... heuristic poll`,e=v(r,[(0,u.waitForOnlineNaive)(),(0,c.default)(d.jsHaltDetector,l.JS_HALT_EVENT),(0,c.default)(n(608080).Stream,"change:available")]),m):(__LOG__(2)`SocketOpenerMD:offline... wait for navigator`,t=0,e=v(r,[(0,u.waitForOnlineNaive)()]),m)),jitter:.2,onActivated:()=>{0===this.pendingAttempts()&&this.attemptOpen()},onDeactivated:()=>{e&&e.cancel()},onTimeout:()=>(this.attemptOpen(),!0)})}deactivate(){this._reject(new a.AbortError)}pendingAttempts(){return this.pendingSocketPromiseCount}_handleJsHalt(e){const t=this.controller;t&&e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, resetting watchdog fail generation`,t.resetGeneration())}}function v(e,t){return(0,o.promiseAny)(t).cancellable().then((()=>{e.forceTimeout()})).finally((()=>{t.forEach((e=>{e.cancel()}))})).catch((0,a.catchAbort)((()=>{})))}var T=(0,h.defineModel)(E);t.default=T},824774:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseCertificateWA6=u,t.verifyCertificateWA6=d,t.verifyChainCertificateWA6=function(e,t){const n=(0,s.decodeProtobuf)(o.CertChainSpec,e);if(!n)throw new Error("verifyCertificateWA6 - Missing Certificate");const i=n.intermediate,a=n.leaf;if(null==i||null==a)throw new Error("verifyCertificateWA6 - Missing Leaf and/or Intermediate Certificate");__LOG__(2)`verifying intermediate certificate`;const l=u(i);if(d(l,c.PUBLIC_KEY),l.issuerSerial!==c.SERIAL)throw new Error("verifyChainCertificateWA6 intermediateCert was not issued by RootCA");__LOG__(2)`verifying leaf certificate`;const p=u(a);if(d(p,l.key),p.issuerSerial!==l.serial)throw new Error("verifyChainCertificateWA6 leafCert was not issued by IntermediateCert");if(!(0,r.arrayBuffersEqual)(p.key,t))throw new Error("verifyChainCertificateWA6 leafCert.key does not match handshake server.hello.static")};var r=n(607589),i=n(787614),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(138062)),o=n(640965),s=n(484902);function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}const c={SERIAL:0,ISSUER:"WhatsAppLongTerm1",PUBLIC_KEY:(0,i.parseHex)("142375574d0a587166aae71ebe516437c4a28b73e3695c6ce1f7f9545da8ee6b")};function u(e){const t=e.details,n=e.signature;if(!t)throw new Error('parseCertificateWA6 certificate is missing "details"');if(!n)throw new Error('parseCertificateWA6 certificate is missing "signature"');const r=(0,s.decodeProtobuf)(o.CertChain$NoiseCertificate$DetailsSpec,t),{issuerSerial:i,serial:a,key:l,notAfter:c,notBefore:u}=r;if(null==i)throw new Error('parseCertificateWA6 certificate is missing "issuer_serial"');if(null==a)throw new Error('parseCertificateWA6 certificate is missing "serial"');if(null==l)throw new Error('parseCertificateWA6 certificate is missing "key"');return{serial:a,issuerSerial:i,key:l,notBefore:u,notAfter:c,details:t,signature:n}}function d(e,t){if(!a.verifySignature(new Uint8Array(t),new Uint8Array(e.details),new Uint8Array(e.signature)))throw new Error("verifyCertificateWA6 certificate is poorly signed!")}},966567:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Watchdog=void 0,t.fibonacci=function(e,t,n){if("number"==typeof n){const r=n;return function(n){switch(n.failGeneration){case 0:return Math.min(r,t);case 1:return Math.min(r,e+t);default:return Math.min(r,n.waitDuration+n.prevWaitDuration)}}}return function(n){switch(n.failGeneration){case 0:return t;case 1:return e+t;default:return n.waitDuration+n.prevWaitDuration}}};var r=n(657319),i=n(411290);class a extends i.BaseModel{constructor(){super(...arguments),this.failGeneration=(0,i.session)(0),this.ts=(0,i.session)(),this.waitDuration=(0,i.session)(0),this.prevWaitDuration=(0,i.session)(0),this.jitter=(0,i.session)(0),this.shiftTimer=(0,i.session)(),this.waitAlgorithm=(0,i.session)(),this.onActivated=(0,i.session)(),this.onDeactivated=(0,i.session)(),this.onFed=(0,i.session)(),this.onTimeout=(0,i.session)()}initialize(){this.shiftTimer=new r.ShiftTimer((()=>s.call(this)))}activate(){this.shiftTimer.isScheduled()||(this._run(!0),this.onActivated&&this.onActivated(this))}deactivate(){this.shiftTimer.isScheduled()&&(this.shiftTimer.cancel(),this.onDeactivated&&this.onDeactivated(this))}feed(){this.shiftTimer.isScheduled()&&(this._run(!0),this.onFed&&this.onFed(this))}forceTimeout(e){this.shiftTimer.isScheduled()?null!=e&&0!==e?(this.shiftTimer.onOrBefore(e),this.ts=this.shiftTimer.ts):this.shiftTimer.forceRunNow():__LOG__(3)`forced non-running watchdog!`}poke(){this.forceTimeout.apply(this,arguments)}resetGeneration(){this.failGeneration=0}_run(e){e&&this.resetGeneration();const t=this.waitAlgorithm(this),n=this.jitter*Math.random()*t;this.shiftTimer.debounce(t+n),this.set({ts:this.shiftTimer.ts,waitDuration:t,prevWaitDuration:this.waitDuration})}}const o=(0,i.defineModel)(a);function s(){const e=this.onTimeout;if(!e)return __LOG__(3,void 0,void 0,!0)`Watchdog timed-out without handler!`,void SEND_LOGS("watchdog-no-handler");this.failGeneration++,e(this)&&this._run(!1)}t.Watchdog=o},12099:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketModel=void 0,t.open=function(e){let t;try{t=new v(e)}catch(e){return __LOG__(3)`WatchedSocket error constructing: ${e}`,p.default.reject(e)}return new p.default(t,(function(e,t){this.id=(v.numSocketsAttempted++).toString(),__LOG__(2)`WatchedSocket opening socket ${this.id}`;const n=(0,f.openSocket)(this.url);n.binaryType="arraybuffer",n.onopen=e,n.onclose=n.onerror=function(e){t(new d.SocketError(e))},this.socket=n})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocket error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocket opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._handleMessage.bind(this),e.onerror=this._handleCloseOrError.bind(this,!0),e.onclose=this._handleCloseOrError.bind(this,!1),this._offlineListener=(0,c.default)().then(this.close.bind(this,!1,"offline")).catch((0,a.catchAbort)((()=>{}))),this._pingTimer.onOrAfter(T()),this.state=_.WATCHED_SOCKET_STATE.OPEN,this}))};var i=r(n(82569)),a=n(389385),o=n(638284),s=n(657319),l=n(767924),c=r(n(3121)),u=n(885553),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=m(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),p=r(n(171520)),f=n(172006),_=n(662583),h=r(n(833163)),g=n(411290);function m(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(m=function(e){return e?n:t})(e)}const y=18e4;function S(e,t){let n=-1;const r=e.find((e=>(n++,t(e))));return void 0===r?void 0:{index:n,value:r}}class E extends g.BaseModel{constructor(){super(...arguments),this.id=(0,g.session)(),this.url=(0,g.session)(),this.onmessage=(0,g.session)(),this.onactivity=(0,g.session)(),this.timeSkew=(0,g.session)(),this.msgParser=(0,g.session)(),this.state=(0,g.session)(),this.error=(0,g.session)(),this.socket=(0,g.session)(),this.isQueueing=(0,g.session)(!0),this.maxQueueSize=(0,g.session)(),this.messageQueue=(0,g.session)(),this._offlineListener=(0,g.session)(),this._msgListeners=(0,g.session)(),this._pingTimer=(0,g.session)(),this._killTimer=(0,g.session)()}initialize(){this._msgListeners=[],this.messageQueue=[],this._pingTimer=new s.ShiftTimer((()=>this._ping())),this._killTimer=new s.ShiftTimer((()=>this._killSocket())),u.jsHaltDetector.on(l.JS_HALT_EVENT,this._handleJsHalt,this)}_handleJsHalt(e){e>y&&(__LOG__(2)`js halt longer than ${y} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_ping(){this.send("?,,"),this._killTimer.onOrAfter(C())}_killSocket(){__LOG__(3)`WatchedSocket ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.set({onactivity:void 0,onmessage:void 0})}send(e){this.cast(e),this._pingTimer.cancel(),this._killTimer.onOrAfter(C())}cast(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)throw new d.SocketNotOpen(this.state);if("string"==typeof e&&/\[object ArrayBuffer\]/.test(e))throw new TypeError("converted ArrayBuffer to string prematurely");try{this.socket.send(e)}catch(e){__LOG__(3,void 0,void 0,!0)`exception sending: ${e}\n${e.stack}`,SEND_LOGS("send-exception"),this.close(!0,e)}}partingSend(e,t,n){const r=this,i=this.socket,a=new Promise((function(a){function o(){a(void 0)}i.onclose=o,i.onerror=o,i.onmessage=function(e){const t=e.data;n&&!n(t)||a(t)},r.send(t),r._handleCloseOrError(!1,e)}));return(0,o.promiseTimeout)(a,2e4,"paringSendTimeout").catch((()=>{})).finally((function(){i.onclose=void 0,i.onerror=void 0,i.onmessage=void 0,i.readyState===WebSocket.OPEN&&i.close()}))}close(e,t){const n=this.socket;let r;if(this._handleCloseOrError(e,t||"unspecified"),n&&(r=n.readyState,r===WebSocket.CONNECTING||r===WebSocket.OPEN))try{n.close()}catch(e){__LOG__(3)`WatchedSocket:exception closing: ${e}\n${e.stack}`}}_handleMessage(e){this._pingTimer.onOrAfter(T()),this._killTimer.cancel();const t=e.data;if("string"==typeof t&&"!"===t.charAt(0)){const e=parseInt(t.slice(1),10);return e==e&&(this.timeSkew=Date.now()-e),void(this.onactivity&&this.onactivity())}const n=this.msgParser(e);this.onactivity&&this.onactivity(n),this._handleParsedMsg(n)}_handleParsedMsg(e){const t=S(this._msgListeners,(function(t){return!t.filter||t.filter(e)}));t?(this._msgListeners.splice(t.index,1),t.value.removed=!0,t.value.promise.force(e)):this.isQueueing?(__LOG__(3)`watchedSocket:enqueued`,this.messageQueue.push(e),void 0!==this.maxQueueSize&&this.messageQueue.length>this.maxQueueSize&&this.close(!0,"Queue Overflow")):this.onmessage?this.onmessage(e):__LOG__(3)`watchedSocket:dropped!`}_handleCloseOrError(e,t){if(this.state===_.WATCHED_SOCKET_STATE.CLOSED)return;this.socket&&(this.socket.onclose=void 0,this.socket.onerror=void 0,this.socket.onmessage=void 0),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,u.jsHaltDetector.off(l.JS_HALT_EVENT,this._handleJsHalt,this),this._pingTimer.cancel(),this._killTimer.cancel(),this.set({state:_.WATCHED_SOCKET_STATE.CLOSED,error:e?t:void 0});const n=this._msgListeners,r=e?new d.SocketError(t):new d.SocketClosed(t);this._msgListeners=[],n.forEach((function(e){e.removed=!0,e.promise.cancel(r)}))}holdMessages(e){const t=this.isQueueing&&void 0!==e&&this.messageQueue>e;this.set({isQueueing:!0,messageQueue:this.messageQueue||[],maxQueueSize:e}),t&&this.close(!0,"Queue Overflow")}releaseMessages(e){if(!this.isQueueing)return void __LOG__(3)`WatchedSocket:releaseMessages not queued!`;const t=this.messageQueue;this.set({isQueueing:!1,messageQueue:[]}),e?t.length>0&&__LOG__(3)`WatchedSocket:releaseMessages dropping ${t.length} messages.`:t.forEach((e=>{this._handleParsedMsg(e)}))}nextMessage(e){if(this.state!==_.WATCHED_SOCKET_STATE.OPEN)return p.default.reject(new d.SocketNotOpen(this.state)).cancellable();let t;if(t=e instanceof h.default?e.test.bind(e):e,this.isQueueing){let e;if(t){const n=S(this.messageQueue,t);n&&(e=n.value,this.messageQueue.splice(n.index,1))}else this.messageQueue.length>0&&(e=this.messageQueue.shift());if(e)return p.default.resolve(e).cancellable()}const n=(new p.default).cancellable().forceable(),r={removed:!1,filter:t,promise:n};return this._msgListeners.push(r),n.catch((()=>{r.removed||(this._msgListeners=(0,i.default)(this._msgListeners,r))})),n}}const v=(0,g.defineModel)(E);function T(){return 2e4*Math.random()+1e4}function C(){return 7e4*Math.random()+2e4}t.WatchedSocketModel=v,v.numSocketsAttempted=0},714350:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WatchedSocketMD=void 0,t.open=function(e){let t;try{t=new g(e)}catch(e){return __LOG__(3)`WatchedSocketMD error constructing: ${e}`,d.default.reject(e)}return new d.default(t,(function(e,t){g.numSocketsAttempted++,this.id=g.numSocketsAttempted,__LOG__(2)`WatchedSocketMD opening socket ${this.id}`;const n=(0,p.openSocket)(this.url);n.binaryType="arraybuffer",n.onopen=e,n.onclose=n.onerror=function(e){t(new u.SocketError(e))},this.socket=n})).cancellable().catch((function(e){if(__LOG__(2)`WatchedSocketMD error on open of ${this.id}: ${e}`,this.socket){const e=this.socket;switch(e.readyState){case WebSocket.CONNECTING:e.onopen=null;case WebSocket.OPEN:e.onerror=null,e.onclose=null,e.close();break;case WebSocket.CLOSING:case WebSocket.CLOSED:e.onerror=null,e.onclose=null}}throw e})).then((function(){__LOG__(2)`WatchedSocketMD opened socket ${this.id}`;const e=this.socket;return e.onmessage=this._handleMessage.bind(this),e.onerror=this._handleCloseOrError.bind(this,!0),e.onclose=this._handleCloseOrError.bind(this,!1),this._offlineListener=(0,l.default)().then(this.close.bind(this,!1,"offline")).catch((0,i.catchAbort)((()=>{}))),this.state=f.WATCHED_SOCKET_STATE.OPEN,this}))};var i=n(389385),a=n(108584),o=n(657319),s=n(767924),l=r(n(3121)),c=n(885553),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),d=r(n(171520)),p=n(172006),f=n(662583);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const h=18e4;class g{constructor(e){this.onError=null,this.dataToSend=new a.Binary,this.url=e,this._killTimer=new o.ShiftTimer((()=>this._killSocket())),c.jsHaltDetector.on(s.JS_HALT_EVENT,this._handleJsHalt,this)}_handleJsHalt(e){e>h&&(__LOG__(2)`js halt longer than ${h} ms detected, killing socket`,this._killTimer.cancel(),this._killTimer.onOrBefore(0))}_killSocket(){__LOG__(3)`WatchedSocketMD ${this.id} Timeout!`,this.close(!0,"stale")}detachCallbacks(){this.socket.onmessage=m}close(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;const n=this.socket;let r;if(this._handleCloseOrError(e,t||"unspecified"),n&&(r=n.readyState,r===WebSocket.CONNECTING||r===WebSocket.OPEN))try{n.close()}catch(e){__LOG__(3)`WatchedSocketMD:exception closing: ${e}\n${e.stack}`}}requestSend(){if(this.state!==f.WATCHED_SOCKET_STATE.OPEN)throw new u.SocketNotOpen(this.state);if(this.dataToSend.size())try{this.socket.send(this.dataToSend.readByteArray())}catch(e){__LOG__(3)`exception sending: ${e}\n${e.stack}`,this.close(!0,e)}}_handleMessage(e){if(!(e.data instanceof ArrayBuffer))throw new TypeError("expected ArrayBuffer from the socket");if(this.onData){(0,this.onData)(new Uint8Array(e.data))}}_handleCloseOrError(e,t){this.state!==f.WATCHED_SOCKET_STATE.CLOSED&&(this.socket&&(this.socket.onclose=m,this.socket.onerror=m,this.socket.onmessage=m),this._offlineListener&&this._offlineListener.cancel(),__LOG__(3)`Socket ${this.id} closing: ${t.toString()}`,c.jsHaltDetector.off(s.JS_HALT_EVENT,this._handleJsHalt,this),this._killTimer.cancel(),this.state=f.WATCHED_SOCKET_STATE.CLOSED,this.error=e?t:void 0,null!=this.onClose&&this.onClose())}}function m(){}t.WatchedSocketMD=g,g.numSocketsAttempted=0},615947:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceSentMessage=function(e,t){return{deviceSentMessage:{destinationJid:t.toString({legacy:!0}),message:e}}},t.createDisappearingMode=A,t.createDocumentWithCaptionsFutureProofMessage=C,t.createMessageKey=function(e){const t=N(e.to),n={fromMe:!0,id:e.id.id};(0,s.isString)(t)&&(n.remoteJid=t);return n},t.createMsgProtobuf=function(e,t){const n=function(e){const t=e.id,n=e.toJSON();delete n.status,delete n.mimetype,delete n.height,delete n.width,delete n.recipients,delete n.chat,delete n.broadcast,delete n.ack,delete n.invis,delete n.filehash,delete n.recvFresh,delete n.mediaData,p.default.isHttp(e.clientUrl)||delete n.clientUrl;p.default.isHttp(e.deprecatedMms3Url)||delete n.deprecatedMms3Url;for(const e in n)null==n[e]&&delete n[e];const r=y.default.get(t.remote);r&&(n.conversionTuple=r.serialize());return n}(e),r={};if(n.quotedMsg){const e=n.quotedMsg.mentionedJidList,t=Array.isArray(e)&&e.length>0?{mentionedJid:e.map(N)}:void 0;r.stanzaId=n.quotedStanzaID,r.remoteJid=N(n.quotedRemoteJid),r.participant=N(n.quotedParticipant),r.quotedMessage=w(n.quotedMsg,{duration:n.quotedMsg.duration,directPath:n.quotedMsg.directPath,encFilehash:n.quotedMsg.encFilehash,filehash:n.quotedMsg.filehash,height:n.quotedMsg.height,mediaKey:n.quotedMsg.mediaKey,mediaKeyTimestamp:(0,s.isNumber)(n.quotedMsg.mediaKeyTimestamp)?n.quotedMsg.mediaKeyTimestamp:void 0,mimetype:n.quotedMsg.mimetype,url:n.quotedMsg.clientUrl||n.quotedMsg.deprecatedMms3Url,width:n.quotedMsg.width},t)}else n.quotedRemoteJid&&n.quotedGroupSubject&&n.quotedParentGroupJid?(r.remoteJid=N(n.quotedRemoteJid),r.groupSubject=n.quotedGroupSubject,r.parentGroupJid=N(n.quotedParentGroupJid)):n.quotedRemoteJid&&(r.remoteJid=N(n.quotedRemoteJid));if(n.mentionedJidList&&n.mentionedJidList.length>0){const e=n.mentionedJidList;r.mentionedJid=e.map(N)}n.conversionTuple&&Object.assign(r,n.conversionTuple);n.isForwarded&&(r.isForwarded=n.isForwarded);n.forwardingScore&&(r.forwardingScore=n.forwardingScore);n.ephemeralDuration&&(r.expiration=n.ephemeralDuration);n.ephemeralSettingTimestamp&&(r.ephemeralSettingTimestamp=n.ephemeralSettingTimestamp);n.disappearingModeInitiator&&(r.disappearingMode=A(n.disappearingModeInitiator));n.ctwaContext&&(r.externalAdReply={sourceUrl:n.ctwaContext.sourceUrl,sourceId:n.ctwaContext.sourceId,sourceType:n.ctwaContext.sourceType,body:n.ctwaContext.description,title:n.ctwaContext.title,thumbnailUrl:n.ctwaContext.thumbnailUrl,thumbnail:n.ctwaContext.thumbnail?L(n.ctwaContext.thumbnail):void 0,mediaType:n.ctwaContext.mediaType,mediaUrl:n.ctwaContext.mediaUrl});return w(n,t,Object.keys(r).length>0?r:void 0)},t.createViewOnceFutureProofMessage=T,t.encodeJid=N,t.populateMessageContextInfo=function(e,t,n){if(!t&&!n)return;e.messageContextInfo=(0,a.default)((0,a.default)({},e.messageContextInfo),{},{deviceListMetadata:{senderKeyHash:null==t?void 0:t.keyHash,senderTimestamp:null==t?void 0:t.timestamp,senderKeyIndexes:null==t?void 0:t.keyIndexes,recipientKeyHash:null==n?void 0:n.keyHash,recipientTimestamp:null==n?void 0:n.timestamp,recipientKeyIndexes:null==n?void 0:n.keyIndexes},deviceListMetadataVersion:2})};var i=r(n(506479)),a=r(n(81109)),o=n(615688),s=n(551737),l=n(985947),c=n(408139),u=n(115461),d=n(758180),p=r(n(376139)),f=r(n(389867)),_=n(524606),h=n(124808),g=n(534535),m=r(n(905165)),y=r(n(835667)),S=n(455981),E=n(964551);const v=["type"];function T(e){return{viewOnceMessage:{message:e}}}function C(e){return{documentWithCaptionMessage:{message:e}}}function A(e){let t;switch(e){case _.DisappearingModeInitiator.ChangedInChat:t=h.DisappearingMode$Initiator.CHANGED_IN_CHAT;break;case _.DisappearingModeInitiator.InitiatedByMe:t=h.DisappearingMode$Initiator.INITIATED_BY_ME;break;case _.DisappearingModeInitiator.InitiatedByOther:t=h.DisappearingMode$Initiator.INITIATED_BY_OTHER}return{initiator:t}}function b(e,t,n){const{documentMessage:r,imageMessage:i,locationMessage:a,videoMessage:o}=e;if(t.isForwarded&&(r||i||a||o))return e;const s={buttons:!0===t.isForwarded?void 0:t.dynamicReplyButtons,footerText:t.footer,contextInfo:n};return r?(s.documentMessage=r,s.headerType=h.Message$ButtonsMessage$HeaderType.DOCUMENT,s.contentText=t.caption):i?(s.imageMessage=i,s.headerType=h.Message$ButtonsMessage$HeaderType.IMAGE,s.contentText=t.caption):a?(s.locationMessage=a,s.headerType=h.Message$ButtonsMessage$HeaderType.LOCATION,s.contentText=t.caption):o?(s.videoMessage=o,s.headerType=h.Message$ButtonsMessage$HeaderType.VIDEO,s.contentText=t.caption):t.title?(s.text=t.title,s.headerType=h.Message$ButtonsMessage$HeaderType.TEXT,s.contentText=t.body):(s.contentText=t.body,s.headerType=h.Message$ButtonsMessage$HeaderType.EMPTY),{buttonsMessage:s}}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const i={url:t.url,mimetype:r,caption:e.caption,directPath:t.directPath||void 0,fileSha256:L(t.filehash),fileEncSha256:L(t.encFilehash),height:t.height,width:t.width,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:L(t.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:L(e.body),contextInfo:n,viewOnce:e.isViewOnce};return D(e.type,i),i}function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=t.duration;i=(0,s.isString)(i)?parseInt(i,10):i;const a=e.type===u.MSG_TYPE.INTERACTIVE?void 0:e.caption,o={url:t.url,mimetype:r,directPath:t.directPath||void 0,fileSha256:L(t.filehash),fileEncSha256:L(t.encFilehash),height:t.height,width:t.width,seconds:i,caption:a,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:L(t.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(t.mediaKeyTimestamp)?t.mediaKeyTimestamp:void 0,jpegThumbnail:e.isViewOnce?void 0:L(e.body),gifPlayback:e.isGif,gifAttribution:e.gifAttribution,contextInfo:n,streamingSidecar:e.streamingSidecar,viewOnce:e.isViewOnce};return D(e.type,o),o}function M(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;e.type!==u.MSG_TYPE.INTERACTIVE&&(t=e.caption,(0,c.documentWithCaptionsSendEnabled)()&&(n=e.caption,t=r.filename));const o={url:r.url,mimetype:a,title:t,caption:n,directPath:r.directPath||void 0,fileSha256:L(r.filehash),fileEncSha256:L(r.encFilehash),fileName:r.filename,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:L(r.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(r.mediaKeyTimestamp)?r.mediaKeyTimestamp:void 0,jpegThumbnail:L(e.body),contextInfo:i,contactVcard:e.isVcardOverMmsDocument,thumbnailDirectPath:r.thumbnailDirectPath,thumbnailSha256:L(r.thumbnailSha256),thumbnailEncSha256:L(r.thumbnailEncSha256),thumbnailHeight:r.thumbnailHeight,thumbnailWidth:r.thumbnailWidth};return Number.isFinite(e.pageCount)&&!Number.isNaN(e.pageCount)&&(o.pageCount=e.pageCount),D(e.type,o),o}function I(e){switch(e){case S.GroupType.COMMUNITY:return h.Message$ExtendedTextMessage$InviteLinkGroupType.PARENT;case S.GroupType.SUBGROUP:return h.Message$ExtendedTextMessage$InviteLinkGroupType.SUB;case S.GroupType.DEFAULT_ANNOUNCEMENT_GROUP:return h.Message$ExtendedTextMessage$InviteLinkGroupType.DEFAULT_SUB;default:return h.Message$ExtendedTextMessage$InviteLinkGroupType.DEFAULT}}function w(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,c=o||{};const p=e.mimetype||n.mimetype||void 0;let f=n.duration;switch(e.type){case u.MSG_TYPE.CHAT:"url"===e.subtype||e.quotedMsg||e.quotedRemoteJid||Array.isArray(e.mentionedJidList)&&e.mentionedJidList.length>0||e.conversionTuple||e.isForwarded||e.forwardingScore||e._isPaymentNoteMsg||e.ephemeralDuration||e.ephemeralSettingTimestamp||e.ctwaContext?c.extendedTextMessage={text:e.body,matchedText:e.matchedText,canonicalUrl:e.canonicalUrl,description:e.description,title:e.title,jpegThumbnail:L(e.thumbnail),previewType:e.richPreviewType,contextInfo:r,mediaKey:L(e.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(e.mediaKeyTimestamp)?e.mediaKeyTimestamp:void 0,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:L(e.thumbnailSha256),thumbnailEncSha256:L(e.thumbnailEncSha256),thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth,inviteLinkGroupTypeV2:I(e.inviteGrpType)}:c.conversation=e.body;break;case u.MSG_TYPE.GROUPS_V4_INVITE:c.groupInviteMessage={inviteCode:e.inviteCode,inviteExpiration:parseInt(e.inviteCodeExp,10),groupJid:e.inviteGrp,groupName:e.inviteGrpName,caption:e.comment,jpegThumbnail:L(e.inviteGrpJpegThum)};break;case u.MSG_TYPE.STICKER:if("image/webp"!==n.mimetype)throw __LOG__(3)`invalid sticker mimetype: ${n.mimetype}`,new Error("invalid sticker mimetype");c.stickerMessage={url:n.url,mimetype:n.mimetype,directPath:n.directPath||void 0,fileSha256:L(n.filehash),fileEncSha256:L(n.encFilehash),mediaKey:L(n.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(n.mediaKeyTimestamp)?n.mediaKeyTimestamp:void 0,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,height:e.height,width:e.width,firstFrameLength:n.firstFrameLength||void 0,firstFrameSidecar:e.firstFrameSidecar||void 0,isAnimated:n.isAnimated,contextInfo:r},D(e.type,c.stickerMessage);break;case u.MSG_TYPE.LOCATION:const t={degreesLatitude:parseFloat(e.lat)||void 0,degreesLongitude:parseFloat(e.lng)||void 0,jpegThumbnail:L(e.body),contextInfo:r};if(e.loc&&(0,s.isString)(e.loc)){const n=e.loc.split("\n");t.name=n[0],t.address=n[1],t.url=e.clientUrl}c.locationMessage=t;break;case u.MSG_TYPE.VCARD:c.contactMessage={displayName:e.vcardFormattedName,vcard:e.body,contextInfo:r};break;case u.MSG_TYPE.MULTI_VCARD:c.contactsArrayMessage={displayName:e.subtype,contacts:e.vcardList.map((e=>e)),contextInfo:r};break;case u.MSG_TYPE.IMAGE:c.imageMessage=P(e,n,r,p);break;case u.MSG_TYPE.PRODUCT:c.productMessage={product:{productImage:{url:n.url,mimetype:p,caption:e.caption,directPath:n.directPath||void 0,fileSha256:L(n.filehash),fileEncSha256:L(n.encFilehash),height:n.height,width:n.width,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:L(n.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(n.mediaKeyTimestamp)?n.mediaKeyTimestamp:void 0,jpegThumbnail:L(e.body)},productId:e.productId,title:e.title,description:e.description,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000||void 0,salePriceAmount1000:e.salePriceAmount1000||void 0,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount},businessOwnerJid:e.businessOwnerJid,contextInfo:r,body:e.caption,footer:e.footer};break;case u.MSG_TYPE.DOCUMENT:c.documentMessage=M(e,n,r,p);break;case u.MSG_TYPE.PTT:case u.MSG_TYPE.AUDIO:f=(0,s.isString)(f)?parseInt(f,10):f;const o={url:n.url,mimetype:p,directPath:n.directPath||void 0,fileSha256:L(n.filehash),fileEncSha256:L(n.encFilehash),seconds:f,ptt:"ptt"===e.type,fileLength:(0,s.isNumber)(e.size)?e.size:void 0,mediaKey:L(n.mediaKey),mediaKeyTimestamp:(0,s.isNumber)(n.mediaKeyTimestamp)?n.mediaKeyTimestamp:void 0,contextInfo:r,streamingSidecar:e.streamingSidecar};E.ServerProps.pttWaveformSend&&e.waveform&&((0,l.validateWaveform)(e.waveform)?o.waveform=e.waveform.buffer:(__LOG__(4,void 0,new Error,!0)`Outgoing waveform with invalid size: ${e.waveform.byteLength}`,SEND_LOGS("outgoing-waveform-invalid-size"))),c.audioMessage=o,D(e.type?"ptt":"audio",c.audioMessage);break;case u.MSG_TYPE.VIDEO:c.videoMessage=O(e,n,r,p);break;case u.MSG_TYPE.PROTOCOL:let _;switch(e.subtype){case"admin_revoke":case"sender_revoke":_={key:R(e.protocolMessageKey),type:h.Message$ProtocolMessage$Type.REVOKE};break;case"ephemeral_setting":_={type:h.Message$ProtocolMessage$Type.EPHEMERAL_SETTING,ephemeralExpiration:e.ephemeralDuration};break;case"ephemeral_sync_response":_={type:h.Message$ProtocolMessage$Type.EPHEMERAL_SYNC_RESPONSE,ephemeralExpiration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingMode:A(e.disappearingModeInitiator)};break;case"app_state_sync_key_share":_={type:h.Message$ProtocolMessage$Type.APP_STATE_SYNC_KEY_SHARE,appStateSyncKeyShare:e.appStateSyncKeyShare};break;case"app_state_sync_key_request":_={type:h.Message$ProtocolMessage$Type.APP_STATE_SYNC_KEY_REQUEST,appStateSyncKeyRequest:e.appStateSyncKeyRequest};break;case"app_state_fatal_exception_notification":_={type:h.Message$ProtocolMessage$Type.APP_STATE_FATAL_EXCEPTION_NOTIFICATION,appStateFatalExceptionNotification:e.appStateFatalExceptionNotification};break;case"share_phone_number":_={type:h.Message$ProtocolMessage$Type.SHARE_PHONE_NUMBER}}_&&(c.protocolMessage=_);break;case u.MSG_TYPE.INTERACTIVE:let y={};if((e.caption||e.nativeFlowName===m.default.ORDER_STATUS)&&(y={body:{text:e.caption}}),e.interactiveHeader){const t={title:e.interactiveHeader.title,subtitle:e.interactiveHeader.subtitle,hasMediaAttachment:e.interactiveHeader.hasMediaAttachment};if(e.interactiveHeader.thumbnail)t.jpegThumbnail=L(e.interactiveHeader.thumbnail);else if(e.interactiveHeader.mediaType)switch(e.interactiveHeader.mediaType){case g.InteractiveMessageHeaderMediaType.VIDEO:t.videoMessage=O(e,n,r,p);break;case g.InteractiveMessageHeaderMediaType.DOCUMENT:t.documentMessage=M(e,n,r,p);break;case g.InteractiveMessageHeaderMediaType.IMAGE:t.imageMessage=P(e,n,r,p)}y.header=t}e.footer&&(y.footer={text:e.footer});const S=(0,l.getInteractiveMessageFieldNameForType)(e.interactiveType);S&&(y[S]=e.interactivePayload),r&&(y.contextInfo=r),c.interactiveMessage=y;break;case u.MSG_TYPE.INTERACTIVE_RESPONSE:{const t=e.interactivePayload,{type:n}=t,a=(0,i.default)(t,v),o=(0,l.getInteractiveResponseMessageFieldNameForType)(n);c.interactiveResponseMessage={body:{text:e.body},[o]:a,contextInfo:r};break}case u.MSG_TYPE.PAYMENT:const T={};T.stanzaId=e.quotedStanzaID,T.mentionedJid=e.mentionedJidList&&e.mentionedJidList.map(N),T.isForwarded=e.isForwarded,T.forwardingScore=e.forwardingScore,T.participant=N(e.quotedParticipant),e.quotedMsg&&(T.quotedMessage=w(e.quotedMsg));const C=e.paymentNoteMsg?w(Object.assign(e.paymentNoteMsg,{_isPaymentNoteMsg:!0}),T):void 0;switch(e.subtype){case"send":const t=e.paymentRequestMessageKey?{fromMe:e.paymentRequestMessageKey.fromMe,remoteJid:N(e.paymentRequestMessageKey.remote),id:e.paymentRequestMessageKey.id,participant:N(e.paymentRequestMessageKey.participant)}:void 0;c.sendPaymentMessage={requestMessageKey:t,noteMessage:C};break;case"request":c.requestPaymentMessage={amount1000:e.amount1000,expiryTimestamp:e._paymentExpiryTimestamp,requestFrom:e._paymentRequestFrom,currencyCodeIso4217:e._currencyCodeIso4217,noteMessage:C}}break;case u.MSG_TYPE.TEMPLATE_BUTTON_REPLY:c.templateButtonReplyMessage={selectedId:e.selectedId,selectedIndex:e.selectedIndex,selectedDisplayText:e.body,contextInfo:r};break;case"template":return"text"===e.subtype?(e.type="chat",e.title&&(e.body="*"+e.title+"*\n"+e.body)):e.type=e.subtype,w(e,n,r,c);case u.MSG_TYPE.LIST:c.listMessage=e.list,c.listMessage.contextInfo=r;break;case u.MSG_TYPE.LIST_RESPONSE:c.listResponseMessage=e.listResponse,c.listResponseMessage.contextInfo=r;break;case u.MSG_TYPE.BUTTONS_RESPONSE:c.buttonsResponseMessage=e.buttonsResponse,c.buttonsResponseMessage.contextInfo=r;break;case u.MSG_TYPE.ORDER:e.itemCount||e.message||e.orderId||e.orderTitle||e.sellerJid||e.status||e.surface||e.thumbnail||e.token||e.totalAmount1000||e.totalCurrencyCode?c.orderMessage={itemCount:e.itemCount,message:e.message,orderId:e.orderId,orderTitle:e.orderTitle,sellerJid:e.sellerJid,status:e.status,surface:e.surface,thumbnail:L(e.thumbnail),token:e.token,totalAmount1000:e.totalAmount1000,totalCurrencyCode:e.totalCurrencyCode}:c.conversation=e.body;break;case u.MSG_TYPE.NATIVE_FLOW:e.headerType===h.Message$ButtonsMessage$HeaderType.IMAGE&&(c.imageMessage=P(e,n,void 0,p)),c=b(c,e,r),c.buttonsMessage=(0,a.default)((0,a.default)({},c.buttonsMessage),{},{buttons:e.nativeFlowButtons});break;case u.MSG_TYPE.REACTION:c.reactionMessage={key:R(e.reactionParentKey),text:e.reactionText,senderTimestampMs:e.reactionTimestamp};break;case u.MSG_TYPE.REQUEST_PHONE_NUMBER:c.requestPhoneNumberMessage={contextInfo:r};break;case u.MSG_TYPE.POLL_CREATION:if(!(0,d.isPollsCreationEnabled)())break;c.pollCreationMessage={name:e.pollName,options:e.pollOptions.map((e=>{let{name:t}=e;return{optionName:t}})),selectableOptionsCount:e.pollSelectableOptionsCount,contextInfo:r};break;case u.MSG_TYPE.POLL_UPDATE:if(!(0,d.isPollsReceivingEnabled)())break;c.pollUpdateMessage={pollCreationMessageKey:R(e.pollUpdateParentKey),vote:e.encPollVote,senderTimestampMs:e.senderTimestampMs};break;case u.MSG_TYPE.KEEP_IN_CHAT:c.keepInChatMessage={key:R(e.keptMessageKey),keepType:e.keepType,timestampMs:e.t}}return!0===e.isDynamicReplyButtonsMsg&&(c=b(c,e,r)),e.isViewOnce&&(c=T(c)),e.messageSecret&&(c.messageContextInfo=(0,a.default)((0,a.default)({},c.messageContextInfo),{},{messageSecret:e.messageSecret})),e.type===u.MSG_TYPE.DOCUMENT&&Boolean(null===(t=c.documentMessage)||void 0===t?void 0:t.caption)?C(c):c}function R(e){const t={fromMe:e.fromMe,id:e.id},n=N(e.remote),r=N(e.participant);return(0,s.isString)(n)&&(t.remoteJid=n),(0,s.isString)(r)&&(t.participant=r),t}function N(e){return e instanceof f.default?e.toString({legacy:!0}):(0,s.isString)(e)?e.replace(/@c.us$/,"@s.whatsapp.net"):void 0}function L(e){return e?(0,o.decodeB64)(e):void 0}function D(e,t){t.viewOnce||(null==t.directPath&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`directPath missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-direct-path`)),null==t.fileSha256&&(__LOG__(2,void 0,void 0,!0)`fileSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-sha`)),null==t.fileEncSha256&&(__LOG__(2,void 0,void 0,!0)`fileEncSha256 missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-file-enc-sha`)),null==t.url&&null==t.staticUrl&&(__LOG__(2,void 0,void 0,!0)`url(deprecatedMms3Url) missing from msg type ${e}`,SEND_LOGS(`outgoing-${e}-message-missing-mms3-url`)))}},363069:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToTextWithoutSpecialEmojis=Ie,t.decodeJid=ee,t.isValidReactionMessage=Ae,t.parseAudioMessageProto=z,t.parseButtons=re,t.parseButtonsMessageProto=Ee,t.parseButtonsResponseMessageProto=ge,t.parseCancelPaymentRequestMessageProto=ue,t.parseContextInfoProto=J,t.parseConversationProto=K,t.parseCtwaContextProto=Q,t.parseDeclinePaymentRequestMessageProto=ce,t.parseDeviceSentMessage=te,t.parseDisappearingModeProto=ve,t.parseDocumentMessageProto=$,t.parseDocumentWithCaptionFutureProofMessageProto=Se,t.parseEphemeralFutureProofMessageProto=ye,t.parseExtendedTextMessageProto=V,t.parseGroupInviteMessageProto=pe,t.parseImageMessageProto=W,t.parseInteractiveMessageProto=Te,t.parseInteractiveResponseMessageProto=Ce,t.parseKeepInChatProto=we,t.parseListMessageProto=_e,t.parseListResponseMessageProto=he,t.parseLiveLocationMessageProto=oe,t.parseMessageContextInfoProto=Re,t.parseMsgProto=Y,t.parseOrderMessageProto=fe,t.parsePaymentInviteMessageProto=de,t.parsePollCreationMessageProto=Pe,t.parsePollUpdateMessageProto=Me,t.parseProductMessageProto=ae,t.parseProtocolMessageProto=Z,t.parseReactionMessageProto=be,t.parseRequestPaymentMessageProto=le,t.parseRequestPhoneNumberMessageProto=Oe,t.parseSendPaymentMessageProto=se,t.parseStickerMessageProto=H,t.parseTemplateButtonReplyMessage=ie,t.parseTemplateMessage=ne,t.parseVideoMessageProto=q,t.parseViewOnceFutureProofMessageProto=me;var i=r(n(81109)),a=r(n(288306)),o=r(n(278403)),s=n(608243),l=r(n(145095)),c=n(551737),u=n(535470),d=n(88555),p=n(40234),f=r(n(364369)),_=n(985947),h=n(272441),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=F(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(995726)),m=n(408139),y=r(n(465212)),S=n(115461),E=n(758180),v=r(n(376139)),T=n(978820),C=r(n(389867)),A=n(745454),b=n(306303),P=n(627558),O=n(524606),M=n(529805),I=n(199140),w=n(124808),R=n(421224),N=n(767247),L=n(534535),D=r(n(384064)),k=r(n(905165)),U=n(317239),G=n(726287),x=n(390837),B=n(964551);function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(F=function(e){return e?n:t})(e)}const j=(0,a.default)((function(e){return v.default.hostname(e)}));function Y(e,t,n,r,i,a,o,s){if(!e)return __LOG__(4,void 0,new Error,!0)`drop: not Message`,SEND_LOGS("null-message"),t;const{conversation:u,imageMessage:p,contactMessage:f,locationMessage:_,liveLocationMessage:h,extendedTextMessage:g,documentMessage:m,audioMessage:y,videoMessage:E,stickerMessage:v,contactsArrayMessage:T,sendPaymentMessage:C,requestPaymentMessage:A,productMessage:b,groupInviteMessage:O,viewOnceMessage:M,ephemeralMessage:I,documentWithCaptionMessage:w,orderMessage:R,listMessage:N,listResponseMessage:L,protocolMessage:D,declinePaymentRequestMessage:k,cancelPaymentRequestMessage:U,paymentInviteMessage:G,templateMessage:x,templateButtonReplyMessage:F,buttonsResponseMessage:j,buttonsMessage:Y,interactiveMessage:X,interactiveResponseMessage:ee,reactionMessage:re,pollCreationMessage:ve,pollUpdateMessage:Ae,keepInChatMessage:Ne,requestPhoneNumberMessage:Le,messageContextInfo:De}=e;let ke;var Ue,Ge,xe,Be;((0,c.isString)(u)&&K(t,u),O&&pe(t,O),p&&(W(t,p),ke=p.contextInfo),v&&(H(t,v),ke=v.contextInfo),f&&((0,P.parseContactMessageProto)(t,f),ke=f.contextInfo),T&&((0,P.parseContactsArrayMessageProto)(t,T),ke=T.contextInfo),_&&((0,P.parseLocationMessageProto)(t,_),ke=_.contextInfo),h&&(oe(t,h,i),ke=h.contextInfo),C)&&(ke=null===(Ue=C.noteMessage)||void 0===Ue||null===(Ge=Ue.extendedTextMessage)||void 0===Ge?void 0:Ge.contextInfo,se(t,C,r));A&&(ke=null===(xe=A.noteMessage)||void 0===xe||null===(Be=xe.extendedTextMessage)||void 0===Be?void 0:Be.contextInfo,le(t,A,r));if(k&&ce(t,k),U&&ue(t,U),G&&de(t,G),g&&(V(t,g),ke=g.contextInfo),m&&($(t,m),ke=m.contextInfo),w&&Se(t,w),y&&(z(t,y),ke=y.contextInfo),E&&(q(t,E),ke=E.contextInfo),D&&Z(t,D,n,s),b&&(ae(t,b),ke=b.contextInfo),R&&(fe(t,R),ke=R.contextInfo),N&&(_e(t,N),ke=N.contextInfo),L&&(he(t,L),ke=L.contextInfo),M&&me(t,M),I&&ye(t,I),Y&&(Ee(t,Y,o),ke=Y.contextInfo),j&&(ge(t,j),ke=j.contextInfo),X&&(Te(t,X,o),ke=X.contextInfo),ee&&(Ce(t,ee,o),ke=ee.contextInfo),re&&be(t,re),ve&&(Pe(t,ve,De,n),ke=ve.contextInfo),Le&&(Oe(t),ke=Le.contextInfo),Ae&&Me(t,Ae),(0,d.isMDBackend)()){const{deviceSentMessage:r,highlyStructuredMessage:i}=e;var Fe;if(r&&te(t,r,n),i)t.type=S.MSG_TYPE.HSM,(null===(Fe=i.hydratedHsm)||void 0===Fe?void 0:Fe.hydratedTemplate)&&(t.body=Ie(i.hydratedHsm.hydratedTemplate.hydratedContentText))}return x&&((0,d.isMDBackend)()&&x.hydratedTemplate?ne(t,x.hydratedTemplate):ne(t,(0,l.default)(x.hydratedFourRowTemplate,"templateMessage.hydratedFourRowTemplate"))),F&&(ie(t,F),ke=F.contextInfo,t.type=S.MSG_TYPE.TEMPLATE_BUTTON_REPLY),ke&&(J(t,ke,a),ke.externalAdReply&&B.ServerProps.ctwaContextRender&&Q(t,ke.externalAdReply)),De&&Re(t,De),Ne&&we(t,Ne),t}function K(e,t){e.type=S.MSG_TYPE.CHAT,e.body=Ie(t)}function W(e,t){e.type=S.MSG_TYPE.IMAGE,e.deprecatedMms3Url=(0,P.decodeUrl)(t.url),e.directPath=t.directPath||"",e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype||"",e.caption=Ie(t.caption),e.filehash=(0,P.decodeBytes)(t.fileSha256),e.encFilehash=(0,P.decodeBytes)(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height||0,e.width=t.width||0,e.mediaKey=(0,P.decodeBytes)(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.body=(0,P.decodeBytes)(t.jpegThumbnail)||"",e.interactiveAnnotations=t.interactiveAnnotations,e.scanLengths=t.scanLengths,e.scansSidecar=t.scansSidecar,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=(0,P.decodeBytes)(t.thumbnailSha256),e.thumbnailEncSha256=(0,P.decodeBytes)(t.thumbnailEncSha256),(0,P.validateRequiredMediaProperties)(e,t)}function H(e,t){e.type=S.MSG_TYPE.STICKER,e.deprecatedMms3Url=(0,P.decodeUrl)(t.url),e.directPath=t.directPath||"",e.mimetype=t.mimetype||"",e.filehash=(0,P.decodeBytes)(t.fileSha256),e.encFilehash=(0,P.decodeBytes)(t.fileEncSha256),e.mediaKey=(0,o.default)((0,P.decodeBytes)(t.mediaKey)),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.height=t.height||0,e.width=t.width||0,e.firstFrameLength=t.firstFrameLength,e.firstFrameSidecar=t.firstFrameSidecar,e.isAnimated=t.isAnimated,(0,P.validateRequiredMediaProperties)(e,t)}function V(e,t){const n=t.matchedText||t.canonicalUrl||t.description||t.title;if(n){const n=j(t.canonicalUrl||""),r=j(t.matchedText||"");e.canonicalUrl=n===r||""===n?t.canonicalUrl:r}e.type=S.MSG_TYPE.CHAT,e.subtype=n?"url":void 0,e.body=Ie(t.text||""),e.matchedText=t.matchedText,e.description=t.description,e.title=t.title,e.thumbnail=(0,P.decodeBytes)(t.jpegThumbnail)||"",e.richPreviewType=t.previewType,e.doNotPlayInline=t.doNotPlayInline,e.textColor=t.textArgb,e.backgroundColor=t.backgroundArgb,e.mediaKey=(0,P.decodeBytes)(t.mediaKey),e.mediaKeyTimestamp=t.mediaKeyTimestamp,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=(0,P.decodeBytes)(t.thumbnailSha256),e.thumbnailEncSha256=(0,P.decodeBytes)(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth;const r=w.Message$ExtendedTextMessage$FontType;if(null!=t.font)switch(t.font){case r.SANS_SERIF:case r.SERIF:case r.NORICAN_REGULAR:case r.BRYNDAN_WRITE:case r.BEBASNEUE_REGULAR:case r.OSWALD_HEAVY:e.font=t.font}null!=t.inviteLinkGroupTypeV2&&(e.inviteGrpType=(0,P.parseInviteGrpType)(t.inviteLinkGroupTypeV2))}function $(e,t){e.type=S.MSG_TYPE.DOCUMENT,e.deprecatedMms3Url=(0,P.decodeUrl)(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=(0,P.decodeBytes)(t.fileSha256),e.encFilehash=(0,P.decodeBytes)(t.fileEncSha256),e.size=t.fileLength||0,e.pageCount=t.pageCount||0,e.mediaKey=(0,P.decodeBytes)(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.filename=(0,I.cleanIncomingFilename)(t.fileName||t.title),e.isCaptionByUser=null!=t.caption&&""!==t.caption,e.caption=e.filename,e.isCaptionByUser&&(e.caption=Ie(t.caption)),e.body=(0,P.decodeBytes)(t.jpegThumbnail)||"",e.isVcardOverMmsDocument=Boolean(t.contactVcard)&&e.size<=1024*B.ServerProps.vcardMaxSizeKb,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=(0,P.decodeBytes)(t.thumbnailSha256),e.thumbnailEncSha256=(0,P.decodeBytes)(t.thumbnailEncSha256),e.thumbnailHeight=t.thumbnailHeight,e.thumbnailWidth=t.thumbnailWidth,(0,P.validateRequiredMediaProperties)(e,t)}function z(e,t){e.type=t.ptt?S.MSG_TYPE.PTT:S.MSG_TYPE.AUDIO,e.deprecatedMms3Url=(0,P.decodeUrl)(t.url),e.directPath=t.directPath,e.mimetype=t.mimetype,e.filehash=(0,P.decodeBytes)(t.fileSha256),e.encFilehash=(0,P.decodeBytes)(t.fileEncSha256),e.size=t.fileLength||0,e.duration=`${t.seconds||0}`,e.mediaKey=(0,P.decodeBytes)(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.streamingSidecar=t.streamingSidecar,e.waveform=t.waveform&&(0,_.validateWaveform)(t.waveform)?new Uint8Array(t.waveform):void 0,(0,P.validateRequiredMediaProperties)(e,t)}function q(e,t){e.type=S.MSG_TYPE.VIDEO,e.deprecatedMms3Url=(0,P.decodeUrl)(t.url),e.directPath=t.directPath,e.staticUrl=t.staticUrl||"",e.mimetype=t.mimetype,e.filehash=(0,P.decodeBytes)(t.fileSha256),e.encFilehash=(0,P.decodeBytes)(t.fileEncSha256),e.size=t.fileLength||0,e.height=t.height,e.width=t.width,e.duration=`${t.seconds||0}`,e.mediaKey=(0,P.decodeBytes)(t.mediaKey),e.mediaKeyTimestamp=null!=t.mediaKeyTimestamp?t.mediaKeyTimestamp:p.Clock.globalUnixTime(),e.caption=Ie(t.caption),e.body=(0,P.decodeBytes)(t.jpegThumbnail)||"",e.isGif=t.gifPlayback,e.gifAttribution=t.gifAttribution,e.streamingSidecar=t.streamingSidecar,e.interactiveAnnotations=t.interactiveAnnotations,e.isViewOnce=!0===t.viewOnce,e.thumbnailDirectPath=t.thumbnailDirectPath,e.thumbnailSha256=(0,P.decodeBytes)(t.thumbnailSha256),e.thumbnailEncSha256=(0,P.decodeBytes)(t.thumbnailEncSha256),(0,P.validateRequiredMediaProperties)(e,t)}function J(e,t,n){const r=t.quotedMessage,i=t.mentionedJid;e.quotedMsg=r&&Y(r,{type:S.MSG_TYPE.UNKNOWN},"quoted"),e.quotedMsg&&"payment"===e.quotedMsg.type&&n&&__LOG__(2)`parseContextInfoProto: payment not supported`,e.quotedStanzaID=t.stanzaId,e.quotedParticipant=ee(t.participant),e.quotedRemoteJid=ee(t.remoteJid),e.quotedGroupSubject=ee(t.groupSubject),e.quotedParentGroupJid=ee(t.parentGroupJid),e.mentionedJidList=Array.isArray(i)?i.map(ee):i,e.isForwarded=t.isForwarded,e.forwardingScore=t.forwardingScore,null!=t.expiration&&(e.ephemeralDuration=t.expiration),null!=t.ephemeralSettingTimestamp&&(e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp),null!=t.ephemeralSharedSecret&&(e.ephemeralSharedSecret=t.ephemeralSharedSecret),null!=t.disappearingMode&&ve(e,t.disappearingMode),null!=t.actionLink&&(e.actionLink=t.actionLink)}function Q(e,t){const n=g.findLink(t.sourceUrl||"",!1,e.from);e.ctwaContext={sourceUrl:t.sourceUrl,description:t.body,title:t.title,thumbnail:t.thumbnail?(0,P.decodeBytes)(t.thumbnail):null,thumbnailUrl:t.thumbnailUrl,mediaType:t.mediaType,mediaUrl:t.mediaUrl,isSuspiciousLink:(null==n?void 0:n.suspiciousCharacters)&&n.suspiciousCharacters.size>0}}function X(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for protocol message");const{id:n}=e;if(!n)throw new Error("parseProtocolMessageProto: no message id is defined for protocol message");return(0,d.isLegacyWebdBackend)()?new y.default({id:n,fromMe:!!e.fromMe,remote:ee(e.remoteJid),participant:ee(e.participant)}):function(e,t,n){var r;let i,a,o;if(null==n||null===(r=n.id)||void 0===r?void 0:r.fromMe)i=!!t.fromMe,o=ee(t.remoteJid),t.fromMe?o.isUser()||(a=(0,T.getMeUser)()):a=ee(t.participant);else if(o=n.id.remote,t.fromMe)i=!1,a=n.author;else{const e=ee(t.participant);e?e.equals((0,T.getMeUser)())?(i=!0,o.isUser()||(a=(0,T.getMeUser)())):(i=!1,o.isUser()||(a=e)):i=!0}n.type===S.MSG_TYPE.REACTION&&null!=o&&(o instanceof C.default&&o.isBroadcast()&&!o.isStatusV3()||"broadcast"===(0,h.interpretAndValidateJid)(o.toString()).jidType)&&(o=ee(t.participant),a=void 0);return new y.default({id:e,fromMe:i,remote:o,participant:a})}(n,e,t)}function Z(e,t,n,r){if("relay"!==n&&t.type!==w.Message$ProtocolMessage$Type.EPHEMERAL_SETTING)return;const{key:i,type:a}=t;let o=null;if(e.type=S.MSG_TYPE.PROTOCOL,null!=a)switch(a){case w.Message$ProtocolMessage$Type.REVOKE:try{o=X(i,e),e.protocolMessageKey=o,e.subtype=r===u.EDIT_ATTR.ADMIN_REVOKE?"admin_revoke":"sender_revoke"}catch(e){throw __LOG__(3,void 0,void 0,!0,["messaging"])`parseProtocolMessageProto: error:${null==e?void 0:e.name}, stack: ${null==e?void 0:e.stack}`,SEND_LOGS("parseProtocolMessageProto: RevokeParseError"),e}break;case w.Message$ProtocolMessage$Type.EPHEMERAL_SETTING:e.subtype="ephemeral_setting",e.ephemeralDuration=t.ephemeralExpiration;break;case w.Message$ProtocolMessage$Type.EPHEMERAL_SYNC_RESPONSE:e.subtype="ephemeral_sync_response",e.ephemeralDuration=t.ephemeralExpiration,e.ephemeralSettingTimestamp=t.ephemeralSettingTimestamp,null!=t.disappearingMode&&ve(e,t.disappearingMode);break;case w.Message$ProtocolMessage$Type.SHARE_PHONE_NUMBER:e.subtype="share_phone_number";break;case w.Message$ProtocolMessage$Type.HISTORY_SYNC_NOTIFICATION:e.subtype="history_sync_notification";const{historySyncNotification:n}=t;if(n){const r={directPath:n.directPath,encFilehash:(0,P.decodeBytes)(n.fileEncSha256),filehash:(0,P.decodeBytes)(n.fileSha256),mediaKey:(0,P.decodeBytes)(n.mediaKey),type:"md-msg-hist"};e.historySyncMetaData={historySyncNotification:t.historySyncNotification,downloadOptions:r}}break;case w.Message$ProtocolMessage$Type.APP_STATE_SYNC_KEY_REQUEST:case w.Message$ProtocolMessage$Type.APP_STATE_SYNC_KEY_SHARE:case w.Message$ProtocolMessage$Type.MSG_FANOUT_BACKFILL_REQUEST:case w.Message$ProtocolMessage$Type.INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:case w.Message$ProtocolMessage$Type.APP_STATE_FATAL_EXCEPTION_NOTIFICATION:case w.Message$ProtocolMessage$Type.REQUEST_MEDIA_UPLOAD_MESSAGE:case w.Message$ProtocolMessage$Type.REQUEST_MEDIA_UPLOAD_RESPONSE_MESSAGE:e.subtype="unknown"}}function ee(e){return e&&C.default.isWid(e)?(0,A.createWid)(e):e}function te(e,t,n){const r=ee(t.destinationJid);e.id.remote=r,e.to=r,Y(t.message,e,n)}function ne(e,t){const{documentMessage:n,imageMessage:r,locationMessage:i,videoMessage:a}=t;e.isFromTemplate=!0,n?$(e,n):r?W(e,r):i?(0,P.parseLocationMessageProto)(e,i):a?q(e,a):(e.type=S.MSG_TYPE.CHAT,t.hydratedContentText&&(e.body=Ie(t.hydratedContentText))),t.hydratedButtons&&re(e,t),t.hydratedContentText&&(e.caption=Ie(t.hydratedContentText)),t.hydratedFooterText&&(e.footer=Ie(t.hydratedFooterText)),t.hydratedTitleText&&(e.title=Ie(t.hydratedTitleText))}function re(e,t){const{hydratedButtons:n}=t;n.length&&(e.hydratedButtons=n)}function ie(e,t){e.body=Ie(t.selectedDisplayText),e.selectedIndex=t.selectedIndex,e.selectedId=t.selectedId}function ae(e,t){const{product:n,body:r,footer:i}=t;n&&(n.productImage&&W(e,n.productImage),e.type=S.MSG_TYPE.PRODUCT,e.businessOwnerJid=t.businessOwnerJid,e.productId=n.productId,e.currencyCode=n.currencyCode,e.priceAmount1000=n.priceAmount1000,e.salePriceAmount1000=n.salePriceAmount1000,e.retailerId=n.retailerId,e.url=n.url,e.productImageCount=n.productImageCount,e.title=n.title,e.description=n.description,e.caption=r,e.footer=i)}function oe(e,t,n){e.type="location",e.isLive=!0,e.lat=t.degreesLatitude,e.lng=t.degreesLongitude,e.body=(0,P.decodeBytes)(t.jpegThumbnail)||"",e.accuracy=t.accuracyInMeters,e.speed=t.speedInMps,e.degrees=t.degreesClockwiseFromMagneticNorth,e.comment=Ie(t.caption),e.sequence=t.sequenceNumber,n&&(e.finalLat=n.degreesLatitude,e.finalLng=n.degreesLongitude,e.finalThumbnail=(0,P.decodeBytes)(n.jpegThumbnail)||"",e.finalAccuracy=n.accuracyInMeters,e.finalSpeed=n.speedInMps,e.finalDegrees=n.degreesClockwiseFromMagneticNorth,e.finalTimeOffset=n.timeOffset)}function se(e,t,n){if((null==n?void 0:n.futureproofed)||(0,_.hasUnsupportedCurrency)(n))e.type="unknown",e.subtype="phone_only_feature",__LOG__(2)`parseSendPaymentMessageProto: does not support novi transactions`;else{var r,i,a;e.type=S.MSG_TYPE.PAYMENT,e.subtype="send",t.background&&(e.paymentBackground=t.background),(null===(r=t.noteMessage)||void 0===r?void 0:r.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=Y(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",(0,_.parseMsgPaymentInfo)(e,n);const o=t.requestMessageKey;o&&(e.paymentRequestMessageKey=function(e,t){if(!e)throw new Error("_getPaymentRequestMessageKey: no message key is defined");const{id:n}=e;if(!n)throw new Error("_getPaymentRequestMessageKey: no key id is defined");if(!t.id)return __LOG__(3)`_getPaymentRequestMessageKey: no message id is defined`,null;let r;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=ee(e.participant))||void 0===i?void 0:i.equals((0,T.getMeUser)()))&&"send"!==t.subtype)return null;r=ee(e.participant)}return new y.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:n,participant:r})}(o,e))}}function le(e,t,n){if((null==n?void 0:n.futureproofed)||(0,_.hasUnsupportedCurrency)(n))e.subtype="phone_only_feature",__LOG__(2)`parseRequestPaymentMessageProto: does not support novi transactions`;else{var r,i,a;if(e.type=S.MSG_TYPE.PAYMENT,(0,_.parseMsgPaymentInfo)(e,n),e.subtype="request",t.background&&(e.paymentBackground=t.background),(null===(r=t.noteMessage)||void 0===r?void 0:r.extendedTextMessage)||null!=(null===(i=t.noteMessage)||void 0===i?void 0:i.conversation)||(null===(a=t.noteMessage)||void 0===a?void 0:a.stickerMessage)?(e.paymentNoteMsg={},t.noteMessage=Y(t.noteMessage,e.paymentNoteMsg)):e.subtype="futureproof",null!=t.amount){if(t.amount.currencyCode&&!e.paymentCurrency&&(e.paymentCurrency=t.amount.currencyCode),null!=t.amount.value&&!e.paymentAmount1000){const n=t.amount,r=null==n.offset||0===n.offset?1e3:n.offset;e.paymentAmount1000=1e3*parseFloat(n.value)/r}}else t.currencyCodeIso4217&&!e.paymentCurrency&&(e.paymentCurrency=t.currencyCodeIso4217),null==t.amount1000||e.paymentAmount1000||(e.paymentAmount1000=t.amount1000);t.requestFrom&&!e.paymentMessageReceiverJid&&(e.paymentMessageReceiverJid=ee(t.requestFrom)),e.paymentStatus&&e.paymentTxnStatus||(0,_.isEitherSenderOrReceiverOfPaymentMessage)(e)&&(e.paymentStatus=R.PaymentInfo$Status.WAITING,e.paymentTxnStatus=R.PaymentInfo$TxnStatus.COLLECT_INIT),null==t.expiryTimestamp||e.paymentExpiryTimestamp||(e.paymentExpiryTimestamp=t.expiryTimestamp)}}function ce(e,t){const n=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for decline payment request message");const{id:n}=e;if(!n)throw new Error("parseProtocolMessageProto: no message id is defined for decline payment request message");let r;if(t.id.remote.isGroup()){var i;if(!t.id.fromMe&&!(null===(i=ee(e.participant))||void 0===i?void 0:i.equals((0,T.getMeUser)()))&&"send"!==t.subtype)return null;r=ee(e.participant)}return new y.default({fromMe:!t.id.fromMe,remote:t.id.remote,id:n,participant:r})}(t.key,e);e.paymentRequestMessageKey=n,e.subtype="payment_action_request_declined"}function ue(e,t){const n=t.key;if(n){const t=function(e,t){if(!e)throw new Error("parseProtocolMessageProto: no message key is defined for cancel payment request message");const{id:n}=e;if(!n)throw new Error("parseProtocolMessageProto: no message id is defined for cancel payment request message");let r;var i;if(t.id.remote.isGroup())if(r=t.id.participant,t.id.fromMe)r=ee(t.from);else if(!(null===(i=ee(e.participant))||void 0===i?void 0:i.equals((0,T.getMeUser)())))return null;return new y.default({id:n,fromMe:t.id.fromMe,remote:t.id.remote,participant:r})}(n,e);e.paymentRequestMessageKey=t,e.subtype="payment_transaction_request_cancelled"}}function de(e,t){t.serviceType===w.Message$PaymentInviteMessage$ServiceType.NOVI?(e.subtype="phone_only_feature",__LOG__(2)`[payment-invite] parsePaymentInviteMessageProto: does not support novi transactions`):(e.type=S.MSG_TYPE.PAYMENT,e.subtype="invite",e.paymentExpiryTimestamp=t.expiryTimestamp,e.paymentInviteServiceType=t.serviceType,__LOG__(2)`[payment-invite] render payment invite of type ${t.serviceType}`)}function pe(e,t){e.comment=t.caption,e.inviteCode=t.inviteCode,e.inviteCodeExp=t.inviteExpiration,e.inviteGrp=t.groupJid,e.inviteGrpName=t.groupName,e.type=S.MSG_TYPE.GROUPS_V4_INVITE}function fe(e,t){e.type=S.MSG_TYPE.ORDER,e.thumbnail=(0,P.decodeBytes)(t.thumbnail),e.message=t.message||"",e.orderId=t.orderId,e.itemCount=t.itemCount||0,e.status=t.status,e.surface=t.surface,e.sellerJid=t.sellerJid,e.orderTitle=t.orderTitle||"",e.token=t.token||"",e.totalAmount1000=t.totalAmount1000,e.totalCurrencyCode=t.totalCurrencyCode,e.body=""}function _e(e,t){var n,r;B.ServerProps.webListMessage&&t.listType===w.Message$ListMessage$ListType.SINGLE_SELECT||(0,m.productListMessagesEnabled)()&&t.listType===w.Message$ListMessage$ListType.PRODUCT_LIST?(e.type=S.MSG_TYPE.LIST,e.list=t,e.footer=t.footerText,t.listType===w.Message$ListMessage$ListType.PRODUCT_LIST&&(e.businessOwnerJid=null===(n=t.productListInfo)||void 0===n?void 0:n.businessOwnerJid,e.productListItemCount=null===(r=t.productListInfo)||void 0===r?void 0:r.productSections.reduce(((e,t)=>e+t.products.length),0))):(t.listType===w.Message$ListMessage$ListType.PRODUCT_LIST&&(e.subtype="phone_only_feature"),e.type=S.MSG_TYPE.UNKNOWN)}function he(e,t){if(B.ServerProps.webListMessage&&t.listType===w.Message$ListResponseMessage$ListType.SINGLE_SELECT){e.type=S.MSG_TYPE.LIST_RESPONSE,e.listResponse=(0,i.default)((0,i.default)({},t),{},{contextInfo:void 0});let n=t.title||"";t.description&&(n+="\n"+t.description),e.body=Ie(n)}}function ge(e,t){let{selectedDisplayText:n,selectedButtonId:r,type:i}=t;(0,m.buttonsMessagesEnabled)()&&i===w.Message$ButtonsResponseMessage$Type.DISPLAY_TEXT?(e.type=S.MSG_TYPE.BUTTONS_RESPONSE,e.selectedButtonId=r,e.body=Ie(n)):e.type=S.MSG_TYPE.UNKNOWN}function me(e,t){Y(t.message,e)}function ye(e,t){Y(t.message,e)}function Se(e,t){(0,m.documentWithCaptionsRecieveEnabled)()&&Y(t.message,e)}function Ee(e,t,n){if(!(0,m.buttonsMessagesEnabled)())return void(e.type=S.MSG_TYPE.UNKNOWN);const{documentMessage:r,imageMessage:a,locationMessage:o,videoMessage:s,contentText:l,footerText:c,text:u,buttons:d=[],headerType:p}=t,f=k.default.cast((0,_.getBizNativeFlowName)({buttonsMessage:t}));if(!(0,_.shouldParseNFM)(f,n)||(0,_.hasUnsupportedButtons)(d))return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(p!==w.Message$ButtonsMessage$HeaderType.UNKNOWN&&new Set(w.Message$ButtonsMessage$HeaderType.members()).has(p)){if(e.type=S.MSG_TYPE.CHAT,e.headerType=p,a?W(e,a):r?$(e,r):o?(0,P.parseLocationMessageProto)(e,(0,i.default)((0,i.default)({},o),{},{name:void 0,address:void 0})):s?q(e,s):(u&&(e.title=Ie(u)),l&&(e.body=Ie(l))),null==f)d.length&&(e.isDynamicReplyButtonsMsg=!0,e.dynamicReplyButtons=d);else{if(e.type=S.MSG_TYPE.NATIVE_FLOW,e.nativeFlowName=k.default.cast(f),e.nativeFlowButtons=d,!e.nativeFlowName||!(0,G.isValidNativeFlowMessage)(e))return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(e.nativeFlowName===k.default.ORDER_STATUS&&!(0,x.validateOrderAndSendReceipt)(e.id,e))return void(e.subtype="non_renderable")}l&&(e.caption=Ie(l)),c&&(e.footer=Ie(c))}else e.type=S.MSG_TYPE.UNKNOWN}function ve(e,t){if(null==e.from)return;const n=e.from.equals((0,T.getMeUser)());if(null!=t.initiator)switch(t.initiator){case w.DisappearingMode$Initiator.CHANGED_IN_CHAT:e.disappearingModeInitiator=O.DisappearingModeInitiator.ChangedInChat;break;case w.DisappearingMode$Initiator.INITIATED_BY_ME:e.disappearingModeInitiator=n?O.DisappearingModeInitiator.InitiatedByMe:O.DisappearingModeInitiator.InitiatedByOther;break;case w.DisappearingMode$Initiator.INITIATED_BY_OTHER:e.disappearingModeInitiator=n?O.DisappearingModeInitiator.InitiatedByOther:O.DisappearingModeInitiator.InitiatedByMe}}function Te(e,t,n){var r;const i=(0,_.getInteractiveMessageTypeForProto)(t);if(!i||!(0,_.isInteractiveMessageTypeEnabled)(i))return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");const{body:a,footer:o}=t,s=(0,_.getInteractiveMessageFieldNameForType)(i),l={type:S.MSG_TYPE.INTERACTIVE,caption:null!==(r=Ie(null==a?void 0:a.text))&&void 0!==r?r:"",interactiveType:i,interactivePayload:t[s]};if(!(0,_.isSupportedInteractiveMessageVersion)(l))return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(i===D.default.NATIVE_FLOW){if(l.nativeFlowName=k.default.cast((0,_.getBizNativeFlowName)({interactiveMessage:t})),!(0,_.isValidNativeFlowName)(l.nativeFlowName,n)||!(0,G.isValidNativeFlowMessage)(l))return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");if(l.nativeFlowName===k.default.ORDER_STATUS&&!(0,x.validateOrderAndSendReceipt)(e.id,l))return void(e.subtype="non_renderable")}o&&(l.footer=Ie(o.text)),function(e,t){let{header:n}=t;if(!n)return;const r={title:Ie(n.title),subtitle:Ie(n.subtitle),thumbnail:(0,P.decodeBytes)(n.jpegThumbnail),mediaType:void 0,hasMediaAttachment:Boolean(n.hasMediaAttachment)};r.hasMediaAttachment&&(n.documentMessage?($(e,n.documentMessage),r.mediaType=L.InteractiveMessageHeaderMediaType.DOCUMENT):n.videoMessage?(q(e,n.videoMessage),r.mediaType=L.InteractiveMessageHeaderMediaType.VIDEO):n.imageMessage&&(W(e,n.imageMessage),r.mediaType=L.InteractiveMessageHeaderMediaType.IMAGE)),e.interactiveHeader=r}(e,t),Object.assign(e,l)}function Ce(e,t,n){const r=(0,_.getInteractiveResponseMessageTypeForProto)(t);if(!(0,m.interactiveNativeFlowResponseMessagesEnabled)()||!r||!(0,_.isInteractiveResponseMessageTypeEnabled)(r))return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="phone_only_feature");try{var i,a;const o={type:S.MSG_TYPE.INTERACTIVE_RESPONSE,body:null!==(i=Ie(null===(a=t.body)||void 0===a?void 0:a.text))&&void 0!==i?i:"",interactivePayload:(0,_.getInteractiveResponsePayload)(r,t,n)};Object.assign(e,o)}catch(t){e.type=S.MSG_TYPE.UNKNOWN,e.subtype="phone_only_feature"}}function Ae(e){const t=e.text;return null==t||t.length<=f.default.REACTION_CONTENT_MAX_LENGTH}function be(e,t){if(!(0,m.receiveReactionsEnabled)())return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype="reaction");if(!Ae(t))throw new b.ReactionValidationError("[messaging] Reaction failed validation");const n=Ie(t.text);e.type=S.MSG_TYPE.REACTION,e.reactionParentKey=X(t.key,e),e.reactionText=n,e.reactionTimestamp=t.senderTimestampMs}function Pe(e,t,n,r){const i=function(e,t,n,r){if(!(0,E.isPollsReceivingEnabled)())return{type:S.MSG_TYPE.UNKNOWN,subtype:S.MSG_TYPE.POLL_CREATION};const{name:i,options:a,selectableOptionsCount:o}=t;if(null==i)throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.MISSING_NAME);if(0===i.length||i.length>(0,E.getMaxPollNameLength)())throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.INVALID_NAME);if("quoted"===r)return{type:S.MSG_TYPE.POLL_CREATION,pollName:i};const s=null==n?void 0:n.messageSecret;if(null==s)throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.MISSING_MESSAGE_SECRET);if(32!==s.byteLength)throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.INVALID_MESSAGE_SECRET);if(null==a)throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.MISSING_OPTIONS);if(null==o)throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.MISSING_SELECTABLE_OPTIONS_COUNT);const l=new Set,c=a.map((e=>{let{optionName:t}=e;if(null==t||0===t.length||t.length>(0,E.getMaxPollOptionLength)())throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.INVALID_OPTION);if(l.has(t))return __LOG__(3,void 0,void 0,!0,["polls"])`PollCreationValidationWarning: ${b.PollCreationValidationWarningCode.DUPLICATE_OPTIONS}`,SEND_LOGS(b.PollCreationValidationWarningCode.DUPLICATE_OPTIONS),null;const n=l.size;return l.add(t),{name:t,localId:n}})).filter(Boolean);if(c.length<2||c.length>(0,E.getMaxPollOptionCount)())throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.INVALID_OPTIONS_COUNT);if(o<0||o>c.length)throw new b.PollCreationValidationError(b.PollCreationValidationErrorCode.INVALID_SELECTABLE_OPTIONS_COUNT);return{type:S.MSG_TYPE.POLL_CREATION,pollName:i,pollOptions:c,pollSelectableOptionsCount:o}}(0,t,n,r);Object.assign(e,i)}function Oe(e){e.type=S.MSG_TYPE.REQUEST_PHONE_NUMBER}function Me(e,t){const{$$unknownFieldCount:n=0,vote:r,senderTimestampMs:i}=t;if(n>0||!(0,E.isPollVoteProcessingEnabled)())return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype=S.MSG_TYPE.POLL_UPDATE);if(null==t.pollCreationMessageKey)throw new b.PollUpdateValidationError(b.PollUpdateValidationErrorCode.MISSING_POLL_MESSAGE_KEY);if(null==i)throw new b.PollUpdateValidationError(b.PollUpdateValidationErrorCode.MISSING_SENDER_TIMESTAMP);if(null==r)throw new b.PollUpdateValidationError(b.PollUpdateValidationErrorCode.MISSING_UPDATE);const{encPayload:a,encIv:o}=r;if(null==a)throw new b.PollUpdateValidationError(b.PollUpdateValidationErrorCode.MISSING_VOTE_ENC_PAYLOAD);if(null==o)throw new b.PollUpdateValidationError(b.PollUpdateValidationErrorCode.MISSING_VOTE_ENC_IV);if(12!==o.byteLength)throw new b.PollUpdateValidationError(b.PollUpdateValidationErrorCode.INVALID_VOTE_ENC_IV);e.type=S.MSG_TYPE.POLL_UPDATE,e.pollUpdateParentKey=X(t.pollCreationMessageKey,e),e.encPollVote={encPayload:a,encIv:o},e.senderTimestampMs=(0,s.numberOrThrowIfTooLarge)(i)}function Ie(e){return e?U.Conn.platform===U.PLATFORMS.ANDROID?e:N.EmojiUtil.convertToTextWithoutSpecialEmojis(e):e}function we(e,t){if(e.keptMessageKey=X(t.key,e),!(0,M.isKeepInChatReadEnabled)())return e.type=S.MSG_TYPE.UNKNOWN,void(e.subtype=S.MSG_TYPE.KEEP_IN_CHAT);e.type=S.MSG_TYPE.KEEP_IN_CHAT,e.keepType=t.keepType}function Re(e,t){null!=t.messageSecret&&(e.messageSecret=new Uint8Array(t.messageSecret))}},985947:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptFailAttributeFromProtobuf=function(e){var t;if(null!=e.reactionMessage)return o.DecryptFailType.Hide;if(null!=(null===(t=e.pollUpdateMessage)||void 0===t?void 0:t.vote))return o.DecryptFailType.Hide;return o.DecryptFailType.Show},t.getBizNativeFlowName=function(e){var t,n,r,i,a,o;if(1===(null===(t=e.interactiveMessage)||void 0===t||null===(n=t.nativeFlowMessage)||void 0===n||null===(r=n.buttons)||void 0===r?void 0:r.length))return(0,h.getNativeFlowNameByButtonName)(e.interactiveMessage.nativeFlowMessage.buttons[0].name);if(1===(null===(i=e.buttonsMessage)||void 0===i||null===(a=i.buttons)||void 0===a?void 0:a.length))return(0,h.getNativeFlowNameByButtonName)(null===(o=e.buttonsMessage.buttons[0].nativeFlowInfo)||void 0===o?void 0:o.name)},t.getInteractiveMessageFieldNameForType=S,t.getInteractiveMessageTypeForProto=function(e){for(const t of p.default.members())if(S(t)in e)return t;return null},t.getInteractiveResponseMessageFieldNameForType=E,t.getInteractiveResponseMessageTypeForProto=function(e){for(const t of f.default.members())if(E(t)in e)return t;return null},t.getInteractiveResponsePayload=function(e,t,n){switch(e){case f.default.NATIVE_FLOW:const r=(0,a.default)(t.nativeFlowResponseMessage,"message.nativeFlowResponseMessage"),i=(0,a.default)(_.default.cast(r.name),"NativeFlowName.cast(payload.name)"),o=(0,a.default)(r.version,"payload.version");if(o>1||!m(i,n))throw new Error("Invalid message");return{name:i,version:o,type:e,paramsJson:(0,a.default)(r.paramsJson,"payload.paramsJson")}}},t.hasUnsupportedButtons=function(e){return e.some((e=>e.nativeFlowInfo&&y.includes(e.nativeFlowInfo.name)||y.includes(e.buttonId)))},t.hasUnsupportedCurrency=function(e){var t;const n=(null==e||null===(t=e.primaryAmount)||void 0===t?void 0:t.currencyCode)||(null==e?void 0:e.currency);if(["XUS","XDX","USDP"].includes(null==n?void 0:n.toUpperCase()))return!0;return!1},t.isEitherSenderOrReceiverOfPaymentMessage=function(e){var t,n;if((null===(t=e.id)||void 0===t?void 0:t.remote.isGroup())&&!(null===(n=e.id)||void 0===n?void 0:n.participant.equals((0,c.getMeUser)()))&&!e.paymentMessageReceiverJid.equals((0,c.getMeUser)()))return!1;return!0},t.isInteractiveMessageTypeEnabled=function(e){switch(e){case p.default.NATIVE_FLOW:return(0,s.interactiveNativeFlowMessagesEnabled)();case p.default.SHOPS_STOREFRONT:return(0,s.shopsInteractiveMessageEnabled)()}},t.isInteractiveResponseMessageTypeEnabled=function(e){switch(e){case f.default.NATIVE_FLOW:return(0,s.interactiveNativeFlowResponseMessagesEnabled)()}},t.isSupportedInteractiveMessageVersion=function(e){let{interactivePayload:t,interactiveType:n}=e;const r=null==t?void 0:t.messageVersion;if(null==r||null==n)return!1;switch(n){case p.default.NATIVE_FLOW:case p.default.SHOPS_STOREFRONT:return r<=1}},t.isValidNativeFlowName=m,t.msgKeyToProtobuf=function(e){var t;return{fromMe:e.fromMe,id:e.id,participant:e.fromMe||null===(t=e.participant)||void 0===t?void 0:t.toString({legacy:!0}),remoteJid:e.remote.toString({legacy:!0})}},t.parseMsgPaymentInfo=function(e,t){t&&(e.paymentStatus=t.status,e.paymentTxnStatus=t.txnStatus,e.paymentCurrency=t.currency||"",e.paymentAmount1000=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.amount1000),"maybeNumberOrThrowIfTooLarge(paymentInfo.amount1000)"),e.paymentMessageReceiverJid=(0,u.createWid)((0,a.default)(t.receiverJid,"paymentInfo.receiverJid")),e.paymentExpiryTimestamp=(0,i.maybeNumberOrThrowIfTooLarge)(t.expiryTimestamp),e.paymentTransactionTimestamp=(0,a.default)((0,i.maybeNumberOrThrowIfTooLarge)(t.transactionTimestamp),"maybeNumberOrThrowIfTooLarge(paymentInfo.transactionTimestamp)"))},t.pollTypeAttributeFromProtobuf=function(e){var t;if(null!=e.pollCreationMessage)return d.POLL_TYPES.creation;if(null!=(null===(t=e.pollUpdateMessage)||void 0===t?void 0:t.vote))return d.POLL_TYPES.vote;return null},t.protobufToMsgKey=function(e){const{fromMe:t,id:n,participant:r,remoteJid:i}=e;(0,g.default)(null!=t&&null!=i&&null!=n,"fromMe, remoteJid, and id should be set");let a=null!=r&&(0,u.isWidlike)(r)?(0,u.createWid)(r):void 0;const o=(0,u.createWid)(i);(o.isGroup()||o.isBroadcast())&&t&&(a=(0,c.getMaybeMeUser)());return new l.default({fromMe:t,id:n,participant:a,remote:(0,u.createWid)(i)})},t.shouldParseNFM=function(e,t){if(null!=e||null!=(null==t?void 0:t.nativeFlowName))return!!(0,s.nativeFlowMessagesEnabled)()&&m(e,t);return!0},t.typeAttributeFromProtobuf=function e(t){if(t.ephemeralMessage){const{message:n}=t.ephemeralMessage;return n?e(n):d.MSG_TYPES.text}if(t.deviceSentMessage){const{message:n}=t.deviceSentMessage;return n?e(n):d.MSG_TYPES.text}if(t.reactionMessage)return d.MSG_TYPES.reaction;if(t.pollCreationMessage||t.pollUpdateMessage)return d.MSG_TYPES.poll;if(t.conversation||t.extendedTextMessage||t.templateButtonReplyMessage||t.protocolMessage||t.interactiveMessage||t.keepInChatMessage||t.requestPhoneNumberMessage)return d.MSG_TYPES.text;return d.MSG_TYPES.media},t.validateWaveform=function(e){return e.byteLength>=64&&e.byteLength<=192};var i=n(608243),a=r(n(145095)),o=n(824214),s=n(408139),l=r(n(465212)),c=n(978820),u=n(745454),d=n(312037),p=r(n(384064)),f=r(n(414482)),_=r(n(905165)),h=n(726287),g=r(n(441143));function m(e,t){return null==e&&null==(null==t?void 0:t.nativeFlowName)||null==(null==t?void 0:t.nativeFlowName)||null!=e&&_.default.cast(t.nativeFlowName)===e}const y=["novi_login","novi_report_transaction","novi_hub","novi_view_code","novi_view_transaction","novi_view_bank_detail","novi_view_card_detail","wa_payment_transaction_details","wa_payment_learn_more","wa_payment_fbpin_reset"];function S(e){switch(e){case p.default.NATIVE_FLOW:return"nativeFlowMessage";case p.default.SHOPS_STOREFRONT:return"shopStorefrontMessage"}}function E(e){switch(e){case f.default.NATIVE_FLOW:return"nativeFlowResponseMessage"}}},93945:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(631325),o=n(960362),s=n(122954),l=n(672894),c=n(139976),u=n(559871),d=n(311785);class p extends a.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){const t=[],n=[],r=e.map((e=>{try{const{indexParts:a}=e,[,l]=a;if(l||(0,s.throwInvalidActionIndex)(),"remove"===e.operation)return n.push(l),{actionState:o.SyncActionState.Success};if("set"===e.operation){var r,i;const{agentAction:n}=e.value;if(!n)return{actionState:o.SyncActionState.Malformed};const a=null!==(r=n.name)&&void 0!==r?r:"";return t.push({id:l,name:a,deviceId:null!==(i=n.deviceID)&&void 0!==i?i:-1,isDeleted:Boolean(n.isDeleted)}),{actionState:o.SyncActionState.Success}}return{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return yield(0,d.getTable)().bulkCreateOrMerge(t),l.AgentCollection.add(t,{merge:!0}),yield(0,d.getTable)().bulkRemove(n),l.AgentCollection.remove(n),Promise.resolve().then((()=>{c.UnattributedMessageCollection.getModelsArray().forEach((e=>{let{id:t,deviceId:n}=e;const r=u.MsgCollection.get(t);if(null==r)return;const i=l.AgentCollection.getByDeviceId(n);null!=i&&(r.agentId=String(i.id),c.UnattributedMessageCollection.remove(t))}))})),r}))()}}const f=new p;Object.freeze(f);var _=f;t.default=_},321084:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(550073),i=n(381),a=n(631325),o=n(960362),s=n(892844),l=n(711597),c=n(760980);class u extends a.SyncActionBase{constructor(){super(...arguments),this.version=4}applyMutations(e){return Promise.all(e.map((e=>{try{if("set"===e.operation){const{value:t}=e,n=t.androidUnsupportedActions;if(!n)return __LOG__(3)`android unsupported actions: malformed mutation`,{actionState:o.SyncActionState.Malformed};return n.allowed&&this.updatePrimaryAllowsAllMutationsFlag("allow_unsupported_mutation"),{actionState:o.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})))}getAndroidUnsupportedActionsMutation(){const e=(0,s.unixTimeMs)();return{collection:o.CollectionName.RegularLow,index:JSON.stringify([o.Actions.AndroidUnsupportedActions]),operation:r.SyncdMutation$SyncdOperation.SET,version:this.version,binarySyncAction:(0,c.encodeProtobuf)(i.SyncActionValueSpec,{timestamp:e,androidUnsupportedActions:{allowed:!0}}).readBuffer(),timestamp:e,action:o.Actions.AndroidUnsupportedActions}}updatePrimaryAllowsAllMutationsFlag(e){(0,l.getPrimaryAllowsAllMutations)()||(__LOG__(2)`[syncd] primary allows all mutations flag set: ${e}`,(0,l.setPrimaryAllowsAllMutations)())}}const d=new u;Object.freeze(d);var p=d;t.default=p},774362:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(550073),l=n(381),c=n(631325),u=n(960362),d=n(408139),p=r(n(389867)),f=n(745454),_=n(819937),h=n(122954),g=n(293824),m=r(n(11339)),y=n(669951),S=r(n(268132)),E=n(776214),v=n(438342),T=n(484902),C=n(760980);function A(e,t){switch(t){case _.MessageRangeEncloseType.RangesAreEqual:case _.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:u.SyncActionState.Success};case _.MessageRangeEncloseType.RangeBEnclosesRangeA:case _.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:e.toString()}}}}class b extends c.SyncActionBase{constructor(){super(...arguments),this.version=3}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,h.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}setArchive(e){return(0,a.default)((function*(){yield(0,E.getChatTable)().bulkCreateOrMerge(e),e.forEach((e=>{const t=(0,f.createWid)(e.id),n=y.ChatCollection.get(t);n&&(n.archive=e.archive)}))}))()}validateSyncActionValue(e){const t=e.archiveChatAction;return null!=(null==t?void 0:t.archived)&&(0,_.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return(0,a.default)((function*(){const n=new Map;yield(0,E.getChatTable)().bulkGet(e.map((e=>{const{indexParts:t}=e,[,n]=t;return n&&p.default.isWid(n)?(0,f.createWid)(n).toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&n.set(e.id,e)}))));const r=[],i=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,h.throwInvalidActionIndex)(),!p.default.isWid(s))return(0,g.uploadCriticalEventMetric)(m.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};const l=a.archiveChatAction;if(!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][archive-chat]: malformed mutation`,{actionState:u.SyncActionState.Malformed};const c=(0,o.default)(null==l?void 0:l.archived,"archiveChatAction?.archived"),d=(0,o.default)(null==l?void 0:l.messageRange,"archiveChatAction?.messageRange"),_=(0,f.createWid)(s);if(!n.has(_.toString()))return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:_.toString()}};const y=yield t._applyMutation(_,c,d,a);return y.updates&&r.push(y.updates),y.syncApplyActionResult}return __LOG__(3)`[syncd][archive-chat]: REMOVE operation not supported`,{actionState:u.SyncActionState.Unsupported}}catch(e){return{actionState:u.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return r.length>0&&(yield t.setArchive(r)),i}))()}_applyMutation(e,t,n,r){return(0,a.default)((function*(){if(yield(0,v.removeActiveMessageRange)(e.toString(),(0,v.getActiveRangeAction)("archive")),!t)return{updates:{id:e.toString(),archive:t},syncApplyActionResult:{actionState:u.SyncActionState.Success}};const i=yield(0,_.constructMessageRange)(e,!1),a=(0,_.compareMessageRanges)(i,n),o=(0,C.encodeProtobuf)(l.SyncActionValueSpec,r).readBuffer(),s=()=>(0,v.addActiveMessageRange)(e.toString(),(0,v.getActiveRangeAction)("archive"),o),c=(0,d.archiveV2Supported)()&&S.default.showArchiveV2;switch(a){case _.MessageRangeEncloseType.RangesAreEqual:case _.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield s(),{updates:{id:e.toString(),archive:t},syncApplyActionResult:A(e,a)};case _.MessageRangeEncloseType.RangeAEnclosesRangeB:case _.MessageRangeEncloseType.RangesNotEnclosing:return c?{updates:{id:e.toString(),archive:t},syncApplyActionResult:A(e,a)}:(yield s(),{updates:void 0,syncApplyActionResult:A(e,a)})}}))()}_constructArchiveChatIndex(e){return JSON.stringify([u.Actions.Archive,e.toString({legacy:!0})])}getArchiveChatMutation(e,t,n){var r=this;return(0,a.default)((function*(){const i={timestamp:e,archiveChatAction:{archived:t,messageRange:yield(0,_.constructMessageRange)(n,!0)}};return{collection:u.CollectionName.RegularLow,index:r._constructArchiveChatIndex(n),binarySyncAction:(0,C.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:r.version,operation:s.SyncdMutation$SyncdOperation.SET,timestamp:e,action:u.Actions.Archive}}))()}getMutationsForArchive(e,t,r){var i=this;return(0,a.default)((function*(){const a=[yield i.getArchiveChatMutation(e,t,r)];if(t&&(0,d.pinChatSyncEnabled)()){const t=n(536014).default;a.push(t.getPinMutation(e,!1,r))}return a}))()}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){var r,s;const c=(0,T.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction),d=(0,T.decodeProtobuf)(l.SyncActionDataSpec,t.binarySyncData).value,p=e.timestamp,h=t.timestamp,g=(0,o.default)(c.archiveChatAction,"pendingMutationValue.archiveChatAction"),m=(0,o.default)(null==d?void 0:d.archiveChatAction,"incomingMutationValue?.archiveChatAction");switch((0,_.compareMessageRanges)((0,o.default)(m.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(g.messageRange,"pendingArchiveChatAction.messageRange"))){case _.MessageRangeEncloseType.RangeAEnclosesRangeB:return u.ConflictResolutionState.ApplyRemoteAndDropLocal;case _.MessageRangeEncloseType.RangeBEnclosesRangeA:return u.ConflictResolutionState.SkipRemote;case _.MessageRangeEncloseType.RangesAreEqual:return p<=h?u.ConflictResolutionState.ApplyRemoteAndDropLocal:u.ConflictResolutionState.SkipRemote;case _.MessageRangeEncloseType.RangesNotEnclosing:const t=p<=h?null!==(r=m.archived)&&void 0!==r&&r:null!==(s=g.archived)&&void 0!==s&&s,c=(0,_.mergeMessageRanges)((0,o.default)(m.messageRange,"incomingArchiveChatAction.messageRange"),(0,o.default)(g.messageRange,"pendingArchiveChatAction.messageRange")),y=(0,C.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},d),{},{archiveChatAction:{archived:t,messageRange:c}})).readBuffer(),S=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:y});return delete S.id,yield(0,_.lockForMessageRangeSync)(["chat"],[S],(0,a.default)((function*(){const r=JSON.parse(e.index),i=(0,f.createWid)(r[1]);return yield(0,v.addActiveMessageRange)(i.toString(),(0,v.getActiveRangeAction)("archive"),y),n.setArchive([{id:i.toString(),archive:t}])}))),u.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const P=new b;Object.freeze(P);var O=P;t.default=O},428464:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(381),s=n(631325),l=n(960362),c=n(408139),u=n(711597),d=n(745454),p=r(n(321084)),f=n(819937),_=r(n(273407)),h=n(669951),g=r(n(268132)),m=n(776214),y=n(438342),S=n(569702),E=n(799069),v=n(484902);class T extends s.SyncActionBase{constructor(){super(...arguments),this.version=4}decodeValue(e){if(!e.binarySyncData){if(!e.binarySyncAction)throw __LOG__(4,void 0,new Error,!0,["syncd"])`binarySyncAction should not be null`,SEND_LOGS("syncd binarySyncAction should not be null"),new Error("binarySyncAction should not be null");return(0,v.decodeProtobuf)(o.SyncActionValueSpec,e.binarySyncAction)}{const t=(0,v.decodeProtobuf)(o.SyncActionDataSpec,e.binarySyncData);if(t.value)return t.value}}applyMutations(e,t){var n=this;return(0,a.default)((function*(){p.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{setMutationsPendingToPersist:r}=t;if(e.length>0){const t=e[e.length-1];try{let e=[];if(!(0,c.archiveV2Supported)())return __LOG__(3)`archive setting sync: ArchiveV2 not supported yet`,[{actionState:l.SyncActionState.Unsupported}];if("set"===t.operation){const{value:o}=t,s=o.unarchiveChatsSetting;if(null==(null==s?void 0:s.unarchiveChats))return __LOG__(3)`archive setting sync: malformed mutation`,[{actionState:l.SyncActionState.Malformed}];const c=s.unarchiveChats;return(0,u.getArchiveV2EnabledSetting)()||((0,u.setArchiveV2EnabledSetting)(!0),g.default.archive=(0,i.default)((0,i.default)({},g.default.archive),{},{enabled:!0})),(0,u.setUnarchiveChatsSetting)(c),g.default.archive=(0,i.default)((0,i.default)({},g.default.archive),{},{classic:c}),yield(0,E.getStorage)().lock(["message","chat","sync-actions","active-message-ranges"],(0,a.default)((function*(){e=yield n.updateSideEffectOnChats(c,r),yield(0,m.getChatTable)().bulkCreateOrMerge(e)}))),e.forEach((e=>{const t=(0,d.createWid)(e.id),n=h.ChatCollection.get(t);n&&(n.archive=e.archive)})),[{actionState:l.SyncActionState.Success}]}return __LOG__(3)`archive setting sync: operation not supported`,[{actionState:l.SyncActionState.Unsupported}]}catch(e){return[{actionState:l.SyncActionState.Failed}]}}return __LOG__(3)`archive setting sync: no mutations`,[{actionState:l.SyncActionState.Failed}]}))()}_handleSettingOn(e){var t=this;return(0,a.default)((function*(){const n=[];performance.now();const r=(yield(0,m.getChatTable)().all()).filter((e=>e.archive)).map((e=>e.id)),i=(yield Promise.all(r.map((e=>(0,y.getActiveMessageRanges)(e))))).flat().filter((e=>e.action===S.ActiveRangeAction.Archive)).map((e=>e.chatId)),a=r.filter((e=>!i.includes(e))),o=(yield Promise.all(a.map((t=>{const n=(0,d.createWid)(t),r=JSON.stringify([l.Actions.Archive,n.toString({legacy:!0})]),i=e.find((e=>e.index===r));return i?Promise.resolve(i):_.default.getSyncAction(r)})))).filter((e=>{if(!e)return!1;const n=t.decodeValue(e).archiveChatAction;return[l.SyncActionState.Success,l.SyncActionState.Orphan].includes(e.actionState)&&(null==n?void 0:n.archived)&&n.messageRange})).map((e=>{const n=e&&t.decodeValue(e).archiveChatAction;return[e?JSON.parse(e.index)[1]:"",null==n?void 0:n.messageRange]})),s=new Map(o),c=Array.from(s.keys()),u=yield Promise.all(c.map((e=>(0,f.constructMessageRange)((0,d.createWid)(e),!1))));return c.forEach(((e,t)=>{const r=u[t],i=s.get(e);if(i){const t=(0,f.compareMessageRanges)(r,i);if(t===f.MessageRangeEncloseType.RangeAEnclosesRangeB||t===f.MessageRangeEncloseType.RangesNotEnclosing){const t=(0,d.createWid)(e);n.push({id:t.toString({legacy:!1}),archive:!1})}else __LOG__(4,void 0,new Error,!0)`Archive_Setting_Sync: Unsupported rangeEnclosedType ${t}`,SEND_LOGS("ArchiveSettingSync setting true rangeEnclosedType unsupported")}})),performance.now(),n.length,n}))()}_handleSettingOff(e){var t=this;return(0,a.default)((function*(){const n=[],r=yield _.default.getSyncActionsRows(["action"],[l.Actions.Archive]),i=e.filter((e=>e.action===l.Actions.Archive)),a=i.map((e=>e.index));return[...r.filter((e=>!a.includes(e.index))),...i].filter((e=>{if(e.actionState===l.SyncActionState.Success){var n;return null===(n=t.decodeValue(e).archiveChatAction)||void 0===n?void 0:n.archived}return!1})).forEach((e=>{const t=JSON.parse(e.index)[1],r=(0,d.createWid)(t);n.push({id:r.toString({legacy:!1}),archive:!0})})),n.length,n}))()}updateSideEffectOnChats(e,t){return e?this._handleSettingOn(t):this._handleSettingOff(t)}}const C=new T;Object.freeze(C);var A=C;t.default=A},129867:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(550073),l=n(381),c=n(631325),u=n(960362),d=n(408139),p=n(453168),f=n(14571),_=r(n(389867)),h=n(745454),g=r(n(321084)),m=n(819937),y=n(122954),S=r(n(273407)),E=n(293824),v=r(n(11339)),T=n(669951),C=n(776214),A=n(438342),b=n(330986),P=n(484902),O=n(760980);class M extends c.SyncActionBase{constructor(){super(...arguments),this.version=6}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return t||(0,y.throwInvalidActionIndex)(),{chatJid:t,messageKey:null}}_getMessageIdsThatWereUnstarredInCurrentPatch(e,t){const n=new Set;return e.forEach((e=>{if(e.actionName===u.Actions.Star&&e.timestamp>t){const t=(0,E.getMsgKeyFromStarActionIndex)(e.index);n.add(t.toString())}})),n}validateSyncActionValue(e){const t=e.clearChatAction;return(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e,t){var n=this;g.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const{allSupportedSetMutations:r}=t;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,d.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][clear-chat]: not enabled`,Promise.resolve({actionState:u.SyncActionState.Unsupported});if("set"===e.operation){var t;const{indexParts:i,value:a}=e,[,s,l,c]=i;if(s&&l&&c||(0,y.throwInvalidActionIndex)(),!_.default.isWid(s))return(0,E.uploadCriticalEventMetric)(v.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};if(!n.validateSyncActionValue(a))return __LOG__(3)`[syncd][clear-chat]: malformed mutation`,{actionState:u.SyncActionState.Malformed};const d=(0,o.default)(null===(t=a.clearChatAction)||void 0===t?void 0:t.messageRange,"value.clearChatAction?.messageRange"),p=(0,h.createWid)(s),f=p.toString();if(!(yield(0,C.getChatTable)().get(f)))return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:f}};const g=n._getMessageIdsThatWereUnstarredInCurrentPatch(r,e.timestamp);return n._applyMutation(p,d,"1"===l,"0"===c,g,a)}return __LOG__(3)`[syncd][clear-chat]: REMOVE operation not supported`,{actionState:u.SyncActionState.Unsupported}}catch(e){return{actionState:u.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}clearChat(e,t,r,i){return(0,a.default)((function*(){const{queryAndRemoveMessagesInMessageRange:a}=n(413946),o=yield a(e,t,{skipStarred:!r,skipMessages:i});if(o.length>0){(0,f.deleteModelsForLastReactionPreview)(o);const t=n(203292).getJobManager;yield t().waitUntilPersisted(p.jobSerializers.deleteAddOns(e.toString(),o))}const s=T.ChatCollection.get(e);s&&s.deleteMessages(o)}))()}_applyMutation(e,t,n,r,i,o){var s=this;return(0,a.default)((function*(){const a=(0,O.encodeProtobuf)(l.SyncActionValueSpec,o).readBuffer();return yield(0,A.addActiveMessageRange)(e.toString(),(0,A.getActiveRangeAction)("clearChat",{deleteMedia:r,deleteStarred:n}),a),yield s.clearChat(e,t,n,i),{actionState:u.SyncActionState.Success}}))()}getClearChatMutation(e,t,n,r){var i=this;return(0,a.default)((function*(){let a=yield(0,m.constructForwardMovingMessageRange)(t);const o=i._constructClearChatIndex(t,n,r||!1),c=yield S.default.getPendingMutationsRowsByIndex(["index"],o);if(c.length){var d;const e=c.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(d=(0,P.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).clearChatAction)||void 0===d?void 0:d.messageRange;t&&(a=(0,m.mergeMessageRanges)(a,t),(0,b.logMaybeMillisecondTimestamp)(a.lastMessageTimestamp,"pendingMutationRange"))}const p={timestamp:e,clearChatAction:{messageRange:a}};return{collection:u.CollectionName.RegularHigh,index:o,binarySyncAction:(0,O.encodeProtobuf)(l.SyncActionValueSpec,p).readBuffer(),version:i.version,operation:s.SyncdMutation$SyncdOperation.SET,timestamp:e,action:u.Actions.ClearChat}}))()}_constructClearChatIndex(e,t,n){return JSON.stringify([u.Actions.ClearChat,e.toString({legacy:!0}),t?"1":"0",n?"1":"0"])}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){const r=(0,P.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction),s=(0,P.decodeProtobuf)(l.SyncActionDataSpec,t.binarySyncData).value,c=e.timestamp,d=t.timestamp,p=(0,o.default)(r.clearChatAction,"pendingMutationValue.clearChatAction"),f=(0,o.default)(null==s?void 0:s.clearChatAction,"incomingMutationValue?.clearChatAction");switch((0,m.compareMessageRanges)((0,o.default)(f.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(p.messageRange,"pendingClearChatAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return u.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return u.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return c<=d?u.ConflictResolutionState.ApplyRemoteAndDropLocal:u.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,m.mergeMessageRanges)((0,o.default)(f.messageRange,"incomingClearChatAction.messageRange"),(0,o.default)(p.messageRange,"pendingClearChatAction.messageRange")),r=(0,O.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},s),{},{clearChatAction:{messageRange:t}})).readBuffer(),_=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:r});return delete _.id,yield(0,m.lockForMessageRangeSync)([],[_],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,h.createWid)(i[1]),o="1"===i[2],s="1"===i[3];return yield(0,A.addActiveMessageRange)(a.toString(),(0,A.getActiveRangeAction)("clearChat",{deleteStarred:o,deleteMedia:s}),r),n.clearChat(a,t,o)}))),u.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const I=new M;Object.freeze(I);var w=I;t.default=w},224900:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(631325),s=n(960362),l=n(272441),c=n(81245),u=n(745454),d=n(122954),p=n(719380),f=n(500959),_=n(776214),h=n(835673);class g extends o.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return(0,a.default)((function*(){const t=[],n=[],r=yield Promise.all(e.map((e=>{try{const a=e.indexParts,[,o]=a;o||(0,d.throwInvalidActionIndex)();const l=(0,u.createUserWid)(o);if("set"===e.operation){var r;const n=e.value.contactAction;if(!n)return __LOG__(3)`contact sync: malformed mutation`,{actionState:s.SyncActionState.Malformed};const a={id:o,name:n.fullName||"",shortName:n.firstName||(null!==(r=(0,f.getShortName)(n.fullName))&&void 0!==r?r:""),type:"in",isAddressBookContact:1,isContactSyncCompleted:0};return t.push(a),p.ContactCollection.add((0,i.default)((0,i.default)({},a),{},{id:l}),{merge:!0}),(0,c.syncNewContact)(l),{actionState:s.SyncActionState.Success}}if("remove"===e.operation){const e=p.ContactCollection.get(l);return null!=e&&e.setNotMyContact(),n.push(l),{actionState:s.SyncActionState.Success}}return __LOG__(3)`contact sync: operation not supported`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}})));if(yield(0,_.getContactTable)().bulkCreateOrMerge(t),n.length>0){const e=n.map((e=>(0,l.toPhoneUserJid)(e.user)));yield(0,h.setNotAddressBookContacts)(e)}return r}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},256928:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(550073),l=n(381),c=n(631325),u=n(960362),d=n(408139),p=n(453168),f=n(14571),_=r(n(389867)),h=n(745454),g=r(n(321084)),m=n(819937),y=n(122954),S=r(n(273407)),E=n(293824),v=n(377772),T=r(n(11339)),C=n(669951),A=n(776214),b=n(438342),P=n(330986),O=n(413946),M=n(484902),I=n(760980);class w extends c.SyncActionBase{constructor(){super(...arguments),this.version=6}validateSyncActionValue(e){const t=e.deleteChatAction;return(0,m.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return g.default.updatePrimaryAllowsAllMutationsFlag("other mutation"),Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if(!(0,d.clearOrDeleteChatSyncEnabled)())return __LOG__(3)`[syncd][delete-chat]: not enabled`,Promise.resolve({actionState:u.SyncActionState.Unsupported});if("set"===e.operation){var n;const{indexParts:r,value:i}=e,[,a,s]=r;if(a&&s||(0,y.throwInvalidActionIndex)(),!_.default.isWid(a))return(0,E.uploadCriticalEventMetric)(T.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};if(!t.validateSyncActionValue(i))return __LOG__(3)`[syncd][delete-chat]: malformed mutation`,{actionState:u.SyncActionState.Malformed};const l=(0,o.default)(null===(n=i.deleteChatAction)||void 0===n?void 0:n.messageRange,"value.deleteChatAction?.messageRange"),c=(0,h.createWid)(a),d=c.toString();return(yield(0,A.getChatTable)().get(d))?t._applyMutation(c,l,"0"===s,i):{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:d}}}return __LOG__(3)`[syncd][delete-chat]: REMOVE operation not supported`,{actionState:u.SyncActionState.Unsupported}}catch(e){return{actionState:u.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}deleteChat(e,t){return(0,a.default)((function*(){const r=C.ChatCollection.get(e);if(t){const i=yield(0,O.queryAndRemoveMessagesInMessageRange)(e,t);if(i.length>0){(0,f.deleteModelsForLastReactionPreview)(i);const t=n(203292).getJobManager;yield t().waitUntilPersisted(p.jobSerializers.deleteAddOns(e.toString(),i))}r&&r.deleteMessages(i)}else yield(0,v.deleteFromStorage)(e),r&&r.delete()}))()}_applyMutation(e,t,n,r){var i=this;return(0,a.default)((function*(){const a=(0,I.encodeProtobuf)(l.SyncActionValueSpec,r).readBuffer();yield(0,b.addActiveMessageRange)(e.toString(),(0,b.getActiveRangeAction)("deleteChat",{deleteMedia:n}),a);const o=yield(0,m.constructMessageRange)(e,!1);switch((0,m.compareMessageRanges)(o,t)){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:case m.MessageRangeEncloseType.RangesNotEnclosing:yield i.deleteChat(e,t);break;default:yield i.deleteChat(e)}return{actionState:u.SyncActionState.Success}}))()}getDeleteChatMutation(e,t,n){var r=this;return(0,a.default)((function*(){let i=yield(0,m.constructForwardMovingMessageRange)(t);const a=r._constructDeleteChatIndex(t,n||!1),o=yield S.default.getPendingMutationsRowsByIndex(["index"],a);if(o.length){var c;const e=o.reduce(((e,t)=>e.timestamp>t.timestamp?e:t)),t=null===(c=(0,M.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction).deleteChatAction)||void 0===c?void 0:c.messageRange;t&&(i=(0,m.mergeMessageRanges)(i,t),(0,P.logMaybeMillisecondTimestamp)(i.lastMessageTimestamp,"pendingMutationRange"))}const d={timestamp:e,deleteChatAction:{messageRange:i}};return{collection:u.CollectionName.RegularHigh,index:a,binarySyncAction:(0,I.encodeProtobuf)(l.SyncActionValueSpec,d).readBuffer(),version:r.version,operation:s.SyncdMutation$SyncdOperation.SET,timestamp:e,action:u.Actions.DeleteChat}}))()}_constructDeleteChatIndex(e,t){return JSON.stringify([u.Actions.DeleteChat,e.toString({legacy:!0}),t?"1":"0"])}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){const r=(0,M.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction),s=(0,M.decodeProtobuf)(l.SyncActionDataSpec,t.binarySyncData).value,c=e.timestamp,d=t.timestamp,p=(0,o.default)(r.deleteChatAction,"pendingMutationValue.deleteChatAction"),f=(0,o.default)(null==s?void 0:s.deleteChatAction,"incomingMutationValue?.deleteChatAction");switch((0,m.compareMessageRanges)((0,o.default)(f.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(p.messageRange,"pendingDeleteChatAction.messageRange"))){case m.MessageRangeEncloseType.RangeAEnclosesRangeB:return u.ConflictResolutionState.ApplyRemoteAndDropLocal;case m.MessageRangeEncloseType.RangeBEnclosesRangeA:return u.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesAreEqual:return c<=d?u.ConflictResolutionState.ApplyRemoteAndDropLocal:u.ConflictResolutionState.SkipRemote;case m.MessageRangeEncloseType.RangesNotEnclosing:const t=(0,m.mergeMessageRanges)((0,o.default)(f.messageRange,"incomingDeleteChatAction.messageRange"),(0,o.default)(p.messageRange,"pendingDeleteChatAction.messageRange")),r=(0,I.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},s),{},{deleteChatAction:{messageRange:t}})).readBuffer(),_=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:r});return delete _.id,yield(0,m.lockForMessageRangeSync)([],[_],(0,a.default)((function*(){const i=JSON.parse(e.index),a=(0,h.createWid)(i[1]);return yield(0,b.addActiveMessageRange)(a.toString(),(0,b.getActiveRangeAction)("deleteChat",{deleteMedia:"1"===i[2]}),r),n.deleteChat(a,t)}))),u.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const R=new w;Object.freeze(R);var N=R;t.default=N},841058:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(550073),s=n(381),l=n(631325),c=n(960362),u=n(892844),d=n(322911),p=r(n(465212)),f=n(453168),_=n(14571),h=r(n(389867)),g=n(122954),m=n(293824),y=r(n(11339)),S=n(559871),E=n(776214),v=n(584886),T=n(484902),C=n(760980);class A extends l.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return(0,i.default)((function*(){const t=[],r=new Map;yield(0,E.getMessageTable)().bulkGet(e.map((e=>{var t;const[,n,r,i,a]=e.indexParts;return n&&r&&i&&a&&h.default.isWid(n)?null===(t=(0,g.syncKeyToMsgKey)(n,r,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.set(e.id,e)}))));const a=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const[,n,i,a,o]=e.indexParts;n&&i&&a&&o||(0,g.throwInvalidActionIndex)();const s=(0,g.syncKeyToMsgKey)(n,i,a,o);if(!s)return(0,m.uploadCriticalEventMetric)(y.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:c.SyncActionState.Malformed};const l=r.get(s.toString());if(!l)return{actionState:c.SyncActionState.Orphan,orphanModel:{modelId:s.toString(),modelType:c.SyncModelType.Msg}};t.push(l.id);const u=S.MsgCollection.get(s);return u?(1===u.chat.msgs.length&&(yield(0,d.loadEarlierMsgs)(u.chat)),u.delete()):__LOG__(3)`delete_message_for_me_sync: msg ${s} found in storage but not in collection`,{actionState:c.SyncActionState.Success}}return __LOG__(3)`delete_message_for_me_sync: operation not supported`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));if(t.length>0){yield(0,v.removeMessagesFromHistory)(t);const e=new Set;t.forEach((t=>e.add(p.default.fromString(t).remote.toString())));const r=Array.from(e.values()).join(",").toString();(0,_.deleteModelsForLastReactionPreview)(t);const i=n(203292).getJobManager;yield i().waitUntilPersisted(f.jobSerializers.deleteAddOns(r,t))}return a}))()}resolveConflicts(e,t){var n,r;const i=(0,T.decodeProtobuf)(s.SyncActionValueSpec,e.binarySyncAction),o=(0,T.decodeProtobuf)(s.SyncActionDataSpec,t.binarySyncData).value,l=(0,a.default)(null===(n=i.deleteMessageForMeAction)||void 0===n?void 0:n.deleteMedia,"pendingMutationValue.deleteMessageForMeAction?.deleteMedia");return!(0,a.default)(null==o||null===(r=o.deleteMessageForMeAction)||void 0===r?void 0:r.deleteMedia,"incomingMutationValue?.deleteMessageForMeAction?.deleteMedia")&&l?Promise.resolve(c.ConflictResolutionState.SkipRemote):Promise.resolve(c.ConflictResolutionState.SkipRemoteAndDropLocal)}getDeleteForMeMutations(e,t){const n=(0,u.unixTimeMs)();return e.map((e=>{const r={deleteMessageForMeAction:{deleteMedia:t,messageTimestamp:e.t},timestamp:n};return{collection:c.CollectionName.RegularHigh,index:JSON.stringify([c.Actions.DeleteMessageForMe,e.id.remote.toString({legacy:!0}),e.id.id,e.id.fromMe?"1":"0",e.isGroupMsg&&!e.id.fromMe?e.sender.toString({legacy:!0}):"0"]),binarySyncAction:(0,C.encodeProtobuf)(s.SyncActionValueSpec,r).readBuffer(),version:this.version,operation:o.SyncdMutation$SyncdOperation.SET,timestamp:n,action:c.Actions.DeleteMessageForMe}}))}}const b=new A;Object.freeze(b);var P=b;t.default=P},112123:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(631325),s=n(960362),l=n(333037),c=n(864795),u=r(n(389867)),d=n(745454),p=n(122954),f=n(293824),_=r(n(11339)),h=n(68638),g=n(82663);class m extends o.SyncActionBase{constructor(){super(...arguments),this.version=s.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,a.default)((function*(){const t=new Set,r=[],o=[],m=yield Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var a;const{indexParts:m,value:y}=e,[,S,E]=m;S&&E||(0,p.throwInvalidActionIndex)();const v=null===(a=y.labelAssociationAction)||void 0===a?void 0:a.labeled;if(null==v)return __LOG__(3)`label jid sync: malformed mutation`,{actionState:s.SyncActionState.Malformed};if(!u.default.isWid(E))return(0,f.uploadCriticalEventMetric)(_.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:s.SyncActionState.Malformed};const T=(0,d.createWid)(E),C=T.toString(),A={labelId:S,associationId:C,type:g.LabelAssociationType.Jid};if(v){let e=t.has(C);if(!e){(yield(0,h.getTable)().get(C))&&(t.add(C),e=!0)}const a=n(63183).Chat,o=e?null:new a({id:T});r.push(A),o&&((0,h.getTable)().create((0,i.default)((0,i.default)({},o.toJSON()),{},{id:C})),t.add(C)),o&&n(669951).ChatCollection.add(o),(0,c.addToLabelCollection)(C,[S],l.LabelItemParentType.Chat)}else o.push(A),(0,c.removeLabelFromCollection)(C,S,l.LabelItemParentType.Chat);return{actionState:s.SyncActionState.Success}}return __LOG__(3)`label jid sync: unsupported operation`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()));return yield(0,g.getTable)().bulkRemove(o.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,g.getTable)().bulkCreateOrReplace(r),m}))()}}const y=new m;Object.freeze(y);var S=y;t.default=S},835096:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(631325),o=n(960362),s=n(333037),l=n(864795),c=r(n(389867)),u=n(122954),d=n(293824),p=r(n(11339)),f=n(776214),_=n(82663);function h(){return(h=(0,i.default)((function*(e){const t=new Set;return yield(0,f.getMessageTable)().bulkGet(e.map((e=>{var t;const[,,n,r,i,a]=e.indexParts;return n&&r&&i&&a&&c.default.isWid(n)?null===(t=(0,u.syncKeyToMsgKey)(n,r,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&t.add(e.id)})))),t}))).apply(this,arguments)}class g extends a.SyncActionBase{constructor(){super(...arguments),this.version=o.LABEL_ASSOCIATION_SYNC_VERSION}applyMutations(e){return(0,i.default)((function*(){const t=[],n=[],r=yield function(){return h.apply(this,arguments)}(e),i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:c}=e,[,f,h,g,m,y]=a;f&&h&&g&&m&&y||(0,u.throwInvalidActionIndex)();const S=null===(i=c.labelAssociationAction)||void 0===i?void 0:i.labeled;if(null==S)return __LOG__(3)`label message sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const E=(0,u.syncKeyToMsgKey)(h,g,m,y);if(!E)return(0,d.uploadCriticalEventMetric)(p.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:o.SyncActionState.Malformed};if(!r.has(E.toString()))return{actionState:o.SyncActionState.Orphan,orphanModel:{modelId:E.toString(),modelType:o.SyncModelType.Msg}};const v={labelId:f,associationId:E.toString(),type:_.LabelAssociationType.Message};return S?(t.push(v),(0,l.addToLabelCollection)(E.toString(),[f],s.LabelItemParentType.Msg)):(n.push(v),(0,l.removeLabelFromCollection)(E.toString(),f,s.LabelItemParentType.Msg)),{actionState:o.SyncActionState.Success}}return __LOG__(3)`label message sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}})));return yield(0,_.getTable)().bulkRemove(n.map((e=>[e.labelId,e.associationId,e.type]))),yield(0,_.getTable)().bulkCreateOrReplace(t),i}))()}}const m=new g;Object.freeze(m);var y=m;t.default=y},880056:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(631325),s=n(960362),l=n(122954),c=n(316770),u=n(694337);class d extends o.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:n,value:r}=e,[,a]=n;a||(0,l.throwInvalidActionIndex)();const o=r.labelEditAction;if(!o)return __LOG__(3)`label sync: malformed mutation`,{actionState:s.SyncActionState.Malformed};if(o.deleted)return yield(0,u.getTable)().remove(a),c.LabelCollection.remove(a),{actionState:s.SyncActionState.Success};const{color:d,predefinedId:p}=o,f=null!==(t=o.name)&&void 0!==t?t:"";""===f&&__LOG__(3)`labelEditAction.name is empty`,null==d&&__LOG__(3)`labelEditAction.color is empty`;const _={id:a,name:f,colorIndex:d,predefinedId:p};return yield(0,u.getTable)().createOrReplace(_),c.LabelCollection.add((0,i.default)({},_),{merge:!0}),{actionState:s.SyncActionState.Success}}return __LOG__(3)`label sync: operation not supported`,{actionState:s.SyncActionState.Unsupported}}catch(e){return{actionState:s.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const p=new d;Object.freeze(p);var f=p;t.default=f},79171:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(631325),o=n(960362),s=r(n(914296)),l=n(833970);class c extends a.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{value:t}=e,n=t.localeSetting;if(!n)return __LOG__(3)`locale setting sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const r=n.locale;return yield s.default.setLocale(r,l.L10N_PRIORITY.PHONE),{actionState:o.SyncActionState.Success}}return __LOG__(3)`locale setting sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const u=new c;Object.freeze(u);var d=u;t.default=d},464294:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(550073),l=n(381),c=n(631325),u=n(960362),d=r(n(364369)),p=r(n(389867)),f=n(745454),_=n(819937),h=n(122954),g=n(293824),m=r(n(11339)),y=n(669951),S=n(776214),E=n(438342),v=n(484902),T=n(760980);function C(e,t){switch(t){case _.MessageRangeEncloseType.RangesAreEqual:case _.MessageRangeEncloseType.RangeAEnclosesRangeB:return{actionState:u.SyncActionState.Success};case _.MessageRangeEncloseType.RangeBEnclosesRangeA:case _.MessageRangeEncloseType.RangesNotEnclosing:return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:e.toString()}}}}class A extends c.SyncActionBase{constructor(){super(...arguments),this.version=3}_setRead(e,t){const r=y.ChatCollection.get(e);if(r){const e=n(561498);t?e.markSeen(r):e.markUnseen(r)}}_isChatMarkedUnreadByUser(e){return(0,a.default)((function*(){const t=yield(0,S.getChatTable)().get(e.toString());return(null==t?void 0:t.unreadCount)===d.default.MARKED_AS_UNREAD}))()}validateSyncActionValue(e){const t=e.markChatAsReadAction;return null!=(null==t?void 0:t.read)&&(0,_.validateMessageRange)(null==t?void 0:t.messageRange)}applyMutations(e){var t=this;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{if("set"===e.operation){var n,r;const{indexParts:i,value:a}=e,[,s]=i;if(s||(0,h.throwInvalidActionIndex)(),!t.validateSyncActionValue(a))return __LOG__(3)`[syncd][mark-chat-as-read]: malformed mutation`,{actionState:u.SyncActionState.Malformed};if(!p.default.isWid(s))return(0,g.uploadCriticalEventMetric)(m.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};const l=(0,o.default)(null===(n=a.markChatAsReadAction)||void 0===n?void 0:n.read,"value.markChatAsReadAction?.read"),c=(0,o.default)(null===(r=a.markChatAsReadAction)||void 0===r?void 0:r.messageRange,"value.markChatAsReadAction?.messageRange"),d=(0,f.createWid)(s),_=d.toString();return(yield(0,S.getChatTable)().get(_))?t._applyMutation(d,l,c,a):{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:_}}}return __LOG__(3)`[syncd][mark-chat-as-read]: operation not supported`,{actionState:u.SyncActionState.Unsupported}}catch(e){return{actionState:u.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}_applyMutation(e,t,n,r){var i=this;return(0,a.default)((function*(){yield(0,E.removeActiveMessageRange)(e.toString(),(0,E.getActiveRangeAction)("markChatAsRead"));const a=yield(0,_.constructMessageRange)(e,!1),o=(0,_.compareMessageRanges)(a,n),s=(0,T.encodeProtobuf)(l.SyncActionValueSpec,r).readBuffer();switch(o){case _.MessageRangeEncloseType.RangesAreEqual:case _.MessageRangeEncloseType.RangeBEnclosesRangeA:return yield(0,E.addActiveMessageRange)(e.toString(),(0,E.getActiveRangeAction)("markChatAsRead"),s),i._setRead(e,t),Promise.resolve(C(e,o));case _.MessageRangeEncloseType.RangesNotEnclosing:case _.MessageRangeEncloseType.RangeAEnclosesRangeB:return t&&(yield i._isChatMarkedUnreadByUser(e))&&i._setRead(e,t),Promise.resolve(C(e,o))}}))()}_constructMarkChatAsReadIndex(e){return JSON.stringify([u.Actions.MarkChatAsRead,e.toString({legacy:!0})])}getMarkChatAsReadMutation(e,t,n){var r=this;return(0,a.default)((function*(){const i={timestamp:e,markChatAsReadAction:{read:t,messageRange:yield(0,_.constructMessageRange)(n,!0)}};return{collection:u.CollectionName.RegularLow,index:r._constructMarkChatAsReadIndex(n),binarySyncAction:(0,T.encodeProtobuf)(l.SyncActionValueSpec,i).readBuffer(),version:r.version,operation:s.SyncdMutation$SyncdOperation.SET,timestamp:e,action:u.Actions.MarkChatAsRead}}))()}resolveConflicts(e,t){var n=this;return(0,a.default)((function*(){var r,s;const c=(0,v.decodeProtobuf)(l.SyncActionValueSpec,e.binarySyncAction),d=(0,v.decodeProtobuf)(l.SyncActionDataSpec,t.binarySyncData).value,p=e.timestamp,h=t.timestamp,g=(0,o.default)(c.markChatAsReadAction,"pendingMutationValue.markChatAsReadAction"),m=(0,o.default)(null==d?void 0:d.markChatAsReadAction,"incomingMutationValue?.markChatAsReadAction");switch((0,_.compareMessageRanges)((0,o.default)(m.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(g.messageRange,"pendingMarkChatAsReadAction.messageRange"))){case _.MessageRangeEncloseType.RangeAEnclosesRangeB:return u.ConflictResolutionState.ApplyRemoteAndDropLocal;case _.MessageRangeEncloseType.RangeBEnclosesRangeA:return u.ConflictResolutionState.SkipRemote;case _.MessageRangeEncloseType.RangesAreEqual:return p<=h?u.ConflictResolutionState.ApplyRemoteAndDropLocal:u.ConflictResolutionState.SkipRemote;case _.MessageRangeEncloseType.RangesNotEnclosing:const t=p<=h?null!==(r=m.read)&&void 0!==r&&r:null!==(s=g.read)&&void 0!==s&&s,c=(0,_.mergeMessageRanges)((0,o.default)(m.messageRange,"incomingMarkChatAsReadAction.messageRange"),(0,o.default)(g.messageRange,"pendingMarkChatAsReadAction.messageRange")),y=(0,T.encodeProtobuf)(l.SyncActionValueSpec,(0,i.default)((0,i.default)({},d),{},{markChatAsReadAction:{read:t,messageRange:c}})).readBuffer(),S=(0,i.default)((0,i.default)({},e),{},{binarySyncAction:y});return delete S.id,yield(0,_.lockForMessageRangeSync)(["chat"],[S],(0,a.default)((function*(){const r=JSON.parse(e.index),i=(0,f.createWid)(r[1]);return yield(0,E.addActiveMessageRange)(i.toString(),(0,E.getActiveRangeAction)("markChatAsRead"),y),n._setRead(i,t)}))),u.ConflictResolutionState.SkipRemoteAndDropLocal}}))()}}const b=new A;Object.freeze(b);var P=b;t.default=P},819937:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageRangeEncloseType=void 0,t.compareMessageRanges=function(e,t){const n=E(e,t),r=E(t,e);if(n&&r)return S.RangesAreEqual;if(n)return S.RangeAEnclosesRangeB;if(r)return S.RangeBEnclosesRangeA;return S.RangesNotEnclosing},t.constructForwardMovingMessageRange=function(){return O.apply(this,arguments)},t.constructMessageRange=v,t.lockForMessageRangeSync=void 0,t.maybeMillisecondsToSeconds=M,t.mergeMessageRanges=A,t.validateMessageRange=function(e){if(null==e)return(0,f.uploadCriticalEventMetric)(_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_UNSET),!1;for(const[t,n]of b)if(n(e))return(0,f.uploadCriticalEventMetric)(t),!1;for(const t of e.messages)for(const[e,n]of P)if(n(t))return(0,f.uploadCriticalEventMetric)(e),!1;return!0};var i=r(n(348926)),a=n(608243),o=n(381),s=n(960362),l=n(892844),c=r(n(389867)),u=n(745454),d=r(n(273407)),p=n(238804),f=n(293824),_=r(n(11339)),h=n(438342),g=n(330986),m=n(569702),y=n(484902);const S=n(76672).Mirrored(["RangeAEnclosesRangeB","RangeBEnclosesRangeA","RangesAreEqual","RangesNotEnclosing"]);function E(e,t){const n=new Set(e.messages.map((e=>{var t;return null===(t=e.key)||void 0===t?void 0:t.id})));for(let e=0;e<t.messages.length;e++){var r;if(null==t.messages[e].timestamp)if(!n.has(null===(r=t.messages[e].key)||void 0===r?void 0:r.id))return!1}for(let r=0;r<t.messages.length;r++){var i,o,s;if(!n.has(null===(i=t.messages[r].key)||void 0===i?void 0:i.id)&&(0,a.numberOrThrowIfTooLarge)(null!==(o=e.lastMessageTimestamp)&&void 0!==o?o:0)<=(0,a.numberOrThrowIfTooLarge)(null!==(s=t.messages[r].timestamp)&&void 0!==s?s:0))return!1}return!0}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n){let r=yield(0,g.getLastMessageTimestamp)(e);(0,g.logMaybeMillisecondTimestamp)(r,"getLastMessageTimestamp");const i=yield(0,g.getLastSystemMessageTimestamp)(e);(0,g.logMaybeMillisecondTimestamp)(i,"lastSystemMessageTimestamp");const{messages:o,newLastMessageTimestamp:s}=yield(0,g.getAdditionalMessages)(e,r,n);if(null!=s&&(r=s,(0,g.logMaybeMillisecondTimestamp)(s,"newLastMessageTimestamp")),null==r){var l;r=null===(l=o.sort(g.timestampComparison)[o.length-1])||void 0===l?void 0:l.timestamp,(0,g.logMaybeMillisecondTimestamp)(r,"sorting")}const c={messages:o};if(null!=r&&(c.lastMessageTimestamp=r),null!=i&&(null==r||i>(0,a.numberOrThrowIfTooLarge)(r))&&(c.lastSystemMessageTimestamp=i,(0,g.logMaybeMillisecondTimestamp)(c.lastSystemMessageTimestamp,"lastSystemMessageTimestamp")),t&&null==c.lastMessageTimestamp){const t=yield(0,g.getFirstSystemMessageTimestamp)(e);null!=t&&(c.lastMessageTimestamp=t,(0,g.logMaybeMillisecondTimestamp)(c.lastMessageTimestamp,"firstSystemMessageTimestamp"),t===i&&(c.lastSystemMessageTimestamp=void 0))}return c}))).apply(this,arguments)}function C(e,t,n){const r=new Map;return e.concat(t).forEach((e=>{var t,i,o;const s=null!==(t=null===(i=e.key)||void 0===i?void 0:i.id)&&void 0!==t?t:"";if((0,a.numberOrThrowIfTooLarge)(null!==(o=e.timestamp)&&void 0!==o?o:0)>=n){const t=r.get(s);var l,c;if(t)r.set(s,(0,a.numberOrThrowIfTooLarge)(null!==(l=t.timestamp)&&void 0!==l?l:0)<(0,a.numberOrThrowIfTooLarge)(null!==(c=e.timestamp)&&void 0!==c?c:0)?e:t);else r.set(s,e)}})),Array.from(r.values())}function A(e,t){var n,r;const i=(0,a.numberOrThrowIfTooLarge)(null!==(n=e.lastMessageTimestamp)&&void 0!==n?n:0),o=(0,a.numberOrThrowIfTooLarge)(null!==(r=t.lastMessageTimestamp)&&void 0!==r?r:0),s=Math.max(i,o),l={messages:C(e.messages,t.messages,s)};if(0!==s&&(l.lastMessageTimestamp=s),null!=e.lastSystemMessageTimestamp||null!=t.lastSystemMessageTimestamp){var c,u;const n=Math.max((0,a.numberOrThrowIfTooLarge)(null!==(c=e.lastSystemMessageTimestamp)&&void 0!==c?c:0),(0,a.numberOrThrowIfTooLarge)(null!==(u=t.lastSystemMessageTimestamp)&&void 0!==u?u:0));(null==s||n>s)&&(l.lastSystemMessageTimestamp=n)}return l}t.MessageRangeEncloseType=S;const b=[[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET,e=>{let{lastSystemMessageTimestamp:t,lastMessageTimestamp:n}=e;return null!=t&&null!=n&&(0,a.numberOrThrowIfTooLarge)(t)<(0,a.numberOrThrowIfTooLarge)(n)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGES_CROSS_LIMIT,e=>e.messages.filter((e=>null!=e.timestamp)).length>1e3]],P=[[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_UNSET,e=>null==e.key],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.fromMe)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET,e=>{var t;return null==(null===(t=e.key)||void 0===t?void 0:t.id)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID,e=>{var t;return!(0,u.isWidlike)(null===(t=e.key)||void 0===t?void 0:t.remoteJid)}],[_.default.MD_SYNCD_CRITICAL_EVENT_CODE.MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET,e=>{var t,n,r;return c.default.isGroup(null===(t=e.key)||void 0===t?void 0:t.remoteJid)&&!(null===(n=e.key)||void 0===n?void 0:n.fromMe)&&null==(null===(r=e.key)||void 0===r?void 0:r.participant)}]];function O(){return(O=(0,i.default)((function*(e,t){var n;let r=yield v(e,!0,t);(yield(0,h.getActiveMessageRanges)(e.toString())).forEach((e=>{const t=e.actionValue.messageRange;switch(t&&((0,g.logMaybeMillisecondTimestamp)(t.lastMessageTimestamp,"activeRanges"),(0,g.logMaybeMillisecondTimestamp)(t.lastSystemMessageTimestamp,"activeRangesSystem")),e.action){case m.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:case m.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:case m.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:case m.ActiveRangeAction.ClearChatKeepStarredKeepMedia:case m.ActiveRangeAction.DeleteChatDeleteMedia:case m.ActiveRangeAction.DeleteChatKeepMedia:const t=e.actionValue.messageRange;t&&(r=A(r,t));break;case m.ActiveRangeAction.Archive:case m.ActiveRangeAction.MarkChatAsRead:}})),(0,g.logMaybeMillisecondTimestamp)(r.lastMessageTimestamp,"intermediaForwardMovingRange");const i=yield I(e);return r.messages=C(r.messages,i,(0,a.numberOrThrowIfTooLarge)(null!==(n=r.lastMessageTimestamp)&&void 0!==n?n:0)),r=(0,g.fixMessageRange)(r),(0,g.logMaybeMillisecondTimestamp)(r.lastMessageTimestamp,"forwardMovingRange"),r}))).apply(this,arguments)}function M(e){let t=e;try{(0,a.numberOrThrowIfTooLarge)(e)/(0,l.unixTime)()>10?(t=(0,a.numberOrThrowIfTooLarge)(e)/1e3,__LOG__(2)`syncd: maybeMillisecondsToSeconds: adjusting future timestamp`):__LOG__(2)`syncd: maybeMillisecondsToSeconds: no need to adjust timestamp`}catch(t){__LOG__(3)`syncd: maybeMillisecondsToSeconds: messageTimestamp: ${e} too large to cast`}return t}function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e){const t=[],n=yield d.default.getSyncActionsRows(["action"],[s.Actions.DeleteMessageForMe]);return __LOG__(2)`syncd: deleteForMeSyncActions length: ${n.length}`,n.forEach((n=>{const r=e.toString({legacy:!0}),i=JSON.parse(n.index);if(5!==i.length)__LOG__(2)`constructForwardMovingMessageRange: delete for me mutation index malformed ${n.index}`;else if(r===i[1]&&n.actionState===s.SyncActionState.Success){var a;const e=(0,y.decodeProtobuf)(o.SyncActionDataSpec,n.binarySyncData).value,r=null==e||null===(a=e.deleteMessageForMeAction)||void 0===a?void 0:a.messageTimestamp;if(null==r)__LOG__(2)`constructForwardMovingMessageRange: deleteMessageForMeAction malformed`;else{const e={remoteJid:i[1],id:i[2],fromMe:"1"===i[3],participant:"0"!==i[4]?i[4]:void 0};t.push({key:e,timestamp:M(r)})}}})),t}))).apply(this,arguments)}t.lockForMessageRangeSync=(e,t,n)=>(0,p.lockForSync)([...e,"message","active-message-ranges"],t,n)},170119:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(608243),o=n(550073),s=n(381),l=n(631325),c=n(960362),u=n(892844),d=r(n(389867)),p=n(745454),f=n(122954),_=n(293824),h=r(n(11339)),g=n(776214),m=n(760980);class y extends l.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{indexParts:r,value:i}=e,[,o]=r;if(o||(0,f.throwInvalidActionIndex)(),!d.default.isWid(o))return(0,_.uploadCriticalEventMetric)(h.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:c.SyncActionState.Malformed};const s=i.muteAction,l=null===(t=i.muteAction)||void 0===t?void 0:t.muted,m=(0,a.maybeNumberOrThrowIfTooLarge)(null==s?void 0:s.muteEndTimestamp);if(null==l||l&&null==m)return __LOG__(3)`mute chat sync: malformed mutation`,{actionState:c.SyncActionState.Malformed};const y=(0,p.createWid)(o);if(!(yield(0,g.getChatTable)().get(y.toString())))return{actionState:c.SyncActionState.Orphan,orphanModel:{modelType:c.SyncModelType.Chat,modelId:y.toString()}};const S=null!=m?m:0,E=S>0&&S<(0,u.unixTimeMs)()?0:Math.floor(S/1e3);return yield(0,g.getChatTable)().merge(y.toString(),{muteExpiration:E}),n(72472).MuteCollection.add({id:y,expiration:E},{merge:!0}),{actionState:c.SyncActionState.Success}}return __LOG__(3)`mute chat sync: operation not supported`,{actionState:c.SyncActionState.Unsupported}}catch(e){return{actionState:c.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}generateMuteMutation(e,t){const n=void 0!==t&&0!==t,r=(0,u.unixTimeMs)();let i=t;-1!==i&&(i*=1e3);const a={timestamp:r,muteAction:{muted:n,muteEndTimestamp:i}};return{collection:c.CollectionName.RegularHigh,index:JSON.stringify([c.Actions.Mute,e.toString({legacy:!0})]),operation:o.SyncdMutation$SyncdOperation.SET,version:this.version,binarySyncAction:(0,m.encodeProtobuf)(s.SyncActionValueSpec,a).readBuffer(),timestamp:r,action:c.Actions.Mute}}}const S=new y;Object.freeze(S);var E=S;t.default=E},17867:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(631325),a=n(960362),o=r(n(389867)),s=n(745454),l=n(122954),c=n(293824),u=r(n(11339)),d=n(719380);class p extends i.SyncActionBase{constructor(){super(...arguments),this.version=1}applyMutations(e){return Promise.all(e.map((e=>{try{if("set"===e.operation){var t;const{indexParts:n,value:r}=e,[,i]=n;if(i||(0,l.throwInvalidActionIndex)(),!o.default.isWid(i))return(0,c.uploadCriticalEventMetric)(u.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:a.SyncActionState.Malformed};const p=null===(t=r.userStatusMuteAction)||void 0===t?void 0:t.muted;if(void 0===p)return __LOG__(3)`MuteStatusSync: malformed mutation ${e}`,{actionState:a.SyncActionState.Malformed};const f=(0,s.createUserWid)(i),_=d.ContactCollection.gadd(f);return _?(_.set({statusMute:p}),{actionState:a.SyncActionState.Success}):(__LOG__(3)`MuteStatusSync: contact ${i} couldn't be found`,{actionState:a.SyncActionState.Failed})}return __LOG__(3)`status user mute chat sync: operation not supported`,{actionState:a.SyncActionState.Unsupported}}catch(e){return{actionState:a.SyncActionState.Failed}}})))}}const f=new p;Object.freeze(f);var _=f;t.default=_},134610:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(550073),o=n(381),s=n(631325),l=n(960362),c=n(892844),u=n(551737),d=(n(871579),n(474315)),p=n(238804),f=n(362488),_=n(760980);class h extends s.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!(0,f.enableNuxSync)())return __LOG__(3)`NuxSync: nux_sync ab prop required`,e.map((()=>({actionState:l.SyncActionState.Unsupported})));const t=[],n=e.map((e=>{var n;if("set"!==e.operation)return __LOG__(3)`NuxSync: operation not supported ${e}`,{actionState:l.SyncActionState.Malformed};const r=e.indexParts[1];return(0,u.isString)(r)?(t.push({nuxKey:r,acknowledged:!0===(null===(n=e.value.nuxAction)||void 0===n?void 0:n.acknowledged)}),{actionState:l.SyncActionState.Success}):(__LOG__(3)`NuxSync: malformed mutation ${e}`,{actionState:l.SyncActionState.Malformed})}));return 0!==t.length&&(__LOG__(2)`NuxSync: update nux to local store`,(0,d.updateNuxSyncList)(t)),n}))()}_createNuxMutation(e,t,n){return{collection:l.CollectionName.RegularLow,index:JSON.stringify([l.Actions.Nux,e]),binarySyncAction:(0,_.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:t,nuxAction:{acknowledged:n}}).readBuffer(),version:this.version,operation:a.SyncdMutation$SyncdOperation.SET,timestamp:t,action:l.Actions.Nux}}acknowledgeNux(e){var t=this;return(0,i.default)((function*(){yield t._changeNuxState(e,!0)}))()}unAcknowledgeNux(e){var t=this;return(0,i.default)((function*(){yield t._changeNuxState(e,!1)}))()}_changeNuxState(e,t){var n=this;return(0,i.default)((function*(){if(!(0,f.enableNuxSync)())return;(0,d.updateNuxSyncList)([{nuxKey:e,acknowledged:t}]);const r=n._createNuxMutation(e,(0,c.unixTimeMs)(),t);yield(0,p.lockForSync)([],[r],(()=>Promise.resolve()))}))()}}const g=new h;Object.freeze(g);var m=g;t.default=m},536014:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(608243),o=r(n(145095)),s=n(550073),l=n(381),c=n(631325),u=n(960362),d=n(892844),p=n(408139),f=r(n(389867)),_=n(745454),h=r(n(321084)),g=r(n(774362)),m=n(122954),y=r(n(273407)),S=n(238804),E=n(293824),v=n(909025),T=r(n(11339)),C=n(776214),A=n(484902),b=n(760980);class P extends c.SyncActionBase{constructor(){super(...arguments),this.version=5}applyMutations(e){var t=this;return(0,i.default)((function*(){h.default.updatePrimaryAllowsAllMutationsFlag("other mutation");const n=[];for(let r=0;r<e.length;r++)n.push(yield t.applyMutation(e[r]));return n}))()}applyMutation(e){var t=this;return(0,i.default)((function*(){if("remove"===e.operation)return __LOG__(3)`syncd: pin_chat_sync: REMOVE not supported`,Promise.resolve({actionState:u.SyncActionState.Unsupported});if(!(0,p.pinChatSyncEnabled)())return __LOG__(3)`syncd: pin_chat_sync: not enabled`,Promise.resolve({actionState:u.SyncActionState.Unsupported});const{indexParts:n,value:r,timestamp:i}=e,[,a]=n;try{if(a||(__LOG__(3)`syncd: pin_chat_sync: missing chatId in index`,(0,m.throwInvalidActionIndex)()),!f.default.isWid(a))return(0,E.uploadCriticalEventMetric)(T.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:u.SyncActionState.Malformed};const e=(0,_.createWid)(a),{pinAction:n}=r;if(null==n)return __LOG__(3)`syncd: pin_chat_sync: missing pinAction`,Promise.resolve({actionState:u.SyncActionState.Malformed});const{pinned:o}=n;if(null==o)return __LOG__(3)`syncd: pin_chat_sync: missing pinned field`,Promise.resolve({actionState:u.SyncActionState.Malformed});if(null==(yield(0,C.getChatTable)().get(e.toString())))return{actionState:u.SyncActionState.Orphan,orphanModel:{modelType:u.SyncModelType.Chat,modelId:e.toString()}};if(!o)return yield t.applyUpdates([{wid:e,pinned:!1,timestamp:i}]),{actionState:u.SyncActionState.Success};const s=yield t.getLocalPins();if(s.some((t=>t.chatId.toString()===e.toString())))return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:u.SyncActionState.Success};if(s.length<3)return yield t.applyUpdates([{wid:e,pinned:o,timestamp:i}]),{actionState:u.SyncActionState.Success};const l=s.reduce(((e,t)=>t.timestamp<e.timestamp?t:e)),c=[],d=l.timestamp<i?l.chatId:e;return d===l.chatId&&c.push({wid:l.chatId,pinned:!1,timestamp:i},{wid:e,pinned:!0,timestamp:i}),yield Promise.all([t.applyUpdates(c),t.createPendingUnpin(d,i)]),Promise.resolve({actionState:u.SyncActionState.Success})}catch(e){return{actionState:u.SyncActionState.Failed}}}))()}applyUpdates(e){return(0,i.default)((function*(){if(0===e.length)return;const t=e.map((e=>{let{wid:t,pinned:n,timestamp:r}=e;const i={id:t.toString(),pin:n?r:0};return n&&(i.archive=!1),i}));yield Promise.all(t.map((e=>(0,C.getChatTable)().merge(e.id,e)))),yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield(0,v.getExisting)(e.wid);null!=t&&(t.pin=e.pinned?e.timestamp:0,e.pinned&&(t.archive=!1))}));return function(){return e.apply(this,arguments)}}()))}))()}createPendingUnpin(e,t){var n=this;return(0,i.default)((function*(){yield y.default.appendPendingMutationsRows([n.getPinMutation(t,!1,e)])}))()}getLocalPins(){return(0,i.default)((function*(){const e=(0,C.getChatTable)().all().then((e=>e.filter((e=>null!=e.pin&&e.pin>0)).map((e=>[e.id,(0,o.default)(e.pin,"chatRow.pin")])))),t=y.default.getSyncActionsRows(["action"],[u.Actions.Pin]).then((e=>e.filter((e=>e.actionState===u.SyncActionState.Orphan)).map((e=>{var t;const n=JSON.parse(e.index);if(n.length<2)return null;const r=n[1],i=(0,A.decodeProtobuf)(l.SyncActionDataSpec,e.binarySyncData).value;return null!=(null==i?void 0:i.pinAction)&&(null==i?void 0:i.pinAction.pinned)?[r,(0,a.numberOrThrowIfTooLarge)(null!==(t=i.timestamp)&&void 0!==t?t:0)]:null})).filter(Boolean))),[n,r]=yield Promise.all([e,t]);return[...n,...r].map((e=>{let[t,n]=e;return{chatId:(0,_.createWid)(t),timestamp:n}}))}))()}unpinAll(){var e=this;return(0,i.default)((function*(){const t=yield e.getLocalPins(),n=(0,d.unixTimeMs)(),r=t.map((t=>{let{chatId:r}=t;return e.getPinMutation(n,!1,r)}));return(0,S.lockForSync)(["chat"],r,(()=>Promise.resolve())).then((()=>e.applyUpdates(t.map((e=>{let{chatId:t}=e;return{wid:t,pinned:!1,timestamp:n}})))))}))()}getMutationsForPin(e,t,n){var r=this;return(0,i.default)((function*(){const i=[r.getPinMutation(e,t,n)];return t&&i.push(yield g.default.getArchiveChatMutation(e,!1,n)),i}))()}getChatJidAndMessageKey(e){const[,t]=e.indexArr;return{chatJid:t,messageKey:null}}getPinMutation(e,t,n){return{collection:u.CollectionName.RegularLow,index:JSON.stringify([u.Actions.Pin,n.toString({legacy:!0})]),binarySyncAction:(0,b.encodeProtobuf)(l.SyncActionValueSpec,{timestamp:e,pinAction:{pinned:t}}).readBuffer(),version:this.version,operation:s.SyncdMutation$SyncdOperation.SET,timestamp:e,action:u.Actions.Pin}}}const O=new P;Object.freeze(O);var M=O;t.default=M},544720:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(631325),s=n(960362),l=n(257243),c=n(634771);class u extends o.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){if(!0!==(0,l.getABPropConfigValue)("primary_feature_sync"))return __LOG__(3)`primary feature sync: operation not supported`,e.map((()=>({actionState:s.SyncActionState.Unsupported})));let t;const n=e.map((e=>{var n;if("set"!==e.operation)return __LOG__(3)`primary feature sync: operation not supported`,{actionState:s.SyncActionState.Malformed};return null==(null===(n=e.value.primaryFeature)||void 0===n?void 0:n.flags)?(__LOG__(3)`primary feature sync: malformed mutation`,{actionState:s.SyncActionState.Malformed}):((null==t||e.timestamp>t.timestamp)&&(t=e),{actionState:s.SyncActionState.Success})}));if(null!=t){var r;const e=(0,a.default)(null===(r=t.value.primaryFeature)||void 0===r?void 0:r.flags,"latestMutation.value.primaryFeature?.flags");c.PrimaryFeatures.setPrimaryFeatures(e)}return n}))()}}const d=new u;Object.freeze(d);var p=d;t.default=p},942339:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(550073),o=n(381),s=n(631325),l=n(960362),c=r(n(445150)),u=n(476195),d=n(58597),p=r(n(11339)),f=n(760980);class _ extends s.SyncActionBase{constructor(){super(...arguments),this.version=1}applyMutations(e){return(0,i.default)((function*(){return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const{value:r}=e;let i=null===(t=r.pushNameSetting)||void 0===t?void 0:t.name;i||(__LOG__(3)`push name sync: empty pushname`,(0,d.logCriticalBootstrapStageIfNecessary)(p.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),i=""),(0,c.default)(i),(0,u.setPushnameLocally)(i),yield(0,d.logCriticalBootstrapStageIfNecessary)(p.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_APPLIED);const a=n(595023).default;return a.isSyncDCriticalDataSyncInProcess()&&(a.setSyncDCriticalSynced(),yield a.setSyncDCriticalDataSyncCompleted()),Promise.resolve({actionState:l.SyncActionState.Success})}return __LOG__(3)`push name sync: operation not supported`,Promise.resolve({actionState:l.SyncActionState.Unsupported})}catch(e){return(0,d.logCriticalBootstrapStageIfNecessary)(p.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.PUSHNAME_INVALID),{actionState:l.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}))()}getPushnameMutation(e,t){return{collection:l.CollectionName.CriticalBlock,index:JSON.stringify([l.Actions.SettingPushName]),binarySyncAction:(0,f.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:e,pushNameSetting:{name:t}}).readBuffer(),version:this.version,operation:a.SyncdMutation$SyncdOperation.SET,timestamp:e,action:l.Actions.SettingPushName}}}const h=new _;Object.freeze(h);var g=h;t.default=g},360282:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(631325),o=n(960362),s=n(122954),l=n(999662),c=n(776214);class u extends a.SyncActionBase{constructor(){super(...arguments),this.version=2}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){const{indexParts:t,value:n}=e,[,r]=t;r||(0,s.throwInvalidActionIndex)();const i=n.quickReplyAction;if(!i)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};if(i.deleted)return yield(0,c.getQuickReplyTable)().remove(r),l.QuickReplyCollection.remove(r),{actionState:o.SyncActionState.Success};const{shortcut:a,message:u}=i;if(!a||!u)return __LOG__(3)`quick replies sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const d=i.keywords||[],p=i.count||0;return yield(0,c.getQuickReplyTable)().createOrReplace({id:r,shortcut:a,count:p,message:u,keywords:d}),l.QuickReplyCollection.add({id:r,shortcut:a,message:u,keywords:d,count:p},{merge:!0}),{actionState:o.SyncActionState.Success}}return __LOG__(3)`quick replies sync: operation not supported`,{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}}const d=new u;Object.freeze(d);var p=d;t.default=p},740108:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(550073),o=n(381),s=n(631325),l=n(960362),c=n(892844),u=r(n(273407)),d=n(837),p=n(760980);class f extends s.SyncActionBase{constructor(){super(...arguments),this.version=3}applyMutations(e){return Promise.all(e.map(function(){var e=(0,i.default)((function*(e){try{if("set"===e.operation){var t;const n=null===(t=e.value.keyExpiration)||void 0===t?void 0:t.expiredKeyEpoch;return null==n?(__LOG__(4,void 0,new Error)`sentinel mutation sync: malformed mutation`,{actionState:l.SyncActionState.Malformed}):(yield u.default.expireSyncKey(n),{actionState:l.SyncActionState.Success})}return __LOG__(3)`sentinel mutation sync: operation not supported`,{actionState:l.SyncActionState.Unsupported}}catch(e){return{actionState:l.SyncActionState.Failed}}}));return function(){return e.apply(this,arguments)}}()))}getSentinelMutations(){var e=this;return(0,i.default)((function*(){const t=(0,c.unixTimeMs)(),n=Array.from(l.CollectionName.members()),r={keyExpiration:{expiredKeyEpoch:(yield(0,d.getNewestKeyPair)()).keyEpoch},timestamp:t};return n.map((n=>({collection:n,index:JSON.stringify([l.Actions.Sentinel,n]),operation:a.SyncdMutation$SyncdOperation.SET,version:e.version,binarySyncAction:(0,p.encodeProtobuf)(o.SyncActionValueSpec,r).readBuffer(),timestamp:t,action:l.Actions.Sentinel})))}))()}}const _=new f;Object.freeze(_);var h=_;t.default=h},721263:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(550073),o=n(381),s=n(631325),l=n(960362),c=n(892844),u=r(n(389867)),d=n(122954),p=n(293824),f=r(n(11339)),_=n(559871),h=n(719011),g=n(776214),m=n(584886),y=n(760980);class S extends s.SyncActionBase{constructor(){super(...arguments),this.version=2}getChatJidAndMessageKey(e){const[,t,n,r,i]=e.indexArr;t&&n&&r&&i||(0,d.throwInvalidActionIndex)();const a=(0,d.syncKeyToMsgKey)(t,n,r,i);return{chatJid:t,messageKey:null==a?void 0:a.toString()}}applyMutations(e){return(0,i.default)((function*(){const t=[],n=[],r=new Set;yield(0,g.getMessageTable)().bulkGet(e.map((e=>{var t;const[,n,r,i,a]=e.indexParts;return n&&r&&i&&a&&u.default.isWid(n)?null===(t=(0,d.syncKeyToMsgKey)(n,r,i,a))||void 0===t?void 0:t.toString():null})).filter(Boolean)).then((e=>e.forEach((e=>{e&&r.add(e.id)}))));const i=yield Promise.all(e.map((e=>{try{if("set"===e.operation){var i;const{indexParts:a,value:o}=e,[,s,c,u,g]=a;s&&c&&u&&g||(0,d.throwInvalidActionIndex)();const m=null===(i=o.starAction)||void 0===i?void 0:i.starred;if(null==m)return __LOG__(3)`star message sync: malformed mutation`,{actionState:l.SyncActionState.Malformed};const y=(0,d.syncKeyToMsgKey)(s,c,u,g);if(!y)return(0,p.uploadCriticalEventMetric)(f.default.MD_SYNCD_CRITICAL_EVENT_CODE.ACTION_INVALID_INDEX_DATA),{actionState:l.SyncActionState.Malformed};if(!r.has(y.toString()))return{actionState:l.SyncActionState.Orphan,orphanModel:{modelId:y.toString(),modelType:l.SyncModelType.Msg}};m?t.push(y.toString()):n.push(y.toString());const S=_.MsgCollection.get(y);return S?(S.star=m,S.star?(0,h.addStarredMsgs)([S]):(0,h.removeStarredMsgs)([S])):__LOG__(3)`star_message_sync: msg ${y} found in storage but not in collection`,{actionState:l.SyncActionState.Success}}return __LOG__(3)`star message sync: operation not supported`,{actionState:l.SyncActionState.Unsupported}}catch(e){return{actionState:l.SyncActionState.Failed}}})));return yield Promise.all([(0,m.starMessages)(t),(0,m.unstarMessages)(n)]),i}))()}getStarMessageMutations(e,t){const n=(0,c.unixTimeMs)();return e.map((e=>({collection:l.CollectionName.RegularHigh,index:(0,p.constructStarMsgKey)(e),operation:a.SyncdMutation$SyncdOperation.SET,version:this.version,binarySyncAction:(0,y.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:n,starAction:{starred:t}}).readBuffer(),timestamp:n,action:l.Actions.Star})))}}const E=new S;Object.freeze(E);var v=E;t.default=v},642903:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(631325),o=n(960362),s=n(122954),l=n(115578),c=n(503027),u=n(712901);class d extends a.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){const t=[],n=e.map((e=>{try{if("set"===e.operation){const{indexParts:n,value:r}=e,[,i]=n;i||(0,s.throwInvalidActionIndex)();const{subscriptionAction:a}=r;if(void 0===(null==a?void 0:a.isAutoRenewing)||void 0===a.isDeactivated)return __LOG__(3)`subscription sync: malformed mutation`,{actionState:o.SyncActionState.Malformed};const l={id:i,isAutoRenewing:a.isAutoRenewing,isDeactivated:a.isDeactivated,expirationDate:void 0!==a.expirationDate?parseInt(a.expirationDate,10):void 0};return t.push(l),{actionState:o.SyncActionState.Success}}return{actionState:o.SyncActionState.Unsupported}}catch(e){return{actionState:o.SyncActionState.Failed}}}));yield(0,u.getTable)().bulkCreateOrMerge(t),c.SubscriptionCollection.add(t);try{(0,l.update)()}catch(e){__LOG__(4,void 0,new Error,!0)`subscription sync: error PremiumAccessEngine ${e}`,SEND_LOGS("PremiumAccessEngine")}return n}))()}}const p=new d;Object.freeze(p);var f=p;t.default=f},122954:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.syncKeyToMsgKey=function(e,t,n,r){let i;if(!s.default.isWid(e))return __LOG__(3)`syncKeyToMsgKey: invalid remote value: ${e.replace(d,"#")}`,null;if(!(0,l.createWid)(e).isUser()){if("0"===n&&!s.default.isWid(r))return __LOG__(3)`syncKeyToMsgKey: invalid participant value: ${r.replace(d,"#")}`,null;i="1"===n?(0,o.getMeUser)():(0,l.createWid)(r)}return new a.default({fromMe:"1"===n,remote:(0,l.createWid)(e),id:t,participant:i})},t.throwInvalidActionIndex=function(){throw(0,c.uploadFatalErrorMetric)(u.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX,null),new i.SyncdFatalError("invalid action index")};var i=n(266313),a=r(n(465212)),o=n(978820),s=r(n(389867)),l=n(745454),c=n(801116),u=r(n(11339));const d=/\d(?=)/gm},72411:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(631325),o=n(960362),s=n(257243),l=n(40234);class c extends a.SyncActionBase{constructor(){super(...arguments),this.version=7}applyMutations(e){return(0,i.default)((function*(){return!0!==(0,s.getABPropConfigValue)("md_syncd_24_hour_time_format_sync_enabled")?(__LOG__(3)`time format sync: operation not supported`,e.map((()=>({actionState:o.SyncActionState.Unsupported})))):e.map((e=>{var t;if("set"!==e.operation)return __LOG__(3)`time format sync: operation not supported`,{actionState:o.SyncActionState.Unsupported};const n=null===(t=e.value.timeFormatAction)||void 0===t?void 0:t.isTwentyFourHourFormatEnabled;return null==n?(__LOG__(3)`time format sync: malformed mutation`,{actionState:o.SyncActionState.Malformed}):(l.Clock.setIs24Hour(n),{actionState:o.SyncActionState.Success})}))}))()}}const u=new c;Object.freeze(u);var d=u;t.default=d},58597:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logCriticalBootstrapStageIfNecessary=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(892844),o=n(257243),s=n(388432),l=r(n(11339));function c(){return(c=(0,i.default)((function*(e){(yield(0,o.getABPropConfigValue)("md_app_state_critical_data_processing_logging"))&&n(595023).default.isSyncDCriticalDataSyncInProcess()&&new l.default.MdBootstrapAppStateCriticalDataProcessing({bootstrapAppStateDataStage:e,mdSessionId:yield s.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,a.unixTimeMs)()}).commit()}))).apply(this,arguments)}},273407:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(400899),o=(n(381),n(776214)),s=n(799069);n(484902);const l=new ArrayBuffer(a.KEY_LENGTH_BYTES);t.default=class{static getAllPendingMutationsRows(){return(0,o.getPendingMutationsTable)().all()}static performTransaction(e){return(0,s.getStorage)().lock(["collection-version","pending-mutations","sync-actions"],e)}static getPendingMutationsRows(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static getPendingMutationsRowsById(e){return(0,i.default)((function*(){return(yield(0,o.getPendingMutationsTable)().bulkGet(e)).filter(Boolean)}))()}static getPendingMutationsRowsByIndex(e,t){return(0,o.getPendingMutationsTable)().equals(e,t)}static appendPendingMutationsRows(e){return(0,o.getPendingMutationsTable)().bulkCreate(e)}static bulkUpdatePendingMutationsKeyId(e){return(0,o.getPendingMutationsTable)().bulkCreateOrMerge(e)}static bulkRemovePendingMutations(e){return(0,o.getPendingMutationsTable)().bulkRemove(e)}static hasPendingMutationForCollection(e){return(0,o.getPendingMutationsTable)().equals(["collection"],e).then((e=>e.length>0))}static getCollectionVersion(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return null==t?void 0:t.version}))()}static getCollectionVersions(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().bulkGet(e);return new Map(e.map(((e,n)=>{var r;return[e,null===(r=t[n])||void 0===r?void 0:r.version]})))}))()}static setCollectionVersion(e,t,n){return(0,o.getCollectionVersionTable)().createOrMerge(e,{collection:e,version:t,ltHash:n})}static getLtHash(e){return(0,i.default)((function*(){const t=yield(0,o.getCollectionVersionTable)().get(e);return(null==t?void 0:t.ltHash)||l}))()}static getAllCollectionLtHashes(){return(0,i.default)((function*(){return(yield(0,o.getCollectionVersionTable)().all()).map((e=>({collection:e.collection,ltHash:e.ltHash})))}))()}static getSyncAction(e){return(0,o.getSyncActionsTable)().get(e)}static getSyncActionsRows(e,t){return(0,o.getSyncActionsTable)().anyOf(e,t)}static setSyncAction(e){return(0,o.getSyncActionsTable)().createOrReplace(e)}static setSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrReplace(e)}static updateSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkCreateOrMerge(e)}static deleteSyncActionRows(e){return(0,o.getSyncActionsTable)().bulkRemove(e)}static getSyncKey(e){return(0,o.getSyncKeysTable)().get(e)}static getAllSyncKeys(){return(0,o.getSyncKeysTable)().all()}static createSyncKey(e){return(0,o.getSyncKeysTable)().create(e)}static getSyncKeyData(e){return(0,o.getSyncKeysTable)().get(e)}static expireSyncKey(e){return(0,i.default)((function*(){(yield(0,o.getSyncKeysTable)().equals(["keyEpoch"],e)).forEach((e=>(0,o.getSyncKeysTable)().merge(e.keyId,{keyId:e.keyId,timestamp:0})))}))()}static getMissingKey(e){return(0,o.getMissingKeysTable)().get(e)}static getMissingKeyCount(){return(0,o.getMissingKeysTable)().count()}static bulkGetMissingKeys(e){return(0,o.getMissingKeysTable)().bulkGet(e)}static getAllMissingKeys(){return(0,o.getMissingKeysTable)().all()}static bulkRemoveMissingKeys(e){return(0,o.getMissingKeysTable)().bulkRemove(e)}static createOrUpdateMissingKeys(e){return(0,o.getMissingKeysTable)().bulkCreateOrMerge(e)}}},425374:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleSyncdFatal=t.handleSyncDelayApplyingPatchUntilUIUnblocks=t.handleSyncCompleted=t.handleSyncBeforeApplyPatch=t.getSyncMaxSupportedVersion=t.getSyncDisabled=t.getSyncActionHandler=t.getPrimaryPlatform=t.getLogoutInProgress=void 0;var i=r(n(145095)),a=n(781572),o=r(n(355184)),s=r(n(904285)),l=n(546718),c=r(n(321084)),u=n(802161),d=r(n(652991)),p=n(317239),f=n(768254);t.getLogoutInProgress=()=>d.default.isLogoutInProgress;t.getPrimaryPlatform=()=>p.Conn.platform;t.getSyncActionHandler=e=>u.ActionHandlers.get(e);t.getSyncDisabled=()=>"true"===(0,i.default)(s.default,"localStorage").getItem(l.KEYS.SYNCD_DISABLED_DUE_TO_FATAL);const _=u.maxSupportedVersion;t.getSyncMaxSupportedVersion=_;t.handleSyncBeforeApplyPatch=e=>{0===e.deviceIndex&&c.default.updatePrimaryAllowsAllMutationsFlag("device index")};t.handleSyncCompleted=e=>{a.Cmd.trigger(a.APP_STATE_SYNC_COMPLETED,e)};const h=o.default;t.handleSyncDelayApplyingPatchUntilUIUnblocks=h;const g=f.handleFatalError;t.handleSyncdFatal=g},802161:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.maxSupportedVersion=t.ActionHandlers=void 0;var i=r(n(606162)),a=n(960362),o=r(n(93945)),s=r(n(321084)),l=r(n(774362)),c=r(n(428464)),u=r(n(129867)),d=r(n(224900)),p=r(n(256928)),f=r(n(841058)),_=r(n(112123)),h=r(n(835096)),g=r(n(880056)),m=r(n(79171)),y=r(n(464294)),S=r(n(170119)),E=r(n(17867)),v=r(n(134610)),T=r(n(536014)),C=r(n(544720)),A=r(n(942339)),b=r(n(360282)),P=r(n(740108)),O=r(n(721263)),M=r(n(642903)),I=r(n(72411));const w=new Map([[a.Actions.Star,O.default],[a.Actions.Contact,d.default],[a.Actions.Mute,S.default],[a.Actions.LabelEdit,g.default],[a.Actions.Agent,o.default],[a.Actions.LabelMessage,h.default],[a.Actions.LabelJid,_.default],[a.Actions.QuickReply,b.default],[a.Actions.LocaleSetting,m.default],[a.Actions.SettingPushName,A.default],[a.Actions.Archive,l.default],[a.Actions.MarkChatAsRead,y.default],[a.Actions.ClearChat,u.default],[a.Actions.DeleteMessageForMe,f.default],[a.Actions.Sentinel,P.default],[a.Actions.UnarchiveChatsSetting,c.default],[a.Actions.Pin,T.default],[a.Actions.DeleteChat,p.default],[a.Actions.AndroidUnsupportedActions,s.default],[a.Actions.PrimaryFeature,C.default],[a.Actions.Nux,v.default],[a.Actions.Subscription,M.default],[a.Actions.TimeFormat,I.default],[a.Actions.MuteStatusSync,E.default]]);t.ActionHandlers=w;t.maxSupportedVersion=()=>(0,i.default)(Array.from(w.values()).map((e=>e.version)))},335377:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMetricsForDataApplied=function(){return u.apply(this,arguments)},t.logMetricsForMutationLength=function(e){new c.default.MdAppStateMessageRange({additionalMessagesCount:e}).commit()};var i=r(n(348926)),a=n(549334),o=n(892844),s=n(293824),l=n(388432),c=r(n(11339));function u(){return(u=(0,i.default)((function*(e,t,n){new c.default.MdBootstrapDataApplied({mdBootstrapPayloadType:c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdBootstrapSource:c.default.MD_BOOTSTRAP_SOURCE.APP_STATE,mdSessionId:yield l.MdSyncFieldStatsMeta.getMdSessionId(),mdTimestamp:(0,o.unixTimeMs)(),mdBootstrapStepDuration:n,collection:(0,s.collectionNameToMetric)(e),usedSnapshot:t===a.SyncdBootstrapDataAppliedSnapshotUsed.SNAPSHOT_USED}).commit()}))).apply(this,arguments)}},262274:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitBootstrapAppStateDownloadMetric=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(608243),o=n(960362),s=n(892844),l=n(388432),c=r(n(11339));function u(){return(u=(0,i.default)((function*(e,t,n,r){const i=new c.default.MdBootstrapAppStateDataDownloaded({mdBootstrapPayloadType:[o.CollectionName.CriticalBlock,o.CollectionName.CriticalUnblockLow].includes(e)?c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.CRITICAL:c.default.MD_BOOTSTRAP_PAYLOAD_TYPE.NON_CRITICAL,mdTimestamp:(0,s.unixTimeMs)(),mdBootstrapStepDuration:(0,s.unixTimeMs)()-t,mdBootstrapStepResult:"success"===r?c.default.MD_BOOTSTRAP_STEP_RESULT.SUCCESS:c.default.MD_BOOTSTRAP_STEP_RESULT.FAILURE,mdSessionId:yield l.MdSyncFieldStatsMeta.getMdSessionId()}),u=yield l.MdSyncFieldStatsMeta.getStorageEstimation();u.mdStorageQuotaBytes!==l.STORAGE_QUOTA_UNAVAILABLE&&(i.mdStorageQuotaUsedBytes=u.mdStorageQuotaUsedBytes,i.mdStorageQuotaBytes=u.mdStorageQuotaBytes);try{const e=(0,a.maybeNumberOrThrowIfTooLarge)(n);null!=e&&(i.mdBootstrapPayloadSize=e)}catch(e){}i.commit()}))).apply(this,arguments)}},765582:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyRequest=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(463109),o=n(453168),s=n(203292),l=r(n(273407));function c(){return(c=(0,i.default)((function*(e,t){const n=e.keyIds;if(n){const e=n.map((e=>e.keyId)).filter(Boolean);if(__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}
\t for keyIds: [${e.map(a.arrayBufferToHex)}]`,e){const n=[],r=[];return yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield l.default.getSyncKey(new Uint8Array(e));t?n.push(t):r.push(e)}));return function(){return e.apply(this,arguments)}}())),__LOG__(2)`syncd: handleAppStateSyncKeyRequest from device ${t.getDeviceId()}: about to send key share
\t keys with keydata: [${n.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)))}]
\t keys without keydata: [${r.map((e=>(0,a.arrayBufferToHex)(e)))}]`,(0,s.getJobManager)().waitUntilPersisted(o.jobSerializers.sendRequestedKeyShare(n,r,t))}}}))).apply(this,arguments)}},182568:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleAppStateSyncKeyShare=function(e,t){return h(e,t)},t.setAppStateSyncKeyShareHandler=function(e){};var i=r(n(348926)),a=n(608243),o=n(836229),s=n(463109),l=n(353771),c=n(793932),u=n(58597),d=r(n(273407)),p=n(768254),f=n(801116),_=r(n(11339));let h=function(){var e=(0,i.default)((function*(e,t){(0,u.logCriticalBootstrapStageIfNecessary)(_.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_RECEIVED);const n=t.getDeviceId();__LOG__(2)`syncd: handling key share from device ${n} with ${e.keys.length} keys`;const r=[],h=e.keys;if(!h)return Promise.resolve();yield Promise.all(h.map(function(){var e=(0,i.default)((function*(e){var t;const i=null===(t=e.keyId)||void 0===t?void 0:t.keyId,o=e.keyData,c=null==o?void 0:o.keyData;if(!i)return void __LOG__(2)`syncd: received key with missing keyID from device ${n}`;const u=(0,s.arrayBufferToHex)(i);if(__LOG__(2)`syncd: received key share key id ${u} from device ${n} ${null!=c?"with":"without"} keyData`,6!==i.byteLength)return(0,f.uploadFatalErrorMetric)(_.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_ID,null),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`,SEND_LOGS(`syncd: fatal error: key share key id has invalid bytelength of ${i.byteLength}`),(0,p.handleFatalError)();if(r.push({keyId:i,keyData:c}),o){var h,g,m;const e=o.timestamp,t=null===(h=o.fingerprint)||void 0===h?void 0:h.currentIndex,r=null===(g=o.fingerprint)||void 0===g?void 0:g.rawId,s=null===(m=o.fingerprint)||void 0===m?void 0:m.deviceIndexes;if(!c||null==e||null==t||null==r||!s)return(0,f.uploadFatalErrorMetric)(_.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_KEY_SHARE_KEY_DATA,null),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: invalid key share key data`,SEND_LOGS("syncd: fatal error: invalid key share key data"),(0,p.handleFatalError)();const y=new Uint8Array(i);(yield d.default.getSyncKey(y))||(yield d.default.createSyncKey({keyId:y,keyEpoch:(0,l.getKeyEpoch)(i),keyData:c,timestamp:(0,a.numberOrThrowIfTooLarge)(e),fingerprint:{rawId:r,currentIndex:t,deviceIndexes:s}}),__LOG__(2)`syncd: stored key share key id ${u} from device ${n}`)}}));return function(){return e.apply(this,arguments)}}())),r.some((e=>null!=e.keyData))||__LOG__(2)`syncd: key share from device ${n} has no keys with keydata.`,yield(0,c.updateMissingKeys)(r,t),(0,o.syncBlockedCollections)()}));return function(){return e.apply(this,arguments)}}()},284051:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleMissingKeys=function(){return u.apply(this,arguments)},t.requestAllMissingKeys=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=n(463109),o=n(604573),s=n(765031),l=r(n(273407)),c=n(793932);function u(){return(u=(0,i.default)((function*(e){if(!n(528237).OfflineMessageHandler.isResumeFromRestartComplete())return void __LOG__(2)`syncd: _handleMissingKeys: skipping due to resume from restart in progress`;const t=Array.from(e);__LOG__(2)`syncd: _handleMissingKeys: missing keys [${t}]`;const r=new Set((yield l.default.bulkGetMissingKeys(t)).filter(Boolean).map((e=>e.keyHex))),i=t.filter((e=>!r.has(e)));if(__LOG__(2)`syncd: _handleMissingKeys: missing keys after filter: [${i}]`,0===i.length)return Promise.resolve();const o=i.map((e=>(0,a.hexToUint8Array)(e).buffer)),s=yield d(o);yield(0,c.addMissingKeys)(o,s.map((e=>e.getDeviceId())))}))).apply(this,arguments)}function d(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=yield(0,o.getPeerDevices)();return yield(0,s.sendAppStateSyncKeyRequest)(e,t),t}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){const e=yield l.default.getAllMissingKeys();__LOG__(2)`syncd: requestAllMissingKeys: missing keys: [${e.map((e=>e.keyHex))}]`,0!==e.length&&(yield d(e.map((e=>e.keyId))))}))).apply(this,arguments)}},837:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearSyncKeysCache=function(){m=new Map},t.getActiveKey=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return y.enqueue((()=>S(e)))},t.getKeyData=function(){return C.apply(this,arguments)},t.getNewestKeyPair=v;var i=r(n(348926)),a=r(n(322762)),o=r(n(763105)),s=r(n(606162)),l=n(615688),c=n(927870),u=n(463109),d=n(353771),p=n(526442),f=n(113722),_=r(n(273407)),h=r(n(11339)),g=n(209108);let m=new Map;const y=new c.PromiseQueue;function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=yield v(),n=yield(0,g.getMyDeviceList)();const{currentIndex:r,devices:i,rawId:a}=n;if(null==r)throw new Error("syncd: missing current index for own device");n={currentIndex:r,deviceIndexes:i.map((e=>e.keyIndex)),rawId:a};const o=(0,f.hasKeyExpired)(t),s=(0,f.hasADeviceBeenRemoved)(t,n);return e&&(o||s)?(t=(0,f.rotateKey)(t,n),__LOG__(2)`syncd: stored key rotation key id ${(0,u.arrayBufferToHex)(t.keyId.buffer)}`,yield _.default.createSyncKey(t),yield(0,p.sendAppStateSyncKeyShare)({type:"key_rotation",keys:[t]}),o&&(__LOG__(2)`syncd: key rotation due to key expiry`,new h.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:h.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.APP_STATE_SYNC_KEY_EXPIRY}).commit()),s&&(__LOG__(2)`syncd: key rotation due to device removal`,new h.default.MdAppStateKeyRotation({mdAppStateKeyRotationReason:h.default.MD_APP_STATE_KEY_ROTATION_REASON_CODE.DEVICE_DEREGISTERATION}).commit()),S(e)):{keyId:t.keyId.buffer,keyData:t.keyData}}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=yield _.default.getAllSyncKeys(),t=(0,s.default)(e.map((e=>(0,d.getKeyEpoch)(e.keyId.buffer)))),n=(0,o.default)(e,(e=>(0,d.getKeyEpoch)(e.keyId.buffer)===t));return(0,a.default)(n,(e=>(0,d.getKeyDeviceId)(e.keyId.buffer)))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e){var t;let n=m.get((0,l.encodeB64)(e));return n?n.keyData:(n=yield _.default.getSyncKeyData(new Uint8Array(e)),n&&m.set((0,l.encodeB64)(e),n),null===(t=n)||void 0===t?void 0:t.keyData)}))).apply(this,arguments)}},604573:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPeerDevices=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(978820),o=n(745454),s=n(209108);function l(){return(l=(0,i.default)((function*(){const e=[],t=(0,a.assertGetMe)();try{(yield(0,s.getMyDeviceList)()).devices.forEach((n=>{n.id!==t.getDeviceId()&&e.push((0,o.createDeviceWidFromUserAndDevice)(t.user,t.server,n.id))}))}catch(e){return __LOG__(3,void 0,void 0,!0)`syncd: getPeerDevices: error ${e}. Future key requests will only be sent to primary device.`,SEND_LOGS(e.toString()),[(0,o.createDeviceWidFromUserAndDevice)(t.user,t.server,0)]}return e}))).apply(this,arguments)}},765031:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyRequest=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=n(463109),o=r(n(465212)),s=n(682514),l=n(978820),c=n(58597),u=r(n(11339)),d=n(17304),p=n(400238);function f(){return(f=(0,i.default)((function*(e,t){const n={keyIds:e.map((e=>({keyId:e})))},r=t.map((e=>{const t=new o.default({fromMe:!0,remote:(0,l.assertGetMeUser)(),id:o.default.newId()});return new d.Msg({id:t,to:e,type:"protocol",subtype:"app_state_sync_key_request",appStateSyncKeyRequest:n})})),i=t.map((e=>e.getDeviceId())),f=e.map((e=>(0,a.arrayBufferToHex)(e)));__LOG__(2)`syncd: send key request key id ${f} to peer deviceIds ${i}`,yield(0,p.storePeerMessages)(r),yield Promise.all(r.map(s.encryptAndSendKeyMsg)),(0,c.logCriticalBootstrapStageIfNecessary)(u.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MISSING_KEYS_REQUESTED)}))).apply(this,arguments)}},526442:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateSyncKeyShare=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(463109),o=r(n(465212)),s=n(682514),l=n(978820),c=n(604573),u=n(17304),d=n(400238);function p(){return(p=(0,i.default)((function*(e){let t,n;if("key_rotation"===e.type?(t=f(e.keys),n=yield(0,c.getPeerDevices)()):"missing_key"===e.type&&(t=f(e.keys,e.orphanKeys),n=[e.peerDeviceId]),null==n)return Promise.resolve();const r=n,i=r.map((e=>{const n=new o.default({fromMe:!0,remote:(0,l.assertGetMeUser)(),id:o.default.newId()});return new u.Msg({id:n,to:e,type:"protocol",subtype:"app_state_sync_key_share",appStateSyncKeyShare:t})})),p=r.map((e=>e.getDeviceId())),_=e.keys.map((e=>(0,a.arrayBufferToHex)(e.keyId.buffer)));__LOG__(2)`syncd: send key share key id ${_} to peer deviceIds ${p} due to ${e.type}`,yield(0,d.storePeerMessages)(i),yield Promise.all(i.map(s.encryptAndSendKeyMsg))}))).apply(this,arguments)}function f(e,t){let n=e.map((e=>({keyId:{keyId:e.keyId.buffer},keyData:{keyData:e.keyData,fingerprint:{rawId:e.fingerprint.rawId,currentIndex:e.fingerprint.currentIndex,deviceIndexes:e.fingerprint.deviceIndexes},timestamp:e.timestamp}})));if(t){const e=t.map((e=>({keyId:{keyId:e},keyData:void 0})));n=n.concat(e)}return{keys:n}}},793932:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMissingKeys=function(){return P.apply(this,arguments)},t.hasExpiredKeys=T,t.setMissingKeyTimeout=y,t.updateMissingKeyDevices=function(){return m.apply(this,arguments)},t.updateMissingKeys=function(e,t){const n=t.getDeviceId(),r=[],a=[];return e.forEach((e=>{const t=e.keyData,n=(0,s.arrayBufferToHex)(e.keyId);t?r.push(n):a.push(n)})),__LOG__(2)`syncd: updateMissingKeys from device ${n}
\tkeys with keyData: ${r}
\tkeys without keyData: ${a}`,(0,h.getStorage)().lock(["missing-keys"],function(){var e=(0,i.default)((function*(){if(r.length>0&&(yield u.default.bulkRemoveMissingKeys(r),yield y()),a.length>0){const e=(yield u.default.bulkGetMissingKeys(a)).filter(Boolean);e.forEach((e=>e.deviceResponses.set(n,!1))),__LOG__(2)`syncd: updateMissingKeys: begin updating missing keys from device ${n}
\tmissingKeys: [${a}]`,yield u.default.createOrUpdateMissingKeys(e),__LOG__(2)`syncd: updateMissingKeys: finish updating missing keys from device ${n}`,yield A()}}));return function(){return e.apply(this,arguments)}}())};var i=r(n(348926)),a=r(n(322762)),o=n(352613),s=n(463109),l=n(892844),c=n(604573),u=r(n(273407)),d=n(768254),p=n(801116),f=r(n(11339)),_=n(964551),h=n(799069);let g;function m(){return(m=(0,i.default)((function*(){const e=(yield(0,c.getPeerDevices)()).map((e=>e.getDeviceId()));return(0,h.getStorage)().lock(["missing-keys"],function(){var t=(0,i.default)((function*(){const t=yield u.default.getAllMissingKeys();if(0===t.length)return Promise.resolve();t.forEach((t=>{t.deviceResponses.forEach(((n,r)=>{e.includes(r)||t.deviceResponses.delete(r)}))})),yield u.default.createOrUpdateMissingKeys(t),yield A()}));return function(){return t.apply(this,arguments)}}())}))).apply(this,arguments)}function y(){return S.apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){clearTimeout(g),g=null;const e=yield u.default.getAllMissingKeys();if(0===e.length)return;__LOG__(2)`syncd: _setMissingKeyTimeout: missing keys: ${e.map((e=>(0,s.arrayBufferToHex)(e.keyId)))}`;const t=(0,a.default)(e,(e=>e.timestamp)),n=_.ServerProps.syncdWaitForKeyTimeoutDays*l.DAY_MILLISECONDS-(-t.timestamp+(0,l.unixTimeMs)());__LOG__(2)`syncd: earliest missing key: ${(0,s.arrayBufferToHex)(t.keyId)}, timestamp=${t.timestamp}, timeoutMs=${n}`,g=setTimeout(E,n)}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){__LOG__(2)`syncd: _timeoutWhileWaitingForMissingKey`,(yield T())?((0,p.uploadFatalErrorMetric)(f.default.MD_SYNCD_FATAL_ERROR_CODE.TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY,null),__LOG__(4,void 0,new Error,!0)`syncd: fatal error: timeout while waiting for missing key`,SEND_LOGS("syncd fatal error: timeout while waiting for missing key"),(0,d.handleFatalError)()):__LOG__(2)`syncd: _timeoutWhileWaitingForMissingKey: no expired keys`}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){__LOG__(2)`syncd: check if has expired keys`;const e=(yield u.default.getAllSyncKeys()).map((e=>(0,s.arrayBufferToHex)(e.keyId.buffer)));__LOG__(2)`syncd: all keys: ${e}`;const t=yield u.default.getAllMissingKeys();__LOG__(2)`syncd: missing keys: ${t.map((e=>(0,s.arrayBufferToHex)(e.keyId)))}`;const n=t.filter((t=>!e.includes(t.keyHex)));__LOG__(2)`syncd: actually missing keys: ${t.map((e=>(0,s.arrayBufferToHex)(e.keyId)))}`;const r=n.filter((e=>_.ServerProps.syncdWaitForKeyTimeoutDays*l.DAY_MILLISECONDS<(0,l.unixTimeMs)()-e.timestamp));return __LOG__(2)`syncd: expired keys: ${r.map((e=>(0,s.arrayBufferToHex)(e.keyId)))}`,r.length>0}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,i.default)((function*(){const e=yield u.default.getAllMissingKeys();for(const t of e){let e=!0;for(const n of t.deviceResponses.values())if(null==n){e=!1;break}if(e)return __LOG__(4,void 0,new Error,!0)`syncd: fatal error: missing key on all clients`,SEND_LOGS("syncd: fatal error: missing key on all clients"),(0,p.uploadFatalErrorMetric)(f.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_KEY_ON_ALL_CLIENTS,null),yield(0,o.asyncSleep)(5e3),void(0,d.handleFatalError)()}}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(e,t){const n=()=>{const e=new Map;return t.forEach((t=>e.set(t,null))),e},r=e.map((e=>({keyHex:(0,s.arrayBufferToHex)(e),keyId:e,timestamp:(0,l.unixTimeMs)(),deviceResponses:n()})));yield u.default.createOrUpdateMissingKeys(r),yield y()}))).apply(this,arguments)}},113722:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.hasADeviceBeenRemoved=function(e,t){const n=e.fingerprint,{rawId:r,currentIndex:a,deviceIndexes:o}=t,s=new Set(n.deviceIndexes);for(let e=n.currentIndex+1;e<=a;e++)s.add(e);return n.rawId!==r||!(0,i.default)(s,new Set(o))},t.hasKeyExpired=function(e){const t=e.timestamp,n=Math.min(90,Math.max(1,u.ServerProps.syncdKeyMaxUseDays));return(0,l.unixTimeMs)()-t>n*l.DAY_MILLISECONDS},t.rotateKey=function(e,t){const{keyId:n,keyEpoch:r}=function(e){const t=(0,s.getKeyEpoch)(e.keyId.buffer)+1,n=(0,c.assertGetMe)().getDeviceId();return{keyId:new Uint8Array((0,a.concatArrayBuffers)((0,o.intToBytes)(2,n).buffer,(0,o.intToBytes)(4,t).buffer)),keyEpoch:t}}(e),i=self.crypto.getRandomValues(new Uint8Array(32)).buffer,u=function(e){const{currentIndex:t,deviceIndexes:n,rawId:r}=e;return{rawId:r,currentIndex:t,deviceIndexes:n}}(t),d=(0,l.unixTimeMs)();return{keyId:n,keyEpoch:r,keyData:i,fingerprint:u,timestamp:d}};var i=r(n(618446)),a=n(832428),o=n(51239),s=n(353771),l=n(892844),c=n(978820),u=n(964551)},768254:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.handleFatalError=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=(n(960362),n(781572)),o=n(257243),s=n(765044),l=n(788950),c=n(613983),u=n(289751),d=n(352613);function p(){return(p=(0,i.default)((function*(e){__LOG__(2)`syncd: starting fatal flow for ${e}`;const t=(0,o.getABPropConfigValue)("should_deregister_on_syncd_fatal"),r=n(595023).default;let i=[];null!=e&&(i=e.map((e=>String(e)))),yield(0,d.asyncSleep)(5e3),__LOG__(2)`syncd: start notifying primary on fatal error`;try{yield(0,c.sendAppStateFatalExceptionNotification)(i)}catch(e){__LOG__(4,void 0,new Error,!0)`syncd: error when sending fatal message to primary: ${e}`,SEND_LOGS("syncd: could not send fatal to primary")}__LOG__(2)`syncd: end notifying primary on fatal error`,!1!==t?(__LOG__(4,!0,new Error)`syncd: Received fatal error and logged out`,s.Socket.logout(!1,l.LogoutReason.SyncdFailure)):r.isSyncDCriticalDataSyncInProcess()?(__LOG__(4,!0,new Error,!0)`syncd: critical sync failed during bootstrap`,SEND_LOGS("syncd: critical sync failed during bootstrap"),s.Socket.logout(!1,l.LogoutReason.SyncdErrorDuringBootstrap)):(__LOG__(4,!0,new Error)`syncd: Received fatal error and showed fatal flag`,(0,u.updateSyncdDisabledDueToFatalFlag)(!0),a.Cmd.handleFatalError())}))).apply(this,arguments)}},613983:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendAppStateFatalExceptionNotification=function(){return p.apply(this,arguments)};var i=r(n(348926)),a=n(892844),o=r(n(465212)),s=n(682514),l=n(978820),c=n(745454),u=n(17304),d=n(400238);function p(){return(p=(0,i.default)((function*(e){const t={collectionNames:e,timestamp:(0,a.unixTimeMs)()},n=new o.default({fromMe:!0,remote:(0,l.getMeUser)(),id:o.default.newId()}),r=new u.Msg({id:n,to:(0,c.createDeviceWidFromUserAndDevice)((0,l.assertGetMe)().user,(0,l.assertGetMe)().server,0),type:"protocol",subtype:"app_state_fatal_exception_notification",appStateFatalExceptionNotification:t});return yield(0,d.storePeerMessages)([r]),(0,s.encryptAndSendKeyMsg)(r)}))).apply(this,arguments)}},519001:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleMissingSyncKeys=t.getSyncKeyData=t.getSyncActiveKey=void 0;var r=n(284051),i=n(837);const a=i.getActiveKey;t.getSyncActiveKey=a;const o=i.getKeyData;t.getSyncKeyData=o;const s=r.handleMissingKeys;t.handleMissingSyncKeys=s},773490:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadSyncExternalPatch=t.downloadSyncBlob=void 0;var a=i(n(81109)),o=i(n(348926)),s=n(615688),l=n(266313),c=n(801116),u=n(826384),d=n(727856),p=i(n(154824)),f=i(n(11339));t.uploadSyncExternalPatch=e=>p.default.encryptAndUpload({blob:e,signal:(new r).signal,type:"md-app-state",uploadOrigin:f.default.UPLOAD_ORIGIN_TYPE.UNKNOWN,userUploadAttemptCount:0,forwardedFromWeb:!1,isViewOnce:!1});const _=function(){var e=(0,o.default)((function*(e,t,n){const{mediaKey:i,directPath:o,fileSha256:p,fileEncSha256:_}=e,h={directPath:o,encFilehash:(0,s.encodeB64)(_),filehash:(0,s.encodeB64)(p),mediaKey:(0,s.encodeB64)(i),type:"md-app-state",userDownloadAttemptCount:0};try{return yield u.downloadManager.downloadAndDecrypt((0,a.default)({signal:(new r).signal},h))}catch(r){if(__LOG__(2)`syncd: error downloading ${t} of expected size ${e.fileSizeBytes} with expected hash b64 length of ${(0,s.encodeB64)(e.fileEncSha256).length} for collection ${n}`,r instanceof d.MediaNotFoundError)throw(0,c.uploadFatalErrorMetric)("patch"===t?f.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_PATCH_EXPIRED:f.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_EXPIRED,n),new l.SyncdFatalError("external patch expired");throw r}}));return function(){return e.apply(this,arguments)}}();t.downloadSyncBlob=_},837933:(e,t,n)=>{"use strict";var r=n(595318);t.Z=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(836229),o=n(960362),s=r(n(740108)),l=r(n(273407));function c(){return(c=(0,i.default)((function*(){const e=yield s.default.getSentinelMutations();return yield l.default.appendPendingMutationsRows(e),(0,a.markCollectionsForSync)(Array.from(o.CollectionName.members()))}))).apply(this,arguments)}},238804:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SYNCD_INTERNAL_TABLES_TO_LOCK=void 0,t.initialize=function(){if((0,l.isMDBackend)())return(0,s.isSyncdDisabled)()?Promise.resolve():(function(){const e=6e4,t=(0,o.default)(E.reportWam,e,{maxWait:3*e});g.Cmd.on(g.APP_STATE_SYNC_COMPLETED,t)}(),T(),u.default.loadStatesFromDb().then((()=>(0,E.stateMachineTick)())));return Promise.reject(new Error("This call is only supported in MD mode"))},t.lockForSync=function(e,t,n){const r=(0,f.getStorage)().lock([...e,...v],(e=>Promise.all([p.default.appendPendingMutationsRows(t),n(e)]))).then((()=>{const e=t.map((e=>e.collection));(0,E.markCollectionsForSync)(e)}));return Promise.resolve(r)},t.sanitizeActionInSyncActionsRow=T;var i=r(n(81109)),a=r(n(348926)),o=r(n(23279)),s=n(900669),l=n(88555),c=n(41007),u=r(n(611634)),d=n(960362),p=r(n(273407)),f=n(799069),_=r(n(312523)),h=n(134719),g=n(781572),m=n(776214),y=n(711597),S=n(608080),E=n(836229);const v=["pending-mutations"];function T(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(){if(!(0,y.getMdSyncActionsActionSanitized)()){__LOG__(2)`syncd: sanitizing null 'action' property in sync-actions table`;const e=(yield(0,m.getSyncActionsTable)().all()).filter((e=>null==e.action)).map((e=>{const t=JSON.parse(e.index)[0];return d.Actions.cast(t)?(0,i.default)((0,i.default)({},e),{},{action:t}):(__LOG__(2)`syncd: invalid action ${t}`,(0,i.default)({},e))}));yield(0,c.bulkUpdateSyncActionsInTransaction)(e),(0,y.setMdSyncActionsActionSanitized)(!0)}}))).apply(this,arguments)}t.SYNCD_INTERNAL_TABLES_TO_LOCK=v,(0,_.default)(S.Stream,"change:mode",(()=>S.Stream.mode===S.StreamMode.MAIN)).then((()=>{(0,l.isMDBackend)()&&!(0,s.isSyncdDisabled)()&&((0,h.applyAllOrphansAndUnsupported)(),__LOG__(2)`syncd: syncing pending mutations and blocked collections due to app resume`,(0,E.syncPendingMutationsAndBlockedCollections)())}))},289751:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateSyncdDisabledDueToFatalFlag=function(e){(0,i.default)(a.default,"localStorage").setItem(o.KEYS.SYNCD_DISABLED_DUE_TO_FATAL,e.toString())};var i=r(n(145095)),a=r(n(904285)),o=n(546718)},205195:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyncdQPL=void 0;var i=r(n(81109)),a=n(266543),o=n(451897),s=n(549334),l=n(665397),c=n(669393);const u=["source"];function d(e){if(null==(null==e?void 0:e.string))return;const t=e.string,n={};Object.keys(e.string).forEach((e=>{u.includes(e)||(n[e]=t[e])})),e.string=n}t.SyncdQPL=class{constructor(){this._when=n(595023).default.isSyncDBootstrapInProcess()?"bootstrap":n(528237).OfflineMessageHandler.isResumeFromRestartComplete()?"online":"offline_resume",this._loggingEnabled=(0,a.getConfig)().syncdQPLLoggingEnabled()&&("bootstrap"===this._when||"offline_resume"===this._when),this._loggingEnabled&&(this._instanceKey=c.QPL.getNextMarkerInstanceValue(l.QuickLogMarkerId.SYNCD))}_validate(){if(!this._loggingEnabled)return!1;if(!this._started)throw new Error("QPL instance ${this._instanceKey} is not started");return!0}start(){this._loggingEnabled&&(c.QPL.markerStart(l.QuickLogMarkerId.SYNCD,{instanceKey:this._instanceKey}),this._started=!0,this.annotate({when:this._when}))}annotate(e){if(!this._validate())return;const t=(0,s.constructAnnotationsFromContext)(e);d(t),t&&c.QPL.markerAnnotate(l.QuickLogMarkerId.SYNCD,t,{instanceKey:this._instanceKey})}mark(e,t){if(!this._validate())return;const n=(0,s.constructAnnotationsFromContext)(t);this._markInternal(e,n)}markAnnotations(e,t){this._validate()&&this._markInternal(e,t)}_markInternal(e,t){const n=function(e,t){var n;if(null==(null==t||null===(n=t.string)||void 0===n?void 0:n.source))return e;const r=t.string;return[Object.keys(r).filter((e=>u.includes(e))).map((e=>r[e])),e].join("_")}(e,t);d(t),c.QPL.markerPoint(l.QuickLogMarkerId.SYNCD,n,(0,i.default)((0,i.default)({},t&&{data:t}),{},{instanceKey:this._instanceKey}))}end(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._validate()&&(this._started=!1,c.QPL.markerEnd(l.QuickLogMarkerId.SYNCD,e?o.QuickLogActionType.FAIL:o.QuickLogActionType.SUCCESS,{instanceKey:this._instanceKey}))}}},293824:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.collectionNameToMetric=u,t.constructMsgKeySegments=s,t.constructMuteChatKey=function(e){return JSON.stringify([i.Actions.Mute,e.id.remote.toString({legacy:!0})])},t.constructPinChatKey=function(e){return JSON.stringify([i.Actions.Pin,e.id.remote.toString({legacy:!0})])},t.constructStarMsgKey=function(e){return JSON.stringify([i.Actions.Star,...s(e)])},t.constructStarMsgKeyFromMsgKey=function(e){return JSON.stringify([i.Actions.Star,...l(e)])},t.extractParticipantForSync=c,t.getMsgKeyFromStarActionIndex=function(e){const t=JSON.parse(e);if(t.length<5)throw new Error("[sync-action] star action index malformed, cannot create MsgKey");const n=(0,a.syncKeyToMsgKey)(t[1],t[2],t[3],t[4]);if(!n)throw __LOG__(3)`[sync-action] star action index data is malformed, , cannot create MsgKey`,new Error("[sync-action] star action index data is malformed, , cannot create MsgKey");return n},t.uploadCriticalEventMetric=function(e,t){const n=new o.default.MdCriticalEvent({mdCriticalEventCode:e});null!=t&&(n.collection=u(t));n.commit()};var i=n(960362),a=n(122954),o=r(n(11339));function s(e){return l(e.id)}function l(e){const t=c(e);return[e.remote.toString({legacy:!0}),e.id,e.fromMe?"1":"0",t]}function c(e){let t="0";return!e.participant||e.remote.isUser()||e.fromMe||(t=e.participant.toString({legacy:!0})),t}function u(e){switch(e){case i.CollectionName.CriticalBlock:return o.default.COLLECTION.CRITICAL_BLOCK;case i.CollectionName.CriticalUnblockLow:return o.default.COLLECTION.CRITICAL_UNBLOCK_LOW;case i.CollectionName.Regular:return o.default.COLLECTION.REGULAR;case i.CollectionName.RegularHigh:return o.default.COLLECTION.REGULAR_HIGH;case i.CollectionName.RegularLow:return o.default.COLLECTION.REGULAR_LOW}}},101374:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.genCurrentSessionId=function(){return p.apply(this,arguments)},t.genSessionId=f;var i=r(n(348926)),a=n(108584),o=n(273045),s=r(n(145095)),l=n(138062),c=n(978820),u=n(572841),d=r(n(876883));function p(){return(p=(0,i.default)((function*(){const e=(0,u.createSignalAddress)((0,c.getMeUser)()).toString(),t=(0,s.default)(yield d.default.loadIdentityKey(e),"yield PersistSignalProtocolStore.loadIdentityKey(primaryDeviceIdentifier)"),n=(0,l.toCurveKeyPubKey)((0,u.strToBuffer)(t)),r=(0,s.default)(yield d.default.getIdentityKeyPair(),"yield SignalProtocolStore.getIdentityKeyPair()");return f(n,(0,l.toCurveKeyPubKey)(r.pubKey))}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t){if(32!==e.byteLength)throw new Error(`genSessionId: primary identity public key is ${e.byteLength} bytes, should be 32!`);if(32!==t.byteLength)throw new Error(`genSessionId: companion identity public key is ${e.byteLength} bytes, should be 32!`);const n=new a.Binary;n.writeBuffer(e),n.write("_".charCodeAt(0)),n.writeBuffer(t);const r=n.readByteArray();return yield(0,o.sha256Base64)(r)}))).apply(this,arguments)}},388432:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.STORAGE_QUOTA_UNAVAILABLE=t.MdSyncFieldStatsMeta=void 0;var i=r(n(348926)),a=n(101374),o=r(n(963236));t.STORAGE_QUOTA_UNAVAILABLE=-1;const s=new class{constructor(){this._storageEstimation={mdStorageQuotaBytes:-2,mdStorageQuotaUsedBytes:-2},this._mdSessionId=null}getStorageEstimation(){var e=this;return(0,i.default)((function*(){if(-2!==e._storageEstimation.mdStorageQuotaBytes)return Promise.resolve(e._storageEstimation);const t=yield(0,o.default)();return e._storageEstimation={mdStorageQuotaBytes:t?t.quota:-1,mdStorageQuotaUsedBytes:t?t.usage:-1},e._storageEstimation}))()}getMdSessionId(){var e=this;return(0,i.default)((function*(){return null!=e._mdSessionId||(e._mdSessionId=yield(0,a.genCurrentSessionId)()),e._mdSessionId}))()}};t.MdSyncFieldStatsMeta=s},801116:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFatalErrorMetric=function(e,t,r,p){const f=n(595023).default;let _={mdFatalErrorCode:e,collection:t?(0,o.collectionNameToMetric)(t):void 0,isBootstrap:f.isSyncDCriticalDataSyncInProcess()};if((0,s.getABPropConfigValue)("md_app_state_gate_D34336913")){const e=(0,l.getPairingTimestamp)(),t=null!=e?1e3*((0,c.unixTime)()-e):void 0;_=(0,i.default)((0,i.default)({},_),{},{timeSinceRefreshMs:1e3*((0,c.unixTime)()-d),timeSincePairingMs:t,patchSnapshotMutationCount:r,patchVersion:p})}if((0,s.getABPropConfigValue)("web_syncd_fatal_fields_from_L1104589PRV2")){const e=(0,l.getRecentMailboxAgeDays)(),t=(0,l.getLastPeriodicAppStateSyncTs)(),n=u.default.getCollectionMinFailureTime();_=(0,i.default)((0,i.default)({},_),{},{mailboxAgeDays:null==e?void 0:e,daysSinceLastPeriodicSync:null==t?void 0:Math.trunc(((0,c.unixTime)()-t)/60/60/24),hoursSinceFirstFiniteFailure:null==n?void 0:Math.trunc(((0,c.unixTimeMs)()-n)/1e3/60/60)})}new a.default.MdFatalError(_).commit(!0)};var i=r(n(81109)),a=r(n(11339)),o=(n(960362),n(293824)),s=n(257243),l=n(711597),c=n(892844),u=r(n(611634));const d=(0,c.unixTime)()},435047:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.convertToBucket=function(e){if(e<0)throw new Error("cannot convert negative number to a bucket");return 0===e?o.default.MUTATION_COUNT_BUCKET.ZERO:1===e?o.default.MUTATION_COUNT_BUCKET.ONE:e<10?o.default.MUTATION_COUNT_BUCKET.LT10:e<100?o.default.MUTATION_COUNT_BUCKET.LT100:e<500?o.default.MUTATION_COUNT_BUCKET.LT500:e<1e3?o.default.MUTATION_COUNT_BUCKET.LT1K:e<5e3?o.default.MUTATION_COUNT_BUCKET.LT5K:o.default.MUTATION_COUNT_BUCKET.GTE5K},t.generateActionStatCounts=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(960362),o=r(n(11339)),s=n(134296);function l(){return(l=(0,i.default)((function*(){const e=new Map;return(yield(0,s.getTable)().all()).map((t=>{var n;const r=JSON.parse(t.index)[0],i=null!==(n=e.get(r))&&void 0!==n?n:{action:r,applied:0,invalid:0,orphan:0,unsupported:0,failed:0};switch(t.actionState){case a.SyncActionState.Success:case a.SyncActionState.Skipped:i.applied++;break;case a.SyncActionState.Malformed:i.invalid++;break;case a.SyncActionState.Orphan:i.orphan++;break;case a.SyncActionState.Unsupported:i.unsupported++;break;case a.SyncActionState.Failed:i.failed++}e.set(r,i)})),e}))).apply(this,arguments)}},682827:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyStats=function(){return v.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=(n(257243),n(227101)),s=n(408139),l=n(410945),c=n(555452),u=n(134898),d=n(978820),p=(n(711597),r(n(963236))),f=n(728307),_=n(555975),h=r(n(11339)),g=n(407595),m=n(966423),y=n(776214),S=n(575861);function E(e){const t=e.getEndTime();(e.goldenBoxContactNarrativeAppearCount>0||e.goldenBoxContactDialogAppearCount>0||e.goldenBoxContactDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.GOLDEN_BOX_CONTACT,narrativeAppearCount:e.goldenBoxContactNarrativeAppearCount,dialogAppearCount:e.goldenBoxContactDialogAppearCount,dialogSelectCount:e.goldenBoxContactDialogSelectCount}).commit(),(e.goldenBoxGroupNarrativeAppearCount>0||e.goldenBoxGroupDialogAppearCount>0||e.goldenBoxGroupDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.GOLDEN_BOX_GROUP,narrativeAppearCount:e.goldenBoxGroupNarrativeAppearCount,dialogAppearCount:e.goldenBoxGroupDialogAppearCount,dialogSelectCount:e.goldenBoxGroupDialogSelectCount}).commit(),(e.infoScreenContactNarrativeAppearCount>0||e.infoScreenContactDialogAppearCount>0||e.infoScreenContactDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.INFO_SCREEN_CONTACT,narrativeAppearCount:e.infoScreenContactNarrativeAppearCount,dialogAppearCount:e.infoScreenContactDialogAppearCount,dialogSelectCount:e.infoScreenContactDialogSelectCount}).commit(),(e.infoScreenGroupNarrativeAppearCount>0||e.infoScreenGroupDialogAppearCount>0||e.infoScreenGroupDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.INFO_SCREEN_GROUP,narrativeAppearCount:e.infoScreenGroupNarrativeAppearCount,dialogAppearCount:e.infoScreenGroupDialogAppearCount,dialogSelectCount:e.infoScreenGroupDialogSelectCount}).commit(),(e.chatsListNarrativeAppearCount>0||e.chatsListDialogAppearCount>0||e.chatsListDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.CHATS_LIST,narrativeAppearCount:e.chatsListNarrativeAppearCount,dialogAppearCount:e.chatsListDialogAppearCount,dialogSelectCount:e.chatsListDialogSelectCount}).commit(),(e.statusListNarrativeAppearCount>0||e.statusListDialogAppearCount>0||e.statusListDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.STATUS_LIST,narrativeAppearCount:e.statusListNarrativeAppearCount,dialogAppearCount:e.statusListDialogAppearCount,dialogSelectCount:e.statusListDialogSelectCount}).commit(),(e.callingScreenAudioNarrativeAppearCount>0||e.callingScreenAudioDialogAppearCount>0||e.callingScreenAudioDialogSelectCount>0)&&new h.default.PrivacyHighlightDaily({eventTime:t,privacyHighlightCategory:h.default.PRIVACY_HIGHLIGHT_CATEGORY_ENUM.E2EE,privacyHighlightSurface:h.default.PRIVACY_HIGHLIGHT_SURFACE_ENUM.CALLING_SCREEN_AUDIO,narrativeAppearCount:e.callingScreenAudioNarrativeAppearCount,dialogAppearCount:e.callingScreenAudioDialogAppearCount,dialogSelectCount:e.callingScreenAudioDialogSelectCount}).commit()}function v(){return(v=(0,a.default)((function*(){const e=T(),t=yield C(),n=yield O(),r=I(),a=(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},e),t),n),r),o=new h.default.Daily;o.set(a),o.commit(),(0,g.logDailyPrivateStatsTestEvents)();const s=m.DailyAggregatedStatsCollection.toArray().filter((e=>e.shouldBeSubmitted()));m.DailyAggregatedStatsCollection.remove(s),s.forEach((e=>{new h.default.PttDaily({eventTime:e.getEndTime(),pttCancelBroadcast:e.pttCancelBroadcast,pttCancelGroup:e.pttCancelGroup,pttCancelIndividual:e.pttCancelIndividual,pttDraftReviewBroadcast:e.pttDraftReviewBroadcast,pttDraftReviewGroup:e.pttDraftReviewGroup,pttDraftReviewIndividual:e.pttDraftReviewIndividual,pttFastplaybackBroadcast:e.pttFastplaybackBroadcast,pttFastplaybackGroup:e.pttFastplaybackGroup,pttFastplaybackIndividual:e.pttFastplaybackIndividual,pttLockBroadcast:e.pttLockBroadcast,pttLockGroup:e.pttLockGroup,pttLockIndividual:e.pttLockIndividual,pttOutOfChatBroadcast:e.pttOutOfChatBroadcast,pttOutOfChatGroup:e.pttOutOfChatGroup,pttOutOfChatIndividual:e.pttOutOfChatIndividual,pttPlaybackBroadcast:e.pttPlaybackBroadcast,pttPlaybackGroup:e.pttPlaybackGroup,pttPlaybackIndividual:e.pttPlaybackIndividual,pttRecordBroadcast:e.pttRecordBroadcast,pttRecordGroup:e.pttRecordGroup,pttRecordIndividual:e.pttRecordIndividual,pttSendBroadcast:e.pttSendBroadcast,pttSendGroup:e.pttSendGroup,pttSendIndividual:e.pttSendIndividual,pttPausedRecordBroadcast:e.pttPausedRecordBroadcast,pttPausedRecordGroup:e.pttPausedRecordGroup,pttPausedRecordIndividual:e.pttPausedRecordIndividual,pttStopTapBroadcast:e.pttStopTapBroadcast,pttStopTapGroup:e.pttStopTapGroup,pttStopTapIndividual:e.pttStopTapIndividual}).commit(),E(e),new h.default.CommunityTabAction({communityTabGroupNavigations:e.communityTabGroupNavigations,communityTabToHomeViews:e.communityTabToHomeViews,communityTabViews:e.communityTabViews}).commit(),null!=e.communityHome&&Object.keys(e.communityHome).forEach((t=>{const{communityHomeGroupDiscoveries:n,communityHomeGroupJoins:r,communityHomeGroupNavigations:i,communityHomeViews:a}=e.communityHome[t];new h.default.CommunityHomeAction({communityHomeId:t,communityHomeGroupDiscoveries:n,communityHomeGroupJoins:r,communityHomeGroupNavigations:i,communityHomeViews:a}).commit()})),new h.default.KeepInChatNotif({eventTime:e.getEndTime(),groupMessageNotificationTaps:e.groupMessageNotificationTaps,groupMessageNotifications:e.groupMessageNotifications,kicGroupNotificationTaps:e.kicGroupNotificationTaps,kicGroupNotifications:e.kicGroupNotifications,kicNotificationTaps:e.kicNotificationTaps,kicNotifications:e.kicNotifications,totalNotificationTaps:e.totalNotificationTaps,totalNotifications:e.totalNotifications,userMessageNotificationTaps:e.userMessageNotificationTaps,userMessageNotifications:e.userMessageNotifications}).commit()}))}))).apply(this,arguments)}function T(){const e=u.deviceInfo.get();return{languageCode:e.lg,locationCode:e.lc,osBuildNumber:e.osBuild,simMcc:parseInt(e.mcc,10),simMnc:parseInt(e.mnc,10)}}function C(){return A.apply(this,arguments)}function A(){return(A=(0,a.default)((function*(){const e=(0,c.getUserPrivacySettings)(),t={receiptsEnabled:"none"!==e.readReceipts};if((0,s.privacySettingsEnabled)()){var n,r,i,a;const o=yield(0,S.queryDisallowedLists)();t.privacySettingsAbout=b(e.about),t.privacySettingsAboutExceptNum="contact_blacklist"===e.about?P(null===(n=o.status)||void 0===n?void 0:n.disallowedList.length):null,t.privacySettingsGroups=b(e.groupAdd),t.privacySettingsGroupsExceptNum="contact_blacklist"===e.groupAdd?P(null===(r=o.groupadd)||void 0===r?void 0:r.disallowedList.length):null,t.privacySettingsLastSeen=b(e.lastSeen),t.privacySettingsLastSeenExceptNum="contact_blacklist"===e.lastSeen?P(null===(i=o.last)||void 0===i?void 0:i.disallowedList.length):null,t.privacySettingsProfilePhoto=b(e.profilePicture),t.privacySettingsProfilePhotoExceptNum="contact_blacklist"===e.profilePicture?P(null===(a=o.profile)||void 0===a?void 0:a.disallowedList.length):null}if((0,o.isDisappearingModeEnabled)()){var l;const e=(0,d.getMaybeMeUser)(),n=(0,f.getDisappearingModeSettingForUser)(e);t.defaultDisappearingDuration=null!==(l=null==n?void 0:n.duration)&&void 0!==l?l:0}return t}))).apply(this,arguments)}function b(e){if(null==e)return null;switch(e){case"all":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.EVERYONE;case"contacts":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS;case"contact_blacklist":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.MY_CONTACTS_EXCEPT;case"none":return h.default.PRIVACY_SETTINGS_VALUE_TYPE.NOBODY}}function P(e){return null==e?null:0===e?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B0:e<5?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B1:e<10?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B5:e<15?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B10:e<20?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B15:e<30?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B20:e<40?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B30:e<50?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B40:e<60?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B50:e<70?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B60:e<80?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B70:e<90?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B80:e<100?h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B90:h.default.PRIVACY_SETTINGS_CONTACTS_BUCKETS.B100}function O(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(){const e=yield(0,y.getContactTable)().equals(["isAddressBookContact"],1).then((e=>e.length)),t=yield(0,p.default)(),n=yield _.LruMediaStore.count(),r=yield Promise.all([t,e,n]);let i=0,a=0;const o=r[0];return null!=o&&(i=o.available,a=o.quota),{addressbookWhatsappSize:w(r[1],10),storageAvailSize:w(i,100),storageTotalSize:w(a,100),mediaFolderFileCount:r[2]}}))).apply(this,arguments)}function I(){let e=h.default.NOTIFICATION_SETTING_TYPE.UNKNOWN;if(null!=window.Notification)switch(window.Notification.permission){case l.PERMISSION_ALLOWED:e=h.default.NOTIFICATION_SETTING_TYPE.ALLOWED;break;case l.PERMISSION_DENIED:e=h.default.NOTIFICATION_SETTING_TYPE.BLOCKED;break;default:e=h.default.NOTIFICATION_SETTING_TYPE.UNKNOWN}return{osNotificationSetting:e}}function w(e,t){return Math.round(e/t)*t}},757936:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.registerTasks=function(){if((0,d.isLegacyWebdBackend)())return;(0,o.startScheduler)({scheduledTimeResolver:{get:e=>(0,M.getTaskScheduledTime)(String(e)),set:(e,t)=>(0,M.updateTaskScheduledTime)(String(e),t)}}),w.filter((e=>e!==I.LOG_DB_ROW_COUNTS||!1)).forEach((e=>{const t=function(e){switch(e){case I.MONITOR_DB_STORAGE:return function(){var e=(0,i.default)((function*(){return o.DO_NOT_RESCHEDULE}));return function(){return e.apply(this,arguments)}}();case I.CLEAN_TC_TOKENS:return function(){var e=(0,i.default)((function*(e){if(e)__LOG__(2)`CleanTcToken skip first run`;else try{yield(0,A.pruneExpiredTcTokens)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired TcTokens with error: ${e}`}return s.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case I.LOG_DAILY_STATS:return()=>(0,T.logDailyStats)().catch((e=>{__LOG__(4,!0,new Error)`Failed to log daily stats: ${e}`})).then((()=>s.DAY_SECONDS));case I.LOG_DB_ROW_COUNTS:break;case I.ROTATE_KEY:return function(){var e=(0,i.default)((function*(e){return e?__LOG__(2)`RotateKeyTask skip first run`:yield(0,h.getJobManager)().waitUntilCompleted(_.jobSerializers.rotateKey()),27*s.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case I.SYNC_AB_PROPS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,u.syncABPropsTask)()),(0,c.getRefresh)()}));return function(){return e.apply(this,arguments)}}();case I.SYNC_CONTACTS:return function(){var e=(0,i.default)((function*(e){if(!e){try{yield(0,f.getNonAddressBookContactsAndMarkAllContactsDirty)()}catch(e){__LOG__(4,!0,new Error)`Failed to sync non-address book contacts with error: ${e}`}try{yield(0,C.contactSync)()}catch(e){__LOG__(4,!0,new Error,!0,["non-sad","contact-sync"])`syncContacts: contact sync failed, error: ${e}`,SEND_LOGS("syncContacts: contact sync failed")}}return(0,y.getContactSyncRefreshSeconds)()}));return function(){return e.apply(this,arguments)}}();case I.REPORT_SYNCD_ACTION_STAT:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,S.reportSyncdStatsJob)()),s.DAY_SECONDS}));return function(){return e.apply(this,arguments)}}();case I.LT_HASH_CHECK:return function(){var e=(0,i.default)((function*(e){const t=(0,l.getABPropConfigValue)("lthash_check_hours");return 0===t?24*s.HOUR_SECONDS:(e||(yield(0,a.checkLtHash)()),t*s.HOUR_SECONDS)}));return function(){return e.apply(this,arguments)}}();case I.REQUEST_ALL_SYNCD_MISSING_KEYS:return function(){var e=(0,i.default)((function*(e){return e||(yield(0,E.requestAllSyncdMissingKeysJob)()),6*s.HOUR_SECONDS}));return function(){return e.apply(this,arguments)}}();case I.SYNCD_SYNC_ALL_COLLECTIONS:return function(){var e=(0,i.default)((function*(e){const t=(0,l.getABPropConfigValue)("syncd_periodic_sync_days");return 0===t?(__LOG__(2)`syncd: syncdPeriodicSyncDays is 0, skipping sync`,s.DAY_SECONDS):(e||(yield(0,v.syncdSyncAllCollectionsJob)()),s.DAY_SECONDS*t)}));return function(){return e.apply(this,arguments)}}();case I.CLEAN_ORPHAN_REACTIONS:return(0,i.default)((function*(){if(!(0,p.receiveReactionsEnabled)())return s.DAY_SECONDS;try{yield(0,O.pruneExpiredOrphanReactions)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired orphan reactions with error: ${e}`}return s.DAY_SECONDS}));case I.CLEAN_ORPHAN_ADD_ONS:return(0,i.default)((function*(){if(!(0,g.isPollsReceivingEnabled)())return s.DAY_SECONDS;try{yield(0,b.purgeExpiredOrphanRecords)(30,90)}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired orphan add-on messages with error: ${e}`}return s.DAY_SECONDS}));case I.CLEAN_PAST_PARTICIPANTS:return(0,i.default)((function*(){if(!(0,m.pastParticipantsDbEnabled)())return s.DAY_SECONDS;try{yield(0,P.pruneExpiredPastParticipants)()}catch(e){__LOG__(4,!0,new Error)`Failed to delete the expired orphan reactions with error: ${e}`}return s.DAY_SECONDS}))}}(e);null!=t&&(0,o.registerTask)(e,t)}))};var i=r(n(348926)),a=n(278009),o=n(802821),s=n(892844),l=n(257243),c=n(464358),u=n(95060),d=n(88555),p=n(408139),f=n(16292),_=n(453168),h=n(203292),g=n(758180),m=n(879662),y=n(81245),S=n(382626),E=n(641950),v=n(801580),T=n(682827),C=n(400189),A=n(448285),b=n(740946),P=n(543201),O=n(766379),M=n(760998);const I=n(76672)({CLEAN_TC_TOKENS:"cleanTcTokens",LOG_DAILY_STATS:"logDailyStats",LOG_DB_ROW_COUNTS:"logDbRowCounts",ROTATE_KEY:"rotateKey",SYNC_AB_PROPS:"syncAbProps",SYNC_CONTACTS:"syncContacts",MONITOR_DB_STORAGE:"monitorDbStorage",REPORT_SYNCD_ACTION_STAT:"reportSyncdActionStat",LT_HASH_CHECK:"ltHashCheck",REQUEST_ALL_SYNCD_MISSING_KEYS:"requestAllSyncdMissingKeys",SYNCD_SYNC_ALL_COLLECTIONS:"syncdSyncAllCollections",CLEAN_ORPHAN_REACTIONS:"cleanOrphanReactions",CLEAN_ORPHAN_ADD_ONS:"cleanOrphanAddOns",CLEAN_PAST_PARTICIPANTS:"cleanPastParticipants"}),w=[I.CLEAN_TC_TOKENS,I.LOG_DAILY_STATS,I.LOG_DB_ROW_COUNTS,I.ROTATE_KEY,I.SYNC_AB_PROPS,I.SYNC_CONTACTS,I.MONITOR_DB_STORAGE,I.REPORT_SYNCD_ACTION_STAT,I.LT_HASH_CHECK,I.REQUEST_ALL_SYNCD_MISSING_KEYS,I.SYNCD_SYNC_ALL_COLLECTIONS,I.CLEAN_ORPHAN_REACTIONS,I.CLEAN_ORPHAN_ADD_ONS]},536037:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TosManager=t.TOS_3_ID=void 0;var a=i(n(348926)),o=n(757491),s=n(413959),l=n(492574),c=i(n(876521)),u=n(408139),d=n(260976),p=n(546718),f=n(978820),_=n(491442);const h="20210210";t.TOS_3_ID=h;const g={minTimeout:1e3,maxTimeout:16e3,retries:5,signal:(new r).signal};class m extends c.default{constructor(){super(...arguments),this._noticeIds=[h],this._refreshInterval=864e5}getState(e){const t=this._getStoreKey(e);return _.userPreferencesStore.getUser(t)||"UNKNOWN"}setState(e,t){if((0,u.tosFetchEnabled)()){new Set(this._noticeIds).has(e)?(_.userPreferencesStore.setUser(this._getStoreKey(e),t),this.trigger("change")):__LOG__(3)`ToS state manager unrecognized user notice id: ${e}`}}run(){var e=this;return(0,a.default)((function*(){if((0,u.tosFetchEnabled)()){try{yield(0,o.exponentialBackoff)(g,((t,n)=>e._query().catch((e=>{if(e instanceof l.ServerStatusCodeError)switch(e.statusCode){case 500:return __LOG__(3)`ToS state manager query failed, retriable error: ${e.errorMessage}, failCount ${n}`,t(e)}throw e}))))}catch(e){if(__LOG__(4,!0,new Error,!0)`ToS state manager state pull failed, error: ${e}`,SEND_LOGS("ToS state manager run failed"),!(e instanceof l.ServerStatusCodeError&&500===e.statusCode))return}if(e._getNoticeIdsToRun().length>0){const t=(0,f.getMaybeMeUser)();yield(0,s.delayMs)(e._refreshInterval),(0,f.getMaybeMeUser)()===t&&e.run()}}}))()}_query(){var e=this;return(0,a.default)((function*(){if(!(0,f.getMaybeMeUser)())return;const t=e._getNoticeIdsToRun();if(t.length>0){const n=yield(0,d.queryTosState)(t);e._refreshInterval=1e3*n.refresh;const r=new Set(e._noticeIds);let i=!1;n.notice.filter((e=>r.has(e.id))).forEach((t=>{const n=t.state?"ACCEPTED":"NOT_ACCEPTED",r=e._getStoreKey(t.id);_.userPreferencesStore.getUser(r)!==n&&(_.userPreferencesStore.setUser(r,n),i=!0)})),_.userPreferencesStore.setUser(p.KEYS.TOS_STATE_FETCH_ITERATION,(0,u.tosFetchIteration)()),i&&e.trigger("change")}}))()}_getNoticeIdsToRun(){const e=parseInt(_.userPreferencesStore.getUser(p.KEYS.TOS_STATE_FETCH_ITERATION),10)||0;if((0,u.tosFetchIteration)()>e)return this._noticeIds;const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((e,n)=>"ACCEPTED"!==t[n]))}_getStoreKey(e){switch(e){case h:return p.KEYS.TOS_3}throw new Error("Unknown user notice id: "+e)}maybeUpdateServer(e){var t=this;return(0,a.default)((function*(){if((0,u.tosFetchEnabled)())try{const n=new Set(e);yield(0,o.exponentialBackoff)(g,((e,r)=>{const i=t._getAcceptedNoticeIds(n);return i.length>0?(0,d.updateTosState)(i).catch((t=>{if(t instanceof l.ServerStatusCodeError&&500===t.statusCode)return __LOG__(3)`ToS state manager server session state update failed, retriable error: ${t.errorMessage}, failCount ${r}`,e(t);throw t})):Promise.resolve()}))}catch(e){__LOG__(4,!0,new Error,!0)`ToS state manager server session state update failed, error: ${e}`,SEND_LOGS("ToS state manager server session state update failed")}}))()}_getAcceptedNoticeIds(e){if((0,f.getMaybeMeUser)()){const t=this._noticeIds.map((e=>this.getState(e)));return this._noticeIds.filter(((n,r)=>"ACCEPTED"===t[r]&&e.has(n)))}return[]}resetTosState(){}}const y=new m;t.TosManager=y},49506:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByCountry=function(e){var t;return!!(0,i.countryGatingEnabled)()&&((null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===a.HostStorageEnumType.Facebook&&!(0,r.getFbBrandedNumber)(e.id.user))};var r=n(183180),i=n(408139),a=n(49714)},507134:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldBlockByTos=l,t.shouldBlockByTosB2C=function(e,t){if((0,i.tos3GatingEnabledB2C)()&&l(e)&&t)return t.type!==a.MSG_TYPE.DEBUG&&t.type!==a.MSG_TYPE.E2E_NOTIFICATION&&t.type!==a.MSG_TYPE.NOTIFICATION_TEMPLATE&&!t.isSentByMe;return!1};var r=n(183180),i=n(408139),a=n(115461),o=n(536037),s=n(49714);function l(e){var t;if((0,i.tos3GatingEnabled)()&&("NOT_ACCEPTED"===o.TosManager.getState(o.TOS_3_ID)&&(null===(t=e.privacyMode)||void 0===t?void 0:t.hostStorage)===s.HostStorageEnumType.Facebook&&!(0,r.getFbBrandedNumber)(e.id.user)))return!0;return!1}},33723:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncQuery=t.USYNC_SUPPORT_TYPE=void 0;var i=r(n(348926)),a=n(736184),o=n(831914),s=n(471914),l=n(696055),c=n(181663),u=n(395588),d=n(561948),p=n(993092),f=n(862988),_=n(202644),h=n(343063),g=n(170128),m=n(401117),y=r(n(389867));const S={FEATURE:"feature",DEVICE:"devices",CONTACT:"contact",PICTURE:"picture",STATUS:"status",BUSINESS:"business",DISAPPEARING_MODE:"disappearing_mode",LID:"lid"};t.USYNC_SUPPORT_TYPE=S;const E={feature:_.featureParser,devices:p.deviceParser,contact:d.contactParser,picture:g.pictureParser,status:m.statusParser,business:u.businessParser,disappearing_mode:f.disappearingModeParser,lid:h.lidParser};function v(e){const t=[];return e.forEachChildWithTag("user",(e=>{const n={};e.hasAttr("jid")&&(Object.keys(S).forEach((t=>{const r=S[t],i=e.maybeChild(r);i&&E[r]&&(n[r]=E[r](i))})),n.id=(0,c.deviceJidToUserWid)(e.attrDeviceJid("jid")),t.push(n))})),t}const T=new s.WapParser("usyncParser",(e=>{e.assertAttr("type","result");const t={error:{},refresh:{},list:[],sideList:[]},n=e.child("usync"),r=n.child("result"),i=n.child("list"),a=n.maybeChild("side_list");return Object.keys(S).forEach((e=>{const n=S[e],i=r.maybeChild(n);if(i){const e=i.maybeChild("error");e?t.error[n]={errorCode:e.attrInt("code"),errorText:e.attrString("text"),errorBackoff:e.attrInt("backoff")}:i.hasAttr("refresh")&&(t.refresh[n]=i.attrInt("refresh",0))}})),t.list=v(i),a&&(t.sideList=v(a)),__LOG__(2)`usync query success!`,t}));t.USyncQuery=class{constructor(){this.context="interactive",this.mode="query",this.protocols=[],this.users=[]}withMode(e){return this.mode=e,this}withContext(e){return this.context=e,this}withContactProtocol(){return this.protocols.push(new d.USyncContactProtocol),this}withBusinessProtocol(){return this.protocols.push(new u.USyncBusinessProtocol),this}withDeviceProtocol(){return this.protocols.push(new p.USyncDeviceProtocol),this}withDisappearingModeProtocol(){return this.protocols.push(new f.USyncDisappearingModeProtocol),this}withPictureProtocol(){return this.protocols.push(new g.USyncPictureProtocol),this}withStatusProtocol(){return this.protocols.push(new m.USyncStatusProtocol),this}withFeaturesProtocol(e){return this.protocols.push(new _.USyncFeaturesProtocol(e)),this}withLidProtocol(){return this.protocols.push(new h.USyncLidProtocol),this}withUser(e){return this.users.push(e),this}_buildStanza(){if(0===this.protocols.length)throw new Error("a usync query must have at least one protocol");const e=this.users.filter((e=>{const t=e.getId();return(!t||!y.default.isServer(t))&&e.validate()}));0===e.length&&__LOG__(3)`Usync warning: a usync query must have at least one user`;const t=(0,o.wap)("query",null,this.protocols.map((e=>e.getQueryElement()))),n=e.map((e=>{const t=e.getId();return(0,o.wap)("user",{jid:t?(0,l.USER_JID)(t):o.DROP_ATTR},this.protocols.map((t=>t.getUserElement(e))))})),r=(0,o.wap)("list",null,n);return(0,o.wap)("iq",{to:o.S_WHATSAPP_NET,xmlns:"usync",type:"get",id:(0,o.generateId)()},(0,o.wap)("usync",{sid:(0,o.generateId)(),index:"0",last:"true",mode:(0,o.CUSTOM_STRING)(this.mode),context:(0,o.CUSTOM_STRING)(this.context)},t,r))}execute(){var e=this;return(0,i.default)((function*(){const t=e._buildStanza(),n=yield(0,a.sendIq)(t,T);return n.success?n.result:{error:{all:{errorCode:n.errorCode,errorText:n.errorText,errorType:n.errorType}},refresh:{},list:[]}}))()}}},395588:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.USyncBusinessProtocol=void 0,t.businessParser=function(e){e.assertTag("business");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n=e.maybeChild("verified_name");return{verifiedName:n?(0,a.default)(n):null}};var i=n(831914),a=r(n(377651));t.USyncBusinessProtocol=class{getQueryElement(){return(0,i.wap)("business",null,(0,i.wap)("verified_name",null))}getUserElement(){return null}}},561948:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncContactProtocol=void 0,t.contactParser=function(e){e.assertTag("contact");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{type:e.attrString("type")}};var r=n(831914);t.USyncContactProtocol=class{getQueryElement(){return(0,r.wap)("contact",null)}getUserElement(e){const t=e.getPhone();return t?(0,r.wap)("contact",null,t):null}}},993092:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDeviceProtocol=void 0,t.deviceParser=function(e){e.assertTag("devices");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n=e.maybeChild("key-index-list"),r=e.maybeChild("device-list"),i=null==n?null:{ts:n.attrTime("ts"),signedKeyIndexBytes:n.hasContent()?n.contentBytes():null,expectedTs:n.hasAttr("expected_ts")?n.attrTime("expected_ts"):void 0};return{deviceList:null==r?void 0:r.mapChildrenWithTag("device",(e=>({id:e.attrInt("id"),keyIndex:e.hasAttr("key-index")?e.attrInt("key-index"):null}))),keyIndex:i}};var r=n(831914),i=n(257243);t.USyncDeviceProtocol=class{getQueryElement(){return(0,r.wap)("devices",{version:(0,r.CUSTOM_STRING)(String(2))})}getUserElement(e){const t=e.getDeviceHash(),n=e.getTs(),a=e.getExpectedTs();return t||null!=n||null!=a?(0,r.wap)("devices",{device_hash:t?(0,r.CUSTOM_STRING)(t):r.DROP_ATTR,ts:null!=n?(0,r.INT)(n):r.DROP_ATTR,expected_ts:(0,i.getABPropConfigValue)("adv_v2_m4_m5")&&null!=a?(0,r.INT)(a):r.DROP_ATTR}):null}}},862988:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncDisappearingModeProtocol=void 0,t.disappearingModeParser=function(e){e.assertTag("disappearing_mode");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n=e.attrInt("duration",0),r=e.attrInt("t");return{duration:n,t:r}};var r=n(831914);t.USyncDisappearingModeProtocol=class{getQueryElement(){return(0,r.wap)("disappearing_mode",null)}getUserElement(){return null}}},202644:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncFeaturesProtocol=void 0,t.featureParser=function(e){e.assertTag("feature");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};const n={};return Object.keys(i).forEach((t=>{const r=e.maybeChild(t);r&&(n[t]=r.attrString("value"))})),n};var r=n(831914);const i={document:(0,r.wap)("document",null),encrypt:(0,r.wap)("encrypt",null),encrypt_blist:(0,r.wap)("encrypt_blist",null),encrypt_contact:(0,r.wap)("encrypt_contact",null),encrypt_group_gen2:(0,r.wap)("encrypt_group_gen2",null),encrypt_image:(0,r.wap)("encrypt_image",null),encrypt_location:(0,r.wap)("encrypt_location",null),encrypt_url:(0,r.wap)("encrypt_url",null),encrypt_v2:(0,r.wap)("encrypt_v2",null),voip:(0,r.wap)("voip",null),multi_agent:(0,r.wap)("multi_agent",null)};t.USyncFeaturesProtocol=class{constructor(e){if(this.queries=e,0===e.length)throw new Error("must specify at least one query")}getQueryElement(){return(0,r.wap)("feature",null,this.queries&&this.queries.map((e=>i[e])))}getUserElement(){return null}}},343063:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncLidProtocol=void 0,t.lidParser=function(e){e.assertTag("lid");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return e.maybeAttrLidUserJid("val")};var r=n(831914);t.USyncLidProtocol=class{getQueryElement(){return(0,r.wap)("lid",null)}getUserElement(){return null}}},170128:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncPictureProtocol=void 0,t.pictureParser=function(e){e.assertTag("picture");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};return{id:e.attrInt("id")}};var r=n(831914);t.USyncPictureProtocol=class{getQueryElement(){return(0,r.wap)("picture",null)}getUserElement(){return null}}},401117:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncStatusProtocol=void 0,t.statusParser=function(e){e.assertTag("status");const t=e.maybeChild("error");if(t)return{errorCode:t.attrInt("code"),errorText:t.attrString("text")};if(!e.hasContent())return e.hasAttr("code")&&401===e.attrInt("code")?null:i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString();return 0!==e.contentString().length?e.contentString():i.fbt._("Hey there! I am using WhatsApp.",null,{hk:"1lXNBq"}).toString()};var r=n(831914),i=n(548360);t.USyncStatusProtocol=class{getQueryElement(){return(0,r.wap)("status",null)}getUserElement(){return null}}},4e4:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USyncUser=void 0;var r=n(447685);t.USyncUser=class{withId(e){return this._id=e,this}withDeviceHash(e){return this._deviceHash=e,this}withTs(e){return this._ts=e,this}withExpectedTs(e){return this._expectedTs=e,this}withPhone(e){return this._phone=e,this}getDeviceHash(){return this._deviceHash}getPhone(){return this._phone}getId(){return this._id}getTs(){return this._ts}getExpectedTs(){return this._expectedTs}validate(){const{_id:e,_phone:t}=this;if(null==e&&null==t)throw new Error("user must have an id or a phone");if(e){const t=(0,r.validateWid)(e.toString());return t||__LOG__(3)`USync user created with invalid jid: ${e.toString()}`,t}return!0}}},36129:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(108584);class i{static tag(e){return null==e?void 0:e[0]}static attr(e,t){return(null==t?void 0:t[1])?t[1][e]:void 0}static attrs(e){return e[1]}static child(e,t){const n=t[2];if(Array.isArray(n)){const t=n.length;for(let r=0;r<t;r++){const t=n[r];if(Array.isArray(t)&&t[0]===e)return t}}}static firstChild(e){const t=e[2];if(Array.isArray(t))return t[0]}static children(e,t){if(!t)return null==e?void 0:e[2];const n=e[2];return Array.isArray(n)?n.filter((e=>e[0]===t)):void 0}static dataStr(e){if(!e)return"";const t=e[2];return"string"==typeof t?t:t instanceof ArrayBuffer?new r.Binary(t).readString(t.byteLength):""}static toString(e,t){if(!e)return"undefined";const n=function(e,t){if(e){let n="";for(const r in e){n+=" "+r+"="+("string"==typeof e[r]?t?"...":'"'+e[r]+'"':e[r])}return n}return""}(e[1],t),r=function(e,t){if(e instanceof ArrayBuffer)return"<<bin:"+e.byteLength+">>";if("string"==typeof e)return t?"<<string:"+e.length+">>":e;if(Array.isArray(e))return e.map((e=>i.toString(e,t))).join("\n");return""}(e[2],t);return"<"+e[0]+n+(r?">\n"+r+"\n</"+e[0]+">":"/>")}}t.default=i},833163:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(451584)),a=r(n(513218)),o=r(n(616579)),s=r(n(402525)),l=n(551737);function c(e){switch(typeof e){case"object":return null==e?e=>null===e:function(e){const t=[];let n=!1,r=0;(0,s.default)(e,(function(e,i){if(void 0===e)return void(n=!0);r++;const a=c(e);t.push((function(e){return e.hasOwnProperty(i)&&a&&a(e[i])}))}));const i=(0,o.default)(t,(function(e,t){return e?function(n){return t(n)&&e(n)}:t}));return function(e){if("object"!=typeof e||null==e)return!1;const t=Object.keys(e).length;return!(t<r)&&!(!n&&t>r)&&i(e)}}(e);case"function":return e;case"boolean":case"undefined":case"number":case"string":return function(t){return t===e};default:throw new TypeError("Unknown Template type: "+typeof e)}}class u{constructor(e){this.predicate=c(e)}test(e){return this.predicate(e)}}t.default=u,u.ANY=()=>!0,u.OBJECT=a.default,u.STRING=l.isString,u.BOOLEAN=i.default},641090:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(421224),i={voipIndividualOutgoing:r.WebFeatures$Flag.FORCE_UPGRADE,groupsV3:r.WebFeatures$Flag.FORCE_UPGRADE,groupsV3Create:r.WebFeatures$Flag.DEVELOPMENT,changeNumberV2:r.WebFeatures$Flag.FORCE_UPGRADE,queryStatusV3Thumbnail:r.WebFeatures$Flag.DEVELOPMENT,liveLocations:r.WebFeatures$Flag.FORCE_UPGRADE,queryVname:r.WebFeatures$Flag.FORCE_UPGRADE,voipIndividualIncoming:r.WebFeatures$Flag.FORCE_UPGRADE,quickRepliesQuery:r.WebFeatures$Flag.FORCE_UPGRADE,payments:r.WebFeatures$Flag.FORCE_UPGRADE,labelsDisplay:r.WebFeatures$Flag.FORCE_UPGRADE,labelsEdit:r.WebFeatures$Flag.FORCE_UPGRADE,stickerPackQuery:r.WebFeatures$Flag.FORCE_UPGRADE,liveLocationsFinal:r.WebFeatures$Flag.FORCE_UPGRADE,mediaUpload:r.WebFeatures$Flag.FORCE_UPGRADE,vnameV2:r.WebFeatures$Flag.FORCE_UPGRADE,videoPlaybackUrl:r.WebFeatures$Flag.FORCE_UPGRADE,statusRanking:r.WebFeatures$Flag.FORCE_UPGRADE,voipIndividualVideo:r.WebFeatures$Flag.DEVELOPMENT,thirdPartyStickers:r.WebFeatures$Flag.FORCE_UPGRADE,frequentlyForwardedSetting:r.WebFeatures$Flag.FORCE_UPGRADE,recentStickers:r.WebFeatures$Flag.FORCE_UPGRADE,recentStickersV2:r.WebFeatures$Flag.PRODUCTION,recentStickersV3:r.WebFeatures$Flag.PRODUCTION,groupsV4JoinPermission:r.WebFeatures$Flag.FORCE_UPGRADE,catalog:r.WebFeatures$Flag.FORCE_UPGRADE,starredStickers:r.WebFeatures$Flag.PRODUCTION,templateMessage:r.WebFeatures$Flag.PRODUCTION,templateMessageInteractivity:r.WebFeatures$Flag.DEVELOPMENT,ephemeralMessages:r.WebFeatures$Flag.PRODUCTION,e2ENotificationSync:r.WebFeatures$Flag.FORCE_UPGRADE,syncdRelease1:r.WebFeatures$Flag.PRODUCTION,userNotice:r.WebFeatures$Flag.PRODUCTION,syncdRelease11:r.WebFeatures$Flag.PRODUCTION,support:r.WebFeatures$Flag.PRODUCTION,groupUiiCleanup:r.WebFeatures$Flag.FORCE_UPGRADE,groupDogfoodingInternalOnly:r.WebFeatures$Flag.DEVELOPMENT,settingsSync:r.WebFeatures$Flag.PRODUCTION,ephemeral24HDuration:r.WebFeatures$Flag.DEVELOPMENT,archiveV2:r.WebFeatures$Flag.PRODUCTION,mdForceUpgrade:r.WebFeatures$Flag.FORCE_UPGRADE,disappearingMode:r.WebFeatures$Flag.PRODUCTION,externalMdOptInAvailable:r.WebFeatures$Flag.PRODUCTION,noDeleteMessageTimeLimit:r.WebFeatures$Flag.DEVELOPMENT};t.default=i},580208:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.settingsSync=t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=t.DISAPPEARING_MODE_SETTINGS_KEY=t.ARCHIVE_SETTINGS_KEY=void 0;var i=r(n(441609));const a="archive";t.ARCHIVE_SETTINGS_KEY=a;const o="disappearing_mode";t.DISAPPEARING_MODE_SETTINGS_KEY=o;const s="md_opt_in_deadline";t.MD_OPT_IN_DEADLINE_SETTINGS_KEY=s;const l={querySettings:function(e){return new Promise(((t,n)=>{const r=this.queryNode({type:"settings"},void 0),a=e?"query,settings,resume":"query,settings";this.binSend("sendEphemeral",r,n,{onSend:this.binWrap((e=>{this.BinaryProtocol.read(e).then((e=>{const n={settings:[],status:parseInt(this.N.attr("code",e),10)||200};if(__LOG__(2)`bin-recv: response,settings`,"response"===this.N.tag(e)&&"settings"===this.N.attr("type",e)){const t=this.N.children(e);if(Array.isArray(t))for(let e=0;e<t.length;e++){const r=this.parseSetting(t[e]);(0,i.default)(r)||n.settings.push(r)}}t(n)})).catch(n)}),t),onDrop:this.wrap(n),serverCacheable:Boolean(e)},{debugString:a,metricName:"QUERY_SETTINGS"})}))},setArchiveSetting:function(e){return new Promise(((t,n)=>{const r=this.actionNode("set",[["archive_v2",{classic:e.toString()},void 0]]);this.binSend("send",r,n,{clientCacheable:!0,onSend:this.wrap(t),onDrop:this.wrap(n)},{debugString:"action,settings,archive",metrics:"SET_ARCHIVE_SETTING",ackRequest:!0})}))},parseSetting:function(e){switch(this.N.tag(e)){case"archive_v2":return{type:a,value:{classic:"true"===this.N.attr("classic",e),enabled:this.N.attr("enabled",e)&&"true"===this.N.attr("enabled",e)}};case"disappearing_mode":return{type:o,value:{duration:parseInt(this.N.attr("duration",e),10),settingTimestamp:parseInt(this.N.attr("t",e),10)}};case"md_opt_in_deadline":return{type:s,value:{timestamp:parseInt(this.N.attr("t",e),10)}};default:return}}};t.settingsSync=l},656891:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.instance}});var i=n(686875);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},978144:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.default.isWid,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.createWid,o=t;switch(e){case"author":case"broadcast":case"chat":case"descOwner":case"from":case"gid":case"id":case"jid":case"owner":case"participant":case"quotedRemoteJid":case"quotedParticipant":case"remote":case"subjectOwner":case"s_o":case"to":case"wid":case"changeNumberNewJid":case"changeNumberOldJid":case"recipient":case"paymentMessageReceiverJid":case"parentGroup":case"revokeSender":n(t)&&(o=r(t));break;default:const i=parseInt(e,10);!isNaN(i)&&n(t)&&(o=r(t))}return o};var i=r(n(389867)),a=n(745454)},877113:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.loadProtoVersions=function(){return s.apply(this,arguments)},t.protoMap=void 0;var i=r(n(348926)),a=n(546582);const o={};function s(){return(s=(0,i.default)((function*(){const e=yield(0,a.requireLoadProtoVersions)();Object.assign(o,e)}))).apply(this,arguments)}t.protoMap=o},807353:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(211865)),a=n(108584);const o={NEW:"REQUEST_STATE_NEW",SENT:"REQUEST_STATE_SENT",WEBDACKED:"REQUEST_STATE_WEBDACKED",WILL_RETRY:"REQUEST_STATE_WILL_RETRY"};class s{constructor(e){this.state=o.NEW,this.age=0,this.resends=0;const t=e.data;this.data=t,this.isToPhone=t instanceof ArrayBuffer,this.tag=e.tag,this.clientCacheable=!!e.clientCacheable,this.serverCacheable=!!e.serverCacheable,this.retryOn5xx=!!e.retryOn5xx,this.onSend=e.onSend,this.logOnSend=e.logOnSend,this.onDrop=e.onDrop,this.binaryOpts=e.binaryOpts,this.on5xx=e.on5xx,this.resendGuard=e.resendGuard,this.onTag=e.onTag,this.tagToCancel=e.tagToCancel,this.ephemeral=!!e.ephemeral,this.ignore=!!e.ignore,this.isCallOffer=!!e.isCallOffer,this.isWap4Bridge=!!e.isWap4Bridge}getTag(){return this.tag||(this.onSend?this.onSend.tag:void 0)}getName(){var e;return(null===(e=this.binaryOpts)||void 0===e?void 0:e.metricName)?this.binaryOpts.metricName.toLowerCase():`${this.data[0]}_${(0,i.default)(this.data[1])}`}toString(){const e=this.data;return this.binaryOpts?this.binaryOpts.debugString:Array.isArray(e)?0===e.length?"[]":1===e.length?`[${e[0]}]`:"query"===e[0]||"action"===e[0]?`[${e[0]}, ${e[1]}${e.length>2?", ...":""}]`:`Invalid request: ${e[0]}`:e instanceof Object?"{...}":`${String(e)}`}serialize(){const e=this.tag;if(this.binaryOpts){const t=this.binaryOpts,n=null!=t.metric?t.metric:0,r=(this.ignore?0:1)<<7|(!this.ignore&&t.ackRequest?1:0)<<6|(!0===t.available?1:0)<<5|(!1===t.available?1:0)<<4|(null!=t.expires&&0!==t.expires?1:0)<<3|(t.skipOffline?1:0)<<2;return a.Binary.build(e,",",n,r,this.data).readBuffer()}const t="string"==typeof this.data?this.data:JSON.stringify(this.data);return`${String(e)},,${String(t)}`}}t.default=s,s.STATE=o},266934:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.VoipSignaling=void 0,t.base64DecodeRecursively=function e(t){const n=t[2];Array.isArray(n)&&n.forEach((t=>{t&&(t[2]instanceof ArrayBuffer||"string"==typeof t[2]?t[2]=(0,a.decodeB64ToJsArray)(t[2]):t[2]&&e(t))}))};var i=r(n(478718)),a=n(615688),o=n(978820),s=r(n(36129)),l=n(743067),c=n(124808),u=n(445473),d=n(719380),p=n(484902),f=n(760980);const _={formatCallOffer:function(e,t,n){const r=n.payload,i={to:n.common.peer_jid,id:t,from:(0,o.getMaybeMeUser)().toString({legacy:!0})};let a,s;const u=r[2];u.forEach(((e,t)=>{switch(e[0]){case"enc":const i={call:{callKey:new Uint8Array(e[2])}},o={},u=r[1].retry_count;u&&(o.count=u);const d=["call",o,(0,l.cdataArrayBuffer)((0,f.encodeProtobuf)(c.MessageSpec,i))];a=d,s=t;break;default:(0,l.arrayToB64Recursively)(n.payload,!0)}})),u.splice(s,1),u.push(a),r[2]=u;return e.actionNode("relay",[["call",i,[r]]])},parseCallSignalingMsg:function(e){try{const t=d.ContactCollection.get(e.from),n={peer_jid:e.from.toString({legacy:!0}),isContact:null==t?void 0:t.isMyContact},r=["wrapper",{},e.data];switch(e.type){case"offer":{const t=h("offer",r);n.peer_platform=e.platform,e.version&&e.version.length&&(n.peer_version=e.version.join(".")),this.parseCallOffer(t,n,!1);break}case"accept":{const t=h("accept",r);n.type=u.TYPE.ACCEPT,n.call_id=s.default.attr("call-id",t)||"",n.peer_platform=e.platform,e.version&&e.version.length&&(n.peer_version=e.version.join("."));break}case"receipt":const t=e.data;switch(n.call_id=s.default.attr("call-id",t)||"",s.default.tag(t)){case"offer":n.type=u.TYPE.OFFER_RECEIPT;break;case"accept":n.type=u.TYPE.ACCEPT_RECEIPT;break;case"reject":default:return}break;case"terminate":const i=h("terminate",r);n.call_id=s.default.attr("call-id",i)||"",n.type=u.TYPE.TERMINATE;break;default:const a=function(e){const t=s.default.firstChild(e);if(!t)throw new Error("voip_signaling:Failed to get first child node");return t}(r);n.call_id=s.default.attr("call-id",a)}return(null==n?void 0:n.call_id)&&this.createCommonHeader(n),n}catch(e){return void __LOG__(3)`Error parsing voip signaling message`}},parseCallOffer:function(e,t,n){if(t.type=u.TYPE.OFFER,t.call_id=s.default.attr("call-id",e)||"",n){const n=h("call",e),i=s.default.children(n);if(i instanceof ArrayBuffer){var r;const e=(0,p.decodeProtobuf)(c.MessageSpec,i);(null===(r=e.call)||void 0===r?void 0:r.callKey)?this.receiveCallOfferKey(e.call.callKey,t):__LOG__(3)`voip_signaling:invalid messageProto.call`}else __LOG__(3)`voip_signaling:invalid serializedMessage`}else t.enc=this.parseRawE2EMaterial(e);const i=s.default.children(e,"video");t.video_count=Array.isArray(i)?i.length:void 0,t.isVideoCall=!!t.video_count,t.isGroupCall_DEPRECATED=!!t.group_info;const a=s.default.attr("t",e);a&&(t.t=a)},parseRawE2EMaterial:function(e){const t=s.default.child("enc",e);if(t)return(0,a.decodeB64ToJsArray)(s.default.dataStr(t));__LOG__(3)`voip_signaling:enc node not present`},receiveCallOfferKey:function(e,t){t&&(t[2]=Array.prototype.slice.call(new Uint8Array(e)))},createCommonHeader(e){e.common=(0,i.default)(e,["type","call_id","peer_jid"])}};function h(e,t){const n=s.default.child(e,t);if(!n)throw new Error(`voip_signaling:Failed to get child node ${e}`);return n}t.VoipSignaling=_},743067:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayToB64Recursively=o,t.cdataArrayBuffer=s,t.cdataB64=l,t.formatCallSignalingMsg=function(e,t){var n;const r=t.common.peer_jid;o(t.payload,!1);const i=t.payload;return["call",{from:null===(n=(0,a.getMaybeMeUser)())||void 0===n?void 0:n.toString({legacy:!0}),to:r,id:e},[i]]};var r=n(615688),i=n(108584),a=n(978820);function o(e,t){const n=e[2];Array.isArray(n)&&n.forEach((e=>{e&&(e[2]instanceof Array&&!(e[2][0]instanceof Array)?e[2]=t?s(new Uint8Array(e[2])):l(new Uint8Array(e[2])):e[2]&&o(e,t))}))}function s(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:e instanceof i.Binary?e.readBuffer():void 0}function l(e){return e instanceof Uint8Array||e instanceof ArrayBuffer?(0,r.encodeB64)(e):e instanceof i.Binary?(0,r.encodeB64)(e.readBuffer()):void 0}},686875:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.instance=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(615688),s=n(781484),l=n(181576),c=n(411141),u=n(234497),d=n(787614),p=r(n(145095)),f=r(n(747259)),_=n(920461),h=n(551737),g=n(831914),m=n(492574),y=n(413335),S=n(374316),E=(n(310206),U(n(138062))),v=n(438184),T=U(n(435232)),C=U(n(266333)),A=r(n(389867)),b=n(745454),P=r(n(641090)),O=n(877113),M=n(743067),I=n(509978),w=n(124808),R=n(421224),N=n(906822),L=n(765044),D=n(484902);function k(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(k=function(e){return e?n:t})(e)}function U(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=k(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}let G,x;function B(e){return function(){if(!G)return Promise.reject(new T.ProtoVersionUndefined(`wap:${e}:not connected to phone yet`));const t=G[e];return t?t.apply(G,arguments):Promise.reject(new Error(`wap:${e}:unsupported`))}}const F=B("sendPresenceUpdate"),j=B("sendChatstateUpdate");const Y=new class{constructor(){this.setSharedSecret=(0,_.promiseWrapSync)(function(){var e=(0,a.default)((function*(e){__LOG__(2)`Wap:saveSharedSecret start`;const t=(0,p.default)((0,o.decodeB64ToJsArray)(e),"decodeB64ToJsArray(payload)"),n=t.slice(0,32),r=t.slice(64),i=C.get().keyPair,a=(0,p.default)(i,"keyPair").privKey,u=yield E.sharedSecret(n,a).then((e=>(0,l.extractAndExpand)(e,"",80))),d=new Uint8Array(u,0,32),f=new Uint8Array(u,32,32),_=new Uint8Array(u,64,16),h=new Uint8Array(n.concat(r)),g=yield(0,c.hmacSha256)(f,h),m=(0,o.encodeB64)(g),y=(0,o.encodeB64)(t.slice(32,64));if(y!==m)return void __LOG__(3)`Wap:saveSharedSecret hmac mismatch ${y} ${m}`;const S=yield(0,s.aesCbcDecrypt)(d,_,new Uint8Array(r)),v=new Uint8Array(S,0,32),T=new Uint8Array(S,32,32);C.setSecretKeys("0.1",v,T),__LOG__(2)`Wap:saveSharedSecret done`}));return function(){return e.apply(this,arguments)}}()),this.addContact=B("addContact"),this.groupMetadataFindFromPhone=B("groupMetadataFindFromPhone"),this.resyncMessages=B("resyncMessages"),this.resyncReceipts=B("resyncReceipts"),this.queryReceivedActions=B("queryReceivedActions"),this.addParticipants=B("addParticipants"),this.changeSubject=B("changeSubject"),this.createGroup=B("createGroup"),this.leaveGroup=B("leaveGroup"),this.removeParticipants=B("removeParticipants"),this.promoteParticipants=B("promoteParticipants"),this.demoteParticipants=B("demoteParticipants"),this.setGroupDescription=B("setGroupDescription"),this.setGroupProperty=B("setGroupProperty"),this.setGroupEphemeralDuration=B("setGroupEphemeralDuration"),this.requestMediaReupload=B("requestMediaReupload"),this.sendMedia=B("sendMedia"),this.mediaUpload=B("mediaUpload"),this.sendConversationSeen=B("sendConversationSeen"),this.sendConversationUnseen=B("sendConversationUnseen"),this.sendConversationClear=B("sendConversationClear"),this.sendConversationDelete=B("sendConversationDelete"),this.sendConversationArchive=B("sendConversationArchive"),this.sendConversationMute=B("sendConversationMute"),this.sendConversationNotSpam=B("sendConversationNotSpam"),this.sendConversationPin=B("sendConversationPin"),this.sendConversationDismissChangeNumber=B("sendConversationDismissChangeNumber"),this.sendMessagePlayed=B("sendMessagePlayed"),this.sendMessageDelete=B("sendMessageDelete"),this.sendMessageStarred=B("sendMessageStarred"),this.sendUnstarAll=B("sendUnstarAll"),this.sendSetPicture=B("sendSetPicture"),this.deletePicture=B("deletePicture"),this.sendSetStatus=B("sendSetStatus"),this.setPushname=B("setPushname"),this.statusQuery=B("statusQuery"),this.sendStatusSeen=B("sendStatusSeen"),this.statusQueryThumbnail=B("statusQueryThumbnail"),this.sendSetBlock=B("sendSetBlock"),this.sendSpamReport=B("sendSpamReport"),this.chatFindQuery=B("chatFindQuery"),this.contactFindQuery=B("contactFindQuery"),this.queryIdentity=B("queryIdentity"),this.queryVname=B("queryVname"),this.msgCreateRecord=B("msgCreateRecord"),this.msgFindQuery=B("msgFindQuery"),this.queryLinkPreview=B("queryLinkPreview"),this.queryVcard=B("queryVcard"),this.queryMsgInfo=B("queryMsgInfo"),this.recentEmojiQuery=B("recentEmojiQuery"),this.clearBPQueue=B("clearBPQueue"),this.parseWebMessageInfo=B("parseWebMessageInfo"),this.subscribeLiveLocation=B("subscribeLiveLocation"),this.unsubscribeLiveLocation=B("unsubscribeLiveLocation"),this.queryActiveLiveLocation=B("queryActiveLiveLocation"),this.disableLiveLocation=B("disableLiveLocation"),this.findGroupPendingInvitesFromPhone=B("findGroupPendingInvitesFromPhone"),this.acceptGroupV4Invite=B("acceptGroupV4Invite"),this.revokeGroupV4Invite=B("revokeGroupV4Invite"),this.sendCallOffer=B("sendCallOffer"),this.queryCall=B("queryCall"),this.sendCallEnd=B("sendCallEnd"),this.queryLabels=B("queryLabels"),this.queryNextLabelColor=B("queryNextLabelColor"),this.queryLabelPalette=B("queryLabelPalette"),this.addOrRemoveLabels=B("addOrRemoveLabels"),this.deleteLabel=B("deleteLabel"),this.createLabel=B("createLabel"),this.editLabel=B("editLabel"),this.queryQuickReplies=B("queryQuickReplies"),this.flushQuickReplyCounts=B("flushQuickReplyCounts"),this.queryStickerPacks=B("queryStickerPacks"),this.queryStickersInStickerPack=B("queryStickersInStickerPack"),this.queryRecentStickers=B("queryRecentStickers"),this.queryStarredStickers=B("queryStarredStickers"),this.queryVideoPlaybackUrl=B("queryVideoPlaybackUrl"),this.queryNoticeState=B("queryNoticeState"),this.querySettings=B("querySettings"),this.setArchiveSetting=B("setArchiveSetting"),this.queryDisappearingMode=B("queryDisappearingMode"),this.sendMdOptIn=B("sendMdOptIn")}isInitialized(){return!!x}setVersion(e,t,n){const r=e[0],a=e[1],o=[r,a,t,n].join("."),s=x!==o;if(__LOG__(2)`wap:setVersion ${o} set: ${String(s)}`,!s)return;const l=G;switch(r){case 0:switch(a){case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 11:case 12:case 13:case 14:case 15:case 16:throw __LOG__(3)`wap:setVersion deprecated version: ${o}`,new T.DeprecatedProtocolVersion("wap_deprecated_version");case 17:G=(0,i.default)({},O.protoMap[a]),G.setSubProtocol(t);break;default:G=void 0}}if(!G)throw __LOG__(3)`wap:setVersion unknown version. attempting to update`,new T.UpdateImmediately("wap_unknown_version");x=o,G.supportsFeatureFlags&&this.processFeatureFlags(n),l&&G&&G.upgradeProtoVersion(l)}processFeatureFlags(e){if(!e)return;const t=(0,p.default)(G,"protoVersion"),n=t.implementedFeatures||{},r=(0,D.decodeProtobufWithUnknowns)(R.WebFeaturesSpec,(0,o.decodeB64)(e)),i=(0,D.getUnknownFields)(r);delete r.$$unsafeUnknownFields;for(const e in n)v.LegacyPhoneFeatures.setFeatureFromFlags(e,R.WebFeatures$Flag.FORCE_UPGRADE,R.WebFeatures$Flag.FORCE_UPGRADE);const a=(0,u.getProtoInternalSpec)(R.WebFeaturesSpec),s=Object.keys(a),l=Object.keys(r);s.forEach((e=>{const t=(0,v.getProtobufFeatureName)(e);!l.includes(e)&&v.LegacyPhoneFeatures.supportsFeature(t)&&v.LegacyPhoneFeatures.setFeature(t,!1)}));for(const e in r){if(n[e])continue;const i=r[e],a=P.default[e];if(i===R.WebFeatures$Flag.FORCE_UPGRADE&&a!==R.WebFeatures$Flag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:${e} phone value is ${i} and web value is ${a}. updating...`,new T.UpdateImmediately("wap_feature_force_upgrade");if(v.LegacyPhoneFeatures.setFeatureFromFlags(e,a,i),v.LegacyPhoneFeatures.supportsFeatureFromFlags(e)){const n=O.protoMap.features[e];n&&Object.assign(t,n)}}for(const e in i){const t=i[e];if("number"==typeof t&&R.WebFeatures$Flag.cast(t)===R.WebFeatures$Flag.FORCE_UPGRADE)throw __LOG__(3)`wap:features:unknown: ${e}: ${t}`,new T.UpdateImmediately("wap_feature_implemented_unknown")}}delete(){const e=G?G.delete.apply(G,arguments):void 0;return G=void 0,x=void 0,__LOG__(2)`wap:unsetVersion, which should only happen when logout`,e}cannotReachPhone(){G&&G.cannotReachPhone.apply(G,arguments)}handle(e,t,n,r){return(0,p.default)(G,"protoVersion").handle.apply(G,[e,t,n,r])}queryServerProps(){return L.Socket.sendEphemeral2({data:["query","props"],retryOn5xx:!1})}resyncPictures(e){const t=e.filter((e=>A.default.isWid(e.id)));return 0===t.length?Promise.resolve([]):L.Socket.sendEphemeral2({data:["query","resumePic",t],retryOn5xx:!0})}setRememberMe(e){return L.Socket.sendBasic({data:["admin","remember",!!e]})}queryMediaConnections(e){const t=new Date,n=L.Socket.send2({data:["query","mediaConn"]}).then((e=>{if(__LOG__(2,!0)`queryMediaConnections result: ${JSON.stringify(e)}`,200!==e.status){if(e.status>=400)throw new m.ServerStatusCodeError(e.status,"queryMediaConnections");throw new m.ServerStatusCodeError(e.status,"Invalid return status")}const{media_conn:n}=e;if(!(n&&n.auth&&n.ttl&&n.hosts&&Array.isArray(n.hosts)&&0!==n.hosts.length))throw __LOG__(2)`wap:queryMediaConnections mediaConn exists ${String(!!n)}`,n&&(__LOG__(2)`wap:queryMediaConnections mediaConn.auth exists ${String(!!n.auth)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.ttl exists ${String(!!n.ttl)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts exists ${String(!!n.hosts)}`,__LOG__(2)`wap:queryMediaConnections mediaConn.hosts isArray ${String(Array.isArray(n.hosts))}`,n.hosts&&__LOG__(2)`wap:queryMediaConnections mediaConn.hosts.length ${n.hosts.length}`),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("wap:queryMediaConnections unexpected mediaConn"),new Error("Invalid mediaConn");const{auth:r,auth_ttl:a,ttl:o,max_buckets:s}=n;return{auth:r,authTTL:a,hosts:n.hosts.map((e=>{var t;const n=null===(t=e.rules)||void 0===t?void 0:t.map((e=>e.download_buckets?{downloadBuckets:e.download_buckets}:e));return(0,i.default)((0,i.default)({},e),{},{rules:n})})),queryStartTime:t,ttl:o,maxBuckets:s}}));return(0,f.default)(n,e)}acceptGroupInvite(e){return L.Socket.send2({data:["action","invite",e],retryOn5xx:!0})}revokeGroupInvite(e){return L.Socket.send2({data:["action","inviteReset",e],retryOn5xx:!0})}contactFindBroadcast(e){return L.Socket.send2({data:["query","contact",e],retryOn5xx:!0})}commonGroupsFind(e){return A.default.isServer(e)?Promise.resolve({status:200,groups:[]}):L.Socket.send2({data:["query","group","common",e]})}getCapabilities(e){return L.Socket.send2({data:["query","caps",e.filter(A.default.isUser)],retryOn5xx:!0})}queryExist(e){return A.default.isUser(e)?L.Socket.send2({data:["query","exist",e],retryOn5xx:!0}):Promise.resolve({status:400})}queryCtwaContext(e,t,n){return(0,a.default)((function*(){var r,i,a,o;const s={accountNumber:(0,b.createWid)(e).toString({legacy:!0}),code:t,expectedSourceUrl:n,id:(0,g.generateId)()},l=yield L.Socket.send2({data:["query","ctwa",s],retryOn5xx:!0});if(200!==l.status)throw new m.ServerStatusCodeError(l.status,`queryCtwaContext:fail ${l.status}`);const c={sourceId:l.data.source.id,sourceType:l.data.source.type,sourceUrl:l.data.source.url,description:l.data.body,title:l.data.headline,mediaType:(null===(r=l.data.video)||void 0===r?void 0:r.url)?w.ContextInfo$ExternalAdReplyInfo$MediaType.VIDEO:w.ContextInfo$ExternalAdReplyInfo$MediaType.IMAGE,isSuspiciousLink:l.data.source.url!==n,thumbnailUrl:null===(i=l.data.thumbnail)||void 0===i?void 0:i.url,mediaUrl:null===(a=l.data.video)||void 0===a?void 0:a.url};return(null===(o=l.data.thumbnail)||void 0===o?void 0:o.bytes)&&(c.thumbnail=l.data.thumbnail.bytes),c}))()}queryBusinessProfile(e,t){return(0,a.default)((function*(){const n=yield L.Socket.send2({data:["query","businessProfile",e.filter((e=>A.default.isUser(e.wid))),t],retryOn5xx:!0});switch(n.status){case 200:return n.profiles;default:throw new Error(`queryBusinessProfile:fail ${n} ${n.status}`)}}))()}queryMerchantCompliance(e){return(0,a.default)((function*(){const t=yield L.Socket.send2({data:["query","merchantCompliance",e.filter((e=>A.default.isUser(e.wid)))],retryOn5xx:!0});switch(t.status){case 200:return t.compliance_infos;default:throw new Error(`queryMerchantCompliance:fail ${t} ${t.status}`)}}))()}queryBusinessCategories(e){return(0,a.default)((function*(){const t={id:(0,g.generateId)(),query:e},n=yield L.Socket.send2({data:["query","businessCategories",t],retryOn5xx:!0});switch(n.status){case 200:const e=n.data.not_a_biz[0],t=e.id,r=n.data.categories.reduce(((t,n)=>(n.id!==e.id&&t.push({id:n.id,localized_display_name:n.name}),t)),[]);return r.unshift({id:t,localized_display_name:e.name,not_a_biz:!0}),{categories:r,notABizId:t};default:throw new Error(`queryBusinessCategories:fail ${n} ${n.status}`)}}))()}queryOrder(e,t,n,r){return(0,a.default)((function*(){const i={id:(0,g.generateId)(),orderId:e,imageWidth:t.toString(),imageHeight:n.toString(),token:r},a=yield L.Socket.send2({data:["query","order",i],retryOn5xx:!0});switch(a.status){case 200:const{data:e}=a;try{const{currency:t,subtotal:n,total:r,tax:i}=e.price,a=parseInt(e.creationTS,10);return{currency:t,createdAt:a,products:e.products.map((e=>{var t,n;return{id:e.id,price:e.price,thumbnailId:null===(t=e.image)||void 0===t?void 0:t.id,thumbnailUrl:null===(n=e.image)||void 0===n?void 0:n.url,currency:e.currency,name:e.name,quantity:parseInt(e.quantity||0,10)}})),subtotal:n,total:r,tax:i}}catch(e){throw new m.ServerStatusCodeError(a.status,`queryOrder:response malformed ${a.status}`)}case 404:throw new m.E404;default:throw new m.ServerStatusCodeError(a.status,`queryOrder:fail ${a.status}`)}}))()}createOrder(e,t){return(0,a.default)((function*(){const n={product:t.map((e=>({id:e.id,name:e.name,quantity:(0,h.isNumber)(e.quantity)?e.quantity.toString():void 0,price:(0,h.isNumber)(e.priceAmount1000)?e.priceAmount1000.toString():void 0,currency:e.currency}))),bizJID:e,id:(0,g.generateId)()},r=yield L.Socket.send2({data:["action","createOrder",n],retryOn5xx:!0});if(200===r.status)return r.data;throw new m.ServerStatusCodeError(r.status,`createOrder:fail wap action return status: ${r.status}`)}))()}refreshCart(e,t,n,r){return(0,a.default)((function*(){const i=t.map((e=>({id:e}))),a={id:(0,g.generateId)(),products:i,bizJID:A.default.user(e),imageDimensions:{width:n.toString(),height:r.toString()}},o=yield L.Socket.send2({data:["action","refreshOrder",a],retryOn5xx:!0});if(200===o.status)return o.data;throw new m.ServerStatusCodeError(o.status,`refreshCart:fail wap action return status: ${o.status}`)}))()}queryProductCatalog(e,t,n,r,i,o){return(0,a.default)((function*(){const a={catalogWid:e,afterCursor:t,limit:n,width:r,height:i,allowShopSource:o,type:"get_product_catalog_reh",stanza_id:(0,g.generateId)()},s=yield L.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(s.status){case 200:return"string"==typeof s.data||s.data instanceof String?JSON.parse(s.data):s.data;default:throw new m.ServerStatusCodeError(s.status,`queryProductCatalog:fail ${s.status}`)}}))()}queryProductList(e,t,n,r){return(0,a.default)((function*(){const i={catalogWid:e,product_ids:t,width:""+n,height:""+r,stanza_id:(0,g.generateId)()},a=yield L.Socket.send2({data:["action","getProductList",i],retryOn5xx:!0});switch(a.status){case 200:return a.data.data;default:throw new m.ServerStatusCodeError(a.status,`queryProductList:fail ${a.status}`)}}))()}queryProduct(e,t,n,r,i){return(0,a.default)((function*(){const a={catalogWid:e,productID:t,width:n,height:r,fetchComplianceInfo:i,type:"get_product_reh",stanza_id:(0,g.generateId)()},o=yield L.Socket.send2({data:["query","bizCatalog",a],retryOn5xx:!0});switch(o.status){case 200:const e="string"==typeof o.data||o.data instanceof String?JSON.parse(o.data):o.data.product;return e.compliance_category===N.ProductComplianceCategory.CountryOriginExempt&&(e.compliance_info={country_code_origin:String(I.SyntheticCountryCode.NotApplicable)}),{data:e};case 404:case"not_found":return{error:"NOT_FOUND"};default:throw new m.ServerStatusCodeError(o.status,`queryProduct:fail ${o.status}`)}}))()}reportBusinessCatalogProduct(e,t,n){return(0,a.default)((function*(){const r={id:t,jid:e.toString(),reason:n,stanza_id:(0,g.generateId)()},i=yield L.Socket.send2({data:["action","reportProduct_reh",r],retryOn5xx:!0});if(200!==i.status)throw new m.ServerStatusCodeError(i.status,`reportBusinessCatalogProduct:fail ${i.status}`)}))()}deleteBusinessCatalogProduct(e){return(0,a.default)((function*(){const t=["action","deleteProduct_reh",{product_ids:e,stanza_id:(0,g.generateId)()}],n=yield L.Socket.send2({data:t,retryOn5xx:!0});if(200!==n.status)throw new m.ServerStatusCodeError(n.status,`deleteBusinessCatalogProduct:fail ${n.status}`);return{deletedCount:n.deletedCount}}))()}createBusinessCatalog(){return(0,a.default)((function*(){const e=["action","createCatalog_reh",{stanza_id:(0,g.generateId)()}],t=yield L.Socket.send2({data:e,retryOn5xx:!0});if(200!==t.status)throw new m.ServerStatusCodeError(t.status,`createBusinessCatalog:fail ${t.status}`)}))()}getComplianceInfoRequestParams(e){const{complianceInfo:t}=e,{isExempt:n,hasCountryCodeOrigin:r,hasImporterName:i,hasImporterAddress:a}=(0,S.scanComplianceInfoForMissingData)(t);if(n||!t||!(r||i||a))return;const o={compliance_info:{}};if(t.countryCodeOrigin&&(o.compliance_info.country_code_origin=t.countryCodeOrigin),t.importerName&&(o.compliance_info.importer_name=t.importerName),t.importerAddress){const e={};t.importerAddress.street1&&(e.street1=t.importerAddress.street1),t.importerAddress.street2&&(e.street2=t.importerAddress.street2),t.importerAddress.postalCode&&(e.postal_code=t.importerAddress.postalCode),t.importerAddress.city&&(e.city=t.importerAddress.city),t.importerAddress.region&&(e.region=t.importerAddress.region),t.importerAddress.countryCode&&(e.country_code=t.importerAddress.countryCode),Object.keys(e).length>0&&(o.compliance_info.importer_address=e)}return o}editBusinessCatalogProduct(e,t,n){var r=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({product_id:e.id,name:e.name,image_url:e.imageCdnUrl,url:e.url,additional_image_urls:e.additionalImageCdnUrl,width:t.toString(),height:n.toString(),stanza_id:(0,g.generateId)(),is_hidden:e.isHidden},r.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),e.description&&(s.description=e.description),e.retailerId&&(s.retailer_id=e.retailerId),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(I.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=N.ProductComplianceCategory.CountryOriginExempt);const l=yield L.Socket.send2({data:["action","editProduct_reh",s],retryOn5xx:!0});if(200===l.status)return l.data.product;throw new m.CatalogEditServerError(l.status,(0,y.parseLegacyProductErrorReason)(null==l||null===(o=l.data)||void 0===o?void 0:o.reason))}))()}editBusinessComplianceWebd(e){return(0,a.default)((function*(){var t,n,r,i,a,o,s;const l={customer_care_details:{email:null===(t=e.customerCareDetails)||void 0===t?void 0:t.email,landline_number:null===(n=e.customerCareDetails)||void 0===n?void 0:n.landlineNumber,mobile_number:null===(r=e.customerCareDetails)||void 0===r?void 0:r.mobileNumber},grievance_officer_details:{email:null===(i=e.grievanceOfficerDetails)||void 0===i?void 0:i.email,landline_number:null===(a=e.grievanceOfficerDetails)||void 0===a?void 0:a.landlineNumber,mobile_number:null===(o=e.grievanceOfficerDetails)||void 0===o?void 0:o.mobileNumber,name:null===(s=e.grievanceOfficerDetails)||void 0===s?void 0:s.name},entity_name:e.entityName,entity_type:e.entityType,entity_type_custom:e.entityTypeCustom,is_registered:e.isRegistered},c=yield L.Socket.send2({data:["action","editBusinessCompliance",l],retryOn5xx:!0});switch(c.status){case 200:return c.compliance_infos;default:throw new Error(`editBusinessCompliance:fail ${c} ${c.status}`)}}))()}addBusinessCatalogProduct(e,t,n){var r=this;return(0,a.default)((function*(){var a,o;const s=(0,i.default)({name:e.name,description:e.description||"",image_url:e.imageCdnUrl,url:e.url||"",additional_image_urls:e.additionalImageCdnUrl,retailer_id:e.retailerId||"",width:t.toString(),height:n.toString(),stanza_id:(0,g.generateId)(),is_hidden:e.isHidden},r.getComplianceInfoRequestParams(e));"number"==typeof e.priceAmount1000&&(s.price=(e.priceAmount1000/10).toString(),e.currency&&(s.currency=e.currency)),(null===(a=e.complianceInfo)||void 0===a?void 0:a.countryCodeOrigin)===String(I.SyntheticCountryCode.NotApplicable)&&(s.compliance_category=N.ProductComplianceCategory.CountryOriginExempt);const l=yield L.Socket.send2({data:["action","addProduct_reh",s],retryOn5xx:!0});if(200===l.status)return l.data.product;throw new m.CatalogEditServerError(l.status,(0,y.parseLegacyProductErrorReason)(null==l||null===(o=l.data)||void 0===o?void 0:o.reason))}))()}productVisibilitySet(e){return(0,a.default)((function*(){const t={product_visibility:e.map((e=>[e.productId,e.isHidden])),stanza_id:(0,g.generateId)()},n=yield L.Socket.send2({data:["action","productVisibilitySet",t],retryOn5xx:!0});if(200!==n.status)throw new m.ServerStatusCodeError(n.status,`productVisibilitySet:fail ${n.status}`)}))()}appealCatalogProduct(e,t){return(0,a.default)((function*(){const n={id:e,reason:t,stanza_id:(0,g.generateId)()},r=yield L.Socket.send2({data:["action","appealProduct_reh",n],retryOn5xx:!0});if(200===r.status)return!0;throw new m.ServerStatusCodeError(r.status,`appealCatalogProduct:fail ${r.status}`)}))()}groupV4InviteRequestMetadataFind(e,t,n,r,i){return L.Socket.send2({data:["query","InvitedGroupMetadata",{from:e,admin:t,code:n,expiration:r,gid:i}],retryOn5xx:!1})}groupV4InviteGrpPicThumb(e,t,n,r){return L.Socket.send2({data:["query","AddRequestGrpProfilePicThumb",{admin:e,code:t,expiration:n,gid:r}],retryOn5xx:!0})}groupMetadataFind(e){return(0,a.default)((function*(){const t=yield L.Socket.send2({data:["query","GroupMetadata",e],retryOn5xx:!0});return t.status&&t.status>=400?Promise.reject(new m.ServerStatusCodeError(t.status)):t}))()}groupInviteInfo(e){return L.Socket.send2({data:["query","invite",e],retryOn5xx:!0})}groupInviteCode(e){return L.Socket.send2({data:["query","inviteCode",e],retryOn5xx:!0})}profilePicFind(e){return A.default.isServer(e)?Promise.resolve({status:400}):L.Socket.sendEphemeral2({data:["query","ProfilePicThumb",e],retryOn5xx:!0})}profilePicFindThumbFromPhone(){return G?G.profilePicFindThumbFromPhone.apply(G,arguments):Promise.reject(new T.ProtoVersionUndefined("wap:profilePicFindThumbFromPhone:not connected to phone"))}statusFind(e){return A.default.isServer(e)?Promise.resolve({status:""}):L.Socket.sendEphemeral2({data:["query","Status",e],retryOn5xx:!0})}sendPing(){return L.Socket.send2({data:["admin","test"],retryOn5xx:!0})}sendPresenceAvailable(){return F("available")}sendPresenceUnavailable(){return F("unavailable")}sendChatstateComposing(e){return j("composing",e)}sendChatstatePaused(e){return j("paused",e)}sendChatstateRecording(e){return j("recording",e)}subscribePresence(e){return L.Socket.send2({data:["action","presence","subscribe",e],retryOn5xx:!0})}downloadImage(){return Promise.reject(new Error("Image download is not yet implemented"))}logoutToken(){return(0,a.default)((function*(){const{encKey:e,macKey:t}=C.get(),n=yield(0,c.hmacSha256)((0,p.default)(t,"macKey"),new Uint8Array((0,p.default)(e,"encKey")));return(0,o.encodeB64)(n)}))()}sendGroupCallOffer(e){return this.sendCallSignalingMsg(e)}sendCallSignalingMsg(e,t){return(0,a.default)((function*(){const n=t||(0,d.randomHex)(8),r=(0,M.formatCallSignalingMsg)(n,e);if(!r)return Promise.reject(new Error("unknown call signaling msg type"));return yield L.Socket.send2({tag:n,data:["action","call",r],retryOn5xx:!0})}))()}};t.instance=Y},797951:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.attemptWithDirectConnectionRetry=c,t.attemptWithOrderDirectConnectionRetry=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(257243),o=n(305905),s=r(n(515131)),l=n(900884);function c(){return u.apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t){if(!(yield(0,l.isCypherNeeded)(e)))return t();const n=function(){var n=(0,i.default)((function*(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const r=(yield s.default.getCypher(e,{forceRenew:n})).cypher;return t(r)}));return function(){return n.apply(this,arguments)}}();try{return yield n()}catch(e){return(0,l.errorIsDirectConnectionCypherError421)(e)?(__LOG__(2)`[direct-connection] Received 421 from Direct Connection request. Renewing certificate and retrying.`,n(!0)):Promise.reject(e)}}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t){if(!(0,a.getABPropConfigValue)("share_phone_number_on_cart_send_to_direct_connection_biz_enabled"))return c(e,t);if(!(yield(0,l.isCypherNeeded)(e)))return t();const n=function(){var n=(0,i.default)((function*(){var n;const r=null===(n=yield s.default.genNewCypher(e,o.CypherType.PhoneNumberAndPostcode,{forceRenew:!0}))||void 0===n?void 0:n.cypher;return t(r)}));return function(){return n.apply(this,arguments)}}(),r=function(){var r=(0,i.default)((function*(){const r=yield s.default.getCypher(e);return r.cypherType===o.CypherType.PhoneNumberAndPostcode?t(r.cypher):n()}));return function(){return r.apply(this,arguments)}}();try{return yield r()}catch(e){return(0,l.errorIsDirectConnectionCypherError421)(e)?(__LOG__(2)`[direct-connection] Received 421 from Direct Connection request. Renewing certificate and retrying.`,n()):Promise.reject(e)}}))).apply(this,arguments)}},779235:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessProfile=function(e,t){const n=(0,p.getBusinessProfileQueryVersion)();let r;r=(0,o.isMDBackend)()?t?Promise.all([(0,d.default)(e,n),(0,c.getMerchantCompliance)(e)]).then(_):(0,d.default)(e,n):t?Promise.all([f.default.queryBusinessProfile(e,n),f.default.queryMerchantCompliance(e)]).then(_):f.default.queryBusinessProfile(e,n);return(0,a.attachErrorLogger)(r,"Query business profile failed")},t.queryBusinessPublicKey=function(e){if((0,o.isMDBackend)()){return(0,n(203292).getJobManager)().waitUntilCompleted(u.jobSerializers.getPublicKey(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.queryCustomUrlPaths=function(e){let t;t=(0,o.isMDBackend)()?(0,s.getCustomUrlPaths)(e):Promise.reject(new Error("This feature is only available for MD."));return t},t.querySignedUserInfo=function(e){if((0,o.isMDBackend)()){return(0,n(203292).getJobManager)().waitUntilCompleted(u.jobSerializers.getSignedUserInfo(e))}return Promise.reject(new Error("This feature is only available for MD."))},t.updateCartEnabled=function(e){let t;t=(0,o.isMDBackend)()?(0,l.updateCartEnabled)(e):Promise.reject(new Error("This feature is only available for MD."));return t};var i=r(n(81109)),a=n(492574),o=n(88555),s=n(469845),l=n(461561),c=n(51486),u=n(453168),d=r(n(32428)),p=n(856149),f=r(n(656891));function _(e){let[t,n]=e;return t.map(((e,t)=>(0,i.default)((0,i.default)({},e),{},{profile:(0,i.default)((0,i.default)({},e.profile),{},{legal_entity_details:n[t]})})))}},740346:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryBusinessCategories=function(e){let t;const n=(0,o.phaseOutNotABusiness)();(0,a.qplPointProfileCatsView)("datasource_start"),t=(0,i.isMDBackend)()?(0,s.queryBusinessCategories)(e,n):l.default.queryBusinessCategories(e);return t.then((e=>((0,a.qplPointProfileCatsView)("datasource_end"),e))),t};var i=n(88555),a=n(669545),o=n(408139),s=n(545063),l=r(n(656891))},856149:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DIRECT_CONNECTION_FLAG=void 0,t.getBusinessProfileQueryVersion=function(){return a(i.ServerProps.webBizProfileOptions)},t.getBusinessProfileQueryVersionWithCustomBizProfileOptions=a;var r=n(408139),i=n(964551);t.DIRECT_CONNECTION_FLAG=128;function a(e){let t=247;return(0,r.bizLinkedAccountsEnabled)()&&(t|=256),e&t}},245741:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createLabelAssociationMutations=T,t.editLabelAssociation=function(e,t){let n;if((0,u.isMDBackend)()){t.some((e=>e instanceof h.default))&&(__LOG__(4,void 0,new Error,!0)`contact model is invalid for editLabelAssociation`,SEND_LOGS("contact model is invalid for editLabelAssociation")),n=S(e,t.map((e=>e instanceof g.Msg?{labelAssociationType:m.LabelAssociationType.Message,modelId:e.id.toString(),mutationIndexSegments:(0,f.constructMsgKeySegments)(e)}:{labelAssociationType:m.LabelAssociationType.Jid,modelId:e.id.toString(),mutationIndexSegments:[e.id.toString({legacy:!0})]})))}else n=_.default.addOrRemoveLabels(e,t).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status)}));return n},t.editLabelAssociationMD=S,t.editLocalLabelAssociationMD=E;var i=r(n(348926)),a=n(550073),o=n(381),s=n(960362),l=n(892844),c=n(492574),u=n(88555),d=n(408139),p=n(238804),f=n(293824),_=r(n(656891)),h=r(n(400121)),g=n(17304),m=n(82663),y=n(760980);function S(e,t){return(0,d.canEditLabelAssociation)()?(0,p.lockForSync)(["label-association"],T(e,t),(()=>E(e,t))):Promise.reject(new Error("editLabelAssociation is not supported"))}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e,t){const n=[],r=[];e.forEach((e=>{let{id:i,type:a}=e;t.map((e=>{let{modelId:t,labelAssociationType:o}=e;"add"===a?n.push({labelId:i,associationId:t,type:o}):r.push([i,t,o])}))}));const i=(0,m.getTable)();yield Promise.all([i.bulkCreateOrReplace(n).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkCreateOrReplace into label association table failed`,SEND_LOGS("bulkCreateOrReplace into label association table failed when saving label associations"),new Error("bulkCreateOrReplace into label association table failed")})),i.bulkRemove(r).catch((()=>{throw __LOG__(4,!0,new Error,!0)`bulkRemove from label association table failed`,SEND_LOGS("bulkRemove from label association table failed while saving label associations"),new Error("bulkRemove form label association table failed")}))])}))).apply(this,arguments)}function T(e,t){const n=(0,l.unixTimeMs)(),r=[];return e.forEach((e=>{let{id:i,type:l}=e;t.forEach((e=>{let{labelAssociationType:t,mutationIndexSegments:c}=e;const u=t===m.LabelAssociationType.Message?s.Actions.LabelMessage:s.Actions.LabelJid;r.push({timestamp:n,collection:s.CollectionName.Regular,operation:a.SyncdMutation$SyncdOperation.SET,index:JSON.stringify([u,i,...c]),version:s.LABEL_ASSOCIATION_SYNC_VERSION,binarySyncAction:(0,y.encodeProtobuf)(o.SyncActionValueSpec,{timestamp:n,labelAssociationAction:{labeled:"add"===l}}).readBuffer(),action:u})}))})),r}},968825:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrder=function(e,t){if((0,c.commerceFeaturesDisabledBySanctions)())return Promise.reject(new i.E451);let n;(0,s.qplPointOrderCreate)("datasource_start"),n=(0,a.isMDBackend)()?(0,u.attemptWithOrderDirectConnectionRetry)(e,(n=>(0,o.createOrderMD)(e,t,n))):d.default.createOrder(e.user,t);return n.then((()=>(0,s.qplPointOrderCreate)("datasource_end"))),n},t.queryOrder=function(e,t,n,r,o){if((0,c.commerceFeaturesDisabledBySanctions)())return Promise.reject(new i.E451);let p;(0,s.qplPointOrderView)("datasource_start"),p=(0,a.isMDBackend)()?(0,u.attemptWithDirectConnectionRetry)(e,(e=>(0,l.queryOrder)(t,n,r,o,e))):d.default.queryOrder(t,n,r,o);return p.then((()=>(0,s.qplPointOrderView)("datasource_end"))),p};var i=n(492574),a=n(88555),o=n(591097),s=n(669545),l=n(879327),c=n(408139),u=n(797951),d=r(n(656891))},621374:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addProduct=function(e,t,n){let r;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),r=(0,o.isMDBackend)()?(0,s.addProductMD)(e,t,n):A.default.addBusinessCatalogProduct(e,t,n);return r.then((()=>m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),r=r.then(I),r.catch((e=>{if(e instanceof a.ServerStatusCodeError&&406===e.statusCode||e instanceof a.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Add product failed, error: ${e}`,SEND_LOGS("Add product failed"),e}))},t.appealProduct=function(e,t){let n;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_start"),n=(0,o.isMDBackend)()?(0,l.appealProductMD)(e,t):A.default.appealCatalogProduct(e,t);return n.then((()=>m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_APPEAL,"datasource_end"))),(0,a.attachErrorLogger)(n,"Appeal product failed")},t.createCatalog=function(){let e;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_start"),e=(0,o.isMDBackend)()?(0,p.createProductCatalog)():A.default.createBusinessCatalog();return e.then((()=>{m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_CATALOG_CREATE,"datasource_end")})),(0,a.attachErrorLogger)(e,"Create catalog failed")},t.deleteProducts=function(e){let t;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_start"),t=(0,o.isMDBackend)()?(0,c.deleteProductsMD)(e):A.default.deleteBusinessCatalogProduct(e);return t=t.then((()=>m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_DELETE,"datasource_end"))),(0,a.attachErrorLogger)(t,"Delete product failed")},t.editProduct=function(e,t,n){let r;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_start"),r=(0,o.isMDBackend)()?(0,u.default)(e,t,n):A.default.editBusinessCatalogProduct(e,t,n);return r.then((()=>m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_SAVE,"datasource_end"))),r=r.then(I),r.catch((e=>{if(e instanceof a.ServerStatusCodeError&&406===e.statusCode||e instanceof a.CatalogEditServerError&&406===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Edit product failed, error: ${e}`,SEND_LOGS("Edit product failed"),e}))},t.mapMsgToProductModel=function(e){let t;e.businessOwnerJid&&(t=(0,T.createWid)(e.businessOwnerJid));return{catalogWid:t,id:e.productId||"",url:e.url,name:e.title,description:e.description,imageCdnUrl:e.mediaData.renderableUrl,reviewStatus:"",currency:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,productMsgMediaData:e.mediaData,imageCount:null!=e.productImageCount&&0!==e.productImageCount?e.productImageCount:1,fetchedFromServer:!1,t:e.t,isHidden:!1}},t.mapProductResponseToModel=I,t.parseDateValue=M,t.productVisibilitySet=function(e){let t;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_start"),t=(0,o.isMDBackend)()?(0,d.default)(e):A.default.productVisibilitySet(e);return t.then((()=>m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_SET_VISIBLE,"datasource_end"))),(0,a.attachErrorLogger)(t,"Product visibility change failed")},t.queryCatalog=function(e,t,n,r,i,s,l){let c;if((0,o.isMDBackend)())c=(0,C.attemptWithDirectConnectionRetry)(e,(a=>(0,y.default)({catalogWid:e,afterCursor:t,limit:n,width:r,height:i,checkmarkCollectionId:s,allowShopSource:l,directConnectionEncryptedInfo:a})));else{const a=e.toString({legacy:!0});c=A.default.queryProductCatalog(a,t,n,r,i,l)}return c.catch((e=>{if(e instanceof a.ServerStatusCodeError&&404===e.statusCode)throw e;throw __LOG__(4,!0,new Error,!0)`Query catalog failed, error: ${e}`,SEND_LOGS("Query catalog failed"),e}))},t.queryCatalogHasCategories=function(e){if((0,o.isMDBackend)())return(0,C.attemptWithDirectConnectionRetry)(e,(t=>(0,S.queryCatalogHasCategories)({catalogWid:e,directConnectionEncryptedInfo:t})));return Promise.resolve(!1)},t.queryProduct=function(e,t,n,r,i,s){let l;!0===s&&(0,f.qplPointProductView)("datasource_start"),l=(0,o.isMDBackend)()?(0,C.attemptWithDirectConnectionRetry)(e,(a=>(0,E.default)(e,t,n,r,i,a))):A.default.queryProduct(e.toString({legacy:!0}),t,n,r,i);return l.then((()=>!0===s&&(0,f.qplPointProductView)("datasource_end"))),(0,a.attachErrorLogger)(l,"Query product failed")},t.queryProductList=function(e,t,r,i,s){if((0,_.commerceFeaturesDisabledBySanctions)())return Promise.reject(new a.E451);let l;if(s&&(0,f.qplPointPLMDetailsView)("datasource_start"),(0,o.isMDBackend)()){const a=n(203292).getJobManager;l=(0,C.attemptWithDirectConnectionRetry)(e,(n=>a().waitUntilCompleted(h.jobSerializers.queryProductList(e,t,n,r,i))))}else{const n=e.toString({legacy:!0});l=A.default.queryProductList(n,t,r,i)}return l.then((()=>s&&(0,f.qplPointPLMDetailsView)("datasource_end"))).catch((e=>{if(451===e.errorCode)throw new a.E451})),l},t.reportProduct=function(e,t,n){let r;m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_start"),r=(0,o.isMDBackend)()?(0,v.default)(e,t,n):A.default.reportBusinessCatalogProduct(e,t,n);return r.then((()=>m.QPL.markerPoint(g.QuickLogMarkerId.WHATSAPP_PRODUCT_REPORT,"datasource_end"))),(0,a.attachErrorLogger)(r,"Report product failed")};var i=r(n(81109)),a=n(492574),o=n(88555),s=n(816179),l=n(360622),c=n(988132),u=r(n(665945)),d=r(n(100068)),p=n(235586),f=n(669545),_=n(408139),h=n(453168),g=n(665397),m=n(669393),y=r(n(615925)),S=n(904684),E=r(n(681588)),v=r(n(559175)),T=n(745454),C=n(797951),A=r(n(656891)),b=n(906822),P=r(n(730381));function O(e){return null==e?null:(0,o.isMDBackend)()?parseInt(e,10):10*parseInt(e,10)}function M(e){return e?P.default.utc(e,P.default.ISO_8601).valueOf():null}function I(e,t){var n,r;const a=(null===(n=e.capability_to_review_status[0])||void 0===n?void 0:n.value)||"APPROVED",o={catalogWid:t,id:e.id,isHidden:e.is_hidden||!1,url:e.url||"",name:e.name,description:e.description||"",availability:null!==(r=b.ProductAvailability.cast(e.availability))&&void 0!==r?r:b.ProductAvailability.UNKNOWN,maxAvailable:e.max_available,additionalImageCdnUrl:e.additional_image_cdn_urls.map((e=>e[1].value)),additionalImageHashes:e.image_hashes_for_whatsapp.slice(1),imageCdnUrl:e.image_cdn_urls[1].value,imageHash:e.image_hashes_for_whatsapp[0],reviewStatus:a,currency:e.currency,priceAmount1000:O(e.price),salePriceAmount1000:O(e.sale_price),salePriceStartDate:M(e.sale_start_date),salePriceEndDate:M(e.sale_end_date),retailerId:e.retailer_id||"",productMsgMediaData:null,imageCount:e.additional_image_cdn_urls.length+1,fetchedFromServer:!0,t:Date.now()/1e3,old:!1,canAppeal:e.whatsapp_product_can_appeal,checkmark:e.checkmark};return e.compliance_info&&(o.complianceInfo=function(e){const t={countryCodeOrigin:e.country_code_origin};e.importer_name&&(t.importerName=e.importer_name);e.importer_address&&(t.importerAddress=function(e){const t={street1:e.street1,city:e.city,countryCode:e.country_code};e.street2&&(t.street2=e.street2);e.postal_code&&(t.postalCode=e.postal_code);e.region&&(t.region=e.region);e.country_code&&(t.countryCode=e.country_code);return t}(e.importer_address));return t}(e.compliance_info)),(0,i.default)({},o)}},976892:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateQuickReply=function(e){let t=Promise.resolve();if((0,r.isMDBackend)()){const{id:n,shortcut:r,count:a,message:o,keywords:s}=e;t=(0,i.getQuickReplyTable)().createOrReplace({id:n,shortcut:r,count:a,message:o,keywords:s})}return t};var r=n(88555),i=n(776214)},572639:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,o.isMDBackend)()){if(t){const n=c.ContactCollection.gadd(e);(0,s.updateVerifiedInfo)(n,t.verifiedName)}}else l.default.queryVname(e).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))};var i=n(450796),a=n(492574),o=n(88555),s=n(880617),l=r(n(656891)),c=n(719380)},476931:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendChatStateComposing=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendChatstateComposing(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.default)(e,"composing"),Promise.resolve()},t.sendChatStatePaused=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendChatstatePaused(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.default)(e,"paused"),Promise.resolve()},t.sendChatStateRecording=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendChatstateRecording(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.default)(e,"recording"),Promise.resolve()};var i=n(492574),a=n(88555),o=r(n(224757)),s=r(n(656891))},932107:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addChatThreadLoggingActivities=function(e){return(0,r.handleActivitiesForChatThreadLogging)(e)},t.getChatThreadID=function(e,t){return(0,r.getChatThreadID)(e,t)};var r=n(217869)},391177:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearStorage=S,t.sendClear=function(e,t,r){if((0,u.isLegacyWebdBackend)())return _.default.sendConversationClear(e.id,t,!r).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status);return e}));return((0,d.clearOrDeleteChatSyncEnabled)()?function(){return v.apply(this,arguments)}(e,t,r):function(){return T.apply(this,arguments)}(e,r)).then(function(){var t=(0,a.default)((function*(t){if(null!=t.result&&t.result.length>0){const r=t.result;(0,f.deleteModelsForLastReactionPreview)(r);const i=n(203292).getJobManager;yield i().waitUntilPersisted(p.jobSerializers.deleteAddOns(e.id.toString(),r))}return t}));return function(){return t.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(381),l=n(892844),c=n(492574),u=n(88555),d=n(408139),p=n(453168),f=n(14571),_=r(n(656891)),h=r(n(169048)),g=n(438342),m=n(413946),y=n(484902);function S(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n)return(0,m.queryAndRemoveMessagesInMessageRange)(e.id,n,{skipStarred:t,skipRecentSystemMessages:!1});const r=yield(0,m.getBoundsForChat)(e.id),a=yield(0,m.queryAndRemoveMessageHistory)(e.id);return null==r&&__LOG__(3)`_sendClearMD: Expected to receive boundaries for chat while clearing`,h.default.purgeRange((0,i.default)({chatId:e.id.toString()},(0,o.default)(r,"rowIdBounds"))).catch((()=>{})),a}))).apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t,r){const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(n.bind(n,819937))]),o=n(129867).default,c=(0,l.unixTimeMs)(),u=yield o.getClearChatMutation(c,e.id,!r);let d;return yield i(["message"],[u],(0,a.default)((function*(){var t;yield(0,g.addActiveMessageRange)(e.id.toString(),(0,g.getActiveRangeAction)("clearChat",{deleteStarred:!r}),u.binarySyncAction);const n=null===(t=(0,y.decodeProtobuf)(s.SyncActionValueSpec,u.binarySyncAction).clearChatAction)||void 0===t?void 0:t.messageRange;d=yield S(e,r,n)}))),{_duplicate:null,result:d}}))).apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e,t){return{_duplicate:null,result:yield S(e,t)}}))).apply(this,arguments)}},991829:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return v.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(227101),s=n(88555),l=n(810635),c=n(966464),u=r(n(329224)),d=n(707122),p=n(108197),f=r(n(729783)),_=n(524606),h=n(728307),g=n(2259),m=n(669951),y=n(719380),S=n(448285),E=n(724319);function v(){return(v=(0,a.default)((function*(e,t,r){var i;const{forceUsync:a=!1,firstIncomingMsg:v,nextPrivacyMode:A,createdOffline:b=!1}=null!=r?r:{},P=!e.isUser()||!a||e.isLid()&&(0,g.testLidWaMeLinkEnabled)()?null:yield(0,c.getOrQueryUsyncInfo)(e),O=null==P?e:P.wid;if(!e.equals(O)){const e=m.ChatCollection.get(O);if(null!=e)return e}let M=null,I=!1;if(null!=P&&(null===(i=P.bizInfo)||void 0===i?void 0:i.verifiedName.isApi))I=!0;else if(null==P){const t=y.ContactCollection.get(e);null!=t&&t.isEnterprise&&(I=!0)}!I&&O.isUser()&&(0,o.isDisappearingModeEnabled)()&&(M=null==v||v.id.fromMe?(0,h.getDisappearingModeSettingForChat)(O):(0,h.getDisappearingModeSettingFromMsg)(v));const w=m.ChatCollection.gadd(T(O,null!=t?t:{},M)),R=P?(0,p.getPrivacyModeFromQueryExistResponse)(P):null,N=(0,p.getLatestPrivacyMode)(w.contact.privacyMode,(0,p.getLatestPrivacyMode)(A,R)),L=(0,u.default)(O,N),D=null!=M?(0,l.genDisappearingModeSystemMsg)(O,M.duration,M.initiator===_.DisappearingModeInitiator.InitiatedByMe):null;if((0,s.isLegacyWebdBackend)()){const e=n(926453).default;return e([{meta:{add:"relay"},chat:O,msg:L}]),null!=D&&e([{meta:{add:"relay"},chat:O,msg:D}]),w}const k=yield(0,E.getOrphanTcToken)(O.toString());var U,G,x;k&&(w.tcToken=null!==(U=k.tcToken)&&void 0!==U?U:null,w.tcTokenTimestamp=null!==(G=k.tcTokenTimestamp)&&void 0!==G?G:null,w.tcTokenSenderTimestamp=null!==(x=k.tcTokenSenderTimestamp)&&void 0!==x?x:null,yield(0,E.removeOrphanTcToken)(O.toString()));yield(0,S.createChat)(O,C(w));if(b){const e=[L,D].filter(Boolean);f.default.addOfflineMessage(e.map((e=>({msg:e}))))}else yield(0,d.handleSingleMsgMD)(L.from,L,false,false),null!=D&&(yield(0,d.handleSingleMsgMD)(D.from,D,false,false));return w}))).apply(this,arguments)}function T(e,t,n){let r=(0,i.default)({id:e},t);return null!=n&&(r=(0,i.default)((0,i.default)({},r),{},{ephemeralDuration:n.duration,ephemeralSettingTimestamp:n.settingTimestamp,disappearingModeInitiator:n.initiator})),r}function C(e){return{id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:null!=e.changeNumberOldJid?e.changeNumberOldJid.toString():void 0,changeNumberNewJid:null!=e.changeNumberNewJid?e.changeNumberNewJid.toString():void 0,muteExpiration:e.muteExpiration,endOfHistoryTransferType:(e.endOfHistoryTransferType,e.endOfHistoryTransferType),ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp,disappearingModeInitiator:(e.disappearingModeInitiator,e.disappearingModeInitiator),tcToken:null!=e.tcToken?e.tcToken:void 0,tcTokenTimestamp:null!=e.tcTokenTimestamp?e.tcTokenTimestamp:void 0,tcTokenSenderTimestamp:null!=e.tcTokenSenderTimestamp?e.tcTokenSenderTimestamp:void 0}}},377772:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteFromStorage=function(e){return(0,E.getStorage)().lock(["chat","label-association","message"],(0,a.default)((function*(){const t=yield(0,y.getBoundsForChat)(e),[n,r,i]=yield Promise.all([(0,h.getChatTable)().remove(e.toString()),(0,y.queryAndRemoveMessageHistory)(e),T(e)]);return{chatBoundaries:t,deletedMsgIds:r}}))).then(function(){var t=(0,a.default)((function*(t){let{chatBoundaries:r,deletedMsgIds:a}=t;if(r){_.default.purgeRange((0,i.default)({chatId:e.toString()},r)),(0,d.deleteModelsForLastReactionPreview)(a);const t=n(203292).getJobManager;yield t().waitUntilPersisted(u.jobSerializers.deleteAddOns(e.toString(),a))}else __LOG__(3)`sendConversationDelete: chat boundaries was null`}));return function(){return t.apply(this,arguments)}}())},t.sendConversationDelete=function(e,t,r){if((0,l.isLegacyWebdBackend)())return p.default.sendConversationDelete(e,t);let i=Promise.resolve({status:400,_duplicate:!1});if((0,c.clearOrDeleteChatSyncEnabled)())i=P(e,!0);else{const n=r();(t&&t.equals(n)||t===n)&&(i=P(e,!1))}return i.then(function(){var t=(0,a.default)((function*(t){if(null!=t.result&&t.result.length>0){const r=t.result;(0,d.deleteModelsForLastReactionPreview)(r);const i=n(203292).getJobManager;return yield i().waitUntilPersisted(u.jobSerializers.deleteAddOns(e.toString(),r)),t}return t}));return function(){return t.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(348926)),o=n(381),s=n(892844),l=n(88555),c=n(408139),u=n(453168),d=n(14571),p=r(n(656891)),f=n(245741),_=r(n(169048)),h=n(776214),g=n(438342),m=n(154598),y=n(413946),S=n(82663),E=n(799069),v=n(484902);function T(){return C.apply(this,arguments)}function C(){return(C=(0,a.default)((function*(e){if(!(0,c.canEditLabelAssociation)())return;const{labelsToUpdate:t,modelRecords:n}=yield A(e);yield(0,f.editLocalLabelAssociationMD)(t,n)}))).apply(this,arguments)}function A(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){return{labelsToUpdate:(yield(0,m.queryLocalLabelAssociation)([{associationId:e.toString(),type:S.LabelAssociationType.Jid}])).map((e=>{let{labelId:t}=e;return{id:t,type:"remove"}})),modelRecords:[{labelAssociationType:S.LabelAssociationType.Jid,modelId:e.toString(),mutationIndexSegments:[e.toString({legacy:!0})]}]}}))).apply(this,arguments)}function P(){return O.apply(this,arguments)}function O(){return(O=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const[{lockForMessageRangeSync:i},{default:l}]=yield Promise.all([Promise.resolve().then(n.bind(n,819937)),Promise.resolve().then(n.bind(n,536014))]),u=n(256928).default,d=(0,s.unixTimeMs)(),[p,f,_]=yield Promise.all([u.getDeleteChatMutation(d,e,!r),l.getPinMutation(d,!1,e),M(e)]),m=[..._];let S;return(0,c.pinChatSyncEnabled)()&&m.push(f),t&&m.push(p),yield i(["message","chat","label-association","group-metadata"],m,(0,a.default)((function*(){var n;t&&(yield(0,g.addActiveMessageRange)(e.toString(),(0,g.getActiveRangeAction)("deleteChat",{deleteMedia:!r}),p.binarySyncAction));const i=null===(n=(0,v.decodeProtobuf)(o.SyncActionValueSpec,p.binarySyncAction).deleteChatAction)||void 0===n?void 0:n.messageRange;i&&(S=yield(0,y.queryAndRemoveMessagesInMessageRange)(e,i),yield Promise.all([(0,h.getChatTable)().remove(e.toString()),(0,h.getGroupMetadataTable)().remove(e.toString()),T(e)]))}))),{status:200,_duplicate:!1,result:S}}))).apply(this,arguments)}function M(){return I.apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e){if(!(0,c.canEditLabelAssociation)())return[];const{labelsToUpdate:t,modelRecords:n}=yield A(e);return(0,f.createLabelAssociationMutations)(t,n)}))).apply(this,arguments)}},211082:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(){return c.apply(this,arguments)},t.findLocal=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=r(n(656891)),s=n(464448),l=n(68638);function c(){return(c=(0,i.default)((function*(e,t){const n=performance.now(),r=yield o.default.chatFindQuery(e,(e=>{t.binarySize=e.binarySize}));return"preempted"!==r&&(t.timing=Math.ceil(performance.now()-n),t.size=r.length),r}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)())return null;const t=yield(0,l.getTable)().get(e);return t?(0,s.hydrateWids)(t):null}))).apply(this,arguments)}},909025:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getExisting=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(211082),s=n(669951);function l(){return(l=(0,i.default)((function*(e){const t=s.ChatCollection.get(e);if(t&&!t.stale)return t;if((0,a.isLegacyWebdBackend)())return null;const n=yield(0,o.findLocal)(e.toString());return n?s.ChatCollection.gadd(n):null}))).apply(this,arguments)}},111902:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setLastReceivedKey=function(){return Promise.resolve()}},745197:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendConversationMute=function(e,t,n){let r=Promise.resolve();if((0,a.isMDBackend)()){const n=o.default.generateMuteMutation(e,t);r=(0,s.lockForSync)(["chat"],[n],(n=>{let[r]=n;return r.merge(e.toString(),{muteExpiration:t})})).then((()=>({status:200})))}else r=l.default.sendConversationMute(e,t,n).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status);return e}));return r};var i=n(492574),a=n(88555),o=r(n(170119)),s=n(238804),l=r(n(656891))},203060:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.resyncMessages=function(){return c.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(88555),s=r(n(656891)),l=n(799069);function c(){return(c=(0,a.default)((function*(e){const t=yield s.default.resyncMessages(e);if((0,o.isMDBackend)()&&(!t.status||t.status<400)){const{data:e}=t,r=[],o=[];return e.forEach((e=>{n(669951).ChatCollection.get(e.id)?"clear"===e.type?r.push({id:e.id.toString(),t:e.t,unreadCount:e.unreadCount,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,notSpam:e.notSpam,pin:e.pin,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid,muteExpiration:e.muteExpiration,ephemeralDuration:e.ephemeralDuration,ephemeralSettingTimestamp:e.ephemeralSettingTimestamp}):"delete"===e.type?o.push(e.id.toString()):r.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()})):r.push((0,i.default)((0,i.default)({},e),{},{id:e.id.toString()}))})),(0,l.getStorage)().lock(["chat"],function(){var e=(0,a.default)((function*(e){let[t]=e;return yield t.bulkCreateOrMerge(r),t.bulkRemove(o)}));return function(){return e.apply(this,arguments)}}()).then((()=>t)).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get storage or bulk update chats failed`,SEND_LOGS("get storage or bulk update chats failedwhen re-sync messages"),new Error("get storage or bulk update chats failed")}))}return t}))).apply(this,arguments)}},297848:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.markConversationSeen=function(e,t){if((0,s.isLegacyWebdBackend)())return Promise.resolve();return(0,d.getChatTable)().merge(e.toString(),{unreadCount:t}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark convestation seen"),new Error("update chat table failed")}))},t.markConversationUnseen=function(e){if((0,s.isLegacyWebdBackend)())return Promise.resolve();return(0,d.getChatTable)().merge(e.toString(),{unreadCount:-1}).catch((e=>{if(e instanceof l.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when mark conversation as unseen"),new Error("update chat table failed")}))},t.sendConversationSeen=function(){return _.apply(this,arguments)},t.sendConversationUnseen=function(e,t){if((0,s.isLegacyWebdBackend)())return u.default.sendConversationUnseen(e,t).then((e=>{const{status:t}=e;if(200!==t)throw new o.ServerStatusCodeError(t)}));return Promise.all([Promise.resolve().then(n.bind(n,819937))]).then((t=>{let[{lockForMessageRangeSync:r}]=t;const i=n(464294).default,o=(0,a.unixTimeMs)();return i.getMarkChatAsReadMutation(o,!1,e).then((t=>r([],[t],(()=>(0,p.addActiveMessageRange)(e.toString(),"markChatAsRead",t.binarySyncAction)))))}))};var i=r(n(348926)),a=n(892844),o=n(492574),s=n(88555),l=n(435232),c=n(348918),u=r(n(656891)),d=n(776214),p=n(438342),f=n(448285);function _(){return(_=(0,i.default)((function*(e,t,r){if((0,s.isLegacyWebdBackend)()){const n=yield u.default.sendConversationSeen(e.id,t,r),{status:i,_duplicate:a}=n;if(200!==i)throw new o.ServerStatusCodeError(i);return{_duplicate:a}}const[{lockForMessageRangeSync:i}]=yield Promise.all([Promise.resolve().then(n.bind(n,819937))]),l=n(464294).default,d=(0,a.unixTimeMs)();if(-1===r){const t=yield l.getMarkChatAsReadMutation(d,!0,e.id),n=e.id.toString();i([],[t],(()=>(0,p.addActiveMessageRange)(e.id.toString(),"markChatAsRead",t.binarySyncAction))),yield(0,f.updateChatForMarkAsReadSync)(n)}else yield(0,c.markChatRead)(e,t);return{_duplicate:!1}}))).apply(this,arguments)}},469694:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendStarMsgs=function(e,t,n){if((0,o.isLegacyWebdBackend)())return l.default.sendMessageStarred(e,t.map((e=>e.id)),n).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status)}));return d(t,n)},t.sendUnstarAll=function(e,t){if((0,o.isLegacyWebdBackend)())return l.default.sendUnstarAll(t).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status)}));return d(e,!1)};var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(607414)),a=n(492574),o=n(88555),s=n(238804),l=r(n(656891)),c=n(584886);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e,t){t||i.addUnsetActionCount(e.length);const r=n(721263).default.getStarMessageMutations(e,t);return(0,s.lockForSync)(["message"],r,(()=>t?(0,c.starMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`star messages failed`,SEND_LOGS("star messages failed"),new Error("star messages failed")})):(0,c.unstarMessages)(e.map((e=>e.id.toString()))).catch((()=>{throw __LOG__(4,!0,new Error,!0)`unstar messages failed`,SEND_LOGS("unstar messages failed"),new Error("unstar messages failed")}))))}},358871:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if((0,r.isLegacyWebdBackend)())return Promise.resolve();return(0,a.getTable)().merge(e.toString(),t).catch((e=>{if(e instanceof i.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error,!0)`update chat table failed`,SEND_LOGS("update chat table failed when update local"),new Error("update chat table failed")}))};var r=n(88555),i=n(435232),a=n(68638)},130312:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendSetBlock=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(492574),o=n(88555),s=n(124578),l=r(n(656891)),c=n(776214);function u(){return(u=(0,i.default)((function*(e,t){if((0,o.isLegacyWebdBackend)())return l.default.sendSetBlock(e,[{jid:t}]).then((e=>{if(200!==e.status)throw new a.ServerStatusCodeError(e.status);return!(e._duplicate||200!==e.status)}));const n=e?(0,s.blockUser)(t):(0,s.unblockUser)(t);yield n.then((e=>{if(e&&null!=e.errorCode)throw new a.ServerStatusCodeError(e.errorCode,e.errorText)}));try{const n=t.toString();return e?yield(0,c.getBlocklistTable)().createOrReplace({id:n}):yield(0,c.getBlocklistTable)().remove(t.toString()),!0}catch(e){throw __LOG__(4,!0,new Error,!0)`send set block failed`,SEND_LOGS("Failed to send set block"),new Error("send set block failed")}}))).apply(this,arguments)}},545873:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setChecksum=function(e){(0,r.isMDBackend)()&&(0,i.setContactChecksum)(e);return Promise.resolve()};var r=n(88555),i=n(233776)},400189:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.contactSync=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(984598),s=n(745454),l=n(776214);function c(){return(c=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)())return;const t=yield(0,l.getContactTable)().all();if(t.length>0){const n=t.map((e=>(0,s.createWid)(e.id)));return(0,o.syncContactListInChunksJob)(n,e)}}))).apply(this,arguments)}},908071:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setFrequent=function(e){const t={};Object.keys(e).forEach((n=>{t[n]=e[n].map((e=>e.toString()))})),(0,r.isMDBackend)()&&(0,i.setFrequentContacts)(t);return Promise.resolve()};var r=n(88555),i=n(233776)},102253:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setPresenceAvailable=function(){if((0,o.isLegacyWebdBackend)())return void p.default.sendPresenceAvailable().catch((0,i.filteredCatch)([a.WebdDrop,s.ProtoVersionUndefined],(()=>{})));(0,l.default)("available")},t.setPresenceUnavailable=function(){if((0,o.isLegacyWebdBackend)())return void p.default.sendPresenceUnavailable().catch((0,i.filteredCatch)([a.WebdDrop,s.ProtoVersionUndefined],(()=>{})));(0,l.default)("unavailable")},t.subscribePresence=function(e,t){if((0,o.isLegacyWebdBackend)())return p.default.subscribePresence(e);let n;n=e instanceof u.default?e:(0,d.createWid)(e);return Promise.resolve((0,c.default)(n,t))};var i=n(450796),a=n(492574),o=n(88555),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=r(n(133233)),c=r(n(930228)),u=r(n(389867)),d=n(745454),p=r(n(656891));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}},78426:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.profilePicFind=C,t.profilePicFindThumbFromPhone=function(){return T.apply(this,arguments)},t.profilePicResync=function(){return b.apply(this,arguments)},t.profilePicThumbEURLFromDB=function(){return O.apply(this,arguments)},t.requestDeletePicture=function(){return E.apply(this,arguments)},t.sendSetPicture=function(){return v.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(615688),s=r(n(145095)),l=n(257243),c=n(492574),u=n(88555),d=n(160106),p=r(n(511659)),f=r(n(376139)),_=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(266333)),h=r(n(656891)),g=n(241601),m=n(776214),y=n(799069);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function E(){return(E=(0,a.default)((function*(e){let t;t=(0,u.isMDBackend)()?(0,p.default)(e,null).then((()=>({_duplicate:!1,status:200}))):h.default.deletePicture(e).then((e=>{if(e.status&&200!==e.status)throw new c.ServerStatusCodeError(e.status);return e}));const r=yield t;if(r._duplicate)return r;if((0,u.isMDBackend)()){return((0,l.getABPropConfigValue)("web_profile_picture_db_cache_disabled")?Promise.resolve():(0,m.getProfilePicThumbTable)().remove(e.toString())).then((()=>{(0,n(373232).changeProfilePicThumb)(e,g.PROFILE_PIC_COMMAND.REMOVE)})).then((()=>r))}return r}))).apply(this,arguments)}function v(){return(v=(0,a.default)((function*(e,t,r){let i;if((0,u.isMDBackend)()){const t=f.default.parseDataURL(r).data,n=(0,o.decodeB64)(t);i=(0,p.default)(e,n).then((0,a.default)((function*(){const t=yield(0,d.getProfilePic)(e,{preview:!1});return{_duplicate:!1,tag:t.tag,eurl:t.eurl,token:"",status:200}})))}else i=h.default.sendSetPicture(e,t,r).then((e=>{if(200!==e.status)throw new c.ServerStatusCodeError(e.status);return e}));const s=yield i,_=yield P(e);if(s.token=_,s._duplicate)return s;if((0,u.isMDBackend)()){const t=e.toString();return((0,l.getABPropConfigValue)("web_profile_picture_db_cache_disabled")?Promise.resolve():(0,m.getProfilePicThumbTable)().createOrMerge(t,{id:t,tag:s.tag,eurl:s.eurl})).then((()=>{(0,n(373232).changeProfilePicThumb)(e,g.PROFILE_PIC_COMMAND.SET)})).then((()=>s))}return s}))).apply(this,arguments)}function T(){return(T=(0,a.default)((function*(e,t){const n=yield h.default.profilePicFindThumbFromPhone(e,t),r=yield P(e);if(n.token=r,(0,u.isMDBackend)()){const e=n.id.toString();return((0,l.getABPropConfigValue)("web_profile_picture_db_cache_disabled")?Promise.resolve():(0,m.getProfilePicThumbTable)().createOrMerge(e,{id:e,tag:n.tag,raw:n.raw})).then((()=>n))}return n}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,a.default)((function*(e,t){let n;if(n=(0,u.isMDBackend)()?Promise.all([(0,d.getProfilePic)(e,(0,i.default)((0,i.default)({},t),{},{preview:!1})),(0,d.getProfilePic)(e,(0,i.default)((0,i.default)({},t),{},{preview:!0}))]).then((e=>{const t=e[0],n=e[1];return{eurl:t.eurl,tag:t.tag,previewEurl:n.eurl,token:""}})):h.default.profilePicFind(e).then((e=>{if(null!=e.status&&200!==e.status)throw new c.ServerStatusCodeError(e.status);return e})),(0,l.getABPropConfigValue)("web_profile_picture_db_cache_disabled"))return n;const r=t=>(0,y.getStorage)().lock(["profile-pic-thumb"],function(){var n=(0,a.default)((function*(n){let[r]=n;return(yield r.get(e.toString()))?r.merge(e.toString(),t):r.create(t)}));return function(){return n.apply(this,arguments)}}()),o={id:e.toString(),tag:void 0,eurl:void 0,raw:void 0,previewEurl:void 0};try{const t=yield(0,s.default)(n,"serverPromise");return P(e).then((e=>(t.token=e,(0,u.isMDBackend)()?(o.tag=t.tag,o.eurl=t.eurl,o.raw=null,o.previewEurl=t.previewEurl,r(o).then((()=>t))):t)))}catch(e){if(!(e instanceof c.ServerStatusCodeError))throw e;if((0,u.isLegacyWebdBackend)())throw e;return(0,u.isMDBackend)()&&404===e.status||(0,u.isLegacyWebdBackend)()&&401===e.status?(o.tag="",o.raw=null):(o.tag=null,o.eurl=null,o.previewEurl=null),r(o).then((()=>{throw e}))}}))).apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){if((0,u.isMDBackend)())return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{const t=yield C(e.id);return{id:e.id,eurl:t.eurl,tag:t.tag,token:t.token,previewEurl:t.previewEurl}}catch(t){if(t instanceof c.ServerStatusCodeError)switch(t.status){case 401:case 404:return{id:e.id,tag:"",token:""};default:return __LOG__(3)`ProfilePicThumb:resyncPictures error - ${t.status}, ${t.message}`,{id:e.id,token:""}}throw t}}));return function(){return e.apply(this,arguments)}}()));const t=yield h.default.resyncPictures(e);return Array.isArray(t)?Promise.all(t.map(function(){var e=(0,a.default)((function*(e){const t=yield P(e.id);return(0,i.default)((0,i.default)({},e),{},{token:t})}));return function(){return e.apply(this,arguments)}}())):"number"==typeof t.status&&t.status>=400?(423!==t.status&&429!==t.status&&__LOG__(3)`ProfilePicThumbStore:resyncPictures error ${t.status}`,Promise.reject(new c.ServerStatusCodeError(t.status))):(__LOG__(3)`ProfilePicThumbStore:resyncPictures unknown reply`,Promise.reject(new Error("ProfilePicThumbStore:resyncPictures unknown reply")))}))).apply(this,arguments)}function P(e){if((0,u.isMDBackend)())return Promise.resolve("");const t=String(e),n=new ArrayBuffer(2*t.length),r=new Uint16Array(n);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return Promise.resolve().then((()=>_.getSecurityToken(n)))}function O(){return(O=(0,a.default)((function*(e){const t=yield(0,m.getProfilePicThumbTable)().get(e.toString());return(null==t?void 0:t.eurl)||""}))).apply(this,arguments)}},57547:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryExists=function(e){const t=e.isLid()?"":`+${e.toString()}`;if((0,o.isLegacyWebdBackend)())return e.isLid()?(__LOG__(4,void 0,new Error,!0)`Can not query lid in non-md`,SEND_LOGS("queryExists-non-md-lid-query"),Promise.resolve()):Promise.all([l.default.queryExist(t),(0,a.isDisappearingModeEnabled)()?l.default.queryDisappearingMode(e):Promise.resolve()]).then((e=>{let[t,n]=e,r=null;if(200===t.status&&(r={wid:t.jid,biz:t.biz||!1}),null!=r&&null!=n&&200===n.status){const e=n.duration,t=n.settingTimestamp;r=(0,i.default)({disappearingMode:{duration:e,settingTimestamp:t}},r)}return r}));if(e.isLid())return(0,s.queryExist)({type:"lid",wid:e});return(0,s.queryExist)({type:"phone",phone:t})},t.queryPhoneExists=function(e){if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("Should Not Reach queryPhoneExists preMD"));return(0,s.queryExist)({type:"phone",phone:e})};var i=r(n(81109)),a=n(227101),o=n(88555),s=n(695434),l=r(n(656891))},188129:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactsToRemove=function(e){const t=[],i={};return e.forEach((e=>{e&&(i[e.id]=!0)})),r.ContactCollection.forEach((e=>{const{id:r}=e;!(e.isUser||e.isGroup&&!n(669951).ChatCollection.get(r))||i[r.toString()]||e.isPSA||t.push(e)})),t};var r=n(719380)},526707:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMessageReport=function(e,t){if((0,a.isLegacyWebdBackend)())return Promise.resolve();return(0,o.reportSpam)(e.chat,t,e).then((e=>{if(null==e?void 0:e.errorCode)throw new i.ServerStatusCodeError(e.errorCode,e.errorText)}))},t.sendNotSpam=function(e){if((0,a.isLegacyWebdBackend)())return s.default.sendConversationNotSpam(e.id).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,l.getChatTable)().merge(e.id.toString(),{notSpam:!0}).catch((()=>{throw __LOG__(4,!0,new Error,!0)`get chat table merge failed`,SEND_LOGS("get chat table merge failed when sending spam report"),new Error("get chat table merge failed")}))},t.sendSpamReport=function(e,t){if((0,a.isLegacyWebdBackend)())return s.default.sendSpamReport(e.id).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status)}));return(0,o.reportSpam)(e,t).then((e=>{if(null==e?void 0:e.errorCode)throw new i.ServerStatusCodeError(e.errorCode,e.errorText)}))};var i=n(492574),a=n(88555),o=n(993614),s=r(n(656891)),l=n(776214)},546898:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getStatus=function(e){if((0,l.isLegacyWebdBackend)())return p.default.statusFind(e).then((t=>({id:e,status:null!=t.status?t.status:""}))).catch((0,a.filteredCatch)(s.WebdDrop,(()=>({id:e,stale:!0,status:""}))));return(0,c.default)(e).then((e=>e.error?(__LOG__(3)`getStatus: failed ${e.error.errorCode} : ${e.error.errorText}`,{id:e.id,stale:!0,status:""}):{id:e.id,status:null!=e.status?e.status:""}))},t.queryStatusAll=function(){if((0,l.isLegacyWebdBackend)())return p.default.statusQuery();return(0,f.queryStatusAllMD)()},t.queryStatusUpdate=function(e,t,n){if((0,l.isLegacyWebdBackend)())return p.default.statusQuery(e,t,n,"after");return Promise.resolve([])},t.sendReadStatus=function(){return _.apply(this,arguments)},t.setMyStatus=function(e){if((0,l.isLegacyWebdBackend)())return p.default.sendSetStatus(e);return(0,n(203292).getJobManager)().waitUntilCompleted(u.jobSerializers.setAbout(e))};var i=r(n(348926)),a=n(450796),o=n(535470),s=n(492574),l=n(88555),c=r(n(238383)),u=n(453168),d=n(348918),p=r(n(656891)),f=n(706331);function _(){return(_=(0,i.default)((function*(e,t){const n=e.id;if((0,l.isLegacyWebdBackend)()){return 200===(yield p.default.sendStatusSeen(n,e.author)).status}try{return yield(0,d.markStatusRead)(n,t),e.ack=o.ACK.READ,!0}catch(e){return!1}}))).apply(this,arguments)}},27211:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=function(e,t){if((0,r.isLegacyWebdBackend)())return Promise.resolve();return(0,a.getTable)().merge((0,i.toPhoneUserJid)(e.user),t)};var r=n(88555),i=n(272441),a=n(4233)},79583:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendCreateGroup=function(e,t,n,r,l,c,u,d){if((0,a.isLegacyWebdBackend)())return s.default.createGroup(e,t,n,r,l,c,u).then((e=>{if(200===e.status)return e;throw new i.ServerStatusCodeError(e.status)}));return(0,o.createGroup)(e,t,u,d).then((e=>({gid:e.wid,participants:e.participants.map((e=>({[e.wid.toString()]:{code:null!=e.error?e.error.toString():"200",invite_code:e.invite_code,invite_code_exp:e.invite_code_exp}})))})))};var i=n(492574),a=n(88555),o=n(308998),s=r(n(656891))},990447:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.markExited=function(e){if((0,a.isLegacyWebdBackend)())return Promise.resolve();return(0,l.getTable)().merge(e.toString(),{isReadOnly:!0})},t.sendExitGroup=function(e){if((0,a.isLegacyWebdBackend)())return s.default.leaveGroup(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status);return{_duplicate:e._duplicate}}));return(0,o.leaveGroups)([e]).then((()=>({_duplicate:null})))};var i=n(492574),a=n(88555),o=n(507280),s=r(n(656891)),l=n(68638)},35270:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.findGroupMetadata=function(){return f.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(88555),s=n(104622),l=n(368082),c=n(408139),u=n(312889),d=n(810790),p=n(395716);function f(){return(f=(0,a.default)((function*(e){if((0,o.isMDBackend)()){let o=null,h=null,g=null,m=()=>{};const y=n(963928).default.get(e);if(y){if(y.participantQueryPromise)return __LOG__(2)`findGroupMetadata: ${e} - pending participant query`,y.participantQueryPromise.then((()=>({id:e})));y.participantQueryPromise=new Promise((e=>{m=e})),g=y.unjoinedSubgroups}else{var t;if(o=yield(0,l.getGroupMetadataJob)(e),!o)return __LOG__(2)`findGroupMetadata: ${e} - query missing group participant`,_(e);(0,d.updateSubject)(e,null!==(t=o.subject)&&void 0!==t?t:""),g=o.unjoinedSubgroups}try{var r,a,f;if(!(y&&0!==y.participants.length||(h=yield(0,l.getGroupParticipantJob)(e),h)))return __LOG__(2)`findGroupMetadata: ${e} - query missing group participant`,_(e);const t=(0,i.default)((0,i.default)({id:e},o),{},{participants:null===(r=h)||void 0===r?void 0:r.participants,pastParticipants:null===(a=h)||void 0===a?void 0:a.pastParticipants,deviceStale:h?h.staleType===s.STALE_TYPES.DEVICE:void 0});if((null===(f=h)||void 0===f?void 0:f.staleType)===s.STALE_TYPES.PARTICIPANT){__LOG__(2)`findGroupMetadata: ${e} - query stale group participant`;const n=yield _(e);null!=(null==n?void 0:n.participants)&&(t.participants=n.participants)}if((0,c.communitiesEnabled)()&&null!=g&&g.length>0){const t=(yield(0,p.getUnjoinedSubgroupsMetadataFromStorage)(g)).filter(Boolean);(0,u.updateUnjoinedSubgroupsInCollection)(t.map((e=>(0,u.dbAsUpdate)(e))),e)}return t}finally{m(),y&&(y.participantQueryPromise=null)}}return _(e)}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,a.default)((function*(e){var t;const n=yield(0,d.sendQueryGroup)(e);return(0,d.updateSubject)(e,null!==(t=null==n?void 0:n.subject)&&void 0!==t?t:""),n}))).apply(this,arguments)}},364808:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendJoinGroupViaInviteV4=function(e,t,n,r){return(0,o.joinGroupViaInviteV4)(e,t,n,r)},t.sendQueryGroupInviteV4=function(){return s.apply(this,arguments)},t.sendRevokeGroupInviteV4=function(e,t){return(0,o.revokeGroupInviteV4)(e,t)};var i=r(n(81109)),a=r(n(348926)),o=n(116382);function s(){return(s=(0,a.default)((function*(e,t,n,r,a){const s=yield(0,o.queryGroupInviteV4)(e,t,n,r,a);return null!=s.groupMetadata?(0,i.default)({},s.groupMetadata):{status:s.status}}))).apply(this,arguments)}},393717:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.revokeGroupInvitesV4=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(76581),s=n(559871),l=n(562415),c=n(584886);function u(){return(u=(0,i.default)((function*(e,t,n,r){if((0,a.isLegacyWebdBackend)())return Promise.resolve();const i=yield(0,l.revokeGroupInvites)(e,t,n,r),u=(null==i?void 0:i.map((e=>e.id)))||[];(yield(0,o.msgFindByIds)(u)).map((e=>{var t;null===(t=s.MsgCollection.get(e.id))||void 0===t||t.set({inviteCodeExp:"0"}),e.inviteCodeExp="0",(0,c.updateExistingMessages)([e],e.id.remote)}))}))).apply(this,arguments)}},810790:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.groupMetadataFindFromPhone=function(e){if((0,l.isLegacyWebdBackend)())return d.default.groupMetadataFindFromPhone(e);return Promise.reject(new Error("groupMetadataFindFromPhone: not supported in MD backend mode"))},t.sendQueryGroup=function(){return f.apply(this,arguments)},t.sendQueryGroupInvite=function(e){if((0,l.isLegacyWebdBackend)())return d.default.groupInviteInfo(e).then((e=>{if(200!==e.status)throw new s.ServerStatusCodeError(e.status);return e}));return(0,u.queryGroupInvite)(e).then((e=>(0,i.default)({status:200},e)))},t.updateSubject=_;var i=r(n(81109)),a=r(n(348926)),o=n(551737),s=n(492574),l=n(88555),c=n(395486),u=n(639133),d=r(n(656891)),p=n(719380);function f(){return(f=(0,a.default)((function*(e){let t;(0,l.isMDBackend)()?(__LOG__(2,void 0,void 0,void 0,["groups"])`querying server for groupMetadata of group id ${e.toString()}`,t=(0,c.queryGroupJob)(e)):t=d.default.groupMetadataFind(e);try{const n=yield t;if(n.id)return _(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,desc:n.desc,descId:n.descId,descOwner:n.descOwner,descTime:n.descTime,restrict:n.restrict||!1,announce:n.announce||!1,noFrequentlyForwarded:n.noFrequentlyForwarded||!1,ephemeralDuration:n.ephemeralDuration||0,participants:n.participants,support:!0===n.support};__LOG__(3)`Store:GroupMetadata Unexpected server response`}catch(t){if(t instanceof s.ServerStatusCodeError&&t.status>=400)return{id:e,stale:!1};throw t}}))).apply(this,arguments)}function _(e,t){(0,o.isString)(t)&&p.ContactCollection.find(e).then((function(e){e.name||e.set({name:t})}))}},909530:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isConnectedAsRegistered=s,t.isLoggedIn=function(){if((0,r.isLegacyWebdBackend)())return!!(0,i.getLoginTokens)().server;return(0,a.isRegistered)()&&s()},t.setIsConnectedAsRegistered=function(e){o=e};var r=n(88555),i=n(555452),a=n(711597);let o=!1;function s(){return o}},804121:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryServerProps=function(){if((0,a.isLegacyWebdBackend)())return s.default.queryServerProps();return(0,o.default)().then((e=>{if(e.success)return e.result;throw new i.ServerStatusCodeError(e.errorCode,e.errorText)}))};var i=n(492574),a=n(88555),o=r(n(174004)),s=r(n(656891))},713611:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMediaConn=function(e){return(0,o.backoff)({delay:e=>{let{taskDuration:t}=e;const n=1e3*p();return Math.max(n-t,0)},signal:e},function(){var t=(0,a.default)((function*(t){let n;n=(0,c.isMDBackend)()?(0,u.queryMediaConn)(e):d.default.queryMediaConnections(e);try{const e=yield n;let{ttl:t,authTTL:r}=e;return null==r?(r=1e3*t,t=3e5):(r*=1e3,t*=1e3),(0,i.default)((0,i.default)({},e),{},{authTTL:r,ttl:t})}catch(e){if(e instanceof l.E507)throw e;if(e instanceof l.ServerStatusCodeError&&e.status>=500)return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(348926)),o=n(918925),s=n(237178),l=n(492574),c=n(88555),u=n(520252),d=r(n(656891));const p=(0,s.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:9e5,jitter:.25})},284159:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=r(n(656891)),s=n(303151),l=n(16258);function c(e){if(null!=e)switch(e){case l.MediaRetryNotification$ResultType.SUCCESS:return 200;case l.MediaRetryNotification$ResultType.NOT_FOUND:case l.MediaRetryNotification$ResultType.DECRYPTION_ERROR:return 404;case l.MediaRetryNotification$ResultType.GENERAL_ERROR:return 500}return 500}function u(){return(u=(0,i.default)((function*(e){if((0,a.isLegacyWebdBackend)()){const{status:t,url:n,mediaKey:r,mediaKeyTimestamp:i,encFilehash:a,directPath:s}=yield o.default.requestMediaReupload(e);return{isMD:!1,status:t,url:n,mediaKey:r,mediaKeyTimestamp:i,encFilehash:a,directPath:s}}return s.RequestMediaReuploadManager.requestMediaReupload(e).then((e=>{let{result:t,directPath:n}=e;return{status:c(t),directPath:n,isMD:!0}}))}))).apply(this,arguments)}},197563:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateLocal=s,t.updateLocalAndModel=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(290981);function s(e,t){return(0,a.isLegacyWebdBackend)()?Promise.resolve():(0,o.getTable)().merge(e.toString(),t).catch((e=>{throw __LOG__(4,!0,new Error,!0)`updateLocal: failed to update in storage`,SEND_LOGS("message updateLocal failed"),e}))}function l(){return(l=(0,i.default)((function*(e,t){try{yield s(e,t);const r=n(559871).MsgCollection.get(e);r&&r.set(t)}catch(e){return Promise.reject(new Error(`[messaging] updateLocalAndModel: failed with error ${e}`))}}))).apply(this,arguments)}},925680:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getHighestAck=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(535470),o=n(88555),s=n(617972);function l(){return(l=(0,i.default)((function*(e){if((0,o.isLegacyWebdBackend)())return Promise.reject(new Error("getHighestAck: not supported for non MD"));const t=yield s.MsgInfoCollection.find(e.id);if(!t)return __LOG__(2)`getHighestAck: no orphan ack found for ${e.id}`,null;let n=null,r=null;return 0===t.playedRemaining&&0!==t.played.length?(r=a.ACK.PLAYED,n=t.played):0===t.readRemaining&&0!==t.read.length?(r=a.ACK.READ,n=t.read):0===t.deliveryRemaining&&0!==t.delivery.length&&(r=a.ACK.RECEIVED,n=t.delivery),null==r||null==n?(__LOG__(2)`getHighestAck: orphan ack has 0 receipt for ${e.id}`,null):(__LOG__(2)`getHighestAck: orphan ack ${r} for ${e.id}`,{ack:r,t:Math.max(...n.map((e=>e.t))),to:e.to,from:e.from,deliveryPrivacyMode:t.deliveryPrivacyMode})}))).apply(this,arguments)}},76581:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgFindByIds=function(e){if((0,i.isLegacyWebdBackend)())return Promise.resolve([]);return(0,o.getMsgsByMsgKey)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`msgFindByIds: failed to find msg in storage`,SEND_LOGS("msgFindByIdsMD failed"),e}))},t.msgFindQuery=function(e,t,n,r){if((0,i.isLegacyWebdBackend)())return a.default.msgFindQuery(e,t,n,r);return(0,o.msgFindQuery)(e,t).catch((e=>{throw __LOG__(3,!0)`msgFindQuery: failed to find msg in storage`,e}))},t.queryVcard=function(e){if((0,i.isLegacyWebdBackend)())return a.default.queryVcard(e);return(0,o.queryVcard)(e).catch((e=>{throw __LOG__(4,!0,new Error,!0)`queryVcard: failed to find vCard in storage`,SEND_LOGS("queryVcardMD failed"),e}))};var i=n(88555),a=r(n(656891)),o=n(584886)},628259:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryMsgInfo=function(){return d.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(492574),s=n(88555),l=n(115461),c=r(n(656891)),u=n(847124);function d(){return(d=(0,a.default)((function*(e){let t;const{id:n}=e;t=(0,s.isMDBackend)()?(0,u.queryMsgInfo)(e.id).catch((e=>{throw __LOG__(4,!0,new Error,!0)`sendQueryMsgInfo: failed to find msg info in storage`,SEND_LOGS("queryMsgInfo failed"),e})):c.default.queryMsgInfo(n).then((e=>{if(e.status>=400)throw __LOG__(2)`model:MsgInfo:findQuery error ${e.status}`,new o.ServerStatusCodeError(e.status);return e}));const r=yield t;return(0,i.default)((0,i.default)({},r),{},{id:n,usePlayReceipt:e.type===l.MSG_TYPE.PTT||e.isViewOnce})}))).apply(this,arguments)}},15665:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendQueryReactions=function(){return f.apply(this,arguments)},t.updateHasReactionInParent=p;var i=r(n(81109)),a=r(n(348926)),o=n(535470),s=n(88555),l=r(n(465212)),c=n(867811),u=n(197563),d=n(957881);function p(e,t){const r=n(559871).MsgCollection.get(e);return r&&r.hasReaction!==t?(0,u.updateLocalAndModel)(r.id,{hasReaction:t}):Promise.resolve()}function f(){return(f=(0,a.default)((function*(e){if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("Not supported in non MD"));const t=yield(0,d.getReactions)(e.id.toString()).catch((e=>{throw __LOG__(4,!0,new Error,!0)`getReactions: failed with error: ${e.name} message: ${e.message}`,SEND_LOGS("getReactions failed"),e})),n=t.reactions.map((e=>{const t=e.senders.map((e=>{let t=(0,i.default)((0,i.default)({},e),{},{id:l.default.fromString(e.msgKey)});return(0,c.isReactionByMe)(e.senderUserJid)&&e.ack===o.ACK.CLOCK&&(t=(0,i.default)((0,i.default)({},t),{},{isSendFailure:!0})),t}));return(0,i.default)((0,i.default)({},e),{},{hasReactionByMe:e.hasReactionByMe,id:e.aggregateEmoji,senders:t})})),r=n.length>0;return yield p(e.id.toString(),r),(0,i.default)((0,i.default)({},t),{},{id:e.id,reactions:n})}))).apply(this,arguments)}},807992:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendDeliveryReceiptsAfterPresence=function(){if((0,r.isLegacyWebdBackend)())return;(0,i.sendDeliveryReceiptsAfterPresence)()};var r=n(88555),i=n(987168)},390298:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sendMsgRecord=function(e){if((0,a.isLegacyWebdBackend)())return c.default.msgCreateRecord(e).then((e=>{if(200!==e.status)throw new i.ServerStatusCodeError(e.status);return e}));let t;e.isForwarded&&(t=(0,l.createMessageForwardMetric)(e));const{encryptAndSendMsg:r}=n(925080);return r(e).catch((t=>{if(__LOG__(3,void 0,void 0,void 0,["messaging"])`sendMsgRecord: MD send failure, msg: ${e.id.toString()}`,(0,u.updateLocalAndModel)(e.id,{isSendFailure:!0}),e.type===o.MSG_TYPE.REACTION){const t={parentMsgKey:e.reactionParentKey,msgKey:e.id,reactionText:e.reactionText,senderUserJid:e.from.toString()};(0,s.updateFailedPropsForSentReactionsDBAndModel)(t,void 0,!0)}throw t})).then((e=>(t&&(0,l.logMessageMetric)(t),{t:parseInt(e.t,10),data:null})))};var i=n(492574),a=n(88555),o=n(115461),s=n(837398),l=n(184746),c=r(n(656891)),u=n(197563)},184746:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageForwardMetric=function(e){let t=Boolean(e.caption);(0,o.documentWithCaptionsSendEnabled)()&&e.type===s.MSG_TYPE.DOCUMENT&&(t=e.isCaptionByUser);const r={messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:t,fastForwardEnabled:!0,messageIsFanout:!0,isFrequentlyForwarded:Boolean(e.isFrequentlyForwarded),isForwardedForward:Boolean(e.numTimesForwarded>1)};null!=e.ephemeralDuration&&(r.ephemeralityDuration=e.ephemeralDuration);if(!e.isGroupMsg){const t=(0,l.getMaybeMeUser)(),i=n(728307).getDisappearingModeSettingForUser,a=i(t);null!=a&&(r.senderDefaultDisappearingDuration=a.duration);const o=i(e.to);null!=o&&(r.receiverDefaultDisappearingDuration=o.duration)}const i=e.getWamDisappearingModeInitiator();null!=i&&(r.disappearingChatInitiator=i);const a=(0,c.getGroupTypeFromChatWid)(e.to);null!=a&&(r.typeOfGroup=a);return new u.default.ForwardSend(r)},t.logMessageMetric=d,t.logMessageSendForChatThreadLogging=function(e){var t;const n=(null===(t=e.quotedMsg)||void 0===t?void 0:t.type)===s.MSG_TYPE.PRODUCT&&e.isSentByMe&&e.chat.contact.isBusiness;(0,a.handleActivitiesForChatThreadLogging)([{activityType:"msgSend",chatId:e.id.remote,ts:(0,i.unixTime)(),isViewOnce:Boolean(e.isViewOnce),isCommerceMessage:e.isCommerceMsg,isPdpInquiry:n,isReply:e.isReply()}])},t.logSuccessfulMessageSend=function(e){e.messageSendResult=u.default.MESSAGE_SEND_RESULT_TYPE.OK,e.messageSendResultIsTerminal=!1,d(e)};var i=n(892844),a=n(217869),o=n(408139),s=n(115461),l=n(978820),c=n(542515),u=r(n(11339));function d(e){e.markMessageSendT(),e.commit()}},785195:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,p.isLegacyWebdBackend)())return function(e,t){const n=new FormData;n.append("t",String((0,u.unixTime)())),n.append("v","2.2228.14");const r=(0,g.getLoginTokens)().server;r&&n.append("tok",r);return n.append("buffer",e),y(t,function(){var e=(0,a.default)((function*(e){const r=yield(0,_.default)(m,{method:"POST",body:n});if(200===r.status)e(void 0);else{if(r.status>=500)throw new d.ServerStatusCodeError(r.status);e(t)}}));return function(){return e.apply(this,arguments)}}())}(e,t);return function(e,t){const n=new Uint8Array((0,s.decodeB64)(e)),r=(0,u.unixTime)();return y(t,function(){var e=(0,a.default)((function*(e){const i=yield(0,h.default)(n,r);if(null==i?void 0:i.errorCode){if(i.errorCode>=500)throw new d.ServerStatusCodeError(i.errorCode,i.errorText);e(t)}e(void 0)}));return function(){return e.apply(this,arguments)}}())}(e,t)};var a=i(n(348926)),o=n(180284),s=n(615688),l=n(413959),c=n(904352),u=n(892844),d=n(492574),p=n(88555),f=i(n(681602)),_=i(n(506631)),h=i(n(880121)),g=n(555452);const m="https://web.whatsapp.com/wam";function y(e,t){return(0,c.promiseLoop)(function(){var n=(0,a.default)((function*(n,i,a){const s=(0,l.delayMs)((0,o.expBackoff)(a,12e4,1e3,.1));try{return yield f.default.waitIfOffline({signal:(new r).signal}),yield t(n)}catch(t){return a>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,n(e)):s}}));return function(){return n.apply(this,arguments)}}())}},624569:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,d.isLegacyWebdBackend)()||!(0,u.getABPropConfigValue)("web_ps_v3_enabled"))return Promise.resolve(t);const n=new Uint8Array((0,s.decodeB64)(e));return i=t,_=function(){var e=(0,a.default)((function*(e){const{uploadedBufferKeys:r,metrics:i}=yield(0,h.upload_UNSAFE_INTERNAL_DO_NOT_USE)([{key:t,content:n}],p.getToken);i.map(g),0===r.length&&e(t),e(void 0)}));return function(){return e.apply(this,arguments)}}(),(0,c.promiseLoop)(function(){var e=(0,a.default)((function*(e,t,n){const a=(0,l.delayMs)((0,o.expBackoff)(n,12e4,1e3,.1));try{return yield f.default.waitIfOffline({signal:(new r).signal}),yield _(e)}catch(t){return n>1?(__LOG__(3)`wam:sendLogs failure error: ${String(t)}`,e(i)):a}}));return function(){return e.apply(this,arguments)}}());var i,_};var a=i(n(348926)),o=n(180284),s=n(615688),l=n(413959),c=n(904352),u=n(257243),d=n(88555),p=n(862664),f=i(n(681602)),_=i(n(11339)),h=n(714604);function g(e){const{result:t,uploadTime:n,httpResponseCode:r}=e,i=function(e){switch(e){case"success":return _.default.PS_BUFFER_UPLOAD_RESULT.SUCCESS;case"error-server-other":return _.default.PS_BUFFER_UPLOAD_RESULT.ERROR_SERVER_OTHER;case"error-parsing":return _.default.PS_BUFFER_UPLOAD_RESULT.ERROR_PARSING;case"error-decoding":return _.default.PS_BUFFER_UPLOAD_RESULT.ERROR_DECODING;case"error-credential":return _.default.PS_BUFFER_UPLOAD_RESULT.ERROR_CREDENTIAL;case"error-other":return _.default.PS_BUFFER_UPLOAD_RESULT.ERROR_OTHER;default:return _.default.PS_BUFFER_UPLOAD_RESULT.ERROR_ACCESS_TOKEN}}(t);new _.default.PsBufferUpload({psBufferUploadResult:i,psBufferUploadT:n,psBufferUploadHttpResponseCode:r,applicationState:"visible"===document.visibilityState?_.default.APPLICATION_STATE.FOREGROUND:_.default.APPLICATION_STATE.BACKGROUND}).commit()}},270308:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.prepareRetryReceiptBridge=function(e){if((0,i.isLegacyWebdBackend)())return Promise.resolve(e);return(0,n(901480).Z)(e)},t.sendCallEndBridge=function(e,t){if((0,i.isLegacyWebdBackend)())return a.default.sendCallEnd(e,t);return Promise.resolve({})},t.sendCallOfferBridge=function(e){if((0,i.isLegacyWebdBackend)())return e.payload[2].find((e=>"enc"===e[0]))?a.default.sendCallOffer(e):a.default.sendGroupCallOffer(e);return(0,n(335283).Z)(e,o.TYPE.OFFER)},t.sendCallSignalingMsgBridge=function(e,t){if((0,i.isLegacyWebdBackend)())return a.default.sendCallSignalingMsg(e,t);return(0,n(126489).Z)(e)},t.sendEncRekeyBridge=function(e){if((0,i.isLegacyWebdBackend)())return a.default.sendCallSignalingMsg(e);return(0,n(335283).Z)(e,o.TYPE.ENC_REKEY)},t.sendQueryCallBridge=function(e,t){if((0,i.isLegacyWebdBackend)())return a.default.queryCall(e,t);return Promise.resolve({status:200})};var i=n(88555),a=r(n(656891)),o=n(445473)},815183:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),a=t.blocklist.map((e=>({id:e}))),o=n(132826).BlocklistCollection;if((0,r.isLegacyWebdBackend)())return void o.set(a);(0,i.getBlocklistTable)().clear().then((()=>Promise.all(a.map((e=>{let{id:t}=e;return(0,i.getBlocklistTable)().create({id:t.toString()})}))))).then((()=>o.set(a)))};var r=n(88555),i=n(776214)},570257:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),r=n(669951).ChatCollection,w=n(559871).MsgCollection;if(Array.isArray(t)){const e=[],s=[],l=[],u=[];t.forEach((function(t){if("c.us"===t.id)s.push(t);else{const n=!!r.get(t.id),i=["delete","clear","ephemeral","archive","unarchive","star","unstar","spam","modify_tag","pin","modify"].includes(t.type);i?n&&i?s.push(t):__LOG__(2)`Model:chat:handle received junk chat record: ${JSON.stringify(t)}`:e.push(t)}}));const f=e.find((e=>E.default.isPSA(e.id)));null!=f&&(f.name=T.default.t(868));const _=n(719011).AllStarredMsgsCollection;let h;return s.forEach((function(e){const t=e.type;if("c.us"===e.id.toString()){switch(r.disableSortListener(),t){case"clear":__LOG__(2)`Model:chat:handle:clear:all before:${String(e.before)} kind:${String(e.kind)}`,r.forEach((function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)}));break;case"delete":__LOG__(2)`Model:chat:handle:delete:all`,r.toArray().forEach((function(e){e.isGroup?e.deleteMsgs(!0):l.push(e)}));break;case"archive":__LOG__(2)`Model:chat:handle:archive:all`,r.forEach((function(e){u.push({id:e.id,archive:!0,pin:void 0})}));break;case"unarchive":__LOG__(2)`Model:chat:handle:unarchive:all`,r.forEach((function(e){u.push({id:e.id,archive:!1})}));break;case"unstar":__LOG__(2)`Model:chat:handle:unstar:all`,_.delete(),r.forEach((function(e){e.unstarAll()}));break;default:__LOG__(3)`Model:chat:handle unknown ${JSON.stringify(e)}`}r.enableSortListener()}else{const n=r.get(e.id);if(!n)return;switch(t){case"ephemeral":if(null!=e.t){const t=(0,p.getLastReceivedNonExpiredMsg)(n,e.t);t&&(0,v.setLastReceivedKey)(n.id,t.id).then((()=>{n.lastReceivedKey=t.id}))}break;case"clear":case"star":case"unstar":if(e.keys){const n=e.keys.length,r="star"===t,i=[],a=[],o=[];let s=!1;for(let l=0;l<n;l++){let n,u,d,p,f;const _=e.keys[l];Array.isArray(_)?([n,u,d]=_,p=new m.default({fromMe:u,remote:e.id,id:n,participant:d}),f=w.get(p),f?"clear"===t?f.delete():(f.star=r,o.push(f)):r&&(s=!0)):!(0,c.default)(_)||"star"!==t&&"unstar"!==t||(p=_.id,f=w.get(_.id),f?(f.star=r,o.push(f)):a.push(_)),i.push(p&&p.toString())}"star"!==t&&"unstar"!==t||_.process(r,a,o,s),__LOG__(2)`model:Chat:handle:messages:${[t,e.id,i.join(),e.modifyTag].join()}`}else"clear"===t?("number"==typeof e.before?n.deleteMsgsOlderThan(e.before,e.star,e.kind):n.deleteMsgs(e.star,e.kind),__LOG__(2)`model:Chat:handle cleared chat:${[e.id,e.before,e.modifyTag,e.kind].join()}`):"unstar"===t&&(n.unstarAll(),__LOG__(2)`model:Chat:handle unstarred chat: ${e.id}`);isNaN(e.modifyTag)||u.push({id:e.id,modifyTag:e.modifyTag});break;case"delete":l.push(n),__LOG__(2)`model:Chat:handle deleted chat for ${String(e.id)}`;break;case"archive":u.push({id:e.id,archive:!0,pin:void 0});break;case"unarchive":u.push({id:e.id,archive:!1});break;case"spam":u.push({id:e.id,notSpam:e.notSpam});break;case"modify_tag":u.push({id:e.id,modifyTag:e.modifyTag});break;case"pin":u.push({id:e.id,pin:e.pin});break;case"modify":u.push({id:e.id,changeNumberOldJid:e.changeNumberOldJid,changeNumberNewJid:e.changeNumberNewJid})}}})),h=(0,d.isMDBackend)()?(0,O.getStorage)().lock(["chat"],function(){var t=(0,o.default)((function*(t){let[n]=t;try{return yield n.bulkCreateOrMerge(e.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString()})))),yield Promise.all(u.map((e=>{const{id:t}=e,r=(0,i.default)(e,M);n.merge(t.toString(),r)}))),n.bulkRemove(l.map((e=>e.id.toString())))}catch(e){__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ChatHandler: bulk handle error")}}));return function(){return t.apply(this,arguments)}}()):Promise.resolve(),h.then((()=>{r.add(e,{merge:!0}),u.forEach((e=>{const{id:t}=e,n=(0,i.default)(e,I),a=r.get(t);a&&a.set(n)})),l.forEach((e=>e.delete()))}))}if("leave"===t.cmd)t.gids.forEach((function(e){const t=r.get(e);t&&(0,h.localExitGroup)(t)}));else{if("preempt"===t.cmd){let e=Promise.resolve();return(0,d.isMDBackend)()&&(e=(0,P.getTable)().bulkCreateOrMerge(t.response.map((e=>(0,a.default)((0,a.default)({},e),{},{id:e.id.toString(),muteExpiration:0}))))),e.then((()=>(0,u.frontendSendAndReceive)("chatCollectionAdd",{things:t.response,options:{merge:!0}}))).then((()=>{C.Conn.platform!==C.PLATFORMS.IPHONE&&C.Conn.platform!==C.PLATFORMS.SMBI||((0,l.default)(t.response)?(0,u.frontendFireAndForget)("msgCollectionTrigger",{name:_.COLLECTION_HAS_SYNCED}):setTimeout((()=>{(0,u.frontendFireAndForget)("msgCollectionTrigger",{name:_.COLLECTION_HAS_SYNCED})}),2500)),(0,u.frontendFireAndForget)("chatCollectionTrigger",{name:_.COLLECTION_HAS_SYNCED,args:{count:t.response.length,binarySize:t.binarySize}})}))}if("action"===t.cmd){const e=t.id,n=t.data;if("create"!==n[0]&&"introduce"!==n[0]){if(n.length<3)return void __LOG__(3)`model:chat: incorrect length of payload data for action ${JSON.stringify(t)}`;const e=t.data[0],r="unknown"===t.data[1]?null:t.data[1];let i;return i=e===g.GROUP_ACTIONS.RESTRICT||e===g.GROUP_ACTIONS.ANNOUNCE||e===g.GROUP_ACTIONS.NO_FORWARD?{action:e,value:t.data[2]}:e===g.GROUP_ACTIONS.EPHEMERAL?{action:e,duration:t.data[2]}:(0,a.default)({action:e},t.data[2]),(0,y.updateModelForGroupAction)({chatId:t.id,author:r},i)}{const t=n[1],i=n[2],a=[...(0,s.default)(i.admins,(e=>({id:e,isAdmin:!0}))),...(0,s.default)(i.superadmins||[],(e=>({id:e,isAdmin:!0,isSuperAdmin:!0}))),...(0,s.default)(i.regulars,(e=>({id:e,isAdmin:!1})))];b.default.add({id:e,creation:i.creation,owner:t,participants:a,stale:!1,desc:i.desc,descId:i.descId,descTime:i.descTime,descOwner:i.descOwner,restrict:!!i.restrict,announce:!!i.announce},{merge:!0}),A.ContactCollection.add({id:e,name:i.subject},{merge:!0});const o=r.get(e);if(!o)return;const l=o.msgs.last();if(!l)return;if("gp2"===l.type&&"add"===l.subtype){const t=(0,S.getMaybeMeUser)();b.default.trigger(`group_participant_change_${t.toString()}`,e),(0,S.isMePrimary)(l.recipients[0])&&f.Cmd.alertNewMsg(l)}}}else __LOG__(3)`model:chat: unknown payload: ${JSON.stringify(t)}`}};var i=r(n(506479)),a=r(n(81109)),o=r(n(348926)),s=r(n(435161)),l=r(n(441609)),c=r(n(513218)),u=n(708154),d=n(88555),p=n(933852),f=n(781572),_=n(813042),h=n(525510),g=n(795720),m=r(n(465212)),y=n(114949),S=n(978820),E=r(n(389867)),v=n(111902),T=r(n(914296)),C=n(317239),A=n(719380),b=r(n(963928)),P=n(68638),O=n(799069);const M=["id"],I=["id"]},32720:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();switch(t.type){case"picture":(0,r.changeProfilePicThumb)(t.jid,t.tag);break;default:(0,i.handle)([t])}return Promise.resolve()};var r=n(373232),i=n(98423)},766405:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t;const r=e.shift();r.id="1";const p=n(656891).default,{protoVersion:f,binVersion:_,features:h}=r;if(f){a.LegacyPhoneFeatures.setVersion(f);const e=a.LegacyPhoneFeatures.setFeatures(h);t=!!e.KEY_PARTICIPANT,p.setVersion(f,_,null==h?void 0:h.FLAGS)}if(r.initial){a.LegacyPhoneFeatures.setPlatform(r.platform),(0,s.setLogoutToken)(r.browserToken),r.hasOwnProperty("is24h")&&i.Clock.setIs24Hour(r.is24h);const e=r.ref,t=r.serverToken,n=r.clientToken,o=r.connected;e&&o&&t&&(0,s.setRefTok)(e,t),(0,s.setLoginTokens)({client:n,server:t});const f=r.secret?p.setSharedSecret(r.secret):Promise.resolve();return Promise.all([(0,u.requireContactCollection)(),f]).then((e=>{let[t]=e;if("true"!==r.isResponse&&c.save(),r.wid){const e=r.wid;(0,l.setMe)(e),d.Conn.trigger("me_ready"),r.pushname&&(d.Conn.pushname=r.pushname,(0,s.setPushname)(r.pushname)),t.gadd(e)}d.Conn.set(r)}))}d.Conn.connected&&t&&(__LOG__(2)`models:Conn:participantChange:to:${String(a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.KEY_PARTICIPANT))}`,o.default.hardRefresh());return d.Conn.set(r),Promise.resolve()};var i=n(40234),a=n(438184),o=r(n(379264)),s=n(555452),l=n(978820),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(266333)),u=n(546582),d=n(317239);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}},278496:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();if(Array.isArray(t)){const n=e.shift();!function(e,t){const n=t&&"remove"===t.missing?(0,s.getContactsToRemove)(e):[];(0,a.mungePSAContact)(e),l.ContactCollection.add(e,{merge:!0}),n.forEach((e=>{e.unset("name"),e.unset("shortName")})),(null==t?void 0:t.checksum)&&(l.ContactCollection.setChecksum(t.checksum),__LOG__(2)`handle:Contact update checksum ${t.checksum}`);__LOG__(2)`handle:Contact updated ${e.map((e=>e.id)).join()}`}(t,n)}else"preempt"===t.cmd?function(e){(0,a.mungePSAContact)(e.response),l.ContactCollection.add(e.response,{merge:!0}),e.checksum&&(l.ContactCollection.setChecksum(e.checksum),__LOG__(2)`Store:Contact:handle update checksum ${e.checksum}`);l.ContactCollection.trigger(i.COLLECTION_HAS_SYNCED,{count:e.response.length,binarySize:e.binarySize})}(t):"frequent"===t.type?function(e){let t;delete e.type,t=(0,r.isMDBackend)()?(0,o.setFrequent)(e):Promise.resolve();t.then((()=>{l.ContactCollection.updateFrequentContacts(e)}))}(t):"sidelist"===t.type?function(e){const{notification:t,action:n,hash:r}=e,i=l.ContactCollection.resolveWidsFromHash(r);if(!i)return;"business"===t&&"profile"===n&&i.forEach((e=>{const t=l.ContactCollection.get(e);if(t)t.businessProfile&&t.businessProfile.markStale();else{const e=l.ContactCollection.getUserCount(),t=l.ContactCollection.contactHashLength();__LOG__(4,void 0,new Error,!0)`Hash: ${r} Users: ${e}, Hashes: ${t}`,SEND_LOGS("Stale wid in contact hash index")}}))}(t):__LOG__(3)`handle:Contact unknown: ${JSON.stringify(t)}`};var r=n(88555),i=n(813042),a=n(125946),o=n(908071),s=n(188129),l=n(719380)},467938:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!Array.isArray(e))return __LOG__(4,void 0,new Error,!0)`ws2: Invalid message, not an array`,void SEND_LOGS("ws2:invalid-msg");const t=e.shift();switch(t){case"Blocklist":return void(0,i.default)(e);case"Contact":return void(0,l.default)(e);case"Props":case"ServerProps":return void n(964551).ServerProps.handle(e);case"Location":case"LiveLocation":return void n(985865).LiveLocationCollection.handle(e);case"Chat":return void(0,a.default)(e);case"Msg":return void(0,c.default)(e);case"Stream":return void(0,p.default)(e);case"Conn":return void(0,s.default)(e);case"Cmd":return void(0,o.default)(e);case"Presence":return void(0,d.default)(e);case"MsgInfo":return void(0,u.default)(e);case"BusinessProfile":return void n(493581).BusinessProfileCollection.handle(e);case"GroupMetadata":return void n(963928).default.handle(e);case"Label":return void n(316770).LabelCollection.handle(e);case"QuickReply":return void n(999662).QuickReplyCollection.handle(e);case"Call":return void n(160868).CallCollection.handle(e);case"Mute":return void n(72472).MuteCollection.handle(e);case"Status":return void n(46133).StatusCollection.handle(e);case"StatusV3":return void n(459387).StatusV3Collection.handle(e);default:__LOG__(4,void 0,new Error,!0)`ws2: Invalid type received: ${t}`,SEND_LOGS("ws2: Invalid type received")}};var i=r(n(815183)),a=r(n(570257)),o=r(n(32720)),s=r(n(766405)),l=r(n(278496)),c=r(n(926453)),u=r(n(474609)),d=r(n(882805)),p=r(n(180169))},926453:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let[t]=e;const r=n(559871).MsgCollection;function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,n){let i;i=p.default.isStatusV3(t.broadcast)?new d.default({from:t.from,to:t.broadcast,id:n,selfDir:t.self||"out"}):new d.default({from:t.from,to:e,id:n,participant:t.participant,selfDir:t.self||"out"});const a=r.get(i);a?yield(0,l.updateMsgAck)(a,t.broadcast,{from:t.from,to:e,ack:t.ack,t:t.t}):(__LOG__(2)`Msg:out of order ack`,r.preAck[i]=t)}))).apply(this,arguments)}if("ack"===t.cmd){const e=[t.to];if(p.default.isBroadcast(t.to)&&t.ack===s.ACK.SENT){const n=g.default.get(t.to);n&&Array.prototype.push.apply(e,(0,a.default)(n.participants.toArray(),"id"))}const n=e.map((e=>m(e,t.id)));return Promise.all(n)}if("acks"===t.cmd){const e=t.id.map((e=>m(t.to,e)));return Promise.all(e)}if(t.msg){if(!(t.chat instanceof p.default))return Promise.resolve();const e="update"===t.meta.add;return p.default.isStatusV3(t.chat)&&!n(459387).StatusV3Collection.handleUpdate(t.msg,t.meta.checksum,e)?Promise.resolve():(t.msg.recvFresh=!0,t.msg.isNewMsg=!0,r.processMultipleMessages(t.chat,[t.msg],{add:"after",update:e,isHistory:!1}).catch((0,o.filteredCatch)(c.LogoutDrop,(()=>{}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`Msg: ${String(t.msg.id)} chat: ${String(t.chat)} Error: ${e.name}, message: ${e.message}, stack: ${e.stack}`,SEND_LOGS("msg_handler: error storing/processing single message")})))}if(t.msgs){const e=t.msgs.length;if(!e)return Promise.resolve();let n=null;if(!(t.chat instanceof p.default))return Promise.resolve();const i=t.meta;i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new d.default({fromMe:i.unreadFromMe,remote:t.chat,id:i.unreadId,participant:i.unreadParticipant}),n=new _.ChatMsgsCollection);for(let n=0;n<e;n++){t.msgs[n].invis=!0}return h.Conn.platform!==h.PLATFORMS.IPHONE&&h.Conn.platform!==h.PLATFORMS.SMBI||r.trigger(u.COLLECTION_HAS_SYNCED),r.trigger("handle:msg_history",{count:t.msgs.length,binarySize:t.binarySize}),r.processMultipleMessages(t.chat,t.msgs,i,n).catch((0,o.filteredCatch)(c.LogoutDrop,(()=>{}))).catch((n=>{__LOG__(4,void 0,new Error,!0)`Msgs count: ${e} Chat: ${String(t.chat)} Error: ${n.name}, message: ${n.message}, stack: ${n.stack}`,SEND_LOGS("msg_handler: error storing/processing multiple messages")}))}if(t.recent){const e=t.meta,n=t.binarySize;return delete t.recent,delete t.meta,delete t.binarySize,r.trigger(u.COLLECTION_HAS_SYNCED,{count:Object.keys(t).length,binarySize:n}),e.isHistory=!0,Promise.all(Object.keys(t).map((n=>{let i;try{i=(0,f.createWid)(n)}catch(e){return Promise.resolve()}const a=t[n];a.invis=!0;const s="last"===e.add&&e.resume?new _.ChatMsgsCollection:null;r.processMultipleMessages(i,[a],e,s).catch((0,o.filteredCatch)(c.LogoutDrop,(()=>{}))).catch((()=>{__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("msg_handler: error storing recent messages")}))})))}return __LOG__(2)`************** Msg else clause. something strange is going on`,Promise.resolve()};var i=r(n(348926)),a=r(n(435161)),o=n(450796),s=n(535470),l=n(272720),c=n(492574),u=n(813042),d=r(n(465212)),p=r(n(389867)),f=n(745454),_=n(951612),h=n(317239),g=r(n(963928))},474609:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift(),{from:n,to:i,ack:a,participant:o,t:s}=t;switch(t.cmd){case"ack":r.MsgInfoCollection.updateInfo(t.id,n,i,a,o,s);break;case"acks":t.id.forEach((e=>{r.MsgInfoCollection.updateInfo(e,n,i,a,o,s)}))}};var r=n(617972)},882805:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.shift();return(0,i.default)(t)};var i=r(n(624206))},180169:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e[0]){case"asleep":break;case"killsw":r.Updater.killServiceWorker();break;case"update":case"update_desktop":break;default:__LOG__(3)`Stream:handle unknown cmd ${e[0]}`}};var r=n(400922)},257243:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigCodeToName=void 0,t.clearABPropConfigs=function(){return p.reset()},t.getABPropConfigValue=f,t.getAllABPropConfigs=function(){return p.getAllConfigs()},t.updateABPropsFromStorage=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(73074),o=n(246440),s=n(88555),l=(n(333126),n(834541));const c=new Map;let u=!1;const d={};t.ABPropConfigCodeToName=d,Object.keys(a.ABPropConfigs).forEach((e=>{const[t]=a.ABPropConfigs[e];d[t]=e})),Object.freeze(d);const p={reset:()=>{c.clear(),o.accessedConfigs.clear(),o.exposureKeys.clear(),u=!1},bulkCreateOrReplace(e){let t=!1;e.forEach((e=>{c.set(e.configCode,e),!0===e.hasAccessed&&(o.accessedConfigs.add(e.configCode),null!=e.configExpoKey&&(o.exposureKeys.add(e.configExpoKey),t=!0))})),t&&(0,o.updateGlobalExpoKey)(),u=!0,f("web_abprop_config_experiment_test")},getConfigValue(e){var t;if((0,s.isLegacyWebdBackend)())return null;if(!u)return __LOG__(3)`[ABProps] configs need to be initialized before its first access, config code: ${e}`,null;if(c.get(e)&&!o.accessedConfigs.has(e)){var n;const t=null===(n=c.get(e))||void 0===n?void 0:n.configExpoKey;null==t||o.exposureKeys.has(t)||(o.exposureKeys.add(t),(0,o.updateGlobalExpoKey)()),o.accessedConfigs.add(e),(0,l.setConfigAccessed)(e)}return null===(t=c.get(e))||void 0===t?void 0:t.configValue},getAllConfigs:()=>Array.from(c.values())};function f(e){var t;const n=a.ABPropConfigs[e],[r,i,o,s]=n,l=o;return null!==(t=p.getConfigValue(r))&&void 0!==t?t:l}function _(){return(_=(0,i.default)((function*(){try{const e=(yield(0,l.getABPropConfigs)()).map((e=>{const t=d[Number(e.configCode)];if(null!=t){const n=a.ABPropConfigs[t],[r,i,o,s]=n,c=o;return{configCode:r,configValue:(0,l.parseConfigValue)(e.configValue,i,c),configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed}}__LOG__(3)`[ABProps] ABProp (code: ${e.configCode}) exists in storage but no longer available for this client version`})).filter((e=>!!e));p.bulkCreateOrReplace(e)}catch(e){__LOG__(4,!0,new Error,!0)`[ABProps] Failed to update ABProps configs cache from storage: ${e}`,SEND_LOGS("[ABProps] Failed to update ABProps configs cache from storage: "+e)}__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps Start ---`,c.forEach(((e,t)=>{__LOG__(2,void 0,void 0,void 0,["abprops"])`code: ${t}, name: ${d[e.configCode]}, value: ${e.configValue}, type: ${typeof e.configValue}`})),__LOG__(2,void 0,void 0,void 0,["abprops"])`--- Print ABProps End ---`}))).apply(this,arguments)}},73074:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ABPropConfigs=void 0;t.ABPropConfigs={order_details_total_order_minimum_value:[1719,"float",1,1],order_details_total_maximum_value:[1684,"float",5e3,5e3],order_details_total_minimum_value:[1683,"int",0,0],in_app_support_v2_enabled:[233,"bool",!1,!1],in_app_support_v2_locale_langs:[379,"string","",""],in_app_support_v2_numbers:[390,"string","",""],in_app_support_v2_number_prefixes:[1031,"string","15517868","15517868"],in_app_support_v2_jump_to_group:[819,"bool",!1,!1],in_app_support_v2_jump_to_group_wait_time_in_ms:[974,"int",5e3,5e3],groups_dogfooding_ui:[308,"bool",!1,!1],md_icdc_enabled:[309,"bool",!1,!1],md_icdc_hash_length:[310,"int",10,10],played_self_enabled:[361,"bool",!1,!1],ephemeral_24h_duration:[407,"bool",!1,!0],disappearing_mode:[536,"bool",!1,!1],payments_expressive_backgrounds_enabled:[605,"bool",!1,!0],ephemeral_allow_group_members:[432,"bool",!1,!0],business_profile_refresh_m1_enabled:[470,"bool",!1,!0],num_days_key_index_list_expiration:[730,"int",35,35],num_days_before_device_expiry_check:[731,"int",7,7],media_reupload_limit_mb:[1098,"int",100,100],message_level_reporting:[535,"bool",!1,!0],native_shop_preview_enabled:[636,"bool",!1,!0],sync_archive_v2_setting:[736,"bool",!1,!1],ptt_conversation_waveform:[637,"bool",!1,!0],ptt_waveform_send:[746,"bool",!1,!0],adv_v2_m4_m5:[753,"bool",!1,!1],adv_v2_m6:[903,"bool",!1,!1],ptt_draft_enabled:[777,"bool",!1,!0],ptt_pausable_enabled:[871,"bool",!1,!0],tos_3_client_gating_biz_initiated_enabled:[953,"bool",!1,!1],tos_3_client_gating_enabled:[791,"bool",!1,!1],tos_3_client_force_fetch_enabled:[792,"bool",!1,!1],tos_client_state_fetch_enabled:[877,"bool",!1,!1],tos_client_state_force_fetch_enabled:[878,"bool",!1,!1],tos_client_state_fetch_iteration:[908,"int",0,0],country_client_gating_enabled:[1105,"bool",!1,!1],system_msg_numbers_fb_branded:[1035,"string","16505434800,16503130062,16507885324,16508620604,16504228206,447710173736,16315551023,16505361212,16508129150,16315555102,16315558723,16505212669,16507885280,19032707825,0","16505434800,16503130062,16507885324,16508620604,16504228206,447710173736,16315551023,16505361212,16508129150,16315555102,16315558723,16505212669,16507885280,19032707825,0"],system_msg_numbers_fb_inc:[1036,"string","",""],log_clock_skew:[1190,"bool",!1,!1],trusted_contacts:[794,"bool",!1,!1],trusted_contacts_sender:[995,"bool",!1,!1],trusted_contacts_ti:[922,"bool",!1,!1],tctoken_duration:[865,"int",604800,604800],tctoken_num_buckets:[909,"int",4,4],tctoken_duration_sender:[996,"int",604800,604800],tctoken_num_buckets_sender:[997,"int",4,4],reactions_receive:[827,"bool",!1,!0],reactions_send:[828,"bool",!1,!0],reactions_announcement_only:[1150,"bool",!1,!1],reaction_cleanup_days:[987,"int",31,31],reactions_chat_preview:[1605,"bool",!1,!0],reactions_animations:[1361,"bool",!1,!0],reactions_animations_simple:[1485,"bool",!1,!0],md_migration_experience:[861,"int",0,1],web_abprop_direct_connection_md:[869,"bool",!1,!0],media_upload_prekeys_fetch_enabled:[907,"bool",!1,!0],reactions_panel_prekeys_fetch_enabled:[1828,"bool",!1,!0],status_quick_reply_enabled:[1455,"bool",!1,!0],ptt_remember_play_position:[952,"bool",!1,!0],banned_shops_ux_enabled:[957,"bool",!1,!0],group_suspend_v0_enabled:[973,"bool",!1,!0],parent_group_view_enabled:[982,"bool",!1,!0],parent_group_create_enabled:[1173,"bool",!1,!0],parent_group_query_ts:[1228,"int",0,0],parent_group_link_limit:[1238,"int",0,10],parent_group_admins_limit:[1655,"int",0,20],cadmin_self_demote:[1286,"bool",!1,!1],community_admin_promotion_one_time_prompt:[1864,"bool",!1,!1],forwarded_ptt_ui_enabled:[1040,"bool",!1,!0],shops_storefront_url_format:[1054,"string","https://www.facebook.com/%s/shop/","https://www.facebook.com/%s/shop/"],message_count_logging_md_enabled:[1135,"bool",!1,!1],dev_prop_string:[1064,"string","",""],dev_prop_boolean:[1065,"bool",!1,!1],dev_prop_int:[1066,"int",0,0],dev_prop_float:[1067,"float",0,0],order_details_from_cart_enabled:[1107,"bool",!1,!0],order_details_custom_item_enabled:[1176,"bool",!1,!0],order_details_from_catalog_enabled:[1212,"bool",!1,!0],md_app_state_critical_data_processing_logging:[1187,"bool",!1,!0],md_app_state_report_md_sync_mutation_stats:[1221,"bool",!1,!0],order_management_enabled:[1188,"bool",!1,!1],growth_lock_v0_enabled:[1204,"bool",!1,!0],smart_filters_enabled_consumer:[1287,"bool",!1,!0],md_offline_v2_m2_enabled:[1517,"int",10,10],profile_photo_rings_for_status_enabled:[1533,"bool",!1,!1],dc_edit_postcode_by_default_enabled:[1534,"bool",!1,!1],chatlist_filters_v1:[1608,"bool",!1,!1],community_suspend_v0_enabled:[1653,"bool",!1,!0],is_meta_employee_or_internal_tester:[1777,"bool",!1,!1],disable_auto_download:[1838,"bool",!1,!1],ctwa_data_max_length:[1841,"int",768,768],ig_reels_music_attribution:[1912,"bool",!1,!0],status_inline_link_preview_enabled:[1522,"bool",!1,!0],text_status_url_logging_enabled:[1851,"bool",!1,!0],status_reaction_emojis:[1852,"string","[128525, 128514, 128558, 128546, 128591, 128079, 127881, 128175]","[128525, 128514, 128558, 128546, 128591, 128079, 127881, 128175]"],status_reply_received_logging_enabled:[1859,"bool",!1,!0],smb_collections_enabled:[451,"bool",!1,!0],consumer_collections_enabled:[582,"bool",!1,!0],smb_collections_appeal_flow_enabled:[724,"bool",!1,!1],smb_multi_device_awareness:[1074,"bool",!1,!0],smb_quick_replies_v2_enabled:[875,"bool",!1,!1],smb_ecommerce_compliance_india_m4:[1003,"bool",!1,!0],smb_ecommerce_compliance_india_m4_5:[1192,"bool",!1,!0],smart_filters_enabled:[1015,"bool",!1,!0],btm_threads_logging_enabled:[1022,"bool",!1,!0],native_commerce_threads_logging_enabled:[1034,"bool",!1,!0],threads_logging_observe_list_enabled:[1168,"bool",!1,!0],smb_hide_unsupported_currency_price:[1203,"bool",!1,!0],hyperlinked_phone_numbers_enabled:[1215,"bool",!1,!1],smb_catkit_query_version:[1229,"int",1,1],smb_phase_out_not_a_business:[1263,"bool",!1,!0],smb_phase_out_not_a_business_V2:[1771,"bool",!1,!0],smb_threads_logging_enabled:[1251,"bool",!1,!0],smb_click_to_chat_logging_enabled:[1252,"bool",!1,!0],smb_broadcast_logging_enabled:[1253,"bool",!1,!0],smb_status_logging_enabled:[1254,"bool",!1,!0],smb_biz_profile_logging_enabled:[1255,"bool",!1,!0],smb_registration_flow_logging_enabled:[1256,"bool",!1,!0],btm_qpl_enabled:[1272,"bool",!1,!0],smb_multi_device_agents_enabled:[1438,"bool",!1,!0],smb_multi_device_agents_logging_enabled:[1671,"bool",!1,!0],smb_multi_device_agents_logging_V2_enabled:[1897,"bool",!1,!0],smb_md_agent_chat_assignment_enabled:[1798,"bool",!1,!0],smb_temp_cover_photo_privacy_messaging:[1913,"bool",!1,!0],qpl_enabled:[212,"bool",!1,!0],qpl_upload_delay:[215,"int",1440,1],qpl_sampling_as_string:[466,"string",'json:{"sampling":[]}','json:{"sampling":[]}'],qpl_initial_upload_delay:[1223,"int",5,1],is_meta_employee:[1570,"bool",!1,!1],should_deregister_on_syncd_fatal:[383,"bool",!0,!0],group_catch_up:[559,"bool",!1,!1],web_abprop_ctwa_context_compose_enabled:[591,"bool",!1,!1],web_abprop_group_description_length:[592,"int",0,0],web_abprop_ephemeral_messages_allowed_values:[593,"string","604800","604800"],web_abprop_collections_display:[584,"bool",!1,!1],web_abprop_collections_management:[585,"bool",!1,!1],web_abprop_drop_full_history_sync:[600,"bool",!1,!1],web_abprop_business_profile_incomplete_nux_banner:[710,"bool",!1,!1],web_abprop_product_catalog_nux_banner:[711,"bool",!1,!1],web_abprop_click_nux_banner_migration:[712,"bool",!1,!1],web_abprop_ecommerce_compliance_india:[717,"bool",!1,!1],web_abprop_edit_ecommerce_compliance_india:[826,"bool",!1,!1],drop_last_name:[726,"bool",!1,!1],web_abprop_catalog_icon_on_top_bar:[734,"bool",!1,!1],web_abprop_collections_nux_banner:[741,"bool",!1,!1],nfm_rendering_enabled:[760,"bool",!1,!1],web_abprop_nux_cart_interstitial:[761,"bool",!1,!1],web_abprop_business_profile_refresh_status_enabled:[763,"bool",!1,!1],web_abprop_business_profile_refresh_linked_account_enabled:[764,"bool",!1,!1],web_abprop_business_profile_refresh_edit_cover_photo_enabled:[765,"bool",!1,!1],web_abprop_business_profile_refresh_cover_photo_view_enabled:[766,"bool",!1,!1],elevated_important_msg:[809,"bool",!1,!1],web_privacy_settings:[837,"bool",!1,!1],web_privacy_settings_v2:[1226,"bool",!1,!1],web_status_psa:[873,"bool",!1,!1],web_status_psa_history_sync:[1095,"bool",!1,!1],web_2fa:[1195,"bool",!1,!1],web_abprop_stateful_enumeration_enabled:[887,"bool",!0,!0],web_abprop_block_catalog_creation_ecommerce_compliance_india:[894,"bool",!1,!1],web_sticker_store:[930,"bool",!1,!1],web_proactive_prekeys_fetch_group_size_limit:[937,"int",0,0],web_favorite_stickers:[962,"bool",!1,!1],web_orchestrator_enabled_version:[984,"string","default","default"],web_wam_v5_enabled:[1033,"bool",!1,!1],web_ps_v3_enabled:[1114,"bool",!1,!1],web_shop_storefront_message:[1053,"bool",!1,!1],web_identity_store_cache:[1078,"bool",!1,!1],web_abprop_large_files_encryption_optimization:[1086,"bool",!1,!1],web_send_invisible_msg_to_new_groups:[1099,"bool",!1,!1],web_send_invisible_msg_min_group_size:[1100,"int",128,128],web_init_chat_batch_size:[1171,"int",100,100],web_init_chat_max_unread_message_count:[1172,"int",0,0],web_abprop_skip_file_copy_on_attach:[1174,"bool",!1,!1],reaction_history_sync:[1179,"bool",!1,!1],web_abprop_screen_sharing_enabled:[1189,"bool",!1,!1],web_graphql_for_catalog_m1:[1205,"bool",!1,!1],web_abprop_config_experiment_test:[1217,"bool",!1,!1],web_adaptive_offline_resume_enabled:[1224,"bool",!1,!1],web_wa_signal_enabled:[1225,"bool",!1,!1],web_gdpr_request_account_info_enabled:[1232,"bool",!1,!1],web_new_compose_box_input:[1243,"bool",!1,!1],web_abprop_document_resume_upload:[1247,"bool",!1,!1],more_reactions_option_desktop_beta_rollout:[1759,"bool",!1,!1],reactions_keyboard_hides_three_flags_desktop_beta_rollout:[1796,"bool",!1,!1],web_rotate_sender_key_if_sent:[1329,"bool",!1,!1],web_lru_cache_optimization:[1339,"bool",!1,!1],web_lru_cache_purge_logic_refactor:[1383,"bool",!1,!1],companion_min_versions:[1367,"string","json:[]","json:[]"],comparion_force_upgrade:[1368,"bool",!1,!1],web_abprop_business_profile_refresh_linked_accounts_killswitch:[1351,"bool",!1,!1],web_default_pull_mode_enabled:[1355,"bool",!1,!1],web_abprop_chatd_login_cookie_enabled:[1371,"bool",!1,!1],web_prekeys_fetch_first_batch_size:[1373,"float",0,0],md_app_state_gate_D34336913:[1379,"bool",!1,!1],web_address_capture_message_enabled:[1385,"bool",!1,!1],syncd_periodic_sync_days:[1400,"int",0,0],web_enable_hyperlinked_phone_numbers_ps_logging:[1401,"bool",!1,!1],web_get_maybe_me_user_optimization_enabled:[1451,"bool",!1,!1],web_should_fatal_on_missing_patch:[1461,"bool",!0,!0],web_reactions_send_desktop_beta_rollout:[1479,"bool",!1,!1],web_abprop_remove_uploaded_files:[1481,"bool",!1,!1],web_abprop_remove_downloaded_files:[1496,"bool",!1,!1],web_new_rich_text_input:[1507,"bool",!1,!1],web_syncd_max_mutations_to_process_during_resume:[1513,"int",1e3,1e3],reactions_skin_tone_aggregation:[1593,"bool",!1,!1],message_quick_reply:[1623,"bool",!1,!1],web_quantity_controls_enabled:[1659,"bool",!1,!1],web_unified_message_processing_enabled:[1633,"bool",!1,!1],web_push_notifications:[1643,"bool",!1,!0],web_notification_settings_v2:[1676,"bool",!1,!0],web_abprop_device_agnostic_voip:[1675,"bool",!1,!1],web_abprop_screen_lock_enabled:[1680,"bool",!1,!1],web_command_palette:[1726,"bool",!1,!1],web_group_profile_editor:[1745,"bool",!1,!1],web_quick_reply_authoring:[1751,"bool",!1,!1],web_accidental_delete_for_me:[1752,"bool",!1,!1],web_abprop_core_wam_runtime:[1753,"bool",!1,!1],web_profile_picture_db_cache_disabled:[1757,"bool",!1,!1],web_offline_resume_qpl_enabled:[1773,"bool",!1,!1],web_offline_resume_m3_enabled:[1802,"bool",!1,!1],web_syncd_fatal_fields_from_L1104589PRV2:[1808,"bool",!1,!1],web_unified_flow:[1809,"int",0,0],web_media_editor_blur_tool:[1816,"bool",!1,!1],web_abprop_mute_notifications_on_app_focus:[1824,"bool",!1,!0],web_multi_skin_toned_emoji_picker:[1850,"bool",!1,!1],web_send_only_active_receipts:[1868,"bool",!1,!0],web_message_send_cache_warming_up:[1894,"bool",!1,!0],web_ptt_streamer_upload:[1902,"bool",!1,!1],web_prekey_fetch_cache_warming_up:[1910,"bool",!1,!0],web_history_sync_ui:[1911,"bool",!1,!1],stop_abprops_traffic_in_serverprops_response:[315,"bool",!1,!1],group_chat_profile_pictures_enabled:[1825,"bool",!1,!1],commerce_metadata_supported_business:[1693,"string","+918591749310,+917977079770","+918591749310,+917977079770,+447766028329"],in_app_survey_phone_numbers:[1607,"string","19195552584","19195552584"],order_details_payment_instructions_enabled:[1595,"bool",!1,!0],enable_biz_activity_report_request:[455,"bool",!1,!1],plm_products_max_batch_fetch_size:[464,"int",18,18],enable_granular_reject_reasons:[550,"bool",!1,!1],elevating_profile_names_enabled:[604,"bool",!1,!1],enable_group_profile_editor:[689,"bool",!1,!1],csat_message_rating:[690,"bool",!1,!0],facebook_link_preview_use_thumbnail:[810,"bool",!1,!0],tam_attachment_cache_compaction_enabled:[838,"bool",!1,!1],business_threads_logging_enabled:[853,"bool",!1,!1],private_stats_biz_view_logging_enabled:[904,"bool",!1,!1],group_join_request_m1:[1727,"bool",!1,!1],group_join_request_m2:[1728,"bool",!1,!1],group_join_request_m2_setting:[1887,"bool",!1,!1],no_delete_message_time_limit:[1011,"bool",!1,!1],sender_revoke_window_sender:[1333,"bool",!1,!0],sender_revoke_window_receiver:[1334,"bool",!1,!0],sender_revoke_ui:[1335,"bool",!1,!0],admin_revoke_receiver:[1177,"bool",!1,!0],admin_revoke_sender:[1292,"bool",!1,!0],admin_revoke_history_sync_consumer:[1245,"bool",!1,!0],revokes_logging_unsampled:[1865,"bool",!0,!0],admin_hfm_toggle:[1021,"bool",!1,!0],csat_message_trigger:[1082,"bool",!1,!0],graphql_privacy_imp_m1:[1096,"bool",!1,!1],lthash_check_hours:[1104,"int",0,0],interactive_message_native_flow_killswitch:[1133,"bool",!1,!1],sender_key_expired_logging_enabled:[1185,"bool",!1,!1],group_size_bypassing_sampling:[1861,"int",1e5,1e5],group_size_limit:[1304,"int",257,257],address_message_native_flow_killswitch:[1538,"bool",!1,!1],commerce_sanctioned:[1319,"bool",!1,!1],commerce_bloks_apps_mapping:[1320,"string","{}","{}"],graphql_privacy_imp_m2:[1327,"bool",!1,!1],nux_sync:[1343,"bool",!1,!0],in_app_survey_enabled:[1377,"bool",!1,!0],poll_creation_enabled:[1394,"bool",!1,!1],poll_receiving_enabled:[1395,"bool",!1,!1],poll_name_length:[1406,"int",255,255],poll_option_length:[1407,"int",100,100],poll_option_count:[1408,"int",12,12],poll_offline_accuracy:[1409,"int",30,30],poll_cleanup_days:[1410,"int",31,31],poll_vote_processing_enabled:[1541,"bool",!1,!1],group_suspend_v1_enabled:[1415,"bool",!1,!0],smb_product_price_label:[1417,"string","control","control"],interactive_response_message_killswitch:[1435,"bool",!1,!1],interactive_response_message_native_flow_killswitch:[1436,"bool",!1,!1],biz_api_voip_enabled:[1464,"bool",!1,!0],quantity_controls_enabled:[1480,"bool",!1,!0],keepable_disappearing_messages:[1504,"bool",!1,!0],catalog_categories_enabled:[1514,"bool",!1,!0],disappearing_messages_chat_picker:[1518,"bool",!1,!1],more_reactions_option:[1322,"bool",!1,!1],reactions_keyboard_hides_three_flags:[1792,"bool",!1,!1],silent_group_exit:[1527,"bool",!1,!0],silent_group_exit_past_participants:[1528,"bool",!1,!0],silent_group_exit_dialog:[1597,"bool",!1,!0],silent_group_exit_sync:[1598,"bool",!1,!0],silent_group_exit_db:[1613,"bool",!1,!0],order_details_quick_pay:[1600,"string",'{"allowed_product_type":"none"}','{"allowed_product_type":"none"}'],incentive_program_logging_enabled:[1599,"bool",!1,!0],md_syncd_24_hour_time_format_sync_enabled:[1612,"bool",!1,!1],send_cart_cta_long_button_enabled:[1660,"bool",!0,!0],product_search_m1_enabled:[1678,"bool",!1,!0],smb_catalog_collections_reordering_enabled:[1688,"bool",!1,!0],smb_catalog_collection_items_reordering_enabled:[1794,"bool",!1,!0],is_message_secret_enabled:[1707,"bool",!1,!0],documents_with_captions_receive:[1749,"bool",!1,!1],documents_with_captions_send:[1750,"bool",!1,!1],external_payments_supported_business:[1763,"string","+917000770007","+918368084712,+917000770007"],active_cart_discovery_enabled:[1766,"bool",!1,!0],order_details_payment_options:[1767,"string",'{"payment_options":[{"type":"JioPay","url_regex_list":["^https://www.jio.com/.*$","^https://t.jio/.*$","^http://tiny.jio.com/.*$"],"title":{"name":"jiopay_title","default_text":"Pay on Jio.com"},"subtitle":{"name":"jiopay_subtitle","default_text":"Go to Jio.com website"},"button":{"name":"jiopay_button","default_text":"Proceed to Jio.com"}}]}','{"payment_options":[{"type":"JioPay","url_regex_list":["^https://www.jio.com/.*$","^https://t.jio/.*$","^http://tiny.jio.com/.*$"],"title":{"name":"jiopay_title","default_text":"Pay on Jio.com"},"subtitle":{"name":"jiopay_subtitle","default_text":"Go to Jio.com website"},"button":{"name":"jiopay_button","default_text":"Proceed to Jio.com"}}]}'],recent_sticker_rollout_phase:[1829,"int",0,0],enable_client_chat_psa:[1844,"bool",!1,!0],direct_connection_business_numbers:[1846,"string","16005554444,918591749310","16005554444,918591749310"],forward_media_with_captions:[1853,"bool",!1,!1],share_phone_number_on_cart_send_to_direct_connection_biz_enabled:[1867,"bool",!1,!1],client_group_participants_limit:[618,"int",257,257],payment_stickers_render_enabled:[812,"bool",!1,!1],privacy_allow_contacts_except:[808,"bool",!1,!1],primary_feature_sync:[1063,"bool",!1,!0],privacy_narrative_v1:[1071,"bool",!1,!1],add_dm_to_chat_overflow_menu:[1309,"bool",!1,!1],keep_in_chat_receiver:[1352,"bool",!1,!1],keep_in_chat_sender:[1353,"bool",!1,!1],kic_orphan_cleanup_days:[1673,"int",31,31],ddm_reversed_options:[1397,"bool",!1,!1],qm_lean_msg:[1645,"bool",!1,!1],pnh_historical_mapping_retention_seconds:[1429,"int",7776e3,7776e3],trusted_contacts_reciprocity:[1437,"bool",!1,!1],trusted_contacts_chat_state_optimization:[1566,"string","old","old"],trusted_contacts_op:[1687,"bool",!1,!0],dm_updated_system_message:[1670,"bool",!1,!0],keep_in_chat_undo_duration_limit:[1698,"int",216e3,216e3],view_once_sp_receiver:[1710,"bool",!1,!1],view_once_sp_sender:[1711,"bool",!1,!1],pnh_ctwa:[1823,"bool",!1,!0],usync_lid:[1892,"bool",!1,!0],sticker_md_favorite_stickers_enabled:[864,"bool",!1,!1],smb_orange_enabled:[1469,"bool",!1,!1],smb_melon_display_enabled:[1483,"bool",!1,!1],smb_melon_management_enabled:[1484,"bool",!1,!1],call_only_primary_device_limit_exceeded:[1525,"bool",!1,!1],smb_premium_md_limit_perf_tracker_enabled:[1591,"bool",!1,!0],smb_billing_premium_access_config:[1619,"string","",""],smb_billing_logging_enabled:[1672,"bool",!1,!0],smb_melon_logging_enabled:[1669,"bool",!1,!0],smb_dcp_enabled:[1701,"bool",!1,!1],smb_custom_url_display_v2_enabled:[1849,"bool",!1,!0]}},246440:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.exposureKeys=t.accessedConfigs=void 0,t.updateGlobalABKey=function(e){i.default.Global.set({abKey2:e})},t.updateGlobalExpoKey=function(){i.default.Global.set({expoKey:Array.from(o).join(",")})};var i=r(n(11339));const a=new Set;t.accessedConfigs=a;const o=new Set;t.exposureKeys=o},183180:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFbBrandedNumber=function(e){if((0,i.isMDBackend)()){return(0,r.getABPropConfigValue)("system_msg_numbers_fb_branded").split(",").includes(e)}return!1},t.getIsInternalNumber=function(e){if((0,i.isMDBackend)()){const t=(0,r.getABPropConfigValue)("system_msg_numbers_fb_branded").split(","),n=(0,r.getABPropConfigValue)("system_msg_numbers_fb_inc").split(",");return t.includes(e)||n.includes(e)}return a.has(e)};var r=n(257243),i=n(88555);const a=new Set(["16505434800","16503130062","16507885324","16508620604","16504228206","16505212669","447710173736","16507885280","19032707825","16505361212","16508129150","16315555102","0"])},227101:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAdminHfmToggleEnabled=function(){var e;return(0,i.isMDBackend)()?null!==(e=(0,r.getABPropConfigValue)("admin_hfm_toggle"))&&void 0!==e&&e:a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.FREQUENTLY_FORWARDED_SETTING)},t.isDefaultDisappearingMessagesEnabled=function(){return!!(null==l?void 0:l.PrimaryFeatures.ddmSettings)&&(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_privacy_settings_v2")},t.isDisappearingModeEnabled=function(){var e;return(0,i.isMDBackend)()?null!==(e=(0,r.getABPropConfigValue)("disappearing_mode"))&&void 0!==e&&e:a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.DISAPPEARING_MODE)},t.isDropLastNameEnabled=function(){var e;return!!(0,i.isMDBackend)()&&(null!==(e=(0,r.getABPropConfigValue)("drop_last_name"))&&void 0!==e&&e)},t.isElevatedImportantMessageEnabled=function(){var e;return!(!(0,i.isMDBackend)()||!d())&&(null!==(e=(0,r.getABPropConfigValue)("elevated_important_msg"))&&void 0!==e&&e)},t.isEphemeral24HDurationEnabled=function(){var e;return(0,i.isMDBackend)()?null!==(e=(0,r.getABPropConfigValue)("ephemeral_24h_duration"))&&void 0!==e&&e:a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.EPHEMERAL_24_H_DURATION)},t.isGroupCatchUpEnabled=d,t.isInAppSupportEnabled=function(){if((0,i.isMDBackend)()){if(!(0,r.getABPropConfigValue)("in_app_support_v2_enabled"))return!1;const e=(0,r.getABPropConfigValue)("in_app_support_v2_locale_langs");if(""===e)return!0;const t=new Set(e.split(",")),i=n(914296).default;return t.has(i.getLocale())}return a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.SUPPORT)},t.isOnlinePresenceEnabled=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("trusted_contacts_op");return!1},t.isPrivacyNarrativeV1Enabled=function(){if((0,i.isMDBackend)()&&(null==s?void 0:s.Conn.isSMB))return!1;return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("privacy_narrative_v1")},t.isSenderRevokeUiEnabled=function(){var e;return(0,i.isMDBackend)()?null!==(e=(0,r.getABPropConfigValue)("sender_revoke_ui"))&&void 0!==e&&e:a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.NO_DELETE_MESSAGE_TIME_LIMIT)},t.isSenderRevokeWindowReceiverEnabled=function(){var e;return(0,i.isMDBackend)()?null!==(e=(0,r.getABPropConfigValue)("sender_revoke_window_receiver"))&&void 0!==e&&e:a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.NO_DELETE_MESSAGE_TIME_LIMIT)},t.isSenderRevokeWindowSenderEnabled=function(){var e;return(0,i.isMDBackend)()?null!==(e=(0,r.getABPropConfigValue)("sender_revoke_window_sender"))&&void 0!==e&&e:a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.NO_DELETE_MESSAGE_TIME_LIMIT)};var r=n(257243),i=n(88555),a=n(438184),o=n(555452),s=u(n(317239)),l=u(n(634771));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function d(){if((0,i.isMDBackend)()){var e,t;const n=null!==(e=(0,o.getUnreadMentionCountEnabled)())&&void 0!==e&&e;return null!==(t=(0,r.getABPropConfigValue)("group_catch_up"))&&void 0!==t&&t&&n}return!1}},464358:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABKey=function(){const e=l();return null==e?void 0:e.abKey},t.getHash=function(){const e=l();return null==e?void 0:e.hash},t.getLastSyncTime=function(){const e=l(),t=null==e?void 0:e.lastSyncTime;if(null==t)return null;return parseInt(t,10)},t.getRefresh=function(){var e;const t=l();return parseInt(null!==(e=null==t?void 0:t.refresh)&&void 0!==e?e:86400,10)},t.isABPropsAfterFirstSync=function(){return null!=l()},t.updateAttributesLocalStorage=function(e,t,n,r){var c,u;let d=null;null!=n&&(d=n,d<600?d=600:d>s&&(d=s));const p=l()||{},f={abKey:null!=e?e:p.abKey,hash:null!=t?t:p.hash,refresh:null!==(c=null===(u=d)||void 0===u?void 0:u.toString())&&void 0!==c?c:p.refresh,lastSyncTime:r};(0,i.default)(a.default,"localStorage").setItem(o.KEYS.ABPROPS,JSON.stringify(f))};var i=r(n(145095)),a=r(n(904285)),o=n(546718);const s=604800;function l(){const e=(0,i.default)(a.default,"localStorage").getItem(o.KEYS.ABPROPS);return null==e?null:JSON.parse(e)}},726682:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isMDBackend)()){const t=(0,r.getABPropConfigValue)("in_app_support_v2_number_prefixes");return null!=t&&""!==t&&t.split(",").some((t=>e.startsWith(t)))}return!1};var r=n(257243),i=n(88555)},246007:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.compareServerPropsAndABProps=function(){new Map([["web_abprop_ctwa_context_compose_enabled",["ctwaContextCompose",o.ServerProps.ctwaContextCompose]],["web_abprop_group_description_length",["groupDescLength",o.ServerProps.groupDescLength]],["web_abprop_ephemeral_messages_allowed_values",["ephemeralMessagesAllowedValues",o.ServerProps.ephemeralMessagesAllowedValues]]]).forEach(((e,t)=>{const n=(0,i.getABPropConfigValue)(t);new a.default.WebcAbpropsValidation({abpropName:t,abpropValue:String(n),serverPropName:String(e[0]),serverPropValue:String(e[1])}).commit()}))};var i=n(257243),a=r(n(11339)),o=n(964551)},541080:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeBridge=function(){return new r.DynamicRouter};var r=n(702486)},722854:(e,t,n)=>{"use strict";var r=n(595318);t.Z=void 0;var i=n(739948),a=r(n(652991)),o=r(n(943610));var s={logImpl:(e,t,n,r,a)=>(i.Logger.logImpl(e,t,n,r,a),Promise.resolve()),initFromStorage:()=>o.default.invoke("initFromStorage",[]),setLogoutState:e=>(a.default.isLogoutInProgress=e,o.default.invoke("setLogoutState",[e])),sendLogs:e=>n(386374).sendLogs(e),deleteDbEncKeyCache:()=>o.default.invoke("deleteDbEncKeyCache",[]),initDatabaseEncnKey:e=>o.default.invoke("initDatabaseEncnKey",[e]),generateFinalDbEncryptionAndFtsKey:e=>o.default.invoke("generateFinalDbEncryptionAndFtsKey",[e]),startBackendWorker:()=>Promise.resolve(),startBackendWorkerDebugHelper:()=>Promise.resolve()};t.Z=s},141208:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=new MessageChannel,n=t.port1,r=t.port2;o.default.respondTo(n),i.default.init(),a.default.setConnectionManager(i.default),i.default.connectVia(n),e.postMessage((0,s.buildHandshakePayload)(r),[r])};var i=r(n(782090)),a=r(n(943610)),o=r(n(572601)),s=n(503620)},979038:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(141208));const a=new(r(n(735474)).default);(0,i.default)(a);var o=a;t.default=o},782090:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(145095)),a=n(638284),o=n(88156),s=r(n(441143));var l=new class{init(){return this._port=null,this._deferred=new o.Resolvable,(0,a.promiseTimeout)(this._deferred.promise,5e3)}isConnected(){return null!=this._port}getPort(){return this._port}waitForConnection(){var e;return(0,i.default)(null===(e=this._deferred)||void 0===e?void 0:e.promise,"ConnectionManager Initialization Promise")}connectVia(e){if(this.isConnected())throw new Error("Connection already established");(0,s.default)(this._deferred,"ConnectionManager not initialized"),this._port=e,this._deferred.resolve()}};t.default=l},652991:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11339));const a={[i.default.WEBC_SCENARIO_TYPE.IDLE]:0,[i.default.WEBC_SCENARIO_TYPE.INITIAL_PAIRING]:3e5,[i.default.WEBC_SCENARIO_TYPE.OFFLINE_RESUME]:12e4};let o,s;var l={isLogoutInProgress:!1,getCurrentScenario(){var e;return null!==(e=s)&&void 0!==e?e:i.default.WEBC_SCENARIO_TYPE.IDLE},initOrUpdateTracking(e){o&&clearTimeout(o),s=e,s!==i.default.WEBC_SCENARIO_TYPE.IDLE&&(o=setTimeout((()=>{s=i.default.WEBC_SCENARIO_TYPE.IDLE,o=null}),a[e]))}};t.default=l},943610:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(322068),s=n(912758),l=n(123097),c=r(n(441143));var u=new class{constructor(){this._pending=new Map,this._handleResponseReceipt=e=>{const t=(0,l.unwrapResponsePayload)(e.data);if(null!=t){const{invocationId:e,result:n}=t;if(this._pending.has(e)){const{resolve:t}=(0,a.default)(this._pending.get(e),"this._pending.get(invocationId)");t(n),this._pending.delete(e)}}}}setConnectionManager(e){this._conn=e,e.waitForConnection().then((()=>{const t=(0,a.default)(e.getPort(),"Port obtained from ConnectionManager after connection");t.addEventListener("message",this._handleResponseReceipt),t.start()}))}invoke(e,t){var n=this;return(0,i.default)((function*(){(0,c.default)(n._conn,"Connection has not been inited"),yield n._conn.waitForConnection(),(0,c.default)(n._conn,"Connection has not been inited");const r=(0,a.default)(n._conn.getPort(),"Port obtained from ConnectionManager after connection"),i=(0,o.genInvocationId)();return r.postMessage((0,s.buildInvocationPayload)({invocationId:i,method:e,args:t})),new Promise(((e,t)=>{n._pending.set(i,{resolve:e,reject:t})}))}))()}};t.default=u},572601:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(277303)),i=n(912758),a=n(123097);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}var s=new class{constructor(){this._handleMessage=(e,t)=>{const n=t.data,o=(0,i.unwrapInvocationPayload)(n);if(null!=o){const{method:t,args:n,invocationId:i}=o;r.get()[t](...n).then((t=>{e.postMessage((0,a.buildResponsePayload)(i,t))}))}}}respondTo(e){e.addEventListener("message",(t=>this._handleMessage(e,t))),e.start()}};t.default=s},322068:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractInvocationId=function(e){if(null!=e&&"number"==typeof e)return e},t.genInvocationId=function(){return n++};let n=1},277303:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.get=l,t.log=void 0,t.sendLogs=function(e){return l().sendLogs(e)},t.set=function(e){s=e};var i=r(n(570185)),a=r(n(145095)),o=r(n(679405));let s;function l(){return(0,a.default)(s,"InvocationInterface was not inited")}const c=(0,i.default)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return function(a){for(var s=arguments.length,c=new Array(s>1?s-1:0),u=1;u<s;u++)c[u-1]=arguments[u];const d=(0,o.default)(a,c,!t);let p;return n&&(p={name:n.name,stack:n.stack}),l().logImpl(e,d,p,r,i),d}}),((e,t,n,r,i)=>n||i?null:String(e)+String(Boolean(t))+String(Boolean(r))));t.log=c},503620:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildHandshakePayload=function(e){return{__command:i.HANDSHAKE_COMMAND,__port:e}},t.extractPortFromHandshakePayload=function(e){if(null!=e&&null!=e.__command&&e.__command===i.HANDSHAKE_COMMAND&&null!=e.__port){(0,a.default)(e.__port instanceof MessagePort,"Malformed connection payload");return e.__port}};var i=n(837557),a=r(n(441143))},912758:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildInvocationPayload=function(e){let{invocationId:t,method:n,args:r}=e;return{__id:t,__command:i.INVOCATION_COMMAND,__method:n,__args:r}},t.unwrapInvocationPayload=function(e){if(null!=e&&e.__command===i.INVOCATION_COMMAND){(0,o.default)(e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,o.default)(null!=t&&e.__method&&"string"==typeof e.__method&&e.__id&&e.__args&&Array.isArray(e.__args),"Malformed invocation message");const n=e,r=n.__method,i=n.__args;return{method:r,args:i,invocationId:t}}};var i=n(837557),a=n(322068),o=r(n(441143))},123097:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.buildResponsePayload=function(e,t){return{__id:e,__command:i.RESPONSE_COMMAND,__result:t}},t.unwrapResponsePayload=function(e){if(null!=e&&e.__command===i.RESPONSE_COMMAND){(0,o.default)(null!=e.__id,"Invocation ID missing");const t=(0,a.extractInvocationId)(e.__id);(0,o.default)(null!=t&&e.hasOwnProperty("__result"),"Malformed response message");return{result:e.__result,invocationId:t}}};var i=n(837557),a=n(322068),o=r(n(441143))},837557:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_COMMAND=t.INVOCATION_COMMAND=t.HANDSHAKE_COMMAND=void 0;t.HANDSHAKE_COMMAND="@@handshake";t.INVOCATION_COMMAND="@@invoke";t.RESPONSE_COMMAND="@@response"},535470:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EDIT_ATTR=t.ACK_STRING=t.ACK=void 0;t.ACK={MD_DOWNGRADE:-7,INACTIVE:-6,CONTENT_UNUPLOADABLE:-5,CONTENT_TOO_BIG:-4,CONTENT_GONE:-3,EXPIRED:-2,FAILED:-1,CLOCK:0,SENT:1,RECEIVED:2,READ:3,PLAYED:4,PEER:5};t.EDIT_ATTR={SENDER_REVOKE:7,ADMIN_REVOKE:8};t.ACK_STRING={SENDER:"sender",DELIVERY:"delivery",READ:"read",PLAYED:"played",INACTIVE:"inactive",READ_SELF:"read-self",PLAYED_SELF:"played-self"}},813042:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAGE_SIZE=t.MSG_PRELOAD_THRESHOLD=t.COLLECTION_HAS_SYNCED=void 0;t.COLLECTION_HAS_SYNCED="collection_has_synced";t.PAGE_SIZE=50;t.MSG_PRELOAD_THRESHOLD=20},364369:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={IMG_THUMB_MAX_EDGE:100,DOC_THUMB_MAX_EDGE:480,VIDEO_THUMB_MAX_EDGE:480,MAX_PORTRAIT_MEDIA_CAPTION_LENGTH:500,MAX_FILES:30,MEDIA_EDITOR_OUTLINE_TENSION:.4,MMS_THUMBNAIL_UPLOAD_TIMEOUT:3e3,FREQUENTLY_FORWARDED_SENTINEL:127,MAX_SMB_LABEL_COUNT:20,WA_COMMERCE_POLICY_URL:"https://www.whatsapp.com/policies/commerce-policy",MAX_TXT_MSG_SIZE:65536,GROUP_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:100,BUSINESS_DESCRIPTION_INFO_PANEL_TRUNC_LENGTH:200,TEMPLATE_URL_START:64,TEMPLATE_URL_END:32,SQUELCH_RESET_VALUE:-1,MAX_CAPTION_LENGTH:1024,REACTION_CONTENT_MAX_LENGTH:30,MAX_CART_MESSAGE_LENGTH:1024,MAX_PUSHNAME_LENGTH:25,KEY_BUNDLE_TYPE:"",NEW_MSG_SENT:"new_msg_sent",ONE_BY_ONE_TRANS_GIF:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",VOIP_LOG_COLOR:"#aa6627",VOIP_MAX_GROUP_CALL_PARTICIPANTS:32,WAM_SYS_INFO_INIT_DELAY:5e3,MARKED_AS_UNREAD:-1};t.default=n},520289:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_TO_CLB=t.TICKET_URL=t.LOG_SIZE=t.CLB_URL=t.CLB_TOKEN=t.CLB_CHECK_URL=void 0;t.CLB_CHECK_URL="https://crashlogs.whatsapp.net/wa_fls_upload_check";t.CLB_TOKEN="1063127757113399|745146ffa34413f9dbb5469f5370b7af";t.CLB_URL="https://crashlogs.whatsapp.net/wa_clb_data";t.TICKET_URL="https://web.whatsapp.com/web-contact-us";let n=0;n=1;t.UPLOAD_TO_CLB=1;t.LOG_SIZE=4999},221310:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORM=t.FAQ_BASE_URL=void 0,t.getBusinessFaqUrl=function(){return s("general/chats/about-chatting-with-businesses")},t.getCannotConnectFaqUrl=function(){return s("web/troubleshooting/cant-connect-to-whatsapp")},t.getCatalogCartOnOffFaqUrl=function(){return s("general/account-and-profile/about-cart")},t.getCiphertextFaqUrl=function(){return s("general/security-and-privacy/seeing-waiting-for-this-message-this-may-take-a-while")},t.getCodeChangeFaqUrl=function(){return s("general/security-and-privacy/security-code-change-notification")},t.getCommunitiesLearningCenterUrl=function(){return`https://www.whatsapp.com/communities/learning?lang=${i.default.getLocale()}`},t.getCommunityHomeNuxUrl=function(){return s("general/about-community")},t.getCommunityNotAvailableFaqUrl=function(){return s("cxt/?entrypointid=community-no-longer-available",!0)},t.getDBErrorFaqUrl=function(){return s("web/about-seeing-a-database-error-occured-on-your-browser")},t.getE2EEnterpriseFaqUrl=function(){return s("general/security-and-privacy/end-to-end-encryption-for-business-messages")},t.getE2EFaqUrl=function(){return s("general/security-and-privacy/end-to-end-encryption")},t.getEphemeralFaqUrl=function(){return s("general/chats/about-disappearing-messages")},t.getFanoutPlaceholderFaqUrl=function(){return s("general/security-and-privacy/seeing-waiting-for-this-message-check-your-phone")},t.getFaqUrl=function(){return`${a}/web?lang=${i.default.getLocale()}`},t.getFrequentlyForwardedFaqUrl=function(){return s("general/chats/about-forwarding-limits")},t.getGroupInviteGrowthLockedFaqUrl=function(){return s("cxt/?entrypointid=invite-via-link-unavailable",!0)},t.getHowToExitAndDeleteGroupsFaq=function(){return s("web/chats/how-to-exit-and-delete-groups")},t.getJioMartPostcodeChangeLearnMoreLink=function(){return s("general/security-and-privacy/about-sharing-your-information-with-businesses-on-whatsapp")},t.getLinkDeviceFaqUrl=function(){return s("web/download-and-installation/how-to-link-a-device")},t.getLoginFaqUrl=function(){return s("web/download-and-installation/how-to-log-in-or-out")},t.getMDCodeChangeFaqUrl=function(){return`${a}/${i.default.getLocale()}/web/26000361`},t.getMdOptInFaqUrl=function(){return s("general/download-and-installation/about-linked-devices")},t.getNonVerifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-a-standard-account")},t.getNotificationChromeFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-chrome")},t.getNotificationEdgeFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-microsoft-edge")},t.getNotificationFirefoxFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-firefox")},t.getNotificationOperaFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-opera")},t.getNotificationSafariFaqUrl=function(){return s("web/troubleshooting/cant-receive-notifications-on-safari")},t.getRevokeFaqUrl=function(){return s("web/chats/how-to-delete-messages")},t.getSupportChatFaqUrl=function(){return s("general/what-information-does-whatsapp-collect-when-you-contact-support")},t.getSupportChatSafetyFaqUrl=function(){return s("general/about-safely-communicating-with-whatsapp-support")},t.getSuspiciousLinkFaqUrl=function(){return s("web/chats/suspicious-links")},t.getUnverifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-unverified")},t.getUpdatePrimaryDeviceFaqUrl=function(){return s("general/download-and-installation/how-to-update-whatsapp")},t.getVerifiedHighFaqUrl=function(){return s("general/verified-business-account")},t.getVerifiedLowUnknownFaqUrl=function(){return s("general/unverified-business-account")},t.getVerifiedTransitionFaqUrl=function(){return s("general/business-account-becomes-verified")},t.getViewOnceFaqUrl=function(){return s("general/chats/about-view-once")};var i=r(n(914296));const a="https://faq.whatsapp.com";t.FAQ_BASE_URL=a;const o="web";function s(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?`${a}/${e}&platform=web&lang=${i.default.getLocale()}`:`${a}/${e}?lang=${i.default.getLocale()}`}t.PLATFORM=o},312380:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAST_PARTICIPANT_EXPIRATION_DAYS=t.GROUP_SETTING_TYPE=void 0;t.GROUP_SETTING_TYPE={ANNOUNCEMENT:"announcement",RESTRICT:"restrict",NO_FREQUENTLY_FORWARDED:"no_frequently_forwarded",EPHEMERAL:"ephemeral",MEMBERSHIP_APPROVAL_MODE:"membership_approval_mode"};t.PAST_PARTICIPANT_EXPIRATION_DAYS=60},538069:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYBOARD_EVENT_KEY_VALUE=void 0;t.KEYBOARD_EVENT_KEY_VALUE={UNIDENTIFIED:"Unidentified",ALT:"Alt",ALT_GRAPH:"AltGraph",CAPS_LOCK:"CapsLock",CONTROL:"Control",FN:"Fn",FN_LOCK:"FnLock",HYPER:"Hyper",META:"Meta",NUM_LOCK:"NumLock",SCROLL_LOCK:"ScrollLock",SHIFT:"Shift",SUPER:"Super",SYMBOL:"Symbol",SYMBOL_LOCK:"SymbolLock",OS:"OS",ENTER:"Enter",TAB:"Tab",SPACE:" ",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",ARROW_UP:"ArrowUp",LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down",END:"End",HOME:"Home",PAGE_DOWN:"PageDown",PAGE_UP:"PageUp",BACKSPACE:"Backspace",CLEAR:"Clear",COPY:"Copy",CR_SEL:"CrSel",CRSEL:"Crsel",CUT:"Cut",DELETE:"Delete",ERASE_EOF:"EraseEof",EX_SEL:"ExSel",EXSEL:"Exsel",INSERT:"Insert",PASTE:"Paste",REDO:"Redo",UNDO:"Undo"}},788950:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoutReason=t.LOGOUT_REASON_CODE=void 0;const r=n(76672)({UserInitiated:"user_initiated",SyncdFailure:"syncd_failure",InvalidAdvStatus:"invalid_adv_status",CriticalSyncTimeout:"critical_sync_timeout",SyncdTimeout:"syncd_timeout",HistorySyncTimeout:"history_sync_timeout",AccountSyncTimeout:"account_sync_timeout",MDOptOut:"md_opt_out",UnknownCompanion:"unknown_companion",ClientVersionOutdated:"client_version_outdated",SyncdErrorDuringBootstrap:"syncd_error_during_bootstrap",AccountSyncError:"account_sync_error",ClientFatalError:"client_fatal_error",StorageQuotaExceeded:"storage_quota_exceeded",PrimaryIdentityKeyChange:"primary_identity_key_change",MissingEncSalt:"missing_enc_salt",MissingScreenLockSalt:"missing_screen_lock_salt"});t.LogoutReason=r;t.LOGOUT_REASON_CODE={CLIENT_FATAL:"0",SYNC_FAIL:"1",INITIAL_HISTORY_SYNC_TIMEOUT:"2"}},115461:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SYSTEM_MESSAGE_TYPES=t.MSG_TYPE=t.ADDON_MESSAGE_TYPES=void 0;t.MSG_TYPE={NOTIFICATION:"notification",NOTIFICATION_TEMPLATE:"notification_template",GROUP_NOTIFICATION:"group_notification",GP2:"gp2",BROADCAST_NOTIFICATION:"broadcast_notification",E2E_NOTIFICATION:"e2e_notification",CALL_LOG:"call_log",PROTOCOL:"protocol",CHAT:"chat",LOCATION:"location",PAYMENT:"payment",VCARD:"vcard",CIPHERTEXT:"ciphertext",MULTI_VCARD:"multi_vcard",REVOKED:"revoked",OVERSIZED:"oversized",GROUPS_V4_INVITE:"groups_v4_invite",HSM:"hsm",TEMPLATE_BUTTON_REPLY:"template_button_reply",DEBUG:"debug",IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",ORDER:"order",LIST:"list",INTERACTIVE:"interactive",INTERACTIVE_RESPONSE:"interactive_response",LIST_RESPONSE:"list_response",BUTTONS_RESPONSE:"buttons_response",REACTION:"reaction",POLL_CREATION:"poll_creation",REQUEST_PHONE_NUMBER:"request_phone_number",POLL_UPDATE:"poll_update",NATIVE_FLOW:"native_flow",BIZ_COVER_PHOTO:"biz-cover-photo",KEEP_IN_CHAT:"keep_in_chat",UNKNOWN:"unknown"};t.SYSTEM_MESSAGE_TYPES=["notification","notification_template","group_notification","gp2","broadcast_notification","e2e_notification","call_log","protocol","debug"];t.ADDON_MESSAGE_TYPES=["reaction","poll_update"]},410945:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PERMISSION_DENIED=t.PERMISSION_DEFAULT=t.PERMISSION_ALLOWED=void 0;t.PERMISSION_ALLOWED="granted";t.PERMISSION_DEFAULT="default";t.PERMISSION_DENIED="denied"},468387:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.VISIBILITY_WITH_ERROR=t.VISIBILITY=t.ONLINE_VISIBILITY=t.ALL_NONE_WITH_ERROR=t.ALL_NONE=void 0;var i=r(n(81109));const a={all:"all",contacts:"contacts",contact_blacklist:"contact_blacklist",none:"none"};t.VISIBILITY=a;const o=(0,i.default)((0,i.default)({},a),{},{error:"error"});t.VISIBILITY_WITH_ERROR=o;const s={all:"all",none:"none"};t.ALL_NONE=s;t.ONLINE_VISIBILITY={all:"all",match_last_seen:"match_last_seen"};const l=(0,i.default)((0,i.default)({},s),{},{error:"error"});t.ALL_NONE_WITH_ERROR=l},841473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM=t.IS_MMS_URL_SEARCH_PARAM=void 0;t.IS_MMS_URL_SEARCH_PARAM="__wa-mms";t.MMS_URL_MEDIA_TYPE_SEARCH_PARAM="mms-type"},387674:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpamFlow=t.SPAM_REPORT_SUPPORTED_MESSAGE_TYPES=void 0;var r=n(115461);const i=n(76672)({Chat:"chat",Account:"account_info",Group:"group_info",Block:"block_dialog",Dropdown:"overflow_menu",MediaViewer:"media_viewer",MessageMenu:"message_menu",CommunityHome:"community_home"});t.SpamFlow=i;const a=new Set([r.MSG_TYPE.CHAT,r.MSG_TYPE.AUDIO,r.MSG_TYPE.IMAGE,r.MSG_TYPE.PTT,r.MSG_TYPE.VIDEO,r.MSG_TYPE.VCARD,r.MSG_TYPE.UNKNOWN,r.MSG_TYPE.CIPHERTEXT,r.MSG_TYPE.LIST,r.MSG_TYPE.LIST_RESPONSE,r.MSG_TYPE.BUTTONS_RESPONSE,r.MSG_TYPE.NATIVE_FLOW,r.MSG_TYPE.DOCUMENT,r.MSG_TYPE.STICKER,r.MSG_TYPE.LOCATION]);t.SPAM_REPORT_SUPPORTED_MESSAGE_TYPES=a},515411:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEMPLATE_BUTTON_SUBTYPE=void 0;t.TEMPLATE_BUTTON_SUBTYPE={QUICK_REPLY:"quick_reply",CALL:"call",URL:"url"}},837626:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SEVEN_DAYS=t.ONE_DAY=t.OFF=t.NINETY_DAYS=t.KeepInChatState=t.DisappearingModeInitiator=void 0;var r=n(892844);t.OFF=0;const i=r.DAY_SECONDS;t.ONE_DAY=i;const a=7*r.DAY_SECONDS;t.SEVEN_DAYS=a;const o=90*r.DAY_SECONDS;t.NINETY_DAYS=o;const s=n(76672)({ChangedInChat:"chat",InitiatedByMe:"me",InitiatedByOther:"other"});t.DisappearingModeInitiator=s;const l=n(76672).Mirrored(["KEPT","UNKEPT"]);t.KeepInChatState=l},247343:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decodeBroadcastEphemeralSetting=function(){return h.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(108584),s=n(892844),l=n(128286),c=n(484902);const u=new Uint8Array(32);function d(){return p.apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t){const n=yield self.crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveKey"]),r=yield self.crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:u,info:t},n,{name:"HMAC",hash:"SHA-256"},!0,["verify"]);return self.crypto.subtle.exportKey("raw",r)}))).apply(this,arguments)}function f(){return _.apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n){const r=e.slice(0,12),i=e.slice(12,44),a=yield self.crypto.subtle.importKey("raw",i,"AES-GCM",!1,["decrypt"]);return self.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(r),additionalData:n},a,t)}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e,t,n,r,i){const u=e.toString({legacy:!0}),p=t.toString({legacy:!0}),_=n.toString({legacy:!0}),h=o.Binary.build(`Ephemeral ${p} ${u}`).readByteArray(),g=new Uint8Array(i),m=(0,a.decodeB64)(r),y=o.Binary.build(_).readBuffer(),S=yield d(g,h),E=yield f(S,m,y),{duration:v,timestamp:T}=(0,c.decodeProtobuf)(l.EphemeralSettingSpec,E);if(null==v||null==T)throw new Error("ephSetting decoded into malformed proto");return{ephemeralDuration:v,ephemeralSettingTimestamp:(0,s.castLongIntToUnixTime)(T)}}))).apply(this,arguments)}},524606:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisappearingModeInitiator=void 0;const r=n(76672)({ChangedInChat:"chat",InitiatedByMe:"me",InitiatedByOther:"other"});t.DisappearingModeInitiator=r},782109:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EphemeralStringType=void 0,t.getDisappearingMessageDurationStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.Duration,e)},t.getDisappearingMessageExplanationStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.Explanation,e)},t.getDisappearingMessageOutOfSyncInfoStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.OutOfSyncInfo,e)},t.getDisappearingMessageSettingOthersAsAdminGroupStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return _(s.SettingChangeByOthersAsAdmin,e,t)},t.getDisappearingMessageSettingOthersAsAdminStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return l(s.SettingChangeByOthersAsAdmin,e,t)},t.getDisappearingMessageSettingOthersGroupStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return _(s.SettingChangeByOthers,e,t)},t.getDisappearingMessageSettingOthersStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return l(s.SettingChangeByOthers,e,t)},t.getDisappearingMessageSettingUnknownAsAdminStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.SettingChangeByUnknownAsAdmin,e)},t.getDisappearingMessageSettingUnknownStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.SettingChangeByUnknown,e)},t.getDisappearingMessageSettingYouAsAdminStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.SettingChangeByYouAsAdmin,e)},t.getDisappearingMessageSettingYouStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.SettingChangeByYou,e)},t.getDisappearingModeOtherStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return l(s.ModeChangeByOthers,e,t)},t.getDisappearingModeYouStringKic=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l(s.ModeChangeByYou,e)},t.getKeptByString=function(e){const t=a.ContactCollection.assertGet(e);if(null==t?void 0:t.isMe)return o.fbt._("Kept by You",null,{hk:"2cgwzF"});{const n=(null==t?void 0:t.isMyContact)?t.formattedName:(0,i.widToFormattedUser)(e);return o.fbt._("Kept by {person-name}",[o.fbt._param("person-name",n)],{hk:"4jCayt"})}};var r=n(227101),i=n(562054),a=n(719380),o=n(548360);const s=n(76672).Mirrored(["SettingChangeByOthers","SettingChangeByYou","SettingChangeByUnknown","SettingChangeByOthersAsAdmin","SettingChangeByYouAsAdmin","SettingChangeByUnknownAsAdmin","Duration","OutOfSyncInfo","Explanation","ModeChangeByOthers","ModeChangeByYou"]);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(t<0)return __LOG__(4,void 0,new Error,!0)`getEphemeralString ${e} is given invalid duration ${t}`,SEND_LOGS("invalid-duration"),"";if(0===t)return c(e,n);if(t<=60)return u(e,t,n);if(t<=3600){return d(e,Math.floor(t/60),n)}if(t<=86400){return p(e,Math.floor(t/60/60),n)}const r=Math.floor(t/24/60/60);return f(e,r,n)}function c(e,t){return e===s.SettingChangeByOthers&&null!=t?o.fbt._("{person-name} turned off disappearing messages.",[o.fbt._param("person-name",t)],{hk:"XO892"}):e===s.SettingChangeByYou?o.fbt._("You turned off disappearing messages.",null,{hk:"9TMbp"}):e===s.SettingChangeByUnknown?o.fbt._("Disappearing messages were turned off.",null,{hk:"3IBeCD"}):e===s.SettingChangeByOthersAsAdmin&&null!=t?o.fbt._("{person-name} turned off disappearing messages. Click to change.",[o.fbt._param("person-name",t)],{hk:"su743"}):e===s.SettingChangeByYouAsAdmin?o.fbt._("You turned off disappearing messages. Click to change.",null,{hk:"3n2ern"}):e===s.SettingChangeByUnknownAsAdmin?o.fbt._("Disappearing messages were turned off. Click to change.",null,{hk:"42Gz4g"}):e===s.Duration?o.fbt._("Off",null,{hk:"3BRZfX"}):e===s.OutOfSyncInfo?o.fbt._("This message will not disappear from the chat. The sender may be on an old version of WhatsApp.",null,{hk:"KEziN"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOffString is given invalid type ${e}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function u(e,t,n){const i=(0,r.isDefaultDisappearingMessagesEnabled)();return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 second after they're sent, except when kept."},[o.fbt._plural(t,"number_of_seconds"),o.fbt._param("person-name",n)],{hk:"4kkOWq"}):e===s.SettingChangeByYou?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 second after they're sent, except when kept."},[o.fbt._plural(t,"number_of_seconds")],{hk:"2k7TQ1"}):e===s.SettingChangeByUnknown?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 second after they're sent, except when kept."},[o.fbt._plural(t,"number_of_seconds")],{hk:"bo1mR"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_seconds"),o.fbt._param("person-name",n)],{hk:"31TjrZ"}):e===s.SettingChangeByYouAsAdmin?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to change.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_seconds")],{hk:"3miT5e"}):e===s.SettingChangeByUnknownAsAdmin?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to change.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_seconds")],{hk:"IOXzj"}):e===s.Duration?o.fbt._({"*":"{number_of_seconds} seconds",_1:"1 second"},[o.fbt._plural(t,"number_of_seconds")],{hk:"2ek3Kv"}):e===s.OutOfSyncInfo?o.fbt._({"*":"This message will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept.",_1:"This message will disappear from this chat 1 second after they're sent, except when kept."},[o.fbt._plural(t,"number_of_seconds")],{hk:"2Fe69a"}):e===s.Explanation?o.fbt._({"*":"New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept.",_1:"New messages will disappear from this chat 1 second after they're sent, except when kept."},[o.fbt._plural(t,"number_of_seconds")],{hk:"mlkne"}):e===s.ModeChangeByOthers?i?o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to set your own default timer.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to set your own default timer."},[o.fbt._plural(t,"number_of_seconds"),o.fbt._param("person-name",n)],{hk:"3HoMUO"}):o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to learn more.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_seconds"),o.fbt._param("person-name",n)],{hk:"JNSih"}):e===s.ModeChangeByYou?i?o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to change your default timer."},[o.fbt._plural(t,"number_of_seconds")],{hk:"kqWHO"}):o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to learn more.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_seconds")],{hk:"3mvB3N"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnSecondsString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function d(e,t,n){const i=(0,r.isDefaultDisappearingMessagesEnabled)();return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 minute after they're sent, except when kept."},[o.fbt._plural(t,"number_of_minutes"),o.fbt._param("person-name",n)],{hk:"3B0sxH"}):e===s.SettingChangeByYou?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 minute after they're sent, except when kept."},[o.fbt._plural(t,"number_of_minutes")],{hk:"8ptBy"}):e===s.SettingChangeByUnknown?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 minute after they're sent, except when kept."},[o.fbt._plural(t,"number_of_minutes")],{hk:"2ZcAto"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_minutes"),o.fbt._param("person-name",n)],{hk:"1rr4wS"}):e===s.SettingChangeByYouAsAdmin?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to change.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_minutes")],{hk:"2qSGiH"}):e===s.SettingChangeByUnknownAsAdmin?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to change.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_minutes")],{hk:"4pRdjD"}):e===s.Duration?o.fbt._({"*":"{number_of_minutes} minutes",_1:"1 minute"},[o.fbt._plural(t,"number_of_minutes")],{hk:"3D4yRb"}):e===s.OutOfSyncInfo?o.fbt._({"*":"This message will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept.",_1:"This message will disappear from this chat 1 minute after they're sent, except when kept."},[o.fbt._plural(t,"number_of_minutes")],{hk:"10OLU9"}):e===s.Explanation?o.fbt._({"*":"New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept.",_1:"New messages will disappear from this chat 1 minute after they're sent, except when kept."},[o.fbt._plural(t,"number_of_minutes")],{hk:"1lxJuv"}):e===s.ModeChangeByOthers?i?o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to set your own default timer.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to set your own default timer."},[o.fbt._plural(t,"number_of_minutes"),o.fbt._param("person-name",n)],{hk:"4CqMhX"}):o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to learn more.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_minutes"),o.fbt._param("person-name",n)],{hk:"12RSEy"}):e===s.ModeChangeByYou?i?o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to change your default timer."},[o.fbt._plural(t,"number_of_minutes")],{hk:"10Ts6G"}):o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to learn more.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_minutes")],{hk:"3dn7ae"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnMinutesString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function p(e,t,n){const i=(0,r.isDefaultDisappearingMessagesEnabled)();return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 hour after they're sent, except when kept."},[o.fbt._plural(t,"number_of_hours"),o.fbt._param("person-name",n)],{hk:"2ZKFqA"}):e===s.SettingChangeByYou?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 hour after they're sent, except when kept."},[o.fbt._plural(t,"number_of_hours")],{hk:"4Bhxbn"}):e===s.SettingChangeByUnknown?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 hour after they're sent, except when kept."},[o.fbt._plural(t,"number_of_hours")],{hk:"4gJufp"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_hours"),o.fbt._param("person-name",n)],{hk:"1S7Usz"}):e===s.SettingChangeByYouAsAdmin?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to change.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_hours")],{hk:"3cnipx"}):e===s.SettingChangeByUnknownAsAdmin?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to change.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_hours")],{hk:"PhEp3"}):e===s.Duration?o.fbt._({"*":"{number_of_hours} hours",_1:"1 hour"},[o.fbt._plural(t,"number_of_hours")],{hk:"tAbug"}):e===s.OutOfSyncInfo?o.fbt._({"*":"This message will disappear from this chat {number_of_hours} hours after they're sent, except when kept.",_1:"This message will disappear from this chat 1 hour after they're sent, except when kept."},[o.fbt._plural(t,"number_of_hours")],{hk:"RiRXl"}):e===s.Explanation?o.fbt._({"*":"New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept.",_1:"New messages will disappear from this chat 1 hour after they're sent, except when kept."},[o.fbt._plural(t,"number_of_hours")],{hk:"2198Ib"}):e===s.ModeChangeByOthers?i?o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to set your own default timer.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to set your own default timer."},[o.fbt._plural(t,"number_of_hours"),o.fbt._param("person-name",n)],{hk:"12F4R7"}):o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to learn more.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_hours"),o.fbt._param("person-name",n)],{hk:"2Qc9Rg"}):e===s.ModeChangeByYou?i?o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to change your default timer."},[o.fbt._plural(t,"number_of_hours")],{hk:"1ynB4I"}):o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to learn more.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_hours")],{hk:"2ZknLc"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnHoursString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function f(e,t,n){const i=(0,r.isDefaultDisappearingMessagesEnabled)();return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 day after they're sent, except when kept."},[o.fbt._plural(t,"number_of_days"),o.fbt._param("person-name",n)],{hk:"1VErQ8"}):e===s.SettingChangeByYou?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 day after they're sent, except when kept."},[o.fbt._plural(t,"number_of_days")],{hk:"nAa5n"}):e===s.SettingChangeByUnknown?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 day after they're sent, except when kept."},[o.fbt._plural(t,"number_of_days")],{hk:"1YZVmQ"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_days"),o.fbt._param("person-name",n)],{hk:"1paE5w"}):e===s.SettingChangeByYouAsAdmin?o.fbt._({"*":"You turned on disappearing messages. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to change.",_1:"You turned on disappearing messages. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_days")],{hk:"3VPrO7"}):e===s.SettingChangeByUnknownAsAdmin?o.fbt._({"*":"Disappearing messages were turned on. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to change.",_1:"Disappearing messages were turned on. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_days")],{hk:"16iROF"}):e===s.Duration?o.fbt._({"*":"{number_of_days} days",_1:"1 day"},[o.fbt._plural(t,"number_of_days")],{hk:"1it080"}):e===s.OutOfSyncInfo?o.fbt._({"*":"This message will disappear from this chat {number_of_days} days after they're sent, except when kept.",_1:"This message will disappear from this chat 1 day after they're sent, except when kept."},[o.fbt._plural(t,"number_of_days")],{hk:"JVeRo"}):e===s.Explanation?o.fbt._({"*":"New messages will disappear from this chat {number_of_days} days after they're sent, except when kept.",_1:"New messages will disappear from this chat 1 day after they're sent, except when kept."},[o.fbt._plural(t,"number_of_days")],{hk:"4EIXHa"}):e===s.ModeChangeByOthers?i?o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to set your own default timer.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to set your own default timer."},[o.fbt._plural(t,"number_of_days"),o.fbt._param("person-name",n)],{hk:"vtUA8"}):o.fbt._({"*":"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to learn more.",_1:"{person-name} uses a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_days"),o.fbt._param("person-name",n)],{hk:"dLWS"}):e===s.ModeChangeByYou?i?o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to change your default timer."},[o.fbt._plural(t,"number_of_days")],{hk:"1wHhce"}):o.fbt._({"*":"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to learn more.",_1:"You use a default timer for disappearing messages in new chats. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to learn more."},[o.fbt._plural(t,"number_of_days")],{hk:"3GPqL1"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnDaysString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(t<0)return __LOG__(4,void 0,new Error,!0)`getEphemeralString ${e} is given invalid duration ${t}`,SEND_LOGS("invalid-duration"),"";if(0===t)return h(e,n);if(t<=60)return g(e,t,n);if(t<=3600){return m(e,Math.floor(t/60),n)}if(t<=86400){return y(e,Math.floor(t/60/60),n)}const r=Math.floor(t/24/60/60);return S(e,r,n)}function h(e,t){return e===s.SettingChangeByOthers&&null!=t?o.fbt._("{person-name} turned off disappearing messages.",[o.fbt._param("person-name",t)],{hk:"XO892"}):e===s.SettingChangeByOthersAsAdmin&&null!=t?o.fbt._("{person-name} turned off disappearing messages. Click to change.",[o.fbt._param("person-name",t)],{hk:"su743"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOffL10nComponent is given invalid type ${e}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function g(e,t,n){return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 second after they're sent, except when kept."},[o.fbt._plural(t,"number_of_seconds"),o.fbt._param("person-name",n)],{hk:"4kkOWq"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_seconds} seconds after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 second after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_seconds"),o.fbt._param("person-name",n)],{hk:"31TjrZ"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnSecondsL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function m(e,t,n){return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 minute after they're sent, except when kept."},[o.fbt._plural(t,"number_of_minutes"),o.fbt._param("person-name",n)],{hk:"3B0sxH"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_minutes} minutes after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 minute after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_minutes"),o.fbt._param("person-name",n)],{hk:"1rr4wS"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnMinutesL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function y(e,t,n){return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 hour after they're sent, except when kept."},[o.fbt._plural(t,"number_of_hours"),o.fbt._param("person-name",n)],{hk:"2ZKFqA"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_hours} hours after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 hour after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_hours"),o.fbt._param("person-name",n)],{hk:"1S7Usz"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnHoursL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function S(e,t,n){return e===s.SettingChangeByOthers&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 day after they're sent, except when kept."},[o.fbt._plural(t,"number_of_days"),o.fbt._param("person-name",n)],{hk:"1VErQ8"}):e===s.SettingChangeByOthersAsAdmin&&null!=n?o.fbt._({"*":"{person-name} turned on disappearing messages. New messages will disappear from this chat {number_of_days} days after they're sent, except when kept. Click to change.",_1:"{person-name} turned on disappearing messages. New messages will disappear from this chat 1 day after they're sent, except when kept. Click to change."},[o.fbt._plural(t,"number_of_days"),o.fbt._param("person-name",n)],{hk:"1paE5w"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnDaysL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}t.EphemeralStringType=s},124175:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateEphemeralSystemMessage=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(40234),s=r(n(465212)),l=n(115461),c=n(978820);function u(){return(u=(0,i.default)((function*(e,t){if((0,a.isMDBackend)()){const r=n(707122).handleSingleMsgMD,i={id:new s.default({id:s.default.newId(),remote:e.id,fromMe:!1}),from:e.id,to:(0,c.getMaybeMeUser)(),t:o.Clock.globalUnixTime(),type:l.MSG_TYPE.PROTOCOL,subtype:"ephemeral_setting",ephemeralDuration:t,isNewMsg:!0};yield r(e.id,i,!1,!1)}}))).apply(this,arguments)}},728307:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisappearingModeSettingForChat=function(e){const t=c((0,a.getMaybeMeUser)()),n=c(e);if(!t&&!n)return null;if(t&&n)return n.duration<t.duration?n:t;return null!=n?n:t},t.getDisappearingModeSettingForUser=c,t.getDisappearingModeSettingFromMsg=function(e){var t;if(null==e)return null;const n=c((0,a.getMaybeMeUser)());let r=e.disappearingModeInitiator;if(null!=n&&null==e.disappearingModeInitiator)return n;if(null==n&&e.disappearingModeInitiator===o.DisappearingModeInitiator.InitiatedByMe)r=o.DisappearingModeInitiator.ChangedInChat;else if(null!=e.disappearingModeInitiator&&e.disappearingModeInitiator===o.DisappearingModeInitiator.ChangedInChat)return null;if(null==r)return null;const i=e.ephemeralDuration,s=null!==(t=e.ephemeralSettingTimestamp)&&void 0!==t?t:0;if(null==i||0===i)return null;if(null!=n&&n.settingTimestamp>s)return n;return{duration:i,settingTimestamp:s,initiator:r}};var i=n(88555),a=n(978820),o=n(524606),s=n(719380),l=r(n(268132));function c(e){var t;const n=(0,a.getMaybeMeUser)().toString()===e.toString(),r=s.ContactCollection.get(e);if(!r)return null;let c=r.disappearingModeDuration,u=r.disappearingModeSettingTimestamp;return(0,i.isLegacyWebdBackend)()&&n&&(c=l.default.disappearingMode.duration,u=l.default.disappearingMode.settingTimestamp),null==c||0===c?null:(__LOG__(2)`disappearing mode setting fetched for ${e.toString()}: duration=${c} settingTimestamp=${u}`,{duration:c,settingTimestamp:null!==(t=u)&&void 0!==t?t:0,initiator:n?o.DisappearingModeInitiator.InitiatedByMe:o.DisappearingModeInitiator.InitiatedByOther})}},6901:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEphemeralExpirationTimestamp=function(e,t,n,r,i){if("ephemeral_setting"===r)return null;if(null==e||0===e)return null;if(i&&null!=t)return t+e;return n+e}},714777:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEphemeralDurationAllowed=function(e){return!(e<0)&&(0===e||r.ServerProps.getEphemeralMessagesAllowedValues().includes(e))};var r=n(964551)},529805:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getKicUserContact=function(e){return u.ContactCollection.assertGet(e)},t.getUndoKeepInChatExpiration=function(){return(0,a.isMDBackend)()&&(0,i.getABPropConfigValue)("keep_in_chat_undo_duration_limit")||o.REVOKE_WINDOW_V2},t.isKICFullyEnabled=function(){return(0,a.isMDBackend)()&&(0,i.getABPropConfigValue)("keep_in_chat_receiver")&&(0,i.getABPropConfigValue)("keep_in_chat_sender")},t.isKeepInChatFullyDisabled=function(){return(0,a.isMDBackend)()&&!(0,i.getABPropConfigValue)("keep_in_chat_receiver")&&!(0,i.getABPropConfigValue)("keep_in_chat_sender")},t.isKeepInChatReadEnabled=d,t.isKeepInChatReadOnlyEnabled=function(){return d()&&!(0,i.getABPropConfigValue)("keep_in_chat_sender")},t.isKept=function(e){return e===s.KeepInChatState.KEPT},t.parseKeepTypeToKicState=function(e){if(null!=e&&e===l.KeepType.KEEP_FOR_ALL)return s.KeepInChatState.KEPT;if(null!=e&&e===l.KeepType.UNDO_KEEP_FOR_ALL)return s.KeepInChatState.UNKEPT;return null},t.parseKeepTypeToMetric=function(e){let t;switch(e){case l.KeepType.KEEP_FOR_ALL:t=c.default.KIC_REQUEST_TYPE_TYPE.KEEP;break;case l.KeepType.UNDO_KEEP_FOR_ALL:t=c.default.KIC_REQUEST_TYPE_TYPE.UNKEEP}return t},t.runKeepInChatTieBreaker=function(e){let t;return e.forEach((e=>{t?(e.t>t.t||e.t===t.t&&e.id.id>t.id.id)&&(t=e):t=e})),t};var i=n(257243),a=n(88555),o=n(586031),s=n(837626),l=n(124808),c=r(n(11339)),u=n(719380);function d(){return(0,a.isMDBackend)()&&(0,i.getABPropConfigValue)("keep_in_chat_receiver")}},779259:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.EphemeralL10n=function(e){const{type:t,numSeconds:n=0,name:r}=e;if(n<0)return __LOG__(4,void 0,new Error,!0)`getEphemeralL10nComponent ${t} is given invalid duration ${n}`,SEND_LOGS("invalid-duration"),null;if(0===n)return function(e,t){if(e===c.SettingChangeByOthers&&null!=t)return(0,l.jsx)(o.default,{id:266,params:{name:t}});if(e===c.SettingChangeByYou)return s.fbt._("You turned off disappearing messages.",null,{hk:"CJJkP"});if(e===c.SettingChangeByUnknown)return s.fbt._("Disappearing messages were turned off.",null,{hk:"2o9H09"});if(e===c.SettingChangeByOthersAsAdmin&&null!=t)return(0,l.jsx)(o.default,{id:279,params:{name:t}});if(e===c.SettingChangeByYouAsAdmin)return s.fbt._("You turned off disappearing messages. Click to change.",null,{hk:"ULdpU"});if(e===c.SettingChangeByUnknownAsAdmin)return s.fbt._("Disappearing messages were turned off. Click to change.",null,{hk:"1M6kFu"});if(e===c.Duration)return(0,l.jsx)(o.default,{id:296});if(e===c.OutOfSyncInfo)return s.fbt._("This message will not disappear from the chat. The sender may be on an old version of WhatsApp.",null,{hk:"2d4xYQ"});return __LOG__(4,void 0,new Error,!0)`getEphemeralOffL10nComponent is given invalid type ${e}`,SEND_LOGS("invalid-ephemeral-string-type"),null}(t,r);if(n<=60)return function(e,t,n){const r=a.default.n(t);if(e===c.SettingChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:270,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYou)return(0,l.jsx)(o.default,{id:265,params:{number:r},plural:t});if(e===c.SettingChangeByUnknown)return(0,l.jsx)(o.default,{id:261,params:{number:r},plural:t});if(e===c.SettingChangeByOthersAsAdmin&&null!=n)return(0,l.jsx)(o.default,{id:283,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYouAsAdmin)return(0,l.jsx)(o.default,{id:278,params:{number:r},plural:t});if(e===c.SettingChangeByUnknownAsAdmin)return(0,l.jsx)(o.default,{id:274,params:{number:r},plural:t});if(e===c.Duration)return(0,l.jsx)(o.default,{id:301,params:{number:r},plural:t});if(e===c.OutOfSyncInfo)return(0,l.jsx)(o.default,{id:295,params:{number:r},plural:t});if(e===c.Explanation)return(0,l.jsx)(o.default,{id:289,params:{number:r},plural:t});if(e===c.ModeChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:241,params:{name:n,number:r},plural:t});if(e===c.ModeChangeByYou)return(0,l.jsx)(o.default,{id:245,params:{number:r},plural:t});return __LOG__(4,void 0,new Error,!0)`getEphemeralOnSecondsL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),null}(t,n,r);if(n<=3600){const e=Math.floor(n/60);return function(e,t,n){const r=a.default.n(t);if(e===c.SettingChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:269,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYou)return(0,l.jsx)(o.default,{id:264,params:{number:r},plural:t});if(e===c.SettingChangeByUnknown)return(0,l.jsx)(o.default,{id:260,params:{number:r},plural:t});if(e===c.SettingChangeByOthersAsAdmin&&null!=n)return(0,l.jsx)(o.default,{id:282,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYouAsAdmin)return(0,l.jsx)(o.default,{id:277,params:{number:r},plural:t});if(e===c.SettingChangeByUnknownAsAdmin)return(0,l.jsx)(o.default,{id:273,params:{number:r},plural:t});if(e===c.Duration)return(0,l.jsx)(o.default,{id:300,params:{number:r},plural:t});if(e===c.OutOfSyncInfo)return(0,l.jsx)(o.default,{id:294,params:{number:r},plural:t});if(e===c.Explanation)return(0,l.jsx)(o.default,{id:288,params:{number:r},plural:t});if(e===c.ModeChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:240,params:{name:n,number:r},plural:t});if(e===c.ModeChangeByYou)return(0,l.jsx)(o.default,{id:244,params:{number:r},plural:t});return __LOG__(4,void 0,new Error,!0)`getEphemeralOnMinutesL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),null}(t,e,r)}if(n<=86400){const e=Math.floor(n/60/60);return function(e,t,n){const r=a.default.n(t);if(e===c.SettingChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:268,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYou)return(0,l.jsx)(o.default,{id:263,params:{number:r},plural:t});if(e===c.SettingChangeByUnknown)return(0,l.jsx)(o.default,{id:259,params:{number:r},plural:t});if(e===c.SettingChangeByOthersAsAdmin&&null!=n)return(0,l.jsx)(o.default,{id:281,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYouAsAdmin)return(0,l.jsx)(o.default,{id:276,params:{number:r},plural:t});if(e===c.SettingChangeByUnknownAsAdmin)return(0,l.jsx)(o.default,{id:272,params:{number:r},plural:t});if(e===c.Duration)return(0,l.jsx)(o.default,{id:299,params:{number:r},plural:t});if(e===c.OutOfSyncInfo)return(0,l.jsx)(o.default,{id:293,params:{number:r},plural:t});if(e===c.Explanation)return(0,l.jsx)(o.default,{id:287,params:{number:r},plural:t});if(e===c.ModeChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:239,params:{name:n,number:r},plural:t});if(e===c.ModeChangeByYou)return(0,l.jsx)(o.default,{id:243,params:{number:r},plural:t});return __LOG__(4,void 0,new Error,!0)`getEphemeralOnHoursL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),null}(t,e,r)}const i=Math.floor(n/24/60/60);return function(e,t,n){const r=a.default.n(t);if(e===c.SettingChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:267,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYou)return(0,l.jsx)(o.default,{id:262,params:{number:r},plural:t});if(e===c.SettingChangeByUnknown)return(0,l.jsx)(o.default,{id:258,params:{number:r},plural:t});if(e===c.SettingChangeByOthersAsAdmin&&null!=n)return(0,l.jsx)(o.default,{id:280,params:{name:n,number:r},plural:t});if(e===c.SettingChangeByYouAsAdmin)return(0,l.jsx)(o.default,{id:275,params:{number:r},plural:t});if(e===c.SettingChangeByUnknownAsAdmin)return(0,l.jsx)(o.default,{id:271,params:{number:r},plural:t});if(e===c.Duration)return(0,l.jsx)(o.default,{id:298,params:{number:r},plural:t});if(e===c.OutOfSyncInfo)return(0,l.jsx)(o.default,{id:292,params:{number:r},plural:t});if(e===c.Explanation)return(0,l.jsx)(o.default,{id:286,params:{number:r},plural:t});if(e===c.ModeChangeByOthers&&null!=n)return(0,l.jsx)(o.default,{id:238,params:{name:n,number:r},plural:t});if(e===c.ModeChangeByYou)return(0,l.jsx)(o.default,{id:242,params:{number:r},plural:t});return __LOG__(4,void 0,new Error,!0)`getEphemeralOnDaysL10nComponent is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),null}(t,i,r)},t.EphemeralStringType=void 0,t.getDisappearingMessageDurationString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.Duration,e)},t.getDisappearingMessageExplanationString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.Explanation,e)},t.getDisappearingMessageOutOfSyncInfoString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.OutOfSyncInfo,e)},t.getDisappearingMessageSettingOthersAsAdminString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return u(c.SettingChangeByOthersAsAdmin,e,t)},t.getDisappearingMessageSettingOthersString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return u(c.SettingChangeByOthers,e,t)},t.getDisappearingMessageSettingUnknownAsAdminString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.SettingChangeByUnknownAsAdmin,e)},t.getDisappearingMessageSettingUnknownString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.SettingChangeByUnknown,e)},t.getDisappearingMessageSettingYouAsAdminString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.SettingChangeByYouAsAdmin,e)},t.getDisappearingMessageSettingYouString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.SettingChangeByYou,e)},t.getDisappearingModeOtherString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return u(c.ModeChangeByOthers,e,t)},t.getDisappearingModeYouString=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return u(c.ModeChangeByYou,e)};var i=n(227101),a=r(n(914296)),o=r(n(356074)),s=n(548360),l=n(785893);const c=n(76672).Mirrored(["SettingChangeByOthers","SettingChangeByYou","SettingChangeByUnknown","SettingChangeByOthersAsAdmin","SettingChangeByYouAsAdmin","SettingChangeByUnknownAsAdmin","Duration","OutOfSyncInfo","Explanation","ModeChangeByOthers","ModeChangeByYou"]);function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(t<0)return __LOG__(4,void 0,new Error,!0)`getEphemeralString ${e} is given invalid duration ${t}`,SEND_LOGS("invalid-duration"),"";if(0===t)return d(e,n);if(t<=60)return p(e,t,n);if(t<=3600){return f(e,Math.floor(t/60),n)}if(t<=86400){return _(e,Math.floor(t/60/60),n)}const r=Math.floor(t/24/60/60);return h(e,r,n)}function d(e,t){return e===c.SettingChangeByOthers&&null!=t?a.default.t(266,{name:t}):e===c.SettingChangeByYou?s.fbt._("You turned off disappearing messages.",null,{hk:"CJJkP"}):e===c.SettingChangeByUnknown?s.fbt._("Disappearing messages were turned off.",null,{hk:"2o9H09"}):e===c.SettingChangeByOthersAsAdmin&&null!=t?a.default.t(279,{name:t}):e===c.SettingChangeByYouAsAdmin?s.fbt._("You turned off disappearing messages. Click to change.",null,{hk:"ULdpU"}):e===c.SettingChangeByUnknownAsAdmin?s.fbt._("Disappearing messages were turned off. Click to change.",null,{hk:"1M6kFu"}):e===c.Duration?a.default.t(296):e===c.OutOfSyncInfo?s.fbt._("This message will not disappear from the chat. The sender may be on an old version of WhatsApp.",null,{hk:"2d4xYQ"}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOffString is given invalid type ${e}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function p(e,t,n){const r=(0,i.isDefaultDisappearingMessagesEnabled)(),o=a.default.n(t);return e===c.SettingChangeByOthers&&null!=n?a.default.t(270,{name:n,number:o,_plural:t}):e===c.SettingChangeByYou?a.default.t(265,{number:o,_plural:t}):e===c.SettingChangeByUnknown?a.default.t(261,{number:o,_plural:t}):e===c.SettingChangeByOthersAsAdmin&&null!=n?a.default.t(283,{name:n,number:o,_plural:t}):e===c.SettingChangeByYouAsAdmin?a.default.t(278,{number:o,_plural:t}):e===c.SettingChangeByUnknownAsAdmin?a.default.t(274,{number:o,_plural:t}):e===c.Duration?a.default.t(301,{number:o,_plural:t}):e===c.OutOfSyncInfo?a.default.t(295,{number:o,_plural:t}):e===c.Explanation?a.default.t(289,{number:o,_plural:t}):e===c.ModeChangeByOthers?r?s.fbt._({"*":"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} seconds after they're sent. Click to set your own default timer.",_1:"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 second after they're sent. Click to set your own default timer."},[s.fbt._plural(t,"number"),s.fbt._param("name",n)],{hk:"3SWmFy"}):a.default.t(241,{name:n,number:o,_plural:t}):e===c.ModeChangeByYou?r?s.fbt._({"*":"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} seconds after they're sent. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 second after they're sent. Click to change your default timer."},[s.fbt._plural(t,"number")],{hk:"2Qilmp"}):a.default.t(245,{number:o,_plural:t}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnSecondsString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function f(e,t,n){const r=(0,i.isDefaultDisappearingMessagesEnabled)(),o=a.default.n(t);return e===c.SettingChangeByOthers&&null!=n?a.default.t(269,{name:n,number:o,_plural:t}):e===c.SettingChangeByYou?a.default.t(264,{number:o,_plural:t}):e===c.SettingChangeByUnknown?a.default.t(260,{number:o,_plural:t}):e===c.SettingChangeByOthersAsAdmin&&null!=n?a.default.t(282,{name:n,number:o,_plural:t}):e===c.SettingChangeByYouAsAdmin?a.default.t(277,{number:o,_plural:t}):e===c.SettingChangeByUnknownAsAdmin?a.default.t(273,{number:o,_plural:t}):e===c.Duration?a.default.t(300,{number:o,_plural:t}):e===c.OutOfSyncInfo?a.default.t(294,{number:o,_plural:t}):e===c.Explanation?a.default.t(288,{number:o,_plural:t}):e===c.ModeChangeByOthers?r?s.fbt._({"*":"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} minutes after they're sent. Click to set your own default timer.",_1:"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 minute after they're sent. Click to set your own default timer."},[s.fbt._plural(t,"number"),s.fbt._param("name",n)],{hk:"ibhrL"}):a.default.t(240,{name:n,number:o,_plural:t}):e===c.ModeChangeByYou?r?s.fbt._({"*":"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} minutes after they're sent. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 minute after they're sent. Click to change your default timer."},[s.fbt._plural(t,"number")],{hk:"3R3Wfk"}):a.default.t(244,{number:o,_plural:t}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnMinutesString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function _(e,t,n){const r=(0,i.isDefaultDisappearingMessagesEnabled)(),o=a.default.n(t);return e===c.SettingChangeByOthers&&null!=n?a.default.t(268,{name:n,number:o,_plural:t}):e===c.SettingChangeByYou?a.default.t(263,{number:o,_plural:t}):e===c.SettingChangeByUnknown?a.default.t(259,{number:o,_plural:t}):e===c.SettingChangeByOthersAsAdmin&&null!=n?a.default.t(281,{name:n,number:o,_plural:t}):e===c.SettingChangeByYouAsAdmin?a.default.t(276,{number:o,_plural:t}):e===c.SettingChangeByUnknownAsAdmin?a.default.t(272,{number:o,_plural:t}):e===c.Duration?a.default.t(299,{number:o,_plural:t}):e===c.OutOfSyncInfo?a.default.t(293,{number:o,_plural:t}):e===c.Explanation?a.default.t(287,{number:o,_plural:t}):e===c.ModeChangeByOthers?r?s.fbt._({"*":"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} hours after they're sent. Click to set your own default timer.",_1:"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 hour after they're sent. Click to set your own default timer."},[s.fbt._plural(t,"number"),s.fbt._param("name",n)],{hk:"2V2Gzq"}):a.default.t(239,{name:n,number:o,_plural:t}):e===c.ModeChangeByYou?r?s.fbt._({"*":"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} hours after they're sent. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 hour after they're sent. Click to change your default timer."},[s.fbt._plural(t,"number")],{hk:"425gbB"}):a.default.t(243,{number:o,_plural:t}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnHoursString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}function h(e,t,n){const r=(0,i.isDefaultDisappearingMessagesEnabled)(),o=a.default.n(t);return e===c.SettingChangeByOthers&&null!=n?a.default.t(267,{name:n,number:o,_plural:t}):e===c.SettingChangeByYou?a.default.t(262,{number:o,_plural:t}):e===c.SettingChangeByUnknown?a.default.t(258,{number:o,_plural:t}):e===c.SettingChangeByOthersAsAdmin&&null!=n?a.default.t(280,{name:n,number:o,_plural:t}):e===c.SettingChangeByYouAsAdmin?a.default.t(275,{number:o,_plural:t}):e===c.SettingChangeByUnknownAsAdmin?a.default.t(271,{number:o,_plural:t}):e===c.Duration?a.default.t(298,{number:o,_plural:t}):e===c.OutOfSyncInfo?a.default.t(292,{number:o,_plural:t}):e===c.Explanation?a.default.t(286,{number:o,_plural:t}):e===c.ModeChangeByOthers?r?s.fbt._({"*":"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} days after they're sent. Click to set your own default timer.",_1:"{name} uses a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 day after they're sent. Click to set your own default timer."},[s.fbt._plural(t,"number"),s.fbt._param("name",n)],{hk:"Vmtxb"}):a.default.t(238,{name:n,number:o,_plural:t}):e===c.ModeChangeByYou?r?s.fbt._({"*":"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat {number} days after they're sent. Click to change your default timer.",_1:"You use a default timer for disappearing messages in new chats. All new messages will disappear from this chat 1 day after they're sent. Click to change your default timer."},[s.fbt._plural(t,"number")],{hk:"3TGIk6"}):a.default.t(242,{number:o,_plural:t}):(__LOG__(4,void 0,new Error,!0)`getEphemeralOnDaysString is given type ${e} and name ${n}`,SEND_LOGS("invalid-ephemeral-string-type"),"")}t.EphemeralStringType=c},776290:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUpdateEphemeralSetting=function(e){const{oldDuration:t,oldSettingTimestamp:n,newDuration:i,newSettingTimestamp:a,chatId:o}=e;if(a>n)return!0;if(a<n)return!1;if(t===i)return!1;if((0,r.getMaybeMeUser)().isLessThan(o))return!1;return!0};var r=n(978820)},362488:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableNuxSync=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("nux_sync")};var r=n(257243),i=n(88555)},939519:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.currencyForCountryShortcode=function(e){const t=a.REGION_TO_CURRENCY[e.toUpperCase()];return(null==t?void 0:t.length)>0?t[0]:a.DEFAULT_CURRENCY},t.formatAmount1000=t.formatAmount=void 0,t.formatAmount1000ToParts=function(e,t){const n=c(),r=p(n),i=f(n,e),a=d(e,t).replace(i,"").trim(),o=a.indexOf(r),s=-1===o?a:a.substring(0,o),l=-1===o?"":a.substring(o);return{symbol:i,integer:s,decimal:l}},t.formatLocalSymbol=function(e){return f(s[e],e)},t.isSupportedCurrency=function(e){return l.has(e)},t.parseValueFromString=h,t.validatePriceString=function(e,t,n,r){const i=c(),o=void 0!==a.CURRENCY_DIGITS[e]?a.CURRENCY_DIGITS[e]:a.DEFAULT_DIGITS,s=_(e,t);if(null!=n&&s<n)return!1;if(null!=r&&s>r)return!1;const l=t.replace(/\D+$/g,""),u=p(i);if(Number.isNaN(s)||l!==t||(t.split(u)[1]||"").length>o)return!1;return!0},t.valueFromString=_;var i=r(n(81109)),a=n(676595),o=r(n(914296));const s={IDR:"in-ID",MXN:"es-MX",INR:"en-IN"},l=new Set(["DZD","ARS","AUD","BDT","BOB","BRL","GBP","CAD","CLP","CNY","COP","CRC","CZK","DKK","EGP","EUR","GTQ","HNL","HKD","HUF","ISK","INR","IDR","ILS","JPY","KES","KRW","MOP","MYR","MXN","NZD","NIO","NGN","NOK","PKR","PYG","PEN","PHP","PLN","QAR","RON","RUB","SAR","SGD","ZAR","SEK","CHF","TWD","THB","TRY","AED","USD","UYU","VEF","VND"]),c=()=>[o.default.getFullLocale(),o.default.getLocale()].filter(Boolean),u=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:c();return new Intl.NumberFormat(r,(0,i.default)({style:"currency",currency:e},n)).format(t)};t.formatAmount=u;const d=(e,t,n,r)=>u(e,t/1e3,n,r);function p(e){return new Intl.NumberFormat(e).format(1.1).substring(1,2)}function f(e,t){return d(t,0,{},e).replace(/\d+([,.]\d+)?/g,"").trim()}function _(e,t){const n=c(),r=f(n,e),i=function(e){return new Intl.NumberFormat(e).format(1e4).substring(2,3)}(n);return h(t,r,p(n),i)}function h(e,t,n,r){const i=e.replace(t,"").trim().split(r).join(""),a=parseFloat(i.replace(n,".")||"0");return Math.round(1e3*a)}t.formatAmount1000=d},676595:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REGION_TO_CURRENCY=t.MAX_FRACTION_DIGITS=t.DEFAULT_DIGITS=t.DEFAULT_CURRENCY=t.CURRENCY_DIGITS=void 0;t.DEFAULT_CURRENCY="USD";t.MAX_FRACTION_DIGITS=4;t.DEFAULT_DIGITS=2;t.CURRENCY_DIGITS={ADP:0,AFN:0,ALL:0,BHD:3,BIF:0,BYR:0,CLF:4,CLP:0,DJF:0,ESP:0,GNF:0,IQD:0,IRR:0,ISK:0,ITL:0,JOD:3,JPY:0,KMF:0,KPW:0,KRW:0,KWD:3,LAK:0,LBP:0,LUF:0,LYD:3,MGA:0,MGF:0,MMK:0,MRO:0,OMR:3,PYG:0,RSD:0,RWF:0,SLL:0,SOS:0,STD:0,SYP:0,TMM:0,TND:3,TRL:0,UGX:0,UYI:0,UYW:4,VND:0,VUV:0,XAF:0,XOF:0,XPF:0,YER:0,ZMK:0,ZWD:0};t.REGION_TO_CURRENCY={AC:["SHP"],AD:["EUR"],AE:["AED"],AF:["AFN"],AG:["XCD"],AI:["XCD"],AL:["ALL"],AM:["AMD"],AO:["AOA"],AR:["ARS"],AS:["USD"],AT:["EUR"],AU:["AUD"],AW:["AWG"],AX:["EUR"],AZ:["AZN"],BA:["BAM"],BB:["BBD"],BD:["BDT"],BE:["EUR"],BF:["XOF"],BG:["BGN"],BH:["BHD"],BI:["BIF"],BJ:["XOF"],BL:["EUR"],BM:["BMD"],BN:["BND"],BO:["BOB"],BQ:["USD"],BR:["BRL"],BS:["BSD"],BT:["BTN","INR"],BV:["NOK"],BW:["BWP"],BY:["BYN"],BZ:["BZD"],CA:["CAD"],CC:["AUD"],CD:["CDF"],CF:["XAF"],CG:["XAF"],CH:["CHF"],CI:["XOF"],CK:["NZD"],CL:["CLP"],CM:["XAF"],CN:["CNY"],CO:["COP"],CR:["CRC"],CU:["CUP","CUC"],CV:["CVE"],CW:["ANG"],CX:["AUD"],CY:["EUR"],CZ:["CZK"],DE:["EUR"],DG:["USD"],DJ:["DJF"],DK:["DKK"],DM:["XCD"],DO:["DOP"],DZ:["DZD"],EA:["EUR"],EC:["USD"],EE:["EUR"],EG:["EGP"],EH:["MAD"],ER:["ERN"],ES:["EUR"],ET:["ETB"],EU:["EUR"],FI:["EUR"],FJ:["FJD"],FK:["FKP"],FM:["USD"],FO:["DKK"],FR:["EUR"],GA:["XAF"],GB:["GBP"],GD:["XCD"],GE:["GEL"],GF:["EUR"],GG:["GBP"],GH:["GHS"],GI:["GIP"],GL:["DKK"],GM:["GMD"],GN:["GNF"],GP:["EUR"],GQ:["XAF"],GR:["EUR"],GS:["GBP"],GT:["GTQ"],GU:["USD"],GW:["XOF"],GY:["GYD"],HK:["HKD"],HM:["AUD"],HN:["HNL"],HR:["HRK"],HT:["HTG","USD"],HU:["HUF"],IC:["EUR"],ID:["IDR"],IE:["EUR"],IL:["ILS"],IM:["GBP"],IN:["INR"],IO:["USD"],IQ:["IQD"],IR:["IRR"],IS:["ISK"],IT:["EUR"],JE:["GBP"],JM:["JMD"],JO:["JOD"],JP:["JPY"],KE:["KES"],KG:["KGS"],KH:["KHR"],KI:["AUD"],KM:["KMF"],KN:["XCD"],KP:["KPW"],KR:["KRW"],KW:["KWD"],KY:["KYD"],KZ:["KZT"],LA:["LAK"],LB:["LBP"],LC:["XCD"],LI:["CHF"],LK:["LKR"],LR:["LRD"],LS:["ZAR","LSL"],LT:["EUR"],LU:["EUR"],LV:["EUR"],LY:["LYD"],MA:["MAD"],MC:["EUR"],MD:["MDL"],ME:["EUR"],MF:["EUR"],MG:["MGA"],MH:["USD"],MK:["MKD"],ML:["XOF"],MM:["MMK"],MN:["MNT"],MO:["MOP"],MP:["USD"],MQ:["EUR"],MR:["MRU"],MS:["XCD"],MT:["EUR"],MU:["MUR"],MV:["MVR"],MW:["MWK"],MX:["MXN"],MY:["MYR"],MZ:["MZN"],NA:["NAD","ZAR"],NC:["XPF"],NE:["XOF"],NF:["AUD"],NG:["NGN"],NI:["NIO"],NL:["EUR"],NO:["NOK"],NP:["NPR"],NR:["AUD"],NU:["NZD"],NZ:["NZD"],OM:["OMR"],PA:["PAB","USD"],PE:["PEN"],PF:["XPF"],PG:["PGK"],PH:["PHP"],PK:["PKR"],PL:["PLN"],PM:["EUR"],PN:["NZD"],PR:["USD"],PS:["ILS","JOD"],PT:["EUR"],PW:["USD"],PY:["PYG"],QA:["QAR"],RE:["EUR"],RO:["RON"],RS:["RSD"],RU:["RUB"],RW:["RWF"],SA:["SAR"],SB:["SBD"],SC:["SCR"],SD:["SDG"],SE:["SEK"],SG:["SGD"],SH:["SHP"],SI:["EUR"],SJ:["NOK"],SK:["EUR"],SL:["SLL"],SM:["EUR"],SN:["XOF"],SO:["SOS"],SR:["SRD"],SS:["SSP"],ST:["STN"],SV:["USD"],SX:["ANG"],SY:["SYP"],SZ:["SZL"],TA:["GBP"],TC:["USD"],TD:["XAF"],TF:["EUR"],TG:["XOF"],TH:["THB"],TJ:["TJS"],TK:["NZD"],TL:["USD"],TM:["TMT"],TN:["TND"],TO:["TOP"],TR:["TRY"],TT:["TTD"],TV:["AUD"],TW:["TWD"],TZ:["TZS"],UA:["UAH"],UG:["UGX"],UM:["USD"],US:["USD"],UY:["UYU"],UZ:["UZS"],VA:["EUR"],VC:["XCD"],VE:["VES"],VG:["USD"],VI:["USD"],VN:["VND"],VU:["VUV"],WF:["XPF"],WS:["WST"],XK:["EUR"],YE:["YER"],YT:["EUR"],ZA:["ZAR"],ZM:["ZMW"],ZW:["USD"]}},2259:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lidHistorySyncEnabled=function(){return!1},t.lidUsyncEnabled=function(){return(0,r.getABPropConfigValue)("usync_lid")},t.testLidWaMeLinkEnabled=function(){return!1};var r=n(257243)},867811:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.REVOKED_REACTION_TEXT=t.MAX_REACTIONS_DISPLAY_AGGREGATES=void 0,t.canHaveReactions=b,t.canReactToMessage=function(e){var t;if(!(0,s.sendReactionsEnabled)())return!1;if(!b(e.type))return!1;if(null===(t=e.chat.groupMetadata)||void 0===t?void 0:t.announce)return!(e.chat.groupMetadata.groupType===h.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&!(0,s.reactionsCommunityAnnouncementOnly)())&&e.replyChecks();return e.canReply()},t.canRevokeReaction=function(){return(0,s.sendReactionsEnabled)()},t.createReactionsRow=function(){return M.apply(this,arguments)},t.createReactionsRowFromMsg=function(){return P.apply(this,arguments)},t.getReactionAggregates=C,t.getReactionEmojisAndSum=function(e){let t=[],n=0;if(0===e.length)return{numberOfSenderReactions:n,reactionArrayEmojis:t};if(1!==e.length)return function(e){let t=[],n=0;const r=C(e),i=r.slice(0,3);return t=i.map((e=>e)),n=r.reduce(((e,t)=>e+t.reactionSenders.length),0),{numberOfSenderReactions:n,reactionArrayEmojis:t}}(e);{const r=e[0],i=r.reactions.slice(0,3);t=i.map((e=>{e.hasReactionByMe&&r.reactionByMe;return{reactionByMe:e.hasReactionByMe?r.reactionByMe:null,reactionAggregate:e.aggregateEmoji,reactionSenders:e.senders.toArray()}})),n=r.reactions.reduce(((e,t)=>e+t.senders.length),0)}return{numberOfSenderReactions:n,reactionArrayEmojis:t}},t.getReactionForDisplay=function(e){var t;e.reactionSenders.length;const n=null===(t=e.reactionSenders[0])||void 0===t?void 0:t.reactionText;return _.EmojiUtil.getNormalizedOrTofu(n)},t.getReactionsForTray=function(e,t){const n=[],r=e.map((e=>_.EmojiUtil.getEmojiAggregate(e))),i=null!=t?_.EmojiUtil.getEmojiAggregate(t.reactionText):null;r.forEach((e=>{const r=g.RecentReactionsCollection.get(e);null!=t&&e===i?n.push(t.reactionText):null!=r?n.push(r.reactionText):n.push(e)})),null==t||r.includes(i)||n.push(t.reactionText);return n},t.isFilteredReaction=function(e){return I.includes(e)},t.isReactionByMe=A,t.lastMessageReactionChange=function(e){const t=n(559871).MsgCollection;e.forEach((e=>{const n=t.get(e);(null==n?void 0:n.isLastMessage())&&o.Cmd.reactionChangeLastMessage()}))},t.reactionBubbleAriaLabelOneReaction=function(e,t){return v.fbt._("{name} reacted with {reactionContent}",[v.fbt._param("name",e),v.fbt._param("reactionContent",t)],{hk:"2Vcjyz"})},t.reactionBubbleAriaLabelString=function(e,t){const n=t.map((e=>e.reactionByMe?e.reactionByMe.reactionText:e.reactionAggregate)).join(p.default.t(257));if(1===e)return v.fbt._("reaction {reactions_content}",[v.fbt._param("reactions_content",n)],{hk:"2ksvWq"});return v.fbt._({"*":"Reactions {reactions_content} {num_sender_reactions} in total",_1:"Reactions {reactions_content} 1 in total"},[v.fbt._plural(e,"num_sender_reactions"),v.fbt._param("reactions_content",n)],{hk:"3KYY1f"})},t.reactionSenderToReactionUpdate=function(e){const{id:t,parentMsgKey:n,reactionText:r,senderUserJid:i}=e;return{parentMsgKey:l.default.fromString(n),msgKey:t,reactionText:r,senderUserJid:i}},t.shouldShowReactionBubble=function(e,t){if(!(0,s.receiveReactionsEnabled)())return!1;if(!b(e.type))return!1;if(t===f.ReactionBubbleType.NON_CONVERSATION)return!1;if(t===f.ReactionBubbleType.MEDIA_ITEM&&e.type===c.MSG_TYPE.STICKER)return!1;return!0},t.updateHasReactionFromParent=function(){return O.apply(this,arguments)},t.updateRecentReaction=function(e,t){const n=_.EmojiUtil.getEmojiAggregate(e);g.RecentReactionsCollection.add({id:n,reactionText:e,timestamp:t},{merge:!0})},t.webMsgInfoReactionTypeToReactionsRow=function(e){let{id:t,reactionTimestamp:n,reactionText:r,reactionParentKey:i,sender:a,unread:o}=e;const s=(0,d.toUserWid)(a);return{msgKey:t.toString(),parentMsgKey:i.toString(),senderUserJid:s.toString(),reactionText:null!=r?r:T,timestamp:n,orphan:0,read:!o}};var i=r(n(348926)),a=r(n(81109)),o=n(781572),s=n(408139),l=r(n(465212)),c=n(115461),u=n(978820),d=n(745454),p=r(n(914296)),f=n(694270),_=n(767247),h=n(455981),g=n(505104),m=n(776214),y=n(584886),S=n(957881),E=n(926704),v=n(548360);const T="";t.REVOKED_REACTION_TEXT=T;function C(e){const t=new Map;e.forEach((e=>{let n=null;if(e.reactionByMe){const a=e.reactionByMe.reactionText;n=_.EmojiUtil.getEmojiAggregate(a);const o=t.get(n);if(o){var r,i;const t=(null===(r=o.reactionByMe)||void 0===r?void 0:r.timestamp)||0,n=(null===(i=e.reactionByMe)||void 0===i?void 0:i.timestamp)||0;(o.reactionByMe&&t<n||!o.reactionByMe)&&(o.reactionByMe=e.reactionByMe)}}e.reactions.forEach((n=>{const r=n.aggregateEmoji,i=n.senders.toArray(),a=t.get(r);if(a){const e=a.reactionSenders.concat(i);a.reactionSenders=e,t.set(r,a)}else{const a=n.hasReactionByMe?e.reactionByMe:null;t.set(r,{reactionByMe:a,reactionSenders:i,reactionAggregate:r})}}))}));return Array.from(t.values()).map((e=>{const t=e.reactionSenders.sort(((e,t)=>A(e.senderUserJid)&&!A(t.senderUserJid)?-1:A(t.senderUserJid)&&!A(e.senderUserJid)?1:t.timestamp-e.timestamp));return(0,a.default)((0,a.default)({},e),{},{reactionSenders:t})})).sort(((e,t)=>e.reactionByMe&&t.reactionByMe?t.reactionSenders.length===e.reactionSenders.length?t.reactionByMe.timestamp-e.reactionByMe.timestamp:t.reactionSenders.length-e.reactionSenders.length:e.reactionByMe?-1:t.reactionByMe?1:t.reactionSenders.length===e.reactionSenders.length?t.reactionSenders[0].timestamp-e.reactionSenders[0].timestamp:t.reactionSenders.length-e.reactionSenders.length))}function A(e){return e===(0,u.getMaybeMeUser)().toString()}function b(e){return!(!(0,s.receiveReactionsEnabled)()||e===c.MSG_TYPE.UNKNOWN||e===c.MSG_TYPE.CIPHERTEXT||e===c.MSG_TYPE.REVOKED||e===c.MSG_TYPE.DEBUG||e===c.MSG_TYPE.GP2||e===c.MSG_TYPE.NOTIFICATION||e===c.MSG_TYPE.NOTIFICATION_TEMPLATE||e===c.MSG_TYPE.E2E_NOTIFICATION||e===c.MSG_TYPE.CALL_LOG)}function P(){return(P=(0,i.default)((function*(e){const t=[],n=[];e.forEach((e=>{e&&n.push(e.reactionParentKey.toString())}));const r=yield(0,y.getMsgsByMsgKey)(n),i=new Map;return r.forEach((e=>{i.set(e.id.toString(),e)})),e.forEach((e=>{var n,r;const a=null!==(n=e.author)&&void 0!==n?n:e.from;if(!a||!e)return void __LOG__(3)`createReactionsRowFromMsg: sender or reactionMsg are null`;const o=i.get(e.reactionParentKey.toString());let s,l=0;if(o||(l=1,s=E.OrphanReactionsReasonType.ParentMsgMissing),(null==o?void 0:o.type)===c.MSG_TYPE.CIPHERTEXT&&(l=1,s=E.OrphanReactionsReasonType.ParentMsgPlaceholder),o&&o.type!==c.MSG_TYPE.CIPHERTEXT&&!b(o.type))return void __LOG__(3)`createReactionsRowFromMsg: reactions not allowed for this message type ${o.type}`;const u=(0,d.toUserWid)(a),p={msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:u.toString(),reactionText:null!==(r=e.reactionText)&&void 0!==r?r:T,timestamp:e.reactionTimestamp,orphan:l,orphanReason:s,read:!1};t.push(p)})),t}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const t=[],n=[];e.forEach((e=>{const r=e.parentMsgKey;e.reactionText!==T?n.push({id:r,hasReaction:!0}):t.push(e.parentMsgKey)}));const r=yield(0,S.getFilteredReactionsFromParentMsgs)(t);return t.forEach((e=>{const t=r.get(e),i=t&&t.length>0||!1;n.push({id:e,hasReaction:i})})),(0,m.getMessageTable)().bulkCreateOrMerge(n)}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){var n;const r=yield(0,y.getMsgByMsgKey)(e.reactionParentKey);let i,a=0;r||(a=1,i=E.OrphanReactionsReasonType.ParentMsgMissing),(null==r?void 0:r.type)===c.MSG_TYPE.CIPHERTEXT&&(a=1,i=E.OrphanReactionsReasonType.ParentMsgPlaceholder);const o=t.author;if(r&&r.type!==c.MSG_TYPE.CIPHERTEXT&&!b(r.type))return __LOG__(3)`createReactionsRow: reactions not allowed for this message type ${r.type}`,Promise.resolve();const s=(0,d.toUserWid)(o);return{msgKey:e.id.toString(),parentMsgKey:e.reactionParentKey.toString(),senderUserJid:s.toString(),reactionText:null!==(n=e.reactionText)&&void 0!==n?n:T,timestamp:e.reactionTimestamp,orphan:a,orphanReason:i,read:!1}}))).apply(this,arguments)}t.MAX_REACTIONS_DISPLAY_AGGREGATES=3;const I=["🏴󠁵󠁳󠁴󠁸󠁿","🇽🇹","🏳️‍⚧️","🏳‍🟧‍⬛‍🟧"]},564603:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TcTokenMode=void 0,t.getTcTokenDuration=s,t.isTokenExpired=function(e,t){return e<l(t)},t.shouldSendNewToken=function(e){if(null==e)return!0;const t=(0,i.getABPropConfigValue)("tctoken_duration_sender"),n=Math.floor(a.Clock.globalUnixTime()/t),r=Math.floor(e/t);return n>r},t.tokenExpirationCutoff=l;var r=n(892844),i=n(257243),a=n(40234);const o=n(76672)({Sender:"sender",Receiver:"receiver"});function s(e){const t=e===o.Receiver?"tctoken_duration":"tctoken_duration_sender";return Math.min((0,i.getABPropConfigValue)(t),15552e3)}function l(e){const t=e===o.Receiver?"tctoken_num_buckets":"tctoken_num_buckets_sender",n=(0,i.getABPropConfigValue)(t),l=s(e),c=Math.floor(a.Clock.globalUnixTime()/l);return(0,r.castToUnixTime)((c-(n-1))*l)}t.TcTokenMode=o},169048:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(81109)),o=r(n(145095)),s=n(406663),l=r(n(979038)),c=r(n(151998));var u=new class{constructor(){this._pendingMap=new Map}_ensureWorkerInited(){this._worker||(l.default.onerror=e=>{this._handleWorkerError(e)},l.default.onmessageerror=e=>{this._handleMessageError(e)},l.default.onmessage=e=>{const t=e.data;this._handleWorkerResponse(t)},this._worker=l.default)}_handleMessageError(){}_handleWorkerError(e){__LOG__(3)`FTS:client: worker error: ${e}`}_handleWorkerResponse(e){const{reqId:t}=e,n=this._pendingMap.get(t);n&&(e.error?(__LOG__(3)`FTS:client: worker completed job ${n.command.operation} with error`,n.reject(new Error("FTS worker error"))):n.resolve(e.result),this._untrackInvocation(t))}startIndexer(){return this._runCommand({operation:"start-indexer"})}indexFull(){return this._runCommand({operation:"run"})}index(){return this._runCommand({operation:"consume"})}purge(e){return this._runCommand({operation:"purge",ids:e})}purgeRange(e){return this._runCommand((0,a.default)({operation:"purge-range"},e))}reInit(){return this._runCommand({operation:"re-init"})}clearInitializationPromises(){return this._runCommand({operation:"clear-init"})}search(e,t){var n=this;return(0,i.default)((function*(){const r=yield n._runCommand({operation:"find",query:e,queryOptions:t});return n._coerceToSearchResult(r)}))()}_coerceToSearchResult(e){var t=this;return(0,i.default)((function*(){if(Array.isArray(e)||"boolean"==typeof e)return{canceled:!1,eof:!0,status:404,messages:[]};const{resolved:n,unresolved:r}=yield(0,s.resolveMsgIds)(e.messages),{eof:i,status:a}=e;return r.length>0&&t.purge(r),{canceled:!1,eof:i,status:a,messages:n}}))()}_runCommand(e){this._ensureWorkerInited();const t=(0,c.default)();return new Promise(((n,r)=>{this._pendingMap.set(t,{resolve:n,reject:r,command:e}),this._message({command:e,reqId:t})})).finally((()=>{this._untrackInvocation(t)}))}_untrackInvocation(e){this._pendingMap.delete(e)}_message(e){(0,o.default)(this._worker,"this._worker").postMessage(e)}};t.default=u},406663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveMsgIds=function(e){if((0,r.isMDBackend)()){const t=e.map((e=>+e.id)),n=new Map(e.map((e=>[+e.id,e])));return(0,a.getTable)().anyOf(["rowId"],t).then((e=>{const t=[];e.forEach((e=>{const r=(0,i.messageFromDbRow)(e),a=n.get(r.rowId);null!=a&&a.id===String(r.rowId)&&a.timestamp===r.t&&a.chatId===r.id.remote.toString()&&(t.push(r),n.delete(r.rowId))}));const r=Array.from(n.keys(),(e=>String(e)));return t.sort(((e,t)=>t.t-e.t)),{resolved:t,unresolved:r}}))}return Promise.resolve({resolved:[],unresolved:[]})};var r=n(88555),i=n(536051),a=n(290981)},580872:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FTS_TYPING_DELAY=t.FTS_TTL=t.FTS_NUM_RESULTS=t.FTS_MIN_CHARS=void 0;t.FTS_MIN_CHARS=2;t.FTS_TTL=6e4;t.FTS_TYPING_DELAY=300;t.FTS_NUM_RESULTS=30},151998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return n++};let n=0},88555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLegacyWebdBackend=function(){return!n},t.isMDBackend=function(){return n},t.switchToLegacyWebdBackend=function(){n=!1},t.switchToMDBackend=function(){n=!0};let n=!1},310206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debugDisableFeatureFlag=function(e){n[e]=!1},t.debugEnableFeatureFlag=function(e){n[e]=!0},t.isFeatureEnabled=function(e){return n[e]},t.overwriteDebugFeatures=function(){};const n={a11y_block:!1,download_status_thumb_mms:!1,format_bulleted_msg:!1,media_auto_download:!1,media_existence_check:!1,web_voip_voice_call:!1,web_voip_video_call:!1,youtube_video_preview_without_blur:!1,message_add_ons:!1,reactions_filter_problematic_flags:!0}},438184:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyPhoneFeatures=t.FEATURE_CHANGE_EVENT=void 0,t.getProtobufFeatureName=v;var i=r(n(23279)),a=r(n(618446)),o=r(n(114176)),s=r(n(766678)),l=r(n(944908)),c=r(n(385564)),u=r(n(211865)),d=r(n(682492)),p=r(n(617204)),f=n(234497),_=r(n(876521)),h=(r(n(177853)),n(421224));const g=(0,f.getProtoInternalSpec)(h.WebFeaturesSpec),m=(0,p.default)(Object.keys(g).map((e=>[v(e),!1]))),y={RESEND_ICON:!1,DEBUG_COMMANDS:!1,SKIP_COMPLIANCE_PHONE_CHECK:!1},S=[[(0,d.default)(y,m),{},{},{},{ARCHIVE_BROADCAST:!0},{RECENT_EMOJI_SYNC:!0},{},{},{},{},{},{INDEX_RECEIVED_VCARD:!1},{STATUS_V3_UI_SENDING:!1},{MEDIAS_COUNT:!1},{},{VOIP_VOICE_CALL:!0},{DESKTOP_VOIP_VOICE_CALL:!0,DESKTOP_VOIP_VIDEO_CALL:!0,DESKTOP_VOIP_GROUP_VOICE_CALL:!1,DESKTOP_VOIP_GROUP_VIDEO_CALL:!1}]],E={KEY_PARTICIPANT:!1,RICH_TEXT:!0};function v(e){return(0,u.default)(e).toUpperCase()}const T="feature_change";t.FEATURE_CHANGE_EVENT=T;class C extends _.default{constructor(){super(),this.FEATURE_CHANGE_EVENT=T,this.silenceChangeEvents=!0,this.triggerFeaturesChangedDebounced=(0,i.default)((()=>{this.trigger(T)}),50),this.features={};const e=(0,c.default)((0,c.default)(S).map(Object.keys)).concat(Object.keys(E));this.F=(0,p.default)((0,l.default)(e).map((e=>[e,e]))),this.setVersion([0,0]),this.silenceChangeEvents=!1}setVersion(e){if(this.proto&&this.proto.length===e.length&&this.proto[0]===e[0]&&this.proto[1]===e[1])return;this.proto=e;const t=S.slice(0,e[0]+1),n=S.slice(e[0]+1,S.length),r=t[e[0]],i=r.slice(0,e[1]+1),l=r.slice(e[1]+1,r.length);t[e[0]]=i,n.unshift(l);const u=(0,s.default)(this.features);this.features=(0,d.default)((0,o.default)((0,d.default)({},...(0,c.default)(t)),(e=>!e)),this.features||{});const f=(0,d.default)({},...(0,c.default)(n));this.features=(0,o.default)(this.features,((e,t)=>!!f[t])),this.VF=(0,p.default)(Object.keys((0,d.default)({},...(0,c.default)(t))).map((e=>[e,e]))),(0,a.default)(u,this.features)||this.triggerFeaturesChanged()}setPlatform(e){let t=!1;switch(e){case"iphone":t=!1!==this.features.RECENT_EMOJI_SYNC||!1!==this.features.ARCHIVE_BROADCAST||!0!==this.features.RESEND_ICON,this.features.RECENT_EMOJI_SYNC=!1,this.features.ARCHIVE_BROADCAST=!1,this.features.RESEND_ICON=!0}t&&this.triggerFeaturesChanged()}setFeatureFromFlags(e,t,n){let r=!1;switch(n){case h.WebFeatures$Flag.FORCE_UPGRADE:switch(t){case h.WebFeatures$Flag.FORCE_UPGRADE:r=!0;break;case h.WebFeatures$Flag.PRODUCTION:case h.WebFeatures$Flag.DEVELOPMENT:case h.WebFeatures$Flag.NOT_STARTED:r=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${n} and web value is ${t}.`,SEND_LOGS("wap_feature_unreachable_code")}break;case h.WebFeatures$Flag.PRODUCTION:switch(t){case h.WebFeatures$Flag.FORCE_UPGRADE:r=!1,__LOG__(4,void 0,new Error,!0)`wap:features:${e} phone value is ${n} and web value is ${t}.`,SEND_LOGS("wap_feature_unexpected");break;case h.WebFeatures$Flag.PRODUCTION:r=!0;break;case h.WebFeatures$Flag.DEVELOPMENT:case h.WebFeatures$Flag.NOT_STARTED:r=!1}break;case h.WebFeatures$Flag.DEVELOPMENT:switch(t){case h.WebFeatures$Flag.FORCE_UPGRADE:case h.WebFeatures$Flag.PRODUCTION:case h.WebFeatures$Flag.DEVELOPMENT:case h.WebFeatures$Flag.NOT_STARTED:r=!1}break;case h.WebFeatures$Flag.NOT_STARTED:r=!1}const i=v(e);return this.setFeature(i,r)}setFeature(e,t){let n;n=!!t;const r=this.features[e]!==n;return this.features[e]=n,r&&this.triggerFeaturesChanged(),r}setFeatures(e){const t={},n=(0,d.default)({},E,e);for(const e in n)e in this.VF||(t[e]=this.setFeature(e,n[e]));return t}supportsFeature(e){return!!this.features[e]}supportsFeatureFromFlags(e){const t=v(e);return this.supportsFeature(t)}supportsAllFeatures(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every((e=>!!this.features[e]))}supportsAnyFeature(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.some((e=>!!this.features[e]))}resetFeatures(){this.proto=[0,0],this.features={},this.triggerFeaturesChanged()}triggerFeaturesChanged(){this.silenceChangeEvents||this.triggerFeaturesChangedDebounced()}overwriteDebugGKs(){}}const A=new C;t.LegacyPhoneFeatures=A},408139:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QUICK_PAY_PRODUCT_TYPE_GATING=void 0,t.accidentalDeleteMessageEnabled=function(){return(0,r.getABPropConfigValue)("web_accidental_delete_for_me")||!1},t.adminRevokeHistorySyncConsumerEnabled=function(){return(0,r.getABPropConfigValue)("admin_revoke_history_sync_consumer")},t.adminRevokeReceiverEnabled=function(){return(0,r.getABPropConfigValue)("admin_revoke_receiver")},t.adminRevokeSenderEnabled=function(){return(0,r.getABPropConfigValue)("admin_revoke_sender")},t.archiveV2Supported=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("sync_archive_v2_setting");return s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.ARCHIVE_V_2)},t.bannedShopsEnabled=function(){return(0,r.getABPropConfigValue)("banned_shops_ux_enabled")},t.bizLinkedAccountsEnabled=function(){return(0,r.getABPropConfigValue)("web_abprop_business_profile_refresh_linked_accounts_killswitch")},t.blockCatalogCreationECommerceComplianceIndia=function(e){var t;return h(null==e?void 0:e.id.user,(()=>(0,r.getABPropConfigValue)("web_abprop_block_catalog_creation_ecommerce_compliance_india")),(()=>f.ServerProps.blockCatalogCreationEcommerceComplianceIndia))&&(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===u.COMMERCE_EXPERIENCE_TYPES.NONE},t.btmThreadsLoggingEnabled=function(){return(0,r.getABPropConfigValue)("btm_threads_logging_enabled")},t.buttonsMessagesEnabled=function(){return f.ServerProps.webButtonsMessage},t.canAppealCollections=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("smb_collections_appeal_flow_enabled");return f.ServerProps.webCollectionsAppealEnabled},t.canDisplayLabel=function(){if((0,i.isMDBackend)())return d.Conn.isSMB;return s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.LABELS_DISPLAY)},t.canEditLabel=function(){if((0,i.isMDBackend)())return!1;return s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.LABELS_EDIT)},t.canEditLabelAssociation=function(){if((0,i.isMDBackend)())return d.Conn.isSMB;return s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.LABELS_EDIT)},t.canManageCollections=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("smb_collections_enabled");return f.ServerProps.webCollectionsManagement},t.canSeeBizProfileV3=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("business_profile_refresh_m1_enabled");return f.ServerProps.webBizProfileV3Enabled},t.canSeeECommerceComplianceIndiaCountryOriginExemptBusinessJourney=function(e){return h(e,(()=>(0,r.getABPropConfigValue)("smb_ecommerce_compliance_india_m4_5")),(()=>f.ServerProps.smbEcommerceComplianceIndiaM4_5))},t.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney=function(e){return h(e,(()=>(0,r.getABPropConfigValue)("smb_ecommerce_compliance_india_m4")),(()=>f.ServerProps.smbEcommerceComplianceIndiaM4))},t.canSeeECommerceComplianceIndiaSoftEnforcement=function(e){return _(e)},t.canSeeSMBUpsell=function(){return f.ServerProps.webSMBUpsellInBizProfile},t.canSendQuickReply=function(){if((0,i.isMDBackend)())return d.Conn.isSMB;return s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.QUICK_REPLIES_QUERY)},t.canToggleCartOnOff=function(){return(0,i.isMDBackend)()&&f.ServerProps.webCartOnOffToggle},t.canViewBizLinkedAccounts=function(){return(0,r.getABPropConfigValue)("web_abprop_business_profile_refresh_linked_account_enabled")},t.canViewCollections=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("consumer_collections_enabled");return f.ServerProps.webCollectionsDisplay},t.catalogCategoriesEnabled=function(){return(0,r.getABPropConfigValue)("catalog_categories_enabled")},t.chatlistFiltersV1Enabled=function(){return(0,r.getABPropConfigValue)("chatlist_filters_v1")||!1},t.clearOrDeleteChatSyncEnabled=function(){if(f.ServerProps.syncdClearChatDeleteChatEnabled){if((d.Conn.platform===d.PLATFORMS.ANDROID||d.Conn.platform===d.PLATFORMS.SMBA)&&(0,l.getPrimaryAllowsAllMutations)())return!0;if((d.Conn.platform===d.PLATFORMS.IPHONE||d.Conn.platform===d.PLATFORMS.SMBI)&&p.PrimaryFeatures.clearAndDeleteChatSync)return!0}return!1},t.commerceFeaturesDisabledBySanctions=function(){return(0,r.getABPropConfigValue)("commerce_sanctioned")},t.commerceThreadsLoggingEnabled=function(){return(0,r.getABPropConfigValue)("native_commerce_threads_logging_enabled")},t.communitiesEnabled=S,t.communityAdminPromotionOneTimePromptEnabled=function(){return!1},t.communityCreationEnabled=function(){return!1},t.countryGatingEnabled=function(){return(0,r.getABPropConfigValue)("country_client_gating_enabled")},t.coverPhotoPrivacyMessagingEnabled=function(){return(0,r.getABPropConfigValue)("smb_temp_cover_photo_privacy_messaging")},t.customURLLoggingEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("smb_melon_logging_enabled")},t.documentWithCaptionsRecieveEnabled=function(){return!!T()||(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("documents_with_captions_receive")},t.documentWithCaptionsSendEnabled=T,t.forwardMediaWithCaptionsEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("forward_media_with_captions")},t.getGroupSizeLimit=function(){let e;(0,i.isMDBackend)()&&(e=(0,r.getABPropConfigValue)("group_size_limit")-1);(null==e||e<=0||Number.isNaN(e))&&(e=f.ServerProps.maxParticipants);return e},t.getParentGroupLinkLimit=function(){return(0,r.getABPropConfigValue)("parent_group_link_limit")+1},t.graphQLForCatalogM1Enabled=function(){return(0,r.getABPropConfigValue)("graphql_privacy_imp_m1")},t.graphQLForCollectionM2Enabled=function(){return(0,r.getABPropConfigValue)("graphql_privacy_imp_m2")},t.groupProfileEditorEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_group_profile_editor")},t.hideSpecificFlagReactions=function(){return(0,a.isFeatureEnabled)("reactions_filter_problematic_flags")||y()&&(0,r.getABPropConfigValue)("reactions_keyboard_hides_three_flags")},t.hideUnsupportedCurrency=function(){return(0,r.getABPropConfigValue)("smb_hide_unsupported_currency_price")},t.interactiveNativeFlowMessagesEnabled=function(){if((0,i.isMDBackend)())return!(0,r.getABPropConfigValue)("interactive_message_native_flow_killswitch");return!1},t.interactiveNativeFlowResponseMessagesEnabled=function(){if((0,i.isMDBackend)())return!(0,r.getABPropConfigValue)("interactive_response_message_native_flow_killswitch");return!1},t.interactiveResponseMessagesEnabled=function(){if((0,i.isMDBackend)())return!(0,r.getABPropConfigValue)("interactive_response_message_killswitch");return!1},t.isBizCoverPhotoEditEnabled=function(){return(0,r.getABPropConfigValue)("web_abprop_business_profile_refresh_edit_cover_photo_enabled")},t.isBizCoverPhotoViewEnabled=function(){return(0,r.getABPropConfigValue)("web_abprop_business_profile_refresh_cover_photo_view_enabled")},t.isCallingToPrimarySMBLimitEnabled=function(){return(0,r.getABPropConfigValue)("call_only_primary_device_limit_exceeded")},t.isCollectionReorderingEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("smb_catalog_collections_reordering_enabled")},t.isHighQualityVideoThumbnailsEnabled=function(){const{UA:e}=n(26741);return!e.isGecko},t.isMediaGalleryFixEnabled=function(){return(0,i.isMDBackend)()},t.isMultiDeviceAgentsEnabled=v,t.isMultiDeviceAgentsLoggingEnabled=function(){return v()&&(0,r.getABPropConfigValue)("smb_multi_device_agents_logging_enabled")},t.isOrderDetailsQuickPayEnabled=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.NONE;try{const{allowed_product_type:t}=JSON.parse((0,r.getABPropConfigValue)("order_details_quick_pay"));if(t&&t!==C.NONE)return t===C.ANY||t===e}catch(e){__LOG__(3)`isOrderDetailsQuickPayEnabled failed to parse config json: error ${e}`}return!1},t.isQuantityControlsFeatureEnabled=function(){return(0,r.getABPropConfigValue)("web_quantity_controls_enabled")},t.isRecentStickersEnabled=E,t.isSmbMelonDisplayEnabled=function(){return(0,r.getABPropConfigValue)("smb_melon_display_enabled")},t.isSmbMelonDisplayV2Enabled=function(){return(0,r.getABPropConfigValue)("smb_custom_url_display_v2_enabled")},t.isSmbOrangeEnabled=function(){return!!d.Conn.isSMB&&(0,r.getABPropConfigValue)("smb_orange_enabled")},t.isStarredStickersEnabled=function(){return s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.STARRED_STICKERS)&&E()},t.isThirdPartyStickersEnabled=function(){return s.LegacyPhoneFeatures.supportsAllFeatures(s.LegacyPhoneFeatures.F.THIRD_PARTY_STICKERS,s.LegacyPhoneFeatures.F.MEDIA_UPLOAD)},t.legacyUsersShouldUpdatePrimaryExperience=function(){return(0,i.isLegacyWebdBackend)()&&!s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.EXTERNAL_MD_OPT_IN_AVAILABLE)&&f.ServerProps.webLegacyUsersShouldUpdatePrimaryExperience},t.mdMigrationExperience=function(){return d.Conn.isSMB&&f.ServerProps.webMdMigrationExperience},t.mediaEditorBlurToolEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_media_editor_blur_tool")},t.messageLevelReportingEnabled=function(){return(0,r.getABPropConfigValue)("message_level_reporting")},t.messageQuickReplyEnabled=function(){return(0,r.getABPropConfigValue)("message_quick_reply")},t.messageSendCacheWarmingUpEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_message_send_cache_warming_up")},t.moreReactionsOption=y,t.multiSkinToneEmojiPickerEnabled=function(){return!1},t.nativeFlowMessagesEnabled=function(){return(0,r.getABPropConfigValue)("nfm_rendering_enabled")},t.newComposeBoxInputEnabled=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("web_new_compose_box_input")||!1;return!1},t.orderDetailsCustomItemEnabled=function(){return(0,r.getABPropConfigValue)("order_details_custom_item_enabled")},t.orderDetailsFromCartEnabled=function(){return(0,r.getABPropConfigValue)("order_details_from_cart_enabled")},t.orderDetailsFromCatalogEnabled=function(){return(0,r.getABPropConfigValue)("order_details_from_catalog_enabled")},t.orderDetailsTotalMaxValue=function(){return(0,r.getABPropConfigValue)("order_details_total_maximum_value")},t.orderDetailsTotalOrderMinimumValue=function(){return(0,r.getABPropConfigValue)("order_details_total_order_minimum_value")},t.orderManagementEnabled=function(){return(0,r.getABPropConfigValue)("order_management_enabled")},t.parseWMIReaction=function(){return(0,r.getABPropConfigValue)("reaction_history_sync")||m()},t.paymentBackgroundEnabled=function(){if((0,i.isMDBackend)()&&f.ServerProps.webPaymentBackgroundEnabled)return!0;return!1},t.phaseOutNotABusiness=function(){return(0,r.getABPropConfigValue)("smb_phase_out_not_a_business")},t.pinChatSyncEnabled=function(){if(f.ServerProps.syncdPinChatEnabled)return!!(d.Conn.platform!==d.PLATFORMS.ANDROID&&d.Conn.platform!==d.PLATFORMS.SMBA||(0,l.getPrimaryAllowsAllMutations)());return!1},t.prekeyFetchCacheWarmingUpEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_prekey_fetch_cache_warming_up")},t.privacyAllowContactsExceptEnabled=function(){return(0,r.getABPropConfigValue)("privacy_allow_contacts_except")&&p.PrimaryFeatures.contactExcept},t.privacySettingsEnabled=function(){return(0,i.isMDBackend)()},t.productListMessagesEnabled=function(){return f.ServerProps.webProductListMessage},t.quickRepliesManagementEnabled=function(){return d.Conn.isSMB&&(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_quick_reply_authoring")},t.reactionsAnimationsEnabled=function(){return m()&&(0,r.getABPropConfigValue)("reactions_animations")},t.reactionsCommunityAnnouncementOnly=function(){return(0,r.getABPropConfigValue)("reactions_announcement_only")},t.reactionsEmojiAggregateEnabled=function(){return m()&&(0,r.getABPropConfigValue)("reactions_skin_tone_aggregation")},t.reactionsPrekeysFetchEnabled=function(){return(0,r.getABPropConfigValue)("reactions_panel_prekeys_fetch_enabled")},t.receiveReactionsEnabled=m,t.rotateSenderKeyIfSentEnabled=function(){return(0,r.getABPropConfigValue)("web_rotate_sender_key_if_sent")},t.sendKeyDistributionMsgMinGroupSize=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("web_send_invisible_msg_min_group_size");return 0},t.sendKeyDistributionMsgToNewGroups=function(){return(0,r.getABPropConfigValue)("web_send_invisible_msg_to_new_groups")},t.sendOnlyActiveReceiptsEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("web_send_only_active_receipts")},t.sendReactionsEnabled=g,t.shopsInteractiveMessageEnabled=function(){return(0,r.getABPropConfigValue)("web_shop_storefront_message")},t.showReactionChatListPreview=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("reactions_chat_preview");return!1},t.smartFiltersEnabled=function(){return d.Conn.isSMB&&(0,r.getABPropConfigValue)("smart_filters_enabled")||!d.Conn.isSMB&&(0,r.getABPropConfigValue)("smart_filters_enabled_consumer")},t.smbBizProfileLoggingEnabled=function(){if(d.Conn.isSMB)return(0,r.getABPropConfigValue)("smb_biz_profile_logging_enabled");return!1},t.smbClickToChatLoggingEnabled=function(){if(d.Conn.isSMB)return(0,r.getABPropConfigValue)("smb_click_to_chat_logging_enabled");return!1},t.tos3GatingEnabled=function(){if(!d.Conn.isSMB)return(0,r.getABPropConfigValue)("tos_3_client_gating_enabled");return!1},t.tos3GatingEnabledB2C=function(){if(!d.Conn.isSMB)return(0,r.getABPropConfigValue)("tos_3_client_gating_biz_initiated_enabled");return!1},t.tosFetchEnabled=function(){if(!d.Conn.isSMB)return(0,r.getABPropConfigValue)("tos_client_state_fetch_enabled");return!1},t.tosFetchIteration=function(){return(0,r.getABPropConfigValue)("tos_client_state_fetch_iteration")},t.web2FAEnabled=function(){return(0,r.getABPropConfigValue)("web_2fa")},t.webMediaAutoDownloadEnabled=function(){return(0,a.isFeatureEnabled)("media_auto_download")&&f.ServerProps.webMediaAutoDownloadEnabled};var r=n(257243),i=n(88555),a=n(310206),o=n(715127),s=n(438184),l=n(711597),c=n(92059),u=n(393170),d=n(317239),p=n(634771),f=n(964551);function _(e){return(0,c.getCountryShortcodeByPhone)(e||"")===o.COMPLIANCE_INFO_CODES.INDIA||s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.SKIP_COMPLIANCE_PHONE_CHECK)}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!1;return!!_(e)&&((0,i.isMDBackend)()?t():n())}function g(){return!(!(0,i.isMDBackend)()||!p.PrimaryFeatures.reactionsSend)&&(0,r.getABPropConfigValue)("reactions_send")}function m(){return(0,r.getABPropConfigValue)("reactions_receive")||g()}function y(){return g()&&(0,r.getABPropConfigValue)("more_reactions_option")}function S(){return!1}function E(){return s.LegacyPhoneFeatures.supportsAnyFeature(s.LegacyPhoneFeatures.F.RECENT_STICKERS_V_2,s.LegacyPhoneFeatures.F.RECENT_STICKERS_V_3)&&s.LegacyPhoneFeatures.supportsFeature(s.LegacyPhoneFeatures.F.MEDIA_UPLOAD)}function v(){return d.Conn.isSMB&&(0,r.getABPropConfigValue)("smb_multi_device_agents_enabled")}function T(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("documents_with_captions_send")}const C=n(76672)({DIGITAL_GOODS:"digital-goods",PHYSICAL_GOODS:"physical-goods",ANY:"any",NONE:"none"});t.QUICK_PAY_PRODUCT_TYPE_GATING=C},758180:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMaxPollNameLength=function(){return(0,i.isLegacyWebdBackend)()?0:Math.min((0,r.getABPropConfigValue)("poll_name_length"),500)},t.getMaxPollOptionCount=function(){return(0,i.isLegacyWebdBackend)()?0:Math.min((0,r.getABPropConfigValue)("poll_option_count"),20)},t.getMaxPollOptionLength=function(){return(0,i.isLegacyWebdBackend)()?0:Math.min((0,r.getABPropConfigValue)("poll_option_length"),255)},t.getPollCleanupDays=function(){return(0,i.isLegacyWebdBackend)()?0:(0,r.getABPropConfigValue)("poll_cleanup_days")},t.isPollVoteProcessingEnabled=function(){return o()||a()||(0,r.getABPropConfigValue)("poll_vote_processing_enabled")},t.isPollsCreationEnabled=a,t.isPollsReceivingEnabled=o;var r=n(257243),i=n(88555);function a(){return(0,r.getABPropConfigValue)("poll_creation_enabled")}function o(){return!!a()||(0,r.getABPropConfigValue)("poll_receiving_enabled")}},879662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pastParticipantsDbEnabled=a,t.pastParticipantsInitialSyncEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("silent_group_exit_sync")},t.pastParticipantsScreenEnabled=o,t.silentGroupExitDialogEnabled=function(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("silent_group_exit_dialog")},t.skipLeaveSystemMessageEnabled=function(){return(0,i.isMDBackend)()&&o()&&(0,r.getABPropConfigValue)("silent_group_exit")};var r=n(257243),i=n(88555);function a(){return(0,i.isMDBackend)()&&(0,r.getABPropConfigValue)("silent_group_exit_db")}function o(){return(0,i.isMDBackend)()&&a()&&(0,r.getABPropConfigValue)("silent_group_exit_past_participants")}},263161:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.areStatusQuickRepliesEnabled=function(){return(0,r.getABPropConfigValue)("status_quick_reply_enabled")},t.canSeeStatusV3OnContact=function(){if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("web_abprop_business_profile_refresh_status_enabled");return o.ServerProps.webBizProfileV3M2},t.isStatusV3ProfilePhotoRingEnabled=function(){return(0,r.getABPropConfigValue)("profile_photo_rings_for_status_enabled")},t.smbStatusLoggingEnabled=function(){if(a.Conn.isSMB)return(0,r.getABPropConfigValue)("smb_status_logging_enabled");return!1},t.statusQuickReplyEmojis=function(){const e=["😍","😂","😮","😢","🙏","👏","🎉","💯"];try{const t=JSON.parse((0,r.getABPropConfigValue)("status_reaction_emojis"));return 0===t.length?e:t.map((e=>String.fromCodePoint(e)))}catch(t){return e}},t.statusV3LinkPreviewEnabled=function(){return(0,r.getABPropConfigValue)("status_inline_link_preview_enabled")};var r=n(257243),i=n(88555),a=n(317239),o=n(964551)},233783:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigImpl=void 0;var r=n(257243),i=n(964551);const a={syncdQPLLoggingEnabled:()=>i.ServerProps.syncdQPLLoggingEnabled,syncdInlineMutationsMaxCount:()=>i.ServerProps.syncdInlineMutationsMaxCount,syncdPatchProtobufMaxSize:()=>i.ServerProps.syncdPatchProtobufMaxSize,syncdPatchDeviceIndexIncluded:()=>i.ServerProps.syncdPatchDeviceIndexIncluded,syncdAdditionalMutations:()=>i.ServerProps.syncdAdditionalMutations,syncdMaxMutationsToProcessDuringResume:()=>(0,r.getABPropConfigValue)("web_syncd_max_mutations_to_process_during_resume"),syncdShouldFatalOnMissingPatch:()=>(0,r.getABPropConfigValue)("web_should_fatal_on_missing_patch")};t.ConfigImpl=a},947999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dbCallbacks=void 0;var r=n(425374),i=n(519001),a=n(773490);const o={downloadSyncBlob:a.downloadSyncBlob,getLogoutInProgress:r.getLogoutInProgress,getPrimaryPlatform:r.getPrimaryPlatform,getSyncActionHandler:r.getSyncActionHandler,getSyncActiveKey:i.getSyncActiveKey,getSyncDisabled:r.getSyncDisabled,getSyncKeyData:i.getSyncKeyData,getSyncMaxSupportedVersion:r.getSyncMaxSupportedVersion,handleMissingSyncKeys:i.handleMissingSyncKeys,handleSyncBeforeApplyPatch:r.handleSyncBeforeApplyPatch,handleSyncCompleted:r.handleSyncCompleted,handleSyncDelayApplyingPatchUntilUIUnblocks:r.handleSyncDelayApplyingPatchUntilUIUnblocks,handleSyncdFatal:r.handleSyncdFatal,uploadSyncExternalPatch:a.uploadSyncExternalPatch};t.dbCallbacks=o},512670:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=function(){return l().config},t.getMyDeviceJid=function(){var e;const t=null===(e=l().myJids)||void 0===e?void 0:e.deviceJid;if(null==t)throw(0,a.default)("Trying to access myDeviceJid, but it's not set");return(0,o.unsafeCoerceToPhoneDeviceJid)(t)},t.setGlobals=function(e){s=e,(0,i.setGlobals)(e)};var i=n(266543),a=r(n(124935)),o=n(252230);let s=null;function l(){if(null==s)throw Error("globals api called before set");return s}},121892:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runInTransaction=void 0;var r=n(595104),i=n(616982),a=n(777005),o=n(570491),s=n(144945),l=n(799069);const c={SyncActionStore:o.WAWebSyncActionStore,CollectionVersionStore:r.WAWebCollectionVersionStore,PendingMutationStore:a.WAWebPendingMutationStore,MissingKeyStore:i.WAWebMissingKeyStore,SyncKeyStore:s.WAWebSyncKeyStore};t.runInTransaction=(e,t)=>{const n=e.flatMap((e=>c[e].locks));return(0,l.getStorage)().lock(n,(()=>{const n={};for(const t of e)n[t]=new c[t];return t(n)}))}},514702:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.L10n=void 0;var i=r(n(876521)),a=n(424460),o=n(833970),s=r(n(842435)),l=r(n(70210)),c=r(n(617588)),u=r(n(156755)),d=r(n(997331)),p=r(n(730381));const f=new Set(["⁦","‪"]),_=new Set(["ar","ar-XB","fa","ur","he","dv","ku"]),h=new Set(["ar","ar-XB","fa"]),g="٠١٢٣٤٥٦٧٨٩".split("");function m(e){return g[parseInt(e,10)]}const y=new Error("Unimplemented method");class S extends i.default{constructor(e,t,n){if(super(),!e||!t)throw y;this._locale=e,this.localeStrings={},this.localeStrings[o.DEFAULT_LOCALE]=t,this.fbtStrings={},this.fbtStrings[o.DEFAULT_LOCALE]={en_GB:{}},this.markTranslations=n,this.customizeMoment()}getLocale(){throw y}getFbtTranslations(){throw y}setLocale(){throw y}normalizeLocale(e){const t=e.replace(/-/g,"_").toLowerCase(),n=this._getTranslationFilename(t);if(n)return n;let r=t;for(;r;){r=r.split("_").slice(0,-1).join("_");const e=r&&this._getTranslationFilename(r);if(e)return e}}isLocaleSupported(e){return!!e&&!!this.normalizeLocale(e)}_getTranslationFilename(e){const t=l.default[e]||e;return c.default[t]}isRTL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getLocale();return _.has(e)}LR(e,t){return this.isRTL()?t:e}embedDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.embedRTL(e):this.embedLTR(e)}forceDir(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isRTL())?this.forceRTL(e):this.forceLTR(e)}embedLTR(e){return"‪"+e+"‬"}embedRTL(e){return"‫"+e+"‬"}isolateLTR(e){return"⁦"+e+"⁩"}isolateRTL(e){return"⁧"+e+"⁩"}forceLTR(e){return"‎"+e}forceRTL(e){return"‏"+e}t(e,t,n){"number"!=typeof e&&__LOG__(3)`l10n.t was called with an unprocessed id (${e}). If you just added a string on local, restarting your build may address the issue.`;const r=e,i=null!=t?t._plural:null;let a=n||this.getLocale();this.localeStrings[a]||(a=o.DEFAULT_LOCALE);let s=this._getString(r,a,i);this.markTranslations&&(s?a===o.DEFAULT_LOCALE&&(s="["+s+"]"):(s="!!"+r+"!!",__LOG__(2)`l10n:t string key "${r}" not found`)),s||(s=this._getString(r,o.DEFAULT_LOCALE,i)),s||__LOG__(2)`l10n:t string key "${r}" fallback failed`;for(const e in t){if(!t.hasOwnProperty(e)||"_plural"===e)continue;const n=new RegExp("__"+e+"__","g");let r;r="string"==typeof t[e]&&f.has(t[e].slice(0,1))?t[e]:this.n(t[e],a),s=s.replace(n,r)}return s}_getString(e,t,n){const r=this.localeStrings[t]||this.localeStrings[o.DEFAULT_LOCALE];if(null==r)throw new Error(`Couldn't find translations for locale ${t} or default (${o.DEFAULT_LOCALE})`);if(!Array.isArray(r))throw new Error("Unexpected locale format.");const[i,a]=r,l=i[e]||"";if(null==n)return l;const c=s.default[t];if(null==c)return l;const u=c.numbers[c.plurals(n)];if(1===u)return l;return a[2===c.numbers.length&&2===u?e.toString():`${e}_${u}`]||l}useArabicScriptDigits(e){return h.has(e||this.getLocale())}isLatinAlphabetLanguage(e){return d.default.isLatin(this.removeAccents(e))}n(e,t){let n=e;return isNaN(n)||(n=n.toString()),this.useArabicScriptDigits(t)?n.toString().replace(/[0-9]/g,m):n}filesize(e){const t=this,n=e>1073741824?1:0,r=this.getLocale();return this.n((0,u.default)(e,{base:2,round:n,locale:r,symbols:{B:t.t(311),KB:t.t(313),MB:t.t(314),GB:t.t(312),KiB:t.t(313),MiB:t.t(314),GiB:t.t(312)}}))}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,a.normalizeForm)(e)}removeAccents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,a.removeAccents)(e)}accentFold(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.removeAccents(e).toLowerCase()}customizeMoment(){p.default.relativeTimeRounding(Math.floor),p.default.relativeTimeThreshold("s",60),p.default.relativeTimeThreshold("m",60),p.default.relativeTimeThreshold("h",24)}}t.L10n=S},92059:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryShortcodeByPhone=function(e){if(null==e||0===e.length)return"";const t=function(e,t){if(null!=e&&e.length>0&&null!=t){let n=t[e[0]],r=e;for(;r.length>0&&n;){if(n.c)return n.c;r=r.substr(1,r.length-1),n=n[r[0]]}}return""}(e,n);return""===t&&"1"===e[0]?"US":"RU"===t&&["6","7"].includes(e[1])?"KZ":t};const n={1:{2:{0:{4:{c:"CA"}},2:{6:{c:"CA"}},3:{6:{c:"CA"}},4:{2:{c:"BS"},9:{c:"CA"}},5:{0:{c:"CA"}},6:{4:{c:"AI"},8:{c:"AG"}},8:{4:{c:"VG"},9:{c:"CA"}}},3:{0:{6:{c:"CA"}},4:{0:{c:"VI"},3:{c:"CA"},5:{c:"KY"}},6:{5:{c:"CA"},7:{c:"CA"}}},4:{0:{3:{c:"CA"}},1:{6:{c:"CA"},8:{c:"CA"}},3:{1:{c:"CA"},7:{c:"CA"},8:{c:"CA"}},4:{1:{c:"BM"}},5:{0:{c:"CA"}},7:{3:{c:"GD"}}},5:{0:{6:{c:"CA"}},1:{4:{c:"CA"},9:{c:"CA"}},4:{8:{c:"CA"}},7:{9:{c:"CA"}},8:{1:{c:"CA"},7:{c:"CA"}}},6:{0:{4:{c:"CA"}},1:{3:{c:"CA"}},3:{9:{c:"CA"}},4:{7:{c:"CA"},9:{c:"TC"}},5:{8:{c:"JM"}},6:{4:{c:"MS"}},7:{0:{c:"MP"},1:{c:"GU"},2:{c:"CA"}},8:{4:{c:"AS"}}},7:{0:{5:{c:"CA"},9:{c:"CA"}},2:{1:{c:"MF"}},5:{8:{c:"LC"}},6:{7:{c:"DM"}},7:{8:{c:"CA"}},8:{0:{c:"CA"},2:{c:"CA"},4:{c:"VC"},7:{c:"PR"}}},8:{0:{7:{c:"CA"},9:{c:"DO"}},1:{9:{c:"CA"}},2:{5:{c:"CA"},9:{c:"DO"}},4:{9:{c:"DO"}},6:{7:{c:"CA"},8:{c:"TT"},9:{c:"KN"}},7:{3:{c:"CA"},6:{c:"JM"}}},9:{0:{2:{c:"CA"},5:{c:"CA"}},3:{9:{c:"PR"}}}},2:{0:{c:"EG"},1:{1:{c:"SS"},2:{c:"MA"},3:{c:"DZ"},6:{c:"TN"},8:{c:"LY"}},2:{0:{c:"GM"},1:{c:"SN"},2:{c:"MR"},3:{c:"ML"},4:{c:"GN"},5:{c:"CI"},6:{c:"BF"},7:{c:"NE"},8:{c:"TG"},9:{c:"BJ"}},3:{0:{c:"MU"},1:{c:"LR"},2:{c:"SL"},3:{c:"GH"},4:{c:"NG"},5:{c:"TD"},6:{c:"CF"},7:{c:"CM"},8:{c:"CV"},9:{c:"ST"}},4:{0:{c:"GQ"},1:{c:"GA"},2:{c:"CG"},3:{c:"CD"},4:{c:"AO"},5:{c:"GW"},6:{c:"IO"},7:{c:"AC"},8:{c:"SC"},9:{c:"SD"}},5:{0:{c:"RW"},1:{c:"ET"},2:{c:"SO"},3:{c:"DJ"},4:{c:"KE"},5:{c:"TZ"},6:{c:"UG"},7:{c:"BI"},8:{c:"MZ"}},6:{0:{c:"ZM"},1:{c:"MG"},2:{c:"RE"},3:{c:"ZW"},4:{c:"NA"},5:{c:"MW"},6:{c:"LS"},7:{c:"BW"},8:{c:"SZ"},9:{c:"KM"}},7:{c:"ZA"},9:{0:{c:"SH"},1:{c:"ER"},7:{c:"AW"},8:{c:"FO"},9:{c:"GL"}}},3:{0:{c:"GR"},1:{c:"NL"},2:{c:"BE"},3:{c:"FR"},4:{c:"ES"},5:{0:{c:"GI"},1:{c:"PT"},2:{c:"LU"},3:{c:"IE"},4:{c:"IS"},5:{c:"AL"},6:{c:"MT"},7:{c:"CY"},8:{c:"FI"},9:{c:"BG"}},6:{c:"HU"},7:{0:{c:"LT"},1:{c:"LV"},2:{c:"EE"},3:{c:"MD"},4:{c:"AM"},5:{c:"BY"},6:{c:"AD"},7:{c:"MC"},8:{c:"SM"}},8:{0:{c:"UA"},1:{c:"RS"},2:{c:"ME"},3:{c:"XK"},5:{c:"HR"},6:{c:"SI"},7:{c:"BA"},9:{c:"MK"}},9:{c:"IT"}},4:{0:{c:"RO"},1:{c:"CH"},2:{0:{c:"CZ"},1:{c:"SK"},3:{c:"LI"}},3:{c:"AT"},4:{c:"GB"},5:{c:"DK"},6:{c:"SE"},7:{c:"NO"},8:{c:"PL"},9:{c:"DE"}},5:{0:{0:{c:"FK"},1:{c:"BZ"},2:{c:"GT"},3:{c:"SV"},4:{c:"HN"},5:{c:"NI"},6:{c:"CR"},7:{c:"PA"},8:{c:"PM"},9:{c:"HT"}},1:{c:"PE"},2:{c:"MX"},3:{c:"CU"},4:{c:"AR"},5:{c:"BR"},6:{c:"CL"},7:{c:"CO"},8:{c:"VE"},9:{0:{c:"GP"},1:{c:"BO"},2:{c:"GY"},3:{c:"EC"},4:{c:"GF"},5:{c:"PY"},6:{c:"MQ"},7:{c:"SR"},8:{c:"UY"},9:{c:"CW"}}},6:{0:{c:"MY"},1:{c:"AU"},2:{c:"ID"},3:{c:"PH"},4:{c:"NZ"},5:{c:"SG"},6:{c:"TH"},7:{0:{c:"TL"},2:{c:"NF"},3:{c:"BN"},4:{c:"NR"},5:{c:"PG"},6:{c:"TO"},7:{c:"SB"},8:{c:"VU"},9:{c:"FJ"}},8:{0:{c:"PW"},1:{c:"WF"},2:{c:"CK"},3:{c:"NU"},5:{c:"WS"},6:{c:"KI"},7:{c:"NC"},8:{c:"TV"},9:{c:"PF"}},9:{0:{c:"TK"},1:{c:"FM"},2:{c:"MH"}}},7:{c:"RU"},8:{1:{c:"JP"},2:{c:"KR"},4:{c:"VN"},5:{0:{c:"KP"},2:{c:"HK"},3:{c:"MO"},5:{c:"KH"},6:{c:"LA"}},6:{c:"CN"},8:{0:{c:"BD"},6:{c:"TW"}}},9:{0:{c:"TR"},1:{c:"IN"},2:{c:"PK"},3:{c:"AF"},4:{c:"LK"},5:{c:"MM"},6:{0:{c:"MV"},1:{c:"LB"},2:{c:"JO"},3:{c:"SY"},4:{c:"IQ"},5:{c:"KW"},6:{c:"SA"},7:{c:"YE"},8:{c:"OM"}},7:{0:{c:"PS"},1:{c:"AE"},2:{c:"IL"},3:{c:"BH"},4:{c:"QA"},5:{c:"BT"},6:{c:"MN"},7:{c:"NP"}},8:{c:"IR"},9:{2:{c:"TJ"},3:{c:"TM"},4:{c:"AZ"},5:{c:"GE"},6:{c:"KG"},8:{c:"UZ"}}}}},712733:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStringOrFbt=function(e){return(0,r.isString)(e)||i.fbt.isFbtInstance(e)};var r=n(551737),i=n(548360)},424460:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getLanguageCodeFromLocale=function(e){return e.replace(/_/g,"-").split("-")[0].toLowerCase()},t.getRegionCodeFromLocale=function(e){const t=e.replace(/_/g,"-").split("-");if(t.length<=1)return null;return t[t.length-1].toUpperCase()},t.normalizeForm=a,t.removeAccents=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(0,i.default)(a(e).replace(/(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])/g,""))};var i=r(n(997331));function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.normalize("NFKD")}},914296:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=(r(n(435161)),n(180284)),o=(r(n(229690)),n(413959)),s=n(904352),l=n(26741),c=n(548360),u=r(n(730381)),d=n(514702),p=n(424460),f=n(833970),_=r(n(468609)),h=n(134355);const g=self.location.href;g&&g.includes("/%F0%9F%8C%90/")&&Promise.resolve().then(n.bind(n,376139)).then((e=>{let{default:t}=e;t.canMuckHistory()&&window.history.replaceState({},"","/")}));const m="en-GB",y={LTR:"LTR",RTL:"RTL"},S={LTR:"style",RTL:"style_rtl"},E=f.L10N_PRIORITY;class v extends d.L10n{constructor(){super({l:f.DEFAULT_LOCALE,priority:E.DEFAULT,loc:f.DEFAULT_LOCALE},n(243756).default,f.MARK_TRANSLATIONS);{const e=function(){const e=document.querySelector("html");return null==e?void 0:e.getAttribute("loc")}(),t={};this._considerLocale(t,e,E.PREVIOUS)&&this.downloadAndSetTranslation(t)}}getLocale(){return this._locale.l}getFbtTranslations(){return this.fbtStrings[this._locale.l]}getFullLocale(){return this._locale.loc.replace("_","-")}_getFBTLocale(){return(0,h.normalizeLocaleToFBTLocale)(this.getLocale())}getLanguage(){return(0,p.getLanguageCodeFromLocale)(this.getFullLocale())}getRegion(){return(0,p.getRegionCodeFromLocale)(this.getFullLocale())}normalizeForm(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!l.UA.isTrident)return e.normalize("NFKD");try{return e.normalize("NFKD")}catch(t){return e}}setLocale(e,t){var n=this;return(0,i.default)((function*(){const r={l:n._locale.l,priority:n._locale.priority,loc:n._locale.l};return n._considerLocale(r,e,t)?n.downloadAndSetTranslation(r):Promise.resolve()}))()}isLocaleSupported(e){try{return super.isLocaleSupported(e)&&(!self.Intl||Array.isArray(self.Intl.Collator.supportedLocalesOf(e)))}catch(e){return!1}}init(e){var t;this._initFbt();const n={l:f.DEFAULT_LOCALE,priority:E.DEFAULT,loc:f.DEFAULT_LOCALE};if(this._considerLocale(n,e,E.PREVIOUS),this._considerLocale(n,function(){let e=(g||self.location.href||"").split("/%F0%9F%8C%90/");return e.length>1?e[1].split("/")[0]:void 0}(),E.URL),this._considerLocale(n,navigator.language,E.BROWSER),null===(t=navigator.languages)||void 0===t?void 0:t.length)for(let e=0;e<navigator.languages.length&&!this._considerLocale(n,navigator.languages[e],E.BROWSER);e++);return this.downloadAndSetTranslation(n)}_initFbt(){const e=f.MARK_TRANSLATIONS?e=>this.getLocale()===f.DEFAULT_LOCALE?new c.FbtResult(["{",...e.contents,"}"]):new c.FbtResult(e.contents):void 0;(0,c.init)({translations:this.getFbtTranslations(),hooks:{getViewerContext:()=>({locale:this._getFBTLocale()}),getFbsResult:e,getFbtResult:e}})}_considerLocale(e,t,n){if(null!=e.priority&&n<e.priority)return;if(null==t||t===this.getLocale())return;const r=this.normalizeLocale(t);return r?(e.l=r,e.priority=n,e.loc=t,e):void 0}downloadAppLocale(e){return this.localeStrings[e]?Promise.resolve(this.localeStrings[e]):(0,s.promiseLoop)(function(){var t=(0,i.default)((function*(t,r,i){const s=(0,o.delayMs)((0,a.expBackoff)(i,12e4,1e3,.1)),l=yield n(826299)(`./${e}`);try{const[e]=yield l.default();return t(e)}catch(t){return 10===i&&(__LOG__(4,void 0,new Error,!0)`${i} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),s}}));return function(){return t.apply(this,arguments)}}())}downloadFbtLocaleAndSetCache(e){var t=this;return this.fbtStrings[e]?Promise.resolve(this.fbtStrings[e]):(0,s.promiseLoop)(function(){var r=(0,i.default)((function*(r,i,s){const l=(0,o.delayMs)((0,a.expBackoff)(s,12e4,1e3,.1)),c=yield n(826299)(`./${e}`);try{const[,n]=yield c.default();return t.fbtStrings[e]=n,r(n)}catch(t){return 10===s&&(__LOG__(4,void 0,new Error,!0)`${s} times, locale is ${e}`,SEND_LOGS("downadAppLocale failure")),l}}));return function(){return r.apply(this,arguments)}}())}_downloadMomentResourceFile(e){return(0,i.default)((function*(){try{return(yield n(519922)(`./${e}`)).default}catch(t){__LOG__(2)`l10n:_downloadMomentResourceFile failed to download resource ${e}`}}))()}downloadMomentLocale(e){var t=this;const{l:n,loc:r}=e;return u.default.locale()===r?Promise.resolve():(0,s.promiseLoop)(function(){var e=(0,i.default)((function*(e,i,s){const l=(0,o.delayMs)((0,a.expBackoff)(s,12e4,1e3,.1)),c=r.replace(/_/g,"-");let u,d;if(c===f.DEFAULT_MOMENT_LOCALE)u=()=>Promise.resolve(),d=f.DEFAULT_MOMENT_LOCALE;else{const e=[];if(e.push(c),n===f.DEFAULT_LOCALE)e.push(m);else{const t=n.replace(/_/g,"-");e.push(t),null!=_.default[t]&&e.push(_.default[t])}e.push(m);for(let n=0;n<e.length;++n)if(u=yield t._downloadMomentResourceFile(e[n]),null!=u){d=e[n];break}null==u&&(__LOG__(3)`Could not fetch moment locales, using default en-US`,u=()=>Promise.resolve(),d=f.DEFAULT_MOMENT_LOCALE)}try{return yield u(),e(d)}catch(e){return 10===s&&(__LOG__(4,void 0,new Error,!0)`${s} times, locale is (${n}, ${r})`,SEND_LOGS("downloadMomentLocale failure")),l}}));return function(){return e.apply(this,arguments)}}())}updateFbtContext(e){null!=e&&c.FbtTranslations.registerTranslations(e)}downloadAndSetTranslation(e){const{l:t,loc:r}=this._locale,{l:i,loc:a}=e,o=this.isRTL(i),s=o?y.RTL:y.LTR;if(document.getElementById(S[s])&&a===r)return Promise.resolve();const l=self.performance.now();let c,d;return this._fetchPromise=Promise.all([this.downloadAppLocale(i),this.downloadFbtLocaleAndSetCache(i),this.downloadMomentLocale(e)]).then((t=>{let[n,r,o]=t;c=self.performance.now(),this.localeStrings[i]=n,this._locale=e,this.trigger("set_collator",i),o&&(u.default.locale(o),__LOG__(2)`l10n:moment locale updated to: ${o}`),this.customizeMomentLocale(u.default.locale()),document.documentElement&&document.documentElement.setAttribute("lang",e.l),document.documentElement&&document.documentElement.setAttribute("dir",s),this.updateFbtContext(r),this.trigger("locale_change",{l:i,loc:a})})).then((()=>{d=self.performance.now(),__LOG__(2)`l10n:locale updated: (${t}, ${r}) > (${i}, ${a}), Fetch: ${c-l}ms, Apply: ${d-c}ms`;if(n(8425).default.supported){var e;const t=n(125613).default,r=n(364237).default;(null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)&&t.request(navigator.serviceWorker.controller,r.SET_L10N,{isRTL:o,locale:i}).catch((()=>{}))}})).catch((()=>(__LOG__(2)`l10n:locale update error: (${t}, ${r}) > (${i}, ${a})`,this.downloadAndSetTranslation({l:f.DEFAULT_LOCALE,priority:E.DEFAULT,loc:f.DEFAULT_LOCALE}))))}_updateSpellChecker(){}_updateElectronMain(){}customizeMomentLocale(e){const t=f.LOCALE_CUSTOMIZATIONS[e];t&&u.default.locale(e,t)}}v.Dir=y;var T=new v;t.default=T},833970:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SHOULD_USE_MOMENT_LOCALE_FORMAT=t.MARK_TRANSLATIONS=t.LOCALE_DATE_TIME_CUSTOMIZATIONS=t.LOCALE_CUSTOMIZATIONS=t.LOCALES_THAT_PREFER_24HOUR_TIME=t.L10N_PRIORITY=t.DEFAULT_MOMENT_LOCALE=t.DEFAULT_LOCALE=void 0;var i=r(n(81109));t.L10N_PRIORITY={SAVED:6,PHONE:5,PREVIOUS:4,URL:3,BROWSER:2,DEFAULT:1};t.DEFAULT_LOCALE="en";t.DEFAULT_MOMENT_LOCALE="en-US";const a=new Set(["ur"]);t.SHOULD_USE_MOMENT_LOCALE_FORMAT=a;const o=new Set(["af","az","ca","cs","da","de","el","et","fi","fr","he","hr","hu","id","it","kk","lt","mk","nb","pl","pt","pt-BR","ro","ru","sk","sl","sr","sv","th","tr","uk"]);t.LOCALES_THAT_PREFER_24HOUR_TIME=o;const s={"zh-tw":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY年MMMD日",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"}},"zh-cn":{longDateFormat:{LT:"Ah:mm",LTS:"Ah:m:s",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY年MMMD日",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"}},ar:{longDateFormat:{LT:"h:mm A",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"}},ta:{longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY, h:mm A"},preparse:null,postformat:null,meridiem:null,meridiemHour:null},nl:{longDateFormat:{l:"DD-MM-YYYY",L:"DD-MM-YYYY"}},"en-ie":{longDateFormat:{l:"DD/MM/YYYY",L:"DD/MM/YYYY"}},hi:{preparse:null,postformat:null,longDateFormat:{LT:"A h:mm बजे",LTS:"A h:mm:ss बजे",LLL:"D MMMM YYYY A h:mm बजे",LLLL:"dddd, D MMMM YYYY, A h:mm बजे"},meridiem:(e,t)=>0===e&&0===t?"मध्यरात्रि":e>=20||e<4?"रात":e>=4&&e<12?"सुबह":e>=12&&e<16?"दोपहर":"शाम"}};t.LOCALE_DATE_TIME_CUSTOMIZATIONS=s;const l=(0,i.default)((0,i.default)({},s),{"pt-pt":{weekdays:["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"]}});t.LOCALE_CUSTOMIZATIONS=l;t.MARK_TRANSLATIONS=!1},134355:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeLocaleToFBTLocale=function(e){const t=n[e];if(null!=t)return t;return e};const n={af:"af_ZA",ar:"ar_AR",az:"az_AZ",bg:"bg_BG",bn:"bn_IN",ca:"ca_ES",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_GB",es:"es_MX",et:"et_EE",fa:"fa_IR",fi:"fi_FI",fil:"tl_PH",fr:"fr_FR",gu:"gu_IN",he:"he_IL",hi:"hi_IN",hr:"hr_HR",hu:"hu_HU",id:"id_ID",it:"it_IT",ja:"ja_JP",kk:"kk_KZ",kn:"kn_IN",ko:"ko_KR",lt:"lt_LT",lv:"lv_LV",mk:"mk_MK",ml:"ml_IN",mr:"mr_IN",ms:"ms_MY",nb:"nb_NO",nl:"nl_NL",pa:"pa_IN",pl:"pl_PL",pt:"pt_PT","pt-BR":"pt_BR",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sq:"sq_AL",sr:"sr_RS",sv:"sv_SE",sw:"sw_KE",ta:"ta_IN",te:"te_IN",th:"th_TH",tr:"tr_TR",uk:"uk_UA",ur:"ur_PK",uz:"uz_UZ",vi:"vi_VN","zh-CN":"zh_CN","zh-HK":"zh_HK","zh-TW":"zh_TW"}},842435:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={ach:{name:"Acholi",numbers:[1,2],plurals:e=>Number(e>1)},af:{name:"Afrikaans",numbers:[1,2],plurals:e=>Number(1!=e)},ak:{name:"Akan",numbers:[1,2],plurals:e=>Number(e>1)},am:{name:"Amharic",numbers:[1,2],plurals:e=>Number(e>1)},an:{name:"Aragonese",numbers:[1,2],plurals:e=>Number(1!=e)},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:e=>Number(0===e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},arn:{name:"Mapudungun",numbers:[1,2],plurals:e=>Number(e>1)},ast:{name:"Asturian",numbers:[1,2],plurals:e=>Number(1!=e)},ay:{name:"Aymará",numbers:[1],plurals:()=>0},az:{name:"Azerbaijani",numbers:[1,2],plurals:e=>Number(1!=e)},be:{name:"Belarusian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},bg:{name:"Bulgarian",numbers:[1,2],plurals:e=>Number(1!=e)},bn:{name:"Bengali",numbers:[1,2],plurals:e=>Number(1!=e)},bo:{name:"Tibetan",numbers:[1],plurals:()=>0},br:{name:"Breton",numbers:[1,2],plurals:e=>Number(e>1)},bs:{name:"Bosnian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ca:{name:"Catalan",numbers:[1,2],plurals:e=>Number(1!=e)},cgg:{name:"Chiga",numbers:[1],plurals:()=>0},cs:{name:"Czech",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},csb:{name:"Kashubian",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:e=>Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},da:{name:"Danish",numbers:[1,2],plurals:e=>Number(1!=e)},de:{name:"German",numbers:[1,2],plurals:e=>Number(1!=e)},dz:{name:"Dzongkha",numbers:[1],plurals:()=>0},el:{name:"Greek",numbers:[1,2],plurals:e=>Number(1!=e)},en:{name:"English",numbers:[1,2],plurals:e=>Number(1!=e)},eo:{name:"Esperanto",numbers:[1,2],plurals:e=>Number(1!=e)},es:{name:"Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:e=>Number(1!=e)},et:{name:"Estonian",numbers:[1,2],plurals:e=>Number(1!=e)},eu:{name:"Basque",numbers:[1,2],plurals:e=>Number(1!=e)},fa:{name:"Persian",numbers:[1,2],plurals:e=>Number(e>1)},fi:{name:"Finnish",numbers:[1,2],plurals:e=>Number(1!=e)},fil:{name:"Filipino",numbers:[1,2],plurals:e=>Number(e>1)},fo:{name:"Faroese",numbers:[1,2],plurals:e=>Number(1!=e)},fr:{name:"French",numbers:[1,2],plurals:e=>Number(e>1)},fur:{name:"Friulian",numbers:[1,2],plurals:e=>Number(1!=e)},fy:{name:"Frisian",numbers:[1,2],plurals:e=>Number(1!=e)},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:e=>Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:e=>Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},gl:{name:"Galician",numbers:[1,2],plurals:e=>Number(1!=e)},gu:{name:"Gujarati",numbers:[1,2],plurals:e=>Number(1!=e)},gun:{name:"Gun",numbers:[1,2],plurals:e=>Number(e>1)},ha:{name:"Hausa",numbers:[1,2],plurals:e=>Number(1!=e)},he:{name:"Hebrew",numbers:[1,2,20,3],plurals:e=>Number(1===e?0:2===e?1:e>=20&&e%10==0?2:3)},hi:{name:"Hindi",numbers:[1,2],plurals:e=>Number(1!=e)},hr:{name:"Croatian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},hu:{name:"Hungarian",numbers:[1,2],plurals:e=>Number(1!=e)},hy:{name:"Armenian",numbers:[1,2],plurals:e=>Number(1!=e)},ia:{name:"Interlingua",numbers:[1,2],plurals:e=>Number(1!=e)},id:{name:"Indonesian",numbers:[1],plurals:()=>0},is:{name:"Icelandic",numbers:[1,2],plurals:e=>Number(e%10!=1||e%100==11)},it:{name:"Italian",numbers:[1,2],plurals:e=>Number(1!=e)},ja:{name:"Japanese",numbers:[1],plurals:()=>0},jbo:{name:"Lojban",numbers:[1],plurals:()=>0},jv:{name:"Javanese",numbers:[0,1],plurals:e=>Number(0!==e)},ka:{name:"Georgian",numbers:[1],plurals:()=>0},kk:{name:"Kazakh",numbers:[1],plurals:()=>0},km:{name:"Khmer",numbers:[1],plurals:()=>0},kn:{name:"Kannada",numbers:[1,2],plurals:e=>Number(1!=e)},ko:{name:"Korean",numbers:[1],plurals:()=>0},ku:{name:"Kurdish",numbers:[1,2],plurals:e=>Number(1!=e)},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:e=>Number(1==e?0:2==e?1:3==e?2:3)},ky:{name:"Kyrgyz",numbers:[1],plurals:()=>0},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:e=>Number(1!=e)},ln:{name:"Lingala",numbers:[1,2],plurals:e=>Number(e>1)},lo:{name:"Lao",numbers:[1],plurals:()=>0},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},lv:{name:"Latvian",numbers:[0,1,2],plurals:e=>Number(e%10==1&&e%100!=11?0:0!==e?1:2)},mai:{name:"Maithili",numbers:[1,2],plurals:e=>Number(1!=e)},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:e=>Number(e>1)},mg:{name:"Malagasy",numbers:[1,2],plurals:e=>Number(e>1)},mi:{name:"Maori",numbers:[1,2],plurals:e=>Number(e>1)},mk:{name:"Macedonian",numbers:[1,2],plurals:e=>Number(1==e||e%10==1?0:1)},ml:{name:"Malayalam",numbers:[1,2],plurals:e=>Number(1!=e)},mn:{name:"Mongolian",numbers:[1,2],plurals:e=>Number(1!=e)},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:e=>Number(0===e?0:1==e?1:2)},mr:{name:"Marathi",numbers:[1,2],plurals:e=>Number(1!=e)},ms:{name:"Malay",numbers:[1],plurals:()=>0},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:e=>Number(1==e?0:0===e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},nah:{name:"Nahuatl",numbers:[1,2],plurals:e=>Number(1!=e)},nap:{name:"Neapolitan",numbers:[1,2],plurals:e=>Number(1!=e)},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:e=>Number(1!=e)},ne:{name:"Nepali",numbers:[1,2],plurals:e=>Number(1!=e)},nl:{name:"Dutch",numbers:[1,2],plurals:e=>Number(1!=e)},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:e=>Number(1!=e)},no:{name:"Norwegian",numbers:[1,2],plurals:e=>Number(1!=e)},nso:{name:"Northern Sotho",numbers:[1,2],plurals:e=>Number(1!=e)},oc:{name:"Occitan",numbers:[1,2],plurals:e=>Number(e>1)},or:{name:"Oriya",numbers:[2,1],plurals:e=>Number(1!=e)},pa:{name:"Punjabi",numbers:[1,2],plurals:e=>Number(1!=e)},pap:{name:"Papiamento",numbers:[1,2],plurals:e=>Number(1!=e)},pl:{name:"Polish",numbers:[1,2,5],plurals:e=>Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},pms:{name:"Piemontese",numbers:[1,2],plurals:e=>Number(1!=e)},ps:{name:"Pashto",numbers:[1,2],plurals:e=>Number(1!=e)},pt:{name:"Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},"pt-BR":{name:"Brazilian Portuguese",numbers:[1,2],plurals:e=>Number(1!=e)},rm:{name:"Romansh",numbers:[1,2],plurals:e=>Number(1!=e)},ro:{name:"Romanian",numbers:[1,2,20],plurals:e=>Number(1==e?0:0===e||e%100>0&&e%100<20?1:2)},ru:{name:"Russian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},sah:{name:"Yakut",numbers:[1],plurals:()=>0},sco:{name:"Scots",numbers:[1,2],plurals:e=>Number(1!=e)},se:{name:"Northern Sami",numbers:[1,2],plurals:e=>Number(1!=e)},si:{name:"Sinhala",numbers:[1,2],plurals:e=>Number(1!=e)},sk:{name:"Slovak",numbers:[1,2,5],plurals:e=>Number(1==e?0:e>=2&&e<=4?1:2)},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:e=>Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},so:{name:"Somali",numbers:[1,2],plurals:e=>Number(1!=e)},son:{name:"Songhay",numbers:[1,2],plurals:e=>Number(1!=e)},sq:{name:"Albanian",numbers:[1,2],plurals:e=>Number(1!=e)},sr:{name:"Serbian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},su:{name:"Sundanese",numbers:[1],plurals:()=>0},sv:{name:"Swedish",numbers:[1,2],plurals:e=>Number(1!=e)},sw:{name:"Swahili",numbers:[1,2],plurals:e=>Number(1!=e)},ta:{name:"Tamil",numbers:[1,2],plurals:e=>Number(1!=e)},te:{name:"Telugu",numbers:[1,2],plurals:e=>Number(1!=e)},tg:{name:"Tajik",numbers:[1,2],plurals:e=>Number(e>1)},th:{name:"Thai",numbers:[1],plurals:()=>0},ti:{name:"Tigrinya",numbers:[1,2],plurals:e=>Number(e>1)},tk:{name:"Turkmen",numbers:[1,2],plurals:e=>Number(1!=e)},tr:{name:"Turkish",numbers:[1,2],plurals:e=>Number(e>1)},tt:{name:"Tatar",numbers:[1],plurals:()=>0},ug:{name:"Uyghur",numbers:[1],plurals:()=>0},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:e=>Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},ur:{name:"Urdu",numbers:[1,2],plurals:e=>Number(1!=e)},uz:{name:"Uzbek",numbers:[1,2],plurals:e=>Number(e>1)},vi:{name:"Vietnamese",numbers:[1],plurals:()=>0},wa:{name:"Walloon",numbers:[1,2],plurals:e=>Number(e>1)},wo:{name:"Wolof",numbers:[1],plurals:()=>0},yo:{name:"Yoruba",numbers:[1,2],plurals:e=>Number(1!=e)},zh:{name:"Chinese",numbers:[1],plurals:()=>0}};t.default=n},509978:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SyntheticCountryCode=void 0,t.bubbleCountryOnListOfCountries=p,t.formatCountriesOfOrigin=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=d(e,!0);if(""===t)return n;return p(n,t)},t.getCountries=function(){return f.apply(this,arguments)},t.getCountryName=function(){return c.apply(this,arguments)},t.unshiftNotApplicableToListOfCountries=d;var i=r(n(348926)),a=r(n(914296)),o=n(833970),s=n(548360);r(n(156720));const l={countrySeparator:{borderBottom:"bajl15op"}};function c(){return(c=(0,i.default)((function*(e){if(!e)return;return(yield _(a.default.getLocale()))[e.toUpperCase()]}))).apply(this,arguments)}const u=n(76672)({NotApplicable:"NOT_APPLICABLE"});function d(e,t){const n=[...e];return n.unshift([String(u.NotApplicable),s.fbt._("Not Applicable",null,{hk:"2k1klN"}),s.fbt._("Item is a service or non-physical good",null,{hk:"3uDBY7"}),...!0===t?[l.countrySeparator]:[]]),n}function p(e,t,n){const r=e.findIndex((e=>{let[n]=e;return n===t})),[i,a]=[...e[r]],o=[...e];return o.splice(r,1),o.unshift([i,a,null,...n?[l.countrySeparator]:[]]),o}function f(){return(f=(0,i.default)((function*(){const e=yield _(a.default.getLocale());return Object.keys(e).filter((e=>!e.includes("@"))).map((t=>[t,e[t]])).sort(((e,t)=>{let[,n]=e,[,r]=t;return String(n).localeCompare(String(r))}))}))).apply(this,arguments)}function _(){return h.apply(this,arguments)}function h(){return(h=(0,i.default)((function*(e){const t=(yield n.e(5211).then(n.t.bind(n,401820,19))).default.includes(e)?e:o.DEFAULT_LOCALE;return(yield n(329127)(`./${t}.json`)).default}))).apply(this,arguments)}t.SyntheticCountryCode=u},468609:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={"zh-HK":"zh-TW",pa:"pa-IN"};t.default=n},70210:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={pt:"pt_br",pt_ao:"pt",pt_ch:"pt",pt_cv:"pt",pt_fr:"pt",pt_gq:"pt",pt_gw:"pt",pt_lu:"pt",pt_mo:"pt",pt_mz:"pt",pt_pt:"pt",pt_st:"pt",pt_tl:"pt",zh_hans:"zh_cn",zh_hant:"zh_tw",zh_sg:"zh_cn",tl:"fil",in:"id",iw:"he",mo:"ro",jw:"jv",ji:"yi"};t.default=n},617588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={af:"af",ar:"ar",ar_xb:"ar-XB",az:"az",bg:"bg",bn:"bn",ca:"ca",cs:"cs",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",fa:"fa",fi:"fi",fil:"fil",fr:"fr",gu:"gu",he:"he",hi:"hi",hr:"hr",hu:"hu",id:"id",it:"it",ja:"ja",kk:"kk",kn:"kn",ko:"ko",lt:"lt",lv:"lv",mk:"mk",ml:"ml",mr:"mr",ms:"ms",nb:"nb",nl:"nl",pa:"pa",pl:"pl",pt:"pt",pt_br:"pt-BR",ro:"ro",ru:"ru",sk:"sk",sl:"sl",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",th:"th",tr:"tr",uk:"uk",ur:"ur",uz:"uz",vi:"vi",zh_cn:"zh-CN",zh_hk:"zh-HK",zh_tw:"zh-TW"};t.default=n},871473:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_AUTO_DOWNLOAD_SIZE=t.AutoDownloadQueue=t.AUTO_DOWNLOAD_TYPES=t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=void 0,t.shouldAutoDownloadMedia=m,t.shouldTrustMedia=g,t.validateMediaSize=y;var i=r(n(348926)),a=r(n(730844)),o=n(115461),s=n(555452),l=r(n(961516)),c=n(778986),u=r(n(11339)),d=n(554676);const p=n(76672)({MEDIA:"media",MMS_THUMBNAIL:"mms_thumbnail"});t.AUTO_DOWNLOAD_TYPES=p;const f=33554432;t.MAX_AUTO_DOWNLOAD_SIZE=f;const _=524288;t.AUDIO_AUTO_DOWNLOAD_SIZE_LIMIT=_;const h=512e3;function g(e){return e.isTrusted()}function m(e){switch(e.type){case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return(0,s.getAutoDownloadAudio)();case o.MSG_TYPE.STICKER:case o.MSG_TYPE.IMAGE:return(0,s.getAutoDownloadPhotos)();case o.MSG_TYPE.VIDEO:return e.isGif&&e.size<h?(0,s.getAutoDownloadPhotos)():(0,s.getAutoDownloadVideos)();case o.MSG_TYPE.DOCUMENT:return(0,s.getAutoDownloadDocuments)()}return!1}function y(e){switch(e.type){case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.VIDEO:case o.MSG_TYPE.DOCUMENT:return e.size<=f;case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return e.size<_;case o.MSG_TYPE.STICKER:return!0}return!1}const S=new class{constructor(){this._downloaderQueue=new a.default(5,{photos:2,videos:1,audio:1,documents:1,mms_thumbnail:4})}getEnqueuedTasksCount(){return this._downloaderQueue.getEnqueuedTasksCount()}clearQueue(){this._downloaderQueue.clearQueue()}enqueue(e,t){if(this.getEnqueuedTasksCount()>=32)return!1;if(t===p.MEDIA&&g(e)&&e.isNewMsg&&m(e)&&y(e))switch(e.type){case o.MSG_TYPE.AUDIO:case o.MSG_TYPE.PTT:return this._enqueueMedia({message:e,group:"audio"}),!0;case o.MSG_TYPE.IMAGE:case o.MSG_TYPE.STICKER:return this._enqueueMedia({message:e,group:"photos"}),!0;case o.MSG_TYPE.VIDEO:return e.isGif&&e.size<h?(this._enqueueMedia({message:e,group:"photos"}),!0):(this._enqueueMedia({message:e,group:"videos"}),!0);case o.MSG_TYPE.DOCUMENT:return this._enqueueMedia({message:e,group:"documents"}),!0}if(t===p.MMS_THUMBNAIL){if(e.type===o.MSG_TYPE.DOCUMENT||(0,d.typeIsUrl)(e))return this._enqueueMmsThumbnail({message:e,group:"mms_thumbnail"}),!0;if(e.type===o.MSG_TYPE.IMAGE||e.type===o.MSG_TYPE.VIDEO)return this._enqueueStatusV3Thumbnail({message:e,group:"mms_thumbnail"}),!0}return!1}_enqueueMedia(e){var t=this;let{message:n,group:r}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){m(n)&&(yield n.downloadMedia({downloadEvenIfExpensive:!1,rmrReason:u.default.WEBC_RMR_REASON_CODE.OTHER,isUserInitiated:!1,isAutoDownload:!0}))})),{group:r,priority:-n.t})}))()}_enqueueMmsThumbnail(e){var t=this;let{message:n,group:r}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,l.default)({msg:n})})),{group:r,priority:-n.t})}))()}_enqueueStatusV3Thumbnail(e){var t=this;let{message:n,group:r}=e;return(0,i.default)((function*(){yield t._downloaderQueue.enqueue((0,i.default)((function*(){yield(0,c.downloadStatusV3Thumbnail)({msg:n})})),{group:r,priority:-n.t})}))()}};t.AutoDownloadQueue=S},199140:(e,t)=>{"use strict";function n(e){if(!e)return e;const t=e.replace(/[\u202a-\u202e\u2066-\u2069\u200E\u200F\u061C]/g,"�"),n=t.split(".");if(1===n.length)return t;for(let e=n.length-1;e>0;e--){const t=n[e].trim();if(t.length)return n.slice(0,e).join(".")+"."+t}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.cleanFilename=n,t.cleanIncomingFilename=function(e){if(!e)return e;const t=n(e);if(e!==t&&t){const e=t.split("."),n=e.length>=2&&e.pop();["bat","exe","cmd","com","lnk","pif","scr","vb","vbe","vbs","wsh","js","ps1","hta","sh","csh","msi","app","scpt","applescript","reg","vbe","wsf","sct"].includes(n)&&__LOG__(2,!0)`cleanIncomingFilename:extension: ${n||""}`}return t}},756406:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=function(){return!!I.canPlayOgg},t.decodeWebpToRGBANoOpaque=F,t.fetchMedia=function(){return Z.apply(this,arguments)},t.gatherAndSetMetadata=function(){return ee.apply(this,arguments)},t.gatherAndSetMetadataNoOpaque=function(){return te.apply(this,arguments)},t.getImageWidthHeight=function(e){return X(function(){var t=(0,a.default)((function*(t){t(e);const n=new Image;return yield new Promise(((t,r)=>{n.onload=t,n.onabort=()=>{r(new Error("getImageWidthHeight onabort"))},n.onerror=()=>{r(new Error("getImageWidthHeight onerror"))},n.src=e.url()})),{width:n.naturalWidth,height:n.naturalHeight}}));return function(){return t.apply(this,arguments)}}())},t.getImageWidthHeightNoOpaque=x,t.getRawDocumentMimetype=q,t.getResizedThumbData=function(e,t){return new Promise((n=>{const r=new Image;r.setAttribute("crossorigin","anonymous"),r.onload=()=>{const e=t.map((e=>{let{width:t,height:n,minWidth:i,minHeight:a,imageFormat:o,imageFormatOptions:s,keepAspectRatio:l}=e;if(null!=i&&r.width<i||null!=a&&r.height<a)return null;const c=document.createElement("canvas"),u=c.getContext("2d");let d,p,f=0,_=0;if(r.height>r.width){d=t,p=r.height/r.width*t,_=-(p-n)/2}else{p=n,d=r.width/r.height*n,f=-(d-t)/2}return l?(c.width=d,c.height=p):(c.width=t,c.height=n),u.drawImage(r,f,_,d,p),{dataUrl:c.toDataURL(o,s).replace("data:image/jpeg;base64,",""),width:c.width,height:c.height}}));n(e)},r.src=e}))},t.opaqueDataToArrayBuffer=function(e){return X((t=>{t(e);const n=e.getBlob();if(n)return B(n);const r=(0,l.default)(e.getBase64(),"b64 should be defined");return(0,o.decodeB64)(r)}))},t.parseWebpNoOpaque=Y,t.processRawAudioVideo=function(){return z.apply(this,arguments)},t.processRawDocument=function(){return Q.apply(this,arguments)},t.processRawImage=function(){return V.apply(this,arguments)},t.processRawSticker=function(){return $.apply(this,arguments)},t.shouldUseLruMediaStore=function(e){const t=e===N.MEDIA_TYPES.STICKER||e===N.MEDIA_TYPES.IMAGE,n=e===N.MEDIA_TYPES.AUDIO||e===N.MEDIA_TYPES.DOCUMENT||e===N.MEDIA_TYPES.GIF||e===N.MEDIA_TYPES.PPIC||e===N.MEDIA_TYPES.PRODUCT||e===N.MEDIA_TYPES.PTT||e===N.MEDIA_TYPES.VIDEO||e===N.MEDIA_TYPES.TEMPLATE||e===N.MEDIA_TYPES.THUMBNAIL_DOCUMENT||e===N.MEDIA_TYPES.THUMBNAIL_IMAGE||e===N.MEDIA_TYPES.THUMBNAIL_LINK||e===N.MEDIA_TYPES.THUMBNAIL_VIDEO;return(t||n)&&T.userPreferencesStoreBase.getRememberMe()},t.shouldUseMediaCache=function(e){return e===N.MEDIA_TYPES.STICKER||e===N.MEDIA_TYPES.IMAGE||e===N.MEDIA_TYPES.PRODUCT||e===N.MEDIA_TYPES.PTT||e===N.MEDIA_TYPES.AUDIO},t.videoWidthHeightDuration=function(e){return X((t=>(t(e),I.videoWidthHeightDuration(e.forceToBlob()))))},t.videoWidthHeightDurationNoOpaque=W;var i=r(n(81109)),a=r(n(348926)),o=n(615688),s=n(450796),l=r(n(145095)),c=n(418412),u=n(367602),d=n(585582),p=r(n(364369)),f=r(n(824789)),_=G(n(748011)),h=n(431645),g=n(565885),m=G(n(551428)),y=G(n(435232)),S=n(408139),E=r(n(318254)),v=r(n(376139)),T=n(646239),C=n(893778),A=n(149520),b=r(n(511854)),P=n(199140),O=r(n(534949)),M=n(421921),I=G(n(216737)),w=n(58668),R=n(843257),N=n(661596),L=r(n(11339)),D=n(964551),k=r(n(397769));function U(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(U=function(e){return e?n:t})(e)}function G(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=U(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function x(e){return new Promise(((t,n)=>{const r=new Image,i=window.URL.createObjectURL(e);r.onload=()=>{const e={width:r.naturalWidth,height:r.naturalHeight};window.URL.revokeObjectURL(i),t(e)},r.onabort=()=>{window.URL.revokeObjectURL(i),n(new Error("getImageWidthHeight onabort"))},r.onerror=()=>{window.URL.revokeObjectURL(i),n(new Error("getImageWidthHeight onerror"))},r.src=i}))}function B(e){return(0,g.blobToArrayBuffer)(e).catch((e=>{throw __LOG__(3)`MediaUtils error: ${e}`,e}))}function F(){return j.apply(this,arguments)}function j(){return(j=(0,a.default)((function*(e){const t=yield B(e);return(0,f.default)(t)}))).apply(this,arguments)}function Y(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e){const t=yield B(e);return(0,A.parseWebp)(t)}))).apply(this,arguments)}function W(e){return I.videoWidthHeightDuration(e)}function H(e,t){return X(function(){var n=(0,a.default)((function*(n){n(e);const r=yield I.transcode(e.forceToBlob(),t).then((e=>O.default.createFromData(e,e.type)));return n(r),r.autorelease(),r}));return function(){return n.apply(this,arguments)}}())}function V(){return(V=(0,a.default)((function*(e,t){const{transparency:n,minDimension:r}=null!=t?t:{},i=e.forceToBlob(),{width:a,height:o,images:s}=yield m.rotateAndResize(i,D.ServerProps.imageMaxEdge,m.BLOB|m.CANVAS,{transparency:n,minDimension:r}),{images:l}=yield m.rotateAndResize(s.canvas,p.default.IMG_THUMB_MAX_EDGE,m.DATA_URL|m.CANVAS),c=(0,d.getResizedDataUrl)(l.canvas,"image/jpeg",2e4),u=c?v.default.parseDataURL(c).data:null;return u||__LOG__(2)`processRawImage: Failed to reach max thumbnail size, preview will be null`,{type:w.OUTWARD_TYPES.IMAGE,mediaBlob:s.blob,mimetype:s.blob.type,fullWidth:a,fullHeight:o,preview:u}}))).apply(this,arguments)}function $(){return($=(0,a.default)((function*(e){const t=e.forceToBlob(),{width:n,height:r,images:i}=yield m.rotateAndResize(t,D.ServerProps.imageMaxEdge,m.BLOB,{transparency:!0}),a=yield m.toWebpSticker(i.blob),o=yield O.default.createFromData(a,a.type);return{type:w.OUTWARD_TYPES.STICKER,mediaBlob:o,mimetype:a.type,fullWidth:n,fullHeight:r}}))).apply(this,arguments)}function z(){return(z=(0,a.default)((function*(e,t,n,r,a){var o;const s=e.forceToBlob(),l=new L.default.VideoTranscoder({sourceHeight:null==n?void 0:n.fullHeight,sourceWidth:null==n?void 0:n.fullWidth,sourceDuration:null==n?void 0:n.duration,sourceFileSize:e.size(),sourceFormat:!0===r?L.default.VIDEO_TRANSCODER_SOURCE_FORMAT_TYPE.GIF:L.default.VIDEO_TRANSCODER_SOURCE_FORMAT_TYPE.VIDEO});l.startTranscoderT();const c=yield(0,M.checkAndRepair)(s,!!r);if(l.markTranscoderT(),!c)throw l.set({transcoderResult:L.default.VIDEO_TRANSCODER_RESULT_TYPE.FAILED}),l.commit(),__LOG__(3)`processRawAudioVideo bad video file ${s.type}`,new y.InvalidMediaFileType;const u=c.type,d=c.file;l.set({targetFileSize:d.size});const f=!0===r||!0===c.isGif;switch((0,g.typeFromMimetype)(u)){case g.FILETYPE.VIDEO:if(t)throw l.set({transcoderResult:L.default.VIDEO_TRANSCODER_RESULT_TYPE.FAILED}),l.commit(),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: ptt became video"),new y.InvalidMediaFileType;l.set({targetFormat:L.default.VIDEO_TRANSCODER_TARGET_FORMAT_TYPE.VIDEO,transcoderResult:L.default.VIDEO_TRANSCODER_RESULT_TYPE.SUCCEEDED});const e={type:w.OUTWARD_TYPES.VIDEO,mediaBlob:d,mimetype:u,isGif:f,gifAttribution:f?a||0:void 0};if(n&&null!=n.duration&&null!=n.fullHeight&&0!==n.fullHeight&&null!=n.fullWidth&&0!==n.fullWidth&&n.preview){const{duration:t}=n;return l.set({sourceHeight:n.fullHeight,sourceWidth:n.fullWidth,sourceDuration:t}),l.commit(),(0,i.default)((0,i.default)({},e),{},{fullWidth:n.fullWidth,fullHeight:n.fullHeight,preview:n.preview,duration:t.toString()})}const{duration:r,thumbs:[s,c]}=yield m.generateVideoThumbsAndDuration({file:d,maxDimensions:[p.default.IMG_THUMB_MAX_EDGE,p.default.VIDEO_THUMB_MAX_EDGE],debugHint:"processRawAudioVideo"}),_=yield O.default.createFromBase64Jpeg(v.default.parseDataURL(c.url).data);return l.set({sourceHeight:s.fullHeight,sourceWidth:s.fullWidth,sourceDuration:r}),l.commit(),(0,i.default)((0,i.default)({},e),{},{fullWidth:s.fullWidth,fullHeight:s.fullHeight,preview:v.default.parseDataURL(s.url).data,fullPreviewData:_,duration:r.toString()});case g.FILETYPE.AUDIO:const h=null!==(o=null==n?void 0:n.duration)&&void 0!==o?o:yield(0,g.getAudioDuration)(d);return{type:t?w.OUTWARD_TYPES.PTT:w.OUTWARD_TYPES.AUDIO,mediaBlob:d,mimetype:u,duration:h.toString(),waveform:null==n?void 0:n.waveform};default:throw l.set({transcoderResult:L.default.VIDEO_TRANSCODER_RESULT_TYPE.FAILED}),l.commit(),__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: audio/video became other"),new Error(`audio/video became ${u}`)}}))).apply(this,arguments)}function q(){return J.apply(this,arguments)}function J(){return(J=(0,a.default)((function*(e,t){const n=e.type;if(n){if("*"===R.DOC_MIMES||R.DOC_MIMES.includes(n))return n;throw new y.InvalidMediaFileType(`disallowed mimetype ${n}`)}{const n=Math.min(R.MIMETYPE_DETERMINING_LENGTH,e.size),i=yield B(e.slice(0,n)),a=new Uint8Array(i);var r;if((0,R.isMsCompoundFileBinaryFormat)(a.subarray(0,8)))return null!=t&&null!==(r=(0,g.getMimeTypeForFilepath)(t))&&void 0!==r?r:R.MSCFB_MIME;const o=(0,k.default)(a);if(null==o?void 0:o.mime){const e=(0,R.isAllowedDocumentMimetype)(o.mime,t,!0);if(e)return e}else if(t){const e=(0,g.getMimeTypeForFilepath)(t);if(e)return e}throw new y.InvalidMediaFileType(`type: ${String(e.type)} name: ${String(t)}`)}}))).apply(this,arguments)}function Q(){return(Q=(0,a.default)((function*(e,t,n,r){var i,a;const o=e.forceToBlob(),s=(0,P.cleanFilename)(o.name||t||null),l=yield q(o,s),c=n?(0,g.blobToText)(o):null,[u,d]=yield Promise.all([_.enrich(o,l),c]),p=null!==(i=null==u||null===(a=u.microThumbnail)||void 0===a?void 0:a.dataUrl)&&void 0!==i?i:null==u?void 0:u.thumbUrl,f=p?v.default.parseDataURL(p).data:null;return{type:w.OUTWARD_TYPES.DOCUMENT,mediaBlob:yield O.default.createFromData(o,l),mimetype:l,filename:s||void 0,documentPreview:u,preview:f,fullPreviewData:null==u?void 0:u.fullPreviewData,fullPreviewSize:u?{width:u.width,height:u.height}:null,pageCount:null!=r?r:null==u?void 0:u.pdfPages,isVcardOverMmsDocument:n,parsedVcards:d?(0,C.parseMultiVcard)(d):null}}))).apply(this,arguments)}function X(e){const t=[];return(0,c.promiseCallSync)(e,null,(function(e){e.retain(),t.push(e)})).finally((()=>{for(let e=0;e<t.length;e++)t[e].autorelease()}))}function Z(){return(Z=(0,a.default)((function*(e){const t=yield(0,E.default)(e,"GET",null,b.default.RESP_TYPE.ARRAY_BUFFER);return t?Promise.resolve({result:t.response,status:t.status}):Promise.resolve(null)}))).apply(this,arguments)}function ee(){return(ee=(0,a.default)((function*(e,t){let n,r;t.retain();try{switch(e.type){case w.TYPE.VIDEO:const i=t.forceToBlob(),{thumbs:[a],duration:o}=yield m.generateVideoThumbsAndDuration({file:i,maxDimensions:[p.default.VIDEO_THUMB_MAX_EDGE],debugHint:"gatherAndSetMetadata"});let s;(0,S.isHighQualityVideoThumbnailsEnabled)()&&(s=yield O.default.createFromBase64Jpeg(v.default.parseDataURL(a.url).data)),n={mediaBlob:t,renderableUrl:t.url(),fullWidth:a.fullWidth,fullHeight:a.fullHeight,duration:void 0!==o?`${Math.ceil(o)}`:void 0,durationFloat:o,fullPreviewData:s};break;case w.TYPE.AUDIO:const l=yield H(t);l.retain(),n={mediaBlob:l,renderableUrl:l.url()},r=()=>l.autorelease();break;default:e.type!==w.TYPE.IMAGE&&e.type!==w.TYPE.STICKER||(__LOG__(4,void 0,new Error,!0)`object type: ${e.type||""}`,SEND_LOGS("Entering gatherAndSetMetadata (with OpaqueData) unexpectedly")),n={mediaBlob:t,renderableUrl:t.url()}}e.consolidate(n)}catch(n){if(!(n instanceof y.MediaUnsupportedError))throw n;e.consolidate({mediaBlob:t,renderableUrl:t.url()})}finally{t.autorelease(),null!=r&&r()}}))).apply(this,arguments)}function te(){return(te=(0,a.default)((function*(e,t){const n=yield Promise.resolve().then((()=>{switch(e.type){case w.TYPE.VIDEO:return W(t).then((e=>({fullWidth:e.width,fullHeight:e.height,duration:void 0!==e.duration?`${Math.ceil(e.duration)}`:void 0,durationFloat:e.duration})));case w.TYPE.IMAGE:return null!=e.contentInfo.fullHeight&&null!=e.contentInfo.fullWidth&&e.size===t.size?null:x(t).then((e=>({fullWidth:e.width,fullHeight:e.height,size:t.size})));case w.TYPE.STICKER:return(0,h.detectWebpSupport)().then((e=>e?(0,u.promiseProps)({widthHeight:x(t),webpData:Y(t)}).then((e=>({fullWidth:e.widthHeight.width,fullHeight:e.widthHeight.height,animationDuration:e.webpData.animationDuration,firstFrameLength:e.webpData.firstFrameLength,singleLoopDuration:e.webpData.singleLoopDuration,emojis:e.webpData.emojis,isAnimated:e.webpData.animationDuration>0,size:t.size,isFirstParty:e.webpData.isFirstParty,isFromStickerMaker:e.webpData.isFromStickerMaker,stickerPackId:e.webpData.stickerPackId,stickerPackName:e.webpData.stickerPackName,stickerPackPublisher:e.webpData.stickerPackPublisher}))):Y(t).then(function(){var e=(0,a.default)((function*(e){let{animationDuration:n,firstFrameLength:r,singleLoopDuration:i,emojis:a,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:u}=e;if(n>0)return{animationDuration:n,firstFrameLength:r,singleLoopDuration:i,emojis:a,isAnimated:!0,size:t.size,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:u};const d=yield F(t);return{animationDuration:n,rgbaBuffer:d.rgbaBuffer,rgbaWidth:d.width,rgbaHeight:d.height,emojis:a,isAnimated:!1,size:t.size,isFirstParty:o,isFromStickerMaker:s,stickerPackId:l,stickerPackName:c,stickerPackPublisher:u}}));return function(){return e.apply(this,arguments)}}())));case w.TYPE.AUDIO:default:return{}}})).catch((0,s.filteredCatch)(y.MediaUnsupportedError,(t=>{throw e.consolidate({}),t})));null!=n&&e.consolidate(n)}))).apply(this,arguments)}},534949:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(615688),a=r(n(145095)),o=n(657319),s=n(565885);let l=[];const c=new o.ShiftTimer((function(){const e=l;l=[];for(let t=0;t<e.length;t++){const n=e[t];n._inAutoreleasePool=!1,0!==n._retainCount||n.released||(n.released=!0,n._releaseImpl())}}));class u{constructor(){this._retainCount=1,this._inAutoreleasePool=!1,this.released=!1,this._b64=void 0,this._blob=void 0,this._url=void 0,this._mimetype=void 0,this._released=void 0}retain(){if(this.released)throw __LOG__(3)`OpaqueData:retain called on released OpaqueData`,new Error("OpaqueData:retain called on released OpaqueData");this._retainCount++}autorelease(){this.released?__LOG__(3)`OpaqueData:autorelease called on released object`:0===this._retainCount?__LOG__(3)`OpaqueData:autorelease too many release calls`:1===this._retainCount?(this._retainCount=0,this._inAutoreleasePool||(this._inAutoreleasePool=!0,l.push(this),c.onOrBefore(1e3))):this._retainCount--}autoreleaseWhenPromiseCompletes(e){const t=()=>{this.autorelease()};e.then(t,t)}throwIfReleased(e){if(this.released)throw __LOG__(4,void 0,new Error)`${e} called on released OpaqueData`,new Error(`${e} called on released OpaqueData`);0===this._retainCount&&__LOG__(4,void 0,new Error)`${e} called on unretained OpaqueData`}url(){return this.throwIfReleased("OpaqueData:url"),null!=this._url&&""!==this._url?this._url:null!=this._b64&&""!==this._b64?(this._url=`data:image/jpeg;base64,${this._b64}`,this._url):(this._url=window.URL.createObjectURL((0,a.default)(this._blob,"this._blob")),this._url)}getBlob(){return this._blob}getBase64(){return this._b64}validate(){return!0===this._released?Promise.resolve(!1):this._blob?(0,s.validateBlob)(this._blob):Promise.resolve(!0)}size(){return this.throwIfReleased("OpaqueData:size"),this._blob?this._blob.size:null!=this._b64?(0,i.sizeWhenB64Decoded)(this._b64):(__LOG__(4,void 0,new Error,!0)`OpaqueData:size returned 0`,SEND_LOGS("opaque-data-size-0"),0)}formData(){return this.throwIfReleased("OpaqueData:formData"),this.forceToBlob()}type(){return this.throwIfReleased("OpaqueData:type"),null!=this._mimetype&&""!==this._mimetype?this._mimetype:"undefined"}forceToBlob(){this.throwIfReleased("OpaqueData:forceToBlob");const e=this._blob;if(e)return e;const t=this._b64;if(null!=t&&""!==t){this._b64=void 0,this._url=void 0;const e=this._mimetype;return this._blob=new Blob([(0,i.decodeB64)(t)],null!=e&&""!==e?{type:e}:void 0)}throw new Error("OpaqueData:forceToBlob no b64 or blob")}_releaseImpl(){this._mimetype=void 0;this._blob?(this._blob=void 0,null!=this._url&&""!==this._url&&(window.URL.revokeObjectURL(this._url),this._url=void 0)):(this._b64=void 0,this._url=void 0)}isBlobEqual(e){return e?this._blob===e._blob:!this._blob}}t.default=u,u.createFromBase64Jpeg=e=>new Promise((t=>{const n=new u;return n._b64=e,n._mimetype="image/jpeg",t(n)})),u.createFromData=(e,t)=>new Promise((n=>{const r=new u;return r._blob=e instanceof Blob&&e.type===t?e:new Blob([e],{type:t}),r._mimetype=t,n(r)}))},961516:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var a=i(n(348926)),o=n(389385),s=n(615688),l=i(n(145095)),c=n(115461),u=i(n(434475)),d=i(n(534949)),p=i(n(992360)),f=n(661596),_=n(826384);function h(){return(h=(0,a.default)((function*(e){const{msg:t,isPreload:n,signal:i}=e,{thumbnailSha256:a,thumbnailEncSha256:h,thumbnailDirectPath:g,mediaKey:m,mediaKeyTimestamp:y}=t;if(null==g||null==h||null==a||null==m||null==y)return;if(!(t.type!==c.MSG_TYPE.DOCUMENT&&t.type!==c.MSG_TYPE.INTERACTIVE||(0,f.getMsgMediaType)(t)!==f.MEDIA_TYPES.DOCUMENT||null!=t.thumbnailHeight&&null!=t.thumbnailWidth))return;const S=t.asUrl;if(!S||null!=S.thumbnailHeight&&null!=S.thumbnailWidth){__LOG__(2)`media.downloadMmsThumbnail: start`;try{const e=yield _.downloadManager.downloadAndDecrypt({directPath:g,encFilehash:h,filehash:a,mediaKey:m,mediaKeyTimestamp:y,type:(0,p.default)(t),signal:i||(new r).signal,userDownloadAttemptCount:0,isPreload:n});if(S)S.thumbnailHQ=(0,s.encodeB64)(e);else{const n=(0,l.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),r={fullPreviewData:yield d.default.createFromData(e,"image/jpeg")};t.type===c.MSG_TYPE.DOCUMENT&&(r.fullPreviewSize={height:(0,l.default)(t.thumbnailHeight,"msg.thumbnailHeight"),width:(0,l.default)(t.thumbnailWidth,"msg.thumbnailWidth")}),n.consolidate(r)}__LOG__(2)`media.downloadMmsThumbnail: success`}catch(e){if(e.name===o.ABORT_ERROR)return void __LOG__(2)`media.downloadMmsThumbnail aborted`;__LOG__(3,!0)`media.downloadMmsThumbnail: error\n${(0,u.default)(e)}`}}}))).apply(this,arguments)}},597841:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e===a.MEDIA_TYPES.DOCUMENT&&(0,i.isMDBackend)()&&!0===(0,r.getABPropConfigValue)("web_abprop_remove_uploaded_files")};var r=n(257243),i=n(88555),a=n(661596)},992360:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.type){case r.MSG_TYPE.DOCUMENT:return i.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case r.MSG_TYPE.VIDEO:return i.MEDIA_TYPES.THUMBNAIL_VIDEO;case r.MSG_TYPE.IMAGE:return i.MEDIA_TYPES.THUMBNAIL_IMAGE;case r.MSG_TYPE.CHAT:return i.MEDIA_TYPES.THUMBNAIL_LINK;case r.MSG_TYPE.INTERACTIVE:{const{interactiveHeader:t}=e;if(null!=(null==t?void 0:t.mediaType))switch(t.mediaType){case a.InteractiveMessageHeaderMediaType.DOCUMENT:return i.MEDIA_TYPES.THUMBNAIL_DOCUMENT;case a.InteractiveMessageHeaderMediaType.VIDEO:return i.MEDIA_TYPES.THUMBNAIL_VIDEO}break}}throw new Error("getThumbnailTypeForMsg: Unsupported msg type")};var r=n(115461),i=n(661596),a=n(534535)},846220:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e?(0,a.unproxy)(e).isGroup?i.default.UPLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL:i.default.UPLOAD_ORIGIN_TYPE.UNKNOWN};var i=r(n(11339)),a=n(118146)},284866:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBlobCacheImpl=t.MediaBlobCache=void 0;var i=r(n(823493)),a=n(142430),o=n(988297),s=n(58668);class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25e7;if(this._filehashesToCleanUp=new Set,this.getOrCreateURL=e=>{if(this._filehashToUrl[e])return this.touch(e),this._filehashToUrl[e];const t=this.get(e);if(!t)throw new Error(`There is no blob matching filehash: ${e}.`);const n=window.URL.createObjectURL(t);return this._filehashToUrl[e]=n,n},this.revokeURL=(e,t)=>{if(t){if(this._filehashToUrl[e]!==t)throw new Error("The url provided does not match the filehash.");delete this._filehashToUrl[e],window.URL.revokeObjectURL(t)}},this._scheduleCleanup=(0,i.default)((()=>{this._filehashesToCleanUp.forEach((e=>{window.URL.revokeObjectURL(this._filehashToUrl[e]),delete this._filehashToUrl[e]})),this._filehashesToCleanUp.clear()}),0,{leading:!1}),null!=e&&e<0)throw new Error("Size limit cannot be a negative number.");this._usageCounts={},this._filehashToUrl={},this._lruCache=new a.LruCache({sizeLimit:e,getSize:e=>e.size,onEvict:e=>{this._filehashToUrl[e]&&0===this._getUsageCount(e)&&(this.revokeURL(e,this._filehashToUrl[e]),(0,o.getOrCreateMediaObject)(e).consolidate({downloadStage:s.DOWNLOAD_STAGE.INIT,progressiveStage:null}))},shouldEvict:e=>0===this._getUsageCount(e)})}get(e){return this._lruCache.get(e)}has(e){return this._lruCache.has(e)}touch(e){this.get(e)}put(e,t){this._lruCache.put(e,t)}clear(){this._scheduleCleanup.flush(),this._usageCounts={},Object.keys(this._filehashToUrl).forEach((e=>{this._filehashToUrl[e]&&this.revokeURL(e,this._filehashToUrl[e])})),this._filehashToUrl={},this._lruCache.clear()}increaseUsageCount(e){this._usageCounts[e]=this._getUsageCount(e)+1,this._filehashesToCleanUp.delete(e)}decreaseUsageCount(e){const t=this._getUsageCount(e);if(t<=0)throw new Error("Cannot decrease the usageCount to a negative number.");this._usageCounts[e]=t-1,0===this._usageCounts[e]&&(delete this._usageCounts[e],this._filehashesToCleanUp.add(e),this._scheduleCleanup())}_getUsageCount(e){return this._usageCounts[e]||0}}t.MediaBlobCacheImpl=l;const c=new l;t.MediaBlobCache=c},245554:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaKeyCache=void 0,t.shouldUseMediaKeyCache=function(){return(0,i.isMDBackend)()};var r=n(142430),i=n(88555);const a={sizeLimit:10,getSize:()=>1};const o=new r.LruCache(a);t.MediaKeyCache=o},345987:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cleanJPEG=function(e){const t=new r.Binary(e),n=new r.Binary(e),j=new r.Binary;let Y,K=!1,W=!1,H=!1,V=!1;const $={version:257,densityUnits:0,xDensity:1,yDensity:1};if(255!==t.readUint8()||t.readUint8()!==y)throw new Error("SOI marker not at the start of the file.");n.advance(2);let z;for(;null!=z||t.size();){if(void 0===z){const e=t.readUint8();if(255!==e)throw new Error(`0x${e.toString(16)} is not a marker prefix.`);z=t.readUint8()}switch(z){case C:if(W)Y=t.readUint16(),n.advance(Y+2),t.advance(t.size()-n.size());else{if(Y=t.readUint16(),"JFIF\0"!==t.readString(5))throw new Error("APP0 marker missing 'JFIF' magic bytes.");V=!0,$.version=t.readUint16(),$.densityUnits=t.readUint8(),$.xDensity=t.readUint16(),$.yDensity=t.readUint16(),n.advance(Y+2),t.advance(t.size()-n.size()),W=!0}break;case E:if(!H&&!V)throw new Error("Missing magic bytes marker.");let e,r;t.advance(t.readUint16()-2);let y=t.readUint8();for(;t.size();){if(r=t.readUint8(),e=255===y&&!F.includes(r),e){z=r;break}y=r}j.writeByteArray(n.readByteArray(n.size()-t.size()-2));continue;case A:if(Y=t.readUint16(),!H&&"Exif\0\0"!==t.readString(6))throw new Error("APP1 marker missing 'EXIF' magic bytes.");H=!0,n.advance(Y+2),t.advance(t.size()-n.size());break;case U:case B:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=t.readUint16(),n.advance(Y+2),t.advance(t.size()-n.size());break;case S:if(!H&&!V)throw new Error("Missing magic bytes marker.");K=!0,j.writeByteArray(n.readByteArray(2));break;case i:case a:case o:case s:case c:case u:case d:case p:case f:case _:case h:case g:case m:case v:case l:case T:if(!H&&!V)throw new Error("Missing magic bytes marker.");Y=t.readUint16(),j.writeByteArray(n.readByteArray(2+Y)),t.advance(t.size()-n.size());break;case b:case P:case O:case M:case I:case w:case R:case N:case L:case D:case k:case G:case x:throw new Error(`Received unexpected APP marker 0x${z.toString(16)}`);default:throw new Error(`Did not understand marker: 0x${z.toString(16)}`)}if(z=void 0,K)break}if(!K)throw new Error("No EOI tag found.");const q=function(e){const t=new r.Binary;return t.writeBytes(255,216,255,224,0,16,74,70,73,70,0),t.writeUint16(e.version),t.writeUint8(e.densityUnits),t.writeUint16(e.xDensity),t.writeUint16(e.yDensity),t.writeBytes(0,0),t.readByteArray()}($);return new Blob([q,j.readByteArray()],{type:"image/jpeg"})};var r=n(108584);const i=192,a=193,o=194,s=195,l=196,c=197,u=198,d=199,p=201,f=202,_=203,h=205,g=206,m=207,y=216,S=217,E=218,v=219,T=221,C=224,A=225,b=226,P=227,O=228,M=229,I=230,w=231,R=232,N=233,L=234,D=235,k=236,U=237,G=238,x=239,B=254,F=[0,208,209,210,211,212,213,214,215]},684979:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(37338));const a={ignoreSearch:!0,ignoreMethod:!0,ignoreVary:!0};class o extends i.default{constructor(e){super(e,s,l,{encodeKey:c,matchOptions:a})}}function s(e){return new Response(e)}function l(e){return e.arrayBuffer()}function c(e,t){const n=encodeURIComponent(e);return`https://_media_cache_v2_.whatsapp.com/${encodeURIComponent(t)}_${n}`}t.default=o},148520:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(413684)),o=r(n(291481)),s=n(429830),l=n(703971);class c extends a.default{constructor(){super(),this._store=new o.default(s.initialize,l.IdbArrayBufferTable)}doGet(e){var t=this;return(0,i.default)((function*(){const n=yield t._store.get(e);return n?n.data:null}))()}doQueryByIndex(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doGetAll(){throw new Error("Not implemented. Actual Arraybuffer store does not need it.")}doPut(e,t){var n=this;return(0,i.default)((function*(){return(yield n._store.put(e,{id:e,data:t})).data}))()}doDel(e){return this._store.del(e)}doCount(){return this._store.count()}clear(){return this._store.clear()}doOpen(){return Promise.resolve()}doClose(){return Promise.resolve()}}t.default=c},625289:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(413684));class a extends i.default{get(){return Promise.resolve()}queryByIndex(){return Promise.resolve([])}getAll(){return Promise.resolve([])}put(e,t){return Promise.resolve(t)}del(){return Promise.resolve()}count(){return Promise.resolve(0)}clear(){return Promise.resolve()}}t.default=a},555975:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaStore=t.LruMediaStore=void 0;var i=r(n(348926)),a=r(n(751463)),o=n(257243),s=n(88555),l=r(n(226945)),c=n(435232),u=r(n(434475)),d=r(n(684979)),p=r(n(148520)),f=r(n(625289)),_=r(n(771058));class h{constructor(){this._getBackingStore=(0,a.default)((0,i.default)((function*(){try{const e=function(){const e=function(){if(null!=l.default&&"caches"in self)return new d.default("lru-media-array-buffer-cache");return null!=l.default?new p.default("media_lru_buffer"):null}();return null==e?null:new _.default({maxSize:(0,s.isMDBackend)()&&(0,o.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")?void 0:Number.MAX_SAFE_INTEGER,arrayBufferStore:e})}();if(null!=e)return yield e.open(),e}catch(e){if("SecurityError"===e.name)__LOG__(3)`There was a security error attempting to open the media storage. \
This likely indicates a permissions error. Falling back to dummy \
(no-op) storage.`;else{if(e instanceof c.DbOnLogoutAbort)throw e;__LOG__(4,!0,new Error,!0)`Failed to initialize media store! Falling back to dummy (no-op) storage. Error:
${(0,u.default)(e)}`,SEND_LOGS("Failed to initialize media store")}}return new f.default})))}get(e){var t=this;return(0,i.default)((function*(){return(yield t._getBackingStore()).get(e)}))()}queryByIndex(e,t){var n=this;return(0,i.default)((function*(){return(yield n._getBackingStore()).queryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).getAll()}))()}put(e,t){var n=this;return(0,i.default)((function*(){return(yield n._getBackingStore()).put(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){const n=yield t._getBackingStore();yield n.del(e)}))()}count(){var e=this;return(0,i.default)((function*(){return(yield e._getBackingStore()).count()}))()}clear(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.clear()}))()}open(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.open()}))()}close(){var e=this;return(0,i.default)((function*(){const t=yield e._getBackingStore();yield t.close()}))()}}t.MediaStore=h;const g=new h;t.LruMediaStore=g},771058:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(927870),s=n(257243),l=r(n(413684)),c=n(88555),u=r(n(537804)),d=r(n(963236)),p=r(n(986128));class f extends l.default{constructor(e){var t;super(),t=this,this._queueMap=new o.PromiseQueueMap,this._isInitialized=!1,this.updateMaxSizeInterval=null,this._dispose=e=>this._bufferStore.del(e),this.doPut=(e,n)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(n.byteLength>t.getMaxSize())return n;if(n.byteLength>3e7)return n;const r={id:e,timestamp:(new Date).getTime(),size:n.byteLength};try{return(0,c.isMDBackend)()&&(0,s.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")&&(yield t._updateMaxSize()),yield t._metaInfoStore.putObject(r),t._bufferStore.put(e,n)}catch(e){if(e instanceof p.default.AbortError&&e.message.includes("QuotaExceededError"))return __LOG__(2)`LruMediaStore: encounter QuotaExceededError, thus shrink the size of LruMediaStore`,void t.setMaxSize((0,a.default)(t.getCurrentSize(),"_this.getCurrentSize()")/2);throw e}}))),this.doDel=e=>this._isInitialized?this._queueMap.enqueue(e,(()=>this._metaInfoStore.del(e))):Promise.resolve(),this._updateMaxSize=function(){var e=(0,i.default)((function*(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=yield(0,d.default)();if(null==n)return void t._clearStoreForThisSession();const r=t.getCurrentSize();if(null==r)return;const i=n.available,a=t._calculateTargetedBufferSize(n.quota);if(i>a)return void(e&&t.setMaxSize(i));const o=(0,c.isMDBackend)()&&(0,s.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")?2:1,l=a*o-i;r<l?t._clearStoreForThisSession():t.setMaxSize(r-l)}));return function(){return e.apply(this,arguments)}}();const{maxSize:n,arrayBufferStore:r}=e;this._bufferStore=r,this._isInitialized=null!=n,this._metaInfoStore=new u.default(null!=n?n:0,this._dispose),this.updateMaxSizeInterval=setInterval(this._updateMaxSize,6e4)}doGet(e){var t=this;return(0,i.default)((function*(){const n=yield t._bufferStore.get(e);return null!=n&&t.put(e,n),n}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._bufferStore.clear(),e._metaInfoStore.clear()}))()}doCount(){return this._metaInfoStore.count()}doOpen(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.open(),e._bufferStore.open()]),!e._isInitialized&&(0,c.isMDBackend)()&&(0,s.getABPropConfigValue)("web_lru_cache_purge_logic_refactor")&&(yield e._updateMaxSize(!0),e._isInitialized=!0)}))()}doClose(){var e=this;return(0,i.default)((function*(){yield Promise.all([e._metaInfoStore.close(),e._bufferStore.close()])}))()}getCurrentSize(){return this._metaInfoStore.getCurrentSize()}getMaxSize(){return this._metaInfoStore.getMaxSize()}setMaxSize(e){return this._metaInfoStore.setMaxSize(e)}_calculateTargetedBufferSize(e){const t=Math.floor(.01*e);return t<1e8?1e8:t>5e8?5e8:t}_clearStoreForThisSession(){this.setMaxSize(0),this.updateMaxSizeInterval&&(clearInterval(this.updateMaxSizeInterval),this.updateMaxSizeInterval=null)}}t.default=f},537804:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(291481)),a=r(n(303459)),o=n(429830),s=n(209362);class l extends a.default{constructor(e,t){super(new i.default(o.initialize,s.IdbMetaInfoTable),{primaryIndex:s.metaInfoPrimaryIndex,dateIndex:s.metaInfoDateIndex,sizeIndex:s.metaInfoSizeIndex,maxSize:e,dispose:t})}}t.default=l},291481:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(413684));class o extends a.default{constructor(e,t){super(),this._initialize=e,this._table=t}doGet(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.get(e)}))()}doQueryByIndex(e,t){var n=this;return(0,i.default)((function*(){return yield n._initialize(),n._table.all({limit:t.limit,index:[e]})}))()}doGetAll(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.all()}))()}doPut(e,t){var n=this;return(0,i.default)((function*(){return yield n._initialize().then((()=>n._table.createOrReplace(t))),t}))()}doDel(e){var t=this;return(0,i.default)((function*(){return yield t._initialize(),t._table.remove(e)}))()}doCount(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.count()}))()}doClear(){var e=this;return(0,i.default)((function*(){return yield e._initialize(),e._table.clear(!0)}))()}doOpen(){return this._initialize()}doClose(){return Promise.resolve()}}t.default=o},303459:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(904352),s=n(927870),l=n(657319),c=n(257243),u=r(n(413684)),d=n(88555);class p extends u.default{constructor(e,t){var n;if(super(),n=this,this._queueMap=new s.PromiseQueueMap,this._purgeCount=0,this._optimizationEnabled=!1,this._purge=()=>{if(this._pendingPurgePromise)return this._pendingPurgePromise;const e=this.open().then((()=>(0,o.promiseLoop)(function(){var e=(0,i.default)((function*(e){const t=()=>{n._pendingPurgePromise=null,e()},r=n.getCurrentSize();if(null==r||r<=n._maxSize)return void t();const a=yield n.queryOneByIndex(n._dateIndex),o=n.getCurrentSize(),s=n._maxSize;if(null==o||o<=s)return void t();if(null==a)return(0,i.default)((function*(){const e=yield n.count();__LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: No row returned but currentSize (${o}) > maxSize (${s}). Row count is ${e} (may be out of date).`,SEND_LOGS("size-lru-store-invalid-empty")}))(),Promise.reject(new Error("Query returned no result but currentSize > maxSize"));const l=a[n._primaryIndex];return n.del(l)}));return function(){return e.apply(this,arguments)}}())));return this._pendingPurgePromise=e},this._purgeOptimized=(e,t)=>{this._purgeCount++;const r=Promise.resolve().then((0,i.default)((function*(){var r;const i=yield n._store.get(e),a=null==i?0:n._getSize(i),o=null!==(r=n.getCurrentSize())&&void 0!==r?r:0,s=n.getMaxSize(),l=o+(t-a);if(l<=s)return;const c=yield n.count(),u=yield n.doQueryByIndex(n._dateIndex,{limit:c}),d=[];let p=l;for(const t of u)if(t[n._primaryIndex]!==e&&(p-=n._getSize(t),d.push(t[n._primaryIndex]),p<=s))break;if(p>s)throw __LOG__(3,void 0,void 0,!0)`SizeLruObjectStore: _purge error: Adjusted size is too big even after removal of all items.`,SEND_LOGS("size-lru-store-invalid-empty"),new Error("Above max limit after purge");yield Promise.all(d.map((e=>n.del(e)))),0==--n._purgeCount&&(n._pendingPurgePromiseOptimized=null)})));return null!=this._pendingPurgePromiseOptimized?(this._pendingPurgePromiseOptimized=this._pendingPurgePromiseOptimized.finally((()=>r)),this._pendingPurgePromiseOptimized):(this._pendingPurgePromiseOptimized=r,r)},this._schedulePurge=()=>{this._purgeTimer.debounce(2e3)},this.doPut=(e,t)=>this._queueMap.enqueue(e,(0,i.default)((function*(){if(t[n._primaryIndex]!==e)throw new Error("The key you provide does not match.");const r=yield n._store.get(e),i=null==r?0:n._getSize(r),o=n._getSize(t);n._optimizationEnabled&&(yield n._purgeOptimized(e,o));const s=yield n._store.put(e,t);return n._currentSize=(0,a.default)(n.getCurrentSize(),"_this.getCurrentSize()")+(o-i),n._optimizationEnabled||n._schedulePurge(),s}))),this.doDel=e=>this._queueMap.enqueue(e,(0,i.default)((function*(){const t=yield n._store.get(e);if(null!=t){try{yield n._dispose(e,t)}catch(e){throw __LOG__(3,void 0,void 0,!0)`SizeLRUObjectStore: _dispose error: ${e.message}`,SEND_LOGS("size-lru-store-dispose-error"),e}yield n._store.del(e),n._currentSize=(0,a.default)(n.getCurrentSize(),"_this.getCurrentSize()")-n._getSize(t)}}))),this._store=e,this._primaryIndex=t.primaryIndex,this._dateIndex=t.dateIndex,this._sizeIndex=t.sizeIndex,t.maxSize<0)throw new Error("Cannot set max size to a negative number");this._maxSize=Math.floor(t.maxSize),this._dispose=t.dispose,this._purgeTimer=new l.ShiftTimer((()=>{this._purge().catch((e=>{__LOG__(3)`Error while purging: ${e.message}`}))})),this._optimizationEnabled=(0,d.isMDBackend)()&&(0,c.getABPropConfigValue)("web_lru_cache_optimization")}getCurrentSize(){return this._currentSize}getMaxSize(){return this._maxSize}setMaxSize(e){return e<0?Promise.reject(new Error("Cannot set size to a negative number")):(this._maxSize=Math.floor(e),this._purgeTimer.cancel(),this._purge().catch((e=>{__LOG__(3)`Error while purging during setMaxSize: ${e.message}`})))}putObject(e){const t=e[this._primaryIndex];return this.put(t,e)}_getSize(e){const t=e[this._sizeIndex];return"number"!=typeof t||t<0?(__LOG__(3)`Invalid size in index ${this._sizeIndex}: ${t}`,0):t}doGet(e){return this._store.get(e)}queryOneByIndex(e){var t=this;return(0,i.default)((function*(){const n=yield t._store.queryByIndex(e,{limit:1});return 0===n.length?null:n[0]}))()}doQueryByIndex(e,t){return this._store.queryByIndex(e,t)}doGetAll(){return this._store.getAll()}doClear(){var e=this;return(0,i.default)((function*(){e._purgeTimer.cancel(),yield e._store.clear(),e._currentSize=0}))()}doCount(){return this._store.count()}doOpen(){var e=this;return(0,i.default)((function*(){if(yield e._store.open(),null!=e._currentSize)return;const t=yield e._store.doGetAll();e._currentSize=t.reduce(((t,n)=>t+e._getSize(n)),0)}))()}doClose(){return this._currentSize=null,this._store.close()}}t.default=p},778986:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0});var i={MediaPrep:!0,checkExistence:!0,clearMediaForChat:!0,downloadMsg:!0,downloadProgressiveJpegThumbnail:!0,downloadStatusV3Thumbnail:!0,downloadVideoThumbnail:!0,forwardMediaMsg:!0,manuallySetMedia:!0,prepRawMedia:!0,resumeUploadMsg:!0};Object.defineProperty(t,"MediaPrep",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"checkExistence",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"clearMediaForChat",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"downloadMsg",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"downloadProgressiveJpegThumbnail",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"downloadStatusV3Thumbnail",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"downloadVideoThumbnail",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"forwardMediaMsg",{enumerable:!0,get:function(){return S.default}}),Object.defineProperty(t,"manuallySetMedia",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"prepRawMedia",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(t,"resumeUploadMsg",{enumerable:!0,get:function(){return T.default}});var a=n(474025);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}));var o=n(439287);Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))}));var s=n(879019);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))}));var l=n(496575);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(985046);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var u=n(304007);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var d=n(348086);Object.keys(d).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(i,e)||e in t&&t[e]===d[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}}))}));var p=r(n(494995)),f=r(n(716389)),_=r(n(348714)),h=r(n(193628)),g=r(n(742454)),m=r(n(165403)),y=r(n(611679)),S=r(n(637461)),E=r(n(779373)),v=r(n(740674)),T=r(n(123127))},421921:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.checkAndRepair=function(e,t){const n=new a.default.WebcMediaAnalyzed;let r=!1;return function(e){let t;return new Promise(((n,r)=>{__LOG__(2)`MediaAnalyzer:sendMessageToWorker`,t=o||new i.default,o=void 0,t.onmessage=e=>{try{e.data&&"log"===e.data.type?__LOG__(2)`(via Milan) ${e.data.msg}`:n(e.data)}catch(e){r(e)}},t.onerror=e=>{r(new Error(`Milan.onerror = ${(null==e?void 0:e.message)?e.message:e}`))},t.postMessage(e)})).finally((()=>{t&&(t.terminate(),o=new i.default)}))}({type:"prep",file:e,asGif:t}).then((e=>{let{type:t,result:n,error:i,filename:a,file:o}=e;switch(t){case"result":return __LOG__(2)`MediaAnalyzer:checkAndRepair approved file`,r=!!n,n;case"parsingError":return __LOG__(2)`trouble parsing file ${o} (fossil ${a}) ${String(i)}`,o&&(__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got parsing error! ${String(i)}`,SEND_LOGS("media-parsing-error")),void __LOG__(2)`MediaAnalyzer:checkAndRepair rejected file (${String(i)})`}})).catch((e=>{__LOG__(4,void 0,new Error,!0)`MediaAnalyzer:checkAndRepair got error! ${String(e)}`,SEND_LOGS("media-detection-error")})).finally((()=>{if(n){let t;if(e.name){const n=e.name.split(".");n.length>1&&(t=n[n.length-1])}n.set({webcMediaSupported:r,webcMediaExtensions:t}),n.markWebcMediaAnalyzeT(),n.commit()}}))};var i=r(n(991528)),a=r(n(11339));let o},474025:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelDownloadMedia=i,t.cancelDownloadMsg=function(e){e.mediaObject?i(e.mediaObject):e.mediaObject||(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelDownloadMsg msg without mediaObject"))};var r=n(209329);function i(e){(0,r.cancelDownloadMedia)(e)}},439287:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cancelUploadMedia=i,t.cancelUploadMsg=function(e){e.mediaObject?i(e.mediaObject):(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: cancelUploadMsg msg without mediaObject"))};var r=n(70996);function i(e){(0,r.cancelUploadMedia)(e)}},716389:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=n(209329),o=n(661596);function s(){return(s=(0,i.default)((function*(e){if(yield e.waitForPhoneUpload(),!e.mediaObject)return __LOG__(4,void 0,new Error,!0)`checkExistence msg without mediaObject, id: ${e.id.toString()} type: ${e.type}`,void SEND_LOGS("media-fault: checkExistence msg without mediaObject");yield(0,a.checkExistence)({mimetype:e.mimetype,mediaObject:e.mediaObject,mediaType:(0,o.getMsgMediaType)(e)})}))).apply(this,arguments)}},348714:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){r.clearMediaForChat(e)};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var r={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(988297));function i(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}},160953:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.consolidateMediaUpdate=function(e,t){if(e.isUnsentPhoneMsg()){e.mediaObject&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: consolidateMediaUpdate unsent message"));const t=_(e);if(t.hasOwnProperty("preview")){const n=t.preview;delete t.preview,n&&s.default.createFromBase64Jpeg(n).then((t=>{(null==e?void 0:e.mediaData)&&e.isUnsentPhoneMsg()&&(e.mediaData.preview=t)}))}e.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:e.phoneUploading?u.MEDIA_DATA_STAGE.REMOTE_UPLOADING:u.MEDIA_DATA_STAGE.REMOTE_NEED_UPLOAD}))}else h(e,e,t)},t.consolidateMediaUpdateWithValues=h;var i=r(n(81109)),a=n(115461),o=r(n(464328)),s=r(n(534949)),l=n(721009),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(988297)),u=n(58668),d=n(209329),p=n(661596);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}function _(e){const t={};return u.MAPPED_MSG_PROPS.forEach((n=>{const r=e[n],i=u.MSG_TO_MEDIA[n];t[i]=r})),t.type===a.MSG_TYPE.INTERACTIVE&&(t.type=(0,l.getInteractiveMsgMediaType)(e)),t}function h(e,t,n){const r=_(t);let i=e.mediaObject;const a=t.filehash;if(i)a&&a!==i.filehash&&(__LOG__(2)`media:msg ${e.id.toString()} ${i.filehash?"changed":"added"} filehash`,c.disassociateMediaFromMsg(i,e),i=c.getOrCreateMediaObject(a),e.mediaObject=i,c.associateMediaWithMsg(i,e));else{i=a?c.getOrCreateMediaObject(a):new l.MediaObject;const t=e.mediaData;void 0!==t.aspectRatio&&(r.aspectRatio=t.aspectRatio),e.mediaObject=i,c.associateMediaWithMsg(i,e)}let s=!1;const{deprecatedMms3Url:f,mediaKey:h,mediaKeyTimestamp:g,encFilehash:m,type:y,streamingSidecar:S,firstFrameSidecar:E,directPath:v,scansSidecar:T,scanLengths:C,staticUrl:A}=t;if(f||m){let e,n;try{e=(0,p.msgToMediaType)(t)}catch(t){e=~p.MEDIA_TYPE_VALUES.indexOf(y)?y:null}s=!i.entries.has({encFilehash:m,deprecatedMms3Url:f}),s?h&&e&&m?n=i.entries.addEntry({deprecatedMms3Url:f,mediaKey:h,mediaKeyTimestamp:g,encFilehash:m,type:e,sidecar:S,directPath:v,firstFrameSidecar:E,scansSidecar:T,scanLengths:C,debugHint:"consolidate",staticUrl:A}):s=!1:h&&(n=i.entries.updateEntry({deprecatedMms3Url:f,mediaKey:h,mediaKeyTimestamp:g,encFilehash:m,type:e,sidecar:S,directPath:v,firstFrameSidecar:E,scansSidecar:T,scanLengths:C,staticUrl:A})),n||(s=!1),s&&i.downloadStage===u.DOWNLOAD_STAGE.ERROR_MISSING&&(r.downloadStage=u.DOWNLOAD_STAGE.INIT)}if(i.consolidate(r)||i.notifyMsgsAsync(),s&&i.downloadStage===u.DOWNLOAD_STAGE.NEED_POKE){let r;try{r=(0,p.getMsgMediaType)(e)}catch(n){if(!t.type)throw n;r=(0,p.msgToMediaType)({type:t.type,isGif:e.isGif})}(0,d.downloadMedia)({mimetype:t.mimetype,mediaObject:i,downloadEvenIfExpensive:!1,mediaType:r,rmrReason:n,downloadOrigin:(0,o.default)(e)})}}},193628:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{msg:t,isUserClick:n,mode:r,downloadEvenIfExpensive:l,rmrReason:c,rmrData:u,isAutoDownload:d}=e,{mediaObject:p}=t;if(p){return p.getPendingProcess("fromDisk").then((0,i.default)((function*(){n&&p.userDownloadAttemptCount++,yield(0,o.downloadMedia)({mimetype:t.mimetype,mediaObject:p,downloadEvenIfExpensive:l,mediaType:(0,s.getMsgMediaType)(t),rmrReason:c,rmrData:u,downloadOrigin:(0,a.default)(t),isVcardOverMmsDocument:t.isVcardOverMmsDocument,mode:r,isAutoDownload:d,isViewOnce:Boolean(t.isViewOnce)}),p.userDownloadAttemptCount=0})))}return __LOG__(4,void 0,new Error,!0)`id: ${t.id.toString()} type: ${t.type}`,SEND_LOGS("media-fault: downloadMsg msg without mediaObject"),Promise.resolve()};var i=r(n(348926)),a=r(n(464328)),o=n(209329),s=n(661596);r(n(11339))},742454:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return p.apply(this,arguments)};var a=i(n(348926)),o=n(389385),s=i(n(145095)),l=i(n(434475)),c=i(n(534949)),u=n(661596),d=n(826384);function p(){return(p=(0,a.default)((function*(e){const{msg:t,isPreload:n,signal:i}=e;__LOG__(2)`media.downloadProgressiveJpegThumbnail: start`;try{const e=(0,s.default)(t.scanLengths,"msg.scanLengths"),a=(0,s.default)(t.scansSidecar,"msg.scansSidecar"),o=(0,s.default)(t.mediaObject,"msg.mediaObject"),l=(0,s.default)(o.filehash,"mediaObject.filehash"),{encFilehash:p,directPath:f}=t,_=yield d.downloadManager.downloadAndDecrypt({directPath:f,encFilehash:p,filehash:l,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:u.MEDIA_TYPES.IMAGE,signal:i||(new r).signal,userDownloadAttemptCount:0,progressiveJpegOpts:{mimetype:"image/jpeg",scansSidecar:a,scanLengths:e,scanCount:1},isPreload:n});o.consolidate({fullPreviewData:yield c.default.createFromData(_,"image/jpeg")}),__LOG__(2)`media.downloadProgressiveJpegThumbnail: success`}catch(e){if(e.name===o.ABORT_ERROR)return void __LOG__(2)`media.downloadProgressiveJpegThumbnail aborted`;__LOG__(3,void 0,void 0,!0)`media.downloadProgressiveJpegThumbnail: error\n${(0,l.default)(e)}`,SEND_LOGS("download-pjpeg-thumbnail-failed")}}))).apply(this,arguments)}},165403:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(115461),o=r(n(742454)),s=r(n(961516));function l(){return(l=(0,i.default)((function*(e){const{msg:t,isPreload:n,signal:r}=e,{encFilehash:i,thumbnailSha256:l,thumbnailEncSha256:c,thumbnailDirectPath:u}=t;t.type===a.MSG_TYPE.IMAGE&&t.scanLengths&&t.scansSidecar&&i?yield(0,o.default)({msg:t,signal:r,isPreload:n}):l&&c&&u&&(yield(0,s.default)({msg:t,signal:r,isPreload:n}))}))).apply(this,arguments)}},611679:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return h.apply(this,arguments)};var a=i(n(348926)),o=i(n(145095)),s=i(n(364369)),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(551428)),c=i(n(434475)),u=i(n(376139)),d=i(n(534949)),p=n(661596),f=n(826384);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function h(){return(h=(0,a.default)((function*(e){const{msg:t}=e,{encFilehash:n,filehash:i,directPath:a}=t;if(!n||!i||!a)return;const{fullPreviewData:_,fullWidth:h,fullHeight:g}=t.mediaData;if(!_||null==h||null==g){__LOG__(2)`media.downloadVideoThumbnail: start`;try{const e=Math.max(parseInt(t.mediaData.duration,10),1),c={video:{size:t.mediaData.size,duration:e},secondsToDownload:1},_=yield f.downloadManager.downloadAndDecrypt({directPath:a,encFilehash:n,filehash:i,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,type:p.MEDIA_TYPES.VIDEO,signal:(new r).signal,userDownloadAttemptCount:0,partialVideoOpts:c,isPreload:!0}),h=new Blob([_],{type:"video/mp4"}),{thumbs:[g]}=yield l.generateVideoThumbsAndDuration({file:h,maxDimensions:[s.default.VIDEO_THUMB_MAX_EDGE],debugHint:"downloadVideoThumbnail",throwOnBlack:!0}),m=yield d.default.createFromBase64Jpeg(u.default.parseDataURL(g.url).data),y=(0,o.default)(t.mediaObject,"mediaObject cannot be null for thumbnail download"),S={fullPreviewData:m,fullWidth:g.fullWidth,fullHeight:g.fullHeight};y.consolidate(S),__LOG__(2)`media.downloadVideoThumbnail: success`}catch(e){if(e instanceof l.BlackVideoThumbnailError)return void __LOG__(2)`media.downloadVideoThumbnail: black thumbnail was generated, fallback to blurred thumbnail`;__LOG__(3,!0)`media.downloadVideoThumbnail: error\n${(0,c.default)(e)}`}}}))).apply(this,arguments)}},637461:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=r(n(534949)),s=r(n(494995)),l=n(58668),c=r(n(11339));function u(){return(u=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];__LOG__(2)`Prepping media msg`;const a=e.mediaObject;if(!a)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: forwardMediaMsg msg without mediaObject"),Promise.reject(new Error("non initialized media"));const u=e.mediaData.toJSON();null!=u.preview&&(u.preview=a.contentInfo._preview),u.mediaBlob instanceof o.default&&u.mediaBlob.retain();const d={mimetype:u.mimetype},p=u.isGif?(0,i.default)((0,i.default)({},d),{},{isGif:!0}):d;u.type===l.OUTWARD_TYPES.PTT&&(u.type=l.OUTWARD_TYPES.AUDIO);const f={businessOwnerJid:e.businessOwnerJid,productId:e.productId,currencyCode:e.currencyCode,priceAmount1000:e.priceAmount1000,salePriceAmount1000:e.salePriceAmount1000,retailerId:e.retailerId,url:e.url,productImageCount:e.productImageCount,title:e.title,description:e.description},_=e.isFromTemplate||e.isDynamicReplyButtonsMsg,h=yield new s.default(u.type,Promise.resolve(u)).sendToChat(t,{forwardedFromWeb:!0,caption:_&&u.type===l.OUTWARD_TYPES.DOCUMENT||u.type===l.OUTWARD_TYPES.PRODUCT?e.caption:void 0,footer:u.type===l.OUTWARD_TYPES.PRODUCT?e.footer:void 0,addEvenWhilePreparing:!0,placeholderProps:p,isForwarded:e.isForwarded||!e.isSentByMe,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:r,productMsgOptions:f});if(u.type===l.OUTWARD_TYPES.STICKER){var g,m,y;new c.default.StickerSend({stickerSendOrigin:c.default.STICKER_SEND_ORIGIN_TYPE.FORWARD,stickerIsAnimated:Boolean(null===(g=e.mediaData)||void 0===g?void 0:g.isAnimated),stickerIsFirstParty:Boolean(null===(m=e.mediaData)||void 0===m?void 0:m.isFirstParty),stickerIsFromStickerMaker:Boolean(null===(y=e.mediaData)||void 0===y?void 0:y.isFromStickerMaker)}).commit();n(249264).RecentStickerCollectionMd.addStickerWithMediaData(u,e.id.id)}return h}))).apply(this,arguments)}},464328:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.asProduct?i.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:e.isStatusV3?i.default.DOWNLOAD_ORIGIN_TYPE.STATUS_USER:e.isGroupMsg?i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:i.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL};var i=r(n(11339))},779373:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{msg:t,media:n,rmrReason:r}=e;const l=t.mediaObject;if(!l)return;a.default.createFromData(n,t.mimetype).then((e=>{(0,o.manuallySetMedia)({mimetype:t.mimetype,mediaObject:l,mediaBlob:e,mediaType:(0,s.getMsgMediaType)(t),rmrReason:r,downloadOrigin:(0,i.default)(t)})}))};var i=r(n(464328)),a=r(n(534949)),o=n(209329),s=n(661596);r(n(11339))},879019:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mediaMetadata=function(e){const t=e.mediaObject;if(!t)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata msg without mediaObject"),new Error("msg.mediaMetadata with no mediaObject");const n=t.entries.getEntryByEncFilehash({encFilehash:e.encFilehash,deprecatedMms3Url:e.deprecatedMms3Url});if(!n)throw __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: mediaMetadata no entry"),new Error("msg.mediaMetadata with entry mismatch");const r=e.mediaData;return{url:n.deprecatedMms3Url,directPath:n.directPath,encFilehash:n.encFilehash,mediaKey:n.mediaKey,mediaKeyTimestamp:n.mediaKeyTimestamp,filehash:e.filehash,type:r.type,mimetype:r.mimetype,filename:r.filename,duration:r.duration,width:r.fullWidth,height:r.fullHeight,firstFrameLength:r.firstFrameLength,isAnimated:r.isAnimated,thumbnailDirectPath:e.thumbnailDirectPath,thumbnailSha256:e.thumbnailSha256,thumbnailEncSha256:e.thumbnailEncSha256,thumbnailHeight:e.thumbnailHeight,thumbnailWidth:e.thumbnailWidth,waveform:e.waveform,staticUrl:e.staticUrl}}},496575:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterMsg=function(e){e.off(null,p);const t=e.mediaObject;t&&s.disassociateMediaFromMsg(t,e)},t.prepareMsg=function(e){const t=e.mediaObject;if(t)return t.resolveWhenConsolidated();const n=e.mediaData,r=n.preview;if(r instanceof o.default&&void 0===n.aspectRatio&&(void 0===n.fullWidth||void 0===n.fullHeight))return(0,a.getImageWidthHeight)(r).then((t=>{let{width:n,height:r}=t;e.mediaObject||e.mediaData.set({aspectRatio:n/r})}));return Promise.resolve()},t.registerMsg=function(e){e.mimetype||e.type!==l.OUTWARD_TYPES.IMAGE||(e.mimetype="image/jpeg");e.mimetype||e.type!==l.OUTWARD_TYPES.STICKER||(e.mimetype="image/webp");e.on(d,p),(0,i.consolidateMediaUpdate)(e,c.default.WEBC_RMR_REASON_CODE.MSG_INIT)},t.registerMsgEarly=function(e,t){e.isUnsentPhoneMsg()&&(__LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: registerMsgEarly msg without mediaObject"));const n={};for(let r=0;r<l.MEDIA_MSG_PROPS.length;r++){const i=l.MEDIA_MSG_PROPS[r],a=t[i];n[i]=void 0!==a?a:e[i]}n.mimetype||n.type!==l.OUTWARD_TYPES.IMAGE||(t.mimetype=n.mimetype="image/jpeg");e.on(d,p),(0,i.consolidateMediaUpdateWithValues)(e,n,c.default.WEBC_RMR_REASON_CODE.MSG_UPDATE);const r={};for(let e=0;e<l.MSG_SPECIFIC_FIELDS.length;e++){const t=l.MSG_SPECIFIC_FIELDS[e];r[t]=n[l.MEDIA_TO_MSG[t]]}e.mediaData.set(r)};var i=n(160953),a=n(756406),o=r(n(534949)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(988297)),l=n(58668),c=r(n(11339));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}const d=`change:phoneUploading change:ack ${l.MEDIA_MSG_PROPS.map((e=>`change:${e}`)).join(" ")}`;function p(e){(0,i.consolidateMediaUpdate)(e,c.default.WEBC_RMR_REASON_CODE.MSG_UPDATE)}},740674:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n;__LOG__(2)`Prepping raw media`,n=!0===t.isPtt?a.OUTWARD_TYPES.PTT:!0===t.asDocument?a.OUTWARD_TYPES.DOCUMENT:!0===t.asGif?a.OUTWARD_TYPES.VIDEO:!0===t.isAudio?a.OUTWARD_TYPES.AUDIO:!0===t.asSticker?a.OUTWARD_TYPES.STICKER:a.OUTWARD_TYPES.UNKNOWN;const r=Promise.resolve(e).then((e=>(e.autoreleaseWhenPromiseCompletes(r),(0,o.default)(e,t))));return new i.default(n,r)};var i=r(n(494995)),a=n(58668),o=r(n(327989))},985046:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.uploadProductImage=function(){return u.apply(this,arguments)};var a=i(n(348926)),o=n(565885),s=n(661596),l=i(n(154824)),c=i(n(11339));function u(){return(u=(0,a.default)((function*(e,t){const n=yield(0,o.blobToArrayBuffer)(e.forceToBlob()).then((e=>l.default.unencryptedUpload({file:e,hash:t,signal:(new r).signal,type:s.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE,uploadOrigin:c.default.UPLOAD_ORIGIN_TYPE.PRODUCT_CATALOG,isViewOnce:!1})));return new URL(n.directPath,"https://mmg.whatsapp.net").toString()}))).apply(this,arguments)}},123127:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const{mediaObject:n}=e;if(!n)return __LOG__(4,void 0,new Error,!0)`id: ${e.id.toString()} type: ${e.type}`,SEND_LOGS("media-fault: resumeUploadMsg msg without mediaObject"),Promise.resolve();n.userUploadAttemptCount++;const{filehash:r}=n,p=(0,l.shouldUseMediaKeyCache)()&&null!=r&&null!==(t=l.MediaKeyCache.get(r))&&void 0!==t?t:void 0;e.ack=a.ACK.CLOCK;const f=(0,c.uploadMedia)({mimetype:e.mimetype,mediaObject:n,mediaKeyInfo:p,mediaType:(0,u.getMsgMediaType)(e),forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,s.default)(e.chat),isViewOnce:Boolean(e.isViewOnce)}).then(function(){var t=(0,i.default)((function*(t){let{mediaEntry:i}=t;if((0,l.shouldUseMediaKeyCache)()&&null!=r&&l.MediaKeyCache.delete(r),!i)throw new Error("upload failed: media entry was not created");n.userUploadAttemptCount=0;const a={deprecatedMms3Url:i.deprecatedMms3Url,directPath:i.directPath,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,filehash:n.filehash,encFilehash:i.encFilehash,size:n.size,streamingSidecar:i.sidecar,firstFrameSidecar:i.firstFrameSidecar};return yield(0,d.default)(e,a),e}));return function(){return t.apply(this,arguments)}}());return(0,o.resendMsgToChat)(e.chat,f).catch((()=>{e.ack=a.ACK.FAILED}))};var i=r(n(348926)),a=n(535470),o=n(623631),s=(n(20551),r(n(846220))),l=n(245554),c=n(70996),u=n(661596),d=r(n(302603))},304007:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deregisterSticker=function(e){const{mediaObject:t}=e;t&&l.disassociateMediaFromSticker(t,e)},t.deregisterStickerPackIcon=function(e){const{mediaObject:t}=e;t&&l.disassociateMediaFromStickerPack(t,e)},t.downloadStickerOrStickerPackIcon=function(){return m.apply(this,arguments)},t.prepSticker=function(e){__LOG__(2)`Prepping sticker`;const t=e.mediaObject,n=e.mediaData.toJSON();if(n.fullWidth=125,n.fullHeight=125,!t)return __LOG__(4,void 0,new Error,!0)`id: ${e.id}`,SEND_LOGS("media-fault: prepSticker sticker without mediaObject"),new s.default(n.type,Promise.reject(new Error("non initialized media")));return new s.default(n.type,Promise.resolve(n))},t.registerSticker=function(e){g(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker with no filehash`,void SEND_LOGS("sticker-filehash-error");const t=l.getOrCreateMediaObject(e.filehash);return l.associateMediaWithSticker(t,e),t}(e),d.MEDIA_TYPES.STICKER)},t.registerStickerPackIcon=function(e){g(e,e.mediaObject||function(e){if(!e.filehash)return __LOG__(4,void 0,new Error,!0)`Unexpected sticker pack with no filehash`,void SEND_LOGS("sticker-pack-filehash-error");const t=l.getOrCreateMediaObject(e.filehash);return l.associateMediaWithStickerPack(t,e),t}(e),d.MEDIA_TYPES.IMAGE)};var a=i(n(348926)),o=n(88555),s=i(n(494995)),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(988297)),c=n(58668),u=n(209329),d=n(661596),p=n(826384),f=i(n(11339)),_=n(964551);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}function g(e,t,n){const r=function(e){const t={};return c.MAPPED_STICKER_PROPS.forEach((n=>{const r=e[n],i=c.MSG_TO_MEDIA[n];t[i]=r})),t}(e);if(e.mediaData.set(r),!t)return;e.mediaObject=t;const{deprecatedMms3Url:i,encFilehash:a}=e;if((a||i)&&!t.entries.has({encFilehash:a,deprecatedMms3Url:i})){t.entries.addEntry({deprecatedMms3Url:i,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,encFilehash:a,type:n,directPath:e.directPath,debugHint:"setMediaObjectValues"})&&t.downloadStage===c.DOWNLOAD_STAGE.ERROR_MISSING&&(r.downloadStage=c.DOWNLOAD_STAGE.INIT)}t.consolidate(r)}function m(){return(m=(0,a.default)((function*(e,t){if(e.isPlaceholder||e.isCreateButton)return e.mediaData.mediaStage=c.MEDIA_DATA_STAGE.PREPARING,Promise.resolve();const i=e.mediaObject;if(!i)return Promise.reject(new Error("media-fault: downloadStickerOrStickerPackIcon sticker/stickerPack without mediaObject"));if(i.downloadStage===c.DOWNLOAD_STAGE.RESOLVED)return Promise.resolve();const a="STICKER"===t?f.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_STICKER:f.default.WEBC_RMR_REASON_CODE.STICKER_PANEL_ICON;let s=!1;yield i.getPendingProcess("fromDisk").then((()=>{if((0,o.isLegacyWebdBackend)()&&!e.deprecatedMms3Url||!e.filehash||!e.mediaKey||!e.encFilehash)return s=!0,p.downloadManager.rmr({mediaObject:i,signal:(new r).signal,rmrReason:a})})).then((()=>(0,u.downloadMedia)({mimetype:e.mimetype,mediaObject:e.mediaObject,downloadEvenIfExpensive:!0,mediaType:(0,d.msgToMediaType)({type:e.type,isGif:!1}),rmrReason:a,downloadOrigin:f.default.DOWNLOAD_ORIGIN_TYPE.STICKER_PICKER,shouldThrow:!0}))),(0,o.isMDBackend)()&&s&&_.ServerProps.webServerStickerPanel&&n(249264).RecentStickerCollectionMd.updateStickerMediaData(e.filehash,i.entries.getDownloadEntry())}))).apply(this,arguments)}},348086:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.videoStreamingInfo=function(e){const t=e.mediaObject;return t?t.videoStreamingInfo(e.id.toString()):null};n(721009)},502320:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(199140),o=n(284866),s=n(58668),l=n(411290);class c extends l.BaseModel{constructor(){super(...arguments),this.type=(0,l.prop)(s.OUTWARD_TYPES.UNKNOWN),this.directPath=(0,l.prop)(),this.mediaKey=(0,l.prop)(),this.mediaKeyTimestamp=(0,l.prop)(),this.encFilehash=(0,l.prop)(),this.mediaStage=(0,l.prop)(s.MEDIA_DATA_STAGE.INIT),this.size=(0,l.prop)(),this.loadedSize=(0,l.prop)(),this.filehash=(0,l.prop)(),this.mimetype=(0,l.prop)(),this.mediaBlob=(0,l.prop)(),this.renderableUrl=(0,l.prop)(),this.fullHeight=(0,l.prop)(),this.fullWidth=(0,l.prop)(),this.aspectRatio=(0,l.prop)(),this.rgbaBuffer=(0,l.prop)(),this.rgbaHeight=(0,l.prop)(),this.rgbaWidth=(0,l.prop)(),this.animationDuration=(0,l.prop)(0),this.animatedAsNewMsg=(0,l.prop)(!1),this.isAnimated=(0,l.prop)(),this.isFirstParty=(0,l.prop)(),this.isFromStickerMaker=(0,l.prop)(),this.stickerPackId=(0,l.prop)(),this.stickerPackName=(0,l.prop)(),this.stickerPackPublisher=(0,l.prop)(),this.singleLoopDuration=(0,l.prop)(),this.firstFrameLength=(0,l.prop)(),this.firstFrameSidecar=(0,l.prop)(),this.emojis=(0,l.prop)(),this.progressiveStage=(0,l.prop)(),this.isViewOnce=(0,l.prop)(!1),this.staticUrl=(0,l.prop)(),this.preview=(0,l.prop)(),this.sidecar=(0,l.prop)(),this.duration=(0,l.prop)(),this.durationFloat=(0,l.prop)(),this.isGif=(0,l.prop)(),this.gifAttribution=(0,l.prop)(),this.streamable=(0,l.derived)((function(){return this.isStreamable()}),["isGif","isViewOnce","mediaStage","sidecar","type","_swStreamingSupported"]),this._swStreamingSupported=(0,l.prop)(!1),this._listeningToSwSupport=(0,l.prop)(!1),this.filename=(0,l.prop)(),this.pageCount=(0,l.prop)(),this.documentPreview=(0,l.prop)(),this.isVcardOverMmsDocument=(0,l.prop)(!1),this.parsedVcards=(0,l.prop)(),this.fullPreviewSize=(0,l.prop)(),this.fullPreviewData=(0,l.prop)(),this.subtype=(0,l.prop)(),this.waveform=(0,l.prop)()}initialize(){super.initialize()}set(e,t,n){let r,o=n;return"string"==typeof e?r={[e]:t}:(r=e,o=t),r=function(e){if(e.filename&&e.type===u.TYPE.DOCUMENT){const t=(0,a.cleanFilename)(e.filename);return(0,i.default)((0,i.default)({},e),{},{filename:t,caption:t})}return e}(r),super.set(r,o)}isStreamable(){return this.isStreamableType()&&this.listenToServiceWorkerSupport()&&!this.isViewOnce}_updateStreamingSupported(e){this._swStreamingSupported=e}listenToServiceWorkerSupport(){if(this._listeningToSwSupport)return this._swStreamingSupported;{const e=n(8425).default;this.listenTo(e,"change:streamingSupported",this._updateStreamingSupported),this._swStreamingSupported=Boolean(e.streamingSupported)}return this._listeningToSwSupport=!0,this._swStreamingSupported}isStreamableType(){return this.type===s.OUTWARD_TYPES.VIDEO&&!this.isGif&&(this.mediaStage===s.MEDIA_DATA_STAGE.INIT||this.mediaStage===s.MEDIA_DATA_STAGE.FETCHING||this.mediaStage===s.MEDIA_DATA_STAGE.DECRYPTING||this.mediaStage===s.MEDIA_DATA_STAGE.RESOLVED)&&null!=this.fullWidth&&null!=this.fullHeight&&Boolean(this.sidecar&&this.sidecar.byteLength>0)}isDownloadable(){return!this.isViewOnce&&(null!=this.renderableUrl||o.MediaBlobCache.has(this.filehash)||this.mediaStage===s.MEDIA_DATA_STAGE.EXISTS||this.mediaStage===s.MEDIA_DATA_STAGE.PROGRESSIVE_READY)}}c.Proxy="mediaData";const u=(0,l.defineModel)(c);u.TYPE=s.OUTWARD_TYPES;var d=u;t.default=d},480923:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEntryList=t.MediaEntry=void 0;var i=r(n(348926)),a=n(420177),o=n(442658),s=n(892844),l=r(n(522283)),c=n(546640),u=r(n(821081)),d=r(n(487798));const p="PROBABLY_ON_SERVER",f="PROBABLY_OFF_SERVER",_="UNKNOWN";class h{constructor(e){this.useBackupUrl=!1,this._encFilehashPromise=null,this.deprecatedMms3Url=e.deprecatedMms3Url,this.mediaKey=e.mediaKey,this.mediaKeyTimestamp=e.mediaKeyTimestamp,this.encFilehash=e.encFilehash,this.serverStatus=_,this.sidecar=e.sidecar,this.directPath=e.directPath,this.firstFrameSidecar=e.firstFrameSidecar,this.type=e.type,this.scansSidecar=e.scansSidecar,this.scanLengths=e.scanLengths,this.staticUrl=e.staticUrl}url(e){var t=this;return(0,i.default)((function*(){const{useFallback:n,forceHashUrl:r}=e||{},{encFilehash:i}=t;if(!i)return Promise.reject(new Error("media_entry: encFilehash does not exist"));const{selectedHost:a,fallbackHost:o}=yield c.mediaHosts.getHostsInfo({operation:l.default.DOWNLOAD,encFilehash:i,type:t.type}),s=n&&o?o:a;return(0,u.default)({directPath:r?null:t.directPath,encFilehash:i,hostname:s.hostname,type:t.type})}))()}canReuseMediaKey(){if(null==this.directPath)return!1;const e=(0,s.castToUnixTime)(this.mediaKeyTimestamp);return(0,o.isMediaKeyReusable)(e)}markWhetherOnServer(e){this.serverStatus=e?p:f}}t.MediaEntry=h;function g(e){e.entries.sort(((e,t)=>{const n=m(t)-m(e);return 0===n?t.mediaKeyTimestamp-e.mediaKeyTimestamp:n}))}function m(e){let t=0;switch(e.serverStatus){case p:t+=200;break;case f:break;case _:t+=100}return e.encFilehash?t+=20:e._encFilehashPromise&&(t+=10),t}t.MediaEntryList=class{constructor(){this.entries=[]}_updateEntry(e){let{foundEntry:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:u,deprecatedMms3Url:d,staticUrl:p}=e;if(n&&!(0,a.b64Equal)(t.mediaKey,n)){const e=t.mediaKey.replace("=","").split("\n")[0],r=n.replace("=","").split("\n")[0];return __LOG__(4,void 0,new Error,!0)`media-fault: mediaKey changed for the same MMS3 url. type:${t.type}. equal?:${e===r}. Debug:\n${JSON.stringify({before:{hasDirectPath:Boolean(t.directPath),hasEncFilehash:Boolean(t.encFilehash),hasMediaKey:Boolean(t.mediaKey),hasDeprecatedMms3Url:Boolean(t.deprecatedMms3Url)},after:{hasDirectPath:Boolean(s),hasEncFilehash:Boolean(i),hasDeprecatedMms3Url:Boolean(d)}},null,2)}`,SEND_LOGS("media-key-mismatch-same-mms3-url"),null}return null!=r&&(t.mediaKeyTimestamp=r),o&&(t.sidecar=o),l&&(t.firstFrameSidecar=l),c&&(t.scansSidecar=c),(null==u?void 0:u.length)&&(t.scanLengths=u),p&&(t.staticUrl=p),t.directPath=s,t}updateEntry(e){let{deprecatedMms3Url:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:u,staticUrl:d}=e;const p=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t});if(p)return this._updateEntry({foundEntry:p,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:u,deprecatedMms3Url:t,staticUrl:d})}addEntry(e){const{deprecatedMms3Url:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:u,staticUrl:d,debugHint:p}=e;null==i&&(__LOG__(4,void 0,new Error,!0)`Media type ${a} from ${p} is missing encFilehash`,SEND_LOGS(`media-entry-missing-upload-hash-${a}-${p}`));const f=this.entries,_=this.getEntryByEncFilehash({encFilehash:i,deprecatedMms3Url:t}),g=_?this._updateEntry({foundEntry:_,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:u,deprecatedMms3Url:t,staticUrl:d}):null;if(g)return g;if(!n)return null;const m=new h({deprecatedMms3Url:t,mediaKey:n,mediaKeyTimestamp:r,encFilehash:i,type:a,sidecar:o,directPath:s,firstFrameSidecar:l,scansSidecar:c,scanLengths:u,staticUrl:d});return f.push(m),m}_getKey(e){let{encFilehash:t,deprecatedMms3Url:n}=e;return null==t?`mms3:${n}`:t}has(e){return null!=this.getEntryByEncFilehash(e)}getEntryByEncFilehash(e){const t=this._getKey(e);return this.entries.find((e=>this._getKey(e)===t))}getUploadEntry(){return g(this),this.entries.find((e=>(0,d.default)(e.mediaKeyTimestamp)))||null}getDownloadEntry(){g(this);const e=this.entries[0];return e&&e.serverStatus!==f?e:null}}},750170:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(640265),i=n(435232);class a extends((0,r.customError)("MediaFileTooLarge",!0,i.MediaFileError)){constructor(e){super(`File (${e.type()}) size = ${e.size()}`),this.opaqueData=e}}t.default=a},216737:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.canPlayOgg=void 0,t.disposeVideo=v,t.getMediaTagErrorReason=y,t.image=function(e){return S(e).then((e=>{if(e&&e.naturalWidth>0)return{img:e,fullWidth:e.naturalWidth,fullHeight:e.naturalHeight};throw new l.MediaLoadError("image loaded with zero width")})).catch((()=>{throw new l.MediaLoadError("unable to render image")}))},t.loadImage=S,t.loadVideo=E,t.transcode=function(e,t){const n=t||e.type;if((0,d.isOpus)(n)&&!h){if(e.size<=3e5){return new f.default(e).generateBlob()}return Promise.reject(new l.TranscodeBlobTooLargeError)}return Promise.resolve(e)},t.videoWidthHeightDuration=function(e){return E(e).then((e=>{let{video:t,fullWidth:n,fullHeight:r,duration:i}=e;return v(t),{width:n,height:r,duration:i}}))};var i=n(640265),a=n(450796),o=n(413959),s=n(638284),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),c=r(n(968868)),u=n(26741),d=n(843257),p=r(n(11339)),f=r(n(151631));function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}const h=(new Audio).canPlayType("audio/ogg");t.canPlayOgg=h;let g=0,m=Promise.resolve();function y(e){if(!e||!e.error)return null;const t=e.error;let n=Object.keys(c.default).find((e=>c.default[e]===t.code));n=n||`UNKNOWN CODE ${t.code}`;const r=t.message&&~t.message.indexOf(":")?t.message.split(":")[0]:"";return r?`${n}: ${r}`:n}function S(e){let t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(r,i){t=new Image;const a=/^(?:data|blob):/.test(e);n&&!a&&t.setAttribute("crossOrigin","anonymous"),t.onload=r,t.onabort=()=>{i(new Error("loadImage onabort"))},t.onerror=()=>{i(new l.InvalidImageFileType("Image tag load error"))},t.src=e})).then((()=>t))}function E(e){const t=m.then((()=>function(e){const t=new p.default.WebcMediaLoad;let n,r,c=null;const d=++g;function f(){n&&c&&(document.body&&document.body.removeChild(c),c=null)}let _=!0;const h=new Promise((function(t,i){__LOG__(2)`MediaLoad:video called (#${d})`;let a=!1,o=!1;n=document.createElement("video"),n.setAttribute("crossOrigin","anonymous"),n.volume=0,n.muted=!0,n.playsinline=!0;const s=()=>{o&&a&&t()};if(n.onloadedmetadata=()=>{__LOG__(2)`MediaLoad:video.onloadedmetadata #${d}. Video ready: ${o}. Video width: ${n.videoWidth}`,n.onloadedmetadata=null,a=!0,s()},n.oncanplaythrough=()=>{__LOG__(2)`MediaLoad:video.oncanplaythrough #${d}. Metadata loaded: ${a}. Video width: ${n.videoWidth}`,n.oncanplaythrough=null,n.onseeked=()=>{o=!0,n.onseeked=null,s()},n.currentTime=0},n.onerror=()=>{const t=n.error?n.error.message:"no error message";__LOG__(3)`MediaLoad:video.onerror #${d}: ${String(t)}\n Blob info -> size:${e.size}, type: ${e.type}`;const r=y(n);i(new l.UnableToPlayVideoError(r))},n.src=r=window.URL.createObjectURL(e),u.UA.isSafari){c=document.createElement("div");const e=c;e.style="opacity: 0.004",e.appendChild(n),document.body&&document.body.appendChild(e)}n.load(),n.currentTime=1})).finally((()=>{_=!1}));setTimeout((()=>{f(),_&&(__LOG__(3)`unable to load video #${d} (${e.size} bytes)`,new p.default.WebcMediaLoad({webcMediaLoadResult:p.default.WEBC_MEDIA_LOAD_RESULT_CODE.SILENCE}).commit())}),8e3);const m=(0,s.promiseTimeout)(h,2e4).then((()=>(0,o.delayMs)(10))).then((()=>{if(t.markWebcMediaLoadT(),__LOG__(2)`MediaLoad:video #${d} successful`,n.pause(),n.videoWidth>0)return t.webcMediaLoadResult=p.default.WEBC_MEDIA_LOAD_RESULT_CODE.SUCCESS,t.commit(),{video:n,fullWidth:n.videoWidth,fullHeight:n.videoHeight,duration:n.duration};throw n.duration>0?(__LOG__(3)`MediaLoad:video #${d} dimensions are not defined. Video readyState: ${n.readyState}. Video width: ${n.videoWidth}`,new l.MediaUnsupportedError("video loaded with duration but no dims")):(t.webcMediaLoadResult=p.default.WEBC_MEDIA_LOAD_RESULT_CODE.ZEROWIDTH,t.commit(),new l.MediaLoadError("video loaded with zero width"))})).catch((0,a.filteredCatch)(i.TimeoutError,(e=>{throw __LOG__(4,void 0,new Error,!0)`MediaLoad:video load error, currentTime=${n.currentTime}. duration=${n.duration}`,SEND_LOGS("video-load-timeout"),e}))).finally((()=>{f(),n&&(n.onloadedmetadata=null,n.onloadeddata=null,n.oncanplaythrough=null,n.ontimeupdate=null,n.onerror=null),r&&window.URL.revokeObjectURL(r)}));return m.catch((()=>{v(n)})),m}(e)));return m=(0,s.promiseTimeout)(t,1e3).then((()=>{}),(()=>{})),t}function v(e){try{e.pause(),e.src="",e.load()}catch(e){__LOG__(4,void 0,new Error,!0)`Error: ${String(e)}`,SEND_LOGS("dispose-video-error")}}},721009:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaObject=void 0,t.consolidate=E,t.getInteractiveMsgMediaType=v,t.webMediaTypeToWamMediaType=function(e){switch(e){case"VIDEO":return 3;case"IMAGE":return 2;case"AUDIO":return 4;case"STICKER":return 16;case"DOCUMENT":return 8;case"PRODUCT":return 18;case"BIZ_COVER_PHOTO":default:throw new Error(`web media type is invalid: ${e}`)}};var i=r(n(81109)),a=r(n(348926)),o=n(657319),s=n(535470),l=n(88555),c=n(115461),u=n(756406),d=r(n(534949)),p=n(480923),f=n(422104),_=n(58668),h=n(661596),g=r(n(428011)),m=r(n(284159)),y=(r(n(11339)),n(534535)),S=n(964551);function E(e,t){const n=e.contentInfo;let r=!1;const i=function(e){switch(e){case _.OUTWARD_TYPES.IMAGE:case _.OUTWARD_TYPES.PRODUCT:return _.TYPE.IMAGE;case _.OUTWARD_TYPES.VIDEO:return _.TYPE.VIDEO;case _.OUTWARD_TYPES.STICKER:return _.TYPE.STICKER;case _.OUTWARD_TYPES.AUDIO:case _.OUTWARD_TYPES.PTT:return _.TYPE.AUDIO;case _.OUTWARD_TYPES.DOCUMENT:default:return}}(t.type,t.subtype);i&&!e.type&&(e.type=i,r=!0);const{downloadStage:a,uploadStage:o}=t;a&&a!==e.downloadStage&&(e.downloadStage=a,r=!0),o&&o!==e.uploadStage&&(e.uploadStage=o,r=!0),t.resolvedPreview&&!n.preview&&(t.resolvedPreview.retain(),n.preview=t.resolvedPreview,r=!0),void 0!==t.progressiveStage&&t.progressiveStage!==e.progressiveStage&&(e.progressiveStage=t.progressiveStage,r=!0);const s=t.mediaBlob;s&&!s.isBlobEqual(e.mediaBlob)&&(e.mediaBlob&&e.clearBlob(),s.retain(),e.mediaBlob=s,e.size=s.size(),r=!0),null!=t.size&&(null==e.size||t.size<e.size)&&(e.size=t.size,r=!0);const{loadedSize:l}=t;null!=l&&l!==e.loadedSize&&(e.loadedSize=l,r=!0),t.filehash&&!e.filehash&&(e.filehash=t.filehash,r=!0),t.parsedVcards&&t.parsedVcards!==e.parsedVcards&&(e.parsedVcards=t.parsedVcards,r=!0);const c=e.contentFields();for(let i=0;i<c.length;i++){const a=c[i];switch(a){case"preview":t.preview&&!n._preview&&(e.runProcessIfNotRunBefore("preview",b,t.preview),n._preview=t.preview,r=!0);break;case"fullWidth":case"fullHeight":case"aspectRatio":{const e=t[a];null!=e&&0!==e&&n[a]!==e&&(n[a]=e,r=!0);break}case"animationDuration":case"singleLoopDuration":{const e=t[a];null!=e&&e!==n[a]&&(n[a]=e,r=!0);break}default:const i=t[a];void 0!==i&&void 0===n[a]&&(n[a]=i,r=!0)}}return null!=n.aspectRatio&&0!==n.aspectRatio||(null!=n.fullWidth&&0!==n.fullWidth&&null!=n.fullHeight&&0!==n.fullHeight?(n.aspectRatio=n.fullWidth/n.fullHeight,r=!0):n.preview&&e.runProcessIfNotRunBefore("aspectRatio",O,n.preview)),r}function v(e){var t;if(null!=(null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType))switch(e.interactiveHeader.mediaType){case y.InteractiveMessageHeaderMediaType.DOCUMENT:return _.OUTWARD_TYPES.DOCUMENT;case y.InteractiveMessageHeaderMediaType.VIDEO:return _.OUTWARD_TYPES.VIDEO;case y.InteractiveMessageHeaderMediaType.IMAGE:return _.OUTWARD_TYPES.IMAGE}}function T(e,t,n){for(let r=0;r<n.length;r++){const i=n[r];e[i]=t[i]}}function C(e,t){return t.filehash?e.id.fromMe&&e.ack<s.ACK.SENT?(e.local||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: unsent media system message not local")),function(e){switch(e.uploadStage){case _.UPLOAD_STAGE.INIT:case _.UPLOAD_STAGE.PREPARING:return _.MEDIA_DATA_STAGE.PREPARING;case _.UPLOAD_STAGE.UPLOADING:return _.MEDIA_DATA_STAGE.UPLOADING;case _.UPLOAD_STAGE.NEED_UPLOAD:return _.MEDIA_DATA_STAGE.NEED_UPLOAD;case _.UPLOAD_STAGE.ERROR_MISSING:return _.MEDIA_DATA_STAGE.ERROR_MISSING;case _.UPLOAD_STAGE.ERROR_TOO_LARGE:return _.MEDIA_DATA_STAGE.ERROR_TOO_LARGE;case _.UPLOAD_STAGE.UPLOADED:return _.MEDIA_DATA_STAGE.SENDING;case _.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE:return _.MEDIA_DATA_STAGE.ERROR_FILE_NOT_READABLE;case _.UPLOAD_STAGE.FINALIZING:return _.MEDIA_DATA_STAGE.FINALIZING}}(t)):A(t):_.MEDIA_DATA_STAGE.PREPARING}function A(e){switch(e.downloadStage){case _.DOWNLOAD_STAGE.INIT:return _.MEDIA_DATA_STAGE.INIT;case _.DOWNLOAD_STAGE.EXISTS:return _.MEDIA_DATA_STAGE.EXISTS;case _.DOWNLOAD_STAGE.PREPARING:return _.MEDIA_DATA_STAGE.PREPARING;case _.DOWNLOAD_STAGE.REUPLOADING:return _.MEDIA_DATA_STAGE.REUPLOADING;case _.DOWNLOAD_STAGE.FETCHING:return _.MEDIA_DATA_STAGE.FETCHING;case _.DOWNLOAD_STAGE.PROCESSING:return _.MEDIA_DATA_STAGE.DECRYPTING;case _.DOWNLOAD_STAGE.NEED_POKE:return _.MEDIA_DATA_STAGE.NEED_POKE;case _.DOWNLOAD_STAGE.ERROR_MISSING:return _.MEDIA_DATA_STAGE.ERROR_MISSING;case _.DOWNLOAD_STAGE.ERROR_UNSUPPORTED:return _.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED;case _.DOWNLOAD_STAGE.RESOLVED:return _.MEDIA_DATA_STAGE.RESOLVED;case _.DOWNLOAD_STAGE.PROGRESSIVE_READY:return _.MEDIA_DATA_STAGE.PROGRESSIVE_READY}}function b(){return P.apply(this,arguments)}function P(){return(P=(0,a.default)((function*(e){const t=yield d.default.createFromBase64Jpeg(e);return t.autorelease(),{resolvedPreview:t}}))).apply(this,arguments)}function O(){return M.apply(this,arguments)}function M(){return(M=(0,a.default)((function*(e){const{width:t,height:n}=yield(0,u.getImageWidthHeight)(e);return{aspectRatio:t/n}}))).apply(this,arguments)}t.MediaObject=class{constructor(){this._msgs=[],this._notifyTimer=new o.ShiftTimer((()=>{!function(e){const t={};T(t,e,_.FIELDS.RAW),T(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const n=e._msgs,r=n.length;for(let i=0;i<r;i++){const[r,a]=n[i];if(null!=r&&!a){if(r.type!==c.MSG_TYPE.CIPHERTEXT){t.mediaStage=C(r,e);for(let e=0;e<_.MSG_SPECIFIC_FIELDS.length;e++){const n=_.MSG_SPECIFIC_FIELDS[e];t[n]=r.get(_.MEDIA_TO_MSG[n])}t.type===c.MSG_TYPE.INTERACTIVE&&(t.type=v(r))}else{delete t.mediaStage;for(let e=0;e<_.MSG_SPECIFIC_FIELDS.length;e++)delete t[_.MSG_SPECIFIC_FIELDS[e]]}r.mediaData.set(t)}}for(let e=n.length-1;e>=0;e--)n[e][1]&&n.splice(e,1);const i=e._callOnConsolidate;!e._pendingChanges&&i&&(e._callOnConsolidate=null,i.forEach((e=>{e()})));e._saveMedia&&e._saveMedia(e)}(this),function(e){const t={};T(t,e,_.FIELDS.RAW),T(t,e.contentInfo,e.contentFields()),e.mediaBlob&&(t.renderableUrl=e.mediaBlob.url());const n=A(e);e._stickers=e._stickers.filter((e=>{let[t,n]=e;return!n})),e._stickers.forEach((e=>{let[r,a]=e;r.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:n}))})),e._stickerPacks=e._stickerPacks.filter((e=>{let[t,n]=e;return!n})),e._stickerPacks.forEach((e=>{let[r,a]=e;r.mediaData.set((0,i.default)((0,i.default)({},t),{},{mediaStage:n}))})),!e._pendingChanges&&e._callOnConsolidate&&(e._callOnConsolidate.forEach((e=>{e()})),e._callOnConsolidate=null);e._saveMedia&&e._saveMedia(e)}(this)})),this._callOnConsolidate=null,this._keyedProcesses=null,this._pendingChangesCount=0,this._saveMedia=null,this._stickers=[],this._stickerPacks=[],this.entries=new p.MediaEntryList,this.downloadStage=_.DOWNLOAD_STAGE.INIT,this.uploadStage=_.UPLOAD_STAGE.INIT,this.userUploadAttemptCount=0,this.userDownloadAttemptCount=0,this.downloadPromise=null,this.uploadPromise=null,this.mediaBlob=null,this.size=void 0,this.loadedSize=void 0,this.filehash=void 0,this.contentInfo={},this.progressiveStage=void 0,this.parsedVcards=null}consolidate(e){return!!E(this,e)&&(this.notifyMsgsAsync(),!0)}clearBlob(e){const t=this.mediaBlob;t&&(this.mediaBlob=null,t.autorelease()),!0===(null==e?void 0:e.reset)&&this._resetDownloadLoadStage()}_resetDownloadLoadStage(){this.consolidate({downloadStage:_.DOWNLOAD_STAGE.INIT})}contentFields(){const e=this.type||_.TYPE.DOCUMENT;return _.FIELDS[e]}resolveWhenConsolidated(){return this._notifyTimer.ts||this._pendingChanges?new Promise((e=>{this._callOnConsolidate?this._callOnConsolidate.push(e):this._callOnConsolidate=[e]})):Promise.resolve()}notifyMsgsAsync(){this._notifyTimer.debounce(0)}addMsg(e){const t=this._msgs;for(let n=0;n<t.length;n++){const[r,i]=t[n];r!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-media-msg"))}t.push([e,!1]),this.notifyMsgsAsync()}removeMsg(e){const t=this._msgs;let n=!1;for(let r=0;!n&&r<t.length;r++){const[i,a]=t[r];i!==e||a||(t[r][1]=!0,n=!0)}}hasAssociatedMsgsOrStickers(){const e=this._msgs;for(let t=0;t<e.length;t++)if(!e[t][1])return!0;return this.hasAssociatedStickers()||this.hasAssociatedStickerPacks()}associatedMsgs(){const e=this._msgs,t=[];for(let n=0;n<e.length;n++){const[r,i]=e[n];i||t.push(r)}return t}rmr(e){var t=this;return(0,a.default)((function*(){const r=t.associatedStickers();if((0,l.isMDBackend)()){if(r.length>0&&S.ServerProps.webServerStickerPanel){if(0===t.associatedMsgs().filter((e=>null!=e)).length){return n(249264).RecentStickerCollectionMd.removeAndSave(r.map((e=>e.id))),r.forEach((e=>{e.delete()})),Promise.resolve(200)}}}else{if(r.length>0)return(0,f.rmrSticker)(t.entries,t._stickers,r[0]).then((e=>e.status));const e=t.associatedStickerPacks();if(e.length>0)return(0,f.rmrStickerPack)(t.entries,t._stickerPacks,e[0]).then((e=>e.status))}const[i]=t._msgs.find((e=>{let[t,n]=e;return!n&&!t.isUnsentPhoneMsg()}))||[null];if(i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject with no msg")),!i)return Promise.reject(new Error("rmr called on MediaObject with no msg"));e.onMsgSelect(i);const a=yield(0,m.default)(i);if(200===a.status){const e=i.mediaData.type;if("unknown"===e)return Promise.reject(new Error("rmr called on MediaData with unknown type"));const n=a.isMD?t.entries.updateEntry({deprecatedMms3Url:i.deprecatedMms3Url,encFilehash:i.encFilehash,directPath:a.directPath}):t.entries.addEntry({deprecatedMms3Url:a.url,mediaKey:a.mediaKey||i.mediaKey,mediaKeyTimestamp:a.mediaKeyTimestamp,encFilehash:a.encFilehash,type:e,directPath:a.directPath,debugHint:"rmr"});n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: rmr entry can not be found")),null==n||n.markWhetherOnServer(!0)}return a.status}))()}msgProps(e){const t={};T(t,this,_.FIELDS.RAW),T(t,this.contentInfo,this.contentFields()),T(t,e,_.MSG_SPECIFIC_FIELDS),t.preview=this.contentInfo._preview;const n={};for(const e in t){const r=_.MEDIA_TO_MSG[e];r&&(n[r]=t[e])}return n}delete(){this._saveMedia=null;const{cancelDownloadMedia:e,cancelUploadMedia:t}=n(778986);e(this),t(this),this.clearBlob()}runProcessIfNotRunBefore(e,t,n){let r=this._keyedProcesses;r||(r=this._keyedProcesses={}),r.hasOwnProperty(e)||(this._pendingChangesCount++,r[e]=Promise.resolve(n).then(t).then((e=>{this.consolidate(e)})).finally((()=>{this._pendingChangesCount--,0===this._pendingChangesCount&&this.notifyMsgsAsync()})))}getPendingProcess(e){return 0!==this._pendingChangesCount&&this._keyedProcesses&&this._keyedProcesses.hasOwnProperty(e)?this._keyedProcesses[e]:Promise.resolve()}videoStreamingInfo(e){var t=this;return(0,a.default)((function*(){if(t.type!==_.TYPE.VIDEO)return __LOG__(4,void 0,new Error,!0)`type: ${String(t.type)}`,void SEND_LOGS("media-fault: media streaming info request for non-video type");const n=t.entries.getDownloadEntry();if(!n||!n.sidecar)return null;const[r,a]=yield Promise.all([(0,g.default)(h.MEDIA_TYPES.VIDEO,n.mediaKey),n.url()]);return{cryptoKeys:(0,i.default)((0,i.default)({},r),{},{cipherKey:r.encKey,sidecar:n.sidecar}),streamData:{clientUrl:a,size:t.size,msgKey:e}}}))()}addStickerPack(e){const t=this._stickerPacks;for(let n=0;n<t.length;n++){const[r,i]=t[n];r!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-pack-add"))}t.push([e,!1]),this.notifyMsgsAsync()}addSticker(e){const t=this._stickers;for(let n=0;n<t.length;n++){const[r,i]=t[n];r!==e||i||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("redundant-sticker-add"))}t.push([e,!1]),this.notifyMsgsAsync()}removeSticker(e){const t=this._stickers;let n=!1;for(let r=0;!n&&r<t.length;r++){const[i,a]=t[r];i!==e||a||(t[r][1]=!0,n=!0)}}removeStickerPack(e){const t=this._stickerPacks;let n=!1;for(let r=0;!n&&r<t.length;r++){const[i,a]=t[r];i!==e||a||(t[r][1]=!0,n=!0)}}hasAssociatedStickers(){return this._stickers.some((e=>{let[t,n]=e;return!n}))}hasAssociatedStickerPacks(){return this._stickerPacks.some((e=>{let[t,n]=e;return!n}))}associatedStickers(){return this._stickers.reduce(((e,t)=>{let[n,r]=t;return r?e:e.concat(n)}),[])}associatedStickerPacks(){return this._stickerPacks.reduce(((e,t)=>{let[n,r]=t;return r?e:e.concat(n)}),[])}toJSON(){return{mediaBlob:this.mediaBlob,size:this.size,filehash:this.filehash,type:this.type,contentInfo:this.contentInfo,downloadStage:this.downloadStage,uploadStage:this.uploadStage}}}},422104:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.rmrSticker=function(){return u.apply(this,arguments)},t.rmrStickerPack=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=r(n(278403)),o=r(n(145095)),s=n(88555),l=r(n(656891)),c=n(661596);function u(){return(u=(0,i.default)((function*(e,t,n){if(n||(__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without sticker")),(0,s.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const r=yield l.default.mediaUpload("sticker",n.id),i=r.sticker;if(200===r.status&&i){const n=0;t.forEach((e=>{let[t,r]=e;r||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed!`,SEND_LOGS("rmrSticker:same-direct-path-after-rmr")),i.mediaKey=(0,o.default)((0,a.default)(i.mediaKey),"sanitizeBase64(nextSticker.mediaKey)"),t.deprecatedMms3Url=i.url,t.filehash=i.filehash,t.width=i.width,t.height=i.height,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=n,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const r=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:n,encFilehash:i.encFilehash,type:c.MEDIA_TYPES.STICKER,directPath:i.directPath,debugHint:"rmrSticker"});r&&r.markWhetherOnServer(!0)}return r}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t,n){if(n||(__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed!`,SEND_LOGS("media-fault: rmr called on MediaObject without stickerPack")),(0,s.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const r=yield l.default.mediaUpload("sticker-pack",n.id),i=r.stickerPack;if(200===r.status&&i){const n=0;t.forEach((e=>{let[t,r]=e;r||(t.directPath===i.directPath&&(__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed!`,SEND_LOGS("rmrStickerPack:same-direct-path-after-rmr")),t.url=i.url,t.filehash=i.filehash,t.mediaKey=i.mediaKey,t.mediaKeyTimestamp=n,t.directPath=i.directPath,t.encFilehash=i.encFilehash,i.mimetype&&(t.mimetype=i.mimetype))}));const r=e.addEntry({deprecatedMms3Url:i.url,mediaKey:i.mediaKey,mediaKeyTimestamp:n,encFilehash:i.encFilehash,type:c.MEDIA_TYPES.IMAGE,directPath:i.directPath,debugHint:"rmrStickerPack"});r&&r.markWhetherOnServer(!0)}return r}))).apply(this,arguments)}},494995:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(418412),s=n(535470),l=n(88555),c=n(585582),u=n(40234),d=j(n(551428)),p=n(408139),f=r(n(465212)),_=n(115461),h=n(623631),g=n(20551),m=r(n(376139)),y=n(978820),S=n(756406),E=r(n(534949)),v=r(n(597841)),T=r(n(992360)),C=r(n(846220)),A=n(284866),b=n(245554),P=r(n(502320)),O=j(n(988297)),M=n(58668),I=n(209329),w=n(70996),R=n(661596),N=n(818309),L=r(n(215554)),D=r(n(302603)),k=r(n(474460)),U=r(n(11339)),G=n(118146),x=n(964551),B=r(n(441143));function F(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(F=function(e){return e?n:t})(e)}function j(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=F(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function Y(e,t){return"product"===t.type?U.default.DOWNLOAD_ORIGIN_TYPE.PRODUCT_CATALOG:(0,G.unproxy)(e).isGroup?U.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP:U.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL}function K(e){return x.ServerProps.webUploadDocumentThumbMmsEnabled&&e===R.MEDIA_TYPES.DOCUMENT}function W(e,t,r){var o;__LOG__(2)`Media:sendToChat chat ${t.id.toString()}`;const{caption:P,footer:N}=r,G=r.quotedMsg?r.quotedMsg.msgContextInfo(t.id):{},F=(0,y.getMeUser)(),j=r.productMsgOptions||{};let W,H,V,$;!t.isUser&&(0,l.isMDBackend)()&&(W=F),t.isEphemeralSettingOn()&&(H=t.getEphemeralSetting());const z=t.getEphemeralSettingTimestamp();null!=z&&(V=z);const q=t.getDisappearingModeInitiator();null!=q&&($=q);const J=(0,i.default)({t:u.Clock.globalUnixTime(),from:F,isNewMsg:!0,to:t.id,self:"out",type:null!==(o=r.type)&&void 0!==o?o:e._baseType,ack:s.ACK.CLOCK,local:!0,id:new f.default({from:F,to:t.id,id:f.default.newId(),participant:W,selfDir:"out"}),caption:P,footer:N,quotedMsg:G.quotedMsg,quotedParticipant:G.quotedParticipant,quotedStanzaID:G.quotedStanzaID,quotedRemoteJid:G.quotedRemoteJid,mentionedJidList:r.mentionedJidList,isForwarded:r.isForwarded,forwardingScore:r.forwardingScore,multicast:r.multicast,forwardedFromWeb:r.forwardedFromWeb,ctwaContext:r.ctwaContext,ephemeralDuration:H,ephemeralSettingTimestamp:V,disappearingModeInitiator:$},j),Q=e.waitForPrep().then((e=>{const t=e.mediaBlob;return!t||t instanceof E.default?e:E.default.createFromData(t,t.type).then((t=>(e.mediaBlob=t,e)))})).then((e=>{const n=e.filehash;n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: sendToChat filehash undefined"));const i=O.getOrCreateMediaObject(n),a=i.mediaBlob;a&&(a.retain(),e.mediaBlob instanceof E.default&&e.mediaBlob.autorelease(),e.mediaBlob=a),e.mediaBlob instanceof E.default&&(e.renderableUrl=e.mediaBlob.url()),i.consolidate(e.toJSON()),e.mediaBlob instanceof E.default&&e.mediaBlob.autorelease();if((0,S.shouldUseMediaCache)((0,R.castToV4)(i.type))&&e.mediaBlob instanceof E.default){const t=e.mediaBlob.formData();A.MediaBlobCache.put(n,t)}(0,I.downloadMedia)({mimetype:e.mimetype,mediaObject:i,downloadEvenIfExpensive:!0,mediaType:(0,R.msgToMediaType)({type:e.type,isGif:e.isGif}),rmrReason:U.default.WEBC_RMR_REASON_CODE.SEND_TO_CHAT,downloadOrigin:Y(t,J),mode:"manual"});const o=i.msgProps(e);return o.caption=P,(0,p.documentWithCaptionsSendEnabled)()||P||e.type!==M.OUTWARD_TYPES.DOCUMENT||(o.caption=e.filename),r.isViewOnce&&(o.isViewOnce=!0),o}));let X,Z,ee;function te(){return ne.apply(this,arguments)}function ne(){return(ne=(0,a.default)((function*(e){X=e;const{mediaObject:n}=e;n||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: incorrect media object for created msg")),(0,B.default)(n,"msg is missing mediaObject");const r=(0,R.msgToMediaType)(e);e.type===_.MSG_TYPE.DOCUMENT&&(e.isCaptionByUser=!1,(0,p.documentWithCaptionsSendEnabled)()&&null!=e.caption&&""!==e.caption&&(e.isCaptionByUser=!0));const a=n.entries.getUploadEntry(),o=a?{key:a.mediaKey,timestamp:a.mediaKeyTimestamp}:(0,L.default)();let{fullPreviewData:s,fullPreviewSize:l}=n.contentInfo,u=e.body;if(K(r)&&!s&&n.contentInfo.preview){const e=yield d.base64ImageToCanvas(n.contentInfo.preview.url()),t=yield(0,c.generateMicroThumb)(e,1300,{mimetype:"image/jpeg",maxAttempts:10});s=n.contentInfo.preview,l={width:t.width,height:t.height},u=m.default.parseDataURL(t.dataUrl).data}const f=s&&l&&K(r),h=e.safe(),g=s&&f&&h.type===_.MSG_TYPE.DOCUMENT?(0,k.default)({thumbnail:s,mediaKeyInfo:o,mediaType:(0,T.default)(h),uploadOrigin:(0,C.default)(t),forwardedFromWeb:Boolean(e.forwardedFromWeb),isViewOnce:Boolean(e.isViewOnce)}):Promise.resolve(null),y=(0,w.uploadMedia)({mimetype:e.mimetype,mediaObject:n,mediaType:r,forwardedFromWeb:Boolean(e.forwardedFromWeb),uploadOrigin:(0,C.default)(t),mediaKeyInfo:o,isViewOnce:Boolean(e.isViewOnce)}),{filehash:S}=n;(0,b.shouldUseMediaKeyCache)()&&null!=S&&b.MediaKeyCache.put(S,o);const[{kind:E,mediaEntry:A},P]=yield Promise.all([y,g]);(0,v.default)(r)&&n.clearBlob({reset:!0});const O=null==P?void 0:P.mediaEntry;if(Z=E,!A)throw new Error("upload failed: media entry was not created");(0,b.shouldUseMediaKeyCache)()&&null!=S&&b.MediaKeyCache.delete(S);let M={};if(f){if(!(O&&P&&l)){const e={thumbnailResultEntry:O,uploadThumbnailResult:P,fullPreviewSize:l};throw __LOG__(4,void 0,new Error,!0)`upload failed: thumbnail data incomplete\nDebug info:${JSON.stringify(e)}`,SEND_LOGS("mms-thumbnail-data-incomplete"),new Error("upload failed: thumbnail data incomplete")}M={thumbnailDirectPath:O.directPath,thumbnailSha256:P.filehash,thumbnailEncSha256:O.encFilehash,thumbnailHeight:l.height,thumbnailWidth:l.width}}return(0,D.default)(X,(0,i.default)({deprecatedMms3Url:A.deprecatedMms3Url,directPath:A.directPath,mediaKey:A.mediaKey,mediaKeyTimestamp:A.mediaKeyTimestamp,filehash:n.filehash,encFilehash:A.encFilehash,size:n.size,streamingSidecar:A.sidecar,firstFrameSidecar:A.firstFrameSidecar,body:u},M))}))).apply(this,arguments)}if(r.addEvenWhilePreparing){const e=r.placeholderProps||{};ee=(0,h.addAndSendMsgToChat)(t,(0,i.default)((0,i.default)({},e),J),(e=>(X=e,Q.then((e=>(0,D.default)(X,e))).then((()=>te(X))))))[1]}else{const e=Q.then((e=>{const t=r.useBasePropsType?J.type:e.type;return(0,i.default)((0,i.default)((0,i.default)({},J),e),{},{type:t})}));ee=(0,h.addAndSendMsgToChat)(t,e,te)[1]}return ee.then((e=>({result:e,error:null}))).catch((e=>({result:null,error:e}))).then((e=>{var t,r;let{result:i,error:a}=e;if(i===g.SendMsgResult.OK)return X.type===M.OUTWARD_TYPES.STICKER&&((0,l.isMDBackend)()?x.ServerProps.webServerStickerPanel&&n(249264).RecentStickerCollectionMd.addStickerWithMediaData(X.mediaData,X.id.toString()):n(191692).RecentStickerCollection.addStickerWithMediaData(X.mediaData)),g.SendMsgResult.OK;const o=null===(t=X)||void 0===t||null===(r=t.mediaObject)||void 0===r?void 0:r.uploadStage;if(X&&(X.ack=s.ACK.FAILED),Z===w.UploadMediaResultKind.CANCELLATION)return __LOG__(2)`Media:sendToChat canceled`,g.SendMsgResult.ERROR_CANCELLED;if(__LOG__(3)`Media:sendToChat error\nresult: ${i}\nuploadStage: ${o}\nuploadResultKind: ${Z}\nerror: ${String(a)}`,null!=o)switch(o){case M.UPLOAD_STAGE.NEED_UPLOAD:case M.UPLOAD_STAGE.ERROR_TOO_LARGE:return g.SendMsgResult.ERROR_UPLOAD;case M.UPLOAD_STAGE.ERROR_MISSING:return g.SendMsgResult.ERROR_EXPIRED}return Z===w.UploadMediaResultKind.ERROR?g.SendMsgResult.ERROR_UPLOAD:null!=i?i:g.SendMsgResult.ERROR_UNKNOWN}))}t.default=class{constructor(e,t){this._baseType=e,this._mediaData=new P.default({mediaStage:M.MEDIA_DATA_STAGE.PREPARING}),this._prepwork=t.then((e=>{if(this._mediaData.set(e),!e.filehash)return e.mediaBlob||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("media-fault: no hash or blob")),(0,N.calculateFilehashFromBlob)(e.mediaBlob).then((e=>{this._mediaData.filehash=e}))}),(e=>{throw this._mediaData.mediaStage=M.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED,e}))}sendToChat(e,t){return(0,o.promiseCallSync)(W,null,this,e,t)}waitForPrep(){var e=this;return(0,a.default)((function*(){return yield e._prepwork,e._mediaData}))()}}},988297:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.associateMediaWithMsg=function(e,t){e.addMsg(t)},t.associateMediaWithSticker=function(e,t){e.addSticker(t)},t.associateMediaWithStickerPack=function(e,t){e.addStickerPack(t)},t.clearMediaForChat=function(){},t.delistAndDeleteAllMedia=function(){const e=s;s={};for(const t in e)e[t].delete()},t.disassociateMediaFromMsg=function(e,t){if(t.mediaObject=null,e.removeMsg(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:n}=e;n&&delete s[n];n&&(0,r.shouldUseLruMediaStore)((0,o.msgToMediaType)(t))&&i.LruMediaStore.del(n);e.delete()},t.disassociateMediaFromSticker=function(e,t){if(t.mediaObject=null,e.removeSticker(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:n}=e;n&&delete s[n];n&&i.LruMediaStore.del(n);e.delete()},t.disassociateMediaFromStickerPack=function(e,t){if(t.mediaObject=null,e.removeStickerPack(t),e.hasAssociatedMsgsOrStickers())return;const{filehash:n}=e;n&&delete s[n];n&&i.LruMediaStore.del(n);e.delete()},t.getOrCreateMediaObject=function(e){if(s.hasOwnProperty(e))return s[e];return s[e]=new a.MediaObject};var r=n(756406),i=n(555975),a=n(721009),o=n(661596);let s={}},58668:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD_STAGE=t.TYPE=t.OUTWARD_TYPES=t.MSG_TO_MEDIA=t.MSG_SPECIFIC_FIELDS=t.MEDIA_TO_MSG=t.MEDIA_MSG_PROPS=t.MEDIA_DATA_STAGE=t.MAPPED_STICKER_PROPS=t.MAPPED_MSG_PROPS=t.MAPPED_MEDIA_PROPS=t.FIELDS=t.DOWNLOAD_STAGE=void 0;const r=Object.freeze({preview:"body",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",fullHeight:"height",fullWidth:"width",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",sidecar:"streamingSidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl"});t.MEDIA_TO_MSG=r;const i=Object.freeze({body:"preview",directPath:"directPath",mediaKey:"mediaKey",mediaKeyTimestamp:"mediaKeyTimestamp",size:"size",filehash:"filehash",mimetype:"mimetype",duration:"duration",pageCount:"pageCount",height:"fullHeight",width:"fullWidth",type:"type",filename:"filename",caption:"caption",isGif:"isGif",gifAttribution:"gifAttribution",streamingSidecar:"sidecar",subtype:"subtype",firstFrameLength:"firstFrameLength",firstFrameSidecar:"firstFrameSidecar",isAnimated:"isAnimated",isVcardOverMmsDocument:"isVcardOverMmsDocument",isViewOnce:"isViewOnce",waveform:"waveform",staticUrl:"staticUrl",stickerPackId:"stickerPackId",stickerPackName:"stickerPackName",stickerPackPublisher:"stickerPackPublisher"});t.MSG_TO_MEDIA=i;const a=Object.keys(i);t.MAPPED_MSG_PROPS=a;const o=Object.keys(r);t.MAPPED_MEDIA_PROPS=o;t.MAPPED_STICKER_PROPS=["filehash","height","mimetype","size","type","width","stickerPackId","stickerPackName","stickerPackPublisher"];const s=[...a,"deprecatedMms3Url","encFilehash","streamable"];t.MEDIA_MSG_PROPS=s;const l=Object.freeze({VIDEO:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","duration","durationFloat","isViewOnce","fullPreviewData","staticUrl"]),AUDIO:Object.freeze(["duration","waveform"]),IMAGE:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview","isViewOnce","fullPreviewData","staticUrl"]),PRODUCT:Object.freeze(["aspectRatio","fullWidth","fullHeight","preview"]),STICKER:Object.freeze(["animationDuration","singleLoopDuration","emojis","firstFrameLength","firstFrameSidecar","isAnimated","isFirstParty","isFromStickerMaker","stickerPackId","stickerPackName","stickerPackPublisher","fullWidth","fullHeight","preview","rgbaBuffer","rgbaWidth","rgbaHeight","aspectRatio"]),STICKER_PACK:Object.freeze([]),DOCUMENT:Object.freeze(["aspectRatio","pageCount","preview","isVcardOverMmsDocument","parsedVcards","fullPreviewData","fullPreviewSize"]),RAW:Object.freeze(["mediaBlob","size","loadedSize","filehash","progressiveStage"]),BIZ_COVER_PHOTO:Object.freeze([])});t.FIELDS=l;t.MSG_SPECIFIC_FIELDS=["type","filename","caption","isGif","gifAttribution","mimetype","pageCount","sidecar","subtype","isViewOnce"];const c=n(76672).Mirrored(["INIT","EXISTS","PREPARING","REUPLOADING","FETCHING","PROCESSING","NEED_POKE","ERROR_MISSING","ERROR_UNSUPPORTED","PROGRESSIVE_READY","RESOLVED"]);t.DOWNLOAD_STAGE=c;const u=n(76672).Mirrored(["INIT","PREPARING","UPLOADING","FINALIZING","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","UPLOADED"]);t.UPLOAD_STAGE=u;const d=n(76672).Mirrored(["INIT","EXISTS","PREPARING","UPLOADING","FINALIZING","SENDING","REUPLOADING","FETCHING","DECRYPTING","RESOLVED","NEED_POKE","NEED_UPLOAD","ERROR_FILE_NOT_READABLE","ERROR_MISSING","ERROR_TOO_LARGE","ERROR_UNSUPPORTED","PROGRESSIVE_READY","REMOTE_UPLOADING","REMOTE_NEED_UPLOAD"]);t.MEDIA_DATA_STAGE=d;t.OUTWARD_TYPES={IMAGE:"image",VIDEO:"video",AUDIO:"audio",PTT:"ptt",STICKER:"sticker",DOCUMENT:"document",PRODUCT:"product",BIZ_COVER_PHOTO:"biz-cover-photo",UNKNOWN:"unknown"};const p=Object.freeze({VIDEO:"VIDEO",IMAGE:"IMAGE",AUDIO:"AUDIO",STICKER:"STICKER",DOCUMENT:"DOCUMENT",PRODUCT:"PRODUCT",BIZ_COVER_PHOTO:"BIZ_COVER_PHOTO"});t.TYPE=p},871644:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){try{const t=null!=e&&""!==e?JSON.parse(e):a.default,n={};return o(t,n,"",""),n}catch(e){return null}};var i=n(551737),a=r(n(47466));function o(e,t,n,r){let a=e;if(Array.isArray(a)||(0,i.isString)(a)){(0,i.isString)(a)&&(a=[a]);for(let e=0;e<a.length;e++){const o=a[e];(0,i.isString)(o)&&(t[o]=r+n)}}else if("object"==typeof a)for(const e in a)o(a[e],t,e,r+n)}},843257:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_MIMES=t.MSCFB_MIME=t.MSCFB_HEADER=t.MIMETYPE_DETERMINING_LENGTH=t.MIMETYPES=t.IMAGE_MIMES=t.EXT_TO_MIME=t.DOC_MIMES=t.DOCUMENT_MIMETYPES=void 0,t.getExtension=function(e){const t=d[e];return t?"."+(t.ext||e.split("/")[1]).toLowerCase():""},t.getMediaMimeType=function(e,t){const n=t.subarray(0,262),r=(0,l.default)(n);if(r)return r.mime;if("image"===e)return"image/jpeg";throw new o.MediaEncryptionError("unknown mime decrypt error for type:"+e)},t.isAllowedDocumentMimetype=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(const r in h){const i=d[r];if(null==i)continue;const{signatureMimetype:a,ext:o}=i;if((n?a:r)===e&&o&&(null==t?void 0:t.toLowerCase().endsWith(o.toLowerCase())))return r}if(n)return e;return null!=e?e:"application/octet-stream"},t.isMsCompoundFileBinaryFormat=function(e){return(0,a.default)(e,u)},t.isOpus=function(e){return!!e&&e.includes("audio/ogg")},t.previewType=function(e){const t=d[e];return null==t?void 0:t.previewType};var i=r(n(535937)),a=r(n(863438)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),s=r(n(871644)),l=r(n(397769));function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}t.MIMETYPE_DETERMINING_LENGTH=262;const u=new Uint8Array([208,207,17,224,161,177,26,225]);t.MSCFB_HEADER=u;t.MSCFB_MIME="application/x-cfb";const d={"text/plain":{ext:"TXT",msgType:"document",icon:"icon-doc-txt",canSend:!0},"text/rtf":{ext:"RTF",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/rtf"},"text/vcard":{ext:"VCF",msgType:"vcard"},"application/zip":{ext:"ZIP",icon:"icon-doc-generic",msgType:"document"},"application/pdf":{ext:"PDF",msgType:"document",icon:"icon-doc-pdf",canSend:!0,signatureMimetype:"application/pdf",previewType:"pdf"},"application/msword":{ext:"DOC",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-excel":{ext:"XLS",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.ms-powerpoint":{ext:"PPT",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/x-msi",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{ext:"DOCX",msgType:"document",icon:"icon-doc-doc",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{ext:"PPTX",msgType:"document",icon:"icon-doc-ppt",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{ext:"XLSX",msgType:"document",icon:"icon-doc-xls",canSend:!0,signatureMimetype:"application/zip",previewType:"msoffice"},"audio/aac":{msgType:"audio",ext:"AAC"},"audio/mp4":{msgType:"audio"},"audio/amr":{msgType:"audio"},"audio/mpeg":{msgType:"audio"},"audio/ogg; codecs=opus":{msgType:"audio",ext:"OGG"},"audio/wav":{msgType:"audio",ext:"wav"},"video/mp4":{msgType:"video",ext:"MP4"},"video/3gpp":{msgType:"video"},"image/jpeg":{msgType:"image"},"image/png":{msgType:"image"}},p=d;t.MIMETYPES=p;const f=(0,i.default)(p,(e=>"document"===(null==e?void 0:e.msgType)));t.DOCUMENT_MIMETYPES=f;t.DOC_MIMES="*";t.IMAGE_MIMES="image/*";t.VIDEO_MIMES="video/mp4,video/3gpp,video/quicktime";const _=(0,s.default)();t.EXT_TO_MIME=_;const h=(0,i.default)(d,(e=>"document"===(null==e?void 0:e.msgType)&&!0===e.canSend&&null!=e.ext))},600691:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FILE_PROGRESS_THROTTLE_WAIT_MS=void 0;t.FILE_PROGRESS_THROTTLE_WAIT_MS=100},661596:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MEDIA_TYPE_VALUES=t.MEDIA_TYPES=void 0,t.castToV4=function(e){let t;if(null==e)t=s.DOCUMENT;else{if(!(e in s))throw new Error(`castToV4: unexpected mmsv3 type ${e}`);t=s[e]}return t},t.getMsgMediaType=function(e){return c({type:e.type,interactiveHeader:e.interactiveHeader,isGif:e.type===a.MSG_TYPE.VIDEO&&e.isGif})},t.msgToMediaType=c;var i=r(n(252628)),a=n(115461),o=n(534535);const s=Object.freeze({AUDIO:"audio",DOCUMENT:"document",GIF:"gif",IMAGE:"image",NATIVE_FLOW:"native_flow",PPIC:"ppic",PRODUCT:"product",PTT:"ptt",STICKER:"sticker",VIDEO:"video",TEMPLATE:"template",THUMBNAIL_DOCUMENT:"thumbnail-document",THUMBNAIL_IMAGE:"thumbnail-image",THUMBNAIL_VIDEO:"thumbnail-video",THUMBNAIL_LINK:"thumbnail-link",HISTORY_SYNC:"md-msg-hist",MD_APP_STATE:"md-app-state",PRODUCT_CATALOG_IMAGE:"product-catalog-image",PAYMENT_BG_IMAGE:"payment-bg-image",BIZ_COVER_PHOTO:"biz-cover-photo"});t.MEDIA_TYPES=s;const l=(0,i.default)(s);function c(e){let{type:t,isGif:n,interactiveHeader:r}=e;switch(t){case a.MSG_TYPE.IMAGE:return s.IMAGE;case a.MSG_TYPE.VIDEO:return n?s.GIF:s.VIDEO;case a.MSG_TYPE.AUDIO:return s.AUDIO;case a.MSG_TYPE.PTT:return s.PTT;case a.MSG_TYPE.DOCUMENT:return s.DOCUMENT;case a.MSG_TYPE.STICKER:return s.STICKER;case a.MSG_TYPE.PRODUCT:return s.PRODUCT;case a.MSG_TYPE.NATIVE_FLOW:return s.NATIVE_FLOW;case a.MSG_TYPE.INTERACTIVE:if(null!=(null==r?void 0:r.mediaType))switch(r.mediaType){case o.InteractiveMessageHeaderMediaType.DOCUMENT:return s.DOCUMENT;case o.InteractiveMessageHeaderMediaType.VIDEO:return s.VIDEO;case o.InteractiveMessageHeaderMediaType.IMAGE:return s.IMAGE}}throw new Error(`msg is not a media msg: ${t}, isGif=${String(n)}`)}t.MEDIA_TYPE_VALUES=l},522283:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.default=n},818309:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.calculateFilehashFromBlob=function(e){return(e instanceof s.default?(0,o.opaqueDataToArrayBuffer)(e):(0,a.blobToArrayBuffer)(e)).then((e=>(0,i.calculateFilehash)(e))).catch((t=>{const n={error:`${t}`,blobSize:e.size,isOpaqueData:e instanceof s.default};__LOG__(3,void 0,void 0,!0)`calculateFilehashFromBlob error. Debug:\n${JSON.stringify(n,null,2)}`,SEND_LOGS("calculate-filehash-from-blob-error")}))};var i=n(541996),a=n(565885),o=n(756406),s=r(n(534949))},107407:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){const a=16*Math.ceil(e/16),o=t.slice(0,i.IV_LENGTH+a);return(0,r.hmacSha256)(n,o,i.HMAC_LENGTH)};var r=n(411141),i=n(471940)},471940:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.IV_LENGTH=t.HMAC_LENGTH=void 0,t.calculateStreamingSidecar=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=r(n(498913)),o=n(832428),s=n(411141);const l=65536;t.IV_LENGTH=16;function c(){return(c=(0,i.default)((function*(e,t){const n=e instanceof ArrayBuffer?e.byteLength:e.buffer.byteLength,r=Math.ceil((n-16)/l),i=(0,a.default)(r,(n=>{const r=n*l,i=e.slice(r,r+16+l);return(0,s.hmacSha256)(t,i,10)})),c=yield Promise.all(i);return(0,o.concatArrayBuffers)(...c)}))).apply(this,arguments)}t.HMAC_LENGTH=10},428011:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(181576),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=n(661596);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(){return(u=(0,i.default)((function*(e,t){const n=d(e);let r;try{r=(0,a.decodeB64)(t)}catch(e){}if(!t||!n||!r)throw new s.MediaEncryptionError(`createKeys fail: !!mediakey: ${!!t} info: ${n} type: ${e}`);const i=yield(0,o.extractAndExpand)(r,n,112);if(!i||i.byteLength<112)throw new s.MediaEncryptionError("computeMediaKeys: hkdf error");return{iv:i.slice(0,16),encKey:i.slice(16,48),macKey:i.slice(48,80),refKey:i.slice(80,112)}}))).apply(this,arguments)}function d(e){switch(e){case l.MEDIA_TYPES.AUDIO:return"WhatsApp Audio Keys";case l.MEDIA_TYPES.DOCUMENT:return"WhatsApp Document Keys";case l.MEDIA_TYPES.GIF:return"WhatsApp Video Keys";case l.MEDIA_TYPES.IMAGE:return"WhatsApp Image Keys";case l.MEDIA_TYPES.PPIC:throw new Error("Cannot create media keys for profile pics");case l.MEDIA_TYPES.PRODUCT:return"WhatsApp Image Keys";case l.MEDIA_TYPES.PTT:return"WhatsApp Audio Keys";case l.MEDIA_TYPES.STICKER:return"WhatsApp Image Keys";case l.MEDIA_TYPES.VIDEO:return"WhatsApp Video Keys";case l.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return"WhatsApp Document Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_IMAGE:return"WhatsApp Image Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_VIDEO:return"WhatsApp Video Thumbnail Keys";case l.MEDIA_TYPES.THUMBNAIL_LINK:return"WhatsApp Link Thumbnail Keys";case l.MEDIA_TYPES.TEMPLATE:throw new Error("Cannot create media keys for template");case l.MEDIA_TYPES.HISTORY_SYNC:return"WhatsApp History Keys";case l.MEDIA_TYPES.MD_APP_STATE:return"WhatsApp App State Keys";case l.MEDIA_TYPES.PRODUCT_CATALOG_IMAGE:throw new Error("Cannot create media keys for product catalog image");case l.MEDIA_TYPES.PAYMENT_BG_IMAGE:return"WhatsApp Payment Background Keys"}}},274994:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(781484),o=n(411141),s=n(607589),l=n(541996),c=n(846269),u=n(660977),d=n(435232),p=n(523125);const f=10;function _(){return(_=(0,i.default)((function*(e){let{mediaKeys:t,ciphertextHmac:n,expectedPlaintextHash:r,debugString:_}=e;if(yield Promise.resolve(),__LOG__(2)`decryptMedia: [${_}] start`,n.byteLength<f)throw new d.MediaDecryptionError(`ciphertext too short: ${n.byteLength}`);const{iv:h,encKey:g,macKey:m}=t,y=(0,c.castTypedArrays)(Uint8Array,n);try{return yield(0,o.hmacSha256)(m,(0,u.concatTypedArrays)(Uint8Array,[new Uint8Array(h),(0,p.isPerformanceExperimentEnabled)()?y.subarray(0,-10):y.slice(0,-10)]),f).then((e=>{const t=y.buffer.slice(-10);if(!(0,s.arrayBuffersEqual)(e,t))throw new d.MediaDecryptionError("decryptMedia: hmac mismatch");return(0,a.aesCbcDecrypt)(g,h,y.subarray(0,-10))})).then(function(){var e=(0,i.default)((function*(e){if(null==r)return e;if((yield(0,l.calculateFilehash)(e))!==r)throw new d.MediaDecryptionError("decryptMedia: plaintext hash mismatch");return __LOG__(2)`decryptMedia: [${_}] success`,e}));return function(){return e.apply(this,arguments)}}())}catch(e){if(__LOG__(3)`decryptMedia: [${_}] error`,e instanceof d.MediaDecryptionError)throw e;throw new d.MediaDecryptionError(`decryption error: ${String(e)}; stack: ${e.stack}`)}}))).apply(this,arguments)}},680733:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.decryptPartialMedia=t.decrypt=t.cleanupCiphertextAndIv=t.HMAC_SIZE=t.BLOCK_SIZE=void 0;var i=r(n(348926)),a=n(660977);t.BLOCK_SIZE=16;t.HMAC_SIZE=10;const o=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,iv:n,mediaKeys:r}=e,{encKey:i}=r;try{const e=yield self.crypto.subtle.importKey("raw",new Uint8Array(i),"AES-CBC",!1,["decrypt"]).catch((e=>{throw __LOG__(2)`decryptPartialMedia:decrypt importKey error: ${String(e)}`,e}));return self.crypto.subtle.decrypt({name:"AES-CBC",iv:n},e,t)}catch(e){throw __LOG__(2)`decryptPartialMedia:decrypt decrypt error: ${String(e)}`,e}}));return function(){return e.apply(this,arguments)}}();t.decrypt=o;const s=function(){var e=(0,i.default)((function*(e){const{ciphertext:t,mediaKeys:n}=e,{encKey:r}=n,i={name:"AES-CBC",iv:(t instanceof Uint8Array?t:new Uint8Array(t)).slice(-16)};try{const e=yield self.crypto.subtle.importKey("raw",new Uint8Array(r),"AES-CBC",!1,["encrypt"]).catch((e=>{__LOG__(2)`decryptPartialMedia:getEncryptedPadding importKey error: ${String(e)}`})),t=new Uint8Array([]);return self.crypto.subtle.encrypt(i,e,t)}catch(e){return void __LOG__(2)`decryptPartialMedia:getEncryptedPadding encrypt error: ${String(e)}`}}));return function(){return e.apply(this,arguments)}}(),l=e=>{const{serverRangeStart:t,ciphertext:n,mediaKeys:r}=e;let i=n instanceof Uint8Array?n:new Uint8Array(n);const o=i.byteLength%16==0;let l;return 0===t?l=new Uint8Array(r.iv):(l=i.slice(0,16),i=i.slice(16)),o||(i=i.slice(0,i.byteLength-10)),o?s({ciphertext:i,mediaKeys:r}).then((e=>(i=(0,a.concatTypedArrays)(Uint8Array,[i,new Uint8Array(e)]),{ciphertext:i,iv:l}))):Promise.resolve({ciphertext:i,iv:l})};t.cleanupCiphertextAndIv=l;const c=function(){var e=(0,i.default)((function*(e){let{mediaKeys:t,ciphertext:n}=e;const{ciphertext:r,iv:i}=yield l({serverRangeStart:0,ciphertext:n,mediaKeys:t});return o({ciphertext:r,iv:i,mediaKeys:t})}));return function(){return e.apply(this,arguments)}}();t.decryptPartialMedia=c},683899:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{mediaKey:t,plaintext:n,type:r}=e;return new Promise(((e,i)=>{if(t.slice(0,10),__LOG__(2)`encryptMedia: start`,!r)throw new d.MediaEncryptionError('encryptMedia: missing "type"');if(!t)throw new d.MediaEncryptionError('encryptMedia: missing "mediaKey"');(0,h.default)(r,t).then((e=>(0,m.isPerformanceExperimentEnabled)()?function(){return v.apply(this,arguments)}(n,r,e):function(){return y.apply(this,arguments)}(n,r,e))).then((t=>{__LOG__(2)`encryptMedia: success`,e(t)})).catch((e=>{if(__LOG__(3)`encryptMedia: error`,e instanceof d.MediaEncryptionError)throw e;throw new d.MediaEncryptionError(`encryption error: ${String(e)}; stack: ${e.stack}`)})).catch(i)}))};var i=r(n(348926)),a=n(832428),o=n(781484),s=n(411141),l=n(541996),c=n(367602),u=n(660977),d=n(435232),p=n(149520),f=r(n(107407)),_=n(471940),h=r(n(428011)),g=n(661596),m=n(523125);function y(){return(y=(0,i.default)((function*(e,t,n){let{iv:r,encKey:i,macKey:u}=n;const d=yield(0,o.aesCbcEncrypt)(i,e,r),h=d.slice(r.byteLength),m=yield(0,s.hmacSha256)(u,d,10);let y=Promise.resolve();if(t===g.MEDIA_TYPES.VIDEO||t===g.MEDIA_TYPES.AUDIO){const e=(0,a.concatArrayBuffers)(d,m);y=(0,_.calculateStreamingSidecar)(e,u)}let S=Promise.resolve();if(t===g.MEDIA_TYPES.STICKER){const{firstFrameLength:t}=(0,p.parseWebp)(e);if(null!=t){const e=(0,a.concatArrayBuffers)(d,m);S=(0,f.default)(t,e,u)}}const E=(0,a.concatArrayBuffers)(h,m);return(0,c.promiseProps)({ciphertextHmac:E,hash:(0,l.calculateFilehash)(E),sidecar:y,firstFrameSidecar:S})}))).apply(this,arguments)}function S(e){let{ivCiphertext:t,signature:n,macKey:r}=e;const i=(0,a.concatArrayBuffers)(t,n);return{sidecar:(0,_.calculateStreamingSidecar)(i,r),firstFrameSidecar:Promise.resolve()}}const E=new Map([[g.MEDIA_TYPES.VIDEO,S],[g.MEDIA_TYPES.AUDIO,S],[g.MEDIA_TYPES.STICKER,function(e){let{plaintext:t,ivCiphertext:n,signature:r,macKey:i}=e;const{firstFrameLength:o}=(0,p.parseWebp)(t);return{sidecar:Promise.resolve(),firstFrameSidecar:null!=o?(0,f.default)(o,(0,a.concatArrayBuffers)(n,r),i):Promise.resolve()}}]]);function v(){return(v=(0,i.default)((function*(e,t,n){var r,i;let{iv:a,encKey:d,macKey:p}=n;const f=(0,m.shouldEncryptInChunks)(e.byteLength)?yield(0,o.aesCbcEncryptWithChunking)(d,e,a):yield(0,o.aesCbcEncrypt)(d,e,a),_=new Uint8Array(f).subarray(a.byteLength),h=yield(0,s.hmacSha256)(p,f,10),{sidecar:g=Promise.resolve(),firstFrameSidecar:y=Promise.resolve()}=null!==(r=null===(i=E.get(t))||void 0===i?void 0:i({plaintext:e,ivCiphertext:f,signature:h,macKey:p}))&&void 0!==r?r:{},S=(0,u.concatTypedArrays)(Uint8Array,[_,new Uint8Array(h)]).buffer;return(0,c.promiseProps)({ciphertextHmac:S,hash:(0,l.calculateFilehash)(S),sidecar:g,firstFrameSidecar:y})}))).apply(this,arguments)}},627126:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageStreamer=t.EOI_TAG=void 0,t.getProgressiveMediaCacheKey=S;var i=r(n(348926)),a=n(271610),o=n(676100),s=n(559002),l=n(781484),c=n(411141),u=n(607589),d=n(640265),p=n(660977),f=n(284866);class _ extends((0,d.customError)("ChunkValidationError")){constructor(e){super(`Chunk ${e} does not match sidecar`)}}const h=16,g=new Uint8Array([2,2]),m=new Uint8Array([255,217]);t.EOI_TAG=m;function y(){return(y=(0,i.default)((function*(e,t){const{encKey:n}=t;return(yield(0,l.aesCbcEncrypt)(n,g,new Uint8Array(e.slice(-16)))).slice(-16)}))).apply(this,arguments)}function S(e,t){return`${e}-progressive-${t}`}t.ImageStreamer=class{constructor(e){this._alignedScanLengths=[],this._increasingScanLengths=[],this._lastDecryptedChunk=0,this._downloadedBytes=new ArrayBuffer(0);const{cryptoKeys:t,scanLengths:n,scansSidecar:r,filehash:i,mimetype:a,debugString:o,onProgressiveUpdate:s}=e;this._cryptoKeys=t,this._scanLengths=n,this._scansSideCar=r,this._filehash=i,this._mimetype=a,this._nextChunkIV=this._cryptoKeys.iv,this._decryptedChunks=new Array(n.length),this._onProgressiveUpdate=s,this._debugString=o}_validateSidecar(e,t){var n=this;return(0,i.default)((function*(){0===t&&(n._nextChunkIV=n._cryptoKeys.iv);const{macKey:r}=n._cryptoKeys,i=n._scansSideCar.slice(10*t,10*t+10),a=n._nextChunkIV;n._nextChunkIV=e.slice(-16);const o=(0,p.concatTypedArrays)(Uint8Array,[new Uint8Array(a),new Uint8Array(e)]),s=yield(0,c.hmacSha256)(r,o,10);if(!(0,u.arrayBuffersEqual)(s,i))throw new _(t)}))()}_cleanupCipherTextAndIV(e,t){var n=this;return(0,i.default)((function*(){let r=e;const i=r.byteLength%h==0;let a;if(0===t)a=n._cryptoKeys.iv;else{const e=n._increasingScanLengths[t-1];a=n._downloadedBytes.slice(e-h,e)}if(i||(r=r.slice(0,r.byteLength-10)),i){const e=yield function(){return y.apply(this,arguments)}(r,n._cryptoKeys);return{cipherText:(0,p.concatTypedArrays)(Uint8Array,[new Uint8Array(r),new Uint8Array(e)]),iv:a}}return{cipherText:r,iv:a}}))()}_getLastFullyLoadedChunkIndex(e){let t=0;for(let n=0;n<this._alignedScanLengths.length;n++)if(t+=this._alignedScanLengths[n],e<t)return n;return this._alignedScanLengths.length}_handleChunk(e,t){var n=this;return(0,i.default)((function*(){yield n._validateSidecar(e,t);const{cipherText:r,iv:i}=yield n._cleanupCipherTextAndIV(e,t),a=yield(0,l.aesCbcDecrypt)(n._cryptoKeys.encKey,i,r),o=yield(0,s.removeEncryptedPadding)(a,g.buffer);return __LOG__(2)`ImageStreamer: [${n._debugString}] Successfully decrypted chunk ${t} of ${n._scanLengths.length} total`,o}))()}_generateBlobFromFullyLoadedChunks(e){var t=this;return(0,i.default)((function*(){var n;const r=yield Promise.all(t._decryptedChunks.slice(0,e)),i=t._scanLengths.slice(0,e).reduce(((e,t)=>e+t),0),a=(0,p.concatTypedArrays)(Uint8Array,r.map((e=>new Uint8Array(e)))).slice(0,i),o=(0,u.arrayBuffersEqual)(m.buffer,a.slice(-m.length).buffer)?a:(0,p.concatTypedArrays)(Uint8Array,[a,m]),s=[o],l=t._mimetype?new Blob(s,{type:t._mimetype}):new Blob(s),c=S(t._filehash,e);return f.MediaBlobCache.put(c,l),__LOG__(2)`ImageStreamer: [${t._debugString}] Generated progressive image using ${e} chunks of ${t._scanLengths.length} total`,null===(n=t._onProgressiveUpdate)||void 0===n||n.call(t,e),t._lastDecryptedChunk=e,o.buffer}))()}_decryptFullyLoadedChunks(e,t){var n=this;return(0,i.default)((function*(){for(let r=0;r<t;r++)if(!n._decryptedChunks[r]){const t=0===r?0:n._increasingScanLengths[r-1],i=e.slice(t,t+n._alignedScanLengths[r]);yield Promise.all(n._decryptedChunks),n._decryptedChunks[r]||(n._decryptedChunks[r]=n._handleChunk(i,r))}}))()}handleProgress(e,t){var n=this;return(0,i.default)((function*(){if(!n._alignedScanLengths.length){n._alignedScanLengths=(0,a.alignChunkLengthsToMultipleOfAesBlockSize)(n._scanLengths,e);for(let e=0;e<n._alignedScanLengths.length;e++){const t=n._alignedScanLengths[e],r=0===e?t:n._increasingScanLengths[e-1]+t;n._increasingScanLengths.push(r)}}const r="string"==typeof t?t.length:t.byteLength,i=n._getLastFullyLoadedChunkIndex(r);if(i<=n._lastDecryptedChunk)return null;try{const e="string"==typeof t?yield(0,o.largeStringToArrayBuffer)(t):t;return n._downloadedBytes=e,yield n._decryptFullyLoadedChunks(n._downloadedBytes,i),yield n._generateBlobFromFullyLoadedChunks(i)}catch(e){__LOG__(3)`ImageStreamer:handleProgress error: ${e}`;const t=`${e.message}, [${n._debugString}]scanLengths length: ${n._scanLengths.length}, scansSidecar byteLength: ${n._scansSideCar.byteLength}.`;e instanceof _?(__LOG__(2)`ImageStreamer:chunk validation error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:chunk validation error`,SEND_LOGS("ImageStreamer:chunk validation error")):(__LOG__(2)`ImageStreamer:handleProgress error: ${t}`,__LOG__(4,void 0,new Error,!0)`ImageStreamer:handleProgress error`,SEND_LOGS("ImageStreamer:handleProgress error"))}}))()}}},215554:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),{key:(0,r.encodeB64)(e),timestamp:i.Clock.globalUnixTime()}};var r=n(615688),i=n(40234)},395987:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const n=(0,a.generateMediaEventId)(),r=new o.default.MediaDownload2({mediaId:n,connectionType:o.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,a.getMetricMediaType)(e.type),overallMmsVersion:4,networkStack:o.default.NETWORK_STACK_TYPE.NATIVE,overallDownloadMode:(0,a.getMetricOverallDownloadModeType)(e.type,e.downloadMode,e.isPrefetch),overallAttemptCount:e.userDownloadAttemptCount,overallDownloadOrigin:e.downloadOrigin,overallBackendStore:null!==(t=(0,a.getMetricBackendStore)(e.directPath))&&void 0!==t?t:void 0,isViewOnce:e.isViewOnce});return i.downloadUploadCrashLogger.mark(n,i.ProgressType.DOWNLOAD_STARTED),{mediaId:n,handleDownloadSuccess:e=>{r.set({overallMediaSize:e,overallDownloadResult:o.default.MEDIA_DOWNLOAD_RESULT_TYPE.OK,overallIsFinal:!0,downloadHttpCode:200}),i.downloadUploadCrashLogger.mark(n,i.ProgressType.DOWNLOAD_FINISHED,{overallMediaSize:e})},handleDownloadHostFound:e=>{let{hostName:t,hostClass:n,failCount:i}=e;r.set({overallDomain:t,overallConnectionClass:n,overallRetryCount:i})},handleDownloadError:(e,t)=>{r.set({overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(e),overallIsFinal:t});const n=(0,a.getStatusCode)(e);null!=n&&(r.downloadHttpCode=n),r.markOverallCumT(),r.commit(),(0,a.logErrorUnknownDetails)(r,e)},handleDownloadAttemptSuccess:e=>{r.set({overallT:e})},handleDownloadAttemptError:e=>{let{err:t,overallT:n,failCount:i}=e;const s=new o.default.MediaDownload2(r);s.set({mediaId:(0,a.generateMediaEventId)(),overallDownloadResult:(0,a.getMetricDownloadErrorResultType)(t),overallIsFinal:!1,overallT:n,overallRetryCount:i});const l=(0,a.getStatusCode)(t);null!=l&&(r.downloadHttpCode=l),r.markOverallCumT(),s.commit(),(0,a.logErrorUnknownDetails)(s,t)},handleDownloadAndDecryptSuccess:()=>{r.markOverallCumT(),r.commit()},markDecryptionEnd:()=>{r.markOverallDecryptT()},markDecryptionStart:()=>{r.startOverallDecryptT()}}};var i=n(622200),a=n(529992),o=r(n(11339))},847235:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadAndDecryptCache=void 0,t.getLRUStoreKey=l;var i=r(n(348926)),a=r(n(434475)),o=n(756406),s=n(555975);function l(e){var t,n;const r=null===(t=e.progressiveJpegOpts)||void 0===t?void 0:t.scanCount,i=null===(n=e.progressiveJpegOpts)||void 0===n?void 0:n.scanLengths;if(null!=r&&i)return`${e.filehash}-${r}/${i.length}-scans`;if(e.partialVideoOpts){const{secondsToDownload:t}=e.partialVideoOpts;return`${e.filehash}-${t}-seconds`}return e.filehash}t.DownloadAndDecryptCache=class{get(e,t){return(0,i.default)((function*(){if(!(0,o.shouldUseLruMediaStore)(t.type))return null;try{return yield s.LruMediaStore.get(l(t))}catch(e){return __LOG__(3,!0)`downloadManager.asyncCache.get error:\n${(0,a.default)(e)}`,null}}))()}set(e,t,n){return(0,i.default)((function*(){if((0,o.shouldUseLruMediaStore)(n.type))try{yield s.LruMediaStore.put(l(n),t)}catch(e){__LOG__(3,!0)`downloadManager.asyncCache.set error:\n${(0,a.default)(e)}`}}))()}}},826384:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadManager=void 0;var a=i(n(81109)),o=i(n(348926)),s=i(n(60411)),l=i(n(730844)),c=i(n(901577)),u=i(n(145095)),d=n(492574),p=n(435232),f=n(176562),_=i(n(434475)),h=i(n(395987)),g=n(847235),m=n(937115),y=i(n(756747)),S=n(721009),E=n(58668),v=n(661596),T=i(n(428011)),C=i(n(274994)),A=n(680733),b=n(627126),P=i(n(239436)),O=n(727856),M=n(622200),I=i(n(11339));const w=1,R=2,N=e=>{switch(e){case v.MEDIA_TYPES.THUMBNAIL_DOCUMENT:return R;case v.MEDIA_TYPES.VIDEO:default:return w}};function L(){return D.apply(this,arguments)}function D(){return(D=(0,o.default)((function*(e){const{directPath:t,encFilehash:n,filehash:i,mediaKey:a,onDecryptStart:o,downloadOrigin:s,staticUrl:l,type:c,mode:d,progressiveJpegOpts:p,partialVideoOpts:f,onProgress:g,userDownloadAttemptCount:m,isViewOnce:S}=e,E=null==p?void 0:p.scanCount,v=null!=E&&E===(null==p?void 0:p.scanLengths.length),I=v?null:E,{handleDownloadSuccess:w,handleDownloadHostFound:R,handleDownloadError:N,handleDownloadAttemptSuccess:L,handleDownloadAttemptError:D,handleDownloadAndDecryptSuccess:k,markDecryptionStart:U,markDecryptionEnd:G,mediaId:x}=(0,h.default)({directPath:t,downloadOrigin:s,type:c,userDownloadAttemptCount:m,isViewOnce:S,downloadMode:d,isPrefetch:null!=p&&!v}),F=e.signal||(new r).signal,j=i.slice(0,10);__LOG__(2)`downloadManager.download: [${j}] start`;try{let e=null;const r=(0,y.default)({partialVideoOpts:f,progressiveJpegOpts:p,scanCount:I}),s=null==I&&p?(t,n)=>{var r;null===(r=e)||void 0===r||r.handleProgress(t.total,n)}:null,[_,h,m]=yield Promise.all([(0,T.default)(c,a).then((t=>(p&&(e=new b.ImageStreamer({cryptoKeys:t,scanLengths:p.scanLengths,scansSidecar:p.scansSidecar,mimetype:p.mimetype,filehash:i,debugString:j,onProgressiveUpdate:p.onProgressiveUpdate})),t))),B({scanCount:I,directPath:t,encFilehash:n,type:c,signal:F}),P.default.download({directPath:t,encFilehash:n,staticUrl:l,type:c,signal:F,mode:d,byteRange:r,onResponseText:s,onDownloadHostFound:R,onDownloadAttemptSuccess:L,onDownloadAttemptError:D,debugString:j,onProgress:g})]);let S;var Y;if(o&&o(),w(m.byteLength),M.downloadUploadCrashLogger.mark(x,M.ProgressType.DOWNLOAD_DECRYPTION_STARTED),U(),null!=I)S=(0,u.default)(yield null===(Y=e)||void 0===Y?void 0:Y.handleProgress(h,m),"yield imageStreamer?.handleProgress(encryptedFileSize, ciphertextHmac)");else S=f?yield(0,A.decryptPartialMedia)({mediaKeys:_,ciphertext:m}):yield(0,C.default)({mediaKeys:_,ciphertextHmac:m,expectedPlaintextHash:i,debugString:j});return G(),M.downloadUploadCrashLogger.mark(x,M.ProgressType.DOWNLOAD_DECRYPTION_FINISHED),__LOG__(2)`downloadManager.download: [${j}] success`,k(),S}catch(t){throw t instanceof O.MediaNotFoundError?(N(t,Boolean(e.isFinalRmrRetry)),__LOG__(2,!0)`downloadManager.download: [${j}] expected error\n${(0,_.default)(t)}`):(N(t,!0),__LOG__(3,!0)`downloadManager.download: [${j}] error\n${(0,_.default)(t)}`),M.downloadUploadCrashLogger.mark(x,M.ProgressType.DOWNLOAD_ERROR),t}}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,o.default)((function*(e){var t,n;const{mediaObject:r}=e,i=null!==(t=null===(n=r.filehash)||void 0===n?void 0:n.slice(0,10))&&void 0!==t?t:"";r.filehash,r.type,__LOG__(2)`downloadManager.rmr: [${i}] start`,r.consolidate({downloadStage:E.DOWNLOAD_STAGE.REUPLOADING});const o=performance.now(),s=new I.default.WebcMediaRmr((0,a.default)((0,a.default)({},e.rmrData),{},{webcRmrReason:e.rmrReason})),l=(0,f.getEffectiveNetworkType)();null!=l&&(s.webcBrowserNetworkType=l),r.type&&(s.messageMediaType=(0,S.webMediaTypeToWamMediaType)(r.type)),null!=r.size&&(s.webcMediaSize=r.size);try{const e=yield r.rmr({onMsgSelect:function(e){null==s.webcChatType&&e.chat&&(s.webcChatType=e.chat.getWebcChatType()),null==s.webcMessageT&&(s.webcMessageT=e.t),s.messageMediaType=e.getWamMediaType()}});if(s.webcRmrStatusCode=e,__LOG__(2)`downloadManager.rmr: [${i}] status ${e}`,404===e)throw new m.MediaNotOnPhone;if(200!==e)throw new d.ServerStatusCodeError(e)}catch(e){throw s.webcMediaRmrError=!0,e instanceof m.MediaNotOnPhone?(__LOG__(2,!0)`downloadManager.rmr: [${i}] error MediaNotOnPhone\n${(0,_.default)(e)}`,e):(__LOG__(3,!0)`downloadManager.rmr: [${i}] error ${e.status||e.message}\n${e.stack}`,new p.MediaNeedsReupload)}finally{s.webcMediaRmrT=Math.ceil(performance.now()-o),s.commit()}}))).apply(this,arguments)}function G(){return x.apply(this,arguments)}function x(){return(x=(0,o.default)((function*(e){const{directPath:t,encFilehash:n,signal:i,type:a}=e;yield P.default.checkExistence({directPath:t,encFilehash:n,type:a,signal:i||(new r).signal})}))).apply(this,arguments)}function B(e){const{scanCount:t,directPath:n,encFilehash:r,type:i,signal:a}=e;return null==t?Promise.resolve(null):P.default.getEncryptedMediaSize({directPath:(0,u.default)(n,"directPath is required for partial downloads"),encFilehash:(0,u.default)(r,"encFilehash is required for partial downloads"),signal:a,type:i})}const F=new class{constructor(){this.preloader=new l.default(10,{thumbnail:4}),this.downloadAndDecrypt=(0,s.default)((e=>(0,g.getLRUStoreKey)(e)),new g.DownloadAndDecryptCache,(e=>!0===e.isPreload?this.preloader.enqueue((()=>L(e)),{priority:-N(e.type),group:"thumbnail",signal:e.signal}):L(e))),this.rmr=(0,c.default)((e=>e.mediaObject.filehash||""),k),this.checkExistence=(0,c.default)((e=>e.encFilehash),G),M.downloadUploadCrashLogger.init()}};t.downloadManager=F},937115:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaNotOnPhone=void 0;var r=n(492574);class i extends r.ServerStatusCodeError{constructor(){super(404),this.name="MediaNotOnPhone"}}t.MediaNotOnPhone=i},756747:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{partialVideoOpts:t,progressiveJpegOpts:n,scanCount:a}=e;if(n&&null!=a)return{start:0,end:(0,r.alignChunkLengthsToMultipleOfAesBlockSize)(n.scanLengths).slice(0,a).reduce(((e,t)=>e+t),0)};if(t){const{video:{size:e,duration:n},secondsToDownload:r}=t,a=Math.max(e*r/n,131072);return{start:0,end:Math.ceil(a/i.BLOCK_SIZE)*i.BLOCK_SIZE-1}}return null};var r=n(271610),i=n(680733)},840859:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoMediaHostsError=void 0;var r=n(640265);class i extends((0,r.customError)("NoMediaHostsError")){}t.NoMediaHostsError=i},546640:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={mediaHosts:!0};Object.defineProperty(t,"mediaHosts",{enumerable:!0,get:function(){return i.mediaHosts}});var i=n(282828);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},755514:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THRESHOLD=void 0,t.maybeSwitchHost=function(e,t,n,o){let{selectedHost:s,fallbackHost:l}=t,{selectedHost:c,fallbackHost:u}=n;if(o<i)return{changed:!1,host:e};switch(e.type){case r.HOST_TYPE.PRIMARY:if(!e.equals(c))return{changed:!0,host:c};break;case r.HOST_TYPE.FALLBACK:if(!s.equals(c))return{changed:!0,host:c};if(a(e,l,u)||a(e,s.fallback,c.fallback))return{changed:!0,host:s}}return{changed:!1,host:e}};var r=n(417930);const i=52428800;function a(e,t,n){return e.equals(t)&&null!=n&&null!=t&&!t.equals(n)}t.THRESHOLD=i},417930:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaHost=t.HOST_TYPE=void 0;var i=r(n(81109)),a=n(661596);const o=new Set(a.MEDIA_TYPE_VALUES),s=Object.freeze({PRIMARY:"primary",FALLBACK:"fallback"});t.HOST_TYPE=s;class l{constructor(e){this.hostname=e.hostname,this.ips=e.ips||[],this.type=e.type,this.class=e.class;const{downloadBuckets:t,supportedDownloadTypes:n,supportedUploadTypes:r}=function(e){var t,n;const r=e||[];let i,a,s;for(const e of r){if(e.download){var l;i=null!==(l=i)&&void 0!==l?l:new Set;for(const t of e.download)i.add(t)}if(e.upload){var c;a=null!==(c=a)&&void 0!==c?c:new Set;for(const t of e.upload)a.add(t)}e.downloadBuckets&&(s=e.downloadBuckets.map((e=>parseInt(e,10))))}return{supportedDownloadTypes:null!==(t=i)&&void 0!==t?t:o,supportedUploadTypes:null!==(n=a)&&void 0!==n?n:o,downloadBuckets:s}}(e.rules);this.downloadBuckets=t,this._supportedDownloadTypes=n,this._supportedUploadTypes=r,this.fallback=null!=e.fallback?new l((0,i.default)((0,i.default)((0,i.default)({},e),e.fallback),{},{type:"fallback",fallback:void 0})):null}equals(e){return this.hostname===(null==e?void 0:e.hostname)}isFallback(){return this.type===s.FALLBACK}supportsDownloadMediaType(e){return this._supportedDownloadTypes.has(e)}supportsUploadMediaType(e){const t="product-catalog-image"===e?"product":e;return this._supportedUploadTypes.has(t)}}t.MediaHost=l},282828:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.mediaHosts=t.FETCH_STATE=void 0;var a=i(n(506479)),o=i(n(348926)),s=n(389385),l=i(n(901577)),c=n(492574),u=n(481806),d=n(840859),p=n(417930),f=n(370426),_=n(713611);const h=["forceRefresh"],g=["name","message","stack"];t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};const m=new class{constructor(){var e=this;this._locked=!1,this._fetch=(0,l.default)((()=>"all"),function(){var t=(0,o.default)((function*(t){let{signal:n}=t;try{const t=yield(0,_.sendQueryMediaConn)(n);e._err=null,e._data={auth:t.auth,authExpirationTime:new Date(t.queryStartTime.getTime()+t.authTTL),authTTL:t.authTTL,hosts:t.hosts.map((e=>new p.MediaHost(e))),hostsRefreshTime:new Date(t.queryStartTime.getTime()+t.ttl),queryStartTime:t.queryStartTime,maxBuckets:t.maxBuckets}}catch(t){const i=t;var r;if(i instanceof c.E507)return e._data=e._previousData,e._previousData=null,e._locked=!0,void setTimeout((0,o.default)((function*(){yield e._refreshIfStale({signal:n}),e._locked=!1})),null!==(r=i.backoff)&&void 0!==r?r:void 0);if(e._data=null,e._err=i,i.name===s.ABORT_ERROR)return void __LOG__(2)`mediaHosts.sendQueryMediaConn aborted`;__LOG__(3,!0)`mediaHosts.sendQueryMediaConn error: ${function(e){const{name:t,message:n,stack:r}=e,i=(0,a.default)(e,g),o=(0,u.normalizeStack)(e),s=o.slice(o.indexOf("\n")+1),l=0===Object.keys(i).length?"":" "+JSON.stringify(i,((e,t)=>e&&"object"==typeof t?String(t):t));return`${e.name||"Error"}: ${e.message}${l}\n${s}`}(i)}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error fetching mms hosts")}}));return function(){return t.apply(this,arguments)}}()),this._reset()}getHostsInfo(e){var t=this;let{directPath:n,encFilehash:i,operation:a,type:s,signal:l,forceRefresh:c=!1}=e;return(0,o.default)((function*(){if(!t._locked){const e={signal:l||(new r).signal,forceRefresh:c};yield t._refreshIfStale(e)}if(!t._data)throw new d.NoMediaHostsError("no fetched data");const{auth:e,hosts:o,maxBuckets:u}=t._data,{selectedHost:p,fallbackHost:_}=(0,f.routeSelection)({directPath:n,encFilehash:i,hosts:o,operation:a,type:s,maxBuckets:u});if(!p)throw new d.NoMediaHostsError("no selected host");return{auth:e,selectedHost:p,fallbackHost:_}}))()}_isExpiredOrMissing(){if(!this._data)return!0;const e=this._data;return new Date>=e.authExpirationTime}_needsRefresh(){if(!this._data)return!0;const e=this._data;if(new Date>=e.hostsRefreshTime)return!0;const{authTTL:t,queryStartTime:n}=e,r=Math.floor(.8*t),i=new Date(n.getTime()+r);return new Date>=i}_refreshIfStale(e){var t=this;let{forceRefresh:n}=e,r=(0,a.default)(e,h);return(0,o.default)((function*(){return t._isExpiredOrMissing()||n?(t._reset(),yield t._fetch(r),!0):!!t._needsRefresh()&&(t._fetch(r),!1)}))()}_reset(){this._previousData=this._data,this._data=null,this._err=null}};t.mediaHosts=m},370426:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OPERATIONS=void 0,t.routeSelection=function(e){var t,n;let r,{encFilehash:c,directPath:u,hosts:d,operation:p,type:f,maxBuckets:_}=e;if(!d.length)return{selectedHost:null,fallbackHost:null};if(p===l.DOWNLOAD){const e=u?u.match(/&_nc_hot=([0-9]+)/):null,t=parseInt(null==e?void 0:e[1],10),n=Number.isNaN(t)?null:(0,a.unixTime)()-t,{mmsHotContentTimespan:l,mmsVCacheAggregationEnabled:p}=s.ServerProps;let h;null!=l&&l>0&&(f===o.MEDIA_TYPES.STICKER||null!=n&&n<=l)?h=1:p&&null!=_&&(h=(0,i.default)(c,_)+100);const g=function(e){const t=new Map;return e.forEach((e=>{var n;null===(n=e.downloadBuckets)||void 0===n||n.forEach((n=>{t.set(n,e)}))})),t}(d),m=null==h?null:g.get(h),y=g.get(0);(null==m?void 0:m.supportsDownloadMediaType(f))?r=m:(null==y?void 0:y.supportsDownloadMediaType(f))&&(r=y)}const h=d.find((e=>e.isFallback()));return r=null!==(t=r)&&void 0!==t?t:d.find((e=>p===l.UPLOAD?e.supportsUploadMediaType(f):e.supportsDownloadMediaType(f))),{selectedHost:null!==(n=r)&&void 0!==n?n:null,fallbackHost:null!=h?h:null}};var i=r(n(613353)),a=n(892844),o=n(661596),s=n(964551);const l={DOWNLOAD:"DOWNLOAD",UPLOAD:"UPLOAD"};t.OPERATIONS=l},727856:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MediaTooLargeError=t.MediaNotFoundError=t.MediaInvalidError=t.MMSUnauthorizedError=t.MMSThrottleError=t.MMSForbiddenError=void 0;var r=n(923082);class i extends r.HttpStatusCodeError{constructor(e){super(404,e),this.name="MediaNotFoundError"}}t.MediaNotFoundError=i;class a extends r.HttpStatusCodeError{constructor(e){super(413,e),this.name="MediaTooLargeError"}}t.MediaTooLargeError=a;class o extends r.HttpStatusCodeError{constructor(e){super(415,e),this.name="MediaInvalidError"}}t.MediaInvalidError=o;class s extends r.HttpStatusCodeError{constructor(e){super(401,e),this.name="MMSUnauthorizedError"}}t.MMSUnauthorizedError=s;class l extends r.HttpStatusCodeError{constructor(e){super(403,e),this.name="MMSForbiddenError"}}t.MMSForbiddenError=l;class c extends r.HttpStatusCodeError{constructor(e){super(507,e),this.name="MMSThrottleError"}}t.MMSThrottleError=c},821081:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{directPath:t,encFilehash:n,hostname:r,type:l,mode:c,byteRange:u}=e;if(t)return function(e){let{directPath:t,encFilehash:n,hostname:r,query:o}=e;const s=new URL(t,`https://${r}`);if(s.hostname!==r)throw __LOG__(4,void 0,new Error,!0)`url.hostname: ${s.hostname}, hostname: ${r}, directPath: ${t}`,SEND_LOGS("malicious directPath"),new Error("malicious directPath");const l=s.searchParams||new a.default(s.search);return l.set("hash",(0,i.default)(n)),Object.keys(o).forEach((e=>{const t=o[e];null!=t&&l.set(e,t)})),`https://${s.host}${s.pathname}?${l.toString()}`}({encFilehash:n,hostname:r,directPath:t,query:{mode:c,bytestart:null==u?void 0:u.start.toString(),byteend:null==u?void 0:u.end.toString(),[o.MMS_URL_MEDIA_TYPE_SEARCH_PARAM]:l,[o.IS_MMS_URL_SEARCH_PARAM]:""}});return(0,s.default)({hostname:r,type:l,encFilehash:n,query:{mode:c,[o.IS_MMS_URL_SEARCH_PARAM]:""}})};var i=r(n(827194)),a=r(n(177853)),o=n(841473),s=r(n(943311))},943311:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{hostname:t,type:n,encFilehash:r,query:l}=e;const c=(0,a.default)(s[n],"MEDIA_TYPE_TO_PATH[type]"),u=new URL(`https://${t}${c}/${(0,i.default)(r)}`),d={};l&&Object.keys(l).forEach((e=>{null!=l[e]&&(d[e]=l[e])}));let p=new o.default(d).toString();p&&(p=`?${p}`);return`https://${u.host}${u.pathname}${p}`};var i=r(n(827194)),a=r(n(145095)),o=r(n(177853));const s={audio:"/mms/audio",document:"/mms/document",gif:"/mms/gif",image:"/mms/image",ppic:"/pps/photo",product:"/mms/image",ptt:"/mms/ptt",sticker:"/mms/sticker","thumbnail-document":"/mms/thumbnail-document","thumbnail-link":"/mms/thumbnail-link",video:"/mms/video","md-app-state":"/mms/md-app-state","product-catalog-image":"/product/image","biz-cover-photo":"/pps/biz-cover-photo"}},542594:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n;let{auth:r,encFilehash:o,hostname:s,query:l,type:c,byteRange:u}=e;const d=null==l?void 0:l.final_hash;return(0,a.default)({encFilehash:o,hostname:s,type:c,query:{auth:r,token:(0,i.default)(o),resume:null==l||null===(t=l.resume)||void 0===t?void 0:t.toString(10),stream:null==l||null===(n=l.stream)||void 0===n?void 0:n.toString(10),final_hash:null!=d?(0,i.default)(d):void 0,bytestart:null==u?void 0:u.start.toString(10),byteend:null==u?void 0:u.end.toString(10)}})};var i=r(n(827194)),a=r(n(943311))},239436:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}r.default=e,n&&n.set(e,r);return r}(n(429221));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))}))},305489:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e instanceof i.MMSThrottleError)return!1;return e instanceof a.NoMediaHostsError||e instanceof r.HttpNetworkError||e instanceof i.MMSUnauthorizedError||e instanceof r.HttpStatusCodeError&&e.status>=500};var r=n(923082),i=n(727856),a=n(840859)},387206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={minTimeout:1e3,retries:3};t.default=n},379306:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(923082),o=n(727856),s=r(n(219242)),l=n(536823);const c="complete";function u(){return(u=(0,i.default)((function*(e){const t={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsCheckIfUploadExists: start`;try{const t=yield(0,s.default)(e),{directPath:n,url:r,handle:i,resume:l}=t;if(l===c){if(null==n||""===n)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing directPath");if(null==r||""===r)throw new a.HttpInvalidResponseError("mmsCheckIfUploadExists: missing url");return __LOG__(2)`mmsCheckIfUploadExists: success`,{directPath:n,url:r,handle:i,complete:!0}}const u=parseInt(l,10);if(0===u)throw new o.MediaNotFoundError("mmsCheckIfUploadExists");if(Number.isNaN(u))throw __LOG__(4,void 0,new Error,!0)`mmsCheckIfUploadExists: resume is NaN, resume=${u}`,SEND_LOGS("upload-offset-is-NaN"),new a.HttpInvalidResponseError("mmsCheckIfUploadExists: invalid resume");return{complete:!1,resume:u}}catch(e){throw(0,l.mmsLogError)("mmsCheckIfUploadExists",e,t),e}}))).apply(this,arguments)}},429221:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(81109)),o=i(n(348926)),s=n(757491),l=i(n(145095)),c=i(n(71197)),u=i(n(432309)),d=i(n(681602)),p=i(n(305489)),f=i(n(387206)),_=i(n(379306)),h=i(n(187439)),g=n(584062),m=n(536823),y=i(n(172702)),S=n(674641),E=i(n(666717)),v=n(729908),T=n(661596),C=i(n(522283)),A=n(546640),b=i(n(11339));function P(){return(P=(0,o.default)((function*(e){const{encFilehash:t,signal:n,type:r}=e;let i=!1;const l={encFilehash:e.encFilehash,type:e.type};__LOG__(2)`mmsClient.checkIfUploadExists: start`;try{let e=null;const l=yield(0,s.exponentialBackoff)((0,a.default)((0,a.default)({},f.default),{},{signal:n}),function(){var a=(0,o.default)((function*(a,o){__LOG__(2)`mmsClient.checkIfUploadExists: attempt #${o+1}`,yield d.default.waitIfOffline({signal:n});try{const{auth:a,selectedHost:s,fallbackHost:l}=yield A.mediaHosts.getHostsInfo({operation:C.default.UPLOAD,encFilehash:t,type:r,signal:n}),c=(0,E.default)({selectedHost:s,fallbackHost:l,lastHostUsed:e,attemptCount:o,lastFetchMadeProgress:i});return e=c,yield(0,_.default)({auth:a,encFilehash:t,hostname:c.hostname,type:r,signal:n,onProgress:()=>{i=!0}})}catch(e){if((0,p.default)(e))return a(e);throw e}}));return function(){return a.apply(this,arguments)}}());return __LOG__(2)`mmsClient.checkIfUploadExists: success`,l}catch(e){throw(0,m.mmsLogError)("mmsClient.checkIfUploadExists",e,l),e}}))).apply(this,arguments)}function O(){return(O=(0,o.default)((function*(e){const{encFilehash:t,type:n,onUploadAttemptSuccess:r}=e;__LOG__(2)`mmsClient.upload: start`;try{if((0,v.shouldUseStreamingUpload)(e.ciphertextHmac.byteLength,e.type)){const t=new v.UploadStreamer(e);return yield t.upload()}const{response:t,retryStartTime:n}=yield k(e);return r(Date.now()-n),__LOG__(2)`mmsClient.upload: success`,(0,l.default)(t,"response")}catch(e){throw(0,m.mmsLogError)("mmsClient.upload",e,{encFilehash:t,type:n},!1),e}}))).apply(this,arguments)}function M(){return(M=(0,o.default)((function*(e){const{directPath:t,encFilehash:n,type:r,debugString:i,staticUrl:a,onDownloadAttemptSuccess:o}=e;__LOG__(2)`mmsClient.download: [${i}] start`;try{const{response:t,retryStartTime:n}=yield R(e);return o(Date.now()-n),__LOG__(2)`mmsClient.download: [${i}] success`,t}catch(e){throw(0,m.mmsLogError)("mmsClient.download",e,{directPath:t,encFilehash:n,type:r,staticUrl:a}),e}}))).apply(this,arguments)}function I(e,t){const{directPath:n,encFilehash:r,type:i,signal:l}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,s.exponentialBackoff)((0,a.default)((0,a.default)({},f.default),{},{signal:l}),function(){var t=(0,o.default)((function*(t,a){__LOG__(2)`runMmsTaskWithBackoff: attempt #${a+1}`;try{const t=yield function(){return w.apply(this,arguments)}({operation:C.default.DOWNLOAD,directPath:n,encFilehash:r,type:i,signal:l,failCount:a});return yield e(t)}catch(e){if((0,p.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}function w(){return(w=(0,o.default)((function*(e){const{failCount:t,operation:n,directPath:r,encFilehash:i,type:a,signal:o}=e,{selectedHost:s,fallbackHost:l}=yield A.mediaHosts.getHostsInfo({operation:n,directPath:r,encFilehash:i,type:a,signal:o});return(t>=2&&l?l:s).hostname}))).apply(this,arguments)}function R(){return N.apply(this,arguments)}function N(){return(N=(0,o.default)((function*(e){let{debugString:t,signal:n,directPath:i,encFilehash:d,staticUrl:_,type:h,onDownloadHostFound:m,mode:y,byteRange:v,onDownloadAttemptError:T,onResponseText:b,onProgress:P}=e,O=Date.now(),M=!1,I=null;const w=yield(0,s.exponentialBackoff)((0,a.default)((0,a.default)({},f.default),{},{signal:n}),function(){var e=(0,o.default)((function*(e,a){O=Date.now(),__LOG__(2)`mmsClient.download: [${t}] attempt #${a+1}`;const s=e=>A.mediaHosts.getHostsInfo({operation:C.default.DOWNLOAD,directPath:i,encFilehash:d,type:h,signal:n,forceRefresh:e});try{const{selectedHost:e,fallbackHost:l}=yield s();let p=(0,E.default)({selectedHost:e,fallbackHost:l,attemptCount:a,lastHostUsed:I,lastFetchMadeProgress:M});I=p,m({hostName:p.hostname,hostClass:p.class,failCount:a});let f=0,T=null;const C={selectedHost:e,fallbackHost:l},A=e=>{if(null!=e&&null==T){const t=e.get("Content-Length"),n=parseInt(t,10);T=Number.isNaN(n)?null:n}};return yield(0,u.default)(function(){var e=(0,o.default)((function*(e){let{retry:a,failCount:o}=e;const l=e=>{null==P||P(e),M=!0,e.lengthComputable&&(f=e.loaded)};f=0;const u=new r,{signal:m}=u,E=yield(0,c.default)([n,m],(e=>{const n=(0,g.mms4Download)({directPath:i,encFilehash:d,staticUrl:_,hostname:p.hostname,type:h,signal:e,mode:y,byteRange:v,debugString:t,onHeadersReceived:A,onProgress:l,onResponseText:b}).then((e=>({kind:"download-completed",arrayBuffer:e}))),r=(0,S.shouldPollDownloadHosts)(h,T)?(0,S.pollMediaHosts)({connectionBlock:C,getHost:()=>p,getMediaHosts:()=>s(!0),getRemainingBytes:()=>null!=T?T-f:null,signal:e}).then((e=>({kind:"host-changed",host:e}))):null;return Promise.race([n,r].filter(Boolean)).finally((()=>u.abort()))}));return"host-changed"===E.kind?(p=E.host,I=p,a()):E.arrayBuffer}));return function(){return e.apply(this,arguments)}}())}catch(t){M=!1;const n=(0,p.default)(t);if(!n||a===f.default.retries||T({err:t,overallT:Date.now()-O,failCount:a}),n)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}());return{response:(0,l.default)(w,"response"),retryStartTime:O}}))).apply(this,arguments)}function L(){return D.apply(this,arguments)}function D(){return(D=(0,o.default)((function*(e){let{auth:t,encFilehash:n,hostname:r,type:i,signal:a,byteLength:o,byteOffset:s,failCount:l}=e;if(null!=s&&0===l)return s;if(!(0,S.shouldPollUploadHosts)(i,o))return 0;try{const e=yield(0,_.default)({auth:t,encFilehash:n,hostname:r,type:i,signal:a});if(e.complete)return 0;const{resume:s}=e;return s>=o?0:s}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to compute upload offset`,SEND_LOGS("upload-offset-failed"),0}}))).apply(this,arguments)}function k(){return U.apply(this,arguments)}function U(){return(U=(0,o.default)((function*(e){const{ciphertextHmac:t,encFilehash:n,type:i,signal:l,onUploadHostFound:_,onUploadAttemptError:h,onProgress:g,byteOffset:m}=e;let v=!1,T=Date.now(),P=null;return{response:yield(0,s.exponentialBackoff)((0,a.default)((0,a.default)({},f.default),{},{signal:l}),function(){var e=(0,o.default)((function*(e,a){const s=e=>A.mediaHosts.getHostsInfo({operation:C.default.UPLOAD,encFilehash:n,type:i,signal:l,forceRefresh:e});T=Date.now(),__LOG__(2)`mmsClient.upload: attempt #${a+1}`;try{yield d.default.waitIfOffline({signal:l});const{auth:e,selectedHost:p,fallbackHost:f}=yield s(),h={selectedHost:p,fallbackHost:f};let T=(0,E.default)({selectedHost:p,fallbackHost:f,attemptCount:a,lastHostUsed:P,lastFetchMadeProgress:v});return P=T,_({hostName:T.hostname,hostClass:T.class,failCount:a}),yield(0,u.default)(function(){var u=(0,o.default)((function*(o){let{retry:u}=o;const d=yield L({auth:e,encFilehash:n,byteLength:t.byteLength,hostname:T.hostname,type:i,signal:l,byteOffset:m,failCount:a}),p=new r,{signal:f}=p,_=yield(0,c.default)([l,f],(r=>{const a=(0,S.shouldPollUploadHosts)(i,t.byteLength)?(0,S.pollMediaHosts)({connectionBlock:h,getHost:()=>T,getMediaHosts:()=>s(!0),getRemainingBytes:()=>t.byteLength,signal:r}).then((e=>({kind:"host-changed",host:e}))):null,o=(0,y.default)({auth:e,ciphertextHmac:d>0?new Uint8Array(t).subarray(d):t,hostname:T.hostname,encFilehash:n,type:i,signal:l,onProgress:e=>{v=!0,g(e,d)},byteRange:d>0?{start:d,end:t.byteLength}:void 0}).then((e=>({kind:"upload-completed",value:e})));return Promise.race([o,a].filter(Boolean)).finally((()=>p.abort()))}));return"host-changed"===_.kind?(T=_.host,P=T,u()):_.value}));return function(){return u.apply(this,arguments)}}())}catch(t){v=!1;const n=(0,p.default)(t);if(!n||a===f.default.retries||h(t,Date.now()-T,a,b.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.UPLOAD),n)return e(t);throw t}}));return function(){return e.apply(this,arguments)}}()),retryStartTime:T}}))).apply(this,arguments)}function G(){return(G=(0,o.default)((function*(e){const{failCount:t,operation:n,directPath:r,encFilehash:i,type:a,signal:o}=e,{selectedHost:s,fallbackHost:l,auth:c}=yield A.mediaHosts.getHostsInfo({operation:n,directPath:r,encFilehash:i,type:a,signal:o});return{hostname:(t>=2&&l?l:s).hostname,auth:c}}))).apply(this,arguments)}var x={download:function(){return M.apply(this,arguments)},upload:function(){return O.apply(this,arguments)},checkExistence:function(e){return I((t=>(0,g.mmsCheckExistence)((0,a.default)((0,a.default)({},e),{},{hostname:t}))),e)},getEncryptedMediaSize:function(e){return I((t=>(0,g.mmsGetEncryptedMediaSize)((0,a.default)((0,a.default)({},e),{},{hostname:t}))),e)},checkIfUploadExists:function(){return P.apply(this,arguments)},deleteMdHistorySyncBlob:function(e){const{directPath:t,encFilehash:n}=e;return function(e,t){const{directPath:n,encFilehash:r,type:i,signal:l,operation:c}=t;return __LOG__(2)`runTaskWithBackoff: start`,(0,s.exponentialBackoff)((0,a.default)((0,a.default)({},f.default),{},{signal:l}),function(){var t=(0,o.default)((function*(t,a){__LOG__(2)`runMmsTaskWithBackoff: attempt #${a+1}`;try{const{hostname:t,auth:o}=yield function(){return G.apply(this,arguments)}({operation:c,directPath:n,encFilehash:r,type:i,signal:l,failCount:a});return yield e(t,o)}catch(e){if((0,p.default)(e))return t(e);throw e}}));return function(){return t.apply(this,arguments)}}())}(((e,r)=>(0,h.default)({directPath:t,hostname:e,encFilehash:n,auth:r})),(0,a.default)((0,a.default)({},e),{},{type:T.MEDIA_TYPES.IMAGE,operation:C.default.UPLOAD}))}};t.default=x},187439:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=r(n(827194)),s=n(923082),l=r(n(506631)),c=r(n(943311)),u=n(661596);function d(){return(d=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,auth:i}=e,d=t.split("?")[0],p=(new TextEncoder).encode(d),f=(0,a.encodeB64UrlSafe)(p),_=(0,c.default)({encFilehash:n,hostname:r,type:u.MEDIA_TYPES.IMAGE,query:{token:(0,o.default)(n),d_md:f,auth:i}}),h=yield(0,l.default)(_,{method:"DELETE"});if(!h.ok)throw new s.HttpStatusCodeError(h.status,"MMS Delete error")}))).apply(this,arguments)}},584062:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.mms4Download=function(e){let{directPath:t,encFilehash:n,staticUrl:r,hostname:o,type:s,signal:l,onProgress:c,onResponseText:d,onHeadersReceived:f,mode:_,byteRange:h,debugString:g}=e;const m=r||(0,u.default)({directPath:t,encFilehash:n,hostname:o,type:s,mode:_,byteRange:h});return function(){return p.apply(this,arguments)}({url:m,signal:l,onHeadersReceived:f,onProgress:c,onResponseText:d,ciphertextValidator:h?null:function(){var e=(0,i.default)((function*(e){return(yield(0,a.calculateFilehash)(e))===n}));return function(){return e.apply(this,arguments)}}(),debugString:g,debug:{encFilehash:n,type:s,url:m}})},t.mmsCheckExistence=function(){return f.apply(this,arguments)},t.mmsGetEncryptedMediaSize=function(){return _.apply(this,arguments)},t.validateMmsResponse=h;var i=r(n(348926)),a=n(541996),o=n(923082),s=n(589135),l=n(435232),c=n(727856),u=r(n(821081)),d=n(536823);function p(){return(p=(0,i.default)((function*(e){let{url:t,signal:n,onHeadersReceived:r,onProgress:i,onResponseText:a,debug:l,debugString:c,ciphertextValidator:u}=e;__LOG__(2)`mmsDownload: [${c}] start`;try{const e=yield(0,s.extendedFetch)(t,{signal:n,onProgress:i,onResponseText:a,onHeadersReceived:r});yield h({response:e,functionName:"mmsDownload",url:t});const l=yield e.arrayBuffer();if(u&&!(yield u(l)))throw __LOG__(3)`download hash mismatch error. downloaded size: ${l.byteLength}`,new o.MmsDownloadFilehashMismatchError({url:t});return __LOG__(2)`mmsDownload: [${c}] success`,l}catch(e){throw(0,d.mmsLogError)("mmsDownload",e,l),e}}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,type:i,signal:a}=e;yield m({directPath:t,encFilehash:n,hostname:r,type:i,signal:a,functionName:"mmsCheckExistence"})}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,type:i,signal:a}=e,o=(yield m({directPath:t,encFilehash:n,hostname:r,type:i,signal:a,functionName:"mmsGetEncryptedMediaSize"})).headers.get("content-length");if(!o)throw new l.UnableToGetContentLengthError;return parseInt(o,10)}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){const{response:t,url:n,functionName:r}=e;if(!t.ok)switch(t.status){case 401:throw new c.MMSUnauthorizedError(r,{url:n});case 403:if((yield t.text()).includes("URL signature expired"))throw new c.MediaNotFoundError(r,{url:n,status:t.status});throw new c.MMSForbiddenError(r,{url:n});case 404:case 410:throw new c.MediaNotFoundError(r,{url:n,status:t.status});case 507:throw new c.MMSThrottleError(r,{url:n});default:throw new o.HttpStatusCodeError(t.status,r,{url:n})}}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){const{directPath:t,encFilehash:n,hostname:r,type:i,signal:a,functionName:o}=e,l=(0,u.default)({directPath:t,encFilehash:n,hostname:r,type:i,mode:"auto"}),c=yield(0,s.extendedFetch)(l,{method:"HEAD",signal:a});return yield h({response:c,functionName:o,url:l}),c}))).apply(this,arguments)}},219242:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(923082),o=n(589135),s=n(727856),l=r(n(542594)),c=n(536823);function u(){return(u=(0,i.default)((function*(e){const{auth:t,encFilehash:n,hostname:r,signal:i,type:u,onProgress:d}=e,p=(0,l.default)({auth:t,encFilehash:n,hostname:r,query:{resume:1},type:u});__LOG__(2)`mmsGetUploadProgress: start`;try{const e=yield(0,o.extendedFetch)(p,{method:"post",signal:i,onProgress:d});if(!e.ok)switch(e.status){case 401:throw new s.MMSUnauthorizedError("mmsGetUploadProgress",{url:p});case 404:throw new s.MediaNotFoundError("mmsGetUploadProgress",{url:p});default:throw new a.HttpStatusCodeError(e.status,"mmsGetUploadProgress",{url:p})}const t=yield e.json();if(!t.resume)throw new a.HttpInvalidResponseError("mmsGetUploadProgress: missing resume",{url:p});return __LOG__(2)`mmsGetUploadProgress: success`,{directPath:t.direct_path,resume:t.resume,url:t.url,handle:t.handle}}catch(e){throw(0,c.mmsLogError)("mmsUpload",e,{encFilehash:n,type:u,url:p}),e}}))).apply(this,arguments)}},536823:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mmsLogError=function(e,t){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t instanceof i.MediaNotFoundError&&n?__LOG__(2)`${e}: expected error`:"object"==typeof t&&(null==t?void 0:t.name)===r.ABORT_ERROR?__LOG__(2)`${e}: canceled`:__LOG__(3)`${e}: error`};var r=n(389385),i=n(727856)},172702:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(348926)),a=n(923082),o=n(589135),s=n(727856),l=r(n(542594)),c=n(536823),u=n(661596);function d(e){if(null==e.direct_path||""===e.direct_path)throw new a.HttpInvalidResponseError("mmsUpload: missing direct_path");if(null==e.url||""===e.url)throw new a.HttpInvalidResponseError("mmsUpload: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}function p(e){if(null==e.ts)throw new a.HttpInvalidResponseError("mmsUpload: missing ts (timestamp)");if(null==e.meta_hmac)throw new a.HttpInvalidResponseError("mmsUpload: missing meta_hmac");if(null==e.fbid)throw new a.HttpInvalidResponseError("mmsUpload: missing fbid");return{directPath:"",url:"",ts:e.ts,metaHmac:e.meta_hmac,fbid:e.fbid}}function f(){return(f=(0,i.default)((function*(e){const{auth:t,ciphertextHmac:n,encFilehash:r,hostname:i,type:f,signal:_,onProgress:h,byteRange:g}=e,m=(0,l.default)({auth:t,encFilehash:r,hostname:i,type:f,byteRange:g});__LOG__(2)`mmsUpload: start`;try{const e=f===u.MEDIA_TYPES.BIZ_COVER_PHOTO?p:d,t=yield(0,o.extendedFetch)(m,{method:"post",body:n,signal:_,onProgress:h}).then((e=>{if(!e.ok)switch(e.status){case 401:throw new s.MMSUnauthorizedError("mmsUpload",{url:m});case 413:throw new s.MediaTooLargeError("mmsUpload",{url:m});case 415:throw new s.MediaInvalidError("mmsUpload: hash mismatch",{url:m});case 507:throw new s.MMSThrottleError("mmsUpload",{url:m});default:throw new a.HttpStatusCodeError(e.status,"mmsUpload",{url:m})}return e.json()})).then(e);return __LOG__(2)`mmsUpload: success`,t}catch(e){throw(0,c.mmsLogError)("mmsUpload",e,{encFilehash:r,type:f,url:m},!1),e}}))).apply(this,arguments)}},41486:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.mmsUploadStream=function(e){let{auth:t,encFilehash:n,type:r,hostname:i,byteStart:a,byteEnd:s,chunk:c,signal:d,onProgress:p}=e;const f=(0,l.default)({auth:t,encFilehash:n,type:r,hostname:i,query:{stream:1},byteRange:{start:a,end:s}});return(0,o.extendedFetch)(f,{method:"post",body:c,signal:d,onProgress:p}).then((e=>{e.ok||u(e.status,"mmsUploadStream",f)}))},t.mmsUploadStreamFinalize=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(923082),o=n(589135),s=n(727856),l=r(n(542594)),c=n(536823);function u(e,t,n){switch(e){case 401:throw new s.MMSUnauthorizedError(t,{url:n});case 413:throw new s.MediaTooLargeError(t,{url:n});case 415:throw new s.MediaInvalidError(`${t}: hash mismatch`,{url:n});case 507:throw new s.MMSThrottleError("mmsUploadStreamFinalize",{url:n});default:throw new a.HttpStatusCodeError(e,t,{url:n})}}function d(){return(d=(0,i.default)((function*(e){let{auth:t,encFilehash:n,type:r,hostname:i,finalHash:s,signal:d}=e;const p=(0,l.default)({auth:t,encFilehash:n,type:r,hostname:i,query:{stream:1,final_hash:s}});__LOG__(2)`mmsUploadStreamFinalize: start`;try{const e=yield(0,o.extendedFetch)(p,{method:"post",signal:d}).then((e=>(e.ok||u(e.status,"mmsUploadStreamFinalize",p),e.json()))).then((e=>{if(null==e.direct_path||""===e.direct_path)throw new a.HttpInvalidResponseError("mmsUploadStreamFinalize: missing direct_path");if(null==e.url||""===e.url)throw new a.HttpInvalidResponseError("mmsUploadStreamFinalize: missing url");return{directPath:e.direct_path,url:e.url,handle:e.handle}}));return __LOG__(2)`mmsUploadStreamFinalize: success`,e}catch(e){throw(0,c.mmsLogError)("mmsUpload",e,{encFilehash:n,type:r,url:p},!1),e}}))).apply(this,arguments)}},674641:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_POLLING_INTERVAL=void 0,t.pollMediaHosts=function(){return d.apply(this,arguments)},t.shouldPollDownloadHosts=function(e,t){return c.ServerProps.downloadHostSwitchingEnabled&&e===s.MEDIA_TYPES.DOCUMENT&&(null!=t?t:0)>l.THRESHOLD},t.shouldPollUploadHosts=function(e,t){return c.ServerProps.uploadHostSwitchingEnabled&&e===s.MEDIA_TYPES.DOCUMENT&&t>l.THRESHOLD};var i=r(n(348926)),a=n(413959),o=r(n(432309)),s=n(661596),l=n(755514),c=n(964551);const u=3e5;function d(){return(d=(0,i.default)((function*(e){let t=e.connectionBlock;return yield(0,a.delayMs)(u,e.signal),(0,o.default)((n=>{let{retry:r}=n;return new Promise((n=>e.getMediaHosts().then((i=>{let{selectedHost:a,fallbackHost:o}=i;const s={selectedHost:a,fallbackHost:o},c=e.getRemainingBytes();if(null==c)return r(u);const{changed:d,host:p}=(0,l.maybeSwitchHost)(e.getHost(),t,s,c);return t=s,d?n(p):r(u)}))))}),e.signal)}))).apply(this,arguments)}t.SERVER_POLLING_INTERVAL=u},666717:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{selectedHost:t,fallbackHost:n,attemptCount:r,lastHostUsed:i,lastFetchMadeProgress:a}=e;if(a&&i)return i;if(r<=1)return t;if(3===r&&n)return n;if((null==i?void 0:i.equals(t))&&null!=t.fallback)return t.fallback;return null!=n?n:t}},729908:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadStreamer=void 0,t.shouldUseStreamingUpload=function(e,t){return T.ServerProps.streamingUploadChunkSize>0&&t===y.MEDIA_TYPES.DOCUMENT&&e>T.ServerProps.streamingUploadChunkSize};var a=i(n(506479)),o=i(n(81109)),s=i(n(348926)),l=n(757491),c=i(n(71197)),u=i(n(432309)),d=n(923082),p=i(n(681602)),f=i(n(305489)),_=i(n(387206)),h=n(41486),g=n(674641),m=i(n(666717)),y=n(661596),S=n(282828),E=n(370426),v=i(n(11339)),T=n(964551);const C=["auth"];function A(e,t){return(0,f.default)(e)&&t<_.default.retries}t.UploadStreamer=class{constructor(e){var t;this._retryStartTime=Date.now(),this._lastUploadedChunkIndex=0,this._offset=0,this._config=e,this._payload=new Uint8Array(e.ciphertextHmac),this._debugString=e.encFilehash.slice(0,10),this._chunkSize=0===T.ServerProps.streamingUploadChunkSize?this._payload.byteLength:T.ServerProps.streamingUploadChunkSize,this._offset=null!==(t=e.byteOffset)&&void 0!==t?t:0}upload(){var e=this;return(0,s.default)((function*(){e._config.onStreamUploadStart(),__LOG__(2)`uploadStreamer: [${e._debugString}] start upload`,yield p.default.waitIfOffline({signal:e._config.signal});const t=Math.ceil((e._payload.byteLength-e._offset)/e._chunkSize);for(let n=0;n<t;n++){e._logChunkUploadProgress(n,t);const r=e._offset+n*e._chunkSize,i=r+e._chunkSize,a=e._payload.subarray(r,i);yield e._uploadChunkWithBackoff(a,r)}const n=yield e._finalizeWithBackoff();return e._config.onUploadAttemptSuccess(Date.now()-e._retryStartTime),n}))()}_resetRetryStartTime(){this._retryStartTime=Date.now()}_getAttemptTime(){return Date.now()-this._retryStartTime}_getRemainingBytes(){return this._payload.byteLength-this._lastUploadedChunkIndex*this._chunkSize}_logChunkUploadProgress(e,t){__LOG__(2)`uploadStreamer: [${this._debugString}] uploading chunk ${e+1}/${t}`}_uploadChunkWithBackoff(e,t){var n=this;return(0,l.exponentialBackoff)((0,o.default)((0,o.default)({},_.default),{},{signal:this._config.signal}),function(){var r=(0,s.default)((function*(r,i){try{yield n._uploadChunk(e,t,i)}catch(e){if(A(e,i))return n._config.onUploadAttemptError(e,n._getAttemptTime(),i,v.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.UPLOAD),n._resetRetryStartTime(),r(e);throw e}}));return function(){return r.apply(this,arguments)}}())}_finalizeWithBackoff(){var e=this;return(0,l.exponentialBackoff)((0,o.default)((0,o.default)({},_.default),{},{signal:this._config.signal}),function(){var t=(0,s.default)((function*(t,n){try{var r,i;return null===(r=(i=e._config).onFinalize)||void 0===r||r.call(i),yield e._finalize(n)}catch(r){if(function(e,t){return!(e instanceof d.HttpStatusCodeError&&e.status>=500)&&A(e,t)}(r,n))return e._config.onUploadAttemptError(r,e._getAttemptTime(),n,v.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.FINALIZE),e._resetRetryStartTime(),t(r);throw r}}));return function(){return t.apply(this,arguments)}}())}_uploadChunk(e,t,n){var i=this;return(0,s.default)((function*(){let o=null,l=!1;yield p.default.waitIfOffline({signal:i._config.signal});const d=yield i._getMediaHosts(n),{auth:f}=d,_=(0,a.default)(d,C);let y=o=(0,m.default)({selectedHost:_.selectedHost,fallbackHost:_.fallbackHost,lastHostUsed:o,lastFetchMadeProgress:l,attemptCount:n});const S=e=>{l=!0,i._config.onProgress(e,t)};return(0,u.default)(function(){var a=(0,s.default)((function*(a){let{retry:s}=a;const l=new r,{signal:u}=l,d=yield(0,c.default)([u,i._config.signal],(r=>{const a=(0,g.shouldPollUploadHosts)(i._config.type,i._payload.byteLength)?(0,g.pollMediaHosts)({connectionBlock:_,signal:r,getHost:()=>y,getMediaHosts:()=>i._getMediaHosts(n,!0),getRemainingBytes:()=>i._getRemainingBytes()}).then((e=>({host:e,kind:"host-changed"}))):null,o=(0,h.mmsUploadStream)({auth:f,encFilehash:i._config.encFilehash,type:i._config.type,hostname:y.hostname,byteStart:t,byteEnd:t+e.byteLength,chunk:e,signal:r,onProgress:S}).then((()=>({kind:"upload-completed"})));return Promise.race([o,a].filter(Boolean)).finally((()=>l.abort()))}));if("host-changed"===d.kind)return o=y,y=d.host,s()}));return function(){return a.apply(this,arguments)}}())}))()}_finalize(e){var t=this;return(0,s.default)((function*(){yield p.default.waitIfOffline({signal:t._config.signal});const{auth:n,selectedHost:r}=yield t._getMediaHosts(e);return __LOG__(2)`uploadStreamer: [${t._debugString}] finalizing`,(0,h.mmsUploadStreamFinalize)({auth:n,hostname:r.hostname,encFilehash:t._config.encFilehash,finalHash:t._config.encFilehash,type:t._config.type,signal:t._config.signal})}))()}_getMediaHosts(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.default)((function*(){const r=yield S.mediaHosts.getHostsInfo({operation:E.OPERATIONS.UPLOAD,encFilehash:t._config.encFilehash,type:t._config.type,signal:t._config.signal,forceRefresh:n});return t._config.onUploadHostFound({failCount:e,hostName:r.selectedHost.hostname,hostClass:r.selectedHost.class}),r}))()}}},51127:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r,l){const c=(0,o.generateMediaEventId)(),u=new s.default.MediaUpload2({mediaId:c,connectionType:s.default.CONNECTION_TYPE.HOSTNAME,overallMediaType:(0,o.getMetricMediaType)(e),overallMmsVersion:4,overallAttemptCount:n,networkStack:s.default.NETWORK_STACK_TYPE.NATIVE,overallUploadMode:(0,o.getMetricOverallUploadModeType)(e),overallIsForward:r,overallUploadOrigin:t,uploadSource:(0,a.default)(t,r),isViewOnce:l,overallUserVisibleT:0});return{handleStreamUploadStart:function(){u.set({uploadIsStreaming:!0})},handleArrayBufferCreated:function(e){u.set({overallMediaSize:e})},handleCheckExistingError:function(e){e instanceof i.HttpStatusCodeError&&u.set({resumeHttpCode:e.status})},handleCheckExistingSuccess:function(){u.set({overallUploadResult:s.default.MEDIA_UPLOAD_RESULT_TYPE.DUPLICATE,overallIsFinal:!0,resumeHttpCode:200}),u.markOverallCumT(),u.commit()},handleUploadHostFound:function(e){let{hostName:t,hostClass:n,failCount:r}=e;u.set({overallDomain:t,overallConnectionClass:n,overallRetryCount:r})},handleUploadSuccess:function(){u.set({resumeHttpCode:404,overallUploadResult:s.default.MEDIA_UPLOAD_RESULT_TYPE.OK,overallIsFinal:!0,uploadHttpCode:200,finalizeHttpCode:200}),u.markOverallCumT(),u.commit()},handleUploadError:function(e){u.set({overallUploadResult:(0,o.getMetricUploadErrorResultType)(e),overallIsFinal:!0});const t=(0,o.getStatusCode)(e);null!=t&&(u.uploadHttpCode=t,u.finalizeHttpCode=t),u.markOverallCumT(),u.commit(),(0,o.logErrorUnknownDetails)(u,e)},handleUploadAttemptSuccess:function(e){u.set({overallT:e})},handleUploadAttemptError:function(e,t,n,r){const i=new s.default.MediaUpload2(u),a=(0,o.getStatusCode)(e),l=r===s.default.OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE.FINALIZE?a:i.finalizeHttpCode;i.set({mediaId:(0,o.generateMediaEventId)(),overallUploadResult:(0,o.getMetricUploadErrorResultType)(e),overallIsFinal:!1,overallT:t,overallRetryCount:n,overallLastUploadRetryPhase:r,finalizeHttpCode:l}),null!=a&&(u.uploadHttpCode=a),u.markOverallCumT(),i.commit(),(0,o.logErrorUnknownDetails)(u,e)},mediaId:c,handleEncryptionStart:function(){u.startOverallEncryptT()},handleEncryptionSuccess:function(){u.markOverallEncryptT()},handleUploadProgress:function(e){u.set({uploadBytesTransferred:e})}}};var i=n(923082),a=r(n(982739)),o=n(529992),s=r(n(11339))},982739:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(t)return i.default.UPLOAD_SOURCE_TYPE.OTHER;switch(e){case i.default.MEDIA_PICKER_ORIGIN_TYPE.CHAT_PHOTO_LIBRARY:return i.default.UPLOAD_SOURCE_TYPE.GALLERY;case i.default.MEDIA_PICKER_ORIGIN_TYPE.MENU_CAMERA_CAPTURE:return i.default.UPLOAD_SOURCE_TYPE.CAMERA;case i.default.MEDIA_PICKER_ORIGIN_TYPE.PASTE:return i.default.UPLOAD_SOURCE_TYPE.SHARE;default:return i.default.UPLOAD_SOURCE_TYPE.OTHER}};var i=r(n(11339))},154824:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(389385),o=n(450796),s=r(n(901577)),l=n(892844),c=n(565885),u=r(n(177853)),d=r(n(51127)),p=r(n(683899)),f=r(n(215554)),_=r(n(239436)),h=n(727856),g=n(622200),m=n(523125),y=(r(n(11339)),n(964551));function S(e){let{mediaKey:t,mediaKeyTimestamp:n}=e;if(null!=t&&null!=n)return{mediaKey:t,mediaKeyTimestamp:n};const{key:r,timestamp:i}=(0,f.default)();return{mediaKey:r,mediaKeyTimestamp:i}}var E=new class{constructor(){var e=this;this.checkIfAlreadyUploaded=(0,s.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){const{encFilehash:t,type:n}=e;__LOG__(2)`uploadManager.checkIfAlreadyUploaded: start`;try{const t=yield _.default.checkIfUploadExists(e).catch((0,o.filteredCatch)(h.MediaNotFoundError,(()=>null)));return __LOG__(2)`uploadManager.checkIfAlreadyUploaded: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.checkIfAlreadyUploaded: canceled`:__LOG__(3)`uploadManager.checkIfAlreadyUploaded: error`,e}}));return function(){return e.apply(this,arguments)}}()),this._memoizedUpload=(0,s.default)((e=>e.encFilehash),function(){var e=(0,i.default)((function*(e){var t;const{ciphertextHmac:n,encFilehash:r,type:i,signal:a,onUploadHostFound:o,onUploadAttemptSuccess:s,onUploadAttemptError:l,onUploadSuccess:c,onProgress:u,onFinalize:d,onStreamUploadStart:p}=e,f=yield _.default.upload({ciphertextHmac:n,encFilehash:r,type:i,signal:a,onUploadHostFound:o,onUploadAttemptSuccess:s,onUploadAttemptError:l,onProgress:u,byteOffset:null!==(t=e.byteOffset)&&void 0!==t?t:0,onFinalize:d,onStreamUploadStart:p});return c(),f}));return function(){return e.apply(this,arguments)}}()),this._getExistingOrUpload=(0,s.default)((e=>e.encFilehash),function(){var t=(0,i.default)((function*(t){const{ciphertextHmac:n,encFilehash:r,signal:i,type:o,onCheckExistingSuccess:s,onCheckExistingError:l,onUploadHostFound:c,onUploadAttemptSuccess:u,onUploadAttemptError:d,onUploadSuccess:p,onProgress:f,onFinalize:_,onStreamUploadStart:h}=t;__LOG__(2)`uploadManager._getExistingOrUpload: start`;try{const t=yield e.checkIfAlreadyUploaded({encFilehash:r,type:o,signal:i}).catch((e=>{throw l(e),e})).then((t=>!0===(null==t?void 0:t.complete)?(s(),{directPath:t.directPath,handle:t.handle,url:t.url}):e._memoizedUpload({ciphertextHmac:n,encFilehash:r,type:o,signal:i,onUploadHostFound:c,onUploadAttemptSuccess:u,onUploadAttemptError:d,onUploadSuccess:p,onCheckExistingSuccess:s,onCheckExistingError:l,onProgress:f,onFinalize:_,onStreamUploadStart:h,byteOffset:null==t?void 0:t.resume})));return __LOG__(2)`uploadManager._getExistingOrUpload: success`,t}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager._getExistingOrUpload: canceled`:__LOG__(3)`uploadManager._getExistingOrUpload: error`,e}}));return function(){return t.apply(this,arguments)}}()),g.downloadUploadCrashLogger.init()}encryptAndUpload(e){var t=this;return(0,i.default)((function*(){const{blob:n,signal:r,type:o,userUploadAttemptCount:s,forwardedFromWeb:l,uploadOrigin:u,onProgress:f,onFinalize:_,isViewOnce:h}=e;__LOG__(2)`uploadManager.encryptAndUpload: start`;const{handleCheckExistingSuccess:E,handleCheckExistingError:T,handleUploadHostFound:C,handleUploadAttemptSuccess:A,handleUploadAttemptError:b,handleUploadSuccess:P,handleArrayBufferCreated:O,handleUploadError:M,mediaId:I,handleEncryptionStart:w,handleEncryptionSuccess:R,handleStreamUploadStart:N,handleUploadProgress:L}=(0,d.default)(o,u,s,l,h),D=(e,t)=>{null==f||f(e,t);const n=t+e.loaded;L(n)};g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_ENCRYPTION_STARTED);try{let a;if((0,m.isPerformanceExperimentEnabled)()){const i=S(e);a=Promise.resolve(n).then((e=>{g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:n instanceof Blob?n.size:n.byteLength});const t=e instanceof Blob?(0,c.blobToArrayBuffer)(e):e;return g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),t})).then((e=>(O(e.byteLength),w(),(0,p.default)({type:o,plaintext:e,mediaKey:i.mediaKey})))).then((n=>{let{hash:a,ciphertextHmac:s,sidecar:c,firstFrameSidecar:u}=n;R(),g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_ENCRYPTION_FINISHED);return(e.mediaKey?t._getExistingOrUpload:t._memoizedUpload)({ciphertextHmac:s,encFilehash:a,type:o,signal:r,onCheckExistingSuccess:E,onCheckExistingError:T,onUploadHostFound:C,onUploadAttemptSuccess:A,onUploadAttemptError:b,onUploadSuccess:P,onProgress:D,onFinalize:_,onStreamUploadStart:N}).then((e=>({directPath:l&&y.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(e.directPath):e.directPath,encFilehash:a,mediaKey:i.mediaKey,mediaKeyTimestamp:i.mediaKeyTimestamp,sidecar:c,firstFrameSidecar:u,url:e.url,handle:e.handle})))}))}else{g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED,{size:n instanceof Blob?n.size:n.byteLength});const s=n instanceof Blob?(0,c.blobToArrayBuffer)(n):Promise.resolve(n);g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED),a=s.then(function(){var n=(0,i.default)((function*(n){O(n.byteLength);const{mediaKey:i,mediaKeyTimestamp:a}=S(e);w();const{ciphertextHmac:s,hash:c,sidecar:u,firstFrameSidecar:d}=yield(0,p.default)({type:o,plaintext:n,mediaKey:i});R(),g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_ENCRYPTION_FINISHED);const f=e.mediaKey?t._getExistingOrUpload:t._memoizedUpload,h=yield f({ciphertextHmac:s,encFilehash:c,type:o,signal:r,onCheckExistingSuccess:E,onCheckExistingError:T,onUploadHostFound:C,onUploadAttemptSuccess:A,onUploadAttemptError:b,onUploadSuccess:P,onFinalize:_,onStreamUploadStart:N,onProgress:D});return{directPath:l&&y.ServerProps.mmsCatV1ForwardHotOverrideEnabled?v(h.directPath):h.directPath,encFilehash:c,mediaKey:i,mediaKeyTimestamp:a,sidecar:u,firstFrameSidecar:d,url:h.url,handle:h.handle}}));return function(){return n.apply(this,arguments)}}())}const s=yield a;return __LOG__(2)`uploadManager.encryptAndUpload: success`,g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_FINISHED),s}catch(e){throw e.name===a.ABORT_ERROR?__LOG__(2)`uploadManager.encryptAndUpload: canceled`:__LOG__(3)`uploadManager.encryptAndUpload: error`,g.downloadUploadCrashLogger.mark(I,g.ProgressType.UPLOAD_ERROR),M(e),e}}))()}unencryptedUpload(e){const{file:t,hash:n,type:r,signal:i,uploadOrigin:a,isViewOnce:o}=e,{handleCheckExistingSuccess:s,handleCheckExistingError:l,handleUploadHostFound:c,handleUploadAttemptSuccess:u,handleUploadAttemptError:p,handleUploadSuccess:f,handleStreamUploadStart:_,handleUploadProgress:h}=(0,d.default)(r,a,0,!1,o);return this._getExistingOrUpload({ciphertextHmac:t,encFilehash:n,type:r,signal:i,onCheckExistingSuccess:s,onCheckExistingError:l,onUploadHostFound:c,onUploadAttemptSuccess:u,onUploadAttemptError:p,onUploadSuccess:f,onStreamUploadStart:_,onProgress:(e,t)=>{h(e.loaded+t)}})}uploadCoverPhoto(e){const{file:t,hash:n,type:r,signal:i,uploadOrigin:a,isViewOnce:o}=e,{handleCheckExistingSuccess:s,handleCheckExistingError:l,handleUploadHostFound:c,handleUploadAttemptSuccess:u,handleUploadAttemptError:p,handleUploadSuccess:f,handleStreamUploadStart:_,handleUploadProgress:h}=(0,d.default)(r,a,0,!1,o);return this._memoizedUpload({ciphertextHmac:t,encFilehash:n,type:r,signal:i,onCheckExistingSuccess:s,onCheckExistingError:l,onUploadHostFound:c,onUploadAttemptSuccess:u,onUploadAttemptError:p,onUploadSuccess:f,onStreamUploadStart:_,onProgress:(e,t)=>{h(e.loaded+t)}})}};function v(e){const[t,n]=e.split("?"),r=new u.default(n),i=(0,l.unixTime)();return r.set("_nc_hot",String(i)),`${t}?${r.toString()}`}t.default=E},622200:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.downloadUploadCrashLogger=t.ProgressType=void 0;var i=r(n(904285)),a=n(964551);const o=n(76672).Mirrored(["DOWNLOAD_STARTED","DOWNLOAD_FINISHED","DOWNLOAD_DECRYPTION_STARTED","DOWNLOAD_DECRYPTION_FINISHED","DOWNLOAD_ERROR","UPLOAD_STARTED","UPLOAD_FINISHED","UPLOAD_BLOB_TO_ARRAY_BUFFER_STARTED","UPLOAD_BLOB_TO_ARRAY_BUFFER_FINISHED","UPLOAD_ENCRYPTION_STARTED","UPLOAD_ENCRYPTION_FINISHED","UPLOAD_ERROR"]);t.ProgressType=o;const s="DownloadUploadCrashLoggerLikelyCrashed",l=new Set([o.DOWNLOAD_DECRYPTION_FINISHED,o.DOWNLOAD_ERROR,o.UPLOAD_FINISHED,o.UPLOAD_ERROR]);const c=new class{constructor(){this.hasPerformedInit=!1,this._clearAllStorage=()=>{null===i.default||void 0===i.default||i.default.removeItem(s)}}_getStorage(){const e=null===i.default||void 0===i.default?void 0:i.default.getItem(s);return e?JSON.parse(e):{}}_commitStorage(){null===i.default||void 0===i.default||i.default.setItem(s,JSON.stringify(this.storage))}_shouldLog(){return!0===a.ServerProps.webLogUploadDownloadCrashes}init(){!this.hasPerformedInit&&this._shouldLog()&&(window.addEventListener("beforeunload",this._clearAllStorage),this.storage=this._getStorage(),Object.entries(this.storage).forEach((e=>{let[t,{progressType:n,metadata:r}]=e;var i,a;__LOG__(3,void 0,void 0,!0)`downloadUploadCrashLogger.likelyCrashedDuring${a=n,a.toLowerCase().replace(/(?:^|_)(\w)/g,((e,t)=>t.toLocaleUpperCase()))}WithID${t}${r?`AndData => ${i=r,Object.entries(i).map((e=>{let[t,n]=e;return`${t}: ${String(n)}`})).join(", ")}`:""}`,SEND_LOGS("download-upload-manager-likely-crashed")})),this._clearAllStorage(),this.hasPerformedInit=!0)}reset(){this._shouldLog()&&(window.removeEventListener("beforeunload",this._clearAllStorage),this._clearAllStorage(),this.hasPerformedInit=!1)}mark(e,t,n){this._shouldLog()&&(l.has(t)?delete this.storage[String(e)]:this.storage[String(e)]={progressType:t,metadata:n},this._commitStorage())}};t.downloadUploadCrashLogger=c},523125:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLargeFilesEnabled=o,t.isPerformanceExperimentEnabled=function(){if(o())return!0;if((0,i.isMDBackend)())return(0,r.getABPropConfigValue)("web_abprop_large_files_encryption_optimization");return!1},t.shouldEncryptInChunks=function(e){return o()&&e>a.DEFAULT_MAX_FILE_SIZE_BYTES};var r=n(257243),i=n(88555),a=n(964551);function o(){return a.ServerProps.maxFileSize>a.DEFAULT_MAX_FILE_SIZE_BYTES||a.ServerProps.maxElectronFileSize>a.DEFAULT_MAX_FILE_SIZE_BYTES}},209329:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.NoEntryAfterRMR=t.MissingEncFilehash=void 0,t.cancelDownloadMedia=function(e){const{downloadPromise:t}=e;if(null==t)return;const n=D.get(t);if(null==n)return;D.delete(t),n()},t.checkExistence=function(){return F.apply(this,arguments)},t.downloadMedia=x,t.manuallySetMedia=function(){return k.apply(this,arguments)};var a=i(n(348926)),o=i(n(823493)),s=n(389385),l=n(640265),c=n(450796),u=i(n(145095)),d=i(n(71197)),p=n(565885),f=I(n(435232)),_=n(893778),h=n(756406),g=i(n(534949)),m=n(284866),y=I(n(216737)),S=n(58668),E=n(843257),v=n(600691),T=n(661596),C=n(826384),A=n(937115),b=n(727856),P=i(n(11339)),O=n(964551);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(M=function(e){return e?n:t})(e)}function I(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=M(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class w extends((0,l.customError)("NoEntryAfterRMR")){}t.NoEntryAfterRMR=w;class R extends((0,l.customError)("MissingEncFilehash")){}t.MissingEncFilehash=R;const N=3,L=4,D=new WeakMap;function k(){return(k=(0,a.default)((function*(e){let{mimetype:t,mediaObject:n,mediaBlob:r,mediaType:i,rmrReason:a,downloadOrigin:o}=e;n.mediaBlob||(yield(0,h.gatherAndSetMetadata)(n,r),yield x({mimetype:t,mediaObject:n,downloadEvenIfExpensive:!1,mediaType:i,rmrReason:a,downloadOrigin:o}))}))).apply(this,arguments)}function U(){return G.apply(this,arguments)}function G(){return(G=(0,a.default)((function*(e){const{mimetype:t}=e,n=O.ServerProps.webLargeFilesUi?(0,o.default)((t=>{e.mediaObject.consolidate({loadedSize:t.loaded})}),v.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,r=yield C.downloadManager.downloadAndDecrypt({directPath:e.directPath,encFilehash:e.encFilehash,filehash:e.objFilehash,isFinalRmrRetry:e.isFinalRmrRetry,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,signal:e.signal,staticUrl:e.staticUrl,type:e.mediaType,onDecryptStart:()=>{e.mediaObject.consolidate({downloadStage:S.DOWNLOAD_STAGE.PROCESSING})},onProgress:n,userDownloadAttemptCount:e.mediaObject.userDownloadAttemptCount,downloadOrigin:e.downloadOrigin,mode:e.mode,progressiveJpegOpts:j({scanLengths:e.scanLengths,scansSidecar:e.scansSidecar,mimetype:t,mediaObject:e.mediaObject}),isViewOnce:e.isViewOnce}),i=null!=t&&""!==t?t:(0,E.getMediaMimeType)(e.mediaType,new Uint8Array(r));return new Blob([r],{type:i})}))).apply(this,arguments)}function x(){return B.apply(this,arguments)}function B(){return(B=(0,a.default)((function*(e){let{mimetype:t,mediaObject:n,downloadEvenIfExpensive:i,mediaType:o,signal:l,rmrReason:E,rmrData:v,downloadOrigin:P,shouldThrow:O,isVcardOverMmsDocument:M,mode:I,isAutoDownload:N,isFinalRmrRetry:L,isViewOnce:k}=e;if(!n)return;const G=n.filehash;if(!G)return;if(n.downloadPromise)return n.downloadPromise;if(n.downloadStage===S.DOWNLOAD_STAGE.ERROR_MISSING)return;if(n.downloadStage===S.DOWNLOAD_STAGE.PREPARING)return;if(n.mediaBlob){return(yield n.mediaBlob.validate())?void n.consolidate({downloadStage:S.DOWNLOAD_STAGE.RESOLVED}):(n.clearBlob(),n.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),void n.notifyMsgsAsync())}const B=m.MediaBlobCache.get(G);let F,j;const Y=new r;return(0,d.default)([Y.signal,l].filter(Boolean),(e=>{const l=function(){var r=(0,a.default)((function*(){if(B)j=B;else{if(F=n.entries.getDownloadEntry(),!F){if(!i)return void n.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE});if(yield C.downloadManager.rmr({mediaObject:n,signal:e,rmrReason:E,rmrData:v}),F=n.entries.getDownloadEntry(),!F)throw new w}n.consolidate({downloadStage:S.DOWNLOAD_STAGE.FETCHING}),F=(0,u.default)(F,"entry");const{encFilehash:r,scansSidecar:a,scanLengths:s,directPath:l,mediaKey:c,mediaKeyTimestamp:d,staticUrl:p}=F;if(!r)throw F.markWhetherOnServer(!1),new R;const f=yield U({directPath:l,encFilehash:r,objFilehash:G,isFinalRmrRetry:L,mediaKey:c,mediaKeyTimestamp:d,signal:e,staticUrl:p,mediaType:o,mediaObject:n,downloadOrigin:P,mode:I,scanLengths:s,mimetype:t,scansSidecar:a,isViewOnce:k});j=o===T.MEDIA_TYPES.PTT||o===T.MEDIA_TYPES.AUDIO?yield y.transcode(f):f}if("text/vcard"===j.type&&M)try{const e=yield(0,p.blobToText)(j);if(e){const t=(0,_.parseMultiVcard)(e);t.length>0?n.consolidate({parsedVcards:t}):(__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed!`,SEND_LOGS("vcard_over_mms:Failed to parse vcard over mms contents"))}}catch(e){__LOG__(4,void 0,new Error,!0,["non-sad"])`Failed to retrieve blob text contents ${String(e)}`,SEND_LOGS(`vcard_over_mms:blobToText failed with error: ${String(e)}`)}if((0,h.shouldUseMediaCache)(o))N||(m.MediaBlobCache.put(G,j),yield(0,h.gatherAndSetMetadataNoOpaque)(n,j));else{const e=yield g.default.createFromData(j,j.type);yield(0,h.gatherAndSetMetadata)(n,e)}return n.consolidate({downloadStage:S.DOWNLOAD_STAGE.RESOLVED}),n.downloadPromise=null,n.resolveWhenConsolidated()}));return function(){return r.apply(this,arguments)}}()().catch((0,c.filteredCatch)(b.MediaNotFoundError,function(){var e=(0,a.default)((function*(e){if(!F)throw e;if(F.markWhetherOnServer(!1),!i)throw e;return yield C.downloadManager.rmr({mediaObject:n,signal:(new r).signal,rmrReason:E,rmrData:v}),n.downloadPromise=null,x({mimetype:t,mediaObject:n,downloadEvenIfExpensive:!1,mediaType:o,rmrReason:E,rmrData:v,downloadOrigin:P,isFinalRmrRetry:!0,isVcardOverMmsDocument:M,mode:I,isAutoDownload:N})}));return function(){return e.apply(this,arguments)}}())).catch((0,c.filteredCatch)(f.MediaUnsupportedError,(e=>{if(n.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_UNSUPPORTED}),__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media unsupported error:"),O)throw e}))).catch((0,c.filteredCatch)(A.MediaNotOnPhone,(e=>{if(n.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_MISSING}),O)throw e}))).catch((0,c.filteredCatch)([w,R],(e=>{if(n.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_MISSING}),__LOG__(3)`Unexpected download error: ${e.name}`,__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed!`,SEND_LOGS(`unexpected download error: ${e.name}`),O)throw e}))).catch((0,c.filteredCatch)(f.MediaDecryptionError,(e=>{if(n.consolidate({downloadStage:S.DOWNLOAD_STAGE.ERROR_MISSING}),O)throw e}))).catch((e=>{if(n.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),e instanceof f.MediaLoadError){if(__LOG__(3)`downloadMedia: media unsupported error: ${e.name}, ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: media load error:"),O)throw e}else if(e instanceof f.TranscodeBlobTooLargeError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: transcode blob too large"),O)throw e}else if(e instanceof f.UnableToPlayVideoError){if(__LOG__(3)`downloadMedia: error: ${e.message}, ${t||""}`,__LOG__(4,void 0,new Error,!0,["non-sad"])`Assertion failed! ${e.message}`,SEND_LOGS("downloadMedia: unable to play video"),O)throw e}else if(e.name!==s.ABORT_ERROR){if(__LOG__(2)`downloadMedia: error`,O)throw e}else if(O)throw e})).finally((()=>{n.downloadPromise=null}));return D.set(l,(()=>{Y.abort()})),n.downloadPromise=l,l}))}))).apply(this,arguments)}function F(){return(F=(0,a.default)((function*(e){let{mimetype:t,mediaObject:n,mediaType:i}=e;const{filehash:a}=n;if(!a)return;if(n.downloadStage!==S.DOWNLOAD_STAGE.INIT)return;if(yield Y(n))return;const o=m.MediaBlobCache.get(a),s=new r;if(o)return void(n.downloadStage===S.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:S.DOWNLOAD_STAGE.EXISTS}));const l=n.entries.getDownloadEntry();if(!l)return void(n.downloadStage===S.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}));const{encFilehash:c}=l;if(!c)return l.markWhetherOnServer(!1),void(n.downloadStage===S.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}));try{yield C.downloadManager.checkExistence({directPath:l.directPath,encFilehash:c,signal:s.signal,type:i}),n.downloadStage===S.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:S.DOWNLOAD_STAGE.EXISTS})}catch(e){n.downloadStage===S.DOWNLOAD_STAGE.INIT&&n.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),__LOG__(2)`checkExistence: error`}}))).apply(this,arguments)}function j(e){const{scanLengths:t,scansSidecar:n,mimetype:r,mediaObject:i}=e;if(!function(e,t){return!!(e&&t&&e.length>=2&&10*e.length===t.byteLength)}(t,n))return null;const a=new P.default.WebcProgressiveImage({webcFirstRenderScans:0});return{mimetype:r,scansSidecar:(0,u.default)(n,"scansSidecar"),scanLengths:(0,u.default)(t,"scanLengths"),onProgressiveUpdate:e=>{i.downloadStage!==S.DOWNLOAD_STAGE.RESOLVED&&(i.consolidate({downloadStage:S.DOWNLOAD_STAGE.PROGRESSIVE_READY,progressiveStage:e}),a.webcFirstRenderScans||(a.webcFirstRenderScans=e,a.markWebcFirstRenderT()),e>=N&&!a.webcMidQualityT&&a.markWebcMidQualityT(),e!==L||a.webcFullQualityT||(a.markWebcFullQualityT(),a.commit()))}}}function Y(){return K.apply(this,arguments)}function K(){return(K=(0,a.default)((function*(e){if(!e.mediaBlob)return!1;return(yield e.mediaBlob.validate())?(e.consolidate({downloadStage:S.DOWNLOAD_STAGE.RESOLVED}),!0):(e.clearBlob(),e.consolidate({downloadStage:S.DOWNLOAD_STAGE.NEED_POKE}),e.notifyMsgsAsync(),!1)}))).apply(this,arguments)}},70996:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UploadMediaResultKind=void 0,t.cancelUploadMedia=function(e){const{uploadPromise:t}=e;if(null==t)return;const n=P.get(t);if(null==n)return;P.delete(t),n()},t.getBlobFromMediaObject=R,t.getOrDownloadBlob=I,t.uploadMedia=function(e){let{mimetype:t,mediaObject:n,mediaType:i,forwardedFromWeb:o,uploadOrigin:_,mediaKeyInfo:h,isViewOnce:S}=e;if(n.uploadPromise)return n.uploadPromise;const E=new r,{signal:v}=E,T=Promise.resolve().then((()=>{n.consolidate({uploadStage:f.UPLOAD_STAGE.UPLOADING})})).then((()=>I({mediaObject:n,mimetype:t,mediaType:i,abortSignal:v,uploadOrigin:_}))).then(function(){var e=(0,a.default)((function*(e){const t=n.entries.getUploadEntry();t&&h&&(0,C.default)(t.mediaKey===h.key,"uploadEntry.mediaKey and mediaKeyInfo.mediaKey should be the same");const r=yield function(){return M.apply(this,arguments)}({blob:e,forwardedFromWeb:o,mediaKeyInfo:h,mediaObject:n,mediaType:i,signal:v,uploadEntry:t,uploadOrigin:_,isViewOnce:S});if(!r)throw new Error("could not create media entry");if((i===g.MEDIA_TYPES.PTT||i===g.MEDIA_TYPES.AUDIO)&&!u.canPlayOgg())if(u.shouldUseMediaCache(i)){const e=n.filehash;if(e&&n.mediaBlob)return p.transcode(n.mediaBlob.formData()).then((t=>{d.MediaBlobCache.put(e,t)})).then((()=>r))}else if(n.mediaBlob)return u.gatherAndSetMetadata(n,n.mediaBlob).then((()=>r));return r}));return function(){return e.apply(this,arguments)}}()).then((e=>{if(v.aborted)throw new s.AbortError;return n.consolidate({uploadStage:f.UPLOAD_STAGE.UPLOADED}),__LOG__(2)`MediaAlgo.uploadMedia: success`,{kind:O.SUCCESS,mediaEntry:e}})).catch((e=>{throw e.name===s.ABORT_ERROR?__LOG__(2)`MediaAlgo.uploadMedia: canceled`:__LOG__(3)`MediaAlgo.uploadMedia: error`,e})).finally((()=>{delete n.uploadPromise})).catch((0,l.filteredCatch)(c.FileNotReadableError,(()=>(n.consolidate({uploadStage:f.UPLOAD_STAGE.ERROR_FILE_NOT_READABLE}),{kind:O.ERROR})))).catch((0,l.filteredCatch)(m.MediaNotOnPhone,(()=>(n.consolidate({uploadStage:f.UPLOAD_STAGE.ERROR_MISSING}),{kind:O.ERROR})))).catch((0,l.filteredCatch)(y.MediaTooLargeError,(()=>(n.consolidate({uploadStage:f.UPLOAD_STAGE.ERROR_TOO_LARGE}),{kind:O.ERROR})))).catch((e=>(n.consolidate({uploadStage:f.UPLOAD_STAGE.NEED_UPLOAD}),e.name===s.ABORT_ERROR?{kind:O.CANCELLATION}:{kind:O.ERROR})));return P.set(T,(()=>{E.abort()})),n.uploadPromise=T,T};var a=i(n(348926)),o=i(n(823493)),s=n(389385),l=n(450796),c=n(435232),u=b(n(756406)),d=n(284866),p=b(n(216737)),f=n(58668),_=n(209329),h=n(600691),g=n(661596),m=n(937115),y=n(727856),S=i(n(51127)),E=i(n(154824)),v=i(n(11339)),T=n(964551),C=i(n(441143));function A(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(A=function(e){return e?n:t})(e)}function b(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=A(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const P=new WeakMap;const O={SUCCESS:"success",CANCELLATION:"cancellation",ERROR:"error",TIMEOUT:"timeout"};function M(){return(M=(0,a.default)((function*(e){let{blob:t,forwardedFromWeb:n,mediaKeyInfo:r,mediaObject:i,mediaType:a,signal:s,uploadEntry:l,uploadOrigin:c,isViewOnce:u}=e;if(null==l?void 0:l.canReuseMediaKey())return(0,S.default)(a,c,0,n,u).handleCheckExistingSuccess(),l;const d=r?r.key:null==l?void 0:l.mediaKey,p=r?r.timestamp:null==l?void 0:l.mediaKeyTimestamp,_=T.ServerProps.webLargeFilesUi?(0,o.default)(((e,t)=>{const n=e.loaded+t;Number.isFinite(n)&&i.consolidate({loadedSize:n})}),h.FILE_PROGRESS_THROTTLE_WAIT_MS):void 0,{directPath:g,encFilehash:m,mediaKey:y,mediaKeyTimestamp:v,url:C,sidecar:A,firstFrameSidecar:b}=yield E.default.encryptAndUpload({blob:t,mediaKey:d,mediaKeyTimestamp:p,type:a,signal:s,userUploadAttemptCount:i.userUploadAttemptCount,forwardedFromWeb:n,uploadOrigin:c,onProgress:_,onFinalize:()=>{i.consolidate({uploadStage:f.UPLOAD_STAGE.FINALIZING})},isViewOnce:u});return i.entries.addEntry({deprecatedMms3Url:C,mediaKey:y,mediaKeyTimestamp:v,encFilehash:m,type:a,sidecar:A,directPath:g,firstFrameSidecar:b,debugHint:"upload"})}))).apply(this,arguments)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){let{mediaObject:t,mimetype:n,mediaType:r,abortSignal:i,uploadOrigin:a}=e;const o=R(t);if(o)return o;if(yield(0,_.downloadMedia)({mimetype:n,mediaObject:t,downloadEvenIfExpensive:!0,mediaType:r,signal:i,rmrReason:v.default.WEBC_RMR_REASON_CODE.UPLOAD,downloadOrigin:a===v.default.UPLOAD_ORIGIN_TYPE.CHAT_PERSONAL?v.default.DOWNLOAD_ORIGIN_TYPE.CHAT_PERSONAL:v.default.DOWNLOAD_ORIGIN_TYPE.CHAT_GROUP,mode:"manual"}),t.downloadStage===f.DOWNLOAD_STAGE.ERROR_MISSING)throw new m.MediaNotOnPhone;const s=R(t);if(s)return s;throw new Error("cant upload media w/out mediaBlob after download")}))).apply(this,arguments)}function R(e){const t=e.mediaBlob;return t?t.formData():e.filehash?d.MediaBlobCache.get(e.filehash):void 0}t.UploadMediaResultKind=O},327989:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=Promise.resolve().then((()=>{var n;const r=e.size();let c;c=t.asDocument?i.FILETYPE.DOCUMENT:t.asSticker?i.FILETYPE.STICKER:(0,i.typeFromMimetype)(e.type());const u=null!==(n=t.isVcardOverMmsDocument)&&void 0!==n&&n;if(r>function(e,t){if(e===i.FILETYPE.DOCUMENT)return t?1024*l.ServerProps.vcardMaxSizeKb:(0,l.getMaxFilesSizeServerProp)();return l.ServerProps.media}(c,u))throw new s.default(e);if(r<=0)throw new a.MediaFileEmpty;let d;switch(null!=t.gifAttribution?d=t.gifAttribution:t.asGif&&(d=0),c){case"image":return o.processRawImage(e,{minDimension:t.minDimension,transparency:t.transparency});case"sticker":return o.processRawSticker(e);case"video":case"audio":return o.processRawAudioVideo(e,!!t.isPtt,t.precomputedFields,t.asGif,d,e.type());case"document":return o.processRawDocument(e,t.filename,u,t.documentPageCount);default:throw new Error("Received unsupported mediaType: "+c)}}));return e.retain(),e.autoreleaseWhenPromiseCompletes(n),n};var i=n(565885),a=u(n(435232)),o=u(n(756406)),s=r(n(750170)),l=n(964551);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}function u(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}},303151:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RequestMediaReuploadManagerImpl=t.RequestMediaReuploadManager=void 0;var i=r(n(348926)),a=r(n(145095)),o=r(n(800976));class s{constructor(){var e=this;this._rmrRequests=new Map,this.requestMediaReupload=function(){var t=(0,i.default)((function*(t){const n=t.id.id,r=e._rmrRequests.get(n);if(r)return(0,a.default)(r.request,"existingRequest.request");const i=new Promise(((r,i)=>{e._rmrRequests.set(n,{resolve:r,reject:i,msg:t})}));return(0,a.default)(e._rmrRequests.get(n),"_this._rmrRequests.get(msgId)").request=i,yield(0,o.default)(t),i}));return function(){return t.apply(this,arguments)}}(),this.resolveMediaReupload=e=>{let{msgId:t,result:n,directPath:r}=e;const i=this._rmrRequests.get(t);null!=i?(i.resolve({result:n,directPath:r}),this._rmrRequests.delete(t)):__LOG__(3)`resolveMediaReupload: msgId (${t}) is not found in _rmrRequests`},this.getMediaKey=e=>{var t;return null===(t=this._rmrRequests.get(e))||void 0===t?void 0:t.msg.mediaKey}}}t.RequestMediaReuploadManagerImpl=s;const l=new s;t.RequestMediaReuploadManager=l},302603:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return o.apply(this,arguments)};var i=r(n(348926)),a=n(197563);function o(){return(o=(0,i.default)((function*(e,t){yield(0,a.updateLocal)(e.id,t),e.set(t)}))).apply(this,arguments)}},474460:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return f.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(389385),s=n(640265),l=r(n(747259)),c=n(638284),u=n(721009),d=n(70996),p=n(818309);r(n(11339));function f(){return(f=(0,a.default)((function*(e){const{thumbnail:t,mediaType:n,mediaKeyInfo:r,uploadOrigin:f,forwardedFromWeb:_,timeout:h,signal:g,isViewOnce:m}=e,y=new u.MediaObject;try{return null==h?yield S():yield(0,c.promiseTimeout)(S(),h)}catch(e){const t=e;if(t instanceof s.TimeoutError)return(0,d.cancelUploadMedia)(y),{kind:d.UploadMediaResultKind.TIMEOUT};throw t}function S(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(){try{const e=yield(0,l.default)((0,p.calculateFilehashFromBlob)(t),g);y.filehash=e,y.mediaBlob=t;const a=yield(0,l.default)((0,d.uploadMedia)({mimetype:"image/jpeg",mediaObject:y,mediaType:n,forwardedFromWeb:_,uploadOrigin:f,mediaKeyInfo:r,isViewOnce:m}),g);return a.kind===d.UploadMediaResultKind.SUCCESS?(0,i.default)((0,i.default)({},a),{},{filehash:e}):{kind:a.kind}}catch(e){const t=e;if("object"==typeof t&&(null==t?void 0:t.name)===o.ABORT_ERROR)return(0,d.cancelUploadMedia)(y),{kind:d.UploadMediaResultKind.CANCELLATION}}}))).apply(this,arguments)}}))).apply(this,arguments)}},487798:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return r.Clock.globalUnixTime()-e<i.ServerProps.mmsMediaKeyTTL+Math.floor(86400*Math.random())};var r=n(40234),i=n(964551)},237540:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.eventTypeFromMsgType=function(e){const t=e.type,r=e.subtype;let i;i=t===o.MSG_TYPE.GP2||t===o.MSG_TYPE.GROUP_NOTIFICATION?"subject"===r?"n":"add"===r||"invite"===r?e.recipients&&(0,s.isMePrimary)(e.recipients[0])?"s":"i":"linked_group_promote"===r||"linked_group_demote"===r?function(e){{const{communitiesEnabled:t}=n(408139);if(t()){const t=n(963928).default,{GroupType:r}=n(455981),i=t.get(e.id.remote);if((null==i?void 0:i.groupType)===r.DEFAULT_ANNOUNCEMENT_GROUP&&e.recipients&&(0,s.isMePrimary)(e.recipients[0]))return"s"}return"i"}}(e):"remove"===r?e.recipients&&(0,s.isMePrimary)(e.recipients[0])?"n":"i":"create"===r?"n":"parent_group_link"===r||"parent_group_unlink"===r?"s":"i":t===o.MSG_TYPE.BROADCAST_NOTIFICATION||t===o.MSG_TYPE.NOTIFICATION||t===o.MSG_TYPE.E2E_NOTIFICATION?"create"===r?"n":"i":t===o.MSG_TYPE.GROUPS_V4_INVITE&&(0,s.isMePrimary)(e.from)?"i":t===o.MSG_TYPE.CALL_LOG?"n":e.broadcast?l.default.isBroadcast(e.id.remote)?"n":"i":t===o.MSG_TYPE.REVOKED?"i":l.default.isPSA(e.id.remote)?e.ack===a.ACK.RECEIVED?"d":"a":t===o.MSG_TYPE.CIPHERTEXT||t===o.MSG_TYPE.OVERSIZED?"a":t===o.MSG_TYPE.NOTIFICATION_TEMPLATE||t===o.MSG_TYPE.PROTOCOL&&"ephemeral_setting"===r||t===o.MSG_TYPE.UNKNOWN&&"reaction"===r||t===o.MSG_TYPE.REACTION?"i":"d";return i},t.getSender=function(e){return h(e)?e.from:f(e)||_(e)?e.author:e.from},t.hasMentionOfMe=d,t.isGroupMsg=f,t.isImportantMessage=function(e){return d(e)||p(e)},t.isNotification=g,t.isNotificationType=m,t.isSentByMe=h,t.isStatusV3=_,t.isUnreadTypeMsg=function(e){if(e.type===o.MSG_TYPE.UNKNOWN&&"reaction"===e.subtype)return!1;const t=[o.MSG_TYPE.CHAT,o.MSG_TYPE.IMAGE,o.MSG_TYPE.VIDEO,o.MSG_TYPE.AUDIO,o.MSG_TYPE.PTT,o.MSG_TYPE.DOCUMENT,o.MSG_TYPE.VCARD,o.MSG_TYPE.LOCATION,o.MSG_TYPE.CIPHERTEXT,o.MSG_TYPE.OVERSIZED,o.MSG_TYPE.MULTI_VCARD,o.MSG_TYPE.STICKER,o.MSG_TYPE.PRODUCT,o.MSG_TYPE.GROUPS_V4_INVITE];(0,i.isSenderRevokeUiEnabled)()||t.push(o.MSG_TYPE.REVOKED);return t.includes(e.type)},t.repliedToMyMessage=p;var i=n(227101),a=n(535470),o=n(115461),s=n(978820),l=r(n(389867)),c=n(745454);function u(e){return e instanceof l.default?e:null!=e.user?(0,c.createUserWid)(e.user,e.server):e}function d(e){return!!(null==e?void 0:e.mentionedJidList)&&e.mentionedJidList.some((e=>(0,s.isMeAccount)(u(e))))}function p(e){return!!e&&(!(!e.quotedMsg||!e.quotedParticipant)&&(0,s.isMeAccount)(u(e.quotedParticipant)))}function f(e){return l.default.isGroup(e.from)||l.default.isGroup(e.to)}function _(e){return l.default.isStatusV3(e.id.remote)}function h(e){return"in"!==e.id.self&&!g(e)&&(0,s.isMeAccount)(e.from)}function g(e){return m(e.type,e.subtype)}function m(e,t){switch(e){case o.MSG_TYPE.GROUP_NOTIFICATION:case o.MSG_TYPE.GP2:case o.MSG_TYPE.BROADCAST_NOTIFICATION:case o.MSG_TYPE.NOTIFICATION:case o.MSG_TYPE.NOTIFICATION_TEMPLATE:case o.MSG_TYPE.E2E_NOTIFICATION:case o.MSG_TYPE.CALL_LOG:return!0;case o.MSG_TYPE.PROTOCOL:return"ephemeral_setting"===t||"share_phone_number"===t;default:return!1}}},465212:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(787614),a=n(978820),o=r(n(389867)),s=n(745454),l=r(n(5030)),c=r(n(592305));class u{constructor(e){let t=e;if(!t)throw new Error("MsgKey error: obj is null/undefined");t.id instanceof u&&(t=t.id,__LOG__(3)`MsgKey error: id is already a MsgKey`);const n=t.from&&t.to&&t.id,r=void 0!==t.fromMe&&t.remote&&t.id;let i,s,l,d,p,f,_;const h=(0,a.getMaybeMeUser)();if(!h)throw new Error("MsgKey error: me is undefined");if(n&&r)throw __LOG__(3)`Unclear constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: unclear which constructor to use");if(!n&&!r)throw __LOG__(3)`No matching constructor MsgKey: ${JSON.stringify(t)}`,new Error("MsgKey error: don't have a matching constructor");if(n){if(({from:i,to:s,id:l,participant:d,selfDir:p}=t),!(i instanceof o.default)||!(s instanceof o.default)||d&&!(d instanceof o.default))throw __LOG__(3)`Incorrect Wid MsgKey: from:${String(i)} to:${String(s)} p:${String(d)}`,new Error("MsgKey error: something is not a wid");p=o.default.equals(i,s)?p:void 0,o.default.equals(i,s)&&(0,a.isMePrimary)(i)?(f="out"===p,_=h):(0,a.isMePrimary)(i)?(f=!0,_=s):(0,a.isMePrimary)(s)?(f=!1,_=i):o.default.equals(i,s)&&(o.default.isGroup(i)||o.default.isBroadcast(i))?(f=!0,_=i):__LOG__(3)`MsgKey case error: ${[i,s,l,h].join()}`,void 0!==f&&(this.fromMe=f),_&&(this.remote=_),l&&(this.id=l)}else if(r){if(({fromMe:f,remote:_,id:l,participant:d}=t),!(_ instanceof o.default)||d&&!(d instanceof o.default))throw __LOG__(3)`Incorrect Wid MsgKey: remote:${String(_)} p:${String(d)}`,new Error("MsgKey error: something is not a wid");(0,a.isMePrimary)(_)&&(p=f?"out":"in"),void 0!==f&&(this.fromMe=f),_&&(this.remote=_),l&&(this.id=l)}const g=[this.fromMe,this.remote,this.id];void 0!==p&&(this.self=p,g.push(this.self)),(0,c.default)()&&void 0!==d&&(this.participant=d,g.push(this.participant)),this._serialized=g.join("_")}toString(){return this._serialized}clone(){return new u({fromMe:this.fromMe,remote:this.remote,id:this.id,participant:this.participant})}equals(e){return e instanceof u&&this.toString()===e.toString()}static fromString(e){if(null==e)throw new Error("MsgKey.fromString error: str is null or not a string");return u.from(e)}static from(e){if(e instanceof u)return e;let t;return t="string"==typeof e?(0,l.default)(e):e,new u({fromMe:t.fromMe,remote:(0,s.createWidFromWidLike)(t.remote),id:t.id,participant:t.participant?(0,s.createWidFromWidLike)(t.participant):void 0})}static newId(){return"3EB0"+(0,i.randomHex)(8)}}t.default=u},5030:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e||!(0,r.isString)(e))throw new Error("MsgKey fromString error: str is null or not a string");const t=e.split("_");let n;t.length<3?__LOG__(3)`MsgKey error: cannot create MsgKey from ${e}`:4===t.length?"out"!==t[3]&&"in"!==t[3]&&(n=t[3]):5===t.length&&(n=t[4]);return{fromMe:"true"===t[0],remote:t[1],id:t[2],participant:n}};var r=n(551737)},592305:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,r.isMDBackend)()||i.LegacyPhoneFeatures.supportsFeature(i.LegacyPhoneFeatures.F.KEY_PARTICIPANT)};var r=n(88555),i=n(438184)},871579:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.NuxSyncKey=t.NuxKeyTypes=t.NUX=t.CoolOffPeriodKeys=void 0,t.getNuxMaxViews=function(e){switch(e){case i.ARCHIVE:case i.STATUS_QUICK_REPLIES:return 3;default:return 1}},t.getNuxSyncKey=function(e){switch(e){case i.EPHEMERAL:return a.EPHEMERAL;case i.EPHEMERAL_VIEW_ONCE:return a.EPHEMERAL_VIEW_ONCE;case i.EPHEMERAL_VIEW_ONCE_RECEIVER:return a.EPHEMERAL_VIEW_ONCE_RECEIVER;case i.ARCHIVE:return a.ARCHIVE;case i.STATUS_QUICK_REPLIES:return a.STATUS_QUICK_REPLIES;case i.COMMUNITY:return a.COMMUNITY;case i.COMMUNITY_HOME:return a.COMMUNITY_HOME;default:return null}};r(n(11339));const i={SAFARI_LIMITED_SUPPORT:"safari_limited_support",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX_NEW:"sender_revoke_legal_disclaimer_nux",ADMIN_REVOKE_LEGAL_DISCLAIMER_NUX:"admin_revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community",COMMUNITY_HOME:"community_home",STATUS_QUICK_REPLIES:"status_quick_replies",KEEP_IN_CHAT:"keep_in_chat"};t.NUX=i;const a=n(76672)({EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",STATUS_QUICK_REPLIES:"status_quick_replies",COMMUNITY:"community",COMMUNITY_HOME:"community_home"});t.NuxSyncKey=a;t.NuxKeyTypes={COOL_OFF_NUX:{INCOMPLETE_BUSINESS_PROFILE_BANNER:"incomplete_business_profile_banner",PRODUCT_CATALOG_BANNER:"product_catalog_banner",COLLECTIONS:"collections_banner",CART_INTERSTITIAL:"cart_interstitial"},VIEW_COUNT_NUX:{SAFARI_LIMITED_SUPPORT:"safari_limited_support",SENDER_REVOKE_LEGAL_DISCLAIMER_NUX:"revoke_legal_disclaimer_nux",ADMIN_REVOKE_LEGAL_DISCLAIMER_NUX:"admin_revoke_legal_disclaimer_nux",EPHEMERAL:"ephemeral",EPHEMERAL_VIEW_ONCE:"ephemeral_view_once",EPHEMERAL_VIEW_ONCE_RECEIVER:"ephemeral_view_once_receiver",ARCHIVE:"archive",COMMUNITY:"community",COMMUNITY_HOME:"community_home",KEEP_IN_CHAT:"keep_in_chat"}};t.CoolOffPeriodKeys={DEFAULT:"default_cool_off_banners_key",CATALOG:"catalog_banners_key"}},396177:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createPollOptionLocalIdMap=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=n(787614),o=r(n(145095));function s(){return(s=(0,i.default)((function*(e){const t=yield Promise.all(e.map(function(){var e=(0,i.default)((function*(e){const t=yield l(e);return{hash:t,hexHash:(0,a.toHex)(new Uint8Array(t)),localId:e.localId}}));return function(){return e.apply(this,arguments)}}())),n=new Map,r=new Map;for(const{hash:e,hexHash:i,localId:a}of t)n.set(i,a),r.set(a,e);return{getLocalIdForHash:e=>(0,o.default)(n.get((0,a.toHex)(new Uint8Array(e))),"hexHashesToLocalIds.get(toHex(new Uint8Array(hash)))"),getHashForLocalId:e=>(0,o.default)(r.get(e),"localIdsToHexHashes.get(localId)"),includesHashes:e=>e.every((e=>n.has((0,a.toHex)(new Uint8Array(e)))))}}))).apply(this,arguments)}function l(e){return self.crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e.name))}},887426:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVoteKey=function(e){return`${e.parentMsgKey.toString()},${e.sender.toString()}`}},962959:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUnvote=function(e){return 0===e.selectedOptionLocalIds.length}},20853:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.protobufFromVote=function(){return l.apply(this,arguments)},t.voteFromProtobuf=function(e){let{voteProtobuf:t,pollVoteMsgKey:n,parentMsgKey:r,sender:i,senderTimestampMs:s,pollOptionLocalIdMap:l}=e;return{msgKey:n,parentMsgKey:(0,o.default)(r,"parentMsgKey"),selectedOptionLocalIds:t.selectedOptions.map(l.getLocalIdForHash),senderTimestampMs:(0,a.numberOrThrowIfTooLarge)(s),sender:i}};var i=r(n(348926)),a=n(608243),o=r(n(145095)),s=n(396177);function l(){return(l=(0,i.default)((function*(e,t){const n=yield(0,s.createPollOptionLocalIdMap)(t),r=e.selectedOptionLocalIds.map(n.getHashForLocalId);return{selectedOptions:0===r.length?null:r}}))).apply(this,arguments)}},280366:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(515229));let a;if("undefined"!=typeof self)a=self;else{if(void 0===n.g)throw new Error("Couldn't get global object");a=n.g}var o="AbortController"in a?a.AbortController:class{constructor(){this.signal=new i.default}abort(){const e=new Event("abort");this.signal.dispatchEvent(e)}};t.default=o},515229:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(806005)),a=class extends i.default{constructor(){super(),this.aborted=!1}dispatchEvent(e){return"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}toString(){return"[object AbortSignal]"}};t.default=a},806005:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(876521));t.default=class{constructor(){this._emitter=new i.default}addEventListener(e,t){this._emitter.on(e,t,this)}removeEventListener(e,t){this._emitter.off(e,t,this)}dispatchEvent(e){return this._emitter.trigger(e.type),!0}}},361438:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ADVSignedKeyIndexListSpec=t.ADVSignedDeviceIdentitySpec=t.ADVSignedDeviceIdentityHMACSpec=t.ADVKeyIndexListSpec=t.ADVDeviceIdentitySpec=void 0;var i=r(n(81109)),a=n(401390);const o=(0,i.default)({},null);t.ADVKeyIndexListSpec=o;const s=(0,i.default)({},null);t.ADVSignedKeyIndexListSpec=s;const l=(0,i.default)({},null);t.ADVDeviceIdentitySpec=l;const c=(0,i.default)({},null);t.ADVSignedDeviceIdentitySpec=c;const u=(0,i.default)({},null);t.ADVSignedDeviceIdentityHMACSpec=u,o.internalSpec={rawId:[1,a.TYPES.UINT32],timestamp:[2,a.TYPES.UINT64],currentIndex:[3,a.TYPES.UINT32],validIndexes:[4,a.FLAGS.REPEATED|a.FLAGS.PACKED|a.TYPES.UINT32]},s.internalSpec={details:[1,a.TYPES.BYTES],accountSignature:[2,a.TYPES.BYTES]},l.internalSpec={rawId:[1,a.TYPES.UINT32],timestamp:[2,a.TYPES.UINT64],keyIndex:[3,a.TYPES.UINT32]},c.internalSpec={details:[1,a.TYPES.BYTES],accountSignatureKey:[2,a.TYPES.BYTES],accountSignature:[3,a.TYPES.BYTES],deviceSignature:[4,a.TYPES.BYTES]},u.internalSpec={details:[1,a.TYPES.BYTES],hmac:[2,a.TYPES.BYTES]}},640965:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.NoiseCertificateSpec=t.NoiseCertificate$DetailsSpec=t.CertChainSpec=t.CertChain$NoiseCertificateSpec=t.CertChain$NoiseCertificate$DetailsSpec=void 0;var i=r(n(81109)),a=n(401390);const o=(0,i.default)({},null);t.NoiseCertificateSpec=o;const s=(0,i.default)({},null);t.NoiseCertificate$DetailsSpec=s;const l=(0,i.default)({},null);t.CertChainSpec=l;const c=(0,i.default)({},null);t.CertChain$NoiseCertificateSpec=c;const u=(0,i.default)({},null);t.CertChain$NoiseCertificate$DetailsSpec=u,o.internalSpec={details:[1,a.TYPES.BYTES],signature:[2,a.TYPES.BYTES]},s.internalSpec={serial:[1,a.TYPES.UINT32],issuer:[2,a.TYPES.STRING],expires:[3,a.TYPES.UINT64],subject:[4,a.TYPES.STRING],key:[5,a.TYPES.BYTES]},l.internalSpec={leaf:[1,a.TYPES.MESSAGE,c],intermediate:[2,a.TYPES.MESSAGE,c]},c.internalSpec={details:[1,a.TYPES.BYTES],signature:[2,a.TYPES.BYTES]},u.internalSpec={serial:[1,a.TYPES.UINT32],issuerSerial:[2,a.TYPES.UINT32],key:[3,a.TYPES.BYTES],notBefore:[4,a.TYPES.UINT64],notAfter:[5,a.TYPES.UINT64]}},698263:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DevicePropsSpec=t.DeviceProps$PlatformType=t.DeviceProps$AppVersionSpec=void 0;var i=r(n(81109)),a=n(401390);const o=n(76672)({UNKNOWN:0,CHROME:1,FIREFOX:2,IE:3,OPERA:4,SAFARI:5,EDGE:6,DESKTOP:7,IPAD:8,ANDROID_TABLET:9,OHANA:10,ALOHA:11,CATALINA:12,TCL_TV:13});t.DeviceProps$PlatformType=o;const s=(0,i.default)({},null);t.DevicePropsSpec=s;const l=(0,i.default)({},null);t.DeviceProps$AppVersionSpec=l,s.internalSpec={os:[1,a.TYPES.STRING],version:[2,a.TYPES.MESSAGE,l],platformType:[3,a.TYPES.ENUM,o],requireFullSync:[4,a.TYPES.BOOL]},l.internalSpec={primary:[1,a.TYPES.UINT32],secondary:[2,a.TYPES.UINT32],tertiary:[3,a.TYPES.UINT32],quaternary:[4,a.TYPES.UINT32],quinary:[5,a.TYPES.UINT32]}},124808:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Message$ProductMessage$ProductSnapshotSpec=t.Message$ProductMessage$CatalogSnapshotSpec=t.Message$PollVoteMessageSpec=t.Message$PollUpdateMessageSpec=t.Message$PollUpdateMessageMetadataSpec=t.Message$PollEncValueSpec=t.Message$PollCreationMessageSpec=t.Message$PollCreationMessage$OptionSpec=t.Message$PaymentInviteMessageSpec=t.Message$PaymentInviteMessage$ServiceType=t.Message$OrderMessageSpec=t.Message$OrderMessage$OrderSurface=t.Message$OrderMessage$OrderStatus=t.Message$LocationMessageSpec=t.Message$LiveLocationMessageSpec=t.Message$ListResponseMessageSpec=t.Message$ListResponseMessage$SingleSelectReplySpec=t.Message$ListResponseMessage$ListType=t.Message$ListMessageSpec=t.Message$ListMessage$SectionSpec=t.Message$ListMessage$RowSpec=t.Message$ListMessage$ProductSpec=t.Message$ListMessage$ProductSectionSpec=t.Message$ListMessage$ProductListInfoSpec=t.Message$ListMessage$ProductListHeaderImageSpec=t.Message$ListMessage$ListType=t.Message$KeepInChatMessageSpec=t.Message$InvoiceMessageSpec=t.Message$InvoiceMessage$AttachmentType=t.Message$InteractiveResponseMessageSpec=t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=t.Message$InteractiveResponseMessage$BodySpec=t.Message$InteractiveMessageSpec=t.Message$InteractiveMessage$ShopMessageSpec=t.Message$InteractiveMessage$ShopMessage$Surface=t.Message$InteractiveMessage$NativeFlowMessageSpec=t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=t.Message$InteractiveMessage$HeaderSpec=t.Message$InteractiveMessage$FooterSpec=t.Message$InteractiveMessage$CollectionMessageSpec=t.Message$InteractiveMessage$BodySpec=t.Message$InitialSecurityNotificationSettingSyncSpec=t.Message$ImageMessageSpec=t.Message$HistorySyncNotificationSpec=t.Message$HistorySyncNotification$HistorySyncType=t.Message$HighlyStructuredMessageSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponent$DayOfWeekType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponent$CalendarType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=t.Message$GroupInviteMessageSpec=t.Message$GroupInviteMessage$GroupType=t.Message$FutureProofMessageSpec=t.Message$ExtendedTextMessageSpec=t.Message$ExtendedTextMessage$PreviewType=t.Message$ExtendedTextMessage$InviteLinkGroupType=t.Message$ExtendedTextMessage$FontType=t.Message$DocumentMessageSpec=t.Message$DeviceSentMessageSpec=t.Message$DeclinePaymentRequestMessageSpec=t.Message$ContactsArrayMessageSpec=t.Message$ContactMessageSpec=t.Message$ChatSpec=t.Message$CancelPaymentRequestMessageSpec=t.Message$CallSpec=t.Message$ButtonsResponseMessageSpec=t.Message$ButtonsResponseMessage$Type=t.Message$ButtonsMessageSpec=t.Message$ButtonsMessage$HeaderType=t.Message$ButtonsMessage$ButtonSpec=t.Message$ButtonsMessage$Button$Type=t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=t.Message$ButtonsMessage$Button$ButtonTextSpec=t.Message$AudioMessageSpec=t.Message$AppStateSyncKeySpec=t.Message$AppStateSyncKeyShareSpec=t.Message$AppStateSyncKeyRequestSpec=t.Message$AppStateSyncKeyIdSpec=t.Message$AppStateSyncKeyFingerprintSpec=t.Message$AppStateSyncKeyDataSpec=t.Message$AppStateFatalExceptionNotificationSpec=t.LocationSpec=t.KeepType=t.InteractiveAnnotationSpec=t.HydratedTemplateButtonSpec=t.HydratedTemplateButton$HydratedURLButtonSpec=t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=t.HydratedTemplateButton$HydratedCallButtonSpec=t.DisappearingModeSpec=t.DisappearingMode$Initiator=t.DeviceListMetadataSpec=t.ContextInfoSpec=t.ContextInfo$ExternalAdReplyInfoSpec=t.ContextInfo$ExternalAdReplyInfo$MediaType=t.ContextInfo$AdReplyInfoSpec=t.ContextInfo$AdReplyInfo$MediaType=t.ActionLinkSpec=void 0,t.TemplateButtonSpec=t.TemplateButton$URLButtonSpec=t.TemplateButton$QuickReplyButtonSpec=t.TemplateButton$CallButtonSpec=t.PointSpec=t.PaymentBackgroundSpec=t.PaymentBackground$Type=t.PaymentBackground$MediaDataSpec=t.MoneySpec=t.MessageSpec=t.MessageContextInfoSpec=t.Message$VideoMessageSpec=t.Message$VideoMessage$Attribution=t.Message$TemplateMessageSpec=t.Message$TemplateMessage$HydratedFourRowTemplateSpec=t.Message$TemplateMessage$FourRowTemplateSpec=t.Message$TemplateButtonReplyMessageSpec=t.Message$StickerSyncRMRMessageSpec=t.Message$StickerMessageSpec=t.Message$SenderKeyDistributionMessageSpec=t.Message$SendPaymentMessageSpec=t.Message$RmrSource=t.Message$RequestPhoneNumberMessageSpec=t.Message$RequestPaymentMessageSpec=t.Message$RequestMediaUploadResponseMessageSpec=t.Message$RequestMediaUploadResponseMessage$RequestMediaUploadResultSpec=t.Message$RequestMediaUploadMessageSpec=t.Message$ReactionMessageSpec=t.Message$ProtocolMessageSpec=t.Message$ProtocolMessage$Type=t.Message$ProductMessageSpec=t.Message$ProductMessage$ProductSnapshotSpec=t.Message$ProductMessage$CatalogSnapshotSpec=t.Message$PollVoteMessageSpec=t.Message$PollUpdateMessageSpec=t.Message$PollUpdateMessageMetadataSpec=t.Message$PollEncValueSpec=t.Message$PollCreationMessageSpec=t.Message$PollCreationMessage$OptionSpec=t.Message$PaymentInviteMessageSpec=t.Message$PaymentInviteMessage$ServiceType=t.Message$OrderMessageSpec=t.Message$OrderMessage$OrderSurface=t.Message$OrderMessage$OrderStatus=t.Message$LocationMessageSpec=t.Message$LiveLocationMessageSpec=t.Message$ListResponseMessageSpec=t.Message$ListResponseMessage$SingleSelectReplySpec=t.Message$ListResponseMessage$ListType=t.Message$ListMessageSpec=t.Message$ListMessage$SectionSpec=t.Message$ListMessage$RowSpec=t.Message$ListMessage$ProductSpec=t.Message$ListMessage$ProductSectionSpec=t.Message$ListMessage$ProductListInfoSpec=t.Message$ListMessage$ProductListHeaderImageSpec=t.Message$ListMessage$ListType=t.Message$KeepInChatMessageSpec=t.Message$InvoiceMessageSpec=t.Message$InvoiceMessage$AttachmentType=t.Message$InteractiveResponseMessageSpec=t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=t.Message$InteractiveResponseMessage$BodySpec=t.Message$InteractiveMessageSpec=t.Message$InteractiveMessage$ShopMessageSpec=t.Message$InteractiveMessage$ShopMessage$Surface=t.Message$InteractiveMessage$NativeFlowMessageSpec=t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=t.Message$InteractiveMessage$HeaderSpec=t.Message$InteractiveMessage$FooterSpec=t.Message$InteractiveMessage$CollectionMessageSpec=t.Message$InteractiveMessage$BodySpec=t.Message$InitialSecurityNotificationSettingSyncSpec=t.Message$ImageMessageSpec=t.Message$HistorySyncNotificationSpec=t.Message$HistorySyncNotification$HistorySyncType=t.Message$HighlyStructuredMessageSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponent$DayOfWeekType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponent$CalendarType=t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=t.Message$GroupInviteMessageSpec=t.Message$GroupInviteMessage$GroupType=t.Message$FutureProofMessageSpec=t.Message$ExtendedTextMessageSpec=t.Message$ExtendedTextMessage$PreviewType=t.Message$ExtendedTextMessage$InviteLinkGroupType=t.Message$ExtendedTextMessage$FontType=t.Message$DocumentMessageSpec=t.Message$DeviceSentMessageSpec=t.Message$DeclinePaymentRequestMessageSpec=t.Message$ContactsArrayMessageSpec=t.Message$ContactMessageSpec=t.Message$ChatSpec=t.Message$CancelPaymentRequestMessageSpec=t.Message$CallSpec=t.Message$ButtonsResponseMessageSpec=t.Message$ButtonsResponseMessage$Type=t.Message$ButtonsMessageSpec=t.Message$ButtonsMessage$HeaderType=t.Message$ButtonsMessage$ButtonSpec=t.Message$ButtonsMessage$Button$Type=t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=t.Message$ButtonsMessage$Button$ButtonTextSpec=t.Message$AudioMessageSpec=t.Message$AppStateSyncKeySpec=t.Message$AppStateSyncKeyShareSpec=t.Message$AppStateSyncKeyRequestSpec=t.Message$AppStateSyncKeyIdSpec=t.Message$AppStateSyncKeyFingerprintSpec=t.Message$AppStateSyncKeyDataSpec=t.Message$AppStateFatalExceptionNotificationSpec=t.LocationSpec=t.KeepType=t.InteractiveAnnotationSpec=t.HydratedTemplateButtonSpec=t.HydratedTemplateButton$HydratedURLButtonSpec=t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=t.HydratedTemplateButton$HydratedCallButtonSpec=t.DisappearingModeSpec=t.DisappearingMode$Initiator=t.DeviceListMetadataSpec=t.ContextInfoSpec=t.ContextInfo$ExternalAdReplyInfoSpec=t.ContextInfo$ExternalAdReplyInfo$MediaType=t.ContextInfo$AdReplyInfoSpec=t.ContextInfo$AdReplyInfo$MediaType=t.ActionLinkSpec=void 0;var i=r(n(81109)),a=n(401390),o=n(793890),s=n(16258);const l=n(76672)({UNKNOWN:0,DISPLAY_TEXT:1});t.Message$ButtonsResponseMessage$Type=l;const c=n(76672)({UNKNOWN:0,RESPONSE:1,NATIVE_FLOW:2});t.Message$ButtonsMessage$Button$Type=c;const u=n(76672)({UNKNOWN:0,EMPTY:1,TEXT:2,DOCUMENT:3,IMAGE:4,VIDEO:5,LOCATION:6});t.Message$ButtonsMessage$HeaderType=u;const d=n(76672)({DEFAULT:0,PARENT:1});t.Message$GroupInviteMessage$GroupType=d;const p=n(76672)({UNKNOWN_SURFACE:0,FB:1,IG:2,WA:3});t.Message$InteractiveMessage$ShopMessage$Surface=p;const f=n(76672)({UNKNOWN:0,SINGLE_SELECT:1});t.Message$ListResponseMessage$ListType=f;const _=n(76672)({UNKNOWN:0,SINGLE_SELECT:1,PRODUCT_LIST:2});t.Message$ListMessage$ListType=_;const h=n(76672)({CATALOG:1});t.Message$OrderMessage$OrderSurface=h;const g=n(76672)({INQUIRY:1});t.Message$OrderMessage$OrderStatus=g;const m=n(76672)({UNKNOWN:0,FBPAY:1,NOVI:2,UPI:3});t.Message$PaymentInviteMessage$ServiceType=m;const y=n(76672)({GREGORIAN:1,SOLAR_HIJRI:2});t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponent$CalendarType=y;const S=n(76672)({MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6,SUNDAY:7});t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponent$DayOfWeekType=S;const E=n(76672)({FAVORITE_STICKER:0,RECENT_STICKER:1});t.Message$RmrSource=E;const v=n(76672)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4});t.Message$HistorySyncNotification$HistorySyncType=v;const T=n(76672)({REVOKE:0,EPHEMERAL_SETTING:3,EPHEMERAL_SYNC_RESPONSE:4,HISTORY_SYNC_NOTIFICATION:5,APP_STATE_SYNC_KEY_SHARE:6,APP_STATE_SYNC_KEY_REQUEST:7,MSG_FANOUT_BACKFILL_REQUEST:8,INITIAL_SECURITY_NOTIFICATION_SETTING_SYNC:9,APP_STATE_FATAL_EXCEPTION_NOTIFICATION:10,SHARE_PHONE_NUMBER:11,REQUEST_MEDIA_UPLOAD_MESSAGE:12,REQUEST_MEDIA_UPLOAD_RESPONSE_MESSAGE:13});t.Message$ProtocolMessage$Type=T;const C=n(76672)({NONE:0,GIPHY:1,TENOR:2});t.Message$VideoMessage$Attribution=C;const A=n(76672)({DEFAULT:0,PARENT:1,SUB:2,DEFAULT_SUB:3});t.Message$ExtendedTextMessage$InviteLinkGroupType=A;const b=n(76672)({NONE:0,VIDEO:1});t.Message$ExtendedTextMessage$PreviewType=b;const P=n(76672)({SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5});t.Message$ExtendedTextMessage$FontType=P;const O=n(76672)({IMAGE:0,PDF:1});t.Message$InvoiceMessage$AttachmentType=O;const M=n(76672)({NONE:0,IMAGE:1,VIDEO:2});t.ContextInfo$ExternalAdReplyInfo$MediaType=M;const I=n(76672)({NONE:0,IMAGE:1,VIDEO:2});t.ContextInfo$AdReplyInfo$MediaType=I;const w=n(76672)({UNKNOWN:0,DEFAULT:1});t.PaymentBackground$Type=w;const R=n(76672)({CHANGED_IN_CHAT:0,INITIATED_BY_ME:1,INITIATED_BY_OTHER:2});t.DisappearingMode$Initiator=R;const N=n(76672)({UNKNOWN:0,KEEP_FOR_ALL:1,UNDO_KEEP_FOR_ALL:2});t.KeepType=N;const L=(0,i.default)({},null);t.MessageSpec=L;const D=(0,i.default)({},null);t.Message$KeepInChatMessageSpec=D;const k=(0,i.default)({},null);t.Message$PollVoteMessageSpec=k;const U=(0,i.default)({},null);t.Message$PollEncValueSpec=U;const G=(0,i.default)({},null);t.Message$PollUpdateMessageMetadataSpec=G;const x=(0,i.default)({},null);t.Message$PollUpdateMessageSpec=x;const B=(0,i.default)({},null);t.Message$PollCreationMessageSpec=B;const F=(0,i.default)({},null);t.Message$PollCreationMessage$OptionSpec=F;const j=(0,i.default)({},null);t.Message$StickerSyncRMRMessageSpec=j;const Y=(0,i.default)({},null);t.Message$ReactionMessageSpec=Y;const K=(0,i.default)({},null);t.Message$ButtonsResponseMessageSpec=K;const W=(0,i.default)({},null);t.Message$ButtonsMessageSpec=W;const H=(0,i.default)({},null);t.Message$ButtonsMessage$ButtonSpec=H;const V=(0,i.default)({},null);t.Message$ButtonsMessage$Button$NativeFlowInfoSpec=V;const $=(0,i.default)({},null);t.Message$ButtonsMessage$Button$ButtonTextSpec=$;const z=(0,i.default)({},null);t.Message$FutureProofMessageSpec=z;const q=(0,i.default)({},null);t.Message$DeviceSentMessageSpec=q;const J=(0,i.default)({},null);t.Message$RequestPhoneNumberMessageSpec=J;const Q=(0,i.default)({},null);t.Message$GroupInviteMessageSpec=Q;const X=(0,i.default)({},null);t.Message$InteractiveResponseMessageSpec=X;const Z=(0,i.default)({},null);t.Message$InteractiveResponseMessage$NativeFlowResponseMessageSpec=Z;const ee=(0,i.default)({},null);t.Message$InteractiveResponseMessage$BodySpec=ee;const te=(0,i.default)({},null);t.Message$InteractiveMessageSpec=te;const ne=(0,i.default)({},null);t.Message$InteractiveMessage$NativeFlowMessageSpec=ne;const re=(0,i.default)({},null);t.Message$InteractiveMessage$NativeFlowMessage$NativeFlowButtonSpec=re;const ie=(0,i.default)({},null);t.Message$InteractiveMessage$CollectionMessageSpec=ie;const ae=(0,i.default)({},null);t.Message$InteractiveMessage$ShopMessageSpec=ae;const oe=(0,i.default)({},null);t.Message$InteractiveMessage$FooterSpec=oe;const se=(0,i.default)({},null);t.Message$InteractiveMessage$BodySpec=se;const le=(0,i.default)({},null);t.Message$InteractiveMessage$HeaderSpec=le;const ce=(0,i.default)({},null);t.Message$ListResponseMessageSpec=ce;const ue=(0,i.default)({},null);t.Message$ListResponseMessage$SingleSelectReplySpec=ue;const de=(0,i.default)({},null);t.Message$ListMessageSpec=de;const pe=(0,i.default)({},null);t.Message$ListMessage$ProductListInfoSpec=pe;const fe=(0,i.default)({},null);t.Message$ListMessage$ProductListHeaderImageSpec=fe;const _e=(0,i.default)({},null);t.Message$ListMessage$ProductSectionSpec=_e;const he=(0,i.default)({},null);t.Message$ListMessage$ProductSpec=he;const ge=(0,i.default)({},null);t.Message$ListMessage$SectionSpec=ge;const me=(0,i.default)({},null);t.Message$ListMessage$RowSpec=me;const ye=(0,i.default)({},null);t.Message$OrderMessageSpec=ye;const Se=(0,i.default)({},null);t.Message$ProductMessageSpec=Se;const Ee=(0,i.default)({},null);t.Message$ProductMessage$ProductSnapshotSpec=Ee;const ve=(0,i.default)({},null);t.Message$ProductMessage$CatalogSnapshotSpec=ve;const Te=(0,i.default)({},null);t.Message$TemplateButtonReplyMessageSpec=Te;const Ce=(0,i.default)({},null);t.Message$TemplateMessageSpec=Ce;const Ae=(0,i.default)({},null);t.Message$TemplateMessage$HydratedFourRowTemplateSpec=Ae;const be=(0,i.default)({},null);t.Message$TemplateMessage$FourRowTemplateSpec=be;const Pe=(0,i.default)({},null);t.Message$StickerMessageSpec=Pe;const Oe=(0,i.default)({},null);t.Message$LiveLocationMessageSpec=Oe;const Me=(0,i.default)({},null);t.Message$PaymentInviteMessageSpec=Me;const Ie=(0,i.default)({},null);t.Message$CancelPaymentRequestMessageSpec=Ie;const we=(0,i.default)({},null);t.Message$DeclinePaymentRequestMessageSpec=we;const Re=(0,i.default)({},null);t.Message$RequestPaymentMessageSpec=Re;const Ne=(0,i.default)({},null);t.Message$SendPaymentMessageSpec=Ne;const Le=(0,i.default)({},null);t.Message$HighlyStructuredMessageSpec=Le;const De=(0,i.default)({},null);t.Message$HighlyStructuredMessage$HSMLocalizableParameterSpec=De;const ke=(0,i.default)({},null);t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTimeSpec=ke;const Ue=(0,i.default)({},null);t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeUnixEpochSpec=Ue;const Ge=(0,i.default)({},null);t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMDateTime$HSMDateTimeComponentSpec=Ge;const xe=(0,i.default)({},null);t.Message$HighlyStructuredMessage$HSMLocalizableParameter$HSMCurrencySpec=xe;const Be=(0,i.default)({},null);t.Message$ContactsArrayMessageSpec=Be;const Fe=(0,i.default)({},null);t.Message$InitialSecurityNotificationSettingSyncSpec=Fe;const je=(0,i.default)({},null);t.Message$RequestMediaUploadResponseMessageSpec=je;const Ye=(0,i.default)({},null);t.Message$RequestMediaUploadResponseMessage$RequestMediaUploadResultSpec=Ye;const Ke=(0,i.default)({},null);t.Message$RequestMediaUploadMessageSpec=Ke;const We=(0,i.default)({},null);t.Message$AppStateFatalExceptionNotificationSpec=We;const He=(0,i.default)({},null);t.Message$AppStateSyncKeyRequestSpec=He;const Ve=(0,i.default)({},null);t.Message$AppStateSyncKeyShareSpec=Ve;const $e=(0,i.default)({},null);t.Message$AppStateSyncKeyDataSpec=$e;const ze=(0,i.default)({},null);t.Message$AppStateSyncKeyFingerprintSpec=ze;const qe=(0,i.default)({},null);t.Message$AppStateSyncKeyIdSpec=qe;const Je=(0,i.default)({},null);t.Message$AppStateSyncKeySpec=Je;const Qe=(0,i.default)({},null);t.Message$HistorySyncNotificationSpec=Qe;const Xe=(0,i.default)({},null);t.Message$ProtocolMessageSpec=Xe;const Ze=(0,i.default)({},null);t.Message$ChatSpec=Ze;const et=(0,i.default)({},null);t.Message$CallSpec=et;const tt=(0,i.default)({},null);t.Message$VideoMessageSpec=tt;const nt=(0,i.default)({},null);t.Message$AudioMessageSpec=nt;const rt=(0,i.default)({},null);t.Message$DocumentMessageSpec=rt;const it=(0,i.default)({},null);t.Message$ExtendedTextMessageSpec=it;const at=(0,i.default)({},null);t.Message$LocationMessageSpec=at;const ot=(0,i.default)({},null);t.Message$ContactMessageSpec=ot;const st=(0,i.default)({},null);t.Message$InvoiceMessageSpec=st;const lt=(0,i.default)({},null);t.Message$ImageMessageSpec=lt;const ct=(0,i.default)({},null);t.Message$SenderKeyDistributionMessageSpec=ct;const ut=(0,i.default)({},null);t.ContextInfoSpec=ut;const dt=(0,i.default)({},null);t.ContextInfo$ExternalAdReplyInfoSpec=dt;const pt=(0,i.default)({},null);t.ContextInfo$AdReplyInfoSpec=pt;const ft=(0,i.default)({},null);t.MessageContextInfoSpec=ft;const _t=(0,i.default)({},null);t.DeviceListMetadataSpec=_t;const ht=(0,i.default)({},null);t.InteractiveAnnotationSpec=ht;const gt=(0,i.default)({},null);t.PointSpec=gt;const mt=(0,i.default)({},null);t.LocationSpec=mt;const yt=(0,i.default)({},null);t.TemplateButtonSpec=yt;const St=(0,i.default)({},null);t.TemplateButton$CallButtonSpec=St;const Et=(0,i.default)({},null);t.TemplateButton$URLButtonSpec=Et;const vt=(0,i.default)({},null);t.TemplateButton$QuickReplyButtonSpec=vt;const Tt=(0,i.default)({},null);t.HydratedTemplateButtonSpec=Tt;const Ct=(0,i.default)({},null);t.HydratedTemplateButton$HydratedCallButtonSpec=Ct;const At=(0,i.default)({},null);t.HydratedTemplateButton$HydratedURLButtonSpec=At;const bt=(0,i.default)({},null);t.HydratedTemplateButton$HydratedQuickReplyButtonSpec=bt;const Pt=(0,i.default)({},null);t.MoneySpec=Pt;const Ot=(0,i.default)({},null);t.PaymentBackgroundSpec=Ot;const Mt=(0,i.default)({},null);t.PaymentBackground$MediaDataSpec=Mt;const It=(0,i.default)({},null);t.DisappearingModeSpec=It;const wt=(0,i.default)({},null);t.ActionLinkSpec=wt,L.internalSpec={conversation:[1,a.TYPES.STRING],senderKeyDistributionMessage:[2,a.TYPES.MESSAGE,ct],imageMessage:[3,a.TYPES.MESSAGE,lt],contactMessage:[4,a.TYPES.MESSAGE,ot],locationMessage:[5,a.TYPES.MESSAGE,at],extendedTextMessage:[6,a.TYPES.MESSAGE,it],documentMessage:[7,a.TYPES.MESSAGE,rt],audioMessage:[8,a.TYPES.MESSAGE,nt],videoMessage:[9,a.TYPES.MESSAGE,tt],call:[10,a.TYPES.MESSAGE,et],chat:[11,a.TYPES.MESSAGE,Ze],protocolMessage:[12,a.TYPES.MESSAGE,Xe],contactsArrayMessage:[13,a.TYPES.MESSAGE,Be],highlyStructuredMessage:[14,a.TYPES.MESSAGE,Le],fastRatchetKeySenderKeyDistributionMessage:[15,a.TYPES.MESSAGE,ct],sendPaymentMessage:[16,a.TYPES.MESSAGE,Ne],liveLocationMessage:[18,a.TYPES.MESSAGE,Oe],requestPaymentMessage:[22,a.TYPES.MESSAGE,Re],declinePaymentRequestMessage:[23,a.TYPES.MESSAGE,we],cancelPaymentRequestMessage:[24,a.TYPES.MESSAGE,Ie],templateMessage:[25,a.TYPES.MESSAGE,Ce],stickerMessage:[26,a.TYPES.MESSAGE,Pe],groupInviteMessage:[28,a.TYPES.MESSAGE,Q],templateButtonReplyMessage:[29,a.TYPES.MESSAGE,Te],productMessage:[30,a.TYPES.MESSAGE,Se],deviceSentMessage:[31,a.TYPES.MESSAGE,q],messageContextInfo:[35,a.TYPES.MESSAGE,ft],listMessage:[36,a.TYPES.MESSAGE,de],viewOnceMessage:[37,a.TYPES.MESSAGE,z],orderMessage:[38,a.TYPES.MESSAGE,ye],listResponseMessage:[39,a.TYPES.MESSAGE,ce],ephemeralMessage:[40,a.TYPES.MESSAGE,z],invoiceMessage:[41,a.TYPES.MESSAGE,st],buttonsMessage:[42,a.TYPES.MESSAGE,W],buttonsResponseMessage:[43,a.TYPES.MESSAGE,K],paymentInviteMessage:[44,a.TYPES.MESSAGE,Me],interactiveMessage:[45,a.TYPES.MESSAGE,te],reactionMessage:[46,a.TYPES.MESSAGE,Y],stickerSyncRmrMessage:[47,a.TYPES.MESSAGE,j],interactiveResponseMessage:[48,a.TYPES.MESSAGE,X],pollCreationMessage:[49,a.TYPES.MESSAGE,B],pollUpdateMessage:[50,a.TYPES.MESSAGE,x],keepInChatMessage:[51,a.TYPES.MESSAGE,D],documentWithCaptionMessage:[53,a.TYPES.MESSAGE,z],requestPhoneNumberMessage:[54,a.TYPES.MESSAGE,J],viewOnceMessageV2:[55,a.TYPES.MESSAGE,z]},D.internalSpec={key:[1,a.TYPES.MESSAGE,o.MessageKeySpec],keepType:[2,a.TYPES.ENUM,N],timestampMs:[3,a.TYPES.INT64]},k.internalSpec={selectedOptions:[1,a.FLAGS.REPEATED|a.TYPES.BYTES]},U.internalSpec={encPayload:[1,a.TYPES.BYTES],encIv:[2,a.TYPES.BYTES]},G.internalSpec={},x.internalSpec={pollCreationMessageKey:[1,a.TYPES.MESSAGE,o.MessageKeySpec],vote:[2,a.TYPES.MESSAGE,U],metadata:[3,a.TYPES.MESSAGE,G],senderTimestampMs:[4,a.TYPES.INT64]},B.internalSpec={encKey:[1,a.TYPES.BYTES],name:[2,a.TYPES.STRING],options:[3,a.FLAGS.REPEATED|a.TYPES.MESSAGE,F],selectableOptionsCount:[4,a.TYPES.UINT32],contextInfo:[5,a.TYPES.MESSAGE,ut]},F.internalSpec={optionName:[1,a.TYPES.STRING]},j.internalSpec={filehash:[1,a.FLAGS.REPEATED|a.TYPES.STRING],rmrSource:[2,a.TYPES.STRING],requestTimestamp:[3,a.TYPES.INT64]},Y.internalSpec={key:[1,a.TYPES.MESSAGE,o.MessageKeySpec],text:[2,a.TYPES.STRING],groupingKey:[3,a.TYPES.STRING],senderTimestampMs:[4,a.TYPES.INT64]},K.internalSpec={selectedButtonId:[1,a.TYPES.STRING],selectedDisplayText:[2,a.TYPES.STRING],contextInfo:[3,a.TYPES.MESSAGE,ut],type:[4,a.TYPES.ENUM,l],__oneofs__:{response:["selectedDisplayText"]}},W.internalSpec={text:[1,a.TYPES.STRING],documentMessage:[2,a.TYPES.MESSAGE,rt],imageMessage:[3,a.TYPES.MESSAGE,lt],videoMessage:[4,a.TYPES.MESSAGE,tt],locationMessage:[5,a.TYPES.MESSAGE,at],contentText:[6,a.TYPES.STRING],footerText:[7,a.TYPES.STRING],contextInfo:[8,a.TYPES.MESSAGE,ut],buttons:[9,a.FLAGS.REPEATED|a.TYPES.MESSAGE,H],headerType:[10,a.TYPES.ENUM,u],__oneofs__:{header:["text","documentMessage","imageMessage","videoMessage","locationMessage"]}},H.internalSpec={buttonId:[1,a.TYPES.STRING],buttonText:[2,a.TYPES.MESSAGE,$],type:[3,a.TYPES.ENUM,c],nativeFlowInfo:[4,a.TYPES.MESSAGE,V]},V.internalSpec={name:[1,a.TYPES.STRING],paramsJson:[2,a.TYPES.STRING]},$.internalSpec={displayText:[1,a.TYPES.STRING]},z.internalSpec={message:[1,a.TYPES.MESSAGE,L]},q.internalSpec={destinationJid:[1,a.TYPES.STRING],message:[2,a.TYPES.MESSAGE,L],phash:[3,a.TYPES.STRING]},J.internalSpec={contextInfo:[1,a.TYPES.MESSAGE,ut]},Q.internalSpec={groupJid:[1,a.TYPES.STRING],inviteCode:[2,a.TYPES.STRING],inviteExpiration:[3,a.TYPES.INT64],groupName:[4,a.TYPES.STRING],jpegThumbnail:[5,a.TYPES.BYTES],caption:[6,a.TYPES.STRING],contextInfo:[7,a.TYPES.MESSAGE,ut],groupType:[8,a.TYPES.ENUM,d]},X.internalSpec={body:[1,a.TYPES.MESSAGE,ee],nativeFlowResponseMessage:[2,a.TYPES.MESSAGE,Z],contextInfo:[15,a.TYPES.MESSAGE,ut],__oneofs__:{interactiveResponseMessage:["nativeFlowResponseMessage"]}},Z.internalDefaults={version:1},Z.internalSpec={name:[1,a.TYPES.STRING],paramsJson:[2,a.TYPES.STRING],version:[3,a.TYPES.INT32]},ee.internalSpec={text:[1,a.TYPES.STRING]},te.internalSpec={header:[1,a.TYPES.MESSAGE,le],body:[2,a.TYPES.MESSAGE,se],footer:[3,a.TYPES.MESSAGE,oe],shopStorefrontMessage:[4,a.TYPES.MESSAGE,ae],collectionMessage:[5,a.TYPES.MESSAGE,ie],nativeFlowMessage:[6,a.TYPES.MESSAGE,ne],contextInfo:[15,a.TYPES.MESSAGE,ut],__oneofs__:{interactiveMessage:["shopStorefrontMessage","collectionMessage","nativeFlowMessage"]}},ne.internalDefaults={messageVersion:1},ne.internalSpec={buttons:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,re],messageParamsJson:[2,a.TYPES.STRING],messageVersion:[3,a.TYPES.INT32]},re.internalSpec={name:[1,a.TYPES.STRING],buttonParamsJson:[2,a.TYPES.STRING]},ie.internalDefaults={messageVersion:1},ie.internalSpec={bizJid:[1,a.TYPES.STRING],id:[2,a.TYPES.STRING],messageVersion:[3,a.TYPES.INT32]},ae.internalDefaults={messageVersion:1},ae.internalSpec={id:[1,a.TYPES.STRING],surface:[2,a.TYPES.ENUM,p],messageVersion:[3,a.TYPES.INT32]},oe.internalSpec={text:[1,a.TYPES.STRING]},se.internalSpec={text:[1,a.TYPES.STRING]},le.internalSpec={title:[1,a.TYPES.STRING],subtitle:[2,a.TYPES.STRING],documentMessage:[3,a.TYPES.MESSAGE,rt],imageMessage:[4,a.TYPES.MESSAGE,lt],jpegThumbnail:[6,a.TYPES.BYTES],videoMessage:[7,a.TYPES.MESSAGE,tt],hasMediaAttachment:[5,a.TYPES.BOOL],__oneofs__:{media:["documentMessage","imageMessage","jpegThumbnail","videoMessage"]}},ce.internalSpec={title:[1,a.TYPES.STRING],listType:[2,a.TYPES.ENUM,f],singleSelectReply:[3,a.TYPES.MESSAGE,ue],contextInfo:[4,a.TYPES.MESSAGE,ut],description:[5,a.TYPES.STRING]},ue.internalSpec={selectedRowId:[1,a.TYPES.STRING]},de.internalSpec={title:[1,a.TYPES.STRING],description:[2,a.TYPES.STRING],buttonText:[3,a.TYPES.STRING],listType:[4,a.TYPES.ENUM,_],sections:[5,a.FLAGS.REPEATED|a.TYPES.MESSAGE,ge],productListInfo:[6,a.TYPES.MESSAGE,pe],footerText:[7,a.TYPES.STRING],contextInfo:[8,a.TYPES.MESSAGE,ut]},pe.internalSpec={productSections:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,_e],headerImage:[2,a.TYPES.MESSAGE,fe],businessOwnerJid:[3,a.TYPES.STRING]},fe.internalSpec={productId:[1,a.TYPES.STRING],jpegThumbnail:[2,a.TYPES.BYTES]},_e.internalSpec={title:[1,a.TYPES.STRING],products:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,he]},he.internalSpec={productId:[1,a.TYPES.STRING]},ge.internalSpec={title:[1,a.TYPES.STRING],rows:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,me]},me.internalSpec={title:[1,a.TYPES.STRING],description:[2,a.TYPES.STRING],rowId:[3,a.TYPES.STRING]},ye.internalSpec={orderId:[1,a.TYPES.STRING],thumbnail:[2,a.TYPES.BYTES],itemCount:[3,a.TYPES.INT32],status:[4,a.TYPES.ENUM,g],surface:[5,a.TYPES.ENUM,h],message:[6,a.TYPES.STRING],orderTitle:[7,a.TYPES.STRING],sellerJid:[8,a.TYPES.STRING],token:[9,a.TYPES.STRING],totalAmount1000:[10,a.TYPES.INT64],totalCurrencyCode:[11,a.TYPES.STRING],contextInfo:[17,a.TYPES.MESSAGE,ut]},Se.internalSpec={product:[1,a.TYPES.MESSAGE,Ee],businessOwnerJid:[2,a.TYPES.STRING],catalog:[4,a.TYPES.MESSAGE,ve],body:[5,a.TYPES.STRING],footer:[6,a.TYPES.STRING],contextInfo:[17,a.TYPES.MESSAGE,ut]},Ee.internalSpec={productImage:[1,a.TYPES.MESSAGE,lt],productId:[2,a.TYPES.STRING],title:[3,a.TYPES.STRING],description:[4,a.TYPES.STRING],currencyCode:[5,a.TYPES.STRING],priceAmount1000:[6,a.TYPES.INT64],retailerId:[7,a.TYPES.STRING],url:[8,a.TYPES.STRING],productImageCount:[9,a.TYPES.UINT32],firstImageId:[11,a.TYPES.STRING],salePriceAmount1000:[12,a.TYPES.INT64]},ve.internalSpec={catalogImage:[1,a.TYPES.MESSAGE,lt],title:[2,a.TYPES.STRING],description:[3,a.TYPES.STRING]},Te.internalSpec={selectedId:[1,a.TYPES.STRING],selectedDisplayText:[2,a.TYPES.STRING],contextInfo:[3,a.TYPES.MESSAGE,ut],selectedIndex:[4,a.TYPES.UINT32]},Ce.internalSpec={fourRowTemplate:[1,a.TYPES.MESSAGE,be],hydratedFourRowTemplate:[2,a.TYPES.MESSAGE,Ae],contextInfo:[3,a.TYPES.MESSAGE,ut],hydratedTemplate:[4,a.TYPES.MESSAGE,Ae],__oneofs__:{format:["fourRowTemplate","hydratedFourRowTemplate"]}},Ae.internalSpec={documentMessage:[1,a.TYPES.MESSAGE,rt],hydratedTitleText:[2,a.TYPES.STRING],imageMessage:[3,a.TYPES.MESSAGE,lt],videoMessage:[4,a.TYPES.MESSAGE,tt],locationMessage:[5,a.TYPES.MESSAGE,at],hydratedContentText:[6,a.TYPES.STRING],hydratedFooterText:[7,a.TYPES.STRING],hydratedButtons:[8,a.FLAGS.REPEATED|a.TYPES.MESSAGE,Tt],templateId:[9,a.TYPES.STRING],__oneofs__:{title:["documentMessage","hydratedTitleText","imageMessage","videoMessage","locationMessage"]}},be.internalSpec={documentMessage:[1,a.TYPES.MESSAGE,rt],highlyStructuredMessage:[2,a.TYPES.MESSAGE,Le],imageMessage:[3,a.TYPES.MESSAGE,lt],videoMessage:[4,a.TYPES.MESSAGE,tt],locationMessage:[5,a.TYPES.MESSAGE,at],content:[6,a.TYPES.MESSAGE,Le],footer:[7,a.TYPES.MESSAGE,Le],buttons:[8,a.FLAGS.REPEATED|a.TYPES.MESSAGE,yt],__oneofs__:{title:["documentMessage","highlyStructuredMessage","imageMessage","videoMessage","locationMessage"]}},Pe.internalSpec={url:[1,a.TYPES.STRING],fileSha256:[2,a.TYPES.BYTES],fileEncSha256:[3,a.TYPES.BYTES],mediaKey:[4,a.TYPES.BYTES],mimetype:[5,a.TYPES.STRING],height:[6,a.TYPES.UINT32],width:[7,a.TYPES.UINT32],directPath:[8,a.TYPES.STRING],fileLength:[9,a.TYPES.UINT64],mediaKeyTimestamp:[10,a.TYPES.INT64],firstFrameLength:[11,a.TYPES.UINT32],firstFrameSidecar:[12,a.TYPES.BYTES],isAnimated:[13,a.TYPES.BOOL],pngThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut]},Oe.internalSpec={degreesLatitude:[1,a.TYPES.DOUBLE],degreesLongitude:[2,a.TYPES.DOUBLE],accuracyInMeters:[3,a.TYPES.UINT32],speedInMps:[4,a.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[5,a.TYPES.UINT32],caption:[6,a.TYPES.STRING],sequenceNumber:[7,a.TYPES.INT64],timeOffset:[8,a.TYPES.UINT32],jpegThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut]},Me.internalSpec={serviceType:[1,a.TYPES.ENUM,m],expiryTimestamp:[2,a.TYPES.INT64]},Ie.internalSpec={key:[1,a.TYPES.MESSAGE,o.MessageKeySpec]},we.internalSpec={key:[1,a.TYPES.MESSAGE,o.MessageKeySpec]},Re.internalSpec={noteMessage:[4,a.TYPES.MESSAGE,L],currencyCodeIso4217:[1,a.TYPES.STRING],amount1000:[2,a.TYPES.UINT64],requestFrom:[3,a.TYPES.STRING],expiryTimestamp:[5,a.TYPES.INT64],amount:[6,a.TYPES.MESSAGE,Pt],background:[7,a.TYPES.MESSAGE,Ot]},Ne.internalSpec={noteMessage:[2,a.TYPES.MESSAGE,L],requestMessageKey:[3,a.TYPES.MESSAGE,o.MessageKeySpec],background:[4,a.TYPES.MESSAGE,Ot]},Le.internalSpec={namespace:[1,a.TYPES.STRING],elementName:[2,a.TYPES.STRING],params:[3,a.FLAGS.REPEATED|a.TYPES.STRING],fallbackLg:[4,a.TYPES.STRING],fallbackLc:[5,a.TYPES.STRING],localizableParams:[6,a.FLAGS.REPEATED|a.TYPES.MESSAGE,De],deterministicLg:[7,a.TYPES.STRING],deterministicLc:[8,a.TYPES.STRING],hydratedHsm:[9,a.TYPES.MESSAGE,Ce]},De.internalSpec={default:[1,a.TYPES.STRING],currency:[2,a.TYPES.MESSAGE,xe],dateTime:[3,a.TYPES.MESSAGE,ke],__oneofs__:{paramOneof:["currency","dateTime"]}},ke.internalSpec={component:[1,a.TYPES.MESSAGE,Ge],unixEpoch:[2,a.TYPES.MESSAGE,Ue],__oneofs__:{datetimeOneof:["component","unixEpoch"]}},Ue.internalSpec={timestamp:[1,a.TYPES.INT64]},Ge.internalSpec={dayOfWeek:[1,a.TYPES.ENUM,S],year:[2,a.TYPES.UINT32],month:[3,a.TYPES.UINT32],dayOfMonth:[4,a.TYPES.UINT32],hour:[5,a.TYPES.UINT32],minute:[6,a.TYPES.UINT32],calendar:[7,a.TYPES.ENUM,y]},xe.internalSpec={currencyCode:[1,a.TYPES.STRING],amount1000:[2,a.TYPES.INT64]},Be.internalSpec={displayName:[1,a.TYPES.STRING],contacts:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,ot],contextInfo:[17,a.TYPES.MESSAGE,ut]},Fe.internalSpec={securityNotificationEnabled:[1,a.TYPES.BOOL]},je.internalSpec={rmrSource:[1,a.TYPES.ENUM,E],stanzaId:[2,a.TYPES.STRING],reuploadResult:[3,a.FLAGS.REPEATED|a.TYPES.MESSAGE,Ye]},Ye.internalSpec={fileSha256:[1,a.TYPES.STRING],mediaUploadResult:[2,a.TYPES.ENUM,s.MediaRetryNotification$ResultType],stickerMessage:[3,a.TYPES.MESSAGE,Pe]},Ke.internalSpec={fileSha256:[1,a.FLAGS.REPEATED|a.TYPES.STRING],rmrSource:[2,a.TYPES.ENUM,E]},We.internalSpec={collectionNames:[1,a.FLAGS.REPEATED|a.TYPES.STRING],timestamp:[2,a.TYPES.INT64]},He.internalSpec={keyIds:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,qe]},Ve.internalSpec={keys:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,Je]},$e.internalSpec={keyData:[1,a.TYPES.BYTES],fingerprint:[2,a.TYPES.MESSAGE,ze],timestamp:[3,a.TYPES.INT64]},ze.internalSpec={rawId:[1,a.TYPES.UINT32],currentIndex:[2,a.TYPES.UINT32],deviceIndexes:[3,a.FLAGS.REPEATED|a.FLAGS.PACKED|a.TYPES.UINT32]},qe.internalSpec={keyId:[1,a.TYPES.BYTES]},Je.internalSpec={keyId:[1,a.TYPES.MESSAGE,qe],keyData:[2,a.TYPES.MESSAGE,$e]},Qe.internalSpec={fileSha256:[1,a.TYPES.BYTES],fileLength:[2,a.TYPES.UINT64],mediaKey:[3,a.TYPES.BYTES],fileEncSha256:[4,a.TYPES.BYTES],directPath:[5,a.TYPES.STRING],syncType:[6,a.TYPES.ENUM,v],chunkOrder:[7,a.TYPES.UINT32],originalMessageId:[8,a.TYPES.STRING],progress:[9,a.TYPES.UINT32]},Xe.internalSpec={key:[1,a.TYPES.MESSAGE,o.MessageKeySpec],type:[2,a.TYPES.ENUM,T],ephemeralExpiration:[4,a.TYPES.UINT32],ephemeralSettingTimestamp:[5,a.TYPES.INT64],historySyncNotification:[6,a.TYPES.MESSAGE,Qe],appStateSyncKeyShare:[7,a.TYPES.MESSAGE,Ve],appStateSyncKeyRequest:[8,a.TYPES.MESSAGE,He],initialSecurityNotificationSettingSync:[9,a.TYPES.MESSAGE,Fe],appStateFatalExceptionNotification:[10,a.TYPES.MESSAGE,We],disappearingMode:[11,a.TYPES.MESSAGE,It],requestMediaUploadMessage:[12,a.TYPES.MESSAGE,Ke],requestMediaUploadResponseMessage:[13,a.TYPES.MESSAGE,je]},Ze.internalSpec={displayName:[1,a.TYPES.STRING],id:[2,a.TYPES.STRING]},et.internalSpec={callKey:[1,a.TYPES.BYTES],conversionSource:[2,a.TYPES.STRING],conversionData:[3,a.TYPES.BYTES],conversionDelaySeconds:[4,a.TYPES.UINT32]},tt.internalSpec={url:[1,a.TYPES.STRING],mimetype:[2,a.TYPES.STRING],fileSha256:[3,a.TYPES.BYTES],fileLength:[4,a.TYPES.UINT64],seconds:[5,a.TYPES.UINT32],mediaKey:[6,a.TYPES.BYTES],caption:[7,a.TYPES.STRING],gifPlayback:[8,a.TYPES.BOOL],height:[9,a.TYPES.UINT32],width:[10,a.TYPES.UINT32],fileEncSha256:[11,a.TYPES.BYTES],interactiveAnnotations:[12,a.FLAGS.REPEATED|a.TYPES.MESSAGE,ht],directPath:[13,a.TYPES.STRING],mediaKeyTimestamp:[14,a.TYPES.INT64],jpegThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut],streamingSidecar:[18,a.TYPES.BYTES],gifAttribution:[19,a.TYPES.ENUM,C],viewOnce:[20,a.TYPES.BOOL],thumbnailDirectPath:[21,a.TYPES.STRING],thumbnailSha256:[22,a.TYPES.BYTES],thumbnailEncSha256:[23,a.TYPES.BYTES],staticUrl:[24,a.TYPES.STRING]},nt.internalSpec={url:[1,a.TYPES.STRING],mimetype:[2,a.TYPES.STRING],fileSha256:[3,a.TYPES.BYTES],fileLength:[4,a.TYPES.UINT64],seconds:[5,a.TYPES.UINT32],ptt:[6,a.TYPES.BOOL],mediaKey:[7,a.TYPES.BYTES],fileEncSha256:[8,a.TYPES.BYTES],directPath:[9,a.TYPES.STRING],mediaKeyTimestamp:[10,a.TYPES.INT64],contextInfo:[17,a.TYPES.MESSAGE,ut],streamingSidecar:[18,a.TYPES.BYTES],waveform:[19,a.TYPES.BYTES]},rt.internalSpec={url:[1,a.TYPES.STRING],mimetype:[2,a.TYPES.STRING],title:[3,a.TYPES.STRING],fileSha256:[4,a.TYPES.BYTES],fileLength:[5,a.TYPES.UINT64],pageCount:[6,a.TYPES.UINT32],mediaKey:[7,a.TYPES.BYTES],fileName:[8,a.TYPES.STRING],fileEncSha256:[9,a.TYPES.BYTES],directPath:[10,a.TYPES.STRING],mediaKeyTimestamp:[11,a.TYPES.INT64],contactVcard:[12,a.TYPES.BOOL],thumbnailDirectPath:[13,a.TYPES.STRING],thumbnailSha256:[14,a.TYPES.BYTES],thumbnailEncSha256:[15,a.TYPES.BYTES],jpegThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut],thumbnailHeight:[18,a.TYPES.UINT32],thumbnailWidth:[19,a.TYPES.UINT32],caption:[20,a.TYPES.STRING]},it.internalSpec={text:[1,a.TYPES.STRING],matchedText:[2,a.TYPES.STRING],canonicalUrl:[4,a.TYPES.STRING],description:[5,a.TYPES.STRING],title:[6,a.TYPES.STRING],textArgb:[7,a.TYPES.FIXED32],backgroundArgb:[8,a.TYPES.FIXED32],font:[9,a.TYPES.ENUM,P],previewType:[10,a.TYPES.ENUM,b],jpegThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut],doNotPlayInline:[18,a.TYPES.BOOL],thumbnailDirectPath:[19,a.TYPES.STRING],thumbnailSha256:[20,a.TYPES.BYTES],thumbnailEncSha256:[21,a.TYPES.BYTES],mediaKey:[22,a.TYPES.BYTES],mediaKeyTimestamp:[23,a.TYPES.INT64],thumbnailHeight:[24,a.TYPES.UINT32],thumbnailWidth:[25,a.TYPES.UINT32],inviteLinkGroupType:[26,a.TYPES.ENUM,A],inviteLinkParentGroupSubjectV2:[27,a.TYPES.STRING],inviteLinkParentGroupThumbnailV2:[28,a.TYPES.BYTES],inviteLinkGroupTypeV2:[29,a.TYPES.ENUM,A]},at.internalSpec={degreesLatitude:[1,a.TYPES.DOUBLE],degreesLongitude:[2,a.TYPES.DOUBLE],name:[3,a.TYPES.STRING],address:[4,a.TYPES.STRING],url:[5,a.TYPES.STRING],isLive:[6,a.TYPES.BOOL],accuracyInMeters:[7,a.TYPES.UINT32],speedInMps:[8,a.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[9,a.TYPES.UINT32],comment:[11,a.TYPES.STRING],jpegThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut]},ot.internalSpec={displayName:[1,a.TYPES.STRING],vcard:[16,a.TYPES.STRING],contextInfo:[17,a.TYPES.MESSAGE,ut]},st.internalSpec={note:[1,a.TYPES.STRING],token:[2,a.TYPES.STRING],attachmentType:[3,a.TYPES.ENUM,O],attachmentMimetype:[4,a.TYPES.STRING],attachmentMediaKey:[5,a.TYPES.BYTES],attachmentMediaKeyTimestamp:[6,a.TYPES.INT64],attachmentFileSha256:[7,a.TYPES.BYTES],attachmentFileEncSha256:[8,a.TYPES.BYTES],attachmentDirectPath:[9,a.TYPES.STRING],attachmentJpegThumbnail:[10,a.TYPES.BYTES]},lt.internalSpec={url:[1,a.TYPES.STRING],mimetype:[2,a.TYPES.STRING],caption:[3,a.TYPES.STRING],fileSha256:[4,a.TYPES.BYTES],fileLength:[5,a.TYPES.UINT64],height:[6,a.TYPES.UINT32],width:[7,a.TYPES.UINT32],mediaKey:[8,a.TYPES.BYTES],fileEncSha256:[9,a.TYPES.BYTES],interactiveAnnotations:[10,a.FLAGS.REPEATED|a.TYPES.MESSAGE,ht],directPath:[11,a.TYPES.STRING],mediaKeyTimestamp:[12,a.TYPES.INT64],jpegThumbnail:[16,a.TYPES.BYTES],contextInfo:[17,a.TYPES.MESSAGE,ut],firstScanSidecar:[18,a.TYPES.BYTES],firstScanLength:[19,a.TYPES.UINT32],experimentGroupId:[20,a.TYPES.UINT32],scansSidecar:[21,a.TYPES.BYTES],scanLengths:[22,a.FLAGS.REPEATED|a.TYPES.UINT32],midQualityFileSha256:[23,a.TYPES.BYTES],midQualityFileEncSha256:[24,a.TYPES.BYTES],viewOnce:[25,a.TYPES.BOOL],thumbnailDirectPath:[26,a.TYPES.STRING],thumbnailSha256:[27,a.TYPES.BYTES],thumbnailEncSha256:[28,a.TYPES.BYTES],staticUrl:[29,a.TYPES.STRING]},ct.internalSpec={groupId:[1,a.TYPES.STRING],axolotlSenderKeyDistributionMessage:[2,a.TYPES.BYTES]},ut.internalSpec={stanzaId:[1,a.TYPES.STRING],participant:[2,a.TYPES.STRING],quotedMessage:[3,a.TYPES.MESSAGE,L],remoteJid:[4,a.TYPES.STRING],mentionedJid:[15,a.FLAGS.REPEATED|a.TYPES.STRING],conversionSource:[18,a.TYPES.STRING],conversionData:[19,a.TYPES.BYTES],conversionDelaySeconds:[20,a.TYPES.UINT32],forwardingScore:[21,a.TYPES.UINT32],isForwarded:[22,a.TYPES.BOOL],quotedAd:[23,a.TYPES.MESSAGE,pt],placeholderKey:[24,a.TYPES.MESSAGE,o.MessageKeySpec],expiration:[25,a.TYPES.UINT32],ephemeralSettingTimestamp:[26,a.TYPES.INT64],ephemeralSharedSecret:[27,a.TYPES.BYTES],externalAdReply:[28,a.TYPES.MESSAGE,dt],entryPointConversionSource:[29,a.TYPES.STRING],entryPointConversionApp:[30,a.TYPES.STRING],entryPointConversionDelaySeconds:[31,a.TYPES.UINT32],disappearingMode:[32,a.TYPES.MESSAGE,It],actionLink:[33,a.TYPES.MESSAGE,wt],groupSubject:[34,a.TYPES.STRING],parentGroupJid:[35,a.TYPES.STRING]},dt.internalSpec={title:[1,a.TYPES.STRING],body:[2,a.TYPES.STRING],mediaType:[3,a.TYPES.ENUM,M],thumbnailUrl:[4,a.TYPES.STRING],mediaUrl:[5,a.TYPES.STRING],thumbnail:[6,a.TYPES.BYTES],sourceType:[7,a.TYPES.STRING],sourceId:[8,a.TYPES.STRING],sourceUrl:[9,a.TYPES.STRING],containsAutoReply:[10,a.TYPES.BOOL],renderLargerThumbnail:[11,a.TYPES.BOOL],showAdAttribution:[12,a.TYPES.BOOL]},pt.internalSpec={advertiserName:[1,a.TYPES.STRING],mediaType:[2,a.TYPES.ENUM,I],jpegThumbnail:[16,a.TYPES.BYTES],caption:[17,a.TYPES.STRING]},ft.internalSpec={deviceListMetadata:[1,a.TYPES.MESSAGE,_t],deviceListMetadataVersion:[2,a.TYPES.INT32],messageSecret:[3,a.TYPES.BYTES],paddingBytes:[4,a.TYPES.BYTES]},_t.internalSpec={senderKeyHash:[1,a.TYPES.BYTES],senderTimestamp:[2,a.TYPES.UINT64],senderKeyIndexes:[3,a.FLAGS.REPEATED|a.FLAGS.PACKED|a.TYPES.UINT32],recipientKeyHash:[8,a.TYPES.BYTES],recipientTimestamp:[9,a.TYPES.UINT64],recipientKeyIndexes:[10,a.FLAGS.REPEATED|a.FLAGS.PACKED|a.TYPES.UINT32]},ht.internalSpec={polygonVertices:[1,a.FLAGS.REPEATED|a.TYPES.MESSAGE,gt],location:[2,a.TYPES.MESSAGE,mt],__oneofs__:{action:["location"]}},gt.internalSpec={xDeprecated:[1,a.TYPES.INT32],yDeprecated:[2,a.TYPES.INT32],x:[3,a.TYPES.DOUBLE],y:[4,a.TYPES.DOUBLE]},mt.internalSpec={degreesLatitude:[1,a.TYPES.DOUBLE],degreesLongitude:[2,a.TYPES.DOUBLE],name:[3,a.TYPES.STRING]},yt.internalSpec={quickReplyButton:[1,a.TYPES.MESSAGE,vt],urlButton:[2,a.TYPES.MESSAGE,Et],callButton:[3,a.TYPES.MESSAGE,St],index:[4,a.TYPES.UINT32],__oneofs__:{button:["quickReplyButton","urlButton","callButton"]}},St.internalSpec={displayText:[1,a.TYPES.MESSAGE,Le],phoneNumber:[2,a.TYPES.MESSAGE,Le]},Et.internalSpec={displayText:[1,a.TYPES.MESSAGE,Le],url:[2,a.TYPES.MESSAGE,Le]},vt.internalSpec={displayText:[1,a.TYPES.MESSAGE,Le],id:[2,a.TYPES.STRING]},Tt.internalSpec={quickReplyButton:[1,a.TYPES.MESSAGE,bt],urlButton:[2,a.TYPES.MESSAGE,At],callButton:[3,a.TYPES.MESSAGE,Ct],index:[4,a.TYPES.UINT32],__oneofs__:{hydratedButton:["quickReplyButton","urlButton","callButton"]}},Ct.internalSpec={displayText:[1,a.TYPES.STRING],phoneNumber:[2,a.TYPES.STRING]},At.internalSpec={displayText:[1,a.TYPES.STRING],url:[2,a.TYPES.STRING]},bt.internalSpec={displayText:[1,a.TYPES.STRING],id:[2,a.TYPES.STRING]},Pt.internalSpec={value:[1,a.TYPES.INT64],offset:[2,a.TYPES.UINT32],currencyCode:[3,a.TYPES.STRING]},Ot.internalSpec={id:[1,a.TYPES.STRING],fileLength:[2,a.TYPES.UINT64],width:[3,a.TYPES.UINT32],height:[4,a.TYPES.UINT32],mimetype:[5,a.TYPES.STRING],placeholderArgb:[6,a.TYPES.FIXED32],textArgb:[7,a.TYPES.FIXED32],subtextArgb:[8,a.TYPES.FIXED32],mediaData:[9,a.TYPES.MESSAGE,Mt],type:[10,a.TYPES.ENUM,w]},Mt.internalSpec={mediaKey:[1,a.TYPES.BYTES],mediaKeyTimestamp:[2,a.TYPES.INT64],fileSha256:[3,a.TYPES.BYTES],fileEncSha256:[4,a.TYPES.BYTES],directPath:[5,a.TYPES.STRING]},It.internalSpec={initiator:[1,a.TYPES.ENUM,R]},wt.internalSpec={url:[1,a.TYPES.STRING],buttonTitle:[2,a.TYPES.STRING]}},128286:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.EphemeralSettingSpec=void 0;var i=r(n(81109)),a=n(401390);const o=(0,i.default)({},null);t.EphemeralSettingSpec=o,o.internalSpec={duration:[1,a.TYPES.SFIXED32],timestamp:[2,a.TYPES.SFIXED64]}},573027:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WallpaperSettingsSpec=t.StickerMetadataSpec=t.PushnameSpec=t.PastParticipantsSpec=t.PastParticipantSpec=t.PastParticipant$LeaveReason=t.MediaVisibility=t.HistorySyncSpec=t.HistorySyncMsgSpec=t.HistorySync$HistorySyncType=t.GroupParticipantSpec=t.GroupParticipant$Rank=t.GlobalSettingsSpec=t.ConversationSpec=t.Conversation$EndOfHistoryTransferType=t.AutoDownloadSettingsSpec=void 0;var i=r(n(81109)),a=n(401390),o=n(421224),s=n(124808);const l=n(76672)({INITIAL_BOOTSTRAP:0,INITIAL_STATUS_V3:1,FULL:2,RECENT:3,PUSH_NAME:4,UNBLOCKING_DATA:5});t.HistorySync$HistorySyncType=l;const c=n(76672)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1});t.Conversation$EndOfHistoryTransferType=c;const u=n(76672)({REGULAR:0,ADMIN:1,SUPERADMIN:2});t.GroupParticipant$Rank=u;const d=n(76672)({DEFAULT:0,OFF:1,ON:2});t.MediaVisibility=d;const p=n(76672)({LEFT:0,REMOVED:1});t.PastParticipant$LeaveReason=p;const f=(0,i.default)({},null);t.HistorySyncSpec=f;const _=(0,i.default)({},null);t.ConversationSpec=_;const h=(0,i.default)({},null);t.HistorySyncMsgSpec=h;const g=(0,i.default)({},null);t.PushnameSpec=g;const m=(0,i.default)({},null);t.GroupParticipantSpec=m;const y=(0,i.default)({},null);t.WallpaperSettingsSpec=y;const S=(0,i.default)({},null);t.GlobalSettingsSpec=S;const E=(0,i.default)({},null);t.AutoDownloadSettingsSpec=E;const v=(0,i.default)({},null);t.StickerMetadataSpec=v;const T=(0,i.default)({},null);t.PastParticipantsSpec=T;const C=(0,i.default)({},null);t.PastParticipantSpec=C,f.internalSpec={syncType:[1,a.FLAGS.REQUIRED|a.TYPES.ENUM,l],conversations:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,_],statusV3Messages:[3,a.FLAGS.REPEATED|a.TYPES.MESSAGE,o.WebMessageInfoSpec],chunkOrder:[5,a.TYPES.UINT32],progress:[6,a.TYPES.UINT32],pushnames:[7,a.FLAGS.REPEATED|a.TYPES.MESSAGE,g],globalSettings:[8,a.TYPES.MESSAGE,S],threadIdUserSecret:[9,a.TYPES.BYTES],threadDsTimeframeOffset:[10,a.TYPES.UINT32],recentStickers:[11,a.FLAGS.REPEATED|a.TYPES.MESSAGE,v],pastParticipants:[12,a.FLAGS.REPEATED|a.TYPES.MESSAGE,T]},_.internalSpec={id:[1,a.FLAGS.REQUIRED|a.TYPES.STRING],messages:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,h],newJid:[3,a.TYPES.STRING],oldJid:[4,a.TYPES.STRING],lastMsgTimestamp:[5,a.TYPES.UINT64],unreadCount:[6,a.TYPES.UINT32],readOnly:[7,a.TYPES.BOOL],endOfHistoryTransfer:[8,a.TYPES.BOOL],ephemeralExpiration:[9,a.TYPES.UINT32],ephemeralSettingTimestamp:[10,a.TYPES.INT64],endOfHistoryTransferType:[11,a.TYPES.ENUM,c],conversationTimestamp:[12,a.TYPES.UINT64],name:[13,a.TYPES.STRING],pHash:[14,a.TYPES.STRING],notSpam:[15,a.TYPES.BOOL],archived:[16,a.TYPES.BOOL],disappearingMode:[17,a.TYPES.MESSAGE,s.DisappearingModeSpec],unreadMentionCount:[18,a.TYPES.UINT32],markedAsUnread:[19,a.TYPES.BOOL],participant:[20,a.FLAGS.REPEATED|a.TYPES.MESSAGE,m],tcToken:[21,a.TYPES.BYTES],tcTokenTimestamp:[22,a.TYPES.UINT64],contactPrimaryIdentityKey:[23,a.TYPES.BYTES],pinned:[24,a.TYPES.UINT32],muteEndTime:[25,a.TYPES.UINT64],wallpaper:[26,a.TYPES.MESSAGE,y],mediaVisibility:[27,a.TYPES.ENUM,d],tcTokenSenderTimestamp:[28,a.TYPES.UINT64],suspended:[29,a.TYPES.BOOL],terminated:[30,a.TYPES.BOOL],createdAt:[31,a.TYPES.UINT64],createdBy:[32,a.TYPES.STRING],description:[33,a.TYPES.STRING],support:[34,a.TYPES.BOOL],isParentGroup:[35,a.TYPES.BOOL],isDefaultSubgroup:[36,a.TYPES.BOOL],parentGroupId:[37,a.TYPES.STRING],displayName:[38,a.TYPES.STRING],pnJid:[39,a.TYPES.STRING],selfPnExposed:[40,a.TYPES.BOOL]},h.internalSpec={message:[1,a.TYPES.MESSAGE,o.WebMessageInfoSpec],msgOrderId:[2,a.TYPES.UINT64]},g.internalSpec={id:[1,a.TYPES.STRING],pushname:[2,a.TYPES.STRING]},m.internalSpec={userJid:[1,a.FLAGS.REQUIRED|a.TYPES.STRING],rank:[2,a.TYPES.ENUM,u]},y.internalSpec={filename:[1,a.TYPES.STRING],opacity:[2,a.TYPES.UINT32]},S.internalSpec={lightThemeWallpaper:[1,a.TYPES.MESSAGE,y],mediaVisibility:[2,a.TYPES.ENUM,d],darkThemeWallpaper:[3,a.TYPES.MESSAGE,y],autoDownloadWiFi:[4,a.TYPES.MESSAGE,E],autoDownloadCellular:[5,a.TYPES.MESSAGE,E],autoDownloadRoaming:[6,a.TYPES.MESSAGE,E],showIndividualNotificationsPreview:[7,a.TYPES.BOOL],showGroupNotificationsPreview:[8,a.TYPES.BOOL],disappearingModeDuration:[9,a.TYPES.INT32],disappearingModeTimestamp:[10,a.TYPES.INT64]},E.internalSpec={downloadImages:[1,a.TYPES.BOOL],downloadAudio:[2,a.TYPES.BOOL],downloadVideo:[3,a.TYPES.BOOL],downloadDocuments:[4,a.TYPES.BOOL]},v.internalSpec={url:[1,a.TYPES.STRING],fileSha256:[2,a.TYPES.BYTES],fileEncSha256:[3,a.TYPES.BYTES],mediaKey:[4,a.TYPES.BYTES],mimetype:[5,a.TYPES.STRING],height:[6,a.TYPES.UINT32],width:[7,a.TYPES.UINT32],directPath:[8,a.TYPES.STRING],fileLength:[9,a.TYPES.UINT64],weight:[10,a.TYPES.FLOAT]},T.internalSpec={groupJid:[1,a.FLAGS.REQUIRED|a.TYPES.STRING],pastParticipants:[2,a.FLAGS.REPEATED|a.TYPES.MESSAGE,C]},C.internalSpec={userJid:[1,a.FLAGS.REQUIRED|a.TYPES.STRING],leaveReason:[2,a.FLAGS.REQUIRED|a.TYPES.ENUM,p],leaveTs:[3,a.FLAGS.REQUIRED|a.TYPES.UINT64]}},682348:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PollEncValueSpec=t.MsgRowOpaqueDataSpec=t.MsgOpaqueDataSpec=t.MsgOpaqueData$PollOptionSpec=void 0;var i=r(n(81109)),a=n(401390);const o=(0,i.default)({},null);t.MsgRowOpaqueDataSpec=o;const s=(0,i.default)({},null);t.PollEncValueSpec=s;const l=(0,i.default)({},null);t.MsgOpaqueDataSpec=l;const c=(0,i.default)({},null);t.MsgOpaqueData$PollOptionSpec=c,o.internalSpec={currentMsg:[1,a.TYPES.MESSAGE,l],quotedMsg:[2,a.TYPES.MESSAGE,l]},s.internalSpec={encPayload:[1,a.TYPES.BYTES],encIv:[2,a.TYPES.BYTES]},l.internalSpec={body:[1,a.TYPES.STRING],caption:[3,a.TYPES.STRING],lng:[5,a.TYPES.DOUBLE],isLive:[6,a.TYPES.BOOL],lat:[7,a.TYPES.DOUBLE],paymentAmount1000:[8,a.TYPES.INT32],paymentNoteMsgBody:[9,a.TYPES.STRING],canonicalUrl:[10,a.TYPES.STRING],matchedText:[11,a.TYPES.STRING],title:[12,a.TYPES.STRING],description:[13,a.TYPES.STRING],futureproofBuffer:[14,a.TYPES.BYTES],clientUrl:[15,a.TYPES.STRING],loc:[16,a.TYPES.STRING],pollName:[17,a.TYPES.STRING],pollOptions:[18,a.FLAGS.REPEATED|a.TYPES.MESSAGE,c],pollSelectableOptionsCount:[20,a.TYPES.UINT32],messageSecret:[21,a.TYPES.BYTES],senderTimestampMs:[22,a.TYPES.INT64],pollUpdateParentKey:[23,a.TYPES.STRING],encPollVote:[24,a.TYPES.MESSAGE,s]},c.internalSpec={name:[1,a.TYPES.STRING]}},16258:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ServerErrorReceiptSpec=t.MediaRetryNotificationSpec=t.MediaRetryNotification$ResultType=void 0;var i=r(n(81109)),a=n(401390);const o=n(76672)({GENERAL_ERROR:0,SUCCESS:1,NOT_FOUND:2,DECRYPTION_ERROR:3});t.MediaRetryNotification$ResultType=o;const s=(0,i.default)({},null);t.MediaRetryNotificationSpec=s;const l=(0,i.default)({},null);t.ServerErrorReceiptSpec=l,s.internalSpec={stanzaId:[1,a.TYPES.STRING],directPath:[2,a.TYPES.STRING],result:[3,a.TYPES.ENUM,o]},l.internalSpec={stanzaId:[1,a.TYPES.STRING]}},793890:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageKeySpec=void 0;var i=r(n(81109)),a=n(401390);const o=(0,i.default)({},null);t.MessageKeySpec=o,o.internalSpec={remoteJid:[1,a.TYPES.STRING],fromMe:[2,a.TYPES.BOOL],id:[3,a.TYPES.STRING],participant:[4,a.TYPES.STRING]}},691344:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedNameCertificateSpec=t.VerifiedNameCertificate$DetailsSpec=t.LocalizedNameSpec=t.BizIdentityInfoSpec=t.BizIdentityInfo$VerifiedLevelValue=t.BizIdentityInfo$HostStorageType=t.BizIdentityInfo$ActualActorsType=t.BizAccountPayloadSpec=t.BizAccountLinkInfoSpec=t.BizAccountLinkInfo$HostStorageType=t.BizAccountLinkInfo$AccountType=void 0;var i=r(n(81109)),a=n(401390);const o=n(76672)({ENTERPRISE:0});t.BizAccountLinkInfo$AccountType=o;const s=n(76672)({ON_PREMISE:0,FACEBOOK:1});t.BizAccountLinkInfo$HostStorageType=s;const l=n(76672)({SELF:0,BSP:1});t.BizIdentityInfo$ActualActorsType=l;const c=n(76672)({ON_PREMISE:0,FACEBOOK:1});t.BizIdentityInfo$HostStorageType=c;const u=n(76672)({UNKNOWN:0,LOW:1,HIGH:2});t.BizIdentityInfo$VerifiedLevelValue=u;const d=(0,i.default)({},null);t.LocalizedNameSpec=d;const p=(0,i.default)({},null);t.VerifiedNameCertificateSpec=p;const f=(0,i.default)({},null);t.VerifiedNameCertificate$DetailsSpec=f;const _=(0,i.default)({},null);t.BizAccountPayloadSpec=_;const h=(0,i.default)({},null);t.BizAccountLinkInfoSpec=h;const g=(0,i.default)({},null);t.BizIdentityInfoSpec=g,d.internalSpec={lg:[1,a.TYPES.STRING],lc:[2,a.TYPES.STRING],verifiedName:[3,a.TYPES.STRING]},p.internalSpec={details:[1,a.TYPES.BYTES],signature:[2,a.TYPES.BYTES],serverSignature:[3,a.TYPES.BYTES]},f.internalSpec={serial:[1,a.TYPES.UINT64],issuer:[2,a.TYPES.STRING],verifiedName:[4,a.TYPES.STRING],localizedNames:[8,a.FLAGS.REPEATED|a.TYPES.MESSAGE,d],issueTime:[10,a.TYPES.UINT64]},_.internalSpec={vnameCert:[1,a.TYPES.MESSAGE,p],bizAcctLinkInfo:[2,a.TYPES.BYTES]},h.internalSpec={whatsappBizAcctFbid:[1,a.TYPES.UINT64],whatsappAcctNumber:[2,a.TYPES.STRING],issueTime:[3,a.TYPES.UINT64],hostStorage:[4,a.TYPES.ENUM,s],accountType:[5,a.TYPES.ENUM,o]},g.internalSpec={vlevel:[1,a.TYPES.ENUM,u],vnameCert:[2,a.TYPES.MESSAGE,p],signed:[3,a.TYPES.BOOL],revoked:[4,a.TYPES.BOOL],hostStorage:[5,a.TYPES.ENUM,c],actualActors:[6,a.TYPES.ENUM,l],privacyModeTs:[7,a.TYPES.UINT64],featureControls:[8,a.TYPES.UINT64]}},384331:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeMessageSpec=t.HandshakeMessage$ServerHelloSpec=t.HandshakeMessage$ClientHelloSpec=t.HandshakeMessage$ClientFinishSpec=t.ClientPayloadSpec=t.ClientPayload$WebInfoSpec=t.ClientPayload$WebInfo$WebdPayloadSpec=t.ClientPayload$WebInfo$WebSubPlatform=t.ClientPayload$UserAgentSpec=t.ClientPayload$UserAgent$ReleaseChannel=t.ClientPayload$UserAgent$Platform=t.ClientPayload$UserAgent$AppVersionSpec=t.ClientPayload$Product=t.ClientPayload$IOSAppExtension=t.ClientPayload$DevicePairingRegistrationDataSpec=t.ClientPayload$DNSSourceSpec=t.ClientPayload$DNSSource$DNSResolutionMethod=t.ClientPayload$ConnectType=t.ClientPayload$ConnectReason=void 0;var i=r(n(81109)),a=n(401390);const o=n(76672)({WHATSAPP:0,MESSENGER:1});t.ClientPayload$Product=o;const s=n(76672)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.ClientPayload$DNSSource$DNSResolutionMethod=s;const l=n(76672)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayload$ConnectType=l;const c=n(76672)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayload$ConnectReason=c;const u=n(76672)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayload$IOSAppExtension=u;const d=n(76672)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.ClientPayload$WebInfo$WebSubPlatform=d;const p=n(76672)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.ClientPayload$UserAgent$ReleaseChannel=p;const f=n(76672)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.ClientPayload$UserAgent$Platform=f;const _=(0,i.default)({},null);t.HandshakeMessageSpec=_;const h=(0,i.default)({},null);t.HandshakeMessage$ClientFinishSpec=h;const g=(0,i.default)({},null);t.HandshakeMessage$ServerHelloSpec=g;const m=(0,i.default)({},null);t.HandshakeMessage$ClientHelloSpec=m;const y=(0,i.default)({},null);t.ClientPayloadSpec=y;const S=(0,i.default)({},null);t.ClientPayload$DevicePairingRegistrationDataSpec=S;const E=(0,i.default)({},null);t.ClientPayload$DNSSourceSpec=E;const v=(0,i.default)({},null);t.ClientPayload$WebInfoSpec=v;const T=(0,i.default)({},null);t.ClientPayload$WebInfo$WebdPayloadSpec=T;const C=(0,i.default)({},null);t.ClientPayload$UserAgentSpec=C;const A=(0,i.default)({},null);t.ClientPayload$UserAgent$AppVersionSpec=A,_.internalSpec={clientHello:[2,a.TYPES.MESSAGE,m],serverHello:[3,a.TYPES.MESSAGE,g],clientFinish:[4,a.TYPES.MESSAGE,h]},h.internalSpec={static:[1,a.TYPES.BYTES],payload:[2,a.TYPES.BYTES]},g.internalSpec={ephemeral:[1,a.TYPES.BYTES],static:[2,a.TYPES.BYTES],payload:[3,a.TYPES.BYTES]},m.internalSpec={ephemeral:[1,a.TYPES.BYTES],static:[2,a.TYPES.BYTES],payload:[3,a.TYPES.BYTES]},y.internalSpec={username:[1,a.TYPES.UINT64],passive:[3,a.TYPES.BOOL],userAgent:[5,a.TYPES.MESSAGE,C],webInfo:[6,a.TYPES.MESSAGE,v],pushName:[7,a.TYPES.STRING],sessionId:[9,a.TYPES.SFIXED32],shortConnect:[10,a.TYPES.BOOL],connectType:[12,a.TYPES.ENUM,l],connectReason:[13,a.TYPES.ENUM,c],shards:[14,a.FLAGS.REPEATED|a.TYPES.INT32],dnsSource:[15,a.TYPES.MESSAGE,E],connectAttemptCount:[16,a.TYPES.UINT32],device:[18,a.TYPES.UINT32],devicePairingData:[19,a.TYPES.MESSAGE,S],product:[20,a.TYPES.ENUM,o],fbCat:[21,a.TYPES.BYTES],fbUserAgent:[22,a.TYPES.BYTES],oc:[23,a.TYPES.BOOL],lc:[24,a.TYPES.INT32],iosAppExtension:[30,a.TYPES.ENUM,u],fbAppId:[31,a.TYPES.UINT64],fbDeviceId:[32,a.TYPES.BYTES],pull:[33,a.TYPES.BOOL],paddingBytes:[34,a.TYPES.BYTES]},S.internalSpec={eRegid:[1,a.TYPES.BYTES],eKeytype:[2,a.TYPES.BYTES],eIdent:[3,a.TYPES.BYTES],eSkeyId:[4,a.TYPES.BYTES],eSkeyVal:[5,a.TYPES.BYTES],eSkeySig:[6,a.TYPES.BYTES],buildHash:[7,a.TYPES.BYTES],deviceProps:[8,a.TYPES.BYTES]},E.internalSpec={dnsMethod:[15,a.TYPES.ENUM,s],appCached:[16,a.TYPES.BOOL]},v.internalSpec={refToken:[1,a.TYPES.STRING],version:[2,a.TYPES.STRING],webdPayload:[3,a.TYPES.MESSAGE,T],webSubPlatform:[4,a.TYPES.ENUM,d]},T.internalSpec={usesParticipantInKey:[1,a.TYPES.BOOL],supportsStarredMessages:[2,a.TYPES.BOOL],supportsDocumentMessages:[3,a.TYPES.BOOL],supportsUrlMessages:[4,a.TYPES.BOOL],supportsMediaRetry:[5,a.TYPES.BOOL],supportsE2EImage:[6,a.TYPES.BOOL],supportsE2EVideo:[7,a.TYPES.BOOL],supportsE2EAudio:[8,a.TYPES.BOOL],supportsE2EDocument:[9,a.TYPES.BOOL],documentTypes:[10,a.TYPES.STRING],features:[11,a.TYPES.BYTES]},C.internalSpec={platform:[1,a.TYPES.ENUM,f],appVersion:[2,a.TYPES.MESSAGE,A],mcc:[3,a.TYPES.STRING],mnc:[4,a.TYPES.STRING],osVersion:[5,a.TYPES.STRING],manufacturer:[6,a.TYPES.STRING],device:[7,a.TYPES.STRING],osBuildNumber:[8,a.TYPES.STRING],phoneId:[9,a.TYPES.STRING],releaseChannel:[10,a.TYPES.ENUM,p],localeLanguageIso6391:[11,a.TYPES.STRING],localeCountryIso31661Alpha2:[12,a.TYPES.STRING],deviceBoard:[13,a.TYPES.STRING]},A.internalSpec={primary:[1,a.TYPES.UINT32],secondary:[2,a.TYPES.UINT32],tertiary:[3,a.TYPES.UINT32],quaternary:[4,a.TYPES.UINT32],quinary:[5,a.TYPES.UINT32]}},178155:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.HandshakeMessageSpec=t.HandshakeMessage$ServerHelloSpec=t.HandshakeMessage$ClientHelloSpec=t.HandshakeMessage$ClientFinishSpec=t.ClientPayloadSpec=t.ClientPayload$WebInfoSpec=t.ClientPayload$WebInfo$WebdPayloadSpec=t.ClientPayload$WebInfo$WebSubPlatform=t.ClientPayload$UserAgentSpec=t.ClientPayload$UserAgent$ReleaseChannel=t.ClientPayload$UserAgent$Platform=t.ClientPayload$UserAgent$AppVersionSpec=t.ClientPayload$Product=t.ClientPayload$IOSAppExtension=t.ClientPayload$DevicePairingRegistrationDataSpec=t.ClientPayload$DNSSourceSpec=t.ClientPayload$DNSSource$DNSResolutionMethod=t.ClientPayload$ConnectType=t.ClientPayload$ConnectReason=void 0;var i=r(n(81109)),a=n(401390);const o=n(76672)({WHATSAPP:0,MESSENGER:1});t.ClientPayload$Product=o;const s=n(76672)({SYSTEM:0,GOOGLE:1,HARDCODED:2,OVERRIDE:3,FALLBACK:4});t.ClientPayload$DNSSource$DNSResolutionMethod=s;const l=n(76672)({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112});t.ClientPayload$ConnectType=l;const c=n(76672)({PUSH:0,USER_ACTIVATED:1,SCHEDULED:2,ERROR_RECONNECT:3,NETWORK_SWITCH:4,PING_RECONNECT:5});t.ClientPayload$ConnectReason=c;const u=n(76672)({SHARE_EXTENSION:0,SERVICE_EXTENSION:1,INTENTS_EXTENSION:2});t.ClientPayload$IOSAppExtension=u;const d=n(76672)({WEB_BROWSER:0,APP_STORE:1,WIN_STORE:2,DARWIN:3,WIN32:4});t.ClientPayload$WebInfo$WebSubPlatform=d;const p=n(76672)({RELEASE:0,BETA:1,ALPHA:2,DEBUG:3});t.ClientPayload$UserAgent$ReleaseChannel=p;const f=n(76672)({ANDROID:0,IOS:1,WINDOWS_PHONE:2,BLACKBERRY:3,BLACKBERRYX:4,S40:5,S60:6,PYTHON_CLIENT:7,TIZEN:8,ENTERPRISE:9,SMB_ANDROID:10,KAIOS:11,SMB_IOS:12,WINDOWS:13,WEB:14,PORTAL:15,GREEN_ANDROID:16,GREEN_IPHONE:17,BLUE_ANDROID:18,BLUE_IPHONE:19,FBLITE_ANDROID:20,MLITE_ANDROID:21,IGLITE_ANDROID:22,PAGE:23,MACOS:24,OCULUS_MSG:25,OCULUS_CALL:26,MILAN:27,CAPI:28});t.ClientPayload$UserAgent$Platform=f;const _=(0,i.default)({},null);t.HandshakeMessageSpec=_;const h=(0,i.default)({},null);t.HandshakeMessage$ClientFinishSpec=h;const g=(0,i.default)({},null);t.HandshakeMessage$ServerHelloSpec=g;const m=(0,i.default)({},null);t.HandshakeMessage$ClientHelloSpec=m;const y=(0,i.default)({},null);t.ClientPayloadSpec=y;const S=(0,i.default)({},null);t.ClientPayload$DevicePairingRegistrationDataSpec=S;const E=(0,i.default)({},null);t.ClientPayload$DNSSourceSpec=E;const v=(0,i.default)({},null);t.ClientPayload$WebInfoSpec=v;const T=(0,i.default)({},null);t.ClientPayload$WebInfo$WebdPayloadSpec=T;const C=(0,i.default)({},null);t.ClientPayload$UserAgentSpec=C;const A=(0,i.default)({},null);t.ClientPayload$UserAgent$AppVersionSpec=A,_.internalSpec={clientHello:[2,a.TYPES.MESSAGE,m],serverHello:[3,a.TYPES.MESSAGE,g],clientFinish:[4,a.TYPES.MESSAGE,h]},h.internalSpec={static:[1,a.TYPES.BYTES],payload:[2,a.TYPES.BYTES]},g.internalSpec={ephemeral:[1,a.TYPES.BYTES],static:[2,a.TYPES.BYTES],payload:[3,a.TYPES.BYTES]},m.internalSpec={ephemeral:[1,a.TYPES.BYTES],static:[2,a.TYPES.BYTES],payload:[3,a.TYPES.BYTES]},y.internalSpec={username:[1,a.TYPES.UINT64],passive:[3,a.TYPES.BOOL],userAgent:[5,a.TYPES.MESSAGE,C],webInfo:[6,a.TYPES.MESSAGE,v],pushName:[7,a.TYPES.STRING],sessionId:[9,a.TYPES.SFIXED32],shortConnect:[10,a.TYPES.BOOL],connectType:[12,a.TYPES.ENUM,l],connectReason:[13,a.TYPES.ENUM,c],shards:[14,a.FLAGS.REPEATED|a.TYPES.INT32],dnsSource:[15,a.TYPES.MESSAGE,E],connectAttemptCount:[16,a.TYPES.UINT32],device:[18,a.TYPES.UINT32],devicePairingData:[19,a.TYPES.MESSAGE,S],product:[20,a.TYPES.ENUM,o],fbCat:[21,a.TYPES.BYTES],fbUserAgent:[22,a.TYPES.BYTES],oc:[23,a.TYPES.BOOL],lc:[24,a.TYPES.INT32],iosAppExtension:[30,a.TYPES.ENUM,u],fbAppId:[31,a.TYPES.UINT64],fbDeviceId:[32,a.TYPES.BYTES],pull:[33,a.TYPES.BOOL],paddingBytes:[34,a.TYPES.BYTES]},S.internalSpec={eRegid:[1,a.TYPES.BYTES],eKeytype:[2,a.TYPES.BYTES],eIdent:[3,a.TYPES.BYTES],eSkeyId:[4,a.TYPES.BYTES],eSkeyVal:[5,a.TYPES.BYTES],eSkeySig:[6,a.TYPES.BYTES],buildHash:[7,a.TYPES.BYTES],deviceProps:[8,a.TYPES.BYTES]},E.internalSpec={dnsMethod:[15,a.TYPES.ENUM,s],appCached:[16,a.TYPES.BOOL]},v.internalSpec={refToken:[1,a.TYPES.STRING],version:[2,a.TYPES.STRING],webdPayload:[3,a.TYPES.MESSAGE,T],webSubPlatform:[4,a.TYPES.ENUM,d]},T.internalSpec={usesParticipantInKey:[1,a.TYPES.BOOL],supportsStarredMessages:[2,a.TYPES.BOOL],supportsDocumentMessages:[3,a.TYPES.BOOL],supportsUrlMessages:[4,a.TYPES.BOOL],supportsMediaRetry:[5,a.TYPES.BOOL],supportsE2EImage:[6,a.TYPES.BOOL],supportsE2EVideo:[7,a.TYPES.BOOL],supportsE2EAudio:[8,a.TYPES.BOOL],supportsE2EDocument:[9,a.TYPES.BOOL],documentTypes:[10,a.TYPES.STRING],features:[11,a.TYPES.BYTES]},C.internalSpec={platform:[1,a.TYPES.ENUM,f],appVersion:[2,a.TYPES.MESSAGE,A],mcc:[3,a.TYPES.STRING],mnc:[4,a.TYPES.STRING],osVersion:[5,a.TYPES.STRING],manufacturer:[6,a.TYPES.STRING],device:[7,a.TYPES.STRING],osBuildNumber:[8,a.TYPES.STRING],phoneId:[9,a.TYPES.STRING],releaseChannel:[10,a.TYPES.ENUM,p],localeLanguageIso6391:[11,a.TYPES.STRING],localeCountryIso31661Alpha2:[12,a.TYPES.STRING],deviceBoard:[13,a.TYPES.STRING]},A.internalSpec={primary:[1,a.TYPES.UINT32],secondary:[2,a.TYPES.UINT32],tertiary:[3,a.TYPES.UINT32],quaternary:[4,a.TYPES.UINT32],quinary:[5,a.TYPES.UINT32]}},421224:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WebNotificationsInfoSpec=t.WebMessageInfoSpec=t.WebMessageInfo$StubType=t.WebMessageInfo$Status=t.WebMessageInfo$BizPrivacyStatus=t.WebFeaturesSpec=t.WebFeatures$Flag=t.UserReceiptSpec=t.StatusPSASpec=t.ReactionSpec=t.PollUpdateSpec=t.PollAdditionalMetadataSpec=t.PhotoChangeSpec=t.PaymentInfoSpec=t.PaymentInfo$TxnStatus=t.PaymentInfo$Status=t.PaymentInfo$Currency=t.NotificationMessageInfoSpec=t.MediaDataSpec=t.KeepInChatSpec=void 0;var i=r(n(81109)),a=n(401390),o=n(124808),s=n(793890);const l=n(76672)({E2EE:0,FB:2,BSP:1,BSP_AND_FB:3});t.WebMessageInfo$BizPrivacyStatus=l;const c=n(76672)({UNKNOWN:0,REVOKE:1,CIPHERTEXT:2,FUTUREPROOF:3,NON_VERIFIED_TRANSITION:4,UNVERIFIED_TRANSITION:5,VERIFIED_TRANSITION:6,VERIFIED_LOW_UNKNOWN:7,VERIFIED_HIGH:8,VERIFIED_INITIAL_UNKNOWN:9,VERIFIED_INITIAL_LOW:10,VERIFIED_INITIAL_HIGH:11,VERIFIED_TRANSITION_ANY_TO_NONE:12,VERIFIED_TRANSITION_ANY_TO_HIGH:13,VERIFIED_TRANSITION_HIGH_TO_LOW:14,VERIFIED_TRANSITION_HIGH_TO_UNKNOWN:15,VERIFIED_TRANSITION_UNKNOWN_TO_LOW:16,VERIFIED_TRANSITION_LOW_TO_UNKNOWN:17,VERIFIED_TRANSITION_NONE_TO_LOW:18,VERIFIED_TRANSITION_NONE_TO_UNKNOWN:19,GROUP_CREATE:20,GROUP_CHANGE_SUBJECT:21,GROUP_CHANGE_ICON:22,GROUP_CHANGE_INVITE_LINK:23,GROUP_CHANGE_DESCRIPTION:24,GROUP_CHANGE_RESTRICT:25,GROUP_CHANGE_ANNOUNCE:26,GROUP_PARTICIPANT_ADD:27,GROUP_PARTICIPANT_REMOVE:28,GROUP_PARTICIPANT_PROMOTE:29,GROUP_PARTICIPANT_DEMOTE:30,GROUP_PARTICIPANT_INVITE:31,GROUP_PARTICIPANT_LEAVE:32,GROUP_PARTICIPANT_CHANGE_NUMBER:33,BROADCAST_CREATE:34,BROADCAST_ADD:35,BROADCAST_REMOVE:36,GENERIC_NOTIFICATION:37,E2E_IDENTITY_CHANGED:38,E2E_ENCRYPTED:39,CALL_MISSED_VOICE:40,CALL_MISSED_VIDEO:41,INDIVIDUAL_CHANGE_NUMBER:42,GROUP_DELETE:43,GROUP_ANNOUNCE_MODE_MESSAGE_BOUNCE:44,CALL_MISSED_GROUP_VOICE:45,CALL_MISSED_GROUP_VIDEO:46,PAYMENT_CIPHERTEXT:47,PAYMENT_FUTUREPROOF:48,PAYMENT_TRANSACTION_STATUS_UPDATE_FAILED:49,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUNDED:50,PAYMENT_TRANSACTION_STATUS_UPDATE_REFUND_FAILED:51,PAYMENT_TRANSACTION_STATUS_RECEIVER_PENDING_SETUP:52,PAYMENT_TRANSACTION_STATUS_RECEIVER_SUCCESS_AFTER_HICCUP:53,PAYMENT_ACTION_ACCOUNT_SETUP_REMINDER:54,PAYMENT_ACTION_SEND_PAYMENT_REMINDER:55,PAYMENT_ACTION_SEND_PAYMENT_INVITATION:56,PAYMENT_ACTION_REQUEST_DECLINED:57,PAYMENT_ACTION_REQUEST_EXPIRED:58,PAYMENT_ACTION_REQUEST_CANCELLED:59,BIZ_VERIFIED_TRANSITION_TOP_TO_BOTTOM:60,BIZ_VERIFIED_TRANSITION_BOTTOM_TO_TOP:61,BIZ_INTRO_TOP:62,BIZ_INTRO_BOTTOM:63,BIZ_NAME_CHANGE:64,BIZ_MOVE_TO_CONSUMER_APP:65,BIZ_TWO_TIER_MIGRATION_TOP:66,BIZ_TWO_TIER_MIGRATION_BOTTOM:67,OVERSIZED:68,GROUP_CHANGE_NO_FREQUENTLY_FORWARDED:69,GROUP_V4_ADD_INVITE_SENT:70,GROUP_PARTICIPANT_ADD_REQUEST_JOIN:71,CHANGE_EPHEMERAL_SETTING:72,E2E_DEVICE_CHANGED:73,VIEWED_ONCE:74,E2E_ENCRYPTED_NOW:75,BLUE_MSG_BSP_FB_TO_BSP_PREMISE:76,BLUE_MSG_BSP_FB_TO_SELF_FB:77,BLUE_MSG_BSP_FB_TO_SELF_PREMISE:78,BLUE_MSG_BSP_FB_UNVERIFIED:79,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:80,BLUE_MSG_BSP_FB_VERIFIED:81,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:82,BLUE_MSG_BSP_PREMISE_TO_SELF_PREMISE:83,BLUE_MSG_BSP_PREMISE_UNVERIFIED:84,BLUE_MSG_BSP_PREMISE_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:85,BLUE_MSG_BSP_PREMISE_VERIFIED:86,BLUE_MSG_BSP_PREMISE_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:87,BLUE_MSG_CONSUMER_TO_BSP_FB_UNVERIFIED:88,BLUE_MSG_CONSUMER_TO_BSP_PREMISE_UNVERIFIED:89,BLUE_MSG_CONSUMER_TO_SELF_FB_UNVERIFIED:90,BLUE_MSG_CONSUMER_TO_SELF_PREMISE_UNVERIFIED:91,BLUE_MSG_SELF_FB_TO_BSP_PREMISE:92,BLUE_MSG_SELF_FB_TO_SELF_PREMISE:93,BLUE_MSG_SELF_FB_UNVERIFIED:94,BLUE_MSG_SELF_FB_UNVERIFIED_TO_SELF_PREMISE_VERIFIED:95,BLUE_MSG_SELF_FB_VERIFIED:96,BLUE_MSG_SELF_FB_VERIFIED_TO_SELF_PREMISE_UNVERIFIED:97,BLUE_MSG_SELF_PREMISE_TO_BSP_PREMISE:98,BLUE_MSG_SELF_PREMISE_UNVERIFIED:99,BLUE_MSG_SELF_PREMISE_VERIFIED:100,BLUE_MSG_TO_BSP_FB:101,BLUE_MSG_TO_CONSUMER:102,BLUE_MSG_TO_SELF_FB:103,BLUE_MSG_UNVERIFIED_TO_BSP_FB_VERIFIED:104,BLUE_MSG_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:105,BLUE_MSG_UNVERIFIED_TO_SELF_FB_VERIFIED:106,BLUE_MSG_UNVERIFIED_TO_VERIFIED:107,BLUE_MSG_VERIFIED_TO_BSP_FB_UNVERIFIED:108,BLUE_MSG_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:109,BLUE_MSG_VERIFIED_TO_SELF_FB_UNVERIFIED:110,BLUE_MSG_VERIFIED_TO_UNVERIFIED:111,BLUE_MSG_BSP_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:112,BLUE_MSG_BSP_FB_UNVERIFIED_TO_SELF_FB_VERIFIED:113,BLUE_MSG_BSP_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:114,BLUE_MSG_BSP_FB_VERIFIED_TO_SELF_FB_UNVERIFIED:115,BLUE_MSG_SELF_FB_UNVERIFIED_TO_BSP_PREMISE_VERIFIED:116,BLUE_MSG_SELF_FB_VERIFIED_TO_BSP_PREMISE_UNVERIFIED:117,E2E_IDENTITY_UNAVAILABLE:118,GROUP_CREATING:119,GROUP_CREATE_FAILED:120,GROUP_BOUNCED:121,BLOCK_CONTACT:122,EPHEMERAL_SETTING_NOT_APPLIED:123,SYNC_FAILED:124,SYNCING:125,BIZ_PRIVACY_MODE_INIT_FB:126,BIZ_PRIVACY_MODE_INIT_BSP:127,BIZ_PRIVACY_MODE_TO_FB:128,BIZ_PRIVACY_MODE_TO_BSP:129,DISAPPEARING_MODE:130,E2E_DEVICE_FETCH_FAILED:131,ADMIN_REVOKE:132,GROUP_INVITE_LINK_GROWTH_LOCKED:133,COMMUNITY_LINK_PARENT_GROUP:134,COMMUNITY_LINK_SIBLING_GROUP:135,COMMUNITY_LINK_SUB_GROUP:136,COMMUNITY_UNLINK_PARENT_GROUP:137,COMMUNITY_UNLINK_SIBLING_GROUP:138,COMMUNITY_UNLINK_SUB_GROUP:139,GROUP_PARTICIPANT_ACCEPT:140,GROUP_PARTICIPANT_LINKED_GROUP_JOIN:141,COMMUNITY_CREATE:142,EPHEMERAL_KEEP_IN_CHAT:143,GROUP_MEMBERSHIP_JOIN_APPROVAL_REQUEST:144,GROUP_MEMBERSHIP_JOIN_APPROVAL_MODE:145,INTEGRITY_UNLINK_PARENT_GROUP:146,COMMUNITY_PARTICIPANT_PROMOTE:147,COMMUNITY_PARTICIPANT_DEMOTE:148,COMMUNITY_PARENT_GROUP_DELETED:149});t.WebMessageInfo$StubType=c;const u=n(76672)({ERROR:0,PENDING:1,SERVER_ACK:2,DELIVERY_ACK:3,READ:4,PLAYED:5});t.WebMessageInfo$Status=u;const d=n(76672)({UNKNOWN:0,PENDING_SETUP:1,PENDING_RECEIVER_SETUP:2,INIT:3,SUCCESS:4,COMPLETED:5,FAILED:6,FAILED_RISK:7,FAILED_PROCESSING:8,FAILED_RECEIVER_PROCESSING:9,FAILED_DA:10,FAILED_DA_FINAL:11,REFUNDED_TXN:12,REFUND_FAILED:13,REFUND_FAILED_PROCESSING:14,REFUND_FAILED_DA:15,EXPIRED_TXN:16,AUTH_CANCELED:17,AUTH_CANCEL_FAILED_PROCESSING:18,AUTH_CANCEL_FAILED:19,COLLECT_INIT:20,COLLECT_SUCCESS:21,COLLECT_FAILED:22,COLLECT_FAILED_RISK:23,COLLECT_REJECTED:24,COLLECT_EXPIRED:25,COLLECT_CANCELED:26,COLLECT_CANCELLING:27,IN_REVIEW:28,REVERSAL_SUCCESS:29,REVERSAL_PENDING:30,REFUND_PENDING:31});t.PaymentInfo$TxnStatus=d;const p=n(76672)({UNKNOWN_STATUS:0,PROCESSING:1,SENT:2,NEED_TO_ACCEPT:3,COMPLETE:4,COULD_NOT_COMPLETE:5,REFUNDED:6,EXPIRED:7,REJECTED:8,CANCELLED:9,WAITING_FOR_PAYER:10,WAITING:11});t.PaymentInfo$Status=p;const f=n(76672)({UNKNOWN_CURRENCY:0,INR:1});t.PaymentInfo$Currency=f;const _=n(76672)({NOT_STARTED:0,FORCE_UPGRADE:1,DEVELOPMENT:2,PRODUCTION:3});t.WebFeatures$Flag=_;const h=(0,i.default)({},null);t.WebMessageInfoSpec=h;const g=(0,i.default)({},null);t.PaymentInfoSpec=g;const m=(0,i.default)({},null);t.WebNotificationsInfoSpec=m;const y=(0,i.default)({},null);t.NotificationMessageInfoSpec=y;const S=(0,i.default)({},null);t.WebFeaturesSpec=S;const E=(0,i.default)({},null);t.MediaDataSpec=E;const v=(0,i.default)({},null);t.PhotoChangeSpec=v;const T=(0,i.default)({},null);t.StatusPSASpec=T;const C=(0,i.default)({},null);t.UserReceiptSpec=C;const A=(0,i.default)({},null);t.ReactionSpec=A;const b=(0,i.default)({},null);t.PollUpdateSpec=b;const P=(0,i.default)({},null);t.PollAdditionalMetadataSpec=P;const O=(0,i.default)({},null);t.KeepInChatSpec=O,h.internalDefaults={status:u.PENDING},h.internalSpec={key:[1,a.FLAGS.REQUIRED|a.TYPES.MESSAGE,s.MessageKeySpec],message:[2,a.TYPES.MESSAGE,o.MessageSpec],messageTimestamp:[3,a.TYPES.UINT64],status:[4,a.TYPES.ENUM,u],participant:[5,a.TYPES.STRING],messageC2STimestamp:[6,a.TYPES.UINT64],ignore:[16,a.TYPES.BOOL],starred:[17,a.TYPES.BOOL],broadcast:[18,a.TYPES.BOOL],pushName:[19,a.TYPES.STRING],mediaCiphertextSha256:[20,a.TYPES.BYTES],multicast:[21,a.TYPES.BOOL],urlText:[22,a.TYPES.BOOL],urlNumber:[23,a.TYPES.BOOL],messageStubType:[24,a.TYPES.ENUM,c],clearMedia:[25,a.TYPES.BOOL],messageStubParameters:[26,a.FLAGS.REPEATED|a.TYPES.STRING],duration:[27,a.TYPES.UINT32],labels:[28,a.FLAGS.REPEATED|a.TYPES.STRING],paymentInfo:[29,a.TYPES.MESSAGE,g],finalLiveLocation:[30,a.TYPES.MESSAGE,o.Message$LiveLocationMessageSpec],quotedPaymentInfo:[31,a.TYPES.MESSAGE,g],ephemeralStartTimestamp:[32,a.TYPES.UINT64],ephemeralDuration:[33,a.TYPES.UINT32],ephemeralOffToOn:[34,a.TYPES.BOOL],ephemeralOutOfSync:[35,a.TYPES.BOOL],bizPrivacyStatus:[36,a.TYPES.ENUM,l],verifiedBizName:[37,a.TYPES.STRING],mediaData:[38,a.TYPES.MESSAGE,E],photoChange:[39,a.TYPES.MESSAGE,v],userReceipt:[40,a.FLAGS.REPEATED|a.TYPES.MESSAGE,C],reactions:[41,a.FLAGS.REPEATED|a.TYPES.MESSAGE,A],quotedStickerData:[42,a.TYPES.MESSAGE,E],futureproofData:[43,a.TYPES.BYTES],statusPsa:[44,a.TYPES.MESSAGE,T],pollUpdates:[45,a.FLAGS.REPEATED|a.TYPES.MESSAGE,b],pollAdditionalMetadata:[46,a.TYPES.MESSAGE,P],agentId:[47,a.TYPES.STRING],statusAlreadyViewed:[48,a.TYPES.BOOL],messageSecret:[49,a.TYPES.BYTES],keepInChat:[50,a.TYPES.MESSAGE,O],originalSelfAuthorUserJidString:[51,a.TYPES.STRING],revokeMessageTimestamp:[52,a.TYPES.UINT64]},g.internalSpec={currencyDeprecated:[1,a.TYPES.ENUM,f],amount1000:[2,a.TYPES.UINT64],receiverJid:[3,a.TYPES.STRING],status:[4,a.TYPES.ENUM,p],transactionTimestamp:[5,a.TYPES.UINT64],requestMessageKey:[6,a.TYPES.MESSAGE,s.MessageKeySpec],expiryTimestamp:[7,a.TYPES.UINT64],futureproofed:[8,a.TYPES.BOOL],currency:[9,a.TYPES.STRING],txnStatus:[10,a.TYPES.ENUM,d],useNoviFiatFormat:[11,a.TYPES.BOOL],primaryAmount:[12,a.TYPES.MESSAGE,o.MoneySpec],exchangeAmount:[13,a.TYPES.MESSAGE,o.MoneySpec]},m.internalSpec={timestamp:[2,a.TYPES.UINT64],unreadChats:[3,a.TYPES.UINT32],notifyMessageCount:[4,a.TYPES.UINT32],notifyMessages:[5,a.FLAGS.REPEATED|a.TYPES.MESSAGE,h]},y.internalSpec={key:[1,a.TYPES.MESSAGE,s.MessageKeySpec],message:[2,a.TYPES.MESSAGE,o.MessageSpec],messageTimestamp:[3,a.TYPES.UINT64],participant:[4,a.TYPES.STRING]},S.internalSpec={labelsDisplay:[1,a.TYPES.ENUM,_],voipIndividualOutgoing:[2,a.TYPES.ENUM,_],groupsV3:[3,a.TYPES.ENUM,_],groupsV3Create:[4,a.TYPES.ENUM,_],changeNumberV2:[5,a.TYPES.ENUM,_],queryStatusV3Thumbnail:[6,a.TYPES.ENUM,_],liveLocations:[7,a.TYPES.ENUM,_],queryVname:[8,a.TYPES.ENUM,_],voipIndividualIncoming:[9,a.TYPES.ENUM,_],quickRepliesQuery:[10,a.TYPES.ENUM,_],payments:[11,a.TYPES.ENUM,_],stickerPackQuery:[12,a.TYPES.ENUM,_],liveLocationsFinal:[13,a.TYPES.ENUM,_],labelsEdit:[14,a.TYPES.ENUM,_],mediaUpload:[15,a.TYPES.ENUM,_],mediaUploadRichQuickReplies:[18,a.TYPES.ENUM,_],vnameV2:[19,a.TYPES.ENUM,_],videoPlaybackUrl:[20,a.TYPES.ENUM,_],statusRanking:[21,a.TYPES.ENUM,_],voipIndividualVideo:[22,a.TYPES.ENUM,_],thirdPartyStickers:[23,a.TYPES.ENUM,_],frequentlyForwardedSetting:[24,a.TYPES.ENUM,_],groupsV4JoinPermission:[25,a.TYPES.ENUM,_],recentStickers:[26,a.TYPES.ENUM,_],catalog:[27,a.TYPES.ENUM,_],starredStickers:[28,a.TYPES.ENUM,_],voipGroupCall:[29,a.TYPES.ENUM,_],templateMessage:[30,a.TYPES.ENUM,_],templateMessageInteractivity:[31,a.TYPES.ENUM,_],ephemeralMessages:[32,a.TYPES.ENUM,_],e2ENotificationSync:[33,a.TYPES.ENUM,_],recentStickersV2:[34,a.TYPES.ENUM,_],recentStickersV3:[36,a.TYPES.ENUM,_],userNotice:[37,a.TYPES.ENUM,_],support:[39,a.TYPES.ENUM,_],groupUiiCleanup:[40,a.TYPES.ENUM,_],groupDogfoodingInternalOnly:[41,a.TYPES.ENUM,_],settingsSync:[42,a.TYPES.ENUM,_],archiveV2:[43,a.TYPES.ENUM,_],ephemeralAllowGroupMembers:[44,a.TYPES.ENUM,_],ephemeral24HDuration:[45,a.TYPES.ENUM,_],mdForceUpgrade:[46,a.TYPES.ENUM,_],disappearingMode:[47,a.TYPES.ENUM,_],externalMdOptInAvailable:[48,a.TYPES.ENUM,_],noDeleteMessageTimeLimit:[49,a.TYPES.ENUM,_]},E.internalSpec={localPath:[1,a.TYPES.STRING]},v.internalSpec={oldPhoto:[1,a.TYPES.BYTES],newPhoto:[2,a.TYPES.BYTES],newPhotoId:[3,a.TYPES.UINT32]},T.internalSpec={campaignId:[44,a.FLAGS.REQUIRED|a.TYPES.UINT64],campaignExpirationTimestamp:[45,a.TYPES.UINT64]},C.internalSpec={userJid:[1,a.FLAGS.REQUIRED|a.TYPES.STRING],receiptTimestamp:[2,a.TYPES.INT64],readTimestamp:[3,a.TYPES.INT64],playedTimestamp:[4,a.TYPES.INT64],pendingDeviceJid:[5,a.FLAGS.REPEATED|a.TYPES.STRING],deliveredDeviceJid:[6,a.FLAGS.REPEATED|a.TYPES.STRING]},A.internalSpec={key:[1,a.TYPES.MESSAGE,s.MessageKeySpec],text:[2,a.TYPES.STRING],groupingKey:[3,a.TYPES.STRING],senderTimestampMs:[4,a.TYPES.INT64],unread:[5,a.TYPES.BOOL]},b.internalSpec={pollUpdateMessageKey:[1,a.TYPES.MESSAGE,s.MessageKeySpec],vote:[2,a.TYPES.MESSAGE,o.Message$PollVoteMessageSpec],senderTimestampMs:[3,a.TYPES.INT64]},P.internalSpec={pollInvalidated:[1,a.TYPES.BOOL]},O.internalSpec={keepType:[1,a.TYPES.ENUM,o.KeepType],serverTimestamp:[2,a.TYPES.INT64],key:[3,a.TYPES.MESSAGE,s.MessageKeySpec],deviceJid:[4,a.TYPES.STRING]}},925918:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEventSampling=function(){return(0,r.getABPropConfigValue)("qpl_sampling_as_string")},t.getInitialUploadDelayInSeconds=function(){return 60*(0,r.getABPropConfigValue)("qpl_initial_upload_delay")},t.getUploadIntervalInSeconds=function(){return 60*(0,r.getABPropConfigValue)("qpl_upload_delay")},t.isQplEnabled=function(){return(0,r.getABPropConfigValue)("qpl_enabled")};var r=n(257243)},41184:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.config=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s&&!0!==t?__LOG__(3,void 0,void 0,void 0,["qpl"])`QPL Config has already been initialized`:(o=new Map,l=e,f(),s={isQplEnabled:c,uploadInterval:u,getEventDetails:p,uploadDelay:d});return s};var r=n(494694),i=n(382828);const a={sampleRate:0,samplingMethod:r.QplSampleMethod.EVENT_BASED_SAMPLING};r.QplSampleMethod.EVENT_BASED_SAMPLING;let o,s,l;function c(){return l.isQplEnabled()}function u(){return l.getUploadIntervalInSeconds()}function d(){return l.getInitialUploadDelayInSeconds()}function p(e){const t=o.get(e);return t||a}function f(){try{let e=l.getEventSampling();0===e.indexOf("json:")&&(e=e.slice(5));const t=JSON.parse(e);t.sampling.forEach((e=>{const t=e[0],n=e[1],r=Math.max(e[2],0);o.set(t,{sampleRate:r,samplingMethod:n})}))}catch(e){(0,i.errorParsingConfig)(e)}}},382828:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.annotationKeyTooLong=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_KEY_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${n}`}).commit()},t.annotationSizeLimitExceeded=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ANNOTATION_SIZE_LIMIT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, annotationKey: ${n}`}).commit()},t.errorParsingConfig=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_PARSING_CONFIG,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.errorUploadingChunk=function(e){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.ERROR_UPLOADING_CHUNK,webcQplHealthEventData:`errorString: ${e}`}).commit()},t.maxPointCountExceeded=function(e,t){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_POINT_COUNT_EXCEEDED,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}`}).commit()},t.maxStorageEventCountReached=function(){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.MAX_STORAGE_EVENT_COUNT_REACHED}).commit()},t.pointDataTooLong=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_DATA_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, data: ${n}`}).commit()},t.pointNameTooLong=function(e,t,n){if(a++>5)return;new i.default.WebcQplHealth({webcQplHealthEventType:i.default.WEBC_QPL_HEALTH_EVENT_TYPE.POINT_NAME_TOO_LONG,webcQplHealthEventData:`markerId: ${e}, instanceKey: ${t}, pointName: ${n}`}).commit()};var i=r(n(11339));let a=0},38892:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.startQPL=function(){(0,i.defaultQplNetwork)({instrumentForJestE2E:false,restInterface:m,isDev:false,qplAccessToken:d.qplConfigs.accessToken,qplAppId:d.qplConfigs.appId,qplEndpoint:d.qplConfigs.endpoint});const e=(0,s.config)(o);e.isQplEnabled()?(__LOG__(2)`QPL is being initialized`,(0,a.start)({isQplEnabled:e.isQplEnabled,sendEvents:e=>(0,i.defaultQplNetwork)().sendEventsOverNetwork(e),intervalInSeconds:e.uploadInterval(),startDelayInSeconds:e.uploadDelay()},{storageApi:new u.QplStorageApi,healthLogger:g,instrumentForJestE2E:false}),c.QPL.init((e=>((0,f.add)([e]),Promise.resolve())),e.getEventDetails,e.isQplEnabled)):(__LOG__(2)`QPL is disabled, throwing Killswitch, will clear database`,c.QPL.throwKillswitch(!0),c.QPL.clearStorage())};var i=n(656457),a=n(607279),o=h(n(925918)),s=n(41184),l=h(n(382828)),c=(n(665397),n(669393)),u=n(226107),d=n(296400),p=r(n(511854)),f=n(663719);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}function h(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const g=l;const m={post:p.default.post}},665397:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickLogMarkerId=void 0;const r=n(76672)({PHOENIX_FDS_IQ_EXECUTION:578499140,WHATSAPP_COLLECTIONS_MANAGEMENT_VIEW:774768970,WHATSAPP_PRODUCT_APPEAL:774769273,WHATSAPP_CATALOG_CREATE:774769395,WHATSAPP_CATALOG_LOAD_MORE:774769641,WHATSAPP_ORDER_VIEW:774769843,WHATSAPP_PROFILE_VIEW:774770248,WHATSAPP_CATALOG_VIEW:774771408,WHATSAPP_PRODUCT_DELETE:774774122,WHATSAPP_CART_VIEW:774774619,WHATSAPP_CART_ADD:774774794,WHATSAPP_PROFILE_SAVE:774775117,WHATSAPP_PRODUCT_VIEW:774775607,WHATSAPP_COLLECTION_APPEAL:774776895,WHATSAPP_PLM_DETAILS_VIEW:774777097,WHATSAPP_COLLECTION_EDIT:774777483,WHATSAPP_ORDER_CREATE:774777518,WHATSAPP_PROFILE_CATS_VIEW:774777556,WHATSAPP_PRODUCT_SET_VISIBLE:774778628,WHATSAPP_PRODUCT_IMAGES_LOAD:774778674,WHATSAPP_PRODUCT_SAVE:774779113,WHATSAPP_PRODUCT_MESSAGE_SEND:774779800,WHATSAPP_COLLECTION_VIEW_ALL:774780089,WHATSAPP_CATALOG_COLLECTIONS_VIEW:774781666,WHATSAPP_PRODUCT_REPORT:774782053,WHATSAPP_COLLECTION_RENAME:774782934,WHATSAPP_WEB_TEST_EVENT:891422769,CHAT_OPEN:891425633,MESSAGE_RENDER:891426174,SYNCD:891431212,OFFLINE_RESUME:891431279});t.QuickLogMarkerId=r},669393:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QPL=t.ALLOWLIST_DEV_VERBOSE_LOGGING=void 0;var r=n(500628),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(382828)),a=n(665397),o=n(226107);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}const l=i,c=[a.QuickLogMarkerId.WHATSAPP_WEB_TEST_EVENT,a.QuickLogMarkerId.SYNCD,a.QuickLogMarkerId.OFFLINE_RESUME],u=new Map([[a.QuickLogMarkerId.SYNCD,100]]),d=[a.QuickLogMarkerId.WHATSAPP_WEB_TEST_EVENT];t.ALLOWLIST_DEV_VERBOSE_LOGGING=d;const p={cast:e=>a.QuickLogMarkerId.cast(e),getName:e=>a.QuickLogMarkerId.getName(e)};r.QPL.setAllowListDevVerboseLogging(d.map((e=>e))),r.QPL.setStartupAllowListEventFilter(c),r.QPL.setQplReducePrecisionMapMs(u),r.QPL.setStorageApi(new o.QplStorageApi),r.QPL.setHealthLogger(l),r.QPL.setEnumConversion(p),r.QPL.setIsDev((()=>!1));const f={init(e,t,n){r.QPL.init(e,t,n)},clearInstance(){r.QPL.clearInstance()},getInstance:()=>r.QPL.getInstance(),getNextMarkerInstanceValue:e=>r.QPL.getNextMarkerInstanceValue(e),throwKillswitch(e){r.QPL.throwKillswitch(e)},clearStorage(){r.QPL.clearStorage()},logActiveQplMarkers(){r.QPL.logActiveQplMarkers()},markerStart:(e,t)=>r.QPL.markerStart(e,t),markerAnnotate(e,t,n){r.QPL.markerAnnotate(e,t,n)},markerPoint(e,t,n){r.QPL.markerPoint(e,t,n)},markerEnd(e,t,n){r.QPL.markerEnd(e,t,n)},markerDrop(e,t){r.QPL.markerDrop(e,t)},getActiveMarkerIDs:e=>r.QPL.getActiveMarkerIDs(e),getMarker(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r.QPL.getMarker(e,t)},getMarkerInstances:e=>r.QPL.getMarkerInstances(e)};t.QPL=f},226107:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QplStorageApi=void 0;var r=n(663719);t.QplStorageApi=class{add(e,t){return(0,r.add)(e,t)}getFromBottom(e){return(0,r.getFromBottom)(e)}getRowCount(){return(0,r.rowCount)()}clear(){return(0,r.clear)()}deleteRange(e,t){return(0,r.deleteRange)(e,t)}}},296400:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplConfigs=void 0;const n={accessToken:"1063127757113399|745146ffa34413f9dbb5469f5370b7af",appId:"167028690535322",endpoint:"https://graph.whatsapp.net/wa_qpl_data"};t.qplConfigs=n},669545:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCartView=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_CART_VIEW,e)},t.qplPointOrderCreate=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_ORDER_CREATE,e)},t.qplPointOrderView=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_ORDER_VIEW,e)},t.qplPointPLMDetailsView=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_PLM_DETAILS_VIEW,e)},t.qplPointProductView=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_PRODUCT_VIEW,e)},t.qplPointProfileCatsView=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_PROFILE_CATS_VIEW,e)},t.qplPointProfileSave=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_PROFILE_SAVE,e)};var r=n(665397),i=n(669393)},595104:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WAWebCollectionVersionStore=void 0;var r=n(776214);class i{get(e){return(0,r.getCollectionVersionTable)().get(e)}bulkGet(e){return(0,r.getCollectionVersionTable)().bulkGet(e)}getAll(){return(0,r.getCollectionVersionTable)().all()}updateVersionAndLtHash(e,t,n){return(0,r.getCollectionVersionTable)().createOrMerge(e,{collection:e,version:t,ltHash:n})}bulkUpdate(e){return(0,r.getCollectionVersionTable)().bulkCreateOrMerge(e)}}t.WAWebCollectionVersionStore=i,i.locks=["collection-version"]},616982:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WAWebMissingKeyStore=void 0;var i=r(n(273407));class a{getAll(){return i.default.getAllMissingKeys()}count(){return i.default.getMissingKeyCount()}}t.WAWebMissingKeyStore=a,a.locks=["missing-keys"]},777005:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WAWebPendingMutationStore=void 0;var i=r(n(348926)),a=r(n(273407)),o=n(787125);class s{getByCollection(e){return(0,i.default)((function*(){return(yield a.default.getPendingMutationsRows(["collection"],e)).map(o.convertToPendingMutationFromRow)}))()}getAll(){return a.default.getAllPendingMutationsRows()}bulkRemove(e){return a.default.bulkRemovePendingMutations(e)}}t.WAWebPendingMutationStore=s,s.locks=["pending-mutations"]},570491:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WAWebSyncActionStore=void 0;var i=r(n(348926)),a=r(n(273407)),o=n(776214),s=n(134296);class l{count(){return(0,o.getSyncActionsTable)().count()}get(e){return(0,i.default)((function*(){const t=yield a.default.getSyncAction(e);return null==t?null:(0,s.convertToSyncActionFromRow)(t)}))()}getByCollections(e){return(0,i.default)((function*(){return(yield a.default.getSyncActionsRows(["collection"],e.map((e=>e)))).map(s.convertToSyncActionFromRow)}))()}getByIndexMacs(e){return(0,i.default)((function*(){return(yield a.default.getSyncActionsRows(["indexMac"],e.map((e=>e)))).map(s.convertToSyncActionFromRow)}))()}getByActionStates(e){return(0,i.default)((function*(){return(yield a.default.getSyncActionsRows(["actionState"],e.map((e=>e)))).map(s.convertToSyncActionFromRow)}))()}getByModelInfos(e){return(0,i.default)((function*(){return(yield a.default.getSyncActionsRows(["modelId","modelType","actionState"],e.map((e=>e)))).map(s.convertToSyncActionFromRow)}))()}getAll(){return(0,o.getSyncActionsTable)().all()}bulkSet(e){return a.default.setSyncActionRows(e)}bulkUpdate(e){return a.default.updateSyncActionRows(e)}bulkRemove(e){return a.default.deleteSyncActionRows(e)}}t.WAWebSyncActionStore=l,l.locks=["sync-actions"]},144945:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WAWebSyncKeyStore=void 0;var i=r(n(348926)),a=r(n(273407)),o=n(63776);class s{getAll(){return(0,i.default)((function*(){return(yield a.default.getAllSyncKeys()).map(o.convertToSyncKeyFromRow)}))()}}t.WAWebSyncKeyStore=s,s.locks=["sync-keys"]},795720:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_ACTIONS=t.DELETE_REASON=void 0;const n=Object.freeze({SUBJECT:"subject",ADD:"add",PROMOTE:"promote",DEMOTE:"demote",DELETE:"delete",REMOVE:"remove",MODIFY:"modify",INVITE_CODE:"invite",DESC_ADD:"desc_add",DESC_REMOVE:"desc_remove",RESTRICT:"restrict",ANNOUNCE:"announce",NO_FORWARD:"no_frequently_forwarded",EPHEMERAL:"ephemeral",REVOKE_INVITE:"revoke_invite",SUSPEND:"suspend",GROWTH_LOCKED:"growth_locked",GROWTH_UNLOCKED:"growth_unlocked",SUB_GROUP_LINK:"sub_group_link",PARENT_GROUP_LINK:"parent_group_link",SIBLING_GROUP_LINK:"sibling_group_link",SUB_GROUP_UNLINK:"sub_group_unlink",PARENT_GROUP_UNLINK:"parent_group_unlink",SIBLING_GROUP_UNLINK:"sibling_group_unlink",INTEGRITY_PARENT_GROUP_UNLINK:"integrity_parent_group_unlink",LINKED_GROUP_PROMOTE:"linked_group_promote",LINKED_GROUP_DEMOTE:"linked_group_demote",MEMBERSHIP_APPROVAL_MODE:"membership_approval_mode",MEMBERSHIP_APPROVAL_REQUEST:"membership_approval_request"});t.GROUP_ACTIONS=n;const r=Object.freeze({INTEGRITY_DELETE_PARENT:"integrity_delete_parent"});t.DELETE_REASON=r},681398:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LeaveReason=void 0;const r=n(76672).Mirrored(["Left","Removed"]);t.LeaveReason=r},646239:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.userPreferencesStoreBase=t.UserPreferencesStoreBase=void 0;var i=r(n(745234)),a=r(n(724609)),o=n(546718),s=r(n(978144));const l=[o.KEYS.MD_OPTED_IN,o.KEYS.WHATSAPP_MUTEX,o.KEYS.LOGOUT_TOKEN,o.KEYS.OLD_LOGOUT_CREDS,o.KEYS.REMEMBER_ME,o.KEYS.PRESERVED_USER_KEYS,o.MD_KEYS.ROUTING_INFO,o.MD_KEYS.INITIAL_HISTORY_SYNCED,o.MD_KEYS.WEB_ENC_SALT,o.MD_KEYS.CRITICAL_DATA_SYNCED],c=!1,u=!1,d=!0;class p{getStorage(){return this.getRememberMe()?i.default:a.default}_determineStorage(e){return l.includes(e)?i.default:this.getStorage()}get(e,t){var n;if(null==e)throw new Error("UserPreferencesStoreBase.get called with no key");const r=null!==(n=null==t?void 0:t.storage)&&void 0!==n?n:this._determineStorage(e),i=null==(null==t?void 0:t.ignoreCache)?u:t.ignoreCache,a=r.getItem(e,i);if((null==(null==t?void 0:t.isRawString)?c:t.isRawString)||null==a)return a;try{return JSON.parse(a,s.default)}catch(t){return __LOG__(2,void 0,void 0,!0)`UserPreferencesStoreBase.get(${e}) '${t}' ${a}`,SEND_LOGS("userprefs-parse-error"),void r.removeItem(e)}}set(e,t,n){var r;if(null==e)throw new Error("UserPreferencesStoreBase.set called with no key");const i=null!==(r=null==n?void 0:n.storage)&&void 0!==r?r:this._determineStorage(e);if(null==t)i.removeItem(e);else{if(null==(null==n?void 0:n.isRawString)?c:n.isRawString){if("string"!=typeof t)throw new Error("UserPreferencesStoreBase.set: expecting string because isRawString is true");i.setItem(e,t)}else{const r=null==(null==n?void 0:n.shouldWriteToIdb)?d:n.shouldWriteToIdb;i.setItem(e,JSON.stringify(t),r)}}}getRememberMe(){let e=this.get(o.KEYS.REMEMBER_ME,{storage:i.default});const{isMDBackend:t}=n(88555);return t()&&!1===e&&(e=!0,this.set(o.KEYS.REMEMBER_ME,!0,{storage:i.default})),null===e&&(e=!0,this.set(o.KEYS.REMEMBER_ME,!0,{storage:i.default})),!!e}}t.UserPreferencesStoreBase=p;const f=new p;t.userPreferencesStoreBase=f},280863:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._getPreservedKeys=p,t.clearAllLocalState=function(){return _.apply(this,arguments)},t.clearAllTemporaryStorageData=function(){s.default.clear(f())};var i=r(n(348926)),a=n(739948),o=r(n(745234)),s=r(n(724609)),l=n(552922),c=n(546718),u=n(491442),d=n(163200);function p(){var e;const t=null!==(e=u.userPreferencesStore.get(c.KEYS.PRESERVED_USER_KEYS,{storage:o.default}))&&void 0!==e?e:[],n=[...d.LS_PRESERVE_KEYS,...t];return u.userPreferencesStore.getKeys(o.default,n,!0)}function f(){return u.userPreferencesStore.getKeys(s.default,d.TS_PRESERVE_KEYS,!0)}function _(){return(_=(0,i.default)((function*(){const e=p(),t=[s.default.clear(f()),o.default.clear(e)];t.push(a.Logger.clearLogs()),(0,l.clearCookies)(),yield Promise.all(t)}))).apply(this,arguments)}},552922:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clearCookies=function(){if((0,a.isWorker)())return;i.setCookie({name:"ref",expirationDate:0,domain:r.COOKIE_DOMAIN,path:o.PP_REF}),i.setCookie({name:"tok",expirationDate:0,domain:r.COOKIE_DOMAIN,path:o.PP_TOK})},t.setRefTokCookies=function(e,t){if((0,a.isWorker)())return;i.setCookie({name:"ref",value:e,path:o.PP_REF,domain:r.COOKIE_DOMAIN,secure:!0}),i.setCookie({name:"tok",value:t,path:o.PP_TOK,domain:r.COOKIE_DOMAIN,secure:!0})};var r=n(957932),i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(564418)),a=n(333126),o=n(241601);function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}},555452:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.THIS_TAB=void 0,t.clearDeprecatedKeys=T,t.clearTokens=function(){y.forEach((e=>{h.userPreferencesStore.set(e,void 0)}))},t.currentTabHasMutex=function(){return(A()||"").includes(E)},t.deleteComposeContents=function(e){h.userPreferencesStore.clearUserSessionItem(O(e))},t.getAutoDownloadAudio=function(){var e;return null===(e=h.userPreferencesStore.getUser(_.KEYS.AUTO_DOWNLOAD_AUDIO))||void 0===e||e},t.getAutoDownloadDocuments=function(){var e;return null!==(e=h.userPreferencesStore.getUser(_.KEYS.AUTO_DOWNLOAD_DOCUMENTS))&&void 0!==e&&e},t.getAutoDownloadPhotos=function(){var e;return null===(e=h.userPreferencesStore.getUser(_.KEYS.AUTO_DOWNLOAD_PHOTOS))||void 0===e||e},t.getAutoDownloadVideos=function(){var e;return null!==(e=h.userPreferencesStore.getUser(_.KEYS.AUTO_DOWNLOAD_VIDEOS))&&void 0!==e&&e},t.getBrowserId=function(){return h.userPreferencesStore.get(_.KEYS.BROWSER_ID)},t.getCollapseMuted=function(){return h.userPreferencesStore.getUser(_.KEYS.GLOBAL_COLLAPSE_MUTED)},t.getComposeContents=function(e){return h.userPreferencesStore.getUserSession(O(e))},t.getContactChecksum=function(){return h.userPreferencesStore.getUser(_.KEYS.CONTACT_CHECKSUM)},t.getDailyStatsStartTime=R,t.getForcedMdUpgradeComplete=function(){return!!h.userPreferencesStore.getTS(_.KEYS.FORCED_MD_UPGRADE_COMPLETE)},t.getGeocoderLocation=function(){return h.userPreferencesStore.getUser(_.KEYS.GEOCODER_LOCATION)},t.getGlobalCallRingtone=function(){return!h.userPreferencesStore.getUser(_.KEYS.GLOBAL_MUTE_CALL_RINGTONE)},t.getGlobalNotifications=function(){const e=h.userPreferencesStore.getUser(_.KEYS.GLOBAL_MUTE_NOTIFICATIONS);var t;return null==e?(null===(t=window.Notification)||void 0===t?void 0:t.permission)===d.PERMISSION_ALLOWED:!e},t.getGlobalOfflineNotifications=function(){var e;return null!==(e=h.userPreferencesStore.getUser(_.KEYS.GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED))&&void 0!==e&&e},t.getGlobalPreviews=function(){return!h.userPreferencesStore.getUser(_.KEYS.GLOBAL_MUTE_PREVIEWS)},t.getGlobalSecurityNotifications=function(){var e;return null===(e=!h.userPreferencesStore.getUser(_.KEYS.SECURITY_NOTIFICATIONS))||void 0===e||e},t.getGlobalSounds=function(){return!h.userPreferencesStore.getUser(_.KEYS.GLOBAL_MUTE_SOUNDS)},t.getGroupParticipantAssignedColor=function(e){return h.userPreferencesStore.getUser(_.KEYS.GROUP_ASSIGNED_COLOR+"-"+e.toString())},t.getHistorySyncEarliestDate=function(){const e=h.userPreferencesStore.get(_.KEYS.HISTORY_SYNC_EARLIEST_DATE);if(!e)return M((0,c.unixTime)());return e},t.getHour24=function(){var e;return null!==(e=h.userPreferencesStore.get(_.KEYS.HOUR_24))&&void 0!==e?e:null},t.getIgnoreNondirectGroupMsg=function(){return h.userPreferencesStore.getUser(_.KEYS.IGNORE_NONDIRECT_GROUP_MSG)},t.getLastChatMuteDuration=function(){return h.userPreferencesStore.getUser(_.KEYS.LAST_CHAT_MUTE_DURATION)},t.getLastComposeBoxPanel=function(){return h.userPreferencesStore.getUser(_.KEYS.LAST_SELECTED_COMPOSE_BOX_PANEL)},t.getLastMobilePlatform=function(){return h.userPreferencesStore.get(_.KEYS.MOBILE_PLATFORM)},t.getLastStatusUsage=function(){return h.userPreferencesStore.getUser(_.KEYS.LAST_STATUS_USAGE)},t.getLoginTokens=v,t.getLogoutToken=function(){return h.userPreferencesStore.get(_.KEYS.LOGOUT_TOKEN,{storage:p.default})},t.getMapsOverQuota=function(){return h.userPreferencesStore.get(_.KEYS.GMAPS_OVER_LIMIT)},t.getMutex=A,t.getNoTakeover=function(){return!!h.userPreferencesStore.getTS(_.KEYS.NO_TAKEOVER)},t.getNoticeBannerClosedAt=function(){return h.userPreferencesStore.getUser(_.KEYS.NOTICE_BANNER_CLOSED_AT)},t.getNoticeId=function(){return h.userPreferencesStore.getUser(_.KEYS.NOTICE_ID)},t.getOfflineNotificationsBBStatus=function(){var e;return null!==(e=h.userPreferencesStore.getUser(_.KEYS.OFFLINE_NOTIFICATIONS_BB_STATUS))&&void 0!==e?e:{isDismissed:!1,firstSeenTime:null,isLongResumeTime:!1}},t.getOldLogoutCreds=function(){return h.userPreferencesStore.get(_.KEYS.OLD_LOGOUT_CREDS,{storage:p.default})||[]},t.getOutgoingMessageSound=function(){return h.userPreferencesStore.getUser(_.KEYS.OUTGOING_MESSAGE_SOUND)},t.getPersistentExpiringId=function(){return h.userPreferencesStore.getUser(_.KEYS.PERSISTENT_EXPIRING_ID)},t.getPostcodeAutoOpenChangePostcodeCount=function(){return h.userPreferencesStore.getUser(_.KEYS.POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_COUNT)},t.getPostcodeAutoOpenChangePostcodeDone=function(){return!!h.userPreferencesStore.getUser(_.KEYS.POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_DONE)},t.getPostcodeTooltipViewCount=function(){return h.userPreferencesStore.getUser(_.KEYS.POSTCODE_TOOLTIP_VIEW_COUNT)},t.getPostcodeTooltipViewedInSession=function(){return!!h.userPreferencesStore.getUser(_.KEYS.POSTCODE_TOOLTIP_VIEWED_IN_SESSION)},t.getPrimaryFeatures=function(){var e;return null!==(e=h.userPreferencesStore.get(_.KEYS.PRIMARY_FEATURES))&&void 0!==e?e:[]},t.getPsKillSwitchToken=function(){return h.userPreferencesStore.get(_.KEYS.PS_KILLSWITCH_TOKEN)},t.getPttPlaybackRate=function(){var e;return null!==(e=h.userPreferencesStore.get(_.KEYS.PTT_PLAYBACK_RATE))&&void 0!==e?e:1},t.getPushname=function(){return h.userPreferencesStore.getUser(_.KEYS.LAST_PUSHNAME)},t.getSeenGroupDesc=function(e){return h.userPreferencesStore.getUser(e.toString())},t.getShouldPreemptivelyCleanupLogs=function(){return!1!==h.userPreferencesStore.get(_.KEYS.LOG_PREEMPT_CLEAN_UP)},t.getShowMdUpgradeCompleteMsg=function(){return!!h.userPreferencesStore.getTS(_.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG)},t.getSmbLabelPalette=function(){return h.userPreferencesStore.getUser(_.KEYS.SMB_LABEL_COLOR_PALETTE)},t.getStorageAlert=function(){return m.STORAGE_ALERT_TYPE.NO_ALERT},t.getStorageDismissState=function(){return{lowQuotaDismissed:!0,highQuotaDismissed:!0}},t.getSystemThemeMode=function(){var e;return null===(e=h.userPreferencesStore.get(_.KEYS.SYSTEM_THEME_MODE))||void 0===e||e},t.getTheme=function(){return h.userPreferencesStore.get(_.KEYS.THEME)},t.getUnknownId=function(){let e=h.userPreferencesStore.get(_.KEYS.UNKNOWN_ID);e||(e="unknown"+Math.floor(1e10*Math.random()),C(e));return e},t.getUnreadMentionCountEnabled=function(){return h.userPreferencesStore.get(_.KEYS.UNREAD_MENTION_COUNT_ENABLED)},t.getUserPrivacySettings=function(){var e;return null!==(e=h.userPreferencesStore.getUser(_.KEYS.USER_PRIVACY_SETTINGS))&&void 0!==e?e:{}},t.getVersion=function(){return h.userPreferencesStore.get(_.KEYS.PROTO_VERSION)},t.getVideoVolumeSettings=function(){return{volume:h.userPreferencesStore.get(_.KEYS.VIDEO_VOLUME),muted:!!h.userPreferencesStore.get(_.KEYS.VIDEO_MUTE)}},t.getWebNotificationsBBStatus=N,t.initDailyStatsStartTime=function(){R()},t.knowsPhone=function(){const e=v();return!(!e.client||!e.server)},t.localTakeoverSuccess=function(){const e=h.userPreferencesStore.getRememberMe()?{}:(0,o.default)(h.userPreferencesStore.getAllKeyValues(),g.LS_ONLY_KEYS);e.wa_tab_src=E,(0,l.default)(u.default,"localStorage").setItem(_.KEYS.LOCAL_TAKEOVER_OK,JSON.stringify(e)),(0,l.default)(u.default,"localStorage").removeItem(_.KEYS.LOCAL_TAKEOVER_OK)},t.markUserSentMessageToChat=function(e){const t=I(e);let n=h.userPreferencesStore.getUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(n))return __LOG__(3)`UserPrefs:markUserSentMessageToChat value in store is not an array`,h.userPreferencesStore.setUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO,[t]),!1;n=w(n);const r=!n.includes(t);r&&(n.push(t),h.userPreferencesStore.setUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO,n));return __LOG__(2)`UserPrefs:markUserSentMessageToChat`,r},t.mdOptedIn=function(){return!!h.userPreferencesStore.get(_.KEYS.MD_OPTED_IN,{storage:p.default})},t.mutexFilter=function(e){if(e.key!==_.KEYS.WHATSAPP_MUTEX)return!1;if(!(e.newValue||"").includes(E))return!0;return!1},t.parseMutex=function(e){const t=e?JSON.parse(e):"";return t?t.toString().split(/:/).pop():t},t.parseTakeover=function(e){const t=e?JSON.parse(e):{};if((0,a.default)(t))return delete t.wa_tab_src,t;return{}},t.removeMutex=function(){h.userPreferencesStore.set(_.KEYS.WHATSAPP_MUTEX,null,{storage:p.default})},t.removeUserSentMessageToChat=function(e){let t=h.userPreferencesStore.getUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO)||[];if(!Array.isArray(t))return __LOG__(3)`UserPrefs:removeUserSentMessageToChat value in store is not an array`,void h.userPreferencesStore.setUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO,[]);t=w(t);const n=I(e);t.includes(n)&&h.userPreferencesStore.setUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO,(0,i.default)(t,n));__LOG__(2)`UserPrefs:removeUserSentMessageToChat`},t.setAutoDownloadAudio=function(e){h.userPreferencesStore.setUser(_.KEYS.AUTO_DOWNLOAD_AUDIO,e)},t.setAutoDownloadDocuments=function(e){h.userPreferencesStore.setUser(_.KEYS.AUTO_DOWNLOAD_DOCUMENTS,e)},t.setAutoDownloadPhotos=function(e){h.userPreferencesStore.setUser(_.KEYS.AUTO_DOWNLOAD_PHOTOS,e)},t.setAutoDownloadVideos=function(e){h.userPreferencesStore.setUser(_.KEYS.AUTO_DOWNLOAD_VIDEOS,e)},t.setBrowserId=function(e){h.userPreferencesStore.set(_.KEYS.BROWSER_ID,e)},t.setCollapseMuted=function(e){h.userPreferencesStore.setUser(_.KEYS.GLOBAL_COLLAPSE_MUTED,e)},t.setComposeContents=function(e,t){h.userPreferencesStore.setUserSession(O(e),t)},t.setContactChecksum=function(e){h.userPreferencesStore.setUser(_.KEYS.CONTACT_CHECKSUM,e)},t.setForcedMdUpgradeComplete=function(e){h.userPreferencesStore.setTS(_.KEYS.FORCED_MD_UPGRADE_COMPLETE,e)},t.setGeocoderLocation=function(e){h.userPreferencesStore.setUser(_.KEYS.GEOCODER_LOCATION,e)},t.setGlobalCallRingtone=function(e){h.userPreferencesStore.setUser(_.KEYS.GLOBAL_MUTE_CALL_RINGTONE,!e)},t.setGlobalNotifications=function(e){h.userPreferencesStore.setUser(_.KEYS.GLOBAL_MUTE_NOTIFICATIONS,!e)},t.setGlobalOfflineNotifications=function(){},t.setGlobalPreviews=function(e){h.userPreferencesStore.setUser(_.KEYS.GLOBAL_MUTE_PREVIEWS,!e)},t.setGlobalSecurityNotifications=function(e){h.userPreferencesStore.setUser(_.KEYS.SECURITY_NOTIFICATIONS,!e)},t.setGlobalSounds=function(e){h.userPreferencesStore.setUser(_.KEYS.GLOBAL_MUTE_SOUNDS,!e)},t.setGroupParticipantAssignedColor=function(e,t){h.userPreferencesStore.setUser(_.KEYS.GROUP_ASSIGNED_COLOR+"-"+e.toString(),t)},t.setHistorySyncEarliestDate=M,t.setHour24=function(e){h.userPreferencesStore.set(_.KEYS.HOUR_24,e)},t.setIgnoreNondirectGroupMsg=function(e){h.userPreferencesStore.setUser(_.KEYS.IGNORE_NONDIRECT_GROUP_MSG,e)},t.setLastChatMuteDuration=function(e){h.userPreferencesStore.setUser(_.KEYS.LAST_CHAT_MUTE_DURATION,e)},t.setLastComposeBoxPanel=function(e){h.userPreferencesStore.setUser(_.KEYS.LAST_SELECTED_COMPOSE_BOX_PANEL,e)},t.setLastMobilePlatform=function(e){h.userPreferencesStore.set(_.KEYS.MOBILE_PLATFORM,e)},t.setLastStatusUsage=function(){h.userPreferencesStore.setUser(_.KEYS.LAST_STATUS_USAGE,Date.now())},t.setLoginTokens=function(e){const t=e.client,n=e.server;t&&n&&!(0,s.default)(t)&&(__LOG__(2)`UserPrefs:setLoginTokens`,h.userPreferencesStore.set(_.KEYS.CLIENT_TOKEN,t),h.userPreferencesStore.set(_.KEYS.SERVER_TOKEN,n))},t.setLogoutToken=function(e){h.userPreferencesStore.set(_.KEYS.LOGOUT_TOKEN,e,{storage:p.default})},t.setMapsOverQuota=function(e){h.userPreferencesStore.set(_.KEYS.GMAPS_OVER_LIMIT,e)},t.setMdOptedIn=function(e){h.userPreferencesStore.set(_.KEYS.MD_OPTED_IN,e,{storage:p.default})},t.setMutex=function(e){const t=e?E+":"+e:e;h.userPreferencesStore.set(_.KEYS.WHATSAPP_MUTEX,t,{storage:p.default})},t.setNoTakeover=function(e){h.userPreferencesStore.setTS(_.KEYS.NO_TAKEOVER,e)},t.setNoticeBannerClosedAt=function(e){h.userPreferencesStore.setUser(_.KEYS.NOTICE_BANNER_CLOSED_AT,e)},t.setNoticeId=function(e){h.userPreferencesStore.setUser(_.KEYS.NOTICE_ID,e)},t.setOfflineNotificationsBBStatus=function(){},t.setOldLogoutCreds=function(e){h.userPreferencesStore.set(_.KEYS.OLD_LOGOUT_CREDS,e,{storage:p.default})},t.setOutgoingMessageSound=function(e){h.userPreferencesStore.setUser(_.KEYS.OUTGOING_MESSAGE_SOUND,e)},t.setPersistentExpiringId=function(e){h.userPreferencesStore.setUser(_.KEYS.PERSISTENT_EXPIRING_ID,e)},t.setPostcodeAutoOpenChangePostcodeCount=function(e){h.userPreferencesStore.setUser(_.KEYS.POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_COUNT,e)},t.setPostcodeAutoOpenChangePostcodeDone=function(e){h.userPreferencesStore.setUser(_.KEYS.POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_DONE,e)},t.setPostcodeTooltipViewCount=function(e){h.userPreferencesStore.setUser(_.KEYS.POSTCODE_TOOLTIP_VIEW_COUNT,e)},t.setPostcodeTooltipViewedInSession=function(e){h.userPreferencesStore.setUser(_.KEYS.POSTCODE_TOOLTIP_VIEWED_IN_SESSION,e)},t.setPrimaryFeatures=function(e){h.userPreferencesStore.set(_.KEYS.PRIMARY_FEATURES,e)},t.setPsKillSwitchToken=function(e){h.userPreferencesStore.set(_.KEYS.PS_KILLSWITCH_TOKEN,e)},t.setPttPlaybackRate=function(e){h.userPreferencesStore.set(_.KEYS.PTT_PLAYBACK_RATE,e)},t.setPushname=function(e){h.userPreferencesStore.setUser(_.KEYS.LAST_PUSHNAME,e)},t.setRefTok=function(e,t){T(),(0,f.setRefTokCookies)(e,t)},t.setSeenGroupDesc=function(e){h.userPreferencesStore.setUser(e.toString(),!0)},t.setShouldPreemptivelyCleanupLogs=function(e){h.userPreferencesStore.set(_.KEYS.LOG_PREEMPT_CLEAN_UP,e)},t.setShowMdUpgradeCompleteMsg=function(e){h.userPreferencesStore.setTS(_.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,e)},t.setSmbLabelPalette=function(e){h.userPreferencesStore.set(_.KEYS.SMB_LABEL_COLOR_PALETTE,e)},t.setStorageAlert=function(){},t.setStorageDismissState=function(){},t.setSystemThemeMode=function(e){h.userPreferencesStore.set(_.KEYS.SYSTEM_THEME_MODE,e)},t.setTheme=function(e){h.userPreferencesStore.set(_.KEYS.THEME,e)},t.setUnknownId=C,t.setUnreadMentionCountEnabled=function(e){h.userPreferencesStore.set(_.KEYS.UNREAD_MENTION_COUNT_ENABLED,e)},t.setUserPrivacySettings=function(e){h.userPreferencesStore.setUser(_.KEYS.USER_PRIVACY_SETTINGS,e)},t.setVersion=function(e){null!=e&&h.userPreferencesStore.set(_.KEYS.PROTO_VERSION,e)},t.setVideoMutedSetting=P,t.setVideoVolumeSetting=b,t.setVideoVolumeSettings=function(e,t){b(e),P(t)},t.setWebNotificationsBBStatus=function(e){var t,n;const r=N(),{isDismissed:i,firstSeenTime:a=null}=r,o=null!==(t=e.isDismissed)&&void 0!==t?t:i,s=null!==(n=e.firstSeenTime)&&void 0!==n?n:a;h.userPreferencesStore.setUser(_.KEYS.WEB_NOTIFICATIONS_BB_STATUS,{isDismissed:o,firstSeenTime:s})},t.takeoverFilter=function(e){if(e.key!==_.KEYS.LOCAL_TAKEOVER_OK)return!1;if(!(e.newValue||"").includes(E))return!0;return!1};var i=r(n(82569)),a=r(n(513218)),o=r(n(957557)),s=r(n(352353)),l=r(n(145095)),c=n(892844),u=r(n(904285)),d=n(410945),p=r(n(745234)),f=n(552922),_=n(546718),h=n(491442),g=n(163200),m=n(960764);const y=[_.KEYS.LOGOUT_TOKEN,_.KEYS.CLIENT_TOKEN,_.KEYS.SERVER_TOKEN,_.KEYS.SECRET_BUNDLE],S=[_.KEYS.VERSION],E="x"+Math.round(1e9*Math.random());function v(){return{client:h.userPreferencesStore.get(_.KEYS.CLIENT_TOKEN),server:h.userPreferencesStore.get(_.KEYS.SERVER_TOKEN)}}function T(){S.forEach((function(e){p.default.removeItem(e)}))}function C(e){return h.userPreferencesStore.set(_.KEYS.UNKNOWN_ID,e)}function A(){return h.userPreferencesStore.getPSIgnoringCache(_.KEYS.WHATSAPP_MUTEX)}function b(e){h.userPreferencesStore.set(_.KEYS.VIDEO_VOLUME,e)}function P(e){h.userPreferencesStore.set(_.KEYS.VIDEO_MUTE,e)}function O(e){return`${_.KEYS.COMPOSE_CONTENTS_PREFIX}${e.toString()}`}function M(e){const t=90*c.DAY_SECONDS,n=(c.YEAR_SECONDS,e-t);return h.userPreferencesStore.set(_.KEYS.HISTORY_SYNC_EARLIEST_DATE,n),n}function I(e){return(e.toString()||"").replace("@","_")}function w(e){if(e.some((e=>e.endsWith("_")))){const t=e.map((e=>e.replace(/_$/,"").replace("@","_")));return h.userPreferencesStore.setUser(_.KEYS.CHATS_USER_SENT_MESSAGE_TO,t),t}return e}function R(){const e=h.userPreferencesStore.get(_.KEYS.DAILY_STATS_START_TIME);if("number"==typeof e)return e;const t=Date.now();return h.userPreferencesStore.set(_.KEYS.DAILY_STATS_START_TIME,t),t}function N(){var e;return null!==(e=h.userPreferencesStore.getUser(_.KEYS.WEB_NOTIFICATIONS_BB_STATUS))&&void 0!==e?e:{isDismissed:!1,firstSeenTime:null}}t.THIS_TAB=E},134898:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.waNoiseInfo=t.deviceInfo=void 0;var i=r(n(348926)),a=n(615688),o=n(108584),s=(n(781572),n(138062)),l=n(624256),c=n(788950),u=n(711597),d=(n(662583),r(n(914296))),p=n(23551),f=n(765044);const _=new class{get(){return{osVersion:"0.1",osBuild:"0.1",hardware:"desktop",manufacturer:"",device:"Desktop",lg:d.default.getLanguage(),lc:d.default.getRegion()||"",mcc:"000",mnc:"000",sim_mnc:"000",sim_mcc:"000"}}};t.deviceInfo=_;const h="AES-GCM",g="PBKDF2";const m=new class{constructor(){this.cachedPasscodeDerivedKey=null}get(){var e=this;return(0,i.default)((function*(){let t=(0,u.getNoiseInfo)();if(!t)return null;const n=yield e._getIv();return n?(t=yield e._decryptAllNoiseData(t,n),e._isStaticKeyPairValid(t)?t:(__LOG__(2,void 0,void 0,void 0,["info_store"])`Decrypted noise key was invalid.`,null)):null}))()}set(e){var t=this;return(0,i.default)((function*(){const n=new Uint8Array(48);self.crypto.getRandomValues(n);const r=t._processIv(n);return yield t._setIv(r),e.recoveryToken=yield t._encryptNoiseData(e.recoveryToken,r[0]),e.staticKeyPair.pubKey=yield t._encryptNoiseData(e.staticKeyPair.pubKey,r[1]),e.staticKeyPair.privKey=yield t._encryptNoiseData(e.staticKeyPair.privKey,r[2]),(0,u.setNoiseInfo)(e)}))()}_setIv(e){return(0,u.setNoiseInfoIv)(e.map(a.encodeB64))}_getIv(){const e=(0,u.getNoiseInfoIv)();return e?e.map((e=>new Uint8Array((0,a.decodeB64)(e)))):null}_processIv(e){const t=new o.Binary(e);return[t.readByteArray(16),t.readByteArray(16),t.readByteArray(16)]}_encryptNoiseData(e,t){return(0,i.default)((function*(){const n=l.DbEncKeyStore.getEncKeys()[0];return yield self.crypto.subtle.encrypt({iv:t,name:"AES-CBC"},n.key,e)}))()}_decryptAllNoiseData(e,t){var n=this;return(0,i.default)((function*(){return e.recoveryToken=yield n._decryptNoiseData(e.recoveryToken,t[0]),e.staticKeyPair.pubKey=yield n._decryptNoiseData(e.staticKeyPair.pubKey,t[1]),e.staticKeyPair.privKey=yield n._decryptNoiseData(e.staticKeyPair.privKey,t[2]),e}))()}_decryptNoiseData(e,t){return(0,i.default)((function*(){const n=l.DbEncKeyStore.getEncKeys()[0];return yield self.crypto.subtle.decrypt({iv:t,name:"AES-CBC"},n.key,e)}))()}_isStaticKeyPairValid(e){let t=!0;try{const n=new Uint8Array((0,s.keyPair)(e.staticKeyPair.privKey).pubKey),r=new Uint8Array(e.staticKeyPair.pubKey);for(let e=0;e<n.length;e++)if(n[e]!==r[e]){t=!1;break}}catch(e){__LOG__(2,void 0,void 0,void 0,["info_store"])`Decrypted noise key failed validation.`,t=!1}return t}lockNoiseInfo(e){var t=this;return(0,i.default)((function*(){const n=yield t.deriveKeyFromPasscode(e);t.createScreenLockIv();const r=yield t.get();if(!r||!r.staticKeyPair)return!1;const{recoveryToken:i,staticKeyPair:{pubKey:a,privKey:o}}=r;try{const e=yield Promise.all([i,a,o].map((e=>t.encryptNoiseWithPasscodeDerivedKey(e,n))));if(e[0]&&e[1]&&e[2])return yield t.set({recoveryToken:e[0],staticKeyPair:{pubKey:e[1],privKey:e[2]}}),!0}catch(e){}return!1}))()}passcodeUnlockNoiseInfo(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){let r;if(null==t.cachedPasscodeDerivedKey){let e;e=n?yield p.LockScreenResolvable.waitForPasscodeAfterIncorrectAttempt():yield p.LockScreenResolvable.waitForPasscode(),r=yield t.deriveKeyFromPasscode(e)}else r=t.cachedPasscodeDerivedKey;const i=yield t.getUnlockedNoiseInfo(e,r);return i&&t._isStaticKeyPairValid(i)?(p.LockScreenResolvable.correctPasscodeEntered(),i):(__LOG__(2,void 0,void 0,void 0,["info_store"])`Decrypted noise key was invalid.`,t.passcodeUnlockNoiseInfo(e,!0))}))()}getUnlockedNoiseInfo(e,t){var n=this;return(0,i.default)((function*(){const{recoveryToken:r,staticKeyPair:{pubKey:i,privKey:a}}=e;try{const e=yield Promise.all([r,i,a].map((e=>n.decryptNoiseWithPasscodeDerivedKey(e,t))));if(e[0]&&e[1]&&e[2])return n.cachedPasscodeDerivedKey=t,{recoveryToken:e[0],staticKeyPair:{pubKey:e[1],privKey:e[2]}}}catch(e){return null}}))()}removeLockOnNoiseInfo(e){var t=this;return(0,i.default)((function*(){let n=(0,u.getNoiseInfo)();if(!n)return!1;const r=yield t._getIv();if(!r)return!1;n=yield t._decryptAllNoiseData(n,r);const i=yield t.deriveKeyFromPasscode(e),a=yield t.getUnlockedNoiseInfo(n,i);return null!=a&&(t._isStaticKeyPairValid(a)?(yield t.set(a),(0,u.setScreenLockSalt)(null),(0,u.setScreenLockIvString)(""),t.cachedPasscodeDerivedKey=null,!0):(__LOG__(2,void 0,void 0,void 0,["info_store"])`Decrypted noise key was invalid.`,!1))}))()}deriveKeyFromPasscode(e){var t=this;return(0,i.default)((function*(){const n=(new TextEncoder).encode(e),r=yield self.crypto.subtle.importKey("raw",n,{name:g},!1,["deriveKey"]),i=yield t.getOrGenScreenLockSalt();return yield self.crypto.subtle.deriveKey({name:g,hash:"SHA-256",salt:i,iterations:3e3},r,{name:h,length:128},!1,["encrypt","decrypt"])}))()}getOrGenScreenLockSalt(){let e=null;return(0,u.getScreenLockEnabled)()||(e=new Uint8Array(128),self.crypto.getRandomValues(e),e=btoa(String.fromCharCode(...Array.from(new Uint8Array(e)))),(0,u.setScreenLockSalt)(e)),e=(0,u.getScreenLockSalt)(),null==e&&f.Socket.logout(!1,c.LogoutReason.MissingScreenLockSalt),e=Uint8Array.from(atob(e),(e=>e.charCodeAt(0))),Promise.resolve(e)}createScreenLockIv(){const e=new Uint8Array(16);self.crypto.getRandomValues(e);const t=new o.Binary(e).readByteArray(16);(0,u.setScreenLockIvString)((0,a.encodeB64)(t))}getScreenLockIvArray(){const e=(0,u.getScreenLockIvString)();return e?new Uint8Array((0,a.decodeB64)(e)):null}encryptNoiseWithPasscodeDerivedKey(e,t){var n=this;return(0,i.default)((function*(){const r=n.getScreenLockIvArray();if(!r)return null;return yield self.crypto.subtle.encrypt({iv:r,name:h},t,e)}))()}decryptNoiseWithPasscodeDerivedKey(e,t){var n=this;return(0,i.default)((function*(){const r=n.getScreenLockIvArray();if(!r)return null;return yield self.crypto.subtle.decrypt({iv:r,name:h},t,e)}))()}};t.waNoiseInfo=m},546718:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MD_KEYS=t.KEYS=t.HASHED_MD_KEYS=t.HASHED_KEYS=void 0;const n=Object.freeze({STORAGE_TEST:"storage_test",CLIENT_TOKEN:"WAToken1",SERVER_TOKEN:"WAToken2",SECRET:"WASecretKey",SECRET_BUNDLE:"WASecretBundle",SECURITY_NOTIFICATIONS:"WASecurityNotifications",BROWSER_ID:"WABrowserId",GEOCODER_LOCATION:"WAGeocoderLocation",GROUP_ASSIGNED_COLOR:"WAGroupAssignedColor-17",GMAPS_OVER_LIMIT:"WAGmapsOverLimit",GLOBAL_MUTE_SOUNDS:"WAGlobalSounds",GLOBAL_MUTE_CALL_RINGTONE:"WAGlobalCallRingtone",OUTGOING_MESSAGE_SOUND:"WAOutgoingMessageSound",GLOBAL_MUTE_NOTIFICATIONS:"WAGlobalNotifications",GLOBAL_MUTE_IN_APP_NOTIFICATIONS:"WAGlobalInAppNotifications",GLOBAL_MUTE_PREVIEWS:"WAGlobalPreviews",GLOBAL_OFFLINE_NOTIFICATIONS_ENABLED:"WAGlobalOfflineNotificationsEnabled",GLOBAL_COLLAPSE_MUTED:"WAGlobalCollapseMuted",NOTIFICATION_SOUND:"WANotificationSound",AUTO_DOWNLOAD_PHOTOS:"WAAutoDownloadPhotos",AUTO_DOWNLOAD_AUDIO:"WAAutoDownloadAudio",AUTO_DOWNLOAD_VIDEOS:"WAAutoDownloadVideos",AUTO_DOWNLOAD_DOCUMENTS:"WAAutoDownloadDocuments",LANG:"WALangPref",HAS_NOISE_INFO:"WAHasNoiseInfo",LAST_ACTIVE_EMOJI_TAB:"WALastActiveEmojiTab",LAST_SELECTED_COMPOSE_BOX_PANEL:"WALastActiveComposeBoxPanel",LAST_CHAT_MUTE_DURATION:"WALastChatMuteDuration",UNKNOWN_ID:"WAUnknownID",VERSION:"WAVersion",LOAD_RETRY_GENERATION:"WALoadRetryGeneration",WHATSAPP_MUTEX:"whatsapp-mutex",LAST_WID:"last-wid",LAST_WID_MD:"last-wid-md",SAVE_TO_CAMERA_ROLL:"save_to_camera_roll",SMB_LABEL_COLOR_PALETTE:"smb_label_color_palette",POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_DONE:"postcode_auto_open_change_postcode_done",POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_COUNT:"postcode_auto_open_change_postcode_count",POSTCODE_TOOLTIP_VIEW_COUNT:"postcode_tooltip_view_count",POSTCODE_TOOLTIP_VIEWED_IN_SESSION:"postcode_tooltip_viewed_in_session",LAST_PUSHNAME:"last-pushname",PROTO_VERSION:"WAProtoVersion",PTT_PLAYBACK_RATE:"WAPttPlaybackRate",LOGOUT_DIRTY_BIT:"post-logout",UNREAD_MENTION_COUNT_ENABLED:"WAUnreadMentionCountEnabled",DAILY_STATS_START_TIME:"WADailyStatsStartTime",PRIMARY_FEATURES:"WAPrimaryFeatures",TOS_STATE_FETCH_ITERATION:"ToSStateFetchIteration",NUX_LIST:"WANuxList",LID:"WALid",LOG_PREEMPT_CLEAN_UP:"WALogPreemptiveCleanUp",PRESERVED_USER_KEYS:"preserved_user_keys",EMOJI_VARIANT_COLLECTION:"emoji_variant_collection",RECENT_EMOJI_COLLECTION:"recent_emoji_collection",RECENT_REACTIONS_COLLECTION:"recent_reactions_collection",CHAT_PREFERENCE_COLLECTION:"chat_preference",LAST_STATUS_USAGE:"last-status-usage",MD_OPTED_IN:"md-opted-in",SHOW_MD_UPGRADE_COMPLETE_MSG:"show-md-upgrade-complete-msg",FORCED_MD_UPGRADE_COMPLETE:"forced-md-upgrade-complete",MOBILE_PLATFORM:"mobile-platform",REMEMBER_ME:"remember-me",LOGOUT_TOKEN:"logout-token",OLD_LOGOUT_CREDS:"old-logout-cred",NO_TAKEOVER:"no-takeover",WHATSAPP_LS_VERSION:"ver",TIME_SPENT_EVENT:"WaTimeSpentEvent",VIDEO_VOLUME:"video-volume",VIDEO_MUTE:"video-mute",CONTACT_CHECKSUM:"contact-checksum",USER_PRIVACY_SETTINGS:"user-privacy-settings",IS_SMB:"is-smb",COMPOSE_CONTENTS_PREFIX:"compose-contents_",THEME:"theme",SYSTEM_THEME_MODE:"system-theme-mode",ABPROPS:"abprops",HISTORY_SYNC_EARLIEST_DATE:"history-sync-earliest-date",CHATS_USER_SENT_MESSAGE_TO:"chats-user-sent-message-to",SYNCD_DISABLED_DUE_TO_FATAL:"syncd_disabled_due_to_fatal",SYNCD_FIRST_CLEAR_OR_DELETE:"syncd-first-clear-or-delete",CONTACT_SYNC_REFRESH:"contact-sync-refresh-seconds",TOS_3:"TOS_STATE_20210210",NOTICE_BANNER_CLOSED_AT:"notice-banner-closed-at",NOTICE_ID:"notice-id",LOG_CURSOR:"debugCursor",LOCAL_TAKEOVER_OK:"local-takeover-ok",PS_KILLSWITCH_TOKEN:"ps-killswitch-token",STORAGE_DISMISS_STATE:"storage-dismiss-state",STORAGE_ALERT_FLAG:"storage-alert-flag",HOUR_24:"hour-24",PERSISTENT_EXPIRING_ID:"WaPersistentExpiringId",LAST_ELECTRON_NOTIFICATION_CLOSE:"last-electron-notification-close",WEB_NOTIFICATIONS_BB_STATUS:"WAWebNotificationsButterbarStatus",OFFLINE_NOTIFICATIONS_BB_STATUS:"WAOfflineNotificationsButterbarStatus"});t.KEYS=n;const r=Object.freeze({NOISE_INFO:"WANoiseInfo",NOISE_INFO_IV:"WANoiseInfoIv",ME_INFO:"WAMeInfo",DEVICE_ID:"WADeviceId",ROUTING_INFO:"WARoutingInfo",INITIAL_HISTORY_SYNCED:"WaInitialHistorySynced",CRITICAL_DATA_SYNCED:"critical_data_synced",HISTORY_SYNC_STATUS:"WAHistorySyncStatus",ADV_SECRET_KEY:"WaADVSecretKey",IS_SMB:"WAIsSMB",LAST_OFFLINE_MESSAGE:"WALastOfflineMessage",BLOCKLIST_HASH:"WABlocklistHash",SHOULD_CHECK_CONTACT_SYNC_STATUS:"WAShouldCheckContactSyncStatus",WEB_ENC_SALT:"WebEncKeySalt",MD_UPGRADE_WAM_FLAG:"MdUpgradeWamFlag",MD_HISTORY_LAST_CHUNK_PROCESSED:"MdHistoryLastChunkProcessed",UNARCHIVE_CHATS_SETTING:"WAUnarchiveChatsSetting",ARCHIVE_V2_ENABLED_SETTING:"WAArchiveV2EnabledSetting",SYNCD_PRIMARY_ALLOWS_ALL_MUTATIONS:"WASyncdPrimaryAllowsAllMutations",MD_SYNC_ACTIONS_ACTION_SANITIZED:"MdSyncActionsActionSanitized",CHAT_THREAD_LOGGING_OFFSET:"ChatThreadLoggingOffset",CHAT_THREAD_LOGGING_SECRET:"ChatThreadLoggingSecret",CHAT_THREAD_LOGGING_LAST_UPLOADED_START_TS:"ChatThreadLoggingLastUploadedStartTs",IS_COMMUNITY_DISCOVERED:"WAIsCommunityDiscovered",PAIRING_TIMESTAMP:"MdPairingTimestamp",RECENT_MAILBOX_AGE_DAYS:"MdRecentMailboxAgeDays",LAST_PERIODIC_APP_STATE_SYNC_TS:"MdLastPeriodicAppStateSyncTs",MD_LOGIN_COOKIE_REQUEST_COMPLETE:"MdLoginCookieRequestComplete",SCREEN_LOCK_ENABLED:"WAScreenLockEnabled",SCREEN_UNLOCK_TRY_COUNT:"WAScreenUnlockTryCount",SCREEN_LOCK_IV:"WAScreenLockIV",SCREEN_LOCK_SALT:"WAScreenLockSalt",COMMUNITY_TAB_LAST_SEEN_TIMESTAMP:"WACommunityTabLastSeenTimestamp"});t.MD_KEYS=r;const i=Object.freeze({});t.HASHED_MD_KEYS=i;const a=Object.freeze({});t.HASHED_KEYS=a},978820:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.assertGetMe=f,t.assertGetMeUser=function(){return(0,a.default)(_(),"meUser")},t.clearGetMaybeMeUserCache=void 0,t.getMaybeMeLid=m,t.getMaybeMeLidUser=y,t.getMaybeMeUser=void 0,t.getMe=p,t.getMePNandLIDWids=function(){const e=m();return null==e?[f()]:[f(),e]},t.getMeUser=_,t.isMeAccount=function(e){if(null==e||!S(e))return!1;if(e.isSameAccount(_()))return!0;const t=m();return null!=t&&e.isSameAccount(t)},t.isMeDevice=function(e){if(null==e||!S(e))return!1;if(e.equals(f()))return!0;const t=m();return null!=t&&e.equals(t)},t.isMePrimary=function(e){if(null==e||!S(e))return!1;if(e.equals(_()))return!0;const t=y();return null!=t&&e.equals(t)},t.setMe=function(e){g();const{isMDBackend:t}=n(88555);t()?(s.userPreferencesStoreBase.set(l.KEYS.LAST_WID_MD,e),(0,i.setMyJids)((0,d.widToMyJids)(e))):s.userPreferencesStoreBase.set(l.KEYS.LAST_WID,e)},t.setMeLid=function(e){s.userPreferencesStoreBase.set(l.KEYS.LID,e.toString())};var i=n(266543),a=r(n(145095)),o=n(470937),s=(n(333126),n(646239)),l=n(546718),c=r(n(389867)),u=n(745454),d=n(79196);function p(){let e=null;const{isMDBackend:t}=n(88555);return e=t()?s.userPreferencesStoreBase.get(l.KEYS.LAST_WID_MD):s.userPreferencesStoreBase.get(l.KEYS.LAST_WID),e&&c.default.isWid(e)?(0,u.createWid)(e):e}function f(){return(0,a.default)(p(),"me")}function _(){return(0,u.toUserWid)(f())}const[h,g]=(0,o.memoizeWithClear)((()=>{const e=p();if(e)return(0,u.toUserWid)(e)}));function m(){const e=s.userPreferencesStoreBase.get(l.KEYS.LID);return null==e?null:(0,u.createWid)(e)}function y(){const e=m();return null==e?null:(0,u.toUserWid)(e)}function S(e){const t=e instanceof c.default;return t||__LOG__(3)`isWID: input exists but is not WID`,t}t.clearGetMaybeMeUserCache=g,t.getMaybeMeUser=h},233776:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContactChecksum=function(){return r.userPreferencesStore.getUser(i)},t.getFrequentContacts=function(){return r.userPreferencesStore.getUser(a)},t.getGKFeatures=function(){return r.userPreferencesStore.getUser(o)},t.getGKProto=function(){return r.userPreferencesStore.getUser(s)},t.getHistoryInitialSyncBoundry=function(){const e=r.userPreferencesStore.getUser(l);try{return JSON.parse(e)}catch(e){return null}},t.getInitialGroupPhash=function(e){const t=r.userPreferencesStore.getUser(c);try{return JSON.parse(t)[e]}catch(e){return null}},t.getInitialGroupPhashMap=function(){const e=r.userPreferencesStore.getUser(c);try{return JSON.parse(e)}catch(e){return null}},t.setContactChecksum=function(e){r.userPreferencesStore.setUser(i,e)},t.setFrequentContacts=function(e){r.userPreferencesStore.setUser(a,e)},t.setGKFeatures=function(e){r.userPreferencesStore.setUser(o,e)},t.setGKProto=function(e){r.userPreferencesStore.setUser(s,e)},t.setHistoryInitialSyncBoundry=function(e){r.userPreferencesStore.setUser(l,JSON.stringify(e))},t.setInitialGroupPhash=function(e){r.userPreferencesStore.setUser(c,JSON.stringify(e))};var r=n(491442);const i="contact_checksum",a="frequent_contacts",o="gk_features",s="gk_proto",l="history_initial_sync_boundry",c="initial_group_phash"},711597:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearRegistrationInfo=function(){const e=[c.MD_KEYS.NOISE_INFO,c.MD_KEYS.ME_INFO,c.MD_KEYS.DEVICE_ID,c.MD_KEYS.ROUTING_INFO,c.MD_KEYS.INITIAL_HISTORY_SYNCED,c.MD_KEYS.WEB_ENC_SALT];(0,s.isMDBackend)()?e.push(c.KEYS.LAST_WID_MD):e.push(c.KEYS.LAST_WID);e.map((e=>{d.userPreferencesStore.set(e,void 0)}))},t.getADVSecretKey=function(){return d.userPreferencesStore.get(c.MD_KEYS.ADV_SECRET_KEY)},t.getAllCriticalDataSynced=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.CRITICAL_DATA_SYNCED,{storage:l.default})},t.getArchiveV2EnabledSetting=function(){return d.userPreferencesStore.get(c.MD_KEYS.ARCHIVE_V2_ENABLED_SETTING)},t.getBlocklistHash=function(){return d.userPreferencesStore.get(c.MD_KEYS.BLOCKLIST_HASH)},t.getChatThreadLoggingLastUploadedStartTs=function(){return d.userPreferencesStore.get(c.MD_KEYS.CHAT_THREAD_LOGGING_LAST_UPLOADED_START_TS)},t.getChatThreadLoggingOffset=function(){return d.userPreferencesStore.get(c.MD_KEYS.CHAT_THREAD_LOGGING_OFFSET)},t.getChatThreadLoggingSecretB64=function(){return d.userPreferencesStore.get(c.MD_KEYS.CHAT_THREAD_LOGGING_SECRET)},t.getCommunityTabLastSeenTimestamp=function(){var e;return null!==(e=d.userPreferencesStore.get(c.MD_KEYS.COMMUNITY_TAB_LAST_SEEN_TIMESTAMP))&&void 0!==e?e:0},t.getHistorySyncStatus=f,t.getInitialHistorySyncComplete=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.INITIAL_HISTORY_SYNCED,{storage:l.default})},t.getIsCommunityDiscovered=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.IS_COMMUNITY_DISCOVERED)},t.getLastHistorySycnedChunk=function(){return d.userPreferencesStore.get(c.MD_KEYS.MD_HISTORY_LAST_CHUNK_PROCESSED)},t.getLastPeriodicAppStateSyncTs=function(){return d.userPreferencesStore.get(c.MD_KEYS.LAST_PERIODIC_APP_STATE_SYNC_TS)},t.getMdInternVersion=function(){return},t.getMdLoginCookieReqestComplete=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.MD_LOGIN_COOKIE_REQUEST_COMPLETE)},t.getMdSyncActionsActionSanitized=function(){return d.userPreferencesStore.get(c.MD_KEYS.MD_SYNC_ACTIONS_ACTION_SANITIZED)},t.getNoiseInfo=p,t.getNoiseInfoIv=function(){return d.userPreferencesStore.get(c.MD_KEYS.NOISE_INFO_IV)},t.getPairingTimestamp=function(){return d.userPreferencesStore.get(c.MD_KEYS.PAIRING_TIMESTAMP)},t.getPrimaryAllowsAllMutations=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.SYNCD_PRIMARY_ALLOWS_ALL_MUTATIONS)},t.getRecentMailboxAgeDays=function(){return d.userPreferencesStore.get(c.MD_KEYS.RECENT_MAILBOX_AGE_DAYS)},t.getRoutingInfo=function(){const e=d.userPreferencesStore.get(c.MD_KEYS.ROUTING_INFO,{storage:l.default});if(!e)return null;const{domain:t,edgeRouting:n}=e;return{domain:t,edgeRouting:n?(0,o.decodeB64)(n):null}},t.getScreenLockEnabled=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.SCREEN_LOCK_ENABLED)},t.getScreenLockIvString=function(){return d.userPreferencesStore.get(c.MD_KEYS.SCREEN_LOCK_IV)},t.getScreenLockSalt=function(){return d.userPreferencesStore.get(c.MD_KEYS.SCREEN_LOCK_SALT,{storage:l.default})},t.getShouldCheckContactSyncStatus=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.SHOULD_CHECK_CONTACT_SYNC_STATUS)},t.getUnarchiveChatsSetting=function(){return d.userPreferencesStore.get(c.MD_KEYS.UNARCHIVE_CHATS_SETTING)},t.getUpgradeMdWamFlag=function(){return!!d.userPreferencesStore.get(c.MD_KEYS.MD_UPGRADE_WAM_FLAG)},t.getWebEncSalt=function(){return d.userPreferencesStore.get(c.MD_KEYS.WEB_ENC_SALT,{storage:l.default})},t.isRegistered=function(){return!(!p()||!(0,u.getMe)())},t.setADVSecretKey=function(e){return d.userPreferencesStore.set(c.MD_KEYS.ADV_SECRET_KEY,e)},t.setAllCriticalDataSynced=function(){return d.userPreferencesStore.set(c.MD_KEYS.CRITICAL_DATA_SYNCED,!0)},t.setArchiveV2EnabledSetting=function(e){d.userPreferencesStore.set(c.MD_KEYS.ARCHIVE_V2_ENABLED_SETTING,e)},t.setBlocklistHash=function(e){return d.userPreferencesStore.set(c.MD_KEYS.BLOCKLIST_HASH,e)},t.setChatThreadLoggingLastUploadedStartTs=function(e){d.userPreferencesStore.set(c.MD_KEYS.CHAT_THREAD_LOGGING_LAST_UPLOADED_START_TS,e)},t.setChatThreadLoggingOffset=function(e){d.userPreferencesStore.set(c.MD_KEYS.CHAT_THREAD_LOGGING_OFFSET,e)},t.setChatThreadLoggingSecretB64=function(e){d.userPreferencesStore.set(c.MD_KEYS.CHAT_THREAD_LOGGING_SECRET,e)},t.setCommunityTabLastSeenTimestamp=function(e){d.userPreferencesStore.set(c.MD_KEYS.COMMUNITY_TAB_LAST_SEEN_TIMESTAMP,e)},t.setHistorySyncStatus=function(e){var t;const n=null!==(t=f())&&void 0!==t?t:{};d.userPreferencesStore.set(c.MD_KEYS.HISTORY_SYNC_STATUS,(0,i.default)((0,i.default)({},n),e),{shouldWriteToIdb:!1})},t.setInitialHistorySyncComplete=function(){return d.userPreferencesStore.set(c.MD_KEYS.INITIAL_HISTORY_SYNCED,"true",{shouldWriteToIdb:!1})},t.setIsCommunityDiscovered=function(e){d.userPreferencesStore.set(c.MD_KEYS.IS_COMMUNITY_DISCOVERED,e)},t.setLastHistorySycnedChunk=function(e,t){if(null==e||null==t)return;d.userPreferencesStore.set(c.MD_KEYS.MD_HISTORY_LAST_CHUNK_PROCESSED,`${e}_${t}`,{shouldWriteToIdb:!1})},t.setLastPeriodicAppStateSyncTs=function(e){return d.userPreferencesStore.set(c.MD_KEYS.LAST_PERIODIC_APP_STATE_SYNC_TS,e)},t.setMdInternVersion=function(){},t.setMdLoginCookieReqestComplete=function(){return d.userPreferencesStore.set(c.MD_KEYS.MD_LOGIN_COOKIE_REQUEST_COMPLETE,!0)},t.setMdSyncActionsActionSanitized=function(e){d.userPreferencesStore.set(c.MD_KEYS.MD_SYNC_ACTIONS_ACTION_SANITIZED,e)},t.setNoiseInfo=function(e){const t={recoveryToken:e.recoveryToken,pubKey:e.staticKeyPair.pubKey,privKey:e.staticKeyPair.privKey};return d.userPreferencesStore.set(c.MD_KEYS.NOISE_INFO,(0,a.default)(t,o.encodeB64),{shouldWriteToIdb:!1})},t.setNoiseInfoIv=function(e){d.userPreferencesStore.set(c.MD_KEYS.NOISE_INFO_IV,e,{shouldWriteToIdb:!1})},t.setPairingTimestamp=function(e){return d.userPreferencesStore.set(c.MD_KEYS.PAIRING_TIMESTAMP,e)},t.setPrimaryAllowsAllMutations=function(){return d.userPreferencesStore.set(c.MD_KEYS.SYNCD_PRIMARY_ALLOWS_ALL_MUTATIONS,!0)},t.setRecentMailboxAgeDays=function(e){return d.userPreferencesStore.set(c.MD_KEYS.RECENT_MAILBOX_AGE_DAYS,e)},t.setRoutingInfo=function(e){const{domain:t,edgeRouting:n}=e,r={domain:t,edgeRouting:n?(0,o.encodeB64)(n):null};return d.userPreferencesStore.set(c.MD_KEYS.ROUTING_INFO,r,{storage:l.default})},t.setScreenLockEnabled=function(e){d.userPreferencesStore.set(c.MD_KEYS.SCREEN_LOCK_ENABLED,e)},t.setScreenLockIvString=function(e){d.userPreferencesStore.set(c.MD_KEYS.SCREEN_LOCK_IV,e)},t.setScreenLockSalt=function(e){return d.userPreferencesStore.set(c.MD_KEYS.SCREEN_LOCK_SALT,e,{shouldWriteToIdb:!1})},t.setShouldCheckContactSyncStatus=function(){return d.userPreferencesStore.set(c.MD_KEYS.SHOULD_CHECK_CONTACT_SYNC_STATUS,!0)},t.setUnarchiveChatsSetting=function(e){d.userPreferencesStore.set(c.MD_KEYS.UNARCHIVE_CHATS_SETTING,e)},t.setUpgradeMdWamFlag=function(e){return d.userPreferencesStore.set(c.MD_KEYS.MD_UPGRADE_WAM_FLAG,e)},t.setWebEncSalt=function(e){return d.userPreferencesStore.set(c.MD_KEYS.WEB_ENC_SALT,e,{shouldWriteToIdb:!1})};var i=r(n(81109)),a=r(n(66604)),o=n(615688),s=n(88555),l=r(n(745234)),c=n(546718),u=n(978820),d=n(491442);function p(){const e=d.userPreferencesStore.get(c.MD_KEYS.NOISE_INFO);if(!e)return null;const t=(0,a.default)(e,o.decodeB64);return{recoveryToken:t.recoveryToken,staticKeyPair:{pubKey:t.pubKey,privKey:t.privKey}}}function f(){return d.userPreferencesStore.get(c.MD_KEYS.HISTORY_SYNC_STATUS)}},474315:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.NuxPrefsEvent=void 0,t.getNUX=u,t.getNuxSyncList=d,t.nuxExistsInNuxSync=p,t.removeAllNuxSync=function(){s.userPreferencesStore.set(o.KEYS.NUX_LIST,[])},t.removeNUX=function(e){s.userPreferencesStore.setUser(e)},t.setNUX=function(e,t){s.userPreferencesStore.setUser(e,t)},t.shouldShowNUX=function(e){const t=(0,a.getNuxSyncKey)(e);if(null!=t&&p(t))return!1;const n=u(e);return!n||n.views<(0,a.getNuxMaxViews)(e)},t.updateNuxSyncList=function(e){const t=new Set(d());e.forEach((e=>{let{nuxKey:n,acknowledged:r}=e;r?t.add(n):t.delete(n)})),s.userPreferencesStore.set(o.KEYS.NUX_LIST,Array.from(t))};var i=r(n(876521)),a=n(871579),o=n(546718),s=n(491442);class l extends i.default{handleNuxChange(e){this.trigger(e)}}const c=new l;function u(e){return s.userPreferencesStore.getUser(e)}function d(){var e;return null!==(e=s.userPreferencesStore.get(o.KEYS.NUX_LIST))&&void 0!==e?e:[]}function p(e){return d().includes(e)}t.NuxPrefsEvent=c},266333:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clear=function(){f=void 0},t.get=function(){return(0,l.default)(f,"BUNDLE")},t.getBundle=function(){return f},t.getOrGenerate=function(){var e;if((null===(e=f)||void 0===e?void 0:e.key)&&f.keyPair)return(0,o.encodeB64)(f.key);const t=c.keyPair(),n=(0,o.encodeB64)(t.pubKey);return _({key:t.pubKey,keyPair:t,encKey:undefined,macKey:undefined}),n},t.getSecurityToken=function(){return h.apply(this,arguments)},t.load=function(){const e=function(){let e=d.userPreferencesStore.get(u.KEYS.SECRET_BUNDLE);if(!e)return __LOG__(3)`UserPrefs:Attempted to load non-existent secret bundle!`,null;"string"==typeof e&&(e=JSON.parse(e));return(0,a.default)(e,o.decodeB64)}();if(!e)return __LOG__(2)`secret_bundle:load: attempted to load non-existent secret bundle!`,null;return _(e),e},t.save=function(){if(!f)return void __LOG__(2)`secret_bundle:save: trying to save empty secret bundle!`;delete f.keyPair,e=f,d.userPreferencesStore.set(u.KEYS.SECRET_BUNDLE,(0,a.default)(e,o.encodeB64));var e},t.set=_,t.setSecretKeys=function(e,t,n){"0.1"===e?f&&t&&n?(f.encKey=t,f.macKey=n,f.key=n):__LOG__(3)`secret_bundle:setSecretKeys v${e} ${String(t)} ${String(n)}`:__LOG__(2)`secret_bundle:setSecretKeys unknown version: v${e}`};var i=r(n(348926)),a=r(n(66604)),o=n(615688),s=n(411141),l=r(n(145095)),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(138062)),u=n(546718),d=n(491442);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}let f;function _(e){f=e}function h(){return(h=(0,i.default)((function*(e){if(!f)return __LOG__(3)`secret_bundle:getSecurityToken: no secret bundle`,Promise.reject(new Error("secret_bundle:getSecurityToken: no secret bundle"));const t=yield(0,s.hmacSha256)(f.key,new Uint8Array(e));return(0,o.encodeB64)(t)}))).apply(this,arguments)}},270568:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setRememberMe=function(e){const t=!!e;if(t===s.userPreferencesStoreBase.getRememberMe())return;__LOG__(2)`UserPrefs:setRememberMe: ${String(t)}`;const n=s.userPreferencesStoreBase.getStorage();s.userPreferencesStoreBase.set(l.KEYS.REMEMBER_ME,t,{storage:o.default});const r=s.userPreferencesStoreBase.getStorage();if(n!==r){(0,i.default)(Object.keys(n.dataStore),c.LS_ONLY_KEYS.concat(c.LS_PRESERVE_KEYS)).forEach((function(e){const t=n.getItem(e);null!=t&&(r.setItem(e,t),n.removeItem(e))}))}t||a.Logger.clearLogs()};var i=r(n(291966)),a=n(739948),o=r(n(745234)),s=n(646239),l=n(546718),c=n(163200)},491442:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.userPreferencesStore=t.UserPreferencesStore=void 0;var i=r(n(393386)),a=r(n(617204)),o=r(n(402525)),s=r(n(907287)),l=r(n(611782)),c=r(n(745234)),u=r(n(724609)),d=n(646239),p=n(546718),f=n(163200);class _ extends d.UserPreferencesStoreBase{getMe(){return n(978820).getMaybeMeUser()}getKeys(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,s.default)(t,t.map((t=>e.getItem(t,n))))}setKeys(e,t){(0,o.default)(t,(function(t,n){e.setItem(n,t)}))}getAllKeyValues(){const e=super.getStorage();return(0,a.default)(Object.keys(e).map((function(t){return[t,e.getItem(t)]})))}setAllKeyValues(e){const t=super.getStorage();Object.keys(e).forEach((function(n){null!=e[n]&&t.setItem(n,e[n])}))}updatePreservedUserKeys(){var e;const t=this.getMe(),n=null!==(e=super.get(p.KEYS.PRESERVED_USER_KEYS,{storage:c.default}))&&void 0!==e?e:[];if(null!=t){const e=f.LS_PRESERVE_USER_KEYS.map((e=>(0,l.default)(this._concatenateKey(t.toString(),e))));super.set(p.KEYS.PRESERVED_USER_KEYS,(0,i.default)(n,e),{storage:c.default})}}getPSIgnoringCache(e){return super.get(e,{storage:c.default,ignoreCache:!0})}getTS(e){return super.get(e,{storage:u.default})}setTS(e,t){super.set(e,t,{storage:u.default})}setUserSession(e,t){const n=this.getMe();if(!n)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;const r=(0,l.default)(this._concatenateKey(n.toString(),e));super.set(r,t,{storage:u.default})}getUserSession(e){const t=this.getMe();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;const n=(0,l.default)(this._concatenateKey(t.toString(),e));return super.get(n,{storage:u.default})}clearUserSessionItem(e){const t=this.getMe();if(!t)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;const n=(0,l.default)(this._concatenateKey(t.toString(),e));u.default.removeItem(n)}getCollection(e){return this.getUser(e)}setCollection(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null==this.getMe()||n||this.setUser(e,t)}getUser(e){const t=this.getMe();if(!t)return __LOG__(3)`userPrefs: Me has not loaded yet.`,null;const n=(0,l.default)(this._concatenateKey(t.toString(),e));return super.get(n)}setUser(e,t){const n=this.getMe();if(!n)return void __LOG__(3)`userPrefs: Me has not loaded yet.`;const r=(0,l.default)(this._concatenateKey(n.toString(),e));super.set(r,t)}_concatenateKey(e,t){return[e,t].join(":")}}t.UserPreferencesStore=_;const h=new _;t.userPreferencesStore=h},163200:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TS_PRESERVE_KEYS=t.LS_PRESERVE_USER_KEYS=t.LS_PRESERVE_KEYS=t.LS_ONLY_KEYS=void 0;var r=n(546718);const i=[r.KEYS.LOG_CURSOR,r.KEYS.WHATSAPP_MUTEX,r.KEYS.REMEMBER_ME,r.KEYS.WHATSAPP_LS_VERSION];t.LS_ONLY_KEYS=i;const a=[r.KEYS.LANG,r.KEYS.WHATSAPP_MUTEX,r.KEYS.REMEMBER_ME,r.KEYS.OLD_LOGOUT_CREDS,r.KEYS.MD_OPTED_IN,r.KEYS.PRESERVED_USER_KEYS,r.KEYS.THEME,r.KEYS.SYSTEM_THEME_MODE,r.KEYS.MD_INTERN_VERSION_STR];t.LS_PRESERVE_KEYS=a;const o=[r.KEYS.SHOW_MD_UPGRADE_COMPLETE_MSG,r.KEYS.FORCED_MD_UPGRADE_COMPLETE];t.TS_PRESERVE_KEYS=o;const s=[r.KEYS.EMOJI_VARIANT_COLLECTION,r.KEYS.RECENT_EMOJI_COLLECTION,r.KEYS.RECENT_REACTIONS_COLLECTION,r.KEYS.CHAT_PREFERENCE_COLLECTION,r.KEYS.GLOBAL_MUTE_NOTIFICATIONS,r.KEYS.OUTGOING_MESSAGE_SOUND,r.KEYS.GLOBAL_MUTE_PREVIEWS,r.KEYS.GLOBAL_COLLAPSE_MUTED,r.KEYS.GLOBAL_MUTE_SOUNDS,r.KEYS.AUTO_DOWNLOAD_PHOTOS,r.KEYS.AUTO_DOWNLOAD_VIDEOS,r.KEYS.AUTO_DOWNLOAD_AUDIO,r.KEYS.AUTO_DOWNLOAD_DOCUMENTS,r.KEYS.TOS_3,r.KEYS.POSTCODE_AUTO_OPEN_CHANGE_POSTCODE_COUNT,r.KEYS.POSTCODE_TOOLTIP_VIEW_COUNT,r.KEYS.PERSISTENT_EXPIRING_ID];t.LS_PRESERVE_USER_KEYS=s},272441:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"asChatJid",{enumerable:!0,get:function(){return r.asChatJid}}),Object.defineProperty(t,"asMulticastJid",{enumerable:!0,get:function(){return r.asMulticastJid}}),Object.defineProperty(t,"asPhoneChatJid",{enumerable:!0,get:function(){return r.asPhoneChatJid}}),Object.defineProperty(t,"asStatusJid",{enumerable:!0,get:function(){return r.asStatusJid}}),Object.defineProperty(t,"authorAsUserJid",{enumerable:!0,get:function(){return r.authorAsUserJid}}),Object.defineProperty(t,"authorToUserId",{enumerable:!0,get:function(){return r.authorToUserId}}),Object.defineProperty(t,"defaultDeviceJidForUser",{enumerable:!0,get:function(){return r.defaultDeviceJidForUser}}),Object.defineProperty(t,"defaultLidDeviceJidForLidUserJid",{enumerable:!0,get:function(){return r.defaultLidDeviceJidForLidUserJid}}),Object.defineProperty(t,"defaultPhoneDeviceJidForUser",{enumerable:!0,get:function(){return r.defaultPhoneDeviceJidForUser}}),Object.defineProperty(t,"extractDeviceIDParts",{enumerable:!0,get:function(){return r.extractDeviceIDParts}}),Object.defineProperty(t,"extractDeviceId",{enumerable:!0,get:function(){return r.extractDeviceId}}),Object.defineProperty(t,"extractFromJid",{enumerable:!0,get:function(){return r.extractFromJid}}),Object.defineProperty(t,"extractJidFromJidWithType",{enumerable:!0,get:function(){return r.extractJidFromJidWithType}}),Object.defineProperty(t,"extractPhoneUserJid",{enumerable:!0,get:function(){return r.extractPhoneUserJid}}),Object.defineProperty(t,"extractUserId",{enumerable:!0,get:function(){return r.extractUserId}}),Object.defineProperty(t,"extractUserJid",{enumerable:!0,get:function(){return r.extractUserJid}}),Object.defineProperty(t,"fullFormDeviceJidString",{enumerable:!0,get:function(){return r.fullFormDeviceJidString}}),t.getGroupCallDomain=void 0,Object.defineProperty(t,"getGroupDomain",{enumerable:!0,get:function(){return r.getGroupDomain}}),Object.defineProperty(t,"getServerDomain",{enumerable:!0,get:function(){return r.getServerDomain}}),t.getUserDomain=void 0,Object.defineProperty(t,"groupIdFromJid",{enumerable:!0,get:function(){return r.groupIdFromJid}}),Object.defineProperty(t,"interpretAndValidateJid",{enumerable:!0,get:function(){return r.interpretAndValidateJid}}),Object.defineProperty(t,"interpretAsDeviceId",{enumerable:!0,get:function(){return r.interpretAsDeviceId}}),Object.defineProperty(t,"interpretAsGroupJid",{enumerable:!0,get:function(){return r.interpretAsGroupJid}}),Object.defineProperty(t,"interpretAsNumber",{enumerable:!0,get:function(){return r.interpretAsNumber}}),Object.defineProperty(t,"interpretAsPhoneUserJid",{enumerable:!0,get:function(){return r.interpretAsPhoneUserJid}}),Object.defineProperty(t,"interpretAsUserJid",{enumerable:!0,get:function(){return r.interpretAsUserJid}}),Object.defineProperty(t,"isPrimaryDevice",{enumerable:!0,get:function(){return r.isPrimaryDevice}}),Object.defineProperty(t,"maybeSanitizeLogLineText",{enumerable:!0,get:function(){return r.maybeSanitizeLogLineText}}),Object.defineProperty(t,"parseJidParts",{enumerable:!0,get:function(){return r.parseJidParts}}),Object.defineProperty(t,"phoneNumberFromJid",{enumerable:!0,get:function(){return r.phoneNumberFromJid}}),Object.defineProperty(t,"sanitizeJidForLogging",{enumerable:!0,get:function(){return r.sanitizeJidForLogging}}),Object.defineProperty(t,"stripAgentIdFromPhoneDeviceJid",{enumerable:!0,get:function(){return r.stripAgentIdFromPhoneDeviceJid}}),Object.defineProperty(t,"switchOnChatJidType",{enumerable:!0,get:function(){return r.switchOnChatJidType}}),Object.defineProperty(t,"switchOnJidType",{enumerable:!0,get:function(){return r.switchOnJidType}}),Object.defineProperty(t,"switchOnMsgrChatJidType",{enumerable:!0,get:function(){return r.switchOnMsgrChatJidType}}),Object.defineProperty(t,"switchOnMulticastJidType",{enumerable:!0,get:function(){return r.switchOnMulticastJidType}}),Object.defineProperty(t,"switchOnPhoneChatJidType",{enumerable:!0,get:function(){return r.switchOnPhoneChatJidType}}),Object.defineProperty(t,"switchOnPhoneJidType",{enumerable:!0,get:function(){return r.switchOnPhoneJidType}}),Object.defineProperty(t,"toBroadcastJid",{enumerable:!0,get:function(){return r.toBroadcastJid}}),Object.defineProperty(t,"toGroupJid",{enumerable:!0,get:function(){return r.toGroupJid}}),Object.defineProperty(t,"toPhoneDeviceJid",{enumerable:!0,get:function(){return r.toPhoneDeviceJid}}),Object.defineProperty(t,"toPhoneUserJid",{enumerable:!0,get:function(){return r.toPhoneUserJid}}),Object.defineProperty(t,"unsafeCoerceToDeviceId",{enumerable:!0,get:function(){return r.unsafeCoerceToDeviceId}}),Object.defineProperty(t,"unsafeCoerceToDeviceJid",{enumerable:!0,get:function(){return r.unsafeCoerceToDeviceJid}}),Object.defineProperty(t,"unsafeCoerceToGroupJid",{enumerable:!0,get:function(){return r.unsafeCoerceToGroupJid}}),Object.defineProperty(t,"unsafeCoerceToUserJid",{enumerable:!0,get:function(){return r.unsafeCoerceToUserJid}}),Object.defineProperty(t,"userIdFromJid",{enumerable:!0,get:function(){return r.userIdFromJid}});var r=n(252230);const i=(0,r.createJidUtils)({platform:"whatsapp"}),a=i.getUserDomain;t.getUserDomain=a;const o=i.getGroupCallDomain;t.getGroupCallDomain=o},854602:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCodeFromLogoutReason=function(e){switch(e){case r.LogoutReason.ClientFatalError:return r.LOGOUT_REASON_CODE.CLIENT_FATAL;case r.LogoutReason.SyncdFailure:case r.LogoutReason.SyncdErrorDuringBootstrap:case r.LogoutReason.AccountSyncError:case r.LogoutReason.SyncdTimeout:case r.LogoutReason.CriticalSyncTimeout:return r.LOGOUT_REASON_CODE.SYNC_FAIL;case r.LogoutReason.HistorySyncTimeout:return r.LOGOUT_REASON_CODE.INITIAL_HISTORY_SYNC_TIMEOUT;default:return null}},t.getPrevLogoutReasonCode=function(){return i},t.setPrevLogoutReasonCode=function(e){i=e};var r=n(788950);let i=null},470937:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.memoizeWithClear=function(e){let t;return[function(){return t||(t=[e()]),t[0]},function(){t=null}]}},333126:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorker=function(){return"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts}},634114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maxPerGroup=function(e,t,n){const r=new Map;for(const i of e){const e=n(i),a=r.get(e);(null==a||t(i)>=t(a))&&r.set(e,i)}return Array.from(r.values())}},556952:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.flattenPairList=function(e){return(0,i.default)(e.map((e=>[e[0],e[1]])))},t.unFlattenPairList=function(e){if(e.length%2!=0)throw new RangeError("Flattened pairs come in 2, invalid list size to unflatten!");const t=[];for(let n=0;n<e.length;n++)t.push([e[n],e[++n]]);return t};var i=r(n(385564))},899641:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.appendPrefilledMsg=f,t.formatInteractive=function(e){var t,n;let{formatAsSearchResult:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var i;if(e.interactiveType===a.default.SHOPS_STOREFRONT)return e.caption||(null===(i=e.interactiveHeader)||void 0===i?void 0:i.title)||"";if(e.nativeFlowName===o.default.ORDER_DETAILS){const t=p(e);if(null!=t)return t}if(e.nativeFlowName===o.default.ORDER_STATUS){const t=d(e);if(null!=t)return t}return[null===(t=e.interactiveHeader)||void 0===t?void 0:t.title,r?null===(n=e.interactiveHeader)||void 0===n?void 0:n.subtitle:null,e.caption,e.footer].filter(Boolean).join("\n")},t.formatOrderDetailsMessagePreview=p,t.formatOrderStatusMessage=d;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(939519)),a=r(n(384064)),o=r(n(905165)),s=n(834841),l=n(988998),c=n(548360);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e){const t=(0,l.getOrderStatusInfo)(e);return null==t?null:f(e.caption,null==t?void 0:t.status).toString()}function p(e){const t=(0,s.getOrderInfo)(e);if(null==t)return null;const{items:n,totalAmount:r,currency:a}=t,o=i.formatAmount(a,r);return n[0].name+" · "+o}function f(e,t){let n="";switch(t){case l.OrderStatus.Pending:n=c.fbt._("Status: Order pending",null,{hk:"4m2XYh"});break;case l.OrderStatus.Canceled:n=c.fbt._("Status: Order canceled",null,{hk:"2DMTyx"});break;case l.OrderStatus.PartiallyShipped:n=c.fbt._("Status: Order partially shipped",null,{hk:"1hZ92H"});break;case l.OrderStatus.Complete:n=c.fbt._("Status: Order complete",null,{hk:"k6UB5"});break;case l.OrderStatus.Shipped:n=c.fbt._("Status: Order shipped",null,{hk:"3c9XV9"});break;case l.OrderStatus.Processing:n=c.fbt._("Status: Order processing",null,{hk:"2IS36d"})}return(null==e?void 0:e.toLowerCase().includes(n.toString().toLowerCase()))?e||"":(n.toString()+"\n"+(e||"")).trim()}},286274:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_INQUIRY_TYPE=t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=t.BIZ_SYSTEM_MSG_SUBTYPES_V2=t.BIZ_SYSTEM_MSG_SUBTYPES=void 0;t.BIZ_SYSTEM_MSG_SUBTYPES=["blue_msg_bsp_fb_to_bsp_premise","blue_msg_bsp_fb_to_self_fb","blue_msg_bsp_fb_to_self_premise","blue_msg_bsp_fb_unverified","blue_msg_bsp_fb_unverified_to_bsp_premise_verified","blue_msg_bsp_fb_unverified_to_self_fb_verified","blue_msg_bsp_fb_unverified_to_self_premise_verified","blue_msg_bsp_fb_verified","blue_msg_bsp_fb_verified_to_bsp_premise_unverified","blue_msg_bsp_fb_verified_to_self_fb_unverified","blue_msg_bsp_fb_verified_to_self_premise_unverified","blue_msg_bsp_premise_to_self_premise","blue_msg_bsp_premise_unverified","blue_msg_bsp_premise_unverified_to_self_premise_verified","blue_msg_bsp_premise_verified","blue_msg_bsp_premise_verified_to_self_premise_unverified","blue_msg_consumer_to_bsp_fb_unverified","blue_msg_consumer_to_bsp_premise_unverified","blue_msg_consumer_to_self_fb_unverified","blue_msg_consumer_to_self_premise_unverified","blue_msg_self_fb_to_bsp_premise","blue_msg_self_fb_to_self_premise","blue_msg_self_fb_unverified","blue_msg_self_fb_unverified_to_bsp_premise_verified","blue_msg_self_fb_unverified_to_self_premise_verified","blue_msg_self_fb_verified","blue_msg_self_fb_verified_to_bsp_premise_unverified","blue_msg_self_fb_verified_to_self_premise_unverified","blue_msg_self_premise_to_bsp_premise","blue_msg_self_premise_unverified","blue_msg_self_premise_verified","blue_msg_to_bsp_fb","blue_msg_to_consumer","blue_msg_to_self_fb","blue_msg_unverified_to_bsp_fb_verified","blue_msg_unverified_to_bsp_premise_verified","blue_msg_unverified_to_self_fb_verified","blue_msg_unverified_to_verified","blue_msg_verified_to_bsp_fb_unverified","blue_msg_verified_to_bsp_premise_unverified","blue_msg_verified_to_self_fb_unverified","blue_msg_verified_to_unverified"];const n=["biz_privacy_mode_init_fb","biz_privacy_mode_init_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT=n;const r=[...n,"biz_privacy_mode_to_fb","biz_privacy_mode_to_bsp"];t.BIZ_SYSTEM_MSG_SUBTYPES_V2=r;t.PRODUCT_INQUIRY_TYPE="product_inquiry"},131038:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e){case r.VERIFIED_LEVEL.HIGH:return"high";case r.VERIFIED_LEVEL.LOW:return"low";case r.VERIFIED_LEVEL.UNKNOWN:default:return"unknown"}};var r=n(393170)},374316:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scanComplianceInfoForMissingData=t.isBusinessCompliant=t.getGrievanceOfficerDetailsError=t.getEntityTypeText=t.getCustomerCareDetailsError=t.existsGrievanceOfficerDetailsContact=t.existsFieldIgnoreHardEnforcement=t.existsField=t.existsCustomerCareDetailsContact=void 0;var r=n(408139),i=n(509978),a=n(393170),o=n(548360);t.getEntityTypeText=e=>{const{entityType:t,entityTypeCustom:n,isRegistered:r}=e||{},i={[a.businessTypeOptions.limitedLiabilityPartnership]:o.fbt._("Limited liability partnership",null,{hk:"2dwmwU"}),[a.businessTypeOptions.soleProprietorship]:o.fbt._("Sole proprietorship",null,{hk:"2N7jks"}),[a.businessTypeOptions.partnership]:o.fbt._("Partnership",null,{hk:"ZeckL"}),[a.businessTypeOptions.publicCompany]:o.fbt._("Public Company",null,{hk:"1YuMvC"}),[a.businessTypeOptions.privateCompany]:o.fbt._("Private Company",null,{hk:"WL0uU"}),[a.businessTypeOptions.other]:o.fbt._("Other",null,{hk:"3zua5D"})},s=n||i[t]||"";if(!s)return"";let l="";return[a.businessTypeOptions.partnership,a.businessTypeOptions.other].includes(t)&&(l=r?o.fbt._("Registered Business",null,{hk:"3N1x9I"}):o.fbt._("Not Registered Business",null,{hk:"2zDsuK"})),`${s.toString()}${l?` (${l.toString()})`:""}`};const s=(e,t)=>!(!e&&!t),l=e=>!!(null==e?void 0:e.trim());t.existsFieldIgnoreHardEnforcement=l;const c=(e,t)=>!(0,r.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||l(e);t.existsField=c;const u=(e,t,n,i,a)=>!(0,r.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(t.user)||n.some((t=>l(t===i?a:null==e?void 0:e[t]))),d=(e,t,n,r)=>u(e,t,["mobileNumber","landlineNumber"],n,r);t.existsCustomerCareDetailsContact=d;const p=(e,t,n,r)=>u(e,t,["mobileNumber","landlineNumber","email"],n,r);t.existsGrievanceOfficerDetailsContact=p;t.isBusinessCompliant=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(!(0,r.canSeeECommerceComplianceIndiaHardEnforcementBusinessJourney)(n.user))return!0;if(!t)return!1;const{entityName:i,entityType:a,entityTypeCustom:o,customerCareDetails:l,grievanceOfficerDetails:u}=t;return[e,i,null==l?void 0:l.email,null==u?void 0:u.name].every((e=>c(e,n)))&&s(a,o)&&d(l,n)&&p(u,n)};t.getCustomerCareDetailsError=(e,t,n,r,i)=>d(e,i,t,n)?r:"";t.getGrievanceOfficerDetailsError=(e,t,n,r,i)=>p(e,i,t,n)?r:"";t.scanComplianceInfoForMissingData=e=>{const t=(null==e?void 0:e.countryCodeOrigin)===String(i.SyntheticCountryCode.NotApplicable),n=!t&&void 0!==(null==e?void 0:e.countryCodeOrigin),r=!t&&void 0!==(null==e?void 0:e.importerName);return{isExempt:t,hasImporterAddress:!t&&void 0!==(null==e?void 0:e.importerAddress)&&[e.importerAddress.street1,e.importerAddress.street2,e.importerAddress.city,e.importerAddress.region,e.importerAddress.postalCode,e.importerAddress.countryCode].some((e=>e)),hasImporterName:r,hasCountryCodeOrigin:n}}},715127:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMPLIANCE_INFO_LENGTH=t.COMPLIANCE_INFO_CODES=void 0;t.COMPLIANCE_INFO_CODES={INDIA:"IN"};t.COMPLIANCE_INFO_LENGTH={ENTITY_NAME:1024,ENTITY_TYPE_CUSTOM:1024,EMAIL:256,GRIEVANCE_OFFICER_NAME:256,LANDLINE_NUMBER:20,MOBILE_NUMBER:20,IMPORTER_NAME:1024,STREET1:1024,STREET2:1024,CITY:1024,REGION:1024,POSTAL_CODE:12}},305905:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CypherType=void 0,t.cypherStringToString=function(e){return e},t.decryptDataWithSymmetricKey=u,t.decryptDataWithSymmetricKeyToString=function(){return p.apply(this,arguments)},t.genCypher=function(){return f.apply(this,arguments)},t.stringToCypherString=function(e){return e};var i=r(n(348926)),a=n(676100),o=n(770986);const s=n(76672).Mirrored(["PhoneNumberAndPostcode","Postcode"]);function l(){return c.apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e,t,n){const{subtle:r}=yield(0,o.getEngine)();return r.encrypt({name:"AES-GCM",iv:new Uint8Array((0,o.base64ToArrayBuffer)(t)),tagLength:128},e,(0,o.stringToArrayBuffer)(n))}))).apply(this,arguments)}function u(){return d.apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e,t,n){const{subtle:r}=yield(0,o.getEngine)(),i=yield r.importKey("raw",e,{name:"AES-GCM"},!1,["decrypt"]);return r.decrypt({name:"AES-GCM",iv:new Uint8Array((0,o.base64ToArrayBuffer)(n)),tagLength:128},i,(0,o.base64ToArrayBuffer)(t))}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e,t,n){return(0,a.arrayBufferToString)(yield u(e,t,n))}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e,t){const n=(0,o.arrayBufferToBase64)(yield(0,o.getRandomValues)(new Uint8Array(16)));try{const{subtle:r}=yield(0,o.getEngine)(),i=yield r.generateKey({name:"AES-GCM",length:256},!0,["encrypt"]),a=(0,o.arrayBufferToBase64)(yield l(i,n,JSON.stringify(t))),s=yield r.exportKey("raw",i);return{cypher:`AesKey=${yield(0,o.encryptWithPublicKey)(e,s)};IV=${n};Data=${a}`,exportedAesKey:s,iv:n}}catch(e){return __LOG__(3)`[direct-connection] cypher creation failed with ${e.toString()}`,null}}))).apply(this,arguments)}t.CypherType=s},471682:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.directConnectionBusinessNumbersFromAbprop=function(){const e=(0,a.getABPropConfigValue)("direct_connection_business_numbers");if("string"==typeof e&&e.length>0)return e.split(",");return[]},t.editPostcodeByDefaultEnabled=function(){if((0,o.isMDBackend)())return(0,a.getABPropConfigValue)("dc_edit_postcode_by_default_enabled");return!1},t.enablePostcodeInCatalog=function(){if((0,o.isMDBackend)())return(0,a.getABPropConfigValue)("web_abprop_direct_connection_md");return!1},t.genDirectConnectionMessageModifiers=function(){return y.apply(this,arguments)},t.supportsDirectConnection=h;var i=r(n(348926)),a=n(257243),o=n(88555),s=n(115461),l=n(745454),c=n(856149),u=n(124808),d=n(964551);function p(){return((0,c.getBusinessProfileQueryVersion)()&c.DIRECT_CONNECTION_FLAG)>0}function f(){return d.ServerProps.isDirectConnectionForPLMTransparent&&((0,o.isLegacyWebdBackend)()||!(0,a.getABPropConfigValue)("web_abprop_direct_connection_md"))}function _(e,t){return e===s.MSG_TYPE.LIST&&t===u.Message$ListMessage$ListType.PRODUCT_LIST}function h(){return(0,o.isMDBackend)()?(0,a.getABPropConfigValue)("web_abprop_direct_connection_md"):f()}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t,r){if(f()||!_(e,t)||!r)return!1;if(!p())return __LOG__(3)`[direct-connection] This web client cannot detect if the product list message recevied is coming from a direct connection business`,"unknown";const i=(0,l.createWid)(r),{BusinessProfileCollection:a}=n(493581);let o=a.get(i);return o&&o.profileOptions||(o=yield a.find(i)),o.isBusinessDirectConnection()||!1}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t,n){const r=yield g(e,t,n);return!0!==r||h()?{requiresDirectConnection:r}:{requiresDirectConnection:r,type:s.MSG_TYPE.UNKNOWN,subtype:"phone_only_feature"}}))).apply(this,arguments)}},770986:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.arrayBufferToBase64=f,t.arrayBufferToString=h,t.base64ToArrayBuffer=p,t.certificateStringToString=function(e){return e},t.encodeToString=function(e){return e.map((e=>{const t=f(e.toSchema(!0).toBER(!1)).split(/(.{0,64})/g).filter((e=>""!==e)).join("\n");return`${s}\n${t}\n${l}`})).join("\n")},t.encryptWithPublicKey=function(){return M.apply(this,arguments)},t.extractCertificates=E,t.fetchFromCABundle=function(){return S.apply(this,arguments)},t.genRootIssuers=function(){return C.apply(this,arguments)},t.getCommonName=A,t.getEngine=b,t.getRandomValues=function(){return O.apply(this,arguments)},t.stringToArrayBuffer=_,t.stringToCertificateString=function(e){return e},t.validateCertificates=function(){return T.apply(this,arguments)};var i=r(n(348926)),a=r(n(357291)),o=n(929595);const s="-----BEGIN CERTIFICATE-----",l="-----END CERTIFICATE-----",c=`(?:${s})((?:.|\n)*?)(?:${l})`;function u(){return n.e(6352).then(n.bind(n,614231))}function d(){return n.e(6352).then(n.bind(n,865267))}function p(e){let t="";try{t=atob(e)}catch(e){__LOG__(3)`[direct-connection] base64 decoding failed with ${e.toString()}`}return _(t)}function f(e){return btoa(h(e))}function _(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}function h(e){return String.fromCharCode(...Array.from(new Uint8Array(e)))}function g(){return m.apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e,t){const{CertificateChainValidationEngine:n}=yield u();return new n({trustedCerts:t,certs:e})}))).apply(this,arguments)}function y(e,t){return e.flat().reduce(((e,n)=>e.every((e=>!(0,o.isEqualBuffer)(e.tbs,n.tbs)))&&t.includes(n)?[...e,n]:e),[])}function S(){return(S=(0,i.default)((function*(){const{CA_BUNDLE:e}=yield n.e(239).then(n.bind(n,675793));return E(e)}))).apply(this,arguments)}function E(){return v.apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){const{Certificate:t}=yield u(),{fromBER:n}=yield d();return(0,a.default)(Array.from(e.matchAll(new RegExp(c,"gm"))).map((e=>{let[r,i]=e;const{result:a}=n(p(i));let o;try{o=a.error?null:new t({schema:a})}catch(e){__LOG__(3)`[direct-connection] certificate chain parsing from Get Public Key IQ failed with ${e.toString()}`}return o})))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t){return(yield g(e,t)).verify()}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){const n=yield g(e,t),r=y(yield Promise.all(e.map((e=>n.findIssuer(e,n)))),t);return 0===r.length?(__LOG__(3)`[direct-connection] no trusted root certificates could be found for ${A(e[0])}`,null):r}))).apply(this,arguments)}function A(e){var t;return null===(t=e.issuer.typesAndValues.find((e=>{let{type:t}=e;return"2.5.4.3"===t})))||void 0===t?void 0:t.value.valueBlock.value}function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(){const{getEngine:e}=yield u();return e()}))).apply(this,arguments)}function O(){return(O=(0,i.default)((function*(e){const{getRandomValues:t}=yield u();return t(e)}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t){const n=yield e.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]}}),r=yield b();return f(yield r.subtle.encrypt({name:"RSA-OAEP"},n,t))}))).apply(this,arguments)}},333037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemParentType=void 0;const r=n(76672).Mirrored(["Chat","Contact","Msg"]);t.LabelItemParentType=r},864795:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addToLabelCollection=a,t.createLabelItemId=s,t.getParentCollection=function(e){switch(e){case i.LabelItemParentType.Chat:return n(669951).ChatCollection;case i.LabelItemParentType.Contact:return n(719380).ContactCollection;case i.LabelItemParentType.Msg:return n(559871).MsgCollection}},t.getParentTypeFromModel=o,t.initializeLabels=function(e){const t=o(e);if((0,r.isMDBackend)())e.labels=n(316770).LabelCollection.getLabelsForModel(e.id.toString(),t);else{const n=()=>{a(e.id.toString(),e.labels,t)};n(),e.listenTo(e,"change:labels",n)}},t.removeLabelFromCollection=function(e,t,a){const o=n(316770).LabelCollection.get(t),l=null==o?void 0:o.labelItemCollection;if(!l)return void __LOG__(3)`labelItemCollection does not exist for lableId ${t}`;l.remove(s(e,t,a)),(0,r.isMDBackend)()&&a===i.LabelItemParentType.Chat&&l.remove(s(e,t,i.LabelItemParentType.Contact))};var r=n(88555),i=n(333037);function a(e,t,a){if(t&&t.length>0){const o=n(316770).LabelCollection;t.forEach((t=>{const n=o.gadd({id:t});n.labelItemCollection.gadd({id:s(e,t,a),labelId:t,parentId:e,parentType:a}),(0,r.isMDBackend)()&&a===i.LabelItemParentType.Chat&&n.labelItemCollection.gadd({id:s(e,t,i.LabelItemParentType.Contact),labelId:t,parentId:e,parentType:i.LabelItemParentType.Contact})}))}}function o(e){if(e instanceof n(63183).Chat)return i.LabelItemParentType.Chat;if(e instanceof n(400121).default)return i.LabelItemParentType.Contact;if(e instanceof n(17304).Msg)return i.LabelItemParentType.Msg;throw new Error("getParentTypeFromModel: model is invalid")}function s(e,t,n){return`${e}_${t}_${n}`}},979158:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){return JSON.parse(e)},t.stringify=function(e){return JSON.stringify(e)}},319496:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.businessHoursFromConfig=c,t.dayToWeekday=l,t.getBusinessHours=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{config:n}=e,r=(new Date).getDay(),i=a.DAYS_OF_WEEK.map(((e,i)=>{const o=(r+i)%a.DAYS_OF_WEEK.length,s=a.DAYS_OF_WEEK[o];return{day:l(o),hours:c(n[s],t).toString(),first:0===i}}));return i},t.getBusinessHoursForEdit=function(e){const t=null==e?{}:e.config,{note:n,timezone:r}=e||{};let o;const l=a.DAYS_OF_WEEK.map(((e,n)=>{const r=t[e],a=s.default.weekdays(n);let l;return r&&(o=r.mode,r.hours&&(l=r.hours.map((e=>{let[t,n]=e;return[(0,i.minutesToTime)(t),(0,i.minutesToTime)(n)]})))),{dayName:a,dayKey:e,closed:!r,hours:l}})),c=s.default.weekdays(!0,0),u=s.default.weekdays().indexOf(c),d=l.splice(u);return{mode:o,days:[...d,...l],timezone:r,note:n}},t.getWebsiteLink=function(e){return`https://l.wl.co/l?u=${encodeURIComponent(e)}`};var i=n(224190),a=n(393170),o=n(548360),s=r(n(730381));function l(e){return s.default.weekdays(e)}function c(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(null==e?void 0:e.mode){case a.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:return t?d(null==e?void 0:e.hours):u(null==e?void 0:e.hours);case a.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:return o.fbt._("By appointment only",null,{hk:"e1vew"});case a.BUSINESS_HOUR_MODES.OPEN_24H:return o.fbt._("Open 24 hours",null,{hk:"1AlfF5"});default:return o.fbt._("Closed",null,{hk:"3IRgct"})}}function u(e){return e?e.map((e=>e.map(i.minutesToTime).join(" - "))).join("\n"):""}function d(e){if(1===(null==e?void 0:e.length))return e[0].map(i.minutesToTime).join(" - ");if(2===(null==e?void 0:e.length)){const t=(0,i.minutesToTime)(e[0][0]),n=(0,i.minutesToTime)(e[0][1]),r=(0,i.minutesToTime)(e[1][0]),a=(0,i.minutesToTime)(e[1][1]);return o.fbt._("{openTime} - {closeTime} and {additionalOpenTime} - {additionalCloseTime}",[o.fbt._param("openTime",t),o.fbt._param("closeTime",n),o.fbt._param("additionalOpenTime",r),o.fbt._param("additionalCloseTime",a)],{hk:"MyQHy"})}return""}},224190:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.minutesToTime=function(e){return a.default.utc().startOf("day").add(e,"minutes").format(i.Clock.timestampStrFormat())},t.timeStringToMinutes=void 0;var i=n(40234),a=r(n(730381));const o=["h:mm A","h:mmA","HH:mm","HH.mm","H:mm","H.mm"];t.timeStringToMinutes=e=>{let t;const n=e.trim();if(!n)return;for(const e of o){const r=(0,a.default)(n,e,!0);if(r.isValid()){t=r;break}}if(!t)return;const r=t,i=(0,a.default)().startOf("day"),s=r.diff(i);return a.default.duration(s).asMinutes()}},957932:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COOKIE_DOMAIN=void 0;t.COOKIE_DOMAIN=".web.whatsapp.com"},564418:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t.getCookie=function(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:void 0},t.setCookie=function(e){e.session&&delete e.expirationDate;const t=[];["name","value","domain","path","secure","session","expirationDate"].forEach((n=>{const r=e[n];if(void 0!==r&&"value"!==n)switch(n){case"expirationDate":const i=new Date(e.expirationDate);t.push(`expires=${i.toUTCString()}`);break;case"secure":t.push("secure");break;case"name":const a=e.value||"";t.push(`${String(r)}=${a}`);break;default:t.push(`${n}=${String(r)}`)}})),document.cookie=t.join(";")}},653872:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t]=e.source.errors||[];switch(null==t?void 0:t.code){case 2498052:case 2498049:case 2498050:case 2498051:case 2498053:case 2498056:throw new i.ServerStatusCodeError(400,e.message);case 2498048:throw new i.E451;case 2498054:throw new i.ServerStatusCodeError(421)}};var i=n(492574);r(n(299805))},492574:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebdDrop=t.ServerStatusCodeError=t.Server5xxDrop=t.LogoutDrop=t.EphemeralDrop=t.E507=t.E499=t.E451=t.E404=t.E401=t.ConventionViolationDrop=t.CatalogEditServerError=t.BrowserReplacedDrop=void 0,t.attachErrorLogger=function(e,t,n){return e.catch((e=>{throw __LOG__(4,!0,new Error,!0)`${n||t}, error: ${e}`,SEND_LOGS(t),e}))};var r=n(640265);class i extends((0,r.customError)("ServerStatusCodeError")){constructor(e,t){super(t),this.status=e,this.statusCode=e}}t.ServerStatusCodeError=i;class a extends((0,r.customError)("ServerStatusCodeError")){constructor(e,t,n){super(n),this.errors=t,this.status=e,this.statusCode=e}}t.CatalogEditServerError=a;class o extends((0,r.customError)("E451",!0,i)){constructor(){super(451,"commerce features disabled")}}t.E451=o;class s extends((0,r.customError)("E401",!0,i)){constructor(e){super(401,e)}}t.E401=s;class l extends((0,r.customError)("E404",!0,i)){constructor(e){super(404,e)}}t.E404=l;class c extends((0,r.customError)("E499",!0,i)){constructor(e){super(499,e)}}t.E499=c;class u extends((0,r.customError)("E507",!0,i)){constructor(e,t){super(507,e),this.backoff=Number.isNaN(t)?null:t}}t.E507=u;class d extends((0,r.customError)("WebdDrop")){}t.WebdDrop=d;class p extends((0,r.customError)("BrowserReplacedDrop",!0,d)){}t.BrowserReplacedDrop=p;class f extends((0,r.customError)("ConventionViolationDrop",!0,d)){}t.ConventionViolationDrop=f;class _ extends((0,r.customError)("Server5xxDrop",!0,d)){}t.Server5xxDrop=_;class h extends((0,r.customError)("LogoutDrop",!0,d)){}t.LogoutDrop=h;class g extends((0,r.customError)("EphemeralDrop",!0,d)){}t.EphemeralDrop=g},435232:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateImmediately=t.Unmount=t.UnableToPlayVideoError=t.UnableToGetContentLengthError=t.TranscodeBlobTooLargeError=t.SourceUnavailableError=t.SocketNotOpen=t.SocketError=t.SocketClosed=t.ShouldLoop=t.ServerStatusError=t.QueryDrop=t.ProtoVersionUndefined=t.OverconstrainedError=t.Offline=t.NotSupportedError=t.NotFoundError=t.NotAllowedError=t.ModelError=t.ModelCreateError=t.MediaUnsupportedError=t.MediaNeedsReupload=t.MediaMissing=t.MediaLoadError=t.MediaFileFailedLoad=t.MediaFileError=t.MediaFileEmpty=t.MediaEncryptionError=t.MediaDragDropError=t.MediaDecryptionError=t.InvalidServerResponseError=t.InvalidMediaFileType=t.InvalidImageFileType=t.ImageError=t.GaveUpRetry=t.GUMError=t.GUM=t.FileNotReadableError=t.EncodeWebpError=t.DeprecatedProtocolVersion=t.DecodeWebpResultsError=t.DbOnLogoutAbort=t.DbMsgEncKeyNotLoaded=t.DbEncKeyNotLoaded=t.DBInvalidFtsHMACKey=t.ConstraintNotSatisfiedError=t.CatalogImageDownloadError=t.CapabilityUnknown=t.CapabilityInvalid=t.CapabilityError=t.CanNotSendUnencrypted=t.BlockedByProxy=t.BingServerError=t.ActiveChatChanged=t.ActionError=void 0;var r=n(640265);class i extends((0,r.customError)("QueryDrop")){}t.QueryDrop=i;class a extends((0,r.customError)("Offline")){}t.Offline=a;class o extends((0,r.customError)("ShouldLoop")){}t.ShouldLoop=o;class s extends((0,r.customError)("GaveUpRetry")){}t.GaveUpRetry=s;class l extends((0,r.customError)("CatalogImageDownloadError")){}t.CatalogImageDownloadError=l;class c extends((0,r.customError)("MediaFileError")){}t.MediaFileError=c;class u extends((0,r.customError)("InvalidImageFileType",!0,c)){}t.InvalidImageFileType=u;class d extends((0,r.customError)("InvalidMediaFileType",!0,c)){}t.InvalidMediaFileType=d;class p extends((0,r.customError)("MediaEncryptionError",!0,c)){}t.MediaEncryptionError=p;class f extends((0,r.customError)("MediaDecryptionError",!0,c)){}t.MediaDecryptionError=f;class _ extends((0,r.customError)("MediaFileFailedLoad",!0,c)){}t.MediaFileFailedLoad=_;class h extends((0,r.customError)("MediaFileEmpty",!0,c)){}function g(e){try{return JSON.stringify(e)}catch(t){return e.toString()}}t.MediaFileEmpty=h;class m extends((0,r.customError)("SocketError")){constructor(e){super("string"==typeof e?e:g(e)),this.event=e}}t.SocketError=m;class y extends((0,r.customError)("SocketClosed")){constructor(e){super("string"==typeof e?e:g(e)),this.event=e}}t.SocketClosed=y;class S extends((0,r.customError)("SocketNotOpen")){constructor(e){super(`socket not open, is ${e}`)}}t.SocketNotOpen=S;class E extends((0,r.customError)("BlockedByProxy")){}t.BlockedByProxy=E;class v extends((0,r.customError)("ImageError")){constructor(e,t){super("Image failed to load."),this.src=e,this.status=t,this.target={src:e,status:t}}}t.ImageError=v;class T extends((0,r.customError)("DecodeWebpResultsError")){constructor(e,t){super(e),this.event=t}}t.DecodeWebpResultsError=T;class C extends((0,r.customError)("DecodeWebpError")){constructor(e,t){super(e),this.event=t}}t.EncodeWebpError=C;class A extends((0,r.customError)("ServerStatusError")){constructor(e,t,n){super(`${e||"Server replied with a failed status code"}: ${n}`),this.url=t,this.status=n}}t.ServerStatusError=A;class b extends((0,r.customError)("InvalidServerResponseError")){constructor(e,t,n){let r=`Invalid response for ${e}, with status ${t}`;n&&(r=`${r}: ${n}`),super(r)}}t.InvalidServerResponseError=b;class P extends((0,r.customError)("BingServerError",!0,A)){constructor(e,t,n){super(`Error ${t} for ${e}: ${JSON.stringify(n)}`,e,t)}}t.BingServerError=P;class O extends((0,r.customError)("MediaNeedsReupload")){}t.MediaNeedsReupload=O;class M extends((0,r.customError)("MediaMissing")){}t.MediaMissing=M,M.message="Media is no longer available on your phone";class I extends((0,r.customError)("FileNotReadableError",!0,Error)){}t.FileNotReadableError=I;class w extends((0,r.customError)("MediaLoadError")){constructor(e){super(e),this.src=e}}t.MediaLoadError=w;class R extends((0,r.customError)("TranscodeBlobTooLargeError")){constructor(){super("Transcode blob too large")}}t.TranscodeBlobTooLargeError=R;class N extends((0,r.customError)("UnableToPlayVideoError")){constructor(e){super(`Unable to play video. Reason: ${String(e)}`)}}t.UnableToPlayVideoError=N;class L extends((0,r.customError)("MediaDragDropError",!0,w)){}t.MediaDragDropError=L;class D extends((0,r.customError)("MediaUnsupportedError")){}t.MediaUnsupportedError=D,D.message="Media format is unsupported";class k extends((0,r.customError)("ModelError")){}t.ModelError=k;class U extends((0,r.customError)("ModelCreateError")){constructor(e,t){super(e),this.model=t}}t.ModelCreateError=U;class G extends((0,r.customError)("DbEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseEncryptionKey.${e} was accessed before init`)}}t.DbEncKeyNotLoaded=G;class x extends((0,r.customError)("DbMsgEncKeyNotLoadedError")){constructor(e){super(`MasterDatabaseMessageEncryptionKey.${e} was accessed before init`)}}t.DbMsgEncKeyNotLoaded=x;class B extends((0,r.customError)("DbOnLogoutAbortError")){}t.DbOnLogoutAbort=B,B.message="DB operation was dropped due to logout activity";class F extends((0,r.customError)("DBExpiredFtsHMACKey")){}t.DBInvalidFtsHMACKey=F,F.message="MasterDatabaseEncryptionKey.fts_hmac_keys is in an invalid state";class j extends((0,r.customError)("ProtoVersionUndefined")){}t.ProtoVersionUndefined=j;class Y extends((0,r.customError)("UpdateImmediately")){}t.UpdateImmediately=Y;class K extends((0,r.customError)("DeprecatedProtocolVersion")){}t.DeprecatedProtocolVersion=K;class W extends((0,r.customError)("CapabilityError")){}t.CapabilityError=W;class H extends((0,r.customError)("CapabilityInvalid",!0,W)){}t.CapabilityInvalid=H;class V extends((0,r.customError)("CapabilityUnknown",!0,W)){}t.CapabilityUnknown=V;class $ extends((0,r.customError)("CanNotSendUnencrypted")){}t.CanNotSendUnencrypted=$;class z extends((0,r.customError)("ActionError")){}t.ActionError=z,z.message="Could not perform action.";class q extends((0,r.customError)("Unmount")){}t.Unmount=q;class J extends((0,r.customError)("ActiveChatChanged")){}t.ActiveChatChanged=J;class Q extends((0,r.customError)("GUMError")){}t.GUMError=Q;class X extends((0,r.customError)("NotSupportedError",!0,Q)){}t.NotSupportedError=X,X.message="The operation is not supported.";class Z extends((0,r.customError)("NotAllowedError",!0,Q)){}t.NotAllowedError=Z,Z.message="The user did not grant permission for the operation";class ee extends((0,r.customError)("ConstraintNotSatisfiedError",!0,Q)){}t.ConstraintNotSatisfiedError=ee,ee.message="One of the mandatory Constraints could not be satisfied.";class te extends((0,r.customError)("OverconstrainedError",!0,Q)){}t.OverconstrainedError=te,te.message="Due to changes in the environment, one or more mandatory constraints can no longer be satisfied.";class ne extends((0,r.customError)("NotFoundError",!0,Q)){}t.NotFoundError=ne,ne.message="The object can not be found here.";class re extends((0,r.customError)("SourceUnavailableError",!0,Q)){}t.SourceUnavailableError=re,re.message="The source of the MediaStream could not be accessed due to a hardware error (e.g. lock from another process).";class ie extends((0,r.customError)("UnableToGetContentLengthError")){}t.UnableToGetContentLengthError=ie,ie.message="Failed to get media contentLength from mms";const ae={GUMError:Q,NotSupportedError:X,NotAllowedError:Z,ConstraintNotSatisfiedError:ee,OverconstrainedError:te,NotFoundError:ne,SourceUnavailableError:re};t.GUM=ae},481806:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeError=s,t.normalizeStack=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{name:n,message:r,stack:i}=s(e),a=i.indexOf("\n"),l=i.slice(0,a),c=l.match(new RegExp(`(${(0,o.default)(n)}|Error)(:|$)`));if(null!=c){if(!t)return i;const e=c.index+c[0].length,n=null==r?-1:i.indexOf(r,e),o=null==r||-1===n?-1:n+r.length,s=Math.max(0,a,e,o);return i.slice(s).replace(/^\n+/,"")}if(t)return i;const u=""===i?"":`\n${i}`;return r?`${n}: ${r}${u}`:`${n}${u}`};var i=r(n(81109)),a=r(n(548403)),o=r(n(103522));function s(e){const t="object"==typeof e&&"string"==typeof(null==e?void 0:e.name)?e.name:`Thrown${(0,a.default)(typeof e)}Error`;let n,r;if(n=null!=e&&"string"==typeof e.message?e.message:void 0===e?"":String(e),null!=e&&"string"==typeof e.stack)r=e.stack;else{const e=new Error;e.name=t,e.message=n,r="string"==typeof e.stack?e.stack:""}const o="object"==typeof e?(0,i.default)({},e):null;return(0,i.default)((0,i.default)({},o),{},{name:t,message:n,stack:r})}},434475:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.normalizeError)(e),{name:n,message:r,stack:s}=t,l=(0,i.default)(t,o),c=(0,a.normalizeStack)(e,!0),u=0===Object.keys(l).length?"":" "+JSON.stringify(l,((e,t)=>e&&"object"==typeof t?String(t):t));return`${n} - ${r||""}${u}\n${c}`};var i=r(n(506479)),a=n(481806);const o=["name","message","stack"]},876521:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(873955)),a=r(n(441609)),o=r(n(751463));const s=/\s+/;t.default=class{on(e,t,n){if(!t)return this;if("function"!=typeof t)throw new Error("Callback parameter passed is not a function");return this._multiEvent(this.on,...arguments)||this._getOrCreateEvents(e).push({callback:t,context:n,ctx:n||this}),this}once(e,t,n){if(!t)return this;if(this._multiEvent(this.once,...arguments))return this;const r=this,i=(0,o.default)((function(){r.off(e,i),t.apply(this,arguments)}));return i._callback=t,this.on(e,i,n)}off(e,t,n){const r=this._events;if(!r)return this;if(this._multiEvent(this.off,...arguments))return this;if(!e&&!t&&!n)return this._events=void 0,this;const i=e?[e]:Object.keys(r);for(let e=0;e<i.length;e++){const a=i[e],o=r[a];if(o){if(r[a]=[],t||n)for(let e=0;e<o.length;e++){const i=o[e];(t&&t!==i.callback&&t!==i.callback._callback||n&&i.context!==n)&&r[a].push(i)}r[a].length||delete r[a]}}return this}trigger(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!this._events)return this;if(this._multiEvent(this.trigger,...arguments))return this;const i=this._getEvents(e),a=this._getEvents("all");return i&&this._triggerEvents(i,n),a&&this._triggerEvents(a,arguments),this}stopListening(e,t,n){const r=this._listeningTo;if(!r)return this;const i=null==e?void 0:e._listenId,o=i?{[i]:e}:r;for(const e in o){const i=o[e];i.off(t,n,this),(!t&&!n||(0,a.default)(i._events))&&delete r[e]}return(0,a.default)(this._listeningTo)&&delete this._listeningTo,this}listenTo(e,t,n){return n?(this._addListeningTo(e),e.on(t,n,this),this):this}listenToOnce(e,t,n){return this._addListeningTo(e),e.once(t,n,this),this}listenToAndRun(e,t,n){return this.listenTo.apply(this,arguments),n.apply(this),this}isListening(e){const t=this._events;return!!t&&("string"==typeof e?!!t[e]:(0,a.default)(t))}_addListeningTo(e){(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=(0,i.default)("l"))]=e}_getOrCreateEvents(e){const t=this._events||(this._events={});return t[e]||(t[e]=[])}_getEvents(e){if(!e)return;const t=this._events;return t?t[e]:void 0}_multiEvent(e,t){if(s.test(t)){const a=t.split(s);for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];for(let t=0;t<a.length;t++)e.call(this,a[t],...r);return!0}return!1}_triggerEvents(e,t){let n,r=-1;const i=e.length,a=t[0],o=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,a);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,a,o);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,a,o,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t)}}bind(){return this.on(...arguments)}unbind(){return this.off(...arguments)}removeListener(){return this.off(...arguments)}removeAllListeners(){return this.off()}emit(){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return this.trigger(arguments)}}},312523:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){if(null==i?void 0:i.aborted)return Promise.reject(new r.AbortError);let a,o;const s=n;return new Promise((function(n,l){if(a=s?function(){s.apply(this,arguments)&&n(arguments)}:function(){n(arguments)},i){const e=()=>{var e;null===(e=o)||void 0===e||e(),l(new r.AbortError)};i.addEventListener("abort",e),o=()=>{i.removeEventListener("abort",e),o=null}}e.on(t,a)})).cancellable().finally((function(){var n;e.off(t,a),null===(n=o)||void 0===n||n()}))};var r=n(389385)},282080:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){if(null==i?void 0:i.aborted)return Promise.reject(new r.AbortError);let a,o;const s=n;return new Promise((function(n,l){var c;if(a=s?function(){s.apply(this,arguments)&&n.apply(this,arguments)}:n,i){const e=()=>{var e;null===(e=o)||void 0===e||e(),l(new r.AbortError)};i.addEventListener("abort",e),o=()=>{i.removeEventListener("abort",e),o=null}}null===(c=e.addEventListener)||void 0===c||c.call(e,t,a)})).cancellable().finally((function(){var n,r;null===(n=e.removeEventListener)||void 0===n||n.call(e,t,a),null===(r=o)||void 0===r||r()}))};var r=n(389385)},297744:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(i.Cmd.isMainLoaded)return Promise.resolve();return(0,a.default)(i.Cmd,"main_loaded")};var i=n(781572),a=r(n(312523))},355184:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(i.Cmd.isMainStreamReadyMd)return Promise.resolve();return(0,a.default)(i.Cmd,"main_stream_mode_ready")};var i=n(781572),a=r(n(312523))},3121:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,i.default)(window,"offline")};var i=r(n(282080))},932533:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.waitForOnlineNaive=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=n(413959),o=r(n(282080));function s(){return(s=(0,i.default)((function*(){return yield(0,o.default)(self,"online"),(0,a.delayMs)(100)}))).apply(this,arguments)}},288098:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.supportsAesCbc=function(){return o().then((e=>e.generateKey(a,!1,["encrypt","decrypt"]).then((t=>Promise.resolve(self.crypto).then((e=>({name:"AES-CBC",iv:e.getRandomValues(new Uint8Array(16))}))).then((i=>e.encrypt(i,t,r).then((n=>e.decrypt(i,t,n))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC encryption failed: ${e}`,!1))).then((e=>{const t=new Uint8Array(e);return r=t,Array.prototype.slice.call(r).map((e=>String.fromCharCode(e))).join("")===n?(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is correct`,!0):(__LOG__(2)`CryptoSupport:AES-CBC encryption/decryption is incorrect`,!1);var r})).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC decryption failed: ${e}`,!1))))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:AES-CBC: ${e}`,!1)))},t.supportsHmacSha256=function(){return o().then((e=>e.generateKey(i,!1,["sign","verify"]).then((t=>e.sign(i,t,r).then((n=>e.verify(i,t,n,r.buffer))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 signing failed: ${e}`,!1))).then((e=>e?(__LOG__(2)`CryptoSupport:HMAC-SHA256 is verified`,!0):(__LOG__(2)`CryptoSupport:HMAC-SHA256 is not verified`,!1))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 verification failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256 key generation failed: ${e}`,!1))))).catch((e=>(__LOG__(2)`CryptoSupport:HMAC-SHA256: ${e}`,!1)))};const n="whatsapp is da best",r=new Uint8Array(n.split("").map((e=>e.charCodeAt(0))));const i={name:"HMAC",hash:"SHA-256"},a={name:"AES-CBC",length:256};function o(){return Promise.resolve().then((()=>self.crypto.subtle||self.crypto.webkitSubtle))}},431645:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.detectWebpSupport=function(){return c.apply(this,arguments)},t.getCachedWebpSupport=function(){return l};var i=r(n(348926)),a=n(638284),o=n(216737);const s=(0,a.promiseTimeout)(new Promise((e=>{(0,o.loadImage)("data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA").then((t=>e(2===t.height)))})),5e3).catch((()=>!1));let l=null;function c(){return(c=(0,i.default)((function*(){if(null!=l)return Promise.resolve(l);const e=yield s;return l=e,e}))).apply(this,arguments)}},319902:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=new Promise((function(e){function t(){e(!1)}if(self.requestFileSystem)self.requestFileSystem(window.TEMPORARY,1,t,(function(t){e("SecurityError"===t.name)}));else if(s.default){const n=s.default.open("pb_detect");n?(n.onsuccess=t,n.onerror=function(t){t.preventDefault(),window.InvalidStateError?e(t instanceof window.InvalidStateError):e(!0)}):t()}else c.UA.isTrident?e(!0):t()})).then((function(e){if(e)return e;if(!l.default)return!1;try{return l.default.setItem("INCOG","0"),l.default.removeItem("INCOG"),!1}catch(e){if("QuotaExceededError"===e.name)return!0;throw e}}));return(0,o.promiseTimeout)(e,100,"detectIncognitoTimeout").catch((0,a.filteredCatch)(i.TimeoutError,(function(){return!1}))).catch((function(e){return __LOG__(3,void 0,void 0,!0)`promiseUtil:determineIncognito failed check: ${String(e)}`,SEND_LOGS("incog-throw"),!1}))};var i=n(640265),a=n(450796),o=n(638284),s=r(n(226945)),l=r(n(904285)),c=n(26741)},521863:(e,t,n)=>{"use strict";var r=n(595318);t.Z=function(){if(c(l))return!0;return(0,i.promiseProps)({cryptoSha256:(0,a.supportsHmacSha256)(),cryptoAesCbc:(0,a.supportsAesCbc)()}).then(c),!1};var i=n(367602),a=n(288098),o=r(n(904285)),s=r(n(439312));const l={getRandomValues:!!self.crypto.getRandomValues,subtleCrypto:!(!self.crypto||!self.crypto.subtle&&!self.crypto.webkitSubtle),localstorage:!!o.default,sessionstorage:!!s.default,url:!!self.URL,websocket:!!self.WebSocket,worker:!!self.Worker};function c(e){const t=[];for(const n in e)e[n]||t.push(n);if(t.length>0){const e=`https://web.whatsapp.com/browsers.html?missing=${t.join(",")}`;return window.location.replace?window.location.replace(e):window.location.href=e,!0}return!1}},8425:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(638284),a=r(n(876521)),o=r(n(125613)),s=r(n(364237)),l=n(26741);const c="Modernizr"in window;class u extends a.default{constructor(){super(),this.supported=c?Modernizr.serviceworker:"serviceWorker"in navigator,this._checkAlive=()=>{var e;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;return Boolean(t)},this._checkStreamingSupport=()=>{var e;if(!this.supported||!this.alive||l.UA.isSafari)return void(this._streamingSupported=!1);if(this._streamingSupportedPromise)return this._streamingSupported;const t=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller;t&&(this._streamingSupportedPromise=(0,i.promiseTimeout)(o.default.request(t,s.default.STREAMING_SUPPORTED),100).catch((()=>!1)).then((e=>(delete this._streamingSupportedPromise,this.streamingSupported=e,e))))},this._setSupported=e=>{this.supported=e},c&&Modernizr.on("serviceworker",this._setSupported);const e=this;Object.defineProperty(this,"streamingSupported",{get:()=>(e._checkStreamingSupport(),e._streamingSupported),set(t){t!==e._streamingSupported&&e.trigger("change:streamingSupported",t),e._streamingSupported=t}}),Object.defineProperty(this,"alive",{get:()=>e._checkAlive()})}}var d=new u;t.default=d},26741:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UA=t.OS_TYPE=t.BROWSER_TYPE=void 0,t.gteVersion=o,t.ltVersion=s,t.parseUA=l;var i=r(n(42238));t.BROWSER_TYPE={CHROME:"chrome",CHROMIUM:"chromium",FIREFOX:"firefox",SAFARI:"safari",IE:"ie",OPERA:"opera",EDGE:"edge"};function a(e,t){let n,r;const i=/(\.0)+[^\.]*$/,a=(e+"").replace(i,"").split("."),o=(t+"").replace(i,"").split("."),s=Math.min(a.length,o.length);for(n=0;n<s;n++)if(r=parseInt(a[n],10)-parseInt(o[n],10),0!==r)return r;return a.length-o.length}function o(e,t){return a(e,t)>=0}function s(e,t){return a(e,t)<0}function l(e){const t=new i.default;t.setUA(e||"");const n=(t.getBrowser().name||"").toUpperCase(),r=t.getBrowser().version||"0.0.0",a=(t.getEngine().name||"").toUpperCase(),l=(t.getOS().name||"").toUpperCase(),c=t.getOS().version||"0.0.0",u="SAFARI"===n,d="CHROME"===n,p="GECKO"===a,f="BLINK"===a;let _=!1;switch(l){case"MAC OS":d?_=o(c,"10.10")&&o(r,"41.0.0"):o(c,"10.7")&&(_=!0);break;case"WINDOWS":o(c,"8.1")&&(p||d&&o(r,"41.0.0"))&&(_=!0)}const h=u||d&&s(r,"76");return{isWebkit:!a||"WEBKIT"===a,isGecko:p,isTrident:"TRIDENT"===a||"EDGEHTML"===a,isSafari:u,isElectron:!1,isBlink:f,isBuggyVideoLoad:d&&o(r,"76")||f&&!d,hasEmoji:_,troublesWithLotsOfVideos:d,supportsEmojiEllipsification:!h,isBrokenGetUserMedia:d&&s(r,"50"),isLocalStorageBroken:u&&o(r,"14.1")&&s(r,"14.1.2"),os:l.toLowerCase(),osVersion:c,browser:n.toLowerCase(),browserVersion:r,parser:t,isChrome:d}}t.OS_TYPE={WINDOWS:"windows",MAC:"mac os",CHROMEOS:"chromium os"};const c=l("undefined"!=typeof self?self.navigator.userAgent:null);t.UA=c},767924:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.JS_HALT_EVENT=t.CLOCK_CHANGE_BACKWARDS_EVENT=t.BaseJsHaltDetector=void 0;var i=r(n(876521));const a="js_halt";t.JS_HALT_EVENT=a;const o="clock_change_backwards";t.CLOCK_CHANGE_BACKWARDS_EVENT=o;class s extends i.default{constructor(e,t){super(),this._interval=e,this._threshold=t}startDetection(){if(this._intervalId)return;let e=Date.now();this._intervalId=setInterval((()=>{const t=Date.now(),n=t-e-this._interval;n>this._threshold?this.trigger(a,n):n<-this._threshold&&this.trigger(o,n),e=t}),this._interval),__LOG__(2)`JsHaltDetector:detection started`}stopDetection(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null,__LOG__(2)`JsHaltDetector:detection stopped`)}restartDetection(){this.stopDetection(),this.startDetection(),__LOG__(2)`JsHaltDetector:detection restarted`}}t.BaseJsHaltDetector=s},885553:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jsHaltDetector=t.DEFAULT_THRESHOLD=t.DEFAULT_INTERVAL=void 0;var r=n(767924);t.DEFAULT_THRESHOLD=3e3;t.DEFAULT_INTERVAL=1e4;const i=new r.BaseJsHaltDetector(1e4,3e3);t.jsHaltDetector=i,i.startDetection()},585582:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addBorder=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"white";const r=document.createElement("canvas"),i=r.getContext("2d"),a=document.createElement("canvas"),o=a.getContext("2d"),s=2*t;r.width=a.width=e.width+2*s,r.height=a.height=e.height+2*s,i.drawImage(e,s,s),o.shadowColor=n,o.shadowBlur=1;for(let e=0;e<s;e++)o.drawImage(r,0,0),i.drawImage(a,0,0);return o.shadowColor="rgba(0,0,0,0)",o.drawImage(e,s,s),a},t.canvasToBlob=c,t.canvasToWebp=function(e){if(l.default){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return(0,l.default)(t.data,e.width,e.height,{ensureExtendedFormat:!0})}return c(e,"image/webp")},t.contain=function(e,t){const{width:n,height:r}=(0,o.boundHeightWidth)(e.height,e.width,t);if(n>e.width&&r>e.height)return e;const i=document.createElement("canvas"),a=i.getContext("2d");return i.width=n,i.height=r,a.drawImage(e,0,0,n,r),i},t.copy=p,t.createCanvas=d,t.fillBackgroundWithGray=function(e){const t=e.getContext("2d");t.fillStyle="rgb(247,247,247)",t.fillRect(0,0,e.width,e.height)},t.generateMicroThumb=function(){return u.apply(this,arguments)},t.getResizedDataUrl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=arguments.length>2?arguments[2]:void 0;const r=e.toDataURL(t),i=(0,a.dataURLtoBlob)(r);if(i.size<=n)return e.toDataURL(t);for(let r=.9;r>=.1;r-=.1){const i=e.toDataURL(t,r);if((0,a.dataURLtoBlob)(i).size<=n)return i}return null},t.resize=function(e,t,n){const r=e.getContext("2d"),i=r.getImageData(0,0,t,n);e.width=t,e.height=n,r.putImageData(i,0,0)},t.rotate=function(e,t){const n=t.x||0,r=t.y||0;t.degrees&&(t.radians=t.degrees*(Math.PI/180));e.translate(n,r),e.rotate(t.radians),e.translate(-n,-r)},t.scale=function(e,t){const n=e.getContext("2d"),r=p(e),{width:i,height:a}=(0,o.aspectRatioScaled)(e.width/e.height,t);e.width=i,e.height=a,n.drawImage(r,0,0,i,a)},t.square=function(e){const t=e.getContext("2d"),n=e.width,r=e.height,i=t.getImageData(0,0,n,r),a=Math.max(n,r);e.width=a,e.height=a,t.clearRect(0,0,n,r),t.putImageData(i,(a-n)/2,(a-r)/2,0,0,n,r)},t.trim=function(e){if(function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=t.data.length/4;let r;for(r=0;r<n;r++){if(0!==t.data[4*r+3])return!1}return!0}(e))return;const{left:t,top:n,right:r,bottom:i}=function(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height),n=t.data.length/4;let r,i=1/0,a=1/0,o=0,s=0;for(r=0;r<n;r++){if(0===t.data[4*r+3])continue;const n=r%e.width,l=Math.floor(r/e.width);n<i&&(i=n),n>o&&(o=n),l<a&&(a=l),l>s&&(s=l)}return{left:i,top:a,right:o,bottom:s}}(e),a=i-n,o=r-t,s=e.getContext("2d").getImageData(t,n,o,a),l=d(o,a);return l.getContext("2d").putImageData(s,0,0),l};var i=r(n(348926)),a=n(241931),o=n(950057),s=r(n(534949)),l=r(n(189059));function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg";return e.toBlob?new Promise((function(n){e.toBlob(n,t)})):Promise.resolve((0,a.dataURLtoBlob)(e.toDataURL(t)))}function u(){return(u=(0,i.default)((function*(e,t,n){var r,i;const a=n||{},o=null!==(r=a.mimetype)&&void 0!==r?r:"image/jpeg",l=null!==(i=a.maxAttempts)&&void 0!==i?i:10;let u=.5,p=e,f=yield c(p,o);for(let n=0;n<l&&!(f.size<=t);n++){const t=Math.floor(e.width*u),n=Math.floor(e.height*u);p=d(t,n);p.getContext("2d").drawImage(e,0,0,t,n),f=yield c(p,o),u*=.5}return{opaqueData:yield s.default.createFromData(f,o),width:p.width,height:p.height,dataUrl:p.toDataURL("image/jpeg")}}))).apply(this,arguments)}function d(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,n}function p(e){const t=d(e.width,e.height);return t.getContext("2d").drawImage(e,0,0),t}},950057:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aspectRatioScaled=function(e,t){if("number"!=typeof e||e<0||e!=e)return{width:t,height:t};if(e>1)return{width:t,height:Math.max(t/e,1)};return{width:Math.max(t*e,1),height:t}},t.boundHeightWidth=function(e,t,n){let r=null!=t?t:n,i=null!=e?e:n;r>i?r>n&&(i*=n/r,r=n):i>n&&(r*=n/i,i=n);return{width:Math.max(r,1),height:Math.max(i,1)}},t.rotatePoint=function(e,t,n){const r=n*Math.PI/180;return{x:Math.cos(r)*e+Math.sin(r)*t,y:-Math.sin(r)*e+Math.cos(r)*t}}},551428:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_URL=t.CANVAS=t.BlackVideoThumbnailError=t.BLOB=void 0,t.base64ImageToCanvas=function(){return x.apply(this,arguments)},t.crop=function(){return I.apply(this,arguments)},t.generateLinkPreview=function(){return R.apply(this,arguments)},t.generateVideoThumbsAndDuration=function(){return M.apply(this,arguments)},t.isCached=function(e){if(!e)return!1;const t=new Image;return t.src=e,!!t.complete},t.rotateAndResize=function(e,t,n,r){const{transparency:i=!1,fitToSquare:a=!1,minDimension:o=0}=null!=r?r:{},s=new ArrayBuffer(0);let c,f,_;e instanceof HTMLCanvasElement?(f=Promise.resolve(e),_=Promise.resolve(s)):(c=window.URL.createObjectURL(e),f=g.loadImage(c),_=(0,d.blobToArrayBuffer)(e).catch((e=>(__LOG__(3)`ImageUtils::rotateAndResize error: ${e}`,s))));return(0,l.promiseProps)({buffer:_,image:f}).then((e=>{var r;let{buffer:s,image:c}=e,d={};try{d=(0,y.default)(s)}catch(e){}let f=0;if(!(null===(r=Modernizr)||void 0===r?void 0:r.exiforientation))switch(d.orientation||"UNKNOWN"){case"right-top":f=1;break;case"left-bottom":f=-1;break;case"bottom-right":f=2}const _=document.createElement("canvas"),g=c.naturalWidth||c.width,m=c.naturalHeight||c.height,S=Math.max(g,m),E=_.getContext("2d"),v={};if(!f){const e=(0,p.boundHeightWidth)(m,g,t);let r,d,f=n&A;if(s&&f&&g===e.width&&m===e.height)try{const e=(0,h.cleanJPEG)(s);v.blob=e,f=!1,r=g,d=m}catch(e){__LOG__(2)`Could not parse JPEG: ${e.message}`}return(f||n&~A)&&(_.width=e.width,_.height=e.height,i||(0,u.fillBackgroundWithGray)(_),E.drawImage(c,0,0,_.width,_.height),a&&((0,u.square)(_),v.blob=void 0),S<o&&((0,u.scale)(_,o),v.blob=void 0),r=_.width,d=_.height,G(v,_,n,i)),(0,l.promiseProps)(v).then((e=>({width:r,height:d,images:e})))}switch(f){case 1:case-1:const e=Math.max(g,m),r=e/2;_.width=_.height=e,i||(0,u.fillBackgroundWithGray)(_),(0,u.rotate)(E,{x:r,y:r,degrees:90*f}),1===f?E.drawImage(c,0,e-m):E.drawImage(c,e-g,0),(0,u.rotate)(E,{x:r,y:r,degrees:-90*f}),(0,u.resize)(_,m,g),a&&(0,u.square)(_),S<o&&(0,u.scale)(_,o);const s=(0,u.contain)(_,t);return G(v,s,n,i),(0,l.promiseProps)(v).then((e=>({width:s.width,height:s.height,images:e})));case 2:const d=(0,p.boundHeightWidth)(m,g,t),h=_.width=d.width,y=_.height=d.height;return i||(0,u.fillBackgroundWithGray)(_),(0,u.rotate)(E,{x:h/2,y:y/2,degrees:90*f}),E.drawImage(c,0,0,h,y),(0,u.rotate)(E,{x:h/2,y:y/2,degrees:-90*f}),a&&(0,u.square)(_),S<o&&(0,u.scale)(_,o),G(v,_,n,i),(0,l.promiseProps)(v).then((e=>({width:_.width,height:_.height,images:e})))}})).finally((()=>{}))},t.toDataUrl=function(){return N.apply(this,arguments)},t.toDataUrlWithRoundedCorners=function(){return w.apply(this,arguments)},t.toWebpSticker=function(){return k.apply(this,arguments)},t.urlToFile=function(){return U.apply(this,arguments)};var a=i(n(348926)),o=n(640265),s=n(757491),l=n(367602),c=n(374094),u=n(585582),d=n(565885),p=n(950057),f=E(n(435232)),_=n(26741),h=n(345987),g=E(n(216737)),m=n(490669),y=i(n(326642));function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}function E(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}const v=2,T=4,C=1;t.DATA_URL=C;const A=v;t.BLOB=A;const b=T;t.CANVAS=b;class P extends((0,o.customError)("BlackVideoThumbnailError")){}t.BlackVideoThumbnailError=P,P.message="Generated video thumbnail is black";const O=e=>{let{video:t,fullWidth:n,fullHeight:r,maxDimension:i}=e;const a=document.createElement("canvas"),{width:o,height:s}=(0,p.boundHeightWidth)(r,n,i);a.width=o,a.height=s;const l=a.getContext("2d");l.drawImage(t,0,0,o,s);const c=l.getImageData(0,0,o,s);return{thumb:{url:a.toDataURL("image/jpeg"),width:o,height:s,fullWidth:n,fullHeight:r},imageData:c}};function M(){return(M=(0,a.default)((function*(e){const{file:t,maxDimensions:n,debugHint:i,throwOnBlack:a=!1}=e,{video:o,fullWidth:l,fullHeight:c}=yield g.loadVideo(t),u=e=>{const t=e.width*e.height/4;for(let n=0;n<=1;n+=.25){const r=4*Math.round(t*n);if(0!==e.data[r])return!1;if(0!==e.data[r+1])return!1;if(0!==e.data[r+2])return!1;const i=e.data[r+3];if(0!==i&&255!==i)return!1}return!0};if(_.UA.isBuggyVideoLoad){const e=50,t=5e3/e;return(0,s.exponentialBackoff)({minTimeout:e,maxTimeout:e,retries:t,signal:(new r).signal,factor:1},((e,r)=>{const s=[];let d;for(d of n){const{thumb:n,imageData:p}=O({video:o,fullHeight:c,fullWidth:l,maxDimension:d});if(u(p)){if(r<t)return 0===r&&__LOG__(2)`generateVideoThumbsAndDuration: Setting video.currentTime to 0 to attempt to unblock the video`,o.currentTime=0,e(new Error("retry"));if(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${i}`,SEND_LOGS(`thumbnail-generation-failed-${i}`)),a)throw new P}s.push(n)}const p={duration:~~o.seekable.end(0),thumbs:s};return g.disposeVideo(o),Promise.resolve(p)}))}try{const e=n.map((e=>{const{thumb:t,imageData:n}=O({video:o,fullHeight:c,fullWidth:l,maxDimension:e});if(u(n)&&(Math.random()<=.02&&(__LOG__(4,void 0,new Error,!0)`generateVideoThumbsAndDuration: Failed to generate video thumbnail from ${i}`,SEND_LOGS(`thumbnail-generation-failed-${i}`)),a))throw new P;return t}));return{duration:~~o.seekable.end(0),thumbs:e}}finally{g.disposeVideo(o)}}))).apply(this,arguments)}function I(){return(I=(0,a.default)((function*(e,t,n,r,i,a,o){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:C;const c=e instanceof HTMLCanvasElement?e:yield g.loadImage(e),u=document.createElement("canvas"),d=u.getContext("2d");null==a||null==o?(u.height=i,u.width=r,d.drawImage(c,t,n,r,i)):(u.height=o,u.width=a,d.drawImage(c,t,n,r,i,0,0,a,o));const p={};G(p,u,s);const f=yield(0,l.promiseProps)(p);return{images:f,width:r,height:i}}))).apply(this,arguments)}function w(){return(w=(0,a.default)((function*(e){const t=e instanceof HTMLCanvasElement?e:yield g.loadImage(e),n=document.createElement("canvas"),r=n.getContext("2d");n.height=t.height,n.width=t.width;const i=Math.min(t.width,t.height);return r.beginPath(),r.arc(t.width/2,t.height/2,i/2,0,2*Math.PI,!0),r.clip(),r.closePath(),r.drawImage(t,0,0),n.toDataURL("image/png")}))).apply(this,arguments)}function R(){return(R=(0,a.default)((function*(e){try{const t=yield g.loadImage(e),n=100,r=140;if(t.width<n||t.height<n)return __LOG__(2)`Image size too small for link preview`,null;const i=document.createElement("canvas"),a=i.getContext("2d");i.height=r,i.width=r;const o=Math.min(t.width,t.height),s=(t.width-o)/2,l=(t.height-o)/2;return a.drawImage(t,s,l,o,o,0,0,r,r),i.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`link preview image generation failed: `,null}}))).apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e){try{const t=yield g.loadImage(e),n=document.createElement("canvas"),r=n.getContext("2d");return n.height=t.height,n.width=t.width,r.drawImage(t,0,0),n.toDataURL("image/jpeg").replace(/^data:image\/jpeg;base64,/,"")}catch(e){return __LOG__(2)`data URL conversion failed: `,null}}))).apply(this,arguments)}function L(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e,t){try{const n=yield e.arrayBuffer(),r=(0,c.addWebpMetadata)(n,t),i=new Uint8Array(r);return new Blob([i],{type:"image/webp"})}catch(t){return __LOG__(4,void 0,new Error,!0)`addMetadataToSticker: Unable to add metadata to Sticker`,SEND_LOGS("unable-to-add-sticker-metadata"),e}}))).apply(this,arguments)}function k(){return(k=(0,a.default)((function*(e){try{const t=window.URL.createObjectURL(e),n=yield g.loadImage(t);window.URL.revokeObjectURL(t);const r=m.STICKER_DIMENSION,i=(0,u.createCanvas)(r,r),a=i.getContext("2d"),{width:o,height:s}=(0,p.aspectRatioScaled)(n.width/n.height,r);a.drawImage(n,(r-o)/2,(r-s)/2,o,s);const l=yield(0,u.canvasToWebp)(i);return yield L(l,{isFirstParty:!1,isFromStickerMaker:!0,emojis:[],stickerPackPublisher:"WhatsApp Sticker Maker"})}catch(e){throw __LOG__(2)`Webp sticker file generation failed: `,e}}))).apply(this,arguments)}function U(){return(U=(0,a.default)((function*(e){try{const t=yield g.loadImage(e),n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;const r=n.getContext("2d");return(0,u.fillBackgroundWithGray)(n),r.drawImage(t,0,0),(0,u.canvasToBlob)(n)}catch(t){throw new f.MediaDragDropError("unable to render image",e)}}))).apply(this,arguments)}function G(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=r?"image/png":"image/jpeg";!e.blob&&n&A&&(e.blob=(0,u.canvasToBlob)(t,i)),!e.dataUrl&&n&C&&(e.dataUrl=Promise.resolve(t.toDataURL(i))),!e.canvas&&n&b&&(e.canvas=Promise.resolve(t))}function x(){return(x=(0,a.default)((function*(e){const t=yield g.loadImage(e),n=(0,u.createCanvas)(t.width,t.height);return n.getContext("2d").drawImage(t,0,0),n}))).apply(this,arguments)}},628195:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926));t.default=class{constructor(e){let{name:t,handler:n=null,interval:r=3600,restingInterval:i=18e3,sleepWhileResting:a=!1,randomIntervalExtension:o=0}=e;if(this._running=!1,this._slowDown=!1,this._name=t,this._interval=1e3*r,this._restingInterval=1e3*i,this._sleepWhileResting=a,this._randomIntervalExtension=1e3*o,this._rest(),"function"==typeof n)this.poll(n);else if(null!=n)throw new Error("Poll handler must be a function or null")}_getRandomExtension(){return Math.ceil(Math.random()*this._randomIntervalExtension)}_getInterval(){return(this._slowDown?this._restingInterval:this._interval)+this._getRandomExtension()}_rest(){document.addEventListener("visibilitychange",(()=>{this._lock||(document.hidden?this._sleepWhileResting?(__LOG__(2)`LazyPoll[${this._name}]: Inactive paused`,this._pause()):(__LOG__(2)`LazyPoll[${this._name}]: Inactive slowing down`,this._slowDown=!0):this._callback&&(__LOG__(2)`LazyPoll[${this._name}]: Active Resuming`,this._resume()))}),!1)}_isDue(){if(!this._lastPoll)return!0;return Date.now()-this._lastPoll>=this._getInterval()}_pause(){clearTimeout(this._timer),this._running=!1}_resume(){this._slowDown=!1,this._running=!0,this._cycle()}_cycle(){var e=this;return(0,i.default)((function*(){e._running&&(e._isDue()&&(__LOG__(2)`LazyPoll[${e._name}]: Polling...`,yield e._callback(),e._lastPoll=Date.now()),clearTimeout(e._timer),e._timer=setTimeout((()=>e._cycle()),e._getInterval()))}))()}poll(e){null==this._callback?(this._callback=e,this._running=!0,this._cycle()):this.resume()}pause(){__LOG__(2)`LazyPoll[${this._name}]: Manually Paused`,this._lock=!0,this._pause()}resume(){__LOG__(2)`LazyPoll[${this._name}]: Manually Resumed`,this._lock=!1,this._resume()}}},386374:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SERVER_REQUESTED=void 0,t.sendLogs=function(){return B.apply(this,arguments)},t.upload=R,t.uploadUserReport=function(){return U.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=r(n(823493)),s=n(88555),l=n(781572),c=n(520289),u=n(257977),d=n(53658),p=n(739948),f=n(881155),_=r(n(376139)),h=n(555452),g=n(978820),m=r(n(511854)),y=r(n(652991)),S=r(n(11339)),E=n(789618),v=n(317239);const T=e=>new Promise((t=>setTimeout(t,e))),C=n(76672)({CRASHLOG:"crashlog",SUPPORT:"support"}),A=n(76672)({ONLY_EXCEPTION:"only_exception"}),b={shouldHitCheckEndpoint:()=>!1,expectedCodes:[],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},P={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:()=>{},appendToFormDataForUpload:()=>{},shouldUseLightWeightLogs:()=>!1},O={shouldHitCheckEndpoint:()=>!0,expectedCodes:[200,403],appendToFormDataForCheck:e=>{e.append("support_exception_only_upload","true")},appendToFormDataForUpload:(e,t)=>{t&&t.upload===A.ONLY_EXCEPTION&&e.append("exception_only_upload","true")},shouldUseLightWeightLogs:e=>!!e&&e.upload===A.ONLY_EXCEPTION};function M(e,t,n){return n?b:t?O:P}const I="server-requested";t.SERVER_REQUESTED=I;const w=(0,o.default)(L,36e5);function R(){return N.apply(this,arguments)}function N(){return(N=(0,a.default)((function*(e){let{reason:t,immediate:n=!1,force:r=!1,persist:i=!1,isHighPri:a=!1,nativeCrash:o,voipLog:d,skipSampling:p=!1,hasTaggedMessage:_=!1,ticketId:h}=e;if(y.default.isLogoutInProgress)return Promise.resolve();let g=i?C.SUPPORT:C.CRASHLOG;l.Cmd.logSocketSummary(),__LOG__(2)`Focus at time of upload:`;try{E.UIM.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}__LOG__(2)`==================================================`,__LOG__(2)`wa:uploadLogs ref: ${v.Conn.ref||"no conn"}`,__LOG__(2)`wa:uploadLogs hash: ${"6f9c59fd5a82061eb02d756ae3f060d6c428b61e"}`,__LOG__(2)`wa:uploadLogs version: ${"2.2228.14"}`,__LOG__(2)`wa:uploadLogs userAgent: ${navigator.userAgent}`,__LOG__(2)`wa:uploadLogs platform: ${v.Conn.platform||"no platform"}`,__LOG__(2)`wa:uploadLogs webPlatform: ${"web"}`,__LOG__(2)`wa:uploadLogs appId: ${""}`,__LOG__(2)`wa:uploadLogs url: ${location.href}`,__LOG__(2)`wa:uploadLogs distribution: ${(0,u.getDistribution)()}`,__LOG__(2)`wa:uploadLogs buildId: ${"387902353"}`,__LOG__(2)`wa:uploadLogs mdOptIn: ${(0,s.isMDBackend)()}`,_&&__LOG__(2)`wa:uploadLogs hasTaggedMessage`;let m=null;if(void 0===t)g=C.SUPPORT,__LOG__(2)`reason for logs: manual-upload`,m=!0;else if(t){let e=t;(0,s.isMDBackend)()&&(e=`[MD] ${t}`),__LOG__(2)`reason for logs: ${e}`}__LOG__(2)`${f.END_OF_UPLOAD}`;try{const e=new S.default.CrashLog;e.crashReason=null!=t?t:"manual-upload",e.commit()}catch(e){__LOG__(2)`wa:uploadLogs error logging wam event: ${e}`}let T=L;if(!m&&!r){if(!(Math.random()<c.UPLOAD_TO_CLB))return void __LOG__(2)`wa:uploadLogs squelched logs`;T=w}const A=M(0,_,t===I);try{return yield T({isHighPri:a,immediate:n,logType:g,nativeCrash:o,voipLog:d,skipSampling:p,ticketId:h,getFullLogs:t===I,uploadStrategy:A})}catch(e){__LOG__(2)`wa:uploadLogs error uploading: ${e}`}}))).apply(this,arguments)}function L(){return D.apply(this,arguments)}function D(){return(D=(0,a.default)((function*(e){let t,{isHighPri:n,immediate:r,logType:i,nativeCrash:a,voipLog:o,skipSampling:s=!1,ticketId:l,getFullLogs:u=!1,uploadStrategy:d}=e;if(yield T(r?0:500),d.shouldHitCheckEndpoint()){const e=k({isHighPri:n});if(d.appendToFormDataForCheck(e),t=yield m.default.post(G(i),e),!d.expectedCodes.includes(t.status))throw new Error(`Status code of ${t.status} from ${c.CLB_CHECK_URL} was unexpected, expected values are: ${d.expectedCodes.toString()}`);if(403===t.status)throw new Error("Aborting Crashlog upload due to 403 response")}else __LOG__(2)`Crashlog:doUpload skipping sampling check`;let f=null;if(t)try{f=JSON.parse(t.responseText)}catch(e){__LOG__(2)`Crashlog:failed to parse response from upload check ${String(e)}, will perform default upload`}const _=k({isHighPri:n});d.appendToFormDataForUpload(_,f);const h=(yield p.Logger.getLogs(u,d.shouldUseLightWeightLogs(f))).join("\n"),g=new Blob([h],{type:"text/plain"});_.append("file",g,"logs.txt"),l&&_.append("ticket_id",l),a&&(_.append("attachment",new Blob([a.contents],{type:"application/octet-stream"}),a.filename),_.set("agent",a.agent),_.append("tags","electron_native"),o&&_.append("voip_log",new Blob([o.contents],{type:"text/plain"}),o.filename));const y=x(i),S=yield m.default.post(y,_);if(200!==S.status)throw new Error(`Status code of ${S.status} from ${y} was unexpected, expected 200`);return S.getResponseHeader("X-Uploaded-File-Id")}))).apply(this,arguments)}function k(e){let{isHighPri:t}=e;const r=new FormData;t&&r.append("forced","true");const i=(0,g.getMe)();i&&r.append("from_jid",i.toString());const a=n(379264).default.info(),o=(0,u.getLogUserAgent)({device:a.os,browser:a.ua,appVersion:"2.2228.14"});return r.append("agent",o),r.append("app_id",""),r.append("build_id","387902353"),(0,s.isMDBackend)()&&r.append("md_opt_in","true"),r}function U(){return(U=(0,a.default)((function*(e,t,n,r,a,o){try{__LOG__(2)`Crashlog:uploadUserReport uploading`,__LOG__(2,!0)`Crashlog:uploadUserReport description: ${r}`;const s=yield R({reason:"user-report",immediate:!0,force:!0,persist:!0}),l=(0,h.getLoginTokens)().server,u=new FormData;l&&u.append("tok",l),null!=e&&u.append("user",String(e)),u.append("email",t),s&&u.append("crashlog",s),u.append("desc",r),a.map(((e,t)=>{u.append(`screenshot-${t}`,e)}));const p=(0,d.getDebugInfo)({supportTag:o}),f=(0,i.default)((0,i.default)({},p),{},{subject:n});u.append("info",JSON.stringify(f)),__LOG__(2)`Crashlog:uploadUserReport submitting`,yield m.default.post(c.TICKET_URL,u),__LOG__(2)`Crashlog:uploadUserReport succeeded`}catch(e){__LOG__(2)`Crashlog:uploadUserReport failed ${String(e)}`}}))).apply(this,arguments)}function G(e){return _.default.build(c.CLB_CHECK_URL,{type:String(e),access_token:c.CLB_TOKEN})}function x(e){return _.default.build(c.CLB_URL,{type:String(e),access_token:c.CLB_TOKEN})}function B(){return(B=(0,a.default)((function*(e){yield R({reason:e,hasTaggedMessage:!0})}))).apply(this,arguments)}},53658:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getDebugInfo=function(e){u.Wam.initialize();const t=(0,i.default)((0,i.default)({},c.default.Global.all),{},{webcWebPlatform:"web",webcPhonePlatform:l.Conn.platform,webcProtoVersion:String(l.Conn.protoVersion)}),n=(0,s.getMe)();n&&(t.deviceID=n.toString());const r={};for(const e in t){const n=t[e];null!=n&&(r[e]=n)}const p=(0,a.isMDBackend)();if(r.mdEnabled=p,r.hasMdCompanion=p,e){const{supportTag:t,addUserAgentDetails:n,convertFields:i}=e;if(null!=t&&(r.context=t),!0===n&&(r.userAgent=o.UA.parser.getUA()),!0===i){return function(e){const t={};for(const[r,i]of Object.entries(e)){var n;t[null!==(n=d.get(r))&&void 0!==n?n:r]=i}return t}(r)}}return r};var i=r(n(81109)),a=n(88555),o=n(26741),s=n(978820),l=n(317239),c=r(n(11339)),u=n(977959);const d=new Map([["appIsBetaRelease","is-beta"],["appVersion","version"],["browserVersion","browser-version"],["deviceName","os"],["mcc","phone-mcc"],["mnc","phone-mnc"],["webc_bucket","exp-bucket"],["webcPhoneAppVersion","phone-app-version"],["webcPhoneCharging","is-phone-charging"],["webcPhoneDeviceManufacturer","phone-manufacturer"],["webcPhoneDeviceModel","phone-model"],["webcPhoneOsVersion","phone-os-version"],["webcPhonePlatform","phone-os"],["webcWebPlatform","platform"],["webcProtoVersion","protocol-version"],["deviceID","device-id"],["webcWebArch","device-arch"],["webcWebDeviceManufacturer","device-manufacturer"],["webcWebDeviceModel","device-model"],["webcWebOsReleaseNumber","device-release"],["deviceVersion","os-version"],["userAgent","user-agent"],["mdEnabled","md-enabled"],["hasMdCompanion","has-md-companion"]])},679405:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:String,a=(0,i.default)(e,t.map(r)).join("");const o=n?4e3:Number.POSITIVE_INFINITY;a.length>o&&(a=a.slice(0,o).replace(/\s+$/," [truncated]"));return a};var i=r(n(530138))},739948:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0,t.cycleThroughLogLines=v,t.log=void 0;var i=r(n(348926)),a=r(n(435161)),o=r(n(570185)),s=n(657319),l=n(520289),c=r(n(679405)),u=n(881155),d=n(481806),p=r(n(745234)),f=n(546718),_=r(n(730381));const h=Date.now(),g="LTSXOo+_*-=.<^!#?".split("");function m(){return g[Math.round(Math.random()*(g.length-1))]}const y=m()+m()+m()+m(),S={};S[S.ALL=0]="all",S[S.INFO=1]="info",S[S.LOG=2]="log",S[S.WARN=3]="warn",S[S.ERROR=4]="error",S[S.OFF=5]="off";function E(e){switch(e){case S.INFO:case S.LOG:case S.WARN:case S.ERROR:return S[e];default:throw new Error(`Unexpected numeric log level: ${e}`)}}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n,r){yield C(e,t+1,n,r),yield C(0,e,n,r)}))).apply(this,arguments)}function C(){return A.apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e,t,n,r){for(let i=e;i<t;i+=n){const e=Math.min(i+n,t);yield r(i,e)}}))).apply(this,arguments)}const b=new class{constructor(){var e=this;this.logs=[],this.localCursor=0,this.pending=void 0,this.timer=new s.ShiftTimer((()=>this._persistIdb())),this.isTakeOver=!1,this.log=(0,o.default)((function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return function(o){for(var s=arguments.length,l=new Array(s>1?s-1:0),u=1;u<s;u++)l[u-1]=arguments[u];const d=(0,c.default)(o,l,!n);return e.logImpl(t,d,r,i,a),d}}),((e,t,n,r,i)=>n||i?null:String(e)+String(Boolean(t))+String(Boolean(r))))}logImpl(e,t,n,r,i){const a=(0,_.default)().locale("en").format("YYYY-MM-DD HH:mm:ss.SSS:"),o=n?`\n${(0,d.normalizeStack)(n,!0)}`:"",s=[E(e),r?"sendlogs":null,...null!=i?i:[]].filter(Boolean).map((e=>`[${e}]`)).join(""),c=`${y} ${a}`+(s?`${s} `:"")+t+o;this.logs.push(c),this.isTakeOver||(this.logs.length>l.LOG_SIZE&&(this.logs.shift(),this.localCursor--),this.timer.debounceAndCap(250,1e3))}logUncaughtError(e,t){const n=e instanceof Error&&e.stack?e:void 0;let r;if(r=n?String(e):t?`unhandled-rejection: ${String(e)}`:`Error: ${String(e)}`,this.logImpl(S.ERROR,r,n,!0,["uncaught"]),null!=t){const e=String(t);this.logImpl(S.WARN,e)}return r}onTakeOver(){this.isTakeOver=!0}getLogs(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=n(111554).default,s=[];return this.pending&&s.push(this.pending),this.timer.isScheduled()&&(this.timer.forceRunNow(),this.pending&&s.push(this.pending)),Promise.all(s).then((()=>o.idb())).then(function(){var n=(0,i.default)((function*(n){return(0,u.getTimeboxedAndTrimmedLogs)(n,t?0:e._createTimeStamp()-6048e5,r)}));return function(){return n.apply(this,arguments)}}()).then((e=>(0,a.default)(e,"log"))).catch((()=>this.logs))}_clearLogsInBatches(){var e=this;return(0,i.default)((function*(){const t=n(111554).default,{asyncSleep:r}=n(352613),a=yield t.idb(),o=yield a.logs.toCollection().last();if(null==o)return;const s=o.line,l=e._getCursor(),c=function(){var e=(0,i.default)((function*(e,t){try{yield a.transaction("rw",a.logs,(0,i.default)((function*(){const n=yield a.logs.where("line").between(e,t).primaryKeys();yield a.logs.bulkDelete(n)})))}catch(e){__LOG__(2)`_clearLogsInBatches: error while deleting, ${e.stack}`}yield r(0)}));return function(){return e.apply(this,arguments)}}();yield v(l,s,1e3,c)}))()}_clearLogsInDB(){return(0,i.default)((function*(){const e=n(111554).default;yield e.idb().then((e=>e.logs.clear())).catch((()=>{}))}))()}clearLogs(){var e=this;return(0,i.default)((function*(){yield e._clearLogsInDB(),e._setCursor(0),e.localCursor=0,e.logs=[]}))()}clearLogsPreemptive(){var e=this;return(0,i.default)((function*(){{const{getShouldPreemptivelyCleanupLogs:t,setShouldPreemptivelyCleanupLogs:r}=n(555452);t()&&(yield e._clearLogsInDB(),r(!1))}}))()}_optimisticallyAdvanceCursor(e,t){this.localCursor+=t,this._setCursor((e+t)%l.LOG_SIZE)}_persistIdb(){const e=n(111554).default,t=this.logs.slice(Math.max(this.localCursor,0),this.logs.length);t.length&&(this.pending=e.idb().then((e=>e.transaction("rw",e.logs,e.user,(()=>{let n=this._getCursor();this._optimisticallyAdvanceCursor(n,t.length),t.forEach((t=>{n=(n+1)%l.LOG_SIZE,e.logs.put({line:n,log:t,timestamp:this._createTimeStamp()})}))})))).catch((()=>{})).finally((()=>{this.pending=void 0})))}_createTimeStamp(){return performance&&performance.now()+h||Date.now()}_getCursor(){try{return JSON.parse(p.default.getItem(f.KEYS.LOG_CURSOR))||Math.max(this.localCursor,0)}catch(e){return Math.max(this.localCursor,0)}}_setCursor(e){return p.default.setItem(f.KEYS.LOG_CURSOR,String(e))}};t.Logger=b;const P=b.log;t.log=P},881155:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TRIM_LENGTH=t.END_OF_UPLOAD=void 0,t.getTimeboxedAndTrimmedLogs=function(){return o.apply(this,arguments)};var i=r(n(348926));const a="==================================================EOU";t.END_OF_UPLOAD=a;function o(){return(o=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=[];if(n){const n=yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).reverse().until((e=>e.log.includes("[sendlogs]")),!0).toArray();for(let e=n.length-1;e>=0&&(s(n[e],r),!n[e].log.includes(a));e--);}else yield e.logs.orderBy("timestamp").filter((e=>e.timestamp>=t)).each((e=>{s(e,r)}));return r}))).apply(this,arguments)}function s(e,t){e.log=e.log.slice(0,2500),t.push(e)}t.TRIM_LENGTH=2500},257977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDistribution=function(){let e="unknown";return e="prod","web_prod"},t.getLogUserAgent=function(e){let t,{appVersion:n,browser:r,device:i}=e;return t="Web/"+r,`WhatsApp/${n} ${t} Device/${i}`}},748011:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.enrich=function(e,t){let n;switch((0,s.previewType)(t)){case"pdf":n=l(e);break;case"msoffice":n=function(){return c.apply(this,arguments)}(e);break;default:n=Promise.resolve()}return(0,a.promiseTimeout)(n,3e3,"Document enrichment timeout").catch((()=>null))},t.enrichPdf=l;var i=r(n(348926)),a=n(638284),o=r(n(691990)),s=n(843257);function l(e){let t;return o.default.fileToPdf(e).then((e=>(t=e,o.default.pdfToImg(e,1)))).catch((()=>(__LOG__(2)`pdf preview generation failed`,null))).finally((()=>{t&&o.default.releasePdf(t)}))}function c(){return(c=(0,i.default)((function*(e){if("win32"===process.platform)try{yield}catch(e){__LOG__(2)`document preview generation failed`}}))).apply(this,arguments)}},565885:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.FILETYPE=void 0,t.blobToArrayBuffer=c,t.blobToText=function(){return p.apply(this,arguments)},t.createFile=function(e,t,n){const r=new Blob(e,n||{});return r.name=t,r},t.getAudioDuration=function(e){let t,n;return new Promise(((r,i)=>{t=document.createElement("audio"),t.addEventListener("loadeddata",r),t.addEventListener("error",(()=>{i(new Error("getAudioDuration: error loading audio"))})),t.src=n=URL.createObjectURL(e)})).then((()=>~~t.seekable.end(0))).finally((()=>{n&&URL.revokeObjectURL(n)}))},t.getFileExtension=d,t.getMimeTypeForFilepath=function(e){const t=d(e),n=(0,o.isAllowedDocumentMimetype)(o.EXT_TO_MIME&&t&&o.EXT_TO_MIME[t],e,!1);if(n)return n},t.removeTrailingDots=u,t.typeFromMimetype=function(e){const t=e.split("/")[0];switch(t){case s.IMAGE:case s.VIDEO:case s.AUDIO:return t;default:return s.DOCUMENT}},t.validateBlob=function(e){return c(e.webkitSlice?e.webkitSlice(0,1):e.slice(0,1)).then((e=>1===e.byteLength)).catch((()=>!1))};var i=r(n(348926)),a=n(435232),o=n(843257);const s=Object.freeze({IMAGE:"image",VIDEO:"video",AUDIO:"audio",DOCUMENT:"document",STICKER:"sticker"});t.FILETYPE=s;const l=e=>{var t;return null!==(t=null==e?void 0:e.message)&&void 0!==t?t:""};function c(e){let t;return new Promise(((n,r)=>{t=new FileReader,t.onload=n,t.onerror=()=>{var e;r("NotReadableError"===(null===(e=t.error)||void 0===e?void 0:e.name)?new a.FileNotReadableError(`blobToArrayBuffer error: ${l(t.error)}`):new Error(`blobToArrayBuffer error: ${l(t.error)}`))},t.onabort=()=>{r(new Error(`blobToArrayBuffer abort: ${l(t.error)}`))},t.readAsArrayBuffer(e)})).then((()=>t.result))}function u(e){return e.replace(/\.+$/,"")}function d(e){const t=u(e.trimRight()).split(".");return t.length>1?t[t.length-1].toLowerCase():null}function p(){return(p=(0,i.default)((function*(e){if("function"==typeof e.text)return e.text();const t=new FileReader;if(yield new Promise(((n,r)=>{t.onload=n,t.onerror=e=>{r(new Error(`blobToText error: ${String(e)}`))},t.onabort=e=>{r(new Error(`blobToText abort: ${String(e)}`))},t.readAsText(e)})),t.result instanceof ArrayBuffer)throw new TypeError("blobToText error: Invalid result type: ArrayBuffer");if(null==t.result)throw new TypeError("blobToText: Invalid result type: null");return t.result}))).apply(this,arguments)}},248174:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setupLodashMemoizeCache=function(){i.default.Cache=a.MemoizeCache};var i=r(n(288306)),a=n(135174)},379264:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=n(615688),o=n(40234),s=n(26741);let l=!1;const c=(0,i.default)((()=>l=!1),500);function u(){const e=new Uint8Array(16);return self.crypto.getRandomValues(e),(0,a.encodeB64)(e)}var d={id(){const e=n(555452);let t=e.getBrowserId();return t||(t=u(),e.setBrowserId(t),t)},persistentExpiringId(){const e=n(555452);let t=e.getPersistentExpiringId();if(null!=t){if(!(o.Clock.globalUnixTime()-t.ts>=7776e3))return t.value}return t=u(),e.setPersistentExpiringId({ts:o.Clock.globalUnixTime(),value:t}),t},info(){const e=s.UA.parser.getResult();return{os:e.os.name,version:e.os.version,name:e.browser.name,ua:e.browser.name+" "+e.browser.version}},hardRefresh(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.promptUnloadGuards++,e){n(555452).setNoTakeover(!0)}location.reload(t)},startDownloading(){l=!0,c()},clearDownloading(){l=!1},isDownloading:()=>l,promptUnloadGuards:0,open(e){window.open(e,"_blank","noopener,noreferrer")}};t.default=d},691990:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(180284),o=n(413959),s=n(904352),l=n(367602),c=n(585582),u=r(n(364369)),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(551428)),p=r(n(534949)),f=n(964551),_=r(n(44053));function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}t.default=class{static fileToPdf(e){const t=URL.createObjectURL(e);return(0,s.promiseLoop)((function(e,t,r){const i=(0,o.delayMs)((0,a.expBackoff)(r,12e4,0,0));return n.e(2974).then(n.t.bind(n,299299,23)).then((t=>{t.GlobalWorkerOptions.workerSrc=_.default,e(t.default)})).catch((()=>i))})).then((e=>e.getDocument(t).promise))}static releasePdf(e){return e.destroy()}static pdfToImg(e,t){const n=document.createElement("canvas");return e.getPage(t).then((e=>{const t=e.getViewport({scale:1}),r=n.getContext("2d");return n.height=t.height,n.width=t.width,e.render({canvasContext:r,viewport:t}).promise})).then((()=>(0,l.promiseProps)({blob:(0,c.canvasToBlob)(n),thumbnail:d.rotateAndResize(n,u.default.DOC_THUMB_MAX_EDGE,d.DATA_URL|d.CANVAS|d.BLOB),microThumbnail:f.ServerProps.webUploadDocumentThumbMmsEnabled?(0,c.generateMicroThumb)(n,1300,{mimetype:"image/jpeg",maxAttempts:10}):Promise.resolve(null)}))).then((e=>e)).then(function(){var t=(0,i.default)((function*(t){let{blob:n,thumbnail:r,microThumbnail:i}=t;return{url:URL.createObjectURL(n),thumbUrl:r.images.dataUrl,width:r.images.canvas.width,height:r.images.canvas.height,fullPreviewData:yield p.default.createFromData(r.images.blob,"image/jpeg"),fullPreviewSize:{width:r.images.canvas.width,height:r.images.canvas.height},pdfPages:e.numPages,microThumbnail:i}}));return function(){return t.apply(this,arguments)}}())}}},769315:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.phashV1=function(){return l.apply(this,arguments)},t.phashV2=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(615688),o=n(273045),s=n(745454);function l(){return(l=(0,i.default)((function*(e){const t=e.map((e=>(0,s.toUserWid)(e).toString({legacy:!0}))).sort().join(""),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));const r=new Uint8Array(n),i=yield self.crypto.subtle.digest({name:"SHA-1"},r);return`1:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(e){const t=e.map((e=>e.toString({legacy:!0,formatFull:!0}))).sort().join(""),n=[];for(let e=0;e<t.length;e++)n.push(t.charCodeAt(e));const r=new Uint8Array(n),i=yield(0,o.sha256)(r);return`2:${(0,a.encodeB64)(i.slice(0,6))}`}))).apply(this,arguments)}},893778:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Field=void 0,t.getNameString=M,t.getNameStringFromNames=I,t.mergeVcards=function(e){if(0===e.length)throw new Error("No vcards provided");return 1===e.length?e[0]:{displayName:M(e),vcard:e.map((e=>e.vcard)).join("\n"),isMultiVcard:!0}},t.parseMultiVcard=function(e){const t=e.match(/BEGIN:VCARD([\s\S]*?)END:VCARD/g);return t?t.map((e=>P(e))).filter(Boolean):[]},t.parseVcard=P,t.vcardFromContactModel=function(e){var t;const n=b((0,p.getMaybeMeUser)()?e.displayName:e.formattedName),r=["BEGIN:VCARD","VERSION:3.0",`N:${O(e)}`,`FN:${n}`,`TEL;type=CELL;waid=${String(e.userid)}:${(0,_.widToFormattedUser)(e.userid)}`,e.isBusiness?`X-WA-BIZ-NAME:${n}`:null,(null===(t=e.businessProfile)||void 0===t?void 0:t.description)?`X-WA-BIZ-DESCRIPTION:${b(e.businessProfile.description)}`:null,"END:VCARD"].filter(Boolean);return{displayName:n,vcard:r.join("\n"),isMultiVcard:!1}},t.vcardGetDate=function(e){let t=e;return(0,s.default)([/-([^-]*)-([^-]*)-([^-]*)/,/([^-]*)-([^-]*)-([^-]*)/],(n=>{const r=e.match(n);if(r){const e=!r[1].length||"1604"===r[1],n=e?"0000":r[1];return t=(0,m.default)(`${n}-${r[2]}-${r[3]}`).format("l"),e&&(t=t.replace(/[.,-\/\s]*0000[.,-\/\s]*/,"")),!1}})),t},t.vcardGetName=O,t.vcardGetNameFromParsed=function(e){let t=null;const{FN:n,NICKNAME:r,TEL:i}=e;if(null==n?void 0:n[0])t=n[0].value;else if(null==r?void 0:r[0])t=r[0].value;else if(null==i?void 0:i[0]){var a;const e=i[0],n=null===(a=e.properties.waid)||void 0===a?void 0:a[0];t=n?(0,_.widToFormattedUser)(n):e.value}return t},t.vcardGetOrganizationString=function(e){var t,n;const r=null===(t=e.ORG)||void 0===t?void 0:t[0],i=null===(n=e.TITLE)||void 0===n?void 0:n[0];if(r&&Array.isArray(r.value)&&r.value.length>0){var a;let e=null;(null==i?void 0:i.value)&&(e=`${i.value}`.trim());const[t,...n]=r.value;n.push(t);const o=n.map((e=>(0,u.isString)(e)?e.trim():"")).filter((e=>e.length)).join(h.default.t(257));return(e||"")+((null===(a=e)||void 0===a?void 0:a.length)&&o.length?" - ":"")+o}return""},t.vcardGetType=function(e){const t={jabber:g.fbt._("Jabber",null,{hk:"3usmYV"}),"skype-username":g.fbt._("Skype",null,{hk:"1eW8ty"}),skype:g.fbt._("Skype",null,{hk:"1eW8ty"}),msn:g.fbt._("Windows Live",null,{hk:"Cb3b1"}),aim:g.fbt._("AIM",null,{hk:"1dlOP"}),yahoo:g.fbt._("Yahoo",null,{hk:"1VtQI7"}),icq:g.fbt._("ICQ",null,{hk:"M7uX3"}),"wa-biz-description":g.fbt._("Description",null,{hk:"3NFP7B"}),[v]:g.fbt._("Business Name",null,{hk:"MfcFj"})};let n=e.properties["X-ABLabel"]||t[e.type.toLowerCase()];if(null!=n&&""!==n)return function(e){if(!e)return;return e.replace(/^_\$!<([^>]*)>!\$_$/,"$1").replace(/\\,/,",").replace(/\\;/,";").replace(/\\\\/,"\\")}(String(n));const r={TEL:[[["cell"],g.fbt._("Mobile",null,{hk:"1ciHPV"})],[["iphone"],g.fbt._("iPhone",null,{hk:"2MkuaG"})],[["main"],g.fbt._("Main",null,{hk:"46Vh7G"})],[["home","fax"],g.fbt._("Home Fax",null,{hk:"34IobZ"})],[["work","fax"],g.fbt._("Work Fax",null,{hk:"4FNmsW"})],[["home"],g.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],g.fbt._("Work",null,{hk:"3QfW2u"})],[["pager"],g.fbt._("Pager",null,{hk:"20r5VT"})],[[],g.fbt._("Home",null,{hk:"2zkVn1"})]],EMAIL:[[["home"],g.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],g.fbt._("Work",null,{hk:"3QfW2u"})],[["internet"],g.fbt._("Email",null,{hk:"2Vzd0N"})]],URL:[[["home"],g.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],g.fbt._("Work",null,{hk:"3QfW2u"})]],ADR:[[["home"],g.fbt._("Home",null,{hk:"2zkVn1"})],[["work"],g.fbt._("Work",null,{hk:"3QfW2u"})]]};return n=e.type,(0,c.default)(r,(t=>{if(t){const[r,i]=t;if(0===(0,o.default)(r,(0,a.default)(e.properties.type,(e=>e.toLowerCase()))).length)return n=i,!1}})),n},t.vcardIsBiz=function(e){return(e.SERVICE||[]).some((e=>e.type.toLowerCase()===v&&e.value))},t.vcardSerialize=function(e){return e.map((function(e){return e.line.replace(/(.{75,75})/g,"$1\n ").replace(/\n^-$/gm,"")})).join("\n")},t.vcardThumbnail=function(e){if(!e)return;const{PHOTO:t}=e;if((null==t?void 0:t[0])&&d.default.isData(t[0].value))return t[0].value},t.vcardWids=function(e){let t=[];(null==e?void 0:e.TEL)&&e.TEL.forEach((e=>{var n,r,i;(null!==(n=null===(r=e.properties)||void 0===r||null===(i=r.waid)||void 0===i?void 0:i.length)&&void 0!==n?n:0)>0&&(t=t.concat((0,a.default)(e.properties.waid,f.createUserWid)))}));return t};var i=r(n(763105)),a=r(n(435161)),o=r(n(291966)),s=r(n(784486)),l=r(n(189734)),c=r(n(402525)),u=n(551737),d=r(n(376139)),p=n(978820),f=n(745454),_=n(562054),h=r(n(914296)),g=n(548360),m=r(n(730381));const y=/X-([^;:]+)(?:;[^:]+)*:(.+)/,S={"X-ABLabel":[/X-ABLabel(?:;([^:]+))*:(.+)/,1],ADR:[/ADR(?:;([^:]+))*:;;(.*);(.*);(.*);(.*);(.*)/,5],"X-ABADR":[/X-ABADR(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.*)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1],TEL:[/TEL(?:;([^:]+))*:(.+)/,1]},E={N:[/N(?:;([^:]+))*:([^;]*);([^;]*);([^;]*);([^;]*);(.*)/,5],FN:[/FN(?:;([^:]+))*:(.*)/,1],NICKNAME:[/NICKNAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-FIRST-NAME":[/X-PHONETIC-FIRST-NAME(?:;([^:]+))*:(.*)/,1],"X-PHONETIC-LAST-NAME":[/X-PHONETIC-LAST-NAME(?:;([^:]+))*:(.*)/,1],ORG:[/ORG(?:;([^:]+))*:([^;]*)(?:;(.*))*/,2],TITLE:[/TITLE(?:;([^:]+))*:(.*)/,1],TEL:[/TEL(?:;([^:]+))*:(.*)/,1],PHOTO:[/PHOTO(?:;([^:]+))*:(.*)/,1],BDAY:[/BDAY(?:;([^:]+))*:(.*)/,1],URL:[/URL(?:;([^:]+))*:(.+)/,1],EMAIL:[/EMAIL(?:;([^:]+))*:(.+)/,1]},v="wa-biz-name";class T{constructor(e,t,n,r){this.type=e,this.index=t,this.properties=n||{},this.value=r}}function C(e,t,n){e[t]||(e[t]=[]),e[t].push(n)}function A(e){const t={};return e?(e.split(";").forEach((e=>{const n=e.split(/=/);if(1===n.length){const e=n[0];C(t,e.toLowerCase(),!0)}else if(2===n.length){const[e,r]=n;C(t,e.toLowerCase(),r.toLowerCase())}})),t):t}function b(e){return e?e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,"):""}function P(e){const t=e.replace(/\r?\n|\r/g,"\n").replace(/\n^[ \t]/gm,"").split("\n").filter((e=>0!==e.trim().length)),n={},r={};if(t.length<3)return;const i=t[0].trim().toUpperCase(),a=t[1].trim().toUpperCase(),o=t[t.length-1].trim().toUpperCase(),s="VERSION:2.1"===a||"VERSION:3.0"===a||"VERSION:4.0"===a;if("BEGIN:VCARD"!==i||!s||"END:VCARD"!==o)return __LOG__(4,void 0,new Error,!0)`vcard:parse failed because the vCard is not formatted as expected:
Header as expected? ${String("BEGIN:VCARD"===i)}
Version as expected? ${String(s)}
Footer as expected? ${String("END:VCARD"===o)}
Lines: ${t.length}`,void SEND_LOGS("vcard-fault");for(let e=2;e<t.length-1;e++){var d;const i=t[e],a=i.match(/item(\d+)\.(.*)/),o=a?a[2]:i,s=null===(d=o.match(/([^:;]*)[:;].*/))||void 0===d?void 0:d[1];if(null==s)continue;const l=a?S:E;let c,p,f=s,_=s;if(l[f]){const[e,t]=l[f],n=o.match(e);n&&(c=A(n[1]),p=1===t?p=n[2]:n.slice(2,2+t))}else{const e=o.match(y);e&&(_="SERVICE",f=e[1],p=e[2],c={})}if((Array.isArray(p)?p:[p]).some((e=>e&&(0,u.isString)(e)&&e.trim())))if(a){const t=a[1];r[t]?r[t].fields.push(new T(f,null,c,p)):r[t]={type:f,index:e,key:_,properties:c,value:p,fields:[]}}else C(n,_,new T(f,e,c,p))}return Object.keys(r).forEach((e=>{const{key:t,index:i,type:a,value:o,properties:s,fields:l}=r[e];l.forEach((e=>{s[e.type]=e.value})),C(n,t,new T(a,i,s,o))})),function(e){const t={};return(0,c.default)(e,((e,n)=>{t[n]=(0,l.default)(e,(e=>e.index))})),t}(n)}function O(e){const t=(0,i.default)(e.formattedName.split(e.formattedShortName)),n=t.length?t[0].trim():void 0,r=n?e.formattedShortName:e.formattedName;return`${b(n)};${b(r)};;;`}function M(e){return I(e.map((e=>e.displayName)))}function I(e){const t=e.find((e=>!!e));return e.length?t?1===e.length?t:h.default.t(484,{contactName:t,count:e.length-1,_plural:e.length-1}):h.default.t(485,{count:e.length,_plural:e.length}):g.fbt._("No contacts",null,{hk:"1p56oN"})}t.Field=T},318254:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return i.default.request(e,t,n,a,r).then((e=>e.status&&e.status<12e3?e:null)).catch((()=>null))};var i=r(n(511854))},681602:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(901577)),o=n(88555),s=r(n(379264)),l=r(n(318254)),c=n(411290);class u extends c.BaseModel{constructor(){super(...arguments),this.online=(0,c.session)(!0),this.waitIfOffline=(0,a.default)((()=>"all"),(0,i.default)((function*(){this.online||((0,o.isMDBackend)()&&"Firefox"!==s.default.info().name&&navigator.onLine?__LOG__(2)`waitIfOffline: XHR online is false, but navigator.onLine is true, resolving promise`:(__LOG__(2)`waitIfOffline: Waiting...`,yield new Promise((e=>{this.listenToOnce(this,"change:online",(()=>{__LOG__(2)`waitIfOffline: Continuing...`,e()}))}))))}))),this.checkOnline=(0,a.default)((()=>"all"),(0,i.default)((function*(){__LOG__(2)`NetworkStatus:checkOnline checking`;try{const e=yield(0,l.default)("https://web.whatsapp.com/status.json");this.online=!!e,__LOG__(2)`NetworkStatus:checkOnline response ${String(this.online)}`}catch(e){__LOG__(3)`NetworkStatus:checkOnline errored! ${String(e)}`}})))}initialize(){this.listenTo(this,"change:online",this._logOnlineOffline),this._logOnlineOffline()}_logOnlineOffline(){const e=this.online;__LOG__(2)`NetworkStatus ${e?"online":"offline"}`}}var d=new((0,c.defineModel)(u));t.default=d},176562:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEffectiveNetworkType=function(){if(navigator.connection&&"string"==typeof navigator.connection.effectiveType)return navigator.connection.effectiveType;return null}},511854:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(389385),a=r(n(747259)),o=r(n(376139));const s={GET:"GET",POST:"POST",HEAD:"HEAD",PUT:"PUT"};function l(e,t){for(const n in t)e.setRequestHeader(n,t[n])}function c(e,t,n,r,c,u,d){const p=new XMLHttpRequest,f=new Promise(((r,i)=>{if(p.onload=function(e){4===p.readyState?r(p):(__LOG__(4,void 0,new Error)`xhr.request:onload`,i(e))},p.onerror=e=>{__LOG__(4,void 0,new Error)`xhr.request:onerror`,i(e)},p.ontimeout=e=>{__LOG__(4,void 0,new Error)`xhr.request:ontimeout`,i(e)},u&&(p.onprogress=u),p.onabort=e=>{__LOG__(4,void 0,new Error)`xhr.request:onabort`,i(e)},n instanceof FormData)p.open(t||s.POST,e,!0),c&&(p.responseType=c),d&&l(p,d),p.send(n);else if(n instanceof Object){const r=o.default.build(e,n);p.open(t||s.GET,r,!0),c&&(p.responseType=c),d&&l(p,d),p.send()}else p.open(t||s.GET,e,!0),c&&(p.responseType=c),d&&l(p,d),p.send()})),_=(0,a.default)(f,r).cancellable();return _.catch((0,i.catchAbort)((()=>{p.abort()}))).catch((()=>{})),_}var u={head:function(e,t){return c(e,s.HEAD,null,t)},get:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return c(e,s.GET,null,r,t,void 0,n)},post:function(e,t,n){return c(e,s.POST,t,n)},request:c,VERB:s,RESP_TYPE:{ARRAY_BUFFER:"arraybuffer",BLOB:"blob",JSON:"json"}};t.default=u},589135:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.extendedFetch=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _(e,t).catch((e=>{if(e.name===o.ABORT_ERROR)throw new o.AbortError;if(e instanceof l.HttpNetworkError)throw e;throw new l.HttpNetworkError(e.message)}))},t.sharedFetch=_;var i=r(n(348926)),a=r(n(81109)),o=n(389385),s=n(676100),l=n(923082),c=r(n(14322)),u=r(n(991559)),d=n(964551),p=n(725241);const f=n(76672)({UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,r)=>{var o;if(null===(o=t.signal)||void 0===o?void 0:o.aborted)return void r(new p.DOMException("AbortError"));const _=new XMLHttpRequest;if(t.signal){const e=t.signal;e.addEventListener("abort",(function t(){e.removeEventListener("abort",t),_.onreadystatechange=()=>{},_.abort(),r(new p.DOMException("AbortError"))}))}const{onProgress:h,onResponseText:g}=t;var m;(null!=h||g)&&((d.ServerProps.webLargeFilesUi&&"post"===(null===(m=t.method)||void 0===m?void 0:m.toLowerCase())?_.upload:_).onprogress=e=>{g&&g(e,_.responseText),h&&h(e)});const{onHeadersReceived:y}=t;_.onreadystatechange=()=>{if(_.readyState===f.UNSENT)r(new Error("fetch error: not sent"));else if(_.readyState===f.HEADERS_RECEIVED&&null!=y)y(new u.default((0,c.default)(_.getAllResponseHeaders())));else if(_.readyState===f.DONE){if(null==_.status)return void r(new Error("fetch error: no status"));if(0===_.status||_.status>=12e3)return void r(new Error(`fetch error: unexpected status ${_.status}`));n(E())}},_.onerror=()=>r(new Error("fetch error: error")),_.ontimeout=()=>{r(new l.HttpTimedOutError("fetch error: timedout"))},_.withCredentials="include"===t.credentials,null!=t.timeout&&(_.timeout=t.timeout),_.open(t.method||"get",e.toString(),!0);const S=new u.default(t.headers||{});for(const e of S.keys()){const t=S.get(e);null!=t&&_.setRequestHeader(e,t)}function E(){const e=new u.default((0,c.default)(_.getAllResponseHeaders()));return(0,a.default)((0,a.default)({ok:200<=_.status&&_.status<300,statusText:_.statusText,status:_.status,url:_.responseURL},function(){if(g)return{text:()=>Promise.resolve(_.responseText),json:()=>Promise.resolve(JSON.parse(_.responseText)),arrayBuffer:()=>(0,s.largeStringToArrayBuffer)(_.responseText)};return{text:()=>v(),json:(e=(0,i.default)((function*(){const e=yield v();return JSON.parse(e)})),function(){return e.apply(this,arguments)}),arrayBuffer:()=>_.response};var e}()),{},{blob:()=>Promise.resolve(new Blob([_.response],{type:e.get("content-type")||""})),clone:E,headers:e})}function v(){return Promise.resolve(String.fromCharCode(...Array.from(new Uint8Array(_.response))))}g?_.overrideMimeType("text/plain; charset=x-user-defined"):_.responseType="arraybuffer",_.send(t.body||null)}))}},14322:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(e||"").trim().toLowerCase().split("\n").reduce(((e,t)=>{if(!t.trim())return e;const n=t.indexOf(":"),r=t.substr(0,n).trim(),i=t.substr(n+1).trim().replace(/;$/,"");return e[r]?Array.isArray(e[r])?e[r].push(i):e[r]+=`, ${i}`:e[r]=i,e}),{})}},923082:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MmsDownloadFilehashMismatchError=t.HttpTimedOutError=t.HttpStatusCodeError=t.HttpNetworkError=t.HttpInvalidResponseError=void 0;var r=n(640265);class i extends((0,r.customError)("HttpNetworkError")){}t.HttpNetworkError=i;t.HttpTimedOutError=class extends i{constructor(){super(...arguments),this.name="HttpTimedOutError"}};class a extends((0,r.customError)("HttpStatusCodeError")){constructor(e,t,n){super(`${t}: ${e}`),this.status=e}}t.HttpStatusCodeError=a;class o extends((0,r.customError)("HttpInvalidResponseError")){constructor(e,t){super(e)}}t.HttpInvalidResponseError=o;t.MmsDownloadFilehashMismatchError=class extends o{constructor(e){super("mmsDownload: filehash mismatch",e),this.name="MmsDownloadFilehashMismatchError"}}},134842:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e,a)};var i=r(n(114176));const a=e=>null==e},506631:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(589135);const o=()=>{};var s="fetch"in window?fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.sharedFetch)(e,(0,i.default)((0,i.default)({},t),{},{onProgress:o}))};t.default=s},544254:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(26741);["webkitGetUserMedia"].forEach((function(e){const t=Object.getPrototypeOf(navigator)[e];t&&navigator[e]!==t&&(navigator[e]=t)}));var i=function(){var e;if(r.UA.isBrokenGetUserMedia)return null;const t=null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia;if(t)return t.bind(navigator.mediaDevices);const n=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia;return n?function(e){return new Promise((function(t,r){n.call(navigator,e,t,r)}))}:null}();t.default=i},991559:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(685396),a=r(n(362644));let o;var s="Headers"in window&&Headers?Headers:(o=a.default.iterator,class e{constructor(t){if(this._headers={},t instanceof e)for(const e of t.entries()){const[t,n]=e;n.split(", ").forEach((e=>{this.append(t,e)}))}else if("object"==typeof t)for(const e in t){t[e].split(", ").forEach((t=>{this.append(e,t)}))}}append(e,t){const n=e.toLowerCase();n in this._headers?this._headers[n].push(t):this._headers[n]=[t]}delete(e){const t=e.toLowerCase();delete this._headers[t]}entries(){const e=Object.keys(this._headers).map((e=>[e,this.get(e)||""]));return(0,i.iteratorFromArray)(e)}get(e){const t=e.toLowerCase();return t in this._headers?this._headers[t].join(", "):null}has(e){return e.toLowerCase()in this._headers}keys(){return(0,i.mapIterator)(this.entries(),(e=>{let[t]=e;return t}))}set(e,t){const n=e.toLowerCase();this._headers[n]=[t]}values(){return(0,i.mapIterator)(this.entries(),(e=>{let[t,n]=e;return n}))}[o](){return this.entries()}toString(){return"[Object Headers]"}});t.default=s},87364:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestIdleCallback=t.cancelIdleCallback=void 0;const n=window.requestIdleCallback,r=window.cancelIdleCallback,i="requestIdleCallback"in window?n:function(e){return setTimeout((()=>{const t=Date.now();e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1)};t.requestIdleCallback=i;const a="cancelIdleCallback"in window?r:function(e){clearTimeout(e)};t.cancelIdleCallback=a},968868:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=window.MediaError||{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};t.default=n},362644:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r="Symbol"in window?Symbol:((n=class{}).iterator="@@iterator",n);t.default=r},177853:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n(35449);var r=URLSearchParams;t.default=r},125613:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926));class a{constructor(e){this._handleMessage=e=>{if(!e.data||!e.data.action)return;const t=e.data;if(!e.ports||0===e.ports.length)return;const n=e.ports;if(!a.isSW()&&window.navigator.serviceWorker&&e.source!==window.navigator.serviceWorker.controller)return;("function"==typeof e.waitUntil?t=>e.waitUntil(t):()=>{})(Promise.resolve(this.requestHandler(t)).then((e=>{n[0].postMessage(e)})).catch((e=>{n[0].postMessage({error:e&&e.toString()})})))},this.requestHandler=e}init(){const e=a.isSW()?self:window.navigator.serviceWorker;try{if(!e)return;e.addEventListener("message",this._handleMessage)}catch(e){}}static isSW(){return"undefined"==typeof window}static getRequestor(e){return a.isSW()?"string"==typeof e?self.clients.get(e):Promise.resolve(e):window.navigator.serviceWorker?window.navigator.serviceWorker.ready.then((()=>window.navigator.serviceWorker?window.navigator.serviceWorker.controller:null)):Promise.resolve(null)}static broadcast(e,t){return(0,i.default)((function*(){if(!a.isSW())throw new Error("Broadcast called from non-serviceworker.");const n=yield self.clients.matchAll();return 0===n.length?Promise.reject(new Error("No clients available.")):Promise.all(n.map((n=>a.request(n,e,t))))}))()}static request(e,t,n){const r=new MessageChannel;return new Promise(((i,o)=>(r.port1.onmessage=e=>{var t;(null===(t=e.data)||void 0===t?void 0:t.error)?o(e.data.error):i(e.data)},a.getRequestor(e).then((e=>{if(!e)return o(new Error("No ServiceWorker controlling this client."));e.postMessage({action:t,message:n,version:"2.2228.14"},[r.port2])})))))}}t.default=a},364237:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={REQUEST_STREAMING_INFO:"GET_STREAMING_INFO",REQUEST_RMR:"REQUEST_RMR",SEND_STREAMING_CHUNK:"SEND_STREAMING_CHUNK",EXP_BACKOFF:"EXP_BACKOFF",LOG:"LOG",UPLOAD_LOGS:"UPLOAD_LOGS",REQUEST_DOCUMENT_DOWNLOAD:"REQUEST_DOCUMENT_DOWNLOAD",SET_L10N:"SET_L10N",STREAMING_SUPPORTED:"STREAMING_SUPPORTED",REMOVE_PP:"REMOVE_PP",LOGOUT:"LOGOUT",CLEAN_ASSETS:"CLEAN_ASSETS",PRELOAD_LAZY_LOADED_BUNDLES:"PRELOAD_LAZY_LOADED_BUNDLES",ACTIVE_TAB:"ACTIVE_TAB"};t.default=n},838125:(e,t,n)=>{"use strict";var r=n(595318),i=n(781572),a=r(n(8425)),o=n(739948),s=r(n(125613)),l=r(n(364237)),c=n(662583),u=n(546582),d=n(127838),p=n(608080),f=n(765044);if(a.default.supported){const e=function(){try{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&e.controller.addEventListener("error",(e=>{f.Socket.state!==c.SOCKET_STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker controller error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker, error: ${e}`}};try{const t=navigator.serviceWorker;t&&t.addEventListener("controllerchange",(()=>{e(),f.Socket.state===c.SOCKET_STATE.UNLAUNCHED&&(p.Stream.needsUpdate=!0)}))}catch(e){__LOG__(3)`Unable to add "controllerchange" event listener to service worker container, error: ${e}`}try{const e=navigator.serviceWorker;e&&e.addEventListener("error",(e=>{f.Socket.state!==c.SOCKET_STATE.UNLAUNCHED&&__LOG__(3)`ServiceWorker container error: ${e.error}`}))}catch(e){__LOG__(3)`Unable to add "error" event listener to service worker container, error: ${e}`}e();const t=function(e,t){e.buffer.forEach((e=>{var n;const r=null!==(n=e.message[0])&&void 0!==n?n:"",i=function(e){switch(e){case"info":return 1;case"log":return 2;case"warn":return 3;case"error":return 4}throw new Error(`Invalid level: ${e}`)}(e.level.match(/^(.*?)(?:Verbose)?$/i)[1]);o.Logger.logImpl(i,`ServiceWorker (${t}): ${r}`,e.error,e.attachedToSendLogs,e.extraTags)}))};new s.default((e=>{let{action:r,message:i,version:a}=e;switch(r){case l.default.REQUEST_STREAMING_INFO:case l.default.EXP_BACKOFF:case l.default.REQUEST_RMR:case l.default.SEND_STREAMING_CHUNK:return(0,u.requireHandleVideoStreamingRequest)().then((e=>null==e?void 0:e({action:r,message:i})));case l.default.LOG:if(f.Socket.state===c.SOCKET_STATE.UNLAUNCHED)return;return i&&t(i,a),{test:!0};case l.default.UPLOAD_LOGS:i&&t(i,a);return n(386374).upload({reason:"Requested by Service Worker"}).then((()=>{}));case l.default.ACTIVE_TAB:return{isActive:(0,d.getIsTabActive)()};default:return Promise.reject(new Error(`Invalid Action: ${r}`))}})).init(),i.Cmd.on("logout",(()=>{const e=navigator.serviceWorker;(null==e?void 0:e.controller)&&s.default.request(e.controller,l.default.LOGOUT).catch((()=>{}))}))}},413684:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926));t.default=class{open(){return this._openPromise?this._openPromise:this._closePromise?(this._openPromise=this._closePromise.catch((e=>{throw this._openPromise=null,e})).then((()=>(this._openPromise=null,this.open()))),this._openPromise):(this._openPromise=this.doOpen().catch((e=>{throw this._openPromise=null,e})).then((()=>{this._openPromise=null})),this._openPromise)}close(){return this._closePromise?this._closePromise:this._openPromise?(this._closePromise=this._openPromise.catch((e=>{throw this._closePromise=null,e})).then((()=>(this._closePromise=null,this.close()))),this._closePromise):(this._closePromise=this.doClose().catch((e=>{throw this._closePromise=null,e})).then((()=>{this._closePromise=null})),this._closePromise)}get(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doGet(e)}))()}queryByIndex(e,t){var n=this;return(0,i.default)((function*(){return yield n.open(),n.doQueryByIndex(e,t)}))()}getAll(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doGetAll()}))()}put(e,t){var n=this;return(0,i.default)((function*(){return yield n.open(),n.doPut(e,t)}))()}del(e){var t=this;return(0,i.default)((function*(){return yield t.open(),t.doDel(e)}))()}count(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doCount()}))()}clear(){var e=this;return(0,i.default)((function*(){return yield e.open(),e.doClear()}))()}doGet(){throw new Error("Not implemented")}doQueryByIndex(){throw new Error("Not implemented")}doGetAll(){throw new Error("Not implemented")}doPut(){throw new Error("Not implemented")}doDel(){throw new Error("Not implemented")}doCount(){throw new Error("Not implemented")}doClear(){throw new Error("Not implemented")}doOpen(){throw new Error("Not implemented")}doClose(){throw new Error("Not implemented")}}},226945:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{n=self.indexedDB}catch(e){}var r=n;t.default=r},805558:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_IDB_DB_NAMES=void 0,t.deleteAllIdb=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(638284),o=r(n(986128));const s={__dbnames:"__dbnames",fts_storage:"fts-storage",fts_loadgen_metadata:"loadgen-storage",_hsm_storage_DEPRECATED:"hsm-storage",jobs_storage:"jobs-storage",lru_media_storage_idb:"lru-media-storage-idb",model_storage:"model-storage",offd_storage:"offd-storage",pb_detect:"pb_detect",signal_storage:"signal-storage",sw:"sw",wawc:"wawc",wawc_db_enc:"wawc_db_enc",qpl_storage:"qpl-storage",worker_storage:"worker-storage"};function l(){return(l=(0,i.default)((function*(){const e=Object.keys(s).map((e=>s[e]));let t=!1;const n=e.map(function(){var e=(0,i.default)((function*(e){if("__dbnames"!==e&&"sw"!==e&&"pb_detect"!==e)try{yield(0,a.promiseTimeout)(Promise.resolve(o.default.delete(e)),7e3)}catch(e){t=!0}}));return function(){return e.apply(this,arguments)}}());return yield Promise.all(n),t}))).apply(this,arguments)}t.WEB_IDB_DB_NAMES=s},37338:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(413684));class o extends a.default{constructor(e,t,n,r){var i,a;super(),this.storeName=e,this.createResponse=t,this.parseResponse=n,this.encodeKey=null!==(i=null==r?void 0:r.encodeKey)&&void 0!==i?i:e=>e,this.matchOptions=null!==(a=null==r?void 0:r.matchOptions)&&void 0!==a?a:{}}doGet(e){const t=this.encodeKey(e,this.storeName);return this.cacheStore?Promise.resolve(this.cacheStore.match(t,this.matchOptions).then((e=>e?this.parseResponse(e):null))):(__LOG__(3)`Unable to get. This error can occur if abstract method doGet gets called.`,Promise.reject(new Error("Unable to get")))}doPut(e,t){const n=this.encodeKey(e,this.storeName);return this.cacheStore?Promise.resolve(this.cacheStore.put(n,this.createResponse(t)).then((()=>t))):(__LOG__(3)`Unable to put. This error can occur if abstract method doPut gets called.`,Promise.reject(new Error("Unable to put in cache")))}doDel(e){var t=this;return(0,i.default)((function*(){const n=t.encodeKey(e,t.storeName);if(!t.cacheStore)return __LOG__(3)`Unable to delete. This error can occur if abstract method doDel gets called.`,Promise.reject(new Error("Unable to delete"));yield t.cacheStore.delete(n,t.matchOptions)}))()}doClear(){return Promise.resolve(caches.delete(this.storeName).then((e=>{e||__LOG__(2)`Tried to delete a non-existent cache: ${this.storeName}`})))}doOpen(){return caches.open(this.storeName).then((e=>{this.cacheStore=e})).catch((e=>{throw this.cacheStore=null,__LOG__(3)`Unable to open cache: ${this.storeName}, error: ${e}`,e}))}doClose(){return this.cacheStore=null,Promise.resolve()}}t.default=o},904285:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{n=window.localStorage}catch(e){}var r=n;t.default=r},745234:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(402525)),o=r(n(904285)),s=r(n(111554));var l=new class{constructor(){this.dataStore={}}setItem(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.dataStore[e]=t,null!=o.default&&o.default.setItem(e,t),n&&s.default.idb().then((n=>n.user.put({key:e,value:t}))).catch((e=>{__LOG__(3)`db:setItem:Error ${e}`}))}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===this.dataStore[e]||t){if(null!=o.default){const t=o.default.getItem(e);return null!=t&&this.setItem(e,t,!1),t}return null}return this.dataStore[e]}removeItem(e){delete this.dataStore[e],null!=o.default&&o.default.removeItem(e),s.default.idb().then((t=>t.user.delete(e))).catch((e=>{__LOG__(3)`db:removeItem:Error ${e}`}))}clear(e){var t=this;return(0,i.default)((function*(){t.dataStore={},null!=o.default&&(o.default.clear(),e&&(0,a.default)(e,(function(e,t){o.default.setItem(t,e)}))),yield s.default.idb().then((e=>e.user.clear())).catch((e=>{__LOG__(3)`db:clear:Error ${e}`}))}))()}};t.default=l},439312:(e,t)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;try{n=window.sessionStorage}catch(e){}var r=n;t.default=r},724609:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(402525)),a=r(n(145095)),o=n(551737),s=r(n(439312)),l=n(546718);var c=(()=>{try{const e=(0,a.default)(s.default,"sessionStorage");return e.setItem(l.KEYS.STORAGE_TEST,l.KEYS.STORAGE_TEST),(0,o.isFunction)(e.clear)}catch(e){return!1}})()?new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t,(0,a.default)(s.default,"sessionStorage").setItem(e,t)}getItem(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==this.dataStore[e]||t?(0,a.default)(s.default,"sessionStorage").getItem(e):this.dataStore[e]}removeItem(e){delete this.dataStore[e],(0,a.default)(s.default,"sessionStorage").removeItem(e)}clear(e){return this.dataStore={},(0,a.default)(s.default,"sessionStorage").clear(),e&&(0,i.default)(e,(function(e,t){(0,a.default)(s.default,"sessionStorage").setItem(t,e)})),Promise.resolve()}}:new class{constructor(){this.dataStore={}}setItem(e,t){this.dataStore[e]=t}getItem(e){return void 0===this.dataStore[e]?null:this.dataStore[e]}removeItem(e){delete this.dataStore[e]}clear(){return this.dataStore={},Promise.resolve()}};t.default=c},6103:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(904285)),a=n(546718),o=n(609287),s=n(387067),l=n(298246);function c(e){let t=e;return Object.values(a.HASHED_KEYS).some((t=>t===e))&&(t=(0,l.hashUserPrefKey)(e)),t}var u=new class{constructor(){this._cachedLocalStorageValues={}}setItemToLocalStorage(e,t){if(null==i.default)return;const n=c(e);if(null==n)return;const r=JSON.stringify((0,s.preProcessUserPref)(e,t));null!=r&&(this._cachedLocalStorageValues[n]=r,i.default.setItem(n,r))}getItemFromLocalStorage(e){const t=c(e);if(null==t)return;let n,r=this._cachedLocalStorageValues[t];if(null==r&&null!=i.default&&(r=i.default.getItem(t)),null==r)return null;this._cachedLocalStorageValues[t]=r;try{n=JSON.parse(r)}catch(t){return this.removeItemFromLocalStorage(e),null}return(0,o.postProcessUserPref)(e,n)}removeItemFromLocalStorage(e){const t=c(e);null!=t&&(delete this._cachedLocalStorageValues[t],null!=i.default&&i.default.removeItem(t))}clearLocalStorage(){this._cachedLocalStorageValues={},null!=i.default&&i.default.clear()}bulkSetItemsToLocalStorage(e){e.forEach((e=>{this.setItemToLocalStorage(e.userPrefKey,e.userPrefValue)}))}};t.default=u},609287:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.postProcessUserPref=function(e,t){let n=t;const r=o[e];null!=r&&(n=r(t));return n};var i=r(n(66604)),a=n(615688);const o={WANoiseInfo:function(e){const t=(0,i.default)(e,a.decodeB64);return{recoveryToken:t.recoveryToken,staticKeyPair:{pubKey:t.pubKey,privKey:t.privKey}}}}},387067:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.preProcessUserPref=function(e,t){let n=t;const r=o[e];null!=r&&(n=r(t));return n};var i=r(n(66604)),a=n(615688);const o={WANoiseInfo:function(e){const t={privKey:e.staticKeyPair.privKey,pubKey:e.staticKeyPair.pubKey,recoveryToken:e.recoveryToken};return(0,i.default)(t,a.encodeB64)}}},298246:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.hashUserPrefKey=function(e){const t=(0,a.getMaybeMeUser)();if(!t)return void __LOG__(3)`hashUserPrefKey: Me has not loaded yet.`;return(0,i.default)(t.toString()+":"+e)};var i=r(n(611782)),a=n(978820)},120869:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.initWAWC=function(){return i.default.openDB()};var i=r(n(111554))},810635:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.genDeviceNotificationMsg=function(e,t,n,r){const l=(0,o.assertGetMe)(),c=new a.default({fromMe:t.equals((0,s.toUserWid)(l)),remote:e,id:a.default.newId()}),u=c.fromMe&&n.includes(l.getDeviceId());return{id:c,t:(0,i.unixTime)(),type:"e2e_notification",subtype:"device",from:e,to:(0,s.toUserWid)(l),body:t.toString(),devicesAdded:n.length,devicesRemoved:r.length,isThisDeviceAdded:u}},t.genDisappearingModeSystemMsg=function(e,t,n){const r=n?(0,o.getMeUser)():e,i=[String(t),r];return l(e,"notification_template","disappearing_mode",i)},t.genEncryptNotificationMsg=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"encrypt";return l(e,"e2e_notification",t,[])},t.genErrorInDeviceListNotificationMsg=function(e,t){const n=(0,o.assertGetMe)();return{id:new a.default({fromMe:!1,remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"error_in_device_list",from:e,to:(0,s.toUserWid)(n),templateParams:[t]}},t.genNotificationMsg=l,t.genSecurityCodeNotificationMsg=function(e,t){const n=(0,o.getMeUser)();return{id:new a.default({fromMe:t.equals(n),remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:"e2e_notification",subtype:"identity",from:e,to:n,body:t.toString()}},t.genTealNotificationTemplateMsg=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return l(e,"notification_template",t,n)};var i=n(892844),a=r(n(465212)),o=n(978820),s=n(745454);function l(e,t,n,r){const s=(0,o.getMeUser)();return{id:new a.default({fromMe:e.equals(s),remote:e,id:a.default.newId()}),t:(0,i.unixTime)(),type:t,subtype:n,from:e,to:s,templateParams:r}}},526947:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if((0,i.isMDBackend)()&&!e.isGroupMsg&&0===t.msgs.length)return(0,a.default)(t.id,t.contact.privacyMode);return null};var i=n(88555),a=r(n(329224))},677345:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.genGroupCreationMsg=function(e,t){var n,r,i;const{chatId:o}=e;let l=null!==(n=null!==(r=t.owner)&&void 0!==r?r:e.author)&&void 0!==n?n:(0,s.getMaybeMeUser)();const c=t.subject;let u,d;if(!0===t.defaultSubgroup){var p;u="community_create",t.parentGroup&&(d=[t.parentGroup,""]),l=null!==(p=e.author)&&void 0!==p?p:void 0}else u="create";return{id:new a.default({remote:o,fromMe:!1,participant:l,id:a.default.newId()}),author:l,body:c,from:o,recipients:[],self:"in",subtype:u,t:null!==(i=t.creation)&&void 0!==i?i:e.ts,type:"gp2",templateParams:d}},t.genGroupEphemeralSettingMsg=function(e,t,n,r){return{id:new a.default({remote:e,fromMe:!1,participant:n,id:a.default.newId()}),author:n,from:e,recipients:[],self:"in",subtype:"ephemeral",t,type:"gp2",templateParams:[`${r}`]}},t.genGroupNotificationMsg=function(e,t){const{chatId:n,isAdmin:r=!1}=e,s=e.author&&(0,l.toUserWid)(e.author)||void 0;let c=null,u=[],d=s,p=t.actionType,f=null;switch(t.actionType){case i.GROUP_ACTIONS.SUBJECT:c=t.subject;break;case i.GROUP_ACTIONS.MODIFY:u=t.participants;break;case i.GROUP_ACTIONS.ADD:t.isInvite?p="invite":t.isLinkedGroupJoin&&(p="linked_group_join");case i.GROUP_ACTIONS.PROMOTE:case i.GROUP_ACTIONS.DEMOTE:case i.GROUP_ACTIONS.REMOVE:case i.GROUP_ACTIONS.LINKED_GROUP_PROMOTE:case i.GROUP_ACTIONS.LINKED_GROUP_DEMOTE:u=t.participants,1===u.length&&(d=u[0]),t.actionType===i.GROUP_ACTIONS.REMOVE&&1===u.length&&s===d&&(p="leave");break;case i.GROUP_ACTIONS.DELETE:p="leave",t.reason===i.DELETE_REASON.INTEGRITY_DELETE_PARENT&&(c=i.DELETE_REASON.INTEGRITY_DELETE_PARENT);break;case i.GROUP_ACTIONS.INVITE_CODE:p="revoke_invite";break;case i.GROUP_ACTIONS.DESC_ADD:p="description",c=t.desc;break;case i.GROUP_ACTIONS.DESC_REMOVE:p="description";break;case i.GROUP_ACTIONS.RESTRICT:case i.GROUP_ACTIONS.ANNOUNCE:case i.GROUP_ACTIONS.NO_FORWARD:f=t.value?["on"]:["off"],c=f[0];break;case i.GROUP_ACTIONS.EPHEMERAL:s&&(f=[`${t.duration}`,s]);break;case i.GROUP_ACTIONS.GROWTH_LOCKED:f=[t.type],c=f[0];break;case i.GROUP_ACTIONS.SUB_GROUP_LINK:case i.GROUP_ACTIONS.PARENT_GROUP_LINK:case i.GROUP_ACTIONS.SIBLING_GROUP_LINK:case i.GROUP_ACTIONS.SUB_GROUP_UNLINK:case i.GROUP_ACTIONS.PARENT_GROUP_UNLINK:case i.GROUP_ACTIONS.SIBLING_GROUP_UNLINK:case i.GROUP_ACTIONS.INTEGRITY_PARENT_GROUP_UNLINK:f=(0,o.flattenPairList)(t.groupDatas.map((e=>[e.id,e.subject])));break;case i.GROUP_ACTIONS.MEMBERSHIP_APPROVAL_MODE:f=[t.value?"on":"off",r.toString()]}const _={id:new a.default({remote:n,fromMe:!1,participant:d,id:a.default.newId()}),author:s,from:n,recipients:u.map(l.toUserWid)||[],self:"in",subtype:p,t:e.ts,type:"gp2"};c&&(_.body=c);f&&(_.templateParams=f);return _},t.genGroupPicChangeNotificationMsg=function(e,t,n,r){return{type:"gp2",self:"in",subtype:"picture",t:n,author:r,body:t,recipients:[],from:e,id:new a.default({remote:e,fromMe:!1,id:a.default.newId()})}},t.genIntialPhashMismatchMsg=function(e,t){return{id:new a.default({remote:e,fromMe:!1,id:a.default.newId()}),from:e,recipients:[],self:"in",subtype:"initial_pHash_mismatch",t,type:"gp2"}};var i=n(795720),a=r(n(465212)),o=n(556952),s=n(978820),l=n(745454)},329224:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){switch((0,i.getReducedPrivacyMode)(t)){case i.ReducedPrivacyMode.E2EE:return(0,r.genEncryptNotificationMsg)(e);case i.ReducedPrivacyMode.BSP:return(0,r.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_bsp");case i.ReducedPrivacyMode.FB:return(0,r.genTealNotificationTemplateMsg)(e,"biz_privacy_mode_init_fb")}};var r=n(810635),i=n(108197)},1559:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.genPaymentInviteAccoutSetupMsg=function(e,t){return{id:new i.default({remote:e,fromMe:!1,id:i.default.newId()}),from:e,recipients:[],self:"in",subtype:"payment_invite_account_set_up",t,type:a.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[e]}};var i=r(n(465212)),a=n(115461)},108197:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReducedPrivacyMode=void 0,t.comparePrivacyMode=function(e,t){return null==e&&null==t?0:null==t?1:null==e?-1:e.privacyModeTs-t.privacyModeTs},t.getContactPrivacyMode=function(e){if(!i.default.isUser(e))return;const t=n(719380).ContactCollection.get(e);return null==t?void 0:t.privacyMode},t.getLatestPrivacyMode=function(e,t){return null==e?t:null==t||e.privacyModeTs>t.privacyModeTs?e:t},t.getPrivacyModeFromQueryExistResponse=function(e){var t;const n=null===(t=e.bizInfo)||void 0===t?void 0:t.verifiedName;return null==n?null:e.biz&&!0===n.isApi?n.privacyMode:null},t.getReducedPrivacyMode=function(e){if(null==e||e.actualActors===a.ActualActorsEnumType.Self&&e.hostStorage===a.HostStorageEnumType.OnPremise)return o.E2EE;if(e.hostStorage===a.HostStorageEnumType.Facebook)return o.FB;return o.BSP};var i=r(n(389867)),a=n(49714);const o=n(76672).Mirrored(["E2EE","BSP","FB"]);t.ReducedPrivacyMode=o},485074:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(873955)),a=n(767924),o=n(40234),s=n(885553);var l=new class{constructor(){this._alarms=new Map;const e=()=>{this._alarms.size>0&&this._validateTimeouts()};s.jsHaltDetector.on(a.JS_HALT_EVENT,e),s.jsHaltDetector.on(a.CLOCK_CHANGE_BACKWARDS_EVENT,e),o.Clock.on(o.SKEW_CHANGE_EVENT,this._resetGlobalTimeouts.bind(this))}setLocalTimeout(e,t,n){return this._setTimeout(!1,e,t,n)}setGlobalTimeout(e,t,n){return this._setTimeout(!0,e,t,n)}clearTimeout(e){if(!e)return;const t=this._alarms.get(e);t&&(window.clearTimeout(t.timeoutId),this._alarms.delete(e))}_setTimeout(e,t,n,r){r&&this.clearTimeout(r);const a=r||(0,i.default)("alarm_timer_"),o=n-this._getTimeInMS(e),l=Math.min(o,2147483647);if(o<0)return __LOG__(2)`Alarm:setTimeout:Cannot set alarm in the past.`,t(),a;const c=window.setTimeout((()=>{n-this._getTimeInMS(e)<s.DEFAULT_THRESHOLD?(this._alarms.delete(a),t()):this._setTimeout(e,t,n,a)}),l);return this._alarms.set(a,{isGlobal:e,fn:t,expiration:n,timeoutId:c}),a}_validateTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:n,fn:r,expiration:i}=e;i<this._getTimeInMS(n)?(this.clearTimeout(t),r()):this._setTimeout(n,r,i,t)}))}_resetGlobalTimeouts(){new Map(this._alarms).forEach(((e,t)=>{const{isGlobal:n,fn:r,expiration:i}=e;n&&this._setTimeout(n,r,i,t)}))}_getTimeInMS(){return 1e3*(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?o.Clock.globalUnixTime():o.Clock.localUnixTime())}};t.default=l},40234:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SKEW_CHANGE_EVENT=t.HOUR24_FORMAT_CHANGE_EVENT=t.Clock=void 0;var i=r(n(81109)),a=n(892844),o=r(n(876521)),s=n(555452),l=r(n(914296)),c=n(833970),u=n(322476),d=n(548360),p=r(n(730381));const f=["fi","id","ms","ms-my"],_="skew_change";t.SKEW_CHANGE_EVENT=_;const h="hour24_format_change";t.HOUR24_FORMAT_CHANGE_EVENT=h;class g extends o.default{constructor(){if(super(),this.is24h=!1,this.skewMS=0,this.skew=0,Intl.DateTimeFormat&&Intl.DateTimeFormat().resolvedOptions){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;switch(e?__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone is ${e}`:__LOG__(2)`Intl.DateTimeFormat().resolvedOptions().timeZone does not exist`,e){case"America/Sao_Paulo":this.timeZoneHardCode="America/Belem";break;case"America/Campo_Grande":case"America/Cuiaba":this.timeZoneHardCode="America/Porto_Velho"}}}getIs24Hour(){return this.is24h}setIs24Hour(e){e!==this.is24h&&(this.is24h=e,(0,s.setHour24)(e),this.trigger(h))}setIs24HourBasedOnLocale(){const e=(0,s.getHour24)();null!=e?this.setIs24Hour(e):this.setIs24Hour(c.LOCALES_THAT_PREFER_24HOUR_TIME.has(l.default.getLocale()))}setSkew(e){Math.abs(e)>6e4&&__LOG__(2)`Setting large clockskew: ${e}ms`;const t=this.skewMS;this.skewMS=e,this.skew=Math.round(e/1e3),Math.abs(t-this.skewMS)>1e3&&this.trigger(_)}getSkew(){return this.skew}localUnixTime(e){return void 0!==e?e+this.skew:Math.floor(Date.now()/1e3)}globalUnixTime(e){return void 0!==e?e-this.skew:Math.floor((Date.now()-this.skewMS)/1e3)}globalUnixTimeMilliseconds(){return Math.floor(Date.now()-this.skewMS)}relativeStr(e){const t=e+this.skew;return t>=(0,p.default)().startOf("day").unix()?this._timestampStr(t):this._dateRelativeStr(t,!1)}relativeDateStr(e){return this._dateRelativeStr(e+this.skew,!1)}relativeDateAndTimeStr(e){return this._dateRelativeStr(e+this.skew,!0)}monthStr(e){const t=e+this.skew,n=1e3*t;return t>=(0,p.default)().startOf("month").unix()&&t<=(0,p.default)().endOf("month").unix()?d.fbt._("This Month",null,{hk:"3BBgGL"}):t>=(0,p.default)().startOf("year").unix()&&t<=(0,p.default)().endOf("year").unix()?Intl.DateTimeFormat(p.default.locale(),{month:"long"}).format(n):Intl.DateTimeFormat(p.default.locale(),{month:"long",year:"numeric"}).format(n)}timeStr(e){if(this.shouldUseIntlDateTimeFormat()){const t=1e3*(e+this.skew);let n={hour12:!this.is24h,hour:"numeric",minute:"numeric"},r={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(n=(0,i.default)((0,i.default)({},n),{},{timeZone:this.timeZoneHardCode}),r=(0,i.default)((0,i.default)({},r),{},{timeZone:this.timeZoneHardCode}));return`${Intl.DateTimeFormat(p.default.locale(),n).format(t)}, ${Intl.DateTimeFormat(p.default.locale(),r).format(t)}`}return p.default.unix(e+this.skew).format(this.is24h?`HH${this._hmsSeparator()}mm, l`:"LT, l")}timestampStr(e){return this._timestampStr(e+this.skew)}timestampStrFormat(){return this.is24h?`HH${this._hmsSeparator()}mm`:"LT"}timestampHour(e){const t=e+this.skew,n=p.default.unix(t).hour();return this.is24h?n:n%12}createdStr(e,t){const n=this.daysDelta(e),r=e+this.skew,i=this._timestampStr(r);if(0===n)return t?l.default.t(735,{time:i}):l.default.t(734,{time:i});if(1===n)return t?l.default.t(741,{time:i}):l.default.t(740,{time:i});if(n<7){const e=this._dateRelativeStr(r,!1);return t?l.default.t(739,{day:e,time:i}):l.default.t(738,{day:e,time:i})}const a=this._dateRelativeStr(r,!1);return t?l.default.t(731,{date:a,time:i}):l.default.t(730,{date:a,time:i})}createdByStr(e,t,n){const r=this.daysDelta(e),i=e+this.skew,a=this._timestampStr(i);if(0===r)return n?l.default.t(737,{time:a}):l.default.t(736,{name:t,time:a});if(1===r)return n?l.default.t(743,{time:a}):l.default.t(742,{name:t,time:a});if(r<7){const r=this._dayNameStr(e);return n?d.fbt._("Group created by you, {on_day} at {time}",[d.fbt._param("on_day",r),d.fbt._param("time",a)],{hk:"2dwUQV"}):d.fbt._("Group created by {name}, {on_day} at {time}",[d.fbt._param("name",t),d.fbt._param("on_day",r),d.fbt._param("time",a)],{hk:"34crrC"})}const o=this._dateRelativeStr(i,!1);return n?l.default.t(733,{date:o,time:a}):l.default.t(732,{name:t,date:o,time:a})}createdByOnDateStr(e,t){const n=this._dateStr(e);if(t){if(t.isMe)return d.fbt._("Created by you on {date}",[d.fbt._param("date",n)],{hk:"4vAzF8"});if(t.isMyContact)return d.fbt._("Created by {name} on {date}",[d.fbt._param("name",t.formattedName),d.fbt._param("date",n)],{hk:"w6Jgu"})}return d.fbt._("Created on {date}",[d.fbt._param("date",n)],{hk:"16kFZm"})}_dayNameStr(e){const t=e+this.skew;switch(p.default.unix(t).day()){case 0:return d.fbt._("on Sunday",null,{hk:"3hQdLv"});case 1:return d.fbt._("on Monday",null,{hk:"4uZn7B"});case 2:return d.fbt._("on Tuesday",null,{hk:"4llPGV"});case 3:return d.fbt._("on Wednesday",null,{hk:"4afKlR"});case 4:return d.fbt._("on Thursday",null,{hk:"49dOXK"});case 5:return d.fbt._("on Friday",null,{hk:"3P0f1f"});case 6:return d.fbt._("on Saturday",null,{hk:"1I5myq"});default:throw new Error("Unexpected day number")}}untilStr(e){if(e===u.MUTE_ALWAYS_EXPIRATION_SENTINEL)return d.fbt._("Always",null,{hk:"26Zr18"});const t=this.daysDelta(e),n=e+this.skew,r=this._timestampStr(n);if(0===t)return l.default.t(636,{time:r});if(1===t)return l.default.t(637,{time:r});if(t<7){const e=this._dateRelativeStr(n,!1);return l.default.t(638,{day:e,time:r})}const i=this._dateRelativeStr(n,!1);return l.default.t(635,{date:i,time:r})}lastSeenStr(e){const t=this.daysDelta(e),n=e+this.skew,r=this._timestampStr(n);if(0===t)return l.default.t(705,{time:r});if(1===t)return l.default.t(707,{time:r});if(t<7){const e=this._dateRelativeStr(n,!1);return l.default.t(706,{date:e,time:r})}const i=this._dateRelativeStr(n,!1);return l.default.t(704,{date:i,time:r})}daysDelta(e,t){const n=p.default.unix(e).startOf("day"),r=(void 0===t?(0,p.default)().startOf("day"):p.default.unix(t).startOf("day")).diff(n,"days");return Math.abs(r)}durationStr(e){const t="string"==typeof e?parseInt(e,10):e,n=p.default.utc(1e3*t);if(n.isValid()){const e=t<a.HOUR_SECONDS?"m:ss":"H:mm:ss";return n.format(e)}return""}_getShortTimeLeftStr(e){const t=Math.floor(e/86400);if(t>0)return{time:l.default.t(605,{days:t,_plural:t}),_plural:t};const n=Math.floor(e/3600);if(n>0)return{time:l.default.t(606,{hours:n,_plural:n}),_plural:n};const r=Math.floor(e/60);return r>0?{time:l.default.t(607,{minutes:r,_plural:r}),_plural:r}:{time:l.default.t(608,{seconds:e,_plural:e}),_plural:e}}timeLeftStr(e){return l.default.t(621,this._getShortTimeLeftStr(e))}paymentTimestampStr(e){const t=e+this.skew,n=p.default.unix(t),r=n.startOf("day"),i=(0,p.default)().startOf("day").diff(r,"days");if(0===i)return d.fbt._("today",null,{hk:"445Hu3"});if(1===i)return d.fbt._("yesterday",null,{hk:"qICUM"});if(!(i<7)){const e=n.format("MMMM d");return l.default.t(820,{date:e})}switch(n.day()){case 0:default:return d.fbt._("on Sunday",null,{hk:"2gwfdl"});case 1:return d.fbt._("on Monday",null,{hk:"4ww1V1"});case 2:return d.fbt._("on Tuesday",null,{hk:"3Bz1cZ"});case 3:return d.fbt._("on Wednesday",null,{hk:"493Z1"});case 4:return d.fbt._("on Thursday",null,{hk:"2pNhJx"});case 5:return d.fbt._("on Friday",null,{hk:"Tf9gq"});case 6:return d.fbt._("on Saturday",null,{hk:"1SPYjP"})}}liveLocationLastUpdatedStr(e){const t=e+this.skew,n=this._timestampStr(t),r=p.default.unix(t).startOf("day"),i=(0,p.default)().startOf("day").diff(r,"days");if(0===i)return l.default.t(403,{time:n});if(1===i)return l.default.t(405,{time:n});if(i<6){const e=this._dateRelativeStr(t,!1);return l.default.t(404,{date:e,time:n})}const a=this._dateRelativeStr(t,!1);return l.default.t(402,{date:a,time:n})}pastParticipantOnDateAtTime(e,t){const n=this.daysDelta(e),r=e+this.skew,i=this._timestampStr(r);if(0===n)return d.fbt._("{action} today at {time}",[d.fbt._param("action",t),d.fbt._param("time",i)],{hk:"lDUJQ"});if(1===n)return d.fbt._("{action} yesterday at {time}",[d.fbt._param("action",t),d.fbt._param("time",i)],{hk:"3aI8Lj"});const a=this._dateRelativeStr(r,!1);return d.fbt._("{action} {date} at {time}",[d.fbt._param("action",t),d.fbt._param("date",a),d.fbt._param("time",i)],{hk:"2No8oD"})}_timestampStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={hour12:!this.is24h,hour:"numeric",minute:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));const n=Intl.DateTimeFormat(p.default.locale(),t).format(1e3*e);return this.is24h?n.replace(/^24/,"00"):n.replace(/^0/,"12")}return p.default.unix(e).format(this.timestampStrFormat())}_dateStr(e){if(this.shouldUseIntlDateTimeFormat()){let t={year:"numeric",month:"numeric",day:"numeric"};null!=this.timeZoneHardCode&&(t=(0,i.default)((0,i.default)({},t),{},{timeZone:this.timeZoneHardCode}));return Intl.DateTimeFormat(p.default.locale(),t).format(1e3*e)}return p.default.unix(e).format("l")}_dateRelativeStr(e,t){const n=(0,p.default)().startOf("day"),r=p.default.unix(e).startOf("day"),i=n.diff(r,"days"),a=this._timestampStr(e);if(0===i)return t?l.default.t(851,{time:a}):d.fbt._("today",null,{hk:"445Hu3"});if(1===i)return t?l.default.t(858,{time:a}):d.fbt._("yesterday",null,{hk:"qICUM"});if(!t&&Math.abs(i)<7)return p.default.unix(e).format("dddd");const o=this._dateStr(e);return t?l.default.t(850,{date:o,time:a}):o}_hmsSeparator(){const e=p.default.locale();return f.includes(e)?".":":"}shouldUseIntlDateTimeFormat(){return Intl.DateTimeFormat&&!c.LOCALE_DATE_TIME_CUSTOMIZATIONS[p.default.locale()]&&!c.SHOULD_USE_MOMENT_LOCALE_FORMAT.has(p.default.locale())}}const m=new g;t.Clock=m},241931:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dataURLtoBlob=function(e){const t=e.match(n);if(!t)throw new Error("invalid data URI");const r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),i=!!t[4],a=e.slice(t[0].length);let o;o=i?atob(a):decodeURIComponent(a);const s=new ArrayBuffer(o.length),l=new Uint8Array(s);for(let e=0;e<o.length;e+=1)l[e]=o.charCodeAt(e);return new Blob([l],{type:r})};const n=/^data:((.*?)(;charset=.*?)?)(;base64)?,/},995726:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.findLink=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const r=(0,a.findLink)(e,t);if(null==r)return;return u(r,n)},t.findLinks=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;const r=(0,a.findLinks)(e,t);return r.map((e=>u(e,n)))},Object.defineProperty(t,"validateEmail",{enumerable:!0,get:function(){return a.validateEmail}});var i=r(n(81109)),a=n(60248),o=n(53659),s=n(272441),l=n(978820),c=n(317239);function u(e,t){const n=(0,l.getMaybeMeUser)();return(0,i.default)((0,i.default)({},e),{},{suspiciousCharacters:t&&n?(0,o.findSuspiciousCharacters)(e.domain,(0,s.toPhoneUserJid)(t.user),(0,s.toPhoneUserJid)(n.user),c.Conn.allLanguages):void 0})}},376139:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(288306)),a=r(n(402525)),o=n(615688),s=n(108584),l=n(411141),c=n(551737),u=n(241931),d=n(565885),p=r(n(177853)),f=n(114259),_=r(n(608575));let h;const g=/^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/,m="https://l.wl.co/l";var y={URL_REGEX:g,build(e,t){const n=new p.default;return(0,a.default)(t||{},((e,t)=>{n.set(t,e)})),`${e}?${n.toString()}`},canMuckHistory(){var e;return!(!(null===(e=window.history)||void 0===e?void 0:e.pushState)||!self.location)},relToAbs:e=>(h||(h=document.createElement("a")),h.href=e,h.href),hostname:(0,i.default)((function(e){return h||(h=document.createElement("a")),h.href=this.isHttp(e)?e:"http://"+e,h.hostname})),withoutWww:function(e){return e.split("www.").join("")},isHttp:e=>e&&("https://"===e.toLowerCase().substring(0,8)||"http://"===e.toLowerCase().substring(0,7)),isHttps:e=>e&&"https://"===e.toLowerCase().substring(0,8),hasValidUrlScheme(e){const t=e.trim();return["irc://","ftp://","mailto:","http://","https://"].some((e=>0===t.toLowerCase().indexOf(e)))},isBlob:e=>(0,c.isString)(e)&&"blob:"===e.substring(0,5),isData:e=>(0,c.isString)(e)&&"data:"===e.substring(0,5),isEncryptedMedia:e=>e&&(0,c.isString)(e)&&e.endsWith(".enc"),parseDataURL(e){const t=e.indexOf(":"),n=e.indexOf(";"),r=e.indexOf(",");return{mimetype:e.substring(t+1,n),data:e.substring(r+1)}},dataURLtoFile(e){const t=this.parseDataURL(e).mimetype;return(0,d.createFile)([(0,u.dataURLtoBlob)(e)],"",{type:t})},GSM_NAME:"gme-whatsappinc",GSM_NUMS:"LM4NgcjF-X_EedaZ6MwPVSH0Sac=",gsmURL(e,t){const n=t.replace(/\-/g,"+").replace(/_/g,"/"),r=(0,o.decodeB64)(n),i=_.default.parse(e).path,a=s.Binary.build(i).readByteArray();return(0,l.hmacSha1)(r,a).then((t=>`${e}&signature=${(0,o.encodeB64UrlSafe)(t)}`))},thumbToCSSURL(e){return`url("${this.isHttp(e)||e.startsWith("data:")?e:`data:image/jpeg;base64,${e}`}")`},thumbAsBackgroundImage(e){return e?{backgroundImage:this.thumbToCSSURL(e)}:{}},isValid:e=>g.test(e),toMaliciousSiteRedirect:e=>""===e||0===e.indexOf(m)?e:`${m}?u=${encodeURIComponent(e)}`,isCommerceDeepLink:e=>(0,f.matchCatalogUrl)(e)||(0,f.matchProductUrl)(e)};t.default=y},374094:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addWebpMetadata=function(e,t){const n=new Uint8Array(e);if(!(0,i.isExtendedFile)(n))throw new Error("Not extended");const s=function(e){const t=new TextEncoder,n=JSON.stringify(e),a=t.encode(n),s=function(e){return(0,r.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)("II"),new Uint8Array([42,0]),(0,i.numberToLittleEndian)(8),new Uint8Array([1,0]),(0,i.stringToUint8)("AW"),new Uint8Array([7,0]),(0,i.numberToLittleEndian)(e.byteLength),(0,i.numberToLittleEndian)(22),e])}(a),l=[o(i.Chunk.EXIF,s.byteLength),s];a.byteLength%2!=0&&l.push(new Uint8Array([0]));return(0,r.concatTypedArrays)(Uint8Array,l)}((0,a.toRawWebpMetadata)(t)),l=(0,r.concatTypedArrays)(Uint8Array,[n,s]);l.set((0,i.numberToLittleEndian)(l.byteLength-8),4);return l.buffer};var r=n(660977),i=n(755854),a=n(787469);function o(e,t){return(0,r.concatTypedArrays)(Uint8Array,[(0,i.stringToUint8)(e),(0,i.numberToLittleEndian)(t)])}},824789:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return new Promise(((t,n)=>{const r=new a.default;r.onerror=function(e){r.terminate(),n(new i.DecodeWebpResultsError("worker error",e))},r.onmessageerror=function(e){r.terminate(),n(new i.DecodeWebpResultsError("worker message error",e))},r.onmessage=e=>{r.terminate();const n=e.data;t(n)},r.postMessage({webpBuffer:e},[e])}))};var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),a=r(n(926281));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}},189059:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){const{quality:o=90,ensureExtendedFormat:s=!1}=null!=r?r:{};return new Promise(((r,l)=>{const c=new a.default;c.onerror=function(e){c.terminate(),l(new i.EncodeWebpError("worker error",e))},c.onmessageerror=function(e){c.terminate(),l(new i.EncodeWebpError("worker message error",e))},c.onmessage=e=>{c.terminate(),r(e.data.blob)},c.postMessage({rgbaData:e,width:t,height:n,quality:o,ensureExtendedFormat:s})}))};var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),a=r(n(258904));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}},55390:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWebpMetadata=function(e){const t=function(e){const t=new Uint8Array(e),n=(0,r.findWebpMetadata)(t);if(!n)return{};const{position:i,size:a}=n,o=new TextDecoder,s=t.slice(i,i+a),l=o.decode(s);try{return JSON.parse(l)}catch(e){return __LOG__(2)`Failed to parse emojis out of sticker, returning empty object.`,{}}}(e);return(0,i.toWebpMetadata)(t)};var r=n(755854),i=n(787469)},755854:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WEBP_HEADER_SIZE=t.FOUR=t.Chunk=t.CHUNK_HEADER_SIZE=void 0,t.findWebpChunk=l,t.findWebpMetadata=function(e){if(!c(e))return __LOG__(2)`Sticker file not extended format.`,null;const t=l(e,o.EXIF);if(!t)return null;const n=e.slice(t.position,t.position+t.size);let r,i;for(let e=n.byteLength;e>0;--e)if(null==i&&n[e]===s)i=e;else if(null!=i&&0===n[e]){r=e+1;break}if(null==r||null==i)return __LOG__(3)`JSON not found in sticker file`,null;return{position:t.position+r,size:i-r+1}},t.isAnimatedWebp=function(e){const t=new Uint8Array(e);return c(t)&&0!=(2&t[20])},t.isExtendedFile=c,t.littleEndianToNumber=u,t.numberToLittleEndian=function(e){const t=new i.Binary;return t.writeUint32(e,!0),t.readByteArray()},t.stringToUint8=d;var i=n(108584),a=r(n(863438));const o=n(76672)({VP8X:"VP8X",ANMF:"ANMF",EXIF:"EXIF",XMP:"XMP "});t.Chunk=o;t.WEBP_HEADER_SIZE=12;t.CHUNK_HEADER_SIZE=8;t.FOUR=4;const s="}".charCodeAt(0);function l(e,t){const n=d(t);let r=0;for(r+=12;r<e.byteLength;){const t=e.slice(r,r+8),i=t.slice(0,4);let o=u(t.slice(4,8));if(o%2!=0&&(o+=1),(0,a.default)(i,n))return{position:r,size:o+4+4};r+=8+o}return null}function c(e){const t=e.slice(12,16);return(0,a.default)(t,d(o.VP8X))}function u(e){return e.reduce(((e,t,n)=>e+(t<<8*n)),0)}function d(e){const t=new i.Binary;return t.writeString(e),t.readByteArray()}},969667:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const n=new Uint8Array(e),a=null!==(t=(0,i.findWebpChunk)(n,i.Chunk.EXIF))&&void 0!==t?t:(0,i.findWebpChunk)(n,i.Chunk.XMP);if(null==a)return(0,r.sha256Base64)(e);const o=n.slice(0,a.position),s=o.byteLength-i.CHUNK_HEADER_SIZE;return o.set((0,i.numberToLittleEndian)(s),i.FOUR),(0,r.sha256Base64)(o)};var r=n(273045),i=n(755854)},787469:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.FIELDS=t.DEFAULT_METADATA=void 0,t.toRawWebpMetadata=function(e){const t={};null!=e.isFirstParty&&(t[a.isFirstParty]=e.isFirstParty?1:0);null!=e.isFromStickerMaker&&(t[a.isFromStickerMaker]=e.isFromStickerMaker?1:0);null!=e.emojis&&(t[a.emojis]=e.emojis);null!=e.stickerPackId&&(t[a.stickerPackId]=e.stickerPackId);null!=e.stickerPackName&&(t[a.stickerPackName]=e.stickerPackName);null!=e.stickerPackPublisher&&(t[a.stickerPackPublisher]=e.stickerPackPublisher);null!=e.stickerPackPlayStoreLink&&(t[a.stickerPackPlayStoreLink]=e.stickerPackPlayStoreLink);null!=e.stickerPackAppleStoreLink&&(t[a.stickerPackAppleStoreLink]=e.stickerPackAppleStoreLink);return t},t.toWebpMetadata=function(e){const t=e[a.isFirstParty],n=e[a.isFromStickerMaker],r=e[a.emojis],s=e[a.stickerPackId],l=e[a.stickerPackName],c=e[a.stickerPackPublisher],u=e[a.stickerPackPlayStoreLink],d=e[a.stickerPackAppleStoreLink],p=(0,i.default)({},o);null!=t&&(p.isFirstParty=1===t);null!=n&&(p.isFromStickerMaker=1===n);null!=r&&Array.isArray(r)&&(p.emojis=r);null!=s&&(p.stickerPackId=s);null!=l&&(p.stickerPackName=l);null!=c&&(p.stickerPackPublisher=c);null!=u&&(p.stickerPackPlayStoreLink=u);null!=d&&(p.stickerPackAppleStoreLink=d);return p};var i=r(n(81109));const a={isFirstParty:"is-first-party-sticker",isFromStickerMaker:"is-from-sticker-maker",emojis:"emojis",stickerPackId:"sticker-pack-id",stickerPackName:"sticker-pack-name",stickerPackPublisher:"sticker-pack-publisher",stickerPackPlayStoreLink:"android-app-store-link",stickerPackAppleStoreLink:"ios-app-store-link"};t.FIELDS=a;const o={isFirstParty:!1,isFromStickerMaker:!1,emojis:[],stickerPackId:null,stickerPackName:null,stickerPackPublisher:null,stickerPackPlayStoreLink:null,stickerPackAppleStoreLink:null};t.DEFAULT_METADATA=o},149520:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_LOOPS=t.MAX_DURATION=void 0,t.getTotalAnimationDuration=l,t.parseWebp=function(e){const t=new Uint8Array(e);if(!(0,s.isExtendedFile)(t))return __LOG__(2)`Sticker file not extended format.`,c;const{emojis:n,isFirstParty:r,isFromStickerMaker:u,stickerPackId:d,stickerPackName:p,stickerPackPublisher:f}=(0,o.getWebpMetadata)(e),_=(0,i.default)((0,i.default)({},c),{},{emojis:n,isFirstParty:r,isFromStickerMaker:u,stickerPackId:d,stickerPackName:p,stickerPackPublisher:f});if(!(0,s.isAnimatedWebp)(t))return _;let h,g=0,m=44;for(;(0,a.default)(t.slice(m,m+4),(0,s.stringToUint8)(s.Chunk.ANMF));){const e=m+20,n=t.slice(e,e+3);if(3!==n.length)return _;g+=(0,s.littleEndianToNumber)(n);const r=m+4,i=t.slice(r,r+4);if(4!==i.length)return _;m+=8+(0,s.littleEndianToNumber)(i),null==h&&(h=m)}const y=l(g);return(0,i.default)((0,i.default)({},_),{},{animationDuration:y,firstFrameLength:h,singleLoopDuration:g})};var i=r(n(81109)),a=r(n(863438)),o=n(55390),s=n(755854);t.MAX_LOOPS=3;function l(e){if(0===e)return 0;const t=Math.min(Math.floor(5e3/e),3);return Math.max(t,1)*e}t.MAX_DURATION=5e3;const c={animationDuration:0,singleLoopDuration:0,emojis:[],isFirstParty:!1,isFromStickerMaker:!1,stickerPackId:null,stickerPackName:null,stickerPackPublisher:null}},147734:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,i.randomHex)(16).substr(0,64);return __LOG__(2)`voip:generateCallId: ${e}`,e};var i=n(787614);r(n(364369))},983938:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return Promise.resolve(!1)}},522007:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateICELiteAnswerSDP=function(e,t,n,i,a,o,s){const l=(_=e,_.ip.join(".")),c=e.port+1,u=t,d=n,p=a,f=(0,r.encodeB64)(o);var _;let h=`v=0\no=- ${(new Date).getTime()} 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0${s?" 1":""}\na=ice-lite\na=msid-semantic: WMS g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\nm=audio ${c} RTP/SAVP 111\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${u}\na=ice-pwd:${d}\na=ice-options:trickle\na=setup:active\na=mid:0\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${f}\na=rtpmap:111 opus/48000/2\na=fmtp:111 useinbandfec=1\na=fmtp:111 maxplaybackrate=16000; sprop-maxcapturerate=16000\na=rtcp-fb:111 goog-remb\na=ssrc:${i} cname:noAs9WOptAnM/+QP\n`;s&&(h+=`m=video ${c} RTP/SAVP 102\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 ${l}\na=candidate:1152096416 1 udp 2113937151 ${l} ${c} typ host generation 0 network-cost 999\na=ice-ufrag:${u}\na=ice-pwd:${d}\na=ice-options:trickle\na=mid:1\na=extmap:3 urn:3gpp:video-orientation\na=sendrecv\na=msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=rtcp-mux\na=rtcp-rsize\na=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${f}\na=rtpmap:102 VP8/90000\na=rtcp-fb:102 nack\na=rtcp-fb:102 nack pli\na=rtcp-fb:102 goog-remb\na=ssrc:${p} cname:rcpcNyS/Kejuq2+Y\na=ssrc:${p} msid:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP df375ff4-7ed5-459d-b991-76c8e47ffc52\na=ssrc:${p} mslabel:g1noOjzcjYNgtJfnKdCzBmyvTozKsCGWCleP\na=ssrc:${p} label:df375ff4-7ed5-459d-b991-76c8e47ffc52\n`);return{type:"answer",sdp:h}},t.modifyOfferSDP=function(e,t,n,i,a){let o=e;if(o=o.replace(/a=crypto:[1-9].*\r\n/g,""),o=o.replace(/a=crypto:0.*/g,`a=crypto:0 AES_CM_128_HMAC_SHA1_32 inline:${(0,r.encodeB64)(i)}`),o=o.replace(/a=rtcp-fb.*transport-cc.*\r\n/g,""),o=o.replace(/a=extmap:3.*draft-holmer-rmcat.*\r\n/g,""),a){const e=o.search(/m=video/g);let r=o.substring(0,e),i=o.substring(e);r=r.replace(/ssrc:\S+/g,`ssrc:${t}`),i=i.replace(/ssrc:\S+/g,`ssrc:${n}`),i=i.replace(/a=extmap:13 urn:3gpp:video-orientation/g,"a=extmap:3 urn:3gpp:video-orientation"),o=r+i}else o=o.replace(/ssrc:\S+/g,`ssrc:${t}`);return o};var r=n(615688)},84356:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Voip=void 0,t.checkVoipCapability=function(){return Promise.resolve(!1)};var i=r(n(348926)),a=n(615688),o=n(181576),s=n(411141),l=n(40234),c=n(383674),u=r(n(544254)),d=n(978820),p=r(n(147734)),f=n(522007),_=n(669594),h=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(445473)),g=n(749835),m=n(524746),y=n(546582),S=r(n(489345)),E=r(n(277107));function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}let T=null,C=new E.default;const A={init:()=>(__LOG__(2)`voip:init`,Promise.resolve(!1)),updateAudioVideoSwitch:()=>{},cleanup:()=>{},refresh:()=>{},callStart:(e,t)=>{if(!(0,_.isVoiceCallEnabled)()&&!(0,_.isVideoCallEnabled)())throw new Error("voip:callStart: calling not enabled");if(C.getState()!==g.WEB_CALL_STATES.NONE)throw new Error("Call cannot be started because there is already a call in progress");__LOG__(2)`voip:callStart: ${e.toString()} video: ${t.toString()}`,function(){O.apply(this,arguments)}(e,t)},groupCallStart:()=>{},sendGroupCallInvite:()=>{},endCall:(b=(0,i.default)((function*(){const e=C;C.getState()===g.WEB_CALL_STATES.ACTIVE&&(yield function(){return Y.apply(this,arguments)}(C.callId,C.peerJid),(yield(0,y.requireCallCollection)()).remove(e.callId)),e.pc.close(),e.localStream.getTracks().forEach((e=>e.stop())),e.remoteAudioStream&&e.remoteAudioStream.getTracks().forEach((e=>e.stop())),e.remoteVideoStream&&e.remoteVideoStream.getTracks().forEach((e=>e.stop())),C=new E.default})),function(){return b.apply(this,arguments)}),callEndByHandledRemotely:()=>{},acceptCall:()=>{},rejectCall:()=>{},rejectCallWithoutCallCtx:()=>{},resendEncRekeyRetry:()=>{},processMissedIncomingCallMaxRetry:()=>{},mute:()=>{},videoTurnCameraOn:()=>{},videoTurnCameraOff:()=>{},videoStreamPause:()=>{},videoStreamResume:()=>{},videoRequestUpgrade:()=>{},videoAcceptUpgrade:()=>{},videoRejectUpgrade:()=>{},videoCancelUpgrade:()=>{},handleIncomingSignalingMessage:(e,t)=>(0,i.default)((function*(){const n=h.TYPE_NAME[e.type];__LOG__(2)`voip:handleIncomingSignalingMsg: type: "${n}" msg: `;const[r,i]=yield Promise.all([(0,y.requireCallCollection)(),(0,y.requireVoipCommonDisabled)()]),a=r.get(e.call_id);if(null==a?void 0:a.canHandleLocally)switch(e.type){case h.TYPE.OFFER:const n=e.peer_jid,i=e.t;if(n){const{isVideo:e,callId:r,randomBytes:a,key:o,token:s,relay:l}=function(e){const t=e[1]["call-id"];let n=null,r=null,i=null,a=null,o=!1;for(const t of e[2])__LOG__(2)`voip:offer: offerChild: `,"enc"===t[0]?a=new Uint8Array(t[2]):"video"===t[0]?o=!0:"relay"===t[0]&&([n,r,i]=V(t));if(null==n||null==r||null==i)throw new Error("Error parsing relay attributes in Offer");if(null==a)throw new Error("No random byte source found in Offer");return{callId:t,token:n,key:r,relay:i,randomBytes:a,isVideo:o}}(t.payload);yield function(e,t,n){const r=m.AUDIO_CODECS.DEFAULT,i=n?m.VIDEO_CODECS.DEFAULT:m.VIDEO_CODECS.NONE,a=r.concat(i),o=["preaccept",{"call-id":e,"call-creator":t},a.concat([m.CAPABILITIES.DEFAULT,m.ENCOPT.DEFAULT])];return(0,c.sendCallSignalingMsg)({common:{type:"preaccept",call_id:e,peer_jid:t},payload:o})}(r,n.toString({legacy:!0}),e),function(){M.apply(this,arguments)}(e,r,n,a,o,s,l,i)}break;case h.TYPE.OFFER_RECEIPT:case h.TYPE.ACCEPT_RECEIPT:case h.TYPE.MUTE:case h.TYPE.VIDEO_STATE:break;case h.TYPE.ACCEPT:C.getState()===g.WEB_CALL_STATES.OUTGOING_CALLING&&C.setState(g.WEB_CALL_STATES.ACTIVE);break;case h.TYPE.REJECT:C.getState()===g.WEB_CALL_STATES.OUTGOING_CALLING&&(C.pc.close(),C.localStream.getTracks().forEach((e=>e.stop())),C=new E.default);break;case h.TYPE.TERMINATE:C.getState()===g.WEB_CALL_STATES.ACTIVE&&(C.pc.close(),C.localStream.getTracks().forEach((e=>e.stop())),r.remove(C.callId),C=new E.default)}else i.handleIncomingSignalingMessage(e,t)}))(),isInitialized:()=>!0,registerVideoCallback:()=>{},cleanupVideoBuffer:()=>{},updateNetworkMedium:()=>{},registerWebRTCCallback:e=>{T=e},notifyDeviceIdentityChangedOrDeleted:()=>{},getNumParticipantsFromCallOffer:()=>Promise.resolve(-1)};var b;function P(){const e=new Uint8Array(32);return self.crypto.getRandomValues(e),e.buffer}function O(){return(O=(0,i.default)((function*(e,t){if(!u.default)throw new Error("Unable to request Media Devices.");const n=yield(0,u.default)({audio:!0,video:t}),r=(0,p.default)(),i=yield(0,y.requireCallCollection)();i.add({id:r,peerJid:e,offerTime:l.Clock.globalUnixTime(),isVideo:t,outgoing:!0,webClientShouldHandle:!0,canHandleLocally:!0});const a=i.assertGet(r);i.setActiveCall(a);const o=P(),s=(0,d.assertGetMe)(),c=B(),{token:f,key:_,relay:h}=yield W(o,s,e.toString({legacy:!0}),r,t);n.getTracks().forEach((e=>c.addTrack&&c.addTrack(e,n))),C.localStream=n,c.onnegotiationneeded=()=>I(c,r,s,e,o,_,f,h,t,!0),c.ontrack=e=>R(e)}))).apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e,t,n,r,i,a,o,s){(yield(0,y.requireCallCollection)()).add({id:t,peerJid:n,offerTime:s,isVideo:e,outgoing:!1,webClientShouldHandle:!0,canHandleLocally:!0});const l=(0,d.assertGetMe)();if(S.default.openVoipWindow(),yield F(t,n.toString({legacy:!0}),e),!u.default)throw new Error("Unable to request Media Devices.");const c=yield(0,u.default)({audio:!0,video:e}),p=B();c.getTracks().forEach((e=>p.addTrack&&p.addTrack(e,c))),C.localStream=c,p.onnegotiationneeded=()=>I(p,t,l,n,r.buffer,i,a,o,e,!1),p.ontrack=e=>R(e)}))).apply(this,arguments)}function I(){return w.apply(this,arguments)}function w(){return(w=(0,i.default)((function*(e,t,n,r,i,a,o,s,l,c){const[u,d]=yield x(t,n,r,i),[p,_,h,m]=yield k(t,n,r),y=yield e.createOffer();__LOG__(2,!0)`voip:original-offer: ${y.sdp}`,yield z(s,t,n.toString({legacy:!0}),r.toString({legacy:!0}),g.RELAY_INFO.RELAY_LATENCY),y.sdp&&(y.sdp=(0,f.modifyOfferSDP)(y.sdp,p,_,u,l)),__LOG__(2,!0)`voip:modified-offer: ${y.sdp}`,yield e.setLocalDescription(y),__LOG__(2,!0)`voip:localDescription: `;const S=(0,f.generateICELiteAnswerSDP)(s,o,a,h,m,d,l);__LOG__(2,!0)`voip:generated-answer: ${S.sdp}`,C.setState(c?g.WEB_CALL_STATES.OUTGOING_CALLING:g.WEB_CALL_STATES.INCOMING_CALLING),e.setRemoteDescription(S),C.pc=e,C.answer=S,C.callId=t,C.peerJid=r.toString({legacy:!0}),T&&T({type:g.WEB_CALL_EVENTS.MEDIA_READY,data:C.localStream})}))).apply(this,arguments)}function R(e){if(__LOG__(2)`voip:received-track`,!T)throw new Error("No Track callback registered.");"audio"===e.track.kind&&(C.remoteAudioStream=e.streams[0],T({type:g.WEB_CALL_EVENTS.AUDIO_TRACK_RECEIVED,data:e.streams[0]})),"video"===e.track.kind&&(C.remoteVideoStream=e.streams[0],T({type:g.WEB_CALL_EVENTS.VIDEO_TRACK_RECEIVED,data:e.streams[0]}))}function N(e,t,n,r){const i=new TextDecoder;return(0,o.extractWithSaltAndExpand)(e,t,i.decode(n),r)}function L(){return D.apply(this,arguments)}function D(){return(D=(0,i.default)((function*(e,t,n){const r=new TextEncoder,i=r.encode(e).buffer,a=r.encode(t).buffer,o=new Uint32Array([n]).buffer,s=yield N(i,o,a,32);return new Uint32Array(s)[0]}))).apply(this,arguments)}function k(e,t,n){const r=L(e,t.toString({legacy:!0,formatFull:!0}),0),i=L(e,n.toString({legacy:!0}),0),a=L(e,t.toString({legacy:!0,formatFull:!0}),2),o=L(e,n.toString({legacy:!0}),2);return Promise.all([r,a,i,o])}function U(){return G.apply(this,arguments)}function G(){return(G=(0,i.default)((function*(e,t){const n=new TextEncoder;return(yield N(e,s.DEFAULT_SALT.buffer,n.encode(t).buffer,46)).slice(0,30)}))).apply(this,arguments)}function x(e,t,n,r){const i=U(r,t.toString({legacy:!0,formatFull:!0})),a=U(r,n.toString({legacy:!0}));return Promise.all([i,a])}function B(){return new RTCPeerConnection({sdpSemantics:"unified-plan"},{mandatory:{},optional:[{DtlsSrtpKeyAgreement:!1},{RtpDataChannels:!1}]})}function F(e,t,n){const r=m.AUDIO_CODECS.DEFAULT,i=n?m.VIDEO_CODECS.DEFAULT:m.VIDEO_CODECS.NONE,a=["accept",{"call-id":e,"call-creator":t},r.concat(i).concat([["net",{medium:"3"},null],m.ENCOPT.DEFAULT])];return(0,c.sendCallSignalingMsg)({common:{type:"accept",call_id:e,peer_jid:t},payload:a})}function j(e){return["terminate",{"call-id":e},null]}function Y(){return(Y=(0,i.default)((function*(e,t){const n=j(e),r=n[0];yield(0,c.sendCallSignalingMsg)({common:{type:r,call_id:e,peer_jid:t},payload:n})}))).apply(this,arguments)}function K(e,t,n,r){const i=m.AUDIO_CODECS.DEFAULT,a=r?m.VIDEO_CODECS.DEFAULT:m.VIDEO_CODECS.NONE,o=i.concat(a);return["offer",{"call-id":t,"call-creator":n.toString({legacy:!0})},o.concat([["net",{medium:"3"},null],m.CAPABILITIES.DEFAULT,["enc",{count:"0"},Array.from(new Uint8Array(e))],m.ENCOPT.DEFAULT])]}function W(){return H.apply(this,arguments)}function H(){return(H=(0,i.default)((function*(e,t,n,r,i){const a=K(e,r,t,i),o=a[0];__LOG__(2)`voip:send:offer: payload:`;const s=yield(0,c.sendCallOffer)({common:{type:o,call_id:r,peer_jid:n},payload:a});if(!(null==s?void 0:s.status))throw new Error("Error receiving Offer Ack.");switch(s.status){case 200:if(s.payload){__LOG__(2)`voip:recv:offerAck:`;let e=null,t=null,n=null;for(const r of s.payload[2])"relay"===r[0]&&([e,t,n]=V(r));if(null==e||null==t||null==n)throw new Error("Error parsing relay attributes in Offer Ack");return{token:e,key:t,relay:n}}throw new Error("Error receiving Offer Ack: No Payload");case 409:throw new Error("Error receiving Offer Ack: Phone Busy");default:throw new Error(`Error receiving Offer Ack: Unknown status:${status}`)}}))).apply(this,arguments)}function V(e){let t=null,n=null,r=null;const i=new TextDecoder;for(const o of e[2])if("token"===o[0])t=new Uint8Array(o[2]),t=(0,a.encodeB64)(t),__LOG__(2)`voip:relay token: `;else if("key"===o[0])n=new Uint8Array(o[2]),n=i.decode(n),__LOG__(2)`voip:relay key: `;else if("te2"===o[0]){const e=new Uint8Array(o[2]);if(6===e.length){const t=new DataView(e.buffer);r={ip:[t.getUint8(0),t.getUint8(1),t.getUint8(2),t.getUint8(3)],port:t.getUint16(4)},__LOG__(2)`voip:relay address: `}}if(null==t)throw new Error("Could not extract relay token");if(null==n)throw new Error("Could not extract relay key");if(null==r)throw new Error("Could not extract relay address");return[t,n,r]}function $(e,t,n,r){const i=new ArrayBuffer(6),a=new DataView(i);a.setUint8(0,e.ip[0]),a.setUint8(1,e.ip[1]),a.setUint8(2,e.ip[2]),a.setUint8(3,e.ip[3]),a.setUint16(4,e.port);return[r,{"call-id":t,"call-creator":n},[["te",{latency:"10"},Array.from(new Int8Array(i))]]]}function z(){return q.apply(this,arguments)}function q(){return(q=(0,i.default)((function*(e,t,n,r,i){const a=$(e,t,n,i),o=a[0];yield(0,c.sendCallSignalingMsg)({common:{type:o,call_id:t,peer_jid:r},payload:a})}))).apply(this,arguments)}t.Voip=A},669594:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDeviceAgnosticVoip=function(){let e=!1;(0,i.isMDBackend)()&&(e=(0,r.getABPropConfigValue)("web_abprop_device_agnostic_voip"));return e},t.isGroupCallEnabled=function(){let e=!1;return e=!1,false},t.isStatefulEnumerationEnabled=function(){let e=!1;(0,i.isMDBackend)()&&(e=(0,r.getABPropConfigValue)("web_abprop_stateful_enumeration_enabled"));return e},t.isVideoCallEnabled=function(){let e=!1;return e=(0,a.isFeatureEnabled)("web_voip_video_call"),e},t.isVoiceCallEnabled=function(){let e=!1;return e=(0,a.isFeatureEnabled)("web_voip_voice_call"),e};var r=n(257243),i=n(88555),a=n(310206);n(964551)},445473:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_STR=t.TYPE_NAME=t.TYPE=t.ENC_RETRY_RECEIPT_ATTRS=void 0;t.TYPE={NONE:0,OFFER:1,OFFER_RECEIPT:2,ACCEPT:3,REJECT:4,TERMINATE:5,TRANSPORT:6,OFFER_ACK:7,OFFER_NACK:8,RELAY_LATENCY:9,RELAY_ELECTION:10,INTERRUPTION:11,MUTE:12,PREACCEPT:13,ACCEPT_RECEIPT:14,VIDEO_STATE:15,NOTIFY:16,GROUP_INFO:17,ENC_REKEY:18,PEER_STATE:19,VIDEO_STATE_ACK:20,FLOW_CONTROL:21,WEB_CLIENT:22,ACCEPT_ACK:23,GROUP_UPDATE:24,OFFER_NOTICE:25,MAX:26};t.TYPE_STR={OFFER:"offer",ACCEPT:"accept",ENC_REKEY:"enc_rekey",REJECT:"reject",RECEIPT:"receipt",OFFER_NOTICE:"offer_notice"};t.TYPE_NAME=["NONE","OFFER","OFFER_RECEIPT","ACCEPT","REJECT","TERMINATE","TRANSPORT","OFFER_ACK","OFFER_NACK","RELAY_LATENCY","RELAY_ELECTION","INTERRUPTION","MUTE","PREACCEPT","ACCEPT_RECEIPT","VIDEO_STATE","NOTIFY","GROUP_INFO","ENC_REKEY","PEER_STATE","VIDEO_STATE_ACK","FLOW_CONTROL","WEB_CLIENT","ACCEPT_ACK","GROUP_UPDATE","OFFER_NOTICE","MAX"];t.ENC_RETRY_RECEIPT_ATTRS={SINGLE_PARTICIPANT:"enc",GROUP_CALL:"enc_rekey_retry"}},749835:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_CALL_UI_STATES=t.WEB_CALL_STATES=t.WEB_CALL_EVENTS=t.WAVideoCodecScheme=t.WACallState=t.WACallEvent=t.WACallEndReason=t.VoipSettingsType=t.VideoUpgradeRequestEndedReason=t.VideoState=t.VOIP_WINDOW_IPC_EVENTS=t.RENDERER_IPC_EVENTS=t.RELAY_INFO=t.PlatformTypeMapping=t.ParticipantState=t.MAIN_IPC_EVENTS=t.ContentType=t.CallNetworkMedium=t.CALL_STATES=t.CALL_RESULT_TYPE=t.CALL_LOG_RESULT_TYPE=t.CALL_LOG_RESULT=void 0;const r=n(76672).Mirrored(["INCOMING","ACTIVE_VOICE","ACTIVE_VIDEO"]);t.ContentType=r;t.WACallEvent={WANone:0,CallOfferSent:1,CallOfferReceived:2,CallOfferAckedWithRelayInfo:3,CallOfferNacked:4,CallOfferReceiptReceived:5,CallAcceptFailed:6,CallAcceptSent:7,CallAcceptReceived:8,CallPreacceptReceived:9,CallTerminateReceived:10,CallRejectReceived:11,CallOfferResend:12,AudioStreamStarted:13,P2PNegotiationSuccess:14,RelayCreateSuccess:15,CallStateChanged:16,P2PNegotiationFailed:17,MediaStreamError:18,AudioInitError:19,NoSamplingRatesForAudioRecord:20,SendOfferFailed:21,HandleOfferFailed:22,SendAcceptFailed:23,HandlePreAcceptFailed:24,HandleAcceptFailed:25,WillCreateSoundPort:26,SoundPortCreateFailed:27,TransportCandSendFailed:28,P2PTransportCreateFailed:29,P2PTransportMediaCreateFailed:30,P2PTransportStartFailed:31,P2PTransportRestartSuccess:32,MissingRelayInfo:33,ErrorGatheringHostCandidates:34,MediaStreamStartError:35,RelayLatencySendFailed:36,RelayElectionSendFailed:37,CallEnding:38,CallCaptureBufferFilled:39,CallCaptureEnded:40,RxTimeout:41,TxTimeout:42,RxTrafficStarted:43,RxTrafficStopped:44,RTCPPacketReceived:45,RTCPByeReceived:46,RelayBindsFailed:47,SoundPortCreated:48,AudioDriverRestart:49,Echo:50,SelfVideoStateChanged:51,PeerVideoStateChanged:52,VideoPortCreated:53,VideoPortCreateFailed:54,VideoDecodeStarted:55,VideoRenderStarted:56,VideoCaptureStarted:57,VideoPreviewFailed:58,VideoPreviewReady:59,VideoPreviewShouldMinimize:60,VideoStreamCreateError:61,VideoRenderFormatChanged:62,VideoCodecMismatch:63,VideoDecodePaused:64,VideoDecodeResumed:65,VideoEncodeFatalError:66,VideoDecodeFatalError:67,BatteryLevelLow:68,PeerBatteryLevelLow:69,GroupInfoChanged:70,FieldstatsReady:71,PendingCallInfoChanged:72,MuteStateChanged:73,InterruptionStateChanged:74,RxTrafficStateForPeerChanged:75,HandleAcceptReceiptFailed:76,GroupParticipantLeft:77,AudioRouteChangeRequest:78,HandleAcceptAckFailed:79,CallMissed:80,WeakWiFiSwitchedToCellular:81,CallAutoConnect:82,RejectedDecryptionFailure:83,PeerDeviceOrientationChanged:84,HandleOfferAckFailed:85,PendingCallAutoRejected:86,FDLeakDetected:87,RestartCamera:88,AudioTestReplayFinished:89,SyncDevices:90,VideoCodecStateChanged:91,CallFatal:92,UpdateJoinableCallLog:93,WAMax:94};t.WAVideoCodecScheme={VideoCodecSchemeNone:0,VideoCodecSchemeH26X:1,VideoCodecSchemeVPX:2,VideoCodecSchemeVPXH26X:3};t.WACallEndReason={WACallEndReasonUnknown:0,WACallEndReasonEndButtonTapped:1,WACallEndReasonEndButtonTappedOnBusy:2,WACallEndReasonReject:3,WACallEndReasonRejectUnavailable:4,WACallEndReasonRejectBlocked:5,WACallEndReasonTimeout:6,WACallEndReasonPeerUnavailable:7,WACallEndReasonRejectedByPeer:8,WACallEndReasonTimedoutByPeer:9,WACallEndReasonTerminatedByPeer:10,WACallEndReasonFailed:11,WACallEndReasonHandledRemotely:12};t.WACallState={WACallStateNone:0,WACallStateCalling:1,WACallStatePreacceptReceived:2,WACallStateReceivedCall:3,WACallStateAcceptSent:4,WACallStateAcceptReceived:5,WACallStateCallActive:6,WACallStateCallActiveElseWhere:7,WACallStateReceivedCallWithoutOffer:8};t.WEB_CALL_UI_STATES={NONE:"NONE",OUTGOING_RING:"OUTGOING_RING",INCOMING_RING:"INCOMING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",RECONNECTING:"RECONNECTING",ACTIVE:"ACTIVE",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED"};t.CALL_STATES={INCOMING_RING:"INCOMING_RING",OUTGOING_RING:"OUTGOING_RING",OUTGOING_CALLING:"OUTGOING_CALLING",CONNECTING:"CONNECTING",CONNECTION_LOST:"CONNECTION_LOST",ACTIVE:"ACTIVE",HANDLED_REMOTELY:"HANDLED_REMOTELY",ENDED:"ENDED",REJECTED:"REJECTED",REMOTE_CALL_IN_PROGRESS:"REMOTE_CALL_IN_PROGRESS",FAILED:"FAILED",NOT_ANSWERED:"NOT_ANSWERED"};t.WEB_CALL_STATES={OUTGOING_CALLING:"OUTGOING_CALLING",INCOMING_CALLING:"INCOMING_CALLING",ACTIVE:"ACTIVE",NONE:"NONE"};t.WEB_CALL_EVENTS={MEDIA_READY:"MEDIA_STREAM_READY",AUDIO_TRACK_RECEIVED:"AUDIO_TRACK_RECEIVED",VIDEO_TRACK_RECEIVED:"VIDEO_TRACK_RECEIVED"};t.VOIP_WINDOW_IPC_EVENTS={INIT:"VOIP_WINDOW_INIT",UPDATE:"VOIP_WINDOW_UPDATE",REJECT:"VOIP_WINDOW_REJECT",ACCEPT:"VOIP_WINDOW_ACCEPT",IGNORE:"VOIP_WINDOW_IGNORE",END:"VOIP_WINDOW_END",OPEN_PRINA_MODAL:"OPEN_PRINA_MODAL",RESET:"VOIP_WINDOW_RESET",TOGGLE_MUTE:"VOIP_WINDOW_TOGGLE_MUTE",TOGGLE_CAMERA:"VOIP_WINDOW_TOGGLE_CAMERA",OPEN_IN_CALL_MENU:"OPEN_IN_CALL_MENU",CLOSE_IN_CALL_MENU:"CLOSE_IN_CALL_MENU",TOGGLE_DEBUG_INFO:"TOGGLE_DEBUG_INFO",GROUP_CALL_INVITE:"GROUP_CALL_INVITE",UPGRADE_REQUEST:"UPGRADE_REQUEST",UPGRADE_ACCEPT:"UPGRADE_ACCEPT",UPGRADE_REJECT:"UPGRADE_REJECT",UPGRADE_CANCEL:"UPGRADE_CANCEL",INITIATE_WINDOW_MOVE:"INITIATE_WINDOW_MOVE",CLOSE_WINDOW_CLICK:"CLOSE_WINDOW_CLICK",MINIMIZE_WINDOW_CLICK:"MINIMIZE_WINDOW_CLICK",MAXIMIZE_WINDOW_CLICK:"MAXIMIZE_WINDOW_CLICK",UNMAXIMIZE_WINDOW_CLICK:"UNMAXIMIZE_WINDOW_CLICK",WINDOW_MAXIMIZED:"WINDOW_MAXIMIZED",WINDOW_UNMAXIMIZED:"WINDOW_UNMAXIMIZED",WINDOW_TITLE_DBL_CLICK:"WINDOW_TITLE_DBL_CLICK",WINDOW_ESC_PRESS:"WINDOW_ESC_PRESS",WINDOW_ALWAYS_ON_TOP_CHANGED:"WINDOW_ALWAYS_ON_TOP_CHANGED",L10N_UPDATE:"L10N_UPDATE"};t.MAIN_IPC_EVENTS={EVENT:"VOIP_MAIN_WINDOW_EVENT",SIGNALING:"VOIP_MAIN_WINDOW_SIGNALING",LOGGING:"VOIP_MAIN_WINDOW_LOGGING",LOG_PATH:"VOIP_MAIN_WINDOW_LOG_PATH",AV_EVENT:"AV_DEVICE_INFO_CHANGED",AV_LOG:"AV_MAIN_WINDOW_LOGGING",AV_DEVICE_CHANGE_TOAST:"AV_DEVICE_CHANGE_TOAST",AV_DEVICE_STATUS_CHANGE:"AV_DEVICE_STATUS_CHANGE"};t.RENDERER_IPC_EVENTS={ENABLE_VOIP_FEATURES:"voip:ENABLE_VOIP_FEATURES",ENABLE_VOIP_GROUP_FEATURES:"voip:ENABLE_VOIP_GROUP_FEATURES",REQUEST_NUM_PARTICIPANTS:"voip:REQUEST_NUM_PARTICIPANTS"};t.CALL_RESULT_TYPE={INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23};t.CALL_LOG_RESULT={0:"invalid",1:"canceled",2:"missed",3:"unavailable",4:"reject",5:"connected"};t.CALL_LOG_RESULT_TYPE={INVALID:0,CANCELED:1,MISSED:2,UNAVAILABLE:3,REJECT:4,CONNECTED:5};t.VoipSettingsType={voipSettingsNone:0,voipSettingsAudio:1,voipSettingsVideo:2};t.VideoState={VideoStateDisabled:0,VideoStateEnabled:1,VideoStatePaused:2,VideoStateUpgradeRequest:3,VideoStateUpgradeAccept:4,VideoStateUpgradeReject:5,VideoStateStopped:6,VideoStateUpgradeRejectByTimeout:7,VideoStateUpgradeCancel:8,VideoStateUpgradeCancelByTimeout:9,VideoStateError:20};t.VideoUpgradeRequestEndedReason={EndedByUser:0,EndedByTimeout:1};t.ParticipantState={ParticipantStateInvalid:0,ParticipantConnected:1,ParticipantIncoming:2,ParticipantRinging:3,ParticipantRejected:4,ParticipantTerminated:5,ParticipantTimedout:6,ParticipantCreatingCall:7,ParticipantInvisible:8,ParticipantVisible:9,ParticipantCancelOffer:10};t.CallNetworkMedium={CallNetworkMediumCellular:1,CallNetworkMediumWifi:2,CallNetworkMediumNone:3};t.PlatformTypeMapping={0:"unknown",1:"android",2:"iphone",3:"wp",4:"ios_tablet",5:"kaios",6:"windows",7:"portal",8:"mac_os_electron",9:"windows_electron"};t.RELAY_INFO={RELAY_ELECTION:"relayelection",RELAY_LATENCY:"relaylatency"}},524746:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIDEO_CODECS=t.ENCOPT=t.CAPABILITIES=t.AUDIO_CODECS=void 0;t.CAPABILITIES={DEFAULT:["capability",{ver:"1"},[1,4,255,131,207,4]]};t.ENCOPT={DEFAULT:["encopt",{keygen:"2"},null]};t.AUDIO_CODECS={DEFAULT:[["audio",{enc:"opus",rate:"16000"},null],["audio",{enc:"opus",rate:"8000"},null]],RATE_16K:[["audio",{enc:"opus",rate:"16000"},null]]};t.VIDEO_CODECS={NONE:[],DEFAULT:[["video",{orientation:"0",screen_width:"1920",screen_height:"1080",device_orientation:"0",enc:"vp8",dec:"vp8"},null]]}},460620:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.initializePREMetrics=function(){(0,a.subscribe)(g),l.Cmd.on("logout",s.forceCommitAppState)};var i=n(400796),a=n(157662),o=n(549334),s=n(607414),l=n(781572),c=r(n(11339)),u=n(58597),d=n(335377),p=n(262274),f=n(205195),_=n(293824),h=n(801116);function g(e){const{name:t}=e;switch(t){case i.PRE_METRIC.SYNCD_FATAL_ERROR:!function(e){const{stage:t,annotations:n}=e;if("FAIL"!==t)return;const r=(0,o.convertSyncdFatalErrorFromAnnotations)(n);if(null==r)return void(0,h.uploadFatalErrorMetric)(c.default.MD_SYNCD_FATAL_ERROR_CODE.UNKNOWN,null);(0,h.uploadFatalErrorMetric)(function(e){switch(e){case o.SyncdFatalErrorType.PATCH_PROTOBUF_SERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_SERIALIZATION_FAILED;case o.SyncdFatalErrorType.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_SERIALIZATION_FAILED;case o.SyncdFatalErrorType.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED;case o.SyncdFatalErrorType.ENCRYPTION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.ENCRYPTION_FAILED;case o.SyncdFatalErrorType.MISSING_SNAPSHOT_VERSION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_VERSION;case o.SyncdFatalErrorType.MISSING_SNAPSHOT_MAC:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_MAC;case o.SyncdFatalErrorType.MISSING_SNAPSHOT_KEY_ID:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_SNAPSHOT_KEY_ID;case o.SyncdFatalErrorType.MISSING_PATCH_VERSION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_VERSION;case o.SyncdFatalErrorType.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:return c.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS;case o.SyncdFatalErrorType.MISSING_PATCH_SNAPSHOT_MAC:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_SNAPSHOT_MAC;case o.SyncdFatalErrorType.MISSING_PATCH_MAC:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_MAC;case o.SyncdFatalErrorType.MISSING_PATCH_KEY_ID:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_PATCH_KEY_ID;case o.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY;case o.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH;case o.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256;case o.SyncdFatalErrorType.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256;case o.SyncdFatalErrorType.MISSING_MUTATION_OPERATION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_OPERATION;case o.SyncdFatalErrorType.MISSING_MUTATION_RECORD:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_RECORD;case o.SyncdFatalErrorType.MISSING_MUTATION_INDEX:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_INDEX;case o.SyncdFatalErrorType.MISSING_MUTATION_VALUE:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_VALUE;case o.SyncdFatalErrorType.MISSING_MUTATION_KEY_ID:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_MUTATION_KEY_ID;case o.SyncdFatalErrorType.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED;case o.SyncdFatalErrorType.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED;case o.SyncdFatalErrorType.PATCH_PROTOBUF_DESERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.PATCH_PROTOBUF_DESERIALIZATION_FAILED;case o.SyncdFatalErrorType.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED;case o.SyncdFatalErrorType.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED;case o.SyncdFatalErrorType.MISSING_ACTION_INDEX:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_INDEX;case o.SyncdFatalErrorType.MISSING_ACTION_VERSION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VERSION;case o.SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:return c.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT;case o.SyncdFatalErrorType.SNAPSHOT_MAC_MISMATCH_IN_PATCH:return c.default.MD_SYNCD_FATAL_ERROR_CODE.SNAPSHOT_MAC_MISMATCH_IN_PATCH;case o.SyncdFatalErrorType.MAC_MISMATCH_PATCH:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MAC_MISMATCH_PATCH;case o.SyncdFatalErrorType.DECRYPTION_FAILED:return c.default.MD_SYNCD_FATAL_ERROR_CODE.DECRYPTION_FAILED;case o.SyncdFatalErrorType.DUPLICATE_PATCH_VERSION_IN_COLLECTION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.DUPLICATE_PATCH_VERSION_IN_COLLECTION;case o.SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:return c.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH;case o.SyncdFatalErrorType.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:return c.default.MD_SYNCD_FATAL_ERROR_CODE.SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT;case o.SyncdFatalErrorType.MISSING_ACTION_VALUE:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_VALUE;case o.SyncdFatalErrorType.MISSING_ACTION_TIMESTAMP:return c.default.MD_SYNCD_FATAL_ERROR_CODE.MISSING_ACTION_TIMESTAMP;case o.SyncdFatalErrorType.XMPP_BAD_REQUEST_FOR_COLLECTION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_FOR_COLLECTION;case o.SyncdFatalErrorType.XMPP_NOT_FOUND_FOR_COLLECTION:return c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_FOR_COLLECTION;case o.SyncdFatalErrorType.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:return c.default.MD_SYNCD_FATAL_ERROR_CODE.CYCLIC_MUTATION_DEPENDENCY_IN_PATCH;case o.SyncdFatalErrorType.SERVER_DID_NOT_SEND_ALL_PATCHES:return c.default.MD_SYNCD_FATAL_ERROR_CODE.SERVER_DID_NOT_SEND_ALL_PATCHES;case o.SyncdFatalErrorType.TERMINAL_PATCH_MISSING_DATA:return c.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_MISSING_DATA;case o.SyncdFatalErrorType.TERMINAL_PATCH_DESERIALIZATION_ERROR:return c.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_DESERIALIZATION_ERROR;case o.SyncdFatalErrorType.TERMINAL_PATCH_UNKNOWN:return c.default.MD_SYNCD_FATAL_ERROR_CODE.TERMINAL_PATCH_UNKNOWN;case o.SyncdFatalErrorType.INVALID_ACTION_INDEX:return c.default.MD_SYNCD_FATAL_ERROR_CODE.INVALID_ACTION_INDEX;case o.SyncdFatalErrorType.XMPP_BAD_REQUEST_GLOBAL_ERROR:return c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_REQUEST_GLOBAL_ERROR;case o.SyncdFatalErrorType.XMPP_NOT_FOUND_GLOBAL_ERROR:return c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_FOUND_GLOBAL_ERROR;case o.SyncdFatalErrorType.XMPP_BAD_METHOD_GLOBAL_ERROR:return c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_BAD_METHOD_GLOBAL_ERROR;case o.SyncdFatalErrorType.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:return c.default.MD_SYNCD_FATAL_ERROR_CODE.XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR;case o.SyncdFatalErrorType.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:return c.default.MD_SYNCD_FATAL_ERROR_CODE.TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D}}(r.type),null==r.collection?null:r.collection,null==r.patchSnapshotMutationCount?void 0:r.patchSnapshotMutationCount,null==r.patchVersion?void 0:r.patchVersion)}(e);break;case i.PRE_METRIC.APP_STATE_SYNC_DAILY:!function(e){const{stage:t,annotations:n}=e;if("SUCCESS"!==t)return;const r=(0,s.convertAppStateSyncDailyFromAnnotations)(n||{}),i=new c.default.MdAppStateSyncDaily;r.mutationCount>0&&(i.mutationCount=r.mutationCount);r.invalidActionCount>0&&(i.invalidActionCount=r.invalidActionCount);r.unsupportedActionCount>0&&(i.unsupportedActionCount=r.unsupportedActionCount);r.keyRotationRemoveCount>0&&(i.keyRotationRemoveCount=r.keyRotationRemoveCount);r.storedMutationCount>0&&(i.storedMutationCount=r.storedMutationCount);r.uploadConflictCount>0&&(i.uploadConflictCount=r.uploadConflictCount);r.unsetActionCount>0&&(i.unsetActionCount=r.unsetActionCount);r.missingKeyCount>0&&(i.missingKeyCount=r.missingKeyCount);i.commit()}(e);break;case i.PRE_METRIC.SYNCD_CRITICAL_EVENT:!function(e){if("FAIL"!==e.stage)return;const t=(0,o.convertSyncdCriticalEventFromAnnotations)(e.annotations);if(null==t)return;(0,_.uploadCriticalEventMetric)(function(e){switch(e){case o.SyncdCriticalEventType.MISSING_MUTATION_TO_REMOVE:return c.default.MD_SYNCD_CRITICAL_EVENT_CODE.MISSING_MUTATION_TO_REMOVE}}(t.type),t.collection)}(e);break;case i.PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE:!function(e){if("SUCCESS"!==e.stage)return;const t=(0,o.convertSyncdCriticalBootstrapStageFromAnnotations)(e.annotations);if(null==t)return;(0,u.logCriticalBootstrapStageIfNecessary)(function(e){switch(e){case o.SyncdCriticalBootstrapStageType.ABOUT_TO_APPLY_MUTATIONS:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ABOUT_TO_APPLY_MUTATIONS;case o.SyncdCriticalBootstrapStageType.APPLIED_MUTATIONS:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.APPLIED_MUTATIONS;case o.SyncdCriticalBootstrapStageType.MUTATIONS_DECRYPTED:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.MUTATIONS_DECRYPTED;case o.SyncdCriticalBootstrapStageType.REQUEST_BUILT:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.REQUEST_BUILT;case o.SyncdCriticalBootstrapStageType.RESPONSE_RECEIVED:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_RECEIVED;case o.SyncdCriticalBootstrapStageType.RESPONSE_PARSED_VALID:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.RESPONSE_PARSED_VALID;case o.SyncdCriticalBootstrapStageType.ENTERED_RETRY_MODE:return c.default.BOOTSTRAP_APP_STATE_DATA_STAGE_CODE.ENTERED_RETRY_MODE}}(t.type))}(e);break;case i.PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:!function(e){if("FAIL"!==e.stage&&"SUCCESS"!==e.stage)return;const t=(0,o.convertSyncdBootstrapAppStateDownloadFromAnnotations)(e.annotations);if(null==t)return;(0,p.commitBootstrapAppStateDownloadMetric)(t.collection,t.downloadStartTs,t.downloadSize,t.isSuccess)}(e);break;case i.PRE_METRIC.SYNCD_DECRYPT_MUTATIONS:!function(e){const{stage:t,annotations:n}=e;if("SUCCESS"!==t)return;const r=(0,o.convertSyncdDecryptMutationsMetricsFromAnnotations)(n);if(null==r)return;r.decryptedMutationMessageRangeCountArray.forEach((e=>(0,d.logMetricsForMutationLength)(e)))}(e);break;case i.PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED:!function(e){if("SUCCESS"!==e.stage)return;const t=(0,o.convertSyncdBootstrapDataAppliedFromAnnotations)(e.annotations);if(null==t)return;(0,d.logMetricsForDataApplied)(t.collection,t.snapshotUsed,t.durationMs)}(e);break;case i.PRE_METRIC.SYNCD:!function(e){const{instanceKey:t,annotations:n}=e;if("START"===e.stage){const e=new f.SyncdQPL;return e.start(),void m.set(t,e)}const r=m.get(t);if(null==r)return void __LOG__(4,void 0,new Error)`[syncd] Unknown syncd PRE instance key: ${t}`;switch(e.stage){case"POINT":r.markAnnotations(e.reason,n);break;case"SUCCESS":r.end(),m.delete(t);break;case"FAIL":r.end(!0),m.delete(t)}}(e);break;case i.PRE_METRIC.DECRYPT_MESSAGE_FINAL:case i.PRE_METRIC.FRANKING_VALIDATION:case i.PRE_METRIC.GET_DEVICES:case i.PRE_METRIC.MEDIA_DOWNLOAD:case i.PRE_METRIC.MEDIA_UPLOAD:case i.PRE_METRIC.MESSAGE_DECRYPTION:case i.PRE_METRIC.MESSAGE_ENCRYPTION:case i.PRE_METRIC.OFFLINE_QUEUE:case i.PRE_METRIC.OFFLINE_RETRY:case i.PRE_METRIC.QUERY_GROUP:case i.PRE_METRIC.QUERY_GROUPS:case i.PRE_METRIC.RETRY_RECEIPTS_SENT:case i.PRE_METRIC.SAVE_SESSION_RETRIES:case i.PRE_METRIC.SAVE_SIGNAL_SESSION_RETRIES:case i.PRE_METRIC.SEND_MESSAGE:case i.PRE_METRIC.RECEIVE_MESSAGE:__LOG__(4,void 0,new Error)`Unhandled metric event: ${t}`}}const m=new Map},689258:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitToCoreWam=function(e){if(!f)return Promise.resolve();if(!(0,s.getABPropConfigValue)("web_abprop_core_wam_runtime"))return Promise.resolve();_||S();const t=function(e){return{id:e.id,channel:e.wamChannel,psIdIntValue:e.privateStatsIdInt,fields:y(e),weight:e.weight,rawFields:[],debug:c}}(e);return(0,i.logAsync)(t.channel,t.id,t.psIdIntValue,t.fields,t.rawFields,t.weight,t.debug)},t.debugData=void 0,t.deinitializeCoreWam=function(){f=!1},t.doNotUseJustForTestUnloadCoreWamRuntime=function(){_=!1},t.getCoreWamSinkInitPromises=function(){return h},t.initializeCoreWam=function(e){if(f)return;p||((0,i.enableDebugMode)(),p=!0),d=e,S(),f=!0},t.setToCoreWam=function(e,t){if(!f)return;if(!(0,s.getABPropConfigValue)("web_abprop_core_wam_runtime"))return;_||S();(0,i.logAttributes)(m(e,t),c)},t.updatePrivateStatIdsToCore=function(e){if(!f)return;if(!(0,s.getABPropConfigValue)("web_abprop_core_wam_runtime"))return;(0,i.updatePrivateStatsIds)(e)};var i=n(507879),a=n(936376),o=n(368518),s=n(257243),l=r(n(11339));const c={name:"console-test",fieldIds:[],fieldTypes:[],fields:[]};t.debugData=c;const u=Object.freeze({integer:o.TYPES.INT,string:o.TYPES.STRING,boolean:o.TYPES.BOOL,number:o.TYPES.FLOAT,timer:o.TYPES.INT});let d,p=!1,f=!1,_=!1;const h=[];function g(e){return void 0===u[e]?o.TYPES.INT:u[e]}function m(e,t){const n=[];return n.push([...e.channels],e.id,g(e.type),null!=t?t:null),n}function y(e){const t=Object.keys(e.all),n=[];for(let r=0;r<t.length;r++){const i=l.default.METRICS.getEvent(e.$className,t[r]),a=e.all[t[r]];n.push(i.id,g(i.type),a)}return n}function S(){(0,s.getABPropConfigValue)("web_abprop_core_wam_runtime")&&(h.push((0,a.initializeWAMSink)("backend","regular",(()=>{}))),h.push((0,a.initializeWAMSink)("backend","private",(()=>{}))),Object.keys(d).forEach((e=>{(0,i.logAttributes)(function(e,t){return m(l.default.METRICS.getGlobal(e),t)}(e,d[e]),c)})),_=!0)}},991214:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.commitDeviceLinkEvent=m,t.initDeviceLinkEvent=function(){return _.apply(this,arguments)},t.setDeviceLinkPairStage=function(e){if(!d)return;f=e,m()};var i=r(n(348926)),a=n(615688),o=n(108584),s=n(273045),l=n(892844),c=n(711597),u=r(n(11339));let d=null,p=null,f=null;function _(){return(_=(0,i.default)((function*(e,t,n){d=new u.default.MdLinkDeviceCompanion;const r=yield h(e,t);p={regStartTime:n,sessionId:r}}))).apply(this,arguments)}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e,t){const n=new o.Binary;n.writeBuffer(e),n.write("_".charCodeAt(0)),n.writeBuffer(t);const r=n.readByteArray(),i=yield(0,s.sha256)(r);return(0,a.encodeB64)(i)}))).apply(this,arguments)}function m(e){const t=(0,c.getUpgradeMdWamFlag)();if(!d||!p)return;const n=p,r=(0,l.unixTimeWithoutClockSkewCorrection)()-n.regStartTime;if(null==f)return;d=new u.default.MdLinkDeviceCompanion({mdDurationS:r,mdSessionId:n.sessionId,mdTimestampS:n.regStartTime,mdWasUpgraded:t,mdLinkDeviceCompanionErrorCode:null==e?0:e,mdLinkDeviceCompanionStage:f});const i=d;i.commit(!0),null==e&&i.mdLinkDeviceCompanionStage!==u.default.MD_LINK_DEVICE_COMPANION_STAGE.COMPLETE||(d=null,p=null,f=null,(0,c.setUpgradeMdWamFlag)(!1))}},768271:(e,t)=>{"use strict";function n(){let e={},t={},n={};const r={},i=Object.getOwnPropertyNames(window),a=Object.getOwnPropertyNames(document),o=Array.prototype.slice.call(window.document.documentElement.attributes);function s(e,t){const n={};return e.map((e=>{n[e]=!!t.includes(e)})),n}return t=s(["_phantom","__nightmare","_selenium","callPhantom","callSelenium","_Selenium_IDE_Recorder"],i),e=s(["__webdriver_evaluate","__selenium_evaluate","__webdriver_script_function","__webdriver_script_func","__webdriver_script_fn","__fxdriver_evaluate","__driver_unwrapped","__webdriver_unwrapped","__driver_evaluate","__selenium_unwrapped","__fxdriver_unwrapped"],a),n=s(["selenium","webdriver","driver"],o),t.wd=window.navigator.webdriver,r.wKeys=t,r.dKeys=e,r.dElKeys=n,r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={getAutoToolsProperties:()=>({data:n()})};t.default=r},307902:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logFingerprintToWam=function(){const e=i.default.getAutoToolsProperties(),t={webcDocumentWebdriverEvaluate:e.data.dKeys.__webdriver_evaluate,webcDocumentSeleniumEvaluate:e.data.dKeys.__selenium_evaluate,webcDocumentWebdriverScriptFunction:e.data.dKeys.__webdriver_script_function,webcDocumentWebdriverScriptFunc:e.data.dKeys.__webdriver_script_func,webcDocumentWebdriverScriptFn:e.data.dKeys.__webdriver_script_fn,webcDocumentFxdriverEvaluate:e.data.dKeys.__fxdriver_evaluate,webcDocumentDriverUnwrapped:e.data.dKeys.__driver_unwrapped,webcDocumentWebdriverUnwrapped:e.data.dKeys.__webdriver_unwrapped,webcDocumentDriverEvaluate:e.data.dKeys.__driver_evaluate,webcDocumentSeleniumUnwrapped:e.data.dKeys.__selenium_unwrapped,webcDocumentFxdriverUnwrapped:e.data.dKeys.__fxdriver_unwrapped,webcDocumentElementAttrSelenium:e.data.dElKeys.selenium,webcDocumentElementAttrWebdriver:e.data.dElKeys.webdriver,webcDocumentElementAttrDriver:e.data.dElKeys.driver,webcWindowPhantom:e.data.wKeys._phantom,webcWindowNightmare:e.data.wKeys.__nightmare,webcWindowSelenium:e.data.wKeys._selenium,webcWindowCallphantom:e.data.wKeys.callPhantom,webcWindowCallselenium:e.data.wKeys.callSelenium,webcWindowSeleniumIdeRecorder:e.data.wKeys._Selenium_IDE_Recorder,webcWindowNavigatorWebdriver:!0===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.TRUE:!1===e.data.wKeys.wd?a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.FALSE:a.default.WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE.UNDEFINED};new a.default.WebcFingerprint(t).commit()};var i=r(n(768271)),a=r(n(11339))},542515:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.capCount=s,t.getGroupCountMetricsFromChatWid=function(e){if(null!=e&&e.isGroup()){const t=n(963928).default.get(e);if(null!=t)return l(t)}},t.getGroupCountMetricsFromGroupMetadata=l,t.getGroupMetricsFromChatWid=function(e){if(null!=e&&e.isGroup()){const t=n(963928).default.get(e);if(null!=t){const e=(0,i.default)({},l(t));return null!=t.cachedDeviceSizeBucket&&(e.deviceSizeBucket=t.cachedDeviceSizeBucket),e}}},t.getGroupTypeFromChatWid=function(e){if(null!=e&&e.isGroup()){const t=n(963928).default.get(e);if(null!=t)return c(t)}},t.getGroupTypeFromGroupMetadata=c;var i=r(n(81109)),a=r(n(11339)),o=n(455981);function s(e){return Math.max(e,32)}function l(e){let t=Object.freeze({});const n=e.participants.length;null!=n&&(t=(0,i.default)({participantCount:s(n)},t));const r=e.cachedDeviceCount;return null!=r&&(t=(0,i.default)({deviceCount:s(r)},t)),t}function c(e){return e.groupType===o.GroupType.DEFAULT_ANNOUNCEMENT_GROUP?a.default.TYPE_OF_GROUP_ENUM.DEFAULT_SUBGROUP:e.groupType===o.GroupType.SUBGROUP?a.default.TYPE_OF_GROUP_ENUM.SUBGROUP:a.default.TYPE_OF_GROUP_ENUM.GROUP}},550047:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logLabelOperationEvent=function(e,t,n){const r={labelOperation:e};null!=t&&Object.assign(r,{labelCount:t});n&&Object.assign(r,{labelTarget:n});new i.default.LabelEvent(r).commit()};var i=r(n(11339))},488353:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WamContext=void 0;var i=n(615688),a=n(108584),o=n(487278),s=r(n(11339)),l=n(929590),c=n(356768);t.WamContext=class{constructor(e,t,n){this.bufferKey=e,this.buffer=new a.Binary(void 0,!0),this.buffer.writeString("WAM"),this.buffer.writeUint8(c.WAM_PROTOCOL_VERSION),this.buffer.writeUint8(1),this.buffer.writeUint16(t),"regular"===this.bufferKey?this.buffer.writeUint8(0):this.buffer.writeUint8(2),this.eventsWritten=0,this.prevGlobals={},this.dirtyGlobals={},this.unsavedPortion=null,this.saveKey=String(1e9*Math.random()|0),n&&this._setAll(n)}size(){return this.buffer.size()}set(e,t){this.dirtyGlobals[String(e)]=t,this.unsavedPortion&&this.unsavedPortion.set(e,t)}write(e){const t=this.buffer;this.set(47,e.commitTime),this.set(3433,e.sequenceNumber),"private"===e.wamChannel&&this.set(6005,(0,l.getLatestPrivateStatsIdValueFromKey)(this.bufferKey).toString()),this._flushGlobals();const n=e.all,r=Object.keys(n);let i=-1,a=!1;for(let e=0;e<r.length;e++){null!=n[r[e]]&&(i=e,a=!0)}(0,o.writeEvent)(t,e.id,-e.weight,a);for(let l=0;l<=i;l++){const c=r[l],u=s.default.METRICS.getEvent(e.$className,c).id;let d=n[c];null!=d&&("boolean"==typeof d&&(d=d?1:0),a=l<i,(0,o.writeField)(t,u,d,a))}this.eventsWritten++,this.unsavedPortion&&this.unsavedPortion.write(e)}stringBuffer(){return this.eventsWritten>0?(0,i.encodeB64)(this.buffer.peek((e=>e.readByteArray()))):""}getBuffer(){return this.buffer}_setAll(e){const t="regular"===this.bufferKey?"regular":"private";for(const n in e){const r=e[n],i=s.default.METRICS.getGlobal(n).channels.includes(t);void 0!==r&&i&&this.set(s.default.METRICS.getGlobal(n).id,r)}}_flushGlobals(){const e=this.dirtyGlobals,t=this.prevGlobals;for(const n in e){let r=e[n];if("boolean"==typeof r)r=r?1:0;else if(void 0===r)r=null;else if(Number.isNaN(r))continue;if(r!==t[n]){t[n]=r;const e=parseInt(n,10);(0,o.writeGlobalAttribute)(this.buffer,e,r)}}this.dirtyGlobals={}}upgradeWamHeaderFromV3ToV5(e){if(!n(257243).getABPropConfigValue("web_wam_v5_enabled")||this.buffer.size()<4)return this.buffer;const[t,r]=this.buffer.peek((e=>[e.readString(3),e.readUint8()]));if(3===r){const n=new a.Binary(void 0,!0);n.writeString(t),n.writeUint8(5),n.writeUint8(1),n.writeUint16(e),"regular"===this.bufferKey?n.writeUint8(0):n.writeUint8(2);const r=this.buffer.peek((e=>e.readByteArray())).slice(4);n.write(r),this.buffer=n}return this.buffer}}},487278:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeEvent=function(e,t,n,r){return i(e,t,n,r?1:5)},t.writeField=function(e,t,n,r){return i(e,t,n,r?2:6)},t.writeGlobalAttribute=function(e,t,n){return i(e,t,n,0)};var r=n(108584);function i(e,t,n,i){if(null==n)0===i&&a(e,t,i);else if("number"==typeof n&&n===(0|n))0===n?a(e,t,16|i):1===n?a(e,t,32|i):-128<=n&&n<128?(a(e,t,48|i),e.writeInt8(n)):-32768<=n&&n<32768?(a(e,t,64|i),e.writeInt16(n)):(a(e,t,80|i),e.writeInt32(n));else if("number"==typeof n)a(e,t,112|i),e.writeFloat64(n);else if("string"==typeof n){const o=(0,r.numUtf8Bytes)(n);o<256?(a(e,t,128|i),e.writeUint8(o)):o<65536?(a(e,t,144|i),e.writeUint16(o)):(a(e,t,160|i),e.writeUint32(o)),e.writeString(n)}}function a(e,t,n){t<256?(e.writeUint8(n),e.writeUint8(t)):(e.writeUint8(8|n),e.writeUint16(t))}},834894:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11339));const a={document:i.default.MEDIA_TYPE.DOCUMENT,video:i.default.MEDIA_TYPE.VIDEO,gif:i.default.MEDIA_TYPE.GIF,image:i.default.MEDIA_TYPE.PHOTO,audio:i.default.MEDIA_TYPE.AUDIO};t.default=class{constructor(e,t,n){this.mediaPickerSentUnchanged=0,this.mediaPickerDeleted=0,this.mediaPickerChanged=new Set,this.mediaPickerCroppedRotated=new Set,this.mediaPickerDrawing=new Set,this.mediaPickerStickers=new Set,this.mediaPickerText=new Set,this.mediaPickerLikeDoc=0,this.mediaPickerNotLikeDoc=0,this.mediaPickerT=0,this.t0=Date.now(),this.mediaType=a[t],this.mediaPickerOrigin=n,this.medias=new Set,this.medias.add(e),this.changeTypes={mediaPickerCroppedRotated:this.mediaPickerCroppedRotated,mediaPickerDrawing:this.mediaPickerDrawing,mediaPickerStickers:this.mediaPickerStickers,mediaPickerText:this.mediaPickerText}}onAdd(e){this.medias.add(e),"document"===this.mediaType?this.mediaPickerLikeDoc++:this.mediaPickerNotLikeDoc++}onChange(e,t){this.mediaPickerChanged.add(e),this.changeTypes[t].add(e)}onDelete(e){if(this.medias.delete(e),this.mediaPickerDeleted++,0===this.medias.size)return this.onCancel()}onSend(){return this.mediaPickerSent=this.medias.size,this.mediaPickerSentUnchanged=this.mediaPickerSent-this.mediaPickerChanged.size,this.dataPreflight()}onCancel(){return this.mediaPickerSent=0,this.mediaPickerSentUnchanged=0,this.dataPreflight()}onPause(){this.mediaPickerT+=Date.now()-(this.t0||0),this.t0=null}onResume(){this.t0=null!=this.t0?this.t0:Date.now()}dataPreflight(){let e=this.mediaPickerSentUnchanged;return isNaN(e)&&(e=0,__LOG__(4,void 0,new Error,!0)`mediaPickerSentUnchange mediaPickerSent: ${null!=this.mediaPickerSent&&0!==this.mediaPickerSent?this.mediaPickerSent:"undefined"}, mediaPickerChanged: ${this.mediaPickerChanged.size||"undefined"}`,SEND_LOGS("mediaPickerSentUnchange is not a number")),{mediaPickerSent:this.mediaPickerSent,mediaPickerSentUnchanged:e,mediaPickerT:this.mediaPickerT+(Date.now()-(this.t0||0)),mediaType:this.mediaType,mediaPickerOrigin:this.mediaPickerOrigin,mediaPickerChanged:this.mediaPickerChanged.size,mediaPickerCroppedRotated:this.mediaPickerCroppedRotated.size,mediaPickerDrawing:this.mediaPickerDrawing.size,mediaPickerStickers:this.mediaPickerStickers.size,mediaPickerText:this.mediaPickerText.size,mediaPickerLikeDoc:this.mediaPickerLikeDoc,mediaPickerNotLikeDoc:this.mediaPickerNotLikeDoc,mediaPickerDeleted:this.mediaPickerDeleted}}}},690535:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPickerStatsLogger=t.MediaPickerChangeTypes=void 0;var i=r(n(81109)),a=r(n(834894)),o=r(n(11339));t.MediaPickerChangeTypes={mediaPickerCroppedRotated:"mediaPickerCroppedRotated",mediaPickerDrawing:"mediaPickerCroppedRotated",mediaPickerStickers:"mediaPickerCroppedRotated",mediaPickerText:"mediaPickerCroppedRotated"};t.MediaPickerStatsLogger=class{constructor(){this.mediaByTypeAndOrigin=new Map,this.mediaEventReverseIndex=new Map,this.chatRecipients=null}pauseTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onPause()}))}resumeTimer(){this.mediaByTypeAndOrigin.forEach((e=>{e.onResume()}))}_getKey(e,t){return`${e}_${t}`}_commitLog(e){new o.default.MediaPicker((0,i.default)((0,i.default)({},e),{},{chatRecipients:this.chatRecipients})).commit()}_processNewMedia(e,t,n){const r=this._getKey(t,n),i=this.mediaByTypeAndOrigin.get(r);if(i)i.onAdd(e),this.mediaEventReverseIndex.set(e,i);else{const i=new a.default(e,t,n);this.mediaByTypeAndOrigin.set(r,i),this.mediaEventReverseIndex.set(e,i)}}logChange(e,t){const n=this.mediaEventReverseIndex.get(e);n&&n.onChange(e,t)}logDelete(e){const t=this.mediaEventReverseIndex.get(e);t&&t.onDelete(e)}logSend(e){this.mediaByTypeAndOrigin.forEach((t=>{this._commitLog((0,i.default)((0,i.default)({},t.onSend()),{},{isViewOnce:e.isViewOnce}))}))}logCancel(){this.mediaByTypeAndOrigin.forEach((e=>{this._commitLog(e.onCancel())}))}logAdd(e,t,n){this.mediaEventReverseIndex.get(e)||this._processNewMedia(e,t,n)}}},529992:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.generateMediaEventId=function(){return 1+Math.floor(Number.MAX_SAFE_INTEGER*Math.random())},t.getMetricBackendStore=function(e){if(!e)return o.default.BACKEND_STORE_TYPE.NON_DIRECT_PATH;switch(e.slice(0,2).toLowerCase()){case"/v":return o.default.BACKEND_STORE_TYPE.EVERSTORE;case"/o":return o.default.BACKEND_STORE_TYPE.OIL}return __LOG__(4,void 0,new Error,!0)`Unrecognized direct path type`,SEND_LOGS("unrecognized-direct-path-type"),null},t.getMetricDownloadErrorResultType=function(e){if(e instanceof l.MMSThrottleError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof s.NoMediaHostsError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e instanceof a.HttpNetworkError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_NETWORK;if(e instanceof a.HttpStatusCodeError)switch(e.status){case 404:case 410:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_TOO_OLD;case 416:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANNOT_RESUME;case 401:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_INVALID_URL;case 429:case 507:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_THROTTLE;default:return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN}if(e.name===i.ABORT_ERROR)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof a.MmsDownloadFilehashMismatchError)return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_ENC_HASH_MISMATCH;return o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getMetricMediaType=function(e){switch(e){case"audio":return o.default.MEDIA_TYPE.AUDIO;case"document":case"thumbnail-document":return o.default.MEDIA_TYPE.DOCUMENT;case"gif":return o.default.MEDIA_TYPE.GIF;case"image":case"thumbnail-image":return o.default.MEDIA_TYPE.PHOTO;case"ppic":return o.default.MEDIA_TYPE.PROFILE_PIC;case"product":return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case"ptt":return o.default.MEDIA_TYPE.PTT;case"sticker":return o.default.MEDIA_TYPE.STICKER;case"video":case"thumbnail-video":return o.default.MEDIA_TYPE.VIDEO;case"template":return o.default.MEDIA_TYPE.TEMPLATE;case"md-msg-hist":return o.default.MEDIA_TYPE.MD_HISTORY_SYNC;case"md-app-state":return o.default.MEDIA_TYPE.MD_APP_STATE;case"product-catalog-image":return o.default.MEDIA_TYPE.PRODUCT_IMAGE;case"thumbnail-link":return o.default.MEDIA_TYPE.URL;case"payment-bg-image":case"biz-cover-photo":return o.default.MEDIA_TYPE.NONE;default:throw new Error(`webMediaType is invalid: ${e}`)}},t.getMetricOverallDownloadModeType=function(e,t,n){if(c(e))return o.default.MEDIA_DOWNLOAD_MODE_TYPE.THUMBNAIL;if("manual"===t)return o.default.MEDIA_DOWNLOAD_MODE_TYPE.MANUAL;if(n)return o.default.MEDIA_DOWNLOAD_MODE_TYPE.PREFETCH;return o.default.MEDIA_DOWNLOAD_MODE_TYPE.FULL},t.getMetricOverallUploadModeType=function(e){if(c(e))return o.default.MEDIA_UPLOAD_MODE_TYPE.THUMBNAIL;return o.default.MEDIA_UPLOAD_MODE_TYPE.REGULAR},t.getMetricUploadErrorResultType=function(e){if(e instanceof l.MMSUnauthorizedError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_NO_PERMISSIONS;if(e instanceof l.MediaTooLargeError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_BAD_MEDIA;if(e instanceof l.MMSThrottleError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_THROTTLE;if(e instanceof a.HttpStatusCodeError&&e.status>=500)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_SERVER;if(e instanceof s.NoMediaHostsError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_MEDIA_CONN;if(e.name===i.ABORT_ERROR)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_CANCEL;if(e instanceof a.HttpNetworkError)return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UPLOAD;return o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN},t.getStatusCode=function(e){if(e instanceof a.HttpStatusCodeError)return e.status},t.logErrorUnknownDetails=function(e,t){if(null==t)return;let n;e.overallDownloadResult===o.default.MEDIA_DOWNLOAD_RESULT_TYPE.ERROR_UNKNOWN?n=o.default.WEBC_MEDIA_OPERATION_CODE.DOWNLOAD:e.overallUploadResult===o.default.MEDIA_UPLOAD_RESULT_TYPE.ERROR_UNKNOWN&&(n=o.default.WEBC_MEDIA_OPERATION_CODE.UPLOAD);if(null==n)return;new o.default.WebcMediaErrorUnknownDetails({mediaId:e.mediaId,webcMediaOperation:n,webcMediaErrorName:t.name}).commit()};var i=n(389385),a=n(923082),o=r(n(11339)),s=n(840859),l=n(727856);function c(e){switch(e){case"thumbnail-document":case"thumbnail-image":case"thumbnail-video":case"thumbnail-link":return!0}return!1}},751708:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfReporter=void 0;var i=n(542515),a=r(n(11339)),o=r(n(757362));t.MessageSendPerfReporter=class{constructor(e,t,n){this._messageIsInvisible=!1,this._messageIsFirstUserMessage=!1,this._isRevokeMessage=!1,this._isDirectedMessage=!1,this._startTime=Date.now(),this._stagesMap=new Map,this._mediaType=t,this._messageType=n,this._cacheGroupMetadata(e)}setFetchedPrekeyCount(e){this._fetchedPrekeyCount=e}setSenderKeyDistributionCount(e){this._senderKeyDistributionCount=e}setMessageIsInvisible(e){this._messageIsInvisible=e}setMessageIsFirstUserMessage(e){this._messageIsFirstUserMessage=e}setIsRevokeMessage(e){this._isRevokeMessage=e}setIsDirectedMessage(e){this._isDirectedMessage=e}startRenderedStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}postRenderedStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_RENDERED)}startSavedStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}postSavedStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_SAVED)}startPrekeysFetchStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}postPrekeysFetchStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_PREKEYS_FETCH)}startWrittenWireStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}postWrittenWireStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WRITTEN_WIRE)}startWaitingToEncryptStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WAITING_TO_ENCRYPT)}postWaitingToEncryptStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_WAITING_TO_ENCRYPT)}startReadyToSendStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}postReadyToSendStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_READY_TO_SEND)}startClientEncryptStage(){this._start(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}postClientEncryptStage(){this._post(a.default.CLIENT_MESSAGE_SEND_STAGE.CLIENT_ENCRYPT)}_start(e){const t=new a.default.AndroidMessageSendPerf({sendStage:e});return this._stagesMap.set(e,t),t}_post(e){const t=this._stagesMap.get(e)||this._start(e);if(t.mediaType=this._mediaType,t.messageType=this._messageType,t.messageIsInvisible=this._messageIsInvisible,t.messageIsFirstUserMessage=this._messageIsFirstUserMessage,t.durationRelative=Date.now()-this._startTime,t.fetchPrekeys=null!=this._fetchedPrekeyCount&&this._fetchedPrekeyCount>0,t.isRevokeMessage=this._isRevokeMessage,t.isDirectedMessage=this._isDirectedMessage,this._groupMetadata){t.groupSizeBucket=(0,o.default)(this._groupMetadata.participants.length),null!=this._groupMetadata.cachedDeviceSizeBucket&&(t.deviceSizeBucket=this._groupMetadata.cachedDeviceSizeBucket),Object.assign(t,(0,i.getGroupCountMetricsFromGroupMetadata)(this._groupMetadata)),t.typeOfGroup=(0,i.getGroupTypeFromGroupMetadata)(this._groupMetadata);const e=this._groupMetadata.cachedDeviceCount||0;e>0&&(null!=this._fetchedPrekeyCount&&(t.fetchPrekeysPercentage=Math.round(this._fetchedPrekeyCount/e*100)),null!=this._senderKeyDistributionCount&&(t.senderKeyDistributionCountPercentage=Math.round(this._senderKeyDistributionCount/e*100)))}null!=t.fetchPrekeysPercentage&&t.fetchPrekeysPercentage>=50||t.messageIsFirstUserMessage?t.weight=0:null!=t.senderKeyDistributionCountPercentage&&t.senderKeyDistributionCountPercentage>=50?t.weight=20:t.deviceSizeBucket!==a.default.SIZE_BUCKET.LT5000&&t.deviceSizeBucket!==a.default.SIZE_BUCKET.LARGEST_BUCKET||(t.weight=100),t.markDurationAbs(),t.commit()}_cacheGroupMetadata(e){if(null!=e&&e.isGroup()){const t=n(963928).default.get(e);null!=t&&(this._groupMetadata=t)}}}},70500:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendReporter=void 0;var i=r(n(81109)),a=n(408139),o=n(115461),s=n(978820),l=n(542515),c=r(n(11339)),u=r(n(616786));t.MessageSendReporter=class{constructor(e){this._isPosted=!1,this._wid=e.to;let t=Boolean(e.caption);if((0,a.documentWithCaptionsSendEnabled)()&&e.type===o.MSG_TYPE.DOCUMENT&&(t=e.isCaptionByUser),this._metric=new c.default.MessageSend((0,i.default)({messageType:e.getWamMessageType(),messageMediaType:e.getWamMediaType(),mediaCaptionPresent:t,fastForwardEnabled:!0,messageIsFanout:!0,messageIsForward:Boolean(e.isForwarded),isViewOnce:Boolean(e.isViewOnce),isAReply:e.isReply()},(0,l.getGroupMetricsFromChatWid)(e.to))),null!=e.ephemeralDuration&&(this._metric.ephemeralityDuration=e.ephemeralDuration),!e.isGroupMsg){const t=(0,s.getMaybeMeUser)(),r=n(728307).getDisappearingModeSettingForUser,i=r(t);null!=i&&(this._metric.senderDefaultDisappearingDuration=i.duration);const a=r(e.to);null!=a&&(this._metric.receiverDefaultDisappearingDuration=a.duration)}e.isRevoke&&(this._metric.messageIsRevoke=!0,this._metric.revokeType="admin_revoke"===e.subtype?c.default.REVOKE_TYPE.ADMIN:c.default.REVOKE_TYPE.SENDER,this._metric.revokeDuration=e.revokeDuration);const r=e.getWamDisappearingModeInitiator();null!=r&&(this._metric.disappearingChatInitiator=r);const u=(0,l.getGroupTypeFromChatWid)(e.to);null!=u&&(this._metric.typeOfGroup=u)}setDeviceCount(e){this._metric.deviceCount=(0,l.capCount)(e),this._metric.deviceSizeBucket=(0,u.default)(e)}postSuccess(){this._metric.messageSendResult=c.default.MESSAGE_SEND_RESULT_TYPE.OK,this._metric.messageSendResultIsTerminal=!1,this._post()}postFailure(e){let{result:t,isTerminal:n}=e;this._metric.messageSendResult=t,this._metric.messageSendResultIsTerminal=n,this._post()}_post(){if(this._isPosted)return void __LOG__(3)`MessageSendReporter: skip posting, metric has already been posted`;const e=(0,l.getGroupMetricsFromChatWid)(this._wid);null==this._metric.deviceCount?Object.assign(this._metric,e):null!=(null==e?void 0:e.participantCount)&&(this._metric.participantCount=e.participantCount),this._isPosted=!0,this._metric.markMessageSendT(),this._metric.commit()}}},999588:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logMessageCounts=function(e,t){e.webcMessageCount+=t.length;for(let n=0,r=t[n];n<t.length;++n,r=t[n])switch(r.type){case i.MSG_TYPE.CHAT:case i.MSG_TYPE.LOCATION:case i.MSG_TYPE.PAYMENT:case i.MSG_TYPE.VCARD:case i.MSG_TYPE.CIPHERTEXT:case i.MSG_TYPE.MULTI_VCARD:case i.MSG_TYPE.REVOKED:case i.MSG_TYPE.OVERSIZED:e.webcTextMessageCount+=1;break;case i.MSG_TYPE.IMAGE:case i.MSG_TYPE.PRODUCT:e.webcPhotoMessageCount+=1;break;case i.MSG_TYPE.VIDEO:e.webcVideoMessageCount+=1;break;case i.MSG_TYPE.AUDIO:e.webcAudioMessageCount+=1;break;case i.MSG_TYPE.PTT:e.webcPttMessageCount+=1;break;case i.MSG_TYPE.STICKER:e.webcStickerMessageCount+=1;break;case i.MSG_TYPE.DOCUMENT:e.webcDocumentMessageCount+=1;break;default:e.webcOtherMessageCount+=1}},t.newMessageQueryEvent=function(e){return new a.default.WebcMessageQuery({webcResponseBytes:0,webcMessageCount:0,webcTextMessageCount:0,webcVideoMessageCount:0,webcPhotoMessageCount:0,webcAudioMessageCount:0,webcPttMessageCount:0,webcStickerMessageCount:0,webcDocumentMessageCount:0,webcOtherMessageCount:0,webcMessageQueryTrigger:e})};var i=n(115461),a=r(n(11339))},881861:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.maybePostMessageHighRetryCountMetric=function(e,t){if(e<s.MAX_RETRY)return;const r=new l.default.MessageHighRetryCount({retryCount:e}),c=function(e){switch(e){case o.MESSAGE_TYPE.CHAT:return l.default.MESSAGE_TYPE.INDIVIDUAL;case o.MESSAGE_TYPE.GROUP:return l.default.MESSAGE_TYPE.GROUP;case o.MESSAGE_TYPE.PEER_BROADCAST:case o.MESSAGE_TYPE.OTHER_BROADCAST:return l.default.MESSAGE_TYPE.BROADCAST;case o.MESSAGE_TYPE.DIRECT_PEER_STATUS:case o.MESSAGE_TYPE.OTHER_STATUS:return l.default.MESSAGE_TYPE.STATUS;default:return null}}(t.type);null!=c&&(r.messageType=c);const u=function(e){var t;if(!(e instanceof a.default))return null;return e.user===(null===(t=(0,i.getMaybeMeUser)())||void 0===t?void 0:t.user)?e.isCompanion()?l.default.E2E_SENDER_TYPE.MY_COMPANION:l.default.E2E_SENDER_TYPE.MY_PRIMARY:e.isCompanion()?l.default.E2E_SENDER_TYPE.OTHER_COMPANION:l.default.E2E_SENDER_TYPE.OTHER_PRIMARY}(t.author);null!=u&&(r.e2eSenderType=u);const d=t.chat;if(null==d?void 0:d.isGroup()){const e=n(963928).default.get(d);null!=(null==e?void 0:e.cachedDeviceSizeBucket)&&(r.deviceSizeBucket=e.cachedDeviceSizeBucket)}r.commit()};var i=n(978820),a=r(n(389867)),o=n(49714),s=n(779711),l=r(n(11339))},820017:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.maybePostPrekeysDepletionMetric=function(e){let{count:t,prekeysFetchReason:r,messageType:a,chatId:o}=e;if(null==t||0===t)return;const s={};null!=r&&(s.prekeysFetchReason=r);null!=a&&(s.messageType=a);if(null!=o&&o.isGroup()){const e=n(963928).default.get(o);null!=(null==e?void 0:e.cachedDeviceSizeBucket)&&(s.deviceSizeBucket=e.cachedDeviceSizeBucket)}setTimeout((()=>{for(let e=0;e<t;e++)new i.default.PrekeysDepletion(s).commit()}),0)};var i=r(n(11339))},731958:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.postSenderKeyExpiredMetric=function(e){let{chatId:t,expiryReason:n,deviceCount:r}=e;const s=new a.default.SenderKeyExpired;null!=n&&(s.expiryReason=n);if(null!=t){const e=(0,i.createWidFromWidLike)(t);e.isGroup()?s.chatType=a.default.MESSAGE_CHAT_TYPE.GROUP:e.isBroadcast()?s.chatType=a.default.MESSAGE_CHAT_TYPE.BROADCAST:e.isUser()&&(s.chatType=a.default.MESSAGE_CHAT_TYPE.INDIVIDUAL)}null!=r&&r>0&&(s.deviceSizeBucket=(0,o.default)(r));s.commit()};var i=n(745454),a=r(n(11339)),o=r(n(616786))},11339:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(552211);const{BOOLEAN:o,INTEGER:s,NUMBER:l,STRING:c,TIMER:u}=a.TYPES,d=Object.freeze({ACTION_SWIPED_CAROUSEL:0,ACTION_CLICKED_TOS:1,ACTION_CLICKED_START_PREMIUM:2,ACTION_CLICKED_MANAGE_SUBSCRIPTION:3,ACTION_VIEW_IMPRESSION_PREMIUM_HOME:4,ACTION_VIEW_IMPRESSION_MANAGE_SUBSCRIPTION_DIALOG:5,ACTION_CLICKED_ENTRY_POINT:6}),p=Object.freeze({INVALID_PROTOCOL_BUFFER:1}),f=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_DEVICE_IDENTITY:2,ADV_SIGNED_KEY_INDEX_LIST:3,ADV_KEY_INDEX_LIST:4}),_=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),h=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),g=Object.freeze({LIMITED:0,FULL:1,LEGACY:2,LEVEL_3:3,EXTERNAL:4}),m=Object.freeze({API_1:1,API_2:2}),y=Object.freeze({NOT_AVAILABLE:1,SELF_TEST_FAILURE:2,ENC_KEY_READ_FAILURE:3,ENC_KEY_STORED_USED:4,ENC_KEY_PLAIN_DELETED:5,ENC_KEY_PLAIN_RECOVERED:6}),S=Object.freeze({DEBUG:1,ALPHA:2,BETA:3,RELEASE:4}),E=Object.freeze({FOREGROUND:1,BACKGROUND:2}),v=Object.freeze({JNI:1,OPENSLES:2}),T=Object.freeze({AUTO_REPLY_ACTION_FLAG_RECEIVED:0,AUTO_REPLY_ACTION_REPLY_SENT:1}),C=Object.freeze({NON_DIRECT_PATH:1,EVERSTORE:2,OIL:3}),A=Object.freeze({WIFI_ONLY:0,WIFI_OR_CELLULAR:1}),b=Object.freeze({OFF:0,DAILY:1,WEEKLY:2,MONTHLY:3,MANUAL:4}),P=Object.freeze({SHOWN:1,CLICK:2,DISMISS:3,ELIGIBLE:4,REVOKED:5}),O=Object.freeze({GROUP:1,SMB_WELCOME:2,SMB_VERIFIED:3,SMB_EDIT_PROFILE:4,SMB_EDIT_DESCRIPTION:5,SMB_EDIT_CATEGORY:6,SMB_EDIT_HOURS:7,SMB_EDIT_EMAIL:8,SMB_CATALOG:9,SMB_CATALOG_SHARE_BANNER:10,CROSS_SELL_PROFILE_INTERSTITIAL:11,CROSS_SELL_CHATS_INTERSTITIAL:12,CROSS_SELL_CHATS_BANNER:13,BUSINESS_ACCOUNT_SYSTEM_MESSAGE:14,SMB_CATALOG_CART_INTERSTITIAL:15,PAYMENTS_ONBOARD_BANNER:16,SMB_DIRECTORY_UPSELL:17,SMB_CATALG_LIST_LWI_ADVERTISE_BANNER:18,SMB_LWI_AD_HUB_EDUCATIONAL_BANNER:19,SMB_COLLECTION_CREATION:20,SMB_AWAY_MESSAGE:21,SMB_GREETING_MESSAGE:22,PAYMENTS_INCENTIVE_BANNER:23,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITH_VALID_PRODUCT:24,SMB_ADSCREATION_CONVERSATIONS_BANNER_WITHOUT_VALID_PRODUCT:25,SMB_MD_AWARENESS:26,BACKUP_QUOTA:27,SMB_ADD_COVER_PHOTO:28,PAYMENTS_MERCHANT_ONBOARDING_BANNER:29,SMB_PAYMENTS_MERCHANT_ACCOUNT_STATUS_BANNER:30,SMB_CTWA_AD_ACTION_BANNER:31,BIZ_INTEGRITY_WARNING_BANNER:32,SMB_CTWA_AUTO_LABEL_BANNER:33,SMB_UPDATE_CATEGORY_BANNER:34,SMB_PREMIUM_UPSELL_CHAT_BANNER:35,SMB_PREMIUM_SUBS_PAYMENT_FAILED_BANNER:36,SMB_PREMIUM_SUBS_UNINTENTIONAL_CANCELED_BANNER:37}),M=Object.freeze({SHOPS:0,NATIVE:1}),I=Object.freeze({UNKNOWN:1,SMB:2,ENT:3}),w=Object.freeze({OTHER:0,CHAT:1,PROFILE:2,BLOCK_LIST:3,TRIGGERED_BLOCK:4,ACCOUNT_INFO:5,CALL_LOG:6,OVERFLOW_MENU:7,GROUP_INFO:8,BLOCK_DIALOG:9,MESSAGE_MENU:10,MEDIA_VIEWER:11,OVERFLOW_MENU_BLOCK:12,ONE_TO_ONE_OLD_SPAM_BANNER_BLOCK:13,ONE_TO_ONE_SPAM_BANNER_BLOCK:14,BIZ_SPAM_BANNER_BLOCK:15,BLOCK_HEADER_CHAT:16,OVERFLOW_MENU_REPORT:17,ACCOUNT_INFO_REPORT:18}),R=Object.freeze({OTHER:0,NO_LONGER_NEEDED:1,NO_SIGN_UP:2,SPAM:3,OFFENSIVE_MESSAGES:4,OTP_DID_NOT_REQUEST:5}),N=Object.freeze({REQUEST_BUILT:1,RESPONSE_RECEIVED:2,RESPONSE_PARSED_VALID:3,MISSING_KEYS_REQUESTED:4,MISSING_KEYS_RECEIVED:5,MUTATIONS_DECRYPTED:6,ABOUT_TO_APPLY_MUTATIONS:7,APPLIED_MUTATIONS:8,PUSHNAME_APPLIED:9,PUSHNAME_INVALID:10,ENTERED_RETRY_MODE:11}),L=Object.freeze({ACTION_CLICK:1,ACTION_MSG_SENT:2}),D=Object.freeze({FACEBOOK:1,INSTAGRAM:2,WHATSAPP:3,EXTERNAL:4}),k=Object.freeze({CLICK_TO_CHAT_LINK:1,MESSAGE_SHORT_LINK:2,QR_CODE:3,CUSTOM_LINK:4,CUSTOM_QR_CODE_LINK:5}),U=Object.freeze({STATUS:1,INDIVIDUAL_CHAT:2,GROUP:3,OTHER:4,OUTSIDE_OF_WA:5}),G=Object.freeze({INDIVIDUAL_CHAT:1,LANDING_PAGE:2,OTHER:3}),x=Object.freeze({IMPRESSION:0,TAP_ON_MESSAGE:1,TAP_ON_PROFILE:2,TAP_ON_CATALOG_VIEW_ALL:3,TAP_ON_CATLOG_PRODUCT:4,DISMISS_PREVIEW:5}),B=Object.freeze({REGISTRATION:1,SETTINGS:2,COMPLIANCE:3,QUICK_REPLY_SMART_DEFAULT:4}),F=Object.freeze({DESCRIPTION:1,HOURS:2,ADDRESS:3,EMAIL:4,WEBSITE:5,CATEGORY:6,PROFILE:7}),j=Object.freeze({BUSINESS_PROFILE_VIEW_ACTION_IMPRESSION:1,BUSINESS_PROFILE_VIEW_ACTION_CLICK_WEBSITE:2,BUSINESS_PROFILE_VIEW_ACTION_CLICK_LOCATION:3,BUSINESS_PROFILE_VIEW_ACTION_CLICK_HOURS:4,BUSINESS_PROFILE_VIEW_ACTION_CLICK_DESCRIPTION:5,BUSINESS_PROFILE_VIEW_ACTION_CLICK_EMAIL:6,BUSINESS_PROFILE_VIEW_ACTION_CLICK_ADDTOCONTACT:7,BUSINESS_PROFILE_VIEW_ACTION_CLICK_MORE_BIZ_PROFILE:8}),Y=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),K=Object.freeze({ENTRY_BANNER:0,ENTRY_REGISTRATION_ONBOARDING:1,ENTRY_CONVERSATIONS:2,ENTRY_SETTINGS:3,ENTRY_DEEPLINK:4,ENTRY_STATUS_TAB_MENU:5,ENTRY_CALLS_TAB_MENU:6}),W=Object.freeze({OVERFLOW:0,PROFILE:1,CATALOG:2,AWAY_MESSAGE:3,GREETING_MESSAGE:4,QUICK_REPLIES:5,LABELS:6,LINKED_ACCOUNTS:7,SHORT_LINK:8,STATISTICS:9,CREATE_ACCOUNT_LINK:10,MANAGE_CTA:11,CREATE_AD:12,CONTINUE_PROMPT:13,ADVERTISE_LIST_ITEM:14,SHOPS:15,DISABLED_CATALOG:16,BANNED_SHOP:17}),H=Object.freeze({FACEBOOK:0,INSTAGRAM:1}),V=Object.freeze({PROMOTION_NOTIFICATION:1,MEMBER_LIST:2}),$=Object.freeze({SUCCESS:1,FAILURE:2,CANCEL:3,RETRY_SUCCESS:4,RETRY_FAILURE:5,RETRY_CANCEL:6}),z=Object.freeze({CALLS_TAB_MISSED:1,CALLS_TAB_OUTGOING:2,SELECT_CONTACT:3,CALL_INFO:4,NOTIFICATION_MISSED:5,CONTACT_INFO:6,QUICK_CONTACT_INFO:7,CONVERSATION:8,CALLS_TAB_INCOMING:9,GROUP_CHAT_INFO:10,GROUP_CHAT_RECENT_LOCATION:11,ANDROID_BROADCAST_DETAILS:12,ANDROID_LIST_CHAT_INFO:13,ANDROID_CONTACTS_APPLICATION:14,CONTACT_VCARD:15,CALLS_TAB_NEW_CALL:16,VOICE_MAIL_CALL_BACK:17,IOS_INTENT:18,LIVE_LOCATION_MAP:19,GROUP_CALL_INFO:20,CALLS_TAB_BOTTOM_SHEET:21,STATUS_VIEWER:22,DEBUG_TOOL:23,GROUP_CHAT_PICKER:24,GROUP_CHAT_DIRECT:25,STELLA:26,CHAT_LIST:27,NEW_CHAT:28,CONVERSATION_OPTIONS:29,CALL_FAILED_SCREEN:30,BUSINESS_DIRECTORY:31}),q=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),J=Object.freeze({UNBOUND:1,BINDED:2}),Q=Object.freeze({INVALID:0,CONNECTED:1,REJECTED_BY_USER:2,REJECTED_BY_SERVER:3,MISSED:4,BUSY:5,SETUP_ERROR:6,SERVER_NACK:7,CALL_OFFER_ACK_NOT_RECEIVED:8,MISSED_NO_RECEIPT:9,ACCEPTED_BUT_NOT_CONNECTED:10,CALL_CANCELED_CELLULAR_IN_PROGRESS:11,CALL_CANCELED_AIRPLANE_MODE_ON:12,CALL_CANCELED_NO_NETWORK:13,CALL_OFFER_ACK_CORRUPT:14,CALL_REJECTED_TOS:15,CALL_REJECTED_E2E:16,CALL_REJECTED_UNAVAILABLE:17,CALL_CANCELED_OFFER_NOT_SENT:18,PEER_SETUP_ERROR:19,ACTIVE_ELSEWHERE:20,NO_DECRYPTED_OFFER:21,ACCEPTED_ELSEWHERE:22,REJECTED_ELSEWHERE:23}),X=Object.freeze({CALL_SEGMENT_ONE_ON_ONE_ACTIVE:1,CALL_SEGMENT_GROUP_ACTIVE:2,CALL_SEGMENT_ONE_ON_ONE_HOLD_SELF:3,CALL_SEGMENT_ONE_ON_ONE_HOLD_PEER:4}),Z=Object.freeze({UNKNOWN:1,CALL_ACCEPT_FAILED:2,INIT_MEDIA_STREAM_FAILED:3,START_MEDIA_STREAM_FAILED:4,AUDIO_INIT_ERROR:5,HANDLE_OFFER_FAILED:6,HANDLE_ACCEPT_FAILED:7,SOUND_PORT_CREATE_FAILED:8,P2P_TRANSPORT_CREATE_FAILED:9,P2P_TRANSPORT_MEDIA_CREATE_FAILED:10,INCOMPATIBLE_SRTP_KEY_EXCHANGE:11,SRTP_KEY_GENERATION_ERROR:12,UNSUPPORTED_AUDIO_CAPS:13,P2P_TRANSPORT_START_FAILED:14,RELAY_BIND_FAILED:15,CANNOT_INITIALIZE_AUDIO_RECORD_OBJECT:16,PEER_RELAY_BIND_FAILED:17,VIDEO_CAPTURE_INIT_FAILED:18,VIDEO_CAPTURE_START_FAILED:19,VIDEO_RENDER_INIT_FAILED:20,VIDEO_RENDER_START_FAILED:21,VIDEO_ENCODER_OPEN_FAILED:22,VIDEO_DECODER_OPEN_FAILED:23,VIDEO_STREAM_CREATE_FAILED:24,VIDEO_STREAM_SETUP_FAILED:25,PEER_SETUP_FAILED:26,HANDLE_PREACCEPT_FAILED:27}),ee=Object.freeze({CALLER:1,CALLEE:2}),te=Object.freeze({ENDED_BY_USER:1,TIMEOUT:2,RECONNECTING:3,ENDED_BY_SELF:4,ENDED_BY_PEER:5,VIDEO_ENCODER_FATAL_ERROR:6,VIDEO_DECODER_FATAL_ERROR:7,AUDIO_RECORD_FATAL_ERROR:8,CRASH:9,DETECT_IDENTITY_CHANGE:10,USER_INVISIBLE:11,RELAY_BIND_FAILED:12,SETUP_FAILED:13,ACCEPTED_ELSEWHERE:14,REJECTED_ELSEWHERE:15,GROUP_CALL_ENDED:16,CALL_IS_FULL:17,PHONE_PERMISSION_DENIED:18}),ne=Object.freeze({UNKNOWN:0,P2P:1,UDP_RELAY:2,TCP_RELAY:3,MIXED:4}),re=Object.freeze({DISABLED:0,ENABLED:1,PAUSED:2,UPGRADE_REQUEST:3,MUTED:6,ERROR:20}),ie=Object.freeze({NONE:0,UNKNOWN:1,APNS_PUSH:2,IOS_VOIP_PUSH:3,GCM_PUSH:4,ONLINE:5,RIM_PUSH:6,WNS_PUSH:7}),ae=Object.freeze({DEFAULT:0,TEXTURE:1,TEXTURE_FALLBACK:2}),oe=Object.freeze({DEFAULT:0,CONSERVATIVE:1,STRICT:2,ERROR:11}),se=Object.freeze({ACTION_PRODUCT_ADD_CLICKED:1,ACTION_PRODUCT_ADD_SUCCESS:2,ACTION_PRODUCT_ADD_FAILED:3,ACTION_PRODUCT_EDIT_CLICKED:4,ACTION_PRODUCT_EDIT_SUCCESS:5,ACTION_PRODUCT_EDIT_FAILED:6,ACTION_PRODUCT_DELETE_CLICKED:7,ACTION_PRODUCT_DELETE_SUCCESS:8,ACTION_PRODUCT_DELETE_FAILED:9,ACTION_APPEAL_PRODUCT_CLICKED:10,ACTION_APPEAL_PRODUCT_SUCCESS:11,ACTION_APPEAL_PRODUCT_FAILED:12,ACTION_CREATE_PRODUCT_CATALOG:13,ACTION_CREATE_PRODUCT_CATALOG_SUCCESS:14,ACTION_CREATE_PRODUCT_CATALOG_FAILED:15,ACTION_CATALOG_MENU_ITEM_CLICKED:16,ACTION_PRODUCT_RESUBMIT_CLICKED:17,ACTION_START_IMPORT_FLOW:18,ACTION_IMPORT_POST:19,ACTION_CARD_IMPRESSION:20,ACTION_CARD_ITEM_CLICK:21,ACTION_CARD_MORE_CLICK:22,ACTION_LIST_IMPRESSION:23,ACTION_LIST_ITEM_CLICK:24,ACTION_DETAIL_IMAGE_CLICK:25,ACTION_DETAIL_LINK_CLICK:26,ACTION_IMAGE_LIST_IMPRESSION:27,ACTION_IMAGE_LIST_CLICK:28,ACTION_FULL_IMAGE_IMPRESSION:29,ACTION_FULL_IMAGE_SWIPE:30,ACTION_DETAIL_IMPRESSION:31,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:32,ACTION_PRODUCT_IN_CONVERSATION_CLICK:33,ACTION_SEND_PRODUCT_MESSAGE:34,ACTION_ONBOARD_IMPRESSION:35,ACTION_SHARE_CATALOG_LINK_CLICK:36,ACTION_SHARE_PRODUCT_LINK_CLICK:37,ACTION_CATALOG_IN_CONVERSATION_CLICK:38,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:39,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:40,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:41,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:42,ACTION_SEND_CATALOG_CLICK:43,ACTION_ORDER_MESSAGE_CLICK:44,ACTION_ORDER_LIST_IMPRESSION:45,ACTION_ORDER_LIST_ITEM_CLICK:46,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:47,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:48,ACTION_CART_ADD_PRODUCT:49,ACTION_CART_ICON_CLICK:50,ACTION_CART_SNACKBAR_CLICK:51,ACTION_CART_LIST_IMPRESSION:52,ACTION_CART_EDIT_PRODUCT:53,ACTION_CART_DELETE_PRODUCT:54,ACTION_CART_ABANDON:55,ACTION_SEND_ORDER_MESSAGE:56,ACTION_MENU_CLICK:57,ACTION_PRODUCT_HIDE_CLICKED:58,ACTION_PRODUCT_HIDE_SUCCESS:59,ACTION_PRODUCT_HIDE_CANCELLED:60,ACTION_PRODUCT_HIDE_FAILED:61,ACTION_PRODUCT_UNHIDE_CLICKED:62,ACTION_PRODUCT_UNHIDE_SUCCESS:63,ACTION_PRODUCT_UNHIDE_CANCELLED:64,ACTION_PRODUCT_UNHIDE_FAILED:65,ACTION_CATALOG_LIST_MENU_CLICKED:66,ACTION_CATALOG_LIST_MENU_CLICKED_WITH_ADVERTISE_SHOWN:67,ACTION_COLLECTION_CREATE_CLICKED:68,ACTION_COLLECTION_CREATED:69,ACTION_MENU_COLLECTIONS_CLICK:70,ACTION_COLLECTION_RENAME_CLICKED:71,ACTION_COLLECTION_RENAME_CANCELLED:72,ACTION_COLLECTION_RENAMED:73,ACTION_COLLECTION_DELETE_CLICKED:74,ACTION_COLLECTION_DELETE_CANCELLED:75,ACTION_COLLECTION_DELETED:76,ACTION_COLLECTION_ASSIGN_ITEMS:77,ACTION_COLLECTION_UNASSIGN_ITEMS:78,ACTION_COLLECTION_IMPRESSION:79,ACTION_COLLECTION_CHANGE_ORDER:80,ACTION_COLLECTION_ITEM_CHANGE_ORDER:81}),le=Object.freeze({CATALOG_ENTRY_POINT_PROFILE:1,CATALOG_ENTRY_POINT_SETTINGS:2,CATALOG_ENTRY_POINT_MESSAGE:3,CATALOG_ENTRY_POINT_ATTACHMENT_PANEL:4,CATALOG_ENTRY_POINT_NUX:5,CATALOG_ENTRY_POINT_DEEPLINK:6,CATALOG_ENTRY_POINT_CHAT:7,CATALOG_ENTRY_POINT_ORDER_MESSAGE:8,CATALOG_ENTRY_POINT_INVOICE_ATTACHMENT_PANEL:9,CATALOG_ENTRY_POINT_PRODUCT_LIST_MESSAGE:10,CATALOG_ENTRY_POINT_TOP_BAR:11}),ce=Object.freeze({ACTION_CARD_IMPRESSION:1,ACTION_CARD_ITEM_CLICK:2,ACTION_CARD_MORE_CLICK:3,ACTION_LIST_IMPRESSION:4,ACTION_LIST_ITEM_CLICK:5,ACTION_DETAIL_IMAGE_CLICK:6,ACTION_DETAIL_LINK_CLICK:7,ACTION_IMAGE_LIST_IMPRESSION:8,ACTION_IMAGE_LIST_CLICK:9,ACTION_FULL_IMAGE_IMPRESSION:10,ACTION_FULL_IMAGE_SWIPE:11,ACTION_DETAIL_IMPRESSION:12,ACTION_REPORT_PRODUCT:13,ACTION_SEND_PRODUCT_MESSAGE:14,ACTION_REPORT_PRODUCT_SUCCESS:15,ACTION_REPORT_PRODUCT_FAILURE:16,ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,ACTION_SHARE_CATALOG_LINK_CLICK:19,ACTION_SHARE_PRODUCT_LINK_CLICK:20,ACTION_CATALOG_IN_CONVERSATION_CLICK:21,ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,ACTION_CHAT_CATALOG_ICON_CLICK:26,ACTION_MESSAGE_BUSINESS_BUTTON_CLICK:27,ACTION_CART_ADD_PRODUCT:28,ACTION_CART_EDIT_PRODUCT:29,ACTION_CART_DELETE_PRODUCT:30,ACTION_CART_ABANDON:31,ACTION_CART_ICON_CLICK:32,ACTION_CART_SNACKBAR_CLICK:33,ACTION_SEND_ORDER_MESSAGE:34,ACTION_ORDER_LIST_IMPRESSION:35,ACTION_QUOTED_PRODUCT_MESSAGE_SEND:36,ACTION_CART_LIST_IMPRESSION:37,ACTION_ORDER_MESSAGE_CLICK:38,ACTION_ORDER_LIST_ITEM_CLICK:39,ACTION_PLM_CART_CTA_CLICK:40,ACTION_COLLECTION_IMPRESSION:41,ACTION_CART_CHAT_ICON_CLICK:42}),ue=Object.freeze({CATEGORY_SCROLLING_CHIPS:1,ALL_CATEGORIES_PAGE:2,CATEGORY_PILLS:3}),de=Object.freeze({CONTACT:0,NON_CONTACT:1,GROUP:2}),pe=Object.freeze({ATTACHMENT:1,CAMERA:2,PTT:3,PAYMENT:4,GIMMICK:5,PHONE:6,VIDEO:7,MESSAGE:8,CALL:9}),fe=Object.freeze({CLICK:1}),_e=Object.freeze({OPEN:1,SELECT_FILTER:2,SEARCH_WITH_FILTER:3,SEARCH:4,SEARCH_ITEM_SELECTED:5,SEARCH_MSG_SENT:6,UNSELECT_FILTER:7,AUTO_CLEAR_FILTER:8}),he=Object.freeze({CHAT_LIST:0}),ge=Object.freeze({NONE:0,OTHER_LABELS:1,UNREAD:2,GROUP:3,BROADCAST_LIST:4,NEW_CUSTOMER:5,NEW_ORDER:6,PENDING_PAYMENT:7,PAID:8,ORDER_COMPLETE:9,CONTACT:10,NON_CONTACT:11,PHOTOS:12,GIFS:13,LINKS:14,VIDEOS:15,DOCUMENTS:16,AUDIOS:17}),me=Object.freeze({TOS3:1,COUNTRY:2}),ye=Object.freeze({NOT_MUTED:1,MUTED_NO_NOTIFICATIONS:2,MUTED_SILENT_NOTIFICATIONS:3}),Se=Object.freeze({CONTACT:0,CHAT:1,GROUP:2,BROADCAST_LIST:3,MESSAGE:4}),Ee=Object.freeze({INDIVIDUAL:1,SMB:2,ENT:3}),ve=Object.freeze({OUTSIDE_DIALOG_BOX:0,OK:1,LEARN_MORE:2}),Te=Object.freeze({SMALL:1,MEDIUM:2,LARGE:3,EXTRA_LARGE:4,XX_LARGE:5,XXX_LARGE:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),Ce=Object.freeze({CLIENT_RENDERED:1,CLIENT_SAVED:2,CLIENT_WRITTEN_WIRE:3,CLIENT_QUEUED:4,CLIENT_WAITING_TO_ENCRYPT:5,CLIENT_READY_TO_SEND:6,CLIENT_ENCRYPT:7,CLIENT_PREKEYS_FETCH:8}),Ae=Object.freeze({REGULAR:1,REGULAR_LOW:2,REGULAR_HIGH:3,CRITICAL_BLOCK:4,CRITICAL_UNBLOCK_LOW:5}),be=Object.freeze({COMMERCE_ACTION_CARD_IMPRESSION:1,COMMERCE_ACTION_CARD_ITEM_CLICK:2,COMMERCE_ACTION_CARD_MORE_CLICK:3,COMMERCE_ACTION_LIST_IMPRESSION:4,COMMERCE_ACTION_LIST_ITEM_CLICK:5,COMMERCE_ACTION_DETAIL_IMAGE_CLICK:6,COMMERCE_ACTION_DETAIL_LINK_CLICK:7,COMMERCE_ACTION_IMAGE_LIST_IMPRESSION:8,COMMERCE_ACTION_IMAGE_LIST_CLICK:9,COMMERCE_ACTION_FULL_IMAGE_IMPRESSION:10,COMMERCE_ACTION_FULL_IMAGE_SWIPE:11,COMMERCE_ACTION_DETAIL_IMPRESSION:12,COMMERCE_ACTION_REPORT_PRODUCT:13,COMMERCE_ACTION_SEND_PRODUCT_MESSAGE:14,COMMERCE_ACTION_REPORT_PRODUCT_SUCCESS:15,COMMERCE_ACTION_REPORT_PRODUCT_FAILURE:16,COMMERCE_ACTION_QUOTED_PRODUCT_IN_CONVERSATION_CLICK:17,COMMERCE_ACTION_PRODUCT_IN_CONVERSATION_CLICK:18,COMMERCE_ACTION_SHARE_CATALOG_LINK_CLICK:19,COMMERCE_ACTION_SHARE_PRODUCT_LINK_CLICK:20,COMMERCE_ACTION_CATALOG_IN_CONVERSATION_CLICK:21,COMMERCE_ACTION_SHARE_CATALOG_VIA_WA_LINK_CLICK:22,COMMERCE_ACTION_SHARE_PRODUCT_VIA_WA_LINK_CLICK:23,COMMERCE_ACTION_SHARE_CATALOG_COPY_LINK_CLICK:24,COMMERCE_ACTION_SHARE_PRODUCT_COPY_LINK_CLICK:25,COMMERCE_ACTION_CHAT_CATALOG_ICON_CLICK:26,COMMERCE_ACTION_CLICK_ON_MESSAGE_BUSINESS_BUTTON:27}),Pe=Object.freeze({COMMERCE_ENTRY_POINT_PROFILE:1,COMMERCE_ENTRY_POINT_SETTINGS:2,COMMERCE_ENTRY_POINT_MESSAGE:3,COMMERCE_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_ENTRY_POINT_NUX:5,COMMERCE_ENTRY_POINT_DEEPLINK:6,COMMERCE_ENTRY_POINT_CHAT:7,COMMERCE_ENTRY_POINT_ORDER_MESSAGE:8}),Oe=Object.freeze({COMMERCE_PERF_ENTRY_POINT_PROFILE:1,COMMERCE_PERF_ENTRY_POINT_SETTINGS:2,COMMERCE_PERF_ENTRY_POINT_PRODUCT_MESSAGE:3,COMMERCE_PERF_ENTRY_POINT_ATTACHMENT_PANEL:4,COMMERCE_PERF_ENTRY_POINT_CATALOG_PDP:5,COMMERCE_PERF_ENTRY_POINT_DEEPLINK:6,COMMERCE_PERF_ENTRY_POINT_CATALOG_HOME:7,COMMERCE_PERF_ENTRY_POINT_SHOPS_PDP:8,COMMERCE_PERF_ENTRY_POINT_PRODUCT_LIST_MESSAGE:9}),Me=Object.freeze({COMMERCE_PERF_MARKER_START:1,COMMERCE_PERF_MARKER_CACHE_CONTENT:2,COMMERCE_PERF_MARKER_NETWORK_CONTENT:3,COMMERCE_PERF_MARKER_INTERACT:4}),Ie=Object.freeze({COMMERCE_PERF_CATALOG_PDP:1,COMMERCE_PERF_CATALOG_HOME:2,COMMERCE_PERF_PROFILE_CATALOG:3,COMMERCE_PERF_SHOPS_PDP:4}),we=Object.freeze({ENTER:1,GET_STARTED:2,DISMISS:3,NEXT:4,CREATE_GROUP:5,LINK_GROUP:6,CREATE_COMMUNITY:7,EXIT:8}),Re=Object.freeze({CHATS_TAB:1,COMMUNITIES_TAB:2,COMMUNITY_NUX:3,COMMUNITY_INFO:4,COMMUNITY_GROUPS_SUMMARY:5}),Ne=Object.freeze({PERSON:1,PUSH:2,OTHER:3,BACKOFF:4}),Le=Object.freeze({HOSTNAME:0,IP4:1,IP6:2}),De=Object.freeze({CHATD:1,MMS:2}),ke=Object.freeze({PROBLEM_DESCRIPTION:1,SUGGESTED_FAQ:2,EMAIL_SEND:3,IN_APP_FAQ:4,CANCELLED:5,FAQ:6}),Ue=Object.freeze({CRASH:0,OOM:1,MAIN_THREAD_STALL_30_SECONDS:2,MAIN_THREAD_STALL_DEBUG:3,AUDIO_TRANSCODING_ERROR:4,VIDEO_TRANSCODING_ERROR:5,ANR:6,CRITICAL_EVENT:7,UNHANDLED_EXCEPTION:8,APP_CRASH:9,NATIVE_CRASH:10,UFAD:11}),Ge=Object.freeze({NO_OTP_REQUEST_RECEIVED:0,OTP_REQUEST_EXPIRED:1,HASH_MISMATCH:2,NO_ACTIVITY_LISTENING_ON_THIRD_PARTY_APP:3,OTHER:4}),xe=Object.freeze({COPY_CODE:0,AUTOFILL:1}),Be=Object.freeze({LAND_ON_WHATSAPP:1,GET_CONTEXT_CALL_INITIATED:2,GET_CONTEXT_CALL_SUCCESS:3,AD_CONTEXT_FALLBACK_RENDERED:4,AD_CONTEXT_DISMISSED:5,KILL_APP:6,BACK_BUTTON_CLICKED:7,CALL_BUSINESS_BUTTON_CLICKED:8,VIEW_CATALOG_BUTTON_CLICKED:9,PROFILE_PHOTO_CLICKED:10,BIZ_PROFILE_CLICKED:11,GET_CONTEXT_CALL_FAILED:12,CHAT_SETTINGS_CLICKED:13,FIRST_CUSTOM_MESSAGE_SENT_WITH_AD_CONTEXT:14,FIRST_CUSTOM_MESSAGE_SENT_WITHOUT_AD_CONTEXT:15,ICEBREAKER_SENT:16,AD_CONTEXT_FULLPREVIEW_RENDERED:17}),Fe=Object.freeze({MSG_SENT:1}),je=Object.freeze({DEEP_LINK_EXTERNAL:1,DEEP_LINK_WA_LINK_CLICK:2,QR_CODE_SHEET:3}),Ye=Object.freeze({DEEP_LINK_UNKNOWN:1,DEEP_LINK_CHAT:2,DEEP_LINK_CONTACT_QR_CODE:3,DEEP_LINK_PAYMENT:4,DEEP_LINK_PRODUCT:5,DEEP_LINK_CATALOG:6,DEEP_LINK_FUTURE_PROOF:7,DEEP_LINK_GROUP_INVITE:8,DEEP_LINK_MSG_FORWARD:9,DEEP_LINK_MESSAGE_QR_CODE:10,DEEP_LINK_OPT_IN_QR_CODE:11,DEEP_LINK_CTWA:12,DEEP_LINK_STICKERPACK:13,DEEP_LINK_NOVI_HUB:14,DEEP_LINK_NOVI_ADD_DEBIT_CARD:15,DEEP_LINK_NOVI_ADD_BANK_ACCOUNT:16,DEEP_LINK_NOVI_WITHDRAW:17,DEEP_LINK_NOVI_RESET_PASSWORD:18,DEEP_LINK_PAYMENT_SIGNUP:19,DEEP_LINK_BIZTOOLS_ACCOUNTS:20,DEEP_LINK_PAYMENT_VIRALITY:21,DEEP_LINK_SETTINGS_ACCOUNT_DELETE:22,DEEP_LINK_SETTINGS_ACCOUNT_REQUEST_INFO:23,DEEP_LINK_SETTINGS_CHATS_HISTORY:24,DEEP_LINK_DISAPPEARING_MODE:25,DEEP_LINK_ARCHIVE_SETTINGS:26,DEEP_LINK_TOS:27,DEEP_LINK_NOVI_CARE:28,DEEP_LINK_NOVI_TPP_ACCOUNT_LINKING:29,DEEP_LINK_CONTACT_SUPPORT:30,DEEP_LINK_BIZTOOLS_DIRECTORY:31,DEEP_LINK_DIRECTORY:32,DEEP_LINK_CALL:33,DEEP_LINK_DIRECTORY_DEEPER_CATEGORY_SELECTION:34,DEEP_LINK_PHOENIX:35}),Ke=Object.freeze({APP_SWITCH:1,BROWSER:2,CANCELLED:3}),We=Object.freeze({PRIMARY:1,COMPANION:2}),He=Object.freeze({CHAT:1,INITIATED_BY_ME:2,INITIATED_BY_OTHER:3,CHAT_PICKER:4}),Ve=Object.freeze({ACCOUNT_SETTINGS:1,SYSTEM_MESSAGE:2,INDIVIDUAL_CHAT_DISAPPEARING_MESSAGES_SETTING:3,GROUP_CHAT_DISAPPEARING_MESSAGES_SETTING:4,DEEP_LINK:5}),$e=Object.freeze({DEFAULT_MESSAGE_TIMER_OPEN:1,DEFAULT_MESSAGE_TIMER_SET:2,DEFAULT_MESSAGE_TIMER_EXIT:3,LEARN_MORE_CLICK:4}),ze=Object.freeze({DEFAULT_MODE_SETTING:0,STORAGE_SETTING:1}),qe=Object.freeze({CHAT_PICKER_LINK_IMPRESSION:0,CHAT_PICKER_TRAY_OPEN:1,CHAT_PICKER_TRAY_EXIT:2,CHAT_PICKER_CHATS_SELECTED:3}),Je=Object.freeze({CHAT_PERSONAL:1,CHAT_GROUP:2,STATUS_USER:3,STATUS_ADS:4,PRODUCT_CATALOG:5,GDPR:6,STICKER_PICKER:7,PROFILE_PICTURE:8,BLOKS:9,P2B:10,MESSAGE_HISTORY_SYNC:11}),Qe=Object.freeze({NORMAL_QUALITY:1,MID_QUALITY:2,INELIGIBLE_IMAGE_TOO_SMALL:3,INELIGIBLE_PARTIAL_HASHES_NOT_FOUND:4,ERROR_DETERMINING_ELIGIBILITY:5,NOT_DOWNLOADED_ENOUGH_BYTES_TO_DETERMINE_ELIGIBILITY:6}),Xe=Object.freeze({INVALID_SENDER:1,MISSING_DSM:2,INVALID_DSM:3}),Ze=Object.freeze({MESSAGE:0,PREKEY_MESSAGE:1,SENDER_KEY_MESSAGE:2}),et=Object.freeze({INDIVIDUAL:0,GROUP:1,LIST:2,STATUS:3}),tt=Object.freeze({INVALID_MESSAGE:0,LEGACY_MESSAGE:1,INVALID_VERSION:2,PRE_KEY_MESSAGE_MISSING_PRE_KEY:3,PRE_KEY_MESSAGE_INVALID_KEY:4,UNTRUSTED_IDENTITY:5,NO_SESSION_AVAILABLE:6,PLAINTEXT_BYTE_MISMATCH:7,UNKNOWN_CIPHERTEXT_TYPE:8,UNKNOWN_CIPHERTEXT_VERSION:9,INVALID_PADDING:10,INVALID_PROTOCOL_BUFFER:11,INVALID_NUMBER_OF_MESSAGE_TYPES:12,INVALID_IMAGE_FILE_LENGTH:13,INVALID_IMAGE_FILE_SHA256:14,INVALID_IMAGE_MEDIA_URL:15,INVALID_IMAGE_MEDIA_KEY:16,INVALID_IMAGE_MIME_TYPE:17,UNKNOWN_V2_TAGS:18,INVALID_EDIT_VERSION:19,INVALID_HSM_NAMESPACE:20,INVALID_HSM_ELEMENT:21,UNKNOWN_PROTOCOL_MESSAGE_TYPE:22,DUPLICATE_MESSAGE:23,FINGERPRINT_IDENTITY_MISMATCH:24,FINGERPRINT_VERSION_MISMATCH:25,INVALID_ARGUMENT:26,INVALID_KEY:27,INVALID_KEY_ID:28,INVALID_MAC:29,NO_MEMORY:30,STALE_KEY_EXCHANGE:31,VRF_SIGNATURE_VERIFICATION_FAILED:32,ERROR_MINIMUM_VALUE:33,ERROR_UNKNOWN:34,INVALID_BROADCAST_STANZA_ATTRIBUTE:35,INVALID_LIST_REPLY_MESSAGE:36,INVALID_LIST_REPLY_ROW_IDENTIFIER:37,INVALID_BUTTONS_RESPONSE_MESSAGE:38,INVALID_BUTTONS_RESPONSE_BUTTON_IDENTIFIER:39,INVALID_ORDER_MESSAGE:40,ERROR_CANCELLED:41,FUTURE_MESSAGE:42,INVALID_EMPTY_PROTOBUF_NOT_ALLOWED:43,SELF_SEND:44,INVALID_MEDIA_MIME_TYPE_TEMPLATE_MESSAGE:45,INVALID_MEDIA_ENC_HASH:46,INVALID_IDENTITY:47,PASSTHROUGH:48,NOT_IN_PENDING_DEVICES:49,EDIT_TYPE_AND_PROTOCOL_MISMATCH:50,DECRYPTION_FAILED:51,DESERIALIZE_INVALID_PROTO_FORMAT:52,DESERIALIZE_RATCHET_KEY_BAD_FORMAT:53,DESERIALIZE_PK_INVALID_PROTO_FORMAT:54,DESERIALZE_PK_KEY_BAD_FORMAT:55,TOO_MANY_MESSAGES_IN_FUTURE:56,EMPTY_VERSION_CONTENT_SUFFIX:57,CONTENT_EXCEEDED_EXPECTED_LENGTH:58,GRP_INVALID_PROTO_FORMAT:59,GRP_INVALID_KEY_FORMAT:60,GRP_VERSION_CONTENT_EMPTY:61,GRP_INVALID_VERSION_CONTENT_LENGTH:62,GRP_SENDER_KEY_INVALID_PROTO_FORMAT:63,GRP_SENDER_KEY_PROTO_ERROR:64,GRP_TOO_MANY_MESSAGES_IN_FUTURE:65}),nt=Object.freeze({MY_PRIMARY:1,OTHER_PRIMARY:2,MY_COMPANION:3,OTHER_COMPANION:4}),rt=Object.freeze({B1:1,B4:2,B8:3,B16:4,B32:5,B64:6,B128:7,B256:8,B512:9,B1000:10,B1500:11,B2000:12,B2500:13,B3000:14,B3500:15,B4000:16,B4500:17,B5000:18,NULL:19}),it=Object.freeze({ACTION_OPEN:1,ACTION_SAVE:2,ACTION_DISCARD:3,ACTION_PROFILE_FIELD_OPEN:4,ACTION_PROFILE_FIELD_SAVE:5,ACTION_PROFILE_FIELD_DISCARD:6,ACTION_FACEBOOK_ENABLED:7,ACTION_FACEBOOK_DISABLED:8,ACTION_INSTAGRAM_ENABLED:9,ACTION_INSTAGRAM_DISABLED:10,ACTION_FB_IG_POP_SHOWN:11,ACTION_EDIT_COVER_PHOTO_CLICK:12,ACTION_REMOVE_COVER_PHOTO:13,UPGRADE_TO_CUSTOM_LINK_CLICK:14}),at=Object.freeze({CALL_TOO_SHORT:1}),ot=Object.freeze({CHAT_INFO:1,SYSTEM_MESSAGE:2,CHAT_OVERFLOW:3,CHAT_PICKER:4,EPHEMERAL_NUX:5}),st=Object.freeze({ROOM_OPEN_FAILURE:1,UNKNOWN_ERROR:2}),lt=Object.freeze({USER_LEAVE:1,DEVICE_UNPAIR:2,IDENTITY_CHANGE:3,AUDIENCE_CHANGE:4,PERIODIC_ROTATION:5,KEY_CORRUPTION:6,PEER_COMPANION_UNPAIR:7,OTHER_DEVICE_UNPAIR:8}),ct=Object.freeze({BOTH:1,SELF:2,PEER:3}),ut=Object.freeze({SHOW:1,LOGOUT:2,UPGRADE:3}),dt=Object.freeze({NEW:0,RETAINED:1,RESURRECTED:2}),pt=Object.freeze({GIPHY:0,TENOR:1}),ft=Object.freeze({GET_CATALOG:1,GET_PRODUCT:2,GET_PRODUCT_LIST:3,GET_COLLECTIONS:4,GET_SINGLE_COLLECTION:5,GET_CATEGORIES:6}),_t=Object.freeze({SUCCESS:1,FAILURE:2}),ht=Object.freeze({GOLDEN_BOX_CONTACT:0,GOLDEN_BOX_GROUP:1,GOLDEN_BOX_BROADCAST:2,INFO_SCREEN_CONTACT:3,INFO_SCREEN_GROUP:4,INFO_SCREEN_BROADCAST:5,CALLS_LIST:6,CHATS_LIST:7,STATUS_LIST:8,LINKED_DEVICES_SCREEN:9,CALLING_SCREEN_AUDIO:10,CALLING_SCREEN_VIDEO:11}),gt=Object.freeze({INCOMING_CALL_SCREEN_ANSWER:1,INCOMING_CALL_SCREEN_REJECT:2,INCOMING_CALL_NOTIFICATION_ANSWER:3,INCOMING_CALL_NOTIFICATION_REJECT:4,PENDING_CALL_SCREEN_END_AND_ANSWER:5,PENDING_CALL_SCREEN_HOLD_AND_ANSWER:6,PENDING_CALL_SCREEN_REJECT:7,INCOMING_CALL_REMOTE_ANSWER:8,INCOMING_CALL_REMOTE_REJECT:9,PENDING_CALL_NOTIFICATION_END_AND_ANSWER:10,PENDING_CALL_NOTIFICATION_REJECT:11}),mt=Object.freeze({DEFAULT:0,PROBING_ROTT_TO_RELAY:1,PROBING_E2E_PEER_RX:2,PROBING_E2E_RX:3,HIS_RECENT_PEER_RX:4,HIS_RECENT_RX:5,HIS_RECENT_PROBING_ROTT_TO_RELAY:6,HIS_RECENT_PROBING_E2E_PEER_RX:7,HIS_RECENT_PROBING_E2E_RX:8,ONE_SIDE_INITIAL_BANDWIDTH_ESTIMATION:9}),yt=Object.freeze({USER_START:0,USER_CANCEL:1,FLOW_SUCCESS:2,FLOW_ERROR:3,USER_VIEW:4,USER_PAY_NOW:5,USER_VIEW_BASKET:6,CLICK_PAYMENT_DETAILS:7,CLICK_MESSAGE_BUSINESS:8,MODIFY_PAYMENT_METHOD:9,CONFIRM_PAYMENT_METHOD:10,USER_VIEW_SUMMARY:11,USER_PAY_NOW_QUICK_BUY:12,USER_SEND_PAYMENT:13,USER_SEND_PAYMENT_QUICK_BUY:14,CLICK_HELP:15,CLICK_ORDER_SUMMARY:16,USER_CONFIRM:17,CLICK_REPORT_THIS_TRANSACTION:18}),St=Object.freeze({KEEP_MESSAGE:1,UNKEEP_MESSAGE:2,VIEW_KEPT_MESSAGES:3,SEARCH_RESULTS_DISPLAY:4,SEARCH_RESULTS_TAP:5}),Et=Object.freeze({SENDER:1,RECIPIENT:2}),vt=Object.freeze({CHAT_INFO:1,SEARCH:2}),Tt=Object.freeze({NONE:1,MESSAGE_MISSING:2,MESSAGE_REVOKED:3,SENDER_UNKEPT:4,OLDER_REQUEST:5,ORPHAN_EXPIRED:6,TIE_BREAK_IGNORED:7,MESSAGE_EXPIRED:8,ADMIN_ONLY:9,MESSAGE_FROM_EX_MEMBER:10,OFFLINE:11,SENDER_DISABLED:12,KEPT_BEYOND_EXPIRY:13}),Ct=Object.freeze({FIRST_DM_NUX_IMPRESSION:1,KIC_NUX_IMPRESSION:2,KIC_NUX_LEARN_MORE_TAP:3,KIC_SYSTEM_MESSAGE_GENERATE:4}),At=Object.freeze({KEEP:1,UNKEEP:2}),bt=Object.freeze({ADD:1,EDIT:2,DELETE:3,VIEW:4,CLICK_POSITIVE:5,CLICK_NEGATIVE:6,UPDATE_LABEL_COUNT:7,AUTO_ADDED:8}),Pt=Object.freeze({LABEL:1,MESSAGE:2,CONTACT:3,LABELS_SCREEN:4,LABEL_DETAILS_SCREEN:5,EDIT_LABEL_DIALOG:6,DELETE_LABEL_DIALOG:7,LABEL_MESSAGE_DIALOG:8,LABEL_CHAT_DIALOG:9,ADD_LABEL_DIALOG:10,BULK_UNLABEL_DIALOG:11,LABEL_COMBINED_DIALOG:12,GROUP:13,BROADCAST:14}),Ot=Object.freeze({MESSAGE_SYNCING:1,SYNC_COMPLETE_CHECK_PHONE:2}),Mt=Object.freeze({OK:1,ERROR_UNKNOWN:2,SERVER_ERROR:3,SERVER_GOAWAY:4,NETWORK_ERROR:5,ANDROID_KEYSTORE_ERROR:6}),It=Object.freeze({APP_STATE_SYNC_KEY_EXPIRY:1,DEVICE_DEREGISTERATION:2,NO_KEYS:3}),wt=Object.freeze({INITIAL:1,RECENT_HISTORY:2,FULL_HISTORY:3,PUSHNAME:4,STATUS_V3:5}),Rt=Object.freeze({CRITICAL:1,NON_CRITICAL:2}),Nt=Object.freeze({APP_STATE:1,HISTORY:2}),Lt=Object.freeze({SUCCESS:1,FAILURE:2}),Dt=Object.freeze({PIN_MUTATION:1,UNPIN_4TH_CHAT_MUTATION:2,DELETE_MUTATION:3,CLEAR_CHAT_REMOVE_STARRED_MUTATION:4,CLEAR_CHAT_KEEP_STARRED_MUTATION:5}),kt=Object.freeze({PAIR_SUCCESS_RECEIVED:1,PAIR_DEVICE_SIGN_SENT:2,FIRST_CONNECT:3,UPLOAD_PREKEYS:4,COMPLETE:5}),Ut=Object.freeze({INITIAL_SYNC:1,RESUME_SYNC:2,REGULAR_SYNC:3}),Gt=Object.freeze({MESSAGE_RANGE_UNSET:1,MESSAGE_RANGE_LAST_SYSTEM_MESSAGE_TIMESTAMP_SET:2,MESSAGE_RANGE_MESSAGES_UNSET:3,MESSAGE_RANGE_MESSAGES_EMPTY:4,MESSAGE_RANGE_MESSAGES_CROSS_LIMIT:5,MESSAGE_RANGE_MESSAGE_KEY_UNSET:6,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_UNSET:7,MESSAGE_RANGE_MESSAGE_KEY_FROM_ME_UNSET:8,MESSAGE_RANGE_MESSAGE_KEY_STANZA_ID_UNSET:9,MESSAGE_RANGE_MESSAGE_KEY_REMOTE_JID_INVALID:10,MESSAGE_RANGE_MESSAGE_KEY_PARTICIPANT_UNSET:11,MALFORMED_PENDING_MUTATION:12,ACTION_INVALID_INDEX_DATA:13,MISSING_MUTATION_TO_REMOVE:14,LTHASH_INCONSISTENCY_ON_DAILY_CHECK:15,LTHASH_INCONSISTENCY_ON_SNAPSHOT_MAC_MISMATCH:16}),xt=Object.freeze({TOO_MANY_INTERNAL_SERVER_ERRORS_IN_7D:1,SERVER_DATA_MISMATCH:2,PROTOBUF_DESERIALIZATION_FAILED:3,EXTERNAL_PATCH_EXPIRED:4,MISSING_OR_EMPTY_INDEX:5,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_PATCH:6,DECRYPTION_FAILED:7,MISSING_PATCH_VERSION:8,DUPLICATE_PATCH_VERSION_IN_COLLECTION:9,ENCRYPTION_FAILED:10,MISSING_MUTATION_VERSION:11,MISSING_MUTATION_VALUE:12,INVALID_MUTATION_INDEX:13,PATCH_WITH_BOTH_INLINE_AND_EXTERNAL_MUTATIONS:14,MISSING_MUTATION_OPERATION:15,MISSING_MUTATION_RECORD:16,MISSING_MUTATION_KEY_ID:17,PATCH_PROTOBUF_DESERIALIZATION_FAILED:18,ACTION_DATA_PROTOBUF_DESERIALIZATION_FAILED:19,MISSING_MUTATION_INDEX:20,MISSING_ACTION_INDEX:21,INVALID_ACTION_INDEX:22,MISSING_ACTION_VALUE:23,MISSING_ACTION_VERSION:24,MISSING_ACTION_TIMESTAMP:25,MUTATIONS_PROTOBUF_DESERIALIZATION_FAILED:26,MUTATIONS_PROTOBUF_SERIALIZATION_FAILED:27,PATCH_PROTOBUF_SERIALIZATION_FAILED:28,ACTION_DATA_PROTOBUF_SERIALIZATION_FAILED:29,MISSING_KEY_ON_ALL_CLIENTS:30,TIMEOUT_WHILE_WAITING_FOR_MISSING_KEY:31,MAC_MISMATCH_SNAPSHOT:33,MAC_MISMATCH_PATCH:34,DB_STORE_NOT_READY:35,TERMINAL_PATCH_MISSING_DATA:36,TERMINAL_PATCH_DESERIALIZATION_ERROR:37,TERMINAL_PATCH_UNKNOWN:38,CYCLIC_MUTATION_DEPENDENCY_IN_PATCH:39,MISSING_SNAPSHOT_VERSION:45,MISSING_SNAPSHOT_MAC:46,MISSING_PATCH_SNAPSHOT_MAC:47,MISSING_PATCH_MAC:48,MISSING_EXTERNAL_BLOB_REFERENCE_MEDIA_KEY:49,MISSING_EXTERNAL_BLOB_REFERENCE_DIRECT_PATH:50,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_SHA256:51,MISSING_EXTERNAL_BLOB_REFERENCE_FILE_ENC_SHA256:52,INVALID_KEY_SHARE_KEY_ID:53,MISSING_PATCH_KEY_ID:56,INVALID_KEY_SHARE_KEY_DATA:57,SNAPSHOT_EXPIRED:58,MISSING_SNAPSHOT_KEY_ID:59,SNAPSHOT_MAC_MISMATCH_IN_PATCH:60,SNAPSHOT_MAC_MISMATCH_IN_SNAPSHOT:61,XMPP_BAD_REQUEST_FOR_COLLECTION:62,XMPP_NOT_FOUND_FOR_COLLECTION:63,XMPP_BAD_REQUEST_GLOBAL_ERROR:64,XMPP_NOT_FOUND_GLOBAL_ERROR:65,XMPP_BAD_METHOD_GLOBAL_ERROR:66,XMPP_NOT_ACCEPTABLE_GLOBAL_ERROR:67,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_SNAPSHOT:68,EXTERNAL_BLOB_REFERENCE_PROTOBUF_DESERIALIZATION_FAILED:69,SNAPSHOT_PROTOBUF_DESERIALIZATION_FAILED:70,REQUESTING_MISSING_KEY_WITH_NO_CLIENTS:71,DB_STORE_NOT_READY_LOW_DISK_SPACE:72,SERVER_DID_NOT_SEND_ALL_PATCHES:73,SERVER_SENT_EARLIER_PATCH:74,MISSING_KEY_FOR_MUTATION_IN_LOCAL_SNAPSHOT:75,MISSING_ACTIVE_KEY_AFTER_ROTATION:76,MISSING_ACTIVE_KEY_FOR_ENCRYPTION:77,MISSING_CURRENT_EPOCH_FOR_ACTIVE_KEY_VALIDATION:78,SAME_INDEX_FOR_MULTIPLE_MUTATIONS_IN_OUTGOING_PATCH:79,INVALID_SNAPSHOT_RECORDS:80,MISSING_EXTERNAL_BLOB_REFERENCE_HANDLE:81,INVALID_EXTERNAL_BLOB_REFERENCE_UPLOADED:82,INVALID_PATCH_KEY_ID_SIZE:83,INVALID_PATCH_MAC_SIZE:84,INVALID_PATCH_SNAPSHOT_MAC_SIZE:85,INVALID_COLLECTION_SNAPSHOT_HASH_SIZE:86,MISSING_COLLECTION_SNAPSHOT_HASH:87,INVALID_PATCH_KEY_ID_DEVICE_ID:88,INVALID_PATCH_KEY_ID_EPOCH:89,DECRYPTION_FAILED_KEY_ID_MISMATCH:90,DECRYPTION_FAILED_VALUE_MAC_MISMATCH:91,DECRYPTION_FAILED_INDEX_MAC_MISMATCH:92,EXTERNAL_PATCH_MISSING_BLOB:93,COLLECTION_PULL_REQUEST_RECEIVED_PUSH_RESPONSE_WITH_UPDATED_VERSION:94,COLLECTION_PUSH_REQUEST_RECEIVED_RESPONSE_WITH_VERSION_MISMATCH:95,MMS_ERROR_INVALID_FILEHASH:96,UNKNOWN:97,MALFORMED_MUTATION_CLEAR_CHAT:98,MALFORMED_MUTATION_DELETE_CHAT:99,FAILED_MUTATION_CLEAR_CHAT:100,FAILED_MUTATION_DELETE_CHAT:101,CHAT_DB_CORRUPTION:102}),Bt=Object.freeze({SNAPSHOT:1,EXTERNAL_PATCH:2,INLINE_PATCH:3}),Ft=Object.freeze({SYNCD:1,WEB:2}),jt=Object.freeze({BROWSER:1,DESKTOP:2}),Yt=Object.freeze({MANUAL:1,FULL:2,PREFETCH:3,HEADER:4,THUMBNAIL:5,EXPRESS_PATH_DOWNLOAD:6}),Kt=Object.freeze({OK:1,ERROR_UNKNOWN:2,ERROR_TIMEOUT:3,ERROR_DNS:4,ERROR_INSUFFICIENT_SPACE:5,ERROR_TOO_OLD:6,ERROR_CANNOT_RESUME:7,ERROR_HASH_MISMATCH:8,ERROR_INVALID_URL:9,ERROR_OUTPUT_STREAM:10,ERROR_CANCEL:11,DEDUPED:12,ERROR_ENC_HASH_MISMATCH:14,PREFETCH_END:15,ERROR_CANCEL_PROGRAMMATIC:16,ERROR_MEDIA_CONN:17,ERROR_THROTTLE:18,ERROR_SSL:19,ERROR_NETWORK:20,ERROR_CONNECT:21}),Wt=Object.freeze({CHAT_PHOTO_LIBRARY:1,CAMERA_TAB_CAPTURE:2,FORWARD:3,PASTE:4,SHARE_EXTENSION:5,EXPORT:6,MENU_CAMERA_CAPTURE:7,EXTERNAL_CAMERA:8,LINK_PREVIEW_DOWNLOAD:9,CAMERA_TAB_MEDIA_STRIP:10,CAMERA_TAB_PHOTO_LIBRARY:11,CHAT_BUTTON_CAMERA_CAPTURE:12,CHAT_BUTTON_CAMERA_MEDIA_STRIP:13,CHAT_BUTTON_CAMERA_PHOTO_LIBRARY:14,STATUS_TAB_CAMERA_CAPTURE:15,STATUS_TAB_CAMERA_MEDIA_STRIP:16,STATUS_TAB_CAMERA_PHOTO_LIBRARY:17,STATUS_REPLY_CAMERA_CAPTURE:18,STATUS_REPLY_CAMERA_MEDIA_STRIP:19,STATUS_REPLY_CAMERA_PHOTO_LIBRARY:20,MENU_CAMERA_PHOTO_LIBRARY:21,CHAT_GIF_INAPP:22,CHAT_GIF_EXTERNAL:23,STATUS_REPLY_GIF_INAPP:24,STATUS_REPLY_GIF_EXTERNAL:25,SMB_QUICK_REPLY_EDIT:26,SMB_QUICK_REPLY_SEND:27,MEDIA_BROWSER:28,CHAT_QUICK_EDIT:29,CAMERA_TAB_GIF:30,STATUS_TAB_GIF:31,PAYMENT_COMPOSER:32,PHOTO_RECEIVED:33,PHOTO_RECEIVED_GALLERY:34}),Ht=Object.freeze({NONE:1,PHOTO:2,VIDEO:3,AUDIO:4,PTT:5,LOCATION:6,CONTACT:7,DOCUMENT:8,URL:9,CALL:10,GIF:11,FUTURE:12,CONTACT_ARRAY:13,LIVE_LOCATION:14,PROFILE_PIC:15,STICKER:16,HSM:17,PRODUCT_IMAGE:18,TEMPLATE:19,MD_APP_STATE:20,MD_HISTORY_SYNC:21,CATALOG_LINK:22,PRODUCT_LINK:23,ORDER:24,LIST:25,LIST_REPLY:26,BUTTON_MESSAGE:27,BUTTON_RESPONSE_MESSAGE:28,PRODUCT_LIST:29,BUTTON_NFM:30,VIEW_ONCE_IMAGE:31,VIEW_ONCE_VIDEO:32,SHOP_STOREFRONT:33,REACTION:34,INTERACTIVE_NFM:35,INTERACTIVE_RESPONSE_NFM:36}),Vt=Object.freeze({REGULAR:1,FAST_FORWARD_EXIST_CHECK:2,VIDEO_EXIST_CHECK:3,PRODUCT:4,MEDIA_RETRY:5,WEB_REUPLOAD:6,THUMBNAIL:7,EXPRESS_PATH_UPLOAD:8}),$t=Object.freeze({OK:1,DUPLICATE:3,ERROR_UNKNOWN:2,ERROR_REQUEST:4,ERROR_UPLOAD:5,ERROR_OOM:6,ERROR_IO:7,ERROR_NO_PERMISSIONS:8,ERROR_BAD_MEDIA:9,ERROR_INSUFFICIENT_SPACE:10,ERROR_FNF:11,ERROR_CANCEL:12,ERROR_SERVER:13,ERROR_REQUEST_TIMEOUT:14,ERROR_NOT_FINALIZED:15,ERROR_OPTIMISTIC_HASH:16,ERROR_MEDIA_CONN:17,ERROR_DNS:18,ERROR_THROTTLE:19,ERROR_SSL:20,ERROR_NO_CLIENT_NETWORK:21}),zt=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),qt=Object.freeze({OK:1,ERROR_UNKNOWN:3,ERROR_NETWORK:4,ERROR_EXPIRED:5,ERROR_CANCELLED:6,ERROR_UPLOAD:7,ERROR_BACKFILL_USYNC_FAILED:8,ERROR_PAYLOAD_TOO_BIG:9,ERROR_LOCATION:10,ERROR_INVALID_MESSAGE:11,ERROR_E2EE:12}),Jt=Object.freeze({INDIVIDUAL:1,GROUP:2,BROADCAST:3,STATUS:4}),Qt=Object.freeze({PREKEY_MESSAGE:1,CALL_PAYLOAD:2,RETRY_RECEIPT:3,PREKEY_RESPONSE:4,IDENTITY_RESPONSE:5,USYNC_RESPONSE:6}),Xt=Object.freeze({LOGIN:0,LOGOUT:1,CUSTOM_AGENT_NAME:2,MESSAGE_INFO:3}),Zt=Object.freeze({ZERO:1,ONE:2,LT10:3,LT100:4,LT500:5,LT1K:6,LT5K:7,GTE5K:8}),en=Object.freeze({NATIVE:0,OK_HTTP:1,LIGER:2,APACHE:3,WATLS:4}),tn=Object.freeze({ALLOWED:1,BLOCKED:2,UNKNOWN:3}),nn=Object.freeze({NONE:1,SOFTWARE:2,BUILTIN:3}),rn=Object.freeze({PAGE_LOAD:1,SOCKET_CONNECT:2,PROCESS_COMPLETE:3,SCREEN_LOAD:4}),an=Object.freeze({NONE:0,OPTIMISTIC:1,OPT_USED:2,OPT_TAKEOVER:3,OPT_DISABLED:4}),on=Object.freeze({CLICK_VIEW_RECEIVED_CART:1,SEND_DECLINE_CART:2,USER_DELETED_CART:3,CLICK_CREATE_ORDER_DETAILS_FROM_CART:4,CLICK_ORDER_FROM_ICON_MENU:5,CLICK_CREATE_ORDER_DETAILS_FROM_FAB:6,SEND_ORDER_DETAILS:7,VIEW_ORDER_DETAILS_HUB:8,VIEW_ORDER_DETAILS:9,CLICK_SORT_ORDERS:10,CLICK_UPDATE_ORDER_STATUS:11,SEND_ORDER_STATUS:12,CLICK_PAYMENT_DETAILS:13,SEND_MARK_AS_PAID:14,SEND_MARK_AS_UNPAID:15,CLICK_HELP:16,CLICK_MESSAGE_CUSTOMER:17,CLICK_ADD_PAYMENT_OPTION:18,CLICK_SAVE_ADD_PAYMENT_OPTION:19,CLICK_SAVE_EDIT_PAYMENT_OPTION:20,CLICK_EDIT_PAYMENT_OPTION:21,CLICK_DELETE_PAYMENT_OPTION:22,CLICK_GET_PAID_ON_WA:23,CLICK_SEE_ALL_OTHER_ORDERS:24,ADD_PAYMENT_OPTION_TO_OD:25,EDIT_PAYMENT_OPTION_IN_OD:26}),sn=Object.freeze({OTHER:0,CHAT:1,NOTIFICATION:2}),ln=Object.freeze({NOTIFICATION_CTA:0,NOTIFICATION_BODY:1,CHAT_CTA:2,OTHER:3}),cn=Object.freeze({CLICK:0,IMPRESSION:1,OTP_CODE_REQUESTED:2,OTP_CODE_SENT:3}),un=Object.freeze({ONE_TAP:0,ZERO_TAP:1}),dn=Object.freeze({RESUME_CHECK:1,UPLOAD:2,FINALIZE:3}),pn=Object.freeze({NONE_NEW_CONTENT:1,NONE_EXPIRED:2,REUSED:3,NONE_WAS_STATUS:4}),fn=Object.freeze({CONSUMER:1,SMB:2,ENT:3}),_n=Object.freeze({CELLULAR:1,WIFI:2,NONE:3}),hn=Object.freeze({PHONE_NUM_HYPERLINK_MSG_RECEIVED:1,LONG_PRESS_PHONE_NUM_HYPERLINK:2,CLICK_PHONE_NUM_HYPERLINK:3,CLICK_CALL:4,CLICK_ADD_TO_CONTACTS:5,CLICK_MESSAGE_ON_WHATSAPP:6,CLICK_COPY_PHONE_NUMBER:7,CLOSE_DIALOG_BOX:8,MESSAGE_SENT:9}),gn=Object.freeze({OTHER:0,ADD:1,VIEW:2,POPULATE:3}),mn=Object.freeze({OTHER:0,INDIVIDUAL:1,GROUP:2,STATUS:3,BROADCAST:4}),yn=Object.freeze({OTHER:0,SIGNAL_NO_SESSION:1,DEVICE_VERIFICATION_FAILURE:2,UNKNOWN_SELF_DEVICE:3,SIGNAL_INVALID_KEY:4,SIGNAL_INVALID_KEY_ID:5,SIGNAL_INVALID_MESSAGE:6,DEVICE_VERIFICATION_FAILURE_SELF_PEER:7,UNKNOWN_COMPANION_NO_PREKEY:8,BAD_EPHEMERAL_SETTING:9}),Sn=Object.freeze({OTHER:0,CIPHERTEXT:1,FANOUT:2,DOWNGRADE:3}),En=Object.freeze({IPHONE:1,ANDROID:2,BB:3,BBX:7,S40:4,SYMBIAN:5,WP:6,WEBCLIENT:8,OSMETA:11,ENT:12,SMBA:13,KAIOS:14,SMBI:15,WINDOWS:16,WEB:17,PORTAL:18,BLOKS:19,BLUEA:20,BLUEI:21,FBLITEA:22,GREENA:23,GREENI:24,IGDA:25,IGDI:26,IGLITEA:27,MLITEA:28,MSGRA:29,MSGRI:30,MSGRP:31,MSGRW:32,IGDW:33,PAGE:34,MSGRDM:35,MSGRDW:36,MSGROM:37,MSGROC:38,MSGRM:43,IGDM:44,WEARM:45,CAPI:46,XR:47,MACOS:48,TEST:9,UNKNOWN:10}),vn=Object.freeze({CONVERSATION:1,STATUS:2}),Tn=Object.freeze({IDLE:1,READY_PLAY:2,READY_PAUSE:3,BUFFERING:4,OUTSIDE:5,ENDED:6,ERROR:7}),Cn=Object.freeze({LT4:1,LT8:2,LT16:3,LT32:4,LT64:5,LT128:6,LT256:7,LT512:8,LT1000:9,LT1500:10,LT2000:11,LT2500:12,LT3000:13,LT3500:14,LT4000:15,LT4500:16,LT5000:17,LARGEST_BUCKET:18}),An=Object.freeze({LOCAL:0,UNIVERSAL:1}),bn=Object.freeze({SEND_MESSAGE:1,GET_VNAME_CERTIFICATE:2,SEND_LIVE_LOCATION_RETRY:3,SEND_LIVE_LOCATION_KEY:4,SEND_PEER_MESSAGE:5,MULTI_DEVICE_CALL:6,CALL_PEER_E2E_FAIL:7,IDENTITY_CHANGE_NOTIFICATION:8,BACK_OFF:9,USER_INTENT_PREFETCH:10,RESEND_MESSAGE:11,RETRY_MESSAGE:12}),Pn=Object.freeze({ADV_SIGNED_DEVICE_IDENTITY:1,ADV_SIGNED_KEY_INDEX_LIST:2}),On=Object.freeze({E2EE:0}),Mn=Object.freeze({GOLDEN_BOX_CONTACT:0,GOLDEN_BOX_GROUP:1,GOLDEN_BOX_BROADCAST:2,INFO_SCREEN_CONTACT:3,INFO_SCREEN_GROUP:4,INFO_SCREEN_BROADCAST:5,CALLS_LIST:6,CHATS_LIST:7,STATUS_LIST:8,LINKED_DEVICES_SCREEN:9,CALLING_SCREEN_AUDIO:10,CALLING_SCREEN_VIDEO:11}),In=Object.freeze({B0:1,B1:2,B5:3,B10:4,B15:5,B20:6,B30:7,B40:8,B50:9,B60:10,B70:11,B80:12,B90:13,B100:14}),wn=Object.freeze({NOBODY:1,ONLY_SHARE_WITH:2,MY_CONTACTS:3,MY_CONTACTS_EXCEPT:4,EVERYONE:5}),Rn=Object.freeze({CONTACT_CARD:1,CHAT_HEADER:2,CHAT_MENU:3,GROUP_MEMBERSHIP_SCREEN:4,STATUS:5,CALLS:6,BROADCAST_LIST:7,PRODUCT:8,CATALOG:9,SETTINGS:10,SPAM_BLOCK:11,CHATS_HOME:12,SHOPS:13,MENTION:14,EPHEMERAL_SETTINGS_MESSAGE:15,MAP:16,SEARCH:17,PAYMENT_TRANSACTION_DETAILS:18,CUSTOM_URL_LINK:19,CUSTOM_URL_QR_CODE:20}),Nn=Object.freeze({DIT:1,DIRECTORY_SEARCH:2}),Ln=Object.freeze({CHATLIST:1,CHAT:2,SHARE:3}),Dn=Object.freeze({COLD:1,WARM:2,LUKEWARM:3}),kn=Object.freeze({SUCCESS:1,ERROR_PARSING:2,ERROR_DECODING:3,ERROR_CREDENTIAL:4,ERROR_OTHER:5,ERROR_CLIENT_NETWORK:6,ERROR_WAIT_FOR_TOKEN:7,ERROR_SERVER_OTHER:8,SKIPPED_NO_NETWORK:9,SKIPPED_NO_DATA:10,ERROR_ACCESS_TOKEN:11}),Un=Object.freeze({CRASH:0,OOM:1,MAIN_THREAD_STALL_30_SECONDS:2,MAIN_THREAD_STALL_DEBUG:3,AUDIO_TRANSCODING_ERROR:4,VIDEO_TRANSCODING_ERROR:5,ANR:6,CRITICAL_EVENT:7,UNHANDLED_EXCEPTION:8,APP_CRASH:9,NATIVE_CRASH:10,UFAD:11}),Gn=Object.freeze({CREATED:1,ROTATED:2,DELETED:3}),xn=Object.freeze({TEST_VALUE1:1,TEST_VALUE2:2}),Bn=Object.freeze({NO_REASON:0,REASON_UNKNOWN:1,REASON_WAIT_FOR_FIRST_TOKEN:2,REASON_INVALID_SHARED_KEY:3,REASON_INVALID_FACTOR:4,REASON_GEN_FACTOR_FAILURE:5,REASON_COMPUTE_HMAC_FAILURE:6,REASON_BLIND_FAILURE:7,REASON_UNBLIND_FAILURE:8,REASON_LAST_SIGNREQ_NETWORK_FAILURE:9,REASON_LAST_SIGNREQ_SERVER_ERROR:10,REASON_LAST_SIGNREQ_BAD_REQUEST:11,REASON_LAST_SIGNREQ_OTHER_ERROR:12,REASON_WAIT_FOR_GEN_TOKEN:13,REASON_GEN_SHAREDKEY_FAILURE:14,REASON_WAIT_FOR_GEN_FIRST_TOKEN:15}),Fn=Object.freeze({REASON_PS_PINGER:0,REASON_PS_OFFCYCLE:1}),jn=Object.freeze({SUCCESS:1,CANCEL:2,ERROR:3}),Yn=Object.freeze({SAVE:1,FORWARD:2,REACT:3,LINK_CLICK:4,MEDIA_PLAY:5,DELETE:6}),Kn=Object.freeze({BLOCK:1,UNBLOCK:2,ARCHIVE:3,UNARCHIVE:4,CLEAR:5,DELETE_ALL:6}),Wn=Object.freeze({BLOCK_FROM_CONTACT_INFO:1,BLOCK_FROM_CHAT:2,UNBLOCK_FROM_CONTACT_INFO:3,UNBLOCK_FROM_CHAT:4,UNBLOCK_FROM_PRIVACY_SETTINGS:5,ARCHIVE_FROM_CHAT_LIST:6,ARCHIVE_FROM_DELETE_OPTION:7,UNARCHIVE_FROM_ARCHIVED_CHAT_LIST:8,CLEAR_FROM_CONTACT_INFO:9,CLEAR_FROM_CHAT_LIST:10,DELETE_ALL_FROM_CHAT_LIST:11}),Hn=Object.freeze({SPEED_1:0,SPEED_1_5:1,SPEED_2:2}),Vn=Object.freeze({AUDIO_QUEUE:0,AVPLAYER:1,AVAUDIOPLAYER:2,OPUSPLAYER:3,ANDROIDPLAYER:4,EXOPLAYER:5}),$n=Object.freeze({SENT:1,CANCELLED:2,TOO_SHORT:3}),zn=Object.freeze({FROM_CONVERSATION:0,FROM_VOICEMAIL:1}),qn=Object.freeze({UNKNOWN:0,AAC:1,MP3:2,AMR_NB:3,AMR_WB:4,OPUS:5,MULTIPLE_TRACKS:6}),Jn=Object.freeze({MANUAL:0,SEQUENTIAL:1}),Qn=Object.freeze({STICKER_STORE_DATA:0,PREVIEW_IMAGE_DOWNLOAD:1,STICKER_PACK_DATA:2,STICKER_SEARCH:3}),Xn=Object.freeze({ACTION_SETTINGS_IMPRESSION:1,ACTION_SETTINGS_ADD_CLICK:2,ACTION_SETTINGS_ADD_ABANDONED:3,ACTION_SETTINGS_ADDED:4,ACTION_SETTINGS_DELETED:5,ACTION_CHAT_IMPRESSION:6,ACTION_CHAT_CLICK:7,ACTION_SETTINGS_EDITED:8,ACTION_CHAT_INVALID_ATTACHMENTS:9,ACTION_SETTINGS_INVALID_ATTACHMENTS:10,ACTION_SETTINGS_MEDIA_TRANSCODE:11,ACTION_CHAT_CLICK_CANCEL:12,ACTION_SMART_DEFAULT_CLICK:13,QUICK_REPLY_MESSAGE_SENT:14}),Zn=Object.freeze({QUICK_REPLY_ENTRY_POINT_KEYBOARD:1,QUICK_REPLY_ENTRY_POINT_ATTACHMENT_PANEL:2,QUICK_REPLY_ENTRY_POINT_SETTINGS_MENU:3,QUICK_REPLY_ENTRY_POINT_BANNERS:4,QUICK_REPLY_ENTRY_POINT_NUX:5}),er=Object.freeze({UNKNOWN:0,CONVERSATIONS:1,BUTTON:2,KEYBOARD:3}),tr=Object.freeze({QUICK_REPLY_TRANSCODE_RESULT_OK:1,QUICK_REPLY_TRANSCODE_RESULT_CANCELLED:2,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_UNKNOWN:3,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_ENCODING:4,QUICK_REPLY_TRANSCODE_RESULT_FAIL_IMAGE_FILE_COPY:5,QUICK_REPLY_TRANSCODE_RESULT_FAIL_VIDEO_UNKNOWN:6}),nr=Object.freeze({CELLULAR_UNKNOWN:0,WIFI_UNKNOWN:1,CELLULAR_EDGE:100,CELLULAR_IDEN:101,CELLULAR_UMTS:102,CELLULAR_EVDO:103,CELLULAR_GPRS:104,CELLULAR_HSDPA:105,CELLULAR_HSUPA:106,CELLULAR_HSPA:107,CELLULAR_CDMA:108,CELLULAR_1XRTT:109,CELLULAR_EHRPD:110,CELLULAR_LTE:111,CELLULAR_HSPAP:112}),rr=Object.freeze({OPEN_TRAY:1,DELETE:2,UPDATE:3}),ir=Object.freeze({CHAT_LIST:1,CHAT:2}),ar=Object.freeze({SUCCESS:1,ERROR:2}),or=Object.freeze({OTHER:0,DOUBLE_CHECKMARK:1,IDENTITY_CHANGE:2}),sr=Object.freeze({SENDER:0,ADMIN:1}),lr=Object.freeze({CALLS_TAB:1,GROUP_CALL_UI:2,ATTACHMENT:3,WEB_MENU:4}),cr=Object.freeze({CATALOG:1,COLLECTION:2,MPM:3}),ur=Object.freeze({ACTION_SEARCH_CLICK:1,ACTION_SUBMIT_SEARCH:2,ACTION_SEARCH_RESULT_CLICK:3,ACTION_QUANTITY_SELECTOR_ADD:4,ACTION_QUANTITY_SELECTOR_REMOVE:5,ACTION_SEARCH_VIEW_CART_CLICK:6,ACTION_EXIT_SEARCH_CLICK:7}),dr=Object.freeze({E2EE:0,BSP:1,FB:2}),pr=Object.freeze({CUSTOM_URL:1,PHONE_NUMBER:2}),fr=Object.freeze({ACTION_COPY_BUSINESS_LINK:1,ACTION_SHARE_BUSINESS_LINK:2,ACTION_SHARE_QR_CODE:3,ACTION_PREMIUM_NAME_REGISTER:4,ACTION_SHARE_QR_CODE_BUTTON_CLICK:5,ACTION_DELETE_CUSTOM_URL:6,ACTION_UPGRADE_TO_PREMIUM_LINK_CLICK:7,ACTION_PREMIUM_NAME_PAGE_IMPRESSION:8,ACTION_PREMIUM_UPSELL_IMPRESSION:9,ACTION_SHARE_BUSINESS_ICON_CLICK:10,ACTION_EDIT_CUSTOM_URL:11}),_r=Object.freeze({ACTION_CLICK_SHOPS_SETTING:1,ACTION_CLICK_CATALOG_SETTING:2,ACTION_CLICK_COMMERCE_MANAGER_IN_CATALOG_SETTING:3,ACTION_CLICK_CANCEL_IN_CATALOG_SETTING:4,ACTION_CLICK_VIEW_SHOPS_IN_SHOPS_SETTING:5,ACTION_CLICK_COMMERCE_MANAGER_IN_SHOPS_SETTING:6,ACTION_CLICK_CANCEL_IN_SHOPS_SETTING:7,ACTION_SHOPS_PRODUCT_PREVIEW_VISIBLE:8,ACTION_CLICK_SHOPS_PRODUCT_PREVIEW_TILE:9,ACTION_CLICK_MANAGE_SHOPS:10,ACTION_SHARE_SHOPS:11,ACTION_CLICK_VIEW_SHOPS_FROM_EDIT_BIZ_PROFILE:12,ACTION_CLICK_COMMERCE_MANAGER_FROM_EDIT_BIZ_PROFILE:13,ACTION_CLICK_CANCEL_FROM_EDIT_BIZ_PROFILE:14}),hr=Object.freeze({SUCCESS:1,ERROR_BAD_REQUEST:2,ERROR_SERVER:3,ERROR_OTHER:4,ERROR_CLIENT_NETWORK:5}),gr=Object.freeze({ACCOUNT_SIGNATURE:1,DEVICE_SIGNATURE:2}),mr=Object.freeze({LT32:1,LT64:2,LT128:3,LT256:4,LT512:5,LT1000:6,LT1500:7,LT2000:8,LT2500:9,LT3000:10,LT3500:11,LT4000:12,LT4500:13,LT5000:14,LARGEST_BUCKET:15}),yr=Object.freeze({STATIC:0,SHARED:1}),Sr=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),Er=Object.freeze({UNKNOWN:1,TEXT:2,IMAGE:3,VOICE:4,DOCUMENT:5,AUDIO:6,STICKER:7,LOCATION:8,PRODUCT:9,CONTACT:10,CONTACT_ARRAY:11,CAMERA_CAPTURE_IMAGE:12,MEDIA_GALLERY:13,GIF_VIDEO:14,QUICK_REPLY:15}),vr=Object.freeze({OK:1,CANCELLED:2,ERROR_UNKNOWN:3}),Tr=Object.freeze({DIRECT_ROW_TAP:1,BACKWARDS_SWIPE:2,FOWARDS_SWIPE:3,BACKWARDS_TAP:4,FOWARDS_TAP:5,PREVIOUS_ROW_TIMEOUT:6}),Cr=Object.freeze({RECENT_STORIES:1,PREVIOUS_STORIES:2,MUTED_STORIES:3,MY_STATUS:4,CHAT_LIST:5,GROUP_PARTICIPANT:6,CONTACT_CARD:7,PROFILE_PAGE:8,CHAT_LIST_SEARCH:9}),Ar=Object.freeze({REGULAR:1,PAYMENTS:2}),br=Object.freeze({STICKER_SEARCH:1,FORWARD:2,STICKER_PICKER_TAB_RECENTS:3,STICKER_PICKER_TAB_FAVORITES:4,STICKER_PICKER_TAB_EMOTION:5,STICKER_PICKER_TAB_PACK:6,STICKER_PICKER_TAB_CONTEXTUAL_SUGGESTIONS:7,STICKER_MAKER:8,STICKER_STORE:9}),Pr=Object.freeze({BANNER_SHOW:1,BANNER_DISMISS:2,BANNER_TAP_VIEW_CHANGES:3,BANNER_NOT_SHOWN_REGISTRATION_TOO_NEW:4,BANNER_NOT_SHOWN_AGAIN_BEYOND_WINDOW:5}),Or=Object.freeze({HSM:0,BUTTON:1,LIST:2,PRODUCT_LIST:3,BUTTON_NFM:4,PRODUCT_ITEM:5,SHOP_STOREFRONT:6}),Mr=Object.freeze({NEW:0,ACTIVE:1,CHURNED:2}),Ir=Object.freeze({ACTIVATED:0,FAILED:1,CANCELED:3,EXPIRED:4,PAUSED:5}),wr=Object.freeze({PREMIUM_TOOLS:0,MULTI_DEVICE:1,CUSTOM_URL:2,MANAGE_EXISTING_SUBSCRIPTION:3,SMB_PREMIUM_UPSELL_CHAT_BANNER:4,SMB_PREMIUM_SUBS_PAYMENT_FAILED_BANNER:5,SMB_PREMIUM_SUBS_UNINTENTIONAL_CANCELED_BANNER:6}),Rr=Object.freeze({NO_SUBSCRIPTION_DATA_FOUND:0,WA_LATEST_VERSION_REQUIRED:1,GOOGLE_PLAY_SERVICES_NOT_INSTALLED:2,SUBSCRIPTION_QUOTE_FETCH_FAILED:3,SUBSCRIPTION_VERIFICATION_FAILED:4}),Nr=Object.freeze({PAID:0,FREE_TRIAL:1,DISCOUNT_TRIAL:2}),Lr=Object.freeze({NONE:1,SPEEX:2,WEBRTC:3,MWEBRTC:4,ECHOSUPPRESSOR:5}),Dr=Object.freeze({TITLE:1,CONTENT:2,FOOTER:3,BUTTON:4}),kr=Object.freeze({CHAT_ENTRY:1,SYSTEM_MESSAGE:2}),Ur=Object.freeze({B0:1,B1:2,B2:3,B11:4,B51:5,B101:6,B501:7,B1K:8,B10K:9,B100K:10,B1M:11}),Gr=Object.freeze({UPLOAD_SUCCESS:1,EMPTY_LOG_DIR:2,GZIP_FAILURE:3,UPLOAD_FAILURE:4,LOG_SIZE_EXCEEDED:5}),xr=Object.freeze({GROUP:1,SUBGROUP:2,DEFAULT_SUBGROUP:3}),Br=Object.freeze({INDIVIDUAL:1,GROUP:2,SUBGROUP:3,DEFAULT_SUBGROUP:4}),Fr=Object.freeze({OTHER:1,APP_OPEN:2,CHAT_OPEN:3,IMAGE_OPEN:4,FIRST_FTS_RESULT:5,CONTACTS_OPEN:6,GROUP_INFO_OPEN:7,MSG_INFO_OPEN:8,COMMUNITY_INFO_OPEN:9,DEFAULT_SUBGROUP_INFO_OPEN:10,COMMUNITY_CREATE:11,COMMUNITY_LINK:12}),jr=Object.freeze({MESSAGE_SELECTED:0,TRASH_CAN_SELECTED:1,ADMIN_DELETE_FOR_EVERYONE:2,SENDER_DELETE_FOR_EVERYONE:3,ADMIN_AND_SENDER_DELETE_FOR_EVERYONE:4,DELETE_FOR_EVERYONE_SELECTED:5}),Yr=Object.freeze({UNKNOWN:1,CHAT_PERSONAL:2,CHAT_GROUP:3,STATUS_USER:4,PRODUCT_CATALOG:5,STICKER_WEB:6,PAYMENTS_KYC:7,MESSAGE_HISTORY_SYNC:8}),Kr=Object.freeze({OTHER:1,CAMERA:2,GALLERY:3,SHARE:4}),Wr=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TOO_MANY_PORTS:101,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_PINHOLE_SPACE_EXHAUSTED:701,ERR_CODE_FIREWALL_DISABLED:702,ERR_CODE_INBOUND_PINHOLE_NOT_ALLOWED:703,ERR_CODE_NO_SUCH_ENTRY:704,ERR_CODE_PROTOCOL_NOT_SUPPORTED:705,ERR_CODE_INTERNAL_PORT_WILDCARD_NOT_ALLOWED:706,ERR_CODE_PROTOCOL_WILDCARD_NOT_ALLOWED:707,ERR_CODE_WILDCARD_NOT_PERMITTED_IN_SRC_IP:708,ERR_CODE_NO_PACKET_SENT:709,ERR_CODE_SPECIFIED_ARRAY_INDEX_INVALID:713,ERR_CODE_NO_SUCH_ENTRY_IN_ARRAY:714,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_CONFLICT_IN_MAPPING_ENTRY:718,ERR_CODE_SAME_PORT_VALUES_REQUIRED:724,ERR_CODE_ONLY_PERMANENT_LEASES_SUPPORTED:725,ERR_CODE_REMOTE_HOST_ONLY_SUPPORTS_WILDCARD:726,ERR_CODE_EXTERNAL_PORT_ONLY_SUPORTS_WILDCARD:727,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),Hr=Object.freeze({SUCCESS:0,UNKNOWN_ERROR:1,INVALID_ARGS:2,HTTP_ERROR:3,INVALID_RESPONSE:4,MEM_ALLOC_ERROR:5,NO_DEVICE_FOUND:6,NO_IGD_FOUND:7,NOT_ON_WIFI:100,TIMEOUT:102,ERR_CODE_INVALID_ACTION:401,ERR_CODE_INVALID_ARGS:402,ERR_CODE_ACTION_FAILED:501,ERR_CODE_ACTION_NOT_AUTHORIZED:606,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_SRC_IP:715,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_EXT_PORT:716,ERR_CODE_NO_PORT_MAPS_AVAILABLE:728,ERR_CODE_CONFLICT_WITH_OTHER_MECHANISMS:729,ERR_CODE_WILD_CARD_NOT_PERMITTED_IN_INT_PORT:732,DISABLED:999}),Vr=Object.freeze({ONE_CLICK:1,TWO_CLICKS:2,NO_CLICK:3}),$r=Object.freeze({NO_PREVIEW:1,TRUNCATED:2,NON_TRUNCATED:3}),zr=Object.freeze({NARRATIVE_APPEAR:0,DIALOG_APPEAR:1,DIALOG_SELECT:2}),qr=Object.freeze({INVALID_STANZA:1,JSON_FETCH:2,JSON_PARSE:3,IMAGE_FETCH:4}),Jr=Object.freeze({BANNER_APPEAR:1,BANNER_SELECT:2,MODAL_APPEAR:3,MODAL_DISMISS:4,MODAL_LINK_FOLLOW:5,MODAL_ACCEPT:6,BLOCKING_MODAL_APPEAR:7,BLOCKING_MODAL_LINK_FOLLOW:8,BLOCKING_MODAL_ACCEPT:9,BANNER_DISMISS:10,EDUCATION_1_APPEAR:11,EDUCATION_1_DISMISS:12,EDUCATION_1_CONTINUE:13,MODAL_BACK:14,BLOCKING_MODAL_BACK:15}),Qr=Object.freeze({WA_IPHONE:0,FB_IPHONE:1}),Xr=Object.freeze({UNKNOWN:0,SUCCEEDED:1,FAILED:2,CANCELLED:3}),Zr=Object.freeze({SLOMO:0,VIDEO:1,GIF:2}),ei=Object.freeze({IMAGE:0,VIDEO:1,GIF:2}),ti=Object.freeze({ACTION_CATEGORY_LEVEL_CLICK:1,ACTION_CATEGORY_LEVEL_IMPRESSION:2,ACTION_CATEGORY_PRODUCT_CLICK:3,ACTION_CATEGORY_PREFETCH:4}),ni=Object.freeze({ACTION_IMPRESSION:1,ACTION_CLICK_WEBSITE:2,ACTION_CLICK_LOCATION:3,ACTION_CLICK_HOURS:4,ACTION_CLICK_DESCRIPTION:5,ACTION_CLICK_EMAIL:6,ACTION_CLICK_ADDTOCONTACT:7,ACTION_CLICK_MORE_BIZ_PROFILE:8,ACTION_CLICK_MESSAGE:9,ACTION_CLICK_VOICE_CALL:10,ACTION_CLICK_VIDEO_CALL:11,ACTION_CLICK_FORWARD:12,ACTION_CLICK_CATALOG_ICON:13,ACTION_CLICK_SHOPS_ICON:14,ACTION_CLICK_APP_LINK:15,ACTION_APP_IMPRESSION:16,ACTION_CLICK_STATUS:17,ACTION_EXIT:18,ACTION_COVER_PHOTO_IMPRESSION:19}),ri=Object.freeze({SERIAL_MISMATCH_CERT_IN_MESSAGE_INVALID:0,NEW_SERIAL_CERT_IN_MESSAGE_INVALID:1,GET_VNAME_CERT_INVALID:2,VNAME_CERT_UPDATE_INVALID:3,IDENTITY_ADDED_INVALID:4,IDENTITY_CHANGED_INVALID:5,IDENTITY_DELETED_INVALID:6,USYNC_VNAME_CERT_INVALID:7,USYNC_NO_VNAME_CERT:8}),ii=Object.freeze({PHOTO:1,VIDEO:2}),ai=Object.freeze({SENDER_NUX_TYPE_C_IMPRESSION:1,SENDER_NUX_TYPE_D_IMPRESSION:2,SCREENSHOT_SENDER_NUX_TYPE_D_IMPRESSION:3,RECIPIENT_OPEN_NUX_TYPE_C_IMPRESSION:4,RECIPIENT_OPEN_NUX_TYPE_D_IMPRESSION:5,SENDER_NUX_TYPE_C_LEARN_MORE_TAP:6,SENDER_NUX_TYPE_D_LEARN_MORE_TAP:7,SCREENSHOT_SENDER_NUX_TYPE_D_LEARN_MORE_TAP:8,RECIPIENT_OPEN_NUX_TYPE_C_LEARN_MORE_TAP:9,RECIPIENT_OPEN_NUX_TYPE_D_LEARN_MORE_TAP:10,SCREENSHOT_BLOCKED:11,SCREENSHOT_TAKEN:12,SCREEN_RECORDING_BLOCKED:13,SCREEN_RECORDING_STARTED:14,PLACEHOLDER_MESSAGE_LEARN_MORE_TAP:15}),oi=Object.freeze({STATIC:0,SHARED:1}),si=Object.freeze({WHATSAPP_CHATPSA:1}),li=Object.freeze({INVALID:0,NOT_SINGLE_SEGMENT_CALL:1,NOT_START_FROM_VIDEO_CALL:2,HAS_AV_SWITCH:3,SELF_CAMERA_OFF:4,PEER_CAMERA_OFF:5,SELF_HAS_NETWORK_TRANSITION:6,PEER_HAS_NETWORK_TRANSITION:7,CALL_TOO_SHORT:8,PASS:100}),ci=Object.freeze({UNCACHED:0,IDLE:1,CHECKING:2,DOWNLOADING:3,UPDATEREADY:4,OBSOLETE:5}),ui=Object.freeze({UNCACHED:0,IDB:1,SW:2}),di=Object.freeze({INDIVIDUAL:0,GROUP:1,BROADCAST_LIST:2}),pi=Object.freeze({PROD:0,INTERN:1,DEV:2,E2E:3}),fi=Object.freeze({COMPLETED:0,ERROR:1,TIMEOUT:2,ABORTED:3}),_i=Object.freeze({SUCCESS:0,SILENCE:1,ZEROWIDTH:2}),hi=Object.freeze({DOWNLOAD:1,UPLOAD:2}),gi=Object.freeze({NEW_GROUP:1,CREATE_A_ROOM:2,PROFILE:3,CATALOG:4,ARCHIVED:5,STARRED:6,LABELS:7,SETTINGS:8,LOG_OUT:9,CONTACT_INFO:10,SELECT_MESSAGES:11,CLOSE_CHAT:12,MUTE_NOTIFICATIONS:13,CLEAR_MESSAGES:14,DELETE_CHAT:15,REPORT_BUSINESS:16,BLOCK:17,SETTINGS_NOTIFICATIONS:18,SETTINGS_THEME:19,SETTINGS_CHAT_WALLPAPER:20,SETTINGS_BLOCKED:21,SETTINGS_HELP:22,OPEN:23,CLOSE:24}),mi=Object.freeze({THREADS_SCREEN_CLICK:1,CHAT_SCREEN_CLICK:2,SETTINGS_SCREEN_CLICK:3}),yi=Object.freeze({LOAD_PREV:0,LOAD_NEXT:1,LOAD_AROUND:2}),Si=Object.freeze({NAVIGATE_NEXT:0,RELOAD:1,BACK_FORWARD:2,UNDEFINED:255}),Ei=Object.freeze({ANNOTATION_SIZE_LIMIT_EXCEEDED:1,MAX_POINT_COUNT_EXCEEDED:2,MAX_MARKER_COUNT_EXCEEDED:3,TOO_MANY_OPEN_MARKERS_TO_WRITE:4,POINT_TO_END_AT_NOT_FOUND:5,JSON_FORMAT_ERROR:6,MAX_STORAGE_EVENT_COUNT_REACHED:7,ERROR_UPLOADING_CHUNK:8,POINT_NAME_TOO_LONG:9,ANNOTATION_KEY_TOO_LONG:10,POINT_DATA_TOO_LONG:11,ERROR_PARSING_CONFIG:12}),vi=Object.freeze({UNKNOWN:0,USER_SCROLL:1,NEW_MESSAGE_PREFETCH:2,SEARCH_RESULT_CLICK:3}),Ti=Object.freeze({OTHER:0,MSG_CLICK:1,STICKER_PANEL_ICON:2,MEDIA_VIEWER:3,VIDEO_STREAMING:4,STATUS_V3:5,MULTI_SELECT_DOWNLOAD:6,DOCUMENT_DOWNLOAD:7,PIP:8,STICKER_PANEL_STICKER:9,SEND_TO_CHAT:10,UPLOAD:11,MSG_INIT:12,MSG_UPDATE:13,MSG_DELETE:14,MSG_RENDER:15}),Ci=Object.freeze({INITIAL_PAIRING:0,OFFLINE_RESUME:1,IDLE:2}),Ai=Object.freeze({TEXT:0,URL:1,IMAGE:2,VIDEO:3,GIF:4}),bi=Object.freeze({MY:0,RECENT:1,VIEWED:2,MUTED:3}),Pi=Object.freeze({STICKER_MAKER_BUTTON_TAP:0,IMAGE_UPLOADED:1,IMAGE_CROPPED:2,EMOJI_ADDED:3,STICKER_ADDED:4,TEXT_ADDED:5,IMAGE_OUTLINED:6,SEND_STICKER:7}),Oi=Object.freeze({QR:0,MAIN:1,SYNCING:2,OFFLINE:3,CONFLICT:4,PROXYBLOCK:5,TOS_BLOCK:6,SMB_TOS_BLOCK:7,DEPRECATED_VERSION:8,LOCK:9}),Mi=Object.freeze({PHONE:0,SERVER:1}),Ii=Object.freeze({GET:0,SET:1}),wi=Object.freeze({WEB:1,WIN32:2,DARWIN:3,IOS_TABLET:4,ANDROID_TABLET:5,WINSTORE:6,MACSTORE:7,DARWIN_BETA:8,WIN32_BETA:9}),Ri=Object.freeze({FALSE:0,TRUE:1,UNDEFINED:2}),Ni=Object.freeze({SOURCE_OTHER:1,SOURCE_INSTAGRAM:2}),Li=Object.freeze({FIRST_WELCOME_MESSAGE_IMP:0,FIRST_MESSAGE_SENT:1,QUICK_QUESTIONS_TAP:2,ICEBREAKERS_IMP:3,SELECT_QUESTION_TAP:4,SEND_TAP:5,ADS_CONTENT_DISMISSED:6}),Di=Object.freeze({IQ_REQUEST_FAILED:0,NO_WELCOME_MESSAGE_RETURNED:1,WELCOME_MESSAGE_RETURNED:2}),ki=Object.freeze({DISCONNECTED:1,CONNECTING:2,CONNECTED:3,UNKNOWN:4}),Ui=Object.freeze({DISABLED:0,ALLOC:1,ALLOC_AND_RTP:2}),Gi=(0,a.defineGlobal)({abKey2:[4473,c,["regular"]],appBuild:[1657,S,["regular","private"]],appIsBetaRelease:[21,o,["regular","private"]],appVersion:[17,c,["regular","private"]],browser:[779,c,["regular"]],browserVersion:[295,c,["regular"]],datacenter:[2795,c,["regular"]],deviceName:[13,c,["regular","private"]],deviceVersion:[4505,c,["regular"]],expoKey:[5029,c,["regular","private"]],mcc:[5,s,["regular","private"]],memClass:[655,s,["regular","private"]],mnc:[3,s,["regular","private"]],networkIsWifi:[23,o,["regular"]],osVersion:[15,c,["regular","private"]],platform:[11,En,["regular","private"]],psCountryCode:[6833,c,["private"]],psId:[6005,c,["private"]],webcBucket:[875,c,["regular"]],webcEnv:[633,pi,["regular"]],webcNativeAutolaunch:[1009,o,["regular"]],webcNativeBetaUpdates:[1007,o,["regular"]],webcPhoneAppVersion:[1005,c,["regular"]],webcPhoneCharging:[783,o,["regular"]],webcPhoneDeviceManufacturer:[829,c,["regular"]],webcPhoneDeviceModel:[831,c,["regular"]],webcPhoneOsBuildNumber:[833,c,["regular"]],webcPhoneOsVersion:[835,c,["regular"]],webcPhonePlatform:[707,En,["regular"]],webcTabId:[3727,c,["regular"]],webcWebArch:[6605,c,["regular"]],webcWebDeviceManufacturer:[6599,c,["regular"]],webcWebDeviceModel:[6601,c,["regular"]],webcWebOsReleaseNumber:[6603,c,["regular"]],webcWebPlatform:[899,wi,["regular","private"]],yearClass:[689,s,["regular","private"]],yearClass2016:[2617,s,["regular","private"]]});(0,a.defineEvents)({AdvExpectedTsUnavailable:[3038,{},[1,1,1],"regular"],AdvIdentitySignatureInvalid:[3028,{advSignatureType:[1,gr]},[1,1,1],"regular"],AdvIdentityTimestampInvalid:[3046,{advIdentityIncomingTimestampInHours:[2,s],advIdentityLocalTimestampInHours:[1,s],advIdentityPrimaryIdentityMatch:[3,o]},[1,1,1],"regular"],AdvListSignatureInvalid:[3026,{},[1,1,1],"regular"],AdvListTimestampInvalid:[3040,{advListIncomingTimestampInHours:[2,s],advListIsExpired:[3,o],advListLocalTimestampInHours:[1,s]},[1,1,1],"regular"],AdvMetadataCreationFailure:[3048,{advMetadataIsMe:[1,o]},[1,1,1],"regular"],AdvPrimaryIdentityMissing:[3044,{primaryIdentityMissingProtoType:[1,Pn]},[1,1,1],"regular"],AdvProtoDecodeFailed:[3032,{advDecodeErrorType:[2,p],advDecodeProtoType:[1,f]},[1,1,1],"regular"],AdvProtoMissing:[3042,{advCompanionIdentityMissing:[2,o],missingProtoType:[1,Qt]},[1,1,1],"regular"],AdvStoredTimestampExpired:[3036,{advExpireTimeInHours:[1,s]},[1,1,1],"regular"],AdvTimestampMismatch:[3030,{advProtobufTimestampInHours:[2,s],advStanzaTimestampInHours:[1,s]},[1,1,1],"regular"],AdvUsyncInvalidKeyIndex:[3034,{},[1,1,1],"regular"],AndroidMessageSendPerf:[1994,{appRestart:[16,o],bucketedSenderKeyDistributionCountPercentage:[32,s],bucketedSenderKeyDistributionHashTime:[35,s],deviceCount:[36,s],deviceSizeBucket:[26,mr],durationAbs:[11,u],durationRelative:[12,u],durationT:[1,u],fetchPrekeys:[15,o],fetchPrekeysPercentage:[21,s],groupSizeBucket:[17,Te],isDirectedMessage:[33,o],isE2eBackfill:[27,o],isMessageFanout:[9,o],isMessageForward:[8,o],isRevokeMessage:[24,o],isViewOnce:[29,o],jobsInQueue:[18,s],mediaType:[3,Ht],messageIsFirstUserMessage:[30,o],messageIsInvisible:[31,o],messageType:[4,Jt],networkWasDisconnected:[14,o],participantCount:[37,s],phoneCores:[34,s],prekeysEligibleForPrallelProcessing:[28,o],receiverDeviceCount:[39,s],sendCount:[13,s],sendRetryCount:[10,s],sendStage:[2,Ce],senderDeviceCount:[40,s],senderKeyDistributionCountPercentage:[23,s],sessionsMissingWhenComposing:[25,o],targetDeviceGroupSizeBucket:[20,Te],threadsInExecution:[19,s],typeOfGroup:[38,xr]},[1,1,2e3],"regular"],ArchiveSettings:[2788,{keepChatsArchived:[1,o]},[1,1,1],"regular"],AutoReply:[3212,{autoReplyAction:[1,T]},[1,1,1],"private",113760892],BadInteraction:[3316,{actual:[1,u],name:[2,c],threshold:[3,u]},[1,1,1],"regular"],BannerEvent:[1578,{bannerId:[3,c],bannerOperation:[2,P],bannerType:[1,O]},[1,1,1],"regular"],BizCatalogView:[3006,{bizPlatform:[14,I],cartToggle:[13,o],catalogCategoryId:[19,c],catalogEntryPoint:[2,le],catalogEventSampled:[11,o],catalogOwnerJid:[10,c],catalogReportReasonCode:[8,c],catalogSessionId:[3,c],catalogViewAction:[1,ce],collectionId:[15,c],collectionIndex:[16,c],deepLinkOpenFrom:[12,je],isNewProductAddedToCart:[7,o],isOrderMsgAttached:[5,o],orderId:[4,c],productId:[9,c],productIndex:[17,c],quantity:[6,s],sequenceNumber:[18,s]},[1,1,1],"private",0],BizProfileView:[3008,{bizFbSize:[8,Ur],bizIgSize:[9,Ur],businessProfileJid:[2,c],catalogSessionId:[6,c],hasCoverPhoto:[13,o],isProfileLinked:[10,o],isSelfView:[11,o],linkedAccount:[5,H],profileEntryPoint:[12,Rn],scrollDepth:[4,s],sequenceNumber:[7,s],viewBusinessProfileAction:[1,ni],websiteSource:[3,Ni]},[1,1,1],"private",0],BusinessInteraction:[3450,{businessInteractionAction:[1,L],businessInteractionTargetScreen:[2,G],businessJid:[3,c],entryPointApp:[4,D],entryPointSource:[5,k],internalEntryPoint:[6,U],sequenceNumber:[7,s]},[1,1,1],"private",113760892],BusinessMute:[1376,{muteT:[2,u],muteeId:[1,c]},[1,1,1],"regular"],BusinessProfileView:[2440,{businessOwnerJid:[2,c],businessProfileViewAction:[1,j],businessProfileWebsiteSourceTyp:[3,Y]},[1,1,1],"private",113760892],BusinessToolsClick:[2218,{businessToolsItem:[3,W],businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c],linkingTarget:[4,H]},[1,1,1],"regular"],BusinessToolsEntry:[2216,{businessToolsEntryPoint:[3,K],businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessToolsImpression:[2220,{businessToolsSequenceNumber:[2,s],businessToolsSessionId:[1,c]},[1,1,1],"regular"],BusinessUnmute:[1378,{muteeId:[1,c]},[1,1,1],"regular"],CadminDemote:[3426,{cadminDemoteOrigin:[1,V],cadminDemoteResult:[2,$],isLastCadminOrCreator:[4,o]},[1,1,1],"regular"],Call:[462,{acceptAckLatencyMs:[1016,u],acceptedButNotConnectedTimeSpentMs:[1015,u],activeRelayProtocol:[412,s],aflDisPrefetchFailure1x:[1186,u],aflDisPrefetchFailure2x:[1187,u],aflDisPrefetchFailure4x:[1188,u],aflDisPrefetchFailure8x:[1189,u],aflDisPrefetchFailureTotal:[1190,u],aflDisPrefetchSuccess1x:[1191,u],aflDisPrefetchSuccess2x:[1192,u],aflDisPrefetchSuccess4x:[1193,u],aflDisPrefetchSuccess8x:[1194,u],aflDisPrefetchSuccessTotal:[1195,u],aflNackFailure1x:[1196,u],aflNackFailure2x:[1197,u],aflNackFailure4x:[1198,u],aflNackFailure8x:[1199,u],aflNackFailureTotal:[1200,u],aflNackSuccess1x:[1201,u],aflNackSuccess2x:[1202,u],aflNackSuccess4x:[1203,u],aflNackSuccess8x:[1204,u],aflNackSuccessTotal:[1205,u],aflOther1x:[1206,u],aflOther2x:[1207,u],aflOther4x:[1208,u],aflOther8x:[1209,u],aflOtherTotal:[1210,u],aflPureLoss1x:[1211,u],aflPureLoss2x:[1212,u],aflPureLoss4x:[1213,u],aflPureLoss8x:[1214,u],aflPureLossTotal:[1215,u],allocErrorBitmap:[593,s],androidAudioRouteMismatch:[1055,o],androidCamera2MinHardwareSupportLevel:[444,g],androidCameraApi:[443,m],androidSystemPictureInPictureT:[477,u],androidTelecomTimeSpentBeforeReject:[497,u],appInBackgroundDuringCall:[1109,o],audStreamMixPct:[1119,l],audioCodecDecodedFecFrames:[755,s],audioCodecDecodedPlcFrames:[756,s],audioCodecEncodedFecFrames:[751,s],audioCodecEncodedNonVoiceFrames:[753,s],audioCodecEncodedThrottledVoiceFrames:[1177,s],audioCodecEncodedVoiceFrames:[752,s],audioCodecReceivedFecFrames:[754,s],audioDeviceIssues:[860,s],audioDeviceLastIssue:[861,s],audioDeviceSwitchCount:[867,s],audioDeviceSwitchDuration:[866,u],audioFrameLoss1xMs:[724,u],audioFrameLoss2xMs:[725,u],audioFrameLoss4xMs:[726,u],audioFrameLoss8xMs:[727,u],audioGetFrameUnderflowPs:[83,s],audioInbandFecDecoded:[679,s],audioInbandFecEncoded:[678,s],audioLossPeriodCount:[722,s],audioNackHbhEnabled:[1184,o],audioNackReqPktsProcessed:[1271,s],audioNackReqPktsRecvd:[646,s],audioNackReqPktsSent:[645,s],audioNackRtpRetransmitDiscardCount:[649,s],audioNackRtpRetransmitFailCount:[651,s],audioNackRtpRetransmitRecvdCount:[648,s],audioNackRtpRetransmitReqCount:[647,s],audioNackRtpRetransmitSentCount:[650,s],audioNumPiggybackRxPkt:[1008,s],audioNumPiggybackTxPkt:[1007,s],audioPktsNotTriggerOutOfPaused:[1283,s],audioPlayCbIntervalGtDefaultCnt:[1138,s],audioPlayCbLatencyGteMaxCnt:[1139,s],audioPutFrameOverflowPs:[82,s],audioRecCbLatencyAvg:[1036,s],audioRecCbLatencyMax:[1035,s],audioRecCbLatencyMin:[1034,s],audioRecCbLatencyStddev:[1037,s],audioRtxPktDiscarded:[677,s],audioRtxPktProcessed:[676,s],audioRtxPktSent:[675,s],audioRxAvgFpp:[728,l],audioRxPktLossPctDuringPip:[642,l],audioTotalBytesOnNonDefCell:[450,l],avAvgDelta:[192,l],avMaxDelta:[193,l],aveNumPeersAutoPaused:[578,s],aveTimeBwResSwitches:[994,u],aveTimeBwVidRcDynCondTrue:[719,u],avgClockCbT:[139,u],avgCpuUtilizationPct:[1220,l],avgDecodeT:[136,u],avgEncRestartAndKfGenT:[1048,u],avgEncRestartIntervalT:[1047,u],avgEncodeT:[135,u],avgEventQueuingDelay:[816,s],avgLoudnessDiffNoiseFrames:[1302,l],avgLoudnessDiffSpeechFrames:[1303,l],avgLoudnessInputNoiseFrames:[1304,l],avgLoudnessInputSpeechFrames:[1305,l],avgLoudnessOutputNoiseFrames:[1306,l],avgLoudnessOutputSpeechFrames:[1307,l],avgPlayCbIntvT:[1152,u],avgPlayCbT:[137,u],avgRecordCbIntvT:[495,u],avgRecordCbT:[138,u],avgRecordGetFrameT:[140,u],avgTargetBitrate:[141,l],avgTcpConnCount:[413,s],avgTcpConnLatencyInMsec:[414,u],batteryDropMatched:[355,o],batteryDropTriggered:[442,o],batteryLowMatched:[354,o],batteryLowTriggered:[441,o],batteryRulesApplied:[353,o],biDirRelayRebindLatencyMs:[843,u],biDirRelayResetLatencyMs:[844,u],boundSocketIpAddressIsInvalid:[1222,s],builtinAecAvailable:[33,o],builtinAecEnabled:[38,o],builtinAecImplementor:[36,c],builtinAecUuid:[37,c],builtinAgcAvailable:[34,o],builtinNsAvailable:[35,o],bwaVidDisablingCandidate:[1114,o],bwaVidDisablingRxCandidateDuration:[1116,u],bwaVidDisablingTxCandidateDuration:[1115,u],bweEvaluationScoreE2e:[1068,s],bweEvaluationScoreSfuDl:[1070,s],bweEvaluationScoreSfuUl:[1069,s],c2DecAvgT:[302,u],c2DecFrameCount:[300,s],c2DecFramePlayed:[301,s],c2EncAvgT:[298,u],c2EncCpuOveruseCount:[299,s],c2EncFrameCount:[297,s],c2RxTotalBytes:[296,s],c2TxTotalBytes:[295,s],callAcceptFuncT:[132,u],callAecMode:[39,_],callAecOffset:[42,s],callAecTailLength:[43,s],callAgcMode:[52,h],callAndrGcmFgEnabled:[268,o],callAndroidAudioMode:[55,s],callAndroidRecordAudioPreset:[57,s],callAndroidRecordAudioSource:[56,s],callAudioEngineType:[54,v],callAudioRestartCount:[96,l],callAudioRestartReason:[97,l],callAvgAudioRxPipBitrate:[640,l],callAvgRottRx:[259,u],callAvgRottTx:[258,u],callAvgRtt:[107,u],callAvgVideoRxPipBitrate:[638,l],callBatteryChangePct:[195,l],callCalculatedEcOffset:[50,s],callCalculatedEcOffsetStddev:[51,s],callCreatorHid:[505,c],callDefNetwork:[405,q],callEcRestartCount:[99,l],callEchoEnergy:[46,l],callEchoLikelihood:[44,s],callEchoLikelihoodBeforeEc:[47,l],callEndFrameLossMs:[1142,u],callEndFuncT:[130,u],callEndReconnecting:[70,o],callEndReconnectingBeforeNetworkChange:[877,o],callEndReconnectingBeforeP2pFailover:[875,o],callEndReconnectingBeforeRelayFailover:[869,o],callEndReconnectingBeforeRelayReset:[948,o],callEndReconnectingSoonAfterCallActive:[848,o],callEndReconnectingSoonAfterNetworkChange:[878,o],callEndReconnectingSoonAfterP2pFailover:[876,o],callEndReconnectingSoonAfterRelayFailover:[870,o],callEndReconnectingSoonAfterRelayReset:[949,o],callEndedDuringAudFreeze:[518,o],callEndedDuringVidFreeze:[517,o],callEndedInterrupted:[23,o],callEnterPipModeCount:[626,s],callFromUi:[2,z],callHistEchoLikelihood:[45,l],callInitRxPktLossPct3s:[1157,l],callInitialRtt:[109,u],callInterrupted:[22,o],callIsLastSegment:[388,o],callLastRtt:[108,u],callMaxRtt:[106,u],callMessagesBufferedCount:[422,s],callMinRtt:[105,u],callNetwork:[76,q],callNetworkSubtype:[77,s],callNsMode:[53,nn],callOfferAckTimout:[159,l],callOfferDelayT:[243,u],callOfferElapsedT:[102,u],callOfferFanoutCount:[588,s],callOfferReceiptDelay:[134,u],callP2pAvgRtt:[457,u],callP2pDisabled:[18,o],callP2pMinRtt:[456,u],callPeerAppVersion:[15,c],callPeerIpStr:[10,c],callPeerIpv4:[8,s],callPeerPlatform:[5,c],callPeerTestBucket:[1225,c],callPendingCallsAcceptedCount:[501,s],callPendingCallsCount:[498,s],callPendingCallsRejectedCount:[499,s],callPendingCallsTerminatedCount:[500,s],callPipMode10sCount:[628,s],callPipMode10sT:[633,u],callPipMode120sCount:[631,s],callPipMode120sT:[636,u],callPipMode240sCount:[632,s],callPipMode240sT:[637,u],callPipMode30sCount:[629,s],callPipMode30sT:[634,u],callPipMode60sCount:[630,s],callPipMode60sT:[635,u],callPipModeT:[627,u],callPlaybackBufferSize:[59,s],callPlaybackCallbackStopped:[25,o],callPlaybackFramesPs:[93,l],callPlaybackSilenceRatio:[95,l],callRadioType:[231,nr],callRandomId:[529,c],callRecentPlaybackFramesPs:[94,l],callRecentRecordFramesPs:[29,l],callReconnectingStateCount:[438,s],callRecordBufferSize:[58,s],callRecordCallbackStopped:[24,o],callRecordFramesPs:[28,s],callRecordMaxEnergyRatio:[98,l],callRecordSilenceRatio:[26,s],callRejectFuncT:[131,u],callRelayAvgRtt:[455,u],callRelayBindStatus:[16,J],callRelayCreateT:[104,u],callRelayErrorCode:[1300,s],callRelayMinRtt:[454,u],callRelayServer:[17,c],callRelaysReceived:[1301,s],callReplayerId:[1155,c],callResult:[63,Q],callRingingT:[103,u],callRxAvgBitrate:[121,l],callRxAvgBwe:[122,l],callRxAvgJitter:[125,u],callRxAvgLossPeriod:[128,u],callRxMaxJitter:[124,u],callRxMaxLossPeriod:[127,u],callRxMinJitter:[123,u],callRxMinLossPeriod:[126,u],callRxPktLossPct:[120,l],callRxPktLossRetransmitPct:[892,l],callRxStoppedT:[100,u],callSamplingRate:[30,s],callSegmentIdx:[389,s],callSegmentType:[393,X],callSelfIpStr:[9,c],callSelfIpv4:[7,s],callServerNackErrorCode:[68,s],callSetupErrorType:[71,Z],callSetupT:[101,u],callSide:[1,ee],callSoundPortFuncT:[133,u],callStartFuncT:[129,u],callSwAecMode:[41,s],callSwAecType:[40,Lr],callT:[92,u],callTermReason:[69,te],callTestBucket:[19,c],callTestEvent:[318,s],callTonesDetectedInRecord:[49,s],callTonesDetectedInRingback:[48,s],callTransitionCount:[78,s],callTransitionCountCellularToWifi:[432,s],callTransitionCountWifiToCellular:[431,s],callTransport:[72,ne],callTransportExtrayElected:[515,o],callTransportMaxAllocRetries:[1268,s],callTransportP2pToRelayFallbackCount:[80,s],callTransportPeerTcpUsed:[587,o],callTransportRelayToRelayFallbackCount:[79,s],callTransportTcpFallbackToUdp:[516,o],callTransportTcpUsed:[514,o],callTxAvgBitrate:[112,l],callTxAvgBwe:[113,l],callTxAvgJitter:[116,u],callTxAvgLossPeriod:[119,u],callTxMaxJitter:[115,u],callTxMaxLossPeriod:[118,u],callTxMinJitter:[114,u],callTxMinLossPeriod:[117,u],callTxPktErrorPct:[111,l],callTxPktLossPct:[110,l],callUserRate:[20,s],callWakeupSource:[156,ie],calleeAcceptToDecodeT:[447,u],callerInContact:[476,o],callerOfferToDecodeT:[445,u],callerVidRtpToDecodeT:[446,u],cameraFormats:[765,s],cameraIssues:[850,s],cameraLastIssue:[851,s],cameraOffCount:[331,s],cameraPauseT:[1131,u],cameraPermission:[849,o],cameraPreviewMode:[322,ae],cameraStartDuration:[852,u],cameraStartFailureDuration:[856,u],cameraStartMode:[233,oe],cameraStartToFirstFrameT:[916,u],cameraStopDuration:[853,u],cameraStopFailureCount:[858,s],cameraSwitchCount:[855,s],cameraSwitchDuration:[854,u],cameraSwitchFailureDuration:[857,u],clampedBwe:[527,o],codecSamplingRate:[624,s],combinedE2eAvgRtt:[760,l],combinedE2eMaxRtt:[761,l],combinedE2eMinRtt:[759,l],confBridgeSamplingRate:[623,s],connectedToCar:[1226,o],conservativeModeStopped:[974,o],conservativeRampUpExploringT:[743,u],conservativeRampUpHeldCount:[643,s],conservativeRampUpHoldingT:[741,u],conservativeRampUpRampingUpT:[742,u],cpuOverUtilizationPct:[1223,l],createdFromGroupCallDowngrade:[519,o],dataLimitOnAltNetworkReached:[537,o],deviceBoard:[230,c],deviceClass:[1269,c],deviceHardware:[229,c],droppedVideoFrameOutOfPausedMs:[1284,u],dtxRxByteFrameCount:[914,s],dtxRxCount:[912,s],dtxRxDurationT:[911,u],dtxRxTotalCount:[913,s],dtxRxTotalFrameCount:[1083,s],dtxTxByteFrameCount:[910,s],dtxTxCount:[619,s],dtxTxDurationT:[618,u],dtxTxTotalCount:[909,s],dtxTxTotalFrameCount:[1082,s],echoCancellationMsPerSec:[320,s],echoCancellationNumLoops:[1264,s],echoCancelledFrameCount:[940,s],echoEstimatedFrameCount:[941,s],echoMaxConvergeFrameCount:[1265,s],echoSpeakerModeFrameCount:[987,s],encoderCompStepdowns:[81,s],endCallAfterConfirmation:[90,at],failureToCreateAltSocket:[534,s],failureToCreateTestAltSocket:[532,s],fastplayMaxDurationMs:[1005,u],fastplayNumFrames:[1004,s],fastplayNumTriggers:[1006,s],fieldStatsRowType:[328,ct],finishedDlBwe:[503,o],finishedOverallBwe:[528,o],finishedUlBwe:[502,o],freezeAheadBweCongestionCorrPct:[1051,l],freezeBweCongestionCorrPct:[1009,l],gainAdjustedMicAvgPower:[1292,s],gainAdjustedMicMaxPower:[1293,s],gainAdjustedMicMinPower:[1294,s],groupAcceptNoCriticalGroupUpdate:[1013,o],groupAcceptToCriticalGroupUpdateMs:[1014,u],groupCallCallerParticipantCountAtCallStart:[439,s],groupCallInviteCountSinceCallStart:[360,s],groupCallIsGroupCallInvitee:[357,o],groupCallIsLastSegment:[356,o],groupCallNackCountSinceCallStart:[361,s],groupCallReringCountSinceCallStart:[946,s],groupCallReringNackCountSinceCallStart:[947,s],groupCallSegmentIdx:[329,s],groupCallTotalCallTSinceCallStart:[358,u],groupCallTotalP3CallTSinceCallStart:[359,u],groupCallVideoMaximizedCount:[592,s],hasRestrictedSettingsForAudioCalls:[539,o],hbhSrtcpRxBytes:[1256,s],hbhSrtcpRxRejAuthFail:[1257,s],hbhSrtcpRxRejEinval:[1258,s],hbhSrtcpRxRejectedPktCntFromOldRelay:[1219,s],hbhSrtcpRxSuccessNackPktCnt:[1248,s],hbhSrtcpRxSuccessRembPktCnt:[1249,s],hbhSrtcpRxSuccessSbwaPktCnt:[1250,s],hbhSrtcpRxSuccessSpPktCnt:[1251,s],hbhSrtcpTxBytes:[1259,s],hbhSrtcpTxNackPktCnt:[1254,s],hbweHistoryBasedAvgVideoTxBitrate:[1279,s],hbweHistoryBasedBweInstantRampUpDone:[1280,o],hbweHistoryBasedBweUpdateCeilingDone:[1281,o],hbweHistoryBasedBweUpdateCeilingForced:[1282,o],highPeerBweT:[884,u],hisBasedInitialTxBitrate:[342,s],hisInfoCouldBeUsedForInitBwe:[339,o],historyBasedBweActivated:[807,o],historyBasedBweEnabled:[806,o],historyBasedBweSuccess:[808,o],historyBasedBweVideoTxBitrate:[809,s],incomingCallUiAction:[387,gt],initBweSource:[337,mt],initialEstimatedTxBitrate:[244,l],isCallFull:[1149,o],isIpv6Capable:[91,o],isLinkedGroupCall:[1090,o],isOsMicrophoneMute:[1227,o],isPendingCall:[976,o],isRejoin:[927,o],isRering:[945,o],isUpnpExternalIpPrivate:[260,o],isUpnpExternalIpTheSameAsReflexiveIp:[261,o],jbAvgDelay:[146,l],jbAvgDelayUniform:[644,l],jbAvgDisorderTargetSize:[1086,l],jbAvgTargetSize:[1012,l],jbDiscards:[150,l],jbEmpties:[151,l],jbEmptyPeriods1x:[997,l],jbEmptyPeriods2x:[998,l],jbEmptyPeriods4x:[999,l],jbEmptyPeriods8x:[1e3,l],jbGets:[152,l],jbLastDelay:[149,l],jbLost:[277,l],jbLostEmptyDuringPip:[641,s],jbLostEmptyHighPeerBwePerSec:[777,l],jbLostEmptyLowPeerBwePerSec:[775,l],jbLostEmptyLowToHighPeerBwePerSec:[776,l],jbMaxDelay:[148,l],jbMaxDisorderTargetSize:[1087,l],jbMinDelay:[147,l],jbNonSpeechDiscards:[846,l],jbPuts:[153,l],jbTotalEmptyPeriods:[996,l],jbVoiceFrames:[1081,s],joinableAfterCall:[895,o],joinableDuringCall:[894,o],joinableNewUi:[893,o],l1Locations:[986,c],lastConnErrorStatus:[415,s],libsrtpVersionUsed:[504,yr],lobbyVisibleT:[1127,u],logSampleRatio:[1120,s],longConnect:[21,o],lossOfAltSocket:[535,s],lossOfTestAltSocket:[533,s],lowDataUsageBitrate:[157,l],lowPeerBweT:[885,u],lowToHighPeerBweT:[886,u],malformedStanzaXpath:[452,c],maxConnectedParticipants:[1085,s],maxEventQueueDepth:[558,s],mediaStreamSetupT:[448,u],micAvgPower:[253,s],micMaxPower:[252,s],micMinPower:[251,s],micPermission:[859,o],micStartDuration:[862,u],micStartToFirstCallbackT:[931,u],micStopDuration:[863,u],multipleTxRxRelaysInUse:[838,o],muteNotSupportedCount:[1169,s],muteReqAlreadyMutedCount:[1170,s],muteReqTimeoutsCount:[1171,s],nativeSamplesPerFrame:[32,c],nativeSamplingRate:[31,c],neteqAcceleratedFrames:[653,s],neteqExpandedFrames:[652,s],networkFailoverTriggeredCount:[1135,s],networkMediumChangeLatencyMs:[995,u],nseEnabled:[1128,o],nseOfflineQueueMs:[1129,u],numAsserts:[933,s],numConnectedParticipants:[330,s],numConnectedPeers:[1052,s],numCriticalGroupUpdateDropped:[567,s],numDirPjAsserts:[985,s],numInvitedParticipants:[1054,s],numL1Errors:[929,s],numL2Errors:[930,s],numOutOfOrderCriticalGroupUpdate:[625,s],numOutgoingRingingPeers:[1053,s],numPeersAutoPausedOnce:[577,s],numRenderSkipGreenFrame:[1029,s],numResSwitch:[993,s],numTransitionsToSpeech:[1113,s],numVidDlAutoPause:[574,s],numVidDlAutoResume:[576,s],numVidDlAutoResumeRejectBadAudio:[579,s],numVidRcDynCondTrue:[717,s],numVidUlAutoPause:[559,s],numVidUlAutoPauseFail:[560,s],numVidUlAutoPauseRejectHighSendingRate:[564,s],numVidUlAutoPauseRejectTooEarly:[565,s],numVidUlAutoPauseUserAction:[566,s],numVidUlAutoResume:[561,s],numVidUlAutoResumeFail:[562,s],numVidUlAutoResumeRejectAudioLqm:[563,s],numberOfProcessors:[27,s],offerAckLatencyMs:[1017,u],oibweDlProbingTime:[805,u],oibweE2eProbingTime:[802,u],oibweNotFinishedWhenCallActive:[868,o],oibweOibleProbingTime:[803,u],oibweUlProbingTime:[804,u],onMobileDataSaver:[525,o],onWifiAtStart:[540,o],oneSideInitRxBitrate:[507,s],oneSideInitTxBitrate:[506,s],oneSideMinPeerInitRxBitrate:[509,s],oneSideRcvdPeerRxBitrate:[508,o],opusVersion:[287,s],p2pSuccessCount:[522,s],pausedRtcpCount:[1285,s],pcntPoorAudLqmAfterPause:[599,l],pcntPoorAudLqmBeforePause:[598,l],pcntPoorVidLqmAfterPause:[597,l],pcntPoorVidLqmBeforePause:[596,l],peerCallNetwork:[264,_n],peerCallResult:[66,Q],peerTransport:[591,ne],peerVideoHeight:[191,s],peerVideoWidth:[190,s],peerXmppStatus:[4,ki],peersMuteSuccCount:[1172,s],peersRejectedMuteReqCount:[1173,s],pingsSent:[160,l],pongsReceived:[161,l],poolMemUsage:[510,s],poolMemUsagePadding:[511,s],presentEndCallConfirmation:[89,at],prevCallTestBucket:[1060,c],previousCallInterval:[266,u],previousCallVideoEnabled:[265,o],previousCallWithSamePeer:[267,o],previousJoinNotEnded:[1001,o],probeAvgBitrate:[327,l],pstnCallExists:[1228,o],pushToCallOfferDelay:[158,l],rcMaxrtt:[155,l],rcMinrtt:[154,l],receivedByNse:[1130,o],reconnectingStartsBeforeCallActive:[847,o],recordCircularBufferFrameCount:[84,s],reflectivePortsDiff:[162,l],rejectMuteReqCount:[1174,s],rekeyTime:[1140,s],relayBindFailureAltNetSwitchSuccess:[583,s],relayBindFailureAltNetSwitchTriggered:[582,s],relayBindFailureAltNetworkSwitchToCallEnd:[586,u],relayBindFailureFallbackCount:[581,s],relayBindFailureIpVersionSwitchToCallEnd:[585,u],relayBindFailureIpVersionSwitchTriggered:[584,s],relayBindTimeInMsec:[424,u],relayElectionTimeInMsec:[423,u],relayFallbackOnRxDataFromRelay:[481,s],relayFallbackOnStopRxDataOnP2p:[482,s],relayFallbackOnTransportStanzaNotification:[483,s],relaySwapped:[1309,s],renderFreezeHighPeerBweT:[780,u],renderFreezeLowPeerBweT:[778,u],renderFreezeLowToHighPeerBweT:[779,u],rxAllocRespNoMatchingTid:[1168,s],rxForErrorRelayBytes:[1310,l],rxForOtherRelayBytes:[1311,l],rxForTxRelayBytes:[1312,l],rxProbeCountSuccess:[291,s],rxProbeCountTotal:[290,s],rxRelayRebindLatencyMs:[841,u],rxRelayResetLatencyMs:[842,u],rxSubOnScreenDur:[1295,u],rxSubRequestThrottledCnt:[1296,s],rxSubSwitchCnt:[1297,s],rxSubVideoWaitDur:[1298,u],rxSubscriptionAllocCnt:[1291,s],rxSubscriptionAvgAllocSize:[1299,l],rxTotalBitrate:[145,l],rxTotalBytes:[143,l],rxTpFbBitrate:[294,l],rxTrafficStartFalsePositive:[758,o],sbweAvgDowntrend:[963,l],sbweAvgUptrend:[962,l],sbweCeilingCongestionCount:[783,s],sbweCeilingCount:[781,s],sbweCeilingMissingRtcpCongestionCount:[786,s],sbweCeilingNoNewDataReceivedCongestionCount:[787,s],sbweCeilingPktLossCount:[782,s],sbweCeilingReceiveSideCount:[1106,s],sbweCeilingRttCongestionCount:[784,s],sbweCeilingZeroRttCongestionCount:[785,s],sbweGlobalMinRttCongestionCount:[1103,s],sbweHighestRttCongestionCount:[1133,s],sbweHoldCount:[961,s],sbweMinRttEmaCongestionCount:[1104,s],sbweMinRttSlideWindowCount:[1308,s],sbweRampDownCount:[960,s],sbweRampUpCount:[959,s],sbweRampUpPauseCount:[1134,s],selfMuteSuccessCount:[1175,s],selfUnmuteAfterMuteReqCount:[1176,s],senderBweInitBitrate:[975,s],serverRecommendedToElectedRelayMs:[1266,u],sfuAbnormalUplinkRttCount:[879,s],sfuAvgDlPlrAtBalancedCongestion:[1096,l],sfuAvgDlPlrAtHighDlCongestion:[1094,l],sfuAvgDlPlrAtHighUlCongestion:[1092,l],sfuAvgLqHqTargetBitrateDiff:[1002,l],sfuAvgPeerRttAtBalancedCongestion:[1102,s],sfuAvgPeerRttAtHighPeerCongestion:[1100,s],sfuAvgPeerRttAtHighSelfCongestion:[1098,s],sfuAvgSelfRttAtBalancedCongestion:[1101,s],sfuAvgSelfRttAtHighPeerCongestion:[1099,s],sfuAvgSelfRttAtHighSelfCongestion:[1097,s],sfuAvgTargetBitrate:[673,l],sfuAvgTargetBitrateHq:[943,l],sfuAvgUlPlrAtBalancedCongestion:[1095,l],sfuAvgUlPlrAtHighDlCongestion:[1093,l],sfuAvgUlPlrAtHighUlCongestion:[1091,l],sfuBalancedPktLossAtCongestion:[1075,s],sfuBalancedRttAtCongestion:[1079,s],sfuBwaAllParticipantDlBwUsedPct:[919,l],sfuBwaAllParticipantUlBwUsedPct:[918,l],sfuBwaChangeNumStreamCount:[928,s],sfuBwaSelfDlBwUsedPct:[1003,l],sfuBwaSelfUlBwUsedPct:[917,l],sfuBwaSimulcastDisabledCntReasonBattery:[920,s],sfuBwaSimulcastDisabledCntReasonNetMedium:[921,s],sfuBwaVidEncHqStreamScheduledT:[926,u],sfuBwaVidEncLqStreamScheduledT:[925,u],sfuDownlinkAvgCombinedBwe:[662,l],sfuDownlinkAvgPktLossPct:[667,l],sfuDownlinkAvgRemoteBwe:[661,l],sfuDownlinkAvgSenderBwe:[660,l],sfuDownlinkInitCombinedBwe3s:[1158,l],sfuDownlinkInitPktLossPct3s:[1159,l],sfuDownlinkMaxPktLossPct:[668,l],sfuDownlinkMinPktLossPct:[666,l],sfuDownlinkSbweAvgDowntrend:[973,l],sfuDownlinkSbweAvgUptrend:[972,l],sfuDownlinkSbweCeilingCongestionCount:[797,s],sfuDownlinkSbweCeilingCount:[795,s],sfuDownlinkSbweCeilingMissingRtcpCongestionCount:[800,s],sfuDownlinkSbweCeilingNoNewDataReceivedCongestionCount:[801,s],sfuDownlinkSbweCeilingPktLossCount:[796,s],sfuDownlinkSbweCeilingRttCongestionCount:[798,s],sfuDownlinkSbweCeilingZeroRttCongestionCount:[799,s],sfuDownlinkSbweHoldCount:[971,s],sfuDownlinkSbweRampDownCount:[970,s],sfuDownlinkSbweRampUpCount:[969,s],sfuDownlinkSenderBweDiffStddev:[958,l],sfuDownlinkSenderBweStddev:[957,l],sfuFirstRxBandwidthReportTime:[1111,u],sfuFirstRxParticipantReportTime:[883,u],sfuFirstRxUplinkReportTime:[881,u],sfuHighDlPktLossAtCongestion:[1074,s],sfuHighDlRttAtCongestion:[1078,s],sfuHighUlPktLossAtCongestion:[1073,s],sfuHighUlRttAtCongestion:[1077,s],sfuMaxTargetBitrate:[674,l],sfuMaxTargetBitrateHq:[944,l],sfuMinTargetBitrate:[672,l],sfuMinTargetBitrateHq:[942,l],sfuPeerDownlinkStddevAllCombinedBwe:[813,l],sfuRxBandwidthReportCount:[1110,s],sfuRxParticipantReportCount:[882,s],sfuRxUplinkReportCount:[880,s],sfuServerBwaBrAdjustedForParticipantChange:[1260,s],sfuServerBwaBrCappedByUplink:[1261,s],sfuServerBwaInvalidSimulcastResult:[1262,s],sfuServerBwaLocalBwaRun:[1263,s],sfuSimulcastAvgDecSessFlipTime:[833,u],sfuSimulcastAvgEncSchedEventUpdateTime:[837,u],sfuSimulcastBwaCandidateCnt:[923,s],sfuSimulcastBwaDownlinkBottleneckCount:[874,s],sfuSimulcastBwaUplinkBottleneckCount:[873,s],sfuSimulcastDecAvgKfRecvTimeSinceFlip:[952,u],sfuSimulcastDecAvgNumReplayedCachedPkt:[951,l],sfuSimulcastDecAvgNumSkippedCachedPkt:[950,l],sfuSimulcastDecNumNoKf:[953,s],sfuSimulcastDecSessFlipCount:[744,s],sfuSimulcastDecSessFlipErrorBitmap:[768,s],sfuSimulcastDecSessFlipErrorCount:[767,s],sfuSimulcastEncErrorBitmap:[766,s],sfuSimulcastEncSchedEventCount:[732,s],sfuSimulcastEncSchedEventErrorCount:[735,s],sfuSimulcastEncSchedEventSkipCount:[734,s],sfuSimulcastEncSchedEventSuccessUpdateCount:[733,s],sfuSimulcastMaxDecSessFlipTime:[832,u],sfuSimulcastMaxEncSchedEventUpdateTime:[836,u],sfuSimulcastMinDecSessFlipTime:[831,u],sfuSimulcastMinEncSchedEventUpdateTime:[835,u],sfuUplinkAvgCombinedBwe:[659,l],sfuUplinkAvgPktLossPct:[664,l],sfuUplinkAvgRemoteBwe:[658,l],sfuUplinkAvgRtt:[670,l],sfuUplinkAvgSenderBwe:[657,l],sfuUplinkInitCombinedBwe3s:[1160,l],sfuUplinkInitPktLossPct3s:[1161,l],sfuUplinkMaxPktLossPct:[665,l],sfuUplinkMaxRtt:[671,l],sfuUplinkMinPktLossPct:[663,l],sfuUplinkMinRtt:[669,l],sfuUplinkSbweAvgDowntrend:[968,l],sfuUplinkSbweAvgUptrend:[967,l],sfuUplinkSbweCeilingCongestionCount:[790,s],sfuUplinkSbweCeilingCount:[788,s],sfuUplinkSbweCeilingMissingRtcpCongestionCount:[793,s],sfuUplinkSbweCeilingNoNewDataReceivedCongestionCount:[794,s],sfuUplinkSbweCeilingPktLossCount:[789,s],sfuUplinkSbweCeilingRttCongestionCount:[791,s],sfuUplinkSbweCeilingZeroRttCongestionCount:[792,s],sfuUplinkSbweHoldCount:[966,s],sfuUplinkSbweRampDownCount:[965,s],sfuUplinkSbweRampUpCount:[964,s],sfuUplinkSenderBweDiffStddev:[956,l],sfuUplinkSenderBweStddev:[955,l],simulcastAvgLqBitrateWhenHqEnabled:[1011,s],simulcastReplayVideoRenderFreeze2xT:[982,u],simulcastReplayVideoRenderFreeze4xT:[983,u],simulcastReplayVideoRenderFreeze8xT:[984,u],simulcastReplayVideoRenderFreezeT:[981,u],skippedBwaCycles:[748,s],skippedBweCycles:[747,s],slowRenderVideoFrameOutOfPausedMs:[1286,u],speakerAvgPower:[250,s],speakerMaxPower:[249,s],speakerMinPower:[248,s],speakerStartDuration:[864,u],speakerStartToFirstCallbackT:[932,u],speakerStopDuration:[865,u],sreRecommendedDiff:[1313,s],startedInitBweProbing:[900,o],streamDroppedPkts:[1287,s],streamPausedTimeMs:[1288,u],streamTransitionsToPaused:[1289,s],streamTransitionsToPausedWithoutNotif:[1290,s],switchToDefTriggeredByGoodDefNet:[538,s],switchToNonSfu:[750,s],switchToNonSimulcast:[1057,s],switchToSfu:[749,s],switchToSimulcast:[1056,s],symmetricNatPortGap:[257,s],systemNotificationOfNetChange:[541,s],telecomFrameworkCallStartDelayT:[440,u],timeCpuUtilizationSamplingInMs:[1224,u],timeEnc1280w:[992,u],timeEnc160w:[988,u],timeEnc320w:[989,u],timeEnc480w:[990,u],timeEnc640w:[991,u],timeOnNonDefNetwork:[530,u],timeOnNonDefNetworkPerSegment:[531,u],timeSinceLastRtpToCallEndInMsec:[715,u],timeToFirstElectedRelayMs:[1267,u],timeVidRcDynCondTrue:[718,u],totalAqsMsgSent:[1126,s],totalAudioFrameLossMs:[723,u],totalBytesOnNonDefCell:[449,l],totalTimeVidDlAutoPause:[575,u],totalTimeVidUlAutoPause:[573,u],trafficShaperAvgAudioQueueMs:[898,u],trafficShaperAvgQueueMs:[242,u],trafficShaperAvgVideoQueueMs:[899,u],trafficShaperMaxDelayViolations:[240,s],trafficShaperMinDelayViolations:[241,s],trafficShaperOverflowCount:[237,s],trafficShaperQueueEmptyCount:[238,s],trafficShaperQueuedAudioPacketCount:[896,s],trafficShaperQueuedPacketCount:[239,s],trafficShaperQueuedVideoPacketCount:[897,s],transportCurTimeInMsecAsyncWriteWaitingInQueue:[552,u],transportLastSendOsError:[555,s],transportNumAsyncWriteDispatched:[580,s],transportNumAsyncWriteQueued:[551,s],transportOvershoot10PercCount:[699,s],transportOvershoot20PercCount:[700,s],transportOvershoot40PercCount:[701,s],transportOvershootLongestStreakS:[708,s],transportOvershootSinceLast10sCount:[704,s],transportOvershootSinceLast15sCount:[705,s],transportOvershootSinceLast1sCount:[702,s],transportOvershootSinceLast30sCount:[706,s],transportOvershootSinceLast5sCount:[703,s],transportOvershootStreakAvgS:[709,l],transportOvershootTimeBetweenAvgS:[707,l],transportRtpSendErrorRate:[557,l],transportSendErrorCount:[556,s],transportSnJumpDetectCount:[1153,s],transportSplitterRxErrCnt:[1059,s],transportSplitterTxErrCnt:[1058,s],transportSrtcpRxRejectedPktCnt:[1141,s],transportSrtpRxMaxPktSize:[1038,s],transportSrtpRxRejectedBitrate:[763,l],transportSrtpRxRejectedDupPktCnt:[772,s],transportSrtpRxRejectedPktCnt:[762,s],transportSrtpTxFailedPktCnt:[774,s],transportSrtpTxMaxPktSize:[773,s],transportTotalNumSendOsError:[554,s],transportTotalTimeInMsecAsyncWriteQueueToDispatch:[553,u],transportUndershoot10PercCount:[710,s],transportUndershoot20PercCount:[711,s],transportUndershoot40PercCount:[712,s],triggeredButDataLimitReached:[536,s],tsLogUpload:[1112,Gr],txProbeCountSuccess:[289,s],txProbeCountTotal:[288,s],txRelayBindUnbindPacketsMissingMessageIntegrity:[1105,s],txRelayRebindLatencyMs:[839,u],txRelayResetLatencyMs:[840,u],txTotalBitrate:[144,l],txTotalBytes:[142,l],txTpFbBitrate:[293,l],upnpAddResultCode:[246,Wr],upnpRemoveResultCode:[247,Hr],usedInitTxBitrate:[341,s],usedIpv4Count:[1150,s],usedIpv6Count:[1151,s],userDescription:[87,c],userProblems:[88,s],userRating:[86,s],v2vAudioFrameLoss1xMs:[1143,u],v2vAudioFrameLoss2xMs:[1144,u],v2vAudioFrameLoss4xMs:[1145,u],v2vAudioFrameLoss8xMs:[1146,u],v2vAudioLossPeriodCount:[1147,s],v2vTotalAudioFrameLossMs:[1148,u],vidAvgBurstyPktLossLength:[1121,u],vidAvgRandomPktLossLength:[1122,u],vidBurstyPktLossTime:[1123,u],vidCorrectRetxDetectPcnt:[688,s],vidFreezeTMsInSample0:[695,u],vidJbAvgDelay:[1062,l],vidJbDiscards:[1063,l],vidJbEmpties:[1064,l],vidJbGets:[1065,l],vidJbLost:[1061,l],vidJbPuts:[1066,l],vidJbResets:[1067,l],vidNumFecDroppedNoHole:[696,s],vidNumFecDroppedTooBig:[697,s],vidNumRandToBursty:[1124,s],vidNumRetxDropped:[698,s],vidNumRxRetx:[757,s],vidPktRxState0:[693,c],vidRandomPktLossTime:[1125,u],vidRxFecRateInSample0:[694,l],vidUlAutoPausedAtCallEnd:[589,o],vidUlTimeSinceAutoPauseAtCallEnd:[590,u],vidWrongRetxDetectPcnt:[716,s],videoActiveTime:[276,u],videoAheadAvSyncDiscardedFramesAvgDeltaT:[1041,u],videoAheadAvSyncRenderedFramesAvgDeltaT:[1043,u],videoAheadNumAvSyncDiscardFrames:[1039,s],videoAveDelayLtrp:[484,u],videoAvgCombPsnr:[390,l],videoAvgEncodingPsnr:[410,l],videoAvgScalingPsnr:[408,l],videoAvgSenderBwe:[186,l],videoAvgTargetBitrate:[184,l],videoAvgTargetBitrateHq:[828,l],videoBehindAvSyncDiscardedFramesAvgDeltaT:[1042,u],videoBehindAvSyncRenderedFramesAvgDeltaT:[1044,u],videoBehindNumAvSyncDiscardFrames:[1040,s],videoCaptureAvgFps:[222,s],videoCaptureConverterTs:[226,u],videoCaptureDupFrames:[887,s],videoCaptureFrameOverwriteCount:[496,s],videoCaptureHeight:[228,s],videoCaptureWidth:[227,s],videoCodecScheme:[401,s],videoCodecSubType:[303,s],videoCodecType:[236,s],videoDecAvgBitrate:[220,s],videoDecAvgConsecutiveKfVp8:[610,l],videoDecAvgConsecutiveLtrpVp8:[611,l],videoDecAvgFps:[207,l],videoDecAvgFramesFromFoundLtrVp8:[612,l],videoDecAvgFramesFromUnfoundLtrVp8:[613,l],videoDecColorId:[205,s],videoDecCrcMismatchFrames:[419,s],videoDecErrorFrames:[174,s],videoDecErrorFramesCodecSwitch:[714,s],videoDecErrorFramesDuplicate:[713,s],videoDecErrorFramesH264:[680,s],videoDecErrorFramesIgnoreConsecutive:[478,s],videoDecErrorFramesOutoforder:[682,s],videoDecErrorFramesSpsPpsH264:[812,s],videoDecErrorFramesSpsPpsMissingAfterResolutionSwitch:[810,s],videoDecErrorFramesSpsPpsNotSupportedAfterResolutionSwitch:[811,s],videoDecErrorFramesVp8:[681,s],videoDecErrorLtrpFramesVp8:[462,s],videoDecErrorLtrpFramesVp8CrcMismatch:[479,s],videoDecErrorLtrpFramesVp8NoLtr:[480,s],videoDecErrorLtrpFramesVp8NoLtr10:[615,s],videoDecErrorLtrpFramesVp8NoLtr5:[614,s],videoDecFatalErrorNum:[1084,s],videoDecInputFrames:[172,s],videoDecKeyframes:[175,s],videoDecLatency:[223,u],videoDecLatencyH264:[684,u],videoDecLatencyVp8:[683,u],videoDecLostPackets:[210,s],videoDecLtrpFramesVp8:[461,s],videoDecLtrpPoolCreateFailed:[490,o],videoDecName:[204,s],videoDecNumPliThrottledByAllLtrp:[915,s],videoDecNumSkippedFramesVp8:[616,s],videoDecNumSwitchesToAllLtrp:[617,s],videoDecOutputFrames:[173,s],videoDecRestart:[206,s],videoDecSkipPackets:[209,s],videoDecodePausedCount:[232,s],videoDowngradeCount:[273,s],videoEnabled:[163,o],videoEnabledAtCallStart:[270,o],videoEncAllLtrpTimeInMsec:[609,u],videoEncAvgBitrate:[221,s],videoEncAvgConsecutiveKfVp8:[605,l],videoEncAvgConsecutiveLtrpVp8:[606,l],videoEncAvgFps:[216,l],videoEncAvgFpsHq:[825,l],videoEncAvgFramesFromFoundLtrVp8:[604,l],videoEncAvgFramesFromUnfoundLtrVp8:[603,l],videoEncAvgPsnrKeyFrameVp8:[465,l],videoEncAvgPsnrLtrpFrameVp8:[469,l],videoEncAvgPsnrPFramePrevRefVp8:[474,l],videoEncAvgQpKeyFrameOpenh264:[1216,l],videoEncAvgQpKeyFrameVp8:[466,l],videoEncAvgQpLtrpFrameOpenh264:[1217,l],videoEncAvgQpLtrpFrameVp8:[470,l],videoEncAvgQpPFramePrevRefOpenh264:[1218,l],videoEncAvgQpPFramePrevRefVp8:[475,l],videoEncAvgSizeAllLtrpFrameVp8:[685,l],videoEncAvgSizeKeyFrameVp8:[464,l],videoEncAvgSizeLtrpFrameVp8:[468,l],videoEncAvgSizePFramePrevRefVp8:[473,l],videoEncAvgTargetFps:[215,l],videoEncAvgTargetFpsHq:[827,l],videoEncColorId:[213,s],videoEncDeviationAllLtrpFrameVp8:[686,l],videoEncDeviationPFramePrevRefVp8:[687,l],videoEncDiscardFrame:[217,s],videoEncDiscardFrameHq:[938,s],videoEncDropFrames:[179,s],videoEncDropFramesHq:[937,s],videoEncErrorFrames:[178,s],videoEncErrorFramesHq:[936,s],videoEncFatalErrorNum:[1049,s],videoEncInputFrames:[176,s],videoEncInputFramesHq:[934,s],videoEncKeyframes:[180,s],videoEncKeyframesHq:[939,s],videoEncKeyframesVp8:[463,s],videoEncKfErrCodecSwitchT:[731,u],videoEncKfIgnoreOldFrames:[729,s],videoEncKfQueueEmpty:[730,s],videoEncLatency:[224,u],videoEncLatencyHq:[826,u],videoEncLtrpFrameGenFailedVp8:[471,s],videoEncLtrpFramesVp8:[467,s],videoEncLtrpPoolCreateFailed:[491,o],videoEncLtrpToKfFallbackVp8:[494,s],videoEncModifyNum:[1050,s],videoEncName:[212,s],videoEncNumErrorLtrHoldFailedVp8:[600,s],videoEncNumErrorLtrHoldFailedVp810:[602,s],videoEncNumErrorLtrHoldFailedVp85:[601,s],videoEncNumSuccessHfFallbackVp8:[622,s],videoEncNumSwitchesToAllLtrp:[607,s],videoEncOutputFrames:[177,s],videoEncOutputFramesHq:[935,s],videoEncPFramePrevRefVp8:[472,s],videoEncRegularLtrpTimeInMsec:[608,u],videoEncRestart:[214,s],videoEncRestartPresetChange:[1046,s],videoEncRestartResChange:[1045,s],videoEncTimeOvershoot10PercH264:[363,u],videoEncTimeOvershoot10PercH265:[366,u],videoEncTimeOvershoot10PercVp8:[369,u],videoEncTimeOvershoot10PercVp9:[372,u],videoEncTimeOvershoot20PercH264:[364,u],videoEncTimeOvershoot20PercH265:[367,u],videoEncTimeOvershoot20PercVp8:[370,u],videoEncTimeOvershoot20PercVp9:[373,u],videoEncTimeOvershoot40PercH264:[365,u],videoEncTimeOvershoot40PercH265:[368,u],videoEncTimeOvershoot40PercVp8:[371,u],videoEncTimeOvershoot40PercVp9:[374,u],videoEncTimeSpentInFastH264Ms:[1026,u],videoEncTimeSpentInFasterH264Ms:[1025,u],videoEncTimeSpentInMediumH264Ms:[1027,u],videoEncTimeSpentInNegative10Vp8Ms:[1019,u],videoEncTimeSpentInNegative12Vp8Ms:[1018,u],videoEncTimeSpentInNegative4Vp8Ms:[1022,u],videoEncTimeSpentInNegative6Vp8Ms:[1021,u],videoEncTimeSpentInNegative8Vp8Ms:[1020,u],videoEncTimeSpentInSuperfastH264Ms:[1023,u],videoEncTimeSpentInVeryfastH264Ms:[1024,u],videoEncTimeUndershoot10PercH264:[375,u],videoEncTimeUndershoot10PercH265:[378,u],videoEncTimeUndershoot10PercVp8:[381,u],videoEncTimeUndershoot10PercVp9:[384,u],videoEncTimeUndershoot20PercH264:[376,u],videoEncTimeUndershoot20PercH265:[379,u],videoEncTimeUndershoot20PercVp8:[382,u],videoEncTimeUndershoot20PercVp9:[385,u],videoEncTimeUndershoot40PercH264:[377,u],videoEncTimeUndershoot40PercH265:[380,u],videoEncTimeUndershoot40PercVp8:[383,u],videoEncTimeUndershoot40PercVp9:[386,u],videoFecRecovered:[183,s],videoH264Time:[334,s],videoH265Time:[335,s],videoHeight:[189,s],videoInitRxBitrate16s:[904,l],videoInitRxBitrate2s:[901,l],videoInitRxBitrate4s:[902,l],videoInitRxBitrate8s:[903,l],videoInitialCodecScheme:[402,s],videoInitialCodecType:[321,s],videoLastCodecType:[404,s],videoLastSenderBwe:[185,l],videoMaxCombPsnr:[392,l],videoMaxEncodingPsnr:[411,l],videoMaxRxBitrate:[426,l],videoMaxScalingPsnr:[409,l],videoMaxTargetBitrate:[420,l],videoMaxTargetBitrateHq:[829,l],videoMaxTxBitrate:[425,l],videoMaxTxBitrateHq:[824,l],videoMinCombPsnr:[391,l],videoMinEncodingPsnr:[407,l],videoMinScalingPsnr:[406,l],videoMinTargetBitrate:[421,l],videoMinTargetBitrateHq:[830,l],videoNackHbhEnabled:[1185,o],videoNackRtpRetransmitRecvdCount:[1272,s],videoNackSendDelay:[872,u],videoNewPktsBeforeNack:[871,s],videoNpsiGenFailed:[594,s],videoNpsiNoNack:[595,s],videoNumAvSyncDiscardFrames:[1010,s],videoNumH264Frames:[332,s],videoNumH265Frames:[333,s],videoPeerState:[275,re],videoPeerTriggeredPauseCount:[654,s],videoQualityScore:[1270,s],videoRenderAvgFps:[208,s],videoRenderConverterTs:[225,u],videoRenderDelayT:[196,u],videoRenderDupFrames:[888,s],videoRenderFreeze2xT:[304,u],videoRenderFreeze4xT:[305,u],videoRenderFreeze8xT:[306,u],videoRenderFreezeT:[235,u],videoRenderInitFreeze16sT:[908,u],videoRenderInitFreeze2sT:[905,u],videoRenderInitFreeze4sT:[906,u],videoRenderInitFreeze8sT:[907,u],videoRenderInitFreezeT:[526,u],videoRenderNumFreezes:[569,s],videoRenderNumSinceLastFreeze10s:[571,s],videoRenderNumSinceLastFreeze30s:[572,s],videoRenderNumSinceLastFreeze5s:[570,s],videoRenderPauseT:[1132,u],videoRenderSumTimeSinceLastFreeze:[568,u],videoRetxRtcpNack:[1178,s],videoRetxRtcpPli:[1179,s],videoRetxRtcpRr:[1180,s],videoRtcpAppRxFailed:[493,s],videoRtcpAppTxFailed:[492,s],videoRtcpNackProcessed:[1273,s],videoRtcpNackProcessedHq:[1274,s],videoRxBitrate:[169,l],videoRxBweHitTxBwe:[187,o],videoRxBytesRtcpApp:[489,l],videoRxFecBitrate:[219,l],videoRxFecFrames:[182,s],videoRxKfBeforeLtrpAfterRpsi:[485,s],videoRxLtrpFramesVp8:[460,s],videoRxNumCodecSwitch:[721,s],videoRxPackets:[201,s],videoRxPktErrorPct:[171,l],videoRxPktLossPct:[170,l],videoRxPktRtcpApp:[487,s],videoRxRtcpFir:[621,s],videoRxRtcpNack:[203,s],videoRxRtcpNackDropped:[1181,s],videoRxRtcpNpsi:[521,s],videoRxRtcpPli:[202,s],videoRxRtcpPliDropped:[1182,s],videoRxRtcpRpsi:[459,s],videoRxRtcpRrDropped:[1183,s],videoRxTotalBytes:[168,l],videoSelfState:[274,re],videoSenderBweDiffStddev:[954,l],videoSenderBweStddev:[348,l],videoTargetBitrateReaches1000kbpsT:[351,u],videoTargetBitrateReaches1500kbpsT:[435,u],videoTargetBitrateReaches2000kbpsT:[436,u],videoTargetBitrateReaches200kbpsT:[349,u],videoTargetBitrateReaches250kbpsT:[433,u],videoTargetBitrateReaches500kbpsT:[350,u],videoTargetBitrateReaches750kbpsT:[434,u],videoTotalBytesOnNonDefCell:[451,l],videoTxBitrate:[165,l],videoTxBitrateHq:[823,l],videoTxBytesRtcpApp:[488,l],videoTxFecBitrate:[218,l],videoTxFecFrames:[181,s],videoTxNumCodecSwitch:[720,s],videoTxPackets:[197,s],videoTxPacketsHq:[818,s],videoTxPktErrorPct:[167,l],videoTxPktErrorPctHq:[821,l],videoTxPktLossPct:[166,l],videoTxPktLossPctHq:[822,l],videoTxPktRtcpApp:[486,s],videoTxResendCauseKf:[1275,s],videoTxResendCauseKfHq:[1276,s],videoTxResendFailures:[1277,s],videoTxResendFailuresHq:[1278,s],videoTxResendPackets:[198,s],videoTxResendPacketsHq:[819,s],videoTxRtcpFirEmptyJb:[620,s],videoTxRtcpNack:[200,s],videoTxRtcpNpsi:[520,s],videoTxRtcpPli:[199,s],videoTxRtcpPliHq:[820,s],videoTxRtcpRpsi:[458,s],videoTxTotalBytes:[164,l],videoTxTotalBytesHq:[817,l],videoUpdateEncoderFailureCount:[453,s],videoUpgradeCancelByTimeoutCount:[325,s],videoUpgradeCancelCount:[323,s],videoUpgradeCount:[272,s],videoUpgradeRejectByTimeoutCount:[326,s],videoUpgradeRejectCount:[324,s],videoUpgradeRequestCount:[271,s],videoWidth:[188,s],voipParamsCompressedSize:[1136,s],voipParamsUncompressedSize:[1137,s],vpxLibUsed:[513,oi],waLongFreezeCount:[891,s],waReconnectFreezeCount:[890,s],waShortFreezeCount:[889,s],waVoipHistoryGetVideoTxBitrateBySelfAndPeerIpStrResult:[1162,s],waVoipHistoryGetVideoTxBitrateBySelfAndPeerIpStrSuccess:[1163,o],waVoipHistoryGetVideoTxBitrateBySelfIpStrResult:[1164,s],waVoipHistoryGetVideoTxBitrateBySelfIpStrSuccess:[1165,o],waVoipHistoryIpAddressNotAvailable:[834,o],waVoipHistoryIsCallRecordLoaded:[737,o],waVoipHistoryIsCallRecordSaved:[738,o],waVoipHistoryIsInitialized:[769,o],waVoipHistoryNumOfCallRecordFoundByMatchingSelfAndPeerIpStr:[1166,s],waVoipHistoryNumOfCallRecordFoundByMatchingSelfIpStr:[1167,s],waVoipHistoryNumOfCallRecordLoaded:[739,s],waVoipHistorySaveCallRecordConditionCheckStatus:[770,li],warpHeaderRxTotalBytes:[656,l],warpHeaderTxTotalBytes:[655,l],warpMiRxPktErrorCount:[1118,s],warpMiTxPktErrorCount:[1117,s],warpRelayChangeDetectCount:[1154,s],warpRxPktErrorCount:[746,s],warpTxPktErrorCount:[745,s],waspKeyErrorCount:[1156,s],wavFileWriteMaxLatency:[1089,u],weakCellularNetConditionDetected:[429,s],weakWifiNetConditionDetected:[430,s],weakWifiSwitchToDefNetSuccess:[397,s],weakWifiSwitchToDefNetSuccessByPeriodicalCheck:[395,s],weakWifiSwitchToDefNetTriggered:[396,s],weakWifiSwitchToDefNetTriggeredByPeriodicalCheck:[394,s],weakWifiSwitchToNonDefNetFalsePositive:[399,s],weakWifiSwitchToNonDefNetSuccess:[400,s],weakWifiSwitchToNonDefNetTriggered:[398,s],wifiRssiAtCallStart:[263,s],wpNotifyCallFailed:[64,s],wpSoftwareEcMatches:[65,o],xmppStatus:[3,ki],xorCipher:[269,Ui],zedFileWriteMaxLatency:[1088,u]},[1,1,1],"regular"],CatalogBiz:[1722,{cartToggle:[13,o],catalogAppealReason:[4,c],catalogBizAction:[1,se],catalogEntryPoint:[7,le],catalogSessionId:[3,c],collectionCount:[18,s],collectionId:[14,c],collectionIndex:[15,c],deepLinkOpenFrom:[8,je],errorCode:[5,s],isOrderMsgAttached:[10,o],orderId:[9,c],productCount:[6,s],productId:[2,c],productIds:[12,c],productIndex:[16,c],quantity:[11,s]},[1,1,1],"regular"],CatalogCategoryView:[3292,{catalogCategoryId:[1,c],catalogOwnerJid:[2,c],catalogSessionId:[3,c],categoryBrowsingEntryPoint:[4,ue],categoryItemIndex:[5,s],categoryLevel:[6,s],isLastLevel:[7,o],productId:[8,c],sequenceNumber:[9,s],viewAction:[10,ti]},[1,1,1],"private",0],CatalogView:[1630,{bizPlatform:[16,I],cartToggle:[15,o],catalogEntryPoint:[7,le],catalogEventSampled:[8,o],catalogOwnerJid:[6,c],catalogReportReasonCode:[4,c],catalogSessionId:[2,c],catalogViewAction:[1,ce],collectionId:[17,c],collectionIndex:[18,c],deepLinkOpenFrom:[9,je],isNewProductAddedToCart:[13,o],isOrderMsgAttached:[10,o],orderId:[11,c],productId:[5,c],productIndex:[19,c],quantity:[12,s]},[1,1,1],"regular"],ChatComposerAction:[2948,{chatComposerActionTarget:[2,pe],chatComposerActionType:[1,fe]},[1,1,1],"private",113760892],ChatFilterEvent:[1616,{actionType:[1,_e],filterType:[2,ge],searchResultType:[4,Se],sessionId:[3,s],targetScreen:[5,he]},[1,1,1],"regular"],ChatFolderOpen:[2808,{activityIndicatorCount:[2,s],folderType:[1,c],hasImportantMessages:[3,o]},[1,1,1],"regular"],ChatMessageCounts:[1644,{awayMsgsSent:[56,s],bizCatalogType:[60,M],bizConversationDepth:[65,s],blockReason:[33,R],broadcastMsgsReceived:[30,s],broadcastMsgsSent:[29,s],callOffersReceived:[27,s],callOffersSent:[26,s],callsResultBusy:[70,s],callsResultCancelled:[71,s],callsResultConnected:[72,s],callsResultError:[78,s],callsResultMissed:[73,s],callsResultRejected:[74,s],cartViews:[86,s],chatEphemeralityDuration:[15,s],chatMuted:[8,ye],chatOverflowClicks:[79,s],chatTypeInd:[2,Ee],collectionInquiriesSent:[44,s],commerceMsgsReceived:[41,s],commerceMsgsSent:[40,s],disappearingChatInitiator:[59,He],entryPointConversionApp:[47,c],entryPointConversionSource:[46,c],ephemeralMessagesReceived:[14,s],ephemeralMessagesSent:[13,s],ephemeralMessagesUnreadExpired:[69,s],fbCtaInquiriesSent:[45,s],firstResponseTime:[25,s],gaStatus:[22,dt],greetingMsgsSent:[57,s],groupContainsBiz:[75,o],groupMembershipReplies:[51,s],groupPrivateReplies:[52,s],groupSize:[19,s],isAContact:[6,o],isAGroup:[5,o],isArchived:[10,o],isBlocked:[32,o],isCartAddClicked:[36,o],isCommerceViewed:[35,o],isCtaOnPdpClicked:[37,o],isLabelled:[54,o],isOppositePartyInitiated:[62,o],isPinned:[9,o],isWaPayRegistered:[81,o],labelledMsgs:[55,s],messagesReceived:[4,s],messagesSent:[3,s],messagesStarred:[12,s],messagesUnread:[11,s],newThread:[68,o],odReceived:[82,s],ordersSent:[38,s],p2mOdNnpTransactionsSent:[83,s],p2mOdNpTransactionsSent:[84,s],paymentsSent:[39,s],pdpInquiriesSent:[42,s],pdpViews:[61,s],profileReplies:[64,s],profileViews:[63,s],quickRepliesSent:[58,s],receiverDefaultDisappearingDuration:[21,s],repliesSent:[80,s],senderDefaultDisappearingDuration:[20,s],spamReports:[31,s],startTime:[7,s],statusReplies:[50,s],statusViews:[49,s],storefrontInquiriesSent:[43,s],threadDs:[66,c],threadId:[67,c],totalCallDuration:[28,s],typeOfGroup:[85,xr],videoCallsOffered:[76,s],viewOnceMessagesOpened:[18,s],viewOnceMessagesReceived:[17,s],viewOnceMessagesSent:[16,s],voiceCallsOffered:[77,s]},[1,1,1],"regular"],ChatPsaAction:[3572,{messageMediaType:[1,Ht],psaMessageActionType:[2,Yn],psaMessageId:[3,s]},[1,1,1],"regular"],ChatPsaRead:[3574,{messageMediaType:[1,Ht],psaMessageId:[2,s],readEntryPoint:[3,ir]},[1,1,1],"regular"],ChatPsaRemove:[3582,{blockReason:[1,R],lastReceivedMediaType:[2,Ht],lastReceivedMessageId:[3,s],lastReceivedMessageTs:[4,u],psaMessageRemoveAction:[5,Kn],psaMessageRemoveEntryPoint:[6,Wn],waOfficialAccountName:[7,si]},[1,1,1],"regular"],ClockSkewDifferenceT:[3178,{clockSkewHourly:[1,s]},[1,1e3,1e4],"private",37887164],CommercePerf:[2420,{commercePerfEntryPoint:[4,Oe],commercePerfMarker:[3,Me],commercePerfView:[5,Ie],instanceKey:[1,s],timespentT:[2,u]},[1,1,1],"private",113760892],CommerceView:[2438,{businessOwnerJid:[4,c],commerceAction:[1,be],commerceActionSequenceNumber:[5,s],commerceEntryPoint:[2,Pe],commerceEventSampled:[8,o],commerceReportReasonCode:[6,c],commerceSessionId:[3,c],deepLinkOpenFrom:[9,je],productId:[7,c]},[1,1,1],"private",113760892],CommunityCreation:[3492,{communityCreationActionCount:[1,s],communityCreationActionTaken:[2,we],communityCreationCurrentScreen:[3,Re],communityCreationSessionId:[4,c]},[1,1,1],"regular"],CommunityHomeAction:[3494,{communityHomeGroupDiscoveries:[1,s],communityHomeGroupJoins:[2,s],communityHomeGroupNavigations:[3,s],communityHomeId:[4,c],communityHomeViews:[5,s]},[1,1,1],"regular"],CommunityTabAction:[3496,{communityNoActionTabViews:[4,s],communityTabGroupNavigations:[1,s],communityTabToHomeViews:[2,s],communityTabViews:[3,s]},[1,1,1],"regular"],CompanionForceUpgradeUserActionV2:[3294,{forceUpgradeReasonV2:[1,c],forceUpgradeUserActionV2:[2,ut]},[1,1,1],"regular"],CompanionGetDevicesList:[3010,{getDevicesListApiCount:[2,s],getDevicesListApiDeviceType:[3,c],getDevicesListApiEnumerationType:[4,c],getDevicesListApiT:[1,u]},[1,1,1],"regular"],ContactDiscoveryTimeToEngagement:[3190,{elapsedTime:[1,s]},[1,1,1],"private",0],ContactSend:[2234,{channel:[1,De],isMultiVcard:[2,o],messageSendResult:[3,qt],messageSendT:[4,u],vcardDataSize:[5,s]},[1,1,1],"regular"],ContactUsSession:[470,{contactUsAutomaticEmail:[3,o],contactUsExitState:[1,ke],contactUsFaq:[2,o],contactUsLogs:[4,o],contactUsMenuFaqT:[12,u],contactUsOutage:[5,o],contactUsOutageEmail:[6,o],contactUsProblemDescription:[7,c],contactUsScreenshotC:[19,l],contactUsT:[11,u],languageCode:[21,c]},[1,1,1],"regular"],CrashLog:[494,{crashContext:[3,c],crashCount:[5,s],crashReason:[2,c],crashType:[6,Ue]},[1,1,100],"regular"],CtwaActionBannerUnderstand:[3586,{bannerIdentifier:[1,c],bannerLocale:[2,c],clientLocale:[3,c],hasLocalLink:[4,o],hasUniversalLink:[5,o],invalidLink:[6,c],lwiFlowIdentifier:[7,c],preferredLink:[8,An],validLocale:[9,o],validNotification:[10,o]},[1,1,1],"private",0],CtwaBusinessPreview:[3078,{catalogPresent:[4,o],ctwaBusinessPreviewAction:[1,x],eventTimestampMs:[2,s],openingHoursPresent:[5,o],profileLoadTimeMs:[3,s]},[1,1,1],"private",113760892],CtwaUserJourney:[3466,{adId:[1,c],businessJid:[2,c],ctwaUserJourneyOperation:[3,Be],icebreakersShown:[4,o],sequenceNumber:[5,s]},[1,1,1],"private",113760892],CtwaWelcomeMessage:[3022,{ctwaWelcomeMessageAction:[1,Li],ctwaWelcomeMessageContainsIcebreakers:[3,o],ctwaWelcomeMessageError:[4,Di],ctwaWelcomeMessageIcebreakersContainAutoreply:[5,o],firstWelcomeMessageImpressionTime:[2,s]},[1,1,1],"private",113760892],Daily:[1158,{accessibilityVoiceover:[108,o],addressbookSize:[11,s],addressbookWhatsappSize:[12,s],androidAdvertisingId:[135,c],androidKeystoreState:[139,y],appCodeHash:[103,c],autoDlAudioCellular:[90,o],autoDlAudioRoaming:[91,o],autoDlAudioWifi:[89,o],autoDlDocCellular:[96,o],autoDlDocRoaming:[97,o],autoDlDocWifi:[95,o],autoDlImageCellular:[87,o],autoDlImageRoaming:[88,o],autoDlImageWifi:[86,o],autoDlVideoCellular:[93,o],autoDlVideoRoaming:[94,o],autoDlVideoWifi:[92,o],backupNetworkSetting:[10,A],backupRestoreEncryptionVersion:[138,s],backupSchedule:[9,b],chatDatabaseSize:[19,s],defaultDisappearingDuration:[140,s],deviceLanguage:[153,c],entSecurityNotificationsEnabled:[134,o],favoritedAnimatedStickerCount:[113,s],favoritedFirstPartyStickerCount:[112,s],favoritedTotalStickerCount:[111,s],installedAnimatedStickerPackCount:[116,s],installedAnimatedThirdPartyStickerPackCount:[137,s],installedFirstPartyStickerPackCount:[115,s],installedTotalStickerPackCount:[114,s],ipCountry:[123,c],ipStr:[122,c],keyboardLanguage:[154,c],languageCode:[5,c],locationCode:[6,c],mdPairTime:[124,s],mediaFolderFileCount:[21,s],mediaFolderSize:[20,s],modifiedInternalProps:[155,o],networkIsRoaming:[7,o],osBuildNumber:[4,c],osNotificationSetting:[118,tn],packageName:[102,c],paymentsIsEnabled:[100,o],permissionContacts:[104,o],phoneCores:[156,s],privacySettingsAbout:[141,wn],privacySettingsAboutExceptNum:[142,In],privacySettingsGroups:[143,wn],privacySettingsGroupsExceptNum:[144,In],privacySettingsLastSeen:[145,wn],privacySettingsLastSeenExceptNum:[146,In],privacySettingsProfilePhoto:[147,wn],privacySettingsProfilePhotoExceptNum:[148,In],privacySettingsStatus:[150,wn],privacySettingsStatusExceptNum:[151,In],privacySettingsStatusShareNum:[152,In],receiptsEnabled:[8,o],screenLockEnabled:[157,o],simMcc:[2,s],simMnc:[3,s],storageAvailSize:[31,s],storageTotalSize:[32,s],videoFolderFileCount:[23,s],videoFolderSize:[22,s]},[1,1,1],"regular"],DeepLinkClick:[1156,{deepLinkHasPhoneNumber:[2,o],deepLinkHasText:[1,o],deepLinkSessionId:[3,c]},[1,1,1],"regular"],DeepLinkMsgSent:[3198,{deepLinkAction:[1,Fe],deepLinkSessionId:[2,c]},[1,1,1],"regular"],DeepLinkOpen:[2136,{deepLinkOpenFrom:[2,je],deepLinkSessionId:[6,c],deepLinkType:[3,Ye],isContact:[4,o],linkOwnerType:[5,fn]},[1,1,1],"regular"],DisappearingMessageChatPicker:[3398,{chatsSelected:[1,s],dmChatPickerEntryPoint:[2,ze],dmChatPickerEventName:[3,qe],ephemeralityDuration:[4,s],groupChatsSelected:[5,s],groupSizeDistributionJson:[9,c],newlyEphemeralChats:[7,s],totalChatsInChatPicker:[8,s]},[1,1,1],"regular"],DisappearingMessageKeepInChat:[3482,{chatEphemeralityDuration:[1,s],isAGroup:[2,o],isAdmin:[3,o],keptDelta:[4,s],kicActionName:[5,St],kicActor:[6,Et],kicEntryPoint:[7,vt],mediaType:[8,Ht],messageExpiredOnUnkeep:[9,o],messageExpiryTimer:[10,s],messagesInFolder:[11,s],messagesSelected:[12,s],threadId:[13,c]},[1,1,1],"regular"],DisappearingModeSettingChange:[3056,{disappearingModeEntryPoint:[4,Ve],lastToggleTimestamp:[3,s],newEphemeralityDuration:[2,s],previousEphemeralityDuration:[1,s]},[1,1,1],"regular"],DisappearingModeSettingEvents:[3446,{disappearingModeEntryPoint:[5,Ve],disappearingModeSettingEventName:[1,$e],lastToggleTimestamp:[2,s],newEphemeralityDuration:[3,s],previousEphemeralityDuration:[4,s]},[1,1,1],"regular"],E2eMessageDecryptFailSender:[3524,{clientMessageId:[1,c],e2eCiphertextType:[2,Ze],e2eDestination:[9,et],e2eFailureReason:[3,tt],e2eSenderJid:[4,c],e2eSenderType:[5,nt],messageMediaType:[6,Ht],offline:[7,o],retryCount:[8,s],revokeType:[10,sr]},[1,1,1],"private",0],E2eMessageRecv:[478,{e2eCiphertextType:[5,Ze],e2eCiphertextVersion:[6,s],e2eDestination:[4,et],e2eFailureReason:[2,tt],e2eSenderType:[8,nt],e2eSuccessful:[1,o],messageMediaType:[7,Ht],offline:[9,o],retryCount:[3,s],revokeType:[10,sr]},[1,1,20],"regular"],E2eMessageSend:[476,{e2eCiphertextType:[5,Ze],e2eCiphertextVersion:[6,s],e2eDestination:[4,et],e2eFailureReason:[2,tt],e2eReceiverType:[8,We],e2eSuccessful:[1,o],encRetryCount:[9,s],messageIsInvisible:[10,o],messageMediaType:[7,Ht],retryCount:[3,s],revokeType:[11,sr]},[1,1,1],"regular"],E2eRetryAfterDelivery:[894,{deviceType:[4,We],messageType:[1,Jt],msgRetryCount:[3,s],retryRevoke:[2,o]},[1,1,1],"regular"],E2eRetryReject:[3578,{messageType:[1,Jt],msgRetryCount:[2,s],retryRejectReason:[3,or],retryRevoke:[4,o],senderDeviceType:[5,We]},[1,1,1],"regular"],E2eeSystemMessage:[3176,{chatCategory:[1,de],e2eeDialogInteraction:[2,ve],e2eeSystemMessageGroupSizeBucket:[3,rt],e2eeSystemMessageType:[4,dr]},[1,1,1],"regular"],EditBusinessProfile:[1466,{businessProfileEntryPoint:[10,B],editBusinessProfileSessionId:[2,c],editProfileAction:[1,it],editProfileActionField:[9,F],hasAddress:[5,o],hasCategory:[4,o],hasDescription:[3,o],hasEmail:[7,o],hasHours:[6,o],hasWebsite:[8,o]},[1,1,1],"regular"],EphemeralMessageTime:[2742,{zombieStateDuration:[1,s]},[1,1,1],"regular"],EphemeralPurgeCount:[2744,{messageCount:[1,s]},[1,1,1],"regular"],EphemeralSettingChange:[2370,{chatEphemeralityDuration:[1,s],ephemeralSettingEntryPoint:[3,ot],ephemeralSettingGroupSize:[5,Cn],previousEphemeralityDuration:[2,s],threadId:[6,c]},[1,1,1],"regular"],ForwardSend:[1728,{disappearingChatInitiator:[21,He],e2eCiphertextType:[12,Ze],e2eCiphertextVersion:[11,s],ephemeralityDuration:[18,s],fastForwardEnabled:[5,o],isForwardedForward:[22,o],isFrequentlyForwarded:[14,o],mediaCaptionPresent:[10,o],messageForwardAgeT:[4,u],messageIsFanout:[6,o],messageIsFastForward:[3,o],messageIsInternational:[9,o],messageMediaType:[2,Ht],messageSendT:[13,u],messageType:[1,Jt],receiverDefaultDisappearingDuration:[20,s],resendCount:[8,s],retryCount:[7,s],senderDefaultDisappearingDuration:[19,s],typeOfGroup:[23,xr],wouldBeFrequentlyForwardedAt3:[16,o],wouldBeFrequentlyForwardedAt4:[17,o]},[1,1,1],"regular"],GatedChatOpened:[3150,{chatGatedReason:[1,me],selfInitiated:[2,o]},[1,1,1],"regular"],GatedMessageReceived:[3152,{chatGatedReason:[1,me]},[1,1,1],"regular"],GifFromProviderSent:[1124,{gifSearchProvider:[1,pt]},[1,1,1],"regular"],GifSearchCancelled:[1126,{gifSearchProvider:[1,pt]},[1,1,1],"regular"],GifSearchNoResults:[1128,{gifSearchProvider:[1,pt],inputLanguageCode:[3,c],languageCode:[2,c]},[1,1,1],"regular"],GifSearchResultTapped:[1122,{gifSearchProvider:[1,pt],rank:[2,s]},[1,1,1],"regular"],GifSearchSessionStarted:[1134,{gifSearchProvider:[1,pt]},[1,1,1],"regular"],GraphqlCatalogRequest:[3206,{graphqlCatalogEndpoint:[1,ft],graphqlErrorCode:[3,s],graphqlRequestResult:[2,_t]},[1,1,1],"private",0],GroupCatchUp:[3058,{mentionsCountPendingPercentage:[4,s]},[1,1,1],"regular"],GroupCreateC:[156,{},[1,1,1],"regular"],GroupJoinC:[158,{},[1,1,1],"regular"],HfmTextSearchComplete:[2186,{},[1,1,1],"regular"],KeepInChatNotif:[3484,{groupMessageNotificationTaps:[1,s],groupMessageNotifications:[2,s],kicGroupNotificationTaps:[3,s],kicGroupNotifications:[4,s],kicNotificationTaps:[5,s],kicNotifications:[6,s],totalNotificationTaps:[7,s],totalNotifications:[8,s],userMessageNotificationTaps:[9,s],userMessageNotifications:[10,s]},[1,1,1],"regular"],KeepInChatNux:[3486,{chatEphemeralityDuration:[1,s],kicNuxActionName:[2,Ct],threadId:[3,c],trigger:[4,kr]},[1,1,1],"regular"],KeepInChatPerf:[3488,{chatEphemeralityDuration:[1,s],kicErrorCode:[2,Tt],kicMessageEphemeralityDuration:[3,s],kicRequestType:[4,At],requestSendTime:[5,s],response:[6,ar],threadId:[7,c]},[1,1,1],"regular"],LabelEvent:[1422,{itemsLabeledCount:[5,s],labelCount:[4,s],labelOperation:[2,bt],labelTarget:[1,Pt],predefinedLabelNumber:[3,s]},[1,1,1],"regular"],LdpExampleEvent1:[2866,{rapporValue1:[1,s],rapporValue2:[2,s]},[1,1,1],"private",113760892],Login:[460,{androidKeystoreState:[10,y],connectionOrigin:[6,Ne],connectionT:[5,u],loginResult:[1,Mt],loginT:[3,u],longConnect:[4,o],passive:[8,o],retryCount:[2,s],sequenceStep:[7,s],serverErrorCode:[9,s]},[1,1,1],"regular"],MdAppStateDirtyBits:[2520,{dirtyBitsFalsePositive:[2,o]},[1,20,1e3],"regular"],MdAppStateKeyRotation:[2518,{mdAppStateKeyRotationReason:[1,It]},[1,20,1e3],"regular"],MdAppStateMessageRange:[2522,{additionalMessagesCount:[1,s]},[1,20,1e3],"regular"],MdAppStateOfflineNotifications:[2602,{redundantCount:[1,s]},[1,20,1e3],"regular"],MdAppStateSyncDaily:[2300,{crossIndexConflictCount:[11,s],invalidActionCount:[4,s],keyRotationRemoveCount:[12,s],missingKeyCount:[9,s],mutationCount:[1,s],storedMutationCount:[7,s],unsetActionCount:[8,s],unsupportedActionCount:[5,s],uploadConflictCount:[10,s]},[1,1,1],"regular"],MdAppStateSyncMutationStats:[3180,{applied:[1,Zt],failed:[2,Zt],invalid:[3,Zt],orphan:[4,Zt],syncdAction:[5,c],unsupported:[6,Zt]},[1,1,20],"private",0],MdBadDeviceSentMessage:[2176,{dsmError:[2,Xe],peerType:[1,We]},[1,1,1],"regular"],MdBootstrapAppStateCriticalDataProcessing:[3164,{bootstrapAppStateDataStage:[1,N],mdBootstrapPayloadType:[2,Rt],mdRegAttemptId:[3,c],mdSessionId:[4,c],mdTimestamp:[5,s]},[1,1,1],"regular"],MdBootstrapAppStateDataDownloaded:[2294,{mdBootstrapContactsCount:[5,s],mdBootstrapHistoryPayloadType:[11,wt],mdBootstrapPayloadSize:[4,s],mdBootstrapPayloadType:[2,Rt],mdBootstrapStepDuration:[6,s],mdBootstrapStepResult:[7,Lt],mdRegAttemptId:[10,c],mdSessionId:[1,c],mdStorageQuotaBytes:[8,s],mdStorageQuotaUsedBytes:[9,s],mdTimestamp:[3,s]},[1,1,1],"regular"],MdBootstrapDataApplied:[2298,{collection:[5,Ae],historySyncStageProgress:[11,s],mdBootstrapContactsCount:[8,s],mdBootstrapHistoryPayloadType:[10,wt],mdBootstrapPayloadType:[3,Rt],mdBootstrapSource:[2,Nt],mdBootstrapStepDuration:[6,s],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestamp:[4,s],usedSnapshot:[7,o]},[1,1,1],"regular"],MdBootstrapHistoryDataDownloaded:[2296,{historySyncStageProgress:[14,s],mdBootstrapChatsCount:[6,s],mdBootstrapHistoryPayloadType:[13,wt],mdBootstrapMessagesCount:[5,s],mdBootstrapPayloadSize:[4,s],mdBootstrapPayloadType:[2,Rt],mdBootstrapStepDuration:[7,s],mdBootstrapStepResult:[8,Lt],mdHsOldestMessageTimestamp:[11,s],mdRegAttemptId:[12,c],mdSessionId:[1,c],mdStorageQuotaBytes:[9,s],mdStorageQuotaUsedBytes:[10,s],mdTimestamp:[3,s]},[1,1,1],"regular"],MdBootstrapHistoryDataReceived:[2998,{historySyncStageProgress:[5,s],mdBootstrapHistoryPayloadType:[3,wt],mdBootstrapPayloadType:[2,Rt],mdSessionId:[1,c],mdTimestamp:[4,s]},[1,1,1],"regular"],MdCriticalEvent:[2746,{collection:[2,Ae],mdCriticalEventCode:[1,Gt]},[1,1,1],"regular"],MdDeviceSyncAck:[2180,{chatType:[1,zt],revoke:[2,o]},[1,1,1],"regular"],MdExpansionAgentBrowserMdId:[3390,{agentId:[1,c],browserId:[2,c],companionMdId:[5,s],isCustomAgentName:[6,o],loginTimestamp:[3,s],logoutTimestamp:[4,s],mdLinkedCount:[8,s],multideviceAction:[7,Xt]},[1,1,1],"regular"],MdFatalError:[2304,{collection:[2,Ae],daysSinceLastPeriodicSync:[11,s],hoursSinceFirstFiniteFailure:[12,s],isBootstrap:[3,o],mailboxAgeDays:[13,s],mdFatalErrorCode:[1,xt],patchSnapshotMutationCount:[9,s],patchVersion:[5,s],sourceType:[10,Bt],timeSincePairingMs:[6,s],timeSinceRefreshMs:[7,s],timeSinceTabTakeoverMs:[8,s]},[1,1,1],"regular"],MdLinkDeviceCompanion:[2576,{mdDurationS:[8,s],mdLinkDeviceCompanionErrorCode:[6,s],mdLinkDeviceCompanionStage:[4,kt],mdRegAttemptId:[9,c],mdSessionId:[1,c],mdTimestampS:[7,s],mdWasUpgraded:[5,o]},[1,1,1],"regular"],MdLoadingHistoryMessage:[3382,{chatThreadId:[1,c],loadingMessageTypeShown:[2,Ot],mdSessionId:[3,c]},[1,1,1],"regular"],MdPushnameValidation:[2302,{didWebUserChangeSyncd:[3,o],isSyncdPushnameEmpty:[2,o],matches:[1,o],validationCaller:[4,Ft],validationStage:[5,Ut],webPlatform:[6,jt]},[1,1,1e3],"regular"],MdRetryFromUnknownDevice:[2178,{offline:[2,o],senderType:[1,We]},[1,1,1],"regular"],MdSyncdDogfoodingFeatureUsage:[3016,{mdSyncdDogfoodingFeature:[1,Dt]},[1,1,1],"regular"],MediaDownload2:[1590,{connectionType:[31,Le],debugMediaException:[24,c],debugMediaIp:[22,c],debugUrl:[23,c],downloadBytesTransferred:[20,l],downloadConnectT:[15,u],downloadHttpCode:[18,s],downloadIsReuse:[17,o],downloadIsStreaming:[19,o],downloadNetworkT:[16,u],downloadQuality:[37,Qe],downloadResumePoint:[14,s],downloadTimeToFirstByteT:[21,u],estimatedBandwidth:[36,l],isViewOnce:[41,o],mediaId:[38,s],networkStack:[30,en],overallAttemptCount:[4,s],overallBackendStore:[39,C],overallConnBlockFetchT:[10,u],overallConnectionClass:[29,c],overallCumT:[27,u],overallDecryptT:[12,u],overallDomain:[5,c],overallDownloadMode:[11,Yt],overallDownloadOrigin:[35,Je],overallDownloadResult:[25,Kt],overallFileValidationT:[13,u],overallIsEncrypted:[28,o],overallIsFinal:[26,o],overallMediaSize:[7,l],overallMediaType:[1,Ht],overallMmsVersion:[6,s],overallQueueT:[9,u],overallRetryCount:[3,s],overallT:[8,u],usedFallbackHint:[40,c]},[1,1,1],"regular"],MediaPicker:[1038,{audienceSelectorClicked:[24,o],audienceSelectorUpdated:[25,o],chatRecipients:[16,s],isViewOnce:[22,o],mediaPickerChanged:[4,s],mediaPickerCroppedRotated:[10,s],mediaPickerDeleted:[3,s],mediaPickerDrawing:[11,s],mediaPickerFilter:[18,s],mediaPickerHasLocationSticker:[26,o],mediaPickerLikeDoc:[19,s],mediaPickerNotLikeDoc:[20,s],mediaPickerOrigin:[14,Wt],mediaPickerOriginThirdParty:[21,o],mediaPickerSent:[2,s],mediaPickerSentUnchanged:[5,s],mediaPickerStickers:[12,s],mediaPickerT:[15,u],mediaPickerText:[13,s],mediaType:[1,Ht],photoGalleryDurationT:[23,u],statusRecipients:[17,s]},[1,1,1],"regular"],MediaStreamPlayback:[1584,{bytesDownloadedStart:[4,l],bytesTransferred:[5,l],didPlay:[15,o],forcedPlayCount:[12,s],initialBufferingT:[7,u],mediaSize:[2,l],mediaType:[3,Ht],overallPlayT:[10,u],overallT:[1,u],playbackCount:[14,s],playbackError:[17,s],playbackOrigin:[16,vn],playbackState:[11,Tn],seekCount:[13,s],totalRebufferingCount:[9,s],totalRebufferingT:[8,u],videoDuration:[6,s]},[1,1,1],"regular"],MediaUpload2:[1588,{connectionType:[43,Le],debugMediaException:[34,c],debugMediaIp:[32,c],debugUrl:[33,c],estimatedBandwidth:[45,l],finalizeConnectT:[28,u],finalizeHttpCode:[31,s],finalizeIsReuse:[30,o],finalizeNetworkT:[29,u],isViewOnce:[49,o],mediaId:[46,s],networkStack:[42,en],overallAttemptCount:[4,s],overallConnBlockFetchT:[10,u],overallConnectionClass:[41,c],overallCumT:[37,u],overallCumUserVisibleT:[38,u],overallDomain:[5,c],overallEncryptT:[50,u],overallIsFinal:[36,o],overallIsForward:[16,o],overallIsManual:[13,o],overallLastUploadRetryPhase:[11,dn],overallMediaKeyReuse:[40,pn],overallMediaSize:[7,l],overallMediaType:[1,Ht],overallMmsVersion:[6,s],overallOptimisticFlag:[12,an],overallQueueT:[9,u],overallRetryCount:[3,s],overallT:[8,u],overallTranscodeT:[15,u],overallUploadMode:[39,Vt],overallUploadOrigin:[44,Yr],overallUploadResult:[35,$t],overallUserVisibleT:[14,u],resumeConnectT:[17,u],resumeHttpCode:[20,s],resumeIsReuse:[19,o],resumeNetworkT:[18,u],uploadBytesTransferred:[27,l],uploadConnectT:[22,u],uploadHttpCode:[25,s],uploadIsReuse:[24,o],uploadIsStreaming:[26,o],uploadNetworkT:[23,u],uploadResumePoint:[21,s],uploadSource:[48,Kr],usedFallbackHint:[47,c]},[1,1,1],"regular"],MemoryStat:[1336,{hasVerifiedNumber:[7,o],numMessages:[8,l],privateBytes:[3,l],processType:[5,c],sharedBytes:[4,l],uptime:[6,l],workingSetPeakSize:[2,l],workingSetSize:[1,l]},[1,1,1],"regular"],MessageHighRetryCount:[3132,{deviceSizeBucket:[5,mr],e2eSenderType:[3,nt],mediaType:[1,Ht],messageType:[4,Jt],retryCount:[2,s]},[1,20,20],"regular"],MessageReceive:[450,{deviceCount:[16,s],deviceSizeBucket:[10,mr],disappearingChatInitiator:[14,He],ephemeralityDuration:[13,s],isAReply:[19,o],isForwardedForward:[18,o],isViewOnce:[9,o],messageIsInternational:[4,o],messageIsInvisible:[23,o],messageIsOffline:[5,o],messageMediaType:[2,Ht],messageQueueTime:[15,u],messageReceiveT0:[6,u],messageReceiveT1:[7,u],messageType:[1,Jt],mutedGroupMessage:[8,o],numOfWebUrlsInTextMessage:[3,s],paddingBytesSize:[22,s],participantCount:[17,s],receiverDefaultDisappearingDuration:[12,s],revokeType:[20,sr],senderDefaultDisappearingDuration:[11,s],typeOfGroup:[21,xr]},[1,1,1],"regular"],MessageSend:[854,{deviceCount:[31,s],deviceSizeBucket:[25,mr],disappearingChatInitiator:[30,He],e2eBackfill:[23,o],e2eCiphertextType:[10,Ze],e2eCiphertextVersion:[9,s],ephemeralityDuration:[21,s],fastForwardEnabled:[15,o],isAReply:[35,o],isFromWamsys:[19,o],isViewOnce:[22,o],mediaCaptionPresent:[8,o],messageForwardAgeT:[14,u],messageIsFanout:[5,o],messageIsFastForward:[13,o],messageIsFirstUserMessage:[26,o],messageIsForward:[4,o],messageIsInternational:[7,o],messageIsInvisible:[29,o],messageIsRevoke:[24,o],messageMediaType:[3,Ht],messageSendOptUploadEnabled:[12,o],messageSendResult:[1,qt],messageSendResultIsTerminal:[17,o],messageSendT:[11,u],messageType:[2,Jt],networkWasDisconnected:[37,o],participantCount:[32,s],receiverDefaultDisappearingDuration:[28,s],resendCount:[16,s],retryCount:[6,s],revokeDuration:[33,s],revokeType:[34,sr],senderDefaultDisappearingDuration:[27,s],stickerIsAvatar:[38,o],stickerIsFirstParty:[18,o],thumbSize:[20,l],typeOfGroup:[36,xr]},[1,1,1],"regular"],MessageTemplateBlocks:[3002,{blockEntryPoint:[3,w],blockReason:[2,R],businessMessageTime:[5,s],businessPhoneNumber:[6,s],didUserReply:[4,o],isUnsubBlock:[7,o],templateId:[1,c]},[1,1,1],"private",113760892],OfflineResume:[3112,{chatThreadCount:[1,s],isOfflineCompleteMissed:[2,o],isResumeInForeground:[13,o],lastStanzaT:[3,u],mailboxAge:[14,s],mainScreenLoadT:[4,u],offlineDecryptErrorCount:[5,s],offlineMessageCount:[6,s],offlineNotificationCount:[7,s],offlinePreviewT:[8,u],offlineReceiptCount:[9,s],offlineSizeBytes:[10,s],onTrickleMode:[15,o],pageLoadT:[11,u],socketConnectT:[12,u]},[1,1,1],"regular"],OfflineResumeStage:[3536,{currentOfflineStage:[1,rn],offlineSessionId:[2,c],offlineStageTimestampMs:[3,s]},[1,1,1],"regular"],OrderDetailsActionsSmb:[3456,{acceptedPayMethods:[1,c],actionCategory:[2,c],extraAttributes:[3,c],hasAddedPrice:[4,o],hasCatalog:[5,o],hasNote:[6,o],orderDetailEntryPoint:[7,c],orderDetailsCreationAction:[8,on],paymentStatus:[9,o],paymentType:[10,c]},[1,1,1],"regular"],OtpCopyCodeClick:[3080,{businessPhoneNumber:[1,s],otpEntryPoint:[4,sn],otpEventType:[5,cn],templateId:[3,c]},[1,1,1],"private",0],OtpRetriever:[3468,{businessPhoneNumber:[1,s],ctaFallbackReason:[2,Ge],ctaType:[3,xe],messageReceivedElapsedTimeSeconds:[11,s],otpEventSource:[5,ln],otpEventType:[6,cn],otpProductType:[7,un],otpSessionId:[8,c],thirdPartyPackageNameFromIntent:[9,c],thirdPartyPackageSignatureHash:[10,c]},[1,1,1],"private",0],PaymentsDaily:[2950,{invitedUserCnt:[2,s],invitedUserRegisteredCnt:[3,s],inviterUserCnt:[5,s],invitesReceivedToUserCnt:[4,s],invitesSentToUserCnt:[1,s],startTs:[14,s],totalOneTimeMandateCnt:[15,s],totalRecurringMandateCnt:[16,s],totalTransactionReceivedCnt:[10,s],totalTransactionSentCnt:[6,s],transactionReceivedWithBackgroundAndStickerCnt:[13,s],transactionReceivedWithBackgroundCnt:[12,s],transactionReceivedWithStickerCnt:[11,s],transactionSentWithBackgroundAndStickerCnt:[9,s],transactionSentWithBackgroundCnt:[8,s],transactionSentWithStickerCnt:[7,s]},[1,1,1],"private",113760892],PlaceholderActivity:[1980,{deviceCount:[9,s],deviceSizeBucket:[8,mr],messageIsRevoke:[7,o],messageMediaType:[6,Ht],messageType:[5,Jt],participantCount:[10,s],placeholderActionInd:[2,gn],placeholderAddReason:[11,yn],placeholderChatTypeInd:[3,mn],placeholderTimePeriod:[4,s],placeholderTypeInd:[1,Sn]},[1,1,1],"regular"],PrekeysDepletion:[3014,{deviceSizeBucket:[3,mr],messageType:[2,Jt],prekeysFetchReason:[1,bn]},[1,1,1],"regular"],PremiumSubscriptions:[3442,{subscriberType:[8,Mr],subscriptionAction:[1,d],subscriptionAmount:[9,s],subscriptionAmountCurrency:[13,c],subscriptionAppStoreResult:[10,Ir],subscriptionEntryPoint:[2,wr],subscriptionErrorType:[12,Rr],subscriptionLength:[3,s],subscriptionProductSku:[4,c],subscriptionSessionId:[6,c],subscriptionType:[7,Nr]},[1,1,1],"regular"],PrivacyHighlight:[3296,{highlightCategory:[1,c],highlightSurface:[2,ht],userActionType:[3,zr]},[1,1,1],"regular"],PrivacyHighlightDaily:[3522,{dialogAppearCount:[1,s],dialogSelectCount:[2,s],narrativeAppearCount:[3,s],privacyHighlightCategory:[4,On],privacyHighlightSurface:[5,Mn]},[1,1,1],"regular"],ProductSearch:[3548,{catalogOwnerJid:[1,c],catalogSessionId:[2,c],productId:[3,c],searchEntryPoint:[4,cr],searchResultIndex:[5,s],searchViewAction:[6,ur],sequenceNumber:[7,s]},[1,1,1],"private",0],PsAppLaunch:[3300,{psAppLaunchCpuT:[1,u],psAppLaunchDestination:[2,Ln],psAppLaunchMainPreT:[3,u],psAppLaunchMainRunT:[4,u],psAppLaunchT:[5,u],psAppLaunchTypeT:[6,Dn]},[1,1,1],"private",56300709],PsBufferUpload:[2244,{applicationState:[6,E],psBufferUploadHttpResponseCode:[3,s],psBufferUploadResult:[1,kn],psBufferUploadT:[2,u],psDitheredT:[11,s],psForceUpload:[10,o],psTokenNotReadyReason:[4,Bn],psUploadReason:[9,Fn],waConnectedToChatd:[5,o]},[1,1,1],"regular"],PsCrashLog:[3312,{psAndroidAppStateMetadata:[1,c],psAndroidCrashedBuildVersion:[2,c],psCrashContext:[3,c],psCrashCount:[4,s],psCrashReason:[6,c],psCrashType:[7,Un]},[1,1,1],"private",56300709],PsIdCreate:[2310,{},[1,1,1],"regular"],PsIdUpdate:[2862,{psIdAction:[2,Gn],psIdKey:[1,s],psIdRotationFrequence:[3,s]},[1,1,1],"regular"],PsP2bThreadsV1:[2994,{chatEphemeralityDuration:[11,s],chatMuted:[6,ye],chatTypeInd:[18,Ee],ephemeralMessagesReceived:[13,s],ephemeralMessagesSent:[12,s],groupSize:[3,s],isAContact:[1,o],isAGroup:[2,o],isArchived:[5,o],isPinned:[4,o],messagesReceived:[8,s],messagesSent:[7,s],messagesStarred:[9,s],messagesUnread:[10,s],startTime:[17,s],viewOnceMessagesOpened:[14,s],viewOnceMessagesReceived:[16,s],viewOnceMessagesSent:[15,s]},[1,1,1],"private",113760892],PsPhoneNumberHyperlink:[3266,{isPhoneNumHyperlinkOwner:[1,o],phoneNumHyperlinkAction:[2,hn],phoneNumberStatusOnWa:[3,o],sequenceNumber:[4,s]},[1,1,1],"private",113760892],PsStructuredMessageInteraction:[3052,{bizPlatform:[1,I],businessOwnerJid:[7,c],messageClass:[3,Or],messageClassAttributes:[5,c],messageInteraction:[4,yt],messageMediaType:[2,Ht]},[1,1,1],"private",0],PsUserActivitySessionSummary:[3314,{psUserActivityDuration:[1,s],psUserActivityForeground:[2,s],psUserActivitySessionsLength:[3,s],psUserActivityStartTime:[4,s],psUserActivityTimeChange:[5,s],psUserSessionSummarySequence:[6,s]},[1,1,1],"private",113760892],PsWebWamForceFlush:[3284,{collectionId:[1,c],randomIntField:[2,s]},[1,1,1],"private",113760892],Ptt:[458,{pttDraftPlayCnt:[7,s],pttDraftSeekCnt:[8,s],pttDuration:[5,u],pttLock:[4,o],pttPauseCnt:[9,s],pttResult:[1,$n],pttSize:[3,l],pttSource:[2,zn],pttStop:[6,o],pttStopTapCnt:[10,s]},[1,1,1],"regular"],PttDaily:[2938,{pttCancelBroadcast:[9,s],pttCancelGroup:[8,s],pttCancelIndividual:[7,s],pttDraftReviewBroadcast:[15,s],pttDraftReviewGroup:[14,s],pttDraftReviewIndividual:[13,s],pttFastplaybackBroadcast:[21,s],pttFastplaybackGroup:[20,s],pttFastplaybackIndividual:[19,s],pttLockBroadcast:[12,s],pttLockGroup:[11,s],pttLockIndividual:[10,s],pttOutOfChatBroadcast:[29,s],pttOutOfChatGroup:[30,s],pttOutOfChatIndividual:[31,s],pttPausedRecordBroadcast:[22,s],pttPausedRecordGroup:[23,s],pttPausedRecordIndividual:[24,s],pttPlaybackBroadcast:[18,s],pttPlaybackGroup:[17,s],pttPlaybackIndividual:[16,s],pttRecordBroadcast:[3,s],pttRecordGroup:[2,s],pttRecordIndividual:[1,s],pttSendBroadcast:[6,s],pttSendGroup:[5,s],pttSendIndividual:[4,s],pttStopTapBroadcast:[25,s],pttStopTapGroup:[26,s],pttStopTapIndividual:[27,s]},[1,1,1],"regular"],PttLockC:[2984,{},[1,1,1],"regular"],PttPlayback:[2044,{pttDuration:[12,u],pttMainThreadBlock:[7,o],pttMiniPlayerClick:[15,s],pttMiniPlayerClose:[16,o],pttMiniPlayerPauseCnt:[17,s],pttPlayRequestT:[1,u],pttPlaybackFailed:[8,o],pttPlaybackOverallT:[4,u],pttPlaybackSpeed:[10,Hn],pttPlaybackSpeedCnt:[11,s],pttPlayedOutOfChat:[18,o],pttPlayedPct:[14,l],pttPlayer:[9,Vn],pttPlayerInitT:[2,u],pttPlayerPlayT:[3,u],pttSeekCnt:[13,s],pttTrigger:[5,Jn],pttType:[6,qn]},[1,1,1],"regular"],QuickReply:[1468,{attachmentGifCount:[7,s],attachmentImageCount:[5,s],attachmentVideoCount:[6,s],isSmartDefault:[10,o],quickReplyAction:[1,Xn],quickReplyCount:[2,s],quickReplyEntryPoint:[11,Zn],quickReplyKeywordCount:[3,s],quickReplyKeywordMatched:[4,o],quickReplyOrigin:[9,er],quickReplyTranscodeResult:[8,tr]},[1,1,1],"regular"],ReactionActions:[3184,{mediaType:[3,Ht],messageType:[1,Jt],reactionAction:[2,rr]},[1,10,20],"regular"],RoomsCreationFlow:[2202,{entryResult:[3,Ke],errorReason:[2,st],roomsEntryPoint:[1,lr]},[1,1,1],"regular"],SendRevokeMessage:[1348,{messageMediaType:[2,Ht],messageType:[1,Jt],revokeSendDelay:[3,s]},[1,1,1],"regular"],SenderKeyExpired:[3130,{chatType:[1,zt],deviceSizeBucket:[2,mr],expiryReason:[3,lt]},[1,1,1],"regular"],ShareBizTools:[3444,{isPremiumUser:[1,o],linkType:[2,pr],shareBusinessAction:[3,fr]},[1,1,1],"regular"],SignCredential:[2242,{applicationState:[6,E],overallT:[4,u],projectCode:[7,Nn],retryCount:[2,s],signCredentialResult:[1,hr],signCredentialT:[3,u],waConnectedToChatd:[5,o]},[1,1,1],"regular"],StatusItemView:[1658,{isPosterBiz:[23,o],isPosterInAddressBook:[25,o],mediaType:[4,Ht],psaCampaignId:[17,c],psaCampaignItemIndex:[18,s],psaLinkAvailable:[19,o],psaLinkClick:[22,o],psaLinkLoadTime:[21,u],psaLinkOpenResult:[20,jn],statusItemImpressionCount:[14,s],statusItemIndex:[16,s],statusItemLength:[7,u],statusItemLoadTime:[5,u],statusItemReplied:[8,s],statusItemUnread:[9,o],statusItemViewCount:[10,s],statusItemViewResult:[3,Sr],statusItemViewTime:[6,u],statusRowIndex:[2,s],statusRowSection:[11,Cr],statusViewerSessionId:[1,s],urlStatusClicked:[26,Vr],urlStatusType:[27,$r]},[1,1,1],"regular"],StatusReply:[1180,{isPosterBiz:[4,o],isPosterInAddressBook:[6,o],statusReplyMessageType:[3,Er],statusReplyResult:[2,vr],statusSessionId:[1,s]},[1,1,1],"regular"],StatusReplyReceived:[3560,{statusMediaType:[1,Ht],statusPosterJid:[2,c],statusReplyMessageType:[3,Er]},[1,1,1],"private",0],StatusRowView:[1656,{psaCampaigns:[8,c],statusRowEntryMethod:[5,Tr],statusRowIndex:[4,s],statusRowSection:[3,Cr],statusRowUnreadItemCount:[7,s],statusRowViewCount:[6,s],statusSessionId:[1,s],statusViewerSessionId:[2,s]},[1,1,1],"regular"],StatusTabOpen:[1172,{psaCampaigns:[5,c],statusAvailableUpdatesCount:[2,s],statusRankT:[3,u],statusSessionId:[1,s],statusTabOpenT:[4,u]},[1,1,1],"regular"],StickerCommonQueryToStaticServer:[2740,{httpResponseCode:[2,s],params:[3,c],queryType:[1,Qn]},[1,1,1],"regular"],StickerDailyAggregatedEvent:[2884,{stickerAddToFavoriteCount:[11,s],stickerMakerCreates:[16,s],stickerMakerSends:[17,s],stickerPackDeleteCount:[12,s],stickerPickerOpenedCount:[13,s],stickerSearchOpenedCount:[14,s],stickerSendCount:[1,s],stickerSendCountForward:[6,s],stickerSendCountIsAnimated:[9,s],stickerSendCountIsFirstParty:[8,s],stickerSendCountIsWeb:[10,s],stickerSendCountStickerPickerTabEmotion:[5,s],stickerSendCountStickerPickerTabFavorites:[3,s],stickerSendCountStickerPickerTabPack:[15,s],stickerSendCountStickerPickerTabRecents:[2,s],stickerSendCountStickerSearch:[7,s]},[1,1,1],"regular"],StickerSend:[1840,{stickerIsAnimated:[3,o],stickerIsAvatar:[6,o],stickerIsFirstParty:[2,o],stickerIsFromStickerMaker:[5,o],stickerSendMessageType:[4,Ar],stickerSendOrigin:[1,br]},[1,1,1],"regular"],StrawberryBannerEvent:[3532,{strawberryAction:[1,Pr]},[1,1,1],"private",113760892],StructuredMessageReceive:[3222,{bizPlatform:[1,I],businessOwnerJid:[2,c],messageClass:[3,Or],messageClassAttributes:[4,c],messageMediaType:[5,Ht]},[1,1,1],"private",0],TemplateTruncation:[1946,{buttonIndex:[3,s],originalLength:[2,s],templateComponent:[1,Dr]},[1,1,1],"regular"],TestAnonymousDaily:[2328,{},[1,1,1],"private",113760892],TestAnonymousDailyId:[2958,{psTestEnumField:[1,xn],psTestFloatField:[2,l]},[1,1,1],"private",248614979],TestAnonymousIdLess:[3004,{psTimeSinceLastEventInMin:[1,s]},[1,1,1],"private",0],TestAnonymousMonthlyId:[2960,{},[1,1,1],"private",191000728],TestAnonymousWeeklyId:[2956,{psTestBooleanField:[2,o],psTestStringField:[3,c],psTimeSinceLastEventInMin:[1,s]},[1,1,1],"private",42196056],UiAction:[472,{deviceCount:[5,s],participantCount:[6,s],sizeBucket:[4,mr],uiActionChatType:[7,Br],uiActionPreloaded:[2,o],uiActionT:[3,u],uiActionType:[1,Fr]},[1,1,1],"regular"],UiRevokeAction:[3298,{messageAction:[1,jr],uiRevokeActionDuration:[2,s],uiRevokeActionSessionId:[3,c]},[1,1,1],"regular"],UnknownStanza:[3448,{unknownStanzaTag:[1,c],unknownStanzaType:[2,c]},[1,1,1],"regular"],UserActivity:[1384,{userActivityBitmapHigh:[4,s],userActivityBitmapLen:[5,s],userActivityBitmapLow:[3,s],userActivitySessionCum:[7,s],userActivitySessionId:[1,c],userActivitySessionSeq:[6,s],userActivityStartTime:[2,s]},[1,1,1],"regular"],UserActivitySessionSummary:[1502,{ipStr:[7,c],userActivityDuration:[2,s],userActivityForeground:[5,s],userActivitySessionsLength:[3,s],userActivityStartTime:[1,s],userActivityTimeChange:[4,s],userSessionSummarySequence:[6,s]},[1,1,1],"regular"],UserNotice:[2472,{userNoticeContentVersion:[2,s],userNoticeEvent:[3,Jr],userNoticeId:[1,s]},[1,1,1],"regular"],UserNoticeError:[2474,{userNoticeContentVersion:[2,s],userNoticeErrorEvent:[3,qr],userNoticeId:[1,s]},[1,1,1],"regular"],VideoTranscoder:[1802,{sourceAudioBitRate:[12,l],sourceDuration:[8,u],sourceFileSize:[7,l],sourceFormat:[14,Zr],sourceFrameRate:[13,l],sourceHeight:[10,l],sourceVideoBitRate:[11,l],sourceWidth:[9,l],targetAudioBitRate:[20,l],targetDuration:[16,u],targetFileSize:[15,l],targetFormat:[22,ei],targetFrameRate:[21,l],targetHeight:[18,l],targetVideoBitRate:[19,l],targetWidth:[17,l],transcoderAlgorithm:[1,Qr],transcoderContainsVideocomposition:[5,o],transcoderHasEdits:[6,o],transcoderIsPassthrough:[4,o],transcoderResult:[2,Xr],transcoderT:[3,u]},[1,1,1],"regular"],ViewBusinessProfile:[1522,{bizFbSize:[9,Ur],bizIgSize:[10,Ur],businessProfileJid:[3,c],catalogSessionId:[6,c],hasCoverPhoto:[12,o],isProfileLinked:[11,o],isSelfView:[7,o],linkedAccount:[5,H],profileEntryPoint:[8,Rn],scrollDepth:[4,s],viewBusinessProfileAction:[1,ni],websiteSource:[2,Ni]},[1,1,1],"regular"],ViewOnceScreenshotActions:[3606,{isAGroup:[1,o],threadId:[2,c],voMessageType:[3,ii],voSsAction:[4,ai]},[1,1,1],"regular"],VnameCertHealthEvent:[1890,{vnameCertHealthEventType:[2,ri]},[1,1,1],"regular"],WaShopsManagement:[2908,{isShopsProductPreviewVisible:[2,o],shopsManagementAction:[1,_r],shopsSellerJid:[3,c]},[1,1,1],"regular"],WamTestAnonymous0:[2240,{testAnonymousChatdConnectivity:[2,o],wamTestAnonymous0Field0:[1,c]},[1,1,1],"private",113760892],WebWamForceFlush:[3264,{},[1,1,1],"regular"],WebcAbpropsValidation:[2802,{abpropName:[1,c],abpropValue:[2,c],serverPropName:[3,c],serverPropValue:[4,c]},[1,1,1],"regular"],WebcAssetLoad:[1358,{webcAssetCacheType:[4,ui],webcAssetFromCache:[2,o],webcAssetLoadT:[3,u],webcAssetName:[1,c],webcAssetSize:[5,l]},[1,1,1],"regular"],WebcChatOpen:[864,{webcChatOpenBeforePaintT:[7,u],webcChatOpenPaintedT:[6,u],webcChatOpenT:[2,u],webcFinalRenderedMessageCount:[5,s],webcRenderedMessageCount:[4,s],webcUnreadCount:[1,l],webcWindowHeightFloat:[8,l]},[1,1,1],"regular"],WebcCpu:[3e3,{cpuSessionSeconds:[2,s],ftsIndexInProgess:[3,o],logInterval:[4,s],percentCpuUsage:[1,s]},[1,1,1],"regular"],WebcDbOpen:[1940,{webcDbName:[1,c],webcDbOpenNumAttempts:[3,s],webcDbOpenWasSuccess:[2,o]},[1,1,1],"regular"],WebcEmojiOpen:[1166,{webcEmojiOpenTab:[1,c]},[1,1,1],"regular"],WebcFingerprint:[1704,{webcCanvasFingerprint:[25,c],webcDocumentDriverEvaluate:[9,o],webcDocumentDriverUnwrapped:[7,o],webcDocumentElementAttrDriver:[14,o],webcDocumentElementAttrSelenium:[12,o],webcDocumentElementAttrWebdriver:[13,o],webcDocumentFxdriverEvaluate:[6,o],webcDocumentFxdriverUnwrapped:[11,o],webcDocumentSeleniumEvaluate:[2,o],webcDocumentSeleniumUnwrapped:[10,o],webcDocumentWebdriverEvaluate:[1,o],webcDocumentWebdriverScriptFn:[5,o],webcDocumentWebdriverScriptFunc:[4,o],webcDocumentWebdriverScriptFunction:[3,o],webcDocumentWebdriverUnwrapped:[8,o],webcWebglFingerprint:[24,c],webcWebglRenderer:[23,c],webcWebglVendor:[22,c],webcWindowSeleniumIdeRecorder:[20,o],webcWindowCallphantom:[18,o],webcWindowCallselenium:[19,o],webcWindowNavigatorWebdriver:[21,Ri],webcWindowNightmare:[16,o],webcWindowPhantom:[15,o],webcWindowSelenium:[17,o]},[1,1,1],"regular"],WebcImgError:[1700,{webcImgErrorCode:[1,l]},[1,1,1],"regular"],WebcJobInfo:[3054,{jobName:[1,c],jobPriority:[2,c],jobResultType:[5,fi],pendingJobsCount:[4,s],scenario:[3,Ci],webcJobAddedT:[6,s],webcJobCompletedT:[8,s],webcJobStartedT:[7,s]},[1,1,1],"regular"],WebcLogin:[1664,{webcBrowserNetworkType:[14,c],webcBrowserStorageQuotaBytes:[15,s],webcBrowserStorageQuotaUsedBytes:[16,s],webcLoginT:[3,u],webcPersistentLoginEnabled:[17,o],webcQrCodes:[1,s],webcQrLoadT:[2,u],webcSyncChatCount:[8,s],webcSyncChatSize:[10,s],webcSyncChatT:[9,u],webcSyncContactCount:[11,s],webcSyncContactSize:[13,s],webcSyncContactT:[12,u],webcSyncMessageCount:[5,s],webcSyncMessageSize:[7,s],webcSyncMessageT:[6,u],webcSyncT:[4,u]},[1,1,1],"regular"],WebcMediaAnalyzed:[912,{webcMediaAnalyzeT:[3,u],webcMediaExtensions:[2,c],webcMediaSupported:[1,o]},[1,1,1],"regular"],WebcMediaEditorSend:[2890,{editedImageCount:[2,s],emojiLayerCount:[5,s],imageCount:[1,s],paintedImageCount:[3,s],stickerLayerCount:[6,s],textLayerCount:[4,s]},[1,1,1],"regular"],WebcMediaErrorUnknownDetails:[2352,{mediaId:[1,s],webcMediaErrorMessage:[4,c],webcMediaErrorName:[3,c],webcMediaOperation:[2,hi]},[1,1,1],"regular"],WebcMediaLoad:[1202,{webcMediaLoadResult:[2,_i],webcMediaLoadT:[1,u]},[1,1,1],"regular"],WebcMediaRmr:[1906,{messageMediaType:[10,Ht],webcBrowserNetworkType:[2,c],webcBrowserStorageQuotaBytes:[11,s],webcBrowserStorageQuotaUsedBytes:[12,s],webcChatPosition:[1,s],webcChatType:[9,di],webcMediaRmrError:[8,o],webcMediaRmrT:[6,u],webcMediaSize:[7,s],webcMessageIndex:[3,s],webcMessageT:[5,u],webcRmrReason:[14,Ti],webcRmrStatusCode:[13,s]},[1,1,1],"regular"],WebcMemoryStat:[1188,{hasVerifiedNumber:[12,o],jsHeapSizeLimit:[9,s],numMessages:[8,l],totalJsHeapSize:[10,s],uptime:[6,l],usedJsHeapSize:[11,s]},[1,1,1],"regular"],WebcMenu:[2504,{webcMenuAction:[2,mi],webcMenuItemLabel:[3,gi]},[1,1,1],"regular"],WebcMessageQuery:[1876,{webcAudioMessageCount:[14,s],webcBrowserNetworkType:[1,c],webcBrowserStorageQuotaBytes:[20,s],webcBrowserStorageQuotaUsedBytes:[21,s],webcChatPosition:[2,s],webcChatType:[13,di],webcDocumentMessageCount:[16,s],webcEarliestMessageIndex:[11,s],webcEarliestMessageT:[12,u],webcMessageCount:[4,s],webcMessageQueryTrigger:[19,vi],webcMessageQueryType:[3,yi],webcOtherMessageCount:[18,s],webcPhotoMessageCount:[7,s],webcPttMessageCount:[15,s],webcQueryT:[9,u],webcResponseBytes:[10,s],webcStickerMessageCount:[17,s],webcTextMessageCount:[5,s],webcVideoMessageCount:[6,s]},[1,1,1],"regular"],WebcMessageSend:[2072,{messageIsForward:[3,o],messageMediaType:[2,Ht],messageSendT:[4,u],messageType:[1,Jt]},[1,1,1],"regular"],WebcOfflineResume:[2628,{chatThreadCount:[9,s],decryptErrorCount:[4,s],isOfflineCompleteMissed:[11,o],offlineMessageCount:[2,s],offlineNotificationCount:[12,s],offlineReceiptCount:[3,s],offlineSizeBytes:[8,s],webcLastStanzaT:[10,u],webcMainScreenLoadT:[7,u],webcOfflinePreviewT:[6,u],webcPageLoadT:[1,u],webcSocketConnectT:[5,u]},[1,1,1],"regular"],WebcPageLoad:[642,{webcAppcacheStatus:[29,ci],webcCached:[30,o],webcConnectEnd:[10,u],webcConnectStart:[9,u],webcDomComplete:[19,u],webcDomContentLoadedEventEnd:[18,u],webcDomContentLoadedEventStart:[17,u],webcDomInteractive:[16,u],webcDomLoading:[15,u],webcDomainLookupEnd:[8,u],webcDomainLookupStart:[7,u],webcExeDone:[23,u],webcExeStart:[22,u],webcFetchStart:[6,u],webcInitialMountT:[38,u],webcInitialNavMountT:[39,u],webcInitialPanel:[42,c],webcInitialPanelMountStartT:[43,u],webcInitialPanelMountT:[40,u],webcInitialPanelRenderT:[46,u],webcJsLoadT:[37,u],webcLoadEventEnd:[21,u],webcLoadEventStart:[20,u],webcLoadInForeground:[53,o],webcMainScriptEnd:[45,u],webcMainScriptStart:[44,u],webcNativeLoadT:[36,u],webcNavigation:[32,Si],webcPageLoadT:[34,u],webcParallellyFetched:[41,o],webcQrCode:[31,o],webcRedirectCount:[33,l],webcRedirectEnd:[5,u],webcRedirectStart:[4,u],webcRequestStart:[12,u],webcResponseEnd:[14,u],webcResponseStart:[13,u],webcSecureConnectionStart:[11,u],webcUnloadEventEnd:[3,u],webcUnloadEventStart:[2,u],webcWsAttempts:[28,l],webcWsNormal:[27,u],webcWsOpening:[24,u],webcWsPairing:[25,u],webcWsSyncing:[26,u]},[1,1,1],"regular"],WebcPageResume:[884,{webcResumeCount:[1,s]},[1,1,1],"regular"],WebcPhoneDisconnected:[878,{webcPhoneBbarShownT:[2,u],webcPhoneDisconnectedT:[1,u]},[1,1,1],"regular"],WebcProgressiveImage:[2226,{webcFirstRenderScans:[1,s],webcFirstRenderT:[2,u],webcFullQualityT:[4,u],webcMidQualityT:[3,u]},[1,1,10],"regular"],WebcQplHealth:[3134,{webcQplHealthEventData:[1,c],webcQplHealthEventType:[2,Ei]},[1,1,1],"regular"],WebcRawPlatforms:[2416,{webcRawPlatform:[1,c]},[1,1,1],"regular"],WebcResourceLoad:[688,{webcResourceCached:[3,o],webcResourceDuration:[2,u],webcResourceName:[1,c]},[1,1,1],"regular"],WebcStatusSession:[1880,{webcStatusMutedItemCount:[4,s],webcStatusMutedRowCount:[7,s],webcStatusRecentItemCount:[2,s],webcStatusRecentRowCount:[5,s],webcStatusSessionId:[1,s],webcStatusViewedItemCount:[3,s],webcStatusViewedRowCount:[6,s]},[1,1,1],"regular"],WebcStatusSync:[1878,{webcStatusMutedItemCount:[4,s],webcStatusMutedRowCount:[7,s],webcStatusRecentItemCount:[2,s],webcStatusRecentRowCount:[5,s],webcStatusSyncT:[1,u],webcStatusViewedItemCount:[3,s],webcStatusViewedRowCount:[6,s]},[1,1,1],"regular"],WebcStatusView:[1882,{webcIsPosterBiz:[11,o],webcIsPostersAddressBook:[12,o],webcStatusLoadT:[6,u],webcStatusLoaded:[4,o],webcStatusMediaType:[5,Ai],webcStatusPlaybackT:[8,u],webcStatusReplyCount:[9,s],webcStatusRowIndex:[3,s],webcStatusRowSection:[2,bi],webcStatusSessionId:[1,s],webcStatusUnread:[10,o],webcStatusViewT:[7,u]},[1,1,1],"regular"],WebcStickerMakerEvents:[3104,{stickerMakerEventName:[1,Pi]},[1,1,1],"regular"],WebcStorageStat:[1504,{webcStorageQuota:[2,s],webcStorageUsage:[1,s]},[1,1,1],"regular"],WebcStreamModeChange:[770,{webcStreamMode:[1,Oi]},[1,1,1],"regular"],WebcUiFreeze:[1836,{webcUiFreezeFps:[1,l],webcUiFreezeT:[2,u]},[1,1,1],"regular"],WebcWapRequest:[2006,{webcWapRequestAckT:[3,u],webcWapRequestDestination:[6,Mi],webcWapRequestKind:[5,Ii],webcWapRequestName:[8,c],webcWapRequestRecvT:[4,u],webcWapRequestResponseSize:[2,s],webcWapRequestSize:[7,s],webcWapRequestStatus:[9,s]},[1,1,10],"regular"]});var xi=(0,i.default)((0,i.default)({},a.events),{METRICS:a.metrics,Global:Gi,WamEvent:a.WamEvent,PrivateStatsAllIds:[{key:"DefaultPsId",keyHashInt:113760892,rotationPeriodDays:-1},{key:"IdPreMetrics",keyHashInt:56300709,rotationPeriodDays:-1},{key:"IdTtl90Days",keyHashInt:37887164,rotationPeriodDays:90},{key:"IdTtlDaily",keyHashInt:248614979,rotationPeriodDays:1},{key:"IdTtlMonthly",keyHashInt:191000728,rotationPeriodDays:30},{key:"IdTtlWeekly",keyHashInt:42196056,rotationPeriodDays:7}],ACTION:d,ADV_DECODE_ERROR_TYPE:p,ADV_DECODE_PROTO_TYPE:f,AEC_MODE:_,AGC_MODE:h,ANDROID_CAMERA2_SUPPORT_LEVEL:g,ANDROID_CAMERA_API:m,ANDROID_KEYSTORE_STATE_TYPE:y,APP_BUILD_TYPE:S,APPLICATION_STATE:E,AUDIO_ENGINE_TYPE:v,AUTO_REPLY_ACTION:T,BACKEND_STORE_TYPE:C,BACKUP_NETWORK_SETTING:A,BACKUP_SCHEDULE:b,BANNER_OPERATIONS:P,BANNER_TYPES:O,BIZ_CATALOG_TYPE:M,BIZ_PLATFORM:I,BLOCK_ENTRY_POINT:w,BLOCK_REASON:R,BOOTSTRAP_APP_STATE_DATA_STAGE_CODE:N,BUSINESS_INTERACTION_ACTION_TYPE:L,BUSINESS_INTERACTION_ENTRY_POINT_APP:D,BUSINESS_INTERACTION_ENTRY_POINT_SOURCE:k,BUSINESS_INTERACTION_INTERNAL_ENTRY_POINT:U,BUSINESS_INTERACTION_TARGET_SCREEN_TYPE:G,BUSINESS_PREVIEW_ACTION_TYPE:x,BUSINESS_PROFILE_ENTRY_POINT:B,BUSINESS_PROFILE_FIELD:F,BUSINESS_PROFILE_VIEW_ACTION:j,BUSINESS_PROFILE_WEBSITE_SOURCE_TYPE:Y,BUSINESS_TOOLS_ENTRY_POINT_TYPE:K,BUSINESS_TOOLS_ITEM_TYPE:W,BUSINESS_TOOLS_LINKED_ACCOUNT_TYPE:H,CADMIN_DEMOTE_ORIGIN_TYPE:V,CADMIN_DEMOTE_RESULT_TYPE:$,CALL_FROM_UI:z,CALL_NETWORK_MEDIUM:q,CALL_RELAY_BIND_STATUS:J,CALL_RESULT_TYPE:Q,CALL_SEGMENT_TYPE:X,CALL_SETUP_ERROR_TYPE:Z,CALL_SIDE:ee,CALL_TERM_REASON:te,CALL_TRANSPORT_TYPE:ne,CALL_VIDEO_STATE:re,CALL_WAKEUP_SOURCE:ie,CAMERA_PREVIEW_MODE:ae,CAMERA_START_MODE_PARAMS:oe,CATALOG_BIZ_ACTION:se,CATALOG_ENTRY_POINT:le,CATALOG_VIEW_ACTION:ce,CATEGORY_BROWSING_ENTRY_POINT:ue,CATEGORY_TYPE:de,CHAT_COMPOSER_ACTION_TARGETS:pe,CHAT_COMPOSER_ACTION_TYPES:fe,CHAT_FILTER_ACTION_TYPES:_e,CHAT_FILTER_TARGET_SCREEN:he,CHAT_FILTER_TYPES:ge,CHAT_GATED_REASON:me,CHAT_MUTED_TYPE:ye,CHAT_SEARCH_RESULT_TYPE:Se,CHAT_TYPE:Ee,CLICKABLE_EVENT:ve,CLIENT_GROUP_SIZE_BUCKET:Te,CLIENT_MESSAGE_SEND_STAGE:Ce,COLLECTION:Ae,COMMERCE_ACTION:be,COMMERCE_ENTRY_POINT:Pe,COMMERCE_PERF_ENTRY_POINT:Oe,COMMERCE_PERF_MARKER:Me,COMMERCE_PERF_VIEW:Ie,COMMUNITY_CREATION_ACTION_TAKEN_TYPE:we,COMMUNITY_CREATION_CURRENT_SCREEN_TYPE:Re,CONNECTION_ORIGIN_TYPE:Ne,CONNECTION_TYPE:Le,CONTACT_SEND_CHANNEL:De,CONTACT_US_EXIT_STATE:ke,CRASH_TYPE:Ue,CTA_FALLBACK_REASON:Ge,CTA_TYPE:xe,CTWA_USER_JOURNEY_OPERATION_TYPE:Be,DEEP_LINK_ACTION:Fe,DEEP_LINK_OPEN_FROM:je,DEEP_LINK_TYPE:Ye,DESTINATION:Ke,DEVICE_TYPE:We,DISAPPEARING_CHAT_INITIATOR_TYPE:He,DISAPPEARING_MODE_ENTRY_POINT_TYPE:Ve,DISAPPEARING_MODE_SETTING_EVENT_NAME_TYPE:$e,DM_CHAT_PICKER_ENTRY_POINT_TYPE:ze,DM_CHAT_PICKER_EVENT_NAME_TYPE:qe,DOWNLOAD_ORIGIN_TYPE:Je,DOWNLOAD_QUALITY_TYPE:Qe,DSM_ERROR:Xe,E2E_CIPHERTEXT_TYPE:Ze,E2E_DESTINATION:et,E2E_FAILURE_REASON:tt,E2E_SENDER_TYPE:nt,E2EE_SIZE_BUCKET:rt,EDIT_PROFILE_ACTION:it,END_CALL_CONFIRMATION_TYPE:at,EPHEMERAL_SETTING_ENTRY_POINT_TYPE:ot,ERROR_REASON:st,EXPIRY_REASON:lt,FIELD_STATS_ROW_TYPE:ct,FORCE_UPGRADE_USER_ACTION_TYPE_V2:ut,GA_STATUS:dt,GIF_SEARCH_PROVIDER:pt,GRAPHQL_CATALOG_ENDPOINT:ft,GRAPHQL_REQUEST_RESULT:_t,HIGHLIGHT_SURFACE:ht,INCOMING_CALL_UI_ACTION_TYPE:gt,INIT_BWE_SOURCE:mt,INTERACTION_TYPE:yt,KIC_ACTION_NAME_TYPE:St,KIC_ACTOR_TYPE:Et,KIC_ENTRY_POINT_TYPE:vt,KIC_ERROR_CODE_TYPE:Tt,KIC_NUX_ACTION_NAME_TYPE:Ct,KIC_REQUEST_TYPE_TYPE:At,LABEL_OPERATIONS:bt,LABEL_TARGETS:Pt,LOADING_MESSAGE_TYPE_SHOWN:Ot,LOGIN_RESULT_TYPE:Mt,MD_APP_STATE_KEY_ROTATION_REASON_CODE:It,MD_BOOTSTRAP_HISTORY_PAYLOAD_TYPE:wt,MD_BOOTSTRAP_PAYLOAD_TYPE:Rt,MD_BOOTSTRAP_SOURCE:Nt,MD_BOOTSTRAP_STEP_RESULT:Lt,MD_FEATURE_CODE:Dt,MD_LINK_DEVICE_COMPANION_STAGE:kt,MD_PUSHNAME_VALIDATION_STAGE_CODE:Ut,MD_SYNCD_CRITICAL_EVENT_CODE:Gt,MD_SYNCD_FATAL_ERROR_CODE:xt,MD_SYNCD_FATAL_ERROR_SOURCE:Bt,MD_VALIDATION_CALLER_CHANNEL:Ft,MD_VALIDATION_WEB_PLATFORM:jt,MEDIA_DOWNLOAD_MODE_TYPE:Yt,MEDIA_DOWNLOAD_RESULT_TYPE:Kt,MEDIA_PICKER_ORIGIN_TYPE:Wt,MEDIA_TYPE:Ht,MEDIA_UPLOAD_MODE_TYPE:Vt,MEDIA_UPLOAD_RESULT_TYPE:$t,MESSAGE_CHAT_TYPE:zt,MESSAGE_SEND_RESULT_TYPE:qt,MESSAGE_TYPE:Jt,MISSING_PROTO_TYPE:Qt,MULTIDEVICE_ACTION_TYPE:Xt,MUTATION_COUNT_BUCKET:Zt,NETWORK_STACK_TYPE:en,NOTIFICATION_SETTING_TYPE:tn,NS_MODE:nn,OFFLINE_RESUME_STAGES:rn,OPTIMISTIC_FLAG_TYPE:an,ORDER_DETAILS_CREATION_ACTION:on,OTP_ENTRY_POINT:sn,OTP_EVENT_SOURCE:ln,OTP_EVENT_TYPE:cn,OTP_PRODUCT_TYPE:un,OVERALL_LAST_UPLOAD_RETRY_PHASE_TYPE:dn,OVERALL_MEDIA_KEY_REUSE_TYPE:pn,OWNER_TYPE:fn,PEER_CALL_NETWORK_MEDIUM:_n,PHONE_NUM_HYPERLINK_ACTION_TYPE:hn,PLACEHOLDER_ACTION:gn,PLACEHOLDER_CHAT_TYPE:mn,PLACEHOLDER_REASON_TYPE:yn,PLACEHOLDER_TYPE:Sn,PLATFORM_TYPE:En,PLAYBACK_ORIGIN_TYPE:vn,PLAYBACK_STATE_TYPE:Tn,PRECISE_SIZE_BUCKET:Cn,PREFERRED_LINK_TYPE:An,PREKEYS_FETCH_CONTEXT:bn,PRIMARY_IDENTITY_MISSING_PROTO_TYPE:Pn,PRIVACY_HIGHLIGHT_CATEGORY_ENUM:On,PRIVACY_HIGHLIGHT_SURFACE_ENUM:Mn,PRIVACY_SETTINGS_CONTACTS_BUCKETS:In,PRIVACY_SETTINGS_VALUE_TYPE:wn,PROFILE_ENTRY_POINT:Rn,PROJECT_CODE:Nn,PS_APP_LAUNCH_DESTINATION_TYPE:Ln,PS_APP_LAUNCH_TYPE:Dn,PS_BUFFER_UPLOAD_RESULT:kn,PS_CRASH_TYPE:Un,PS_ID_ACTION:Gn,PS_TEST_ENUM_FIELD:xn,PS_TOKEN_NOT_READY_REASON:Bn,PS_UPLOAD_REASON:Fn,PSA_LINK_OPEN_RESULT:jn,PSA_MESSAGE_ACTION_TYPE:Yn,PSA_MESSAGE_REMOVE_ACTION:Kn,PSA_MESSAGE_REMOVE_ENTRY_POINT:Wn,PTT_PLAYBACK_SPEED_TYPE:Hn,PTT_PLAYER_TYPE:Vn,PTT_RESULT_TYPE:$n,PTT_SOURCE_TYPE:zn,PTT_STREAM_TYPE:qn,PTT_TRIGGER_TYPE:Jn,QUERY_TYPE:Qn,QUICK_REPLY_ACTION:Xn,QUICK_REPLY_ENTRY_POINT:Zn,QUICK_REPLY_ORIGIN:er,QUICK_REPLY_TRANSCODE_RESULT:tr,RADIO_TYPE:nr,REACTION_ACTION_TYPE:rr,READ_ENTRY_POINT:ir,RESPONSE_TYPE:ar,RETRY_REJECT_REASON:or,REVOKE_TYPE:sr,ROOMS_ENTRY_POINT:lr,SEARCH_ENTRY_POINT:cr,SEARCH_VIEW_ACTION:ur,SENDER_TYPE:dr,SHARE_BIZ_TOOLS_LINK_TYPE:pr,SHARE_BUSINESS_ACTION_TYPE:fr,SHOPS_MANAGEMENT_ACTION:_r,SIGN_CREDENTIAL_RESULT:hr,SIGNATURE_TYPE:gr,SIZE_BUCKET:mr,SRTP_LIBRARY_VERSION:yr,STATUS_ITEM_VIEW_RESULT:Sr,STATUS_REPLY_MESSAGE_TYPE:Er,STATUS_REPLY_RESULT:vr,STATUS_ROW_ENTRY_METHOD:Tr,STATUS_ROW_SECTION:Cr,STICKER_SEND_MESSAGE_TYPE:Ar,STICKER_SEND_ORIGIN_TYPE:br,STRAWBERRY_ACTION_TYPE:Pr,STRUCTURED_MESSAGE_CLASS:Or,SUBSCRIBER_TYPE:Mr,SUBSCRIPTION_APP_STORE_RESULT:Ir,SUBSCRIPTION_ENTRY_POINT:wr,SUBSCRIPTION_ERROR_TYPE:Rr,SUBSCRIPTION_TYPE:Nr,SW_AEC_TYPE:Lr,TEMPLATE_COMPONENT:Dr,TRIGGER_TYPE:kr,TRUST_SIGNAL_BUCKETS:Ur,TS_LOG_UPLOAD_RESULT:Gr,TYPE_OF_GROUP_ENUM:xr,UI_ACTION_CHAT_TYPE:Br,UI_ACTION_TYPE:Fr,UI_REVOKE_ACTION_TYPE:jr,UPLOAD_ORIGIN_TYPE:Yr,UPLOAD_SOURCE_TYPE:Kr,UPNP_ADD_RESULT_CODE:Wr,UPNP_REMOVE_RESULT_CODE:Hr,URL_STATUS_CLICKED:Vr,URL_STATUS_TYPE:$r,USER_ACTION_TYPE:zr,USER_NOTICE_ERROR_EVENT:qr,USER_NOTICE_EVENT:Jr,VIDEO_TRANSCODER_ALGORITHM_TYPE:Qr,VIDEO_TRANSCODER_RESULT_TYPE:Xr,VIDEO_TRANSCODER_SOURCE_FORMAT_TYPE:Zr,VIDEO_TRANSCODER_TARGET_FORMAT_TYPE:ei,VIEW_ACTION:ti,VIEW_BUSINESS_PROFILE_ACTION:ni,VNAME_CERT_HEALTH_EVENT_TYPE:ri,VO_MESSAGE_TYPE:ii,VO_SS_ACTION:ai,VPX_LIB:oi,WA_OFFICIAL_ACCOUNT_NAME:si,WA_VOIP_HISTORY_SAVE_CALL_RECORD_CONDITION_CHECK_STATUS:li,WEBC_APPCACHE_STATUS_CODE:ci,WEBC_ASSET_CACHE_TYPE_CODE:ui,WEBC_CHAT_TYPE:di,WEBC_ENV_CODE:pi,WEBC_JOB_RESULT_TYPE_CODE:fi,WEBC_MEDIA_LOAD_RESULT_CODE:_i,WEBC_MEDIA_OPERATION_CODE:hi,WEBC_MENU_ITEM_LABEL:gi,WEBC_MENU_TYPE:mi,WEBC_MESSAGE_QUERY_DIRECTION:yi,WEBC_NAVIGATION_TYPE:Si,WEBC_QPL_HEALTH_EVENT_TYPE:Ei,WEBC_QUERY_TRIGGER_TYPE:vi,WEBC_RMR_REASON_CODE:Ti,WEBC_SCENARIO_TYPE:Ci,WEBC_STATUS_MEDIA_TYPE:Ai,WEBC_STATUS_ROW_SECTION:bi,WEBC_STICKER_MAKER_EVENT_NAME_TYPE:Pi,WEBC_STREAM_MODE_CODE:Oi,WEBC_WAP_REQUEST_DESTINATION_CODE:Mi,WEBC_WAP_REQUEST_KIND_CODE:Ii,WEBC_WEB_PLATFORM_TYPE:wi,WEBC_WINDOW_NAVIGATOR_WEBDRIVER_TYPE:Ri,WEBSITE_SOURCE_TYPE:Ni,WELCOME_MESSAGE_ACTION_TYPE:Li,WELCOME_MESSAGE_ERROR_TYPE:Di,XMPP_STATUS:ki,XOR_CIPHER_MODE:Ui});t.default=xi},552211:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WamEvent=t.TYPES=t.Metric=t.GlobalMetric=void 0,t.defineEvents=function(e){for(const n in e){var t;const r=e[n],i=r[2];let a=1;a=i[2];const o=null!==(t=r[3])&&void 0!==t?t:"regular",s=5===r.length?r[4]:-1;E({name:n,id:r[0],props:r[1],weight:a,wamChannel:o,privateStatsIdInt:s})}},t.defineGlobal=function(e){const t={};for(const n in e){const r=e[n],[i,a,o=["regular"]]=r,s=g.defineGlobal(n,i,a,o);t[n]={type:s.validator,set(e){this.commitOnSet&&(d?d.set(s,e):p(s,e))}}}return new((0,l.defineTypeHash)("Global",t,v))},t.metrics=t.events=void 0,t.setWamImpl=function(e){d=e,u.map((e=>{if(e[0]){const t=e[1];d.commit(t,!!e[2])}else{const t=e[1];d.set(t,e[2])}}))};var i=r(n(722205)),a=r(n(711700)),o=r(n(163137)),s=r(n(145095)),l=(n(243840),n(936737));const c=Object.freeze({BOOLEAN:"boolean",INTEGER:"integer",NUMBER:"number",STRING:"string",TIMER:"timer"});t.TYPES=c;const u=[];let d;function p(e,t){u.push([!1,e,t])}function f(e){return"number"==typeof e&&e===Math.floor(e)}class _{constructor(e,t,n){this.name=e,this.id=t,this.type=n,this.setValidator()}setValidator(){const e=this.type;if("object"==typeof e){const t=(0,o.default)(e);this.validator=e=>e in t}else e===c.INTEGER||e===c.TIMER?this.validator=f:this.validator=e}}t.Metric=_;class h extends _{constructor(e,t,n,r){super(e,t,n),this.channels=r}}t.GlobalMetric=h;const g=new class{constructor(){this._events={},this._globalMetrics=new Map}_key(e,t){return`${e}::${t}`}getEvent(e,t){const n=this._key(e,t);return(0,s.default)(this._events[n],n)}define(e,t,n,r){const i=this._key(e,t);return i in this._events||(this._events[i]=new _(t,n,r)),this._events[i]}defineGlobal(e,t,n,r){return this._globalMetrics.has(e)||this._globalMetrics.set(e,new h(e,t,n,r)),(0,s.default)(this._globalMetrics.get(e),e)}getGlobal(e){return(0,s.default)(this._globalMetrics.get(e),e)}};t.metrics=g;let m=1;class y extends l.TypeHash{constructor(){super(),this.instanceId=m++,this.eventTime=Date.now(),this.commitTime=void 0,this.startMarkers={}}commit(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return d?d.commit(this,e):(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.push([!0,e,t])}(this,e),Promise.resolve())}setTime(e){this.eventTime=e||Date.now()}setSequenceNumber(e){this.sequenceNumber=e}}t.WamEvent=y;const S={};function E(e){let{name:t,id:n,weight:r,props:o,wamChannel:s,privateStatsIdInt:u}=e;const d={id:n,weight:r,wamChannel:s,privateStatsIdInt:u},p={},f=[];for(const e in o){const n=o[e],r=g.define(t,e,n[0],n[1]);p[e]=r.validator,n[1]===c.TIMER&&f.push(e)}const _=(0,l.defineTypeHash)(t,p,y);f.forEach((e=>{d["mark"+(0,a.default)(e)]=function(t){var n,r;const{startMarkers:i,eventTime:a}=this;this[e]=Date.now()-(null!==(n=null===(r=i[e])||void 0===r?void 0:r.ts)&&void 0!==n?n:a),null==t||t.showInTimeline,this.startMark},d[`start${(0,a.default)(e)}`]=function(t){const n=Date.now();this.startMarkers[e]={ts:n},null==t||t.showInTimeline}})),(0,i.default)(_.prototype,d),S[t]=_}t.events=S;class v extends l.TypeHash{constructor(){super(...arguments),this.commitOnSet=!0}}},757362:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<=33?a.SMALL:e<=65?a.MEDIUM:e<=129?a.LARGE:e<=257?a.EXTRA_LARGE:e<=513?a.XX_LARGE:e<=1001?a.XXX_LARGE:e<=1501?a.LT1500:e<=2001?a.LT2000:e<=2501?a.LT2500:e<=3001?a.LT3000:e<=3501?a.LT3500:e<=4001?a.LT4000:e<=4501?a.LT4500:e<=5001?a.LT5000:a.LARGEST_BUCKET};var i=r(n(11339));const{CLIENT_GROUP_SIZE_BUCKET:a}=i.default},616786:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e<32?a.LT32:e<64?a.LT64:e<128?a.LT128:e<256?a.LT256:e<512?a.LT512:e<1e3?a.LT1000:e<1500?a.LT1500:e<2e3?a.LT2000:e<2500?a.LT2500:e<3e3?a.LT3000:e<3500?a.LT3500:e<4e3?a.LT4000:e<4500?a.LT4500:e<5e3?a.LT5000:a.LARGEST_BUCKET};var i=r(n(11339));const{SIZE_BUCKET:a}=i.default},797480:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineResumeReporter=void 0;var i=n(787614),a=n(451897),o=n(892844),s=n(257243),l=n(665397),c=n(669393),u=n(711597),d=r(n(11339));class p{start(){(0,s.getABPropConfigValue)("web_offline_resume_qpl_enabled")&&(this._qplEvent=c.QPL.markerStart(l.QuickLogMarkerId.OFFLINE_RESUME))}end(){var e;null===(e=this._qplEvent)||void 0===e||e.end(a.QuickLogActionType.SUCCESS)}drop(){var e;null===(e=this._qplEvent)||void 0===e||e.drop()}_addPoint(e,t){var n;const r=null!=t?{data:t}:{};null===(n=this._qplEvent)||void 0===n||n.addPoint(e,r)}markOfflinePreviewReceived(){this._addPoint("offlinePreviewReceived")}markMainScreenLoad(){this._addPoint("mainScreenLoad")}markSocketConnect(){this._addPoint("socketConnect")}setAnnotations(e){var t;null===(t=this._qplEvent)||void 0===t||t.annotate({int:{messageCount:e.messageCount,receiptCount:e.receiptCount,notificationCount:e.notificationCount,sizeBytes:e.sizeBytes,chatThreadCount:e.chatThreadCount,decryptErrorCount:e.decryptErrorCount}})}}class f{constructor(){this._sessionId=this._generateOfflineSessionId(),this._pageLoadT=performance.now()}_generateOfflineSessionId(){return`${(0,i.randomHex)(4)}${(0,o.unixTimeWithoutClockSkewCorrection)()}`}_commitOfflineStage(e){new d.default.OfflineResumeStage({offlineSessionId:this._sessionId,offlineStageTimestampMs:Math.floor(performance.now()-this._pageLoadT),currentOfflineStage:e}).commit()}logPageLoad(){this._pageLoadT=performance.now()}logSocketConnect(){this._commitOfflineStage(d.default.OFFLINE_RESUME_STAGES.SOCKET_CONNECT)}logProcessComplete(){this._commitOfflineStage(d.default.OFFLINE_RESUME_STAGES.PROCESS_COMPLETE)}logScreenLoad(){this._commitOfflineStage(d.default.OFFLINE_RESUME_STAGES.SCREEN_LOAD)}}const _=new class{constructor(){this.isInitialSync=!1,this.oldestStanzaTs=0,this.offlineResume=new d.default.OfflineResume,this.offlineResume.offlineMessageCount=0,this.offlineResume.offlineReceiptCount=0,this.offlineResume.offlineNotificationCount=0,this.offlineResume.offlineDecryptErrorCount=0,this.offlineResume.offlineSizeBytes=0,this.offlineResume.chatThreadCount=0,this.offlineResume.isOfflineCompleteMissed=!1,this.qpl=new p,this.offlineStage=new f}roundUp(e,t){return Math.round(e/t)*t}logOldestStanzaTime(e){null!=this.offlineResume&&(0===this.oldestStanzaTs||this.oldestStanzaTs>e)&&(this.oldestStanzaTs=e)}countDays(){if(null==this.offlineResume||0===this.oldestStanzaTs)return 0;const e=(0,o.unixTime)()-this.oldestStanzaTs;return Math.round(e/o.DAY_SECONDS)}logOfflineCount(e){this.offlineResume&&(this.offlineResume.offlineMessageCount+=e.message,this.offlineResume.offlineReceiptCount+=e.receipt,this.offlineResume.offlineNotificationCount+=e.notification)}logOfflineDecryptionErrorCount(e){this.offlineResume&&(this.offlineResume.offlineDecryptErrorCount=e)}logAddOfflineSizeBytes(e){this.offlineResume&&(this.offlineResume.offlineSizeBytes+=e)}logOfflineChatThreadCount(e){const t=this.roundUp(e,10);this.offlineResume&&(this.offlineResume.chatThreadCount=t)}_logPerformanceT(e){const t=Math.floor(performance.now());null!=this.offlineResume&&(this.offlineResume[e]=t)}logLastStanzaT(){this._logPerformanceT("lastStanzaT"),this.isInitialSync||this.offlineStage.logProcessComplete()}logMainScreenLoadT(){this._logPerformanceT("mainScreenLoadT"),this.qpl.markMainScreenLoad(),this.isInitialSync||this.offlineStage.logScreenLoad()}logOfflinePreviewT(){this._logPerformanceT("offlinePreviewT"),this.qpl.markOfflinePreviewReceived()}logPageLoadT(){this.qpl.start(),this._logPerformanceT("pageLoadT"),this.offlineStage.logPageLoad(),window.document&&this.offlineResume&&(this.offlineResume.isResumeInForeground=!document.hidden,document.addEventListener("visibilitychange",this.logResumeInBackground))}logSocketConnectT(){this._logPerformanceT("socketConnectT"),this.qpl.markSocketConnect(),this.isInitialSync||this.offlineStage.logSocketConnect()}logMissedOfflineComplete(){this.offlineResume&&(this.offlineResume.isOfflineCompleteMissed=!0)}setIsInitialSync(){this.isInitialSync=!0}logResumeInBackground(){this.offlineResume&&document.hidden&&(this.offlineResume.isResumeInForeground=!1)}commit(){const e=this.offlineResume;e&&(e.offlineSizeBytes=this.roundUp(e.offlineSizeBytes,1e3),e.offlineMessageCount=this.roundUp(e.offlineMessageCount,10),e.offlineReceiptCount=this.roundUp(e.offlineReceiptCount,10),e.offlineNotificationCount=this.roundUp(e.offlineNotificationCount,10),e.mailboxAge=this.countDays(),(0,u.setRecentMailboxAgeDays)(e.mailboxAge),__LOG__(2)`======== offline resume perf ========
message: ${e.offlineMessageCount}
receipt: ${e.offlineReceiptCount}
notification: ${e.offlineNotificationCount}
chatThreadCount: ${e.chatThreadCount}
offlineSizeBytes: ${e.offlineSizeBytes}
decryptError: ${e.offlineDecryptErrorCount}
lastStanzaT: ${e.lastStanzaT}
pageLoadT: ${e.pageLoadT}
connectionT: ${e.socketConnectT}
offlinePreviewT: ${e.offlinePreviewT}
screenLoadT: ${e.mainScreenLoadT}
isResumeInForeground: ${e.isResumeInForeground}
mailboxAge: ${e.mailboxAge}
======================================`,this.isInitialSync?this.qpl.drop():(e.commit(),this.qpl.setAnnotations({messageCount:e.offlineMessageCount,receiptCount:e.offlineReceiptCount,notificationCount:e.offlineNotificationCount,chatThreadCount:e.chatThreadCount,decryptErrorCount:e.offlineDecryptErrorCount,sizeBytes:e.offlineSizeBytes}),this.qpl.end()),this.offlineResume=null,window.document&&document.removeEventListener("visibilitychange",this.logResumeInBackground))}};t.OfflineResumeReporter=_},771119:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.mainScriptTimer=t.initialScreenTimer=t.exeTimer=t.PageLoad=void 0,t.onInitialRenderComplete=function(){f()},t.saveInitialPanelMountTime=function(e){u=e},t.setInitialScreen=function(e){if(null==d)return;d.set({webcInitialPanel:e})},t.streamInfoChange=function(e,t,n){const r=Math.floor(window.performance.now());p[e]=r,n&&(p.socketSequence=t,_())};var i=r(n(145095)),a=r(n(11339)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=c(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(243840)),s=r(n(734179)),l=n(977959);function c(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(c=function(e){return e?n:t})(e)}let u,d=new a.default.WebcPageLoad;const p={};let f,_;const h=new Promise((e=>f=e)),g=new Promise((e=>_=e));let m,y=!1;function S(e){return window.performance&&window.performance.timing&&window.performance.timing.navigationStart?e-window.performance.timing.navigationStart:null}function E(){d&&document.hidden&&(m=!1)}function v(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.navigation)return void __LOG__(2)`MetricReporter:logPageLoad metrics not provided by browser!`;if(!d)return;const t=d,n=window.performance.timing,r=window.performance.navigation,i=n.navigationStart,a=n.loadEventEnd-i;if(a<=0)return __LOG__(2)`MetricReporter:logPageLoad delayed`,void setTimeout(v,1e4);function o(e){const t=n[e];return t&&S(t)}t.set({webcPageLoadT:a,webcUnloadEventStart:o("unloadEventStart"),webcUnloadEventEnd:o("unloadEventEnd"),webcRedirectStart:o("redirectStart"),webcRedirectEnd:o("redirectEnd"),webcFetchStart:o("fetchStart"),webcDomainLookupStart:o("domainLookupStart"),webcDomainLookupEnd:o("domainLookupEnd"),webcConnectStart:o("connectStart"),webcConnectEnd:o("connectEnd"),webcSecureConnectionStart:o("secureConnectionStart"),webcRequestStart:o("requestStart"),webcResponseStart:o("responseStart"),webcResponseEnd:o("responseEnd"),webcDomLoading:o("domLoading"),webcDomInteractive:o("domInteractive"),webcDomContentLoadedEventStart:o("domContentLoadedEventStart"),webcDomContentLoadedEventEnd:o("domContentLoadedEventEnd"),webcDomComplete:o("domComplete"),webcLoadEventStart:o("loadEventStart"),webcLoadEventEnd:o("loadEventEnd"),webcCached:n.fetchStart===n.domainLookupEnd,webcNavigation:r.type,webcRedirectCount:r.redirectCount,webcWsOpening:p.OPENING,webcWsPairing:p.PAIRING,webcWsSyncing:p.SYNCING,webcWsNormal:p.NORMAL,webcWsAttempts:p.socketSequence,webcQrCode:!p.SYNCING,webcInitialPanelMountT:u-i,webcLoadInForeground:m}),t.commit(),window.document&&document.removeEventListener("visibilitychange",E),d=null}window.document&&(m=!document.hidden,document.addEventListener("visibilitychange",E)),Promise.all([h,g]).then((()=>{v(),(0,s.default)(),y||(y=!0,l.Wam.resumeJobs())}));class T{constructor(e){this._hasStarted=!1,this._label=e.label,this._startProperty=e.startProperty,this._endProperty=e.endProperty}start(){this._hasStarted=!0,null!=d&&(d.set({[this._startProperty]:S(Date.now())}),this._measure=o.startMeasure(this._label))}end(){null!=d&&(d.set({[this._endProperty]:S(Date.now())}),(0,i.default)(this._measure,"this._measure").end())}hasStarted(){return this._hasStarted}}const C=new T({label:"PageLoad.webcExe",startProperty:"webcExeStart",endProperty:"webcExeDone"});t.exeTimer=C;const A=new T({label:"PageLoad.webcMainScript",startProperty:"webcMainScriptStart",endProperty:"webcMainScriptEnd"});t.mainScriptTimer=A;const b=new T({label:"PageLoad.webcInitialPanelRender",startProperty:"webcInitialPanelMountStartT",endProperty:"webcInitialPanelRenderT"});t.initialScreenTimer=b;const P=(0,i.default)(d,"_PageLoad");t.PageLoad=P},243840:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.formatMeasureLabel=function(e){return`💬 ${e}`},t.startMeasure=function(e){return r};const r={end(){}};(null===(n=performance)||void 0===n?void 0:n.mark)&&performance.measure,new Map},929590:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getLatestPrivateStatsIdValueFromKey=function(e){if("regular"===e)throw new Error("tried to get psId for regular channel event");if(null==h)throw new Error("can't call getLatestPrivateStatsIdValueFromKey without initializing");return _[e].value},t.getPrivateStatsIdsForCoreWam=m,t.getPrivateStatsKeyFromInt=function(e){if(null==h)throw new Error("can't call getPrivateStatsKeyFromInt without initializing");return p[e]},t.initPrivateStats=function(){return g.apply(this,arguments)},t.maybeRotatePsIds=function(){return y.apply(this,arguments)};var i=r(n(348926)),a=n(787614),o=n(88156),s=n(892844),l=n(689258),c=r(n(11339)),u=r(n(126372)),d=n(115772);const p={},f={},_={};c.default.PrivateStatsAllIds.map((e=>{p[e.keyHashInt]=e.key,f[e.key]=e.keyHashInt,_[e.key]={value:e.keyHashInt,rotationPeriodDays:e.rotationPeriodDays}})),p[0]="none",f.none=0,_.none={value:"none",rotationPeriodDays:-1};let h=null;function g(){return(g=(0,i.default)((function*(){if(null!=h)return h.promise;h=new o.Resolvable,yield v();const e=[],t=yield u.default.getPsMeta(),n=new Set;t.map((t=>{n.add(t.key),void 0===_[t.key]?e.push(t.key):_[t.key].value=t.value}));const r=Object.keys(_).filter((e=>!n.has(e))).map((e=>("none"!==e&&(_[e].value=(0,a.randomHex)(16)),{key:e,value:_[e].value,rotateInDays:_[e].rotationPeriodDays,creationTs:(0,s.unixTime)()})));yield u.default.addPsMeta(r),yield u.default.removePsMeta(e),r.map((e=>(0,d.logPsIdUpdate)(c.default.PS_ID_ACTION.CREATED,f[e.key],e.rotateInDays))),e.map((e=>(0,d.logPsIdUpdate)(c.default.PS_ID_ACTION.DELETED,f[e],_[e].rotationPeriodDays))),h.resolve()}))).apply(this,arguments)}function m(){const e=new Map;return c.default.PrivateStatsAllIds.forEach((t=>{e.set(t.keyHashInt,String(_[t.key].value))})),e}function y(){return(y=(0,i.default)((function*(){const e=[];if(null==h)throw new Error("can't call maybeRotatePsIds without initializing");try{yield h.promise;const t=yield u.default.getPsMeta();yield Promise.all(t.map(function(){var t=(0,i.default)((function*(t){try{const{key:n,rotateInDays:r,creationTs:i}=t;C(i,r)&&(e.push(n),yield S(n))}catch(e){__LOG__(3)`error while rotating PS id for key ${t.key}`}}));return function(){return t.apply(this,arguments)}}()))}catch(e){__LOG__(3)`error while rotating PS ids ${e}`}try{e.length>0&&(0,l.updatePrivateStatIdsToCore)(m())}catch(e){}return e}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){const t=(0,a.randomHex)(16);_[e].value=t,yield u.default.updatePsMeta({key:e,rotateInDays:_[e].rotationPeriodDays,value:t,creationTs:(0,s.unixTime)()}),(0,d.logPsIdUpdate)(c.default.PS_ID_ACTION.ROTATED,f[e],_[e].rotationPeriodDays)}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){const e=[];(yield u.default.getPsMeta()).map((t=>{null!=t.lastRotationTimeUtc&&e.push(t.key)})),yield u.default.removePsMeta(e)}))).apply(this,arguments)}function C(e,t){if(-1===t||null==e)return!1;const n=t*s.DAY_SECONDS;return e<Math.floor((0,s.unixTime)()/n)*n}},407595:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.logDailyPrivateStatsTestEvents=function(){if((0,a.isLegacyWebdBackend)())return;new o.default.TestAnonymousDaily({}).commit(),(0,i.getABPropConfigValue)("web_ps_v3_enabled")&&(new o.default.TestAnonymousWeeklyId({}).commit(),new o.default.TestAnonymousIdLess({}).commit())},t.logUiActionShadowPrivateStatsTestEvents=function(){if((0,a.isLegacyWebdBackend)())return;(0,i.getABPropConfigValue)("web_ps_v3_enabled")&&(new o.default.TestAnonymousDailyId({}).commit(),new o.default.TestAnonymousMonthlyId({}).commit())};var i=n(257243),a=n(88555),o=r(n(11339))},314528:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new class{constructor(){this._resetNextSet=!1,this._value=0}get(){return this._value}_checkReset(){this._resetNextSet&&(this._resetNextSet=!1,this._value=0,this.initialDisplayDate=null)}inc(){return this._checkReset(),this.set(this._value+1)}set(e){if(this._checkReset(),this._value!==e)return 1===e&&(this.initialDisplayDate=Math.floor(window.performance.now())),this._value=e,this.get()}reset(){this._resetNextSet=!0}};t.default=n},734179:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e;if(!(null===(e=window.performance)||void 0===e?void 0:e.timing)||!window.performance.getEntriesByType)return void __LOG__(2)`MetricReporter:logResourceLoads metrics not provided by browser!`;const t=window.performance.timing.fetchStart===window.performance.timing.domainLookupEnd,n=window.performance.getEntriesByType("resource"),r=document.createElement("a");n.forEach((function(e){"xmlhttprequest"!==e.initiatorType&&(r.href=e.name,new i.default.WebcResourceLoad({webcResourceName:r.pathname+r.search+r.hash,webcResourceDuration:Math.round(e.duration),webcResourceCached:t}).commit())}))};var i=r(n(11339))},936737:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeHash=void 0,t.defineTypeHash=function(e,t,i){const a={$className:{value:e}};for(const i in t){let o=t[i];if("string"!=typeof o&&"function"!=typeof o||(o={type:o}),!o||"object"!=typeof o)throw new Error(`${e} specified with non-object ${o}`);a[i]={enumerable:!0,get:n(i),set:r(i,o)}}class o extends i{constructor(e){super(),this.all={},e&&this.set(e)}}return Object.defineProperties(o.prototype,a),o};function n(e){return function(){return this.all[e]}}function r(e,t){const n=t.type,r=t.set;return function(t){if(t!==this.all[e]){if(null==t);else if("function"==typeof n){if(!n(t))throw __LOG__(2)`type-validator fails ${t}`,new TypeError(`${this.$className}.${e} type-validator failed`)}else if(typeof t!==n)throw new TypeError(`${this.$className}.${e} requires type ${n}, got ${String(t)}`);r&&r.call(this,t),this.all[e]=t}}}t.TypeHash=class{set(e){for(const t in e)this[t]=e[t]}}},977959:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Wam=void 0,t.doNotUseOnlyForTestStopPendingTimer=function(){I.cancel()},t.initWamRuntime=function(){w=m.default.PrivateStatsAllIds.map((e=>e.key)),(0,S.initPrivateStats)(),(0,v.startWamStore)(),(0,h.logFingerprintToWam)(),I=new u.ShiftTimer((()=>{f.currentTabHasMutex()?function(){J.apply(this,arguments)}():__LOG__(3)`wam:this tab is in the background, skipping WAM processing for now`})),(0,y.setWamImpl)(L);for(;R.length;){R.pop()()}N=!0};var i=r(n(348926)),a=(r(n(81109)),r(n(763105))),o=r(n(435161)),s=r(n(66604)),l=r(n(145095)),c=n(88156),u=n(657319),d=M(n(386374)),p=r(n(379264)),f=M(n(555452)),_=n(689258),h=n(307902),g=n(488353),m=r(n(11339)),y=n(552211),S=n(929590),E=n(356768),v=n(675838),T=n(642448),C=r(n(126372)),A=n(909530),b=r(n(785195)),P=r(n(624569));function O(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(O=function(e){return e?n:t})(e)}function M(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=O(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}let I,w=[];const R=[];let N=!1;const L=(0,s.default)({commit:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=e.commitTime&&0!==e.commitTime)return __LOG__(3)`wam:commit redundant commit! ${e.$className}`,Promise.resolve();if(0!==e.weight&&Math.random()*e.weight>1)return e.commitTime=de(),Promise.resolve();return(0,_.commitToCoreWam)(e),W(e),$([!0,e],t)},set:function(e,t){return(0,_.setToCoreWam)(e,t),$([!1,e,t])},resumeJobs:q,initialize:V},(function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(N)return e(...n);R.push((()=>{e(...n)}))}}));t.Wam=L;const D={};let k=0,U=[],G=!1,x=!1,B=null,F=0,j=new c.Resolvable,Y=!1,K=!1;function W(e,t){e.commitTime=null!=t?t:de(),e.sequenceNumber=F++}function H(){return m.default.APP_BUILD_TYPE.RELEASE}function V(e){if(B&&!e)return;const t=p.default.info();B={appVersion:"2.2228.14",appBuild:H(),platform:m.default.PLATFORM_TYPE.WEBCLIENT,appIsBetaRelease:H()===m.default.APP_BUILD_TYPE.BETA,browser:t.name||null,browserVersion:t.ua||null,deviceName:t.os||null,deviceVersion:t.version||null,webcEnv:m.default.WEBC_ENV_CODE.PROD,webcTabId:f.THIS_TAB,webcWebPlatform:m.default.WEBC_WEB_PLATFORM_TYPE[T.WAM_PLATFORM]},e&&Object.assign(B,e),m.default.Global.commitOnSet=!1,m.default.Global.set(B),m.default.Global.commitOnSet=!0,(0,_.initializeCoreWam)(B)}function $(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return U.push(e),G?t?(Y=!1,K=!0,setTimeout((()=>I.forceRunNow()),1)):I.onOrBefore(1e3*E.PENDING_DELAY_IN_SECONDS):t&&(I.cancel(),Y=!0,K=!1),j.promise}function z(){G=!1,I.cancel();const e=j;return j=new c.Resolvable,e}function q(){G=!0,K=!1,U.length>0&&I.onOrBefore(1e3*E.PENDING_DELAY_IN_SECONDS),Y&&(Y=!1,K=!0,I.forceRunNow())}function J(){return(J=(0,i.default)((function*(){const e=K,t=z(),n=[...U];U=[];try{V();const r=yield(0,S.maybeRotatePsIds)();yield Promise.all(r.map(X)),yield Promise.all(["regular","none",...w].map((t=>ie(t,n,e))))}finally{t.resolve(),q()}}))).apply(this,arguments)}function Q(e){return"regular"===e?"regular":"private"}function X(){return Z.apply(this,arguments)}function Z(){return(Z=(0,i.default)((function*(e){yield oe(e),D[e]=yield ee(e)}))).apply(this,arguments)}function ee(){return te.apply(this,arguments)}function te(){return(te=(0,i.default)((function*(e){return new g.WamContext(e,yield C.default.getNextSequenceNumberForStream("1"),B)}))).apply(this,arguments)}function ne(){return re.apply(this,arguments)}function re(){return(re=(0,i.default)((function*(e){var t;const n=null!==(t=D[e])&&void 0!==t?t:yield ee(e);return D[e]=n,n}))).apply(this,arguments)}function ie(){return ae.apply(this,arguments)}function ae(){return(ae=(0,i.default)((function*(e,t,n){const r=Q(e);let i;try{i=yield ne(e)}catch(e){return void __LOG__(3)`wam:_executePendingForContext failed to get context ${String((null==e?void 0:e.stack)?e.stack:e)}`}try{for(let n=0;n<t.length;n++){if(i.size()>E.WAM_MAX_BUFFER_SIZE){__LOG__(3)`wam:_executePendingForContext drop the rest due to size limit: ${i.size()} > ${E.WAM_MAX_BUFFER_SIZE}`;break}const a=t[n],[o,...s]=a;if(o){const t=s[0];("regular"===t.wamChannel&&t.wamChannel===r||"private"===t.wamChannel&&e===(0,S.getPrivateStatsKeyFromInt)(t.privateStatsIdInt))&&i.write(t)}else{const[e,t]=s;e.channels.includes(r)&&(B[e.name]=t,i.set(e.id,t))}}const a=de();if(i.eventsWritten>0&&(n||i.size()>E.WAM_MAX_BUFFER_SIZE||a>=k+E.WAM_ROTATE_INTERVAL_IN_SECONDS||!x)){if(!(0,A.isLoggedIn)())return void(i.buffer.size()>E.WAM_MAX_BUFFER_SIZE?D[e]=null:yield oe(e));yield le(e)}else yield oe(e)}catch(t){__LOG__(3)`wam:_executePending error ${String((null==t?void 0:t.stack)?t.stack:t)}`,d.upload({reason:"wam-error"}),D[e]=null}}))).apply(this,arguments)}function oe(){return se.apply(this,arguments)}function se(){return(se=(0,i.default)((function*(e){if(!D[e])return;const t=D[e].stringBuffer();if(!t)return;const n=(0,l.default)(D[e],"contexts[bufferKey]").unsavedPortion;if(n&&0===n.eventsWritten)return;const r=(0,l.default)(D[e],"contexts[bufferKey]").saveKey;try{if(n){const n=yield C.default.update(r,e,t);if(!D[e])return;n?(0,l.default)(D[e],"contexts[bufferKey]").unsavedPortion=yield ee(e):(D[e]=D[e].unsavedPortion,yield oe(e))}else{if(yield C.default.add(r,e,t),!D[e])return;(0,l.default)(D[e],"contexts[bufferKey]").unsavedPortion=yield ee(e)}}catch(e){__LOG__(3)`wam:save WamStorage failed to save ${String(e)}`}}))).apply(this,arguments)}function le(){return ce.apply(this,arguments)}function ce(){return(ce=(0,i.default)((function*(e){let t;try{t=yield C.default.deleteAll(e)}catch(e){t={},__LOG__(3)`wam:sendAllLogs failed to read because ${String(e)}`}const n=t;if(D[e]){D[e].unsavedPortion&&!(D[e].saveKey in n)&&(D[e]=D[e].unsavedPortion);const t=(0,l.default)(D[e],"contexts[bufferKey]").saveKey;n[t]=(0,l.default)(D[e],"contexts[bufferKey]").stringBuffer()}const r=yield Promise.all((0,o.default)(n,((t,n)=>ue(t,n,Q(e))))),s=(0,a.default)(r);if(s.length!==r.length&&(k=de(),x=!0),D[e]&&!s.includes(D[e].saveKey)&&(D[e]=null),0===s.length)return;const c=s.reduce((function(e,t){return e+n[t].length}),0);c<E.WAM_MAX_BUFFER_SIZE?yield Promise.all((0,o.default)(s,function(){var t=(0,i.default)((function*(t){try{yield C.default.add(t,e,n[t])}catch(e){__LOG__(3)`sendAllLogs: adding to WamStorage failed`}}));return function(){return t.apply(this,arguments)}}())):(D[e]=null,__LOG__(3)`wam dropped ${s.length} buffers! (${c} bytes)`)}))).apply(this,arguments)}function ue(e,t,n){return""===e||"["===e[0]?Promise.resolve():"private"===n?(0,P.default)(e,t):"regular"===n?(0,b.default)(e,t):Promise.resolve()}function de(){return Math.floor(Date.now()/1e3)}},356768:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WAM_ROTATE_INTERVAL_IN_SECONDS=t.WAM_PROTOCOL_VERSION=t.WAM_MAX_BUFFER_SIZE=t.PENDING_DELAY_IN_SECONDS=void 0;t.PENDING_DELAY_IN_SECONDS=10;t.WAM_MAX_BUFFER_SIZE=5e4;t.WAM_PROTOCOL_VERSION=5;t.WAM_ROTATE_INTERVAL_IN_SECONDS=300},675838:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.closeWamStore=function(){(0,l.closeWamStorage)()},t.privateStatsKillSwitchGetBlockedToken=p,t.privateStatsKillSwitchSet=f,t.savePrivateStatsToken=d,t.startWamStore=function(){(0,l.startWamStorage)(_)};var i=r(n(81109)),a=r(n(348926)),o=n(640265),s=n(892844),l=n(936376),c=n(555452),u=(n(929590),r(n(126372)));function d(e){return u.default.savePsToken({key:"token",token:e,creationTs:(0,s.unixTime)(),redeemCount:1})}function p(){return Promise.resolve((0,c.getPsKillSwitchToken)())}function f(e){return(0,c.setPsKillSwitchToken)(e),Promise.resolve()}const _={getStreamId:()=>1,saveBuffer:()=>Promise.reject(new o.UnimplementedMethod("saveBuffer not implemented yet")),finishBuffer:()=>Promise.reject(new o.UnimplementedMethod("finishBuffer not implemented yet")),getStartingSequenceRow:()=>Promise.reject(new o.UnimplementedMethod("getStartingSequenceRow not implemented yet")),getBuffers:()=>Promise.reject(new o.UnimplementedMethod("getBuffers not implemented yet")),removeBufferByKey:()=>Promise.resolve(),nukeMetrics:()=>Promise.reject(new o.UnimplementedMethod("nukeMetrics not implemented yet")),updatePrivateStatsIds:()=>Promise.reject(new o.UnimplementedMethod("updatePrivateStatsIds not implemented yet")),redeemPrivateStatsToken:function(){var e=(0,a.default)((function*(e){const t=yield u.default.getPsToken();return t?e({redeemCount:t.redeemCount,creationTs:t.creationTs},{maxExpirySeconds:86400})?u.default.savePsToken((0,i.default)((0,i.default)({},t),{},{redeemCount:t.redeemCount+1})).then((()=>t.token)):Promise.resolve(null):null}));return function(){return e.apply(this,arguments)}}(),savePrivateStatsToken:d,privateStatsKillSwitchGetBlockedToken:p,privateStatsKillSwitchSet:f}},642448:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WAM_PLATFORM=void 0;t.WAM_PLATFORM="WEB"},126372:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(111554));t.default=class{static add(e,t,n){return(0,i.default)((function*(){return(yield a.default.idb()).wam.add({key:e,buffer:n,channel:t},e).catch((e=>{__LOG__(2)`add failed: ${e}\n${null==e?void 0:e.stack}`}))}))()}static update(e,t,n){return(0,i.default)((function*(){let r=0;try{r=yield a.default.idb().then((r=>r.wam.update(e,{key:e,buffer:n,channel:t})))}catch(e){__LOG__(2)`update failed: ${e}\n${null==e?void 0:e.stack}`}return 0!==r}))()}static deleteAll(e){return(0,i.default)((function*(){const t={};try{yield a.default.idb().then((n=>n.wam.where("channel").equals(e).modify((function(e){t[e.key]=e.buffer,delete this.value}))))}catch(e){__LOG__(2)`deleteAll failed: ${e}\n${null==e?void 0:e.stack}`}return t}))()}static getNextSequenceNumberForStream(e){return(0,i.default)((function*(){let t=-1;try{const n=yield a.default.idb();yield n.transaction("rw",["wam_meta"],(0,i.default)((function*(){0===(yield n.wam_meta.where("streamId").equals(e).count())?(yield n.wam_meta.add({streamId:e,seqNum:1}),t=1):yield n.wam_meta.where("streamId").equals(e).modify((function(e){return t=e.seqNum+1,t>=65536&&(t=1),e.seqNum=t,e}))})))}catch(e){__LOG__(2)`getNextSequenceNumberForStream failed: ${e}\n${null==e?void 0:e.stack}`}if(-1===t)throw new Error(`could not get seq number for streamId ${e}`);return t}))()}static removePsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkDelete(e))).catch((e=>{__LOG__(2)`removePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsMeta(){return a.default.idb().then((e=>e.ps_meta.toArray())).catch((e=>(__LOG__(2)`getPsMeta failed: ${e}\n${null==e?void 0:e.stack}`,[])))}static addPsMeta(e){return a.default.idb().then((t=>t.ps_meta.bulkPut(e))).catch((e=>{__LOG__(2)`addPsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static updatePsMeta(e){return a.default.idb().then((t=>t.ps_meta.update(e.key,e))).catch((e=>{__LOG__(2)`updatePsMeta failed: ${e}\n${null==e?void 0:e.stack}`}))}static getPsToken(){return a.default.idb().then((e=>e.ps_tokens.get("token"))).catch((e=>{__LOG__(2)`getPsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}static savePsToken(e){return a.default.idb().then((t=>t.transaction("rw",["ps_tokens"],(()=>t.ps_tokens.put(e))))).catch((e=>{__LOG__(2)`savePsToken failed: ${e}\n${null==e?void 0:e.stack}`}))}static addCoreWamBuffer(e,t){return(0,i.default)((function*(){const n=yield a.default.idb();return n.transaction("rw",["core_wam","core_wam_meta"],(()=>n.core_wam.put(t).then((()=>n.core_wam_meta.put(e)))))}))()}static finishAllCoreWamBuffers(e){return(0,i.default)((function*(){return(yield a.default.idb()).core_wam.where("streamId").equals(e).modify({finished:!0})}))()}static getCoreWamStartingSequenceNumber(e){return(0,i.default)((function*(){return(yield a.default.idb()).core_wam_meta.get({streamId:e})}))()}static getAllCoreWamBuffers(){return(0,i.default)((function*(){return(yield a.default.idb()).core_wam.toArray()}))()}static nukeAllCoreWamBuffers(){return(0,i.default)((function*(){const e=yield a.default.idb();return e.transaction("rw",["core_wam","core_wam_meta"],(()=>e.core_wam.clear().then((()=>e.core_wam_meta.clear()))))}))()}static removeWamBufferByKey(e){return(0,i.default)((function*(){return(yield a.default.idb()).core_wam.delete(e)}))()}}},115772:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.forceFlushAllWamBuffers=function(){return(new i.default.WebWamForceFlush).commit(!0)},t.logPsIdUpdate=function(e,t,n){new i.default.PsIdUpdate({psIdAction:e,psIdKey:t,psIdRotationFrequence:n}).commit()};var i=r(n(11339))},615078:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(11339));var a=new class{constructor(){this._events=new Map}logSend(e){const t=e.tag;if(t)try{const n=e.getName(),r=n.startsWith("query")?i.default.WEBC_WAP_REQUEST_KIND_CODE.GET:i.default.WEBC_WAP_REQUEST_KIND_CODE.SET,a=e.isToPhone?i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.PHONE:i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,o=e.data.byteLength||JSON.stringify(e.data).length;this._createEvent(t,{kind:r,destination:a,name:n,size:o})}catch(e){__LOG__(3)`WAPReporter: fail to log send`}}logBasicSend(e,t){if(e)try{const n=i.default.WEBC_WAP_REQUEST_KIND_CODE.GET,r=i.default.WEBC_WAP_REQUEST_DESTINATION_CODE.SERVER,a=t[1].toLowerCase(),o=JSON.stringify(t).length;this._createEvent(e,{kind:n,destination:r,name:a,size:o})}catch(e){__LOG__(3)`WAPReporter: fail to log basic send`}}logAck(e){if(!e)return;const t=this._events.get(e);t&&t.markWebcWapRequestAckT({showInTimeline:!1})}logRecv(e,t,n){if(!e)return;const r=this._events.get(e);r&&(r.webcWapRequestResponseSize=t,null!=n&&(r.webcWapRequestStatus=n),r.markWebcWapRequestRecvT({showInTimeline:!1}),r.commit(),this._events.delete(e))}delete(e){e&&this._events.delete(e)}clear(){this._events.clear()}_createEvent(e,t){const n=new i.default.WebcWapRequest({webcWapRequestKind:t.kind,webcWapRequestDestination:t.destination,webcWapRequestName:t.name,webcWapRequestSize:t.size});this._events.set(e,n)}};t.default=a},181663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chatJidToChatWid=function(e){return(0,i.toChatWid)((0,i.createWid)(e))},t.deviceJidToDeviceWid=function(e){return(0,i.createDeviceWid)(e)},t.deviceJidToUserWid=function(e){return(0,i.toUserWid)((0,i.createWid)(e))},t.groupJidToWid=function(e){return(0,i.createWid)(e)},t.jidWithTypeToWid=function(e){const t=(0,r.extractJidFromJidWithType)(e);return(0,i.createWid)(t)},t.userJidToUserWid=function(e){return(0,i.createUserWid)(e)};var r=n(272441),i=n(745454)},389867:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(252230),a=n(551737),o=r(n(726682)),s=n(447685);const l="16505361212@c.us",c=["name","short","notify"];class u{constructor(e,t){let{intentionallyUsePrivateConstructor:n}=t;if(!n)throw new Error("You should use WidFactory.createWid() instead of the Wid constructor. If you absolutely must use the constructor, pass {intentionallyUsePrivateConstructor: true} as a second parameter.");const r=(0,s.validateAndGetParts)(e);if(null==r)throw new Error(`wid error: invalid wid: ${e}`);const i=[],a=r.userPart,o=r.devicePart,l=r.serverPart.toLowerCase();let c;switch(l){case"s.whatsapp.net":c="c.us";break;default:c=l}if(this.server=c,null==a)throw new Error(`wid error: this wid repreensts server ans should not be used: ${e}`);if(this.user=a,i.push(this.user),null!=o){if("c.us"!==this.server&&"lid"!==this.server)throw new Error(`wid error: wrong server for wid with device present: ${e}`);const t=parseInt(o,10);t&&(i.push(":"),i.push(t),this.device=t)}i.push("@"),i.push(this.server),this._serialized=i.join("")}getUserPartForLog(){if(this.isGroup()){const e=this.user.split("-");if(2===e.length){const[t,n]=e;return`${t.slice(-4)}-${n}`}}return this.user.slice(-4)}toString(e){if(e){let t,n;const r=e.legacy&&"c.us"===this.server?"s.whatsapp.net":this.server;e.formatFull?(n=`:${this.device||0}`,t=".0"):n=null!=this.device&&0!==this.device?`:${this.device}`:"";const i=e.forLog?this.getUserPartForLog():this.user;if(e.formatFull||e.legacy&&"c.us"===this.server||e.forLog)return[i,t,n,"@",r].join("")}return this._serialized}toLogString(){return this.toString({forLog:!0,legacy:!1})}toJid(){return this.toString({legacy:!0})}getJidServer(){return"c.us"===this.server?i.WA_USER_JID_SUFFIX:this.server}getSignalAddress(){const e=null!=this.device&&0!==this.device?`:${this.device}`:"",t=this.isLid()?"@lid":"";return[this.user,e,t].join("")}getDeviceId(){const e=this.device;return null==e?0:e}equals(e){return e instanceof u&&this.toString()===e.toString()}isLessThan(e){return e instanceof u&&this.toString()<e.toString()}isGreaterThan(e){return e instanceof u&&this.toString()>e.toString()}isCompanion(){return null!=this.device&&this.device!==i.DEFAULT_DEVICE_ID}isSameAccount(e){return this.server===e.server&&this.user===e.user}isUser(){return"c.us"===this.server||"lid"===this.server}isLid(){return"lid"===this.server}isUserNotPSA(){return this.isUser()&&!this.isPSA()}isBroadcast(){return"broadcast"===this.server}isOfficialBizAccount(){return this.toString()===l}isGroup(){return"g.us"===this.server}isGroupCall(){return"call"===this.server}isServer(){return"server"===this.user.toLowerCase()&&"c.us"===this.server}isPSA(){return"0"===this.user&&"c.us"===this.server}isStatusV3(){return"status"===this.user.toLowerCase()&&"broadcast"===this.server}isSupportAccount(){return(0,o.default)(this.user)}toJSON(){return this.toString()}static isXWid(e,t){return(0,a.isString)(t)?t.split("@")[1]===e:t instanceof u?t.server===e:(void 0!==t&&__LOG__(2)`wid:isXWid called on nonstring: + ${String(t)}`,!1)}static isUser(e){return u.isXWid("c.us",e)||u.isXWid("lid",e)}static isBroadcast(e){return u.isXWid("broadcast",e)}static isGroup(e){return u.isXWid("g.us",e)}static isGroupCall(e){return u.isXWid("call",e)}static isWid(e){return(0,a.isString)(e)?(0,s.validateWid)(e):e instanceof u}static canBeWid(e){return!e||!c.includes(e)}static isServer(e){return(0,a.isString)(e)?"server@c.us"===e.toLowerCase():e instanceof u&&e.isServer()}static isPSA(e){return(0,a.isString)(e)?"0@c.us"===e.toLowerCase():e instanceof u&&e.isPSA()}static isStatusV3(e){return(0,a.isString)(e)?e.toLowerCase()===i.STATUS_JID:e instanceof u&&e.isStatusV3()}static isSupportAccount(e){return(0,a.isString)(e)?(0,o.default)(e.split("@")[0]):e instanceof u&&e.isSupportAccount()}static isOfficialBizAccount(e){return(0,a.isString)(e)?e.toLowerCase()===l:e instanceof u&&e.isOfficialBizAccount()}static user(e){return(0,a.isString)(e)?e.split("@")[0]:e instanceof u?e.user:void 0}static equals(e,t){return e instanceof u||t instanceof u?e instanceof u&&e.equals(t):e===t}static isLessThan(e,t){return e instanceof u&&t instanceof u&&e.toString()<t.toString()}static isGreaterThan(e,t){return e instanceof u&&t instanceof u&&e.toString()>t.toString()}}t.default=u},745454:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceWid=c,t.createDeviceWidFromDeviceListPk=function(e,t){const[n,r="c.us"]=e.split("@");return l(n,r,t)},t.createDeviceWidFromUserAndDevice=l,t.createUserWid=u,t.createWid=s,t.createWidFromWidLike=function(e){if(e instanceof a.default)return e;if("string"==typeof e)return s(e);return s(e._serialized)},t.isWidlike=function(e){return!!e&&(!!a.default.isWid(e)||!(!e||"object"!=typeof e||!a.default.isWid(e._serialized)))},t.toChatWid=function(e){if(e.isUser())return d(e);return e},t.toUserWid=d;var i=n(551737),a=r(n(389867)),o=r(n(919037));function s(e){let t;return(null===o.default||void 0===o.default?void 0:o.default.cache)?(t=o.default.cache[e],t||(t=new a.default(e,{intentionallyUsePrivateConstructor:!0}),o.default.cache[e]=t)):t=new a.default(e,{intentionallyUsePrivateConstructor:!0}),t}function l(e,t,n){return c(`${e}:${n}@${t}`)}function c(e){return s(e)}function u(e,t){let n;if(n=(0,i.isString)(e)&&(e.endsWith("@c.us")||e.endsWith("@s.whatsapp.net")||e.endsWith("@lid"))?e:`${e}@${t||"c.us"}`,n=s(n),null==n.device||0===n.device)return n;throw __LOG__(4,void 0,new Error)`createUserWid: ${e} is not a valid user jid`,new Error("createUserWid is called with invalid user string")}function d(e){if(!e.isUser())throw new Error("asUserWid: wid is not a user wid");return null==e.device||0===e.device?e:u(e.user,e.server)}},562054:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.widToFormattedUser=function(e){if(e instanceof l.default)return e.isLid()?(__LOG__(3,void 0,void 0,!0)`widToFormattedUser should not be lid`,SEND_LOGS("widToFormattedUser-wid-lid"),""):d(e.user);if((0,s.isString)(e))return e.endsWith(a.LID_DOMAIN)?(__LOG__(3,void 0,void 0,!0)`widToFormattedUser should not be lid`,SEND_LOGS("widToFormattedUser-string-lid"),""):d(e.split("@")[0]);return""};var i=r(n(288306)),a=n(252230),o=n(240277),s=n(551737),l=r(n(389867)),c=r(n(914296));const u=(0,i.default)((e=>"Server"===e?e:(0,o.formatPhone)(e)));function d(e){return c.default.isRTL()?c.default.isolateLTR(u(e)):u(e)}},79196:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.widToDeviceJid=o,t.widToGroupJid=function(e){const t=a(e);if("group"===t.jidType)return t.groupJid;throw __LOG__(4,void 0,new Error)`widToGroupJid: "${e.toString()}" is not a GroupJid`,new Error("widToGroupJid: can not convert wid to GroupJid")},t.widToJidWithType=a,t.widToMyJids=function(e){if(null!=e){const t=o(e);return{userJid:(0,r.extractUserJid)(t),deviceJid:t}}},t.widToUserJid=function(e){const t=a(e);if("phoneUser"===t.jidType||"lidUser"===t.jidType)return t.userJid;throw __LOG__(4,void 0,new Error)`widToUserJid: "${e.toString()}" is not a UserJid`,new Error("widToUserJid: can not convert wid to UserJid")};var r=n(252230),i=n(272441);function a(e){const t=e.toJid(),n=(0,i.interpretAndValidateJid)(t);if("unknown"===n.jidType)throw __LOG__(4,void 0,new Error)`widToJidWithType: "${t}" is not a valid jid`,new Error("widToJidWithType: unknown jid type");return n}function o(e){const t=a(e);if("phoneDevice"===t.jidType||"lidDevice"===t.jidType)return t.deviceJid;if("phoneUser"===t.jidType)return(0,i.defaultDeviceJidForUser)(t.userJid);if("lidUser"===t.jidType)return(0,i.defaultLidDeviceJidForLidUserJid)(t.userJid);throw __LOG__(4,void 0,new Error)`widToDeviceJid: "${e.toString()}" is not a DeviceJid`,new Error("widToDeviceJid: can not convert wid to DeviceJid")}},447685:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Domains=void 0,t.validateAndGetParts=function(e){if(null==e)return null;const t=e.match(/(.*)@(.*)/);if(null==t)return"call"===e||"s.whatsapp.net"===e?{serverPart:e}:null;const n=t[1],i=r.cast(t[2]);if(null==i)return __LOG__(3)`validateAndGetParts: Domain not supported`,null;const a=n.match(d[t[2]]);if(!a)return null;switch(i){case r.BROADCAST:return{serverPart:r.BROADCAST,userPart:a[1]};case r.CALL:return{serverPart:r.CALL,userPart:a[1]};case r.G_US:return{serverPart:r.G_US,userPart:a[1]};case r.C_US:return{serverPart:r.C_US,userPart:a[1],devicePart:a[3]};case r.S_WHATSAPP_NET:return{serverPart:r.S_WHATSAPP_NET,userPart:a[1],devicePart:a[3]};case r.LID:return{serverPart:r.LID,userPart:a[1],devicePart:a[3]};case r.MSGR:return{serverPart:r.LID,userPart:a[1],devicePart:a[2]}}return null},t.validateWid=function(e){if(null==e)return!1;const t=e.match(/(.*)@(.*)/);if(null==t)return"call"===e||"s.whatsapp.net"===e;const n=t[1],r=t[2];if(null==d[r])return!1;return d[r].test(n)};const r=n(76672)({BROADCAST:"broadcast",CALL:"call",C_US:"c.us",G_US:"g.us",LID:"lid",MSGR:"msgr",S_WHATSAPP_NET:"s.whatsapp.net"});t.Domains=r;const i=/[0-9]{1,2}/,a=/0/,o=/[1-9][0-9]{0,19}/,s=/(?!10)[1-9][0-9]{4,19}/,l=new RegExp(`^(${s.source}[-]${/[1-9][0-9]{9}/.source}$|^${o.source})$`),c=new RegExp(`^(${o.source}$|${["status","location","chat"].map((e=>"^"+e+"$")).join("|")})`,"i"),u=new RegExp(`^(0$|^${s.source})([.]${a.source})?(?:[:](${i.source}))?$`),d={broadcast:c,call:/^([0-9a-f]{18,32})$/i,"c.us":u,"g.us":l,lid:new RegExp(`^(${/[1-9][0-9]{0,14}/.source})([.]${a.source})?(?:[:](${i.source}))?$`),msgr:new RegExp(`^(${o.source})(?:[:](${/[1-9][0-9]{0,2}/.source}))?$`),"s.whatsapp.net":u}},594300:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.App=function(){return(0,Ue.jsx)(Ve,{})},t.AppWrapper=void 0,t.hasPending=function(){return null!=Be&&Be.hasPending()},t.stopCommsBeforeUnload=function(){(0,o.stopComms)()};var i=r(n(348926)),a=r(n(751463)),o=n(736184),s=n(252230),l=r(n(782594)),c=r(n(145095)),u=n(638284),d=n(657319),p=r(n(485074)),f=n(88555),_=n(40234),h=n(781572),g=n(233783),m=(r(n(364369)),n(947999)),y=r(n(282080)),S=n(221310),E=n(512670),v=n(739948),T=n(788950),C=n(408139),A=n(914597),b=n(669393),P=n(296400),O=n(121892),M=n(123918),I=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Ge(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(377144)),w=n(964316),R=n(26741),N=n(400922),L=n(279101),D=r(n(376139)),k=n(555452),U=n(546718),G=r(n(6103)),x=n(978820),B=r(n(111554)),F=n(79196),j=(r(n(785954)),r(n(806357))),Y=n(89721),K=n(441733),W=n(978359),H=n(351650),V=n(114259),$=n(340249),z=n(624113),q=n(729424),J=r(n(370842)),Q=r(n(360695)),X=r(n(422028)),Z=r(n(131703)),ee=r(n(603137)),te=n(789618),ne=n(718644),re=n(478123),ie=n(184387),ae=n(546582),oe=r(n(189248)),se=r(n(452665)),le=r(n(408623)),ce=r(n(894049)),ue=r(n(13259)),de=r(n(907260)),pe=n(540477),fe=r(n(896753)),_e=r(n(540626)),he=r(n(357050)),ge=r(n(137538)),me=r(n(168481)),ye=n(127838),Se=n(597628),Ee=n(877113),ve=r(n(914296)),Te=r(n(11339)),Ce=n(797480),Ae=n(771119),be=r(n(366034)),Pe=n(317239),Oe=n(748694),Me=n(964551),Ie=n(608080),we=n(765044),Re=r(n(294184)),Ne=n(548360),Le=r(n(441143)),De=r(n(730381)),ke=n(667294),Ue=n(785893);function Ge(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ge=function(e){return e?n:t})(e)}n(838125),we.Socket.registerHandler((e=>{(0,ae.requireHandleSocketMessage)().then((t=>t(e)))}));const xe=n(76672).Mirrored(["CLIENT_EXPIRED_DIALOG","ANOTHER_SESSION","UNSUPPORTED_TAKEOVER","QR","SYNCING","OFFLINE","PROXYBLOCK","CONFLICT","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION","MAIN","STARTUP","TEMP_BAN","LOGOUT","PRIMARY_FORCE_UPGRADE","LOCK"]);let Be,Fe=!1,je=!1;function Ye(e){"initialPanelMountTRecorded"===e&&(Fe=!0),"initialPanelRenderTRecorded"===e&&(je=!0),Fe&&je&&(0,Ae.onInitialRenderComplete)()}const Ke=(0,a.default)((()=>{(0,Ae.saveInitialPanelMountTime)(Date.now()),Ye("initialPanelMountTRecorded")}));function We(e){let{cmdAndData:t,isExternal:n,sessionId:r}=e;const{resultType:i,data:a}=t;return __LOG__(2)`main:execApiCmd:${i}`,(0,Le.default)(null!=Be,"Attempted to exec API command before main was loaded"),Be.execApiCmd({cmd:i,untypedData:a,isExternal:n,sessionId:r})}class He extends ke.Component{constructor(){super(...arguments),this.contextMenuRef=(0,ke.createRef)(),this.animate=!0,this.state={mode:Ie.Stream.mode,updating:Ie.Stream.clientExpired,hardExpired:Ie.Stream.hardExpired,anotherSession:!1,takingOver:!1,isUnsupportedTakeover:!1,apiCmd:void 0,locale:ve.default.getLocale(),mainLoaded:!1,socketProgressStep:0,theme:(0,Se.getTheme)(),systemThemeMode:(0,k.getSystemThemeMode)(),isKeyboardUser:!1,initialLoadReady:!1,startLogout:!1,stayInSync:!we.Socket.hasSynced,primaryForceUpgrade:Oe.PrimaryForceUpgrade.shouldForceUpgrade},this._unsetIsKeyboardUser=()=>{this.setState({isKeyboardUser:!1})},this._setIsKeyboardUser=()=>{this.setState({isKeyboardUser:!0})},this._handlers={up:this._setIsKeyboardUser,down:this._setIsKeyboardUser,left:this._setIsKeyboardUser,right:this._setIsKeyboardUser,home:this._setIsKeyboardUser,end:this._setIsKeyboardUser,"command+up":this._setIsKeyboardUser,"command+down":this._setIsKeyboardUser,pageUp:this._setIsKeyboardUser,pageDown:this._setIsKeyboardUser,tab:this._setIsKeyboardUser,"shift+tab":this._setIsKeyboardUser,"shift+?":this._setIsKeyboardUser},this._setWamSystemInfo=null,this._setModeScheduler=new d.ShiftTimer((e=>{e!==this.state.mode&&this.setState({mode:e})})),this._handleStreamModeChange=()=>{const e=Ie.Stream.mode;this.state.mode!==Ie.StreamMode.MAIN?this._setModeScheduler.onOrBefore(0,e):this._setModeScheduler.forceRunNow(e)},this._handleClientExpired=()=>{this.state.updating!==Ie.Stream.clientExpired&&this.setState({updating:Ie.Stream.clientExpired})},this._handleHardExpired=()=>{this.setState({hardExpired:Ie.Stream.hardExpired})},this._handleMouseDown=e=>{0!==e.detail&&this._unsetIsKeyboardUser(),h.Cmd.windowMouseDown(e)},this._handleClick=e=>{h.Cmd.windowClick(e)},this._handleWindowClick=e=>{var t;const n=e.target;if(!n)return;if("A"!==n.nodeName)return;const r=n.getAttribute("href");if(!r)return;if(null===(t=n.dataset)||void 0===t?void 0:t.nohandle)return;const i=(0,V.parseAPICmd)(r);if("INVALID"===i.resultType)return;const a=this._getDeeplinkSessionId();this._canExecApiCmd()&&We({cmdAndData:i,isExternal:!0,sessionId:a})&&((0,f.isMDBackend)()&&this._logDeepLinkClickMetric(i,a),e.preventDefault())},this._logDeepLinkClickMetric=(e,t)=>{if(e.resultType===H.APICmd.GROUP_INVITE)new Te.default.DeepLinkClick({deepLinkHasPhoneNumber:!1,deepLinkHasText:!0}).commit();else if(e.resultType===H.APICmd.MSG_SEND){const n=e.data.phone,r=e.data.text;new Te.default.DeepLinkClick({deepLinkHasPhoneNumber:!!n,deepLinkHasText:!!r,deepLinkSessionId:t}).commit()}else(e.resultType===H.APICmd.CATALOG||e.resultType===H.APICmd.PRODUCT)&&new Te.default.DeepLinkClick({deepLinkHasPhoneNumber:!0,deepLinkHasText:!1}).commit()},this._handleSetTheme=e=>{if(this.state.theme!==e){for(const t of Se.THEME_ASSETS[e])K.AssetLoader.loadAsset(t,Y.LOAD_PRIORITY.THEME_ASSET_LOAD,!1);if(Me.ServerProps.wallpapersV2){const e=be.default.get("defaultPreference");if(e&&re.DEFAULT_CHAT_WALLPAPER!==e.wallpaperColor){const t=(0,re.toggleWallpaperColor)(e.wallpaperColor,this.state.theme);e.set("wallpaperColor",t)}}(0,Se.setTheme)(e),this.setState({theme:e})}},this._handleSetSystemThemeMode=e=>{(0,k.setSystemThemeMode)(e),this.setState({systemThemeMode:e})},this._mdReloadPageOnTakeOver=()=>{__LOG__(2)`[md takeover] refreshing page on takeover`,window.location.reload()},this._handleReadyForMainScreen=()=>{__LOG__(2)`DebouncedLoadingScreen: Ready for main screen`,this.setState({stayInSync:!1})},this._mdReloadPageWithUnsupportedTakeOver=()=>{__LOG__(2)`[unsupported takeover] refreshing page with unsupported takeover`,window.location.reload()},this._getThemeContextValue=(0,l.default)((e=>{let{theme:t,systemThemeMode:n}=e;return{theme:t,setTheme:this._handleSetTheme,systemThemeMode:n,setSystemThemeMode:this._handleSetSystemThemeMode}}))}componentDidMount(){(0,x.getMe)()||(0,f.switchToMDBackend)();let e=null;(0,f.isMDBackend)()&&(e=(0,F.widToMyJids)((0,x.getMe)())),(0,E.setGlobals)({config:g.ConfigImpl,jidUtils:(0,s.createJidUtils)({platform:"whatsapp"}),myJids:e,db:m.dbCallbacks,runInTransaction:O.runInTransaction,qpl:P.qplConfigs});const{theme:t}=this.state;(0,Se.applyThemeToUI)(t),qe().then((e=>{K.AssetLoader.setPlatform(e),K.AssetLoader.loadInitialAssets(Se.THEME_ASSETS[t])})),function(){return $e.apply(this,arguments)}().then(Ee.loadProtoVersions).then((()=>{h.Cmd.mainLoaded(),this.setState({mainLoaded:!0})})).then((()=>Promise.all([(0,ae.requireEmojiAssetMapCreator)(),(0,ae.requireEmojiConfig)(),qe()]))).then((e=>{let[t,n,r]=e;K.AssetLoader.setPlatform(r),K.AssetLoader.initEmojiAsset(t(n)),W.emojiCompletionTracker.beginPreloadFallback()}));const{listeners:r}=this.props;r.add(h.Cmd,"increment_progress",(()=>{this._incProgress()})),r.add(h.Cmd,"initial_load_ready",(()=>{this.setState({initialLoadReady:!0})})),r.add(M.StorageCmd,"storage_not_enough_space",(()=>{A.ModalManager.open((0,Ue.jsx)(se.default,{onOK:()=>{we.Socket.logout(!1,T.LogoutReason.StorageQuotaExceeded)},okText:Ne.fbt._("OK",null,{hk:"2KEeHb"}),children:Ne.fbt._("Your computer does not have enough space for WhatsApp to run. Please create more storage by deleting unused files from your computer, then log in again.",null,{hk:"3tBII8"})}))})),r.add(h.Cmd,"account_temporarily_banned",(e=>{this.setState({temporaryBan:e})})),r.add(h.Cmd,"starting_logout",(()=>{this.setState({startLogout:!0})})),r.add(Oe.PrimaryForceUpgrade,"change:shouldForceUpgrade",(()=>{const e=Oe.PrimaryForceUpgrade.shouldForceUpgrade;this.state.primaryForceUpgrade!==e&&this.setState({primaryForceUpgrade:e})})),(0,f.isMDBackend)()&&(b.QPL.throwKillswitch(!1),Ce.OfflineResumeReporter.logPageLoadT());{const e=n(472117).Z;r.add(window,"beforeunload",e.unloadMutex.bind(e)),r.add(window,"unload",e.unloadMutex.bind(e)),r.add(window,"storage",(t=>{e.storagePong(t)&&((0,f.isMDBackend)()&&(__LOG__(2)`[md takeover] tab taken over. stopping comms`,(0,o.stopComms)()),v.Logger.onTakeOver(),this.setState({takingOver:!1,anotherSession:!0}))}))}if(r.add(Ie.Stream,"change:clientExpired",this._handleClientExpired),r.add(Ie.Stream,"change:hardExpired",this._handleHardExpired),r.add(Ie.Stream,"change:mode",this._handleStreamModeChange),D.default.canMuckHistory()){const e=(0,V.parseAPICmd)(window.location.href);if(e.resultType!==H.APICmd.INVALID){const{url:t}=e.data;delete e.data.url,this._maybeExecApiCmd(e),window.history.replaceState({},"",t)}}var i;r.add(ve.default,"locale_change",(e=>{let{loc:t}=e;__LOG__(2)`App:componentDidMount:rerenderUI locale change`,G.default.setItemToLocalStorage(U.KEYS.LANG,t),(0,f.isMDBackend)()&&_.Clock.setIs24HourBasedOnLocale(),this.animate=!1,this.setState({locale:`${ve.default.getLocale()}#${De.default.locale()}`})})),this._registerYesterdayTimer(),__LOG__(2)`App:componentDidMount:visibilityState: ${document.visibilityState}`,"prerender"===document.visibilityState?(0,u.promiseTimeout)((0,y.default)(document,"visibilitychange"),5e3).then((()=>this._beginMutex(0))).catch((()=>this._beginMutex(0))):this._beginMutex(0),this.props.listeners.add(window,"click",this._handleWindowClick,{capture:!0}),this.props.listeners.add(window,"blur",(()=>{this._unsetIsKeyboardUser()})),L.updatePoll.poll(L.checkForUpdates),this._logFirstRenderMountTime(),document.createElement=(i=document.createElement.bind(document),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("iframe"===e.toLowerCase()){__LOG__(3)`Modified a created iframe element to include sandbox attributes for security fix.`;const n=i(e,t);return n.sandbox=Me.ServerProps.webYouTubePlayerEnhancements||Me.ServerProps.webPipRedesign?"allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox":"allow-scripts allow-same-origin",n}return i(e,t)}),this.props.listeners.add(ee.default,"system_theme_change",(e=>{this.state.systemThemeMode&&this._handleSetTheme(e)}))}componentDidUpdate(e,t){!0===t.anotherSession&&!1===this.state.anotherSession?B.default.openDB().catch((e=>{__LOG__(3)`Failed to open indexeddb: ${e}`})):!1===t.anotherSession&&!0===this.state.anotherSession&&B.default.idb().then((e=>{e.close(),__LOG__(2)`db: closed due to take over`})).catch((()=>{})),this._maybeExecApiCmd(this.state.apiCmd),this.state.mode!==Ie.StreamMode.MAIN&&(this.animate=!0),this._logFirstRenderMountTime()}componentWillUnmount(){this._setModeScheduler.cancel(),this._setWamSystemInfo&&this._setWamSystemInfo.cancel()}_beginMutex(e){var t=this;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.default)((function*(){if(R.UA.isLocalStorageBroken&&(0,f.isMDBackend)()){if(yield(0,ye.isAnotherTabActive)()){v.Logger.onTakeOver(),t.setState({isUnsupportedTakeover:!0});try{(0,o.stopComms)()}catch(e){}return}}(0,ye.setTabActive)(),r&&N.Updater.shouldForceUpdateOnTakeOver()&&N.Updater.restart();{const i=n(472117).Z,a=r?i.takeoverLocal(e):i.init(e),o=yield a.catch((e=>(t.setState({takingOver:!0}),t._beginMutex(e,!0))));v.Logger.isTakeOver=o,t.setState({takingOver:!1,anotherSession:o})}}))()}_incProgress(){this.setState({socketProgressStep:this.state.socketProgressStep+1})}_maybeExecApiCmd(e){if(e){if(this._canExecApiCmd()){return We({cmdAndData:e,isExternal:!0,sessionId:this._getDeeplinkSessionId()}),void(null!=this.state.apiCmd&&this.setState({apiCmd:null}))}e!==this.state.apiCmd&&this.setState({apiCmd:e})}}_canExecApiCmd(){return null!=Be&&ze(this.state)===xe.MAIN}_logFirstRenderMountTime(){this.state.mode!==Ie.StreamMode.SYNCING&&Ke()}_calculateProgress(){return 20*this.state.socketProgressStep}_registerYesterdayTimer(){p.default.setLocalTimeout((()=>{__LOG__(2)`App:registerYesterdayTimer:rerenderUI relative timestamps`,__LOG__(2)`Local Clock: ${Date.now()}, Skew: ${_.Clock.getSkew()}`,h.Cmd.midnight(),this._registerYesterdayTimer()}),(0,De.default)().endOf("day").valueOf())}_getTemporaryBanReason(e){const t=(0,x.getMaybeMeUser)().user;switch(e){case 101:return ve.default.t(619,{phone:t});case 102:return Ne.fbt._("You're temporarily banned from WhatsApp because too many people blocked you.",null,{hk:"3HhQ7n"});case 103:return ve.default.t(620,{phone:t});case 104:return Ne.fbt._("You're temporarily banned from WhatsApp because you sent the same message to too many people.",null,{hk:"2r9Adr"});case 106:return Ne.fbt._("You're temporarily banned from WhatsApp because you sent too many messages to a broadcast list.",null,{hk:"3QZzJ1"});default:return Ne.fbt._("You're temporarily banned from WhatsApp because you may have violated our terms of service.",null,{hk:"1d1rXh"})}}_getUiAndIconCount(){switch(ze(this.state)){case xe.CLIENT_EXPIRED_DIALOG:return{ui:(0,Ue.jsx)(z.DefaultFavicon,{children:(0,Ue.jsx)(oe.default,{})}),requiresBackendCheck:!1};case xe.ANOTHER_SESSION:{let e,t;return this.state.takingOver?(e=()=>{},t=ve.default.t(208)):(e=()=>{(0,f.isMDBackend)()?this._mdReloadPageOnTakeOver():this._beginMutex(0,!0)},t=ve.default.t(163)),{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(le.default,{cancelText:Ne.fbt._("Close",null,{hk:"19Jpec"}),onCancel:window.open.bind(window,"https://www.whatsapp.com/","_self"),okText:t,onOK:e,children:ve.default.t(877)})}),requiresBackendCheck:!1}}case xe.UNSUPPORTED_TAKEOVER:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(le.default,{okText:Ne.fbt._("Refresh",null,{hk:"3gD6Jh"}),onOK:this._mdReloadPageWithUnsupportedTakeOver,children:Ne.fbt._("There is already another active WhatsApp Web tab in this browser. WhatsApp Web does not support multiple active tabs in this browser. Please use the existing tab or close it and refresh this tab.",null,{hk:"xnVvw"})})}),requiresBackendCheck:!1};case xe.TEMP_BAN:const{code:e,expire:t}=this.state.temporaryBan||{},n=this._getTemporaryBanReason(e),r=De.default.duration(t,"seconds").humanize();return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsxs)(le.default,{cancelText:ve.default.t(446),onCancel:()=>{__LOG__(2)`Banned accounts: user selected logout`,we.Socket.logout()},okText:Ne.fbt._("Learn more",null,{hk:"1L9NkE"}),onOK:window.open.bind(window,(0,S.getFaqUrl)()),children:[(0,Ue.jsx)("div",{children:n}),(0,Ue.jsx)("div",{children:ve.default.t(618,{duration:r})})]})}),requiresBackendCheck:!0};case xe.QR:return{ui:(0,Ue.jsxs)(z.DefaultFavicon,{children:[(0,Ue.jsx)(pe.ModalManagerComponent,{type:pe.ModalType},"modal-manager"),(0,Ue.jsx)(X.default,{apiCmd:this.state.apiCmd},"qr-code")]}),extraClasses:j.default.isQR,requiresBackendCheck:!0};case xe.STARTUP:case xe.SYNCING:if((0,f.isLegacyWebdBackend)())return{ui:(0,Ue.jsx)(z.DefaultFavicon,{children:(0,Ue.jsx)(he.default,{progress:this._calculateProgress()})}),requiresBackendCheck:!0};let i=(0,Ue.jsx)(ge.default,{initialLoadReady:this.state.initialLoadReady,onReady:this._handleReadyForMainScreen});return{ui:(0,Ue.jsx)(z.DefaultFavicon,{children:i}),requiresBackendCheck:!0};case xe.OFFLINE:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(fe.default,{})}),requiresBackendCheck:!0};case xe.PROXYBLOCK:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(_e.default,{})}),requiresBackendCheck:!0};case xe.CONFLICT:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(le.default,{cancelText:ve.default.t(446),onCancel:()=>we.Socket.logout(),okText:ve.default.t(163),onOK:()=>we.Socket.takeover(),children:ve.default.t(541)})}),requiresBackendCheck:!0};case xe.TOS_BLOCK:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(me.default,{description:Ne.fbt._('WhatsApp is updating our Terms and Privacy Policy to reflect new features and comply with the new European Union data protection laws. Open WhatsApp on your phone to read our Terms and Privacy Policy and learn more about the choices you have. If you have accepted the Terms and Privacy Policy, click "LOG IN" to continue using WhatsApp.',null,{hk:"4uxe2b"})})}),requiresBackendCheck:!0};case xe.SMB_TOS_BLOCK:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(me.default,{description:Ne.fbt._('We are updating our WhatsApp Business Terms of Service. Agree to our new Terms on your phone to continue using WhatsApp Business. If you have accepted the Terms of Service, click "LOG IN" to continue using WhatsApp Business.',null,{hk:"3Ti2sa"}),children:(0,Ue.jsx)(Z.default,{})})}),requiresBackendCheck:!0};case xe.DEPRECATED_VERSION:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(ce.default,{})}),requiresBackendCheck:!0};case xe.LOGOUT:return{ui:(0,Ue.jsxs)(z.DefaultFavicon,{children:[(0,Ue.jsx)(pe.ModalManagerComponent,{type:pe.ModalType},"modal-manager"),(0,Ue.jsx)(de.default,{},"logout")]}),requiresBackendCheck:!0};case xe.PRIMARY_FORCE_UPGRADE:return{ui:(0,Ue.jsx)(z.ErrorFavicon,{children:(0,Ue.jsx)(ue.default,{})}),requiresBackendCheck:!0};case xe.LOCK:return{ui:(0,Ue.jsxs)(z.DefaultFavicon,{children:[(0,Ue.jsx)(pe.ModalManagerComponent,{type:pe.ModalType},"lock-modal-manager"),(0,Ue.jsx)(Q.default,{})]}),requiresBackendCheck:!1};case xe.MAIN:const{MainComponent:a}=(0,c.default)(Be,"Main");return{ui:[(0,Ue.jsx)(w.ToastManagerComponent,{},"toast-manager"),(0,Ue.jsx)(pe.ModalManagerComponent,{contextMenuRef:this.contextMenuRef,type:pe.ModalType},"main-modal-manager"),(0,Ue.jsx)(pe.ModalManagerComponent,{type:pe.MediaType},"media-modal-manager"),(0,Ue.jsx)($.ContextMenuManager,{ref:this.contextMenuRef,type:$.Type.MENU},"context-menu-manager"),(0,Ue.jsx)($.ContextMenuManager,{type:$.Type.TOOLTIP},"tooltip-manager"),(0,Ue.jsx)(W.InitialEmojisCompletionContext.Provider,{value:W.emojiCompletionTracker,children:(0,Ue.jsx)(a,{conn:Pe.Conn,animate:this.animate})},"main")],extraClasses:j.default.isMain,requiresBackendCheck:!0}}}_getDeeplinkSessionId(){return(0,C.smbClickToChatLoggingEnabled)()?Math.floor(2147483648*Math.random()).toString():void 0}render(){!function(e){if(Ae.initialScreenTimer.hasStarted())return;const t=ze(e);if(!function(e){return e!==xe.SYNCING}(t))return;(0,Ae.setInitialScreen)(t),Ae.initialScreenTimer.start(),window.requestAnimationFrame((()=>{Ae.initialScreenTimer.end(),Ye("initialPanelRenderTRecorded")}))}(this.state);const{isKeyboardUser:e}=this.state,{ui:t,extraClasses:n,requiresBackendCheck:r}=this._getUiAndIconCount(),i=(0,Re.default)(j.default.wrapper,n,{"app-wrapper-native":I.isNative,"app-wrapper-web":I.isWeb,"safari-fix":I.hasSafariFix,"edge-fix":I.hasEdgeFix,"font-fix":I.hasFontFix,"os-ltr":I.isOSLTR,"os-rtl":I.isOSRTL,"os-mac":I.isOSMac,"os-win":I.isOSWin,"keyboard-user":e});r&&null!=Be&&!(0,k.knowsPhone)()&&Be.notificationBackend.shutdownAsNeeded();const a=ze(this.state),o=a===xe.STARTUP||a===xe.SYNCING?"loading-screen":this.state.locale;return(0,Ue.jsx)(Se.ThemeContext.Provider,{value:this._getThemeContextValue({theme:this.state.theme,systemThemeMode:this.state.systemThemeMode}),children:(0,Ue.jsx)(J.default.Provider,{value:e,children:(0,Ue.jsx)(ne.UIE,{displayName:"App",uimState:te.UIMState.INACTIVE,children:(0,Ue.jsxs)(q.HotKeys,{handlers:this._handlers,className:i,tabIndex:null,onMouseDownCapture:this._handleMouseDown,onClickCapture:this._handleClick,children:[undefined,undefined,t]},o)})})})}}He.displayName="AppImpl";const Ve=(0,ie.ListenerHOC)(He);function $e(){return($e=(0,i.default)((function*(){const[e,t]=yield Promise.all([(0,ae.requireMain)(),qe()]);Ae.mainScriptTimer.start(),Be=e(t),Ae.mainScriptTimer.end()}))).apply(this,arguments)}function ze(e){const{anotherSession:t,isUnsupportedTakeover:n,updating:r,hardExpired:i,mainLoaded:a,mode:o}=e;if((0,f.isMDBackend)()){var s;if(null===(s=e.temporaryBan)||void 0===s?void 0:s.banned)return xe.TEMP_BAN;if(e.startLogout)return xe.LOGOUT}if(r||i)return xe.CLIENT_EXPIRED_DIALOG;if(n)return xe.UNSUPPORTED_TAKEOVER;if(t)return xe.ANOTHER_SESSION;switch(o){case Ie.StreamMode.QR:return xe.QR;case Ie.StreamMode.SYNCING:return xe.SYNCING;case Ie.StreamMode.OFFLINE:return xe.OFFLINE;case Ie.StreamMode.PROXYBLOCK:return xe.PROXYBLOCK;case Ie.StreamMode.CONFLICT:return xe.CONFLICT;case Ie.StreamMode.TOS_BLOCK:return xe.TOS_BLOCK;case Ie.StreamMode.SMB_TOS_BLOCK:return xe.SMB_TOS_BLOCK;case Ie.StreamMode.DEPRECATED_VERSION:return xe.DEPRECATED_VERSION;case Ie.StreamMode.LOCK:return xe.LOCK;case Ie.StreamMode.MAIN:if(!a)return xe.STARTUP;if((0,f.isMDBackend)()){if(e.stayInSync)return xe.SYNCING;if(e.primaryForceUpgrade)return xe.PRIMARY_FORCE_UPGRADE}return xe.MAIN}throw new Error(`app:render Error invalid StreamMode: ${o}`)}function qe(){return Pe.Conn.platform?Promise.resolve(Pe.Conn.platform):new Promise((e=>{const t=()=>{const{platform:n}=Pe.Conn;null!=n&&(Pe.Conn.off("change:platform",t),e(n))};Pe.Conn.on("change:platform",t)}))}t.AppWrapper=Ve},441733:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssetLoader=void 0;const r=new(n(89721).AssetLoaderImpl);t.AssetLoader=r,window.addEventListener("dpichange",(()=>{r.loadAssetsForCurrentDpi()}))},550669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e,t,n){this.retryCount=0,this.asset=e,this.resolution=t,this.priority=n}getLoadUrlPromise(){return this._loadUrlPromise}setLoadUrlPromise(e,t){this._loadUrlPromise=e,this._loadUrlAbortController=t}abortLoadUrlPromise(){var e;null===(e=this._loadUrlAbortController)||void 0===e||e.abort()}getConsumerPromise(){return this._consumerPromise}setConsumerPromise(e){this._consumerPromise=e}getConsumerPromiseResolve(){return this._consumerPromiseResolve}setConsumerPromiseResolve(e,t){this._consumerPromiseResolve=e,this._consumerAbortController=t}abortConsumerPromise(){var e;null===(e=this._consumerAbortController)||void 0===e||e.abort()}}},95480:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!n(8425).default.supported)return;const t=!0===e.estimateStorage,r=n(125613).default,d=n(364237).default,p=navigator.serviceWorker;(0,a.detectWebpSupport)().then((t=>{const n=(0,i.default)(e.keep,(e=>[e[o.default.RES.LOW],e[o.default.RES.HIGH]])).map((e=>{var n;const r=null===(n=e[t&&e[u]?u:c])||void 0===n?void 0:n.split("/");return null!=r?r[r.length-1]:null}));(null==p?void 0:p.controller)&&r.request(p.controller,d.CLEAN_ASSETS,n).catch((()=>{}))})).then((()=>t?(0,s.default)():null)).then((e=>{e&&new l.default.WebcStorageStat({webcStorageUsage:e.usage,webcStorageQuota:e.quota}).commit()}))};var i=r(n(594654)),a=n(431645),o=r(n(930588)),s=r(n(963236)),l=r(n(11339));(0,r(n(441143)).default)(!0,"service worker builds only");const c="default",u="webp"},930588:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n={LOW:"low",HIGH:"high"},r=window.matchMedia("\n    only screen and (-webkit-min-device-pixel-ratio: 2),\n    only screen and (min-device-pixel-ratio: 2),\n    only screen and (min-resolution: 2dppx)\n"),i={RES:n,currentRes:r.matches?n.HIGH:n.LOW};r.addListener((function(e){const t=e.matches?n.HIGH:n.LOW;if(t===i.currentRes)return;i.currentRes=t;const r=document.createEvent("Event");r.initEvent("dpichange",!0,!0),window.dispatchEvent(r)}));var a=i;t.default=a},510816:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(968929)),a=r(n(402525)),o=r(n(435161)),s=r(n(873955));t.default=class{constructor(e){this.rules={},this.styleSheet=this.createStyleSheet(e)}createStyleSheet(e){const t=e||(0,s.default)("dynamic-style-");let n=document.createElement("style");return n.id=t,n.type="text/css",document.head&&document.head.appendChild(n),n=n.sheet,n}addRule(e,t){const n=this.styleSheet.cssRules.length,r=(0,o.default)(t,((e,t)=>`${t}: ${e};`)).join(" ");return this.styleSheet.insertRule(`${e} { ${r} }`,n),this.rules[e]=this.styleSheet.cssRules[n],this.rules[e]}updateRule(e,t){const n=this.rules[e];return(0,a.default)(t,((e,t)=>{n.style[(0,i.default)(t)]=e})),n}setRule(e,t){return this.rules[e]?this.updateRule(e,t):this.addRule(e,t)}}},614315:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.emojiAssetMapCreator=function(e){return t=>u(t,e)},t.getEmojiTypeFromPlatform=d;var i=r(n(252628)),a=r(n(944908)),o=r(n(288306)),s=n(513045),l=n(795885),c=n(317239);const u=(0,o.default)(((e,t)=>{const n=new Map,r=d(e),o=t[r],c=o.SELECTOR,u=Math.ceil((0,a.default)((0,i.default)(o.UNICODE_TO_EMOJI)).length/s.BUCKET_SIZE);for(let e=0;e<u;e+=1){const t=`emoji-${c}-b${e}`,i=40;n.set(t,{id:t,selectors:[`.emoji.${c}.b${e}`,`.emojik.${c}.b${e}`],low:{webp:(0,l.getEmojiSpritesPath)(r,e,i,"webp"),default:(0,l.getEmojiSpritesPath)(r,e,40,"png")},high:{default:(0,l.getEmojiSpritesPath)(r,e,64,"png"),webp:(0,l.getEmojiSpritesPath)(r,e,64,"webp")}})}return n}));function d(e){switch(e){case c.PLATFORMS.IPHONE:case c.PLATFORMS.SMBI:case c.PLATFORMS.IPAD:case c.PLATFORMS.IPOD:return s.EMOJI_TYPE.APPLE;default:return s.EMOJI_TYPE.WHATSAPP}}},978359:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emojiCompletionTracker=t.InitialEmojisCompletionContext=t.EmojiCompletionTracker=void 0;var r=n(441733),i=n(667294);class a{constructor(){var e=this;this._loadingEmojisCount=0,this._hasTriggeredEmojiPreload=!1,this._firstRun=!1,this.beginPreload=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e._hasTriggeredEmojiPreload||(e._hasTriggeredEmojiPreload=!0,window.setTimeout((()=>{r.AssetLoader.loadEmojis()}),t?1e3:0))},this.beginPreloadFallback=()=>{window.setTimeout((()=>{this.beginPreload(!1)}),5e3)},this.incrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._firstRun||(this._firstRun=!0,this._firstRunTiming=performance.now()),this._loadingEmojisCount+=1)},this.decrementLoadingEmojisCount=()=>{this._hasTriggeredEmojiPreload||(this._loadingEmojisCount-=1,0===this._loadingEmojisCount&&this._firstRun&&(this.beginPreload(!0),__LOG__(2)`EmojiCompletionTracker:firstScreenEmojis complete in ${Math.ceil(performance.now()-this._firstRunTiming)} ms`))}}}t.EmojiCompletionTracker=a;const o=new a;t.emojiCompletionTracker=o;const s=(0,i.createContext)(o);t.InitialEmojisCompletionContext=s},89721:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LOAD_PRIORITY=t.AssetLoaderImpl=void 0;var a=i(n(348926)),o=i(n(252628)),s=i(n(618446)),l=n(389385),c=n(180284),u=i(n(145095)),d=i(n(109006)),p=i(n(747259)),f=i(n(441143)),_=i(n(550669)),h=i(n(930588)),g=i(n(510816)),m=n(767247),y=n(614315),S=n(513045),E=n(107087),v=i(n(11339)),T=i(n(95480));const C={INITIAL_EMOJI_LOAD:1,INITIAL_ASSET_LOAD:2,THEME_ASSET_LOAD:2,HELP_ANIMATED_DOODLE:2,LAZY_LOAD_EMOJI:2,NOTIFICATION_ICON:2};t.LOAD_PRIORITY=C;t.AssetLoaderImpl=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:90;this._assetStyle=new g.default("asset-style"),this._requestedAssets={},this._loadingDataMap={},this._getEmojiForPlatform=null,this._currentResolution=h.default.currentRes,this._currentlyLoadingCount=0,this._queue=new d.default((e=>-e.priority)),this._hasLoggedDecrementBelowZero=!1,this.loadAssetsForCurrentDpi=()=>{const e=h.default.currentRes,t=this._currentResolution;e!==t&&(this._currentResolution=e,Object.keys(this._requestedAssets).forEach((e=>{this._cancelLoad(e,t)})),this._loadAssets((0,o.default)(this._requestedAssets),C.INITIAL_EMOJI_LOAD,{forceCheck:!1}).catch((0,l.catchAbort)((()=>{}))))},this._maxConcurrentRequests=e}initEmojiAsset(e){this._getEmojiForPlatform=e}loadInitialAssets(e){const t=new v.default.WebcAssetLoad({webcAssetName:"initial-assets",webcAssetFromCache:!1,webcAssetCacheType:v.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(e,C.INITIAL_ASSET_LOAD,{estimateStorage:!0}).then((()=>{t.markWebcAssetLoadT(),t.commit();const e=t.webcAssetLoadT;__LOG__(2)`AssetLoader:loadInitialAssets complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadInitialAssets cancelled by more recent request.`})))}loadEmoji(e,t){if(this._getEmojiForPlatform&&this._currentPlatform){const n=this._getEmojiForPlatform(this._currentPlatform),r=m.EmojiUtil.getBucket(e),i=this._getEmojiPrefix(),a=n.get(`${i}b${r}`),o=this._currentResolution;return a?this.loadAsset(a,t,!1).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader: loadEmoji Cancelled by more recent request: ${a.id}-${o}`}))):Promise.reject(new Error("The given emoji glyph id was not found"))}return Promise.reject(new Error("emojiForPlatform or currentPlatform are not set"))}loadEmojis(){const e=(0,u.default)(this._currentPlatform,"this._currentPlatform");(0,f.default)(null!=this._getEmojiForPlatform,"Emojis were loaded before initializing the emoji assets!");const t=Array.from(this._getEmojiForPlatform(e).values()),n=new v.default.WebcAssetLoad({webcAssetName:"emojis",webcAssetFromCache:!1,webcAssetCacheType:v.default.WEBC_ASSET_CACHE_TYPE_CODE.UNCACHED});this._loadAssets(t,C.INITIAL_EMOJI_LOAD,{estimateStorage:!0}).then((()=>{n.markWebcAssetLoadT(),n.commit();const e=n.webcAssetLoadT;__LOG__(2)`AssetLoader:loadEmojis complete in ${e}ms`})).catch((0,l.catchAbort)((()=>{__LOG__(2)`AssetLoader:loadEmojis cancelled by more recent request.`})))}loadAsset(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{id:i}=e,a=h.default.currentRes,o=this._requestedAssets[i];if(o&&!(0,s.default)(e,o))return Promise.reject(new Error(["Attempted to load an asset using an already used ID"].join("\n")));this._requestedAssets[i]=e,this._loadingDataMap[i]=this._loadingDataMap[i]||{};const c="high"===a?"low":"high";this._cancelLoad(i,c);const u=this._loadingDataMap[i][a];if(u&&!n)return u.promise;const d=new _.default(e,a,t),p=new r,{signal:f}=p,g=this._buildPromise(d,p).then((t=>{if(f.aborted)throw new l.AbortError;const{selectors:n}=e;return n&&this._assetStyle.setRule(`${n.join(", ")}`,{"background-image":`url('${t}')`}),t})).catch((e=>{const t=this._loadingDataMap[i][a],n=m!==t;if(n||(this._loadingDataMap[i][a]=null),e.name===l.ABORT_ERROR&&(__LOG__(2)`Asset load cancelled by more recent request: ${i}-${a}`,n&&t))return t.promise;throw e}));d.setConsumerPromise(g);const m={promise:g,abort:e=>{this._abortUrlPromise(d,e)}};return this._loadingDataMap[i][a]=m,u&&u.abort(!1),this._startLoad(),g}_buildPromise(e,t){const n=new Promise((n=>{e.setConsumerPromiseResolve(n,t),this._queue.push(e)}));return(0,p.default)(n,t.signal)}_startLoad(){if(!(this._currentlyLoadingCount>=this._maxConcurrentRequests))for(let e=0;e<this._maxConcurrentRequests-this._currentlyLoadingCount;e++){const e=this._queue.pull();if(!e)return;this._currentlyLoadingCount+=1,(0,E.loadUrl)(e).then((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()})).catch((0,l.catchAbort)((()=>{this._decrementCurrentlyLoadingCount(),this._startLoad()}))).catch((t=>{this._decrementCurrentlyLoadingCount(),e.retryCount+=1;const n=(0,c.expBackoff)(e.retryCount,12e4,1e3,.1);setTimeout((()=>{this._queue.push(e),this._startLoad()}),n),this._startLoad(),(0,E.getSupportedImageFormatUrl)(e).then((e=>{const n=e.split("/");__LOG__(3)`Asset: ${n[n.length-1]} failed. Retrying... ${t.toString()}`}))}))}}_abortUrlPromise(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.getLoadUrlPromise()){e.abortLoadUrlPromise();const n=e.getConsumerPromise();t&&n&&e.abortConsumerPromise()}this._startLoad()}_cancelLoad(e,t){var n;const r=null===(n=this._loadingDataMap[e])||void 0===n?void 0:n[t];r&&(this._loadingDataMap[e][t]=null,r.abort(!0))}setPlatform(e){if(e===this._currentPlatform)return;this._currentPlatform=e;const t=((0,y.getEmojiTypeFromPlatform)(e)===S.EMOJI_TYPE.APPLE?S.EMOJI_TYPE.WHATSAPP:S.EMOJI_TYPE.APPLE)===S.EMOJI_TYPE.APPLE?"emoji-apple-":"emoji-wa-";if(Object.keys(this._requestedAssets).forEach((e=>{e.startsWith(t)&&(this._cancelLoad(e,"high"),this._cancelLoad(e,"low"))})),null==this._getEmojiForPlatform)return;const n=Array.from(this._getEmojiForPlatform(e).values());this._loadAssets(n,C.INITIAL_EMOJI_LOAD,{forceCheck:!1})}_getEmojiPrefix(){return(0,y.getEmojiTypeFromPlatform)(this._currentPlatform)===S.EMOJI_TYPE.APPLE?"emoji-apple-":"emoji-wa-"}_loadAssets(e,t,n){var r=this;return(0,a.default)((function*(){const i=!1!==(null==n?void 0:n.forceCheck),a=!0===(null==n?void 0:n.estimateStorage),s=yield Promise.all(e.map((e=>r.loadAsset(e,t,i))));return(0,T.default)({keep:(0,o.default)(r._requestedAssets),estimateStorage:a}),s}))()}_decrementCurrentlyLoadingCount(){this._currentlyLoadingCount<=0&&!this._hasLoggedDecrementBelowZero&&(this._hasLoggedDecrementBelowZero=!0,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Tried to decrease _loadingCount below zero, would have been negative.")),this._currentlyLoadingCount=Math.max(0,this._currentlyLoadingCount-1)}}},107087:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LoadUrlError=void 0,t.getSupportedImageFormatUrl=_,t.loadUrl=function(e){const t=new r,n=_(e).then(function(){var n=(0,a.default)((function*(n){yield u.default.waitIfOffline({signal:t.signal});const r=Date.now(),i=yield(0,c.extendedFetch)(n,{signal:t.signal}),a=e.getConsumerPromiseResolve();if(!i.ok||!a)throw new f(n,i.status,Date.now()-r);a(n)}));return function(){return n.apply(this,arguments)}}());return e.setLoadUrlPromise(n,t),n};var a=i(n(348926)),o=n(640265),s=i(n(145095)),l=n(431645),c=n(589135),u=i(n(681602));const d="default",p="webp";class f extends((0,o.customError)("LoadUrlError")){constructor(e,t,n){super(`Failed to load url. StatusCode: ${t}. Duration: ${n} ms`),this.url=e,this.statusCode=t}}function _(){return h.apply(this,arguments)}function h(){return(h=(0,a.default)((function*(e){const t=yield(0,l.detectWebpSupport)(),{asset:n,resolution:r}=e,i=t&&n[r][p]?p:d;return(0,s.default)(n[r][i],"asset[resolution][format]")}))).apply(this,arguments)}t.LoadUrlError=f},384543:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Labels=function(e){const{labels:t,showName:n,renderAsCircle:r}=e,i=(0,p.default)(),m=(0,d.useMemo)((()=>h(t)),[t]);if((0,f.useListener)(null!=m?c.LabelCollection:null,`label_updated_${null!=m?m:""}`,i),!(0,a.canDisplayLabel)())return null;const y=function(e){const t=h(e);return null==t?null:c.LabelCollection.get(t)}(t);if(!y||!y.name)return null;if(1===t.length){const t=n?(0,_.jsx)("span",{className:o.default.name,children:(0,_.jsx)(s.EmojiText,{text:y.name})}):null,i=(0,u.default)({[o.default.container]:!n&&!r,[o.default.containerCircleIconFull]:!!r,[o.default.containerFull]:n&&!r,[o.default.labelFilter]:"label-filter"===e.theme,[o.default.drawerTitle]:"drawer-title"===e.theme}),a=r?{backgroundColor:y.hexColor}:{},c=r?(0,_.jsx)(l.default,{name:"label",className:o.default.icon}):g(y.hexColor);return(0,_.jsxs)("div",{className:i,children:[(0,_.jsx)("div",{className:(0,u.default)(o.default.iconContainer,{[o.default.circleIcon]:r}),style:a,children:c}),t]})}return(0,_.jsx)("div",{className:o.default.container,children:(0,_.jsxs)("svg",{width:"18px",height:"15px",viewBox:"0 0 18 15",children:[(0,_.jsx)("path",{fill:y.hexColor,d:"M11.208,3.925H2.236C1.556,3.925,1,4.565,1,5.357v7.213C1,13.362,1.556,14,2.236,14h8.972 c0.414,0,0.785-0.237,1.007-0.604l2.701-4.433L12.215,4.53C11.993,4.162,11.622,3.925,11.208,3.925z"}),(0,_.jsx)("path",{fill:"currentColor",d:"M15.541,7.832L13.164,3.93 c-0.423-0.698-1.15-1.142-1.956-1.142H2.595V2.432C2.595,1.64,3.151,1,3.831,1h9.1c0.414,0,0.782,0.237,1.005,0.605l2.696,4.433 L15.541,7.832z"})]})})},t.getVisibleLabelId=h,t.renderLabelSvg=g;var i=n(88555),a=n(408139),o=r(n(851340)),s=n(965417),l=r(n(23217)),c=n(316770),u=r(n(294184)),d=n(667294),p=r(n(859312)),f=n(587550),_=n(785893);function h(e){if(0===e.length)return;if((0,i.isLegacyWebdBackend)())return e[0];const t=Math.max(...e.map((e=>parseInt(e,10))));return isNaN(t)?e[0]:t.toString()}function g(e){return(0,_.jsx)("svg",{width:"18px",height:"12px",viewBox:"0 0 18 12",className:o.default.icon,children:(0,_.jsx)("path",{fill:e||"#ffffff",d:"M11.208,0.925H2.236C1.556,0.925,1,1.565,1,2.357V9.57C1,10.362,1.556,11,2.236,11h8.972 c0.414,0,0.785-0.237,1.007-0.604l2.701-4.433L12.215,1.53C11.993,1.162,11.622,0.925,11.208,0.925z"})},2)}},364481:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_LIST_ITEM_HEIGHT=t.MAX_REPLY_PRODUCT_TITLE_LENGTH=t.MAX_REPLY_PRODUCT_DESC_LENGTH=void 0;t.PRODUCT_LIST_ITEM_HEIGHT=96;t.MAX_REPLY_PRODUCT_TITLE_LENGTH=40;t.MAX_REPLY_PRODUCT_DESC_LENGTH=95},140682:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(914296));var a={get:()=>i.default.getFullLocale().replace("-","_")};t.default=a},129821:(e,t,n)=>{"use strict";var r=n(595318)(n(348926)),i=n(785893);function a(){return(a=(0,r.default)((function*(){var e;window.Promise=n(74121).default;const{setupLodashMemoizeCache:t}=n(248174);t(),window.__LOG__=n(739948).log,window.SEND_LOGS=n(386374).sendLogs,window.onerror=n(958955).HC,window.onunhandledrejection=n(958955).TG;const{initializePREMetrics:a}=n(460620);a();const o=n(904285).default;self.URL=self.URL||self.webkitURL,self.AudioContext=self.AudioContext||self.webkitAudioContext,self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem,n(364369).default;const{KEYS:s}=n(546718),{UA:l}=n(26741),c="1"===(null==o?void 0:o.getItem(s.LOGOUT_DIRTY_BIT)),u="true"===(null==o?void 0:o.getItem(s.MD_OPTED_IN)),d=!(null==o?void 0:o.getItem(s.LAST_WID_MD))&&!(null==o?void 0:o.getItem(s.LAST_WID)),{deleteAllIdb:p}=n(805558),{initWAWC:f}=n(120869);if(c||d&&u)try{yield p(),yield f()}catch(e){__LOG__(4,void 0,new Error,void 0,["bootstrap_qr"])`Preemptive db delete failed with error ${e}`}else try{n(739948).Logger.clearLogsPreemptive()}catch(e){}const _=new(0,n(177853).default)((null!==(e=window.location.search)&&void 0!==e?e:"").toLowerCase());c&&(null==o||o.clear(),_.set("post_logout","1"),window.location.href=`${window.location.pathname}?${_.toString()}`);const h=_.get("logout_reason");if(null!=h){(0,n(854602).setPrevLogoutReasonCode)(h)}if("1"===_.get("post_logout")||null!=h){n(376139).default.canMuckHistory()&&window.history.replaceState({},document.title,"/")}const{initModules:g}=n(756599);g();const{initWamRuntime:m}=n(977959);m();const{exeTimer:y}=n(771119);y.start();const S=n(145095).default,E=n(973935);n(667294),l.isSafari&&l.browserVersion.startsWith("13.")&&(S(document.body,"document.body").className+=" text-rendering-bug-fix"),n(694114),window.Velocity=n(512641),n(38161),window.WebFont=n(375933);const v=n(277303),T=n(722854).Z;v.set(T);const{isFunction:C}=n(551737);["getSelection","open","focus"].forEach((function(e){const t=Object.getPrototypeOf(window)[e];C(t)&&window[e]!==t&&(window[e]=t)}));const A=n(386374);window.Debug||(window.Debug={}),window.Debug.uploadLogs=A.upload;try{if(l.isLocalStorageBroken){const e=n(111554).default;yield e.loadUserIdb()}}finally{const e=n(914296).default,t=n(6103).default;e.init(t.getItemFromLocalStorage(s.LANG)).then((0,r.default)((function*(){const{Clock:e}=yield Promise.resolve().then(n.bind(n,40234));e.setIs24HourBasedOnLocale()}))),n(739948).Logger;const{App:a,hasPending:o}=n(594300);window.Debug.VERSION="2.2228.14",window.Debug.DESKTOP_BETA=!1,window.Debug.BUILD_ID="387902353";const l=n(379264).default;window.onbeforeunload=function(){{const{stopCommsBeforeUnload:t}=n(594300);if(u&&!o())try{t()}catch(e){__LOG__(4,void 0,new Error)`error while stopping comms onbeforeunload: ${e}`}if(l.isDownloading())return void l.clearDownloading();if(__LOG__(2)`webclient close/reload triggered`,__LOG__(2)`latest hash: ${"6f9c59fd5a82061eb02d756ae3f060d6c428b61e"}`,__LOG__(2)`version: ${"2.2228.14"}`,l.promptUnloadGuards>0)return;if(o())return e.t(194)}},window.addEventListener("dragover",(function(e){e.preventDefault()})),window.addEventListener("drop",(function(e){e.preventDefault()})),n(771798).loadSVGData();(0,n(521863).Z)()||(E.render((0,i.jsx)(a,{}),S(document.getElementById("app"),"document.getElementById('app')")),y.end())}if(window.navigator.serviceWorker&&!window.navigator.serviceWorker.controller)try{window.navigator.serviceWorker.register("/serviceworker.js",{scope:"/"})}catch(e){}}))).apply(this,arguments)}!function(){a.apply(this,arguments)}()},729237:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,o.jsxs)("span",{className:(0,a.default)(!e.inline&&s.block),children:[(0,o.jsx)("span",{className:(0,a.default)(s.actionText),onClick:e.action,children:e.children}),(0,o.jsx)(i.default,{className:(0,a.default)(s.chevron),directional:!0,name:"chevron-right-text"})]})};var i=r(n(23217)),a=r(n(156720)),o=n(785893);const s={block:{display:"f804f6gw"},actionText:{":hover":{textDecoration:"edeob0r2",cursor:"t94efhq2"}},chevron:{display:"l7jjieqr",marginTop:"hymafltn",marginStart:"k6y3xtnu",verticalAlign:"fewfhwl7"}}},249001:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SEARCH_FILTERS=void 0;const r=n(76672)({UNREAD:"unread",GROUP:"group",BROADCAST:"broadcast",CONTACT:"contact",NON_CONTACT:"non_contact"});t.SEARCH_FILTERS=r},446331:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ActionToast=function(e){const{settleDuration:t=f,toastPosition:n=_.LEFT,initialAction:i,pendingAction:a,id:h}=e,[g,m]=(0,u.useState)(i),[y,S]=(0,u.useState)(i),[E,v]=(0,u.useState)(!0),T=(0,d.default)(g),C=(0,u.useRef)(null),A=()=>{y&&y.handler&&y.handler().catch((()=>{}))};(0,u.useEffect)((()=>{i!==T&&(m(i),S(i),v(!0))}),[i,T]);const b=()=>{l.ToastManager.close(h)};if((0,u.useEffect)((()=>{(e=>{C.current&&C.current.controller.abort();const n=new r,i=n.signal,a=e.then((e=>{if(i.aborted)throw new o.AbortError;S(e),v(!1)})).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;S(e),v(!1)})).then((()=>(0,s.delayMs)(t))).then((()=>{if(i.aborted)throw new o.AbortError;l.ToastManager.close(h)})).catch((0,o.catchAbort)((()=>{})));C.current={promise:a,controller:n}})(a)}),[a]),!y)return null;let P,O;y.action&&y.handler&&(P=(0,p.jsx)(c.ToastActionBtn,{buttonText:y.action,onClick:A}));E||(O=(0,p.jsx)(c.ToastDismissBtn,{onClick:b}));return(0,p.jsx)(c.ToastBody,{toastPosition:n,actionText:y.text,actionBtn:P,dismissBtn:O})},t.ToastPosition=t.ActionType=void 0,t.genId=function(e){return(0,a.default)(e||"action_toast")};var a=i(n(873955)),o=n(389385),s=n(413959),l=n(694816),c=n(950452),u=n(667294),d=i(n(837453)),p=n(785893);const f=5e3,_={LEFT:"LEFT",RIGHT:"RIGHT"};t.ToastPosition=_;t.ActionType=class{constructor(e,t){if(!e)throw new Error("ActionType must have text!");this.text=e,t&&(this.action=t.actionText,this.handler=t.actionHandler)}}},948840:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.URL=void 0;t.URL="https://web.whatsapp.com/"},351650:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APICmd=void 0,t.isWAURL=function(e){return n.test(e)};t.APICmd={GROUP_INVITE:"GROUP_INVITE",MSG_SEND:"MSG_SEND",INVALID:"INVALID",CATALOG:"CATALOG",PRODUCT:"PRODUCT",PUSH_NOTIFICATION:"PUSH_NOTIFICATION"};const n=/^whatsapp:\/\/.*/i},114259:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.matchProductUrl=t.matchCatalogUrl=void 0,t.parseAPICmd=function(e){if("string"!=typeof e)return{resultType:c.APICmd.INVALID,data:void 0};const t=(e=>{let t=e.match(f);if(t)return{code:t[2],url:t[1]||"/"};if(t=e.match(_),t)return{code:t[1]};if(t=e.match(h),t)return{code:t[1]};if(t=e.match(g),t)return{code:t[1]}})(e);if(t)return{resultType:c.APICmd.GROUP_INVITE,data:t};const n=function(e){let t=e.match(R)||e.match(N);if(t)return D(t);if(t=e.match(L),t)return(0,i.default)((0,i.default)({},D(t)),{},{url:"/"})}(e);if(n)return{resultType:c.APICmd.CATALOG,data:n};const r=function(e){let t=I(e,P);if(t)return k(t);if(t=I(e,O),t)return(0,i.default)((0,i.default)({},k(t)),{},{url:"/"})}(e);if(r)return{resultType:c.APICmd.PRODUCT,data:r};const a=function(e){let t=e.match(E);if(t){const e=S(t[2]);if(e)return e.url=t[1]||"/",e}if(t=e.match(v),t)return S(t[1]);if(t=e.match(T),t)return S(t[1]);if(t=e.match(C),t){let n;if(t[1]?n={phone:`${t[1]}@c.us`}:t[2]&&(n={url:e,customURL:t[2]}),t[3]){const e=S(t[3]);e&&(n=(0,i.default)((0,i.default)({},n),e))}return n}}(e);if(a)return{resultType:c.APICmd.MSG_SEND,data:a};const o=function(e){if(e.match(w))return{url:"/"}}(e);if(o)return{resultType:c.APICmd.PUSH_NOTIFICATION,data:o};return{resultType:c.APICmd.INVALID,data:void 0}},t.parseConversionData=y;var i=r(n(81109)),a=n(108584),o=n(257243),s=r(n(177853)),l=n(948840),c=n(351650),u=n(2259);const d=(p=l.URL,p.replace(/\/+$/,"")).replace(/[\/\.]/g,"\\$&");var p;const f=new RegExp(`^${d}((?:/\\w+)*)/accept/?\\?code=(\\w+)$`,"i"),_=/^https?:\/\/chat\.whatsapp\.com\/invite\/(\w+)$/i,h=/^https?:\/\/chat\.whatsapp\.com\/(\w+)$/i,g=/^whatsapp:\/\/chat\/?\?code=(\w+)$/i,m={text:"text",phone:"phone",data:"data",source:"source",context:"context",icebreaker:"icebreaker",source_url:"source_url",jid:"jid"};function y(e){if(!e||"string"!=typeof e)return;const t=a.Binary.build(e);return t.size()>(0,o.getABPropConfigValue)("ctwa_data_max_length")?void 0:t.readBuffer()}function S(e){const t={};return new s.default(e).forEach(((e,n)=>{const r=n.toLowerCase();if(r===m.data){const n=y(e);if(!n)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionData=n}else if(r===m.source){const n=e;if((0,a.numUtf8Bytes)(n)>32)return;t.conversionTuple||(t.conversionTuple={}),t.conversionTuple.conversionSource=n}else r===m.source_url?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.sourceUrl=e):r===m.context?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.context=e):r===m.icebreaker?(t.ctwaContextLinkData=t.ctwaContextLinkData||{},t.ctwaContextLinkData.icebreaker=e):m[r]&&(t[r]=e)})),t.phone&&(t.phone=t.phone.replace(/\D/g,"")+"@c.us",t.ctwaContextLinkData&&(t.ctwaContextLinkData.phone=t.phone)),null!=t.jid&&(0,u.testLidWaMeLinkEnabled)()||null!=t.phone&&""!==t.phone||null!=t.text&&""!==t.text?t:void 0}const E=new RegExp(`^${d}((?:/\\w+)*)/send/?\\?(.+)$`,"i"),v=/^https?:\/\/api\.whatsapp\.com\/send\/?\?(.+)$/i,T=/^whatsapp:\/\/send\/?\?(.*)$/i,C=/^https?:\/\/wa\.me\/?(?:([0-9.]{0,20})|([0-9a-z.]{5,35}))?\/?\??(.+)?$/i,A=new RegExp(`^${d}(?:(?:/\\w+)*)/product/([0-9]{0,20})/([0-9]{0,20})$`,"i"),b=new RegExp(`^${d}(?:(?:/\\w+)*)/product/([^/]{0,200})/([0-9]{0,20})$`,"i"),P=[/^https?:\/\/wa\.me\/p\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([0-9]{0,20})\/([0-9]{0,20})$/i,/^https?:\/\/wa\.me\/p\/([^\/]{0,200})\/([0-9]{0,20})$/i,/^whatsapp:\/\/product\/([^\/]{0,200})\/([0-9]{0,20})$/i],O=[A,b],M=[...P,...O];function I(e,t){for(let n=0;n<t.length;n++){const r=e.match(t[n]);if(r)return r}}t.matchProductUrl=e=>null!=I(e,M);const w=new RegExp(`^${d}(?:(?:/\\w+)*)/push/`,"i"),R=/^https?:\/\/wa\.me\/c\/([0-9]{0,20})$/i,N=/^whatsapp:\/\/catalog\/([0-9]{0,20})$/i,L=new RegExp(`^${d}(?:(?:/\\w+)*)/catalog/([0-9]{0,20})$`,"i");function D(e){return{catalogOwnerJid:`${e[1]}@s.whatsapp.net`}}function k(e){return{productId:e[1],businessOwnerJid:`${e[2]}@s.whatsapp.net`}}t.matchCatalogUrl=e=>[R,N,L].some((t=>e.match(t)))},746918:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{className:t}=e;return(0,s.jsx)("div",{className:(0,a.default)((0,o.default)(l),t),children:(0,s.jsx)(i.Spinner,{size:50,stroke:3,color:"solidwhite"})})};var i=n(111054),a=r(n(294184)),o=r(n(156720)),s=n(785893);const l={position:"lhggkp7q",top:"qq0sjtgm",start:"tkdu00h0",display:"p357zi0d",alignItems:"gndfcl4n",justifyContent:"ac2vgrno",width:"ln8gz9je",height:"ppled2lx",backgroundColor:"epdck8xl",borderTopStartRadius:"g9p5wyxn",borderTopEndRadius:"i0tg5vk9",borderBottomEndRadius:"aoogvgrq",borderBottomStartRadius:"o2zu3hjb"}},39770:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{testid:t,children:n,className:r,xstyle:g,disabled:m,onClick:y,nowrap:S,spinner:E,type:v}=e;const[T,C]=(0,f.default)(y,{disabled:m}),[A,b]=(0,d.default)(),P=(0,p.default)(T,A);let O;switch(v){case"primary":O="white";break;case"secondary":case"plain-white":case"simplified":O="highlight";break;default:O="default"}m&&(O="default");return(0,_.jsx)("div",(0,i.default)((0,i.default)({},C),{},{"data-testid":t,className:(0,c.default)(a.default.button,{[a.default.primary]:"primary"===v,[a.default.secondary]:"secondary"===v,[a.default.plainWhite]:"plain-white"===v,[a.default.disabled]:m,[a.default.nowrap]:S,[a.default.simplified]:"simplified"===v,[a.default.warning]:"warning"===v,[a.default.solidWarning]:"solidWarning"===v,[a.default.strong]:"strong"===v,[a.default.strongPrimary]:"strong-primary"===v,[a.default.itemFocused]:b},r,(0,u.default)(g)),ref:P,children:(0,_.jsxs)(o.FlexRow,{align:"center",justify:"center",children:[(0,_.jsx)(s.default,{testid:"content",children:null!=n?n:null}),E?(0,_.jsx)(s.default,{testid:"spinner",xstyle:h.spinner,children:(0,_.jsx)(l.Spinner,{color:O,size:16})}):null]})}))};var i=r(n(81109)),a=r(n(144889)),o=n(429623),s=r(n(748846)),l=n(111054),c=r(n(294184)),u=r(n(156720)),d=r(n(885647)),p=r(n(778506)),f=r(n(734470)),_=n(785893);const h={spinner:{paddingStart:"mhcwslh8"}}},499360:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;const{children:n,href:r,onClick:l,title:c,className:u,tabIndex:d}=e;return(0,o.jsx)("a",{"data-testid":null!==(t=e.testid)&&void 0!==t?t:"clickable-link",className:(0,i.default)(u,(0,a.default)(s)),href:null!=r?r:void 0,onClick:e=>{null!=r&&(e.metaKey||e.altKey)||(e.preventDefault(),l(e))},role:"button",rel:"noreferrer noopener",target:"_blank",title:c,tabIndex:null!=d?d:void 0,children:n})};var i=r(n(294184)),a=r(n(156720)),o=n(785893);const s={cursor:"ajgl1lbb"}},340249:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Type=t.ContextMenuManager=void 0;var i=r(n(81109)),a=n(781572),o=r(n(540436)),s=(r(n(1691)),n(160811)),l=r(n(333358)),c=r(n(502773)),u=r(n(914296)),d=n(667294),p=n(587550),f=n(785893);const _={MENU:"MENU",TOOLTIP:"TOOLTIP"};function h(e,t){const n=(0,d.useRef)(null),r=(0,d.useRef)(null),[h,g]=(0,d.useState)(null),[y,S]=(0,d.useState)(null);(0,p.useListener)(a.Cmd,e.type===_.MENU?"open_context_menu":"open_tooltip",((e,t)=>{var n,a,o,l,c,d,p,f,_;null==h||h.uim.pop(),r.current=t;const{menuOptions:m,uim:y}=e,{event:E}=m;null==E||E.stopPropagation();const v=null==E?0:10;S(null),g((0,i.default)((0,i.default)({},m),{},{type:null!==(n=m.type)&&void 0!==n?n:s.MenuType.Dropdown,originX:null!==(a=null!==(o=null==E?void 0:E.clientX)&&void 0!==o?o:m.offsetX)&&void 0!==a?a:0,originY:null!==(l=null!==(c=null==E?void 0:E.clientY)&&void 0!==c?c:m.offsetY)&&void 0!==l?l:0,offsetX:null!==(d=m.offsetX)&&void 0!==d?d:v,offsetY:null!==(p=m.offsetY)&&void 0!==p?p:v,dirX:null!==(f=m.dirX)&&void 0!==f?f:u.default.isRTL()?s.DirX.LEFT:s.DirX.RIGHT,dirY:null!==(_=m.dirY)&&void 0!==_?_:s.DirY.BOTTOM,key:Math.random(),uim:y}))})),(0,p.useListener)(a.Cmd,e.type===_.MENU?"close_context_menu":"close_tooltip",(e=>{null!=e&&(null==h?void 0:h.uim)!==e||(g(null),S(null))})),(0,d.useLayoutEffect)((()=>{const e=n.current;if(null==h||null==e)return;if(null!=y)return;const t=e.clientWidth,r=e.clientHeight+10;S(function(e){const{anchor:t,temporaryMenuPosition:n,menuWidth:r,menuHeight:i}=e,a=window.innerWidth,o=window.innerHeight,{originX:l,originY:c,offsetX:u,offsetY:d,dirX:p,dirY:f}=n;let _=l,h=l,g=c,y=c,S=0;if(t&&t instanceof HTMLElement){const e=t.getBoundingClientRect();_=e.left,h=e.right,y=e.bottom,g=e.top,S=t.offsetWidth}let E=p;E===s.DirX.RIGHT&&_+r>a&&h-r>0?E=s.DirX.LEFT:E===s.DirX.LEFT&&h-r<0&&_+r<a?E=s.DirX.RIGHT:E===s.DirX.CENTER&&(h+r/2>a?E=s.DirX.LEFT:_-r/2<0&&(E=s.DirX.RIGHT));let v,T=f;T===s.DirY.BOTTOM&&y+i+d>o&&g-i>0?T=s.DirY.TOP:T===s.DirY.TOP&&g-0-i<0&&y+i+d<o&&(T=s.DirY.BOTTOM);v=T===s.DirY.TOP?g:y;let C=u,A=d;t||(E===s.DirX.LEFT&&(C=0),T===s.DirY.TOP&&(A=0));return{dirX:E,dirY:T,originX:m(E,_,h,S),originY:v,offsetX:C,offsetY:A}}({anchor:h.anchor,temporaryMenuPosition:h,menuWidth:t,menuHeight:r}))}),[h,y]),(0,d.useImperativeHandle)(t,(()=>({isOpen:()=>null!=h})));const E=(0,d.useCallback)((e=>{var t;null!=e&&(null===(t=r.current)||void 0===t||t.call(r,e.getElement()),r.current=null)}),[]);let v;if(null==h)v=(0,f.jsx)(o.default,{transitionName:"dropdown"});else{const{menu:e,key:t,type:r,autoFocus:i,findFirstItem:a,horizontal:c,theme:u,tooltipColorScheme:p}=h,{originX:_,originY:g,offsetX:m,offsetY:S,dirX:T,dirY:C}=null!=y?y:h,A=Array.isArray(e)?e.map((e=>(0,d.cloneElement)(e,{theme:u}))):e;v=(0,f.jsx)(o.default,{transitionName:r===s.MenuType.Picker?"dropdown-picker":"dropdown",children:(0,f.jsx)(s.Dropdown,{ref:n,origin:{x:_+m,y:g+S},type:r,dirX:T,dirY:C,horizontal:c,autoFocus:i,findFirstItem:a,isTemporaryRender:null==y,tooltipColorScheme:p,children:(0,f.jsx)(l.default,{ref:E,children:A})},`key-${t}`)})}return(0,f.jsx)(c.default.Consumer,{children:e=>(0,f.jsx)(c.default.Provider,{value:(null==h?void 0:h.uim)||e,children:v})})}t.Type=_;const g=(0,d.forwardRef)(h);function m(e,t,n,r){switch(e){case s.DirX.RIGHT:return t;case s.DirX.LEFT:return n;case s.DirX.CENTER:return t+r/2}}t.ContextMenuManager=g},611933:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Clipboard=t.APP_TEXT_MIMETYPE=void 0;var i=r(n(396026)),a=r(n(616579)),o=r(n(465345)),s=n(809964),l=n(552596),c=r(n(556695)),u=r(n(848442)),d=r(n(705818));t.APP_TEXT_MIMETYPE="application/whatsapp";class p{constructor(e){this._value=e||""}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[this.toString(),e].filter((e=>e)).join(t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._value=[e,this.toString()].filter((e=>e)).join(t),this}toString(){return this._value}}class f{static fromEl(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,s.isCopyable)(e))?(0,s.getAppTextTemplateData)(e):null;return new f("",t)}static getTemplate(e){let t=e;if(!t)return null;if(!(t instanceof HTMLElement)){if(!t.parentElement)return null;t=t.parentElement}let n=new f("${appText}"),r=t,i=5,a=0,o=!1;for(;r&&a<i;)r instanceof HTMLElement&&(0,s.isCopyable)(r)?(n=f.fromEl(r,!0).append(n.toString()),o=o||!n.isPlainText(),i=5):a++,r=r.parentElement;return o?n.toString():null}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._innerAppText=new p(e),this._appTextTemplate=t}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.append(e,t),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._innerAppText.prepend(e,t),this}isPlainText(){return Boolean(!this._appTextTemplate&&""!==this._appTextTemplate)}toString(){return this._appTextTemplate||""===this._appTextTemplate?this._appTextTemplate.replace(/\$\{appText\}/g,this._innerAppText.toString()):this._innerAppText.toString()}}class _{constructor(e,t){const n=e||"";this._plainText=new p(n),t&&(this._appText=new f(n,t))}static _copyableChildrenToClipboard(e){const t=(0,s.findCopyableChildren)(e);return(0,a.default)(t,((e,t)=>e.prepend(this.fromEl(t),"\n")),new _)}static _pruneRangeNodes(e,t,n){let r=t.cloneContents().childNodes,i=(0,d.default)(t);const a=[],o=[];for(let t=0;t<r.length;t++){const s=r[t],c=i[t].parentElement;(n||(0,l.isSelectable)(i[t])||(0,l.hasSelectableChildren)(s))&&(e.contains(i[t])||c&&c.contains(e))&&(a.push(s),o.push(i[t]))}r=a,i=o;let s=n;if(1===r.length){const e=r[0];s=s||(0,l.isSelectable)(i[0]),s||(r=(0,l.findSelectableChildren)(e,s),s=!1)}return{rangeNodes:r,parentIsSelectable:s}}static fromCopyableEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,s.getPrePlainTextData)(e)||"",r=new _(n),i=(0,s.getPlainTextData)(e),o=(0,s.getAppTextTemplateData)(e),u=new _("",o);return i||""===i?(u.appendPlainText(i),r.append(u)):t||(0,l.isSelectable)(e)?(0,c.default)(e,"br")?r.appendPlainText("\n"):((0,a.default)(e.childNodes,((e,t)=>{const n=(0,c.default)(t,"div")?"\n":"";return e.prepend(this.fromSelectableNode(t),n)}),u),r.append(u)):(u.append(this._copyableChildrenToClipboard(e)),r.append(u))}static fromEl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.isCopyable)(e)||t?this.fromCopyableEl(e,t):this._copyableChildrenToClipboard(e)}static fromNode(e,t){return e instanceof HTMLElement?this.fromEl(e,t):t?this.fromSelectableNode(e):new _}static fromRange(e,t){const n=t.commonAncestorContainer,r=f.getTemplate(n),i=new _("",r),o=(0,l.isSelectAll)(n)?n:(0,l.findSelectAllParent)(n);if(o instanceof HTMLElement)return i.append(this.fromCopyableEl(o));const{parentIsSelectable:s,rangeNodes:c}=this._pruneRangeNodes(e,t,(0,l.isSelectable)(n));return(0,a.default)(c,((e,t)=>{const n=this.fromNode(t,s),r=s||n.toAppString().endsWith("\n")?"":"\n";return e.prepend(n,r)}),i)}static fromSelectableNode(e){if((0,u.default)(e))return new _(e.textContent);if(!(e instanceof HTMLElement))return new _;const t=new _;return(0,o.default)(e,(e=>(0,u.default)(e)||(0,s.isCopyable)(e)?[]:Array.from(e.childNodes)),(n=>{let r;(0,s.isCopyable)(n)&&n instanceof HTMLElement?(r=this.fromCopyableEl(n,!0),t.append(r)):(0,u.default)(n)?t.appendPlainText(n.textContent):(0,c.default)(e,"br")&&t.appendPlainText("\n")})),t}static fromSelection(e,t){const n=new _;return(0,i.default)(t.rangeCount).map((n=>{const r=t.getRangeAt(n);return this.fromRange(e,r)})).reduce(((e,t)=>e.append(t,"\n")),n)}append(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new f(this.toPlainString()),this._appText.append(e.toAppString(),t)):this.hasAppText()&&this._appText.append(e.toAppString(),t),this._plainText.append(e.toPlainString(),t),this}appendPlainText(e){return this.append(new _(e)),this}prepend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.hasAppText()?(this._appText=this._appText||new f(this.toPlainString()),this._appText.prepend(e.toAppString(),t)):this.hasAppText()&&this._appText.prepend(e.toAppString(),t),this._plainText.prepend(e.toPlainString(),t),this}hasAppText(){return Boolean(this._appText)}toAppText(){return this.hasAppText()?this._appText:new f(this.toPlainString())}toPlainString(){return this._plainText.toString()}toAppString(){return this.hasAppText()?this._appText.toString():this.toPlainString()}}t.Clipboard=_},809964:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Copyable=t.COPYABLE_CSS_SELECTOR=t.COPYABLE_CSS_CLASS=void 0,t.CopyableCode=function(e){return(0,d.jsx)("code",(0,a.default)({},P(e)))},t.CopyableDel=function(e){return(0,d.jsx)("del",(0,a.default)({},P(e)))},t.CopyableDiv=function(e){return(0,d.jsx)("div",(0,a.default)({},P(e)))},t.CopyableEm=function(e){return(0,d.jsx)("em",(0,a.default)({},P(e)))},t.CopyableImg=void 0,t.CopyableLink=function(e){const t=P(e),n=t.href;if(n&&!o.default.hasValidUrlScheme(n))return(0,d.jsx)("span",{});return(0,d.jsx)("a",(0,a.default)({},t))},t.CopyableSpan=function(e){return(0,d.jsx)("span",(0,a.default)({},P(e)))},t.CopyableStrong=function(e){return(0,d.jsx)("strong",(0,a.default)({},P(e)))},t.CopyableUl=function(e){return(0,d.jsx)("ul",(0,a.default)({},P(e)))},t.PLAIN_TEXT_DATA_ATTR=void 0,t.findCopyableChildren=function(e){const t=Array.from(e.querySelectorAll(g));return t.filter((e=>!t.some((t=>t!==e&&t.contains(e)))))},t.getAppTextTemplateData=function(e){return e.dataset[T]},t.getPlainTextData=function(e){return e.dataset[y]},t.getPrePlainTextData=function(e){return e.dataset[E]},t.isCopyable=function(e){return e instanceof HTMLElement&&(0,l.default)(e,g)};var i=r(n(506479)),a=r(n(81109)),o=r(n(376139)),s=r(n(719198)),l=r(n(220603)),c=r(n(294184)),u=n(667294),d=n(785893);const p=["forwardedRef"],f=["element"],_=["plainText","prePlainText","appTextTemplate"],h="copyable-text";t.COPYABLE_CSS_CLASS=h;const g=".copyable-text";t.COPYABLE_CSS_SELECTOR=g;const m="data-plain-text",y=(0,s.default)(m);t.PLAIN_TEXT_DATA_ATTR=y;const S="data-pre-plain-text",E=(0,s.default)(S),v="data-app-text-template",T=(0,s.default)(v);const C=(0,u.forwardRef)(((e,t)=>{var n;let{forwardedRef:r}=e;const o=P((0,i.default)(e,p));return(0,d.jsx)("img",(0,a.default)((0,a.default)({ref:null!=r?r:t},o),{},{alt:null!==(n=o.alt)&&void 0!==n?n:""}))}));function A(e,t){let{element:n}=e,r=(0,i.default)(e,f);return(0,d.jsx)(n,(0,a.default)((0,a.default)({},P(r)),{},{ref:t}))}t.CopyableImg=C;const b=(0,u.forwardRef)(A);function P(e){let{plainText:t,prePlainText:n,appTextTemplate:r}=e,o=(0,i.default)(e,_);const s=(0,a.default)({},o);return s.className=(0,c.default)(o.className,h),null!=t&&(s[m]=t),null!=n&&(s[S]=n),null!=r&&(s[v]=r),s}t.Copyable=b},105354:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(506479)),o=n(611933),s=r(n(897922)),l=r(n(294184)),c=n(667294),u=n(785893);const d=["canCut","children","className","testid"];function p(e,t){let{canCut:n,children:r,className:o,testid:c}=e,p=(0,a.default)(e,d);const f=(0,i.default)((0,i.default)({},p),{},{className:(0,l.default)(o,s.default.noop,"copyable-area"),onCopy:h,onCut:n?g:void 0});return(0,u.jsx)("div",(0,i.default)((0,i.default)({},f),{},{ref:t,"data-testid":c,children:r}))}var f=(0,c.forwardRef)(p);function _(e){const t=e.currentTarget;if(!(t instanceof HTMLElement))return!1;const n=o.Clipboard.fromSelection(t,window.getSelection());e.clipboardData.setData("text/plain",n.toPlainString());try{e.clipboardData.setData(o.APP_TEXT_MIMETYPE,n.toAppString())}catch(e){}return!0}function h(e){_(e,window.getSelection())&&(e.stopPropagation(),e.preventDefault())}function g(e){const t=window.getSelection();_(e)&&(t.deleteFromDocument(),e.stopPropagation(),e.preventDefault(),e.target.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})))}t.default=f},552596:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Selectable=t.SELECTABLE_INPUT_CSS_CLASS=t.SELECTABLE_CSS_SELECTOR=t.SELECTABLE_CSS_CLASS=void 0,t.SelectableCode=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableCode,(0,a.default)({},t)):(0,p.jsx)("code",(0,a.default)({},t))},t.SelectableDel=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableDel,(0,a.default)({},t)):(0,p.jsx)("del",(0,a.default)({},t))},t.SelectableDiv=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableDiv,(0,a.default)({},t)):(0,p.jsx)("div",(0,a.default)({},t))},t.SelectableEm=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableEm,(0,a.default)({},t)):(0,p.jsx)("em",(0,a.default)({},t))},t.SelectableImg=void 0,t.SelectableLink=function(e){const t=M(e),n=e.href;if(n&&!o.default.hasValidUrlScheme(n))return(0,p.jsx)("span",{});return e.selectable?(0,p.jsx)(s.CopyableLink,(0,a.default)({},t)):(0,p.jsx)("a",(0,a.default)({},t))},t.SelectableSpan=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableSpan,(0,a.default)({},t)):(0,p.jsx)("span",(0,a.default)({},t))},t.SelectableStrong=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableStrong,(0,a.default)({},t)):(0,p.jsx)("strong",(0,a.default)({},t))},t.SelectableUl=function(e){const t=M(e);return e.selectable?(0,p.jsx)(s.CopyableUl,(0,a.default)({},t)):(0,p.jsx)("ul",(0,a.default)({},t))},t.createSelectableElement=function(e,t){const n=document.createElement(e);n.setAttribute("class",m),(t||""===t)&&(n.dataset[s.PLAIN_TEXT_DATA_ATTR]=t);return n},t.findSelectAllParent=function(e){if(!A(e))return null;let t,n=e,r=0;for(;n&&r<5;){if(C(n)&&n instanceof HTMLElement){t=n;break}n=n.parentElement,r++}return t},t.findSelectableChildren=function(e,t){if(!(e instanceof HTMLElement))return[];if(t||T(e))return Array.from(e.childNodes);const n=Array.from(e.querySelectorAll(y));return n.filter((e=>!n.some((t=>t!==e&&t.contains(e)))))},t.hasSelectableChildren=function(e){if(!(e instanceof HTMLElement))return!1;return!!e.querySelector(y)},t.isSelectAll=C,t.isSelectable=T;var i=r(n(506479)),a=r(n(81109)),o=r(n(376139)),s=n(809964),l=r(n(408581)),c=r(n(220603)),u=r(n(294184)),d=n(667294),p=n(785893);const f=["forwardedRef"],_=["element"],h=["className","plainText","prePlainText","appTextTemplate","selectable","selectAll"],g="selectable-text";t.SELECTABLE_CSS_CLASS=g;const m=`${s.COPYABLE_CSS_CLASS} selectable-text`,y=".selectable-text";t.SELECTABLE_CSS_SELECTOR=y;const S=m;t.SELECTABLE_INPUT_CSS_CLASS=S;const E="select-all",v=".select-all";function T(e){if(!e)return!1;if(!(e instanceof HTMLElement)){return T(e.parentElement)}return(0,c.default)(e,y)||(0,c.default)(e,".selectable-text *")}function C(e){return!!e&&(e instanceof HTMLElement?(0,c.default)(e,v):C(e.parentElement))}function A(e){return!!e&&(e instanceof HTMLElement?(0,c.default)(e,".select-all *"):A(e.parentElement))}const b=(0,d.forwardRef)(((e,t)=>{var n;let{forwardedRef:r}=e,o=(0,i.default)(e,f);const l=M(o);return o.selectable?(0,p.jsx)(s.CopyableImg,(0,a.default)({forwardedRef:t},l)):(0,p.jsx)("img",(0,a.default)((0,a.default)({ref:t},l),{},{alt:null!==(n=o.alt)&&void 0!==n?n:""}))}));function P(e,t){let{element:n}=e,r=(0,i.default)(e,_);const o=M(r);return r.selectable?(0,p.jsx)(s.Copyable,(0,a.default)((0,a.default)({element:n},o),{},{ref:t})):(0,p.jsx)(n,(0,a.default)((0,a.default)({},o),{},{ref:t}))}t.SelectableImg=b;const O=(0,d.forwardRef)(P);function M(e){let{className:t,plainText:n,prePlainText:r,appTextTemplate:a,selectable:o,selectAll:s}=e;const c=(0,i.default)(e,h);return o&&(c.plainText=n,c.prePlainText=r,c.appTextTemplate=a),c.className=(0,u.default)(t,l.default.noop,{[g]:o,[E]:o&&s}),c}t.Selectable=O},288984:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultIcon=F,t.DetailImage=function(e){const{id:t,size:n,quality:r=R.Low,loader:i,onClick:a,onLoad:s,quoted:c,shape:u,border:f,waitIdle:y,ephemeralIcon:b,theme:O,alt:I,xstyle:L}=e,D=(0,A.default)(),U=(0,T.useMemo)((()=>h.ChatCollection.get(t)),[t]);let j;(0,P.useListener)((null==U?void 0:U.isGroup)?U.groupMetadata:U,"change:ephemeralDuration",D),j="number"==typeof n?n>0?n:w.Small:null!=n?n:w.Small;const Y={height:B(j),width:B(j)};a&&(Y.cursor="pointer");let K;if((0,l.communitiesEnabled)())if(null!=U){var W;if(U.isGroup)K=null===(W=U.groupMetadata)||void 0===W?void 0:W.groupType}else{const e=m.default.get(t.toString());K=null==e?void 0:e.groupType}const H=(0,E.default)(d.default.avatar,{[d.default.status_v3]:"status_v3"===O,[d.default.avatarSquare]:u===N.Square,[d.default.avatarBorder]:f,[d.default.avatarSquircle]:u===N.Squircle,[d.default.avatarDefaultAnnouncementGroup]:K===g.GroupType.DEFAULT_ANNOUNCEMENT_GROUP,[d.default.avatarProfileRingBorder]:"status_v3_profile_photo_ring"===O,[(0,C.default)(k)]:(0,o.isIntegritySuspendedCommunity)(U),[d.default.inviteModal]:"invite_modal"===O},(0,C.default)(L)),V=(0,M.jsx)(F,{id:t,quoted:c,groupType:K}),$=(0,M.jsx)(p.default,{id:t,onComplex:()=>{let e=null;const n=S.ProfilePicThumbCollection.gadd(t);return n&&(e=r===R.High?(0,M.jsx)(G,{profilePicThumb:n,defaultIcon:V,loader:i,onLoad:s,alt:I}):(0,M.jsx)(x,{profilePicThumb:n,defaultIcon:V,loader:i,onLoad:s,alt:I})),(0,M.jsxs)("div",{className:H,style:Y,onClick:a,children:[null,e,null]})},waitIdle:y,children:(0,M.jsx)("div",{className:H,style:Y,onClick:a,children:V})});let z;null!=b&&(null==U?void 0:U.isEphemeralSettingOn())&&(z=(0,M.jsxs)("div",{className:d.default.wrapper,"aria-label":v.fbt._("Profile picture, disappearing messages on",null,{hk:"2Riroy"}),children:[(0,M.jsx)("div",{className:(0,E.default)(d.default.badge,{[d.default.chatList]:"chat-list"===b,[d.default.conversationHeader]:"conversation-header"===b}),children:(0,M.jsx)(_.default,{name:"disappearing",className:d.default.badgeIcon})}),$]}));return z||$},t.DetailImageCommon=U,t.DetailImageSize=t.DetailImageShape=t.DetailImageQuality=void 0,t.getSize=B;var i=r(n(81109)),a=n(657319),o=n(189036),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=I(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=n(408139),c=(n(978820),r(n(389867))),u=r(n(746918)),d=r(n(926306)),p=r(n(376239)),f=r(n(247065)),_=r(n(23217)),h=n(669951),g=n(455981),m=r(n(873213)),y=n(118146),S=n(582039),E=r(n(294184)),v=n(548360),T=n(667294),C=r(n(156720)),A=r(n(859312)),b=r(n(616223)),P=n(587550),O=n(735461),M=n(785893);function I(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(I=function(e){return e?n:t})(e)}const w=n(76672).Mirrored(["ExtraSmall","Small","Medium","Large","None"]);t.DetailImageSize=w;const R=n(76672).Mirrored(["Low","High"]);t.DetailImageQuality=R;const N=n(76672).Mirrored(["Circle","Square","Squircle"]);t.DetailImageShape=N;const L={color:"q3u0wlip"},D={borderTopStartRadius:"g9p5wyxn",borderTopEndRadius:"i0tg5vk9",borderBottomEndRadius:"aoogvgrq",borderBottomStartRadius:"o2zu3hjb"},k={opacity:"kaq19mkm"};function U(e){const{profilePicThumbImg:t,spinnerClassName:n,imgClassName:r,alt:o,onLoad:l,profilePicThumb:c,loader:p=!1,theme:_}=e,[h,g]=(0,T.useState)(!0),[m,S]=(0,T.useState)(!1),[v,C]=(0,T.useState)(!1),[A,P]=(0,T.useState)(t),O=(0,T.useRef)(!1),I="business"!==_,w=(0,b.default)((()=>p&&I?new a.ShiftTimer((()=>{C(!0)})):null));t!==A&&(P(t),g(!0),S(!1),C(!1));const R=()=>{var e;null===(e=w.current)||void 0===e||e.cancel(),g(!1),S(!0),null==l||l()},N=e=>{var t;if(null===(t=w.current)||void 0===t||t.cancel(),e instanceof s.ServerStatusError)switch(e.status){case 403:c.markStale({eurl:!0}),O.current||(O.current=!0,c.validate());break;case 410:c.markStale()}g(!1),S(!1)};(0,T.useEffect)((()=>{var e;const t=w;return null===(e=t.current)||void 0===e||e.onOrAfter(100),()=>{var e;null===(e=t.current)||void 0===e||e.cancel()}}),[c,w]);let L={[d.default.isLoaded]:!h};r&&(L=(0,i.default)((0,i.default)({},L),{},{[r]:"string"==typeof r}));const D=(0,E.default)(d.default.avatarImage,L);let k,U;!I||!p||!v||!h||!(0,y.unproxy)(c).stale&&!A||(k=(0,M.jsx)(u.default,{className:n},"spinner")),A&&(U=(0,M.jsx)(f.default,{src:A,hasPrivacyChecks:!0,crossOrigin:!1,className:D,draggable:!1,onLoad:R,onError:N,alt:o},"image"));const G=m?null:e.defaultIcon;return(0,M.jsxs)(M.Fragment,{children:[k,G,U]})}function G(e){const t=(0,O.useModelValues)(e.profilePicThumb,["imgFull"]);return(0,M.jsx)(U,(0,i.default)((0,i.default)({},e),{},{profilePicThumbImg:t.imgFull}))}function x(e){const t=(0,O.useModelValues)(e.profilePicThumb,["img"]);return(0,M.jsx)(U,(0,i.default)((0,i.default)({},e),{},{profilePicThumbImg:t.img}))}function B(e){if("string"!=typeof e)return e;switch(e){case w.ExtraSmall:return 40;case w.Small:return 49;case w.Medium:return 100;case w.Large:return 200;case w.None:return}}function F(e){let t,{id:n,quoted:r,groupType:i}=e,a="default-user";c.default.isUser(n)&&!c.default.isPSA(n)&&r?a="default-user-square":c.default.isGroup(n)?i===g.GroupType.DEFAULT_ANNOUNCEMENT_GROUP?(a="announcement-speaker",t=L):a=i===g.GroupType.COMMUNITY?"community-squircle":"default-group":c.default.isBroadcast(n)?a="default-broadcast":c.default.isPSA(n)&&(a="default-psa",t=D);return(0,M.jsx)("div",{className:d.default.avatarDefault,children:(0,M.jsx)(_.default,{name:a,iconXstyle:t})},"default")}},719198:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e.replace(/^data-/,""))};var i=r(n(968929))},556695:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e instanceof HTMLElement&&e.tagName.toLowerCase()===t.toLowerCase()}},220603:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!(e instanceof HTMLElement))return!1;return n.call(e,t)};const n=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector},848442:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Boolean(e&&3===e.nodeType)}},705818:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(e.collapsed)return[];if(e.startContainer===e.endContainer)return(0,i.default)(e.startContainer)?[e.startContainer]:Array.prototype.slice.call(e.startContainer.childNodes,e.startOffset,e.endOffset);const t=e.commonAncestorContainer.childNodes;let n,r;n=e.commonAncestorContainer===e.startContainer?t[0]:o(e.commonAncestorContainer,e.startContainer);(0,a.default)(n,"range is invalid: start missing"),r=e.commonAncestorContainer===e.endContainer?t[t.length-1]:o(e.commonAncestorContainer,e.endContainer);(0,a.default)(r,"range is invalid: end missing");const s=r,l=e=>null==e?void 0:e.nextSibling,c=[];let u=n;for(;u&&u!==s;)c.push(u),u=l(u)||l(u.parentNode);return c.push(s),c};var i=r(n(848442)),a=r(n(441143));function o(e,t){let n=t;for(;n.parentNode!==e;){if(!n.parentNode)return null;n=n.parentNode}return n}},160811:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TooltipColorScheme=t.REACTION_DETAILS_WIDTH=t.MenuType=t.EMOJI_PICKER_WIDTH=t.Dropdown=t.DirY=t.DirX=void 0;var i=r(n(81109)),a=r(n(145095)),o=n(781572),s=n(581703),l=r(n(145120)),c=r(n(352013)),u=r(n(423257)),d=r(n(914296)),p=n(729424),f=r(n(294184)),_=n(667294),h=r(n(778506)),g=r(n(895402)),m=n(785893);const y=parseInt(u.default["-emoji-picker-width"].replace(/px$/,""),10);t.EMOJI_PICKER_WIDTH=y;const S=parseInt(u.default["-reaction-details-width"].replace(/px$/,""),10);t.REACTION_DETAILS_WIDTH=S;const E=n(76672).Mirrored(["Dropdown","DropdownMenu","DropdownText","AttachMenu","Picker","EmojiPicker","StickerPicker","ColorPicker","Tooltip","ReactionDetailsPane","ReactionSendTray","ReactionPicker"]);t.MenuType=E;const v=n(76672).Mirrored(["Default","Highlight"]);t.TooltipColorScheme=v;const T=n(76672).Mirrored(["LEFT","CENTER","RIGHT"]);t.DirX=T;const C=n(76672).Mirrored(["TOP","BOTTOM"]);function A(e){switch(e){case T.RIGHT:return T.LEFT;case T.LEFT:return T.RIGHT;case T.CENTER:return T.CENTER}}function b(e,t,n){return e!==T.CENTER||null==t||null==n?null:{left:t.offsetWidth/2-n.offsetWidth/2}}t.DirY=C;const P=(0,_.forwardRef)(((e,t)=>{const{type:n=E.Dropdown,dirX:r=T.RIGHT,dirY:y=C.BOTTOM,children:S,flipOnRTL:P,origin:M,style:I,horizontal:w,isTemporaryRender:R,autoFocus:N,findFirstItem:L,onDefault:D,testid:k,tooltipColorScheme:U}=e,[G,x]=(0,_.useState)(!1),[B,F]=(0,_.useState)(null),j=(0,_.useRef)(null),Y=(0,_.useRef)(),K=(0,_.useRef)(),W=(0,h.default)(t,j),H=(0,g.default)(),V=(0,_.useMemo)((()=>n!==E.EmojiPicker&&n!==E.ReactionDetailsPane&&n!==E.ReactionSendTray&&n!==E.StickerPicker&&n!==E.ColorPicker&&n!==E.ReactionPicker&&n!==E.DropdownText),[n]);(0,_.useEffect)((()=>{if(V)if(N){var e;const t=null===(e=K.current)||void 0===e?void 0:e.querySelector("[tabindex]");let n;L&&t||K.current&&K.current.firstChild instanceof HTMLDivElement&&t?n=t:K.current&&K.current.children.length>0?n=K.current.children[0]:null!=S&&(n=_.Children.toArray(S)[0]),c.default.focus(n),x(!0),F(n)}else c.default.focus(j.current)}),[]),(0,_.useEffect)((()=>{K.current&&j.current&&!R&&o.Cmd.floaterEscapeOverlap(j.current,10)}),[R]);const $=(0,_.useMemo)((()=>{const e={},t=null!=I?I:{},[n,a]=function(e,t,n){return[n&&d.default.isRTL()?A(e):e,t]}(r,y,P);if(e[(0,s.compatPrefix)("transformOrigin")]=function(e,t){const n=A(e);return`${t===C.TOP?C.BOTTOM:C.TOP} ${n}`}(n,a),!M)return(0,i.default)((0,i.default)({},t),e);const o=function(e,t,n,r){var i,a;const o={};switch(e){case T.RIGHT:o.left=Math.min(window.innerWidth-(null!==(i=null==r?void 0:r.offsetWidth)&&void 0!==i?i:0)-32,n.x);break;case T.LEFT:o.right=window.innerWidth-n.x;break;case T.CENTER:o.left=n.x-(null!==(a=null==r?void 0:r.offsetWidth)&&void 0!==a?a:0)/2,o.marginLeft=0,o.marginRight=0}switch(t){case C.BOTTOM:{o.top=n.y;const e=null==r?void 0:r.offsetHeight;if(null!=e){const t=window.innerHeight-e-32;o.top=Math.min(t,n.y)}break}case C.TOP:o.bottom=window.innerHeight-n.y}return o}(n,a,M,j.current);return(0,i.default)((0,i.default)((0,i.default)({},t),e),o)}),[r,y,P,M,I]),z=()=>{c.default.focus(j.current),x(!1)},q=(e,t)=>{const n=(t<0?e.length-1:t)%e.length;c.default.focus(e[n]),x(!0),F(e[n])},J=()=>{const e=Array.from((0,a.default)(K.current,"listRef.current").querySelectorAll("li:not(.dropdown-item-disabled)"));return{activeChildren:e,currentlyFocusedIndex:e.indexOf(B)}},Q=e=>{O(e);const{activeChildren:t,currentlyFocusedIndex:n}=J();0!==t.length&&q(t,n-1)},X=e=>{O(e);const{activeChildren:t,currentlyFocusedIndex:n}=J();0!==t.length&&q(t,n+1)},Z=e=>{e.preventDefault(),null==H||H.requestDismiss()},ee=e=>{D&&(l.default.shouldIndicateFocus(),null==H||H.requestDismiss(),D(e))},te=e=>{e.stopPropagation(),c.default.focus(j.current),F(void 0)},ne=(0,f.default)({[u.default.container]:n===E.Dropdown||n===E.DropdownMenu||n===E.EmojiPicker||n===E.StickerPicker||n===E.ColorPicker||n===E.ReactionDetailsPane||n===E.ReactionSendTray||n===E.ReactionPicker||n===E.DropdownText,[u.default.right]:n===E.DropdownMenu,[u.default.attachMenu]:n===E.AttachMenu,[u.default.picker]:n===E.Picker,[u.default.emoji]:n===E.EmojiPicker,[u.default.sticker]:n===E.StickerPicker,[u.default.colorPicker]:n===E.ColorPicker,[u.default.reactionDetails]:n===E.ReactionDetailsPane,[u.default.reactionSendTray]:n===E.ReactionSendTray,[u.default.reactionPicker]:n===E.ReactionPicker,[u.default.text]:n===E.DropdownText,[u.default.tooltip]:n===E.Tooltip,[u.default.tooltipHighlight]:U===v.Highlight,[u.default.inverse]:(n===E.Picker||n===E.EmojiPicker||n===E.StickerPicker||n===E.ColorPicker||n===E.ReactionDetailsPane||n===E.ReactionSendTray||n===E.ReactionPicker||n===E.DropdownText||n===E.Tooltip)&&r===T.LEFT,[u.default.inverseVertical]:(n===E.EmojiPicker||n===E.StickerPicker||n===E.ColorPicker||n===E.ReactionDetailsPane||n===E.ReactionSendTray||n===E.ReactionPicker||n===E.DropdownText)&&y===C.TOP}),re=n===E.Picker||n===E.EmojiPicker||n===E.StickerPicker||n===E.DropdownText||n===E.Tooltip?(0,m.jsx)("div",{"data-testid":"tooltip-nib",ref:Y,className:u.default.nib,"data-animate-dropdown-nib":!0,style:b(r,j.current,Y.current)}):null;if(V){const e={enter:ee,tab:O,"shift+tab":O,up:()=>{},down:()=>{}};return w?(e[d.default.LR("left","right")]=Q,e[d.default.LR("right","left")]=X,e[d.default.LR("up","down")]=Q,e[d.default.LR("down","up")]=X):(n===E.AttachMenu?(e.up=X,e.down=Q):(e.up=Q,e.down=X),e[d.default.LR("left","right")]=Z,e[d.default.LR("right","left")]=ee),(0,m.jsxs)(p.HotKeys,{ref:W,handlers:e,className:ne,style:$,onMouseMove:G?z:null,onMouseUp:te,children:[(0,m.jsx)("ul",{"data-testid":k,ref:K,className:u.default.items,children:S}),re]})}return(0,m.jsxs)("div",{ref:W,className:ne,style:$,"data-testid":k,children:[S,re]})}));function O(e){e.stopPropagation(),e.preventDefault()}t.Dropdown=P,P.displayName="Dropdown"},471174:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DropdownItem=function(e){const{children:t,tooltip:n,type:r="text",disabled:c=!1,theme:g,action:m,testid:y,tabIndex:S,addSpacing:E=!1,ariaLabel:v}=e,[T,C]=(0,u.useState)(!1),[A,b]=(0,u.useState)(!1),P=(0,p.default)(),O=e=>{if(!m)return;!1===m(e)||P&&P.requestDismiss()},M=e=>{e.repeat||O(e)},I=(T||A)&&null!=n?n:null,w=(0,o.isStringOrFbt)(t)||E?(0,f.jsx)("div",{className:(0,l.default)(a.default.ellipsify,a.default.action,{[a.default.compact]:g===_.COMPACT},(0,d.default)(e.xstyle)),role:"button","aria-label":null!=v?v:t,children:t}):t,R=(0,l.default)(a.default.item,a.default.shortcut,{[a.default.hover]:T||A,[a.default.text]:"text"===r,[a.default.emoji]:"emoji"===r||"emoji-grid"===r||"emoji-preview"===r,[a.default.emojiGrid]:"emoji-grid"===r,[a.default.emojiPreview]:"emoji-preview"===r,[a.default.icon]:"icon"===r,[a.default.disabled]:c||g===_.MUTED}),N=c?{}:{handlers:{enter:M,space:M},onContextMenu:h,onMouseDown:h,onClick:e=>{O(e)},onMouseEnter:()=>{C(!0)},onMouseLeave:()=>{C(!1)},onFocus:()=>{b(!0)},onBlur:()=>{b(!1)}};return(0,f.jsxs)(s.HotKeys,(0,i.default)((0,i.default)({component:"li",className:R,"data-animate-dropdown-item":!0,"data-testid":y,tabIndex:null!=S?S:0},N),{},{children:[w,(0,f.jsx)("div",{children:I})]}))},t.ThemeOptions=void 0;var i=r(n(81109)),a=r(n(919328)),o=n(712733),s=n(729424),l=r(n(294184)),c=r(n(566919)),u=n(667294),d=r(n(156720)),p=r(n(895402)),f=n(785893);const _=(0,c.default)({COMPACT:null,MUTED:null});function h(e){e.preventDefault()}t.ThemeOptions=_},684636:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,u.useContext)(s.InitialEmojisCompletionContext);(0,u.useEffect)((()=>{const n=f(e.emoji);null!=n&&(t.incrementLoadingEmojisCount(),o.AssetLoader.loadEmoji(n,a.LOAD_PRIORITY.LAZY_LOAD_EMOJI).finally((()=>{t.decrementLoadingEmojisCount()})))}),[t,e.emoji]);const{className:n,element:r,emoji:l,selectable:g,selected:m,size:y,src:S,onLoad:E,tabIndex:v,xstyle:T}=e,C=f(l);if(null==C)return null;let A,b;S||(A=_(C,y),b=h(C,y));const P=(0,c.default)(n,b,{selected:m},(0,d.default)(T));if("span"===r)return(0,p.jsx)("span",{"data-testid":l,"data-emoji":l,className:P,"aria-label":l,style:A,onLoad:E,tabIndex:v,"data-unicode":e["data-unicode"],"data-variant":e["data-variant"],"data-emoji-index":e["data-emoji-index"]});return(0,p.jsx)(i.default,{alt:l,className:P,draggable:!1,onLoad:E,plainText:l,selectable:g,style:A,src:S})};var i=r(n(247065)),a=n(89721),o=n(441733),s=n(978359),l=n(767247),c=r(n(294184)),u=n(667294),d=r(n(156720)),p=n(785893);const{getGlyphId:f,getStyle:_,getCssClasses:h}=l.EmojiUtil},965417:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiText=t.EMOJI_SIZE=void 0;var i=r(n(81109)),a=r(n(23279)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(293131)),s=r(n(145095)),l=n(781572),c=n(26741),u=n(552596),d=r(n(914296)),p=n(767247),f=n(130695),_=r(n(80691)),h=r(n(810577)),g=n(184387),m=r(n(294184)),y=n(667294),S=r(n(156720)),E=n(785893);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}const T={breakWord:{wordBreak:"cw3vfol9"},clickable:{cursor:"ajgl1lbb",":hover":{textDecoration:"edeob0r2"}},dirMismatch:{display:"f804f6gw",width:"ln8gz9je"},ellipsify:{flexGrow:"ggj6brxn",overflowX:"gfz4du6o",overflowY:"r7fjleex",position:"g0rxnol2",textOverflow:"lhj4utae",whiteSpace:"le5p0ye3"},inlineblock:{display:"l7jjieqr"},multiline:{whiteSpace:"i033jvx7"},preformatted:{whiteSpace:"ag95hn57",width:"boenfpwf",display:"l7jjieqr"}},C={SMALL:"SMALL",LARGE:"LARGE"};t.EMOJI_SIZE=C;const A=4096;function b(e){return p.EmojiUtil.containsEmoji(e.substring(0,A))}class P extends y.PureComponent{constructor(){super(...arguments),this.state={text:String(this.props.text||""),ellipsified:null},this.refContainer=(0,y.createRef)(),this._registeredListener=!1,this._recompute=(0,a.default)((()=>{this.setState({ellipsified:null},this.ellipsify)}),10),this._buildBidiModel=e=>e.reduce(((e,t)=>{if("string"==typeof t){const n=t.split(/(\r?\n|\r)/g).map((e=>({dir:o.dir(e),content:e})));return e.concat(n)}return e.push({content:t}),e}),[]),this.ellipsify=()=>{const e=this.refContainer.current;if(!e)return;const t=(0,s.default)(e.parentElement,"node.parentElement"),n=e.querySelectorAll("img");if(!n.length)return;const r=e.clientWidth;e.style.overflow="visible";const i=e.clientWidth!==r;if(e.style.overflow="hidden",!i)return;const a=Boolean(d.default.isRTL())===Boolean(this.props.dirMismatch),o=n[function(e,t,n){let r=0;for(;r<e.length;){const i=e[r];if(n&&i.offsetLeft+i.clientWidth>=t)break;if(!n&&i.offsetLeft<=t)break;r++}return r}(n,a?t.clientWidth-function(e,t){let n=0;const{childNodes:r}=e;for(let e=0;e<r.length;e++){const i=r[e];if(i===t)break;n+=i instanceof Element?i.clientWidth:0}return n}(t,e)-12:12,a)];this.setState({ellipsified:M(e,o)})},this._ellipsifyCheck=()=>b(this.state.text)&&this.ellipsify(),this._explodeOutputByLines=(e,t)=>{const{direction:n}=this.props,r=[],i=this._buildBidiModel(e);let a=[],o=n;"auto"!==n&&"inherit"!==n||(o=null);const s=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=null==o||null==n||o===n,s=i?null:o,l=!i||"rtl"===o!==d.default.isRTL(),c=l?(0,S.default)(T.dirMismatch):null;r.push((0,E.jsxs)("span",{dir:s,className:c,children:[a,t?"…":null]},e))};for(let e=0;e<i.length;e++){const t=i[e];o!==t.dir&&null!=o&&void 0!==t.dir&&(s(e),a=[]),void 0!==t.dir&&(o=t.dir),a.push(t.content)}return s(i.length,t),r},this._registerResizeListener=()=>{this._registeredListener||(this._registeredListener=!0,this.props.listeners.add(window,"resize",this._recompute),this.props.listeners.add(l.Cmd,"resize",this._recompute))},this.componentDidMount=()=>{!c.UA.supportsEmojiEllipsification&&this.props.ellipsify&&b(this.state.text)&&this._registerResizeListener(),!c.UA.supportsEmojiEllipsification&&this.props.ellipsify&&this._ellipsifyCheck()},this._unregisterResizeListener=()=>{this._registeredListener&&(this._registeredListener=!1,this.props.listeners.remove(window,"resize",this._recompute),this.props.listeners.remove(l.Cmd,"resize",this._recompute))},this.render=()=>{if(!this.state.text)return null;const{onClick:e,ellipsify:t,dirMismatch:n,inferLinesDirection:r,inlineblock:i,direction:a,textLimit:o,multiline:s,preformatted:l,breakWord:c,emojiXstyle:d}=this.props,p=this.state.ellipsified?this.state.ellipsified:this.state.text,g="inherit"===a?null:a||"auto",y=!!this.props.selectable,v=this.props.formatters||f.Configuration.EmojiOnly({selectable:y,emojiXstyle:d});let C=o||1/0;t&&p.length>A&&C>A&&(C=A);const b=(0,m.default)(this.props.className,(0,S.default)(!!t&&T.ellipsify,!!i&&T.inlineblock,!!e&&T.clickable,n&&!r&&T.dirMismatch,s&&T.multiline,l&&T.preformatted,c&&T.breakWord,this.props.xstyle)),P=(0,_.default)(p,v,h.default,void 0,C),O=!!this.state.ellipsified||p.length>C,M=this.props.inferLinesDirection?this._explodeOutputByLines(P,O):P;return(0,E.jsx)(u.Selectable,{"data-testid":this.props.testid,className:b,dir:g,element:this.props.element,onClick:e,ref:this.refContainer,selectable:y,title:this.props.titlify?this.state.text:void 0,children:M})}}getContainerElement(){return this.refContainer.current}static getDerivedStateFromProps(e,t){var n;let r=null;const a=String(null!==(n=e.text)&&void 0!==n?n:"");return a!==t.text&&(r={text:a}),c.UA.supportsEmojiEllipsification||!e.ellipsify||null==r||b(a)||(r=(0,i.default)((0,i.default)({},r),{},{ellipsified:null})),r}getWidth(){const e=this.refContainer.current;return e?e.getBoundingClientRect().width:0}componentDidUpdate(e,t){!c.UA.supportsEmojiEllipsification&&this.props.ellipsify&&t.text!==this.state.text&&(b(this.state.text)?(this._recompute(),this._registerResizeListener()):this._unregisterResizeListener())}componentWillUnmount(){this._recompute.cancel()}}P.defaultProps={element:"span",emojiSize:C.SMALL,textLimit:1/0};const O=(0,g.ListenerHOC)(P);function M(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{found:!1};if(e===t)return n.found=!0,"";if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;const r=I(e);let i="",a=0;for(;a<e.childNodes.length&&(i+=M(e.childNodes[a],t,n),!n.found);)a++;if(null==r)return i;const[o,s]=r;return`${o}${i}${s}`}function I(e){if(e instanceof Element)switch(e.tagName){case"CODE":return["```","```"];case"STRONG":return["*","*"];case"EM":return["_","_"];case"DEL":return["~","~"];case"LI":return["* ",""];default:return null}return null}t.EmojiText=class extends O{getWidth(){return this.getComponent().getWidth()}getContainerElement(){return this.getComponent().getContainerElement()}}},912591:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WINDOWS_STORE_URI=t.ExternalLink=void 0,t.openExternalLink=function(e){if(e!==_&&!o.default.hasValidUrlScheme(e))return void(e.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${e}`,SEND_LOGS("URL error")));const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.style.display="none",document.body&&document.body.appendChild(t);t.click(),document.body&&document.body.removeChild(t)};var i=n(164331),a=r(n(364369)),o=r(n(376139)),s=(r(n(677793)),r(n(254889))),l=r(n(294184)),c=n(667294),u=r(n(156720)),d=n(785893);function p(e){const t=(0,c.useRef)(),n=e=>{var n;(0,s.default)(e)&&(null===(n=t.current)||void 0===n||n.click())},{children:r,className:p,href:f,isLongTemplateUrl:_,onClick:h,testid:g,"aria-label":m,xstyle:y}=e;if(!o.default.hasValidUrlScheme(f))return f.toLowerCase().startsWith("javascript:")&&(__LOG__(4,void 0,new Error,!0)`Bad url: ${f}`,SEND_LOGS("URL error")),null;const S=(0,l.default)(p,(0,u.default)(y));return _?(0,d.jsxs)("a",{ref:t,rel:"noopener noreferrer",className:S,href:f,target:"_blank",onClick:h,onKeyDown:n,"aria-label":m,children:[(0,i.substring)(f,0,a.default.TEMPLATE_URL_START),(0,d.jsx)("span",{children:"…"}),(0,i.substring)(f,f.length-a.default.TEMPLATE_URL_END,f.length)]}):(0,d.jsx)("a",{ref:t,rel:"noopener noreferrer",className:S,href:f,target:"_blank",onClick:h,onKeyDown:n,"data-testid":g,"aria-label":m,children:r})}const f=(0,c.memo)(p);t.ExternalLink=f;const _="ms-windows-store://pdp/?productid=9nksqgp7f2nh";t.WINDOWS_STORE_URI=_},624113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultFavicon=function(e){let{children:t}=e;return(0,i.useEffect)((()=>{(0,r.setTitleAndIcon)(0)}),[]),t},t.ErrorFavicon=function(e){let{children:t}=e;return(0,i.useEffect)((()=>{(0,r.setTitleAndIcon)(-1)}),[]),t};var r=n(311728),i=n(667294)},429623:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.FlexRow=t.FlexContainer=t.FlexColumn=void 0;var i=r(n(81109)),a=r(n(506479)),o=r(n(294184)),s=n(667294),l=r(n(156720)),c=n(785893);const u=["testid","align","as","direction","justify","wrap","children","className","xstyle","style"],d={flex:{display:"p357zi0d",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},directionHorizontal:{flexDirection:"sap93d0t"},directionVertical:{flexDirection:"f8m0rgwh"},directionHorizontalReverse:{flexDirection:"v76qf5v1"},directionVerticalReverse:{flexDirection:"qzvtbs9h"},justifyStart:{justifyContent:"fhf7t426"},justifyCenter:{justifyContent:"ac2vgrno"},justifyEnd:{justifyContent:"kcgo1i74"},justifyAll:{justifyContent:"o4u7okr9"},justifyAround:{justifyContent:"j1p1mz06"},justifyEvenly:{justifyContent:"s1e5xcja"},alignCenter:{alignItems:"gndfcl4n"},alignStart:{alignItems:"r15c9g6i"},alignEnd:{alignItems:"r6jd426a"},alignStretch:{alignItems:"elxb2u3l"},alignBaseline:{alignItems:"e4eao3g2"},wrap:{flexWrap:"lkhkxwyq"},wrapReverse:{flexWrap:"ns59xd2u"}},p=(0,s.forwardRef)((function(e,t){const{testid:n,align:r="start",as:s="div",direction:p,justify:f="start",wrap:_="nowrap",children:h,className:g,xstyle:m,style:y}=e,S=(0,a.default)(e,u);return(0,c.jsx)(s,(0,i.default)((0,i.default)({className:(0,o.default)((0,l.default)(d.flex,"start"===f&&d.justifyStart,"center"===f&&d.justifyCenter,"end"===f&&d.justifyEnd,"all"===f&&d.justifyAll,"around"===f&&d.justifyAround,"evenly"===f&&d.justifyEvenly,"vertical"===p&&d.directionVertical,"horizontal"===p&&d.directionHorizontal,"vertical-reverse"===p&&d.directionVerticalReverse,"horizontal-reverse"===p&&d.directionHorizontalReverse,"start"===r&&d.alignStart,"center"===r&&d.alignCenter,"end"===r&&d.alignEnd,"stretch"===r&&d.alignStretch,"baseline"===r&&d.alignBaseline,"wrap"===_&&d.wrap,"wrap-reverse"===_&&d.wrapReverse,m),g),ref:t,style:y,"data-testid":n},S),{},{children:h}))}));t.FlexContainer=p,p.displayName="FlexContainer";const f=(0,s.forwardRef)((function(e,t){return(0,c.jsx)(p,(0,i.default)((0,i.default)({},e),{},{direction:"horizontal",ref:t,children:e.children}))}));t.FlexRow=f,f.displayName="FlexRow";const _=(0,s.forwardRef)((function(e,t){return(0,c.jsx)(p,(0,i.default)((0,i.default)({},e),{},{direction:"vertical",ref:t,children:e.children}))}));t.FlexColumn=_,_.displayName="FlexColumn"},748846:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(215206)),o=n(667294),s=r(n(156720)),l=n(785893);const c={flexItem:{flexGrow:"tvf2evcx",flexShrink:"m0h2a7mj",flexBasis:"lb5m6g5c",order:"j7l1k36l",minWidth:"ktfrpxia",minHeight:"nu7pwgvd"},alignAuto:{alignSelf:"gjuq5ydh"},alignStart:{alignSelf:"ex3gcxaf"},alignCenter:{alignSelf:"o2es7gts"},alignEnd:{alignSelf:"rwlvdxyg"},alignStretch:{alignSelf:"l33m68ws"}},u=(0,o.forwardRef)((function(e,t){const{testid:n,align:r="auto",as:o="div",basis:u,xstyle:d,children:p,order:f,grow:_,shrink:h,style:g}=e,m={flexBasis:"string"==typeof u||null==u?u:`${u}px`,flexGrow:_,flexShrink:h,order:f};return(0,l.jsx)(o,{className:(0,s.default)(c.flexItem,"auto"===r&&c.alignAuto,"start"===r&&c.alignStart,"center"===r&&c.alignCenter,"end"===r&&c.alignEnd,"stretch"===r&&c.alignStretch,d),"data-testid":n,ref:t,style:(0,i.default)((0,i.default)({},g),(0,a.default)(m)),children:p})}));u.displayName="FlexItem";var d=u;t.default=d},376239:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{children:t,onComplex:n,waitIdle:r,id:u}=e,[d,p]=(0,o.useState)((()=>i.UIBusyTasks.isBusy())),f=()=>{p(!1)},_=(0,s.default)((()=>r?i.UIBusyTasks.enqueue(f):null)),h=(0,l.default)(u);return(0,o.useEffect)((()=>()=>{r&&null!=_.current&&i.UIBusyTasks.dequeue(_.current)}),[]),(0,o.useEffect)((()=>{if(!a.default.equals(h,u)||!r){d&&null!=_.current&&i.UIBusyTasks.dequeue(_.current);const e=i.UIBusyTasks.isBusy();e&&r&&(_.current=i.UIBusyTasks.enqueue(f)),p(e)}}),[u,_,d,h,r]),d&&r?(0,c.jsx)(c.Fragment,{children:t}):n()};var i=n(930764),a=r(n(389867)),o=n(667294),s=r(n(616223)),l=r(n(837453)),c=n(785893)},247065:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(389385),a=n(450796),o=r(n(364369)),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=r(n(376139)),c=r(n(997827)),u=r(n(72668)),d=n(552596),p=r(n(890012)),f=n(667294),_=n(785893);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}const g=new u.default;class m extends f.Component{static getDerivedStateFromProps(e,t){return e.src!==t.src?{src:e.src,available:!0}:null}constructor(e){super(e),this._refNative=(0,f.createRef)(),this.getElement=()=>this._refNative.current,this._handleContextMenu=e=>{this.props.disableContextMenu&&e.preventDefault()},this._handleError=e=>{this.setState({available:!1});const{src:t,crossOrigin:n,noXHR:r,hasPrivacyChecks:o}=this.props;if(!t||!function(e){return"/"===e[0]||l.default.isHttp(e)}(t))return void this.setState({error:e.error});const u=this.retry;let d;if(u)if(y(u,this.props)){if(!u.noXHR)return;d=u}else{u.release()&&g.remove(u),d=new c.default(t,n,r,o)}else d=new c.default(t,n,r,o);this.retry=d;const p=g.enqueue(d),f=this.props.getUnmountSignal();p.then((()=>{d===this.retry&&(f.aborted||this.setState({available:!0}))})).catch((0,a.filteredCatch)([s.ServerStatusError,s.GaveUpRetry],(e=>{d===this.retry&&(f.aborted||(this.setState({available:!1,error:e}),this.props.onError&&this.props.onError(e)))}))).catch((0,a.filteredCatch)(s.Unmount,(()=>{}))).catch((0,i.catchAbort)((()=>{})))},this._handleLoad=e=>{const{target:t}=e;if(t instanceof HTMLImageElement){const t=this.getImgElement();(null==t?void 0:t.complete)&&this._showImgElement(t),this.props.onLoad&&this.props.onLoad(e),this.setState({loading:!1})}},this.state={src:e.src,available:!0,error:null,loading:!0}}_showImgElement(e){"visible"!==e.style.visibility&&(e.style.visibility="visible")}_cancelRetry(){if(this.retry){const e=this.retry;e.release()&&g.remove(e)}}componentWillUnmount(){this._cancelRetry()}_hideImgElement(e){"hidden"!==e.style.visibility&&(e.style.visibility="hidden")}getImgElement(){return this._refNative.current}componentDidUpdate(e){if(y(e,this.props)||this._cancelRetry(),!this.props.src)return;const t=this.getImgElement();t&&!t.complete&&this._hideImgElement(t)}componentDidMount(){if(!this.props.src)return;const e=this.getImgElement();e&&!e.complete&&this._hideImgElement(e)}render(){const{alt:e,className:t,crossOrigin:n,draggable:r,onClick:i,onMouseMove:a,plainText:s,selectable:l,src:c,style:u,renderLoading:p,renderError:f}=this.props,{available:h,error:g,loading:m}=this.state;if(g&&f)return f(g);const y=Boolean(h&&c);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(d.SelectableImg,{ref:this._refNative,plainText:s||"",selectable:Boolean(l),crossOrigin:n?"anonymous":void 0,onError:y?this._handleError:()=>{},onLoad:y?this._handleLoad:()=>{},src:y&&null!=c?c:o.default.ONE_BY_ONE_TRANS_GIF,alt:e,className:t,draggable:r,onClick:i,onMouseMove:a,style:u,onContextMenu:this._handleContextMenu}),m&&(null==p?void 0:p())]})}}function y(e,t){return e.src===t.src&&e.crossOrigin===t.crossOrigin&&e.noXHR===t.noXHR&&e.hasPrivacyChecks===t.hasPrivacyChecks}m.defaultProps={crossOrigin:!0,noXHR:!1,hasPrivacyChecks:!0},m.displayName="Img";var S=(0,p.default)(m);t.default=S},997827:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(389385),o=n(638284),s=(n(88156),function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232))),l=i(n(511854)),c=i(n(11339));function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}t.default=class{constructor(e,t,n,r){this.src=e,this.crossOrigin=t,this.noXHR=n,this.hasPrivacyChecks=r,this.generation=0,this.refCount=0,this.inProgress=!1}key(){return`co:${this.crossOrigin?"Y":"N"},noXHR:${this.noXHR?"Y":"N"},src:${this.src}`}sendXHR(){if(this.noXHR)return Promise.resolve(!0);const e=this.src;this.inProgress=!0;const t=new r,n=(0,o.promiseTimeout)(l.default.get(e,void 0,void 0,t.signal),3e4,"ImgRetryTimeout");return this._xhrRequest={promise:n,controller:t},this._xhrRequest.promise.then((t=>{const{status:n}=t;if(n>=200&&n<400)return!0;if(n>=500){__LOG__(2)`Img:Retry ${e} failed with error code ${n}. Retrying.`;return new c.default.WebcImgError({webcImgErrorCode:n}).commit(),!1}__LOG__(2)`Img:Retry ${e} failed with error code ${n}. Not retrying.`;throw new c.default.WebcImgError({webcImgErrorCode:n}).commit(),new s.ServerStatusError(null,e,n)})).catch((e=>{if(e instanceof s.ServerStatusError)throw e;if(e.name===a.ABORT_ERROR)throw e;return!1})).finally((()=>{this.inProgress=!1}))}release(){return this.refCount--,this.refCount<=0&&(this._xhrRequest&&this._xhrRequest.controller.abort(),!0)}shouldRetain(){return this.refCount>0}}},72668:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(389385),o=n(180284),s=i(n(145095)),l=i(n(747259)),c=n(88156),u=n(930764),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),p=i(n(681602));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}class _{constructor(){this._queue=new Map,this._inDelay=new Map,this._numInProgress=0}static maxInProgressRetry(){return 20}enqueue(e){const t=this._queue.get(e.key());if(t){if(e.hasPrivacyChecks!==t.hasPrivacyChecks){const t=`Img:hasPrivacyChecks shouldn't change ${e.key()}`;return Promise.reject(t)}return t.refCount++,t.deferred.promise}return e.deferred=new c.Resolvable,e.refCount++,this._addToQueue(e),e.deferred.promise}remove(e){const t=e.key();this._queue.delete(t);const n=this._inDelay.get(t);n&&(n.controller.abort(),this._inDelay.delete(t))}_addToQueue(e){const t=e.generation;if(e.generation++,t>10){const t=`Stop retrying ${e.src} after 10 times`;throw new d.GaveUpRetry(t)}const n=e.key();if(0===t)this._queue.set(n,e),this._startProcessing();else{const i=new r,s=i.signal,c=(0,l.default)((0,o.expDelaySec)(t,60,0),s).catch((0,a.catchAbort)((()=>{})));this._inDelay.set(e.key(),{promise:c,controller:i}),c.then((()=>{this._inDelay.delete(n),s.aborted||this._queue.set(n,e),this._startProcessing()}))}}_startProcessing(){this._waitPromise||(this._waitPromise=p.default.waitIfOffline({signal:(new r).signal}).then((()=>{this._waitPromise=null,u.UIBusyTasks.enqueue((()=>{this._processRetries()}))})))}_processRetries(){const e=this._queue.values();let t;for(;(t=e.next())&&!t.done&&!(this._numInProgress>_.maxInProgressRetry());){const e=t.value;this._processRetry((0,s.default)(e,"retry"))}}_processRetry(e){e.inProgress||(e.deferred.resolveWasCalled()?this._queue.delete(e.key()):(this._numInProgress++,e.sendXHR().then((t=>{this._queue.delete(e.key()),t?e.deferred.resolve():e.shouldRetain()&&this._addToQueue(e)})).catch((t=>{this._queue.delete(e.key()),e.deferred.reject(t)})).finally((()=>{this._numInProgress--}))))}}t.default=_},729424:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SpecialKeyMap=t.HotKeys=void 0;var i=r(n(81109)),a=r(n(506479)),o=r(n(252628)),s=n(789618),l=n(667294),c=r(n(778506)),u=r(n(955010)),d=n(785893);const p=["component","handlers","children","onFocus","onBlur"],f={alt:"Alt",ctrl:"Control",meta:"Meta",shift:"Shift"},_=(0,o.default)(f),h={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,meta:224};t.SpecialKeyMap=h;const g={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},m={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+"},y=(0,l.forwardRef)(((e,t)=>{const{component:n="div",handlers:r,children:o,onFocus:f=(()=>{}),onBlur:_=(()=>{})}=e,h=(0,a.default)(e,p),m=(0,l.useRef)(!1),y=(0,l.useRef)(null),v=(0,c.default)(t,y);(0,u.default)((()=>{if(m.current){const e=document.activeElement;y.current===e&&s.UIM.Manager.refocusTopUie()}}));const T=r&&Object.keys(r).some((e=>null!=r[e]));return(0,d.jsx)(n,(0,i.default)((0,i.default)({ref:v,tabIndex:"-1",onKeyPress:T?e=>{r&&Object.keys(r).forEach((t=>{const n=r[t];if(null==n)return;const i=E(t),[a]=i;g[a]||S(i,e)&&n(e)}))}:null,onKeyDown:T?e=>{r&&Object.keys(r).forEach((t=>{const n=r[t];if(null==n)return;const i=E(t),[a]=i;g[a]&&S(i,e)&&n(e)}))}:null},h),{},{onFocus:e=>{m.current=!0,f(e)},onBlur:e=>{m.current=!1,_(e)},children:o}))}));function S(e,t){let[n,r]=e;return n===t.which&&_.every((e=>r&&e===r?t.getModifierState(r):!t.getModifierState(e)))}function E(e){let[t,n]=e.toLowerCase().split("+");m[t]&&(t=m[t]),m[n]&&(n=m[n]);let r,i=t;return n?(i=n,r=f[t],void 0===r?__LOG__(3)`Invalid HotKey Modifier: ${t}`:void 0===i&&__LOG__(3)`Invalid HotKey Key: ${n}`):void 0===i&&__LOG__(3)`Invalid HotKey Key: ${t}`,[h[i]||i.charCodeAt(0),r]}t.HotKeys=y,y.displayName="HotKeys"},254889:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=0;const n=e.charCode,r=e.keyCode;null!=n&&0!==n?t=n:null!=r&&0!==r&&(t=r);return i.has(t)};var r=n(729424);const i=new Set([r.SpecialKeyMap.enter,r.SpecialKeyMap.space])},370842:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(0,n(667294).createContext)(!1);t.default=r},387956:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RotateFocus=t.FocusType=void 0;var i=r(n(145120)),a=r(n(352013)),o=n(538069),s=n(63454),l=n(667294),c=r(n(156720)),u=r(n(778506)),d=n(785893);const p={position:"lhggkp7q",top:"qq0sjtgm",end:"ebjesfe0",bottom:"jxacihee",start:"tkdu00h0"},f=s.FocusType;function _(e,t){const{focusType:n}=e,r=(0,l.useRef)(null),f=(0,u.default)(t,r);return(0,d.jsx)("div",{ref:f,style:e.style,className:(0,c.default)(p),onKeyDown:e=>{if(e.metaKey||e.ctrlKey)return;const t=r.current;let l;var c;(e.key===o.KEYBOARD_EVENT_KEY_VALUE.TAB?(e.stopPropagation(),e.preventDefault(),i.default.shouldIndicateFocus(),null!=t&&(l=(0,s.getNextTabbableElement)(t,e.shiftKey?s.TabDirection.BACKWARD:s.TabDirection.FORWARD,n))):null!=t&&t===document.activeElement&&(l=(0,s.getNextTabbableElement)(t,s.TabDirection.FORWARD,n,(e=>"input"===e.nodeName.toLowerCase()))),null!=l)&&(i.default.shouldIndicateFocus(),(c=l).restoreFocus?c.restoreFocus():a.default.focus(c))},tabIndex:"-1",children:e.children})}t.FocusType=f;const h=(0,l.forwardRef)(_);t.RotateFocus=h},422179:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(538069),a=n(63454),o=n(667294),s=r(n(156720)),l=r(n(778506)),c=n(785893);const u={position:"lhggkp7q",top:"qq0sjtgm",end:"ebjesfe0",bottom:"jxacihee",start:"tkdu00h0"};function d(e,t){const n=(0,o.useRef)(null),r=(0,l.default)(t,n);return(0,c.jsx)("div",{ref:r,className:(0,s.default)(u),onKeyDown:e=>{if(!e.metaKey&&!e.ctrlKey)return e.key===i.KEYBOARD_EVENT_KEY_VALUE.TAB?(e=>{const t=n.current;if(!t)return;const r=e.shiftKey?a.TabDirection.BACKWARD:a.TabDirection.FORWARD,i=(0,a.getNextTabbableElement)(t,r,a.FocusType.TABBABLE);null!=i&&(e.preventDefault(),i.focus())})(e):void 0},tabIndex:"-1",onBlur:e.onBlur,role:"dialog",children:e.children})}var p=(0,o.forwardRef)(d);t.default=p},63454:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TabDirection=t.FocusType=void 0,t.getNextTabbableElement=function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.FORWARD,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.CUSTOM,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>!0;u===o.TABBABLE?(t=(0,a.tabbable)(e),n=()=>!0):(t=(0,i.default)(Array.from(e.querySelectorAll("[data-tab]")),(e=>parseInt(e.getAttribute("data-tab"),10)||0)),n=c);const p=r===s.FORWARD?1:-1;let f=0;const{activeElement:_}=document;if(_){const e=t.findIndex((e=>e.contains(_)));f=-1===e?0:l(e+p,t.length)}for(let e=0;e<t.length;e++){const r=l(f+e*p,t.length),i=t[r];if(n(i)&&d(i))return i}return null};var i=r(n(189734)),a=n(388388);const o=n(76672).Mirrored(["CUSTOM","TABBABLE"]);t.FocusType=o;const s=n(76672).Mirrored(["FORWARD","BACKWARD"]);function l(e,t){return(e+t)%t}function c(e){if(e.disabled)return!1;const t=parseInt(e.dataset.tab,10);return!("number"!=typeof t||t<0)&&!function(e){if("hidden"===getComputedStyle(e).visibility)return!0;let t=e;for(;t;){if("none"===getComputedStyle(t).display)return!0;t=t.parentElement}return!1}(e)}t.TabDirection=s},356074:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{onClick:t,wrapInHiddenToken:n=!0,id:r,plural:u,params:d,className:p,tabIndex:f}=e;return(0,l.jsx)(a.SelectableSpan,{dir:o.default.isRTL()?"rtl":"ltr",selectable:!n,onClick:t,className:p,tabIndex:f,children:(()=>{const e=o.default.t(r,{_plural:u});if(!d||(0,i.default)(d))return e;let t,n;const a=[];for(;t=c.exec(e);){const e=t;a.push(e[1]);const r=e[2];if(r&&null!=d[r]){const e=Array.isArray(d[r])?d[r].map(((e,t)=>(0,l.jsx)(s.Fragment,{children:e},`child_${t}`))):(0,l.jsx)(s.Fragment,{children:d[r]},r);a.push(e)}n=e.index+e[0].length}return"number"==typeof n&&n<e.length&&a.push(e.slice(n)),0===a.length?e:a})()})};var i=r(n(441609)),a=n(552596),o=r(n(914296)),s=n(667294),l=n(785893);const c=/(.*?)__(\w+?)__/g},488793:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"name_list";if(0===e.length)return"";const r=e[0];if(1===e.length)return"group_list"===n?t?o.default.t(351,{A:r}):(0,s.jsx)(a.default,{id:351,params:{A:r}}):r;const i=e[e.length-1];if(2===e.length)return l(r,i,t,n);if("group_list"===n){const n=e.slice(0,e.length-2),r=e[e.length-2];return c(n,r,i,t)}const d=e[1],p=e.slice(2,e.length-1);return u(r,d,p,i,t)};var i=r(n(531351)),a=r(n(356074)),o=r(n(914296)),s=n(785893);function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return"group_list"===r?n?o.default.t(354,{A:e,B:t}):(0,s.jsx)(a.default,{id:354,params:{A:e,B:t}}):n?o.default.t(491,{A:e,B:t}):(0,s.jsx)(a.default,{id:491,params:{A:e,B:t}})}function c(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l=(0,i.default)(e).reduce(((e,t,n)=>[r?o.default.t(353,{A:t,B:e}):(0,s.jsx)(a.default,{id:353,params:{A:t,B:e}},`listItem_${n}`)]),[]);return r?o.default.t(352,{A:l,B:t,C:n}):(0,s.jsx)(a.default,{id:352,params:{A:l,B:t,C:n}})}function u(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const l=[i?o.default.t(490,{A:e,B:t}):(0,s.jsx)(a.default,{id:490,params:{A:e,B:t}},"listItem_firstItem")],c=n.reduce(((e,t,n)=>[i?o.default.t(488,{A:t,B:e}):(0,s.jsx)(a.default,{id:488,params:{A:t,B:e}},`listItem_${n}`)]),l);return i?o.default.t(489,{A:c,B:r}):(0,s.jsx)(a.default,{id:489,params:{A:c,B:r}})}},535501:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,o.jsxs)("div",{className:"landing-header",children:[(0,o.jsx)(l,{}),(0,o.jsx)("div",{className:"landing-headerTitle",children:i.default.t(430)})]})};var i=r(n(914296)),a=r(n(156720)),o=n(785893);const s={display:"l7jjieqr",verticalAlign:"fewfhwl7"};const l=()=>(0,o.jsx)("span",{className:(0,a.default)(s),children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"39",height:"39",viewBox:"0 0 39 39",children:[(0,o.jsx)("path",{fill:"#00E676",d:"M10.7 32.8l.6.3c2.5 1.5 5.3 2.2 8.1 2.2 8.8 0 16-7.2 16-16 0-4.2-1.7-8.3-4.7-11.3s-7-4.7-11.3-4.7c-8.8 0-16 7.2-15.9 16.1 0 3 .9 5.9 2.4 8.4l.4.6-1.6 5.9 6-1.5z"}),(0,o.jsx)("path",{fill:"#FFF",d:"M32.4 6.4C29 2.9 24.3 1 19.5 1 9.3 1 1.1 9.3 1.2 19.4c0 3.2.9 6.3 2.4 9.1L1 38l9.7-2.5c2.7 1.5 5.7 2.2 8.7 2.2 10.1 0 18.3-8.3 18.3-18.4 0-4.9-1.9-9.5-5.3-12.9zM19.5 34.6c-2.7 0-5.4-.7-7.7-2.1l-.6-.3-5.8 1.5L6.9 28l-.4-.6c-4.4-7.1-2.3-16.5 4.9-20.9s16.5-2.3 20.9 4.9 2.3 16.5-4.9 20.9c-2.3 1.5-5.1 2.3-7.9 2.3zm8.8-11.1l-1.1-.5s-1.6-.7-2.6-1.2c-.1 0-.2-.1-.3-.1-.3 0-.5.1-.7.2 0 0-.1.1-1.5 1.7-.1.2-.3.3-.5.3h-.1c-.1 0-.3-.1-.4-.2l-.5-.2c-1.1-.5-2.1-1.1-2.9-1.9-.2-.2-.5-.4-.7-.6-.7-.7-1.4-1.5-1.9-2.4l-.1-.2c-.1-.1-.1-.2-.2-.4 0-.2 0-.4.1-.5 0 0 .4-.5.7-.8.2-.2.3-.5.5-.7.2-.3.3-.7.2-1-.1-.5-1.3-3.2-1.6-3.8-.2-.3-.4-.4-.7-.5h-1.1c-.2 0-.4.1-.6.1l-.1.1c-.2.1-.4.3-.6.4-.2.2-.3.4-.5.6-.7.9-1.1 2-1.1 3.1 0 .8.2 1.6.5 2.3l.1.3c.9 1.9 2.1 3.6 3.7 5.1l.4.4c.3.3.6.5.8.8 2.1 1.8 4.5 3.1 7.2 3.8.3.1.7.1 1 .2h1c.5 0 1.1-.2 1.5-.4.3-.2.5-.2.7-.4l.2-.2c.2-.2.4-.3.6-.5s.4-.4.5-.6c.2-.4.3-.9.4-1.4v-.7s-.1-.1-.3-.2z"})]})})},360695:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e,t]=(0,A.useState)(""),[n,r]=(0,A.useState)(!1),[w,R]=(0,A.useState)(!1),[N,L,D]=(0,O.default)(l.MD_KEYS.SCREEN_UNLOCK_TRY_COUNT),[k,U]=(0,A.useState)("");(0,P.useListener)(o.Cmd,"correct_passcode_lock_screen",(()=>{D()})),(0,P.useListener)(o.Cmd,"incorrect_passcode_lock_screen",(()=>{L(),r(!0),R(!1)})),(0,A.useEffect)((()=>{function e(){return(e=(0,i.default)((function*(){const e=(0,c.getMaybeMeUser)();e&&U(yield(0,S.profilePicThumbEURLFromDB)(e))}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);const G=function(){var t=(0,i.default)((function*(){R(!0),yield(0,a.delayMs)(500),g.LockScreenResolvable.enterPasscode(e)}));return function(){return t.apply(this,arguments)}}(),x=N>=5;return(0,M.jsxs)("div",{className:"landing-wrapper",children:[(0,M.jsx)(h.default,{}),(0,M.jsx)("div",{className:"landing-window",children:(0,M.jsx)("div",{className:(0,b.default)(I.box),children:(0,M.jsxs)(f.FlexColumn,{align:"center",className:"landing-main",children:[(0,M.jsx)(_.default,{xstyle:[s.uiMargin.top16,s.uiMargin.bottom24],children:(0,M.jsx)(E.default,{thumb:k,size:82,quality:d.DetailImageQuality.High})}),(0,M.jsx)(y.Text,{as:"div",size:"19",xstyle:I.pushnameText,children:(0,M.jsx)(p.EmojiText,{text:v.Conn.pushname,ellipsify:!0,titlify:!0})}),(0,M.jsxs)(_.default,{xstyle:[I.passcodeContainer,s.uiMargin.bottom24],children:[(0,M.jsx)(m.default,{onChange:e=>{t(e.currentTarget.value)},onKeyDown:t=>{x||""===e||"Enter"!==t.key||G()},required:!0,placeholder:C.fbt._("",null,{hk:"3EzL8R"}).toString()}),(0,M.jsxs)(y.Text,{as:"div",size:"13",color:"danger",xstyle:[I.incorrectPasscode,s.uiMargin.top4,s.uiMargin.bottom10],children:[n&&!x&&C.fbt._("",null,{hk:"4AFZLZ"}),x&&C.fbt._("",null,{hk:"1U1DqB"})]})]}),(0,M.jsx)(_.default,{xstyle:I.unlockButton,children:(0,M.jsx)(u.default,{type:"primary",onClick:()=>{G()},disabled:w||x||""===e,spinner:w,children:C.fbt._("",null,{hk:"1ZDB3i"})})}),(0,M.jsx)(u.default,{type:"plain-white",onClick:()=>T.Socket.logout(),children:C.fbt._("",null,{hk:"3J8zAh"})})]})})})]})};var i=r(n(348926)),a=n(413959),o=n(781572),s=n(128298),l=n(546718),c=n(978820),u=r(n(39770)),d=n(288984),p=n(965417),f=n(429623),_=r(n(748846)),h=r(n(535501)),g=n(23551),m=r(n(841547)),y=n(113923),S=n(78426),E=r(n(287543)),v=n(317239),T=n(765044),C=n(548360),A=n(667294),b=r(n(156720)),P=n(587550),O=r(n(693999));n(395741);var M=n(785893);const I={box:{backgroundColor:"svpeipy5",minWidth:"d8ddvuix",height:"lffynu9d","@media screen and (max-width: 850px)":{minWidth:"gdbw3fpr"},"@media screen and (max-width: 660px)":{minWidth:"inad9r27"}},pushnameText:{marginBottom:"fhelu9n7"},passcodeContainer:{width:"rtue7xhx"},incorrectPasscode:{height:"jdwybkuq",lineHeight:"l0vqccxk"},unlockButton:{marginBottom:"s3orhvc1"}}},23551:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LockScreenResolvable=void 0;var r=n(88156),i=n(781572),a=n(914597);const o=new class{constructor(){this.deferred=new r.Resolvable}waitForPasscode(){var e;return i.Cmd.openLockScreenModal(),null===(e=this.deferred)||void 0===e?void 0:e.promise}waitForPasscodeAfterIncorrectAttempt(){var e;return this.deferred=new r.Resolvable,i.Cmd.incorrectPasscodeLockScreen(),null===(e=this.deferred)||void 0===e?void 0:e.promise}enterPasscode(e){this.deferred.resolve(e)}correctPasscodeEntered(){i.Cmd.correctPasscodeLockScreen(),a.ModalManager.close()}};t.LockScreenResolvable=o},481145:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,a.getPrevLogoutReasonCode)();if(null==e)return null;const[t,n]=function(e){let t=null,n=null;switch(e){case o.LOGOUT_REASON_CODE.CLIENT_FATAL:t=d.fbt._("A database error occurred on your browser. Please relink your device.",null,{hk:"2607fW"}).toString(),n=(0,i.getDBErrorFaqUrl)();break;case o.LOGOUT_REASON_CODE.SYNC_FAIL:t=d.fbt._("Your device could not link due to a sync issue. Please relink your device.",null,{hk:"2VkiMf"}).toString(),n=(0,i.getLinkDeviceFaqUrl)();break;case o.LOGOUT_REASON_CODE.INITIAL_HISTORY_SYNC_TIMEOUT:t=d.fbt._("Couldn't link device. Keep WhatsApp open on your phone when your device is linking.",null,{hk:"2DAi9E"}).toString(),n=(0,i.getLinkDeviceFaqUrl)()}return[t,n]}(e);if(null==t||""===t)return null;const r=e===o.LOGOUT_REASON_CODE.CLIENT_FATAL,f=null!=n?(0,p.jsxs)(c.default,{action:()=>{(0,s.openExternalLink)(n)},children:[" ",d.fbt._("Learn more",null,{hk:"2S4fxr"})]}):null;return(0,p.jsxs)("div",{className:(0,u.default)(l.default.wrapper,r?l.default.error:l.default.warn),children:[r?(0,p.jsx)("span",{className:l.default.icon,children:(0,p.jsx)("svg",{width:"44",height:"44",viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{d:"M22.0002 0.314301C10.0422 0.314301 0.314453 10.0421 0.314453 22C0.314453 33.958 10.0422 43.6857 22.0002 43.6857C33.9581 43.6857 43.6859 33.958 43.6859 22C43.6859 10.0421 33.9581 0.314301 22.0002 0.314301ZM30.1502 28.5196L28.5197 30.1501L22.0002 23.6305L15.4806 30.1501L13.8501 28.5196L20.3709 22L13.8501 15.4805L15.4806 13.85L22.0002 20.3695L28.521 13.85L30.1515 15.4805L23.6307 22L30.1502 28.5196Z",fill:"currentColor"})})}):(0,p.jsx)("span",{className:l.default.icon,children:(0,p.jsx)("svg",{width:"44",height:"44",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 46C36.1503 46 46 36.1503 46 24C46 11.8497 36.1503 2 24 2C11.8497 2 2 11.8497 2 24C2 36.1503 11.8497 46 24 46ZM34.6473 31.164L25.2436 14.2344C25.1138 13.9995 24.9312 13.8053 24.7134 13.6705C24.4956 13.5357 24.2499 13.4649 24 13.4649C23.7501 13.4649 23.5044 13.5357 23.2866 13.6705C23.0687 13.8053 22.8861 13.9995 22.7564 14.2344L13.3527 31.164C13.2177 31.4068 13.144 31.6848 13.1392 31.9694C13.1344 32.254 13.1986 32.5349 13.3253 32.783C13.452 33.0312 13.6366 33.2377 13.86 33.3813C14.0834 33.5249 14.3376 33.6004 14.5964 33.6H33.4036C33.6624 33.6004 33.9166 33.5249 34.14 33.3813C34.3634 33.2377 34.548 33.0312 34.6747 32.783C34.8014 32.5349 34.8656 32.254 34.8608 31.9694C34.856 31.6848 34.7823 31.4068 34.6473 31.164ZM25.0909 19.2V26.4H22.9091V19.2H25.0909ZM22.9091 31.2V28.8H25.0909V31.2H22.9091Z",fill:"currentColor"})})}),(0,p.jsxs)("div",{className:l.default.textWrapper,children:[(0,p.jsx)("div",{children:t}),f]})]})};var i=n(221310),a=n(854602),o=n(788950),s=n(912591),l=r(n(124242)),c=r(n(729237)),u=r(n(294184)),d=n(548360),p=n(785893)},812176:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ContactAndGroupName=function(e){const{chat:t,contact:n,xstyle:r}=e;return(0,g.jsxs)("span",{className:(0,_.default)(r),children:[(0,g.jsx)(T,{contact:n,useShortName:!0}),(0,g.jsx)("span",{children:" • "}),(0,g.jsx)(v,{chat:t,groupMetadata:t.groupMetadata})]})},t.ContactName=E,t.GroupName=v,t.Name=T;var i=r(n(81109)),a=r(n(506479)),o=r(n(263116)),s=r(n(209384)),l=n(965417),c=r(n(865301)),u=r(n(23217)),d=n(384543),p=n(130695),f=r(n(294184)),_=r(n(156720)),h=n(735461),g=n(785893);const m=["chat"],y=["chat"],S=["contact"];function E(e){const{element:t="span",highlightText:n,titlify:r,ellipsify:i,breakWord:a,you:_,selectable:m,useShortName:y,useDisplayName:S,onClick:E,showLabel:v,showBusinessCheckmark:T,showNotifyName:C,useVerifiedName:A,firstLabel:b,xstyle:P}=e,O=(0,h.useModelValues)(e.contact,["isPSA","formattedUser","formattedName","formattedShortName","displayName","labels","name","notifyName","isMe","verifiedName"]);let M;n&&(M=p.Configuration.SearchName({terms:[n]}));const I=(e=>{let{contact:t,showNotifyName:n,useDisplayName:r,useShortName:i,useVerifiedName:a,you:o}=e;return!0===r&&t.displayName?t.displayName:!0===i&&t.formattedShortName?t.formattedShortName:!0===a&&t.verifiedName?t.verifiedName:!0===o&&t.isMe?t.formattedName:!0!==n||t.name||null==t.notifyName?t.formattedUser:`~${t.notifyName}`})({contact:O,showNotifyName:C,useDisplayName:S,useShortName:y,useVerifiedName:A,you:_});if(!I)return __LOG__(4,void 0,new Error,!0)`displayName:${I},
formattedName:${O.formattedName},
name:${O.name},
formattedShortName:${O.formattedShortName},
formattedUser:${O.formattedUser}`,SEND_LOGS("display name is null or undefined"),"";const w=(0,g.jsx)(l.EmojiText,{text:(0,s.default)(I),element:t,className:(0,f.default)(O.isPSA?c.default.psa:null,e.className),formatters:M,titlify:r,ellipsify:i,breakWord:a,direction:"auto",selectable:m,inlineblock:!0,onClick:E,xstyle:P}),R=e.labels||O.labels;R&&b&&(0,o.default)(R,b);const N=v&&R&&(0,g.jsx)("div",{className:c.default.labels,children:(0,g.jsx)(d.Labels,{labels:R,showName:!1})});return O.isPSA||T?(0,g.jsxs)("span",{className:c.default.verified,children:[w,(0,g.jsx)("div",{className:c.default.icon,children:(0,g.jsx)(u.default,{name:"psa-verified"})}),N]}):N?(0,g.jsxs)("span",{className:c.default.hasLabels,children:[w,N]}):w}function v(e){const{element:t,highlightText:n,titlify:r,ellipsify:i,breakWord:a,onClick:m,showLabel:y,firstLabel:S,className:E,xstyle:v}=e;let T;const C=(0,h.useModelValues)(e.chat,["formattedTitle","labels"]),A=(0,h.useModelValues)(e.groupMetadata,["support"]);n&&(T=p.Configuration.SearchName({terms:[n]}));const b=e.labels||C.labels;b&&S&&(0,o.default)(b,S);const P=y&&b?(0,g.jsx)("div",{className:c.default.labels,children:(0,g.jsx)(d.Labels,{labels:b,showName:!1})}):null,O=(0,g.jsx)(l.EmojiText,{text:(0,s.default)(C.title()),element:t,className:(0,f.default)(E,(0,_.default)(v)),formatters:T,titlify:r,ellipsify:i,breakWord:a,direction:"auto",inlineblock:!0,onClick:m});return A.support?(0,g.jsxs)("div",{className:(0,f.default)({[c.default.verified]:!0,[c.default.hasLabels]:!!P}),children:[O,(0,g.jsx)("div",{className:c.default.icon,children:(0,g.jsx)(u.default,{name:"psa-verified"})}),P]}):P?(0,g.jsxs)("div",{className:c.default.hasLabels,children:[O,P]}):O}function T(e){if(e.chat&&!e.chat.isUser){const{chat:t}=e,n=(0,a.default)(e,m);return(0,g.jsx)(v,(0,i.default)({chat:t,groupMetadata:t.groupMetadata},n))}let t,n;if(e.chat){const{chat:r}=e,i=(0,a.default)(e,y);t=r.contact,n=i}else{const{contact:r}=e;t=r,n=(0,a.default)(e,S)}return(0,g.jsx)(E,(0,i.default)({contact:t},n))}},183777:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WABaseNotification=void 0;var a=i(n(81109)),o=i(n(348926)),s=n(389385),l=n(640265),c=n(450796),u=i(n(145095)),d=i(n(747259)),p=n(638284),f=n(492574),_=n(410945),h=i(n(675350)),g=n(432580),m=n(748805),y=n(72472),S=n(582039);t.WABaseNotification=class{constructor(){this.closeBanner=()=>{null!=this.notificationBanner&&(__LOG__(2)`WABaseNotification:_closeNotification()`,this.notificationBanner.close())}}shouldPlaySound(){return y.MuteCollection.getGlobalSounds()}shouldMute(){return!1}shouldShowBanner(){return window.Notification&&window.Notification.permission===_.PERMISSION_ALLOWED&&y.MuteCollection.getGlobalNotifications()}shouldSquelch(){return!1}buildKey(){throw new Error("WABaseNotification: must implement `buildKey` method")}getBannerOptions(){throw new Error("WABaseNotification: must implement `getBannerOptions` method")}getDefaultIcon(){throw new Error("WABaseNotification: must implement `getDefaultIcon` method")}matchesChat(){return!1}afterBannerShown(){}getChatKind(){throw new Error("WABaseNotification: must implement `getChatKind` method")}logging(){(0,m.incrementNotificationDailyCount)(m.NotificationDailyCountKind.NOTIFICATION,(0,u.default)(this.getChatKind(),"this.getChatKind()"))}triggerNotification(){var e=this;return(0,o.default)((function*(){if(yield e.shouldMute())throw new s.AbortError("Notification muted");if(yield e.shouldSquelch())throw new s.AbortError("Notification squelched");let t;return(yield e.shouldShowBanner())&&(t=yield e.showBanner(),e.afterBannerShown(t),e.logging()),(yield e.shouldPlaySound())&&e.playSound(),t}))()}showBanner(){var e=this;return(0,o.default)((function*(){__LOG__(2)`WABaseNotification: showing banner`,e.abortController=new r;const t=e.getBannerOptions(),n=yield(i=t.wid,o=e.abortController.signal,u=e.getDefaultIcon(),(0,p.promiseTimeout)((0,d.default)(S.ProfilePicThumbCollection.find(i),o),1500,"showNotificationTimeout").then((function(e){var t;if(o.aborted)throw new s.AbortError;const n=null!==(t=null==e?void 0:e.img)&&void 0!==t?t:u;return(0,g.cachePath)(n)})).catch((0,c.filteredCatch)([f.WebdDrop,l.TimeoutError],(function(){return __LOG__(2)`NotificationBackend:IconLoadTimeoutError:${i.toString()}`,(0,g.cachePath)(u)}))));var i,o,u;if(e.abortController.signal.aborted)throw new s.AbortError("Aborted through abortController");if(window.Notification.permission!==_.PERMISSION_ALLOWED)throw new s.AbortError("Permission Denied");const m=new h.default((0,a.default)((0,a.default)({},t),{},{icon:n}));return e.notificationBanner=m,m}))()}playSound(){__LOG__(2)`WABaseNotification: playing sound`,(0,g.playNotification)()}}},460679:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(506479)),o=r(n(145095)),s=n(551737),l=n(781572),c=n(795720),u=n(408139),d=n(914597),p=n(115461),f=r(n(914296)),_=n(188172),h=n(669951),g=n(748805),m=n(455981),y=n(559871);const S=["title","notification"];t.default=class{constructor(e,t,n,r){this.close=()=>{this.notification&&this._waitForInteractionStop().then((()=>{this.notification&&(0,s.isFunction)(this.notification.close)&&this.notification.close()})).catch((()=>{}))},this._handleClose=()=>{__LOG__(2)`BaseNotificationBanner: _handleClose()`,this.waitingPromise.resolver(),window.removeEventListener("beforeunload",this.close),this.notification&&(this.notification.removeEventListener("click",this._handleClick),this.notification.removeEventListener("close",this._handleClose)),this.msg&&this.msg.off("change:type",this._handleRevoke)},this._handleClick=()=>{var e,t,n;null===(e=this._onClick)||void 0===e||e.call(this),window.focus();const r=this.chat,i=this.msg;if(!r)return;const a=i&&i!==r.msgs.last()?r.getSearchContext(i):void 0;var s;(0,u.communitiesEnabled)()&&(null===(t=r.groupMetadata)||void 0===t?void 0:t.groupType)===m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&(null===(n=r.groupMetadata)||void 0===n?void 0:n.parentGroup)&&null!=i&&(i.subtype===c.GROUP_ACTIONS.LINKED_GROUP_PROMOTE||i.subtype===c.GROUP_ACTIONS.LINKED_GROUP_DEMOTE)?l.Cmd.communityHome(null===(s=r.groupMetadata)||void 0===s?void 0:s.parentGroup):l.Cmd.openChatAt(r,a).then((e=>{e&&_.ComposeBoxActions.focus(r)}));(0,g.incrementNotificationDailyCount)(g.NotificationDailyCountKind.NOTIFICATION_TAP,(0,o.default)(r.kind,"chat.kind")),d.ModalManager.closeMedia(),this.close()},this._handleRevoke=()=>{this.msg&&this.msg.type===p.MSG_TYPE.REVOKED&&this.close()},this.msg=y.MsgCollection.get(t),this.chat=h.ChatCollection.get(e),this._onClick=r.onClick;const E=new Promise((e=>{this.waitingPromise={resolver:e}}));this.waitingPromise.promise=E;const{title:v,notification:T}=r,C=(0,a.default)(r,S);C.body&&C.body.charCodeAt(0)>=128&&(C.body=" "+C.body);try{this.notification=new T(v,(0,i.default)({tag:n,renotify:Boolean(n),dir:"auto",lang:f.default.getLocale(),silent:!0},C)),this.notification.addEventListener("error",(()=>{__LOG__(2)`native notification error`})),this.notification.addEventListener("close",(()=>{__LOG__(2)`native notification close`})),this.notification.addEventListener("click",this._handleClick),this.notification.addEventListener("close",this._handleClose),this.msg&&this.msg.on("change:type",this._handleRevoke),window.addEventListener("beforeunload",this.close)}catch(e){__LOG__(2)`Failed to create notification: ${e.name}:${e.message}`,this.waitingPromise.resolver()}}_waitForInteractionStop(){return Promise.resolve()}waitForClose(){return this.waitingPromise.promise}detach(){this._handleClose()}}},166460:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getNotificationBody=function(e){const t=e.msgDir,n=d.default.isRTL()?"rtl":"ltr";if(e.body&&null==e.author&&null==e.action)return e.body;let{body:r,author:a,action:o}=e;null==a&&(a="");o=null==o?"":"ltr"===n?d.default.isolateLTR(o):d.default.isolateRTL(o);if(a){const e=i.dir(a);return"ltr"!==n||t&&"ltr"!==t||e&&"ltr"!==e?"ltr"!==n||t&&"ltr"!==t?"ltr"!==n||e&&"ltr"!==e?"ltr"===n?o?`‫${a}‏: ${o} ${r}‏`:`‫${a}‏: ${r}‏`:t&&"rtl"!==t||e&&"rtl"!==e?t&&"rtl"!==t?e&&"rtl"!==e?o?`‪${a}‎: ${o} ${r}‎`:`‪${a}‎: ${r}‎$`:o?`${a}‏: ${o}‏ ‪${r}‬‏`:`${a}‏: ‪${r}‬‏`:o?`‏‪${a}‬: ${o}‏ ${r}‏`:`‏‪${a}‬: ${r}‏`:o?`${a}‏: ${o}‏ ${r}‏`:`${a}‏: ${r}‏`:o?`${a}‎: ${o}‎ ‫${r}‬‎`:`${a}‎: ‫${r}‬‎`:o?`‎‫${a}‬: ${o}‎ ${r}‎`:`‎‫${a}‬: ${r}‎`:o?`${a}‎: ${o}‎ ${r}‎`:`${a}‎: ${r}‎`}if(o)return`${o} ${r}`;return r},t.getNotificationMessageBody=function(e){var t,n;const r=e.shouldShowNotificationPreview(),i=e.safe();let M,I,w="";switch(i.type){case s.MSG_TYPE.CHAT:r&&(w=(0,v.default)(e,e.body));break;case s.MSG_TYPE.IMAGE:M="",l.UA.hasEmoji&&(M=i.isViewOnce?"1️⃣ ":"📷 "),w=M+(r&&(0,v.default)(e,e.caption)||d.default.t(714));break;case s.MSG_TYPE.PRODUCT:M=l.UA.hasEmoji?"🛒 ":"",w=M+(e.text&&(0,v.default)(e,e.text)||O.fbt._("Product",null,{hk:"1H4J4r"}).toString());break;case s.MSG_TYPE.INTERACTIVE:if(e.interactiveType===C.default.SHOPS_STOREFRONT){var R;M=l.UA.hasEmoji?"🛍️  ":"",w=M+(0,v.default)(e,e.body||(null===(R=e.interactiveHeader)||void 0===R?void 0:R.title))||"";break}if(e.interactiveType===C.default.NATIVE_FLOW&&e.nativeFlowName===A.default.ORDER_DETAILS){var N;M=l.UA.hasEmoji?"📃  ":"",w=M+((0,a.formatOrderDetailsMessagePreview)(e)||(null!==(N=e.caption)&&void 0!==N?N:""));break}if(e.interactiveType===C.default.NATIVE_FLOW&&e.nativeFlowName===A.default.ORDER_STATUS){var L;w=(0,a.formatOrderStatusMessage)(e)||(null!==(L=e.caption)&&void 0!==L?L:"");break}return __LOG__(3)`getNotificationBody: Unrecognized type ${e.type}`,"";case s.MSG_TYPE.NATIVE_FLOW:if(e.nativeFlowName===A.default.ORDER_DETAILS){var D;M=l.UA.hasEmoji?"📃  ":"",w=M+((0,p.formatNFMTextPreview)(e)||(null!==(D=e.caption)&&void 0!==D?D:""));break}return __LOG__(3)`getNotificationBody: Unrecognized type ${e.type}`,"";case s.MSG_TYPE.STICKER:M=l.UA.hasEmoji?"💟 ":"",w=M+O.fbt._("Sticker",null,{hk:"3gWjqH"}).toString();break;case s.MSG_TYPE.VIDEO:e.isGif?(M=l.UA.hasEmoji?"👾 ":"",I=r&&(0,v.default)(e,e.caption)||"GIF"):(M="",l.UA.hasEmoji&&(M=i.isViewOnce?"1️⃣ ":"🎥 "),I=r&&(0,v.default)(e,e.caption)||d.default.t(716),i.isViewOnce||(I=`${I} (${o.Clock.durationStr(e.duration)})`)),w=`${M}${I}`;break;case s.MSG_TYPE.PTT:M=l.UA.hasEmoji?"🎤 ":"",w=`${M} ${d.default.t(717)} (${o.Clock.durationStr(e.duration)})`;break;case s.MSG_TYPE.AUDIO:M=l.UA.hasEmoji?"🎵 ":"",w=`${M} ${d.default.t(710)} (${o.Clock.durationStr(e.duration)})`;break;case s.MSG_TYPE.LOCATION:M=l.UA.hasEmoji?"📍 ":"",I=e.isLive?r&&(0,v.default)(e,e.comment)||O.fbt._("Live location",null,{hk:"4hn7as"}).toString():r&&e.loc||d.default.t(715),w=`${M} ${I}`;break;case s.MSG_TYPE.GROUPS_V4_INVITE:w=O.fbt._("WhatsApp group invite",null,{hk:"Yox1t"});break;case s.MSG_TYPE.GROUP_NOTIFICATION:case s.MSG_TYPE.GP2:w=(0,E.default)(e,!0);break;case s.MSG_TYPE.BROADCAST_NOTIFICATION:w=(0,m.default)(e);break;case s.MSG_TYPE.NOTIFICATION:w=e.body;break;case s.MSG_TYPE.VCARD:M=l.UA.hasEmoji?"👤 ":"",w=M+(e.subtype||d.default.t(711));break;case s.MSG_TYPE.MULTI_VCARD:M=l.UA.hasEmoji?"👥 ":"",w=M+(0,c.getNameString)(e.vcardList).toString();break;case s.MSG_TYPE.DOCUMENT:if(e.isVcardOverMmsDocument){M=l.UA.hasEmoji?"👤 ":"",w=M+(e.filename||d.default.t(485,{count:e.pageCount,_plural:e.pageCount}));break}M=l.UA.hasEmoji?"📄 ":"",w=M+(r&&(0,v.default)(e,e.caption)||d.default.t(713));break;case s.MSG_TYPE.E2E_NOTIFICATION:w=(0,S.default)(i);break;case s.MSG_TYPE.CALL_LOG:w=(0,y.default)(e,!1);break;case s.MSG_TYPE.CIPHERTEXT:w=d.default.t(543);break;case s.MSG_TYPE.REVOKED:w=(0,h.formatRevokedMsg)(i);break;case s.MSG_TYPE.PAYMENT:w=function(e){if("invite"===e.subtype)return(0,_.formatPaymentInviteMessageText)(e.id);if(!e.paymentCurrency||!e.paymentAmount1000)return O.fbt._("Payment message • Amount unavailable",null,{hk:"3SAp3h"});if("send"!==e.subtype&&"request"!==e.subtype)return O.fbt._("Payment message. Open WhatsApp on your phone to view.",null,{hk:"3VcAwk"});let t;const n=u.formatAmount1000(e.paymentCurrency,e.paymentAmount1000),r=(0,T.default)(e.sender),i=(0,T.default)(e.paymentMessageReceiverJid),a=b.ContactCollection.get(e.paymentMessageReceiverJid),o={senderName:r,receiverName:i,amount:n,_plural:e.paymentAmount1000/1e3};t="send"===e.subtype?e.isGroupMsg?(null==a?void 0:a.isMe)?d.default.t(811,o):d.default.t(812,o):d.default.t(810,o):e.isGroupMsg?(null==a?void 0:a.isMe)?d.default.t(808,o):d.default.t(809,o):d.default.t(807,o);return t}(e);break;case s.MSG_TYPE.OVERSIZED:w=(0,f.formatOversizedMsgNotification)(e);break;case s.MSG_TYPE.UNKNOWN:w=(0,g.formatUnknownMsgNotification)(e);break;case s.MSG_TYPE.LIST:if((0,P.listMsgCanRender)(i)){var k,U;w=`${(null===(k=e.list)||void 0===k?void 0:k.title)||""} ${(null===(U=e.list)||void 0===U?void 0:U.description)||""}`;break}return __LOG__(3)`getNotificationBody: Unrecognized type ${e.type}`,"";case s.MSG_TYPE.LIST_RESPONSE:w=`${(null===(t=e.listResponse)||void 0===t?void 0:t.title)||""} ${(null===(n=e.listResponse)||void 0===n?void 0:n.description)||""}`;break;case s.MSG_TYPE.POLL_CREATION:M=l.UA.hasEmoji?"📊 ":"",w=`${M}${(0,v.default)(e,e.pollName)}`;break;case s.MSG_TYPE.ORDER:M=l.UA.hasEmoji?"🛒 ":"",w=O.fbt._({"*":"{shoppingCartIcon}{count} items{message}",_1:"{shoppingCartIcon}1 item{message}"},[O.fbt._plural(e.itemCount,"count"),O.fbt._param("shoppingCartIcon",M),O.fbt._param("message",null!=e.message&&""!==e.message?`\n${e.message}`:"")],{hk:"pCkf8"});break;default:return __LOG__(3)`getNotificationBody: Unrecognized type ${e.type}`,""}return w.toString()};var i=I(n(293131)),a=n(899641),o=n(40234),s=n(115461),l=n(26741),c=n(893778),u=I(n(939519)),d=r(n(914296)),p=n(563448),f=n(757196),_=n(702177),h=n(896206),g=n(24780),m=r(n(557733)),y=r(n(49763)),S=r(n(381412)),E=r(n(346953)),v=r(n(160238)),T=r(n(473977)),C=r(n(384064)),A=r(n(905165)),b=n(719380),P=n(554676),O=n(548360);function M(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(M=function(e){return e?n:t})(e)}function I(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=M(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}},946641:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_SQUELCH_TIME=void 0,t._calculateTimeoutFromGroupMetadata=_,t.appIsActive=function(){return document.hasFocus()},t.chatIsActive=function(e){return document.hasFocus()&&e.active},t.isArchivedAndNotMentioned=function(e){const t=e.chat;if(!(0,s.archiveV2Supported)())return!1;if(!p.default.showArchiveV2)return!1;if(!t.archive)return!1;if(!t.isGroup)return!0;if(h(e)){const t=c.ChatCollection.get(e.sender);return!0===(null==t?void 0:t.mute.isMuted)}return!0},t.isCommunityHomeAdd=function(e){var t;return!!(null===(t=e.chat.groupMetadata)||void 0===t?void 0:t.isParentGroup)},t.isMeUserMentionedOrQuoted=h,t.isMutedAndNotMentioned=function(e){const t=e.chat;if(!t.mute.isMuted)return!1;if(!t.isGroup)return!0;if(h(e)){const t=c.ChatCollection.get(e.sender);return!0===(null==t?void 0:t.mute.isMuted)}return!0},t.isOfflineResumeInProgress=function(){return(0,o.isMDBackend)()&&d.OfflineMessageHandler.isResumeOnSocketDisconnectInProgress()},t.shouldIgnoreGroupMsg=function(e){return!1},t.shouldSquelch=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.isGroup)return!1;if(e.isGroup&&e.isReadOnly)return!1;const n=Date.now(),r=e.squelch||0;if(n>r)return!!t&&(u.default.find(e.id).then((t=>{if(null!=t){const n=_(e.id,t);e.squelch=Date.now()+n}})).catch((0,i.filteredCatch)(a.WebdDrop,(function(){e.squelch=Date.now()+f}))),!1);return!0};var i=n(450796),a=n(492574),o=n(88555),s=n(408139),l=n(978820),c=n(669951),u=r(n(963928)),d=n(528237),p=r(n(268132));const f=6e4;function _(e,t){const n=t.participants.length;return 1e3*Math.min(120,30+5*n)}function h(e){const t=(0,l.getMaybeMeUser)();return e.isMentioned(t)||e.isQuoted(t)}t.DEFAULT_SQUELCH_TIME=f},675350:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(376139)),a=r(n(460679)),o=n(767247);class s extends a.default{constructor(e){let{wid:t,msgId:n,tag:r,title:a,body:s,icon:l,onClick:c}=e;super(t,n,r,{title:o.EmojiUtil.normalizeAllEmojis(a),notification:window.Notification,body:o.EmojiUtil.normalizeAllEmojis(s),icon:i.default.relToAbs(l),onClick:c})}}t.default=s},485807:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WANotificationController=void 0;var i=r(n(348926)),a=n(389385);const o=new class{constructor(){this.map=new Map}notificationExists(e){return this.map.has(e)}getNotification(e){return this.map.get(e)}closeOrCancelNotification(e){const t=this.getNotification(e);t&&(t.notificationBanner?t.notificationBanner.close():t.abortController&&t.abortController.abort(),this._removeNotificationFromMap(e))}closeOrCancelAllNotifications(){this.map.forEach(((e,t)=>{this.closeOrCancelNotification(t)}))}closeOrCancelNotificationsForChat(e){this.map.forEach(((t,n)=>{t.matchesChat(e)&&this.closeOrCancelNotification(n)}))}triggerNotification(e){var t=this;return(0,i.default)((function*(){const n=e.buildKey();t._addNotificationToMap(n,e);try{const r=yield e.triggerNotification();null!=r?r.waitForClose().then((()=>{t._removeNotificationFromMap(n)})):(__LOG__(2)`WANotificationController: notification not invoked:`,t._removeNotificationFromMap(n))}catch(e){(0,a.catchAbort)((e=>{__LOG__(2)`WANotificationController: notification aborted: ${e}`,t._removeNotificationFromMap(n)}))(e)}return e}))()}_addNotificationToMap(e,t){this.map.set(e,t),__LOG__(2)`WANotificationController: adding notification to map ${e}`}_removeNotificationFromMap(e,t){__LOG__(2)`WANotificationController:_removeNotificationFromMap attempting to remove ${e}`;const n=this.getNotification(e);null!=n?null==t||n===t?(__LOG__(2)`WANotificationController:_removeNotificationFromMap removing notification with key ${e}`,this.map.delete(e)):__LOG__(2)`WANotificationController:_removeNotificationFromMap not removing due to strict equality`:__LOG__(2)`WANotificationController:_removeNotificationFromMap cannot find notification in map with key: ${e}`}};t.WANotificationController=o},311728:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.setIcon=p,t.setTitleAndIcon=function(e){let t=s.default.t(875);e>0&&(t="("+s.default.n(e)+") "+s.default.t(875));clearTimeout(u),document.title=document.title+" ",u=setTimeout((()=>{document.title=t}),0),p(e)};var i=n(389385),a=r(n(627722)),o=n(26741),s=r(n(914296)),l=n(89721),c=n(441733);let u;const d=new a.default;function p(e){if(o.UA.isSafari)return;let t,r;-1===e?(t="favicon-error2",r={low:n(372174),high:n(605079)}):0===e?(t="favicon",r={low:n(868431),high:n(149420)}):e<10?(t="f0"+e,r={low:n(363509)(`./${t}.png`),high:n(276554)(`./${t}.png`)}):e<100?(t="f"+e,r={low:n(363509)(`./${t}.png`),high:n(276554)(`./${t}.png`)}):(t="f00",r={low:n(731213),high:n(795203)});const a={id:t,low:{default:r.low},high:{default:r.high}};d.enqueue(c.AssetLoader.loadAsset(a,l.LOAD_PRIORITY.NOTIFICATION_ICON,!1)).then((e=>e)).then((e=>{const n=document.getElementById("favicon");var r;(null==(r=n)?void 0:r.parentNode)&&r.parentNode.removeChild(r);const i=document.createElement("link");i.setAttribute("id","favicon"),i.setAttribute("rel","shortcut icon"),i.setAttribute("type","image/png"),i.setAttribute("href",e),i.setAttribute("src",e);const a=document.getElementsByTagName("head");(null==a?void 0:a[0])&&a[0].appendChild(i),__LOG__(2)`Favicon updated: ${t}`})).catch((0,i.catchAbort)((()=>{})))}},930351:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDoNotDisturb=function(){try{return!1}catch(e){__LOG__(3)`getDoNotDisturb failed with error ${e}`}return!1};n(76672).Mirrored(["UNKNOWN","SESSION_SCREEN_IS_LOCKED","SESSION_ON_CONSOLE_KEY","QUNS_NOT_PRESENT","QUNS_BUSY","QUNS_RUNNING_D3D_FULL_SCREEN","QUNS_PRESENTATION_MODE","QUNS_ACCEPTS_NOTIFICATIONS","QUNS_QUIET_TIME","QUNS_APP","UNKNOWN_ERROR"]),n(76672).Mirrored(["NOT_SUPPORTED","FAILED","OFF","PRIORITY_ONLY","ALARMS_ONLY"])},432580:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cachePath=function(e){return Promise.resolve(e)},t.playNotification=function(){r.play().catch((()=>{}))};const r=new window.Audio(n(637211))},137700:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WAKeepInChatNotification=void 0;var i=r(n(81109)),a=r(n(145095)),o=n(237540),s=n(115461),l=n(978820),c=r(n(389867)),u=n(745454),d=n(562054),p=(n(837626),n(529805)),f=r(n(914296)),_=n(183777),h=n(166460),g=n(946641),m=n(719380),y=n(748805),S=n(72472),E=r(n(891672)),v=r(n(210795)),T=n(548360);class C extends _.WABaseNotification{constructor(e){let{keepInChatMessage:t,parentMessage:n}=e;super(),this._handleKICStateChange=(e,t)=>{(0,p.isKept)(t)||(__LOG__(2)`WAKeepInChatNotification: kic state change, removing notification`,this.closeBanner())},this._logBannerClick=()=>{(0,y.incrementNotificationDailyCount)(y.NotificationDailyCountKind.KIC_NOTIFICATION_TAP,(0,a.default)(this.getChatKind(),"this.getChatKind()"))},this.keepInChatMessage=t,this.parentMessage=n,__LOG__(2)`WAKeepInChatNotification: constructor`}shouldMute(){var e;if(this.parentMessage.kicNotified)return!0;if(!this.parentMessage.isEphemeral)return!0;if(!(0,l.isMeAccount)(this.parentMessage.sender))return!0;const t=(0,u.toUserWid)(this.keepInChatMessage.author||this.keepInChatMessage.from);return!!(0,l.isMeAccount)(t)||(!!this.parentMessage.chat.mute.isMuted||(!!this.parentMessage.chat.archive||(!(!this.parentMessage.chat.isGroup||(null===(e=this.parentMessage.chat.groupMetadata)||void 0===e?void 0:e.hasJoined()))||(!!S.MuteCollection.globalMute().isMuted||!!(0,g.isOfflineResumeInProgress)()))))}buildKey(){return`kic:${this.parentMessage.id.toString()}`}matchesChat(e){return c.default.equals(this.parentMessage.chat.id,e)}getChatKind(){return this.parentMessage.chat.kind}logging(){(0,y.incrementNotificationDailyCount)(y.NotificationDailyCountKind.KIC_NOTIFICATION,(0,a.default)(this.getChatKind(),"this.getChatKind()"))}getDefaultIcon(){let e=v.default;return this.parentMessage.chat.isGroup&&(e=E.default),e}getBannerOptions(){const e=this.parentMessage.chat,t=e.isGroup?T.fbt._("WhatsApp group message",null,{hk:"2updyb"}):f.default.t(223),n=(0,h.getNotificationBody)((0,i.default)((0,i.default)({},function(e,t){let n,r,i;if(e.isGroupMsg){var a;const e=m.ContactCollection.gadd((0,o.getSender)(t));r=null!==(a=e.name)&&void 0!==a?a:(0,d.widToFormattedUser)(e.id)}e.type!==s.MSG_TYPE.CHAT||e.shouldShowNotificationPreview()?(n=(0,h.getNotificationMessageBody)(e),n=T.fbt._('"{originalMessageBody}"',[T.fbt._param("originalMessageBody",n)],{hk:"2D0IjP"}),i=T.fbt._("Kept your message from disappearing:",null,{hk:"iAf2l"}).toString()):n=T.fbt._("Kept your message from disappearing",null,{hk:"uEtuO"});return{body:n.toString(),author:r,action:i}}(this.parentMessage,this.keepInChatMessage)),{},{msgDir:this.parentMessage.dir})),r=e.contact.formattedName||t.toString();return{wid:e.id,msgId:this.parentMessage.id.toString(),title:r,body:n,onClick:this._logBannerClick}}afterBannerShown(e){this.parentMessage.set("kicNotified",!0),this.parentMessage.on("change:kicState",this._handleKICStateChange),e.waitForClose().then((()=>{__LOG__(2)`WAKeepInChatNotification: cleaning up kic notification`,this.parentMessage.off("change:kicState",this._handleKICStateChange)}))}}t.WAKeepInChatNotification=C},747751:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WAReactionNotification=void 0,t.getReactionNotificationAction=function(e){var t;const n=null!==(t=v.EmojiUtil.normalizeEmojiFromString(e.reactionText))&&void 0!==t?t:v.OPEN_BOX_CHAR;return w.fbt._("Reacted {emoji} to",[w.fbt._param("emoji",n)],{hk:"4177kz"}).toString()},t.getReactionNotificationAuthor=function(e){var t;const n=T.ContactCollection.gadd((0,_.createUserWid)(e.senderUserJid));return null!==(t=n.formattedShortName)&&void 0!==t?t:n.formattedUser},t.nonHydratedShouldMuteReactionNotification=N;var i=r(n(81109)),a=n(450796),o=n(257243),s=n(492574),l=r(n(364369)),c=n(408139),u=r(n(465212)),d=n(115461),p=n(867811),f=r(n(389867)),_=n(745454),h=n(562054),g=r(n(914296)),m=n(183777),y=n(166460),S=n(946641),E=n(485807),v=n(767247),T=n(719380),C=r(n(963928)),A=n(559871),b=n(72472),P=(n(981130),n(257162)),O=r(n(268132)),M=r(n(891672)),I=r(n(210795)),w=n(548360);class R extends m.WABaseNotification{constructor(e){let{reactionMsg:t}=e;if(super(),this._handleChatOpenUpdateMsgLevelSquelch=()=>{null!=this.parentMsg.chat&&null!=this.parentMsg&&this.parentMsg.chat.reactionSquelch===l.default.SQUELCH_RESET_VALUE&&(this.parentMsg.squelch=l.default.SQUELCH_RESET_VALUE)},__LOG__(2)`WAReactionNotification: constructor`,!(0,c.receiveReactionsEnabled)())return void __LOG__(3)`WAReactionNotification: receive not enabled for reactions.`;this.reactionMsg=t;const n=A.MsgCollection.get(this.reactionMsg.parentMsgKey);if(null==n)return void __LOG__(3)`WAReactionNotification: parentMsg is not present in the MsgCollection. It may need to be hydrated.`;this.parentMsg=n;const r=P.ReactionsCollection.get(this.parentMsg.id.toString());if(r){const{reactionSenderModel:e}=P.ReactionsCollection.getAggregateEmojiAndSender(r,this.reactionMsg.senderUserJid);this.reactionSender=e}else __LOG__(3)`WAReactionNotification: Reaction model not found`}afterBannerShown(e){if(null!=this.reactionSender){const t=this.reactionSender,n=this.parentMsg.chat;t.on("revoked change:read",this.closeBanner),n.on("change:reactionSquelch",this._handleChatOpenUpdateMsgLevelSquelch),e.waitForClose().then((()=>{__LOG__(2)`WAReactionNotification: cleaning up reaction notification`,t.off("revoked change:read",this.closeBanner),n.off("change:reactionSquelch",this._handleChatOpenUpdateMsgLevelSquelch)}))}}shouldMute(){return!(0,c.receiveReactionsEnabled)()||(!!N(this.reactionMsg)||(null==this.parentMsg||(!!((0,o.getABPropConfigValue)("web_abprop_mute_notifications_on_app_focus")?(0,S.appIsActive)():(0,S.chatIsActive)(this.parentMsg.chat))||(!!this.parentMsg.chat.mute.isMuted||(e=this.parentMsg.chat,!!((0,c.archiveV2Supported)()&&O.default.showArchiveV2&&e.archive))))));var e}shouldSquelch(){if(E.WANotificationController.notificationExists(this.buildKey()))return!1;const e=this.parentMsg.chat;return!!(0,S.shouldSquelch)(e,!1)||!!function(e,t){if(!e.isGroup)return!1;const n=Date.now(),r=t.squelch||0;if(n>r)return C.default.find(e.id).then((n=>{if(null!=n){const r=(0,S._calculateTimeoutFromGroupMetadata)(e.id,n),i=Date.now()+r;t.squelch=i,e.reactionSquelch===l.default.SQUELCH_RESET_VALUE&&(e.reactionSquelch=i)}})).catch((0,a.filteredCatch)(s.WebdDrop,(function(){t.squelch=Date.now()+S.DEFAULT_SQUELCH_TIME,e.reactionSquelch===l.default.SQUELCH_RESET_VALUE&&(e.reactionSquelch=Date.now()+S.DEFAULT_SQUELCH_TIME)}))),!1;return!0}(e,this.parentMsg)}buildKey(){return`reaction:${this.parentMsg.id.toString()}-${this.reactionMsg.senderUserJid}`}matchesChat(e){return f.default.equals(this.parentMsg.chat.id,e)}getChatKind(){return this.parentMsg.chat.kind}getDefaultIcon(){let e=I.default;return this.parentMsg.chat.isGroup&&(e=M.default),e}getBannerOptions(){const e=this.parentMsg,t=e.chat,n=(0,y.getNotificationBody)((0,i.default)((0,i.default)({},function(e,t){var n;let r,i;if(e.isGroupMsg){var a;const e=T.ContactCollection.gadd((0,_.createUserWid)(t.senderUserJid));i=null!==(a=e.name)&&void 0!==a?a:(0,h.widToFormattedUser)(e.id)}const o=null!==(n=v.EmojiUtil.normalizeEmojiFromString(t.reactionText))&&void 0!==n?n:v.OPEN_BOX_CHAR,s=w.fbt._("Reacted {emoji} to",[w.fbt._param("emoji",o)],{hk:"3aQqby"});e.type!==d.MSG_TYPE.CHAT||e.shouldShowNotificationPreview()?(r=(0,y.getNotificationMessageBody)(e),r=w.fbt._('"{originalMessageBody}"',[w.fbt._param("originalMessageBody",r)],{hk:"2by891"})):r=w.fbt._("a message",null,{hk:"3BTW7N"});return{body:r.toString(),author:i,action:s.toString()}}(e,this.reactionMsg)),{},{msgDir:e.dir})),r=t.isGroup?w.fbt._("WhatsApp group message",null,{hk:"2updyb"}):g.default.t(223),a=t.contact.formattedName||r.toString();return{wid:t.id,msgId:e.id.toString(),tag:e.id.toString(),title:a,body:n,canReply:!1,canMarkAsRead:!1}}}function N(e){const{orphan:t,read:n,senderUserJid:r,parentMsgKey:i,reactionText:a}=e;if(1===t)return!0;if(n)return!0;if((0,p.isReactionByMe)(r))return!0;return!u.default.fromString(i).fromMe||(a===p.REVOKED_REACTION_TEXT||(!!(0,S.isOfflineResumeInProgress)()||(!!b.MuteCollection.globalMute().isMuted||!!b.MuteCollection.globalReactionsMute().isMuted)))}t.WAReactionNotification=R},841547:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,n]=(0,l.default)(!1);return(0,c.jsxs)("div",{className:(0,s.default)([u.container,i.uiPadding.top4,i.uiPadding.horiz5,i.uiPadding.bottom6]),children:[(0,c.jsx)("input",{className:(0,s.default)(u.inputField),type:t?"text":"password",value:e.value,onChange:e.onChange,onKeyDown:e.onKeyDown,required:e.required,pattern:e.pattern,title:e.title,placeholder:e.placeholder}),(0,c.jsx)(a.default,{xstyle:u.toggleButton,onClick:n,type:"simplified",children:t?o.fbt._("",null,{hk:"3QhoQq"}):o.fbt._("",null,{hk:"SOUsm"})})]})};var i=n(128298),a=r(n(39770)),o=n(548360),s=r(n(156720)),l=r(n(627698)),c=n(785893);const u={container:{position:"g0rxnol2",display:"p357zi0d",backgroundColor:"f6cvynhn",borderTopStartRadius:"bbr44loe",borderTopEndRadius:"ooj5yc5b",borderBottomEndRadius:"m8i16etx",borderBottomStartRadius:"cw0ivh8j",minWidth:"lu4oe39f"},inputField:{fontSize:"enbbiyaj",color:"tviruh8d",flexGrow:"ggj6brxn",borderTop:"d27kr2rt",borderEnd:"q2i1o5qz",borderBottom:"r40aedaz",borderStart:"g9ebf9yp",outline:"gk6igrwd",backgroundColor:"f6cvynhn",overflowX:"gfz4du6o",overflowY:"r7fjleex"},toggleButton:{minWidth:"h3jhcnxg"}}},524161:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(480648)),a=n(785893);t.default=e=>{let{max:t=100,value:n}=e;return(0,a.jsx)("progress",{value:n,max:t,className:i.default.progress})}},28828:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const e=(0,d.useRef)(null),[t,n]=(0,d.useState)(g.FIRST_OPEN);(0,p.default)();const r=()=>{n(g.READY)},y=e=>{n(g.LOADING),e.stopPropagation(),e.preventDefault()},S=()=>{n(g.REPLAY);const t=e.current;t&&t.play()};let E,v;t===g.FIRST_OPEN&&(E=(0,f.jsx)("div",{className:o.default.overlay,children:(0,f.jsx)(s.Spinner,{size:32})}),v=r);const T=t===g.FIRST_OPEN||t===g.READY||t===g.LOADING?(0,f.jsx)(a.default,{className:(0,u.default)(o.default.poster,{[o.default.hidden]:t===g.FIRST_OPEN}),src:h[c.default.currentRes],onLoad:v},"poster"):null;let C,A;const b=_[c.default.currentRes],P=t!==g.FIRST_OPEN&&t!==g.READY?(0,f.jsx)("video",{autoPlay:!0,className:o.default.player,controls:!0,controlsList:"nodownload",onCanPlayThrough:()=>{t===g.LOADING&&n(g.FIRST_PLAY)},onEnded:()=>{n(g.ENDED)},ref:e,children:(0,f.jsx)("source",{src:b,type:"video/mp4"})},c.default.currentRes):null;switch(t){case g.READY:A=y,C=(0,f.jsx)(m,{});break;case g.LOADING:C=(0,f.jsx)(s.Spinner,{color:"white",size:32});break;case g.ENDED:A=S,C=(0,f.jsx)(l.default,{name:"refresh-large"});break;default:C=null,A=null}const O=C?(0,f.jsx)("div",{className:o.default.overlay,role:"button",onClick:A,children:(0,f.jsx)("div",{className:o.default.button,children:C})}):null;return(0,f.jsx)("div",{className:o.default.video,children:(0,f.jsxs)("div",{className:o.default.container,children:[(0,f.jsxs)(i.default,{transitionName:"fade",children:[E,O,T]}),P]})})};var i=r(n(540436)),a=r(n(247065)),o=r(n(671937)),s=n(111054),l=r(n(23217)),c=r(n(930588)),u=r(n(294184)),d=n(667294),p=r(n(574744)),f=n(785893);const _={low:n(479061),high:n(673727)},h={low:n(717818),high:n(107246)},g=n(76672).Mirrored(["FIRST_OPEN","READY","LOADING","FIRST_PLAY","ENDED","REPLAY"]);const m=()=>(0,f.jsx)("div",{className:o.default.play,children:(0,f.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"34",viewBox:"0 0 28 34",children:(0,f.jsx)("path",{fill:"#FFF",d:"M1 4.983v24.034a2.982 2.982 0 0 0 4.564 2.53L24.792 19.53a2.981 2.981 0 0 0 0-5.058L5.563 2.454A2.983 2.983 0 0 0 1 4.983z"})})})},422028:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,n]=(0,E.useState)(p.userPreferencesStoreBase.getRememberMe()),[r]=(0,E.useState)((()=>(0,f.getShowMdUpgradeCompleteMsg)())),[i]=(0,E.useState)((()=>(0,f.getForcedMdUpgradeComplete)())),[a,c]=(0,E.useState)(B.Socket.state===k.SOCKET_STATE.UNPAIRED_IDLE),[u,_]=(0,E.useState)(!d.default.online),[h,v]=(0,E.useState)(B.Socket.state===k.SOCKET_STATE.UNPAIRED);(0,T.useListener)(B.Socket,"change:state change:online",(()=>{c(B.Socket.state===k.SOCKET_STATE.UNPAIRED_IDLE),_(!d.default.online),v(B.Socket.state===k.SOCKET_STATE.UNPAIRED)})),(0,E.useEffect)((()=>{}),[]);const C=()=>{(0,o.isMDBackend)()?s.Cmd.refreshQR():B.Socket.poke()};let b;b=u?(0,j.jsx)(K,{children:(0,j.jsxs)("div",{className:L.default.qrButton,children:[(0,j.jsx)("div",{className:L.default.qrButtonIcon,children:(0,j.jsx)(G.default,{name:"connection"})}),O.default.t(178)]},"expiry")}):a?(0,j.jsx)(K,{children:(0,j.jsxs)("button",{className:L.default.qrButton,onClick:C,children:[(0,j.jsx)("div",{className:L.default.qrButtonIcon,children:(0,j.jsx)(G.default,{name:"refresh-large"})}),S.fbt._("Click to reload QR code",null,{hk:"pEkpW"})]},"expiry")}):h?(0,j.jsx)(K,{}):(0,j.jsx)("div",{className:L.default.qrcode,children:(0,j.jsx)(U.Spinner,{})});const R=t?null:(0,j.jsx)("div",{className:(0,y.default)(L.default.tip,L.default.rememberMeTip),children:O.default.t(373)});let N;if(e.apiCmd)switch(e.apiCmd.resultType){case A.APICmd.GROUP_INVITE:N=(0,j.jsx)("div",{className:L.default.groupInviteTip,children:(0,j.jsx)("div",{className:L.default.tip,children:S.fbt._("Log in to WhatsApp Web to join this WhatsApp group",null,{hk:"3OnLb2"})})});break;case A.APICmd.MSG_SEND:N=(0,j.jsx)("div",{className:L.default.groupInviteTip,children:(0,j.jsx)("div",{className:L.default.tip,children:S.fbt._("Log in to WhatsApp Web to share",null,{hk:"2k3JEY"})})})}const D=(0,j.jsx)("strong",{children:(0,j.jsx)(M.default,{id:425,params:{android_menu_icon:(0,j.jsx)(W,{})}})}),Y=(0,j.jsx)("strong",{children:(0,j.jsx)(M.default,{id:427,params:{iphone_settings_icon:(0,j.jsx)(H,{})}})}),V=(0,j.jsx)("strong",{children:S.fbt._("Linked Devices",null,{hk:"Nqq5i"})}),$=(0,j.jsx)(M.default,{id:428,params:{android_menu:D,iphone_settings:Y,whatsapp_web_menu_item:V}}),z=(0,j.jsx)("strong",{children:S.fbt._("Link a Device",null,{hk:"v9hB7"})}),q=(0,j.jsx)(M.default,{id:429,params:{login_step_3_md_link_device:z}}),J=r||i||(0,f.mdOptedIn)();let Q;r&&(Q=(0,j.jsx)("div",{className:"landing-header-upgradeCompleteText",children:S.fbt._("Update complete. Scan the QR code to use WhatsApp Web.",null,{hk:"3mQH0X"})}));i&&(Q=(0,j.jsx)("div",{className:"landing-header-upgradeCompleteText",children:S.fbt._("Now use WhatsApp Web without keeping your phone online.",null,{hk:"1eDnsC"})}));let X=(0,j.jsx)(F.default,{});return(0,j.jsxs)("div",{className:"landing-wrapper",children:[(0,j.jsx)(I.default,{}),Q,(0,j.jsxs)("div",{className:"landing-window",children:[(0,j.jsxs)("div",{className:"landing-main",children:[(0,j.jsx)(w.default,{}),(0,j.jsxs)("div",{className:L.default.qrWrapper,children:[(0,j.jsxs)("div",{className:L.default.text,children:[(0,j.jsx)("div",{className:(0,y.default)("landing-title",L.default.headline),children:S.fbt._("To use WhatsApp on your computer:",null,{hk:"3aGbOX"})}),(0,j.jsxs)("ol",{className:L.default.list,children:[(0,j.jsx)("li",{className:L.default.listItem,children:S.fbt._("Open WhatsApp on your phone",null,{hk:"3hHeUI"})}),(0,j.jsx)("li",{className:L.default.listItem,children:$}),J&&(0,j.jsx)("li",{className:L.default.listItem,children:q}),(0,j.jsx)("li",{className:L.default.listItem,children:S.fbt._("Point your phone to this screen to capture the code",null,{hk:"2SaWOV"})})]})]}),(0,j.jsxs)("div",{className:L.default.qr,children:[N,b]}),(0,j.jsx)(P.ExternalLink,{href:(0,l.getLoginFaqUrl)(),className:L.default.hint,children:O.default.t(426)}),(0,o.isMDBackend)()?null:(0,j.jsxs)("div",{className:L.default.toggle,children:[(0,j.jsx)(m.default,{transitionName:"fade_sifo",children:R}),(0,j.jsxs)("label",{children:[(0,j.jsx)("input",{type:"checkbox",name:"rememberMe",checked:t,onChange:e=>{B.Socket.isIncognito||x.default.setRememberMe(e.target.checked).catch((()=>{})),(0,g.setRememberMe)(e.target.checked),n(p.userPreferencesStoreBase.getRememberMe())}}),O.default.t(445)]})]})]})]}),X,undefined]})]})};var i=r(n(348926)),a=n(615688),o=n(88555),s=n(781572),l=n(221310),c=n(941906),u=r(n(379264)),d=(n(914597),r(n(681602))),p=n(646239),f=n(555452),_=n(134898),h=(n(978820),function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Y(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(266333))),g=n(270568),m=r(n(540436)),y=r(n(294184)),S=n(548360),E=n(667294),v=r(n(651799)),T=n(587550),C=n(946308),A=n(351650),b=(r(n(452665)),n(317239)),P=n(912591),O=r(n(914296)),M=r(n(356074)),I=r(n(535501)),w=r(n(481145)),R=r(n(314528)),N=r(n(637360)),L=r(n(866937)),D=(n(552596),n(640623)),k=n(662583),U=n(111054),G=r(n(23217)),x=r(n(656891)),B=n(765044),F=r(n(28828)),j=n(785893);function Y(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Y=function(e){return e?n:t})(e)}function K(e){const t=e.children,[n,r]=(0,E.useState)(!1),l=(0,v.default)((()=>{r(!0)}),100),d=(0,E.useRef)(null),p=(0,E.useRef)(null),f=()=>{if(b.Conn.connected)return Promise.resolve(void 0);const e=b.Conn.ref;if((0,o.isMDBackend)())return D.waSignalStore.getRegistrationInfo().then(function(){var t=(0,i.default)((function*(t){const n=yield _.waNoiseInfo.get();if(!n||!n.staticKeyPair||!t)return __LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Empty noiseInfo or empty regInfo"),null;const r=(0,a.encodeB64)(n.staticKeyPair.pubKey),i=(0,a.encodeB64)(t.identityKeyPair.pubKey),o=(0,C.getADVSecretKey)();return e+","+r+","+i+","+o}));return function(){return t.apply(this,arguments)}}());const t=u.default.id();return Promise.resolve().then((()=>{const n=h.getOrGenerate();return e+","+n+","+t}))},g=function(){var e=(0,i.default)((function*(){const e=d.current,t=p.current;if(null==e)return Promise.resolve();const n=yield f();n&&(R.default.inc(),t?t.makeCode(n):p.current=new N.default(e,{text:n,colorDark:"#122e31",width:c.QR_EDGE,height:c.QR_EDGE,correctLevel:N.default.CorrectLevel.L}),e.removeAttribute("title"),e.setAttribute("data-ref",n))}));return function(){return e.apply(this,arguments)}}();(0,T.useListener)(b.Conn,"change:ref",g),(0,E.useEffect)((()=>(g(),s.Cmd.initialLoadReady(),()=>{R.default.reset()})),[]);const S=(0,y.default)(L.default.qrcode,{[L.default.idle]:!!t}),A=n&&null==t?{cursor:"none"}:null;return(0,j.jsxs)("div",{ref:d,"data-testid":"qrcode",className:S,onContextMenu:null,style:A,onMouseMove:()=>{n&&r(!1),l()},onMouseLeave:()=>{l.cancel(),r(!1)},children:[(0,j.jsx)(m.default,{transitionName:"scale",children:t}),(0,j.jsx)("div",{className:L.default.codeLogo,children:(0,j.jsx)(V,{})})]})}const W=()=>(0,j.jsx)("span",{className:L.default.icon,children:(0,j.jsxs)("svg",{height:"24px",viewBox:"0 0 24 24",width:"24px",children:[(0,j.jsx)("rect",{fill:"#f2f2f2",height:"24",rx:"3",width:"24"}),(0,j.jsx)("path",{d:"m12 15.5c.825 0 1.5.675 1.5 1.5s-.675 1.5-1.5 1.5-1.5-.675-1.5-1.5.675-1.5 1.5-1.5zm0-2c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5zm0-5c-.825 0-1.5-.675-1.5-1.5s.675-1.5 1.5-1.5 1.5.675 1.5 1.5-.675 1.5-1.5 1.5z",fill:"#818b90"})]})}),H=()=>(0,j.jsx)("span",{className:L.default.icon,children:(0,j.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[(0,j.jsx)("rect",{fill:"#F2F2F2",width:"24",height:"24",rx:"3"}),(0,j.jsx)("path",{d:"M12 18.69c-1.08 0-2.1-.25-2.99-.71L11.43 14c.24.06.4.08.56.08.92 0 1.67-.59 1.99-1.59h4.62c-.26 3.49-3.05 6.2-6.6 6.2zm-1.04-6.67c0-.57.48-1.02 1.03-1.02.57 0 1.05.45 1.05 1.02 0 .57-.47 1.03-1.05 1.03-.54.01-1.03-.46-1.03-1.03zM5.4 12c0-2.29 1.08-4.28 2.78-5.49l2.39 4.08c-.42.42-.64.91-.64 1.44 0 .52.21 1 .65 1.44l-2.44 4C6.47 16.26 5.4 14.27 5.4 12zm8.57-.49c-.33-.97-1.08-1.54-1.99-1.54-.16 0-.32.02-.57.08L9.04 5.99c.89-.44 1.89-.69 2.96-.69 3.56 0 6.36 2.72 6.59 6.21h-4.62zM12 19.8c.22 0 .42-.02.65-.04l.44.84c.08.18.25.27.47.24.21-.03.33-.17.36-.38l.14-.93c.41-.11.82-.27 1.21-.44l.69.61c.15.15.33.17.54.07.17-.1.24-.27.2-.48l-.2-.92c.35-.24.69-.52.99-.82l.86.36c.2.08.37.05.53-.14.14-.15.15-.34.03-.52l-.5-.8c.25-.35.45-.73.63-1.12l.95.05c.21.01.37-.09.44-.29.07-.2.01-.38-.16-.51l-.73-.58c.1-.4.19-.83.22-1.27l.89-.28c.2-.07.31-.22.31-.43s-.11-.35-.31-.42l-.89-.28c-.03-.44-.12-.86-.22-1.27l.73-.59c.16-.12.22-.29.16-.5-.07-.2-.23-.31-.44-.29l-.95.04c-.18-.4-.39-.77-.63-1.12l.5-.8c.12-.17.1-.36-.03-.51-.16-.18-.33-.22-.53-.14l-.86.35c-.31-.3-.65-.58-.99-.82l.2-.91c.03-.22-.03-.4-.2-.49-.18-.1-.34-.09-.48.01l-.74.66c-.39-.18-.8-.32-1.21-.43l-.14-.93a.426.426 0 00-.36-.39c-.22-.03-.39.05-.47.22l-.44.84-.43-.02h-.22c-.22 0-.42.01-.65.03l-.44-.84c-.08-.17-.25-.25-.48-.22-.2.03-.33.17-.36.39l-.13.88c-.42.12-.83.26-1.22.44l-.69-.61c-.15-.15-.33-.17-.53-.06-.18.09-.24.26-.2.49l.2.91c-.36.24-.7.52-1 .82l-.86-.35c-.19-.09-.37-.05-.52.13-.14.15-.16.34-.04.51l.5.8c-.25.35-.45.72-.64 1.12l-.94-.04c-.21-.01-.37.1-.44.3-.07.2-.02.38.16.5l.73.59c-.1.41-.19.83-.22 1.27l-.89.29c-.21.07-.31.21-.31.42 0 .22.1.36.31.43l.89.28c.03.44.1.87.22 1.27l-.73.58c-.17.12-.22.31-.16.51.07.2.23.31.44.29l.94-.05c.18.39.39.77.63 1.12l-.5.8c-.12.18-.1.37.04.52.16.18.33.22.52.14l.86-.36c.3.31.64.58.99.82l-.2.92c-.04.22.03.39.2.49.2.1.38.08.54-.07l.69-.61c.39.17.8.33 1.21.44l.13.93c.03.21.16.35.37.39.22.03.39-.06.47-.24l.44-.84c.23.02.44.04.66.04z",fill:"#818b90"})]})}),V=()=>(0,j.jsx)("span",{className:L.default.icon,children:(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64",children:[(0,j.jsx)("path",{fill:"#FFF",d:"M6.525 43.936a29.596 29.596 0 0 1-3.039-13.075C3.494 14.568 16.755 1.313 33.05 1.313c7.904.004 15.328 3.082 20.91 8.666 5.581 5.586 8.653 13.01 8.65 20.907-.007 16.294-13.266 29.549-29.558 29.549a29.648 29.648 0 0 1-12.508-2.771L1.391 62.687l5.134-18.751z"}),(0,j.jsx)("path",{fill:"#123033",d:"M50.801 13.135c-4.739-4.742-11.039-7.354-17.752-7.357-13.837 0-25.094 11.253-25.099 25.085a25.039 25.039 0 0 0 3.349 12.541l-3.56 12.999 13.304-3.488a25.084 25.084 0 0 0 11.996 3.054h.011c13.83 0 25.088-11.256 25.095-25.087.002-6.703-2.607-13.005-7.344-17.747zM33.05 51.733h-.008a20.866 20.866 0 0 1-10.62-2.906l-.762-.452-7.894 2.07 2.108-7.694-.497-.789a20.802 20.802 0 0 1-3.189-11.097c.004-11.496 9.361-20.85 20.87-20.85a20.73 20.73 0 0 1 14.746 6.115 20.733 20.733 0 0 1 6.104 14.752c-.006 11.497-9.363 20.851-20.858 20.851z"}),(0,j.jsx)("path",{fill:"#123033",d:"M25.429 19.26a8.65 8.65 0 0 0-1.028.011 2.352 2.352 0 0 0-.95.255c-.221.114-.427.277-.75.582-.305.288-.481.54-.668.782a6.974 6.974 0 0 0-1.443 4.291l.001.003a8.243 8.243 0 0 0 .844 3.607c1.043 2.307 2.763 4.746 5.035 7.008a24.676 24.676 0 0 0 1.657 1.6 24.145 24.145 0 0 0 9.814 5.229s.751.179 1.391.218c.021.001.04.003.061.003a9.207 9.207 0 0 0 1.422-.033 5.086 5.086 0 0 0 2.129-.59c.423-.225.623-.337.978-.561 0 0 .11-.072.319-.23.345-.257.558-.438.845-.736.211-.22.394-.479.534-.772.2-.417.401-1.213.481-1.874.061-.505.042-.781.036-.952-.011-.275-.238-.558-.487-.678l-1.486-.668s-2.222-.967-3.581-1.587a1.278 1.278 0 0 0-.452-.104c-.341-.021-.723.068-.966.324v-.004c-.013-.001-.182.145-2.031 2.385-.102.122-.341.387-.754.362a1.086 1.086 0 0 1-.185-.029 3.402 3.402 0 0 1-.49-.17c-.316-.134-.427-.185-.643-.278l-.013-.006a15.361 15.361 0 0 1-4.013-2.556 15.88 15.88 0 0 1-.927-.885c-1.074-1.041-1.953-2.148-2.607-3.24-.035-.06-.09-.146-.15-.242-.107-.174-.225-.381-.262-.523-.095-.376.157-.678.157-.678s.622-.68.911-1.05c.278-.356.518-.704.671-.952.301-.484.39-.982.238-1.37a216.767 216.767 0 0 0-2.219-5.215c-.156-.339-.598-.589-1.005-.636a6.284 6.284 0 0 0-.414-.041"})]})})},157297:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertTabToMood=t.ValidMoods=t.StickerTabs=t.SCROLL_THROTTLE_TIME=t.SCROLL_CLICK_TIME_GAP=t.MINIMUM_LOADING_TIME=t.INPUT_SHOW_POINT=t.INPUT_HIDE_POINT=t.INPUT_BAR_TOTAL_HEIGHT=t.INPUT_BAR_SCROLL_SENSITIVITY=t.INPUT_BAR_SCROLL_FAST=void 0;t.SCROLL_CLICK_TIME_GAP=1e3;t.SCROLL_THROTTLE_TIME=100;t.INPUT_BAR_TOTAL_HEIGHT=63;t.INPUT_BAR_SCROLL_SENSITIVITY=5;t.INPUT_BAR_SCROLL_FAST=15;t.INPUT_HIDE_POINT=44.099999999999994;t.INPUT_SHOW_POINT=94.5;const r=n(76672).Mirrored(["LOVE","GREETINGS","HAPPY","SAD","ANGRY","CELEBRATE"]);t.ValidMoods=r;const i=n(76672).Mirrored(["RECENTS","FAVORITES","LOVE","GREETINGS","HAPPY","SAD","ANGRY","CELEBRATE","STORE"]);t.StickerTabs=i;t.convertTabToMood=e=>{const t=e;return r.isValid(t)?r.cast(t):null};t.MINIMUM_LOADING_TIME=1500},309294:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{constructor(e){this.cache=new Map,this.howBig=0,this.fn=e}getKeyString(e){return"string"==typeof e?e:e.join("_")}getRefSetter(e){const t=this.getKeyString(e);let n=this.cache.get(t);return n||(n=n=>{this.fn(e,n),n||this.cache.delete(t)},this.cache.set(t,n),Math.floor(this.cache.size/500)>this.howBig&&(__LOG__(4,void 0,new Error)`[SetRefCache] Large cache detected with ${this.cache.size} entries`,this.howBig=Math.floor(this.cache.size/500))),n}}},188406:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(441609)),a=r(n(876521));class o extends a.default{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"next";super(),this.list=e,this.index=-1,this.value=void 0,this.getter=t,this.deleteDir=n}init(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.list=n,null!=this.value)if((0,i.default)(n))this.unset();else{if(e=n.indexOf(this.value),e>-1){if(e===this.index)return;t=!0,r=!1}else if(!r||this.index<0)e=-1;else{const r="prev"===this.deleteDir?-1:0;e=this.index+r,e=Math.max(e,0),e=Math.min(e,n.length-1),t=e>-1}this.set(e,r,t)}}unset(){const e=this.value;this.value=void 0,this.index=-1,null!=e&&this.trigger(this.getter(e),!1)}reset(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.index<0||null!=this.value&&this.trigger(this.getter(this.value),"focus",e)}set(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.list.length)return;const r=Math.min(Math.max(e,-1),this.list.length-1),i=this.value,a=r>-1?this.list[r]:void 0;null!=a?(this.value=a,this.trigger(this.getter(a),!0===t?"focus":"select")):!0===n&&(this.value=void 0),!0===n&&null!=i&&i!==a&&this.trigger(this.getter(i),!1),this.index=r}getVal(){return this.value}setVal(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.list.indexOf(e);n>-1?this.set(n,t):(this.unset(),this.value=e)}setFirst(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(0,e,!0)}setLast(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.list.length-1,e,!0)}setPrev(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.prev(),e,!0)}setNext(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,i.default)(this.list)||this.set(this.next(),e,!0)}prev(){return(0,i.default)(this.list)||-1===this.index?-1:this.index-1}next(){return(0,i.default)(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}var s=o;t.default=s},131703:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(376139)),a=r(n(499360)),o=n(912591),s=r(n(914296)),l=n(785893);t.default=()=>{const e=i.default.build("https://www.whatsapp.com/legal/small-business-terms/",{lg:s.default.getLocale()});return(0,l.jsx)(a.default,{href:e,onClick:t=>{t.preventDefault(),setTimeout((()=>(0,o.openExternalLink)(e)),10)},children:s.default.t(397)})}},111054:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RADIUS=void 0,t.Spinner=function(e){const{size:t=65,stroke:n=4,color:r=c.default,outgoingMsg:i,max:l=100,value:u}=e,p=function(e,t){if(null==e)return null;const n=Math.max(Math.min(e,t),0);return Math.ceil(100*n/t)}(u,l),f=40+n;return(0,o.jsxs)("svg",{className:(0,a.default)(null==p&&s.container||s.rotate),width:t,height:t,viewBox:`0 0 ${f} ${f}`,role:"status",children:[null!=p?(0,o.jsx)(d,{viewBoxSide:f,stroke:n,outgoingMsg:i,color:"default",progress:l}):null,(0,o.jsx)(d,{progress:p,viewBoxSide:f,stroke:n,outgoingMsg:i,color:r})]})},t.styleThemeOptions=t.colorOptions=void 0;var i=r(n(566919)),a=r(n(156720)),o=n(785893);const s={accent:{stroke:"dba1p600"},container:{animationName:"gdrnme8s",animationDuration:"hbnrezoj",animationTimingFunction:"f8mos8ky",animationIterationCount:"tkmeqcnu",zIndex:"b9fczbqn"},default:{stroke:"a5uym4to"},highlight:{stroke:"sku37djt"},progress:{stroke:"gibn6ev6"},in:{stroke:"ptcoeott"},noop:{visibility:"g5crjs6l"},out:{stroke:"mbixqzja"},rounded:{strokeLinecap:"bvgz89zs"},path:{animationName:"nmreelbr",animationDuration:"sw4r90y6",animationTimingFunction:"gaqnkt02",animationIterationCount:"tkmeqcnu",strokeDasharray:"kzgl1sas",strokeDashoffset:"fwna6xbl"},solidwhite:{stroke:"ad0o4787"},white:{stroke:"qaop2s2o"},rotate:{transform:"bwjm0vhl",transformOrigin:"sx61ek5s"}},l=(0,i.default)({noop:null});t.styleThemeOptions=l;const c=(0,i.default)({default:null,highlight:null,solidwhite:null,white:null,accent:null,progress:null});t.colorOptions=c;function u(e){if(null==e)return null;const t=Math.ceil(40*Math.PI);return{strokeDasharray:`${t} ${t}`,strokeDashoffset:t-e/100*t}}function d(e){let{stroke:t,viewBoxSide:n,progress:r,color:i,outgoingMsg:l}=e;return(0,o.jsx)("circle",{style:u(r),className:(0,a.default)(s.rounded,null==r&&s.path,s[i],!1===l&&s.in,l&&s.out),cx:n/2,cy:n/2,r:20,fill:"none",strokeWidth:t})}t.RADIUS=20},287541:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(325389),i=n(411290),a=n(980134),o=n(608080);n(697335);t.default=class{constructor(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.componentName=e,this.name=t,this._isStrong=i,this.keys=n;const s=a.ProxyStates[t];s||(__LOG__(4,void 0,new Error,!0)`Unknown StateHOC concern type "${t}"`,SEND_LOGS("state-hoc-error")),this._proxyClass=s,this._limitedAccessProxyClass=function(e,t,n,i){const a={$ProxyState$ComponentName:{value:e},proxyBitMask:{value:(0,r.genBitMask)(t.prototype.mirrorMask,n)}};for(const t of n){const n={enumerable:!0};n.get=function(){return this.$ProxyState$state.get(t)},n.set=function(){__LOG__(4,void 0,new Error)`READ ONLY: Cannot write to proxied property "${t}", created in <${e} />, it is not writable.`},i||(n.set=function(e){this.$ProxyState$state.set(t,e)}),a[t]=n}function o(e){t.call(this,e)}return o.prototype=Object.create(t.prototype,a),o.prototype.constructor=o,o}(e,s,n,o)}getModel(e){return e instanceof this._proxyClass?e.$ProxyState$state:e}getModelAndValidate(e){const t=e instanceof this._proxyClass?e.$ProxyState$state:e;return t?t instanceof i.BaseModel?t:(__LOG__(4,void 0,new Error,!0)`${this.componentName} given invalid object for ${this.name}: ${n=t,"string"==typeof n?n:n.toString?n.toString():"Invalid Object"}`,SEND_LOGS("state-hoc-error"),null):(o.Stream.mode===o.StreamMode.MAIN&&(__LOG__(4,void 0,new Error,!0)`${this.componentName} was not supplied the ${this.name} model with keys ${String(this.keys)}.`,SEND_LOGS("state-hoc-error")),null);var n}createProxy(e){return new this._limitedAccessProxyClass(e)}attachConcern(e,t,n){e.incObservers(!this._isStrong),e.mirror.addListener(n,t,this)}detachConcern(e,t){e.decObservers(),e.mirror.removeListener(t)}}},490669:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STICKER_PADDING=t.STICKER_PACK_FETCH_TIMEOUT=t.STICKER_MAKER_IMAGE_PADDING=t.STICKER_LIST_ITEM_HEIGHT=t.STICKER_DIMENSION=t.STICKER_BORDER_WIDTH=void 0;t.STICKER_DIMENSION=512;t.STICKER_BORDER_WIDTH=8;t.STICKER_PADDING=36;t.STICKER_LIST_ITEM_HEIGHT=156;t.STICKER_MAKER_IMAGE_PADDING=20;t.STICKER_PACK_FETCH_TIMEOUT=86400},23217:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{className:t,containerRef:n,directional:r,display:l,height:c,name:u,color:d,title:p,style:f,width:_,viewBox:h,xstyle:g,iconXstyle:m,"aria-label":y,"aria-hidden":S}=e;return(0,o.jsx)(i.SVGBase,{"aria-hidden":S,"aria-label":y,className:t,containerRef:n,height:c,isRTL:!!r&&a.default.isRTL(),display:l,name:u,title:p,style:f,width:_,viewBox:h,xstyle:[g,d&&s[`${d}Color`]],iconXstyle:m})};var i=n(771798),a=r(n(914296)),o=(r(n(156720)),n(785893));const s={secondaryColor:{color:"aft2yglh"},tealColor:{color:"jq3rn4u7"},grayColor:{color:"hsqj3bek"}}},771798:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.SVGBase=void 0,t.getInternalSVGData=function(){},t.loadSVGData=v,t.loadSpecificSVG=function(){return T.apply(this,arguments)};var i=r(n(81109)),a=r(n(506479)),o=r(n(348926)),s=n(389385),l=n(180284),c=r(n(145095)),u=n(413959),d=n(904352),p=r(n(294184)),f=n(667294),_=r(n(156720)),h=r(n(803409)),g=n(785893);const m=["aria-label","aria-hidden","name","isRTL","className","display","containerRef","height","width","viewBox","xstyle","iconXstyle"],y={reverse:{display:"f804f6gw",transform:"n4o0o7gj"},inline:{display:"l7jjieqr",verticalAlign:"fewfhwl7"}};let S,E;function v(e){return E||(E=(0,d.promiseLoop)(((t,r,i)=>{if(null==e?void 0:e.aborted)throw new s.AbortError;const a=(0,u.delayMs)((0,l.expBackoff)(i,12e4,1e3,.1));return n.e(5512).then(n.bind(n,269692)).then((e=>{S=e.default,t()})).catch((()=>a))})))}function T(){return(T=(0,o.default)((function*(e){return yield v(),(0,c.default)(S,"SVGData")[e]}))).apply(this,arguments)}function C(e){const t=e.split("-");for(let e=1;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1).toLowerCase();return t.join("")}function A(e){if(null==e)return{};const t=e.attributes;return t.length>0?function(e){const t={};for(const n of e){let e=n.name;e.startsWith("xmlns")||(e.includes("-")?e=C(e):"class"===e&&(e="className"),t[e]=n.value)}return t}(t):{}}function b(e){var t;const[n,r]=(0,f.useState)(!!S),o=(0,h.default)();(0,f.useEffect)((()=>{n||v(o).then((()=>{if(o.aborted)throw new s.AbortError;r(!0)})).catch((()=>{}))}),[]);const{"aria-label":l,"aria-hidden":c,name:u,isRTL:d,className:E,display:T,containerRef:C,height:b,width:P,viewBox:O,xstyle:M,iconXstyle:I}=e,w=(0,a.default)(e,m);if(S&&!S[u])throw new Error("Missing SVG for '"+u+"'!");const R=null===(t=S)||void 0===t?void 0:t[u],N=(0,f.useMemo)((()=>function(e){if(null==e)return null;const t=document.createElement("div");t.innerHTML=e;const n=t.firstElementChild;return"svg"===(null==n?void 0:n.tagName)?(t.removeChild(n),n):null}(R)),[R]),L=(0,f.useMemo)((()=>A(N)),[N]);if(O){const{x:e=0,y:t=0,width:n=0,height:r=0}=O;L.viewBox=[e,t,n,r].join(" ")}const D={};return null==b&&null==P||(D.height=b,D.width=P,D.preserveAspectRatio="xMidYMid meet"),(0,g.jsx)("span",(0,i.default)((0,i.default)({"data-testid":u,"aria-hidden":c,"aria-label":l,ref:C,"data-icon":u,className:(0,p.default)(E,(0,_.default)(d&&y.reverse,"inline"===T&&y.inline,M))},w),{},{children:(0,g.jsx)("svg",(0,i.default)((0,i.default)((0,i.default)({},L),D),{},{className:(0,_.default)(I),dangerouslySetInnerHTML:{__html:null==N?void 0:N.innerHTML}}))}))}const P=(0,f.memo)(b);t.SVGBase=P},603137:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(876521));class a extends i.default{constructor(){super(),this.mediaQuery=window.matchMedia("(prefers-color-scheme: dark)"),this.theme=this.getCurrentTheme(),this.handleThemeChange=()=>{const e=this.getCurrentTheme();e!==this.theme&&(this.theme=e,this.trigger("system_theme_change",e))},this.mediaQuery.addListener(this.handleThemeChange)}getCurrentTheme(){return this.mediaQuery.matches?"dark":"light"}}var o=new a;t.default=o},113923:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Text=p,t.TextDiv=function(e){return(0,c.jsx)(p,(0,a.default)({as:"div"},e))},t.TextHeader=function(e){const{level:t="1"}=e,n=(0,i.default)(e,u);return(0,c.jsx)(p,(0,a.default)({as:f[t]},n))},t.TextLabel=function(e){let{htmlFor:t}=e,n=(0,i.default)(e,d);return(0,c.jsx)(p,(0,a.default)((0,a.default)({as:"label"},n),{},{extras:{htmlFor:t}}))},t.TextParagraph=function(e){return(0,c.jsx)(p,(0,a.default)({as:"p"},e))},t.TextSpan=function(e){return(0,c.jsx)(p,(0,a.default)({as:"span"},e))};var i=r(n(506479)),a=r(n(81109)),o=r(n(858425)),s=r(n(294184)),l=r(n(156720)),c=n(785893);const u=["level"],d=["htmlFor"];function p(e){var t,n,r,i;const u=null!==(t=e.as)&&void 0!==t?t:"span",d=e.theme?o.default[e.theme]:null,p=e.color?o.default[`color-${e.color}`]:null,f=o.default[`weight-${null!==(n=e.weight)&&void 0!==n?n:"normal"}`],_=null!=e.customSize||null!=(null!==(r=e.xstyle)&&void 0!==r?r:{}).fontSize?null:null!==(i=e.size)&&void 0!==i?i:"14",h=null!=_?o.default[`size-${_}`]:null;let g;return null!=e.customSize&&(g={fontSize:"string"==typeof e.customSize?e.customSize:`${e.customSize}px`}),(0,c.jsx)(u,(0,a.default)((0,a.default)({},e.extras),{},{className:(0,s.default)(d,p,h,f,e.className,(0,l.default)(e.xstyle)),style:g,"data-testid":e.testid,children:e.children}))}const f={1:"h1",2:"h2",3:"h3",4:"h4",5:"h5",6:"h6"}},950452:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastDismissBtn=t.ToastBody=t.ToastActionBtn=t.Toast=void 0,t.genId=function(e){return(0,i.default)(e||"toast")};var i=r(n(873955)),a=n(694816),o=n(128298),s=r(n(23217)),l=n(667294),c=r(n(156720)),u=n(346428),d=n(785893);const p=4e3,f={btnSuccess:{color:"j5au4wul",fontWeight:"nbipi2bn"},button:{color:"dud78hvd",cursor:"ajgl1lbb",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo",flexShrink:"oq44ahr5"},close:{color:"afo7vhit"},right:{right:"grt5ktjy"},toast:{alignItems:"gndfcl4n",backgroundColor:"cqvkqxai",borderTopStartRadius:"cynldqnp",borderTopEndRadius:"l5pmshjt",borderBottomEndRadius:"ecxr5yey",borderBottomStartRadius:"lysxvg3k",color:"k17s6i4e",display:"p357zi0d",fontSize:"f8jlpxt4",lineHeight:"a4ywakfo"}};const _=(0,l.forwardRef)(((e,t)=>{const{msg:n,action:r,onDismiss:i,id:o,duration:s=p}=e,[c]=(0,u.useTimeout)((()=>{a.ToastManager.close(o)}),s,{immediate:!0}),f=()=>{a.ToastManager.close(o),null==i||i()};let _;return(0,l.useImperativeHandle)(t,(()=>({restartDelay:c}))),r&&(_=(0,d.jsx)(h,{buttonText:r.actionText,onClick:r.dismiss?f:r.onAction,theme:r.theme})),(0,d.jsx)(g,{actionText:n,actionBtn:_})}));t.Toast=_;const h=e=>{let{buttonText:t,onClick:n,theme:r}=e;return(0,d.jsx)("button",{className:(0,c.default)(f.button,o.uiMargin.start15,"success"===r&&f.btnSuccess),onClick:n,children:t})};t.ToastActionBtn=h;t.ToastDismissBtn=e=>{let{buttonText:t,onClick:n}=e;return(0,d.jsx)("button",{className:(0,c.default)(f.close,o.uiMargin.start15),onClick:n,children:(0,d.jsx)(s.default,{name:"x-alt"})})};const g=e=>{let{toastPosition:t,actionText:n,actionBtn:r,dismissBtn:i}=e;return(0,d.jsxs)("div",{className:(0,c.default)(f.toast,o.uiPadding.vert12,o.uiPadding.horiz16,"RIGHT"===t&&f.right),"data-testid":"toast-body",children:[(0,d.jsx)("span",{children:n}),r,i]})};t.ToastBody=g},694816:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastPosition=t.ToastManager=void 0;var i=r(n(876521));const a=n(76672)({LEFT:"LEFT",CENTER:"CENTER",RIGHT:"RIGHT"});t.ToastPosition=a;class o extends i.default{open(e,t){this.trigger("open_toast",e,t)}close(e){this.trigger("close_toast",e)}}const s=new o;t.ToastManager=s},964316:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ToastManagerComponent=function(){const e=(0,h.default)((()=>new Map)),t=(t,n)=>{n?e.current.set(t,n):e.current.delete(t)},n=(0,h.default)((()=>new d.default(t))),r=(0,f.useRef)(null),[E,v]=(0,f.useState)({}),T=(0,m.default)(E),C=(t,n)=>{const r=t.props.id,a=e.current.get(r);var o;a?null===(o=a.restartDelay)||void 0===o||o.call(a):v((0,i.default)((0,i.default)({},E),{},{[r]:{toast:t,position:n}}))};(0,g.useListener)(s.ToastManager,"open_toast",C),(0,g.useListener)(s.ToastManager,"close_toast",(e=>{E[e]&&v((0,o.default)(E,e))}));const A=null;(0,g.useListener)(A,"cannot_reach_phone",(e=>{C((0,y.jsx)(p.Toast,{msg:e,id:(0,p.genId)()}))}));(0,g.useListener)(A,"window_error",(e=>{const t=e.length>200?`${e.slice(0,200)}...`:e;C((0,y.jsx)(p.Toast,{msg:`🛑 ${t}`,id:(0,p.genId)()}))})),(0,g.useListener)(A,"ping_sent",(e=>{C((0,y.jsx)(p.Toast,{msg:e,id:(0,p.genId)()}))})),(0,f.useEffect)((()=>{r.current=Object.keys(null!=T?T:{}).length>Object.keys(E).length}),[E,T]);const b=r.current,P=(0,a.default)(E,["toast","id"]).reverse().map(((e,t)=>{let{toast:r,position:i}=e;return(0,y.jsx)("div",{className:(0,_.default)(S.wrapper,i===s.ToastPosition.CENTER&&S.center,i===s.ToastPosition.RIGHT&&S.right,0===t&&b&&S.slide0,1===t&&S.slide1,2===t&&S.slide2,t>=3&&S.slide3),children:(0,y.jsx)("div",{className:(0,_.default)(i===s.ToastPosition.CENTER&&(u.default.isRTL()?S.transformRight:S.transformLeft)),children:(0,f.cloneElement)(r,{ref:n.current.getRefSetter(r.props.id)})})},r.props.id)})),O=l.UA.isTrident?"fade_sifo":"toast-transition";return(0,y.jsx)(c.default,{transitionName:O,children:P})};var i=r(n(81109)),a=r(n(189734)),o=r(n(957557)),s=(n(781572),n(694816)),l=n(26741),c=r(n(540436)),u=r(n(914296)),d=r(n(309294)),p=n(950452),f=n(667294),_=r(n(156720)),h=r(n(616223)),g=n(587550),m=r(n(837453)),y=n(785893);const S={slide0:{transform:"qdd0en2n"},slide1:{transform:"gqonocmn"},slide2:{transform:"b5bqnu92"},slide3:{opacity:"axi1ht8l",transform:"j7iro104"},wrapper:{opacity:"bs7a17vp",bottom:"jxacihee",lineHeight:"d53pemmv",marginTop:"fgtikrv0",marginEnd:"gqi0zhd6",marginBottom:"dblt22a0",marginStart:"nzcjdldu",minHeight:"ocs0cmsa",position:"lhggkp7q",zIndex:"pglj95m3",transition:"byw3xhqn"},center:{start:"m7kgcvyw",marginStart:"svoq16ka",marginEnd:"jnwc1y2a",maxWidth:"culzvsue"},transformLeft:{transform:"t9w6h8zt"},transformRight:{transform:"ajuzgosp"},right:{end:"ebjesfe0"}}},789618:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIMState=t.UIM=void 0;var i=r(n(84753)),a=r(n(82729)),o=r(n(757538));const s=n(76672).Mirrored(["ACTIVE","PASSIVE","INACTIVE","DEAD"]);t.UIMState=s;class l{static maybePreventScroll(e){var t;const n=null===(t=l.Manager.getTop())||void 0===t?void 0:t.getNode();e.target instanceof HTMLElement&&n&&!n.contains(e.target)&&(e.preventDefault(),e.stopPropagation())}constructor(e,t){this.shouldRequestFocus=!0,this.parent=t||this,t||(l.Manager.root&&(__LOG__(4,void 0,new Error,!0)`Attempting to set multiple UIM tree roots. Expecting only one.`,SEND_LOGS("multiple-uim-roots")),l.Manager.root=this),this.displayName=e.displayName,this.popable=e.popable,this.escapable=e.escapable,this.requestFocus=e.requestFocus,this.requestDismiss=e.requestDismiss,this.getNode=e.getNode,this.dismissOnWindowResize=e.dismissOnWindowResize,this.children=[],this.setState(e.uimState)}getState(){return this._state}setState(e){switch(e){case s.ACTIVE:this.lastActive=Date.now(),l.Manager.setTop(this);break;case s.PASSIVE:this.lastActive=Date.now(),this._state!==s.ACTIVE&&l.Manager.setTop(l.findMostRecentlyActiveFocusable());break;case s.INACTIVE:this._state&&this._state!==e&&l.Manager.setTop(l.findMostRecentlyActiveFocusable());break;case s.DEAD:}this._state=e}activate(){this.setState(this._state)}branch(e){const t=new l(e,this);return this.children.push(t),l.pprint(),t}pop(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.getState()===s.DEAD)return;this._invalidateAndDismissChildren(this.children,e),(0,a.default)(this.parent.children,(e=>e===this));const n=l.findMostRecentlyActiveFocusable(this);n&&(n.shouldRequestFocus=t),l.Manager.setTop(n),l.pprint()}_invalidateAndDismissChildren(e,t){e.forEach((e=>{e.setState(s.DEAD),e.requestDismiss(t),this._invalidateAndDismissChildren(e.children,t)}))}static findMostRecentlyActiveFocusable(e){const{root:t}=l.Manager;if(t)return c(t,e,(e=>{const t=e.getState();return t===s.ACTIVE||t===s.PASSIVE}))}static findMostRecentlyActiveDismissable(e){const{root:t}=l.Manager;if(t)return c(t,e,(e=>e.getState()===s.ACTIVE))||c(t,e,(e=>e.getState()===s.PASSIVE))}static pprint(e){if(!e&&!l.Manager.verbose)return;const{root:t}=l.Manager;t&&__LOG__(2)`${d(t,[])}`}}function c(e,t,n){if(!e.children.length)return e;const r=e.children.filter((e=>e!==t)).map((e=>c(e,t,n))).concat([e]).filter(Boolean).filter(n);return(0,i.default)(r,"lastActive")}t.UIM=l,l.State=s,l.Manager=new class{constructor(){this.verbose=!1}setTop(e){var t;e&&(e.lastActive=Date.now()),e&&this._top!==e&&e.getState()!==s.INACTIVE&&e.getState()!==s.DEAD&&e.shouldRequestFocus&&e.requestFocus(),e&&(e.shouldRequestFocus=!0),(null===(t=this._top)||void 0===t?void 0:t.popable)&&window.removeEventListener("wheel",l.maybePreventScroll,{passive:!1,capture:!0}),(null==e?void 0:e.popable)&&window.addEventListener("wheel",l.maybePreventScroll,{passive:!1,capture:!0}),this._top=e}getTop(){return this._top}refocusTopUie(){setTimeout((()=>{null!=this._top&&document.activeElement===document.body&&this._top.requestFocus()}),0)}};function u(e,t,n,r){let i;i=n&&r?"├─┬":n&&!r?"├──":!n&&r?"└─┬":"└──",e===l.Manager.root&&(i="▶");let a=e.displayName;e===l.Manager.getTop()&&(a=`${a} ⬥`);const o=`(${function(e){switch(e){case s.ACTIVE:return"A";case s.PASSIVE:return"P";case s.INACTIVE:return"I";case s.DEAD:return"D"}}(e.getState())})${r?"\n":""}`;return`${t.join("")}${i} ${a} ${o}`}function d(e,t,n){return u(e,t,n,!!e.children.length)+e.children.map(((r,i)=>{const a=i<e.children.length-1;return d(r,n?t.concat(["│ "]):t.concat(["  "]),a)})).join("\n")}window.addEventListener("keydown",(e=>{if(e.keyCode!==o.default.ESC)return;const t=l.Manager.getTop(),n=(null==t?void 0:t.getState())===s.ACTIVE?t:l.findMostRecentlyActiveDismissable();(null==n?void 0:n.escapable)&&(e.stopPropagation(),e.preventDefault(),n.requestDismiss(!1))}),{capture:!0}),window.addEventListener("resize",(()=>{const e=l.Manager.getTop(),t=(null==e?void 0:e.getState())===s.ACTIVE?e:l.findMostRecentlyActiveDismissable();(null==t?void 0:t.dismissOnWindowResize)&&(null==t?void 0:t.escapable)&&t.requestDismiss(!1)}));let p=null;function f(e,t){const n=e&&e.getState()===s.ACTIVE&&e.popable?e:l.findMostRecentlyActiveDismissable();if(!n||!n.popable)return null;const r=n.getNode();return r&&t.target instanceof Node&&r.contains(t.target)?null:n}window.addEventListener("mousedown",(e=>{if(p=null,!e.screenX||!e.screenY)return;const t=f(l.Manager.getTop(),e);t&&2===e.button?t.requestDismiss():p=t}),{capture:!0}),window.addEventListener("mouseup",(e=>{if(!e.screenX||!e.screenY)return void(p=null);const t=f(l.Manager.getTop(),e);t&&t===p&&setTimeout((()=>t.requestDismiss()),0),p=null}),{capture:!0})},718644:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UIE=void 0;var i=n(789618),a=r(n(502773)),o=n(667294),s=r(n(616223)),l=r(n(955010)),c=r(n(389113)),u=r(n(895402)),d=r(n(803409)),p=n(785893);let f=null;const _=(0,o.forwardRef)(((e,t)=>{const{uimState:n=i.UIMState.ACTIVE,requestRecentFocusOnUnmount:r=!0,popable:_=!1,escapable:h=!1,displayName:g,children:m,dismissOnWindowResize:y=!1}=e,S=(0,u.default)(),E=function(e){const t=(0,d.default)(),n=(0,o.useRef)(!1),r=(0,o.useRef)(null),i=()=>{e&&(f&&clearTimeout(f),r.current=f=setTimeout((()=>{e(),r.current=f=null}),0))},a=(0,c.default)((()=>{e&&!t.aborted?i():n.current=!0}));return(0,o.useEffect)((()=>(n.current&&i(),()=>{f&&r.current===f&&(clearTimeout(f),f=null)})),[]),a}(e.requestFocus),v=(0,c.default)(e.requestDismiss),T=(0,o.useRef)(null),C=(0,o.useCallback)((()=>{const e=T.current;if(null!=e)return e instanceof HTMLElement?e:e.getElement()}),[]),A=(0,s.default)((()=>{var e;const t={displayName:g,popable:_,escapable:h,uimState:n,requestFocus:E,requestDismiss:v,getNode:C,dismissOnWindowResize:y};return null!==(e=null==S?void 0:S.branch(t))&&void 0!==e?e:new i.UIM(t)}));if((0,o.useEffect)((()=>{A.current.setState(n)}),[n,A]),(0,l.default)((()=>{A.current.pop(!0,r)})),(0,o.useImperativeHandle)(t,(()=>({activate(){A.current.activate()},getNode:C}))),!m)return null;const b=(0,o.cloneElement)(m,{ref:e=>{var t,n;const r=null!==(t=null==e||null===(n=e.getComponent)||void 0===n?void 0:n.call(e))&&void 0!==t?t:e;T.current=r;const i=m.ref;i&&("function"==typeof i?i(r):i.current=r)}});return(0,p.jsx)(a.default.Provider,{value:A.current,children:b})}));t.UIE=_,_.displayName="UIE"},333358:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(667294),i=n(785893),a=(0,r.forwardRef)((function(e,t){let{children:n}=e;const a=(0,r.useRef)();return(0,r.useImperativeHandle)(t,(()=>({getElement:()=>a.current}))),(0,i.jsx)("div",{ref:a,children:n})}));t.default=a},624717:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(145095)),a=n(781572),o=n(667294),s=r(n(895402));function l(e,t){const{contextMenu:n}=e,r=(0,s.default)(),l=(0,o.useRef)(null);(0,o.useEffect)((()=>(a.Cmd.openContextMenu({menuOptions:n,uim:(0,i.default)(r,"uim")},(e=>{l.current=e})),()=>{a.Cmd.closeContextMenu(r)})),[]);const c=()=>l.current;return(0,o.useImperativeHandle)(t,(()=>({getElement:c}))),null}var c=(0,o.forwardRef)(l);t.default=c},502773:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(0,n(667294).createContext)(null);t.default=r},478123:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHAT_WALLPAPER=void 0,t.colorExistsInTheme=function(e,t){const n=d(t);return e===i||n.some((t=>t.toUpperCase()===e.toUpperCase()))},t.getDoodleAssetName=function(e,t){if(r.ServerProps.wallpapersV2&&"light"===t&&e!==i){const n=p(e,t,"doodle");if(n)return`data-asset-chat-background-${n}`}let n=`data-asset-chat-background-${t}`;"light"===t&&e===i&&(n="data-asset-chat-background-dark");return n},t.getDoodleOpacity=function(e,t){if(r.ServerProps.wallpapersV2){const n=p(e,t,"opacity");if(n)return n}if("light"===t&&e===i)return"0.4";return"0.06"},t.getWallpaperColorPropValue=p,t.getWallpaperColors=d,t.invertTransparentWallpaperColors=function(e,t){if(r.ServerProps.wallpapersV2)return"light"===e&&t!==i&&!!p(t,e,"invertTransparentWallpaperColors");const n=o.includes(t);return!!d(e).includes(t)&&(n?"light"===e:"dark"===e)},t.toggleWallpaperColor=function(e,t){const n=d(t);if(e===i)return i;if(r.ServerProps.wallpapersV2){const r=n.findIndex((t=>t.toUpperCase()===e.toUpperCase()));if(-1!==r)return"light"===t?u[r]:c[r]}return e};var r=n(964551);const i="default_chat_wallpaper";t.DEFAULT_CHAT_WALLPAPER=i;const a=["#ccebdc","#aed8c7","#7acba5","#c7e9eb","#a9dbd8","#68d5d9","#6ec3d4","#f2dad5","#f2d5e1","#fbcad2","#ffa7a8","#cbdaec","#d7d3eb","#e5c0eb","#d0deb1","#dee0b4","#e6dfa8","#f7e9a8","#ffd1a4","#ff8a8c","#ff5978","#f56056","#dc6e4f","#e6e365","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#dee3e9","#d9dade","#c0c1c4","#7e90a3","#55626f","#243640","#162127"],o=["#ff8a8c","#ff5978","#f56056","#dc6e4f","#73c780","#2293a4","#219ed9","#2b5aa6","#74676a","#48324d","#7e90a3","#55626f","#243640","#162127"],s={"#BBE4E5":{doodle:"dark",opacity:"0.42"},"#AED8C7":{doodle:"dark",opacity:"0.3"},"#7ACBA5":{doodle:"dark",opacity:"0.26"},"#CBDAEC":{doodle:"dark",opacity:"0.42"},"#66D2D5":{doodle:"dark",opacity:"0.26"},"#63BDCF":{doodle:"dark",opacity:"0.26"},"#D6D0F0":{doodle:"dark",opacity:"0.36"},"#CECECE":{doodle:"dark",opacity:"0.36"},"#D1DABE":{doodle:"dark",opacity:"0.36"},"#E6E1B1":{doodle:"dark",opacity:"0.42"},"#FEEFA9":{doodle:"light",opacity:"0.06"},"#FED297":{doodle:"dark",opacity:"0.42"},"#FD9A9B":{doodle:"dark",opacity:"0.26"},"#FD6769":{doodle:"dark",opacity:"0.26"},"#FB4668":{doodle:"dark",opacity:"0.26"},"#922040":{doodle:"dark",opacity:"0.17",invertTransparentWallpaperColors:!0},"#DC6E4F":{doodle:"dark",opacity:"0.2"},"#644D52":{doodle:"dark",opacity:"0.13",invertTransparentWallpaperColors:!0},"#517E7E":{doodle:"dark",opacity:"0.13"},"#3190BB":{doodle:"dark",opacity:"0.13"},"#35558A":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#55626F":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#1D2326":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#301E34":{doodle:"dark",opacity:"0.1",invertTransparentWallpaperColors:!0},"#ECF0F1":{doodle:"light",opacity:"0.06"},"#FFFEA2":{doodle:"light",opacity:"0.06"},"#E7E8D2":{doodle:"light",opacity:"0.06"}},l={"#0F2424":{doodle:"dark",opacity:"0.05"},"#12261F":{doodle:"dark",opacity:"0.055"},"#11241C":{doodle:"dark",opacity:"0.055"},"#111E27":{doodle:"dark",opacity:"0.06"},"#0F2224":{doodle:"dark",opacity:"0.06"},"#0E2125":{doodle:"dark",opacity:"0.055"},"#1F1D25":{doodle:"dark",opacity:"0.06"},"#212121":{doodle:"dark",opacity:"0.055"},"#1F211C":{doodle:"dark",opacity:"0.055"},"#23231B":{doodle:"dark",opacity:"0.055"},"#262419":{doodle:"dark",opacity:"0.055"},"#261F17":{doodle:"dark",opacity:"0.055"},"#261717":{doodle:"dark",opacity:"0.055"},"#260F10":{doodle:"dark",opacity:"0.06"},"#260A10":{doodle:"dark",opacity:"0.07"},"#19050B":{doodle:"dark",opacity:"0.075"},"#21100C":{doodle:"dark",opacity:"0.07"},"#0F0C0C":{doodle:"dark",opacity:"0.065"},"#101919":{doodle:"dark",opacity:"0.06"},"#0A1D25":{doodle:"dark",opacity:"0.055"},"#0D1523":{doodle:"dark",opacity:"0.065"},"#0D0F11":{doodle:"dark",opacity:"0.07"},"#0A0C0D":{doodle:"dark",opacity:"0.07"},"#110B12":{doodle:"dark",opacity:"0.07"},"#1E1F1F":{doodle:"dark",opacity:"0.055"},"#262618":{doodle:"dark",opacity:"0.055"},"#23231F":{doodle:"dark",opacity:"0.055"}},c=Object.keys(s),u=Object.keys(l);function d(e){return r.ServerProps.wallpapersV2?"light"===e?c:u:a}function p(e,t,n){const r="light"===t?s:l;for(const t in r)if(t.toUpperCase()===e.toUpperCase())return r[t][n];return null}},188172:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ComposeBoxActions=void 0;var i=r(n(876521)),a=n(118146);class o extends i.default{focus(e){const t=(0,a.unproxy)(e);t?this.trigger("focus_"+t.id.toString()):this.trigger("focus")}send(e){const t=(0,a.unproxy)(e);this.trigger("send_"+t.id.toString())}paste(e,t){const n=(0,a.unproxy)(e);this.trigger("paste_"+n.id.toString(),t)}sendPaste(e,t){const n=(0,a.unproxy)(e);this.trigger("send_paste_"+n.id.toString(),t)}toggleQuickReplies(){this.trigger("toggle_quick_replies")}addMsgSendingLogAttributes(e,t){this.trigger("add_sending_log_attributes_"+e.id.toString(),t)}setCtwaContextLinkData(e,t){this.trigger("set_ctwa_context_link_data_"+e.id.toString(),t)}}const s=new o;t.ComposeBoxActions=s},173770:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LargeEmoji=function(e){const{emoji:t,size:n=v.MEDIUM,animation:r=!1,element:u="div",selectable:d,xstyle:A}=e,b=(0,h.default)(),P=(0,f.useCallback)((()=>{const t=m(e.emoji);return Boolean(null!=t&&E(t))}),[e.emoji]),[O,M]=(0,f.useState)(P);(0,f.useEffect)((()=>{M(P())}),[b,P]);const I=m(t);if(null==I)return null;const w=(0,p.default)({[a.default.medium]:n===v.MEDIUM,[a.default.large]:n===v.LARGE,[a.default.xlarge]:n===v.XLARGE});let R;R=n===v.XLARGE?C:T;const N=y(I,R)[o.default.currentRes];if(O&&r)return(0,g.jsxs)(u,{className:(0,p.default)(a.default.animation,(0,_.default)(A)),children:[(0,g.jsx)(s.SelectableImg,{alt:t,className:(0,p.default)(a.default.highRes,w),draggable:!1,plainText:t,selectable:Boolean(d),src:i.default.ONE_BY_ONE_TRANS_GIF}),(0,g.jsx)(c.default,{className:(0,p.default)(a.default.highRes,w,a.default.heartbeat),draggable:!1,selectable:!1,src:N})]});const L=O?void 0:(0,g.jsx)(l.default,{className:(0,p.default)(a.default.lowRes,w),emoji:t,xstyle:A,selectable:d},"low-res"),D=(0,g.jsx)(l.default,{className:(0,p.default)(a.default.highRes,w,{[a.default.invisible]:!O}),emoji:t,xstyle:A,selectable:d,src:N,onLoad:()=>{const e=m(t);null!=e&&S(e),M(!0)}},"high-res");return(0,g.jsxs)("span",{className:a.default.wrapper,children:[L,D]})},t.SIZE=void 0;var i=r(n(364369)),a=r(n(757312)),o=r(n(930588)),s=n(552596),l=r(n(684636)),c=r(n(247065)),u=n(767247),d=n(513045),p=r(n(294184)),f=n(667294),_=r(n(156720)),h=r(n(574744)),g=n(785893);const{getGlyphId:m,getGlyphPath:y,markGlyphCached:S,isGlyphCached:E}=u.EmojiUtil,v=d.LARGE_EMOJI_SIZE;t.SIZE=v;const T="large",C="xlarge"},432554:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.STATUS_IMAGE_RATIO_THRESHOLD=t.HQ_PREVIEW_LIFESPAN=void 0,t.displayHighQualityLinkPreview=function(e,t){if(!Boolean(e.thumbnailDirectPath||e.thumbnailHQ)||null==e.thumbnailHeight||null==e.thumbnailWidth)return!1;if(o(e.t))return!1;if(t===i.DISPLAY_TYPE.GALLERY)return!1;if(t===i.DISPLAY_TYPE.STATUS&&null!=e.thumbnailHeight&&null!=e.thumbnailWidth)return e.thumbnailWidth/e.thumbnailHeight>=1.4;return!0},t.hqLinkPreviewExpired=o;var r=n(40234),i=n(705177);const a=2592e3;function o(e){return r.Clock.globalUnixTime()-e>a}t.HQ_PREVIEW_LIFESPAN=a;t.STATUS_IMAGE_RATIO_THRESHOLD=1.4},287543:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{theme:t,wid:n}=e,[r,h]=(0,d.useState)(null),[g,m]=(0,d.useState)(null),y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(e.img)},S=(0,f.default)();if((0,d.useEffect)((()=>{n&&c.ProfilePicThumbCollection.find(n).then((e=>(0,i.delayMs)(0).then((()=>e)))).then((e=>{S.aborted||(m(e),y(e))})).catch((()=>{}))}),[]),(0,p.useListener)(g,"change:img",y),r&&e.wid)return(0,_.jsx)(o.DetailImage,{id:e.wid,quoted:e.quoted,size:e.size,shape:e.shape,border:e.border,quality:e.quality});let E;E="number"==typeof e.size&&0!==e.size||"number"!=typeof e.size&&null!=e.size?e.size:o.DetailImageSize.Small;const v=(0,o.getSize)(E)||void 0,T=e.thumbs?e.thumbs:[e.thumb],C=T.map(((t,n)=>{if(t)return(0,_.jsx)("img",{className:a.default.image,src:t,alt:""},n);const r=v&&v/(T.length>2&&n>0?2:1);return(0,_.jsx)(s.FlexRow,{className:a.default.default,justify:"center",align:"center",children:(0,_.jsx)(l.default,{name:e.quoted?"default-user-square":"default-user",style:{width:r,height:r},className:a.default.icon})},n)}));let A;A=1===C.length?C[0]:2===C.length?(0,_.jsxs)(s.FlexRow,{className:a.default.row,justify:"stretch",align:"stretch",children:[C[0],C[1]]}):(0,_.jsxs)(s.FlexRow,{className:a.default.row,justify:"stretch",align:"stretch",children:[C[0],(0,_.jsxs)(s.FlexColumn,{className:a.default.col,justify:"stretch",align:"stretch",children:[C[1],C[2]]})]});return(0,_.jsx)(s.FlexRow,{className:(0,u.default)(a.default.container,{[a.default.square]:e.shape===o.DetailImageShape.Square,[a.default.hasBorder]:e.border,[a.default.hasInnerBorder]:"voip"===t||"voip-dimmed"===t,[a.default.hasLargeInnerBorder]:"voip-large"===t||"voip-large-dimmed"===t,[a.default.dimmed]:"voip-dimmed"===t||"voip-large-dimmed"===t}),style:{width:v,height:v},children:A})};var i=n(413959),a=r(n(223766)),o=n(288984),s=n(429623),l=r(n(23217)),c=(n(793836),n(582039)),u=r(n(294184)),d=n(667294),p=n(587550),f=r(n(803409)),_=n(785893)},694270:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionBubbleType=void 0;const r=n(76672).Mirrored(["DEFAULT","NON_CONVERSATION","STICKER","MEDIA_ITEM"]);t.ReactionBubbleType=r},552930:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o(null,a.default.fromForwardsStrings(e.sort(((e,t)=>t.length-e.length)).map((e=>`${e}${s}`))),null,0)};var i=r(n(103522)),a=r(n(355205));function o(e,t,n,r,a){const c=[];let u=!1,d=a;if(null==d)if(e&&1===r){l.has(e)&&(d=!0)}else e&&n&&2===r&&(d=l.has(n+e));t.getChildren().forEach((t=>{t.prefix!==s?c.push(o(t.prefix,t.node,e,r+1,d)):u=!0}));const p="️"!==e||null==n||d?(0,i.default)(e||""):"️?";let f=0===c.length?"":`(?:${c.join("|")})`;return f&&u&&(f+="?"),`${p}${f}`}const s="\n",l=new Set(["©","®","™","♟","♾","〰"])},513045:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VARIATION_CATEGORY=t.ORDERED_CATEGORY_IDS=t.LARGE_EMOJI_SIZE=t.HEART_EMOJIS=t.EMOJI_WIDTH=t.EMOJI_TYPE=t.CATEGORY_ORDERING=t.CATEGORY_MAPPING=t.CATEGORIES=t.BUCKET_SIZE=void 0;t.BUCKET_SIZE=25;t.CATEGORIES={SMILEYS_PEOPLE:"SMILEYS_PEOPLE",ANIMALS_NATURE:"ANIMALS_NATURE",FOOD_DRINK:"FOOD_DRINK",ACTIVITY:"ACTIVITY",TRAVEL_PLACES:"TRAVEL_PLACES",OBJECTS:"OBJECTS",SYMBOLS:"SYMBOLS",FLAGS:"FLAGS"};t.CATEGORY_MAPPING={"Smileys & People":"SMILEYS_PEOPLE","Animals & Nature":"ANIMALS_NATURE","Food & Drink":"FOOD_DRINK",Activity:"ACTIVITY","Travel & Places":"TRAVEL_PLACES",Objects:"OBJECTS",Symbols:"SYMBOLS",Flags:"FLAGS"};const r=["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS"];t.ORDERED_CATEGORY_IDS=r;t.EMOJI_TYPE={APPLE:"APPLE",WHATSAPP:"WHATSAPP"};t.EMOJI_WIDTH={small:20,large:32};const i=n(76672).Mirrored(["MEDIUM","LARGE","XLARGE"]);t.LARGE_EMOJI_SIZE=i;const a=[...r,"VARIATION"];t.CATEGORY_ORDERING=a;const o=a.indexOf("VARIATION");t.VARIATION_CATEGORY=o;t.HEART_EMOJIS=["❤️","♥️","🤎","💖","🖤","💚","💜","💗","💓","💙","🤍","💛","💕","🧡","❤️‍🔥"]},917136:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,p.emojiSearch)(e,(0,l.default)(g,"Emoji Trie expected to be loaded."))};var i=r(n(348926)),a=r(n(944908)),o=r(n(713752)),s=n(180284),l=r(n(145095)),c=n(413959),u=n(904352),d=r(n(312523)),p=n(586379),f=r(n(914296)),_=n(608080);const h=new Set(["ar","bn","cs","de","en","es","fa","fr","gu","he","hi","hu","id","it","mr","ms","nl","pl","pt","pt-BR","ro","ru","sk","th","tr","uk","ur","zh-CN","zh-TW","zh-HK"]);let g=null;let m=null,y=[];function S(){const e=(0,a.default)(["en",f.default.getLocale()]).filter((e=>h.has(e)));if((0,o.default)(y,e))return;y=e;const t=Promise.all(e.map((e=>function(e){return(0,u.promiseLoop)(function(){var t=(0,i.default)((function*(t,r,i){const a=(0,c.delayMs)((0,s.expBackoff)(i,12e4,1e3,.1));let o=yield n(826299)(`./${e}`);try{const[,,e]=yield o.default();return t(e)}catch(e){return a}}));return function(){return t.apply(this,arguments)}}()).catch((()=>({})))}(e)))).then((e=>{m===t&&(g=(0,p.emojiLocaleDictsToTrie)(e))})).catch((()=>{})).finally((()=>{m===t&&(m=null)}));m=t}f.default.on("locale_change",(()=>{S()})),(0,d.default)(_.Stream,"change:mode",(()=>_.Stream.mode===_.StreamMode.MAIN)).then((()=>{S()}))},586379:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.emojiLocaleDictsToTrie=function(e){let t=e[0];e.length>1&&(t=(0,i.default)((0,i.default)({},t),e[1]));return function(e,t){const n=p.default.fromForwardsStrings(e.map((e=>e[t])),e);return{getMatches:e=>n.search(e)}}((0,a.default)(t,((e,t)=>{const n=t.toLowerCase(),r=n.substring(0,5);return{value:e,keyword:n,shortKeyword:r}})),"shortKeyword")},t.emojiSearch=function(e,t){let n=[];if(e){const r=function(e,t){const n=function(e,t){if(!t)return[];if(e.length<=5)return t.getMatches(e);const n=e.substring(0,5).trim();let r=t.getMatches(n);return r=(0,u.default)(r,(t=>t.keyword.startsWith(e))),r}(e,t),r=m((0,c.default)(n,(e=>e.value))),i=m((0,c.default)(n.filter((t=>t.keyword===e)),(e=>e.value))),a=(0,l.default)(m(_.RecentEmojiCollection.map((e=>e.id))),r),o=(0,l.default)(m(h),r),d=(0,l.default)((0,s.default)(a,o),i);return(0,s.default)(d,S(i),a,o,S(r))}(e.toLowerCase(),t);n=(0,d.default)(r)}return n};var i=r(n(81109)),a=r(n(435161)),o=r(n(751463)),s=r(n(393386)),l=r(n(225325)),c=r(n(594654)),u=r(n(763105)),d=r(n(944908)),p=r(n(355205)),f=n(767247),_=n(492671);const h=["😂","🤣","❤","🥺","🥰","😘","😭","😍","😁","🙏","😅","😆","😊","🙂","😔","🥳","😒","☺","🎂","👍","💖","😢","🙄","😏","😎","💋","😞","😉","👏","🙃","😡","😀","😄","😇","🤩","😌","🤔","🌹","😋","💗","🤗","💕","💔","😚","☹","😃","🎉","🔥","🥴","😳"],g=["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS","VARIATION"];function m(e){return e.map(f.EmojiUtil.normalizeEmoji).filter(Boolean)}const y=(0,o.default)((()=>{const e=new Map;let t=0;for(const n of g){const r=f.EmojiUtil.getEmojisInCategory(n);for(const n of r)e.set(n,t),t++}return e}));function S(e){const t=y();return[...e].sort(((e,n)=>{var r,i;return(null!==(r=t.get(e))&&void 0!==r?r:Number.MAX_SAFE_INTEGER)-(null!==(i=t.get(n))&&void 0!==i?i:Number.MAX_SAFE_INTEGER)}))}},304837:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={APPLE:["00d857b","de87ff6","241d5fa","6e17092","7ee4b49","a6c6736","cbe1a67","046ab97","ff76e3f","eefb21c","58feccb","7d9c2e8","626394d","fc05cb4","4e3d22b","05f53cb","7a79075","97ed50e","e8a8263","3283af2","9975d87","ae1e64d","f03acf0","1e145dc","5f560a7","28e88d8","f4a78cf","1731eb9","96e62e3","dc56ba9","6903fc0","bced5dd","764f77b","010e30e","4cb8088","8adb4bd","5f0a961","b0b5d96","ca0895b","0791a83","7a89f6b","cea765c","dfe1327","cf8cc0c","41bcb6e","fbcf1c1","93ac9d7","0400d48","b4e5219","32e8266","b362770","076faa5","26beb5c","cd4dce1","a1c44d4","7930d41","47babb4","63cedff","af13835","ad2c9ac","5f205d3","65cde6c","7acf47d","65ddcaa","6814e0e","b9c20e5","4c682b5","9a9573b","ddba9f4","ec9d0c5","b89bf39","443a2e3","90c5a2a","eb872a4","440d149","fa62f2d","732c94a","3792066","c006db3","0466a36","25fa7c8","ccfde77","97d6892","e7d0ec7","1a394d7","8df7081","0e2aa84","ed3268a","0899a0e","3a20788","6965b63","c280eaa","cd6846d","14a872b","4a01077","423b755","ed57b13","8b50d20","2619987","58c8f99","da83064","24b2e99","ac537c3","b0a777f","e367f9b","0b5cecd","4ee82a0","5e6c4a2","352acf8","5c48a79","4e00e94","8f6bcb3","e76fb3e","d4d7a71","c20d780","ad43ea2","6149dc7","1a97e33","9f9e5d9","9fe7d25","e808df4","9a1c70b","a1570e4","992cb80","ee2c256","5b8edbd","40b2880","63673e9","eb5476f","e111825","0d368ff","a33bc31","55f3635","e78a2e8","97194a3","3aeaadb","7f28326","6a25be0","178adb3","9b06239","dc1043a","07816c9","f5de456","6bf63e6","5e82bbe","1f49550"],WHATSAPP:["51f163e","d6fe7b6","9c4fcf3","5afa39d","f8293a9","e861026","2658349","2d00b65","b73eefe","afc0c20","c6542a7","b1b31b7","9a4489e","e7fab49","8de4a89","6a87c23","6e1f3f2","ed087fb","01ea86b","2babfd6","35868f5","8980991","57f3525","cc30534","23cccc3","8cc10af","a6d3817","c04f1fc","d22c49d","a4759d8","55574d2","9262634","355feb4","b5e036c","0011956","9b91bac","230fb64","0f2f62d","242edea","d37a6b9","5611397","e164546","4f9f640","aeae604","7b1f671","850767a","c59598f","fa6d9ad","324e065","3fadb9a","4d663fa","6a961f4","392bab2","0be0fff","6be64a8","ebb5cd7","d087f20","cb5e991","e98c673","936a8cb","1bd0bc6","dcd07ed","8a7a7ba","5e201b5","8e43dfd","6460f03","bf8d870","bdf5816","561ba2d","73f2893","2dbc756","f01da50","5c52f8f","d610162","7bfcb86","d418503","efa4c29","0827b29","92ba7c5","f89284c","3faed02","64a2ba9","de1934c","0c7d0b0","b6b5a12","d7a87f4","21f2274","94538d3","15f0feb","1685eee","15ab037","66e8838","49b69e3","95357a1","988fbe9","0478778","6dffa2f","b009328","a7cb14c","b036313","0e49f63","79a8ec8","7618059","6f5411b","4205196","a2eb902","987de6f","8739d65","163eace","d29bd52","8d6dcca","1f79d5b","e4fa633","aa8857f","8afe4b0","365592a","bd54147","3ec24a4","816f331","d376b59","e241824","f4e0a7c","b56014e","7c430d4","b9cdb8b","5691bdf","06826ec","0d49b54","d22ede3","1a2ae07","9f42f3b","0b01126","2fafaf0","8cee25b","300b0c3","48adc62"]}},795885:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getEmojiSpritesPath=function(e,t,n,r){const o=(0,i.default)(a.default[e][t],"emojiSpriteHashes[emojiType][bucketId]");return`${s}/emoji-${t}-${n}_${o}.${r}`},t.getGlyphPath=function(e,t,n){return{low:l(`${t}-${"large"===n?"40":"64"}.png`,e.toLowerCase()),high:l(`${t}-64.png`,e.toLowerCase())}};var i=r(n(145095)),a=r(n(304837)),o=n(830614);const s="/img";function l(e,t){let n=null;return n="/img",`/img/${o.prefixHash}_${t.slice(0,1)}_${e}`}},767247:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getPermutations=t.OPEN_BOX_CHAR=t.EmojiUtil=void 0,t.isBaseMultiSkinToneEmoji=function(e){return y.has(e)};var i=r(n(42905)),a=r(n(288306)),o=r(n(948447)),s=r(n(145095)),l=r(n(5298)),c=n(408139),u=r(n(552930)),d=n(513045),p=n(795885),f=r(n(201429)),_=r(n(294184)),h=r(n(441143));t.OPEN_BOX_CHAR="□";const g=["🏻","🏼","🏽","🏾","🏿"],m=new RegExp(g.join("|"),"g"),y=new Set(["🧑‍🤝‍🧑","👭","👬","👫","👩‍❤️‍💋‍👨","👩‍❤️‍💋‍👩","👨‍❤️‍💋‍👨","💏","👩‍❤️‍👨","👩‍❤️‍👩","👨‍❤️‍👨","💑","🤝"]),S=d.HEART_EMOJIS.map((e=>e)),E=new Set(["︀","︁","︂","︃","︄","︅","︆","︇","︈","︉","︊","︋","︌","︍","︎","️"]),v=e=>e.replace(/\uFE0F/g,""),T=(0,a.default)(((e,t)=>function n(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(r.length===t)return[r];let i=[];for(let t=0;t<e.length;t++){const a=[...r];a.push(e[t]),i=i.concat(n(a))}return i}()),((e,t)=>e.toString()+t));t.getPermutations=T;function C(e){return e.every((t=>t===e[0]))?e[0]:e.join("")}const A=new class{constructor(){var e=this;this.skinToneVariations=g,this._specialEmojiRegex=null,this.emojiRegex=()=>{const e=this._createEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createEmojiRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("("+e+")","g")})),this.onlyEmojiRegex=()=>{const e=this._createOnlyEmojiRegexIfNeeded();return e.lastIndex=0,e},this._createOnlyEmojiRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp("^("+e+")+$","g")})),this.convertToTextWithoutSpecialEmojis=e=>{if(!this._specialEmojiRegex){const e=(0,u.default)(Object.keys(f.default));this._specialEmojiRegex=new RegExp(`(${e})`,"g")}return this._specialEmojiRegex.lastIndex=0,e.replace(this._specialEmojiRegex,(e=>f.default[e]))},this.splitEmojis=e=>!1===this.containsOnlyEmoji(e)?null:e.split(this.emojiRegex()).filter(Boolean),this.containsEmoji=e=>this.emojiRegex().test(e),this.containsOnlyEmoji=e=>this.onlyEmojiRegex().test(e),this.matchLargeEmojiPattern=e=>{if(e.length>50||e.includes(" "))return null;const t=this._getLargeEmojisRegex().exec(e);return t?t.filter(Boolean).slice(1):null},this.normalizeEmojiFromString=e=>this.normalizeEmoji(e),this.normalizeEmoji=e=>{const t=v(e),{unqualifiedToNormalizedEmoji:n}=this._getDerivedMaps();return n.get(t)},this.normalizeAllEmojis=(0,a.default)((e=>e?e.replace(this.emojiRegex(),((e,t)=>{var n;return E.has(t)?"":null!==(n=this.normalizeEmoji(t))&&void 0!==n?n:"□"})):"")),this.getSkinToneVariant=(e,t)=>{const n=this._getBaseToSkinToneEmojis().get(e);if(null==n)return null;const r=C(t);return n.get(r)},this._getDerivedMaps=(0,l.default)((()=>{const{orderedEmojis:e,legacyToEmoji:t}=this._getConfig(),n=new Map,r=new Map,a=new Map;let o=0;return e.forEach(((e,t)=>{if(""===e||null==e)return;(Array.isArray(e)?e:[e]).forEach((e=>{r.set(e,t);const n=v(e);a.set(n,e)})),n.set(t,o),o++})),(0,i.default)(t).forEach((e=>{let[t,n]=e;r.set(t,n);const i=v(t);a.set(i,t)})),{emojiToGlyphId:r,glyphIdToIndex:n,unqualifiedToNormalizedEmoji:a}})),this._getBaseToSkinToneEmojis=(0,l.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps(),t=new Map;for(const n of e.keys()){let e;const r=n.replace(m,(t=>(null==e&&(e=[]),e.push(t),"")));if(null==e)continue;const i=e;let a;a="👩‍🤝‍👩"===r?"👭":"👨‍🤝‍👨"===r?"👬":"👩‍🤝‍👨"===r?"👫":"🧑‍❤️‍🧑"===r?"💑":"🧑‍❤️‍💋‍🧑"===r?"💏":"🫱‍🫲"===r?"🤝":r;const o=this.normalizeEmoji(a);if(null==o)continue;let s=t.get(o);null==s&&(s=new Map,s.set("",o),t.set(o,s));const l=C(i);s.set(l,n)}return t})),this._getSkinToneEmojisToBase=(0,l.default)((()=>{const e=new Map;for(const[t,n]of this._getBaseToSkinToneEmojis().entries())for(const r of n.values())e.set(r,t);return e})),this._getEmojiRegexSource=(0,l.default)((()=>{const{emojiToGlyphId:e}=this._getDerivedMaps();return(0,u.default)([...Array.from(e.keys()),...Array.from(E)].filter(Boolean))})),this._createLargeEmojisRegexIfNeeded=(0,l.default)((()=>{const e=this._getEmojiRegexSource();return new RegExp(`^(${e})(${e})?(${e})?$`)})),this.getEmojisInCategory=e=>{var t;return null!==(t=this._getConfig().categorizedEmojis[e])&&void 0!==t?t:[]},this._getEmojiToCategory=(0,l.default)((()=>{const{categorizedEmojis:e}=this._getConfig(),t=new Map;return Object.keys(e).forEach((n=>{const r=d.CATEGORY_ORDERING.indexOf(n);e[n].forEach((e=>{const n=this.normalizeEmoji(e);null!=n&&t.set(n,r)}))})),t})),this.getGlyphId=e=>{const t=this.normalizeEmoji(e);if(null==t)return null;const{emojiToGlyphId:n}=this._getDerivedMaps();return n.get(t)},this.getGlyphPath=(e,t)=>(0,p.getGlyphPath)(this._getConfig().emojiType,e,t),this.isGlyphCached=e=>{const t=this._getGlyphIndex(e);return this._getCachedGlyphs().get(t)},this.markGlyphCached=e=>{const t=this._getGlyphIndex(e);this._getCachedGlyphs().set(t)},this._getCachedGlyphs=(0,l.default)((()=>new o.default(this._getGlyphCount()))),this.getCssClasses=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";return(0,_.default)(`b${e.getBucket(t)}`,"small"===n?"emoji":"emojik",e._getConfig().emojiType===d.EMOJI_TYPE.APPLE?"apple":"wa")},this.getStyle=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"small";const{xpos:r,ypos:i}=e._getCoordinates(t,n);return{backgroundPosition:`-${r}px -${i}px`}},this.getBucket=e=>{const t=this._getGlyphIndex(e);return`${Math.floor(t/d.BUCKET_SIZE)}`},this.getHeartEmojis=(0,l.default)((()=>S.map(this.normalizeEmoji).filter(Boolean))),this._getLastBucketId=(0,l.default)((()=>{const e=this._getGlyphCount();return e-e%d.BUCKET_SIZE})),this._getLastBucketCols=(0,l.default)((()=>Math.floor(Math.sqrt(this._getGlyphCount()-this._getLastBucketId()))))}configure(e){e!==this._config&&(this._config=e,this.getHeartEmojis.reset(),this._specialEmojiRegex=null,this._createEmojiRegexIfNeeded.reset(),this._createLargeEmojisRegexIfNeeded.reset(),this._createOnlyEmojiRegexIfNeeded.reset(),this._getEmojiRegexSource.reset(),this._getCachedGlyphs.reset(),this._getSkinToneEmojisToBase.reset(),this._getBaseToSkinToneEmojis.reset(),this._getEmojiToCategory.reset(),this._getLastBucketId.reset(),this._getLastBucketCols.reset(),this._getDerivedMaps.reset())}_getConfig(){return(0,h.default)(null!=this._config,"Attempt to use EmojiUtil before it's been configured"),this._config}isEmoji(e){return null!=this.normalizeEmoji(e)}getSkinToneBase(e){var t;const n=this.normalizeEmoji(e);return null==n?null:null!==(t=this._getSkinToneEmojisToBase().get(n))&&void 0!==t?t:null}_getLargeEmojisRegex(){const e=this._createLargeEmojisRegexIfNeeded();return e.lastIndex=0,e}_getGlyphCount(){const{glyphIdToIndex:e}=this._getDerivedMaps();return e.size}_getCoordinates(e,t){const n=this._getGlyphIndex(e),r=n%d.BUCKET_SIZE,i=n>=this._getLastBucketId()?this._getLastBucketCols():Math.floor(Math.sqrt(d.BUCKET_SIZE)),a=d.EMOJI_WIDTH[t],o=Math.floor(r/i);return{xpos:Math.floor(r%i)*a,ypos:o*a,width:a}}_getGlyphIndex(e){const{glyphIdToIndex:t}=this._getDerivedMaps();return(0,s.default)(t.get(e),"glyphIdToIndex.get(glyphId)")}getEmojiAggregate(e){const t=this.getNormalizedOrTofu(e);if(!(0,c.reactionsEmojiAggregateEnabled)())return t;const n=this.getSkinToneBase(t);return null!=n?n:v(t)}getNormalizedOrTofu(e){return this.normalizeEmojiFromString(e)?e:"□"}};t.EmojiUtil=A},761585:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OpenChatFlow=void 0,t.clearChatIdCorrectionCache=function(){P.clear()};var a=i(n(348926)),o=n(389385),s=n(413959),l=n(516413),c=n(781572),u=n(211739),d=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(995726)),p=i(n(379264)),f=n(978820),_=i(n(213702)),h=n(57547),g=n(2259),m=i(n(914296)),y=n(111054),S=n(188172),E=i(n(832973)),v=i(n(452665)),T=n(845222),C=n(548360),A=n(785893);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}const P=new Map;function O(){return(O=(0,a.default)((function*(e){if(!e.isUser())return e;const t=P.get(e.user);if(t)return t;const n=yield(0,h.queryExists)(e),r=null==n?e:n.wid;return P.set(e.user,r),r}))).apply(this,arguments)}class M extends E.default{constructor(){super(...arguments),this._cancel=()=>{this._queryChat&&this._queryChat.controller.abort(),this._queryChat=void 0,this.end()},this.error=()=>{this.push((0,A.jsx)(v.default,{onOK:()=>this.end(),okText:C.fbt._("OK",null,{hk:"2KEeHb"}),children:m.default.t(482)}))}}componentDidMount(){var e=this;return(0,a.default)((function*(){let t=!1;const n=new r;(0,s.delayMs)(250).then((()=>{if(n.signal.aborted)throw new o.AbortError;t=!0,e.push((0,A.jsx)(v.default,{title:C.fbt._("Starting chat",null,{hk:"NHBK3"}),onCancel:e._cancel,cancelText:C.fbt._("Cancel",null,{hk:"H0gNq"}),children:(0,A.jsx)("div",{className:_.default.spinner,children:(0,A.jsx)(y.Spinner,{stroke:6,size:24})})}))})).catch((0,o.catchAbort)((()=>{})));const i=Date.now(),l=new r,c=l.signal,d=yield e.getChatWid();if(null==d){const{fallbackURL:t}=e.props;return null!=t&&p.default.open(t),void e.end()}const{pnForLid:f}=e.props;d.isLid()&&null!=f&&(0,g.testLidWaMeLinkEnabled)()&&(0,T.createOrReplaceLidPnMappings)([{lid:d.user,pn:f}]);const h=function(){return O.apply(this,arguments)}(d).then((e=>(0,u.findChat)(e,!0))).then(function(){var r=(0,a.default)((function*(r){if(c.aborted)throw new o.AbortError;t||n.abort();const a=Date.now()-i,l=t?Math.max(750-a,0):0;e.openChat(r),yield(0,s.delayMs)(l),e.end(),e.props.onSuccess(r)}));return function(){return r.apply(this,arguments)}}()).catch((0,o.catchAbort)((()=>{}))).catch((()=>{n.abort(),e.error()}));e._queryChat={controller:l,promise:h}}))()}getChatWid(){var e=this;return(0,a.default)((function*(){const{chatId:t,customURL:n}=e.props;if(null!=t)return t;if(null!=n){return yield(0,l.getWidfromPath)(n)}__LOG__(4,void 0,new Error)`OpenChatFlow chatWid couldn't be created from provided props.`}))()}openChat(e){let{msgText:t,ctwaContextLinkData:n}=this.props;if(n){const e=d.findLink(n.sourceUrl||"",!1,(0,f.getMaybeMeUser)());(null==e?void 0:e.suspiciousCharacters)&&e.suspiciousCharacters.size>0&&(n=null)}n&&(t=n.icebreaker),e.active&&t?(S.ComposeBoxActions.paste(e,t),n&&S.ComposeBoxActions.setCtwaContextLinkData(e,n)):(t&&e.setComposeContents({text:t}),c.Cmd.openChatFromUnread(e).then((t=>{t&&(S.ComposeBoxActions.focus(e),n&&S.ComposeBoxActions.setCtwaContextLinkData(e,n))}))),null!=this.props.sendLogAttributes&&S.ComposeBoxActions.addMsgSendingLogAttributes(e,this.props.sendLogAttributes)}}t.OpenChatFlow=M,M.defaultProps={removeTopDrawer:!0,pushTransition:"none",popTransition:"none"}},374331:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UntrustedGroupDesc=t.TrustedGroupDesc=t.StatusV3Text=t.StatusV3Caption=t.SearchName=t.Search=t.RawNotification=t.RawGroupNotification=t.QuotedMention=t.QuickReply=t.LastMessage=t.LargeEmojiOnly=t.HeaderAndFooter=t.FormattedNotification=t.FormattedGroupNotification=t.Format=t.FTSMessage=t.EmojiOnly=t.Conversation=t.ComposeBox=t.Compatibility=t.BoldedContactName=void 0;n(310206);var r=n(263161),i=n(365375);t.EmojiOnly=function(){let{selectable:e,emojiXstyle:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Emoji,{selectable:e,emojiXstyle:t}]]]};t.LargeEmojiOnly=function(){let{selectable:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Emoji,{selectable:e,size:"large"}]]]};t.StatusV3Text=function(){let{links:e,selectable:t,emojiXstyle:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Code,{selectable:t}]],[[(0,r.statusV3LinkPreviewEnabled)()?i.StatusLink:i.Link,{links:e,selectable:t}]],[[i.Bold,{selectable:t}],[i.Italic,{selectable:t}],[i.Strikethrough,{selectable:t}]],[[i.Emoji,{selectable:t,size:"xlarge",emojiXstyle:n}]]]};t.StatusV3Caption=function(){let{selectable:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Code,{selectable:e}]],[[i.Bold,{selectable:e}],[i.Italic,{selectable:e}],[i.Strikethrough,{selectable:e}]],[[i.Emoji,{selectable:e}]]]};t.Compatibility=function(){let{selectable:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Emoji,{selectable:e}]]]};t.Conversation=function(){let{mentions:e,links:t,phoneNumbers:n,selectable:r,trusted:a,fromMe:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=a&&n.length>0?[[i.PhoneNumber,{phoneNumbers:n,selectable:r,fromMe:o}]]:null;return[[[i.Code,{selectable:r}]],null,null,a?[[i.Link,{links:t,selectable:r}]]:null,e?[[i.Mention,{mentions:e,selectable:r}]]:null,null,s,[[i.Bold,{selectable:r}],[i.Italic,{selectable:r}],[i.Strikethrough,{selectable:r}]],[[i.Emoji,{selectable:r}]]].filter(Boolean)};t.Search=e=>{let{boundary:t,terms:n,selectable:r,mentions:a}=e;return[[[i.TextMention,{mentions:a,selectable:r}]],[[i.Bold,{selectable:r}],[i.Italic,{selectable:r}],[i.Strikethrough,{selectable:r}]],[[i.Highlight,{terms:n,boundary:t,selectable:r,ignoreDiacritics:!0}]],[[i.Emoji,{selectable:r}]]]};t.SearchName=e=>{let{terms:t}=e;return[[[i.Highlight,{terms:t,ignoreDiacritics:!0}]],[[i.Emoji,{selectable:!1}]]]};t.LastMessage=function(){let{mentions:e,selectable:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Code,{selectable:t}]],null,null,e?[[i.TextMention,{mentions:e,selectable:t}]]:null,[[i.Bold,{selectable:t}],[i.Italic,{selectable:t}],[i.Strikethrough,{selectable:t}]],[[i.Emoji,{selectable:t}]]].filter(Boolean)};t.FTSMessage=e=>{let{boundary:t,mentions:n,terms:r,selectable:a}=e;return[[[i.Code,{selectable:a}]],[[i.TextMention,{mentions:n,selectable:a}]],[[i.Bold,{selectable:a}],[i.Italic,{selectable:a}],[i.Strikethrough,{selectable:a}]],[[i.Highlight,{terms:r,boundary:t,selectable:a}]],[[i.Emoji,{selectable:a}]]]};t.QuickReply=function(){let{selectable:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Code,{selectable:e}]],[[i.Bold,{selectable:e}],[i.Italic,{selectable:e}],[i.Strikethrough,{selectable:e}]],[[i.Emoji,{selectable:e}]]]};t.Format=e=>{let{mentions:t,selectable:n}=e;return[[[i.Code,{selectable:n}]],null,null,[[i.TextMention,{mentions:t,selectable:n}]],[[i.Bold,{selectable:n}],[i.Italic,{selectable:n}],[i.Strikethrough,{selectable:n}]],[[i.Emoji,{selectable:n}]]].filter(Boolean)};t.QuotedMention=e=>{let{mentions:t,selectable:n}=e;return[[[i.Code,{selectable:n}]],null,null,[[i.TextMention,{mentions:t,selectable:n,theme:{quoted:!0}}]],[[i.Bold,{selectable:n}],[i.Italic,{selectable:n}],[i.Strikethrough,{selectable:n}]],[[i.Emoji,{selectable:n}]]].filter(Boolean)};t.ComposeBox=function(){let{selectable:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[[[i.Code,{selectable:e}]],[[i.Link,{selectable:e}]],[[i.Bold,{selectable:e}],[i.Italic,{selectable:e}],[i.Strikethrough,{selectable:e}]],[[i.Emoticon,{selectable:e}]]]};t.RawNotification=e=>{let{mentions:t,selectable:n}=e;return[[[i.RawMention,{mentions:t,selectable:n}]]]};t.FormattedNotification=e=>{let{mentions:t,selectable:n}=e;return[[[i.Code,{selectable:n}]],null,null,[[i.RawMention,{mentions:t,selectable:n}]],[[i.Bold,{selectable:n}],[i.Italic,{selectable:n}],[i.Strikethrough,{selectable:n}]]].filter(Boolean)};t.RawGroupNotification=e=>{let{mentions:t,selectable:n,groupMetadata:r}=e;return[[[i.RawGroupMention,{mentions:t,selectable:n,groupMetadata:r}]]]};t.FormattedGroupNotification=e=>{let{mentions:t,selectable:n,groupMetadata:r}=e;return[[[i.Code,{selectable:n}]],null,null,[[i.RawGroupMention,{mentions:t,selectable:n,groupMetadata:r}]],[[i.Bold,{selectable:n}],[i.Italic,{selectable:n}],[i.Strikethrough,{selectable:n}]]].filter(Boolean)};t.TrustedGroupDesc=e=>{let{links:t}=e;const n=!0;return[[[i.Code,{selectable:n}]],[[i.Link,{links:t,selectable:n}]],[[i.Bold,{selectable:n}],[i.Italic,{selectable:n}],[i.Strikethrough,{selectable:n}]],null,[[i.Emoji,{selectable:n}]]].filter(Boolean)};t.UntrustedGroupDesc=()=>{const e=!0;return[[[i.Code,{selectable:e}]],[[i.Bold,{selectable:e}],[i.Italic,{selectable:e}],[i.Strikethrough,{selectable:e}]],null,[[i.Emoji,{selectable:e}]]].filter(Boolean)};t.HeaderAndFooter=function(){let{links:e,selectable:t,trusted:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[n?[[i.Link,{links:e,selectable:t}]]:null,[[i.Emoji,{selectable:t}]]].filter(Boolean)};t.BoldedContactName=e=>{let{selectable:t}=e;return[[[i.BoldFirstWord,{selectable:t}]],[[i.Emoji,{selectable:t}]]]}},80691:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;return(0,a.default)(n,(0,i.parse)(e,t,o),r)};var i=n(35303),a=r(n(221659))},669188:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t,n){const r=2*e.length+t[1].length,i=t[0].length-r;return i>0&&(t.index+=i,t[0]=t[0].slice(i)),n.lastIndex--,t}}},352084:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return class extends a.default{static match(r){return(0,i.default)(r,e,t,n)}}};var i=r(n(444512)),a=r(n(994718))},327229:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{index:n}=e,[r]=e,i=n+r.length-1,a=[n,n,i,i,e];if(t){const i=e[t];a[1]=n+r.indexOf(i),a[2]=a[1]+i.length-1}return a}},444512:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const a=[];let o;t.lastIndex=0;for(;(o=t.exec(e))&&t.lastIndex>0;)r&&(o=r(o,t)),o&&a.push((0,i.default)(o,n));return a};var i=r(n(327229))},945017:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=null,n=0;try{var r;const i=e.length;for(;n<i;){const r=e.codePointAt(n),i=r>65535?2:1;if(m(t)&&(r<48||r>57))if(45===r)0===t.phoneNumberParenthesesDepth?45===t.phoneNumberLastSignificantCodePoint?S(t,n):0===t.phoneNumber.length?_(t):u(t):_(t);else if(46===r)0===t.phoneNumberParenthesesDepth?46===t.phoneNumberLastSignificantCodePoint?S(t,n):0===t.phoneNumber.length?_(t):c(t):_(t);else if(40===r);else if(41===r)E(t,n);else if(32===r)if(32===t.phoneNumberLastSignificantCodePoint)_(t);else{y(t,n)||d(t)}else S(t,n);switch(r){case 42:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:m(t)||(t||(t=s(e)),f(t,n)),p(t,r);break;case 43:t||(t=s(e)),f(t,n),l(t);break;case 40:m(t)||(t||(t=s(e)),f(t,n)),h(t,n)}n+=i}return t&&null!=t.openings&&S(t,e.length),(null===(r=t)||void 0===r?void 0:r.parsedPhoneNumbers)&&t.parsedPhoneNumbers.length>0?t.parsedPhoneNumbers.reduce(((e,t)=>(e.push({phone:t.matchedText,index:t.start}),e)),[]):[]}catch(e){return __LOG__(4,void 0,new Error,!0)`findPhoneNumbers parse error: ${String(e)}`,SEND_LOGS("findPhoneNumbers-error"),[]}};var i=r(n(288306)),a=n(240277),o=n(978820);function s(e){return{uniqueId:0,text:e,openings:null,phoneNumber:"",phoneNumberStartsWithPlus:!1,phoneNumberLastSignificantCodePoint:-1,phoneNumberParenthesesDepth:0,phoneNumberLeadingZeroes:0,phoneNumberCurrentlyMatchingLeadingZeroes:!0,parsedPhoneNumbers:null}}function l(e){e.phoneNumberStartsWithPlus=!0}function c(e){e.phoneNumberLastSignificantCodePoint=46}function u(e){e.phoneNumberLastSignificantCodePoint=45}function d(e){e.phoneNumberLastSignificantCodePoint=32}function p(e,t){e.phoneNumber=e.phoneNumber+String.fromCodePoint(t),e.phoneNumberLastSignificantCodePoint=t,e.phoneNumberCurrentlyMatchingLeadingZeroes&&(48===t?e.phoneNumberLeadingZeroes++:e.phoneNumberCurrentlyMatchingLeadingZeroes=!1)}function f(e,t){null==e.openings?(e.openings=t,e.phoneNumber="",e.phoneNumberStartsWithPlus=!1,e.phoneNumberLastSignificantCodePoint=-1,e.phoneNumberParenthesesDepth=0,e.phoneNumberLeadingZeroes=0,e.phoneNumberCurrentlyMatchingLeadingZeroes=!0):__LOG__(4,void 0,new Error)`Msg formatting: cannot open a style before closing it`}function _(e){null!=e.openings?e.openings=null:__LOG__(4,void 0,new Error)`Msg formatting: cannot close a style before opening it`}function h(e,t){1!==e.phoneNumberParenthesesDepth?(e.phoneNumberParenthesesDepth++,e.phoneNumberLastSignificantCodePoint=-1):_(e)}const g=(0,i.default)((e=>(0,a.phoneCC)(e)));function m(e){return null!=e&&null!=e.openings}function y(e,t){const n=function(e,t){if(null==e.openings)return;if(1===e.phoneNumberParenthesesDepth)return null;const n=e.phoneNumber.slice(Math.min(2,e.phoneNumberLeadingZeroes));if(0===n.length)return null;let r=!1,i=n;if(e.phoneNumberStartsWithPlus||e.phoneNumberLeadingZeroes>=2){const e=(0,a.findCC)(n),t=n.slice(e.length);r=(0,a.isPotentiallyValid)(e,t)}else{var s;const e=(null===(s=(0,o.getMaybeMeUser)())||void 0===s?void 0:s.toString())||"",t=g(e);if(r=(0,a.isPotentiallyValid)(t,n),r)i=`${t}${n}`;else{const e=(0,a.findCC)(n);if(e===t){const t=n.slice(e.length);r=(0,a.isPotentiallyValid)(e,t)}}}if(r){const n=e.openings;if(null==n)return null;const r=45===e.phoneNumberLastSignificantCodePoint||46===e.phoneNumberLastSignificantCodePoint?t-1:t,a=e.text.slice(n,r);return{start:n,end:r,id:"phone"+ ++e.uniqueId,phoneNumber:i,matchedText:a}}return null}(e,t);return null!=n&&(_(e),e.parsedPhoneNumbers?e.parsedPhoneNumbers.push(n):e.parsedPhoneNumbers=[n],!0)}function S(e,t){y(e,t)||_(e)}function E(e,t){0===e.phoneNumberParenthesesDepth||e.phoneNumberLastSignificantCodePoint<48||e.phoneNumberLastSignificantCodePoint>57?_(e):(e.phoneNumberParenthesesDepth--,e.phoneNumberLastSignificantCodePoint=-1)}},130695:(e,t,n)=>{"use strict";function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(r=function(e){return e?n:t})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;const i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=r(t);if(n&&n.has(e))return n.get(e);var i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(i,o,s):i[o]=e[o]}i.default=e,n&&n.set(e,i);return i}(n(374331));t.Configuration=i},563448:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.formatNFMText=o,t.formatNFMTextPreview=function(e){if(e.nativeFlowName===a.default.ORDER_DETAILS){const t=(0,i.formatOrderDetailsMessagePreview)(e);if(null!=t)return t}return o(e)};var i=n(899641),a=r(n(905165));function o(e){if(e.nativeFlowName===a.default.ORDER_STATUS){const t=(0,i.formatOrderStatusMessage)(e);if(null!=t)return t}return e.caption||""}},757196:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatOversizedMsgNotification=function(){return i.fbt._("This message can't be viewed in WhatsApp Web. View it on your phone instead.",null,{hk:"2Cf4Ej"})},t.formatOversizedMsgText=function(){return r.UA.isElectron?i.fbt._("This message can't be viewed in WhatsApp Desktop. View it on your phone instead.",null,{hk:"3rLTDP"}):i.fbt._("This message can't be viewed in WhatsApp Web. View it on your phone instead.",null,{hk:"2Cf4Ej"})};var r=n(26741),i=n(548360)},702177:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.formatPaymentInviteMessageText=function(e){const t=(0,a.default)(e.remote);if(e.fromMe)return i.default.t(804,{otherUser:t});return i.default.t(805,{otherUser:t})};var i=r(n(914296)),a=r(n(473977))},896206:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatRevokedMsg=function(e){var t;switch(null!==(t=e.subtype)&&void 0!==t?t:"sender"){case"sender":return e.isSentByMe?a.fbt._("You deleted this message",null,{hk:"E892D"}):a.fbt._("This message was deleted",null,{hk:"19qvYd"});case"admin":return e.isRevokedByMe?a.fbt._("You deleted this message as admin",null,{hk:"oMWPt"}):null==e.revokeSender?a.fbt._("This message was deleted by an admin",null,{hk:"28rFSm"}):a.fbt._("This message was deleted by admin {admin}",[a.fbt._param("admin",o(e.revokeSender))],{hk:"3Nu81j"})}};var r=n(562054),i=n(719380),a=n(548360);const o=e=>{const t=i.ContactCollection.get(e);return t?t.shortName||t.name||t.displayName:(0,r.widToFormattedUser)(e)}},24780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatUnknownMsgNotification=function(e){switch(e.subtype){case"phone":return i.fbt._("You received a message, but your version of WhatsApp doesn't support it.",null,{hk:"3WD27"});case"phone_only_feature":return i.fbt._("This message can't be shown on WhatsApp Web. Open WhatsApp on your phone to view.",null,{hk:"FDBoF"});case"reaction":return i.fbt._("You received a reaction. Update your version of WhatsApp to see reactions.",null,{hk:"2TMRfc"});default:return i.fbt._("You received a message on your phone, but your version of WhatsApp Web doesn't support it.",null,{hk:"4mqP2W"})}},t.formatUnknownMsgText=function(e){if(e.isSentByMe)switch(e.type){case"reaction":return i.fbt._("To see reactions, restart WhatsApp on your computer. If you still do not see them, update your app.",null,{hk:"eNtuK"});default:switch(e.subtype){case"reaction":return i.fbt._("To see reactions, restart WhatsApp on your computer. If you still do not see them, update your app.",null,{hk:"eNtuK"});default:return i.fbt._("You sent a message from your phone, but your version of WhatsApp Web doesn't support it.",null,{hk:"4jbsbU"})}}switch(e.subtype){case"phone":return i.fbt._("You received a message, but your version of WhatsApp doesn't support it.",null,{hk:"3WD27"});case"phone_only_feature":return r.UA.isElectron?i.fbt._("This message can't be shown on WhatsApp Desktop. Open WhatsApp on your phone to view.",null,{hk:"1zBLXU"}):i.fbt._("This message can't be shown on WhatsApp Web. Open WhatsApp on your phone to view.",null,{hk:"FDBoF"});case"reaction":return i.fbt._("You received a reaction. Update your version of WhatsApp to see reactions.",null,{hk:"2TMRfc"});case"keep_in_chat":return i.fbt._("A message in this chat was kept from disappearing.",null,{hk:"1gqzBa"});default:return r.UA.isElectron?i.fbt._("You received a message on your phone, but your version of WhatsApp Desktop doesn't support it.",null,{hk:"mhBjl"}):i.fbt._("You received a message on your phone, but your version of WhatsApp Web doesn't support it.",null,{hk:"4mqP2W"})}};var r=n(26741),i=n(548360)},994718:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class n{static match(){throw new Error("Subclasses of `Mutator` must override `match()`")}static mutate(e){return e}}t.default=n,n.nestable=()=>!0,n.format=!0,n.fragment=!1,n.compatibility=!1,n.mutates=!1},338189:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(834357)),a=r(n(669188)),o=r(n(352084)),s=n(785893);const l=(0,a.default)("*"),c=(0,o.default)(/(?:^|[\s\W_])\*([^\s\u20e3]|[^\s\u20e3][^\n]*?\S)\*(?=$|[[\s\W_])/g,1,l);t.default=class extends c{static jsx(e,t,n){let{selectable:r=!1}=n;return(0,s.jsx)(i.default,{selectable:r,children:e})}}},39037:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(834357)),a=r(n(352084)),o=n(785893);const s=(0,a.default)(/^(\w*)\b/g);t.default=class extends s{static jsx(e,t,n){let{selectable:r=!1}=n;return(0,o.jsx)(i.default,{selectable:r,children:e})}}},204841:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.removeCodeBlocks=t.isInsideCodeBlock=t.Code=void 0;var i=r(n(387253)),a=r(n(352084)),o=n(785893);const s=/```([\s\S]*?\S[\s\S]*?)```/g,l=(0,a.default)(s,1),c=new Set(["ListItem","List"]);class u extends l{static jsx(e,t,n){let{selectable:r=!1}=n;return(0,o.jsx)(i.default,{selectable:r,children:e})}}t.Code=u,u.nestable=e=>c.has(e),u.format=!1;t.isInsideCodeBlock=e=>{const t=e.split(s).pop();return/```/.test(t)};t.removeCodeBlocks=e=>e.replace(s," ")},834357:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",selectable:n}=e;return(0,i.jsx)(r.SelectableStrong,{selectable:n,appTextTemplate:"*${appText}*",children:t})};var r=n(552596),i=n(785893)},939147:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{onClick:t,theme:n,selectable:r}=e,p=(0,u.useModelValues)(e.contact,["id","displayName"]),f=p.id,_=!!n&&n.quoted,h=p.displayName,g=(0,i.dir)(h)||"auto",m=(0,o.default)(h,[[[s.default,{selectable:r}]]],l.default,void 0,1/0);return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(a.SelectableSpan,{"data-jid":f.toString(),"data-display":h,className:(0,c.default)("matched-mention",{"quoted-mention":_,"inactive-mention":!t||_}),onClick:t,plainText:`@${h}`,selectable:r,selectAll:!0,appTextTemplate:`​${f.toString()}​`,children:[(0,d.jsx)("span",{className:"at-symbol",children:"@"}),(0,d.jsx)("span",{dir:g,children:m})]})})};var i=n(293131),a=n(552596),o=r(n(80691)),s=r(n(576781)),l=r(n(810577)),c=r(n(294184)),u=n(735461),d=n(785893)},387253:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",selectable:n}=e;return(0,i.jsx)(r.SelectableCode,{selectable:n,appTextTemplate:"```${appText}```",children:t})};var r=n(552596),i=n(785893)},406859:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(684636)),a=n(173770),o=n(785893);t.default=e=>{let{emoji:t,selectable:n,size:r,xstyle:s}=e;return"xlarge"===r?(0,o.jsx)(a.LargeEmoji,{emoji:t,xstyle:s,size:a.SIZE.XLARGE,element:"span",selectable:n}):(0,o.jsx)(i.default,{emoji:t,xstyle:s,selectable:n,size:r})}},389442:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{onClick:t,theme:n,selectable:r}=e,f=(0,d.useModelValues)(e.contact,["id","displayName","shortName","isMyContact"]),_=(0,d.useModelValues)(e.groupMetadata,["uniqueShortNameMap"]),h=f.id,g=!!n&&n.quoted,m=(0,a.isDropLastNameEnabled)()&&_&&_.hasUniqueShortNameMention(f)?f.shortName:f.displayName,y=(0,i.dir)(m)||"auto",S=(0,s.default)(m,[[[l.default,{selectable:r}]]],c.default,void 0,1/0);return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(o.SelectableSpan,{"data-jid":h.toString(),"data-display":m,className:(0,u.default)("matched-mention",{"quoted-mention":g,"inactive-mention":!t||g}),onClick:t,plainText:`@${m}`,selectable:r,selectAll:!0,appTextTemplate:`​${h.toString()}​`,children:[(0,p.jsx)("span",{className:"at-symbol",children:"@"}),(0,p.jsx)("span",{dir:y,children:S})]})})};var i=n(293131),a=n(227101),o=n(552596),s=r(n(80691)),l=r(n(576781)),c=r(n(810577)),u=r(n(294184)),d=n(735461),p=n(785893)},299697:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",selectable:n}=e;return(0,i.jsx)(r.SelectableSpan,{className:"matched-text",selectable:n,children:t})};var r=n(552596),i=n(785893)},368730:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,o.jsx)(a.default,(0,i.default)((0,i.default)({},e),{},{children:e.children}))};var i=r(n(81109)),a=r(n(735150)),o=n(785893)},131117:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",selectable:n}=e;return(0,i.jsx)(r.SelectableEm,{selectable:n,appTextTemplate:"_${appText}_",children:t})};var r=n(552596),i=n(785893)},735150:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",href:n,selectable:a}=e;return(0,i.jsx)(r.SelectableLink,{href:n,title:n,target:"_blank",rel:"noopener noreferrer",selectable:a,children:t})};var r=n(552596),i=n(785893)},385060:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",inline:n,isAtStart:r,selectable:l}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(a.SelectableUl,{appTextTemplate:r?"${appText}":"\n${appText}",className:(0,o.default)({[i.default.inline]:n},i.default.ul),selectable:l,children:t})})};var i=r(n(791545)),a=n(552596),o=r(n(294184)),s=n(785893)},394296:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",inline:n,selectable:r}=e;return(0,s.jsx)("li",{className:(0,o.default)({[i.default.inline]:n}),children:(0,s.jsx)(a.SelectableSpan,{selectable:r,appTextTemplate:"* ${appText}",children:t})})};var i=r(n(489613)),a=n(552596),o=r(n(294184)),s=n(785893)},241013:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LongLink=function(e){var t;let{link:n,children:r="",selectable:p}=e;if(null===(t=n.suspiciousCharacters)||void 0===t?void 0:t.size)return(0,u.jsx)(o.default,{link:n,selectable:p,children:r});return(0,u.jsx)(s.SelectableLink,{onClick:()=>{a.ModalManager.open((0,u.jsx)(l.LongLinkPopup,{link:n})),i.Cmd.openLongLinkModal()},selectable:p,className:(0,c.default)(d),children:r})};var i=n(781572),a=n(914597),o=r(n(805438)),s=n(552596),l=n(321059),c=r(n(156720)),u=n(785893);const d={cursor:"ajgl1lbb"}},142521:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{mentionMeta:t,theme:n,selectable:r}=e;return(0,a.jsx)(i.default,{contact:t.contact,theme:n,selectable:r})};var i=r(n(215775)),a=n(785893)},861154:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{phoneNumber:t,selectable:n,fromMe:r}=e;return(0,a.jsx)(i.default,{selectable:n,phoneNumber:t,fromMe:r})};var i=r(n(879505)),a=n(785893)},879505:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{selectable:t,phoneNumber:n,fromMe:r}=e;const[S,E]=(0,g.useState)(null),[v,T]=(0,g.useState)(null),[C,A]=(0,g.useState)(null);function b(e,t){const i=[];if(null==e?void 0:e.wid){const t=(0,a.formatPhone)(e.wid.user);i.push((0,m.jsx)(c.DropdownItem,{testid:"mi-message-on-whatsapp",xstyle:y.menuItem,action:t=>(0,s.handleOpenChat)(t,e.wid,r),children:h.fbt._("Chat with {chat-with-phoneJid}",[h.fbt._param("chat-with-phoneJid",(0,m.jsx)("span",{dir:"ltr",children:t}))],{hk:"2zFU2R"})},"message-on-whatsapp"))}i.push((0,m.jsx)(c.DropdownItem,{testid:"mi-copy-phone-number",xstyle:y.menuItem,action:()=>(0,s.handleCopyPhoneNumber)(n,null==e?void 0:e.wid,r),children:h.fbt._("Copy phone number",null,{hk:"CCcUf"})},"copy-phone-number")),E(null),E({menu:i,event:t}),A(null==e?void 0:e.wid),(0,s.logClickOnPhoneNumber)(null==e?void 0:e.wid,r)}let P=null;S&&(P=(0,m.jsx)(f.UIE,{displayName:"ContextMenu",escapable:!0,popable:!0,dismissOnWindowResize:!0,requestDismiss:()=>{E(null),(0,s.logCloseDialog)(C,r)},children:(0,m.jsx)(_.default,{contextMenu:S})}));return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l.SelectableLink,{onClick:function(e){let t;function r(){return(r=(0,i.default)((function*(e,n){try{b(yield t.getOrRun(e),n)}catch(e){b(null,n),A(null),__LOG__(4,void 0,new Error,!0)`handlePhoneClick getUsync failed with exceptions ${e}`,SEND_LOGS("handlePhoneClick-getUsync")}}))).apply(this,arguments)}v&&v.isCached(n)?t=v:(t=(0,o.usyncContactCached)(),T(t)),t.isCached(n)||function(e){const t=(0,m.jsxs)(u.FlexColumn,{xstyle:y.spinnerContainer,align:"center",justify:"center",children:[(0,m.jsx)(d.Spinner,{size:50,stroke:4,color:"highlight"}),(0,m.jsx)(p.TextSpan,{xstyle:y.spinnerText,theme:"small",children:h.fbt._("Checking phone number...",null,{hk:"2cfR2e"})},"phone_number_wrapper_loading_text")]});E({menu:t,event:e})}(e),function(){r.apply(this,arguments)}(n,e)},selectable:t,style:{cursor:"pointer"},children:n}),P]})};var i=r(n(348926)),a=n(240277),o=n(966464),s=n(585665),l=n(552596),c=n(471174),u=n(429623),d=n(111054),p=n(113923),f=n(718644),_=r(n(624717)),h=n(548360),g=n(667294),m=(r(n(156720)),n(785893));const y={spinnerContainer:{width:"snzbljq1",height:"ra71746h"},spinnerText:{marginTop:"eg3lofc5",paddingStart:"f78eapp6",paddingEnd:"kyc7k6mt",textAlign:"qfejxiq4"},menuItem:{paddingStart:"nqtxkp62",paddingEnd:"btzf6ewn"}}},351634:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",selectable:n}=e;return(0,i.jsx)(r.SelectableDel,{selectable:n,appTextTemplate:"~${appText}~",children:t})};var r=n(552596),i=n(785893)},805438:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t="",link:n,selectable:r}=e;return(0,l.jsx)(o.SelectableLink,{onClick:()=>{a.ModalManager.open((0,l.jsx)(s.default,{link:n})),i.Cmd.openLongLinkModal()},selectable:r,style:{cursor:"pointer"},children:t})};var i=n(781572),a=n(914597),o=n(552596),s=r(n(482791)),l=n(785893)},971809:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,c.useContext)(l.default);if((0,a.isDropLastNameEnabled)()&&t)return(0,u.jsx)(s.default,(0,i.default)((0,i.default)({},e),{},{groupMetadata:t}));return(0,u.jsx)(o.default,(0,i.default)({},e))};var i=r(n(81109)),a=n(227101),o=r(n(939147)),s=r(n(389442)),l=r(n(945152)),c=n(667294),u=n(785893)},215775:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{contact:t,theme:n,selectable:r}=e;const{isMe:c}=(0,s.useModelValues)(t,["id","isMe"]),u=c?void 0:()=>{(0,a.findChat)(t.id).then((e=>i.Cmd.openChatBottom(e)))};return(0,l.jsx)(o.default,{contact:t,theme:n,selectable:r,onClick:u})};var i=n(781572),a=n(211739),o=r(n(971809)),s=n(735461),l=n(785893)},576781:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(164331),a=r(n(406859)),o=n(767247),s=r(n(444512)),l=r(n(994718)),c=n(785893);class u extends l.default{static jsx(e,t,n){let[r]=t,{size:i,selectable:o=!1,emojiXstyle:s}=n;return(0,c.jsx)(a.default,{emoji:r,size:i,selectable:o,xstyle:s})}static match(e,t,n){const r=null!=n&&0!==n?n:e.length,a=(0,i.firstNCodepoints)(e,r);return(0,s.default)(a,o.EmojiUtil.emojiRegex(),0,d)}}function d(e){return o.EmojiUtil.getGlyphId(e[0])?e:null}t.default=u,u.compatibility=!0},374783:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(103522)),a=n(767247),o=r(n(352084)),s=n(513185);const l={"(y)":"👍","(n)":"👎",":-)":"🙂",":-(":"🙁",":-p":"😛",":-|":"😐",":-\\":"😕",":-d":"😀",":-*":"😘","<3":"❤","^_^":"😁",">_<":"😆",";-)":"😉"},c=Object.keys(l).map(i.default).join("|"),u=new RegExp(`(^|\\s|\`\`\`|[*_~])((?:${c})+)(?=$|\\s|\`\`\`|[*_~])`,"ig"),d=new RegExp(`(${c})`,"i"),p=(0,o.default)(u,2,(function(e){const[,t]=e;t&&(e.index+=t.length,e[0]=e[0].slice(t.length));return e}));class f extends p{static mutate(e){return e.split(d).map((e=>{const t=l[e.toLowerCase()];return t?a.EmojiUtil.getSkinToneBase(t)&&s.EmojiVariantCollection.getVariant(t)||t:e})).join("")}}t.default=f,f.fragment=!0,f.mutates=!0},810043:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(103522)),a=r(n(299697)),o=r(n(914296)),s=r(n(444512)),l=r(n(994718)),c=n(785893);class u extends l.default{static match(e,t){if(!t)return[];const{terms:n,boundary:r=!1,ignoreDiacritics:a=!1}=t;if(!n.length)return[];const l=a&&o.default.isLatinAlphabetLanguage(e)&&n.every((e=>o.default.isLatinAlphabetLanguage(e)))&&!o.default.isRTL(),c=l?o.default.removeAccents(e):e;return(0,s.default)(c,function(e,t,n){const r=(n?e.map((e=>o.default.removeAccents(e))):e).map(i.default).join("|");if(o.default.isRTL())return new RegExp(`${t?"(?:^|\\b)":""}(\\S+)?(${r})(\\S+)?`,"ig");return new RegExp(`${t?"(?:^|\\b)":""}(${r})`,"ig")}(n,r,l))}}t.default=u,u.jsx=(e,t,n)=>{let{selectable:r}=n;return(0,c.jsx)(a.default,{selectable:r,children:e})}},365375:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Bold",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"BoldFirstWord",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"Code",{enumerable:!0,get:function(){return o.Code}}),Object.defineProperty(t,"Emoji",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"Emoticon",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"Highlight",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"Intern",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"Italic",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"Link",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"List",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"ListItem",{enumerable:!0,get:function(){return _.ListItem}}),Object.defineProperty(t,"Mention",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"PhoneNumber",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(t,"RawGroupMention",{enumerable:!0,get:function(){return E.default}}),Object.defineProperty(t,"RawMention",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"StatusLink",{enumerable:!0,get:function(){return v.StatusLink}}),Object.defineProperty(t,"Strikethrough",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(t,"TextMention",{enumerable:!0,get:function(){return S.default}});var i=r(n(39037)),a=r(n(338189)),o=n(204841),s=r(n(576781)),l=r(n(374783)),c=r(n(810043)),u=r(n(90347)),d=r(n(601890)),p=r(n(210275)),f=r(n(187169)),_=n(9272),h=r(n(248861)),g=r(n(78076)),m=r(n(164713)),y=r(n(606738)),S=r(n(502041)),E=r(n(364181)),v=n(795454)},90347:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(368730)),a=r(n(352084)),o=n(785893);const s=(0,a.default)(/(^|\b|\s)(((#|t|T|d|D|p|P|s|S)([0-9]{3,16}))|([0-9a-fA-F]{8,40}))(?=$|\b)/g,2,(function(e){const[,t,,,,,n]=e;if(n&&(!l.test(n)||!c.test(n)))return null;t&&(e.index+=t.length,e[0]=e[0].slice(t.length));return e}));t.default=class extends s{static jsx(e,t,n){let{selectable:r=!1}=n;const a=function(e){let[,,,,t,n,r]=e;if(r)return`${u}${r.toLowerCase()}`;switch(t){case"T":case"t":case"#":return`${d}${n}`;case"D":case"d":return`${p}${n}`;case"P":case"p":return`${f}${n}`;case"S":case"s":return`${_}${n}`;default:return`${h}${t}${n}`}}(t);return(0,o.jsx)(i.default,{href:a,selectable:r,children:e})}};const l=/[a-fA-F]/,c=/[0-9]/;const u="https://internalfb.com/intern/bunny/?q=hash%20",d="https://internalfb.com/intern/tasks/?t=",p="https://internalfb.com/intern/diff/D",f="https://internalfb.com/intern/paste/P",_="https://internalfb.com/intern/sevmanager/view/s/",h="https://internalfb.com/intern/"},601890:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(131117)),a=r(n(669188)),o=r(n(352084)),s=n(785893);const l=(0,a.default)("_"),c=(0,o.default)(/(?:^|\s|_|[^\w\\])_(\S|\S[^\n]*?\S)_(?=$|[[\s\W_])/g,1,l);t.default=class extends c{static jsx(e,t,n){let{selectable:r=!1}=n;return(0,s.jsx)(i.default,{selectable:r,children:e})}}},210275:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(338189)),a=r(n(735150)),o=r(n(805438)),s=r(n(601890)),l=r(n(606738)),c=r(n(994718)),u=n(785893);class d extends c.default{static jsx(e,t,n){let{selectable:r=!1}=n;const{href:i,suspiciousCharacters:s}=t;return(null==s?void 0:s.size)?(0,u.jsx)(o.default,{link:t,selectable:r,children:e}):(0,u.jsx)(a.default,{href:i,selectable:r,children:e})}}function p(e){const{index:t,url:n}=e,r=t+n.length-1;return[t,t,r,r,e]}function f(e,t){let n=0,r=0;for(;n<e.length&&r<t.length;){const i=t[r][3]-e[n][3];if(i>0)n++;else if(i<0)r++;else{e[n][2]--,e[n][3]--;const t=e[n][5];t.href=t.href.slice(0,-1),t.path=t.path&&t.path.slice(0,-1),t.url=t.url.slice(0,-1),r++,n++}}}t.default=d,d.format=!1,d.match=(e,t)=>{if(!t)return[];const{links:n=[]}=t;return n.map(p)},d.conflictResolvers=new Map([[i.default,f],[s.default,f],[l.default,f]])},187169:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(385060)),a=r(n(352084)),o=n(785893);const s=(0,a.default)(/((?:^)(?:\* (?:[^\n]+)(?:\n(?:\* [^\n]+)){0,})(?:\n|$))/gm,0);class l extends s{static jsx(e,t,n){let{selectable:r=!1,inline:a}=n;const s=0===t.index;return(0,o.jsx)(i.default,{inline:a,isAtStart:s,selectable:r,children:e})}}t.default=l,l.nestable=()=>!1},9272:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ListItem=t.LIST_ITEM_DELIMITER=t.LAST_LIST_ITEM_REGEX=void 0;var i=r(n(394296)),a=r(n(352084)),o=n(785893);t.LIST_ITEM_DELIMITER="* ";t.LAST_LIST_ITEM_REGEX=/(?:^|\n)\* [^\n]+$/;const s=(0,a.default)(/(?:^)\* ([^\n]+(?:$))/gm,1),l=new Set(["List"]);class c extends s{static jsx(e,t,n){let{selectable:r=!1,inline:a}=n;return(0,o.jsx)(i.default,{inline:a,selectable:r,children:e})}}t.ListItem=c,c.nestable=e=>l.has(e),c.unformatDecorations={pre:"• "}},248861:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(103522)),a=r(n(441609)),o=r(n(142521)),s=r(n(444512)),l=r(n(994718)),c=n(785893);class u extends l.default{static match(e,t){if(!t)return[];const{mentions:n,groupMetadata:r}=t;if(!n||(0,a.default)(n))return[];const o=function(e){const t=Object.keys(e).map(i.default).join("|");return new RegExp(`(${t})`,"g")}(n),l=(0,s.default)(e,o);for(let e=0;e<l.length;++e)l[e][4]={contact:n[l[e][4][0]],groupMetadata:r};return l}static jsx(e,t,n){let{selectable:r}=n;return(0,c.jsx)(o.default,{mentionMeta:t,selectable:r})}}t.default=u,u.format=!1},78076:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(861154)),a=r(n(994718)),o=n(785893);class s extends a.default{static jsx(e,t,n){let{selectable:r=!1,fromMe:a}=n;const{phone:s}=t;return(0,o.jsx)(i.default,{phoneNumber:s,selectable:r,fromMe:a})}}function l(e){const{index:t,phone:n}=e,r=t+n.length-1;return[t,t,r,r,e]}t.default=s,s.format=!1,s.match=(e,t)=>{if(!t)return[];const{phoneNumbers:n=[]}=t;return n.map(l)}},364181:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(227101),a=r(n(248861));class o extends a.default{}t.default=o,o.mutates=!0,o.mutate=(e,t)=>{const{contact:n,groupMetadata:r}=t;return(0,i.isDropLastNameEnabled)()&&r&&r.hasUniqueShortNameMention(n)?`@${n.shortName}`:`@${n.displayName}`}},164713:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(248861));class a extends i.default{}t.default=a,a.mutates=!0,a.mutate=(e,t)=>{let{contact:n}=t;return`@${n.displayName}`}},795454:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusLink=void 0,t.cleanUrl=l,t.redactUrl=c;var i=n(241013),a=r(n(210275)),o=n(785893);function s(e,t){return t.length>12||t.length+e.length>34?t.slice(0,function(e,t){const n=Math.min(t.length,Math.max(t.length-12,t.length+e.length-34));return t.length-n}(e,t)):t}function l(e){let{domain:t,path:n}=e;return[t.replace(/^www\./,""),null==n||1===n.length?"":n]}function c(e,t){const n=s(e,t),r=e+(1===n.length?"":n);return(r.length>34?`...${r.slice(r.length-34)}`:r)+(t!==n?"...":"")}class u extends a.default{static jsx(e,t,n){const[r,a]=l(t),s=c(r,a);var u;return s!==r+a?(0,o.jsx)(i.LongLink,{selectable:null!==(u=n.selectable)&&void 0!==u&&u,link:t,children:s}):super.jsx([r+a],t,n)}}t.StatusLink=u},606738:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(351634)),a=r(n(669188)),o=r(n(352084)),s=n(785893);const l=(0,a.default)("_"),c=(0,o.default)(/(?:^|[\s\W_])~(\S|\S[^\n]*?\S)~(?=$|[[\s\W_])/g,1,l);t.default=class extends c{static jsx(e,t,n){let{selectable:r}=n;return(0,s.jsx)(i.default,{selectable:r,children:e})}}},502041:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(971809)),a=r(n(248861)),o=n(785893);class s extends a.default{static jsx(e,t,n){let{contact:r}=t,{selectable:a,theme:s}=n;return(0,o.jsx)(i.default,{contact:r,selectable:a,theme:s})}}t.default=s},21829:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(1===e.length)return e;const n=[];let r;for(;r=e.pop();){const[e,,,i,a]=r,[{nestable:o,compatibility:s},,l]=t[a];let c=!0;const{length:u}=n;for(let r=u-1;r>=0;--r){const[,,a,u,d]=n[r];if(e>u)break;const[{mutates:p,format:f,compatibility:_,name:h},,g]=t[d];if(i>a){if(l<g&&n.splice(r,1))continue;c=!1;break}if(p&&!(c=!1))break;if(s)break;if((o(h)||_||!(l<g)||!n.splice(r,1))&&(!s&&!f)){c=!1;break}}c&&n.push(r)}return n}},150008:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r){const[i,a]=e[n][r];t.push([i,a,n])}return t}},35303:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._parse=c,t.parse=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;return c(e,(0,o.default)(t),n)};var i=n(164331),a=r(n(21829)),o=r(n(150008)),s=r(n(958899)),l=r(n(679175));function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;const r=(0,s.default)(e,t,n),o=r.length?(0,l.default)(e,(0,a.default)(r,t),t):{children:[{type:"text",value:e}]},c=(0,i.numCodepoints)(e);return n<c&&u(o,{limit:n}),o}function u(e,t){if(t.limit<=0)return;if(e.type&&"text"===e.type){if(e.value.length>=t.limit){let n=(0,i.toArray)(e.value);n.length>=t.limit&&(n=n.slice(0,t.limit)),e.value=n.join(""),t.limit=t.limit-n.length}else t.limit=t.limit-e.value.length;return}if(e.type&&"delimiter"===e.type)return;let n=0;for(;n<e.children.length&&(u(e.children[n],t),!(t.limit<=0));)n++;e.children=e.children.slice(0,n+1)}},958899:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;const r=[];for(let i=0;i<t.length;++i){const[a,o]=t[i],s=a.match(e,o,n),l=[],{length:c}=s;for(let e=0,t=s[e];e<c;t=s[++e])l[e]=[t[0],t[1],t[2],t[3],i,t[4]];l.length&&r.push(l)}for(let e=0;e<r.length;e++){const{conflictResolvers:n}=t[r[e][0][4]][0];if(n)for(let i=0;i<r.length;i++){const a=t[r[i][0][4]][0],o=n.get(a);null==o||o(r[e],r[i])}}const i=[];for(let e=0;e<r.length;++e)i[e]=r[e].length-1;const a=[];let o=0;for(;r.length;){for(let e=0,t=-1;e<r.length;++e)r[e][i[e]][0]>t&&(o=e,t=r[e][i[e]][0]);a.push(r[o][i[o]]),--i[o]<0&&(r.splice(o,1),i.splice(o,1))}return a}},679175:(e,t,n)=>{"use strict";function r(e,t,n){let{format:r}=e;const i=[],a=function(e){let t=e;const n=[];do{t.mutator&&n.push(t.mutator)}while(t.parent&&(t=t.parent));return n}(n);for(let e=0;e<t.length;++e)(r||t[e][0].compatibility)&&(a.includes(t[e][0])||i.push(t[e]));return i}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,i){const a={children:[]};let o=0,s=a,l=0;for(let a=0;a<t.length;++a){const c=t[a],[u,d]=c;for(;s.parent&&u>(l=s.match[2]);){if(o<=l&&s.children.push({type:"text",value:e.substring(o,l+1)}),o=s.match[3]+1,s.mutator.fragment){const{children:e}=s.parent;e.pop(),e.push.apply(e,s.children)}l!==s.match[3]&&s.parent.children.push({type:"delimiter",value:e.substring(l+1,o)}),s=s.parent}o<u&&s.children.push({type:"text",value:e.substring(o,u)});const[p,f]=i[c[4]],{mutates:_}=p;o=d,u!==d&&s.children.push({type:"delimiter",value:e.substring(u,d)});const h={children:[],match:c,mutator:p,opts:f,parent:s};if(_){const t=e.substring(c[1],c[2]+1),a=p.mutate(t,c[5]),s=r(p,i,h),l=(0,n(35303)._parse)(a,s);h.children=l.children,o=c[2]+1}s.children.push(h),s=h}do{if(!s.match)continue;const[,,t,n]=s.match;if(o<=t&&s.children.push({type:"text",value:e.substring(o,t+1)}),o=n+1,s.mutator.fragment){const{children:e}=s.parent;e.pop(),e.push.apply(e,s.children)}t!==n&&s.parent.children.push({type:"delimiter",value:e.substring(t+1,o)})}while(s.parent&&(s=s.parent)&&s.parent);o!==e.length&&s.children.push({type:"text",value:e.substring(o)});return a}},221659:(e,t)=>{"use strict";function n(e,t,r){return t.reduce(((t,i)=>(t.push(function(e,t,r){if(t.type){const{value:n}=t;switch(t.type){case"text":return e.onText(n,r);case"delimiter":return e.onDelimiter(n,r);default:throw new Error("Invalid node type")}}return e.onMutator(t.mutator,n(e,t.children,r),t.match[5],t.opts,r)}(e,i,r)),t)),[])}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){return e.onRoot(n(e,t.children,r),r)}},883415:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=class{static onMutator(){throw new Error("Subclasses of `Serializer` must override `onMutator()`")}static onRoot(){throw new Error("Subclasses of `Serializer` must override `onRoot()`")}static onText(){throw new Error("Subclasses of `Serializer` must override `onText()`")}static onDelimiter(){throw new Error("Subclasses of `Serializer` must override `onDelimiter()`")}}},810577:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(119173)),a=r(n(883415)),o=n(667294);class s extends a.default{}function l(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];if(void 0===r)continue;if("string"==typeof r){t.push(r);continue}const i=`jsx-child-${n}`;t.push((0,o.cloneElement)(r,{key:i}))}return t}t.default=s,s.onText=i.default,s.onDelimiter=()=>{},s.onRoot=e=>l(e),s.onMutator=(e,t,n,r)=>e.jsx(l(t),n,r)},119173:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=e=>e},39949:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(883415));class a extends i.default{}function o(e){return e.filter(Boolean).join("")}t.default=a,a.onDelimiter=()=>{},a.onMutator=(e,t)=>null!=e.unformatDecorations?o([e.unformatDecorations.pre,...t,e.unformatDecorations.post]):o(t),a.onRoot=e=>o(e),a.onText=e=>e},557733:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{subtype:t,body:n,recipients:r}=e;if("create"===t){const e=parseInt(n,10);return a.default.t(860,{_plural:e,count:e})}if("add"===t){const e=r.length;return a.default.t(775,{_plural:e,name:(0,i.getFormattedNames)(r,!0)})}if("remove"===t){const e=r.length;return a.default.t(776,{_plural:e,name:(0,i.getFormattedNames)(r,!0)})}return""};var i=n(516961),a=r(n(914296))},49763:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n="";switch(e.subtype){case"miss":n=t?a.default.t(790,{time:i.Clock.timestampStr(e.t),_plural:i.Clock.timestampHour(e.t)}):a.default.t(789);break;case"miss_video":n=t?a.default.t(788,{time:i.Clock.timestampStr(e.t),_plural:i.Clock.timestampHour(e.t)}):a.default.t(787);break;case"miss_group":n=t?a.default.t(786,{time:i.Clock.timestampStr(e.t),_plural:i.Clock.timestampHour(e.t)}):o.fbt._("Missed group voice call",null,{hk:"nrsOB"});break;case"miss_group_video":n=t?a.default.t(785,{time:i.Clock.timestampStr(e.t),_plural:i.Clock.timestampHour(e.t)}):o.fbt._("Missed group video call",null,{hk:"2nThzV"})}return n};var i=n(40234),a=r(n(914296)),o=n(548360)},381412:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){switch(e.subtype){case"identity":{const t=null==e.body?null:d.ContactCollection.get(e.body);if(null==t?void 0:t.isMe){__LOG__(4,void 0,new Error,!0)`formatE2ENotification: receive identity notification of self`,SEND_LOGS("SelfIdentityNotificationError");const t=e.chat;if(t.isUser){const e=t.contact?t.contact.formattedName:(0,s.widToFormattedUser)(t.id);return c.default.t(831,{contactName:e})}return t.isGroup?p.fbt._("Your security code with all participants changed. Click to learn more.",null,{hk:"243dFE"}):t.isBroadcast?p.fbt._("Your security code with all recipients changed. Click to learn more.",null,{hk:"44wyW0"}):""}const n=t?t.formattedName:(0,s.widToFormattedUser)(e.body);return c.default.t(831,{contactName:n})}case"device":return(0,l.default)(e);case"encrypt":{const t=e.id.remote;if(o.default.isGroup(t))return(0,a.isSupportGroup)(e.chat)?p.fbt._("This chat is with the official account of WhatsApp Support. Click to learn more.",null,{hk:"1jqzBh"}):(0,u.isGroupCallEnabled)()?p.fbt._("Messages and calls are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.",null,{hk:"3ioH5m"}):p.fbt._("Messages are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.",null,{hk:"4xlCJY"});if((0,i.default)(t.user))return p.fbt._("This chat is with the official account of WhatsApp Support. Click to learn more.",null,{hk:"1jqzBh"});if(o.default.isBroadcast(t))return p.fbt._("Messages you send to this broadcast list are secured with end-to-end encryption. Click to learn more.",null,{hk:"2fA0mg"});return(0,u.isVoiceCallEnabled)()||(0,u.isVideoCallEnabled)()?p.fbt._("Messages and calls are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.",null,{hk:"ZvZfE"}):p.fbt._("Messages are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.",null,{hk:"2rOEit"})}case"encrypt_now":return p.fbt._("Messages and calls are now end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Click to learn more.",null,{hk:"2ayMYf"});case"e2e_identity_unavailable":return p.fbt._("Security code notifications are no longer available for this chat.",null,{hk:"3mV4bQ"});default:return""}};var i=r(n(726682)),a=n(173679),o=r(n(389867)),s=n(562054),l=r(n(430344)),c=r(n(914296)),u=n(669594),d=n(719380),p=n(548360)},430344:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,l.default)("device"===e.subtype,"Shouldn't call this function if msg is not a device notification msg");let r,c=e.body?o.ContactCollection.get(e.body):null;const u=1===e.devicesAdded&&0===e.devicesRemoved,d=0===e.devicesAdded&&1===e.devicesRemoved,p=!u&&!d;if(null===(t=c)||void 0===t?void 0:t.isMe){const t=e.chat;if(t.isUser){const i=t.contact.formattedName;n?u?r=e.isThisDeviceAdded?a.default.t(692,{contactName:i}):a.default.t(691,{contactName:i}):d?r=a.default.t(830,{contactName:i}):p&&(r=a.default.t(700,{contactName:i})):r=a.default.t(831,{contactName:i})}else t.isGroup?n?u?r=e.isThisDeviceAdded?s.fbt._('Your security code with all participants changed because there was a login on this device. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"1f7ZHl"}):s.fbt._('Your security code with all participants changed because there was a login on a new device of yours. To verify a contact\'s security code, open their Contact Info page and click "Encryption"',null,{hk:"23SIhV"}):d?r=s.fbt._('Your security code with all participants changed because there was a logout from one of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"1nWFei"}):p&&(r=s.fbt._('Your security code with all participants changed because there was a login or logout from one or more of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"3BjNsP"})):r=s.fbt._("Your security code with all participants changed. Click to learn more.",null,{hk:"243dFE"}):t.isBroadcast&&(n?u?r=e.isThisDeviceAdded?s.fbt._('Your security code with all recipients changed because there was a login on this device. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"2NYcSl"}):s.fbt._('Your security code with all recipients changed because there was a login on a new device of yours. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"3kx0ZZ"}):d?r=s.fbt._('Your security code with all recipients changed because there was a logout from one of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"sSoLo"}):p&&(r=s.fbt._('Your security code with all recipients changed because there was a login or logout from one or more of your devices. To verify a contact\'s security code, open their Contact Info page and click "Encryption".',null,{hk:"34hVX2"})):r=s.fbt._("Your security code with all recipients changed. Click to learn more.",null,{hk:"44wyW0"}))}else{const t=e.body;c=null==t?null:o.ContactCollection.get(t);const s=c?c.formattedName:(0,i.widToFormattedUser)(t);n?u?r=a.default.t(689,{contactName:s}):d?r=a.default.t(829,{contactName:s}):p&&(r=a.default.t(699,{contactName:s})):r=a.default.t(831,{contactName:s})}return(0,l.default)(null!=r,"text shouldn't be null in the end"),r};var i=n(562054),a=r(n(914296)),o=n(719380),s=n(548360),l=r(n(441143))},58688:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if((0,s.isKeepInChatReadEnabled)())return d(e,t,n,o.getDisappearingMessageSettingUnknownAsAdminStringKic,o.getDisappearingMessageSettingUnknownStringKic,o.getDisappearingMessageSettingYouAsAdminStringKic,o.getDisappearingMessageSettingYouStringKic,o.getDisappearingMessageSettingOthersAsAdminStringKic,o.getDisappearingMessageSettingOthersStringKic);return d(e,t,n,l.getDisappearingMessageSettingUnknownAsAdminString,l.getDisappearingMessageSettingUnknownString,l.getDisappearingMessageSettingYouAsAdminString,l.getDisappearingMessageSettingYouString,l.getDisappearingMessageSettingOthersAsAdminString,l.getDisappearingMessageSettingOthersString)};var i=n(978820),a=r(n(389867)),o=n(782109),s=n(529805),l=n(779259),c=n(669951),u=n(719380);function d(e,t,n,r,o,s,l,d,p){var f;const _=c.ChatCollection.gadd(n),h=_.shouldShowEphemeralSetting()&&(a.default.isUser(n)||(null===(f=_.groupMetadata)||void 0===f?void 0:f.canSetEphemeralSetting()));if(!t)return h?r(e):o(e);const g=u.ContactCollection.gadd(t);if((0,i.isMePrimary)(t))return h?s(e):l(e);const m=g.isMyContact?g.formattedName:g.formattedPhone;return h?d(e,m):p(e,m)}},346953:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n="";const r=e.get("type"),h=e.get("subtype"),g=e.displayName(),m=e.get("author"),y=e.get("body");let S,E;const v=""===g||null==g;if("group_notification"===r)switch(h){case"add":n=(0,o.isMeAccount)(m)?_.fbt._("You were added",null,{hk:"4x0xHD"}):p.default.t(749,{name:g});break;case"remove":n=(0,o.isMeAccount)(m)?_.fbt._("You were removed",null,{hk:"2gyTSa"}):p.default.t(757,{name:g});break;case"leave":n=null!=m?(0,o.isMeAccount)(m)?_.fbt._("You left",null,{hk:"3mSR6P"}):p.default.t(755,{name:g}):_.fbt._("This group has ended.",null,{hk:"C2izu"});break;case"picture":n="remove"===y?(0,o.isMeAccount)(m)?p.default.t(824):p.default.t(823,{name:g}):(0,o.isMeAccount)(m)?p.default.t(822):p.default.t(821,{name:g});break;case"subject":n=(0,o.isMeAccount)(m)?p.default.t(770,{subject:y}):v?p.default.t(769,{subject:y}):p.default.t(768,{name:g,subject:y});break;case"modify":S=(0,s.widToFormattedUser)(e.get("author")),E=(0,s.widToFormattedUser)(y),n=S===g?p.default.t(751,{name:g,new_number:E}):p.default.t(750,{name:g});break;default:__LOG__(2)`wa:formatGroupNotification:unknown message subtype: ${h}`}else if("gp2"===r){const r=e.recipients||[],T=(0,d.getFormattedNames)(r,!0),C=r[0],A=C?f.ContactCollection.get(C):void 0,b=A?A.get("formattedName"):C?(0,s.widToFormattedUser)(C):"";let P;switch(h){case"add":n=m?(0,o.isMeAccount)(m)?p.default.t(764,{participants:T}):(0,o.isMeAccount)(C)?v?_.fbt._("A participant added you",null,{hk:"LtOH1"}):p.default.t(759,{name:g}):v?p.default.t(762,{participants:T}):p.default.t(758,{name:g,participants:T}):(0,o.isMeAccount)(C)?_.fbt._("You were added",null,{hk:"4x0xHD"}):p.default.t(749,{name:b});break;case"remove":n=!(0,o.isMeAccount)(C)||!(0,o.isMeAccount)(m)&&m?(0,o.isMeAccount)(C)&&m?v?_.fbt._("A participant removed you",null,{hk:"3MXPgr"}):p.default.t(761,{name:g}):(0,o.isMeAccount)(m)?p.default.t(765,{participants:T}):m?v?p.default.t(763,{participants:T}):p.default.t(760,{name:g,participants:T}):p.default.t(757,{name:b}):_.fbt._("You were removed",null,{hk:"2gyTSa"});break;case"leave":n=C?(0,o.isMeAccount)(C)?_.fbt._("You left",null,{hk:"3mSR6P"}):p.default.t(755,{name:T}):y===a.DELETE_REASON.INTEGRITY_DELETE_PARENT?_.fbt._("This community is no longer available",null,{hk:"3e98vZ"}):_.fbt._("This group has ended.",null,{hk:"SM1g0"});break;case"picture":n="remove"===y?(0,o.isMeAccount)(m)?p.default.t(824):p.default.t(823,{name:g}):(0,o.isMeAccount)(m)?p.default.t(822):p.default.t(821,{name:g});break;case"subject":n=(0,o.isMeAccount)(m)?p.default.t(770,{subject:y}):v?p.default.t(769,{subject:y}):p.default.t(768,{name:g,subject:y});break;case"modify":S=(0,s.widToFormattedUser)(m),E=(0,s.widToFormattedUser)(C),n=S===g?p.default.t(751,{name:g,new_number:E}):p.default.t(750,{name:g});break;case"create":n=(0,o.isMeAccount)(m)?y?p.default.t(728,{subject:y}):p.default.t(729):y?v?p.default.t(727,{subject:y}):p.default.t(725,{name:g,subject:y}):v?_.fbt._("An admin created this group",null,{hk:"4GaP6B"}):p.default.t(726,{name:g});break;case"delete":n=(0,i.isCommunityAnnouncementGroup)(e.chat)?_.fbt._("This community is no longer available",null,{hk:"3e98vZ"}):(0,i.isSupportGroup)(e.chat)?_.fbt._("This chat has been closed",null,{hk:"4v1FVm"}):_.fbt._("This group has ended",null,{hk:"3LCAzO"});break;case"promote":P=r.length,n=1===P&&(0,o.isMeAccount)(C)?_.fbt._("You're now an admin",null,{hk:"3kNNwA"}):p.default.t(756,{participants:T,_plural:P});break;case"demote":P=r.length,n=1===P&&(0,o.isMeAccount)(C)?_.fbt._("You're no longer an admin",null,{hk:"4b22N8"}):p.default.t(752,{participants:T,_plural:P});break;case"linked_group_promote":n=(0,o.isMeAccount)(C)?_.fbt._("You're now a community admin",null,{hk:"4fMCJO"}):_.fbt._("{name} is now a community admin",[_.fbt._param("name",b)],{hk:"493qke"});break;case"linked_group_demote":n=(0,o.isMeAccount)(C)?_.fbt._("You're no longer a community admin",null,{hk:"1QoLu3"}):_.fbt._("{name} is no longer a community admin",[_.fbt._param("name",b)],{hk:"2dDMg7"});break;case"invite":n=(0,o.isMeAccount)(C)?p.default.t(754):p.default.t(753,{name:b});break;case"revoke_invite":n=(0,o.isMeAccount)(m)?_.fbt._("You reset this group's invite link. Click to view the new invite link.",null,{hk:"27k9Gu"}):p.default.t(746,{name:g});break;case"description":const d=t?v?_.fbt._("A participant changed the group description.",null,{hk:"3YXEnz"}):p.default.t(745,{name:g}):v?_.fbt._("A participant changed the group description. Click to view.",null,{hk:"2V9oO8"}):p.default.t(744,{name:g});n=(0,o.isMeAccount)(m)?_.fbt._("You changed the group description. Click to view.",null,{hk:"44K01H"}):d;break;case"announce":n="on"===y?(0,o.isMeAccount)(m)?_.fbt._("You allowed only admins to send messages to this group",null,{hk:"w9ZN5"}):p.default.t(724,{name:g}):(0,o.isMeAccount)(m)?_.fbt._("You changed this group's settings to allow all participants to send messages to this group.",null,{hk:"3Oj0Tj"}):p.default.t(723,{name:g});break;case"restrict":n="on"===y?(0,o.isMeAccount)(m)?_.fbt._("You changed this group's settings to allow only admins to edit this group's info.",null,{hk:"2ywD8F"}):p.default.t(767,{name:g}):(0,o.isMeAccount)(m)?_.fbt._("You changed this group's settings to allow all participants to edit this group's info.",null,{hk:"1dWmtw"}):p.default.t(766,{name:g});break;case"no_frequently_forwarded":n="on"===y?(0,o.isMeAccount)(m)?_.fbt._("You changed this group's settings to not allow messages that have been forwarded many times.",null,{hk:"16hyEI"}):p.default.t(748,{name:g}):(0,o.isMeAccount)(m)?_.fbt._("You changed this group's settings to allow messages that have been forwarded many times.",null,{hk:"3Ib1Hu"}):p.default.t(747,{name:g});break;case"announce_msg_bounce":n=_.fbt._("Only admins can message this group.",null,{hk:"O3Va5"});break;case"v4_add_invite_sent":n=p.default.t(651,{participants:T,_plural:r.length});break;case"v4_add_invite_join":n=p.default.t(650,{participants:T,_plural:r.length});break;case"ephemeral":const f=parseInt(e.templateParams[0],10)||0,A=e.templateParams[1],O=e.id.remote;return(0,l.default)(f,A,O);case"growth_locked":n=_.fbt._("Invite via link became unavailable. Click to learn more.",null,{hk:"27u4jP"});break;case"growth_unlocked":n=_.fbt._("Invite via link became available again. Click to view the new invite link.",null,{hk:"4sDtjJ"});break;case"linked_group_join":return(0,c.formatLinkNotifAsFbt)(h,C,e.templateParams);case"parent_group_link":case"sibling_group_link":case"sub_group_link":case"parent_group_unlink":case"sibling_group_unlink":case"sub_group_unlink":case"community_create":case"integrity_parent_group_unlink":return(0,c.formatLinkNotifAsFbt)(h,m,e.templateParams);case"membership_approval_mode":case"membership_approval_request":(0,u.default)(h,m,e.templateParams);break;case"ephemeral_keep_in_chat":return _.fbt._("Disappearing messages now support keeping messages in the chat. Click to learn more.",null,{hk:"28BLkP"});default:__LOG__(2)`wa:formatGroupNotification:unknown message subtype: ${h}`}}p.default.isRTL()&&(n=p.default.forceRTL(String(n)));return n};var i=n(173679),a=n(795720),o=n(978820),s=n(562054),l=r(n(58688)),c=n(351382),u=r(n(945320)),d=n(516961),p=r(n(914296)),f=n(719380),_=n(548360)},351382:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.formatLinkNotifAsFbt=function(e,t,n){return f(e,t,n,!1)},t.formatLinkNotification=f;var i=n(978820),a=r(n(389867)),o=n(516961),s=r(n(914296)),l=r(n(356074)),c=n(548360),u=n(785893);const d=e=>e instanceof a.default&&(0,i.isMeAccount)(e);function p(e){return!e}function f(e,t,n,r){const i=t?(0,o.getFormattedName)(t,!r):null;switch(e){case"parent_group_link":{let e=(0,o.getFormattedCommunityName)(n[0],!r);return null==e&&(e=n[1]),!p(e)&&d(t)?c.fbt._('You added this group and its participants to the community "{community}"',[c.fbt._param("community",e)],{hk:"LrNfE"}):p(e)&&d(t)?c.fbt._("You added this group and its participants to a community",null,{hk:"2WbR5d"}):p(e)||null==t?p(e)||null!=t?p(e)&&null!=t?c.fbt._("{author} added this group and its participants to a community",[c.fbt._param("author",i)],{hk:"8zlZu"}):c.fbt._("This group and its participants were added to a community",null,{hk:"3cwk3U"}):c.fbt._('This group and its participants were added to the community "{community}"',[c.fbt._param("community",e)],{hk:"3QVhXn"}):c.fbt._('{author} added this group and its participants to the community "{community}"',[c.fbt._param("author",i),c.fbt._param("community",e)],{hk:"1wTEt7"})}case"sibling_group_link":{const[...e]=n,a=(0,o.getFormattedGroupListForCommunity)(e,!r),p=Array.isArray(a)?a.length:1;return d(t)?null==a?c.fbt._({"*":"You added {count} groups",_1:"You added 1 group"},[c.fbt._plural(p,"count")],{hk:"3cCNOS"}):c.fbt._({"*":"You added the groups {groups}",_1:"You added the group {groups}"},[c.fbt._plural(p),c.fbt._param("groups",a)],{hk:"1Zksob"}):null!=t?null==a?c.fbt._({"*":"{author} added {count} groups",_1:"{author} added 1 group"},[c.fbt._plural(p,"count"),c.fbt._param("author",i)],{hk:"1EO4eV"}):c.fbt._({"*":"{author} added the groups {groups}",_1:"{author} added the group {groups}"},[c.fbt._plural(p),c.fbt._param("author",i),c.fbt._param("groups",a)],{hk:"3YHozc"}):null==a?c.fbt._({"*":"{count} groups were added",_1:"1 group was added"},[c.fbt._plural(p,"count")],{hk:"3IvJQz"}):r?(0,u.jsx)(l.default,{id:190,plural:p,params:{count:p,formattedNames:a}}):s.default.t(190,{formattedNames:a,_plural:p})}case"sub_group_link":break;case"parent_group_unlink":{const[...e]=n,a=(0,o.getFormattedCommunityName)(e[0],!r);return null!=a&&d(t)?c.fbt._('You removed this group from the community "{community}"',[c.fbt._param("community",a)],{hk:"167sfb"}):null==a&&d(t)?c.fbt._("You removed this group from a community",null,{hk:"1mLYQR"}):null!=a&&null!=t?c.fbt._('{author} removed this group from the community "{community}"',[c.fbt._param("author",i),c.fbt._param("community",a)],{hk:"1t3h7N"}):null!=a&&null==t?c.fbt._('This group was removed from the community "{community}"',[c.fbt._param("community",a)],{hk:"3a9Zz5"}):null==a&&null!=t?c.fbt._("{author} removed this group from a community",[c.fbt._param("author",i)],{hk:"1hLgAv"}):c.fbt._("This group was removed from a community",null,{hk:"1UqTCc"})}case"integrity_parent_group_unlink":{const[...e]=n;let t=(0,o.getFormattedCommunityName)(e[0],!r);return null==t&&(t=n[1]),null!=t?c.fbt._('This group is no longer part of the community "{community}"',[c.fbt._param("community",t)],{hk:"1xPItN"}):c.fbt._("This group is no longer part of a community",null,{hk:"ke9K9"})}case"sibling_group_unlink":{const[...e]=n,a=(0,o.getFormattedGroupListForCommunity)(e,!r),p=Array.isArray(a)?a.length:1;return d(t)?null==a?c.fbt._({"*":"You removed {count} groups",_1:"You removed 1 group"},[c.fbt._plural(p,"count")],{hk:"2g1AXG"}):c.fbt._({"*":"You removed the groups {groups}",_1:"You removed the group {groups}"},[c.fbt._plural(p),c.fbt._param("groups",a)],{hk:"1WgaUC"}):null!=t?null==a?c.fbt._({"*":"{author} removed {count} groups",_1:"{author} removed 1 group"},[c.fbt._plural(p,"count"),c.fbt._param("author",i)],{hk:"3x3BWq"}):c.fbt._({"*":"{author} removed the groups {groups}",_1:"{author} removed the group {groups}"},[c.fbt._plural(p),c.fbt._param("author",i),c.fbt._param("groups",a)],{hk:"mXINd"}):null==a?c.fbt._({"*":"{count} groups were removed",_1:"1 group was removed"},[c.fbt._plural(p,"count")],{hk:"1nLis2"}):r?(0,u.jsx)(l.default,{id:191,plural:p,params:{count:p,formattedNames:a}}):s.default.t(191,{formattedNames:a,_plural:p})}case"sub_group_unlink":break;case"community_create":{var a;const[...e]=n,s=null!==(a=(0,o.getFormattedCommunityName)(e[0],!r))&&void 0!==a?a:n[1];return!p(s)&&d(t)?(f=s,c.fbt._('You created the community "{community_name}"',[c.fbt._param("community_name",f)],{hk:"1aYDAG"})):p(s)&&d(t)?c.fbt._("You created the community",null,{hk:"4qa2zp"}):p(s)||null==i?p(s)&&null!=i?function(e){return c.fbt._("{author} created the community",[c.fbt._param("author",e)],{hk:"1REjtL"})}(i):p(s)?c.fbt._("The community was created",null,{hk:"3JaIbm"}):function(e){return c.fbt._('The community "{community_name}" was created',[c.fbt._param("community_name",e)],{hk:"2LF0t"})}(s):function(e,t){return c.fbt._('{author} created the community "{community_name}"',[c.fbt._param("author",e),c.fbt._param("community_name",t)],{hk:"2BQlCF"})}(i,s)}case"linked_group_join":return d(t)?c.fbt._("You joined from the community",null,{hk:"2Dw6An"}):c.fbt._("{author} joined from the community",[c.fbt._param("author",i)],{hk:"XjW5z"});default:__LOG__(2)`wa:formatLinkNotification:unknown message subtype: ${e}`}var f}},945320:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){const o=(0,i.getFormattedName)(t,!0);switch(e){case"membership_approval_mode":{const e="on"===n[0],i="true"===n[1];return e?(0,r.isMeAccount)(t)?a.fbt._("You turned on admin approval to join this group. Click to change.",null,{hk:"14pFvg"}):i?a.fbt._("{author} turned on admin approval to join this group. Click to change.",[a.fbt._param("author",o)],{hk:"4w0YIM"}):a.fbt._("{author} turned on admin approval to join this group",[a.fbt._param("author",o)],{hk:"2MT00g"}):(0,r.isMeAccount)(t)?a.fbt._("You turned off admin approval to join this group. Click to change.",null,{hk:"1DsWjI"}):i?a.fbt._("{author} turned off admin approval to join this group. Click to change.",[a.fbt._param("author",o)],{hk:"z8HrE"}):a.fbt._("{author} turned off admin approval to join this group",[a.fbt._param("author",o)],{hk:"42xQ9Y"})}case"membership_approval_request":return a.fbt._("{author} requested to join. Click to review.",[a.fbt._param("author",o)],{hk:"y43oX"});default:__LOG__(2)`wa:formatMembershipApprovalNotification:unknown message subtype: ${e}`}return""};var r=n(978820),i=n(516961),a=n(548360)},516961:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getFormattedCommunityName=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=c.ContactCollection.get(e.toString()))return g(e,t,f(e));return null},t.getFormattedGroupListForCommunity=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,o.unFlattenPairList)(e).map((e=>{let[n,r]=e;const i=_(n,t);return""!==i&&null!=i?i:r}));return(0,s.default)(n,t,"group_list")},t.getFormattedName=h,t.getFormattedNames=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e))return h(e,t);const n=e.map((e=>h(e,t)));return(0,s.default)(n,t)};var i=n(781572),a=n(211739),o=n(556952),s=r(n(488793)),l=n(188172),c=n(719380),u=r(n(873213)),d=n(785893);function p(e){return t=>{t&&(t.preventDefault(),t.stopPropagation()),(0,a.findChat)(e).then((e=>{i.Cmd.openChatFromUnread(e).then((t=>{t&&l.ComposeBoxActions.focus(e)}))}))}}function f(e){return t=>{t&&(t.preventDefault(),t.stopPropagation()),i.Cmd.communityHome(e)}}function _(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null!=c.ContactCollection.get(e.toString()))return g(e,t,p(e));const n=u.default.get(e.toString());return(null==n?void 0:n.subject)?n.subject:null}function h(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return g(e,t,p(e))}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;const i=c.ContactCollection.gadd(e,{silent:!0}),a=t?void 0:r,{Name:o}=n(812176);return t?i.formattedUser:(0,d.jsx)(o,{contact:i,onClick:a})}},160238:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=null!=t?t:"",r=e.mentionMap();if(!r)return function(e){return a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.RICH_TEXT)?(0,s.default)(e,c,l.default):e}(n);if((0,i.isDropLastNameEnabled)()&&e.chat.groupMetadata){const t=e.chat.groupMetadata,i=a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.RICH_TEXT)?o.Configuration.FormattedGroupNotification({mentions:r,groupMetadata:t}):o.Configuration.RawGroupNotification({mentions:r,groupMetadata:t});return(0,s.default)(n,i,l.default)}const u=a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.RICH_TEXT)?o.Configuration.FormattedNotification({mentions:r}):o.Configuration.RawNotification({mentions:r});return(0,s.default)(n,u,l.default)};var i=n(227101),a=n(438184),o=n(130695),s=r(n(80691)),l=r(n(39949));const c=o.Configuration.Format({mentions:{}})},473977:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=i.ContactCollection.get(e);return t?t.formattedName:(0,r.widToFormattedUser)(e)};var r=n(562054),i=n(719380)},832973:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(145095)),a=r(n(540436)),o=r(n(842438)),s=n(718644),l=r(n(502773)),c=n(667294),u=n(785893);class d extends c.Component{constructor(){var e;super(...arguments),e=this,this.state={_stack:[],_transition:"default",_activeKey:0,_ended:!1,isPushed:!1},this.setRefUIE=e=>{this.refUIE=e},this.getElement=()=>{var e;return null===(e=this.refUIE)||void 0===e?void 0:e.getNode()},this.popAndUpdate=(e,t)=>{const n=this.state._stack;if(n.length<2)return void this.pop(t);const r=(0,c.cloneElement)(n[n.length-2],e);n[n.length-2]=r,this.pop(t)},this.push=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.props.pushTransition;e.setState((e=>({_stack:e._stack.concat(t),_transition:n,_activeKey:++e._activeKey,_ended:!1,isPushed:!0})))},this.pop=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.popTransition;const n=e.state._stack.slice(0,-1);n.length?e.setState((e=>({_stack:n,_transition:t,_activeKey:--e._activeKey,isPushed:!1}))):e.state._ended||e.setState({_ended:!0},e.end)},this.end=e=>{this.props.onEnd?this.props.onEnd(e):(0,i.default)(this.context,"this.context").requestDismiss(e)},this.stackSize=()=>this.state._stack.length,this.requestFocus=()=>{this.props.requestFocus&&this.props.requestFocus()}}handleRequestDismiss(){this.pop()}render(){const{_stack:e,_transition:t,_activeKey:n,isPushed:r}=this.state;if(0===e.length)return null;let i=e[e.length-1];return i=(0,c.cloneElement)(i,{isPushed:r}),i=(0,u.jsx)(s.UIE,{displayName:`FlowDrawer${n}`,escapable:!0,ref:this.setRefUIE,requestFocus:this.requestFocus,requestDismiss:this.handleRequestDismiss.bind(this),children:i},n),(0,u.jsx)(a.default,{transitionName:t,className:o.default.container,children:this.props.removeTopDrawer?i:e})}}t.default=d,d.contextType=l.default,d.defaultProps={removeTopDrawer:!0,pushTransition:"flow-transition-drawer-push",popTransition:"flow-transition-drawer-pop"},d.displayName="FlowComponent"},538701:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"string"==typeof e?e:e&&(e.displayName||e.name)||"Component"}},407128:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedComponent=t.HOCRef=void 0,t._getComponent=function(){const e=this.component||this.refs.component;if("function"==typeof e._getComponent)return e._getComponent();return e};var i=r(n(81109)),a=r(n(145095)),o=n(667294);t.HOCRef="component";class s extends o.Component{constructor(e){super(e),this.setComponent=e=>{this.component=e},this.state=(0,i.default)({},this.state)}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){__LOG__(4,void 0,new Error,!0)`${e.stack}\n${t.componentStack}`,SEND_LOGS("component-did-catch")}getComponent(){return this.component instanceof s?this.component.getComponent():(0,a.default)(this.component,"this.component")}}t.WrappedComponent=s},184387:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ListenerHOC=function(e){var t,n;return(t=class extends u.WrappedComponent{constructor(){super(...arguments),this.listeners=new f}componentDidMount(){this.listeners.internalUseOnlyMarkMounted()}componentWillUnmount(){this.listeners.internalUseOnlyMarkUnmounted()}_getComponent(){return u._getComponent.call(this)}render(){return this.state.hasError?null:(0,p.jsx)(e,(0,a.default)((0,a.default)({ref:this.setComponent},this.props),{},{listeners:this.listeners}))}}).defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`Listener(${(0,c.default)(e)})`,t.wrappedComponent=null,t},t.Listeners=void 0;var a=i(n(81109)),o=n(389385),s=n(781572),l=n(698159),c=i(n(538701)),u=n(407128),d=n(59923),p=n(785893);class f{constructor(){this._mounted=!1,this._unmounted=!1,this._listeners=new Set,this._remove=e=>{e.disengage(),this._listeners.delete(e)}}_add(e){this._unmounted?__LOG__(3)`Listener added after unmounting`:(this._listeners.add(e),this._mounted&&e.engage())}internalUseOnlyMarkMounted(){this._mounted=!0,this._listeners.forEach((e=>{e.engage()}))}internalUseOnlyMarkUnmounted(){this._unmounted=!0,this._listeners.forEach(this._remove),this._abortController&&this._abortController.abort()}add(e,t,n,r){const i=this,a=new d.Listener(e,t,(function(){i._unmounted||n.apply(this,arguments)}),r,n);this._add(a)}addOnce(e,t,n,r){const i=this,a=new d.Listener(e,t,(function(){i._remove(a),i._unmounted||n.apply(this,arguments)}),r,n);this._add(a)}remove(e,t,n,r){this._listeners.forEach((i=>{i.represents(e,t,n,r)&&this._remove(i)}))}uiIdle(e){s.Cmd.uiBusy?this.addOnce(s.Cmd,"ui_idle",e):(this._abortController=this._abortController||new r,(0,l.documentFlushed)({signal:this._abortController.signal}).then((()=>{e()}),(e=>{if(e.name!==o.ABORT_ERROR)throw e})))}testsOnlyGetListeners(){return this._listeners}}t.Listeners=f},890012:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,n;return(t=class extends s.WrappedComponent{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.getUnmountSignal=()=>(this._controller||(this._controller=new r,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort()}_getComponent(){return s._getComponent.call(this)}render(){return this.state.hasError?null:(0,l.jsx)(e,(0,a.default)({ref:this.setComponent,getUnmountSignal:this.getUnmountSignal},this.props))}}).defaultProps=null!==(n=e.defaultProps)&&void 0!==n?n:void 0,t.displayName=`UnmountSignal(${(0,o.default)(e)})`,t.wrappedComponent=null,t};var a=i(n(81109)),o=i(n(538701)),s=n(407128),l=n(785893)},651799:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){const r=(0,o.default)(e),{leading:s,trailing:l,maxWait:c}=null!=n?n:{},u=(0,a.useMemo)((()=>(0,i.default)(r,t,n)),[t,s,c,l,r]);return(0,a.useEffect)((()=>u.cancel),[u]),u};var i=r(n(23279)),a=n(667294),o=r(n(389113))},574744:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e,t]=(0,a.useState)((()=>o().getValue()));return(0,a.useEffect)((()=>o().subscribe((e=>{t(e)}))),[]),e};var i=r(n(751463)),a=n(667294);const o=(0,i.default)((()=>new s));class s{constructor(){this._subscribers=new Set}subscribe(e){if(this._subscribers.has(e))throw new Error("Callback can only be added once.");return this._subscribers.add(e),this._updateListener(),()=>{this._subscribers.delete(e),this._updateListener()}}getValue(){var e;return null!==(e=window.devicePixelRatio)&&void 0!==e?e:1}_updateListener(){var e;if(0===this._subscribers.size)return void(null===(e=this._destroyListener)||void 0===e||e.call(this));if(null!=this._destroyListener)return;const t=matchMedia(`(resolution: ${this.getValue()}dppx)`),n=()=>{var e;null===(e=this._destroyListener)||void 0===e||e.call(this);const t=this.getValue();this._subscribers.forEach((e=>{e(t)})),this._updateListener()};t.addListener(n),this._destroyListener=()=>{t.removeListener(n),this._destroyListener=null}}}},885647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e,t]=(0,r.useState)(!1),n=(0,a.useFocusVisibility)();return[(0,i.useFocus)({onFocusChange:t}),e&&n]};var r=n(667294),i=n(162488),a=n(922885)},859312:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[,e]=(0,r.useReducer)((e=>e+1),0);return e};var r=n(667294)},970393:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const{immediate:r=!1}=null!=n?n:{},o=(0,a.default)(e),s=(0,i.useRef)(),l=(0,i.useCallback)((()=>{s.current&&clearInterval(s.current)}),[]),c=(0,i.useCallback)((()=>{l(),s.current=setInterval(o,t)}),[l,t,o]);return(0,i.useEffect)((()=>(r&&c(),l)),[r,c,l]),[c,l]};var i=n(667294),a=r(n(389113))},616223:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,r.useRef)(),n=(0,r.useRef)(!1);n.current||(t.current=e(),n.current=!0);return t};var r=n(667294)},587550:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.useAddListenerOnce=function(){const e=(0,s.useRef)(),t=(0,s.useCallback)(((t,n,r,a)=>{e.current=c(t,n,r,(0,i.default)((0,i.default)({},a),{},{once:!0}))}),[]),n=(0,s.useCallback)((()=>{var t;null===(t=e.current)||void 0===t||t.call(e)}),[]);return(0,s.useEffect)((()=>n),[n]),[t,n]},t.useListener=function(e,t,n,r){const i=(0,l.default)(n),a=u(t);(0,s.useLayoutEffect)((()=>{if(null!=n)return c(e,t,i,r)}),[e,null==n,a])},t.useListeners=function(e){const t=e.map((e=>{let{callback:t}=e;return t})),n=(0,s.useRef)(t);n.current=t;const r=e.map((e=>{let{source:t,eventOrEvents:n}=e;return`${(0,a.default)(t)},${u(n)}`})).join("-");(0,s.useLayoutEffect)((()=>{const t=e.map(((e,t)=>{let{source:r,eventOrEvents:i,opts:a}=e;return c(r,i,(function(){for(var e,r,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return null===(e=(r=n.current)[t])||void 0===e?void 0:e.call(r,...a)}),a)}));return()=>t.forEach((e=>e()))}),[r])};var i=r(n(81109)),a=r(n(132176)),o=n(59923),s=n(667294),l=r(n(389113));function c(e,t,n,r){if(null==e)return()=>{};const i=function(e,t){if(Array.isArray(t))return(0,o.isEventsType)(e)?[t.join(" ")]:t;return[t]}(e,t).map((t=>new o.Listener(e,t,(function(){(null==r?void 0:r.once)&&a(),n(...arguments)}),r)));i.forEach((e=>{e.engage()}));const a=()=>{i.forEach((e=>{e.disengage()}))};return a}function u(e){return Array.isArray(e)?e.join("\0"):e}},778506:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(48313).useMergeRefs;t.default=r},735461:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StateHookMissingModelError=void 0,t.useModelValues=function(e,t,n){if(null==e)throw __LOG__(4,void 0,new Error,!0)`useModelValues hook received an unexpected \`null\` model`,SEND_LOGS("state-hook-null-model"),new c("Unknown");const r=u(e,t,n);return(0,a.default)(r,"values")},t.useOptionalModelValues=u;var i=n(640265),a=r(n(145095)),o=r(n(287541)),s=n(118146),l=n(667294);class c extends((0,i.customError)("StateHookMissingModelError")){constructor(e){super(`Received a null value for model key: ${e}`)}}function u(e,t,n){const{isStrong:r=!0,componentName:i}=null!=n?n:{},a=e?(0,s.unproxy)(e):null,c=(0,l.useRef)();function u(){if(null==c.current){if(!a)return null;c.current=new o.default(null!=i?i:"Hook(useModelValues)",a.proxyName,t,r,!0)}return c.current}const[d,p]=(0,l.useState)((()=>{const e=u();if(!e)return null;const t=e.getModelAndValidate(a);return t?e.createProxy(t):null})),f=(0,l.useCallback)(((e,t)=>{const n=e.getModelAndValidate(t);p(n?e.createProxy(n):null)}),[]);(0,l.useEffect)((()=>{const e=u();if(!e||!d)return;const t=e.getModel(a);return e.attachConcern(t,d.proxyBitMask,f),()=>{e.detachConcern(t,f)}}),[a,d,f]);const[_,h]=(0,l.useState)(a),g=u();if(_!==a&&g){_&&g.detachConcern(_,f);const e=g.getModelAndValidate(a);h(e),p(e?g.createProxy(e):null)}return d}t.StateHookMissingModelError=c},955010:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,a.default)(e);(0,i.useEffect)((()=>t),[t])};var i=n(667294),a=r(n(389113))},693999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,n]=(0,i.useState)((()=>{var t;return null!==(t=r.userPreferencesStore.get(e))&&void 0!==t?t:0})),a=(0,i.useCallback)((()=>{r.userPreferencesStore.set(e,t+1),n(t+1)}),[e,t]),o=(0,i.useCallback)((()=>{r.userPreferencesStore.set(e,0),n(0)}),[e]);return[t,a,o]};var r=n(491442),i=n(667294)},837453:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e})),t.current};var r=n(667294)},389113:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,r.useRef)(e);t.current=e;return(0,r.useCallback)((function(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return null===(e=t.current)||void 0===e?void 0:e.call(t,...r)}),[])};var r=n(667294)},734470:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n;const r=(0,a.useRef)(),s=!0===(null==t?void 0:t.disabled),l=s?o:e;return[e=>{r.current=e},{"aria-disabled":null!==(n=null==t?void 0:t.disabled)&&void 0!==n?n:void 0,onClick:l,onKeyPress:function(e){var t;(0,i.default)(e)&&(e.stopPropagation(),e.preventDefault(),null===(t=r.current)||void 0===t||t.click())},role:"button",tabIndex:s?-1:0}]};var i=r(n(254889)),a=n(667294);function o(){}},346428:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.useManualTimeout=o,t.useTimeout=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;const{immediate:r=!1}=null!=n?n:{},[a,s]=o(e),l=(0,i.useCallback)((()=>a(t)),[a,t]);return(0,i.useEffect)((()=>{r&&l()}),[r,l]),[l,s]};var i=n(667294),a=r(n(389113));function o(e){const t=(0,a.default)(e),n=(0,i.useRef)(),r=(0,i.useCallback)((()=>{n.current&&clearTimeout(n.current)}),[]),o=(0,i.useCallback)((e=>{r(),n.current=setTimeout(t,e)}),[r,t]);return(0,i.useEffect)((()=>r),[r]),[o,r]}},627698:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){const n=(0,a.default)(t),[r,o]=(0,i.useState)(e),s=(0,i.useCallback)((()=>o((e=>{const t=!e;return n(t),t}))),[n]);return[r,s]};var i=n(667294),a=r(n(389113))},895402:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,a.useContext)(i.default)};var i=r(n(502773)),a=n(667294)},803409:(e,t,n)=>{"use strict";var r=n(280366).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const[e]=(0,i.useState)((()=>new r));return(0,i.useEffect)((()=>()=>e.abort()),[e]),e.signal};var i=n(667294)},756599:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.initModules=function(){c()};var a=i(n(751463)),o=n(757491),s=n(546582);const l={minTimeout:1e3,maxTimeout:12e4,retries:1/0,signal:(new r).signal};const c=(0,a.default)((function(){return(0,o.exponentialBackoff)(l,((e,t)=>Promise.all([n.e(2101),n.e(7964)]).then(n.bind(n,167019)).catch((n=>(__LOG__(3)`failed to load main bundle`,10===t&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("failed to load main bundle")),e(n)))))).then((e=>(0,s.setMainBundleModules)(e)))}))},546582:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMainBundleModules=o,t.requireCallCollection=function(){return E.apply(this,arguments)},t.requireChatCollection=function(){return m.apply(this,arguments)},t.requireClearAppStates=function(){return _.apply(this,arguments)},t.requireContactCollection=function(){return l.apply(this,arguments)},t.requireEmojiAssetMapCreator=function(){return p.apply(this,arguments)},t.requireEmojiConfig=function(){return d.apply(this,arguments)},t.requireHandleSocketMessage=function(){return u.apply(this,arguments)},t.requireHandleVideoStreamingRequest=function(){return h.apply(this,arguments)},t.requireLabelCollection=function(){return g.apply(this,arguments)},t.requireLoadProtoVersions=function(){return c.apply(this,arguments)},t.requireMain=function(){return s.apply(this,arguments)},t.requireMsgCollection=function(){return y.apply(this,arguments)},t.requireSetHandlers=function(){return C.apply(this,arguments)},t.requireStatusV3Collection=function(){return f.apply(this,arguments)},t.requireStickerPackCollection=function(){return S.apply(this,arguments)},t.requireVoip=function(){return v.apply(this,arguments)},t.requireVoipCommonDisabled=function(){return T.apply(this,arguments)},t.setMainBundleModules=function(e){return a.resolve(e),e};var i=r(n(348926));const a=new(n(88156).Resolvable);function o(){return a.promise}function s(){return(s=(0,i.default)((function*(){return(yield o()).requireMain()}))).apply(this,arguments)}function l(){return(l=(0,i.default)((function*(){return(yield o()).requireContactCollection()}))).apply(this,arguments)}function c(){return(c=(0,i.default)((function*(){return(yield o()).requireLoadProtoVersions()}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(){return(yield o()).requireHandleSocketMessage()}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(){return(yield o()).requireEmojiConfig()}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(){return(yield o()).requireEmojiAssetMapCreator()}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(){return(yield o()).requireStatusV3Collection()}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(){return(yield o()).requireClearAppStates()}))).apply(this,arguments)}function h(){return(h=(0,i.default)((function*(){return(yield o()).requireHandleVideoStreamingRequest()}))).apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){return(yield o()).requireLabelCollection()}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(){return(yield o()).requireChatCollection()}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(){return(yield o()).requireMsgCollection()}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(){return(yield o()).requireStickerPackCollection()}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){return(yield o()).requireCallCollection()}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){return(yield o()).requireVoip()}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(){return(yield o()).requireVoipCommonDisabled()}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(){return(yield o()).requireSetHandlers()}))).apply(this,arguments)}},59923:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Listener=void 0,t.isEventsType=o;var i=n(581703),a=r(n(876521));function o(e){return e instanceof a.default||"function"==typeof e.on&&"function"==typeof e.off}t.Listener=class{constructor(e,t,n,r,a){this._hasEngaged=!1,this._hasDisengaged=!1,this.source=e,this.cb=n,this.opts=r,this._cbIdentifier=a,o(e)?this.event=t:this.event=(0,i.compatPrefix)(t,e)}engage(){if(this._hasEngaged||this._hasDisengaged)return;this._hasEngaged=!0;const e=this.source,t=this.event;o(e)?(e.on(t,this.cb),"function"==typeof e.incObservers&&e.incObservers()):this.opts?e.addEventListener(t,this.cb,this.opts):e.addEventListener(t,this.cb)}disengage(){if(this._hasDisengaged)return;if(this._hasDisengaged=!0,!this._hasEngaged)return;const e=this.source,t=this.event;o(e)?(e.off(this.event,this.cb),"function"==typeof e.decObservers&&e.decObservers()):this.opts?e.removeEventListener(t,this.cb,this.opts):e.removeEventListener(t,this.cb)}represents(e,t,n,r){var i;if(this.source!==e)return!1;if(this.event!==t)return!1;if(this._cbIdentifier!==n)return!1;const{capture:a=!1,once:o=!1,passive:s=!1}=null!=r?r:{},{capture:l=!1,once:c=!1,passive:u=!1}=null!==(i=this.opts)&&void 0!==i?i:{};return a===l&&o===c&&s===u}}},565273:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(530988)),o=r(n(618446)),s=n(39581),l=r(n(216186)),c=r(n(124055)),u=r(n(46668)),d=n(934855),p=n(350833),f=n(839989),_=n(881829),h=r(n(948014)),g=n(447732);class m{static create(){const{backgroundColor:e,tintColor:t}=g.DEFAULT_DOMINANT_COLOR.getBackgroundAndTintColors();return new m({id:Math.random(),frame:new c.default({origin:new l.default({x:0,y:0}),size:new u.default({width:0,height:0}),rotation:0,scale:0}),layers:[],paintLayer:new p.DrawLayer({size:u.default.empty(),type:p.DrawLayerType.Paint}),outlineLayer:new p.DrawLayer({size:u.default.empty(),type:p.DrawLayerType.Outline}),background:null,selectedLayer:null,backgroundColor:e,tintColor:t,rotation:0,cropFrame:new c.default({origin:new l.default({x:0,y:0}),size:new u.default({width:0,height:0}),rotation:0,scale:0})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}_update(e){const t=(0,i.default)({},this._props);return null!=e.layers&&(t.layers=e.layers),void 0!==e.paintLayer&&(t.paintLayer=e.paintLayer),void 0!==e.outlineLayer&&(t.outlineLayer=e.outlineLayer),void 0!==e.background&&(t.background=e.background),void 0!==e.frame&&(t.frame=e.frame,t.frame&&(t.cropFrame=t.cropFrame.updateXYWidthHeight({x:0,y:0,width:t.frame.width,height:t.frame.height}))),void 0!==e.cropFrame&&(t.cropFrame=e.cropFrame),void 0!==e.selectedLayer&&(t.selectedLayer=e.selectedLayer),null!=e.backgroundColor&&(t.backgroundColor=e.backgroundColor),null!=e.tintColor&&(t.tintColor=e.tintColor),null!=e.rotation&&(t.rotation=e.rotation),(0,o.default)(this._props,t)?this:new m(t)}updateLayer(e,t){if(e instanceof _.TextLayer&&!(t instanceof _.TextLayer)||e instanceof f.ImageLayer&&!(t instanceof f.ImageLayer))throw new TypeError("MediaEditorData: calling _updateLayer with two different layer types");if(e===t)return this;const n=this.layers.map((n=>n===e?t:n));let r=this.selectedLayer;return r===e&&(r=t),this._update({layers:n,selectedLayer:r})}setBackground(e,t){const{fitToSquare:n=!1,scale:r=1}=null!=t?t:{},i=f.ImageLayer.create({type:f.ImageLayerType.Background,origin:new l.default({x:0,y:0}),image:e,editable:!0,scale:r}),a=i.frame.dimension,o=n?c.default.create({x:0,y:0,width:a,height:a,scale:1,rotation:0}):i.frame,s=new l.default({x:(o.width-i.width)/2,y:(o.height-i.height)/2}),u=i.setScale(r).setOrigin(s),d=(0,g.getDominantColor)(e),{backgroundColor:_,tintColor:h}=d.getBackgroundAndTintColors(),m=new p.DrawLayer({size:o.size,type:p.DrawLayerType.Paint}),y=new p.DrawLayer({size:o.size,type:p.DrawLayerType.Outline});return this._update({background:u,frame:o,backgroundColor:_,tintColor:h,paintLayer:m,outlineLayer:y})}updateBackground(e,t,n,r){var i;const a=null===(i=this.background)||void 0===i?void 0:i.setImage(e).setOrigin(t).setRotation(n).setScale(r);return this._update({background:a,selectedLayer:a}).setBlurLayerBackground(null==a?void 0:a.frame,e)}addImageLayer(e){const t=f.ImageLayer.create(e),n=[...this.layers,t];return this._update({layers:n,selectedLayer:t})}addImageLayerToCenter(e){const t=this.toCanvasPoint(new l.default({x:this.screenWidth/2,y:this.screenHeight/2})),n=new l.default({x:t.x-e.image.width/2,y:t.y-e.image.height/2}),r=(0,i.default)({origin:n,rotation:-this.rotation},e);return this.addImageLayer(r)}addBlurLayer(e){const t=d.BlurLayer.create(e),n=[...this.layers,t];return this._update({layers:n,selectedLayer:t})}addBlurLayerToCenter(e){var t,n,r,a;const o=this.toCanvasPoint(new l.default({x:this.screenWidth/2,y:this.screenHeight/2})),s=new l.default({x:o.x-(null!==(t=null===(n=e.size)||void 0===n?void 0:n.width)&&void 0!==t?t:e.image.width)/2,y:o.y-(null!==(r=null===(a=e.size)||void 0===a?void 0:a.height)&&void 0!==r?r:e.image.height)/2}),c=(0,i.default)({origin:s},e);return this.addBlurLayer(c)}setBlurLayerBackground(e,t){const n=this.layers.map((n=>{let r=n;return r instanceof d.BlurLayer&&(null!=t&&(r=r.setImage(t)),null!=e&&(r=r.setBlurBackgroundFrame(e))),r}));return this._update({layers:n})}addTextLayer(e){const t=e instanceof _.TextLayer?e:_.TextLayer.create((0,i.default)((0,i.default)({},e),{},{rotation:-this.rotation})),n=[...this.layers,t];return this._update({layers:n,selectedLayer:t})}setText(e,t){return this.updateLayer(e,e.setText(t))}setTextColor(e,t){return this.updateLayer(e,e.setTextColor(t))}setTextBackground(e,t){return this.updateLayer(e,e.setTextBackground(t))}setFont(e,t){return this.updateLayer(e,e.setFont(t))}setAlignment(e,t){return this.updateLayer(e,e.setAlignment(t))}setBlurMode(e,t){return this.updateLayer(e,e.setBlurMode(t))}setBlurRadius(e,t){return this.updateLayer(e,e.setBlurRadius(t))}setBlurBackgroundFrame(e,t){return this.updateLayer(e,e.setBlurBackgroundFrame(t))}setRotation(e){if(e%90!=0)throw new Error("canvas can only be rotated at a 90 degrees interval");return this._update({rotation:e%360})}setCrop(e,t){if(e.x<0||e.y<0||e.x+t.width>this.width||e.y+t.height>this.height)throw new Error("canvas crop must stays within the frame bound");const n=new c.default({origin:e,size:t,rotation:0,scale:0});return this._update({cropFrame:n})}addEmptyTextLayer(e,t){const n={origin:new l.default({x:this.width/4,y:this.height/2}),text:"",textColor:e,textBackground:!1,font:t,alignment:s.TextAlignment.CENTER};return this.addTextLayer(n)}addPaintPath(e){const t=this.paintLayer.addPath(e);return this._update({paintLayer:t})}addOutlinePath(e){const t=this.outlineLayer.addPath(e);return this._update({outlineLayer:t})}cropToOutline(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;if(this.outlineLayer.isEmpty())return this;const n=this.outlineLayer.getAllPoints(),r=(0,h.default)(n,this.frame.rotation,this.frame.scale),i=null!=t?t:r.size.dimension,a=e*r.size.dimension/i,o=r.addPadding(a,this.frame);return this.setCrop(o.origin,o.size)}clearOutlinePaths(){const e=this.outlineLayer.clearPaths();return this._update({outlineLayer:e})}translateLayer(e,t){return this.updateLayer(e,e.setOrigin(t))}translateBackground(e){var t;const n=null===(t=this.background)||void 0===t?void 0:t.setOrigin(e);return this._update({background:n,selectedLayer:n}).setBlurLayerBackground(null==n?void 0:n.frame)}transformLayer(e,t,n,r){let i=e;return null!=r&&e instanceof d.BlurLayer&&(i=e.setFrame(r)),i=i.setRotation(t).setScale(n),this.updateLayer(e,i)}transformBackground(e,t){var n;const r=null===(n=this.background)||void 0===n?void 0:n.setRotation(e).setScale(t);return this._update({background:r,selectedLayer:r}).setBlurLayerBackground(null==r?void 0:r.frame)}setSelectedLayer(e){return this._update({selectedLayer:e})}moveToTop(e){if(this.layers[this.layers.length-1]===e)return this;const t=[...this.layers.filter((t=>t!==e)),e];return this._update({layers:t})}clearSelectedLayer(){return this._update({selectedLayer:null})}deleteLayer(e){e.delete();let t={layers:this.layers.filter((t=>t!==e))};return e===this.selectedLayer&&(t=(0,i.default)((0,i.default)({},t),{},{selectedLayer:null})),this._update(t)}deleteAllLayers(){return this.layers.forEach((e=>e.delete())),this._update({layers:[],paintLayer:new p.DrawLayer({size:this.size,type:p.DrawLayerType.Paint}),outlineLayer:new p.DrawLayer({size:this.size,type:p.DrawLayerType.Outline}),selectedLayer:null})}hasEdits(){return!this.paintLayer.isEmpty()||!this.outlineLayer.isEmpty()||this.layers.length>0||0!==this.rotation||!this.size.equals(this._props.cropFrame.size)}get layers(){return this._props.layers}get lastTextLayer(){const e=(0,a.default)(this.layers,(e=>e instanceof _.TextLayer));return e instanceof _.TextLayer?e:null}get paintLayer(){return this._props.paintLayer}get outlineLayer(){return this._props.outlineLayer}get background(){return this._props.background}get selectedLayer(){return this._props.selectedLayer}get backgroundColor(){return this._props.backgroundColor}get tintColor(){return this._props.tintColor}get size(){return this._props.frame.size}get frame(){return this._props.frame}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get cropWidth(){return this._props.cropFrame.width}get cropHeight(){return this._props.cropFrame.height}get cropOrigin(){return this._props.cropFrame.origin}get cropSize(){return this._props.cropFrame.size}get cropCenter(){return this._props.cropFrame.getCenter()}get screenWidth(){return this.rotation%180==0?this.cropWidth:this.cropHeight}get screenHeight(){return this.rotation%180==0?this.cropHeight:this.cropWidth}get canvasCenter(){return new l.default({x:this.width/2,y:this.height/2})}get rotation(){return this._props.rotation}get id(){return this._props.id}toScreenPoint(e){const t=Math.max(this.width,this.height),n=new l.default({x:t/2,y:t/2}),r=new l.default({x:e.x+(t-this.width)/2,y:e.y+(t-this.height)/2}).rotate(n,this.rotation),i=new l.default({x:this.cropCenter.x+(t-this.width)/2,y:this.cropCenter.y+(t-this.height)/2}).rotate(n,this.rotation),a=new l.default({x:i.x-this.screenWidth/2,y:i.y-this.screenHeight/2});return new l.default({x:r.x-a.x,y:r.y-a.y})}toCanvasPoint(e){const t=Math.max(this.width,this.height),n=new l.default({x:t/2,y:t/2}),r=this.cropCenter.rotate(n,this.rotation),i=new l.default({x:r.x-this.screenWidth/2,y:r.y-this.screenHeight/2}),a=new l.default({x:e.x+i.x,y:e.y+i.y}).rotate(n,-this.rotation);return new l.default({x:a.x,y:a.y})}resetCropRotate(){return this.setRotation(0).setCrop(new l.default({x:0,y:0}),new u.default({width:this.width,height:this.height}))}isRotated(){return 0!==this.rotation}isCropped(){return!this.cropOrigin.equals(new l.default({x:0,y:0}))||!this.cropSize.equals(this.size)}isOutlined(){return!this.outlineLayer.isEmpty()}}t.default=m},992320:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COLORS=void 0,t.getAllColors=function(){return Object.keys(i)},t.getColorValue=function(e){return a[e]};var r=n(316241);const i=Object.freeze({BLACK:"BLACK",GRAY:"GRAY",WHITE:"WHITE",BLUE:"BLUE",GREEN:"GREEN",PURPLE:"PURPLE",ORANGE:"ORANGE",RED:"RED"});t.COLORS=i;const a={[i.BLACK]:r.Color.fromHex("#434343"),[i.GRAY]:r.Color.fromHex("#9DA0A9"),[i.WHITE]:r.Color.fromHex("#FFFFFF"),[i.BLUE]:r.Color.fromHex("#33CEFF"),[i.GREEN]:r.Color.fromHex("#64DC2F"),[i.PURPLE]:r.Color.fromHex("#BD73FF"),[i.ORANGE]:r.Color.fromHex("#F49226"),[i.RED]:r.Color.fromHex("#FF4A4A")}},39581:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TextAlignment=t.FONTS=void 0,t.getAllFonts=function(){return Object.keys(i)},t.getFontStyle=function(e){return a[e]},t.getFontTranslation=function(e){switch(e){case i.SANS_SERIF:return r.fbt._("Sans Serif",null,{hk:"oqthG"});case i.SERIF:return r.fbt._("Serif",null,{hk:"1EWGvo"});case i.NORICAN_REGULAR:return r.fbt._("Norican",null,{hk:"RU2yb"});case i.BRYNDAN_WRITE:return r.fbt._("Bryndan Write",null,{hk:"2d40Ei"});case i.OSWALD_HEAVY:return r.fbt._("Oswald",null,{hk:"vyZEQ"});default:throw new Error("Unsupported font")}};var r=n(548360);const i=Object.freeze({SANS_SERIF:"SANS_SERIF",SERIF:"SERIF",NORICAN_REGULAR:"NORICAN_REGULAR",BRYNDAN_WRITE:"BRYNDAN_WRITE",OSWALD_HEAVY:"OSWALD_HEAVY"});t.FONTS=i;const a={[i.SANS_SERIF]:{fontFamily:"sans-serif"},[i.SERIF]:{fontFamily:'"Droid Serif", serif'},[i.NORICAN_REGULAR]:{fontFamily:'"Norican"'},[i.BRYNDAN_WRITE]:{fontFamily:'"Bryndan-Write"'},[i.OSWALD_HEAVY]:{fontFamily:'"Oswald"',fontWeight:"bold"}},o=n(76672).Mirrored(["LEFT","CENTER","RIGHT"]);t.TextAlignment=o},370638:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class n{constructor(e){const{points:t,color:n,thickness:r,smoothing:i}=e;this._points=[...t],this._color=n,this._thickness=r,this._smoothing=i,Object.freeze(this)}update(e){let t=this.points,r=this.color,i=this.thickness,a=this.smoothing;return null!=e.points&&(t=e.points),null!=e.color&&(r=e.color),null!=e.thickness&&(i=e.thickness),null!=e.smoothing&&(a=e.smoothing),new n({points:t,color:r,thickness:i,smoothing:a})}clone(){const e={points:[...this.points],color:this.color.clone(),thickness:this.thickness,smoothing:this.smoothing};return new n(e)}toString(){return`points: [${this.points.map((e=>e.toString())).join(", ")}]\ncolor: ${this.color.toString()}\nthickness: ${this.thickness}`}equals(e){return this.color.equals(e.color)&&Math.abs(this.thickness-e.thickness)<Number.EPSILON&&this.points.length===e.points.length&&this.points.every(((t,n)=>t.equals(e.points[n])))}isDrag(){return this.points.length>1}isSmooth(){return this.smoothing||this.isDrag()}isStraight(){return!this.isSmooth()}get points(){return this._points}get color(){return this._color}get thickness(){return this._thickness}get smoothing(){return this._smoothing}}t.default=n},216186:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(618446));class o{constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.x&&(t.x=e.x),null!=e.y&&(t.y=e.y),(0,a.default)(this._props,t)?this:new o(t)}clone(){return new o(this._props)}toString(){return`(${this.x}x, ${this.y}y)`}equals(e){return Math.abs(this.x-e.x)<Number.EPSILON&&Math.abs(this.y-e.y)<Number.EPSILON}distance(e){return Math.sqrt((e.x-this.x)**2+(e.y-this.y)**2)}rotate(e,t){const n=t*Math.PI/180,r=this.x-e.x,i=this.y-e.y,a=Math.cos(n)*r-Math.sin(n)*i+e.x,s=Math.sin(n)*r+Math.cos(n)*i+e.y;return new o({x:Math.round(100*a)/100,y:Math.round(100*s)/100})}get x(){return this._props.x}get y(){return this._props.y}}t.default=o},124055:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(618446)),o=r(n(216186)),s=r(n(46668));class l{static create(e){return new l({origin:new o.default({x:e.x,y:e.y}),size:new s.default({width:e.width,height:e.height}),rotation:e.rotation,scale:e.scale})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}updateXYWidthHeight(e){const t=(0,i.default)({},this._props);return null==e.x&&null==e.y||(t.origin=t.origin.update({x:e.x,y:e.y})),null==e.width&&null==e.height||(t.size=t.size.update({width:e.width,height:e.height})),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&(t.scale=e.scale),this.update(t)}update(e){const t=(0,i.default)({},this._props);return null!=e.origin&&(t.origin=e.origin),null!=e.size&&(t.size=e.size),null!=e.rotation&&(t.rotation=e.rotation),null!=e.scale&&Math.abs(t.scale-e.scale)>1e-6&&(t.scale=e.scale),(0,a.default)(this._props,t)?this:new l(t)}clone(){return new l(this._props)}addPadding(e,t){const n=this.getTopLeft(),r=t.getTopLeft(),i=new o.default({x:Math.max(r.x,n.x-e),y:Math.max(r.y,n.y-e)}),a=this.getBottomRight(),s=t.getBottomRight(),l=new o.default({x:Math.min(s.x,a.x+e),y:Math.min(s.y,a.y+e)}),c=l.x-i.x,u=l.y-i.y;return this.updateXYWidthHeight({x:i.x,y:i.y,width:c,height:u})}toString(){return`(${this.origin.toString()}, ${this.size.toString()}, ${this.rotation}r)`}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)&&this.rotation===e.rotation&&this.scale===e.scale}contains(e){return e.x>=this.x&&e.y>=this.y&&e.x<this.x+this.width&&e.y<this.y+this.height}getTopLeft(){return new o.default({x:this.x,y:this.y})}getTopCenter(){return new o.default({x:this.x+this.width/2,y:this.y})}getTopRight(){return new o.default({x:this.x+this.width,y:this.y})}getLeftCenter(){return new o.default({x:this.x,y:this.y+this.height/2})}getCenter(){return new o.default({x:this.x+this.width/2,y:this.y+this.height/2})}getRightCenter(){return new o.default({x:this.x+this.width,y:this.y+this.height/2})}getBottomLeft(){return new o.default({x:this.x,y:this.y+this.height})}getBottomCenter(){return new o.default({x:this.x+this.width/2,y:this.y+this.height})}getBottomRight(){return new o.default({x:this.x+this.width,y:this.y+this.height})}get origin(){return this._props.origin}get size(){return this._props.size}get x(){return this.origin.x}get y(){return this.origin.y}get width(){return this.size.width}get height(){return this.size.height}get rotation(){return this._props.rotation}get scale(){return this._props.scale}get dimension(){return this.size.dimension}}t.default=l},46668:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(618446));class o{constructor(e){const{width:t,height:n}=e;if(t<0)throw new RangeError("MediaEditor:Size width cannot be negative");if(n<0)throw new RangeError("MediaEditor:Size height cannot be negative");this._props=Object.freeze({width:t,height:n}),Object.freeze(this)}update(e){const t=(0,i.default)({},this._props);return null!=e.width&&(t.width=e.width),null!=e.height&&(t.height=e.height),(0,a.default)(this._props,t)?this:new o(t)}clone(){return new o(this._props)}toString(){return`(${this.width}w, ${this.height}h)`}equals(e){return Math.abs(this.width-e.width)<Number.EPSILON&&Math.abs(this.height-e.height)<Number.EPSILON}isEmpty(){return this.equals(o.empty())}static empty(){return new o({width:0,height:0})}get width(){return this._props.width}get height(){return this._props.height}get dimension(){return Math.max(this.width,this.height)}}t.default=o},934855:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.BlurMode=t.BlurLayer=void 0;var i=r(n(81109)),a=r(n(618446)),o=r(n(124055)),s=r(n(46668)),l=n(683428);const c=n(76672).Mirrored(["Smooth","Pixelate"]);t.BlurMode=c;class u{static create(e){const t=e.image.width,n=e.image.height;if(!t||!n)throw new Error("Image must have valid width and height");return new u({id:(0,l.generateLayerId)("blur"),image:e.image,editable:!0,frame:new o.default({origin:e.origin,size:e.size,rotation:0,scale:1}),radius:e.radius,mode:e.mode,backgroundFrame:e.backgroundFrame})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setFrame(e){return this._update({frame:e})}setImage(e){return this._update({image:e})}setEditable(e){return this._update({editable:e})}setBlurMode(e){return this._update({mode:e})}setBlurRadius(e){return this._update({radius:e})}setBlurBackgroundFrame(e){return this._update({backgroundFrame:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.image){const n=e.image.width,r=e.image.height;if(!n||!r)throw new Error("Image must have valid width and height");t.image=e.image,t.frame=new o.default({origin:this.frame.origin,size:new s.default({width:n,height:r}),rotation:this.frame.rotation,scale:this.frame.scale})}return null!=e.editable&&(t.editable=e.editable),null!=e.frame&&(t.frame=e.frame),null!=e.radius&&(t.radius=e.radius),null!=e.mode&&(t.mode=e.mode),null!=e.backgroundFrame&&(t.backgroundFrame=e.backgroundFrame),(0,a.default)(this._props,t)?this:new u(t)}get image(){return this._props.image}get editable(){return this._props.editable}get id(){return this._props.id}get frame(){return this._props.frame}get origin(){return this._props.frame.origin}get size(){return this._props.frame.size}get x(){return this._props.frame.x}get y(){return this._props.frame.y}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get rotation(){return this._props.frame.rotation}get scale(){return this._props.frame.scale}get mode(){return this._props.mode}get radius(){return this._props.radius}get backgroundFrame(){return this._props.backgroundFrame}}t.BlurLayer=u},350833:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DrawLayerType=t.DrawLayer=void 0;var i=r(n(370638)),a=r(n(216186)),o=r(n(124055)),s=n(683428);const l=n(76672).Mirrored(["Paint","Outline"]);t.DrawLayerType=l;class c{constructor(e){if(this._type=e.type,null!=e.size){const t=e.size;this._frame=new o.default({origin:new a.default({x:0,y:0}),size:t,rotation:0,scale:1}),this._paths=[]}else null!=e.frame&&null!=e.paths&&(this._frame=e.frame,this._paths=e.paths);e.id?this._id=e.id:this._id=(0,s.generateLayerId)(e.type),Object.freeze(this)}delete(){}_update(e){let t=this._paths;null!=e.paths&&(t=e.paths);const n=this._frame,r=this._type;return new c({id:this.id,paths:t,frame:n,type:r})}setOrigin(){throw new TypeError("MediaEditor:DrawLayer resetting origin is not allowed")}setRotation(){throw new TypeError("MediaEditor:DrawLayer resetting rotation is not allowed")}setScale(){throw new TypeError("MediaEditor:DrawLayer resetting scale is not allowed")}addPath(e){const t=new i.default(e),n=[...this._paths,t];return this._update({paths:n})}clearPaths(){return this._update({paths:[]})}isEmpty(){return 0===this._paths.length}getAllPoints(){return this.paths.reduce(((e,t)=>(!t.smoothing&&e.length&&e.push(e[e.length-1]),t.isDrag()&&e.push(t.points[0]),e.push(...t.points.flatMap((e=>t.isSmooth()?[e]:[e,e]))),e)),[])}get paths(){return this._paths}get editable(){return!1}get id(){return this._id}get type(){return this._type}get frame(){return this._frame}get origin(){return this._frame.origin}get size(){return this._frame.size}get x(){return this._frame.x}get y(){return this._frame.y}get width(){return this._frame.width}get height(){return this._frame.height}get rotation(){return this._frame.rotation}get scale(){return this._frame.scale}}t.DrawLayer=c},839989:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ImageLayerType=t.ImageLayer=void 0;var i=r(n(81109)),a=r(n(618446)),o=r(n(124055)),s=r(n(46668)),l=n(683428);const c=n(76672).Mirrored(["Image","Emoji","Sticker","Background"]);t.ImageLayerType=c;class u{static create(e){var t;const n=e.image.width,r=e.image.height;if(!n||!r)throw new Error("Image must have valid width and height");return new u({id:(0,l.generateLayerId)("image"),type:e.type,image:e.image,editable:e.editable,frame:new o.default({origin:e.origin,size:new s.default({width:n,height:r}),rotation:null!==(t=e.rotation)&&void 0!==t?t:0,scale:e.scale})})}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setFrame(e){return this._update({frame:e})}setImage(e){return this._update({image:e})}setEditable(e){return this._update({editable:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.image){const n=e.image.width,r=e.image.height;if(!n||!r)throw new Error("Image must have valid width and height");t.image=e.image,t.frame=new o.default({origin:this.frame.origin,size:new s.default({width:n,height:r}),rotation:this.frame.rotation,scale:this.frame.scale})}return null!=e.editable&&(t.editable=e.editable),null!=e.frame&&(t.frame=e.frame),(0,a.default)(this._props,t)?this:new u(t)}get image(){return this._props.image}get editable(){return this._props.editable}get id(){return this._props.id}get frame(){return this._props.frame}get origin(){return this._props.frame.origin}get size(){return this._props.frame.size}get x(){return this._props.frame.x}get y(){return this._props.frame.y}get width(){return this._props.frame.width}get height(){return this._props.frame.height}get rotation(){return this._props.frame.rotation}get scale(){return this._props.frame.scale}isSticker(){return this._props.type===c.Sticker}isEmoji(){return this._props.type===c.Emoji}isBackground(){return this._props.type===c.Background}}t.ImageLayer=u},881829:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayer=t.DEFAULT_FONT_SIZE=void 0;var i=r(n(81109)),a=r(n(618446)),o=n(992320),s=(n(39581),r(n(216186))),l=r(n(124055)),c=r(n(46668)),u=n(316241),d=n(683428),p=n(331323),f=n(451234);t.DEFAULT_FONT_SIZE=18;const _={lineVerticalPadding:6,lineHorizontalPadding:8,layerPadding:6,backgroundBorderRadius:5,backgroundShadow:{offsetX:0,offsetY:1,radius:6,spread:0,color:new u.Color(0,0,0,.32)}};class h{static create(e){var t;const n=[],r=g(n,_);let i=0;return null!=e.rotation&&(i=e.rotation),new h({id:(0,d.generateLayerId)("text"),text:"",textColor:e.textColor,textBackground:e.textBackground,font:e.font,alignment:e.alignment,lines:n,frame:new l.default({origin:new s.default({x:e.origin.x-r.width/2,y:e.origin.y-r.height/2}),size:r,rotation:i,scale:null!==(t=e.scale)&&void 0!==t?t:1}),maxWidth:0,backgroundPath:""}).setText(e.text)}constructor(e){this._props=Object.freeze((0,i.default)({},e)),Object.freeze(this)}delete(){}setOrigin(e){return this._update({frame:this.frame.update({origin:e})})}setRotation(e){return this._update({frame:this.frame.update({rotation:e})})}setScale(e){return this._update({frame:this.frame.update({scale:e})})}setText(e){return this._update({text:e})}setTextColor(e){return this._update({textColor:e})}setTextBackground(e){return this._update({textBackground:e})}setFont(e){return this._update({font:e})}setAlignment(e){return this._update({alignment:e})}_update(e){const t=(0,i.default)({},this._props);if(null!=e.frame&&(t.frame=e.frame),null!=e.textColor&&(t.textColor=e.textColor),null!=e.textBackground&&(t.textBackground=e.textBackground),null!=e.text&&e.text!==t.text||null!=e.font&&e.font!==t.font){var n,r;t.text=null!==(n=e.text)&&void 0!==n?n:t.text,t.font=null!==(r=e.font)&&void 0!==r?r:t.font,t.lines=(0,f.getLines)(t.text,t.font,18,this._props.maxWidth);const i=g(t.lines,_),a=t.frame.size,o=t.frame.origin,l=new s.default({x:o.x+a.width/2-i.width/2,y:o.y+a.height/2-i.height/2});t.frame=t.frame.update({origin:l,size:i})}if(null!=e.alignment&&(t.alignment=e.alignment),this.font!==t.font||this.text!==t.text||this.alignment!==t.alignment){const e=t.lines.map((e=>e.width));t.backgroundPath=(0,p.generateTextBackgroundPath)(e,t.alignment,{lineVerticalPadding:this.styles.lineVerticalPadding,lineHorizontalPadding:this.styles.lineHorizontalPadding,lineHeight:this.lineHeight,arcSize:this.styles.backgroundBorderRadius})}return(0,a.default)(this._props,t)?this:new h(t)}get lines(){return this._props.lines}get linesOfText(){return this.lines.map((e=>e.text))}get lineWidths(){return this.lines.map((e=>e.width))}get numberOfLines(){return this.lines.length}get fontSize(){return 18}get lineHeight(){return this.fontSize}get styles(){return _}get text(){return this._props.text}get textColor(){return this._props.textColor}get textBackgroundColor(){return this.textColor.isLight()?(0,o.getColorValue)(o.COLORS.BLACK):(0,o.getColorValue)(o.COLORS.WHITE)}get textBackground(){return this._props.textBackground}get font(){return this._props.font}get editable(){return!0}get id(){return this._props.id}get alignment(){return this._props.alignment}get frame(){return this._props.frame}get origin(){return this.frame.origin}get size(){return this.frame.size}get x(){return this.frame.x}get y(){return this.frame.y}get width(){return this.frame.width}get height(){return this.frame.height}get rotation(){return this.frame.rotation}get scale(){return this.frame.scale}get backgroundPath(){return this._props.backgroundPath}}function g(e,t){const n=Math.max(...e.map((e=>e.width)),0)+2*t.lineHorizontalPadding+2*t.layerPadding,r=e.length*(18+2*t.lineVerticalPadding)+2*t.layerPadding;return new c.default({width:n,height:r})}t.TextLayer=h},316241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Color=void 0,t.cleanHex=s,t.compareHex=function(e,t){if(!e||!t)return!1;const n=s(e),r=s(t);if(n===r)return!0;let i=0,a=0;for(;i<e.length;){if(n[i]!==r[a]||n[i]!==r[a+1])return!1;i+=1,a+=2}return!0},t.isValidHex=function(e){if(!e)return!1;const t=s(e);if(3===t.length)return n.test(t);if(6===t.length)return r.test(t);return!1};const n=/^[0-9A-F]{3}$/i,r=/^[0-9A-F]{6}$/i;class i{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(e<0||e>255)throw new RangeError(`red (${e} given) should be >= 0 and <= 255`);if(t<0||t>255)throw new RangeError(`green (${t} given) should be >= 0 and <= 255`);if(n<0||n>255)throw new RangeError(`blue (${n} given) should be >= 0 and <= 255`);if(r<0||r>1)throw new RangeError(`alpha (${r} given) should be >= 0 and <= 1`);this._red=e,this._green=t,this._blue=n,this._alpha=r}static fromHex(e){let t=e.trim().toLowerCase();if(t.length&&"#"===t[0]&&(t=t.substr(1)),3!==t.length&&6!==t.length)throw new RangeError(`hex ${e} does not have 3 or 6 digits`);3===t.length&&(t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`);const n=parseInt(t.substr(0,2),16),r=parseInt(t.substr(2,2),16),a=parseInt(t.substr(4,2),16);if(isNaN(n)||isNaN(r)||isNaN(a))throw new RangeError(`hex ${e} is invalid`);return new i(n,r,a,1)}static _fromHsl(e,t,n){let r,o,s;if(0===t||0===n)r=o=s=n;else{const i=n<.5?n*(1+t):n+t-n*t,l=2*n-i;r=a(l,i,e+1/3),o=a(l,i,e),s=a(l,i,e-1/3)}return new i(Math.round(255*r),Math.round(255*o),Math.round(255*s))}toRgb(){return{red:this._red,green:this._green,blue:this._blue}}toRgba(){return{red:this._red,green:this._green,blue:this._blue,alpha:this._alpha}}toRgbString(){return`rgb(${this._red}, ${this._green}, ${this._blue})`}toRgbaString(){return`rgba(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}toHex(){return`#${o(this._red.toString(16),2)}${o(this._green.toString(16),2)}${o(this._blue.toString(16),2)}`.toUpperCase()}toHsl(){const e=this._red/255,t=this._green/255,n=this._blue/255,r=Math.max(e,t,n),i=Math.min(e,t,n);let a=(r+i)/2,o=(r+i)/2;const s=(r+i)/2;if(r===i)a=o=0;else{const l=r-i;switch(o=s>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{hue:a,saturation:o,lightness:s}}getBackgroundAndTintColors(){const{hue:e,saturation:t,lightness:n}=this.toHsl();let r,a;if(n<.55&&t>.1){let o=e;e>.08&&e<.22&&(o=e<.08+.14?.08:.22),r=i._fromHsl(o,t<.01?0:Math.max(t,.75),Math.min(n,.25)),a=new i(255,255,255,1)}else r=i._fromHsl(e,Math.min(t,.33),Math.max(n,.9)),a=i._fromHsl(e,0===t?0:.4,.2);return{backgroundColor:r,tintColor:a}}withAlpha(e){return new i(this._red,this._green,this._blue,e)}isLight(){return.299*this._red+.587*this._green+.114*this._blue>190}isWhite(){const{lightness:e}=this.toHsl();return e>=.996}equals(e){return this._red===e._red&&this._green===e._green&&this._blue===e._blue&&this._alpha===e._alpha}clone(){return new i(this._red,this._green,this._blue,this._alpha)}toString(){return`(${this._red}, ${this._green}, ${this._blue}, ${this._alpha})`}get red(){return this._red}get green(){return this._green}get blue(){return this._blue}get alpha(){return this._alpha}}function a(e,t,n){let r=n;return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function o(e,t){return e.length>=t?e:"0".repeat(t-e.length)+e}function s(e){let t=e.trim();return"#"===t.substring(0,1)&&(t=t.substring(1).toLowerCase()),t}t.Color=i,i.Black=new i(0,0,0),i.White=new i(255,255,255)},683428:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLayerId=function(e){const t=Math.random().toString(36).substring(2,10);return`${e}-${t}`}},948014:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){let r=1/0,a=1/0,o=0,s=0;e.forEach((e=>{const t=e.x,n=e.y;t<r&&(r=t),t>o&&(o=t),n<a&&(a=n),n>s&&(s=n)}));const l=o-r,c=s-a;return i.default.create({x:r,y:a,width:l,height:c,rotation:t,scale:n})};var i=r(n(124055))},447732:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_DOMINANT_COLOR=void 0,t.getDominantColor=function(e){const t=function(e){const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return null;const r=t.height=e.height,i=t.width=e.width;n.drawImage(e,0,0);try{return n.getImageData(0,0,i,r).data}catch(e){return null}}(e);return t?function(e){let t=0,n=0,i=0,a=0,o=0;for(let r=0;r<e.length;r+=20){const s=e[r+3],l=e[r]*s,c=e[r+1]*s,u=e[r+2]*s;t+=l,n+=c,i+=u,a+=s,o++}return a?new r.Color(Math.round(t/a),Math.round(n/a),Math.round(i/a),Math.round(a/o)/255):new r.Color(0,0,0,0)}(t):i};var r=n(316241);const i=new r.Color(220,220,220);t.DEFAULT_DOMINANT_COLOR=i},331323:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateTextBackgroundPath=function(e,t,n){const a=n.arcSize,o=[],s=[],l=Math.max(...e),c=n.lineHeight+2*n.lineVerticalPadding;e.forEach(((i,a)=>{const u=i+2*n.lineHorizontalPadding;let d=0;switch(t){case r.TextAlignment.LEFT:d=0;break;case r.TextAlignment.CENTER:d=(l-i)/2;break;case r.TextAlignment.RIGHT:d=l-i}const p=a*c;o.push({y:p,x:d}),s.push({y:p,x:d+u}),a===e.length-1&&(o.push({y:p+c,x:d}),s.push({y:p+c,x:d+u}))}));let u=[];for(let{left:e,points:t}of[{left:!0,points:o},{left:!1,points:s}]){let n=t,r=!0;for(;r;){t=n,n=[],r=!1;for(let i=0;i<t.length;i++){const o=t[i];if(0===i)n.push(o);else{n.length>=2&&n[n.length-1].x===n[n.length-2].x&&(n.pop(),r=!0);const t=n[n.length-1];o.x!==t.x&&Math.abs(o.x-t.x)<2*a&&(r=!0,e&&t.x<o.x||!e&&t.x>o.x?o.x=t.x:t.x=o.x),n.push(o)}}}const i=[];for(let e=0;e<n.length;e++){const t=n[e];if(0===e||e===n.length-1){i.push(t);continue}const r=n[e-1];if(t.x!==r.x){const e={x:r.x,y:t.y},n=i.length-1;i.length>=2&&i[n].x===e.x&&i[n].x===i[n-1].x&&i.pop(),i.push(e)}i.push(t)}e||i.reverse(),u=u.concat(i)}return function(e,t){function n(t){return 0===t?e[e.length-1]:e[t-1]}function r(t){return t===e.length-1?e[0]:e[t+1]}const a=[];for(let o=0;o<e.length;o++){const{start:s,end:l,clockwise:c}=i(e[o],n(o),r(o),t),u=o===e.length-1?0:o+1,{start:d}=i(e[u],n(u),r(u),t);0===o&&a.push(`M ${s.x},${s.y}`),a.push(`A ${t},${t} 0 0 ${c?1:0} ${l.x},${l.y}`),a.push(`L ${d.x},${d.y}`)}return a.push("Z"),a.join("\n")}(u,a)};var r=n(39581);function i(e,t,n,r){const i=t.y===e.y,a={y:i?e.y:t.y>e.y?e.y+r:e.y-r,x:i?t.x>e.x?e.x+r:e.x-r:e.x},o=e.y===n.y;return{start:a,end:{y:o?e.y:n.y>e.y?e.y+r:e.y-r,x:o?n.x>e.x?e.x+r:e.x-r:e.x},clockwise:i&&(t.y<n.y&&t.x<n.x||t.x>n.x&&t.y>n.y)||!i&&(t.y<n.y&&t.x>n.x||t.x<n.x&&t.y>n.y)}}},451234:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLines=function(e,t,n,i){const a=[];for(const s of e.split("\n")){if(""===s){a.push({text:"",width:0,words:[]});continue}const e=s.split(" ");let l="",c=0,u=[];for(let s=0;s<e.length;s++){const d=(0!==s?" ":"")+e[s],p=l+d,f=o(p,t,n);if(i>0&&f>i&&c>0)a.push({text:l,width:c,words:u}),l="",c=0,u=[],s--;else{l=p,c=f;for(const e of d.split(r.EmojiUtil.emojiRegex())){if(!e)continue;let i=null;if(r.EmojiUtil.isEmoji(e)){const t=r.EmojiUtil.getGlyphId(e);null!=t&&(i=r.EmojiUtil.getGlyphPath(t,"xlarge").high)}const a=o(e,t,n);u.push({text:e,width:a,emojiPath:i})}}}c>0&&a.push({text:l,width:c,words:u})}return a},t.getTextBounds=function(e,t){const n=`${t}px ${(0,i.getFontStyle)(e).fontFamily}`,r=l.get(n);if(null!=r)return r;const a="ABCDEF",c=Math.round(o(a,e,t)),u=t,d=s().getContext("2d");d.textBaseline="middle",d.font=n,d.fillStyle="red",d.fillText(a,0,u/2);const p=d.getImageData(0,0,c,u).data;let f=1/0,_=1/0,h=1/0;for(let e=0;e<c;e++)for(let t=0;t<u;t++){p[4*(t*c+e)+3]>0&&(_=Math.min(_,t),f=Math.min(f,e),h=Math.min(h,u-t))}d.clearRect(0,0,c,u);const g={top:_,left:f,bottom:h};return l.set(d.font,g),g};var r=n(767247),i=n(39581);let a;function o(e,t,n){const a=s().getContext("2d");a.font=`${n}px ${(0,i.getFontStyle)(t).fontFamily}`;let o=0;for(const t of e.split(r.EmojiUtil.emojiRegex()))r.EmojiUtil.isEmoji(t)?o+=n:o+=a.measureText(t).width;return o}function s(){return null==a&&(a=document.createElement("canvas"),a.width=9999,a.height=99),a}const l=new Map},189248:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,l.useEffect)((()=>{i.Updater.restart(!0).then((()=>{i.Updater.restart()}))}),[]),(0,u.jsxs)(a.Modal,{cover:!0,title:o.default.t(646),children:[(0,u.jsx)("div",{children:o.default.t(645)}),(0,u.jsx)("div",{className:(0,c.default)(d),children:(0,u.jsx)(s.Spinner,{stroke:4,size:40,color:"highlight"})})]})};var i=n(400922),a=n(857224),o=r(n(914296)),s=n(111054),l=n(667294),c=r(n(156720)),u=n(785893);const d={display:"p357zi0d",justifyContent:"ac2vgrno",marginTop:"nylzjxre",marginEnd:"lfum0007",marginBottom:"bvhm1occ",marginStart:"r6x3u63k"}},452665:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(128298),o=n(857224),s=r(n(39770)),l=n(429623),c=n(729424),u=n(548360),d=n(667294),p=r(n(156720)),f=n(785893);const _=(e,t)=>{const n=t=>{var n;t.stopPropagation(),t.preventDefault(),null===(n=e.onCancel)||void 0===n||n.call(e)},r=e.onOK?(0,f.jsx)(s.default,{testid:"popup-controls-ok",type:e.okButtonType?e.okButtonType:"primary",onClick:t=>{var n;t.stopPropagation(),t.preventDefault(),null===(n=e.onOK)||void 0===n||n.call(e)},disabled:e.okDisabled,spinner:!0===e.okSpinner,xstyle:e.buttonStyle,children:null!=e.okText?e.okText:u.fbt._("OK",null,{hk:"2KEeHb"})}):null,d=e.onCancel?(0,f.jsx)(s.default,{testid:"popup-controls-cancel",type:e.onOK?"secondary":"primary",disabled:e.cancelDisabled,onClick:n,xstyle:e.buttonStyle,children:e.cancelText||u.fbt._("Cancel",null,{hk:"H0gNq"})}):null,_=e.extraButtonProps?(0,f.jsx)(h,(0,i.default)({xstyle:e.buttonStyle},e.extraButtonProps)):null,g={escape:e.onCancel?n:()=>{}};let m;return m=_?(0,f.jsxs)(l.FlexColumn,{align:"end",xstyle:e.buttonContainerStyle,children:[(0,f.jsx)("div",{children:d}),(0,f.jsx)("div",{className:(0,p.default)(a.uiMargin.top12),children:_}),(0,f.jsx)("div",{className:(0,p.default)(a.uiMargin.top12),children:r})]}):(0,f.jsxs)("div",{className:(0,p.default)(e.buttonContainerStyle),children:[d,r]}),(0,f.jsx)(c.HotKeys,{handlers:g,ref:t,children:(0,f.jsx)(o.Modal,{actions:m,children:e.children,cover:e.cover,onDragChange:e.onDragChange,onDrop:e.onDrop,type:e.type,title:e.title})})};function h(e){const{primary:t=!1,disabled:n=!1,spinner:r=!1,text:i,onClick:a,xstyle:o}=e;return(0,f.jsx)(s.default,{testid:"popup-controls-extra",type:t?"primary":"secondary",onClick:e=>{e.stopPropagation(),e.preventDefault(),a()},disabled:n,spinner:r,xstyle:o,children:i})}var g=(0,d.forwardRef)(_);t.default=g},408623:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{children:t,cancelText:n,onCancel:r,okText:o,onOK:s}=e;return(0,a.jsx)(i.default,{cover:!0,children:t,cancelText:n,onCancel:r,okText:o,onOK:s})};var i=r(n(452665)),a=n(785893)},831760:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(413959),s=n(781572),l=n(699608),c=n(528237),u=n(765044),d=n(667294),p=n(587550),f=r(n(803409)),_=n(785893);const h=n(76672).Mirrored(["INITIAL_LOAD","CONNECTING","FAKE_FILL","DOWNLOADING","ORGANIZING"]),g=n(76672).Mirrored(["NOT_STARTED","STARTED","PAST_MIN_TIME"]);var m=e=>{let{onReady:t,onLogout:n,initialLoadReady:r}=e;const m=(0,f.default)(),y=(0,d.useRef)(!1),[S,E]=(0,d.useState)(r?l.Stage.CONNECTING:l.Stage.INITIAL_LOAD),[v,T]=(0,d.useState)({INITIAL_LOAD:r?g.PAST_MIN_TIME:g.NOT_STARTED,CONNECTING:g.NOT_STARTED,FAKE_FILL:g.NOT_STARTED,DOWNLOADING:g.NOT_STARTED,ORGANIZING:g.NOT_STARTED}),[C,A]=(0,d.useState)(0),[b,P]=(0,d.useState)(null);(0,p.useListener)(s.Cmd,"offline_progress_update",(()=>{v.CONNECTING===g.PAST_MIN_TIME&&A(c.OfflineMessageHandler.getOfflineDeliveryProgress());const e=c.OfflineMessageHandler.getHasMessagesToDownload();null==b&&null!=e&&P(e)}));const O=(0,d.useCallback)(function(){var e=(0,a.default)((function*(e,t){T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:g.STARTED}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - starts minimum display time`,yield(0,o.delayMs)(t),m.aborted||(T((t=>(0,i.default)((0,i.default)({},t),{},{[e]:g.PAST_MIN_TIME}))),__LOG__(2)`DebouncedLoadingScreen: ${e} - ends minimum display time`)}));return function(){return e.apply(this,arguments)}}(),[m]),{CONNECTING:M,DOWNLOADING:I,ORGANIZING:w,FAKE_FILL:R,INITIAL_LOAD:N}=v;return(0,d.useEffect)((()=>{if(w===g.PAST_MIN_TIME)y.current||(t(),y.current=!0);else if(I===g.PAST_MIN_TIME&&C>=100&&w===g.NOT_STARTED)(0,o.delayMs)(450).then((()=>{m.aborted||(E(l.Stage.ORGANIZING),O(h.ORGANIZING,800))}));else if(M===g.PAST_MIN_TIME&&null!=b&&I===g.NOT_STARTED&&R===g.NOT_STARTED){const e=c.OfflineMessageHandler.getFinishedDownloading();b&&!e?(E(l.Stage.DOWNLOADING),A(c.OfflineMessageHandler.getOfflineDeliveryProgress()),O(h.DOWNLOADING,450)):(A(100),O(h.FAKE_FILL,450).then((()=>{m.aborted||(u.Socket.hasSynced?y.current||(t(),y.current=!0):(E(l.Stage.ORGANIZING),O(h.ORGANIZING,800)))})))}else r&&N===g.PAST_MIN_TIME&&M===g.NOT_STARTED?(E(l.Stage.CONNECTING),O(h.CONNECTING,1500)):N===g.NOT_STARTED&&O(h.INITIAL_LOAD,500)}),[C,t,b,O,m,r,M,I,w,R,N]),(0,_.jsx)(l.LoadingScreen,{stage:S,progress:C,onLogout:n})};t.default=m},894049:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(788950),a=r(n(452665)),o=r(n(914296)),s=n(765044),l=n(548360),c=n(785893);t.default=()=>(0,c.jsx)(a.default,{cover:!0,cancelText:o.default.t(446),onCancel:s.Socket.logout.bind(s.Socket,!0,i.LogoutReason.UserInitiated),okText:o.default.t(424),onOK:s.Socket.poke.bind(s.Socket),children:l.fbt._('The version of WhatsApp on your phone is too old. Please update to the latest version, then click "LOG IN" to continue using WhatsApp.',null,{hk:"2gorpJ"})})},579592:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(667294),a=r(n(156720)),o=r(n(837453)),s=n(785893);const l={position:"lhggkp7q",top:"qq0sjtgm",start:"tkdu00h0",zIndex:"atxxqlz9",width:"ln8gz9je",height:"ppled2lx"};function c(e,t){const{disableFromWithin:n,onDrop:r,onDragChange:c}=e,[u,d]=(0,i.useState)(!1),[p,f]=(0,i.useState)(!1),[_,h]=(0,i.useState)(!1),g=(0,o.default)(p),m=()=>{n&&d(!0)},y=()=>{n&&d(!1)},S=e=>{e.preventDefault(),e.stopPropagation(),p||u||(f(!0),h(!1),function(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}(e))};return(0,i.useEffect)((()=>{null!=g&&g!==p&&c&&c(p,_)}),[_,p,c,g]),(0,i.useImperativeHandle)(t,(()=>({onDragStart:m,onDragEnd:y,onDragOver:S}))),(0,s.jsx)("div",{className:(0,a.default)(l),style:p?{}:{display:"none"},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),p&&(f(!1),h(!1))},onDrop:e=>{e.preventDefault(),e.stopPropagation(),f(!1),h(!0),r&&!u&&r(e)}},"mask")}var u=(0,i.forwardRef)(c);t.default=u},13259:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return(0,p.jsx)(o.default,{cover:!0,cancelText:s.default.t(446),onCancel:f,okText:d.fbt._("UPDATE",null,{hk:"2YdJcK"}),onOK:_,children:d.fbt._("Please update to the latest version of WhatsApp. This version has expired.",null,{hk:"2Gcdji"})})};var i=n(788950),a=n(400922),o=r(n(452665)),s=r(n(914296)),l=r(n(11339)),c=n(748694),u=n(765044),d=n(548360),p=n(785893);function f(){var e;u.Socket.logout(!0,i.LogoutReason.UserInitiated),new l.default.CompanionForceUpgradeUserActionV2({forceUpgradeUserActionV2:l.default.FORCE_UPGRADE_USER_ACTION_TYPE_V2.LOGOUT,forceUpgradeReasonV2:null!==(e=c.PrimaryForceUpgrade.forceUpgradeReason)&&void 0!==e?e:""}).commit()}function _(){var e;new l.default.CompanionForceUpgradeUserActionV2({forceUpgradeUserActionV2:l.default.FORCE_UPGRADE_USER_ACTION_TYPE_V2.UPGRADE,forceUpgradeReasonV2:null!==(e=c.PrimaryForceUpgrade.forceUpgradeReason)&&void 0!==e?e:""}).commit(),a.Updater.update(null,!0,0)}},141455:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DrawerManager=void 0;var i=r(n(876521));class a extends i.default{setDrawerContext(e,t){this.trigger(`update_context_${e}`,t)}openDrawerRight(e,t,n,r,i){this.trigger("open_drawer_right",e,t,n,void 0,r,i)}openDrawerMid(e,t,n,r,i,a){this.trigger("open_drawer_mid",e,t,n,r,i,a)}openDrawerLeft(e,t,n,r,i){this.trigger("open_drawer_left",e,t,n,void 0,r,i)}existsDrawerRight(e){this.trigger("exists_drawer_right",e)}existsDrawerMid(e){this.trigger("exists_drawer_mid",e)}existsDrawerLeft(e){this.trigger("exists_drawer_left",e)}closeDrawerRight(){this.trigger("close_drawer_right")}closeDrawerMid(){this.trigger("close_drawer_mid")}closeDrawerLeft(){this.trigger("close_drawer_left")}}const o=new a;t.DrawerManager=o},914597:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ModalManager=void 0;var i=r(n(876521));class a extends i.default{open(e,t){this.trigger("open_modal",e,t)}close(e){this.trigger("close_modal",e)}openMedia(e,t){this.trigger("open_media",e,t)}closeMedia(){this.trigger("close_media")}}const o=new a;t.ModalManager=o},699608:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Stage=t.LoadingScreen=void 0;var i=r(n(324326)),a=r(n(914296)),o=r(n(39770)),s=r(n(356074)),l=r(n(524161)),c=r(n(294184)),u=n(548360),d=n(667294),p=r(n(859312)),f=n(587550),_=n(785893);const h=n(76672).Mirrored(["INITIAL_LOAD","CONNECTING","DOWNLOADING","ORGANIZING"]);t.Stage=h;const g=e=>{(0,d.useEffect)((()=>{const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const t=(0,p.default)();(0,f.useListener)(a.default,"locale_change",t);const n=e.stage===h.INITIAL_LOAD,r=e.stage===h.CONNECTING,g=e.stage===h.DOWNLOADING,S=e.stage===h.ORGANIZING,E=(0,c.default)(i.default.container,{[i.default.containerFixed]:!e.debug,[i.default.initialLoad]:n,[i.default.connecting]:r,[i.default.downloading]:g,[i.default.organizing]:S,[i.default.web]:!0}),v=(0,c.default)(i.default.graphic,{[i.default.shimmering]:n||S}),T=(0,c.default)(i.default.logout,{[i.default.showWarning]:g}),C=(0,c.default)(i.default.warning,{[i.default.showWarning]:g});let A;switch(e.stage){case h.INITIAL_LOAD:A=a.default.t(875);break;case h.CONNECTING:A=a.default.t(208);break;case h.DOWNLOADING:A=(0,_.jsx)(s.default,{id:437,params:{progress:e.progress}});break;case h.ORGANIZING:A=u.fbt._("Organizing messages",null,{hk:"2ldft"})}return(0,_.jsxs)("div",{className:E,children:[(0,_.jsx)("div",{className:v,children:(0,_.jsx)(m,{})}),(0,_.jsx)("div",{className:i.default.progress,children:(0,_.jsx)(l.default,{value:e.progress,max:100})}),(0,_.jsx)("div",{className:i.default.main,children:A}),(0,_.jsxs)("div",{className:i.default.secondary,children:[(0,_.jsx)(y,{}),"  ",a.default.t(252)]}),null,null!=e.onLogout&&(0,_.jsx)("div",{className:T,children:(0,_.jsx)(o.default,{type:"plain-white",onClick:e.onLogout,children:a.default.t(446)})}),(0,_.jsx)("div",{className:C,children:u.fbt._("Don't close this window. Your messages are downloading.",null,{hk:"23nekH"})})]})},m=()=>(0,_.jsx)("span",{children:(0,_.jsxs)("svg",{width:"250px",height:"52px",viewBox:"0 0 250 52",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,_.jsxs)("g",{className:i.default.dots,children:[(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"65.7636689",cy:"21.1046108",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"81.0791876",cy:"19.3283142",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"96.3947063",cy:"17.7846275",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"111.710225",cy:"17.5274031",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"127.025744",cy:"17.6118619",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"142.341262",cy:"18.4196288",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"157.656781",cy:"19.9893339",r:"3.65625"}),(0,_.jsx)("circle",{fill:"#B6B6B6",cx:"172.9723",cy:"22.0657859",r:"3.65625"})]}),(0,_.jsx)("path",{className:i.default.laptop,d:"M190.14097 4.7518926h48.227869l.281462-.00596781c1.058365-.00288774 2.664865.25185461 2.695721 2.87464716.142823 12.13996425 0 22.28077555 0 34.40910725 0 .06028-.024112.168784-.036168.217008l-16.394805-.0086927c-12.47317.0007215-24.136918.0136044-37.78743-.0033633l-.010915-6.2953341c-.030319-9.5718533-.105914-18.2714581.010915-28.31872515.033356-2.86867935 1.976535-2.91690333 3.013351-2.86867935zm20.097267 4.28597465l-19.256815-.00079524.002426 4.98254029c-.000422 6.5558423-.012657 12.8111695-.002954 19.3619492l.011919 4.9777941h46.536157l.008754-4.9777414c.010547-8.1882109.002637-15.913459.002637-24.3331514l-27.302124-.01059555zM179.195421 44.6572387c.397848-.036168.807752-.024112 1.2056-.024112 9.620684 0 19.241369-.012056 28.862053 0 .132616.4701838.54252 1.6393289 1.036816 1.6393289 3.255119.012056 4.510238 0 7.765357 0 .542519.036168.988591-1.1450331 1.133263-1.6513849 9.910029 0 19.820057.012056 29.730086.012056.084392.012056.265232.036168.349624.048224-.016075.2571945-.016075 1.0085894 0 2.2541846 0 1.4209691-1.193544 1.8201689-1.965128 2.1215688-.421959.1205599-.868031.1326159-1.289991.1928959h-63.560505c-.651024-.072336-1.350272-.108504-1.916904-.4701838-.566631-.2893439-1.000647-.7595278-1.350271-1.2779356v-2.8446419z",fill:"currentColor"}),(0,_.jsx)("path",{className:i.default.logo,d:"M37.7314595,31.1612046 C37.0876293,30.8391042 33.9223475,29.2816062 33.332139,29.0666255 C32.7419305,28.8517683 32.3127104,28.7444016 31.8834903,29.3887258 C31.4542703,30.0332973 30.2204788,31.4835521 29.8447567,31.91339 C29.4692818,32.3428571 29.0936834,32.3968494 28.4499768,32.0745019 C27.8060232,31.7521544 25.7314595,31.0723707 23.272278,28.8787027 C21.3582085,27.171583 20.0661004,25.0632896 19.6905019,24.4185946 C19.315027,23.7741467 19.6505946,23.4257297 19.9729421,23.1046178 C20.2625483,22.8161235 20.6167722,22.352556 20.9386255,21.9767104 C21.2606023,21.6007413 21.3678456,21.3320154 21.5824556,20.9026718 C21.7970657,20.472834 21.6898224,20.0968649 21.528834,19.7746409 C21.3678456,19.452417 20.0801853,16.2831815 19.543722,14.993915 C19.0210965,13.7387491 18.4903166,13.9087567 18.0950733,13.8887413 C17.7199691,13.870085 17.2902548,13.8661313 16.8611583,13.8661313 C16.4319382,13.8661313 15.7343629,14.0272433 15.144278,14.6716911 C14.5540695,15.3163861 12.8908108,16.8740077 12.8908108,20.0429961 C12.8908108,23.2121081 15.1978996,26.2734826 15.5198765,26.7031969 C15.8417297,27.1330348 20.0597992,33.6360772 26.5184865,36.4250193 C28.05461,37.0883707 29.2539305,37.4846023 30.1888494,37.7811274 C31.7312742,38.2713822 33.1348263,38.2021931 34.2440772,38.0363861 C35.4810811,37.8515521 38.0533127,36.478888 38.5898996,34.9750116 C39.1263629,33.470888 39.1263629,32.1818687 38.9653745,31.91339 C38.8045097,31.6447876 38.3752896,31.4835521 37.7314595,31.1612046 M25.9838765,47.2013591 L25.9752278,47.2013591 C22.1322625,47.1998763 18.3629343,46.1674749 15.0745946,44.2160926 L14.2926332,43.7519074 L6.18674906,45.8782394 L8.35027028,37.9751042 L7.84111198,37.1648494 C5.69723552,33.7549343 4.56500386,29.8139923 4.56660833,25.767166 C4.57130502,13.9587954 14.1789652,4.35187645 25.9924016,4.35187645 C31.7128649,4.35385328 37.0902239,6.58458689 41.1338378,10.6327722 C45.1773282,14.680834 47.4028724,20.0618996 47.4007737,25.7843398 C47.3959539,37.5936988 37.7882934,47.2013591 25.9838765,47.2013591 M44.2112742,7.556695 C39.3464092,2.68614672 32.8767258,0.00271814672 25.9836293,0 C11.7809421,0 0.221652509,11.5584247 0.215969112,25.7654363 C0.21411583,30.3069652 1.40058687,34.7397683 3.65553668,38.6475984 L-4.61852778e-14,52 L13.6596757,48.4167413 C17.4233205,50.4695597 21.6607876,51.5516293 25.9733745,51.5531121 L25.9838765,51.5531121 L25.984,51.5531121 C40.1852046,51.5531121 51.7456062,39.9934517 51.7512912,25.7860695 C51.7538842,18.9011274 49.0761392,12.4271197 44.2112742,7.556695",fill:"currentColor"})]})}),y=()=>(0,_.jsx)("span",{children:(0,_.jsx)("svg",{width:"10px",height:"12px",viewBox:"0 0 10 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:(0,_.jsx)("path",{d:"M5.00847986,1.6 C6.38255462,1.6 7.50937014,2.67435859 7.5940156,4.02703389 L7.59911976,4.1906399 L7.599,5.462 L7.75719976,5.46214385 C8.34167974,5.46214385 8.81591972,5.94158383 8.81591972,6.53126381 L8.81591972,9.8834238 C8.81591972,10.4731038 8.34167974,10.9525438 7.75719976,10.9525438 L2.25767996,10.9525438 C1.67527998,10.9525438 1.2,10.4731038 1.2,9.8834238 L1.2,6.53126381 C1.2,5.94158383 1.67423998,5.46214385 2.25767996,5.46214385 L2.416,5.462 L2.41679995,4.1906399 C2.41679995,2.81636129 3.49135449,1.68973395 4.84478101,1.60510326 L5.00847986,1.6 Z M5.00847986,2.84799995 C4.31163824,2.84799995 3.73624912,3.38200845 3.6709675,4.06160439 L3.6647999,4.1906399 L3.663,5.462 L6.35,5.462 L6.35111981,4.1906399 C6.35111981,3.53817142 5.88169076,2.99180999 5.26310845,2.87228506 L5.13749818,2.85416626 L5.00847986,2.84799995 Z",fill:"currentColor"})})}),S=(0,d.memo)(g);t.LoadingScreen=S},907260:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(179436)),a=n(111054),o=n(113923),s=n(548360),l=n(785893);var c=()=>(0,l.jsx)("div",{className:i.default.background,children:(0,l.jsxs)("div",{className:i.default.mainWrapper,children:[(0,l.jsx)(a.Spinner,{size:50,stroke:4,color:"highlight"}),(0,l.jsx)(o.TextDiv,{className:i.default.logoutTitle,size:"32",children:s.fbt._("Logging Out",null,{hk:"1YEOxc"})}),(0,l.jsx)(o.TextDiv,{theme:"muted",children:s.fbt._("Do not close this window",null,{hk:"14ygD4"})})]})});t.default=c},321059:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LongLinkPopup=function(e){const{link:t}=e;return(0,u.jsx)(o.default,{title:c.fbt._("Open in browser",null,{hk:"4nwCde"}),okText:c.fbt._("Open link",null,{hk:"1yYoWm"}),cancelText:c.fbt._("Cancel",null,{hk:"H0gNq"}),onOK:()=>{(0,l.openExternalLink)(t.href),a.ModalManager.close()},onCancel:d,type:s.ModalTheme.LinkPopup,children:(0,u.jsx)("div",{children:t.href})})};var i=n(781572),a=n(914597),o=r(n(452665)),s=n(857224),l=n(912591),c=n(548360),u=n(785893);const d=()=>{a.ModalManager.close(),i.Cmd.closeLongLinkModal(!0)}},857224:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ModalTheme=t.Modal=void 0;var i=r(n(441609)),a=r(n(579592)),o=r(n(317152)),s=r(n(105354)),l=r(n(294184)),c=n(667294),u=n(785893);const d=n(76672).Mirrored(["Box","BoxLarge","Flex","Guide","Tower","Auto","Invite","InviteNew","ColumnButtons","Multiline","Upgrade","Promote","CommandPalette","QuickReplies","StatusV3ViewerList","LinkPopup"]);t.ModalTheme=d;const p=(0,c.forwardRef)(((e,t)=>{const n=(0,c.useRef)(null),r=null!=e.title?(0,u.jsx)("div",{"data-testid":"popup-title",className:o.default.popupTitle,children:e.title}):null,p=e.type===d.StatusV3ViewerList&&e.dimensions?{height:`${e.dimensions.height}px`,width:`${e.dimensions.width}px`}:null,f=(0,l.default)(o.default.popup,{[o.default.popupFlexInvite]:e.type===d.Invite,[o.default.popupFlexInviteNew]:e.type===d.InviteNew,[o.default.popupFlexUpgrade]:e.type===d.Upgrade,[o.default.popupBox]:e.type===d.Box,[o.default.popupBoxLarge]:e.type===d.BoxLarge,[o.default.popupFlex]:e.type===d.Flex,[o.default.popupTower]:e.type===d.Tower,[o.default.popupAuto]:e.type===d.Auto,[o.default.popupColumnButtons]:e.type===d.ColumnButtons,[o.default.popupMultiline]:e.type===d.Multiline,[o.default.popupStatusV3ViewerList]:e.type===d.StatusV3ViewerList,[o.default.popupPromote]:e.type===d.Promote,[o.default.popupCommandPalette]:e.type===d.CommandPalette,[o.default.popupQuickReplies]:e.type===d.QuickReplies}),_=(0,i.default)(e.actions)?null:(0,u.jsx)("div",{className:o.default.popupControls,children:e.actions}),h=(0,l.default)("overlay",o.default.backdrop,{[o.default.backdropCover]:e.cover,[o.default.popupGuide]:e.type===d.Guide,[o.default.showOverStatusV3]:e.type===d.StatusV3ViewerList||e.type===d.LinkPopup}),g=(0,u.jsx)("div",{className:o.default.popupContainer,children:(0,u.jsx)("div",{className:f,"data-animate-modal-popup":!0,style:p,children:(0,u.jsxs)("div",{className:o.default.popupBody,"data-animate-modal-body":!0,children:[r,(0,u.jsx)("div",{"data-testid":"popup-contents",className:o.default.popupContents,children:e.children}),_]})})});return(0,u.jsxs)(s.default,{className:h,onDragOver:e=>{var t;null===(t=n.current)||void 0===t||t.onDragOver(e)},onDragStart:e=>{var t;null===(t=n.current)||void 0===t||t.onDragStart(e)},onDragEnd:e=>{var t;null===(t=n.current)||void 0===t||t.onDragEnd(e)},ref:t,"data-animate-modal-backdrop":!0,children:[e.onDrop&&(0,u.jsx)(a.default,{ref:n,disableFromWithin:!0,onDragChange:e.onDragChange,onDrop:e.onDrop}),g]})}));t.Modal=p,p.displayName="Modal"},540477:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=void 0,t.ModalManagerComponent=function(e){const{type:t,contextMenuRef:n}=e,r=(0,f.useRef)(null),[E,v]=(0,f.useState)(void 0),[T,C]=(0,f.useState)(null),[A,b]=(0,f.useState)(m),[P,O]=(0,f.useState)(void 0),[M,I]=(0,f.useState)(!1),w=()=>{if(!r.current)return;const e=r.current.getNode();e&&!e.contains(document.activeElement)&&o.default.focus(e)},R=()=>{if(!r.current)return;const e=r.current.getNode();e&&o.default.focus(e)},N=e=>{(e=>{const t=e.relatedTarget,r=null==n?void 0:n.current,i=!!r&&r.isOpen();return t instanceof HTMLElement&&!e.currentTarget.contains(t)&&!i})(e)&&w()},L=e=>{E&&(v(void 0),C(null),e&&b(e))},D=e=>{e===T&&L()};let k;(0,h.useListener)(s.ModalManager,`open_${t}`,(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.transition||m;const{uim:i,blockClose:o}=n;E&&(r=y);const s=(0,a.default)(`ModalManager${t}`);let l=e;t===S&&(l=(0,f.cloneElement)(e,{requestFocus:R})),_.default.unstable_batchedUpdates((()=>{v(l),C(s),b(r),O(i),I(null!=o&&o)}))})),(0,h.useListener)(s.ModalManager,`close_${t}`,L),E&&(k=(0,g.jsx)(d.UIE,{displayName:`Modal${(0,i.default)(e.type)}`,escapable:!M,ref:r,requestFocus:w,requestDismiss:D.bind(null,T),children:e.type===S?(0,g.jsx)(u.default,{onBlur:N,children:E}):(0,g.jsx)(c.RotateFocus,{children:E})},T));return(0,g.jsx)(p.default.Consumer,{children:e=>(0,g.jsx)(p.default.Provider,{value:P||e,children:(0,g.jsx)(l.default,{transitionName:A,children:k})})})},t.ModalType=void 0;var i=r(n(711700)),a=r(n(873955)),o=r(n(352013)),s=n(914597),l=r(n(540436)),c=n(387956),u=r(n(422179)),d=n(718644),p=r(n(502773)),f=n(667294),_=r(n(973935)),h=n(587550),g=n(785893);const m="modal",y="none",S="modal";t.ModalType=S;t.MediaType="media"},322476:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MUTE_ALWAYS_EXPIRATION_SENTINEL=void 0,t.calculateMuteExpiration=function(e){if(e===Number.POSITIVE_INFINITY)return-1;return 60*e*60+(0,o.default)().unix()},t.getAllMuteDurations=s,t.getDefaultMuteDuration=function(){return s()[0].duration};var i=n(964551),a=n(548360),o=r(n(730381));function s(e){return e?[{label:a.fbt._("1 Hour",null,{hk:"2z3e4J"}),duration:1},{label:a.fbt._("8 Hours",null,{hk:"3orTzw"}),duration:8},{label:a.fbt._("1 Day",null,{hk:"11RKz3"}),duration:24},{label:a.fbt._("1 Week",null,{hk:"23fAj3"}),duration:168}]:[{label:a.fbt._("8 Hours",null,{hk:"3orTzw"}),duration:8},{label:a.fbt._("1 Week",null,{hk:"23fAj3"}),duration:168},i.ServerProps.muteAlways?{label:a.fbt._("Always",null,{hk:"26Zr18"}),duration:Number.POSITIVE_INFINITY}:{label:a.fbt._("1 Year",null,{hk:"45Hta7"}),duration:8760}]}t.MUTE_ALWAYS_EXPIRATION_SENTINEL=-1},896753:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(857224),a=r(n(914296)),o=n(548360),s=n(785893);t.default=()=>(0,s.jsx)(i.Modal,{title:o.fbt._("Computer not connected",null,{hk:"300jSy"}),cover:!0,children:a.default.t(433)})},540626:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(221310),a=r(n(452665)),o=r(n(914296)),s=n(912591),l=n(548360),c=n(785893);function u(){(0,s.openExternalLink)((0,i.getCannotConnectFaqUrl)())}t.default=()=>(0,c.jsx)(a.default,{cover:!0,title:o.default.t(168),okText:o.default.t(397),onOK:u,children:l.fbt._("Your computer is connected to a network that prevents WhatsApp from working correctly",null,{hk:"GhGFR"})})},357050:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{progress:t}=e,n=(0,g.default)(),[r,v]=(0,h.useState)(!1),[T,C]=(0,m.default)(n,1e3),A=()=>{(0,u.openExternalLink)((0,a.getCannotConnectFaqUrl)())},[b]=(0,S.useTimeout)((()=>{v(!0),T()}),3e3,{immediate:!0}),P=()=>{C(),v(!1),b()},O=()=>{__LOG__(2)`Startup: user selected logout`,p.Socket.logout()};let M,I,w,R;switch((0,h.useEffect)((()=>{const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]),(0,y.useListener)(d.Stream,"change:displayInfo",n),(0,y.useListener)(p.Socket,"change:retryTimestamp",P),d.Stream.displayInfo){case d.StreamInfo.OPENING:M=c.default.t(209),I=c.default.t(433),R=O;break;case d.StreamInfo.PAIRING:case d.StreamInfo.TIMEOUT:M=c.default.t(623),I=(0,E.jsxs)("span",{children:[f.fbt._("Make sure your phone has an active Internet connection.",null,{hk:"4u0X1o"}),(0,E.jsx)("span",{className:l.default.action,onClick:A,role:"button",children:c.default.t(397)})]}),R=O;break;case d.StreamInfo.SYNCING:case d.StreamInfo.CONNECTING:return(0,E.jsx)(s.LoadingScreen,{progress:t,stage:s.Stage.INITIAL_LOAD});default:return d.Stream.mode===d.StreamMode.MAIN?(0,E.jsx)(s.LoadingScreen,{progress:t,stage:s.Stage.INITIAL_LOAD}):null}const N=r;if(N){const e=p.Socket.retryTimestamp-Date.now();if(isNaN(e)||e<1)w=c.default.t(564),(0,i.default)((()=>p.Socket.poke()));else if(e<6e4){const t=Math.ceil(e/1e3);w=c.default.t(566,{number:t,_plural:t})}else w=c.default.t(565,{duration:_.default.duration(e).humanize()})}else w=c.default.t(564);return(0,E.jsxs)(o.default,{cover:!0,title:M,okText:c.default.t(563),onOK:N?()=>{p.Socket.poke(),P()}:()=>{},cancelText:R?c.default.t(446):null,onCancel:R,children:[w,(0,E.jsx)("hr",{className:l.default.divider}),(0,E.jsx)("div",{className:l.default.textTip,children:I})]})};var i=r(n(781629)),a=n(221310),o=r(n(452665)),s=n(699608),l=r(n(39326)),c=r(n(914296)),u=n(912591),d=n(608080),p=n(765044),f=n(548360),_=r(n(730381)),h=n(667294),g=r(n(859312)),m=r(n(970393)),y=n(587550),S=n(346428),E=n(785893)},137538:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,d.default)();let n,r;(0,f.useListener)(l.Stream,"change:displayInfo",t);const[g]=(0,p.default)(t,1e3),[m]=(0,_.useTimeout)(g,6e3);let y=l.Stream.displayInfo;(0,u.useEffect)((()=>{m();const e=document.getElementById("initial_startup");(null==e?void 0:e.parentNode)&&e.parentNode.removeChild(e)}),[]);const S=()=>{__LOG__(2)`Startup: user selected logout`,c.Socket.logout()};switch(y){case l.StreamInfo.OPENING:case l.StreamInfo.PAIRING:case l.StreamInfo.TIMEOUT:n=s.default.t(209),r=s.default.t(433);break;case l.StreamInfo.SYNCING:case l.StreamInfo.CONNECTING:return(0,h.jsx)(a.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:S});case l.StreamInfo.SCREEN_LOCKED:default:return l.Stream.mode===l.StreamMode.MAIN?(0,h.jsx)(a.default,{initialLoadReady:e.initialLoadReady,onReady:e.onReady,onLogout:S}):null}return(0,h.jsxs)(i.default,{cover:!0,title:n,cancelText:s.default.t(446),onCancel:S,children:[(0,h.jsx)("hr",{className:o.default.divider}),(0,h.jsx)("div",{className:o.default.textTip,children:r})]})};n(134898),n(711597);var i=r(n(452665)),a=r(n(831760)),o=r(n(757525)),s=r(n(914296)),l=n(608080),c=n(765044),u=n(667294),d=r(n(859312)),p=r(n(970393)),f=n(587550),_=n(346428),h=n(785893)},482791:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{link:t}=e,{suspiciousCharacters:n,domain:r,href:g}=t,m=r.split("."),y=m.map(((e,t)=>{let r=!1;const i=e.split("").map(((e,i)=>{const a=n&&n.has(e);r=a||r;const o=a?c.default.suspiciousCharacter:void 0;return(0,_.jsx)("span",{className:o,children:e},`${t}-${i}-${e}`)})),a=r?c.default.suspiciousHostname:void 0;return(0,_.jsxs)(f.Fragment,{children:[(0,_.jsx)("span",{className:a,children:i}),t+1!==m.length?(0,_.jsx)("span",{children:"."}):null]},`${t}-${e}`)})),[S,E]=g.split(r);return(0,_.jsxs)(s.default,{title:p.fbt._("Suspicious link",null,{hk:"J2Yam"}),okText:p.fbt._("Cancel",null,{hk:"H0gNq"}),cancelText:p.fbt._("Open link",null,{hk:"1yYoWm"}),onOK:h,onCancel:()=>{const{href:e}=t;(0,d.openExternalLink)(e),o.ModalManager.close(),i.Cmd.closeLongLinkModal(!0)},type:l.ModalTheme.LinkPopup,children:[(0,_.jsxs)("div",{className:c.default.explanation,children:[p.fbt._("This link contains unusual characters. It may be trying to appear as another site.",null,{hk:"4ybh1b"})," ",(0,_.jsx)(d.ExternalLink,{href:(0,a.getSuspiciousLinkFaqUrl)(),children:u.default.t(397)})]}),(0,_.jsxs)("div",{className:c.default.url,children:[S,y,E]})]})};var i=n(781572),a=n(221310),o=n(914597),s=r(n(452665)),l=n(857224),c=r(n(143047)),u=r(n(914296)),d=n(912591),p=n(548360),f=n(667294),_=n(785893);const h=()=>{o.ModalManager.close(),i.Cmd.closeLongLinkModal(!0)}},168481:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,l.jsxs)(o.default,{cover:!0,cancelText:a.default.t(446),onCancel:s.Socket.logout.bind(s.Socket,!0,i.LogoutReason.UserInitiated),okText:a.default.t(424),onOK:s.Socket.poke.bind(s.Socket),children:[e.description," ",e.children]})};var i=n(788950),a=r(n(914296)),o=r(n(452665)),s=n(765044),l=n(785893)},958955:(e,t,n)=>{"use strict";t.TG=function(e){const{promise:t,reason:n}=e,a=i.Logger.logUncaughtError(n,t);if(!u(n))return;r.upload({reason:a,hasTaggedMessage:!0})},t.HC=function(e,t,a,o,d){if(function(e){const t=[...s];return t.push(...l),t.some((t=>{let{partialUserAgent:n,partialMsg:r}=t;return c.includes(n)&&String(e).includes(r)}))}(e))return __LOG__(3)`Ignored Error: ${e||(d||"").toString()}`,!0;try{const{UIM:e}=n(789618);e.pprint(!0)}catch(e){__LOG__(3)`UIM Print Failed!`}const p=t.split("?")[0];let f;f=p&&"number"==typeof a?` (${p}:${a}:${o})`:p?` (${p})`:"";if("Script error."===e&&!d)return i.Logger.logUncaughtError(`${f} ${e}`),p&&r.upload({reason:"script-error",hasTaggedMessage:!0}),!1;const _=d instanceof Error&&d.stack?d:`${e||`Given: ${String(d)}`}`,h=i.Logger.logUncaughtError(_);if(!u(d))return!0;return r.upload({reason:h,hasTaggedMessage:!0}),!0};var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(386374)),i=n(739948),a=n(435232);function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}const s=[{partialUserAgent:"Chrome",partialMsg:"ResizeObserver loop limit exceeded"}],l=[{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'style' of null"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"Unexpected token :"},{partialUserAgent:"Firefox/52.0,,Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.4) Gecko/20100101 Firefox/52.0",partialMsg:"Cannot read property 'style' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.1.1 Safari/605.1.15",partialMsg:"is not an object"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read property 'getElementsByTagName' of undefined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36",partialMsg:"Can't find variable: dismissKeyboard"},{partialUserAgent:"Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.78 Safari/537.36",partialMsg:"ReferenceError: None is not defined"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read properties of null (reading 'style')"},{partialUserAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36",partialMsg:"Cannot read properties of undefined (reading 'getElementsByTagName')"}],c=window.navigator.userAgent;function u(e){return!(e instanceof a.DbOnLogoutAbort)}},127838:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getIsTabActive=function(){return s},t.isAnotherTabActive=function(){return l.apply(this,arguments)},t.setTabActive=function(){s=!0};var i=r(n(348926)),a=r(n(125613)),o=r(n(364237));let s=!1;function l(){return(l=(0,i.default)((function*(){const e=navigator.serviceWorker;if(null==e?void 0:e.controller)try{return(yield a.default.request(e.controller,o.default.ACTIVE_TAB)).some((e=>!0===e.isActive))}catch(e){return __LOG__(4,void 0,new Error,!0)`error: ${e}`,SEND_LOGS("ACTIVE_TAB service worker call failed"),!1}return!1}))).apply(this,arguments)}},597628:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeContext=t.THEME_ASSETS=void 0,t.applyThemeToUI=c,t.getTheme=function(){var e;if((0,i.getSystemThemeMode)())return a.default.getCurrentTheme();return null!==(e=(0,i.getTheme)())&&void 0!==e?e:"light"},t.setTheme=l;var i=n(555452),a=r(n(603137)),o=n(667294);const s={light:[{id:"bg-chat-light",selectors:["[data-asset-chat-background-light]"],low:{default:n(833557)},high:{default:n(833557)}},{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:n(629347)},high:{default:n(629347)}},{id:"intro-connection-light",selectors:["[data-asset-intro-image-light]"],low:{default:n(705250)},high:{default:n(412891)}}],dark:[{id:"bg-chat-dark",selectors:["[data-asset-chat-background-dark]"],low:{default:n(629347)},high:{default:n(629347)}},{id:"intro-connection-dark",selectors:["[data-asset-intro-image-dark]"],low:{default:n(935729)},high:{default:n(474548)}}]};function l(e){(0,i.setTheme)(e),c(e)}function c(e){const t=document.body;null==t||t.classList.toggle("dark","dark"===e)}t.THEME_ASSETS=s;const u={theme:a.default.getCurrentTheme(),systemThemeMode:!0,setTheme:l,setSystemThemeMode:i.setSystemThemeMode},d=(0,o.createContext)(u);t.ThemeContext=d},400922:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterImpl=t.Updater=void 0;var i=r(n(485074)),a=r(n(379264)),o=n(656797),s=n(826066),l=r(n(8425));class c extends o.UpdaterBase{update(e,t,r){__LOG__(2)`AppUpdate:update current: ${String(this.activeVersion)} latest: ${String(e)}`;const a=++this.latestUpdateIteration,l=null==e?void 0:new s.Version(e);this.clearHardExpiration();const c=n(608080).Stream;return"number"==typeof r&&(this.hardExpirationTimer=i.default.setLocalTimeout((()=>(c.clientExpired=!0,this._update(l).then((e=>{e===o.DownloadState.UPDATE_DOWNLOADED&&this.restart()})))),Date.now()+r)),this.updateInProgress=Promise.resolve(this.updateInProgress).then((()=>this._update(l))).then((e=>{this.updateInProgress=void 0;const n=a!==this.latestUpdateIteration,i=e===o.DownloadState.ERROR,s=e===o.DownloadState.UPDATE_NOT_AVAILABLE;return n||i||s||(!0!==t&&"number"!=typeof r||(c.needsUpdate=!0),"number"==typeof r&&this.listenToAndRun(c,"change:couldForce",(()=>{c.couldForce&&this.restart()}))),e})),this.updateInProgress}_update(e){if(!this.activeVersion.equals(e)&&(null===l.default||void 0===l.default?void 0:l.default.alive))return this._swUpdate();const t=this.activeVersion.equals(e)?o.DownloadState.UPDATE_NOT_AVAILABLE:o.DownloadState.UPDATE_DOWNLOADED;return Promise.resolve(t)}killServiceWorker(){if(!(null===l.default||void 0===l.default?void 0:l.default.alive))return Promise.resolve();const e=navigator.serviceWorker;return e?(__LOG__(2)`Killing service worker`,e.ready.then((e=>e.unregister())).then((e=>{__LOG__(2)`Service worker unregistration status: ${String(e)}`}))):Promise.resolve()}_swUpdate(){{const e=navigator.serviceWorker;if(e)return e.ready.then((t=>new Promise((n=>{function r(e){a(),__LOG__(3)`Unable to update service worker to version. Error: ${String(e)}`}function i(){a(),n(o.DownloadState.UPDATE_DOWNLOADED)}function a(){e.removeEventListener("error",r),e.removeEventListener("controllerchange",i)}e.addEventListener("error",r),e.addEventListener("controllerchange",i),t.update().then((()=>{t.installing||n(o.DownloadState.UPDATE_NOT_AVAILABLE)})).catch((e=>{r(e),n(o.DownloadState.ERROR)}))})))).catch((e=>(__LOG__(3)`Unable to update serviceworker, error: ${e}`,o.DownloadState.ERROR)))}return Promise.resolve(o.DownloadState.ERROR)}restart(e){return!0===e?this.update(void 0,!0,0):(a.default.hardRefresh(void 0,!1),Promise.resolve(o.DownloadState.UPDATE_DOWNLOADED))}}t.UpdaterImpl=c;const u=new c;t.Updater=u},656797:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UpdaterBase=t.DownloadState=void 0;var i=n(640265),a=r(n(485074)),o=n(40234),s=r(n(876521)),l=r(n(493587)),c=n(826066),u=r(n(111554));const d=n(76672).Mirrored(["UPDATE_DOWNLOADED","UPDATE_NOT_AVAILABLE","ERROR"]);t.DownloadState=d;class p extends s.default{constructor(){super(),this._forceUpdateOnTakeOver=!1,this.latestUpdateIteration=0,this.activeVersion=new c.Version("2.2228.14"),u.default.onVersionChange((()=>this.setForceUpdateOnTakeOver()))}setForceUpdateOnTakeOver(){this._forceUpdateOnTakeOver=!0}shouldForceUpdateOnTakeOver(){const e=this._forceUpdateOnTakeOver;return this._forceUpdateOnTakeOver=!1,!!e}isExpired(){return o.Clock.globalUnixTime()>Number(l.default)}clearHardExpiration(){this.hardExpirationTimer&&(a.default.clearTimeout(this.hardExpirationTimer),this.hardExpirationTimer=void 0),this.stopListening(n(608080).Stream,"change:couldForce")}update(){throw new i.UnimplementedMethod("Updater::update")}restart(){throw new i.UnimplementedMethod("Updater::restart")}manualDownload(){throw new i.UnimplementedMethod("Updater::manualDownload")}killServiceWorker(){throw new i.UnimplementedMethod("Updater::killServiceWorker")}}t.UpdaterBase=p},493587:(e,t)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r=document.getElementById("hard_expire_time");let i=null==r||null===(n=r.dataset)||void 0===n?void 0:n.time;i||(__LOG__(3)`hard expire time not found on dom, using fallback of 1572566400 (2019/11/1)`,i="1572566400");var a=i;t.default=a},279101:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=void 0,t.checkForUpdates=function(){return _.apply(this,arguments)},t.updatePoll=t.hasUpdate=void 0;var i=r(n(348926)),a=r(n(628195)),o=r(n(506631)),s=n(400922),l=n(826066),c=n(642448);const u="https://web.whatsapp.com/check-update",d={WEB:"web",DARWIN:"darwin",WIN32:"win32",MACSTORE:"darwin-store",WINSTORE:"win32-store",DARWIN_BETA:"darwin-beta",WIN32_BETA:"win32-beta"};t.PLATFORMS=d;const p=e=>[e.isBroken,e.isBelowSoft,e.isBelowHard,e.beta].some(Boolean);t.hasUpdate=p;const f=new a.default({name:"updater",interval:1800,restingInterval:3600,randomIntervalExtension:180});function _(){return(_=(0,i.default)((function*(){const e=d[c.WAM_PLATFORM],t=l.SANITIZED_VERSION_STR;let r=null;if(!navigator.onLine)return __LOG__(2)`Update check skipped because user is offline.`,!1;try{const n=yield(0,o.default)(`${u}?version=${t}&platform=${e}`);if(!n.ok)throw Error(n.statusText);r=yield n.json();const i=(new Date).toISOString();__LOG__(2)`Updater: Checked at ${i} ${JSON.stringify({response:r,version:t})}`}catch(e){__LOG__(4,void 0,new Error)`Updater: Version check failed`}if(!r||!p(r))return!1;const{isBelowHard:i,isBelowSoft:a,hardUpdateTime:f,currentVersion:_,isBroken:h,beta:g}=r;__LOG__(2)`Updater: App will update. ${JSON.stringify({response:r,version:t})}`;const m=i?f:null;return"web"===e?s.Updater.update(_,a,m):h?n(608080).Stream.needsManualDownload=!0:s.Updater.update(void 0,a,m,g),!0}))).apply(this,arguments)}t.updatePoll=f},826066:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Version=t.SANITIZED_VERSION_STR=void 0,t.sanitizeVersionStr=o;var r=n(640265);class i extends((0,r.customError)("InvalidVersion")){}class a{constructor(e){const t=e.split(".");if(3!==t.length)throw new i("Version format does not contain 3 numbers.");if(this.primary=Number.parseInt(t[0],10),this.secondary=Number.parseInt(t[1],10),this.tertiary=Number.parseInt(t[2],10),Number.isNaN(this.primary)||Number.isNaN(this.secondary)||Number.isNaN(this.tertiary))throw new i("Version contains a non-parseable string.")}lt(e){let t=e;return"string"==typeof t&&(t=new a(t)),this.primary<t.primary||this.primary===t.primary&&this.secondary<t.secondary||this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary<t.tertiary}equals(e){let t=e;return!!t&&("string"==typeof t&&(t=new a(t)),this.primary===t.primary&&this.secondary===t.secondary&&this.tertiary===t.tertiary)}toString(){return`${this.primary}.${this.secondary}.${this.tertiary}`}}function o(e){return e.replace(/\.[di]$/,"")}t.Version=a;const s=o("2.2228.14");t.SANITIZED_VERSION_STR=s},472117:(e,t,n)=>{"use strict";var r=n(595318);t.Z=void 0;var i=r(n(348926)),a=n(640265),o=n(450796),s=n(638284),l=r(n(485074)),c=r(n(282080)),u=n(555452),d=n(491442),p=r(n(10151)),f=n(765044);const _=6e5,h="init",g="ping",m="pong",y="local-takeover";var S=new class{init(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,i.default)((function*(){const n=t+1;if(n>3)return!0;const r=(0,u.getNoTakeover)();(0,u.setNoTakeover)(),f.Socket.preload();if(yield e._pingForOtherLocalSession())return e._updateMutex(),yield(0,p.default)(!r),!1;if(r)return!0;throw n}))()}takeoverLocal(e){return(0,u.getMutex)()?((0,u.setMutex)(y),(0,s.promiseTimeout)((0,c.default)(window,"storage",u.takeoverFilter),3e4,"takeoverLocalTimeout").then((t=>{const n=(0,u.parseTakeover)(t.newValue);return d.userPreferencesStore.getRememberMe()||d.userPreferencesStore.setAllKeyValues(n),f.Socket.mustExitLoop=!1,(0,u.removeMutex)(),this.init(e)})).catch((0,o.filteredCatch)(a.TimeoutError,(()=>(__LOG__(3)`app:takeoverLocal timeout`,f.Socket.mustExitLoop=!1,(0,u.removeMutex)(),this.init(e)))))):this.init(e)}unloadMutex(){const e=(0,u.getMutex)();e&&this._ourMutex&&e.includes(this._ourMutex)&&(0,u.removeMutex)()}storagePong(e){if(!(0,u.mutexFilter)(e))return;const t=(0,u.parseMutex)(e.newValue);return t?t===y?(this._clearMutexTimer(),f.Socket.exitLoop(),(0,u.localTakeoverSuccess)(),!0):void(0===t.indexOf(g)&&(0,u.setMutex)(m+Math.random())):void 0}_clearMutexTimer(){this._updateMutexTimerID&&l.default.clearTimeout(this._updateMutexTimerID)}_updateMutex(){this._clearMutexTimer();const e=Date.now();(0,u.setMutex)(this._ourMutex=h+"_"+e),this._updateMutexTimerID=l.default.setLocalTimeout(this._updateMutex.bind(this),e+_)}_pingForOtherLocalSession(){let e=(0,u.getMutex)();if(e){e+="";let t=1e4;if(e.indexOf("_")>0){const n=e.split("."),r=parseInt(n[n.length-1],10);if(Number.isFinite(r)){r<Date.now()-9e5&&(__LOG__(2)`app:_pingForOtherLocalSession stale mutex`,t=1e3)}}const n=(0,s.promiseTimeout)((0,c.default)(window,"storage",u.mutexFilter),t,"waitForOtherLocalSessionTimeout").then((()=>!1)).catch((0,o.filteredCatch)(a.TimeoutError,(function(){return __LOG__(3)`app:_pingForOtherLocalSession mutex timeout`,!0})));return(0,u.setMutex)(g+Math.random()),n}return Promise.resolve(!0)}};t.Z=S},781572:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Revoke=t.CmdImpl=t.Cmd=t.APP_STATE_SYNC_COMPLETED=void 0;var a=i(n(348926)),o=i(n(81109)),s=i(n(23279)),l=n(389385),c=n(88555),u=n(698159),d=i(n(876521)),p=n(438184),f=(i(n(11339)),n(118146)),_=i(n(441143));const h=n(76672).Mirrored(["Sender","Admin"]);t.Revoke=h;t.APP_STATE_SYNC_COMPLETED="app_state_sync_completed";class g extends d.default{constructor(){super(...arguments),this.isMainLoaded=!1,this.uiBusy=0,this.isMainStreamReadyMd=!1,this._clearUiBusy=(0,s.default)((()=>{this.uiBusy&&(__LOG__(2)`cmd:clearUIBusy uibusy timeout`,this.uiBusy=0,this._triggerIdleEvent())}),1e3,{maxWait:5e3}),this._triggerIdleEvent=function(e){let t;const n=()=>{if(t)return;t=new r;const{signal:n}=t;(0,u.documentFlushed)({signal:n}).then((()=>{n.aborted||(t=null,e())}),(e=>{if(e.name!==l.ABORT_ERROR)throw e}))};return n.cancel=()=>{t&&(t.abort(),t=null)},n}((()=>{(0,_.default)(0===this.uiBusy,`ui_idle triggered when uiBusy is ${this.uiBusy}`),0===this.uiBusy&&(this._clearUiBusy.cancel(),this.trigger("ui_idle"))}))}mainLoaded(){this.isMainLoaded=!0,this.trigger("main_loaded")}incrementProgress(){__LOG__(2)`Cmd: incrementProgress`,this.trigger("increment_progress")}initialLoadReady(){__LOG__(2)`Cmd: initialLoadReady`,this.trigger("initial_load_ready")}logSocketSummary(){this.trigger("log_socket_summary")}muteAll(e,t,n,r){this.trigger("mute_all",e,t,n,r)}muteAllCall(e,t){this.trigger("mute_all_call",e,t)}muteChat(e,t){this.trigger("mute_chat",(0,f.unproxy)(e),t)}muteChats(e,t,n){const r=e.map((e=>(0,f.unproxy)(e)));this.trigger("mute_chats",r,t,n)}deleteOrExitChat(e,t){this.trigger("delete_or_exit_chat",(0,f.unproxy)(e),t)}clearChat(e,t){this.trigger("clear_chat",(0,f.unproxy)(e),t)}archiveChat(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.trigger("archive_chat",(0,f.unproxy)(e),t,n)}pinChat(e,t){this.trigger("pin_chat",(0,f.unproxy)(e),t)}pinChats(e,t){const n=e.map((e=>(0,f.unproxy)(e)));this.trigger("pin_chats",n,t)}markChatUnread(e,t){this.trigger("mark_chat_unread",(0,f.unproxy)(e),t)}msgInfoDrawer(e){this.trigger("msg_info_drawer",(0,f.unproxy)(e))}chatSearch(e){this.trigger("chat_search",(0,f.unproxy)(e))}chatInfoDrawer(e,t,n){this.trigger("chat_info_drawer",(0,f.unproxy)(e),t,n)}attachMediaDrawer(e){const t=(0,o.default)((0,o.default)({},e),{},{chat:(0,f.unproxy)(e.chat)});this.trigger("attach_media_drawer",t)}attachProduct(e){this.trigger("attach_product",e)}verificationDrawer(e){this.trigger("verification_drawer",e)}liveLocationDrawer(e,t){this.trigger("live_location_drawer",e,t)}expiredLocationDrawer(e){this.trigger("expired_location_drawer",e)}mediaViewerModal(e){const{msg:t,getZoomNode:n,currentTime:r,highlightedMsgIds:i}=e;this.trigger("media_viewer_modal",{msg:t,getZoomNode:n,currentTime:r,highlightedMsgIds:i})}openMediaViewerForAlbumMedia(e){this.trigger("open_media_viewer_for_album_media",e)}productImageViewerModal(e,t){this.trigger("product_image_viewer_modal",e,t)}ephemeralDrawer(e,t,n){this.trigger("ephemeral_drawer",e,t,n)}communityHome(e,t){this.trigger("open_community_home",e,t)}communityHomeManageGroups(e){this.trigger("open_community_home_manage_groups",e)}communityAddNewGroup(e,t){this.trigger("open_community_add_new_group",e,t)}sendStarMsgs(e,t,n,r){this.trigger("send_star_msgs",(0,f.unproxy)(e),t,n,r)}sendUnstarMsgs(e,t,n,r){this.trigger("send_unstar_msgs",(0,f.unproxy)(e),t,n,r)}sendDeleteMsgs(e,t,n,r,i){this.trigger("send_delete_msgs",(0,f.unproxy)(e),t,n,r,i)}sendRevokeMsgs(e,t,n){this.trigger("send_revoke_msgs",(0,f.unproxy)(e),t,n)}addFavoriteSticker(e){this.trigger("add_favorite_sticker",e)}removeFavoriteSticker(e){this.trigger("remove_favorite_sticker",e)}_openChat(e,t){const n=(0,f.unproxy)(e);return new Promise((e=>{this.trigger("open_chat",n,t,e)})).catch((e=>{throw __LOG__(2)`Unexpected openChat error: ${String(e)}`,e}))}openChatAt(e,t){var n=this;const r=(0,f.unproxy)(e);if(!t)return this.openChatBottom(r);this.setUiBusy(!0,"open_chat_at");const i=this._openChat(r,t).then(function(){var e=(0,a.default)((function*(e){let r,i;const a=null==t.enableAnimation||t.enableAnimation;if(e)if(e.wasVisible)r=()=>n._scrollToFocusedMsg({pos:"offset",offset:e.offset}),i=()=>n._scrollToFocusedMsg({pos:"center",animate:a,duration:400,easing:[.7,0,.3,1]});else switch(r=()=>n._scrollToFocusedMsg({pos:e.alignAt}),e.alignAt){case"top":case"bottom":i=()=>n._scrollToFocusedMsg({pos:"center",animate:a,duration:400,easing:[.88,.64,.13,.99]});break;case"center":default:i=()=>Promise.resolve()}else r=()=>n._scrollToFocusedMsg({pos:"center"}),i=()=>Promise.resolve();return yield r(),i()}));return function(){return e.apply(this,arguments)}}()).then((()=>{this.flashFocusedMsg(t.highlightMentionMsg)})).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return i.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),i}openChatFromUnread(e){const t=(0,f.unproxy)(e);let n;if(t.unreadMsgAnchor&&(n={collection:t.unreadMsgAnchor.msgChunk,promise:Promise.resolve(),msg:t.unreadMsgAnchor,isUnreadDivider:t.shouldShowUnreadDivider}),n||t.unreadCount>0){this.setUiBusy(!0,"open_from_unread");const e=this._openChat(t,n).then((()=>this._scrollToFocusedMsg({pos:"top",offset:-120}))).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return e.finally((()=>{this.setUiBusy(!1,"open_from_unread")})),e}return this.openChatBottom(t)}openChatBottom(e){const t=(0,f.unproxy)(e);let n;this.setUiBusy(!0,"open_bottom"),t.msgs.length>0&&(n={collection:t.msgs,msg:t.msgs.last(),isUnreadDivider:!1});const r=this._openChat(t,n).then((()=>this._scrollChatToBottom())).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return r.finally((()=>{this.setUiBusy(!1,"open_bottom")})),r}scrollToPtt(e){const t=(0,f.unproxy)(e.chat),n={collection:e.chat.msgs,msg:e,key:e.id,highlightMsg:!1};this.setUiBusy(!0,"open_chat_at");const r=this._openChat(t,n).then((()=>this._scrollToFocusedMsg({pos:"center",animate:!0,duration:400,easing:[.7,0,.3,1]}))).then((()=>!0)).catch((0,l.catchAbort)((()=>!1)));return r.finally((()=>{this.setUiBusy(!1,"open_chat_at")})),r}_scrollToFocusedMsg(e){return new Promise((t=>{this.trigger("scroll_to_focused_msg",t,e)})).catch((e=>{__LOG__(3)`Unexpected scrollToFocusedMsg error: ${String(e)}`}))}_scrollChatToBottom(){return new Promise((e=>{this.trigger("scroll_chat_to_bottom",e)})).catch((e=>{__LOG__(3)`Unexpected scrollChatToBottom error: ${String(e)}`}))}flashFocusedMsg(e){setTimeout((()=>{this.trigger("flash_focused_msg"),e&&this.trigger("flash_mention_msg")}),0)}updateChatlistSelection(e){const t=(0,f.unproxy)(e);this.trigger("update_chatlist_selection",t)}closeChat(e){const t=(0,f.unproxy)(e);this.trigger("close_chat",t)}focusShowMsg(e){this.trigger("focus_show_msg",e)}focusNextChat(e){this.trigger("focus_next_chat",e)}focusPrevChat(e){this.trigger("focus_prev_chat",e)}focusChatList(){this.trigger("focus_chat_list")}focusChatSearch(){this.trigger("focus_chat_search")}startGroupCall(e,t){const n=(0,f.unproxy)(e);this.trigger("voip_start_group_call",n,t)}closeStatusViewer(){this.trigger("close_status_viewer")}openComposeBoxPanel(e){this.trigger("open_compose_box_panel",e)}login(e){this.trigger("login",e)}logout(){const e=(0,c.isMDBackend)();p.LegacyPhoneFeatures.resetFeatures(),e?(0,c.switchToMDBackend)():(0,c.switchToLegacyWebdBackend)(),this.trigger("logout")}openContextMenu(e,t){this.trigger("open_context_menu",e,t)}closeContextMenu(e){this.trigger("close_context_menu",e)}openTooltip(e,t){this.trigger("open_tooltip",e,t)}closeTooltip(e){this.trigger("close_tooltip",e)}alertNewMsg(e){this.trigger("alert_new_msg",e)}alertNewReactionMsg(e){this.trigger("alert_new_reaction_msg",e)}newMediaMsg(e){this.trigger("new_media_msg",e)}alertCall(e,t,n,r,i){this.trigger("alert_call",{wid:e,mid:t,isVideo:n,isGroup:r,canHandleLocally:i})}cancelCall(e){this.trigger("cancel_call",e)}windowError(){}cannotReachPhone(){}sentPing(){}onPanesWillChange(e){this.trigger("panes_will_change",e)}onPanesDidChange(e){this.trigger("panes_did_change",e)}openGroupInviteModal(e){this.trigger("open_group_invite_modal",e)}reactionChangeLastMessage(){this.trigger("reaction_changed_last_msg")}openGroupV4InviteRequestFlow(e,t,n,r){this.trigger("open_group_v4_invite_request_flow",e,t,n,r)}openCommandPalette(){this.trigger("open_command_palette")}uiResize(){this.trigger("resize")}setUiBusy(e){let t=this.uiBusy||0;e?(++t,this._clearUiBusy(),this._triggerIdleEvent.cancel()):t&&--t,this.uiBusy=t,0===t&&(this._clearUiBusy.cancel(),this._triggerIdleEvent())}windowMouseDown(e){this.trigger("window_mousedown",e)}windowClick(e){this.trigger("window_click",e)}midnight(){this.trigger("midnight")}textsizeChange(e){this.trigger("textsize_change",e)}scrollMessages(){this.trigger("scroll_messages")}getConversationHeaderOffset(e){this.trigger("get_conversation_header_offset",e)}floaterEscapeOverlap(e,t){this.trigger("floater_escape_overlap",e,t)}autoplayPTT(e){this.trigger("sequential_playback_ptt",e)}refreshMessages(){this.trigger("refresh_messages")}readyForMainStreamModeLegacy(){this.trigger("main_stream_mode_ready_legacy")}storageInitializationError(){this.trigger("storage_initialization_error")}downgradeWebclient(){this.trigger("md_downgrade_webclient")}upgradeToMDInternal(){this.trigger("upgrade_to_md")}upgradeToMDProd(){this.trigger("upgrade_to_md_prod")}refreshQR(){this.trigger("md_refresh_qr")}setSocketState(e){this.trigger("set_socket_state",e)}socketStreamDisconnected(){this.trigger("socket_stream_disconnected")}openSocketStream(){this.trigger("open_socket_stream")}openLongLinkModal(){this.trigger("open_long_link_modal")}closeLongLinkModal(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.trigger("close_long_link_modal",e)}openLockScreenModal(){this.trigger("open_lock_screen_modal")}correctPasscodeLockScreen(){this.trigger("correct_passcode_lock_screen")}incorrectPasscodeLockScreen(){this.trigger("incorrect_passcode_lock_screen")}readyForMainStreamMode(){this.isMainStreamReadyMd=!0,this.trigger("main_stream_mode_ready")}onInitialChatHistorySynced(){this.trigger("on_initial_chat_synced")}onRecentChatHistorySynced(){this.trigger("on_recent_chat_history_synced")}onFullChatHistorySynced(){this.trigger("on_full_chat_history_synced")}onHistorySyncChunkProcessed(e){this.trigger("new_history_sync_chunk_processed",e)}handleOfflineProgressUpdate(){this.trigger("offline_progress_update")}criticalSyncDone(){this.trigger("on_critical_sync_done")}onTemporaryBan(e){this.trigger("account_temporarily_banned",e)}onStartingLogout(){this.trigger("starting_logout")}handleFatalError(){this.trigger("handle_fatal_error")}merchantDetailsDrawer(e){this.trigger("merchant_details_drawer",e)}showMerchantDetailsEntityTypePopup(e,t){this.trigger("show_merchant_details_entity_type_popup",e,t)}showCountrySelector(e,t,n,r){this.trigger("show_country_selector_popup",e,t,n,r)}toggleStickerMaker(){this.trigger("toggle_sticker_maker")}onAccountSyncForPrivacy(e){this.trigger("account_sync_for_privacy",e)}openStickerPack(e){this.trigger("open_sticker_pack",e)}onStatusViewerOpen(){this.trigger("status_viewer_open")}triggerStorageAlert(){}onAbPropsUpdate(){this.trigger("on_ab_props_update")}onNotificationPermissionChange(){this.trigger("on_notification_permission_change")}}t.CmdImpl=g;const m=new g;t.Cmd=m},581703:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compatPrefix=function(e,t){let a;if(0===e.indexOf(n)){a=e.substring(n.length);return i(window.Modernizr?window.Modernizr.prefixed(n):n,n,a)}if(0===e.indexOf(r)){a=e.substring(r.length);return i(window.Modernizr?window.Modernizr.prefixed(r):r,r,a)}return window.Modernizr.prefixed(e,t,!1)||e};const n="animation",r="transition";function i(e,t,n){const r=e.toLowerCase().indexOf(t),i=e.slice(0,r).toLowerCase();return 0===e.indexOf(t)?i+e.slice(r)+n.toLowerCase():i+e.slice(r)+n}},688755:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=document.createElement("textarea");t.value=e,document.body&&document.body.appendChild(t);t.focus(),t.select(),document.execCommand("copy"),document.body&&document.body.removeChild(t)}},705177:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DISPLAY_TYPE=void 0;t.DISPLAY_TYPE={CONVERSATION:"CONVERSATION",MSG_INFO:"MSG_INFO",STARRED_MSGS:"STARRED_MSGS",GALLERY:"GALLERY",REPLY_STAGE:"REPLY_STAGE",QUOTED_MSG:"QUOTED_MSG",CONTACT_CARD:"CONTACT_CARD",ORDER:"ORDER",STATUS:"STATUS"}},698159:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.documentFlushed=function(e){var t;const n=null!==(t=null==e?void 0:e.signal)&&void 0!==t?t:l();return new Promise(((e,t)=>{if(n.aborted)return void t(new o.AbortError);let r;function i(){n.removeEventListener("abort",l);const e=s.indexOf(a);-1!==e&&s.splice(e,1),0===s.length&&null!=r&&(r(),r=null)}function a(){i(),e()}function l(){i(),t(new o.AbortError)}s.push(a),n.addEventListener("abort",l),1===s.length&&(r=function(){let e;const t=requestAnimationFrame((()=>{e=setTimeout((()=>{c()}),0)}));return()=>{cancelAnimationFrame(t),clearTimeout(e)}}())}))},t.resolveAllForTestingOnly=void 0;var a=i(n(751463)),o=n(389385);const s=[],l=(0,a.default)((()=>(new r).signal));function c(){for(;s.length>0;){s.shift()()}}t.resolveAllForTestingOnly=()=>(c(),Promise.resolve())},145120:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(321338));var a=new class{constructor(){this.shouldIndicateFocusTimestamp=0}shouldIndicateFocus(){this.shouldIndicateFocusTimestamp=Date.now()}maybeIndicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;Date.now()-this.shouldIndicateFocusTimestamp>200||this.indicateFocus(e,t)}indicateFocus(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.default.focusAnimation;e&&(e.classList.remove(t),e.offsetWidth,e.classList.add(t))}};t.default=a},352013:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(657319);let i=[],a=!1;const o=new r.ShiftTimer((function(){i=[],a=!1}));document.addEventListener("keydown",(()=>{o.forceRunNow()}),{capture:!0,passive:!0});var s={focus:function(e,t){if(e&&(!i.length||e!==i[i.length-1])){if(a=a||null!=window.event,function(e){5===i.length&&i.shift(),i.push(e)}(e),function(){if(i.length<5)return!1;const e=new Set;for(let t=0;t<i.length;t++){if(e.has(i[t]))return!0;e.add(i[t])}return!1}()&&!a)return __LOG__(4,void 0,new Error,!0)`Focus loop encountered.`,void SEND_LOGS("focus-loop");o.onOrBefore(75),e.focus(t)}}};t.default=s},941906:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SCROLL_FUDGE=t.QR_EDGE=t.LAYOUT_2COLUMNS_MAX_WIDTH=void 0;t.SCROLL_FUDGE=100;t.LAYOUT_2COLUMNS_MAX_WIDTH=1024;t.QR_EDGE=264},930764:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UIBusyTasks=t.IdleEnum=t.IdleCallbackTasks=void 0;var r=n(657319),i=n(87364);const a=n(76672).Mirrored(["IDLE_CALLBACK","UI_BUSY"]);t.IdleEnum=a;class o{constructor(e){this.busyMap=new Map,this.busyId=0,this._clearBusyMap=()=>{this.busyMap.clear()},this._taskMap=new Map,this.taskId=0,this.runIdleLoop=()=>{this.idleType===a.IDLE_CALLBACK?this.idleCallbackId=(0,i.requestIdleCallback)(this._ricOnIdle):this.isIdle()&&this._uiBusyOnIdle()},this._ricOnIdle=e=>{let t;const n=this._taskMap.entries();for(;(t=n.next())&&!t.done;){const[n,r]=t.value;if(r(),this._taskMap.delete(n),e.timeRemaining()<=0)break}this._taskMap.size>0&&this.runIdleLoop()},this.idleType=e}setBusy(e){let t=e;return null!=t&&this.busyMap.has(t)?this.busyMap.set(t,this.busyMap.get(t)+1):(t=++this.busyId,this.busyMap.set(t,1)),this.busyTimer||(this.busyTimer=new r.ShiftTimer(this._clearBusyMap)),this.busyTimer.debounce(1e3),t}decBusy(e){if(null==e)return;const t=this.busyMap.get(e);null!=t&&0!==t&&(1===t?this.clearBusy(e):this.busyMap.set(e,t-1))}clearBusy(e){null!=this.busyMap.get(e)&&this.busyMap.delete(e),this.isIdle()&&(this.busyTimer.cancel(),this._taskMap.size>0&&window.setTimeout(this.runIdleLoop,0))}isIdle(){return 0===this.busyMap.size}isBusy(){return this.busyMap.size>0}cancelIdleLoop(){this.idleType===a.IDLE_CALLBACK&&null!=this.idleCallbackId&&(0,i.cancelIdleCallback)(this.idleCallbackId)}_uiBusyOnIdle(){let e;const t=this._taskMap.entries();for(;(e=t.next())&&!e.done;){const[t,n]=e.value;if(n(),this._taskMap.delete(t),this.isBusy())break}}enqueue(e){return this._taskMap.set(++this.taskId,e),1===this._taskMap.size&&this.runIdleLoop(),this.taskId}dequeue(e){const t=this._taskMap.delete(e);return t&&0===this._taskMap.size&&this.cancelIdleLoop(),t}isInQueue(e){return this._taskMap.has(e)}}const s=new o(a.UI_BUSY);t.UIBusyTasks=s;const l=new o(a.IDLE_CALLBACK);t.IdleCallbackTasks=l},377144:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.isWeb=t.isOSWin=t.isOSRTL=t.isOSMac=t.isOSLTR=t.isNative=t.hasSafariFix=t.hasFontFix=t.hasFirefoxFix=t.hasEdgeFix=void 0;var i=n(26741),a=r(n(914296));null!=window.Native&&a.default.isRTL(window.Native.appGetLocale());t.isNative=!1;t.isWeb=!0;const o=i.UA.isSafari;t.hasSafariFix=o;const s=i.UA.isTrident;t.hasEdgeFix=s;const l=i.UA.isGecko;t.hasFirefoxFix=l;const c=i.UA.browser===i.BROWSER_TYPE.CHROME||i.UA.browser===i.BROWSER_TYPE.OPERA;t.hasFontFix=c;t.isOSLTR=!1;t.isOSRTL=!1;const u=i.UA.os===i.OS_TYPE.MAC;t.isOSMac=u;const d=i.UA.os===i.OS_TYPE.WINDOWS;t.isOSWin=d},713643:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(512641));const a=[.1,.82,.25,1],o=[.69,0,.79,.14],s=[.84,.07,.93,.46];i.default.RegisterEffect("attach.Up",{defaultDuration:300,calls:[[{opacity:[1,0],translateY:["0%","150%"],scaleX:[1,.3],scaleY:[1,.3]},1,{easing:[300,22]}]]}),i.default.RegisterEffect("attach.Down",{defaultDuration:200,easing:o,calls:[[{opacity:[0,1],translateY:["100%","0%"],scaleX:[.3,1],scaleY:[.3,1]},1,{easing:[.33,0,.39,.91]}]]}),i.default.RegisterEffect("dropdown.Down",{defaultDuration:200,easing:a,calls:[[{opacity:[1,0],translateY:["0%","-15px"]},1,{easing:a}]]});var l={pop:{duration:200,easing:s,enter:{props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]}},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]}}},slide:{duration:200,easing:a,enter:{props:"slideDown"},leave:{props:"slideUp"}},scaleY:{duration:200,easing:a,enter:{props:{scaleY:[1,0],transformOrigin:"center"}},leave:{props:{scaleY:[0,1],transformOrigin:"center"}}},scale:{duration:500,easing:a,enter:{props:{scaleX:[1,0],scaleY:[1,0]}},leave:{props:{scaleX:[0,1],scaleY:[0,1]}}},fade:{duration:200,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},messageComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0],translateX:[0,-100]}},leave:{props:{opacity:[0,1],translateX:[-100,0]}}},pttComposer:{duration:300,easing:"easeInOut",enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"fade-fast":{easing:"ease",enter:{props:{opacity:[1,0]},duration:150},leave:{props:{opacity:[0,1]},duration:100}},"ptt-out-of-chat":{enter:{props:{translateY:["-100%","0%"],opacity:[1,0]},duration:250,delay:150,easing:"ease"},leave:{props:{translateY:["0%","-100%"],opacity:[0,1]},duration:250,delay:150,easing:"ease"}},fade_sifo:{enter:{props:{opacity:[1,0]},duration:250},leave:{props:{opacity:[0,1]},duration:100}},capture:{enter:{props:{opacity:[1,0]},duration:350},leave:[{selector:"[data-animate-capture-snapshot]",props:"transition.bounceDownOut",duration:700},{selector:"[data-animate-capture-webcam]",props:{opacity:[0,1]},duration:100,easing:"ease"}]},butterbar:{enter:{props:"slideDown",easing:a,duration:700},leave:{props:"slideUp",easing:o,duration:350}},modal:{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,0]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:o,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:o,duration:200}]},"modal-flow":{enter:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[1,0]},duration:300,easing:[.19,.73,.28,1]},{selector:"[data-animate-modal-popup]",props:{scaleX:[1,0],scaleY:[1,0],opacity:[1,1]},easing:[.19,.73,.28,1],delay:180,duration:200},{selector:"[data-animate-modal-popup]",props:{opacity:[0,0]},duration:180}],leave:[{selector:"[data-animate-modal-backdrop]",props:{opacity:[0,1]},duration:300,easing:o,delay:100},{selector:"[data-animate-modal-popup]",props:{scaleX:[0,1],scaleY:[0,1]},easing:o,duration:200}]},"flow-transition-modal-push":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-modal-pop":{duration:300,easing:a,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"flow-transition-box-size-drawer-push":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["-100%","0%"]}}]},"flow-transition-box-size-drawer-pop":{duration:300,easing:a,enter:[{selector:"[data-animate-modal-body]",props:{translateX:["0%","-100%"]}}],leave:[{props:{background:["transparent","transparent"]}},{selector:"[data-animate-modal-popup]",props:{background:["transparent","transparent"],boxShadow:["none","none"]}},{selector:"[data-animate-modal-body]",props:{translateX:["100%","0%"]}}]},"flow-transition-drawer-push":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"flow-transition-drawer-pop":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"drawer-left":{enter:[{props:{translateX:["0%","-100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,-50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["-100%","0%"]},duration:300,easing:o}]},"drawer-left-rtl":{enter:[{props:{translateX:["0%","100%"]},duration:300,easing:a},{selector:"[data-animate-drawer-title]",props:{translateX:[0,50],opacity:[1,0]},duration:500,easing:"easeOut"}],leave:[{props:{translateX:["100%","0%"]},duration:300,easing:o}]},dropdown:{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:"dropdown.Down",delay:50,duration:375,stagger:25,drag:!0},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}},"dropdown-picker":{duration:300,easing:a,enter:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},delay:50,duration:200},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0],rotateZ:["45deg"],translateY:["0%","-100%"]}},{props:{scale:[1,0]}},{props:{opacity:[1,0]},duration:100}],leave:[{selector:"[data-animate-dropdown-item]",props:{opacity:[1,0]},duration:100},{selector:"[data-animate-dropdown-nib]",props:{opacity:[1,0]},duration:150},{props:{scaleX:[0,1],scaleY:[0,1],opacity:[0,1]}}]},"profile-viewer":{duration:500,easing:[.1,1.03,.28,.99],leave:[{delay:400,props:{opacity:[0,1]}},{selector:"[data-animate-profile-viewer]",props:{borderRadius:["50%","0%"]}}]},"media-viewer":{duration:300,easing:[.1,1.03,.28,.99],leave:{selector:"[data-animate-media-viewer]",props:{opacity:[0,1]}}},"status-v3-quoted-msg":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:200,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:o}},"status-v3-quick-reply":{enter:{props:{opacity:[1,0]},duration:300,easing:a},leave:{props:{opacity:[0,1]},duration:200,easing:o}},"status-v3-panel":{enter:{props:{translateY:["0%","100%"],opacity:[1,0]},duration:300,easing:a},leave:{props:{translateY:["100%","0%"],opacity:[0,1]},duration:200,easing:o}},"status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-modal-background]",props:{opacity:[0,1]}}},"quoted-status-v3-modal":{easing:[.55,.085,.68,.53],enter:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[1,0]}},leave:{duration:100,selector:"[data-animate-status-v3-viewer]",props:{opacity:[0,1]}}},"status-v3-player":{easing:[.55,.085,.68,.53],enter:{duration:200,props:{opacity:[1,0]}},leave:{duration:200,props:{opacity:[0,1]}}},menu:{enter:{selector:"[data-animate-menu-icons-item]",props:"attach.Up",duration:700,stagger:30,drag:!1},leave:{selector:"[data-animate-menu-icons-item]",props:"attach.Down",duration:200,stagger:30}},emoji:{duration:300,easing:a,enter:{props:{height:[291,0]}},leave:{props:{height:[0,291]}}},ptt:{enter:[{selector:"[data-animate-btn-border]",easing:"easeInOut",props:{scaleX:[1,.5],scaleY:[1,.5],opacity:[1,0]},duration:250,delay:100},{selector:"[data-animate-ptt-counter]",easing:"easeInOut",props:{scaleX:[1,.8],scaleY:[1,.8],opacity:[1,0]},duration:250,delay:100},{props:{opacity:[1,0]},duration:150,easing:a}],leave:[{selector:"[data-animate-btn-border]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{selector:"[data-animate-ptt-counter]",easing:a,props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:250},{props:{opacity:[0,1]},duration:300,easing:a}]},"slide-left":{duration:300,easing:a,enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["100%","0%"]}}},"slide-left-rtl":{duration:300,easing:a,enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","100%"]}},leave:{props:{translateX:["-100%","0%"]}}},"slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:{props:{translateX:["0%","-100%"]}},leave:{props:{translateX:["100%","0%"]}}},"media-slide-forward":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["-30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"media-slide-back":{duration:200,easing:[.19,.93,.18,.99],enter:[{selector:"[data-animate-attach-media]",props:{opacity:[1,0],translateX:["0%","-30%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[1,0]}}],leave:[{selector:"[data-animate-attach-media]",props:{opacity:[0,1],translateX:["30%","0%"]}},{selector:"[data-animate-media-caption]",props:{opacity:[0,1]}}]},"slide-down-date":{duration:300,enter:{props:{translateY:["0%","-130%"],opacity:[1,0]},easing:a},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]},easing:o}},"slide-down-test":{duration:300,easing:a,enter:{props:{height:["auto","0"],opacity:[1,0]}},leave:{props:{translateY:["-130%","0%"],opacity:[0,1]}}},"pop-fast-reverse":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","-100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["-100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast":{duration:75,easing:[.14,.62,.33,.9],enter:[{selector:"[data-js-context-icon]",props:{translateX:["0%","100%"]}},{props:{opacity:[1,.5]}}],leave:[{selector:"[data-js-context-icon]",props:{translateX:["100%","0%"]}},{props:{opacity:[0,1]}}]},"pop-fast-chat":{duration:75,easing:[.14,.62,.33,.9],enter:[{props:{width:["20px","5px"],opacity:[1,.5]}}],leave:[{props:{width:["5px","20px"],opacity:[0,1]}}]},"toast-transition":{duration:300,easing:a,cleanOnComplete:!0,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},"slide-up-down":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-down-footer":{duration:200,easing:a,enter:[{props:{translateY:["0%","100%"]}},{selector:"[data-animate-btn]",props:{opacity:[1,0],scale:[1,0]},delay:200,duration:300}],leave:[{props:{translateY:["100%","0%"]},delay:200},{selector:"[data-animate-btn]",props:{opacity:[0,1],scale:[.6,1]},duration:200}]},"slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"]}},leave:{props:{translateY:["100%","0%"]}}},"slide-up-fade-in-eta":{duration:100,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0],height:[20,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1],height:[0,20]}}},"slide-down":{duration:300,easing:a,enter:{props:{translateY:["0%","-100%"]}},leave:{props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away":{duration:300,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-slide-away-fast":{duration:80,enter:{easing:"easeOutCubic",props:{translateY:["0%","-100%"]}},leave:{easing:"easeInCubic",props:{translateY:["-100%","0%"]}}},"emoji-search-panel-slide-up":{duration:300,easing:a,enter:{props:{translateY:["0%","100%"],opacity:[1,0]}},leave:{props:{translateY:["100%","0%"],opacity:[0,1]}}},none:{},btn:{duration:300,easing:a,enter:{props:{scale:[1,0],opacity:[1,0]}},leave:{props:{scale:[0,1],opacity:[0,1]}}},pop_delay:{duration:300,enter:[{props:{scale:[1,0],opacity:[1,0]},delay:500,easing:a}],leave:{props:"transition.expandOut",easing:o}},"delay-leave":{duration:1,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]},delay:300}},"media-caption":{enter:[{props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300}],leave:{props:{opacity:[0,1]},easing:"ease",duration:300}},"media-scale":{enter:[{selector:"[data-animate-media-caption]",props:{opacity:[0,0],translateY:["100%","100%"]},duration:200},{selector:"[data-animate-media-caption]",props:{opacity:[1,0],translateY:["0%","100%"]},easing:a,delay:200,duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,0]},duration:200},{selector:"[data-animate-attach-media]",props:{opacity:[1,0],scale:[1,.625],display:"flex"},delay:200,duration:300,easing:a}],leave:[{selector:"[data-animate-media-caption]",props:{opacity:[0,1]},easing:"ease",duration:300},{selector:"[data-animate-attach-media]",props:{opacity:[0,1],scale:[.5,1],display:"flex"},delay:0,duration:200,easing:o}]},"thumb-scale":{duration:400,easing:a,enter:{props:"transition.expandIn"},leave:{props:"transition.expandOut"}},"thumb-scale-flex":{duration:400,easing:a,enter:{props:{scale:[1,0],display:"flex"}},leave:{duration:200,props:{scale:[0,1],display:"flex"}}},default:{duration:300,enter:{props:{opacity:[1,0]}},leave:{props:{opacity:[0,1]}}},noop:{duration:0},"noop-full-opacity":{duration:0,enter:{props:{opacity:[1,1]}},leave:{props:{opacity:[1,1]}}},pip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:s}},voip:{enter:{props:{opacity:[1,0]},duration:400},leave:{props:{scaleX:[.5,1],scaleY:[.5,1],opacity:[0,1]},duration:200,easing:s}},"replace-fade":{enter:[{props:{opacity:[0,0]},duration:400},{props:{opacity:[1,0]},duration:400,delay:400}],leave:{props:{opacity:[0,1]},duration:400}}};t.default=l},128298:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.uiPadding=t.uiMargin=void 0;r(n(156720));const i={horizMinus6:{marginEnd:"n3fdhnkw",marginStart:"heai6z19"},startMinus6:{marginStart:"heai6z19"},endMinus6:{marginEnd:"n3fdhnkw"},horizMinus4:{marginEnd:"isg5rw3j",marginStart:"nxn8agaf"},startMinus4:{marginStart:"nxn8agaf"},endMinus4:{marginEnd:"isg5rw3j"},topMinus3:{marginTop:"if44n927"},topMinus1:{marginTop:"o9i7y497"},all0:{marginTop:"tt8xd2xn",marginEnd:"jnwc1y2a",marginBottom:"mpdn4nr2",marginStart:"svoq16ka"},horiz0:{marginEnd:"jnwc1y2a",marginStart:"svoq16ka"},vert0:{marginTop:"tt8xd2xn",marginBottom:"mpdn4nr2"},top0:{marginTop:"tt8xd2xn"},bottom0:{marginBottom:"mpdn4nr2"},end0:{marginEnd:"jnwc1y2a"},start0:{marginStart:"svoq16ka"},top1:{marginTop:"b9l0eqez"},all2:{marginTop:"kiiy14zj",marginEnd:"om6y7gxh",marginBottom:"j4enbv94",marginStart:"gj5xqxfh"},horiz2:{marginEnd:"om6y7gxh",marginStart:"gj5xqxfh"},vert2:{marginTop:"kiiy14zj",marginBottom:"j4enbv94"},top2:{marginTop:"kiiy14zj"},bottom2:{marginBottom:"j4enbv94"},end2:{marginEnd:"om6y7gxh"},start2:{marginStart:"gj5xqxfh"},all3:{marginTop:"g1eqewly",marginEnd:"kjemk6od",marginBottom:"kzyzudjh",marginStart:"k6y3xtnu"},horiz3:{marginEnd:"kjemk6od",marginStart:"k6y3xtnu"},vert3:{marginTop:"g1eqewly",marginBottom:"kzyzudjh"},top3:{marginTop:"g1eqewly"},bottom3:{marginBottom:"kzyzudjh"},end3:{marginEnd:"kjemk6od"},start3:{marginStart:"k6y3xtnu"},all4:{marginTop:"qt60bha0",marginEnd:"mw4yctpw",marginBottom:"inww9tbj",marginStart:"qnz2jpws"},horiz4:{marginEnd:"mw4yctpw",marginStart:"qnz2jpws"},vert4:{marginTop:"qt60bha0",marginBottom:"inww9tbj"},top4:{marginTop:"qt60bha0"},bottom4:{marginBottom:"inww9tbj"},end4:{marginEnd:"mw4yctpw"},start4:{marginStart:"qnz2jpws"},all5:{marginTop:"hymafltn",marginEnd:"q471nw87",marginBottom:"g105fvfm",marginStart:"p3lsiedt"},horiz5:{marginEnd:"q471nw87",marginStart:"p3lsiedt"},vert5:{marginTop:"hymafltn",marginBottom:"g105fvfm"},top5:{marginTop:"hymafltn"},bottom5:{marginBottom:"g105fvfm"},end5:{marginEnd:"q471nw87"},start5:{marginStart:"p3lsiedt"},all6:{marginTop:"iin4x6c7",marginEnd:"claouzo6",marginBottom:"ngycyvoj",marginStart:"oz0g9ue8"},horiz6:{marginEnd:"claouzo6",marginStart:"oz0g9ue8"},vert6:{marginTop:"iin4x6c7",marginBottom:"ngycyvoj"},top6:{marginTop:"iin4x6c7"},bottom6:{marginBottom:"ngycyvoj"},end6:{marginEnd:"claouzo6"},start6:{marginStart:"oz0g9ue8"},all8:{marginTop:"dj1c3cmq",marginEnd:"bugiwsl0",marginBottom:"or9x5nie",marginStart:"fooq7fky"},horiz8:{marginEnd:"bugiwsl0",marginStart:"fooq7fky"},vert8:{marginTop:"dj1c3cmq",marginBottom:"or9x5nie"},top8:{marginTop:"dj1c3cmq"},bottom8:{marginBottom:"or9x5nie"},end8:{marginEnd:"bugiwsl0"},start8:{marginStart:"fooq7fky"},all10:{marginTop:"opp68qpq",marginEnd:"spjzgwxb",marginBottom:"brac1wpa",marginStart:"a3oefunm"},horiz10:{marginEnd:"spjzgwxb",marginStart:"a3oefunm"},vert10:{marginTop:"opp68qpq",marginBottom:"brac1wpa"},top10:{marginTop:"opp68qpq"},bottom10:{marginBottom:"brac1wpa"},end10:{marginEnd:"spjzgwxb"},start10:{marginStart:"a3oefunm"},all12:{marginTop:"iy2cu22y",marginEnd:"oz083wsx",marginBottom:"t4zgqcuo",marginStart:"g9zvcdbd"},horiz12:{marginEnd:"oz083wsx",marginStart:"g9zvcdbd"},vert12:{marginTop:"iy2cu22y",marginBottom:"t4zgqcuo"},top12:{marginTop:"iy2cu22y"},bottom12:{marginBottom:"t4zgqcuo"},end12:{marginEnd:"oz083wsx"},start12:{marginStart:"g9zvcdbd"},bottom14:{marginBottom:"k0lnf8n4"},all15:{marginTop:"eg3lofc5",marginEnd:"ds60debm",marginBottom:"pz0xruzv",marginStart:"htq1q0kf"},horiz15:{marginEnd:"ds60debm",marginStart:"htq1q0kf"},vert15:{marginTop:"eg3lofc5",marginBottom:"pz0xruzv"},top15:{marginTop:"eg3lofc5"},bottom15:{marginBottom:"pz0xruzv"},end15:{marginEnd:"ds60debm"},start15:{marginStart:"htq1q0kf"},top16:{marginTop:"fgtikrv0"},all20:{marginTop:"c46o30wg",marginEnd:"rvlagp7p",marginBottom:"du8bjn1j",marginStart:"bv1sdm6y"},horiz20:{marginEnd:"rvlagp7p",marginStart:"bv1sdm6y"},vert20:{marginTop:"c46o30wg",marginBottom:"du8bjn1j"},top20:{marginTop:"c46o30wg"},bottom20:{marginBottom:"du8bjn1j"},end20:{marginEnd:"rvlagp7p"},start20:{marginStart:"bv1sdm6y"},bottom24:{marginBottom:"iyjcf3gk"},vert28:{marginTop:"ignnouf6",marginBottom:"bibl1e27"},top28:{marginTop:"ignnouf6"},bottom28:{marginBottom:"bibl1e27"},all30:{marginTop:"nylzjxre",marginEnd:"lfum0007",marginBottom:"bvhm1occ",marginStart:"r6x3u63k"},horiz30:{marginEnd:"lfum0007",marginStart:"r6x3u63k"},vert30:{marginTop:"nylzjxre",marginBottom:"bvhm1occ"},top30:{marginTop:"nylzjxre"},bottom30:{marginBottom:"bvhm1occ"},end30:{marginEnd:"lfum0007"},start30:{marginStart:"r6x3u63k"},end32:{marginEnd:"bcfko8ch"}},a={horizMinus6:i.horizMinus6,startMinus6:i.startMinus6,endMinus6:i.endMinus6,horizMinus4:i.horizMinus4,startMinus4:i.startMinus4,endMinus4:i.endMinus4,topMinus3:i.topMinus3,topMinus1:i.topMinus1,all0:i.all0,horiz0:i.horiz0,vert0:i.vert0,top0:i.top0,bottom0:i.bottom0,end0:i.end0,start0:i.start0,top1:i.top1,all2:i.all2,horiz2:i.horiz2,vert2:i.vert2,top2:i.top2,bottom2:i.bottom2,end2:i.end2,start2:i.start2,all3:i.all3,horiz3:i.horiz3,vert3:i.vert3,top3:i.top3,bottom3:i.bottom3,end3:i.end3,start3:i.start3,all4:i.all4,horiz4:i.horiz4,vert4:i.vert4,top4:i.top4,bottom4:i.bottom4,end4:i.end4,start4:i.start4,all5:i.all5,horiz5:i.horiz5,vert5:i.vert5,top5:i.top5,bottom5:i.bottom5,end5:i.end5,start5:i.start5,all6:i.all6,horiz6:i.horiz6,vert6:i.vert6,top6:i.top6,bottom6:i.bottom6,end6:i.end6,start6:i.start6,all8:i.all8,horiz8:i.horiz8,vert8:i.vert8,top8:i.top8,bottom8:i.bottom8,end8:i.end8,start8:i.start8,all10:i.all10,horiz10:i.horiz10,vert10:i.vert10,top10:i.top10,bottom10:i.bottom10,end10:i.end10,start10:i.start10,all12:i.all12,horiz12:i.horiz12,vert12:i.vert12,top12:i.top12,bottom12:i.bottom12,end12:i.end12,start12:i.start12,bottom14:i.bottom14,all15:i.all15,horiz15:i.horiz15,vert15:i.vert15,top15:i.top15,bottom15:i.bottom15,end15:i.end15,start15:i.start15,top16:i.top16,all20:i.all20,horiz20:i.horiz20,vert20:i.vert20,top20:i.top20,bottom20:i.bottom20,end20:i.end20,start20:i.start20,bottom24:i.bottom24,vert28:i.vert28,top28:i.top28,bottom28:i.bottom28,all30:i.all30,horiz30:i.horiz30,vert30:i.vert30,top30:i.top30,bottom30:i.bottom30,end30:i.end30,start30:i.start30,end32:i.end32};t.uiMargin=a;const o={all0:{paddingTop:"i5tg98hk",paddingEnd:"f9ovudaz",paddingBottom:"przvwfww",paddingStart:"gx1rr48f"},horiz0:{paddingEnd:"f9ovudaz",paddingStart:"gx1rr48f"},vert0:{paddingTop:"i5tg98hk",paddingBottom:"przvwfww"},top0:{paddingTop:"i5tg98hk"},bottom0:{paddingBottom:"przvwfww"},end0:{paddingEnd:"f9ovudaz"},start0:{paddingStart:"gx1rr48f"},top1:{paddingTop:"qbqilfqo"},all2:{paddingTop:"ppypbuwx",paddingEnd:"fhfm09ip",paddingBottom:"s8gyl5p1",paddingStart:"mjn2akup"},horiz2:{paddingEnd:"fhfm09ip",paddingStart:"mjn2akup"},vert2:{paddingTop:"ppypbuwx",paddingBottom:"s8gyl5p1"},top2:{paddingTop:"ppypbuwx"},bottom2:{paddingBottom:"s8gyl5p1"},end2:{paddingEnd:"fhfm09ip"},start2:{paddingStart:"mjn2akup"},all3:{paddingTop:"ocd2b0bc",paddingEnd:"folpon7g",paddingBottom:"aa0kojfi",paddingStart:"snweb893"},horiz3:{paddingEnd:"folpon7g",paddingStart:"snweb893"},vert3:{paddingTop:"ocd2b0bc",paddingBottom:"aa0kojfi"},top3:{paddingTop:"ocd2b0bc"},bottom3:{paddingBottom:"aa0kojfi"},end3:{paddingEnd:"folpon7g"},start3:{paddingStart:"snweb893"},all4:{paddingTop:"eujn52yf",paddingEnd:"jfqm35v0",paddingBottom:"ckm995li",paddingStart:"bdbt56hn"},horiz4:{paddingEnd:"jfqm35v0",paddingStart:"bdbt56hn"},vert4:{paddingTop:"eujn52yf",paddingBottom:"ckm995li"},top4:{paddingTop:"eujn52yf"},bottom4:{paddingBottom:"ckm995li"},end4:{paddingEnd:"jfqm35v0"},start4:{paddingStart:"bdbt56hn"},all5:{paddingTop:"qomlamqu",paddingEnd:"lnjlmjd6",paddingBottom:"bxcbqipq",paddingStart:"mc6o24uu"},horiz5:{paddingEnd:"lnjlmjd6",paddingStart:"mc6o24uu"},vert5:{paddingTop:"qomlamqu",paddingBottom:"bxcbqipq"},top5:{paddingTop:"qomlamqu"},bottom5:{paddingBottom:"bxcbqipq"},end5:{paddingEnd:"lnjlmjd6"},start5:{paddingStart:"mc6o24uu"},all6:{paddingTop:"n1yiu2zv",paddingEnd:"abxuf49s",paddingBottom:"eb4rp10x",paddingStart:"mhcwslh8"},horiz6:{paddingEnd:"abxuf49s",paddingStart:"mhcwslh8"},vert6:{paddingTop:"n1yiu2zv",paddingBottom:"eb4rp10x"},top6:{paddingTop:"n1yiu2zv"},bottom6:{paddingBottom:"eb4rp10x"},end6:{paddingEnd:"abxuf49s"},start6:{paddingStart:"mhcwslh8"},top7:{paddingTop:"esbfogcw"},all8:{paddingTop:"fbgy3m38",paddingEnd:"ft2m32mm",paddingBottom:"oq31bsqd",paddingStart:"nu34rnf1"},horiz8:{paddingEnd:"ft2m32mm",paddingStart:"nu34rnf1"},vert8:{paddingTop:"fbgy3m38",paddingBottom:"oq31bsqd"},top8:{paddingTop:"fbgy3m38"},bottom8:{paddingBottom:"oq31bsqd"},end8:{paddingEnd:"ft2m32mm"},start8:{paddingStart:"nu34rnf1"},all9:{paddingTop:"qlb265nb",paddingEnd:"i8go5xc4",paddingBottom:"n0ziumnz",paddingStart:"e1yunedv"},horiz9:{paddingEnd:"i8go5xc4",paddingStart:"e1yunedv"},vert9:{paddingTop:"qlb265nb",paddingBottom:"n0ziumnz"},top9:{paddingTop:"qlb265nb"},bottom9:{paddingBottom:"n0ziumnz"},end9:{paddingEnd:"i8go5xc4"},start9:{paddingStart:"e1yunedv"},all10:{paddingTop:"emrlamx0",paddingEnd:"itegkywt",paddingBottom:"aiput80m",paddingStart:"rppts313"},horiz10:{paddingEnd:"itegkywt",paddingStart:"rppts313"},vert10:{paddingTop:"emrlamx0",paddingBottom:"aiput80m"},top10:{paddingTop:"emrlamx0"},bottom10:{paddingBottom:"aiput80m"},end10:{paddingEnd:"itegkywt"},start10:{paddingStart:"rppts313"},all12:{paddingTop:"b7n2qyd4",paddingEnd:"btzf6ewn",paddingBottom:"ekpn4oxx",paddingStart:"nqtxkp62"},horiz12:{paddingEnd:"btzf6ewn",paddingStart:"nqtxkp62"},vert12:{paddingTop:"b7n2qyd4",paddingBottom:"ekpn4oxx"},top12:{paddingTop:"b7n2qyd4"},bottom12:{paddingBottom:"ekpn4oxx"},end12:{paddingEnd:"btzf6ewn"},start12:{paddingStart:"nqtxkp62"},horiz13:{paddingEnd:"pbp0z3j0",paddingStart:"rn41jex5"},start13:{paddingStart:"rn41jex5"},end13:{paddingEnd:"pbp0z3j0"},bottom14:{paddingBottom:"p9a4hubg"},all15:{paddingTop:"pxvlsfnc",paddingEnd:"kyc7k6mt",paddingBottom:"n3bptxsn",paddingStart:"f78eapp6"},horiz15:{paddingEnd:"kyc7k6mt",paddingStart:"f78eapp6"},vert15:{paddingTop:"pxvlsfnc",paddingBottom:"n3bptxsn"},top15:{paddingTop:"pxvlsfnc"},bottom15:{paddingBottom:"n3bptxsn"},end15:{paddingEnd:"kyc7k6mt"},start15:{paddingStart:"f78eapp6"},all16:{paddingTop:"tvsr5v2h",paddingEnd:"l9g3jx6n",paddingBottom:"jd93c9cp",paddingStart:"lyvj5e2u"},horiz16:{paddingEnd:"l9g3jx6n",paddingStart:"lyvj5e2u"},start16:{paddingStart:"lyvj5e2u"},end16:{paddingEnd:"l9g3jx6n"},all18:{paddingTop:"a71rq12o",paddingEnd:"tcyu26xv",paddingBottom:"pcbmd69e",paddingStart:"i8b31kl9"},horiz18:{paddingEnd:"tcyu26xv",paddingStart:"i8b31kl9"},top18:{paddingTop:"a71rq12o"},all20:{paddingTop:"nlnf8xo7",paddingEnd:"iffbo4e8",paddingBottom:"r219jyu0",paddingStart:"khscay3k"},horiz20:{paddingEnd:"iffbo4e8",paddingStart:"khscay3k"},vert20:{paddingTop:"nlnf8xo7",paddingBottom:"r219jyu0"},top20:{paddingTop:"nlnf8xo7"},bottom20:{paddingBottom:"r219jyu0"},end20:{paddingEnd:"iffbo4e8"},start20:{paddingStart:"khscay3k"},all24:{paddingTop:"a4bywxmn",paddingEnd:"h1a80dm5",paddingBottom:"lzi2pvmc",paddingStart:"sta02ykp"},horiz24:{paddingEnd:"h1a80dm5",paddingStart:"sta02ykp"},vert24:{paddingTop:"a4bywxmn",paddingBottom:"lzi2pvmc"},top24:{paddingTop:"a4bywxmn"},bottom24:{paddingBottom:"lzi2pvmc"},end24:{paddingEnd:"h1a80dm5"},start24:{paddingStart:"sta02ykp"},all30:{paddingTop:"msavwer2",paddingEnd:"bcymb0na",paddingBottom:"slgfab0f",paddingStart:"e8k79tju"},horiz30:{paddingEnd:"bcymb0na",paddingStart:"e8k79tju"},vert30:{paddingTop:"msavwer2",paddingBottom:"slgfab0f"},top30:{paddingTop:"msavwer2"},bottom30:{paddingBottom:"slgfab0f"},end30:{paddingEnd:"bcymb0na"},start30:{paddingStart:"e8k79tju"},horiz36:{paddingEnd:"lk91ofgv",paddingStart:"s9xya5d7"},start36:{paddingStart:"s9xya5d7"},end36:{paddingEnd:"lk91ofgv"}},s={all0:o.all0,horiz0:o.horiz0,vert0:o.vert0,top0:o.top0,bottom0:o.bottom0,end0:o.end0,start0:o.start0,top1:o.top1,all2:o.all2,horiz2:o.horiz2,vert2:o.vert2,top2:o.top2,bottom2:o.bottom2,end2:o.end2,start2:o.start2,all3:o.all3,horiz3:o.horiz3,vert3:o.vert3,top3:o.top3,bottom3:o.bottom3,end3:o.end3,start3:o.start3,all4:o.all4,horiz4:o.horiz4,vert4:o.vert4,top4:o.top4,bottom4:o.bottom4,end4:o.end4,start4:o.start4,all5:o.all5,horiz5:o.horiz5,vert5:o.vert5,top5:o.top5,bottom5:o.bottom5,end5:o.end5,start5:o.start5,all6:o.all6,horiz6:o.horiz6,vert6:o.vert6,top6:o.top6,bottom6:o.bottom6,end6:o.end6,start6:o.start6,top7:o.top7,all8:o.all8,horiz8:o.horiz8,vert8:o.vert8,top8:o.top8,bottom8:o.bottom8,end8:o.end8,start8:o.start8,all9:o.all9,horiz9:o.horiz9,vert9:o.vert9,top9:o.top9,bottom9:o.bottom9,end9:o.end9,start9:o.start9,all10:o.all10,horiz10:o.horiz10,vert10:o.vert10,top10:o.top10,bottom10:o.bottom10,end10:o.end10,start10:o.start10,all12:o.all12,horiz12:o.horiz12,vert12:o.vert12,top12:o.top12,bottom12:o.bottom12,end12:o.end12,start12:o.start12,horiz13:o.horiz13,start13:o.start13,end13:o.end13,bottom14:o.bottom14,all15:o.all15,horiz15:o.horiz15,vert15:o.vert15,top15:o.top15,bottom15:o.bottom15,end15:o.end15,start15:o.start15,all16:o.all16,horiz16:o.horiz16,start16:o.start16,end16:o.end16,all18:o.all18,horiz18:o.horiz18,top18:o.top18,all20:o.all20,horiz20:o.horiz20,vert20:o.vert20,top20:o.top20,bottom20:o.bottom20,end20:o.end20,start20:o.start20,all24:o.all24,horiz24:o.horiz24,vert24:o.vert24,top24:o.top24,bottom24:o.bottom24,end24:o.end24,start24:o.start24,all30:o.all30,horiz30:o.horiz30,vert30:o.vert30,top30:o.top30,bottom30:o.bottom30,end30:o.end30,start30:o.start30,horiz36:o.horiz36,start36:o.start36,end36:o.end36};t.uiPadding=s},422712:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MainAudioChannel=void 0;var i=r(n(876521));class a extends i.default{registerMedia(e){let t=null;const n=()=>{t=this.claim(e,(()=>{e.pause()}))},r=()=>{var e;null===(e=t)||void 0===e||e()};return e.addEventListener("play",n),e.addEventListener("pause",r),()=>{var i;null===(i=t)||void 0===i||i(),e.removeEventListener("play",n),e.removeEventListener("pause",r)}}claim(e,t){const n=this._active;return null!=n&&e!==n.key&&(n.pause(),this.trigger("paused_DEPRECATED_DO_NOT_USE",n.key)),this._active={key:e,pause:t},()=>{var t;e===(null===(t=this._active)||void 0===t?void 0:t.key)&&(this._active=null)}}}const o=new a;t.MainAudioChannel=o},462831:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=r(n(402525)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=s(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(512641));function s(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(s=function(e){return e?n:t})(e)}const l="finish",c="stop",u=new Map;function d(){return(d=(0,i.default)((function*(e,t,n){if(!e)return;for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];if("string"==typeof t&&(t===l||t===c))return(0,o.default)(e,t,n,...i);p(e,(e=>{const t=u.get(e)||0;u.set(e,t+1)}));const s=t;if("object"==typeof n&&"object"==typeof s){let e;"function"==typeof n.begin&&(e=n.begin),n.begin=t=>{for(const e in s){const n=s[e];Array.isArray(n)&&(0,o.hook)(t,e,n[1])}e&&e(t)}}const d=yield(0,o.default)(e,t,n,...i);return p(d,(e=>{const t=(u.get(e)||1)-1;0===t?(u.delete(e),f(e)):u.set(e,t)})),d}))).apply(this,arguments)}function p(e,t){Array.isArray(e)?e.forEach((e=>{t(e)})):t(e)}function f(e){var t;const n=o.default.Utilities.data(e),{delayedElements:r}=o.default.State;(0,a.default)(r,((t,n)=>{"count"!==n&&(t!==e&&t||delete r[n])})),(null==n||null===(t=n.velocity)||void 0===t?void 0:t.tweensContainer)&&(n.velocity.tweensContainer.element=null),o.default.Utilities.removeData(e,["fxqueue","velocity"])}},540436:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(81109)),o=i(n(506479)),s=i(n(957557)),l=i(n(441609)),c=n(551737),u=n(781572),d=n(930764),p=(function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r)}(n(435232)),i(n(713643))),f=i(n(462831)),_=n(667294),h=n(973935),g=n(53175),m=n(785893);const y=["selector"];function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}const E="enter",v="leave",T="appear";class C extends _.Component{constructor(){super(...arguments),this._isUnmounted=!1,this._controller=null,this.setBusy=()=>{this.busyId=d.UIBusyTasks.setBusy(this.busyId),this.isBusy||(this.isBusy=!0,u.Cmd.setUiBusy(!0,"vtg"))},this.unsetBusy=()=>{null!=this.busyId&&(d.UIBusyTasks.clearBusy(this.busyId),delete this.busyId),this.isBusy&&(this.uiBusy=!1,u.Cmd.setUiBusy(!1,"vtg"))},this.componentWillAppear=e=>{this.animateIfEnabled(T,e)},this.componentWillEnter=e=>{this.animateIfEnabled(E,e)},this.componentWillLeave=e=>{this.animateIfEnabled(v,e)},this.getUnmountSignal=()=>(this._controller||(this._controller=new r,this._isUnmounted&&this._controller.abort()),this._controller.signal)}componentWillUnmount(){var e;this._isUnmounted=!0,null===(e=this._controller)||void 0===e||e.abort();const t=b(this,window.Node);(0,f.default)(t,"finish")}_getTransition(){const{transitionName:e}=this.props;if(e&&!p.default[e])throw __LOG__(4,void 0,new Error,!0)` ${e} wasn't found in VelocityTransitionGroupChild transitions.`,SEND_LOGS("transition-name"),new Error("Invalid transitionName");return e?p.default[e]:p.default.default}getTransitionNodes(e,t){let n=t;Array.isArray(n)||(n=[n]);const r={};return n.map((t=>{const{selector:n}=t,i=(0,o.default)(t,y);let s;return s=n?n in r?r[n]:r[n]=e?Array.from(e.querySelectorAll(n)):void 0:e,(0,l.default)(s)?void 0:(0,a.default)({nodes:s},i)})).filter(Boolean)}blockAction(e){e.preventDefault(),e.stopPropagation()}animateTransitions(e){let t=e;const{delay:n=0,children:r,onAnimationComplete:i}=this.props,{staggerDelay:a}=_.Children.only(r);t===T&&(t=E);const o=this._getTransition(),l=o[t];if(!o||!l)return Promise.resolve();const c=(0,s.default)(o,v,E),u=b(this,window.Node),d=this.getTransitionNodes(u,l);return t===v&&(null==u?void 0:u.setAttribute)&&u.addEventListener&&(u.setAttribute("pointerEvents","none",u),u.addEventListener("keypress",this.blockAction,!0),u.addEventListener("keydown",this.blockAction,!0)),Promise.all(d.map((e=>{const{nodes:t,props:r,easing:i,duration:o,delay:s,stagger:l,drag:u}=e;return(0,f.default)(t,r,{easing:i||c.easing||"easeInSine",duration:o||c.duration||0,delay:a||n||s||c.delay||0,queue:c.queue||!1,stagger:l||!1,drag:u||!1})}))).finally((()=>{c.cleanOnComplete&&t===E&&d.forEach((e=>{const t=e.nodes;(Array.isArray(t)?t:[t]).forEach((e=>e.removeAttribute("style")))})),t===v&&(null==u?void 0:u.removeEventListener)&&(u.removeEventListener("keypress",this.blockAction,!0),u.removeEventListener("keydown",this.blockAction,!0)),i&&i()}))}animateIfEnabled(e,t){let n=!1;switch(e){case E:n=this.props.transitionEnter;break;case v:n=this.props.transitionLeave;break;case T:n=this.props.transitionAppear}n?(this.setBusy(),this.animateTransitions(e).finally((()=>{this.unsetBusy()})).then((()=>{this.getUnmountSignal().aborted||(0,c.isFunction)(t)&&t()}))):t()}rejectOnUnmount(){return this._rejectPromise||(this._rejectPromise=new Promise(((e,t)=>{this._rejector=t})),this._rejectPromise.catch((()=>{}))),this._rejectPromise}render(){return _.Children.only(this.props.children)}}C.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},C.displayName="VelocityTransitionGroupChild";class A extends _.Component{constructor(){super(...arguments),this._wrapChild=e=>(0,m.jsx)(C,(0,a.default)((0,a.default)({},this.props),{},{children:e}))}render(){return(0,m.jsx)(g.TransitionGroup,{childFactory:this._wrapChild,className:this.props.className,transitionName:this.props.transitionName,component:this.props.component,children:this.props.children})}}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.HTMLElement;const n=(0,h.findDOMNode)(e);if(n){if(n instanceof t)return n;throw new Error(`[forbiddenFindDOMNode] returned node not instance of ${String(t)}`)}return n}t.default=A,A.defaultProps={transitionAppear:!1,transitionEnter:!0,transitionLeave:!0},A.displayName="VelocityTransitionGroup"},489345:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(876521));class a extends i.default{constructor(){super(...arguments),this.openVoipWindow=()=>{this.manager&&this.manager.openVoipWindow()},this.closeVoipWindow=()=>{this.manager&&this.manager.closeVoipWindow()}}register(e){this.manager=e}unregister(){this.manager&&this.manager.closeVoipWindow(),this.manager=null}}var o=new a;t.default=o},480666:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MediaEditorAction=t.AttachMedia=t.ATTACH_MEDIA_STATE=void 0;var i=r(n(348926)),a=n(450796),o=n(565885),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=n(115461),c=(n(20551),n(411290)),u=r(n(534949)),d=n(778986),p=r(n(750170)),f=n(490669),_=r(n(565273)),h=n(729984);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}const m=n(76672).Mirrored(["Outline","OutlineDone","CropRotateCanvas"]);t.MediaEditorAction=m;const y={READY:"ready",PROCESSING:"processing",ERROR:"error"};t.ATTACH_MEDIA_STATE=y;class S extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.file=(0,c.prop)(),this.uiProcessed=(0,c.prop)(!1),this.fileOrigin=(0,c.prop)(),this.isVcardOverMmsDocument=(0,c.prop)(!1),this.stickerMaker=(0,c.prop)(!1),this.state=(0,c.session)(),this.mediaPrep=(0,c.session)(),this.mimetype=(0,c.session)(),this.originalMimetype=(0,c.session)(),this.processPromise=(0,c.session)(),this.exception=(0,c.session)(),this.caption=(0,c.session)(),this.type=(0,c.session)(l.MSG_TYPE.UNKNOWN),this.mediaEditorData=(0,c.session)(),this.lastMediaEditorAction=(0,c.session)(),this.editedFile=(0,c.session)(),this._mediaEditorUndoStack=(0,c.session)((()=>[])),this._mediaEditorRedoStack=(0,c.session)((()=>[])),this.preview=(0,c.session)(),this.fullPreview=(0,c.session)(),this.fullPreviewSize=(0,c.session)(),this.filename=(0,c.session)(),this.documentPageCount=(0,c.session)(),this.isGif=(0,c.session)(),this.gifAttribution=(0,c.session)(),this.previewable=(0,c.derived)((function(){if(!this.type||!this.mimetype||!this.fullPreview)return!1;switch(this.type){case l.MSG_TYPE.DOCUMENT:return!!this.filename;case l.MSG_TYPE.IMAGE:case l.MSG_TYPE.VIDEO:return!(!this.fullPreviewSize||!this.preview);case l.MSG_TYPE.AUDIO:case l.MSG_TYPE.STICKER:case l.MSG_TYPE.PTT:case l.MSG_TYPE.UNKNOWN:return!0;default:throw new Error(`Unsupported attach media type ${this.type}`)}}),["preview","fullPreview","type","filename","fullPreviewSize","mimetype"]),this.filesize=(0,c.derived)((function(){return this.file instanceof u.default?this.file.size():this.file instanceof Blob?this.file.size:null}),["file"]),this.fileExt=(0,c.derived)((function(){return this.filename?(0,o.getFileExtension)(this.filename):null}),["filename"])}initialize(){if(super.initialize(),!(this.file instanceof Promise))throw new Error("cannot process non-promise file");this.processAttachment(this.file)}processAttachment(e){this.state=y.PROCESSING,this.mediaEditorData=_.default.create(),this.processPromise=this._processAttachmentPromiseHelper(e).then((()=>{const e=new Image;e.src=this.fullPreview,e.onload=()=>{const t={};this.stickerMaker&&(t.fitToSquare=!0,t.scale=1-2*f.STICKER_MAKER_IMAGE_PADDING/f.STICKER_DIMENSION),this.mediaEditorData=this.mediaEditorData.setBackground(e,t)}}))}_processAttachmentPromiseHelper(e){var t=this;return e.then(function(){var e=(0,i.default)((function*(e){t.set(e);const n={},{file:r,filename:i,isGif:a,asSticker:s,stickerMaker:c,gifAttribution:p,isVcardOverMmsDocument:_,documentPageCount:g}=e;!0===a?(n.asGif=!0,n.gifAttribution=p):e.type===o.FILETYPE.DOCUMENT&&(n.asDocument=!0,n.filename=i,n.isVcardOverMmsDocument=_,n.documentPageCount=g),n.asSticker=s,!0===c&&(n.minDimension=f.STICKER_DIMENSION,n.transparency=!0),n.precomputedFields={fullHeight:e.fullPreviewSize?e.fullPreviewSize.height:void 0,fullWidth:e.fullPreviewSize?e.fullPreviewSize.width:void 0,preview:e.preview,duration:e.duration};const m=u.default.createFromData(r,r.type),S=(0,d.prepRawMedia)(m,n);t.set({mediaPrep:S});const E=yield S.waitForPrep(),v=E.documentPreview,T=E.mediaBlob instanceof u.default?window.URL.createObjectURL(E.mediaBlob.forceToBlob()):window.URL.createObjectURL(E.mediaBlob),C={file:E.mediaBlob,fullPreview:T,type:E.type,filename:E.filename,mimetype:E.mimetype,originalMimetype:e.mimetype,preview:E.preview,state:y.READY,isGif:E.isGif,fullPreviewSize:void 0,documentPageCount:g,isVcardOverMmsDocument:E.isVcardOverMmsDocument,editedFile:E.mediaBlob};(0,h.isNonZeroNumber)(E.fullWidth)&&(0,h.isNonZeroNumber)(E.fullHeight)&&(C.fullPreviewSize={height:E.fullHeight,width:E.fullWidth}),E.type===l.MSG_TYPE.IMAGE&&(C.preview=T),E.type===l.MSG_TYPE.DOCUMENT&&v&&(C.fullPreview=v.url,C.preview=v.thumbUrl,C.fullPreviewSize={height:v.height,width:v.width},C.documentPageCount=v.pdfPages),t.set(C),t.previewable||(__LOG__(4,void 0,new Error,!0)`Invariant violated, processed file is not previewable`,SEND_LOGS("AttachMedia processFile"))}));return function(){return e.apply(this,arguments)}}()).catch((0,a.filteredCatch)([s.InvalidMediaFileType,s.InvalidImageFileType],(t=>{if(this.isGif||this.type===o.FILETYPE.DOCUMENT)throw t;return this._processAttachmentPromiseHelper(e.then((e=>(e.type=o.FILETYPE.DOCUMENT,e))))}))).catch((0,a.filteredCatch)([p.default,s.MediaFileFailedLoad,s.MediaFileEmpty],(e=>(this.set({exception:e,state:y.ERROR}),this)))).catch((()=>(__LOG__(3)`AttachMedia:processFile convert unexpected error to InvalidMediaFileType:`,this.set({exception:new s.InvalidMediaFileType,state:y.ERROR}),this)))}sendToChat(e,t){if(!this.mediaPrep)return Promise.reject(new Error("MediaPrep not available"));if(this.state===y.ERROR)return Promise.reject(new Error(this.exception));if(!(this.state!==y.PROCESSING||this.previewable&&t.addEvenWhilePreparing))return Promise.reject(new Error("Media still processing"));if(this.state===y.READY)return this.mediaPrep.sendToChat(e,t);const n={mimetype:this.mimetype};switch(this.type){case l.MSG_TYPE.VIDEO:n.isGif=this.isGif,n.gifAttribution=this.gifAttribution;case l.MSG_TYPE.IMAGE:n.width=this.fullPreviewSize.width,n.height=this.fullPreviewSize.height,n.body=this.preview,t.placeholderProps=n;break;case l.MSG_TYPE.DOCUMENT:n.pageCount=this.documentPageCount,n.filename=this.filename,n.body=this.preview,t.placeholderProps=n;break;case l.MSG_TYPE.AUDIO:case l.MSG_TYPE.PTT:}return this.mediaPrep.sendToChat(e,t)}getFileType(){if(!(this.file instanceof Blob||this.file instanceof File))throw new Error("expected file to be a Blob or File");return(0,o.typeFromMimetype)(this.file.type)}isViewableOnce(){return new Set([l.MSG_TYPE.IMAGE,l.MSG_TYPE.VIDEO]).has(this.type)&&!this.isGif}isSendableAsSticker(){return this.type===l.MSG_TYPE.IMAGE}delete(){this.fullPreview&&window.URL.revokeObjectURL(this.fullPreview),super.delete()}updateMediaEditorData(e,t){return this.mediaEditorData===e||(t.undoable&&(this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]),this.lastMediaEditorAction=t.lastAction,this._mediaEditorRedoStack=[]),this.mediaEditorData=e),this.mediaEditorData}undoMediaEditorData(){if(this.canUndoMediaEditorData()){this._mediaEditorRedoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorUndoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}redoMediaEditorData(){if(this.canRedoMediaEditorData()){this._mediaEditorUndoStack.push([this.mediaEditorData,this.lastMediaEditorAction]);const[e,t]=this._mediaEditorRedoStack.pop();this.mediaEditorData=e,this.lastMediaEditorAction=t}}canUndoMediaEditorData(){return this._mediaEditorUndoStack.length>0}canRedoMediaEditorData(){return this._mediaEditorRedoStack.length>0}updateEditedFile(e){this.editedFile=e}updatePreview(e){window.URL.revokeObjectURL(this.preview),this.preview=e}updateFullPreview(e){window.URL.revokeObjectURL(this.fullPreview),this.fullPreview=e}updateCaption(e){this.caption=e}}S.Proxy="attachMedia";const E=(0,c.defineModel)(S);t.AttachMedia=E},314075:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(364369)),o=n(565885),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=g(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=n(480666),c=n(801255),u=n(964551),d=r(n(914296)),p=r(n(750170)),f=n(690535),_=r(n(188406)),h=n(548360);function g(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(g=function(e){return e?n:t})(e)}const{IMAGE:m,VIDEO:y,DOCUMENT:S,AUDIO:E}=o.FILETYPE,{READY:v,ERROR:T,PROCESSING:C}=l.ATTACH_MEDIA_STATE;let A=1;class b extends c.BaseCollection{constructor(e){let{chatParticipantCount:t}=e;super(),this.errorMsgs=null,this.ignored=0,this.mediaPickerStatsLogger=new f.MediaPickerStatsLogger,this.selection=new _.default([],(e=>e.id),"prev"),this.isStickerMaker=!1,this.mediaPickerStatsLogger.chatRecipients=t,this.listenTo(this.selection,"all",this._handleSelectionEvents.bind(this))}_handleSelectionEvents(e,t){"focus"!==t&&!1!==t||this.trigger("active-change")}removeSingleton(e,t){var n;e&&(t||this.mediaPickerStatsLogger.logDelete(e.id),e.url&&window.URL.revokeObjectURL(e.url),(null===(n=e.original)||void 0===n?void 0:n.url)&&window.URL.revokeObjectURL(e.original.url))}remove(e,t){const n=super.remove(e,t);return n.forEach((e=>this.removeSingleton(e,t))),this.selection.init(this.getPreviewableMedias(),!0),n}delete(){super.delete(),this.forEach((e=>this.removeSingleton(e))),this.selection.init(this.getPreviewableMedias(),!0)}reorder(e,t){return this.reorderMutate(e,t),this.selection.init(this.getPreviewableMedias(),!0),this.getPreviewableMedias()}replace(e,t){const n=this.get(e);if(!n)return;const r=this.indexOf(n),i=n.caption;this.remove(n,{silent:!0}),n.delete();const a=new l.AttachMedia({id:e,caption:i,file:this._normalizeAttachment(t)});return this.add(a,r?{at:r}:{}),a.processPromise}getValidMedias(){return this.filter((e=>e.state===v||e.state===C))}getPreviewableMedias(){return this.filter((e=>e.previewable))}getActive(){return this.selection.getVal()}setActive(e){this.selection.setVal(e)}unsetActive(){this.selection.unset()}setNextAsActive(){const e=this.selection.list.length-1;return-1===this.selection.index||this.selection.index===e||this.selection.setNext(),this.selection.getVal()}setPrevAsActive(){return-1===this.selection.index||0===this.selection.index||this.selection.setPrev(),this.selection.getVal()}processAttachments(e,t){var n=this;return(0,i.default)((function*(){const r=n.getPreviewableMedias().length,i=e.length+r>a.default.MAX_FILES?Math.max(a.default.MAX_FILES-r,0):e.length,o=e.length-i;0===i?o&&n.trigger("max_upload_limit",o):n.ignore(o);const s=e.slice(0,i).map((e=>new l.AttachMedia({id:A++,file:n._normalizeAttachment(e),fileOrigin:t})));n.add(s);const c=n.getActive();return n.unsetActive(),Promise.all(e).then((()=>{n._attemptToSetNextActiveFromAdded(s,c)})),yield Promise.all(s.map((e=>e.processPromise))),s.forEach((e=>n._logMediaAdd(e,t))),n._attemptToSetNextActiveFromAdded(s,c)}))()}_attemptToSetNextActiveFromAdded(e,t){if(this.getActive())return;if(this.getModelsArray().some((e=>e.state===C&&!e.previewable)))return;let n=e.find((e=>e.previewable));n||(n=t),this.selection.init(this.getPreviewableMedias()),n&&this.setActive(n)}_logMediaAdd(e,t){if(null==t)return;const n=e.isGif?"gif":e.type;this.mediaPickerStatsLogger.logAdd(e.id,n,t)}_normalizeAttachment(e){return(0,i.default)((function*(){const t=yield Promise.resolve(e);return t.filename||(t.filename=t.file.name),t.mimetype||(t.mimetype=t.file.type),t.type||(t.type=(0,o.typeFromMimetype)(t.file.type)),!t.type&&t.mimetype&&(t.type=(0,o.typeFromMimetype)(t.mimetype)),t}))()}ignore(e){e>0&&(this.ignored+=e)}uiProcessMsgs(){let e,t=[],n=0,r=0,i=0,o=0,l=0,c=0,f=0,_=0,g=0,v=0,A=0,b=!1;const P=d.default.filesize(u.ServerProps.media),O=d.default.filesize((0,u.getMaxFilesSizeServerProp)()),M=d.default.filesize(1024*u.ServerProps.vcardMaxSizeKb);if(this.forEach((t=>{if(!t.uiProcessed&&(!e&&t.previewable&&(e=t),t.state!==C&&(t.uiProcessed=!0,t.state===T)))if(t.exception instanceof p.default)switch(t.getFileType()){case m:n+=1;break;case y:r+=1;break;case E:i+=1;break;case S:t.isVcardOverMmsDocument?l+=t.documentPageCount:o+=1}else if(t.exception instanceof s.MediaFileEmpty)switch(t.getFileType()){case m:c+=1;break;case y:f+=1;break;case E:_+=1;break;case S:t.isVcardOverMmsDocument?v+=t.documentPageCount:g+=1}else t.exception instanceof s.MediaFileFailedLoad?b=!0:A+=1})),n>0&&t.push(d.default.t(375,{number:n,_plural:n,maxSize:P})),r>0&&t.push(d.default.t(655,{number:r,_plural:r,maxSize:P})),i>0&&t.push(d.default.t(142,{number:i,_plural:i,maxSize:P})),o>0&&t.push(d.default.t(251,{number:o,_plural:o,maxSize:O})),l>0&&t.push(d.default.t(218,{_plural:l,maxSize:M})),c>0&&t.push(d.default.t(374,{number:c,_plural:c})),f>0&&t.push(d.default.t(653,{number:f,_plural:f})),_>0&&t.push(d.default.t(140,{number:_,_plural:_})),g>0&&t.push(d.default.t(250,{number:g,_plural:g})),v>0&&t.push(d.default.t(217,{number:v,_plural:v})),A>0&&t.push(d.default.t(309,{number:A,_plural:A})),b&&(t=[],t.push(h.fbt._("The item you tried adding failed to load.",null,{hk:"1MmBvO"}))),t.length>1){t=[];const e=n+r+i+o,a=c+f+_+g,s=e+a+A;0===A?(0!==e&&t.push(d.default.t(310,{number:e,_plural:e,maxSize:O})),0!==a&&t.push(d.default.t(306,{number:a,_plural:a}))):t.push(d.default.t(308,{number:s,_plural:s}))}const I=t.join(" ");this.errorMsgs=I,this.ignore(this.getPreviewableMedias().length-a.default.MAX_FILES);const w=this.ignored;return this.ignored=0,w&&this.trigger("max_upload_limit",w),A>0&&this.trigger("files_not_supported"),{errorMsgs:I}}canSend(){return!this.getModelsArray().some((e=>e.state===C&&!e.previewable))}}t.default=b,b.model=l.AttachMedia},339505:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Agent=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.deviceId=(0,r.prop)(),this.name=(0,r.prop)(),this.isDeleted=(0,r.prop)(!1)}getCollection(){return n(672894).AgentCollection}}i.Proxy="agent";const a=(0,r.defineModel)(i);t.Agent=a},672894:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AgentCollection=void 0;var r=n(339505),i=n(801255);class a extends i.BaseCollection{constructor(){super(),this._agentsByDeviceId=new Map,this.triggerDeviceIdMapUpdate=()=>{this._agentsByDeviceId=new Map,this.getModelsArray().forEach((e=>{this._agentsByDeviceId.set(e.deviceId,e)}))},this.on("remove reset",this.triggerDeviceIdMapUpdate)}add(e,t){const n=super.add(e,t);return this.triggerDeviceIdMapUpdate(),n}getByDeviceId(e){return this._agentsByDeviceId.get(e)}initializeFromCache(e){this.add(e,{merge:!0})}}a.model=r.Agent;const o=new a;t.AgentCollection=o},29391:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnattributedMessage=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.deviceId=(0,r.prop)()}getCollection(){return n(139976).UnattributedMessageCollection}}i.Proxy="unattributed_message";const a=(0,r.defineModel)(i);t.UnattributedMessage=a},139976:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnattributedMessageCollection=void 0;var r=n(29391),i=n(801255),a=n(714648);class o extends i.BaseCollection{}o.model=r.UnattributedMessage,o.cachePolicy={id:"unattributed_message_collection",policy:a.CACHE_POLICY.LOAD,delay:1e3};const s=new o;t.UnattributedMessageCollection=s},115578:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._reset=function(){l=!1,s.clear(),o.clear()},t._sortSubscriptions=u,t.getFeatureFlagState=function(e){var t,n;if(!(0,a.isSmbOrangeEnabled)())return null;if(!l)throw Error(`Premium access engine getFeatureFlagState() for feature ${e} called before initialize()`);return null!==(t=null===(n=s.get(e))||void 0===n?void 0:n.subscription)&&void 0!==t?t:null},t.initialize=function(){return c.apply(this,arguments)},t.listen=function(e,t){if(!(0,a.isSmbOrangeEnabled)())return Promise.resolve().then((()=>t(null,!1))),()=>{};let n=o.get(e);n||(n=new Set,o.set(e,n));n.add(t),l&&Promise.resolve().then((()=>{const n=s.get(e);try{t((null==n?void 0:n.subscription)||null,(null==n?void 0:n.hasChanged)||!1)}catch(t){__LOG__(4,void 0,new Error,!0)`PremiumAccessEngine: error calling handler during listen for feature ${e}, error ${t}`,SEND_LOGS("PremiumAccessEngine")}}));return()=>{const n=o.get(e);n&&n.delete(t)}},t.update=function(){};var i=r(n(348926)),a=n(408139);n(503027);const o=new Map,s=new Map;let l=!1;function c(){return(c=(0,i.default)((function*(){}))).apply(this,arguments)}function u(e){return e.sort(((e,t)=>e.isDeactivated&&!t.isDeactivated?1:!e.isDeactivated&&t.isDeactivated?-1:e.isDeactivated&&t.isDeactivated?0:e.isAutoRenewing&&!t.isAutoRenewing?-1:t.isAutoRenewing&&!e.isAutoRenewing?1:e.isAutoRenewing||t.isAutoRenewing?0:(t.expirationDate||0)-(e.expirationDate||0))),e}},95336:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0;var i=r(n(766678)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.isDeactivated=(0,a.prop)(!1),this.isAutoRenewing=(0,a.prop)(!1),this.expirationDate=(0,a.prop)()}equal(e){return!!e&&(e.id===this.id&&e.isAutoRenewing===this.isAutoRenewing&&e.isDeactivated===this.isDeactivated&&e.expirationDate===this.expirationDate)}clone(){return(0,i.default)(this)}}o.Proxy="subscription";const s=(0,a.defineModel)(o);t.Subscription=s},503027:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionCollection=void 0;var r=n(95336),i=n(801255);class a extends i.BaseCollection{initializeFromCache(e){this.add(e,{merge:!0})}}a.model=r.Subscription;const o=new a;t.SubscriptionCollection=o},132742:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResult=t.BUSINESS_CATEGORY_EMPTY_STR_ID=void 0;var i=r(n(389867)),a=n(411290);t.BUSINESS_CATEGORY_EMPTY_STR_ID="__empty_query__";class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.categories=(0,a.prop)(),this.notABizId=(0,a.prop)()}getCollection(){return n(203754).BusinessCategoriesResultCollection}}o.Proxy="BusinessCategoriesResult",o.idClass=i.default;const s=(0,a.defineModel)(o);t.BusinessCategoriesResult=s},203754:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.BusinessCategoriesResultCollectionImpl=t.BusinessCategoriesResultCollection=void 0;var i=r(n(348926)),a=n(990553),o=n(132742),s=n(801255);class l extends s.BaseCollection{_find(e){return(0,i.default)((function*(){const{categories:t,notABizId:n}=yield(0,a.queryBusinessCategories)(e);return new o.BusinessCategoriesResult({id:e,categories:t,notABizId:n})}))()}}t.BusinessCategoriesResultCollectionImpl=l,l.model=o.BusinessCategoriesResult,l.staleCollection=!0;const c=new l;t.BusinessCategoriesResultCollection=c},264886:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(389867)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.cypher=(0,a.prop)(),this.cypherExpirationTimestamp=(0,a.prop)(),this.cypherType=(0,a.prop)(),this.postcode=(0,a.prop)(),this.postcodeSetByUser=(0,a.prop)(),this.postcodeLocationName=(0,a.prop)()}}o.Proxy="business_direct_connection",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},515131:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(990553),l=n(305905),c=n(770986),u=n(453168),d=n(203292),p=r(n(264886)),f=n(900884),_=n(801255),h=n(236993);class g extends _.BaseCollection{_getValidCertAndSignedUserInfo(e,t,n){return(0,a.default)((function*(){if(!n&&(null==t?void 0:t.certificateChain)){const[n,r]=yield Promise.all([(0,f.getValidCertificate)((0,c.stringToCertificateString)(t.certificateChain)),(0,s.querySignedUserInfo)(e)]);if(n)return{signedUserInfo:r,validCertificate:n}}const[r,{certificateString:i,leaftCertificateCommonName:a}]=yield Promise.all([(0,s.querySignedUserInfo)(e),(0,f.fetchCertificateFullChain)(e)]);if(r.businessDomain!==a)throw new f.DCCertificateDomainMismatchError("[direct-connection] certificate common name does not match business domain");return{signedUserInfo:r,validCertificate:yield(0,f.getValidCertificate)(i)}}))()}_getCypherTypeForConversation(e,t){return(0,f.userHasSentMessageToBusiness)(e)||t?l.CypherType.PhoneNumberAndPostcode:l.CypherType.Postcode}_fetchPostcode(e,t){return(0,a.default)((function*(){var n;if("string"==typeof(null==t?void 0:t.postcode)&&!0===t.postcodeSetByUser)return{postcode:t.postcode,postcodeSetByUser:t.postcodeSetByUser,postcodeLocationName:null!==(n=t.postcodeLocationName)&&void 0!==n?n:""};const r=yield(0,f.fetchDefaultPostcode)(e);return r?(0,i.default)((0,i.default)({},r),{},{postcodeSetByUser:!1}):void 0}))()}_getCypherFromDborApi(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.default)((function*(){const r=yield(0,h.fetchDirectConnectionKeys)(e.toJid());if(!n&&r&&t._isRowDataInGoodCondition(e,r))return{id:e,cypher:(0,l.stringToCypherString)(r.cypher),cypherExpirationTimestamp:r.cypherExpirationTimestamp,cypherType:r.cypherType,certificateChain:r.certificateChain,postcode:r.postcode,postcodeSetByUser:r.postcodeSetByUser,postcodeLocationName:r.postcodeLocationName};const a=t._getCypherTypeForConversation(e,"string"==typeof(null==r?void 0:r.postcode)&&!0===r.postcodeSetByUser),o=yield t.genNewCypher(e,a,{rowData:r,forceRenew:n});return null==o?(__LOG__(4,void 0,new Error)`[direct-connection] Cannot generate cypher`,null):(yield(0,h.createOrUpdateDirectConnectionKeys)((0,i.default)((0,i.default)({},o),{},{id:e.toJid(),cypher:(0,l.cypherStringToString)(o.cypher)})),o)}))()}_verifyPostcode(e,t){return(0,d.getJobManager)().waitUntilCompleted(u.jobSerializers.verifyPostcode(e,t))}_updateModel(e){return this.set([e])}genNewCypher(e,t,n){var r=this;let{rowData:i,forceRenew:s}=n;return(0,a.default)((function*(){const[{validCertificate:n,signedUserInfo:a},u]=yield Promise.all([r._getValidCertAndSignedUserInfo(e,i,Boolean(s)),r._fetchPostcode(e,i)]);if(null==n)return __LOG__(3)`[direct-connection] no certificate returned from the get_public_key IQ`,null;if(null==u)return __LOG__(3)`[direct-connection] Post code data could not be found`,null;const{cypher:d}=(0,o.default)(yield(0,f.getCypher)(n.chain,u.postcode,a,t),"yield getCypher(validCertificate.chain, postcodeData.postcode, signedUserInfo, cypherType)"),p=t===l.CypherType.PhoneNumberAndPostcode?a.phoneNumberSignatureExpiration:null,_=(0,c.certificateStringToString)(n.string);return{id:e,cypher:d,cypherExpirationTimestamp:p,cypherType:t,certificateChain:_,postcode:u.postcode,postcodeSetByUser:u.postcodeSetByUser,postcodeLocationName:u.postcodeLocationName}}))()}verifyAndSavePostcode(e,t){var n=this;let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,a.default)((function*(){const a=yield(0,h.fetchDirectConnectionKeys)(e.toJid()),s=l.CypherType.PhoneNumberAndPostcode,{validCertificate:u,signedUserInfo:d}=yield n._getValidCertAndSignedUserInfo(e,a,r);if(null==u)return __LOG__(3)`[direct-connection] certificate is null during verify postcode`,null;const{cypher:p,exportedAesKey:_,iv:g}=(0,o.default)(yield(0,f.getCypher)(u.chain,t,d,s),"yield getCypher(validCertificate.chain, newPostcode, signedUserInfo, newCypherType)"),m=s===l.CypherType.PhoneNumberAndPostcode?d.phoneNumberSignatureExpiration:null;let y,S;try{const t=yield n._verifyPostcode(e,p);y=t.resultCode,S=t.encryptedLocationName}catch(r){if((0,f.errorIsDirectConnectionCypherError421)(r))return n.verifyAndSavePostcode(e,t,!0);throw r}if("success"===y&&"string"==typeof S){const r=yield(0,l.decryptDataWithSymmetricKeyToString)(_,S,g),a={cypherExpirationTimestamp:m,certificateChain:(0,c.certificateStringToString)(u.string),cypherType:s,postcode:t,postcodeSetByUser:!0,postcodeLocationName:r};return yield(0,h.createOrUpdateDirectConnectionKeys)((0,i.default)({id:e.toJid(),cypher:(0,l.cypherStringToString)(p)},a)),n._updateModel((0,i.default)({id:e,cypher:p},a)),{resultCode:y,decryptedLocationName:r}}return{resultCode:y}}))()}removeCypher(e){const t=this.get(e);return t?(this.remove(t),(0,h.removeDirectConnectionKeys)(e.toJid())):Promise.resolve()}_isCypherInGoodCondition(e,t,n,r){return!(0,f.isCypherFromLaunch1)(t)&&!(0,f.isCypherExpired)(t,n)&&t===this._getCypherTypeForConversation(e,r)}_isRowDataInGoodCondition(e,t){return this._isCypherInGoodCondition(e,t.cypherType,t.cypherExpirationTimestamp,!0===t.postcodeSetByUser)}_isModelDataInGoodCondition(e,t){return this._isCypherInGoodCondition(e,t.cypherType,t.cypherExpirationTimestamp,!0===t.postcodeSetByUser)}getCypher(e){var t=this;let{forceRenew:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.default)((function*(){const r=n?null:t.get(e);return r&&t._isModelDataInGoodCondition(e,r)?r:[].concat(yield t.update(e,{forceRenewDirectConnection:n}))[0]}))()}_find(e){return this._getCypherFromDborApi(e)}_update(e,t){let{forceRenewDirectConnection:n}=t;return this._getCypherFromDborApi(e,n)}}g.model=p.default;var m=new g;t.default=m},900884:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DCCertificateDomainMismatchError=void 0,t.businessSupportsPostcode=function(e){var t,n;return!0===(null===(t=e.directConnection)||void 0===t?void 0:t.enabled)&&"string"==typeof(null===(n=e.directConnection.defaultPostcode)||void 0===n?void 0:n.code)},t.errorIsDirectConnectionCypherError421=function(e){return e instanceof l.ServerStatusCodeError&&421===e.statusCode},t.fetchCertificateFullChain=function(){return E.apply(this,arguments)},t.fetchDefaultPostcode=function(){return T.apply(this,arguments)},t.getCypher=function(e,t,n,r){const i=function(e,t,n){switch(e){case u.CypherType.PhoneNumberAndPostcode:return{postcode:t,phone_number:n.phoneNumber,ttl_timestamp:n.phoneNumberSignatureExpiration,phone_number_signature:n.phoneNumberSignature};case u.CypherType.Postcode:return{postcode:t}}}(r,t,n);return(0,u.genCypher)(e[0],i)},t.getValidCertificate=function(){return S.apply(this,arguments)},t.isCypherExpired=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,g.default)();if(e!==u.CypherType.PhoneNumberAndPostcode)return!1;if(null==t)return!0;const r=(0,g.default)(t,m),i=!(r.isValid()&&r.isAfter(n));return i},t.isCypherFromLaunch1=function(e){return!e},t.isCypherNeeded=function(){return v.apply(this,arguments)},t.timestampFormat=t.isDirectConnectionNumbersAbPropChanged=t.isDirectConnectionFlagChanged=void 0,t.userHasSentMessageToBusiness=function(e){const t=_.ChatCollection.get(e);return!!t&&t.hasMaybeSentMsgToChat()};var i=r(n(348926)),a=r(n(713752)),o=n(640265),s=r(n(145095)),l=n(492574),c=n(990553),u=n(305905),d=n(471682),p=n(770986),f=n(856149),_=n(669951),h=n(964551),g=r(n(730381));const m="YYYYMMDDTHHmmssZ";t.timestampFormat=m;class y extends((0,o.customError)("DCCertificateDomainMismatchError")){}function S(){return(S=(0,i.default)((function*(e){const t=yield(0,p.extractCertificates)(e),{result:n}=yield(0,p.validateCertificates)(t.slice(1,-1),t.slice(-1));return n?{string:e,chain:t}:null}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){var t;const[{certificate:n},r]=yield Promise.all([(0,c.queryBusinessPublicKey)(e),(0,p.fetchFromCABundle)()]);if(null==n)throw new Error("[direct-connection] no certificate returned from the get_public_key IQ");const i=yield(0,p.extractCertificates)(n),a=i.length>0?null===(t=i[0].subject.typesAndValues.find((e=>"2.5.4.3"===e.type)))||void 0===t?void 0:t.value.valueBlock.value:null,o=(0,s.default)(yield(0,p.genRootIssuers)(i,r),"yield genRootIssuers(extractedCertificate, caBundle)");return{certificateString:(0,p.encodeToString)([...i,...o]),leaftCertificateCommonName:a}}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(e){var t;const r=n(493581).BusinessProfileCollection;return Boolean((0,d.supportsDirectConnection)()&&null!=_.ChatCollection.get(e)&&(null===(t=yield r.find(e))||void 0===t?void 0:t.isBusinessDirectConnection()))}))).apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){var t;const r=n(493581).BusinessProfileCollection,i=yield r.find(e);if((null===(t=i.directConnection)||void 0===t?void 0:t.enabled)&&i.directConnection.defaultPostcode)return{postcode:i.directConnection.defaultPostcode.code,postcodeLocationName:i.directConnection.defaultPostcode.locationName}}))).apply(this,arguments)}t.DCCertificateDomainMismatchError=y;t.isDirectConnectionFlagChanged=(e,t)=>{if(e===h.UNINITIALIZED_VALUE_WEB_BIZ_PROFILE_OPTIONS)return!1;return((0,f.getBusinessProfileQueryVersionWithCustomBizProfileOptions)(e)&f.DIRECT_CONNECTION_FLAG)>0!==((0,f.getBusinessProfileQueryVersionWithCustomBizProfileOptions)(t)&f.DIRECT_CONNECTION_FLAG)>0};t.isDirectConnectionNumbersAbPropChanged=(e,t)=>null!=e&&!(0,a.default)(e,t)},348018:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_BUSINESS_CATEGORIES=t.DEFAULTS=t.BusinessProfile=t.BUSINESS_URL_DOMAIN=void 0;var i=r(n(389867)),a=n(411290);const o="wa.me/";t.BUSINESS_URL_DOMAIN=o;t.MAX_BUSINESS_CATEGORIES=3;class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.tag=(0,a.prop)(),this.description=(0,a.prop)(),this.categories=(0,a.prop)(),this.profileOptions=(0,a.prop)(),this.email=(0,a.prop)(),this.website=(0,a.prop)(),this.latitude=(0,a.prop)(),this.longitude=(0,a.prop)(),this.businessHours=(0,a.prop)(),this.catalogStatus=(0,a.prop)(),this.address=(0,a.prop)(),this.structuredAddress=(0,a.prop)(),this.legalEntityDetails=(0,a.prop)(),this.fbPage=(0,a.prop)(),this.igProfessional=(0,a.prop)(),this.isProfileLinked=(0,a.prop)(),this.directConnection=(0,a.prop)(),this.customUrlPaths=(0,a.prop)(),this.customUrl=(0,a.derived)((function(){return this.customUrlPaths&&0!==this.customUrlPaths.length?`wa.me/${this.customUrlPaths[0]}`:null}),["customUrlPaths"]),this.coverPhoto=(0,a.prop)(),this.stale=(0,a.session)(!0)}markStale(){this.stale=!0,this.hasObservers()&&this.getCollection().find(this.id)}getCollection(){return n(493581).BusinessProfileCollection}isValid(){return Array.isArray(this.categories)}isBusinessDirectConnection(){var e,t,n,r;return null!==(e=null!==(t=null===(n=this.directConnection)||void 0===n?void 0:n.enabled)&&void 0!==t?t:null===(r=this.profileOptions)||void 0===r?void 0:r.directConnection)&&void 0!==e&&e}}s.Proxy="businessProfile",s.idClass=i.default;const l=(0,a.defineModel)(s);t.BusinessProfile=l;t.DEFAULTS={description:null,email:null,website:null}},493581:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BusinessProfileCollectionImpl=t.BusinessProfileCollection=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(464358),s=n(990553),l=n(781572),c=n(471682),u=n(408139),d=n(745454),p=n(900884),f=n(348018),_=n(794010),h=n(719380),g=n(801255),m=n(964551);t.CATALOG_EXISTS="catalog_exists";class y extends g.BaseCollection{constructor(){super(),this.listenTo(m.ServerProps,"change:webBizProfileOptions",((e,t,n)=>{(0,p.isDirectConnectionFlagChanged)(n,t)&&(__LOG__(2)`[direct-connection] change in direct connection bit detected. marking relevant biz profiles from abprop numbers as stale`,this._markBizProfilesAsStale((0,c.directConnectionBusinessNumbersFromAbprop)()))}));let e=(0,o.isABPropsAfterFirstSync)()?(0,c.directConnectionBusinessNumbersFromAbprop)():null;this.listenTo(l.Cmd,"on_ab_props_update",(()=>{try{const n=(0,c.directConnectionBusinessNumbersFromAbprop)();var t;if((0,p.isDirectConnectionNumbersAbPropChanged)(e,n))this._markBizProfilesAsStale(Array.from(new Set((null!==(t=e)&&void 0!==t?t:[]).concat(n))));e=n}catch(e){__LOG__(4,!0,new Error,!0)`[direct-connection] Failed to force update biz profiles on abprop biz numbers change`,SEND_LOGS("direct-connection-biz-number-abprop-sync-fail"+e)}}))}_find(e){return this._findAndParse(e,{queryCatalog:!0})}_update(e,t){return this._findAndParse(e,{queryCatalog:!1,getMerchantCompliance:null==t?void 0:t.getMerchantCompliance})}_findAndParse(e,t){var n=this;let{queryCatalog:r,getMerchantCompliance:o}=t;return(0,a.default)((function*(){const t=n.gadd(e);if(!t.id.isUser())return __LOG__(2)`Store:BusinessProfile:find businessProfile is only available to users (${String(e)})`,Promise.resolve({id:e});let a,l=null;const c=(0,s.queryBusinessProfile)([{wid:t.id,tag:t.tag}],o);if((0,u.isSmbMelonDisplayEnabled)()){const[e,n]=yield Promise.all([c,(0,s.queryCustomUrlPaths)(t.id).catch((e=>{404!==e.statusCode&&(__LOG__(4,void 0,new Error,!0)`Error retrieving custom url ${e.message}`,SEND_LOGS("custom-url-get-error"))}))]);a=e,null!=(null==n?void 0:n.paths)&&(l=n.paths)}else a=yield c;if(!Array.isArray(a))return __LOG__(3)`Received invalid business profile response`,null;if(0===a.length)return __LOG__(2)`Store:BusinessProfile:find No businessProfile found for ${String(e)}`,{id:e};const d=a[0],{wid:p,tag:f}=d,g={id:p,tag:f},{profile:m}=d;if(m){const t=h.ContactCollection.get(e);return t&&!t.isContactSyncCompleted&&(t.set("isBusiness",!0),t.set("forcedBusinessUpdateFromServer",!0)),(0,i.default)((0,i.default)({},(0,_.parseBusinessProfile)({id:d.wid,profile:m,queryCatalog:r,customUrlPaths:l})),g)}return g}))()}fetchBizProfile(e){const t=this.get(e);return t&&t.markStale(),this.find(e)}onResume(){this.filter((e=>e.stale&&e.hasObservers())).map((e=>this.find(e.id)))}handle(e){let[t]=e;t&&null!=t.tag||__LOG__(3)`Store:BusinessProfile:handle Received invalid update from server`;const n=this.gadd(t.wid);t.tag!==n.tag&&n.markStale()}getValid(e){const t=this.get(e);if(null==t?void 0:t.isValid())return t}markProfileAsStale(e){var t;null===(t=this.get(e))||void 0===t||t.markStale()}hasBusinessProfileInCache(e){return!!this.get(e)}_markBizProfilesAsStale(e){var t=this;return(0,a.default)((function*(){yield Promise.all(e.map((e=>(0,d.createUserWid)(e))).filter((e=>t.hasBusinessProfileInCache(e))).map((e=>{__LOG__(2)`[direct-connection] forcefully marking biz profile as stale`,t.markProfileAsStale(e)})))}))()}}t.BusinessProfileCollectionImpl=y,y.model=f.BusinessProfile,y.staleCollection=!0;const S=new y;t.BusinessProfileCollection=S},393170:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.businessTypeOptions=t.VERIFIED_LEVEL=t.DAYS_OF_WEEK=t.COMMERCE_EXPERIENCE_TYPES=t.BUSINESS_PROFILE_FIELDS_LENGTH=t.BUSINESS_HOUR_MODES=void 0;t.VERIFIED_LEVEL={UNKNOWN:0,LOW:1,HIGH:2};t.DAYS_OF_WEEK=["sun","mon","tue","wed","thu","fri","sat"];t.BUSINESS_HOUR_MODES={OPEN_24H:"open_24h",SPECIFIC_HOURS:"specific_hours",APPOINTMENT_ONLY:"appointment_only"};const r=n(76672)({CATALOG:"catalog",NONE:"none",SHOP:"shop"});t.COMMERCE_EXPERIENCE_TYPES=r;t.businessTypeOptions={limitedLiabilityPartnership:"Limited liability partnership",soleProprietorship:"Sole proprietorship",partnership:"Partnership",publicCompany:"Public Company",privateCompany:"Private Company",other:"Other"};t.BUSINESS_PROFILE_FIELDS_LENGTH={WEBSITE:256,DESCRIPTION:512,EMAIL:128,ADDRESS:256}},794010:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CATALOG_EXISTS=t.BUSINESS_OPEN_STATUS=void 0,t.getBusinessOpenState=C,t.hasShop=t.hasCatalog=t.goToShop=t.goToCommerceManager=void 0,t.isBusinessOpen=b,t.parseBusinessProfile=t.isShopBanned=t.isCompleteBizProfile=void 0,t.quickReplyHoursStr=function(e){const t=b(e)?_.fbt._("We're currently *open*",null,{hk:"1Skaff"}):_.fbt._("We're currently *closed*",null,{hk:"18eiaZ"}),n=_.fbt._("Our business hours are:",null,{hk:"Qljt"}),r=(0,l.getBusinessHours)(e,!0).map((e=>`${(0,o.default)(e.day)}: ${e.hours}`)).join("\n");return[t,n,r].join("\n")};var i=r(n(81109)),a=r(n(506479)),o=r(n(548403)),s=r(n(379264)),l=n(319496),c=n(348018),u=n(393170),d=n(599989),p=n(719380),f=n(964551),_=n(548360);const h=["business_hours","catalog_status","structured_address","profile_options","address","legal_entity_details","fb_page","ig_professional","profile_is_linked","cover_photo"],g="catalog_exists";t.CATALOG_EXISTS=g;const m=e=>{var t;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===u.COMMERCE_EXPERIENCE_TYPES.CATALOG||(null==e?void 0:e.catalog_status)===g};t.hasCatalog=e=>{var t;return e&&e instanceof c.BusinessProfile?(null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===u.COMMERCE_EXPERIENCE_TYPES.CATALOG||e.catalogStatus===g:m(e)};const y=e=>{var t,n;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===u.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(n=e.profileOptions)||void 0===n?void 0:n.shopURL)};t.hasShop=y;t.isShopBanned=e=>{var t,n;return(null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceExperience)===u.COMMERCE_EXPERIENCE_TYPES.NONE||y(e)&&!!(null==e||null===(n=e.profileOptions)||void 0===n?void 0:n.isBanned)};t.goToShop=e=>{var t;const n=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.shopURL;n&&s.default.open(n)};t.goToCommerceManager=e=>{var t;const n=null==e||null===(t=e.profileOptions)||void 0===t?void 0:t.commerceManagerURL;s.default.open(n||"https://business.facebook.com/commerce_manager/")};const S=e=>m(e)||f.ServerProps.shopsProductGrid&&(e=>{var t,n;return(null==e||null===(t=e.profile_options)||void 0===t?void 0:t.commerce_experience)===u.COMMERCE_EXPERIENCE_TYPES.SHOP&&Boolean(null==e||null===(n=e.profile_options)||void 0===n?void 0:n.shop_url)})(e),E=e=>{let{email:t,landline_number:n,mobile_number:r}=e;const i={email:t};return n&&(i.landlineNumber=n),r&&(i.mobileNumber=r),i},v=e=>{let{entity_name:t,entity_type:n,is_registered:r,entity_type_custom:i,customer_care_details:a,grievance_officer_details:o}=e;const s={entityName:t,entityType:n,isRegistered:r};return i&&(s.entityTypeCustom=i),a&&(s.customerCareDetails=(e=>{let{email:t,landline_number:n,mobile_number:r}=e;return E({email:t,landline_number:n,mobile_number:r})})(a)),o&&(s.grievanceOfficerDetails=(e=>{let{name:t,email:n,landline_number:r,mobile_number:i}=e;const a=E({email:n,landline_number:r,mobile_number:i});return a.name=t,a})(o)),s};t.parseBusinessProfile=e=>{let{profile:t,id:n,queryCatalog:r,customUrlPaths:o}=e;if(!t)return{id:n};const{business_hours:s,catalog_status:l,structured_address:f,profile_options:_,address:g,legal_entity_details:m,fb_page:y,ig_professional:E,profile_is_linked:T,cover_photo:C}=t,A=(0,a.default)(t,h),b={};return b.businessHours=s?(e=>{let{config:t,timezone:n}=e;const r={};return t.forEach((e=>{const{day_of_week:t,mode:n}=e;if(n===u.BUSINESS_HOUR_MODES.SPECIFIC_HOURS){const{open_time:i,close_time:a}=e;r[t]||(r[t]={mode:n,hours:[]}),null!=i&&null!=a&&r[t].hours&&r[t].hours.push([i,a])}else r[t]={mode:n}})),{config:r,timezone:n}})(s):null,_&&(b.profileOptions={},b.profileOptions.commerceExperience=_.commerce_experience,b.profileOptions.cartEnabled=_.cart_enabled,b.profileOptions.directConnection=_.direct_connection,null!=_.shop_url&&(b.profileOptions.shopURL=_.shop_url),null!=_.commerce_manager_url&&(b.profileOptions.commerceManagerURL=_.commerce_manager_url),null!=_.is_banned&&(b.profileOptions.isBanned=_.is_banned)),S(t)&&(b.catalogStatus=l,r&&d.CatalogCollection.findCarouselCatalog(n).then((e=>{const t=Array.isArray(e)?e[0]:e,r=p.ContactCollection.get(n);r&&(r.businessCatalog=t)})).catch((()=>__LOG__(3)`Store:BusinessProfile:missing catalog`))),f?b.structuredAddress={streetAddress:f.street_address,cityId:f.city_id,localizedCityName:f.localized_city_name,zipCode:f.zip_code}:b.address=g||null,m&&(b.legalEntityDetails=v(m)),y&&(b.fbPage={displayName:y.display_name,likes:y.likes,id:y.id}),E&&(b.igProfessional={handle:E.ig_handle,followers:E.followers}),null!=T&&(b.isProfileLinked=!!T),null!=o&&(b.customUrlPaths=o),b.coverPhoto=null!=C?{id:C.id,url:C.url}:null,(0,i.default)((0,i.default)((0,i.default)((0,i.default)({},c.DEFAULTS),A),b),{},{id:n})};t.isCompleteBizProfile=e=>{var t,n;return null!=e.address&&null!=e.description&&null!=(null===(t=e.businessHours)||void 0===t?void 0:t.config)&&0!==Object.keys(e.businessHours.config).length&&null!=e.email&&0!==(null===(n=e.website)||void 0===n?void 0:n.length)};const T={OPEN:"open",CLOSED:"closed",OPEN_TODAY:"open_today",CLOSED_TODAY:"closed_today",OPEN_APPOINTMENT:"open_appointment",OPEN_24H:"open_24h",UNKNOWN:"unknown"};function C(e,t){var n,r;if(null==e.timezone)return{status:"unknown"};const i=t||new Date,a=new Date(i.toLocaleString("en-US",{timeZone:e.timezone})),o=(i.getTime()-a.getTime())/1e3/60,s=e.config[u.DAYS_OF_WEEK[i.getDay()]];if(!s)return{status:T.CLOSED_TODAY};switch(s.mode){case u.BUSINESS_HOUR_MODES.OPEN_24H:if(s)return{status:T.OPEN_24H};break;case u.BUSINESS_HOUR_MODES.APPOINTMENT_ONLY:if(s)return{status:T.OPEN_APPOINTMENT};break;case u.BUSINESS_HOUR_MODES.SPECIFIC_HOURS:const e=60*i.getHours()+i.getMinutes();if(1===(null===(n=s.hours)||void 0===n?void 0:n.length)){const t=s.hours[0][0],n=s.hours[0][1];return e>=t&&e<=n?{status:T.OPEN,openUntil:A(o+n)}:e<=t?{status:T.CLOSED,opensAt:A(o+t)}:{status:T.CLOSED}}if(2===(null===(r=s.hours)||void 0===r?void 0:r.length)){const t=s.hours[0][0],n=s.hours[0][1],r=s.hours[1][0],i=s.hours[1][1];return e>=t&&e<=n?{status:T.OPEN,openUntil:A(o+n),additionalOpen:A(o+r),additionalClose:A(o+i)}:e<t?{status:T.CLOSED,opensAt:A(o+t),additionalOpen:A(o+r),additionalClose:A(o+i)}:e>=r&&e<=i?{status:T.OPEN,openUntil:A(o+i)}:e<r?{status:T.CLOSED,opensAt:A(o+r)}:{status:T.CLOSED}}}return{status:"unknown"}}function A(e){const t=new Date,n=Math.floor(e/60);return t.setHours(n),t.setMinutes(e%60),t.setSeconds(0),t}function b(e){switch(C(e).status){case T.OPEN_24H:case T.OPEN_APPOINTMENT:case T.OPEN:return!0;case T.CLOSED:case T.CLOSED_TODAY:default:return!1}}t.BUSINESS_OPEN_STATUS=T},565999:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(457037),i=n(411290);class a extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.products=(0,i.prop)(),this.itemCount=(0,i.prop)(),this.total=(0,i.prop)(),this.currency=(0,i.prop)(),this.message=(0,i.prop)()}countTotals(){const e=this.cartItemCollection.reduce(((e,t)=>{var n;return e.currency.add(t.currency),{itemCount:e.itemCount+t.quantity,total:e.total+t.quantity*(null!==(n=t.priceAmount1000)&&void 0!==n?n:0),currency:e.currency}}),{itemCount:0,total:0,currency:new Set}),t=1===e.currency.size,n={itemCount:e.itemCount,total:t?e.total:null,currency:t?e.currency.values().next().value:null};this.set(n,{silent:!0})}initialize(){super.initialize(),this.cartItemCollection=new r.CartItemCollection,this.listenTo(this,"change:cartItemCollection",this.countTotals)}getCollection(){return n(612392).CartCollection}}a.Proxy="cart";var o=(0,i.defineModel)(a);t.default=o},612392:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CartCollectionImpl=t.CartCollection=void 0;var i=n(88555),a=n(491442),o=r(n(565999)),s=n(317239),l=n(801255),c=n(714648);class u extends l.BaseCollection{constructor(e,t){super(),this.imageWidth=100,this.imageHeight=100,null!=e&&(this.imageWidth=e),null!=t&&(this.imageHeight=t)}saveToCache(){if(!(0,i.isMDBackend)())try{if(!s.Conn.shouldSaveToCache())return;const e=this.reduce(((e,t)=>{const{cartItemCollection:n,itemCount:r,total:i,currency:a,id:o,message:s}=t,l=n.map((e=>({id:e.id,priceAmount1000:e.priceAmount1000,currency:e.currency,name:e.name,quantity:e.quantity,imageHash:e.imageHash})));return l.length>0&&e.push({id:o,products:l,itemCount:r,total:i,currency:a,message:s}),e}),[]);a.userPreferencesStore.setCollection(u.cachePolicy.id,e,!0)}catch(e){__LOG__(3)`Error while saving carts to cache, ${String(e)}`}}initializeFromCache(e){try{(e||[]).forEach((e=>{const t=new o.default({id:e.id,itemCount:e.itemCount,total:e.total,currency:e.currency,message:e.message});t.cartItemCollection.add(e.products),this.add(t,{merge:!0})}))}catch(e){__LOG__(3)`Error while restoring carts from cache, ${String(e)}`}}findCart(e){return this.gadd(e)}}t.CartCollectionImpl=u,u.model=o.default,u.cachePolicy={id:"cart_collection",policy:c.CACHE_POLICY.LOAD,delay:2e3};const d=new u;t.CartCollection=d},109581:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_QUANTITY=t.CartItem=void 0;var r=n(411290);t.MAX_QUANTITY=99;class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.priceAmount1000=(0,r.prop)(),this.currency=(0,r.prop)(),this.name=(0,r.prop)(),this.quantity=(0,r.prop)(),this.imageHash=(0,r.prop)(),this.imageCdnUrl=(0,r.prop)(),this.maxAvailable=(0,r.prop)()}getCollection(){return n(612392).CartCollection}}i.Proxy="cart-item";const a=(0,r.defineModel)(i);t.CartItem=a},457037:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CartItemCollection=void 0;var r=n(109581),i=n(801255);class a extends i.BaseCollection{}t.CartItemCollection=a,a.model=r.CartItem},621423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(801255),i=n(17304);class a extends r.BaseCollection{constructor(){super(...arguments),this.hasProductBefore=!0}delete(){super.delete(),this.stopListening(),this.reset()}queryProducts(e){const t=e.msgs;this.hasProductBefore=!1;const n=t.filter((e=>null!=e.asProduct));return 0===n.length?this.trigger("products_loaded"):this.add(n,{at:0}),Promise.resolve()}}t.default=a,a.model=i.Msg,a.comparator=(e,t)=>e.t-t.t},534535:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InteractiveMessageHeaderMediaType=t.IM_MEDIA_HEADER_TYPES=void 0;const r=n(76672).Mirrored(["IMAGE","VIDEO","DOCUMENT"]);t.InteractiveMessageHeaderMediaType=r;const i=new Set([r.IMAGE,r.VIDEO,r.DOCUMENT]);t.IM_MEDIA_HEADER_TYPES=i},384064:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(76672)({NATIVE_FLOW:"native_flow",SHOPS_STOREFRONT:"shops_storefront"});t.default=r},414482:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(76672)({NATIVE_FLOW:"native_flow"});t.default=r},905165:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(76672)({ORDER_DETAILS:"order_details",ORDER_STATUS:"order_status"});t.default=r},208803:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Label=void 0,t.intColorToHex=u;var r=n(88555),i=n(333037),a=n(859846),o=n(634741),s=n(317239),l=n(411290);class c extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.name=(0,l.prop)(),this.colorIndex=(0,l.prop)(),this.color=(0,l.prop)(),this.count=(0,l.prop)(),this.stale=(0,l.session)(!0),this.hexColor=(0,l.derived)((function(){if((0,r.isMDBackend)()){const e=this.colorIndex;if(null==e)return;return s.Conn.platform===s.PLATFORMS.SMBI?a.IPHONE_LABEL_COLOR_PALETTE[e]:a.ANDROID_LABEL_COLOR_PALETTE[e]}if(this.color)return u(this.color)}),["color","colorIndex"])}initialize(){super.initialize(),this.labelItemCollection=new o.LabelItemCollection,this._triggerLabelUpdate(),this.listenTo(this,"change:name",this._triggerLabelUpdate),this.listenTo(this,"change:color",this._triggerLabelUpdate),this.listenTo(this,"change:colorIndex",this._triggerLabelUpdate),this.listenTo(this,"change:count",this._triggerLabelUpdate),(0,r.isMDBackend)()&&(this.listenTo(this.labelItemCollection,"add",this._handleLabelItemCollectionUpdate),this.listenTo(this.labelItemCollection,"remove",this._handleLabelItemCollectionUpdate))}_find(e){return Promise.resolve({id:e})}_triggerLabelUpdate(){this.name&&n(316770).LabelCollection.trigger(`label_updated_${this.id}`)}_handleLabelItemCollectionUpdate(){const e=this.labelItemCollection.filter((e=>e.parentType!==i.LabelItemParentType.Contact)).length;this.count=String(e)}}function u(e){return`#${(parseInt(e,10)>>>0).toString(16).slice(-6)}`}c.Proxy="label";const d=(0,l.defineModel)(c);t.Label=d},316770:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelCollectionImpl=t.LabelCollection=void 0;var i=r(n(348926)),a=r(n(82729)),o=n(389385),s=n(180284),l=n(450796),c=n(413959),u=n(904352),d=n(492574),p=n(88555),f=n(333037),_=n(864795),h=r(n(312523)),g=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=L(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),m=n(694816),y=n(555452),S=n(208803),E=n(859846),v=r(n(656891)),T=n(245741),C=r(n(914296)),A=n(550047),b=r(n(11339)),P=n(446331),O=n(317239),M=n(801255),I=n(765044),w=n(82663),R=n(548360),N=n(785893);function L(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(L=function(e){return e?n:t})(e)}class D extends M.BaseCollection{constructor(){super(),this.checksum=void 0,this.listenTo(this,"remove",this.handleRemove)}initializeAssociationsFromCache(e){e.forEach((e=>{let{labelId:t,associationId:n,type:r}=e;(0,_.addToLabelCollection)(n,[t],r===w.LabelAssociationType.Jid?f.LabelItemParentType.Chat:f.LabelItemParentType.Msg)}))}addNewLabel(e,t){if((0,p.isMDBackend)())throw new Error("This call is only supported in non-MD mode");(0,A.logLabelOperationEvent)(b.default.LABEL_OPERATIONS.ADD,1,b.default.LABEL_TARGETS.LABEL);const n=v.default.createLabel(e,t),r=new P.ActionType(R.fbt._("Adding new label: {labelName}",[R.fbt._param("labelName",e)],{hk:"4iHRrD"})),i=(0,P.genId)(),a=n.then((t=>{let{status:n}=t;return 200===n?new P.ActionType(R.fbt._("Label: {labelName} added successfully",[R.fbt._param("labelName",e)],{hk:"V8AxR"})):new P.ActionType(R.fbt._("Failed to add label: {labelName}",[R.fbt._param("labelName",e)],{hk:"43DyqL"}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new P.ActionType(R.fbt._("Failed to add label: {labelName}",[R.fbt._param("labelName",e)],{hk:"43DyqL"})))));return m.ToastManager.open((0,N.jsx)(P.ActionToast,{id:i,initialAction:r,pendingAction:a})),n}removeAllLabelsMD(e){return this.addOrRemoveLabelsMD((e.labels||[]).map((e=>({type:"remove",id:e}))),[e])}addOrRemoveLabelsMD(e,t){(0,p.isLegacyWebdBackend)()||e.forEach((e=>{let{id:n,type:r}=e;t.forEach((e=>{const t=(0,_.getParentTypeFromModel)(e),i=e.id.toString();"add"===r?(0,_.addToLabelCollection)(i,[n],t):(0,_.removeLabelFromCollection)(i,n,t)}))}))}addOrRemoveLabels(e,t){const n=(0,P.genId)(),r=new P.ActionType(C.default.t(5,{count:e.length,_plural:e.length})),i=(0,T.editLabelAssociation)(e,t).then((()=>{this.addOrRemoveLabelsMD(e,t)})).then((()=>new P.ActionType(C.default.t(7,{count:e.length,_plural:e.length})))).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new P.ActionType(C.default.t(6)))));m.ToastManager.open((0,N.jsx)(P.ActionToast,{id:n,initialAction:r,pendingAction:i}))}deleteLabel(e){(0,A.logLabelOperationEvent)(b.default.LABEL_OPERATIONS.DELETE,1,b.default.LABEL_TARGETS.LABEL);const t=v.default.deleteLabel(e),n=this.get(e);if(!n)return void __LOG__(2)`deleteLabel - label does not exist`;const{name:r}=n,i=new P.ActionType(R.fbt._("Deleting label: {labelName}",[R.fbt._param("labelName",r)],{hk:"3KvQE"})),a=(0,P.genId)(),o=t.then((e=>{let{status:t}=e;return 200===t?new P.ActionType(R.fbt._("Deleted label: {labelName}",[R.fbt._param("labelName",r)],{hk:"4bqQlK"})):new P.ActionType(R.fbt._("Deleting label: {labelName} failed",[R.fbt._param("labelName",r)],{hk:"1j0DXC"}))})).catch((()=>(__LOG__(3)`addingNewLabel dropped`,new P.ActionType(R.fbt._("Deleting label: {labelName} failed",[R.fbt._param("labelName",r)],{hk:"1j0DXC"})))));return m.ToastManager.open((0,N.jsx)(P.ActionToast,{id:a,initialAction:i,pendingAction:o})),t}_getActionLabelUpdateString(e,t){switch(e){case E.LABEL_PROPERTIES.NAME:return t===E.UPDATE_STATUS.UPDATING?R.fbt._("Updating label name",null,{hk:"2FancO"}):t===E.UPDATE_STATUS.SUCCEEDED?R.fbt._("Label name updated",null,{hk:"Nacb5"}):R.fbt._("Label name update failed",null,{hk:"33PW5z"});case E.LABEL_PROPERTIES.COLOR:return t===E.UPDATE_STATUS.UPDATING?R.fbt._("Updating label color",null,{hk:"49XPdJ"}):t===E.UPDATE_STATUS.SUCCEEDED?R.fbt._("Label color updated",null,{hk:"2cuEYz"}):R.fbt._("Label color update failed",null,{hk:"Dzw1J"})}return""}updateLabel(e,t){(0,A.logLabelOperationEvent)(b.default.LABEL_OPERATIONS.EDIT,1,b.default.LABEL_TARGETS.LABEL);const n=v.default.editLabel(e.id,e.name,e.color),r=new P.ActionType(this._getActionLabelUpdateString(t,E.UPDATE_STATUS.UPDATING)),i=(0,P.genId)(),a=n.then((e=>{let{status:n}=e;return 200===n?new P.ActionType(this._getActionLabelUpdateString(t,E.UPDATE_STATUS.SUCCEEDED)):new P.ActionType(this._getActionLabelUpdateString(t,E.UPDATE_STATUS.FAILED))})).catch((()=>(__LOG__(3)`updatingLabel dropped`,new P.ActionType(this._getActionLabelUpdateString(t,E.UPDATE_STATUS.FAILED)))));return m.ToastManager.open((0,N.jsx)(P.ActionToast,{id:i,initialAction:r,pendingAction:a})),n}getNewLabelColor(){return(0,i.default)((function*(){try{return(yield v.default.queryNextLabelColor()).labelColors[0].color}catch(e){return}}))()}getLabelColorPalette(){return this.labelColorPalette=this.labelColorPalette||(0,y.getSmbLabelPalette)(),this.labelColorPalette&&this.labelColorPalette.waVersion===O.Conn.phone.wa_version?Promise.resolve(this.labelColorPalette.colors):this._getColorPaletteLoop().then((e=>{const t=e.labelColors.map((e=>{let{color:t}=e;return t}));return(0,y.setSmbLabelPalette)({colors:t,waVersion:O.Conn.phone.wa_version}),t})).catch((()=>{}))}_getColorPaletteLoop(){return(0,u.promiseLoop)(((e,t,n)=>{const r=(0,c.delayMs)((0,s.expBackoff)(n,12e4,1e3,.1));return("CONNECTED"===I.Socket.stream?Promise.resolve():(0,h.default)(I.Socket,"change:stream",(()=>"CONNECTED"===I.Socket.stream))).then((()=>v.default.queryLabelPalette().then((t=>{e(t)})))).catch((e=>{if(e.name===o.ABORT_ERROR)throw e;return n>3||404===e?(__LOG__(3)`labels:loadLabelPalette:error ${String(e)}`,404===e?Promise.reject(new d.E404):Promise.reject(new g.GaveUpRetry(`Gave up loading label palette ${n} tries`))):r}))}),0)}handleRemove(e){const{labelItemCollection:t}=e;t.toArray().forEach((e=>{const{parentId:t,parentType:n,labelId:r}=e,i=(0,_.getParentCollection)(n).get(t);i&&(i.labels=(0,a.default)(i.labels,(e=>e!==r)))}))}onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,l.filteredCatch)(d.WebdDrop,(()=>{})))}))}delete(){super.delete(),delete this.checksum}sync(e){if(!e||this.checksum!==e)return this.findQuery({}).catch((0,l.filteredCatch)([d.WebdDrop,g.ProtoVersionUndefined],(()=>{})))}handle(e){var t,n;if(e.checksum&&this.updateChecksum(e.checksum),null===(t=e.labels)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.labelUpdates){let t;return e.labels[0].labelUpdates.forEach((e=>{e.collection.forEach((n=>{n!==f.LabelItemParentType.Msg&&n!==f.LabelItemParentType.Chat||(t=!0);const r=e.id,i=(0,_.getParentCollection)(n).get(e.id);i&&(i.labels&&i.labels.forEach((t=>{e.labels.includes(t)||(0,_.removeLabelFromCollection)(r,t,n)})),i.labels=e.labels)}))})),void(t&&this.trigger("bulk_msg_chat_label_change"))}const r=[],i=[];e.labels.forEach((e=>{"delete"===e.type?r.push(e.label):i.push(e.label)})),this.remove(r.map((e=>{let{id:t}=e;return t}))),this.add(i,{merge:!0})}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield v.default.queryLabels();return t.checksum&&e.updateChecksum(t.checksum),t.labels}))()}_find(){return this._findQuery()}updateChecksum(e){this.checksum=e}getLabelsForModel(e,t){return this.filter((n=>n.labelItemCollection.get((0,_.createLabelItemId)(e,n.id,t)))).map((e=>e.id))}}t.LabelCollectionImpl=D,D.model=S.Label,D.staleCollection=!0,D.resumeOnAvailable=!0;const k=new D;t.LabelCollection=k},859846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UPDATE_STATUS=t.LABEL_PROPERTIES=t.IPHONE_LABEL_COLOR_PALETTE=t.ANDROID_LABEL_COLOR_PALETTE=void 0;t.ANDROID_LABEL_COLOR_PALETTE=["#FF9485","#64C4FF","#FFD429","#DFAEF0","#99B6C1","#55CCB3","#FF9DFF","#D3A91D","#6D7CCE","#D7E752","#00D0E2","#FFC5C7","#93CEAC","#F74848","#00A0F2","#83E422","#FFAF04","#B5EBFF","#9BA6FF","#9368CF"];t.IPHONE_LABEL_COLOR_PALETTE=["#A62C71","#90A841","#C1A03F","#792138","#AE8774","#F0B330","#B6B327","#C69FCC","#8B6990","#FF8A8C","#54C265","#FF7B6B","#26C4DC","#57C9FF","#74676A","#7E90A3","#5696FF","#6E257E","#7ACBA5","#243640"];const n=Object.freeze({NAME:"name",COLOR:"color"});t.LABEL_PROPERTIES=n;const r=Object.freeze({UPDATING:"updating",SUCCEEDED:"succeeded",FAILED:"failed"});t.UPDATE_STATUS=r},724137:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n(333037);var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.parentType=(0,r.prop)(),this.parentId=(0,r.prop)(),this.labelId=(0,r.prop)()}}i.Proxy="labelItem";var a=(0,r.defineModel)(i);t.default=a},634741:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelItemCollection=void 0;var i=r(n(82569)),a=n(88555),o=n(864795),s=r(n(724137)),l=n(801255);class c extends l.BaseCollection{constructor(){super(),(0,a.isMDBackend)()&&(this.listenTo(this,"add",this._handleAdd),this.listenTo(this,"remove",this._handleRemove))}_handleAdd(e){this._handleChange(e,!0)}_handleRemove(e){this._handleChange(e,!1)}_handleChange(e,t){const n=(0,o.getParentCollection)(e.parentType).get(e.parentId);if(!n)return;const r=n.labels||[];t?r.includes(e.labelId)||(n.labels=[e.labelId].concat(r)):n.labels=(0,i.default)(r,e.labelId)}}t.LabelItemCollection=c,c.model=s.default},286761:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(852822)),o=n(823412),s=n(411290);class l extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.products=(0,s.prop)(),this.itemCount=(0,s.prop)(),this.subtotal=(0,s.prop)(),this.tax=(0,s.prop)(),this.total=(0,s.prop)(),this.currency=(0,s.prop)(),this.createdAt=(0,s.prop)(),this.sellerJid=(0,s.prop)(),this.totalItemCount=(0,s.derived)((function(){return this.products.reduce(((e,t)=>e+t.quantity),0)}),["products"])}initialize(){super.initialize(),this.orderItemCollection=new o.OrderItemCollection,this.listenTo(this,"change:cartItemCollection",this.triggerItemCollectionUpdate),this.triggerItemCollectionUpdate()}triggerItemCollectionUpdate(){this.orderItemCollection.set(this.products.map((e=>new a.default((0,i.default)({},e)))),{merge:!0})}getCollection(){return n(584312).OrderCollection}}l.Proxy="order";var c=(0,s.defineModel)(l);t.default=c},584312:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OrderCollectionImpl=t.OrderCollection=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(802331),s=r(n(133374)),l=n(615947),c=n(978820),u=n(745454),d=r(n(286761)),p=n(939519),f=n(92059),_=n(801255);class h extends _.BaseCollection{constructor(e,t){super(),this.width=80,this.height=80,null!=e&&(this.width=e),null!=t&&(this.height=t)}addOrder(){const e=(0,s.default)(),t=(0,c.getMeUser)();return super.add({id:e,fetchedFromServer:!1,sellerJid:(0,l.encodeJid)(t),createdAt:Math.round((new Date).getTime()/1e3),currency:(0,p.currencyForCountryShortcode)((0,f.getCountryShortcodeByPhone)(t.user)),products:[],tax:null,subtotal:null,total:null}),this.assertGet(e)}findOrder(e,t,n){const r=this.get(e);return null!=r?Promise.resolve(r):this._queryOrder(e,t,n)}_queryOrder(e,t,n){var r=()=>super.add,s=this;return(0,a.default)((function*(){const a=yield(0,o.queryOrder)((0,u.createWid)(t),e,s.width,s.height,n);r().call(s,(0,i.default)({id:e,fetchedFromServer:!0,sellerJid:t},a));const l=s.get(e);if(null!=l)return Promise.resolve(l)}))()}}t.OrderCollectionImpl=h,h.model=d.default,h.staleCollection=!0;const g=new h;t.OrderCollection=g},852822:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(502320)),a=n(58668),o=n(411290);class s extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.price=(0,o.prop)(),this.currency=(0,o.prop)(),this.name=(0,o.prop)(),this.quantity=(0,o.prop)(),this.thumbnailId=(0,o.prop)(),this.thumbnailUrl=(0,o.prop)(),this.isCustomItem=(0,o.prop)(),this.isQuantitySet=(0,o.prop)(),this.mediaData=(0,o.derived)((function(){return new i.default({mediaStage:null!=this.thumbnailUrl?a.MEDIA_DATA_STAGE.RESOLVED:a.MEDIA_DATA_STAGE.PREPARING,renderableUrl:null!=this.thumbnailUrl?`${this.thumbnailUrl}`:null})}),["thumbnailUrl"])}getCollection(){return n(584312).OrderCollection}}s.Proxy="order-item";var l=(0,o.defineModel)(s);t.default=l},823412:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.OrderItemCollection=void 0;var i=r(n(852822)),a=n(801255);class o extends a.BaseCollection{}t.OrderItemCollection=o,o.model=i.default},652388:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(895697),s=r(n(389867)),l=n(509468),c=n(912496),u=n(105641),d=n(621374),p=n(411290);class f extends p.BaseModel{constructor(){super(...arguments),this.id=(0,p.prop)(),this.afterCursor=(0,p.prop)(),this.index=(0,p.prop)(),this.hasCatalogCategories=(0,p.prop)(),this.fetchedFromServer=(0,p.session)(),this._products=(0,p.session)(),this._msgs=(0,p.session)()}initialize(){super.initialize(),this.productCollection=new u.ProductCollection,this.msgProductCollection=new u.ProductCollection,this.collections=new c.ProductCollCollection,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.listenTo(this,"change:_msgs",this.triggerMsgUpdate),this.triggerProductUpdate(),this.triggerMsgUpdate()}triggerProductUpdate(){this._products&&this.productCollection.add(this._products,{merge:!0}),this._products=void 0}triggerMsgUpdate(){this._msgs&&this.msgProductCollection.add(this._msgs,{merge:!0}),this._msgs=void 0}markProductCollectionOld(){this.productCollection.forEach((e=>e.markOld()))}addProduct(e){var t=this;return(0,i.default)((function*(){const{id:n}=t,r=yield(0,o.addProduct)(e),i=t.productCollection.at(0);r.catalogWid=n,r.index=i?i.index-1:0;const s=t.productCollection.add(r,{merge:!0,at:0})[0];return(0,a.default)(s,"addedProduct")}))()}editProduct(e){var t=this;return(0,i.default)((function*(){const n=yield(0,o.editProduct)(e),r=t.productCollection.add(n,{merge:!0})[0];return t.collections&&t.collections.forEach((t=>{t.productCollection.get(e.id)&&t.productCollection.add(n,{merge:!0})})),(0,a.default)(r,"editedProduct")}))()}refreshProduct(e){var t=this;return(0,i.default)((function*(){const n=t.productCollection.get(e);n&&(n.stale=!0);const r=yield(0,o.queryProduct)(t.id,e);if(null!=r.data){const i=(0,d.mapProductResponseToModel)(r.data,t.id);n&&t.productCollection.add(i,{merge:!0}),t.collections&&t.collections.forEach((t=>{t.productCollection.get(e)&&t.productCollection.add(i,{merge:!0})}))}}))()}pullProduct(e,t){var n=this;return(0,i.default)((function*(){const r=yield(0,o.queryProduct)(n.id,e,void 0,void 0,void 0,t);if("NOT_FOUND"===r.error&&n.productCollection.remove(e),null!=r.data){const e=new l.Product((0,d.mapProductResponseToModel)(r.data,n.id));n.updateProduct(e)}}))()}updateProduct(e){this.productCollection.add(e,{merge:!1})}getCollection(){return n(599989).CatalogCollection}}f.Proxy="catalog",f.idClass=s.default;var _=(0,p.defineModel)(f);t.default=_},599989:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CatalogCollectionImpl=t.CatalogCollection=void 0;var i=r(n(348926)),a=n(551737),o=n(492574),s=n(895697),l=(n(665397),n(669393)),c=n(745454),u=r(n(652388)),d=n(578711),p=n(621374),f=n(801255),_=n(964551);class h extends f.BaseCollection{addMsgAsProduct(e){const t=e.businessOwnerJid&&(0,c.createWid)(e.businessOwnerJid);if(!t)return;const n=this.get(t),r=n&&e.productId&&n.msgProductCollection.get(e.productId),i=n&&e.productId?n.productCollection.get(e.productId):null;if((null==i?void 0:i.t)&&i.t>=e.t)return;if(null==r?void 0:r.fetchedFromServer)return;const a=(0,p.mapMsgToProductModel)(e);return super.add({id:t,afterCursor:void 0,_msgs:[a],stale:!0,fetchedFromServer:!!i},{merge:!0})}_queryProduct(e){var t=()=>super.add,n=this;let{catalogWid:r,productId:a,productMsgMediaData:l,width:c,height:u,shouldFetchComplianceFields:d,canLogQpl:f}=e;return(0,i.default)((function*(){const e=yield(0,s.queryProduct)(r,a,c,u,d,f);if("NOT_FOUND"===e.error){const e=n.get(r);return null==e||e.productCollection.remove(a),Promise.reject(new o.E404("CatalogCollection:findProduct:_queryProduct NOT_FOUND"))}if(!e.data)return t().call(n,{id:r,afterCursor:void 0});const{data:i}=e;if(!i.image_cdn_urls)return Promise.reject(new Error("CatalogCollection:findProduct:_queryProduct: could not find image_cdn_urls for product"));const _=(0,p.mapProductResponseToModel)(i,r);_.productMsgMediaData=l;const h=[_];return t().call(n,{id:r,afterCursor:void 0,_products:h,_msgs:h},{merge:!0})}))()}findProduct(e){let{catalogWid:t,productId:n,productMsgMediaData:r,shouldFetchComplianceFields:i,canLogQpl:a}=e;return n?this._queryProduct({catalogWid:t,productId:n,productMsgMediaData:r,shouldFetchComplianceFields:i,canLogQpl:a}):Promise.reject(new Error("CatalogCollection:findProduct Received productId type "+(void 0===n?"undefined":"null")))}_queryCatalog(e,t,n,r,a,o){return(0,i.default)((function*(){const i=e?e.index:0;o&&l.QPL.markerPoint(o,"datasource_catalog_start");const c=yield(0,s.queryCatalog)(t,n,10,void 0,void 0,r,a);if(o&&l.QPL.markerPoint(o,"datasource_catalog_end"),!c.data.length)return{id:t,afterCursor:null};const u=[];return c.data.forEach((e=>{e.image_cdn_urls&&u.push((0,p.mapProductResponseToModel)(e,t))})),{id:t,afterCursor:c.paging.cursors.after,_products:u,fetchedFromServer:!0,index:i+u.length}}))()}_findQuery(e,t){const n=this.get(e),r=n&&!n.stale?n.afterCursor:void 0;return this._queryCatalog(n,e,r,void 0,void 0,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}findCarouselCatalog(e){var t=()=>super.add,n=this;return(0,i.default)((function*(){const r=n.get(e),i=(0,a.isString)(e)?(0,c.createWid)(e):e;r&&r.set({index:0});const o=yield n._queryCatalog(r,i,void 0,void 0,Boolean(_.ServerProps.shopsProductGrid));return r&&r.markProductCollectionOld(),t().call(n,o,{merge:!0})}))()}findNextProductPage(e,t){var n=this;return(0,i.default)((function*(){!0===t&&(0,d.qplPointCatalogView)("datasource_start");const r=yield n.update(e);!0===t&&(0,d.qplPointCatalogView)("datasource_end");return(Array.isArray(r)?r[0]:r).productCollection.getProductModels()}))()}findCollectionMembership(e,t){var n=()=>super.add,r=this;return(0,i.default)((function*(){let i=r.get(e);const o=(0,a.isString)(e)?(0,c.createWid)(e):e,s=i&&!i.stale?i.afterCursor:void 0,l=yield r._queryCatalog(i,o,s,t);n().call(r,l,{merge:!0}),i=r.get(e),i&&(i.stale=!1)}))()}removeCatalog(e){const t=this.get(e);t?this.remove(t):__LOG__(4,void 0,new Error)`Catalog data cleanup called on a non-existent catalogId`}}t.CatalogCollectionImpl=h,h.model=u.default,h.staleCollection=!0;const g=new h;t.CatalogCollection=g},578711:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplPointCatalogView=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_CATALOG_VIEW,e)},t.qplPointProductMessageSend=function(e){i.QPL.markerPoint(r.QuickLogMarkerId.WHATSAPP_PRODUCT_MESSAGE_SEND,e)};var r=n(665397),i=n(669393)},509468:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Product=t.MIN_PRICE=t.MAX_PRODUCT_IMAGES=t.MAX_PRICE=void 0;var i=n(565885),a=n(307514),o=r(n(502320)),s=n(58668),l=n(411290);t.MIN_PRICE=0;t.MAX_PRICE=4503599627370496;t.MAX_PRODUCT_IMAGES=10;class c extends l.BaseModel{constructor(){super(...arguments),this.old=(0,l.session)(!1),this.checkmark=(0,l.session)(!1),this.id=(0,l.prop)(),this.isHidden=(0,l.prop)(),this.catalogWid=(0,l.prop)(),this.url=(0,l.prop)(),this.name=(0,l.prop)(),this.description=(0,l.prop)(),this.availability=(0,l.prop)(),this.maxAvailable=(0,l.prop)(),this.reviewStatus=(0,l.prop)(),this.canAppeal=(0,l.prop)(),this.currency=(0,l.prop)(),this.priceAmount1000=(0,l.prop)(),this.salePriceAmount1000=(0,l.prop)(),this.salePriceStartDate=(0,l.prop)(),this.salePriceEndDate=(0,l.prop)(),this.retailerId=(0,l.prop)(),this.productImageCollection=(0,l.session)(),this.imageCount=(0,l.prop)(),this.index=(0,l.prop)(),this.additionalImageCdnUrl=(0,l.prop)(),this.additionalImageHashes=(0,l.prop)(),this.imageCdnUrl=(0,l.prop)(),this.imageHash=(0,l.prop)(),this.complianceInfo=(0,l.prop)(),this.productMsgMediaData=(0,l.session)(),this.fetchedFromServer=(0,l.session)(),this.t=(0,l.prop)()}initialize(){super.initialize(),this.productImageCollection=new a.ProductImageCollection,this.listenTo(this,"change:imageCdnUrl",this.triggerMainImageUpdate),this.initImageUpdate()}triggerAdditionalImageUpdate(){var e;let t=0;null===(e=this.additionalImageCdnUrl)||void 0===e||e.forEach(((e,n)=>{this.productImageCollection.gadd({id:`_${n+1}`,mediaUrl:e,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}),t=n+1})),this.productImageCollection.filter(((e,n)=>n>t)).forEach((e=>e.markOld()))}triggerMainImageUpdate(){var e;this.imageCdnUrl?this.productImageCollection.gadd({id:"_0",mediaUrl:this.imageCdnUrl,fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0}):null===(e=this.productImageCollection.get("_0"))||void 0===e||e.markOld()}initImageUpdate(){if(this.fetchedFromServer||!this.productMsgMediaData)this.triggerMainImageUpdate();else for(let e=0;e<this.imageCount;e++)this.productImageCollection.gadd({id:`_${e}`,type:"product",mediaData:new o.default({mediaStage:s.MEDIA_DATA_STAGE.PREPARING}),fetchedFromServer:this.fetchedFromServer,old:!1},{merge:!0})}markOld(){this.old=!0}lazyloadProductImageCollection(){return this.triggerAdditionalImageUpdate(),this.productImageCollection}getProductImageCollectionCount(){return this.productImageCollection.length}getProductImageCollectionHead(){return this.productImageCollection.head()}getHeadImageFile(){var e;const{productImageCollection:t,name:n}=this,r=t.head();if(!r)return;let a;const o=null===(e=r.mediaData)||void 0===e?void 0:e.mediaBlob;if(o._blob&&(a=o._blob),!a)return;return(0,i.createFile)([a],`${n}.jpg`,{type:"image/jpeg"})}evictImagesFromCache(){this.productImageCollection.forEach((e=>e.evictFromCache()))}getPreviewImage(){return this.productImageCollection.head()}getCollection(){return this.collection}}c.Proxy="product";const u=(0,l.defineModel)(c);t.Product=u},991450:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createProductMsgSnapshot=S,t.sendProductMessage=function(){return E.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(115461),l=n(694816),c=n(578711),u=n(713151),d=r(n(11339)),p=n(950452),f=n(480666),_=r(n(314075)),h=n(548360),g=n(785893);function m(){return y.apply(this,arguments)}function y(){return(y=(0,a.default)((function*(e,t){const n=(0,o.default)(new _.default({chatParticipantCount:t}),"new AttachMediaCollection({\n  chatParticipantCount\n})");if((0,c.qplPointProductMessageSend)("image_upload_start"),yield n.processAttachments([{file:e}],d.default.MEDIA_PICKER_ORIGIN_TYPE.CHAT_PHOTO_LIBRARY),(0,c.qplPointProductMessageSend)("image_upload_end"),!n.canSend())return;const r=n.getPreviewableMedias();if(1!==r.length)return;const[i]=r;return i.caption||(i.caption=void 0),i}))).apply(this,arguments)}function S(e){return(0,i.default)((0,i.default)({businessOwnerJid:e.catalogWid.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),title:e.name,description:e.description},0===e.priceAmount1000?{priceAmount1000:null,currencyCode:null}:{currencyCode:e.currency,priceAmount1000:e.priceAmount1000}),{},{salePriceAmount1000:(0,u.isSalePriceActive)(e)?e.salePriceAmount1000:null})}function E(){return(E=(0,a.default)((function*(e,t,n){const r=t.getHeadImageFile();if(!r)throw l.ToastManager.open((0,g.jsx)(p.Toast,{msg:h.fbt._("Can not send product before media is ready",null,{hk:"1dON6O"}),id:(0,p.genId)()})),new Error("Tried to send product message. Media file is not available.");const a=e.getParticipantCount(),o=yield m(r,a);if(!o)throw l.ToastManager.open((0,g.jsx)(p.Toast,{msg:h.fbt._("Can not send product before media is ready",null,{hk:"1dON6O"}),id:(0,p.genId)()})),new Error("Tried to send product message. Media data is not available.");const c={quotedMsg:n,caption:o.caption,addEvenWhilePreparing:o.previewable&&o.state===f.ATTACH_MEDIA_STATE.PROCESSING,useBasePropsType:!0};o.sendToChat(e,(0,i.default)((0,i.default)({},c),{},{type:s.MSG_TYPE.PRODUCT,productMsgOptions:S(t)}))}))).apply(this,arguments)}},394629:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(105641),i=n(411290);class a extends i.BaseModel{constructor(){super(...arguments),this.id=(0,i.prop)(),this.name=(0,i.prop)(),this.isHidden=(0,i.prop)(),this.reviewStatus=(0,i.prop)(),this.commerceUrl=(0,i.prop)(),this.rejectReason=(0,i.prop)(),this.totalItemsCount=(0,i.prop)(),this.afterCursor=(0,i.prop)(),this.canAppeal=(0,i.prop)()}initialize(){super.initialize(),this.productCollection=new r.ProductCollection,this.afterCursor=void 0}addProducts(e){this.productCollection.add(e,{merge:!0})}}a.Proxy="productColl";var o=(0,i.defineModel)(a);t.default=o},912496:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollCollection=void 0;var i=r(n(348926)),a=(n(665397),n(669393)),o=r(n(999909)),s=r(n(79622)),l=r(n(394629)),c=n(797951),u=n(621374),d=n(801255);const p=100,f=e=>({id:e.id,name:e.name,reviewStatus:e.reviewStatus,totalItemsCount:e.totalItemsCount,canAppeal:e.canAppeal,commerceUrl:e.commerceUrl,rejectReason:e.rejectReason});class _ extends d.BaseCollection{constructor(){super(...arguments),this.afterCursor=""}findCollectionsList(e,t,n,r){var s=this;return(0,i.default)((function*(){r&&a.QPL.markerPoint(r,"datasource_collections_start");try{const n=yield(0,c.attemptWithDirectConnectionRetry)(e,(n=>(0,o.default)({catalogWid:e,afterCursor:s.afterCursor,limit:10,productsCount:t,width:p,height:p,directConnectionEncryptedInfo:n})));r&&a.QPL.markerPoint(r,"datasource_collections_end"),s.afterCursor=n.afterCursor,s.add(n.collections.map(f),{merge:!0}),n.collections.forEach((t=>{const n=s.get(t.id);n&&n.addProducts(t.products.map((t=>(0,u.mapProductResponseToModel)(t,e))))})),s.trigger("change")}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionsList, error: ${e}`,SEND_LOGS("Find collections list failed"),e}}))()}getCollectionModels(e){const t=this.toArray();return e?t:t.filter((e=>!e.isHidden&&"APPROVED"===e.reviewStatus))}findCollectionProducts(e,t,n,r){var o=this;return(0,i.default)((function*(){let n=o.get(t);const i=n?n.afterCursor:void 0;r&&a.QPL.markerPoint(r,"datasource_start");try{const l=yield(0,c.attemptWithDirectConnectionRetry)(e,(n=>(0,s.default)({catalogWid:e,collectionId:t,afterCursor:i,limit:10,width:p,height:p,directConnectionEncryptedInfo:n})));r&&a.QPL.markerPoint(r,"datasource_end"),1===l.collections.length&&(o.add(l.collections.map(f),{merge:!0}),n=o.get(t),n&&(n.addProducts(l.collections[0].products.map((t=>(0,u.mapProductResponseToModel)(t,e)))),n.afterCursor=l.afterCursor))}catch(e){throw __LOG__(4,!0,new Error,!0)`Failed findCollectionProducts, error: ${e}`,SEND_LOGS("Find collection products failed"),e}}))()}}t.ProductCollCollection=_,_.model=l.default,_.staleCollection=!0},105641:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductCollection=t.PRODUCT_REVIEW_STATUS=void 0;var r=n(509468),i=n(801255);const a={NO_REVIEW:"NO_REVIEW",PENDING:"PENDING",REJECTED:"REJECTED",APPROVED:"APPROVED",OUTDATED:"OUTDATED"};t.PRODUCT_REVIEW_STATUS=a;class o extends i.BaseCollection{getProductModels(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=super.toArray();if(super.length<1)return t;const n=super.head();if(!(null==n?void 0:n.catalogWid))return t;const r=e?new Set([a.OUTDATED,a.NO_REVIEW,a.APPROVED,a.REJECTED,a.PENDING]):new Set([a.APPROVED]),i=super.filter((e=>r.has(e.reviewStatus)&&!e.old));return e?i:i.filter((e=>!e.isHidden))}add(e,t){const n=t?super.add(e,t):super.add(e);return this.sort(),n}evictImagesFromCache(e){const t=this.get(e);t&&t.evictImagesFromCache()}_find(e){const t=this.get(e);return t?Promise.resolve(t):Promise.resolve({id:e})}}t.ProductCollection=o,o.model=r.Product,o.comparator=function(e,t){return e.index-t.index}},951954:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.STATIC_WHATSAPP_IMAGE_URI=t.ProductImage=void 0;var a=i(n(348926)),o=i(n(81109)),s=n(918925),l=n(237178),c=n(435232),u=n(756406),d=i(n(534949)),p=n(555975),f=n(778986),_=i(n(502320)),h=n(58668),g=n(818309),m=n(411290);const y="https://static.whatsapp.net";t.STATIC_WHATSAPP_IMAGE_URI=y;const S=(0,l.createTimer)({algo:{type:"fibonacci",first:0,second:1},jitter:.25,max:9e5});function E(e){return"_productimage_"+(e.includes(y)?e:new URL(e).pathname)}class v extends m.BaseModel{constructor(){super(...arguments),this.id=(0,m.prop)(),this.type=(0,m.prop)(),this.mediaUrl=(0,m.prop)(),this.blobUrl=(0,m.session)(),this.mediaData=(0,m.session)(),this.fetchedFromServer=(0,m.prop)(),this.old=(0,m.session)(!1)}initialize(){super.initialize(),this.listenTo(this,"change:mediaUrl change:fetchedFromServer",this.triggerImageUpdate),this.triggerImageUpdate()}_processAndUpdateMediaData(e){let t={};const n=d.default.createFromData(e,"image/jpeg");(0,f.prepRawMedia)(n,{}).waitForPrep().then((e=>(t=(0,o.default)((0,o.default)({},t),{},{mediaBlob:e.mediaBlob,type:e.type,mimetype:e.mimetype,fullWidth:e.fullWidth,fullHeight:e.fullHeight}),Promise.all(["string"==typeof e.preview?d.default.createFromBase64Jpeg(e.preview):Promise.resolve(null),d.default.createFromData(e.mediaBlob),(0,g.calculateFilehashFromBlob)(e.mediaBlob)])))).then((e=>{const[n,r,i]=e;t=(0,o.default)((0,o.default)({},t),{},{preview:n,mediaBlob:r,renderableUrl:r.url(),mediaStage:h.MEDIA_DATA_STAGE.RESOLVED,filehash:i}),i!==this.mediaData.filehash&&this.mediaData.set(t)}))}triggerImageUpdate(){var e=this;return(0,a.default)((function*(){if(!e.fetchedFromServer||!e.mediaUrl)return;e.mediaData||e.addChild("mediaData",new _.default({mediaStage:h.MEDIA_DATA_STAGE.PREPARING}));const t=E(e.mediaUrl),n=yield p.LruMediaStore.get(t);if(n)return e._processAndUpdateMediaData(n);const i={delay:e=>{let{taskDuration:t}=e;const n=1e3*S();return Math.max(n-t,0)},signal:(new r).signal,retries:10};try{const{result:n}=yield(0,s.backoff)(i,function(){var t=(0,a.default)((function*(t){const n=yield(0,u.fetchMedia)(e.mediaUrl);return n&&n.status>=200&&n.status<300?n:t(new c.CatalogImageDownloadError)}));return function(){return t.apply(this,arguments)}}());p.LruMediaStore.put(t,n),e._processAndUpdateMediaData(n)}catch(t){__LOG__(3)`Failed to fetch ${e.mediaUrl}`,e.mediaData.set({mediaStage:h.MEDIA_DATA_STAGE.ERROR_MISSING})}}))()}markOld(){this.old=!0}evictFromCache(){if(this.mediaUrl){const e=E(this.mediaUrl);p.LruMediaStore.del(e)}}}v.Proxy="productImage";const T=(0,m.defineModel)(v);t.ProductImage=T},307514:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductImageCollection=void 0;var r=n(951954),i=n(801255);class a extends i.BaseCollection{toArray(){return super.filter((e=>e.old?(this.remove(e),!1):e))}}t.ProductImageCollection=a,a.model=r.ProductImage},989295:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageList=void 0;var i=r(n(348926)),a=n(641399),o=r(n(465212)),s=n(599989),l=n(105641),c=n(526002),u=n(240264),d=n(621374),p=n(900884),f=n(669951),_=n(411290),h=n(964551);const g=["ERROR","SUCCESS"];class m extends _.BaseModel{constructor(){super(...arguments),this.id=(0,_.prop)(),this.catalogId=(0,_.prop)(),this.title=(0,_.prop)(),this.requiresDirectConnection=(0,_.prop)(),this._productsLoadingStatus=(0,_.session)(),this._productList=(0,_.session)(),this._products=(0,_.session)()}initialize(){super.initialize(),this.productCollection=s.CatalogCollection.gadd({id:this.catalogId}).productCollection,this._productsLoadingStatus=new Map,this.listenTo(this,"change:_products",this.triggerProductUpdate),this.triggerProductUpdate(),this.listenTo(this.productCollection,"remove",this.triggerProductRemoved),this.listenTo(f.ChatCollection,"add",this.triggerChatAdded)}triggerProductRemoved(e){(0,a.updateProductListHeaderImageRejected)(e,this.id)}triggerProductUpdate(){null!=this._products&&(this._products.forEach((e=>{const t=this._getFetchStatus(e);if(this.setProductLoadingStatus(e.id,t),"DELETED"===e.status&&this.triggerProductRemoved(e),"DELETED"!==e.status&&"ERROR"!==t){const t=(0,d.mapProductResponseToModel)(e,this.catalogId);t.reviewStatus===l.PRODUCT_REVIEW_STATUS.REJECTED&&this.triggerProductRemoved(t),this.productCollection.add(t,{merge:!0})}})),this._products=void 0)}triggerChatAdded(e){var t=this;return(0,i.default)((function*(){e.id.equals(t.catalogId)&&(yield(0,p.isCypherNeeded)(t.catalogId))&&(t.productCollection.reset(),t._productsLoadingStatus=new Map)}))()}getNextProductBatchToLoad(){const e=this.getPageSize(),t=this._productList.productSections.reduce(((e,t)=>{let{products:n}=t;return[...e,...n.map((e=>{let{productId:t}=e;return t})).filter(Boolean).filter((e=>"NONE"===this.getProductLoadingStatus(e)))]}),[]).slice(0,e);return t.forEach((e=>this.setProductLoadingStatus(e,"PENDING"))),t}getPageSize(){const e=h.ServerProps.webProductListMessagePageSize||u.PRODUCT_PAGE_SIZE,t=this.getProductSize();return t<3*e?t:2*e}getProductSize(){return this._productList.productSections.reduce(((e,t)=>{let{products:n}=t;return e+n.length}),0)}setProductLoadingStatus(e,t){this._productsLoadingStatus.set(e,t)}getProductLoadingStatus(e){return this._productsLoadingStatus.get(e)||"NONE"}getTotalProductsFetchedOrFailed(){return Array.from(this._productsLoadingStatus).filter((e=>{let[t,n]=e;return g.includes(n)})).length}getProductList(){return this._productList}getSections(){return this._productList.productSections}getSectionsCount(){return this._productList.productSections.reduce(((e,t)=>{let{title:n}=t;return null!=n&&""!==n?e+1:e}),0)}isFetching(){let e=!1;return this._productsLoadingStatus.forEach((t=>{"PENDING"===t&&(e=!0)})),e}_getFetchStatus(e){return e.status!==c.INVALID_PRODUCT_TOKEN&&e.image_cdn_urls?"SUCCESS":"ERROR"}}m.Proxy="product_list",m.idClass=o.default;const y=(0,_.defineModel)(m);t.ProductMessageList=y},18952:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProductMessageListCollectionImpl=t.ProductMessageListCollection=void 0;var i=r(n(348926)),a=n(895697),o=(n(665397),n(745454)),s=n(989295),l=n(801255);class c extends l.BaseCollection{_queryProductList(e,t){return(0,i.default)((function*(){const n=e.catalogId,r=yield(0,a.queryProductList)(n,e.getNextProductBatchToLoad(),void 0,void 0,t);return{id:e.id,_products:r,fetchedFromServer:!0}}))()}_findQuery(e,t){const n=this.get(e);return null==n?Promise.resolve({id:e}):this._queryProductList(n,null==t?void 0:t.markerId)}_find(e,t){return this._findQuery(e,t)}getOrAdd(e,t,n,r,i){let a=this.get(e);if(null!=a)return a;if(null==r)return null;const s=(0,o.createWid)(r);return a=this.add({id:e,catalogId:s,_productList:t,title:i,requiresDirectConnection:n})[0],null!=a?a:null}}t.ProductMessageListCollectionImpl=c,c.model=s.ProductMessageList,c.staleCollection=!0;const u=new c;t.ProductMessageListCollection=u},526002:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_PRODUCT_TOKEN=void 0;t.INVALID_PRODUCT_TOKEN="DELETED"},240264:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCT_PAGE_SIZE=void 0;t.PRODUCT_PAGE_SIZE=6},713151:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSalePriceActive=t.isEmptyPrice=t.getActivePrice=void 0;const n=e=>null!=e.salePriceAmount1000&&(null==e.salePriceStartDate||e.salePriceStartDate<=Date.now())&&(null==e.salePriceEndDate||e.salePriceEndDate>Date.now());t.isSalePriceActive=n;const r=e=>n(e)?e.salePriceAmount1000:e.priceAmount1000;t.getActivePrice=r;t.isEmptyPrice=e=>{const{currency:t,priceAmount1000:n}=e,i=r(e);return!t||null==n||null==i}},906822:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductComplianceCategory=t.ProductAvailability=void 0;const r=n(76672)({IN_STOCK:"in stock",OUT_OF_STOCK:"out of stock",UNKNOWN:"unknown"});t.ProductAvailability=r;const i=n(76672)({Default:"DEFAULT",CountryOriginExempt:"COUNTRY_ORIGIN_EXEMPT"});t.ProductComplianceCategory=i},865563:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyTypes=void 0;const r=n(76672)({TEXT:"text",ADDRESS_SMART_DEFAULT:"address_smart_default",HOURS_SMART_DEFAULT:"hours_smart_default",PROFILE_SMART_DEFAULT:"profile_smart_default"});t.QuickReplyTypes=r},947169:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(865563),i=n(976892),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.shortcut=(0,a.prop)(),this.message=(0,a.prop)(),this.count=(0,a.prop)(),this.keywords=(0,a.prop)(),this.pendingCount=(0,a.session)(0),this.totalCount=(0,a.derived)((function(){return this.count+this.pendingCount}),["count","pendingCount"]),this.type=(0,a.derived)((function(){var e;switch(null!==(e=r.QuickReplyTypes.cast(this.id))&&void 0!==e?e:r.QuickReplyTypes.TEXT){case r.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return r.QuickReplyTypes.ADDRESS_SMART_DEFAULT;case r.QuickReplyTypes.HOURS_SMART_DEFAULT:return r.QuickReplyTypes.HOURS_SMART_DEFAULT;case r.QuickReplyTypes.PROFILE_SMART_DEFAULT:return r.QuickReplyTypes.PROFILE_SMART_DEFAULT;default:return r.QuickReplyTypes.TEXT}}),["id"])}useOnce(){this.isSmartDefault()?(this.count+=1,(0,i.updateQuickReply)(this)):(this.pendingCount+=1,this.getCollection().periodicFlush())}getCollection(){return n(999662).QuickReplyCollection}isSmartDefault(){switch(this.type){case r.QuickReplyTypes.PROFILE_SMART_DEFAULT:case r.QuickReplyTypes.HOURS_SMART_DEFAULT:case r.QuickReplyTypes.ADDRESS_SMART_DEFAULT:return!0;default:return!1}}}o.Proxy="quickReply";var s=(0,a.defineModel)(o);t.default=s},999662:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.QuickReplyCollectionImpl=t.QuickReplyCollection=void 0;var i=r(n(348926)),a=n(450796),o=n(657319),s=n(492574),l=n(88555),c=n(438184),u=r(n(947169)),d=n(547787),p=r(n(656891)),f=n(801255),_=n(714648);class h extends f.BaseCollection{constructor(){super(...arguments),this.checksum=void 0,this.flushCountsTimer=new o.ShiftTimer((()=>{this.hasPendingCounts()&&this.flushCounts()})),this.sortQuickReply=(e,t)=>e.totalCount===t.totalCount?e.id<t.id?-1:1:e.totalCount>t.totalCount?-1:1,this._handleCountsFlushed=e=>{let{id:t,count:n}=e;const r=this.get(t);r&&(r.count=n,r.pendingCount=0)}}delete(){super.delete(),delete this.checksum}filterShortcuts(e){return this.filter((t=>{let{shortcut:n}=t;return n.toLowerCase().startsWith(e.toLowerCase())})).sort(this.sortQuickReply)}sync(e){(0,d.addSmartDefaults)(),c.LegacyPhoneFeatures.supportsFeature(c.LegacyPhoneFeatures.F.QUICK_REPLIES_QUERY)&&(this.synced()&&this.checksum===e?this.hasPendingCounts()&&this.flushCounts():this.findQuery({}).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{}))))}periodicFlush(){c.LegacyPhoneFeatures.supportsFeature(c.LegacyPhoneFeatures.F.QUICK_REPLIES_QUERY)&&this.flushCountsTimer.debounceAndCap(2e3,5e3)}updateChecksum(e){this.checksum=e}synced(){return void 0!==this.checksum}hasPendingCounts(){return this.some((e=>{let{pendingCount:t}=e;return t>0}))}getAllPendingCounts(){const e={};return this.forEach((t=>{let{id:n,pendingCount:r}=t;r>0&&(e[n]=r)})),e}flushCounts(){if((0,l.isMDBackend)())throw new Error("This call is only supported in non-MD mode");const e=this.getAllPendingCounts();p.default.flushQuickReplyCounts(e).then((t=>{t.checksum&&this.updateChecksum(t.checksum),t.data.filter((t=>{let{id:n}=t;return void 0!==e[n]})).forEach(this._handleCountsFlushed)})).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{})))}_findQuery(){var e=this;return(0,i.default)((function*(){if((0,l.isMDBackend)())throw new Error("This call is only supported in non-MD mode");const t=e.getAllPendingCounts(),n=yield p.default.queryQuickReplies(t);return n.checksum&&e.updateChecksum(n.checksum),n.data.filter((e=>{let{id:n}=e;return void 0!==t[n]})).forEach(e._handleCountsFlushed),n.data}))()}handle(e){e.checksum&&this.updateChecksum(e.checksum);const t=[],n=[];e.quickReplies.forEach((e=>{"delete"===e.type?t.push(e):n.push(e)})),this.remove(t.map((e=>{let{id:t}=e;return t}))),this.add(n,{merge:!0})}}t.QuickReplyCollectionImpl=h,h.model=u.default,h.cachePolicy={id:"quick_replies_collection",policy:_.CACHE_POLICY.LOAD,delay:2e3};const g=new h;t.QuickReplyCollection=g},547787:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addSmartDefaults=function(){(function(){const e=a.QuickReplyTypes.PROFILE_SMART_DEFAULT,t=function(){const e=s.ContactCollection.get((0,i.getMaybeMeUser)());if(e){const t=a.QuickReplyTypes.PROFILE_SMART_DEFAULT;return new o.default({id:t,shortcut:l.fbt._("profile",null,{hk:"10UPRT"}).toString(),message:e.displayName,count:-1,keywords:[]})}}(),r=n(999662).QuickReplyCollection;r.get(e)?t&&r.add({id:e,message:t.message},{merge:!0}):t&&r.add(t,{merge:!0})})(),function(){const e=a.QuickReplyTypes.ADDRESS_SMART_DEFAULT,t=function(){const e=n(493581).BusinessProfileCollection.get((0,i.getMaybeMeUser)());if((null==e?void 0:e.latitude)||(null==e?void 0:e.longitude)||(null==e?void 0:e.address)){const t=a.QuickReplyTypes.ADDRESS_SMART_DEFAULT,n=e.address||l.fbt._("Map Location",null,{hk:"3wlwI4"});return new o.default({id:t,shortcut:l.fbt._("address",null,{hk:"38K1PS"}).toString(),message:l.fbt._("{pinEmoji} {address}",[l.fbt._param("pinEmoji","📍"),l.fbt._param("address",n)],{hk:"huwFP"}).toString(),count:-1,keywords:[]})}}(),r=n(999662).QuickReplyCollection;r.get(e)?t&&r.add({id:e,message:t.message},{merge:!0}):t&&r.add(t,{merge:!0})}(),function(){const e=a.QuickReplyTypes.HOURS_SMART_DEFAULT,t=function(){var e;const t=n(493581).BusinessProfileCollection,r=n(794010).quickReplyHoursStr,s=t.get((0,i.getMaybeMeUser)());if(null==s||null===(e=s.businessHours)||void 0===e?void 0:e.config){const e=a.QuickReplyTypes.HOURS_SMART_DEFAULT,t=r(s.businessHours);return new o.default({id:e,shortcut:l.fbt._("hours",null,{hk:"1WmWJY"}).toString(),message:t,count:-1,keywords:[]})}}(),r=n(999662).QuickReplyCollection;r.get(e)?t&&r.add({id:e,message:t.message},{merge:!0}):t&&r.add(t,{merge:!0})}()};var i=n(978820),a=n(865563),o=r(n(947169)),s=n(719380),l=n(548360)},689310:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(389867)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)()}contact(){return n(719380).ContactCollection.gadd(this.id)}getCollection(){return n(132826).BlocklistCollection}}o.Proxy="blocklist",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},132826:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistCollectionImpl=t.BlocklistCollection=void 0;var i=r(n(689310)),a=n(801255);class o extends a.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.blockContact),this.listenTo(this,"remove",this.unblockContact)}blockContact(e){e.contact().isContactBlocked=!0}unblockContact(e){e.contact().isContactBlocked=!1}}t.BlocklistCollectionImpl=o,o.model=i.default;const s=new o;t.BlocklistCollection=s},315871:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.displayText=(0,r.prop)(),this.selected=(0,r.session)(!1)}}i.Proxy="replyButton";var a=(0,r.defineModel)(i);t.default=a},47688:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonCollection=void 0;var i=r(n(315871)),a=n(801255);class o extends a.BaseCollection{}t.ButtonCollection=o,o.model=i.default},63183:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=void 0,t.getForwardedMessageFields=je;var a=i(n(348926)),o=i(n(957557)),s=i(n(875472)),l=i(n(766678)),c=i(n(441609)),u=i(n(23279)),d=n(389385),p=n(450796),f=i(n(627722)),_=i(n(145095)),h=n(413959),g=i(n(71197)),m=n(257243),y=n(227101),S=n(535470),E=i(n(485074)),v=n(492574),T=n(88555),C=n(864795),A=i(n(624206)),b=n(461957),P=n(933852),O=n(173679),M=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Be(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(322911)),I=n(716055),w=n(139814),R=n(40234),N=n(781572),L=n(813042),D=n(237540),k=i(n(364369)),U=i(n(670119)),G=i(n(312523)),x=n(438184),B=i(n(465212)),F=n(115461),j=n(453168),Y=n(366517),K=n(623631),W=n(45775),H=n(461827),V=n(438914),$=n(536037),z=n(49506),q=n(507134),J=n(564603),Q=n(14571),X=n(555452),Z=n(978820),ee=i(n(389867)),te=n(745454),ne=i(n(621423)),re=n(991450),ie=i(n(6977)),ae=i(n(177653)),oe=i(n(165568)),se=n(951612),le=i(n(916173)),ce=n(317239),ue=n(719380),de=i(n(835667)),pe=n(455981),fe=n(743323),_e=n(105109),he=n(411290),ge=n(17304),me=n(559871),ye=n(554676),Se=n(72472),Ee=n(868315),ve=n(582039),Te=n(284728),Ce=n(719011),Ae=i(n(558492)),be=i(n(441809)),Pe=n(229331),Oe=n(358871),Me=n(27211),Ie=n(524606),we=i(n(914296)),Re=n(778986),Ne=i(n(487798)),Le=n(999588),De=i(n(11339)),ke=n(249001),Ue=n(448285),Ge=n(760324),xe=n(548360);function Be(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Be=function(e){return e?n:t})(e)}class Fe extends Ae.default{constructor(){super(...arguments),this.id=(0,he.prop)(),this.t=(0,he.prop)(),this.unreadCount=(0,he.prop)(0),this.archive=(0,he.prop)(),this.isReadOnly=(0,he.prop)(),this.isAnnounceGrpRestrict=(0,he.prop)(),this.modifyTag=(0,he.prop)(),this.muteExpiration=(0,he.prop)(0),this.name=(0,he.prop)(),this.notSpam=(0,he.prop)(),this.pin=(0,he.prop)(),this.labels=(0,he.prop)(),this.changeNumberOldJid=(0,he.prop)(),this.changeNumberNewJid=(0,he.prop)(),this.lastReceivedKey=(0,he.prop)(),this.ephemeralDuration=(0,he.prop)(),this.ephemeralSettingTimestamp=(0,he.prop)(),this.disappearingModeInitiator=(0,he.prop)(),this.createdLocally=(0,he.session)(),this.pendingAction=(0,he.session)(),this.formattedTitle=(0,he.session)(),this.active=(0,he.session)(),this.pausedTimerId=(0,he.session)(),this.presenceResendTimerId=(0,he.session)(),this.recording=(0,he.session)(),this.typing=(0,he.session)(),this.colors=(0,he.session)(),this.composeContents=(0,he.session)((()=>({}))),this.attachMediaContents=(0,he.session)(),this.isComposingPoll=(0,he.session)(!1),this.pttRecordingSession=(0,he.session)(),this.squelch=(0,he.session)(),this.reactionSquelch=(0,he.session)(),this.pendingSeenCount=(0,he.session)(0),this.unreadMsgAnchor=(0,he.session)(),this.markedUnread=(0,he.session)(),this.trusted=(0,he.session)(),this.canSend=(0,he.session)(),this.promises=(0,he.session)((()=>({}))),this.ftsCache=(0,he.session)((()=>({}))),this.composeQuotedMsg=(0,he.session)(),this.composeQuotedMsgRemoteJid=(0,he.session)(),this.quotedMsgAdminGroupJid=(0,he.session)(),this.quotedMsgAdminGroupSubject=(0,he.session)(),this.quotedMsgAdminParentGroupJid=(0,he.session)(),this.groupMetadata=(0,he.session)(),this.presence=(0,he.session)(),this.mute=(0,he.session)(),this.contact=(0,he.session)(),this.liveLocation=(0,he.session)(),this.liveLocationQueried=(0,he.session)(!1),this.ackedProps=(0,he.session)((()=>({}))),this.mediaCount=(0,he.session)(0),this.linkCount=(0,he.session)(0),this.docCount=(0,he.session)(0),this.productCount=(0,he.session)(0),this.pendingDeleteForMeCount=(0,he.session)(0),this.isParentGroup=(0,he.session)(),this.unreadMentionsOfMe=(0,he.prop)(),this.unreadMentionCount=(0,he.prop)(),this.hasUnreadMention=(0,he.prop)(!1),this.archiveAtMentionViewedInDrawer=(0,he.prop)(!1),this.hasChatBeenOpened=(0,he.prop)(!1),this.tcToken=(0,he.prop)(),this.tcTokenTimestamp=(0,he.prop)(),this.tcTokenSenderTimestamp=(0,he.prop)(),this.msgUnsyncedButtonReplyMsgs=(0,he.prop)(),this.vcardDismissed=(0,he.session)(!1),this.endOfHistoryTransfer=(0,he.session)(!1),this.endOfHistoryTransferType=(0,he.prop)(),this.hasEstablishedE2EESession=(0,he.session)(!1),this.pendingInitialLoading=(0,he.prop)(!1),this.lastReactionPreview=(0,he.prop)(),this.kind=(0,he.derived)((function(){var e;return ee.default.isGroup(this.id)?(null===(e=this.groupMetadata)||void 0===e?void 0:e.groupType)===pe.GroupType.COMMUNITY?b.CHAT_KIND.COMMUNITY:b.CHAT_KIND.GROUP:ee.default.isBroadcast(this.id)?b.CHAT_KIND.BROADCAST:ee.default.isUser(this.id)?b.CHAT_KIND.CHAT:void __LOG__(2)`chat:unknown kind id:${this.id.toString()}`})),this.isUser=(0,he.derived)((function(){return ee.default.isUser(this.id)})),this.isPSA=(0,he.derived)((function(){return ee.default.isPSA(this.id)})),this.isGroup=(0,he.derived)((function(){return ee.default.isGroup(this.id)})),this.isBroadcast=(0,he.derived)((function(){return ee.default.isBroadcast(this.id)})),this.isBusinessGroup=(0,he.derived)((function(){var e;const t=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getAdmins();if(!t)return!1;for(const e of t){const t=ue.ContactCollection.get(e.id);if(null==t?void 0:t.isBusiness)return!0}return!1})),this.canUnread=(0,he.derived)((function(){return!this.isBroadcast})),this.hasUnread=(0,he.derived)((function(){return 0!==this.unreadCount}),["unreadCount"]),this.optimisticUnreadCount=(0,he.derived)((function(){const{unreadCount:e,pendingSeenCount:t}=this;return e===k.default.MARKED_AS_UNREAD?e:Math.max(0,e-t)}),["unreadCount","pendingSeenCount"]),this.shouldShowUnreadDivider=(0,he.derived)((function(){if(0===this.unreadCount)return!1;if(this.unreadMsgAnchor){const{msgChunk:e}=this.unreadMsgAnchor,t=e?e.getModelsArray():[];return this.unreadMsgAnchor!==t.find((e=>e.isUnreadType))}if(this.msgs.msgLoadState.noEarlierMsgs){return this.msgs.filter((e=>e.isUnreadType)).length!==this.unreadCount}return!0}),["unreadCount","unreadMsgAnchor"]),this.shouldAppearInList=(0,he.derived)((function(){if((0,T.isMDBackend)()&&this.isBroadcast)return"chat"===this.id.user;if(ee.default.isStatusV3(this.id))return!1;if((0,T.isMDBackend)()&&this.endOfHistoryTransferType===b.ConversationEndOfHistoryTransferModelPropType.NOT_INCLUDED_IN_HIST_SYNC&&0===this.msgs.length)return!1;if(this.isGroup&&!0===this.isParentGroup)return!1;if(this._shouldAppearInListLatched)return!0;const e=this.msgs.some((e=>!(e.type===F.MSG_TYPE.GROUPS_V4_INVITE&&e.from.equals((0,Z.getMaybeMeUser)())||e.isInitialE2ENotification||e.type===F.MSG_TYPE.CALL_LOG||e.isBizNotification||"change_number"===e.subtype||e.isDisappearingModeSystemMessage)));return this._shouldAppearInListLatched=!this.createdLocally||e,this._shouldAppearInListLatched}),["createdLocally","msgs","msgsLength","isParentGroup"]),this.previewMessage=(0,he.derived)((function(){for(let e=this.msgs.length-1;e>=0;e--){const t=this.msgs.at(e);if(t&&t.type!==F.MSG_TYPE.E2E_NOTIFICATION&&t.type!==F.MSG_TYPE.NOTIFICATION_TEMPLATE&&t.type!==F.MSG_TYPE.REACTION&&t.type!==F.MSG_TYPE.POLL_UPDATE&&!t.pendingDeleteForMe)return t}if(this.msgs.length>0)return this.msgs.last()}),["msgs","msgsChanged","pendingDeleteForMeCount"]),this.showChangeNumberNotification=(0,he.derived)((function(){if(!x.LegacyPhoneFeatures.supportsFeature(x.LegacyPhoneFeatures.F.CHANGE_NUMBER_V_2))return!1;const{changeNumberOldJid:e,changeNumberNewJid:t,id:n,isUser:r}=this;if(!r)return!1;if(!e&&!t)return!1;const i=ue.ContactCollection.get(t||n);return!(null==i?void 0:i.isMyContact)}),["changeNumberOldJid","changeNumberNewJid","id","isUser"]),this.shouldShowUnreadInTitle=(0,he.derived)((function(){const e=!!this.muteExpiration;if(this.archive)return!1;if(this.optimisticUnreadCount<=0)return!1;if(!this.isGroup)return!e;if(!e)return!0;if(!this.msgs||0===this.msgs.length)return!1;let t=!1;const n=this.msgs,r=this.optimisticUnreadCount;let i=Math.max(0,n.length-r);for(;i<n.length;i++){const e=this.msgs.at(i);if(!e)continue;const n=(0,Z.getMaybeMeUser)();if(e.isMentioned(n)||e.isQuoted(n)){const n=this.getCollection().get(e.sender);if(!n||!n.muteExpiration){t=!0;break}}}return t}),["isGroup","archive","optimisticUnreadCount","muteExpiration"]),this.deleteSignal=(0,he.derived)((function(){return this._abortController.signal}))}initialize(){super.initialize(),this.addQueue=new f.default,this.sendQueue=new f.default,this._ephemeralMessagesToDelete=new Set,this._ephemeralMessageTimerIds=new Map,this._abortController=new r,this.msgs.msgLoadState.contextLoaded=!0,this.addChild("presence",Ee.PresenceCollection.gadd(this.id));const e=Se.MuteCollection.get(this.id);if(e?this.addChild("mute",e):this.addChild("mute",Se.MuteCollection.gadd({id:this.id,expiration:this.muteExpiration})),this.listenTo(this.mute,"change:expiration",this.updateMuteExpiration),this.addChild("contact",ue.ContactCollection.gadd(this.id)),this.name&&!this.contact.name){const e={name:this.name};this.isGroup?this.contact.set(e):(0,Me.updateLocal)(this.contact.id,e).then((()=>{this.contact.set(e)}))}if(this.listenTo(this.contact,"change:name",this.updateTitle),this.listenTo(this.contact,"change:isContactBlocked",this.updateCanSend),this.isGroup&&(this.trusted=!0),this.listenTo($.TosManager,"change",this.updateCanSend),this.listenTo(this.contact,"change:privacyMode",this.updateCanSend),this.isGroup||this.isBroadcast){const e=this.getGroupMetadataCollection();let t;this.isBroadcast&&!e.get(this.id)&&(t=!0);const n=e.gadd(this.id);if(this.addChild("groupMetadata",n),this.listenTo(n,"change:stale change:announce",this.updateIsAnnounceGrpRestrict),this.listenTo(n.participants,"change:isAdmin add remove",this.updateIsAnnounceGrpRestrict),this.listenTo(n,"change:trusted change:stale",this.isTrusted),this.listenTo(n,"change:participants change:stale change:suspended change:terminated",(()=>(0,O.updateReadOnly)(this))),this.listenTo(n.participants,"change:contact.formattedShortName",this.updateTitle),(0,y.isGroupCatchUpEnabled)()){if(this.unreadMentionsOfMe){const e=this.unreadMentionsOfMe.map((e=>new be.default({id:e.id,timestamp:e.timestamp})));n.unreadMentionMetadata.addUnreadMentions(e,fe.UnreadMessageType.PERSISTANCE_LOAD)}null!=this.unreadMentionCount&&(n.unreadMentionMetadata.pendingUnreadMentionCount=this.unreadMentionCount),this._handleUnreadMention(),this.listenTo(n.unreadMentionMetadata.unreadMentionCollection,"add remove reset",this._handleUnreadMention),this.listenTo(n.unreadMentionMetadata,"change:pendingUnreadMentionCount",this._handleUnreadMention)}(0,O.updateReadOnly)(this),this.updateIsAnnounceGrpRestrict();const r=this.id;this.listenTo(this,"change:isReadOnly",(function(){this.isTrusted(),this.updateCanSend(),ve.ProfilePicThumbCollection.update(r).catch((0,p.filteredCatch)(v.WebdDrop,(()=>{}))),e.update(r).catch((0,p.filteredCatch)(v.WebdDrop,(()=>{})))})),this.listenTo(this,"change:isAnnounceGrpRestrict",this.updateCanSend),this.listenTo(this,"change:archive",(()=>{!0===this.archive&&(0,H.shouldEnableArchiveV2)()&&(0,V.setArchiveEnabledSetting)(!0)})),this.listenTo(n,"change:isParentGroup",(()=>{this.isParentGroup=n.isParentGroup})),this.isParentGroup=n.isParentGroup,t&&e.update(r).catch((0,p.filteredCatch)(v.WebdDrop,(()=>{})))}else this.listenTo(this.presence,"change:isOnline",(()=>(0,Y.presenceOnlineChanged)(this)));const t=this.getCollection();t.notSpam[this.id]&&!this.notSpam&&(0,W.sendNotSpam)(this).catch((()=>{})),t.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this._handleNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(this.msgs,"add",this._handleNewMsg),this.listenTo(this.msgs,"update_sort_time",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",((e,t)=>(0,I.addMediaMsgs)(this,e,t))),this.listenTo(this.msgs,"add",this._deregisterExpiredViewOnceMessage),this.listenTo(this.msgs,"bulk_add",this.deregisterExpiredViewOnceBulkMessages),this.listenTo(this.msgs,"add remove change:ephemeralExpirationTimestamp change:kicState",this._resetEphemeralMessageExpirationTimer),this.listenTo(this.msgs,"bulk_add",(e=>{e.forEach((e=>{this._resetEphemeralMessageExpirationTimer(e)}))})),this.listenTo(this.msgs,"change:kicState",(e=>{const t=this.keptMsgs;t&&(e.isKept?t.add(e):t.remove(e))})),this.listenTo(this,"change:msgs",(()=>(0,I.resetMediaMsgs)(this))),this.saveAssignedColorsDebounced=(0,u.default)((()=>(0,w.saveAssignedColors)(this)),1e3),this.listenTo(this,"change:active",this._handleActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache),this.listenTo(we.default,"locale_change",(()=>{this.updateTitle()})),ce.Conn.isSMB&&(0,C.initializeLabels)(this)}_handleUnreadMention(){this.isGroup&&this.groupMetadata&&(0,y.isElevatedImportantMessageEnabled)()&&(this.hasUnreadMention=this.groupMetadata.unreadMentionMetadata.getUnreadMentionCount()>0)}set(e,t,n){"string"==typeof e?"muteExpiration"===e&&this.mute&&this.mute.setMute(t):e.hasOwnProperty("muteExpiration")&&this.mute&&this.mute.setMute(e.muteExpiration);return super.set(e,t,n)}addPendingAction(e){const t=()=>{this.decPending()};e.then(t,t),this.pendingAction++}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}_handleActiveUpdate(){if(this.isGroup&&this.active&&(this.squelch=k.default.SQUELCH_RESET_VALUE,this.reactionSquelch=k.default.SQUELCH_RESET_VALUE,this.hasChatBeenOpened=!0),this.presence.chatActive=this.active,!this.active){if(this.msgs.filter((e=>(0,Te.isExpired)(e.safe()))).forEach(Re.deregisterMsg),(0,T.isMDBackend)()){const e=Array.from(this._ephemeralMessagesToDelete);(0,Ge.removeExpiredMessagesFromHistory)(e).then((()=>{const t=e.map((e=>e.id.toString()));if(t.length>0){(0,Q.deleteModelsForLastReactionPreview)(t);(0,n(203292).getJobManager)().waitUntilPersisted(j.jobSerializers.deleteAddOns(this.id.toString(),t))}}))}this._ephemeralMessagesToDelete.forEach((e=>{this._ephemeralMessagesToDelete.delete(e),e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})}))}}_handlePendingActionUpdate(){this.pendingAction<0&&(__LOG__(2)`chat:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}_handleNotSpamChange(){this.getCollection().notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")}hasMaybeSentMsgToChat(){return this.getAllMsgs().some((e=>e.isSentByMe))}isTrusted(){let e=!1;var t;this.isGroup?e=this.isReadOnly||this.notSpam||(null===(t=this.groupMetadata)||void 0===t?void 0:t.isTrusted()):this.isBroadcast?e=!0:this.isUser&&(e=this.notSpam||this.contact.isMyContact);return!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=Boolean(e)}updateMuteExpiration(){const e=Number(this.mute.expiration);(0,Oe.updateLocal)(this.id,{muteExpiration:e}).then((()=>this.muteExpiration=e))}updateTitle(){var e,t;this.isBroadcast?this.formattedTitle=this.contact.name||(null!==(e=null===(t=this.groupMetadata)||void 0===t?void 0:t.participants)&&void 0!==e?e:[]).map((function(e){return e.contact.formattedShortName})).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser()||"":this.isGroup&&(this.formattedTitle=this.contact.name)}title(){return this.isGroup?this.formattedTitle||xe.fbt._("unknown subject",null,{hk:"3Lg3Zm"}).toString():this.formattedTitle}getTcToken(){return(0,T.isMDBackend)()?null==this.tcToken||null==this.tcTokenTimestamp||(0,J.isTokenExpired)(this.tcTokenTimestamp,J.TcTokenMode.Receiver)?null:this.tcToken:null}isPresenceUnknown(){return!(!(0,T.isMDBackend)()||!(0,m.getABPropConfigValue)("trusted_contacts_ti")||null!=this.getTcToken())}updateCanSend(){return this.isReadOnly||this.isAnnounceGrpRestrict||(0,q.shouldBlockByTos)(this.contact)||(0,z.shouldBlockByCountry)(this.contact)?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isContactBlocked||this.isPSA):this.canSend=!0}delete(){super.delete(),this.getCollection().remove(this.id),this._abortController.abort(),this.presence.delete(),this.liveLocation&&this.liveLocation.delete(),N.Cmd.closeChat(this),this.groupMetadata&&this.groupMetadata.delete(),this.mediaMsgs&&this.mediaMsgs.delete(),this.linkMsgs&&this.linkMsgs.delete(),this.docMsgs&&this.docMsgs.delete(),this.productMsgs&&this.productMsgs.delete();const e=this.starredMsgs;e&&(e.delete(),e.stopListening(),e.reset()),this.receivedVcardMsgs&&this.receivedVcardMsgs.delete(),(0,X.deleteComposeContents)(this.id)}isDirty(){return 0!==this.unreadCount}_handleNewMsg(e){var t=this;if(!e)return;let n=Promise.resolve();e.isSentByMe&&!this.notSpam&&(n=(0,Oe.updateLocal)(this.id,{notSpam:!0}).then((()=>this.notSpam=!0))),"i"!==e.eventType&&n.then((0,a.default)((function*(){const n={};if((0,T.isLegacyWebdBackend)()&&(n.t=e.t),t.promises.updateSortTime&&t.promises.updateSortTime.abortController.abort(),(0,I.updateMediasCountOnMsg)(t,e),((0,T.isLegacyWebdBackend)()||(0,T.isMDBackend)()&&e.isSentByMeFromWeb)&&t.archive&&(0,H.shouldUnarchiveChat)(e.isSentByMe)&&(n.archive=!1),t.promises.setArchive&&t.promises.setArchive.abortController.abort(),e.isSentByMe?t.markedUnread=!1:((0,A.default)({id:t.id,participant:e.author,type:"paused"},!1),(0,T.isLegacyWebdBackend)()&&("a"!==e.eventType&&"d"!==e.eventType||(n.unreadCount=t.unreadCount+1||1))),yield(0,Oe.updateLocal)(t.id,n),(0,T.isMDBackend)())try{const{unreadCount:e,timestamp:r}=yield(0,Ue.getChatMeta)(t.id);n.t=r,n.unreadCount=e}catch(e){__LOG__(4,void 0,new Error)`onNewMsg: unable to find metadata from chat table for id:${t.id.toString()}`}return n}))).then((t=>{e.isSentByMeFromWeb&&e.sendDeferred?this.setAndKeepPrevious(t,e.sendDeferred.promise):this.set(t);const n=de.default.get(this.id);if(n&&(n.timestamp=R.Clock.globalUnixTime()),"gp2"!==e.type||"add"!==e.subtype&&"create"!==e.subtype||this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,Z.getMaybeMeUser)().toString()}`,this.id),!e.isSentByMe){switch(e.eventType){case"d":case"a":"d"===e.eventType&&N.Cmd.alertNewMsg(e),this.msgs.length<L.MSG_PRELOAD_THRESHOLD&&M.loadEarlierMsgs(this,void 0,De.default.WEBC_QUERY_TRIGGER_TYPE.NEW_MESSAGE_PREFETCH).catch((0,p.filteredCatch)(v.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onNewMsg failed\n${e}`}));break;case"n":e.type===F.MSG_TYPE.CALL_LOG&&N.Cmd.alertNewMsg(e);break;case"s":if("gp2"===e.type&&"add"===e.subtype&&(0,Z.getMaybeMeUser)().equals(e.recipients[0])&&!this.contact.name)return;N.Cmd.alertNewMsg(e);this.getGroupMetadataCollection().trigger(`group_participant_change_${(0,Z.getMaybeMeUser)().toString()}`,this.id)}const n=e.mediaData;if(!n||"image"!==n.type&&"video"!==n.type||N.Cmd.newMediaMsg(e),(0,T.isMDBackend)()&&t.unreadCount&&(0,Pe.processOrphanPeerReceipt)(e.id),(0,y.isGroupCatchUpEnabled)()&&(0,D.isImportantMessage)(e)){var r;const t=new be.default({id:e.id.toString(),timestamp:e.t});if(null===(r=this.groupMetadata)||void 0===r||r.unreadMentionMetadata.addUnreadMentions(t,fe.UnreadMessageType.NEW_MESSAGE),this.archiveAtMentionViewedInDrawer){const e=new Map;e.set(this.id.toString(),!1),(0,Ue.updateChatArchiveDrawer)(e),this.archiveAtMentionViewedInDrawer=!1}}}}))}canPin(){var e;if(this.archive)return!1;const t=null===(e=this.promises)||void 0===e?void 0:e.setArchive;return!(null==t?void 0:t.archive)}canArchive(){return!this.isBroadcast||x.LegacyPhoneFeatures.supportsFeature(x.LegacyPhoneFeatures.F.ARCHIVE_BROADCAST)}setComposeContents(e){this.composeContents=e}getSessionPersistedComposeContents(){return(0,X.getComposeContents)(this.id)}getComposeContents(){return(0,c.default)(this.composeContents)?this.getSessionPersistedComposeContents()||{}:this.composeContents}setAttachMediaContents(e){this.attachMediaContents=e}isComposing(){const{text:e}=this.composeContents;return Boolean(e)||this.isComposingPoll}preload(){1===this.msgs.length&&M.loadEarlierMsgs(this).catch((0,p.filteredCatch)(v.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:preload failed\n${e}`}))}onEmptyMRM(){__LOG__(2)`models:Chat:removeMsg 0 messages left, querying...`,M.loadEarlierMsgs(this).catch((0,p.filteredCatch)(v.E404,(()=>{}))).catch((e=>{__LOG__(2)`chat:onEmptyMRM failed\n${e}`}))}getSearchContext(e,t){let n,r=null;e instanceof ge.Msg?r=e:e instanceof B.default&&(n=e);let i=r?r.msgChunk:void 0;const a=Math.trunc(L.PAGE_SIZE/3*2);if(!i||!i.msgLoadState.contextLoaded){i||(i=new se.ChatMsgsCollection,this.msgChunks.push(i),r&&i.add(r));const e=r?r.id.clone():n.clone();e.count=a;const o=function(){if(r)return r.msgChunk;if(null!=n){const e=me.MsgCollection.get(n);return(null==e?void 0:e.msgChunk)?e.msgChunk:i}return i},s=(0,Le.newMessageQueryEvent)(De.default.WEBC_QUERY_TRIGGER_TYPE.SEARCH_RESULT_CLICK);M.loadMsgsPromiseLoop(this,r,i,me.MsgCollection.getContext.bind(me.MsgCollection,e,o,(e=>{s.webcResponseBytes+=e.binarySize})),"around",s,null==t).then((e=>{const t=o();t&&i&&t!==i&&this.notifyMsgCollectionMerge(t,i,t);const s=e[0],l=n?me.MsgCollection.get(n):r;l&&Array.isArray(s)&&s.length<a&&((0,_.default)(l.msgChunk,"loadedMsg.msgChunk").msgLoadState.noEarlierMsgs=!!(0,T.isLegacyWebdBackend)()||this.endOfHistoryTransferType!==b.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE,i&&l.msgChunk!==i&&(i.msgLoadState.noEarlierMsgs=!!(0,T.isLegacyWebdBackend)()||this.endOfHistoryTransferType!==b.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE))})).catch((()=>{t&&(t.isQuotedMsgAvailable=!1)}))}return{collection:i,msg:r,key:n,highlightMsg:!0}}deleteMsgs(e,t){this.deleteMsgsBeforeMsgInclusive(void 0,!e,t)}deleteMsgsOlderThan(e,t,n){const r=this.msgs;let i=r.head();!i||i.t>=e||(i=r.last(),i&&i.t<e?this.deleteMsgs(t,n):this.deleteMsgsPartial((function(r){return r&&(n&&!(0,ye.msgMatchesType)(r,n)||r.star&&!t||r.t>=e||r.isInitialE2ENotification)})))}deleteMsgsBeforeMsgInclusive(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;if(e){if(!this.msgs.get(e.id))return;t=this.msgs.indexOf(e)}else t=this.msgs.length;this.deleteMsgsPartial((function(e,i){return r&&!(0,ye.msgMatchesType)(e,r)||e.msgChunk===this.msgs&&i>t||n&&e.star||e.isInitialE2ENotification&&n}),!0)}deleteMsgsPartial(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.unreadCount;if(this.getAllCMCs().forEach((n=>{const r=n.filter(((t,n,r)=>!e.apply(this,[t,n,r])));n.remove(r,void 0,t),r.forEach((e=>{e.delete()}))})),(0,l.default)(this.msgChunks).forEach((e=>{0===e.length&&this.removeMsgsCollection(e)})),this.msgs.length>0){const e=n>this.msgs.length?this.msgs.length:n;(0,Oe.updateLocal)(this.id,{unreadCount:e}).then((()=>{this.unreadCount=e,this.msgs.msgLoadState.noEarlierMsgs=!!(0,T.isLegacyWebdBackend)()||this.endOfHistoryTransferType!==b.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE}))}}deleteMessages(e){this.deleteMsgsPartial((t=>!e.includes(t.id.toString())),!0),0===this.getAllMsgs().length&&M.loadEarlierMsgs(this)}getLastMsgKeyForAction(){const e=this.msgs.last();let t;return e&&(t=!this.lastReceivedKey||e.id.fromMe&&e.local&&e.ack===S.ACK.CLOCK?e.id:this.lastReceivedKey),t||void 0}getWebcChatType(){switch(this.kind){case b.CHAT_KIND.CHAT:return De.default.WEBC_CHAT_TYPE.INDIVIDUAL;case b.CHAT_KIND.GROUP:return De.default.WEBC_CHAT_TYPE.GROUP;case b.CHAT_KIND.BROADCAST:return De.default.WEBC_CHAT_TYPE.BROADCAST_LIST;default:throw new TypeError(`Invalid Chat.kind ${String(this.kind)}`)}}deregisterExpiredViewOnceBulkMessages(e){e.forEach(this._deregisterExpiredViewOnceMessage)}_deregisterExpiredViewOnceMessage(e){(0,Te.isExpired)(e.safe())&&(0,Re.deregisterMsg)(e)}_resetEphemeralMessageExpirationTimer(e){var t=this;E.default.clearTimeout(this._ephemeralMessageTimerIds.get(e)),this._ephemeralMessageTimerIds.delete(e),this._ephemeralMessagesToDelete.delete(e);const{ephemeralExpirationTimestamp:r}=e;if(null==r||!this.msgs.includes(e)||e.isKept)return;const i=function(){var r=(0,a.default)((function*(){if(t._ephemeralMessageTimerIds.delete(e),t.active)t._ephemeralMessagesToDelete.add(e);else{if((0,T.isMDBackend)()){yield(0,Ge.removeExpiredMessagesFromHistory)([e]),(0,Q.deleteModelsForLastReactionPreview)([e.id.toString()]);const r=n(203292).getJobManager;yield r().waitUntilPersisted(j.jobSerializers.deleteAddOns(t.id.toString(),[e.id.toString()]))}e.delete({skipUpdatingSortTime:!0,doNotResetLastReceived:!0})}}));return function(){return r.apply(this,arguments)}}();if(e.isExpired())i();else{const t=E.default.setGlobalTimeout(i,1e3*r);this._ephemeralMessageTimerIds.set(e,t)}}sendProductMessage(e,t){var n=this;return(0,a.default)((function*(){yield(0,re.sendProductMessage)(n,e,t)}))()}_isMediaMsg(e){return Boolean(e.asMms&&!e.ctwaContext)}isUnreadMsg(e){const t=this.msgs.filter((e=>e.isUnreadType));return t.includes(e,t.length-this.unreadCount)}_forwardMessageAndSendToChat(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._isMediaMsg(e))return(0,Re.forwardMediaMsg)(e,this,n).then(void 0);const r=je(e),i=(0,Z.getMaybeMeUser)();let a;(0,T.isMDBackend)()?t.isGroup()&&(a=(0,te.toUserWid)(i)):a=void 0;const o=new B.default({from:i,to:t,id:B.default.newId(),participant:a,selfDir:"out"});e.ctwaContext&&(r.body=e.ctwaContext.sourceUrl,r.type=F.MSG_TYPE.CHAT,r.mediaObject=void 0),this.isEphemeralSettingOn()&&(r.ephemeralDuration=this.getEphemeralSetting());const s=this.getEphemeralSettingTimestamp();null!=s&&(r.ephemeralSettingTimestamp=s);const l=this.getDisappearingModeInitiator();return null!=l&&(r.disappearingModeInitiator=l),Object.assign(r,{id:o,from:i,t:R.Clock.globalUnixTime(),to:t,ack:S.ACK.CLOCK,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1,isForwarded:e.isForwarded||!e.isSentByMe,forwardedFromWeb:!0,forwardingScore:e.getForwardingScoreWhenForwarded(),multicast:n}),(0,K.addAndSendMsgToChat)(this,r),Promise.resolve()}forwardMessages(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.default)((function*(){const r=t.id,i=t.contact;if(i.isUser&&i.isBlocked())throw new U.default("Forwarded to contact is blocked",i);const a=[];for(const i of e)try{yield t._forwardMessageAndSendToChat(i,r,n)}catch(e){t._isMediaMsg(i)&&a.push(i)}return a}))()}updateIsAnnounceGrpRestrict(){const e=this.groupMetadata;if(this.isGroup&&null!=e&&!e.stale){const t=e.participants.get((0,Z.getMaybeMeUser)()),n=t&&!t.isAdmin&&e.announce;this.isAnnounceGrpRestrict!==n&&(__LOG__(2)`chat:updateIsAnnounceGrpRestrict:old ${this.isAnnounceGrpRestrict}, new: ${n}`,(0,Oe.updateLocal)(this.id,{isAnnounceGrpRestrict:n}).then((()=>this.isAnnounceGrpRestrict=n)))}}sortMsgs(e){const t=e.map((e=>{const t=(0,_.default)(e.msgChunk,"msg.msgChunk");return{msg:e,chunkT:(0,_.default)(t.at(0),"chunk.at(0)").t,index:t.indexOf(e)}}));return(0,s.default)(t,["chunkT","index"]).map((e=>e.msg))}waitForChatLoading(){let e=Promise.resolve();return(0,T.isMDBackend)()&&this.pendingInitialLoading&&(e=(0,G.default)(this,"change:pendingInitialLoading",(()=>!this.pendingInitialLoading))),e}unstarAll(){const e=this.getAllMsgs();e.forEach((e=>{e&&(e.star=!1)})),(0,Ce.removeStarredMsgs)(e)}fts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0;if(1===t){const r=this.ftsCache[e];if(r)return r;const i=me.MsgCollection.search(e,t,n,this.id);this.ftsCache[e]=i;const a=()=>{this.ftsCache[e]=null};return setTimeout(a,b.FTS_TTL),i.catch(a),i}return me.MsgCollection.search(e,t,n,this.id)}_clearFtsCache(){this.ftsCache={}}updateSortTime(){if(this.promises.updateSortTime)return;const e=new r,t=e.signal,n=(0,g.default)([t,this._abortController.signal],(e=>(0,h.delayMs)(0).then((()=>{const e=(0,P.getLastTimestampMsg)(this);if(e)this.t=e.t;else if(!this.msgs.msgLoadState.noEarlierMsgs&&!this.pendingMsgs)return M.loadEarlierMsgs(this)})).then((t=>{if(e.aborted)throw new d.AbortError;if(t){const e=(0,P.getLastTimestampMsg)(this);this.t=e?e.t:void 0}})).catch((()=>{})).finally((()=>{this.promises.updateSortTime=void 0}))));this.promises.updateSortTime={promise:n,abortController:e}}removeFromCollection(e){var t;(e.star&&(0,Ce.removeStarredMsgs)([e]),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.getLinks().length>0&&this.linkMsgs?this.linkMsgs.remove(e):e.asDoc&&this.docMsgs?this.docMsgs.remove(e):null!=e.asProduct&&this.productMsgs&&this.productMsgs.remove(e),(0,I.updateMediasCountOnMsg)(this,e,!0),(0,y.isGroupCatchUpEnabled)()&&e.chat.isGroup)&&(null===(t=e.chat.groupMetadata)||void 0===t||t.unreadMentionMetadata.removeUnreadMentions(e.id.toString()))}getMediaMsgs(){return this.mediaMsgs||(this.mediaMsgs=new oe.default),this.mediaMsgs}getLinkMsgs(){return this.linkMsgs||(this.linkMsgs=new ae.default),this.linkMsgs}getDocMsgs(){return this.docMsgs||(this.docMsgs=new ie.default),this.docMsgs}getParticipantCount(){var e;return(null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.length)||1}getProductMsgs(){return this.productMsgs||(this.productMsgs=new ne.default),this.productMsgs}getReceivedVcardMsgs(){return this.contact.isMyContact||!this.contact.isUser?null:(this.receivedVcardMsgs||(this.receivedVcardMsgs=new le.default,this.receivedVcardMsgs.parent=this),this.receivedVcardMsgs)}dismissVcard(){this.vcardDismissed=!0}getStarredMsgs(){let e=this.starredMsgs;return e||(this.starredMsgs=e=new Ce.StarredMsgCollection,this.starredMsgs.add(Ce.AllStarredMsgsCollection.filter((e=>e.chat===this)))),e}getKeptMsgs(){let e=this.keptMsgs;return e||(this.keptMsgs=e=new _e.KeptMsgCollection,this.keptMsgs.add(this.msgs.filter((e=>e.isKept)))),e}hasKicSystemMessage(){return this.msgs.some((e=>"gp2"===e.type&&"ephemeral_keep_in_chat"===e.subtype))}setAndKeepPrevious(e,t){const n=Object.keys(e);n.forEach((e=>{e in this.ackedProps||(this.ackedProps[e]=this[e])})),t.finally((()=>{n.forEach((e=>{delete this.ackedProps[e]}))})),this.set(e)}getAckedPhoneProps(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,ephemeralDuration:this.ephemeralDuration,ephemeralSettingTimestamp:this.ephemeralSettingTimestamp,changeNumberOldJid:this.changeNumberOldJid,changeNumberNewJid:this.changeNumberNewJid,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}matchFilter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!(0,c.default)(e)||(e.label?this.labels&&this.labels.includes(e.label):e.kind===ke.SEARCH_FILTERS.UNREAD?!!this.hasUnread&&!this.isBroadcast:e.kind===ke.SEARCH_FILTERS.CONTACT?this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===ke.SEARCH_FILTERS.NON_CONTACT?!this.contact.isMyContact&&!this.contact.isGroup&&!this.isBroadcast:e.kind===ke.SEARCH_FILTERS.cast(this.kind))}getEphemeralSetting(){var e;const t=this.isGroup?null===(e=this.groupMetadata)||void 0===e?void 0:e.ephemeralDuration:this.ephemeralDuration;return null==t||0===t?null:t<0?(__LOG__(3)`[ephemeral] invalid duration of ${t} for chat ${this.id.toString()}`,null):t}getEphemeralSettingTimestamp(){return this.isGroup||0===this.ephemeralSettingTimestamp?null:this.ephemeralSettingTimestamp}isEphemeralSettingOn(){const e=this.getEphemeralSetting();return null!=e&&0!==e}shouldShowEphemeralSetting(){if((0,T.isLegacyWebdBackend)()&&!x.LegacyPhoneFeatures.supportsFeature(x.LegacyPhoneFeatures.F.EPHEMERAL_MESSAGES))return!1;if(this.isGroup){var e,t;const n=null===(e=this.groupMetadata)||void 0===e?void 0:e.participants.getSuperAdmin();if(null==n?void 0:n.contact.isEnterprise)return!1;if(!(null===(t=this.groupMetadata)||void 0===t?void 0:t.canSetEphemeralSetting())&&!this.isEphemeralSettingOn())return!1}return!this.isBroadcast&&!this.contact.isEnterprise}getDisappearingModeInitiator(){return this.isGroup?null:(0,y.isDisappearingModeEnabled)()?null!=this.disappearingModeInitiator?this.disappearingModeInitiator:this.isEphemeralSettingOn()?Ie.DisappearingModeInitiator.ChangedInChat:null:null}getCollection(){return n(669951).ChatCollection}getGroupMetadataCollection(){return n(963928).default}}function je(e){var t;let n=["buttons","caption","broadcast","ephemeralDuration","ephemeralSettingTimestamp","ephemeralStartTimestamp","ephemeralOutOfSync","dynamicReplyButtons","replyButtons","isMdHistoryMsg","bizPrivacyStatus","kicState","kicKey","kicTimestamp","kicNotified"];!0===e.isDynamicReplyButtonsMsg&&e.type===F.MSG_TYPE.CHAT||(n=["footer",...n]),(null===(t=e.quotedMsg)||void 0===t?void 0:t.type)!==F.MSG_TYPE.PRODUCT&&(n=["quotedMsg","quotedParticipant","quotedRemoteJid","quotedStanzaID",...n]);const r=e.asUrl;return null==r||null==r.mediaKeyTimestamp||(0,Ne.default)(r.mediaKeyTimestamp)||(n=["mediaKey","mediaKeyTimestamp","thumbnailHQ","thumbnailDirectPath","thumbnailSha256","thumbnailEncSha256","thumbnailHeight","thumbnailWidth",...n]),(0,o.default)(e.toJSON(),n)}Fe.Proxy="chat",Fe.idClass=ee.default;const Ye=(0,he.defineModel)(Fe);t.Chat=Ye},189036:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canAddGroupToCommunity=function(e){if(!(null==e?void 0:e.groupMetadata)||s(e))return!1;const t=e.groupMetadata,n=t.participants;return n.iAmAdmin()||n.iAmSuperAdmin()||(0,a.isMeAccount)(t.owner)},t.canDeactivateCommunity=function(e){if(!(null==e?void 0:e.groupMetadata)||s(e))return!1;const t=e.groupMetadata;return t.participants.iAmSuperAdmin()||(0,a.isMeAccount)(t.owner)},t.isIntegritySuspendedCommunity=s;var r=n(257243),i=n(173679),a=n(978820),o=n(455981);function s(e){var t;return(null==e||null===(t=e.groupMetadata)||void 0===t?void 0:t.groupType)===o.GroupType.COMMUNITY&&(0,i.isSuspendedGroup)(e)&&(0,r.getABPropConfigValue)("community_suspend_v0_enabled")}},432594:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(e,t)=>{const n=e.pin||0,r=t.pin||0;if(n||r)return n!==r?n>r?-1:1:e.id.toString()<t.id.toString()?-1:1;const i=e.t||0,a=t.t||0;return i!==a?i>a?-1:1:e.id.toString()<t.id.toString()?-1:1};t.default=n},461957:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FTS_TTL=t.ConversationEndOfHistoryTransferModelPropType=t.CHAT_KIND=void 0;const r=n(76672)({COMPLETE_BUT_MORE_MESSAGES_REMAIN_ON_PRIMARY:0,COMPLETE_AND_NO_MORE_MESSAGE_REMAIN_ON_PRIMARY:1,INCOMPLETE:2,NOT_INCLUDED_IN_HIST_SYNC:3});t.ConversationEndOfHistoryTransferModelPropType=r;t.FTS_TTL=3e5;t.CHAT_KIND={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat",COMMUNITY:"community"}},933852:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFirstMsgWithStatus=function(e){return(0,o.unproxy)(e).msgs.getModelsArray().find((function(e){return!e.isNotification&&(e.isSentByMe||e.type===a.MSG_TYPE.PTT||e.isViewOnce||e.isEphemeral)}))},t.getLastReceivedMsg=function(e){const t=(0,o.unproxy)(e);for(let e=t.msgs.length-1;e>=0;e--){const n=t.msgs.at(e);if(n&&(!n.local||n.ack>r.ACK.CLOCK))return n}return},t.getLastReceivedNonExpiredMsg=function(e,t){const n=(0,o.unproxy)(e);for(let e=n.msgs.length-1;e>=0;e--){const i=n.msgs.at(e);if(i&&(!i.local||i.ack>r.ACK.CLOCK)&&(!i.isEphemeral||null!=i.ephemeralExpirationTimestamp&&i.ephemeralExpirationTimestamp>t))return i}return},t.getLastTimestampMsg=function(e){const t=(0,o.unproxy)(e);for(let e=t.msgs.length-1;e>=0;e--){const n=t.msgs.at(e);if(n&&"i"!==(0,i.eventTypeFromMsgType)(n))return n}return};var r=n(535470),i=n(237540),a=n(115461),o=n(118146);n(17304)},173679:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.canSendToGroup=function(e){const t=(0,d.unproxy)(e);return t.canSend&&!_(t)&&!f(t)},t.getParticipantCount=function(e){var t;const n=(0,d.unproxy)(e);return(null===(t=n.groupMetadata)||void 0===t?void 0:t.participants.length)||1},t.isCommunityAnnouncementGroup=function(e){var t;const n=(0,d.unproxy)(e);return n.isGroup&&(null===(t=n.groupMetadata)||void 0===t?void 0:t.groupType)===u.GroupType.DEFAULT_ANNOUNCEMENT_GROUP},t.isIntegritySuspendedDefaultSubgroup=function(e){var t;const n=(0,d.unproxy)(e);return(null===(t=n.groupMetadata)||void 0===t?void 0:t.groupType)===u.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&_(n)&&(0,i.getABPropConfigValue)("community_suspend_v0_enabled")},t.isInviteGrowthLockedGroup=function(e){const t=(0,d.unproxy)(e);var n;return!(!(0,o.isMDBackend)()||!(0,i.getABPropConfigValue)("growth_lock_v0_enabled"))&&(t.isGroup&&"invite"===(null===(n=t.groupMetadata)||void 0===n?void 0:n.growthLockType)&&(t.groupMetadata.growthLockExpiration||0)>s.Clock.globalUnixTime())},t.isSupportGroup=p,t.isSupportGroupOrSupportAdmin=function(e){const t=(0,d.unproxy)(e);return p(t)||(0,a.default)(t.id.user)},t.isSuspendedGroup=_,t.isTerminatedGroup=f,t.isTerminatedGroupOrNotMember=function(e){var t;const n=(0,d.unproxy)(e),r=f(n),a=_(n)&&!(null===(t=n.groupMetadata)||void 0===t?void 0:t.participants.iAmMember());return(0,i.getABPropConfigValue)("group_suspend_v1_enabled")&&(r||a)},t.shouldBlockCall=function(e){return _(e)||f(e)&&(0,i.getABPropConfigValue)("group_suspend_v1_enabled")},t.shouldShowTerminatedGroupMsgBar=function(e){return f((0,d.unproxy)(e))&&(0,i.getABPropConfigValue)("group_suspend_v1_enabled")},t.updateIsAnnounceGrpRestrict=function(e){const t=(0,d.unproxy)(e),n=t.groupMetadata;if(t.isGroup&&null!=n&&!n.stale){const e=n.participants.get((0,l.getMaybeMeUser)()),r=e&&!e.isAdmin&&n.announce;(0,c.updateLocal)(t.id,{isAnnounceGrpRestrict:r}).then((()=>t.isAnnounceGrpRestrict=r))}},t.updateReadOnly=function(e){var t;const n=(0,d.unproxy)(e);if(p(n)&&n.isReadOnly)return;let r=Promise.resolve();if(n.isGroup&&!(null===(t=n.groupMetadata)||void 0===t?void 0:t.stale)){let e=!1;var i,a;if((0,o.isMDBackend)())e=!(null===(i=n.groupMetadata)||void 0===i?void 0:i.participants.get((0,l.getMeUser)()))||_(n)||f(n);else e=!(null===(a=n.groupMetadata)||void 0===a?void 0:a.participants.get((0,l.getMaybeMeUser)()));n.isReadOnly!==e&&(__LOG__(2)`chat:updateReadOnly:old ${n.isReadOnly}, new ${e}`,r=(0,c.updateLocal)(n.id,{isReadOnly:e}).then((()=>n.isReadOnly=e)))}r.then((()=>{n.isBroadcast&&n.updateTitle()}))};var i=n(257243),a=r(n(726682)),o=n(88555),s=n(40234),l=n(978820),c=n(358871),u=n(455981),d=n(118146);function p(e){var t;if(!e)return!1;const n=(0,d.unproxy)(e);return n.isGroup&&!0===(null===(t=n.groupMetadata)||void 0===t?void 0:t.support)}function f(e){var t;const n=(0,d.unproxy)(e);return n.isGroup&&!!(null===(t=n.groupMetadata)||void 0===t?void 0:t.terminated)}function _(e){if(!e)return!1;const t=(0,d.unproxy)(e);if((0,o.isMDBackend)()){var n;return(0,i.getABPropConfigValue)("group_suspend_v0_enabled")&&t.isGroup&&!!(null===(n=t.groupMetadata)||void 0===n?void 0:n.suspended)}return!1}},322911:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.loadEarlierMsgs=function(){return P.apply(this,arguments)},t.loadMsgsPromiseLoop=I,t.loadRecentMsgs=function(e,t,n){const r=(0,T.unproxy)(e);let i=t;i||(i=r.msgs);return O(r,i)?Promise.resolve():i.msgLoadState.isLoadingRecentMsgs?i.loadRecentPromise:M(r,"after",i,v.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL,n)};var i=r(n(348926)),a=n(389385),o=n(180284),s=n(450796),l=r(n(145095)),c=n(413959),u=n(904352),d=r(n(71197)),p=n(492574),f=n(88555),_=n(461957),h=n(813042),g=r(n(312523)),m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=b(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),y=n(176562),S=r(n(963236)),E=n(999588),v=r(n(11339)),T=(n(951612),n(118146)),C=(n(17304),n(559871)),A=n(765044);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(b=function(e){return e?n:t})(e)}function P(){return(P=(0,i.default)((function*(e,t,n,r){const i=(0,T.unproxy)(e);(0,f.isMDBackend)()&&(yield i.waitForChatLoading());let a=t;const o=null!=n?n:v.default.WEBC_QUERY_TRIGGER_TYPE.USER_SCROLL;if(a||(a=i.msgs),a.msgLoadState.noEarlierMsgs)return Promise.resolve();if(a.msgLoadState.isLoadingEarlierMsgs)return a.loadEarlierPromise;const s=a?a.head():null,l=yield M(i,"before",a,o,r),c=s?s.msgChunk:a;return c&&Array.isArray(l)&&l.length<h.PAGE_SIZE&&(c.msgLoadState.noEarlierMsgs=!!(0,f.isLegacyWebdBackend)()||i.endOfHistoryTransferType!==_.ConversationEndOfHistoryTransferModelPropType.INCOMPLETE),c&&O(i,c)&&i.trigger("msgs:loadEarlier"),l}))).apply(this,arguments)}function O(e,t){return e.msgs===t}function M(e,t,n,r,i){let a;a="after"===t?n.last():n.head();let o={};a?o=a.id.clone():o.remote=e.id,o.count=h.PAGE_SIZE,o.direction=t;const s=(0,E.newMessageQueryEvent)(r);return I(e,a,n,C.MsgCollection.findQuery.bind(C.MsgCollection,o,{logOnSend:e=>{s.webcResponseBytes+=e.binarySize}}),t,s,!0,i)}function I(e,t,n,r,l,_){let h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7?arguments[7]:void 0;const b=(0,T.unproxy)(e),P=performance.now();"after"===l?(n.msgLoadState.isLoadingRecentMsgs=!0,_.webcMessageQueryType=v.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_NEXT):"before"===l?(n.msgLoadState.isLoadingEarlierMsgs=!0,_.webcMessageQueryType=v.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_PREV):"around"===l&&(n.msgLoadState.isLoadingAroundMsgs=!0,_.webcMessageQueryType=v.default.WEBC_MESSAGE_QUERY_DIRECTION.LOAD_AROUND),_.webcBrowserNetworkType=(0,y.getEffectiveNetworkType)(),_.webcChatType=b.getWebcChatType(),"number"==typeof b.initialIndex&&(_.webcChatPosition=b.initialIndex);const O=(0,d.default)([C,b.deleteSignal].filter(Boolean),(e=>(0,u.promiseLoop)(function(){var s=(0,i.default)((function*(i,s,u){if(e.aborted)throw new a.AbortError;const d=(0,c.delayMs)((0,o.expBackoff)(u,12e4,1e3,.1));let h=Promise.resolve();(0,f.isLegacyWebdBackend)()&&"CONNECTED"!==A.Socket.stream&&(h=(0,g.default)(A.Socket,"change:stream",(()=>"CONNECTED"===A.Socket.stream)));try{yield h;const o=yield r();if(e.aborted)throw new a.AbortError;let s;_.webcQueryT=Math.ceil(performance.now()-P),Array.isArray(o[0])?(s=o[0][0],o.forEach((e=>(0,E.logMessageCounts)(_,e)))):(s=o[0],(0,E.logMessageCounts)(_,o)),s&&(_.webcEarliestMessageT=s.t,s.msgChunk===b.msgs&&(_.webcEarliestMessageIndex=b.msgs.length-1)),(0,S.default)().then((e=>{e&&(_.webcBrowserStorageQuotaBytes=e.quota,_.webcBrowserStorageQuotaUsedBytes=e.usage)})).finally((()=>_.commit())),w(t,n,l),i(o)}catch(e){if(e.name===a.ABORT_ERROR)throw e;return u>3||404===e?(w(t,n,l),__LOG__(3)`chat:loadMsgs:error ${String(e)}`,404===e?Promise.reject(new p.E404):Promise.reject(new m.GaveUpRetry(`Gave up msg fetch after ${u} tries`))):d}}));return function(){return s.apply(this,arguments)}}(),0))).catch((0,s.filteredCatch)(m.GaveUpRetry,(()=>[]))).catch((0,s.filteredCatch)(p.E404,(e=>{if(h)return[];throw e})));return"after"===l?n.loadRecentPromise=O:"before"===l?n.loadEarlierPromise=O:"around"===l&&(n.loadAroundPromise=O),O}function w(e,t,n){const r=(null==e?void 0:e.msgChunk)&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,e&&r&&((0,l.default)(e.msgChunk,"msg.msgChunk").msgLoadState.contextLoaded=!0),"after"===n?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===n?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===n&&(t.msgLoadState.isLoadingAroundMsgs=!1)}},716055:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addMediaMsgs=function(e,t,n){if(!t)return;const r=(0,c.unproxy)(e),a=Array.isArray(t)?t:[t],o=[],l=[],d=[],p=[];a.forEach((e=>{u(e)&&o.push(e),e.asDoc&&d.push(e),e.linkPreview&&l.push(e),null!=e.asProduct&&p.push(e)}));const{mediaMsgs:f}=r;if(f&&o.length){const e=(0,s.isMediaGalleryFixEnabled)()?(0,i.default)((0,i.default)({},n),{},{silent:!1}):(0,i.default)({},n);f.add(o,e)}r.linkMsgs&&l.length&&r.linkMsgs.add(l,n);r.docMsgs&&d.length&&r.docMsgs.add(d,n);r.productMsgs&&p.length&&r.productMsgs.add(p,n)},t.constructMediaMsgs=function(e,t){const n=(0,c.unproxy)(e);if(!t)return n.getMediaMsgs();if(t.isViewOnce)return new l.default;let r;n.getMediaMsgs().includes(t)||t.msgChunk===n.msgs?(r=n.getMediaMsgs(),r.hasMediaAfter=!1):r=new l.default;r.includes(t)||(t.msgChunk?r.add(t.msgChunk.filter(u)):r.add(t));return r},t.countAllMedia=function(e){if((0,a.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`countAllMedia can be called only from MD code`,SEND_LOGS("countAllMedia-not-from-MD"),Promise.resolve(0);const t=(0,c.unproxy)(e);if(null!=t.promises.sendDelete)return Promise.resolve(0);return Promise.all([t.getMediaMsgs(),t.getLinkMsgs(),t.getDocMsgs()].map((e=>e.count(t)))).then((e=>e.reduce(((e,t)=>e+(null!=t?t:0)),0)))},t.isMsgForMediaCollection=u,t.resetMediaMsgs=function(e){const t=(0,c.unproxy)(e),{mediaMsgs:n,linkMsgs:r,docMsgs:i,productMsgs:a}=t;n&&(n.delete(),n.queryMedia({chat:t}));r&&(r.delete(),r.queryLinks(t));i&&(i.delete(),i.queryDocs(t));a&&(a.delete(),a.queryProducts(t))},t.resetMediasCount=function(e,t){if(!o.LegacyPhoneFeatures.supportsFeature(o.LegacyPhoneFeatures.F.MEDIAS_COUNT))return;const n=(0,c.unproxy)(e);null!=t.mediaCount&&(n.mediaCount=t.mediaCount);null!=t.linkCount&&(n.linkCount=t.linkCount);null!=t.docCount&&(n.docCount=t.docCount)},t.updateMediasCountOnMsg=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!o.LegacyPhoneFeatures.supportsFeature(o.LegacyPhoneFeatures.F.MEDIAS_COUNT))return;const r=(0,c.unproxy)(e),i=n?-1:1;t.isMedia&&(r.mediaCount+=i);const a=t.getLinks().length;a&&(r.linkCount+=i*a);t.asDoc&&(r.docCount+=i)};var i=r(n(81109)),a=n(88555),o=n(438184),s=n(408139),l=r(n(165568)),c=n(118146);n(17304);function u(e){return e.isMedia&&!e.isViewOnce}},139814:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getAssignedColor=function(e,t){const n=(0,l.unproxy)(e),r=n.colors||(n.colors=u(n));let a;const s=(0,o.default)(t.toString());if(a=r[s])return a;const c={};(0,i.default)(r,((e,t)=>{c[e]?c[e].push(t):c[e]=[t]}));let d=Number.POSITIVE_INFINITY;for(let e=1;e<=17;e++){if(!c[e]){a=e;break}c[e].length<d&&(d=c[e].length,a=e)}return r[s]=a,n.saveAssignedColorsDebounced(),a},t.loadAssignedColors=u,t.saveAssignedColors=function(e){const t=(0,l.unproxy)(e),n=t.colors;n&&(0,s.setGroupParticipantAssignedColor)(t.id,n)};var i=r(n(402525)),a=r(n(291966)),o=r(n(611782)),s=n(555452),l=n(118146);function c(e){var t,n;const r=(0,l.unproxy)(e);if(!r.colors)return;const i=null!==(t=null===(n=r.groupMetadata)||void 0===n?void 0:n.participants)&&void 0!==t?t:[],s=r.colors,c=(0,a.default)(Object.keys(s),i.map((e=>e.id.toString())).map(o.default));c.forEach((function(e){delete s[e]})),c.length&&r.saveAssignedColorsDebounced()}function u(e){const t=(0,l.unproxy)(e);return t.groupMetadata&&t.listenTo(t.groupMetadata.participants,"remove reset",c),(0,s.getGroupParticipantAssignedColor)(t.id)||{}}},669951:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCollectionImpl=t.ChatCollection=void 0;var i=r(n(348926)),a=r(n(535937)),o=r(n(639693)),s=r(n(763105)),l=r(n(435161)),c=r(n(441609)),u=r(n(23279)),d=n(450796),p=n(413959),f=n(367602),_=n(492574),h=n(48826),g=r(n(432594)),m=n(716055),y=n(813042),S=r(n(312523)),E=r(n(702242)),v=r(n(428233)),T=n(930764),C=n(438184),A=r(n(465212)),b=n(832440),P=n(547159),O=n(491442),M=r(n(389867)),I=n(316770),w=n(999662),R=n(63183),N=n(317239),L=n(719380),D=n(801255),k=r(n(851783)),U=r(n(268132)),G=n(191692),x=n(16774),B=n(366299),F=n(765044),j=n(662583),Y=n(211082),K=n(203060),W=n(27211);class H extends D.BaseCollection{constructor(){super(),this.notSpam={},this.promises={sendUnstarAll:null},this._sortEnabled=!1,this._viewOnceCleanupTaskQueue=new Set,this.enableSortListener(),this.listenTo(F.Socket,"change:stream",(()=>{F.Socket.stream===j.SOCKET_STREAM.RESUMING&&this.forEach((e=>{e.pendingMsgs=!1}))})),this.listenToOnce(this,"sort",(0,u.default)(this.setIndexes,100)),this._scheduleViewOnceMediaCleanup()}_scheduleViewOnceMediaCleanup(){clearTimeout(this._viewOnceCleanupTimeout),this._viewOnceCleanupTimeout=setTimeout((()=>{T.IdleCallbackTasks.enqueue((()=>{this._runViewOnceMediaCleanup(),this._scheduleViewOnceMediaCleanup()}))}),18e5)}_runViewOnceMediaCleanup(){this.forEach((e=>{const t=e.id;this._viewOnceCleanupTaskQueue.has(t)||(T.IdleCallbackTasks.enqueue((()=>{this._viewOnceCleanupTaskQueue.delete(t);const e=this.get(t);!1===(null==e?void 0:e.active)&&e.deregisterExpiredViewOnceBulkMessages(e.msgs)})),this._viewOnceCleanupTaskQueue.add(t))}))}enableSortListener(e){this._sortEnabled||(this.listenTo(this,"change:t change:pin change:shouldAppearInList",this.sort),e&&this.sort(),this._sortEnabled=!0)}disableSortListener(){this._sortEnabled&&(this.stopListening(null,null,this.sort),this._sortEnabled=!1)}setIndexes(){this.forEach(((e,t)=>{e.initialIndex=t}))}getActive(){return this.filter((e=>e.active))[0]}_findQuery(e){var t=this;return(0,i.default)((function*(){const r={},i=yield(0,Y.find)(!!e.retry,r);if("preempted"===i)return Promise.reject(new D.CollectionSilentQueryError("chats preempted"));if(N.Conn.platform===N.PLATFORMS.IPHONE||N.Conn.platform===N.PLATFORMS.SMBI){const e=n(559871).MsgCollection;(0,c.default)(i)?e.trigger(y.COLLECTION_HAS_SYNCED):setTimeout((()=>{e.trigger(y.COLLECTION_HAS_SYNCED)}),2500)}return t.trigger(y.COLLECTION_HAS_SYNCED,r),Promise.resolve(i)}))()}sync(){this.findQuery({}).catch((0,d.filteredCatch)(_.WebdDrop,(()=>{})));const e=n(559871).MsgCollection;return Promise.all([(0,S.default)(this,y.COLLECTION_HAS_SYNCED),e.hasSynced()])}getKeysForResyncMsgs(){return this.filter((function(e){return e.shouldAppearInList})).map((function(e){const t=e.getAckedPhoneProps(),n=e.lastReceivedKey;return n&&(t.id=n.id,t.fromMe=n.fromMe.toString(),t.participant=n.participant),t}))}resyncMessages(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ChatStore:resyncMessages`;const t=e.getKeysForResyncMsgs();try{const r=yield(0,K.resyncMessages)(t);if(r.status>=400)return __LOG__(3)`ChatStore:resyncMessages resume error ${r.status}`,Promise.reject(new Error("ChatStore:resyncMessages resume error "+r.status));__LOG__(2)`ChatStore:resyncMessages resume success`;try{e.disableSortListener(),r.data.forEach((t=>{if(t.disableUnreadAnchor=!1,t.firstUnreadKey=void 0,t.keys&&1===t.keys.length){const e=t.keys[0];t.firstUnreadKey=new A.default({id:e[0],fromMe:e[1],participant:e[2],remote:t.id})}if("delete"!==t.type&&!M.default.isPSA(t.id)){const e=L.ContactCollection.get(t.id);if(e){if(t.name){const n={name:t.name};(0,W.updateLocal)(e.id,n).then((()=>{e.set(n)}))}}else L.ContactCollection.add({id:t.id,name:t.name})}const n=e.get(t.id);if(n)if("clear"===t.type){(0,m.resetMediaMsgs)(n);const e=[];n.msgs.forEach((t=>e.push(t))),n.msgChunks.length&&n.msgChunks.forEach((t=>{t.forEach((t=>e.push(t)))})),n.set({t:t.t,unreadCount:t.unreadCount,createdLocally:!1,archive:t.archive,isReadOnly:t.isReadOnly,modifyTag:t.modifyTag,msgs:[],notSpam:t.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:t.disableUnreadAnchor,pendingMsgs:t.pendingMsgs,pin:t.pin,changeNumberOldJid:t.changeNumberOldJid,changeNumberNewJid:t.changeNumberNewJid,muteExpiration:t.muteExpiration,ephemeralDuration:t.ephemeralDuration,ephemeralSettingTimestamp:t.ephemeralSettingTimestamp}),e.forEach((e=>{e.delete()})),__LOG__(2)`model:chat:resume: cleared chat for ${t.id}`}else"delete"===t.type?(n.delete(),__LOG__(2)`model:chat:resume: deleted chat for ${t.id}`):n.set(t,{merge:!0});else e.add(t)})),e.enableSortListener(!0)}catch(e){__LOG__(3)`model:chat:resume error in processing reply:${String(e)}`}(0,p.delayMs)(100).then((()=>{C.LegacyPhoneFeatures.supportsFeature(C.LegacyPhoneFeatures.F.USER_NOTICE)&&k.default.sync(!0),C.LegacyPhoneFeatures.supportsFeature(C.LegacyPhoneFeatures.F.SETTINGS_SYNC)&&U.default.sync(!0),r.checksum&&(0,b.resyncContacts)(r.checksum),r.statusChecksum&&n(459387).StatusV3Collection.sync(r.statusChecksum),r.quickRepliesChecksum&&w.QuickReplyCollection.sync(r.quickRepliesChecksum),r.labelsChecksum&&I.LabelCollection.sync(r.labelsChecksum),r.stickerPackChecksum&&B.StickerPackCollection.sync(r.stickerPackChecksum),null!=r.recentStickersChecksum&&G.RecentStickerCollection.sync(r.recentStickersChecksum),null!=r.starredStickersChecksum&&x.StarredStickerCollection.sync(r.starredStickersChecksum)})).catch((e=>{__LOG__(3)`model:chat:resume error in processing checksum:${String(e)}`}))}catch(e){return(0,d.filteredCatch)(_.WebdDrop,(function(e){return __LOG__(3)`ChatStore:resyncMessages resume dropped`,Promise.reject(e)}))(e)}}))()}unstarAllMessages(e,t){return(0,P.unstarAllMessages)(e,t)}forwardMessagesToChats(e,t){return(0,i.default)((function*(){const r=Promise.all(e.map((e=>(0,f.promiseProps)({message:e,canForward:e.canForward()&&(null!=n(559871).MsgCollection.get(e.id)||e.isEphemeral)})))),a=yield Promise.all(t.filter((e=>e.canSend)).map(function(){var e=(0,i.default)((function*(e){let t;t=e.isUser&&e.contact.isBlocked()?(0,h.unblockContact)(e.contact):Promise.resolve(!0);const[n]=yield Promise.all([r,t]),i=(0,l.default)((0,s.default)(n,{canForward:!0}),"message"),a=(0,l.default)((0,s.default)(n,{canForward:!1}),"message");return(0,f.promiseProps)({chat:e,undelivered:e.forwardMessages(i,!0),canForward:i,cannotForward:a})}));return function(){return e.apply(this,arguments)}}())),c=(0,o.default)(a.map((e=>{let{chat:t,undelivered:n,canForward:r,cannotForward:i}=e,a=null;return(n.length||i.length)&&(a=(0,E.default)({chat:t,undelivered:n,canForward:r,cannotForward:i})),a?{chat:t,reason:a}:null})));if(c.length)throw new v.default(c);return!0}))()}saveToCache(){if(!N.Conn.shouldSaveToCache())return;const{id:e}=H.cachePolicy;__LOG__(2)`ChatCollection:saveToCache save: ${String(e)}`;const t=this.map(((e,t)=>{const n=e.toJSON(),r=t<20?Math.min(e.unreadCount+20,50):Math.min(Math.max(3,e.unreadCount),20);return n.msgs=e.msgs?e.msgs.slice(-r).map((e=>(0,a.default)(e.toJSON(),(e=>void 0!==e)))):[],n}));O.userPreferencesStore.setCollection(e,t,!0)}onResume(){const e=this.getActive();e&&e.presence.subscribe()}delete(){super.delete(),this.listenToOnce(this,"sort",(0,u.default)(this.setIndexes,100))}}t.ChatCollectionImpl=H,H.model=R.Chat,H.comparator=g.default;const V=new H;t.ChatCollection=V},6977:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(450796),o=n(492574),s=n(88555),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=p(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),c=n(801255),u=n(17304),d=n(559871);function p(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(p=function(e){return e?n:t})(e)}class f extends c.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasDocBefore=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var n;if((0,s.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-docs-not-from-MD"),null;if(null!=e._count)return e._count;const r=t.msgs.filter(_),i=null!==(n=r[0])&&void 0!==n?n:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield d.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id,"document")).length)&&void 0!==a?a:0,n=t>0&&r.length>0?1:0;return e._count=t+r.length-n,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count docs for chat ${t.id}`,SEND_LOGS(`md-failed-docs-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening(),this.reset()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}queryDocs(e,t){if(t)return this.queryDocBefore||(this.queryDocBefore=d.MsgCollection.queryMedia(t.id.remote,d.MEDIA_QUERY_LIMIT,"before",t.id,"document").then((e=>((!e||e.length<d.MEDIA_QUERY_LIMIT)&&(this.hasDocBefore=!1),this.add(e.filter(_),{at:0}),{length:e.length}))).catch((0,a.filteredCatch)([o.WebdDrop,l.ProtoVersionUndefined,o.E404],(()=>{}))).finally((()=>{this.queryDocBefore=null,this.trigger("query_doc_before")})),this.trigger("query_doc_before")),this.queryDocBefore;const n=e.msgs;if(0===this.length){if(!n||0===n.length)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(n.filter(_),{at:0})}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasDocBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*d.MEDIA_QUERY_LIMIT){const t=0===this.length?n.head():this.head();return this.queryDocs(e,t)}return new Promise((e=>{e({eof:!1})}))}}function _(e){return null!=e.asDoc&&!e.isVcardOverMmsDocument}t.default=f,f.model=u.Msg},177653:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(450796),o=n(904352),s=n(492574),l=n(88555),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),u=n(801255),d=n(17304),p=n(559871);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}class _ extends u.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasLinkBefore=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var n;if((0,l.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-links-not-from-MD"),null;if(null!=e._count)return e._count;const r=t.msgs.filter((e=>e.getLinks().length>0)),i=null!==(n=r[0])&&void 0!==n?n:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield p.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id,"url")).length)&&void 0!==a?a:0,n=t>0&&r.length>0?1:0;return e._count=t+r.length-n,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count medias for chat ${t.id}`,SEND_LOGS(`md-failed-medias-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening(),this.reset()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}queryLinks(e,t){if(t)return this.queryLinkBefore||(this.queryLinkBefore=p.MsgCollection.queryMedia(t.id.remote,p.MEDIA_QUERY_LIMIT,"before",t.id,"url").then((e=>((!e||e.length<p.MEDIA_QUERY_LIMIT)&&(this.hasLinkBefore=!1),this.add(e,{at:0}),this.createLinksAndAddMsgs(e),{length:e.length}))).catch((0,a.filteredCatch)([s.WebdDrop,c.ProtoVersionUndefined,s.E404],(()=>{}))).finally((()=>{this.queryLinkBefore=null,this.trigger("query_link_before")})),this.trigger("query_link_before")),this.queryLinkBefore;const n=e.msgs.getModelsArray();if(0===this.length){if(!n||0===n.length)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(n.filter((e=>e.getLinks().length>0)),{at:0}),this.createLinksAndAddMsgs(n)}if(e.msgs.msgLoadState.noEarlierMsgs)return this.hasLinkBefore=!1,new Promise((e=>{e({eof:!0})}));if(this.length<=2*p.MEDIA_QUERY_LIMIT){const t=0===this.length?e.msgs.head():this.head();return this.queryLinks(e,t)}return new Promise((e=>{e({eof:!1})}))}createLinksAndAddMsgs(e){const t=[];(0,o.promiseLoop)(((n,r,i)=>{if(e.length===i)return void n();const a=e[i];if(null!=a){a.getLinks().length&&t.push(a)}})).then((()=>{this.add(t),this.trigger("query_link_before")}))}}t.default=_,_.model=d.Msg,_.comparator=(e,t)=>e.t-t.t},165568:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(450796),o=n(492574),s=n(88555),l=n(716055),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),u=n(801255),d=n(17304),p=n(559871);function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}const _="before",h="after";function g(e){return e.isMedia&&!e.isViewOnce}class m extends u.BaseCollection{constructor(){var e;super(...arguments),e=this,this.hasMediaBefore=!0,this.hasMediaAfter=!0,this._count=null,this.count=function(){var t=(0,i.default)((function*(t){var n;if((0,s.isLegacyWebdBackend)())return __LOG__(4,void 0,new Error,!0)`count can be called only from MD code`,SEND_LOGS("count-media-not-from-MD"),null;if(null!=e._count)return e._count;const r=t.msgs.filter(g),i=null!==(n=r[0])&&void 0!==n?n:t.msgs.head();if(null==i)return 0;try{var a;const t=null!==(a=(yield p.MsgCollection.queryMedia(i.id.remote,1/0,"before",i.id)).mediaCount)&&void 0!==a?a:0,n=t>0&&r.length>0?1:0;return e._count=t+r.length-n,e._count}catch(e){return __LOG__(4,!0,new Error,!0)`Failed to count medias for chat ${t.id}`,SEND_LOGS(`md-failed-medias-count: ${e.message}`),null}}));return function(){return t.apply(this,arguments)}}()}delete(){super.delete(),this.stopListening()}add(e,t){return this._count=null,super.add(e,t)}remove(e,t){return this._count=null,super.remove(e,t)}getAfter(e){const t=this.indexOf(e);return t<0||t===this.length-1?null:this.at(t+1)}getBefore(e){const t=this.indexOf(e);return t<=0?null:this.at(t-1)}loadEarlierMedias(){const e=this.head();e&&this.queryMedia({msg:e})}loadRecentMedias(){const e=this.last();e&&this.queryMedia({msg:e,direction:h})}loadMoreAroundIfNeeded(e){if(!e||e.isViewOnce)return;const t=this.indexOf(e);t<20&&this.hasMediaBefore&&this.loadEarlierMedias(),this.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}queryMedia(e){var t;const{chat:n,msg:r}=e,i=null!==(t=e.direction)&&void 0!==t?t:_;if(!r&&n){const e=n.msgs;if(!e||0===e.length)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));this.add(e.filter(g),{at:0});const t=this.toArray();if(n.msgs.msgLoadState.noEarlierMsgs)return this.hasMediaBefore=!1,new Promise((e=>{e({eof:!0})}));if(t.length<=2*p.MEDIA_QUERY_LIMIT){const r=0===t.length?e.head():t[0];return this.queryMedia({chat:n,msg:r})}return new Promise((e=>{e({eof:!1})}))}if(r&&i===_){if(this.queryMediaBefore)return this.queryMediaBefore;let e=0;return this.queryMediaBefore=p.MsgCollection.queryMedia(r.id.remote,p.MEDIA_QUERY_LIMIT,i,r.isMedia?r.id:void 0).then((t=>{const r=t.messages;(!r||r.length<p.MEDIA_QUERY_LIMIT)&&(this.hasMediaBefore=!1);let i=[];r&&r.length>0&&(i=r.filter(g)),this.add(i,{at:0});const a={mediaCount:t.mediaCount,linkCount:t.linkCount,docCount:t.docCount};return n&&(0,l.resetMediasCount)(n,a),e=i.length,{length:e}})).catch((0,a.filteredCatch)([o.WebdDrop,c.ProtoVersionUndefined,o.E404],(()=>{}))).finally((()=>{this.queryMediaBefore=null,this.trigger("query_media_before",e)})),this.trigger("query_media_before",0),this.queryMediaBefore}if(r&&i===h)return this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=p.MsgCollection.queryMedia(r.id.remote,p.MEDIA_QUERY_LIMIT,i,r.id).then((e=>{const t=e.messages;(!t||t.length<p.MEDIA_QUERY_LIMIT)&&(this.hasMediaAfter=!1);let r=[];t&&t.length>0&&(r=t.filter(g)),this.add(r);const i={mediaCount:e.mediaCount,linkCount:e.linkCount,docCount:e.docCount};return n&&(0,l.resetMediasCount)(n,i),{length:r.length}})).catch((0,a.filteredCatch)([o.WebdDrop,c.ProtoVersionUndefined,o.E404],(()=>{}))).finally((()=>{this.queryMediaAfter=null,this.trigger("query_media_after")}))}}t.default=m,m.model=d.Msg,m.comparator=(e,t)=>e.t-t.t},951612:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgLoadState=t.ChatMsgsCollection=void 0;var i=r(n(81109)),a=n(801255),o=n(411290),s=n(17304),l=r(n(441143));class c extends o.BaseModel{constructor(){super(...arguments),this.noEarlierMsgs=(0,o.prop)(),this.isLoadingEarlierMsgs=(0,o.prop)(),this.isLoadingRecentMsgs=(0,o.prop)(),this.isLoadingAroundMsgs=(0,o.prop)(),this.contextLoaded=(0,o.prop)()}}c.Proxy="msgLoad";const u=(0,o.defineModel)(c);t.MsgLoadState=u;class d extends a.BaseCollection{constructor(){super(),this.msgLoadState=new u({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)}delete(){this.stopListening(),super.delete(),this.msgLoadState.delete()}triggerChangeLast(e,t,n){const r=this.last();if(this._last!==r){this._last=r;let i=!1;const a=!!n.add,o=!!n.remove;t.includes(e)&&a&&!o&&(i=!0),this.trigger("change:last",r,i)}}add(e,t){let r;Array.isArray(e)?1===e.length&&(r=e[0]):r=e;let a=[];if(null!=r&&(r.isInitialE2ENotification||r.isDisappearingModeSystemMessage)){const n=this.some((e=>e.isInitialE2ENotification));if(r.isInitialE2ENotification&&(n||(a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:0})))),r.isDisappearingModeSystemMessage){if(!this.some((e=>e.isDisappearingModeSystemMessage))){const r=n?1:0;a=super.add(e,(0,i.default)((0,i.default)({},t),{},{at:r}))}}a&&this.trigger("insert_msgs",a,t)}else a=super.add(e,t);if(a.length>0){n(559871).MsgCollection.add(a,t).forEach((e=>{e&&this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",a,t)}return a}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=super.remove(e,t),i=!!t&&t.silent,a=r.filter((e=>!!e));return a.length&&!i&&(this.trigger("remove_msgs",a,t),n||this.trigger("update_sort_time")),r}replace(e){this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise;const t=e.getModelsArray();this.set(t,{silent:!0,merge:!1}),t.forEach((e=>{this.isModel(e)&&(e.msgChunk=this)})),this.trigger("bulk_add",t)}onMsgLoadStateChange(e){let t;const n=()=>{e()},r=()=>{(0,l.default)(null!=t,"prevMsgLoadState cannot be null after bulk_add"),t.off("change",n);const r=this.msgLoadState;r.on("change",n),t=r,e()};t=this.msgLoadState,t.on("change",n),this.on("bulk_add",r);let i=()=>{(0,l.default)(null!=t,"prevMsgLoadState cannot be null when unsubscribing"),this.off("bulk_add",r),t.off("change",n)};return()=>{const e=i;e&&(i=null,e())}}}t.ChatMsgsCollection=d,d.model=s.Msg},133929:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PREFERENCE=t.ChatPreference=void 0;var i=r(n(389867)),a=n(411290);const o="defaultPreference";t.DEFAULT_PREFERENCE=o;class s extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.wallpaperColor=(0,a.prop)(),this.saveToCameraRoll=(0,a.prop)(),this.showDoodle=(0,a.prop)()}getCollection(){return n(366034).default}}s.Proxy="chatPreference",s.idClass=i.default,s.allowedIds=[o];const l=(0,a.defineModel)(s);t.ChatPreference=l},366034:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(546718),i=n(133929),a=n(801255),o=n(714648),s=n(478123);class l extends a.BaseCollection{initializeFromCache(e){this.add([{id:i.DEFAULT_PREFERENCE,wallpaperColor:s.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0},...e||[]],{merge:!0})}get(e){return super.get(e)||super.get(i.DEFAULT_PREFERENCE)}delete(){super.delete(),this.add({id:i.DEFAULT_PREFERENCE,wallpaperColor:s.DEFAULT_CHAT_WALLPAPER,saveToCameraRoll:!0,showDoodle:!0})}}l.model=i.ChatPreference,l.cachePolicy={id:r.KEYS.CHAT_PREFERENCE_COLLECTION,policy:o.CACHE_POLICY.LOAD,delay:1e3};var c=new l;t.default=c},916173:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(450796),i=n(492574),a=n(438184),o=n(801255),s=n(17304),l=n(559871);class c extends o.BaseCollection{constructor(){super(...arguments),this.syncPromise=null,this.isSynced=!1}onResume(){this.isSynced=!1,this.sync(this.parent)}sync(e){return a.LegacyPhoneFeatures.supportsFeature(a.LegacyPhoneFeatures.F.INDEX_RECEIVED_VCARD)?this.isSynced?Promise.resolve():(this.syncPromise||(this.syncPromise=l.MsgCollection.queryVcard(e.id).then((e=>this.add(e))).catch((0,r.filteredCatch)(i.E499,(()=>{}))).catch((()=>{})).finally((()=>{this.isSynced=!0,this.syncPromise=null}))),this.syncPromise):(this.isSynced=!0,Promise.resolve())}}t.default=c,c.model=s.Msg,c.resumeOnAvailable=!0},11006:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(631727)),a=r(n(441809));class o extends i.default{oldestUnreadMention(){var e;const t=null!==(e=this.last())&&void 0!==e?e:null;return t&&this.remove(t),t}}t.default=o,o.model=a.default,o.comparator=(e,t)=>t.timestamp-e.timestamp},604550:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=r(n(477589)),o=n(555975);function s(){return(s=(0,i.default)((function*(){(yield Promise.allSettled([(0,a.default)(),o.LruMediaStore.clear()])).forEach((e=>{if("rejected"===e.status)throw e.reason}))}))).apply(this,arguments)}},98423:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handle=function(e){let[t]=e;switch(t.type){case"read":if(t.isStatus){f.StatusV3Collection.handle([t]);break}case"unread":const e=l.ChatCollection.get(t.jid);e&&("read"===t.type?(0,s.markSeen)(e):"unread"===t.type&&(0,s.markUnseen)(e));break;case"log":a.upload({reason:a.SERVER_REQUESTED,immediate:!0,force:!0,isHighPri:!0});break;case"privacy":if(t.jid){const e=u.PresenceCollection.get(t.jid);e&&e.reset(),d.ProfilePicThumbCollection.update(t.jid).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{}))),p.StatusCollection.update(t.jid).catch((0,r.filteredCatch)(i.WebdDrop,(()=>{})))}else __LOG__(3)`Store:Cmd:handle:privacy no jid`;break;case"identity":if(t.jid){const e=c.ContactCollection.get(t.jid);e?(0,o.updateIdentity)(e,t):__LOG__(3)`Store:Cmd:handle:identity no contact`}else __LOG__(3)`Store:Cmd:handle:identity no jid`;break;default:__LOG__(3)`Store:Cmd:handle:unknown ${t.type}`}};var r=n(450796),i=n(492574),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=_(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(386374)),o=n(961552),s=n(561498),l=n(669951),c=n(719380),u=n(868315),d=n(582039),p=n(46133),f=n(459387);function _(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_=function(e){return e?n:t})(e)}},697335:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(672894),a=n(139976),o=n(503027),s=n(203754),l=n(493581),c=n(316770),u=n(584312),d=n(599989),p=n(999662),f=n(132826),_=n(669951),h=r(n(366034)),g=n(719380),m=r(n(835667)),y=n(966423),S=n(513185),E=n(492671),v=r(n(963928)),T=r(n(873213)),C=n(985865),A=n(559871),b=n(617972),P=n(72472),O=n(90585),M=n(868315),I=n(582039),w=n(257162),R=n(505104),N=n(719011),L=n(46133),D=n(459387),k=r(n(870723)),U=n(191692),G=n(249264),x=n(16774),B=n(767963),F=n(344333),j=n(545068),Y=n(160868),K={Blocklist:f.BlocklistCollection,BusinessCategoryResult:s.BusinessCategoriesResultCollection,BusinessProfile:l.BusinessProfileCollection,Call:Y.CallCollection,Catalog:d.CatalogCollection,Chat:_.ChatCollection,ChatPreference:h.default,Contact:g.ContactCollection,ConversionTuple:m.default,DailyAggregatedStats:y.DailyAggregatedStatsCollection,EmojiVariant:S.EmojiVariantCollection,GroupMetadata:v.default,Label:c.LabelCollection,LiveLocation:C.LiveLocationCollection,Msg:A.MsgCollection,MsgInfo:b.MsgInfoCollection,Mute:P.MuteCollection,Order:u.OrderCollection,PollVote:O.PollVoteCollection,Presence:M.PresenceCollection,ProfilePicThumb:I.ProfilePicThumbCollection,QuickReply:p.QuickReplyCollection,RecentEmoji:E.RecentEmojiCollection,RecentSticker:U.RecentStickerCollection,StarredMsg:N.AllStarredMsgsCollection,StarredSticker:x.StarredStickerCollection,Status:L.StatusCollection,StatusV3:D.StatusV3Collection,Sticker:B.StickerCollection,StickerSearch:j.StickerSearchCollection,RecentStickerMD:G.RecentStickerCollectionMd,StickerPackCollectionMD:F.StickerPackCollectionMd,FavoriteSticker:k.default,Reactions:w.ReactionsCollection,RecentReactions:R.RecentReactionsCollection,UnjoinedSubgroupMetadataCollection:T.default,AgentCollection:i.AgentCollection,SubscriptionCollection:o.SubscriptionCollection,UnattributedMessageCollection:a.UnattributedMessageCollection};t.default=K},317239:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PLATFORMS=t.ConnImpl=t.Conn=void 0;var i=r(n(23279)),a=r(n(944908)),o=n(88555),s=n(781572),l=n(555452),c=n(978820),u=n(411290),d=r(n(914296)),p=n(833970),f=r(n(983938)),_=n(669594),h=r(n(11339)),g=n(546582);const m={ANDROID:"android",BB:"bb",BBX:"bbx",IPAD:"ipad",IPHONE:"iphone",IPOD:"ipod",S40:"s40",SMBA:"smba",SMBI:"smbi",SYMBIAN:"symbian",WP7:"wp7"};t.PLATFORMS=m;class y extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.prop)(),this.ref=(0,u.prop)(),this.refTTL=(0,u.prop)(),this.refId=(0,u.prop)(),this.wid=(0,u.prop)(),this.connected=(0,u.prop)(),this.protoVersion=(0,u.prop)(),this.clientToken=(0,u.prop)(),this.serverToken=(0,u.prop)(),this.secret=(0,u.prop)(),this.isResponse=(0,u.prop)(),this.battery=(0,u.prop)(),this.plugged=(0,u.prop)(),this.lc=(0,u.prop)(),this.lg=(0,u.prop)(),this.locales=(0,u.prop)(),this.is24h=(0,u.prop)(),this.platform=(0,u.prop)(),this.phone=(0,u.prop)(),this.tos=(0,u.prop)(),this.smbTos=(0,u.prop)(0),this.pushname=(0,u.prop)(),this.blockStoreAdds=(0,u.session)(!1),this.isVoipInitialized=(0,u.session)(!1),this.refExpiry=(0,u.derived)((function(){return Date.now()+this.refTTL}),["ref","refTTL"]),this.locale=(0,u.derived)((function(){return this.formatLocale(this.lg,this.lc)}),["lg","lc"]),this.localesList=(0,u.derived)((function(){return this.locales&&this.locales.length?this.locales.split(",").map((e=>{const[t,n]=e.split("-");return t?[t,n]:null})).filter(Boolean):this.lg?[[this.lg,this.lc]]:[]}),["locales","lg","lc"]),this.allLocales=(0,u.derived)((function(){return(0,a.default)(this.localesList.map((e=>{let[t,n]=e;return this.formatLocale(t,n)}))).filter(Boolean)}),["localesList"]),this.allLanguages=(0,u.derived)((function(){return(0,a.default)(this.localesList.map((e=>{let[t,n]=e;return t})))}),["localesList"]),this.platformField=(0,u.derived)((function(){return"wp7"===this.platform?h.default.PLATFORM_TYPE.WP:this.platform&&h.default.PLATFORM_TYPE[this.platform.toUpperCase()]||h.default.PLATFORM_TYPE.UNKNOWN}),["platform"]),this.tosShowCallNotification=(0,u.derived)((function(){return(0,o.isMDBackend)()||this.tos<2}),["tos"]),this.isSMB=(0,u.derived)((function(){return this.platform===m.SMBA||this.platform===m.SMBI}),["platform"])}initialize(){u.BaseModel.prototype.initialize.call(this),this.listenTo(this,"change:locale",(function(e,t){d.default.setLocale(t,p.L10N_PRIORITY.PHONE)})),this.listenTo(this,"change:plugged",(0,i.default)((()=>{h.default.Global.webcPhoneCharging=this.plugged}),5e3,{leading:!0})),this.listenTo(this,"change:phone",(()=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{mcc:t,mnc:n}=e;t&&"string"==typeof t&&(t=parseInt(t,10));n&&"string"==typeof n&&(n=parseInt(n,10));h.default.Global.set({mcc:null!=t?t:null,mnc:null!=n?n:null,webcPhoneDeviceManufacturer:e.device_manufacturer||null,webcPhoneDeviceModel:e.device_model||null,webcPhoneOsBuildNumber:e.os_build_number||null,webcPhoneOsVersion:e.os_version||null,webcPhoneAppVersion:e.wa_version||null})}(this.phone)})),this.listenTo(this,"change:platform",this._handlePlatformChange),this.listenTo(s.Cmd,"main_stream_mode_ready_legacy",this.updateVoipAvailability)}delete(){(0,l.setPushname)(),(0,l.setVersion)(),this.clear()}canSetMyPushname(){return!this.isSMB}updateVoipAvailability(){__LOG__(2)`Conn: updateVoipAvailability`,(0,g.requireVoip)().then((e=>{if(!(0,_.isVoiceCallEnabled)()&&!(0,_.isVideoCallEnabled)())return __LOG__(2)`Conn: updateVoipAvailability, Voip GK false`,e.cleanup(),void(this.isVoipInitialized=!1);this.id&&(0,c.getMaybeMeUser)()?(0,f.default)().then((t=>{t?(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip true`,e.init().then((t=>{__LOG__(2)`Conn: updateVoipAvailability, Voip initialized: ${t}`,this.isVoipInitialized=t,t&&e.updateAudioVideoSwitch()}))):(__LOG__(2)`Conn: updateVoipAvailability, isSystemCapableOfVoip false`,e.cleanup(),this.isVoipInitialized=!1)})):(__LOG__(2)`Conn: updateVoipAvailability, getMaybeMeUser undefined`,e.cleanup(),this.isVoipInitialized=!1)}))}_handlePlatformChange(){__LOG__(2)`Conn: platform change: ${this.platform}`,this.platform&&((0,l.setLastMobilePlatform)(this.platform),h.default.Global.set({webcPhonePlatform:this.platformField}))}formatLocale(e,t){return e?t?e.toLowerCase()+"-"+t.toUpperCase():e.toLowerCase():null}shouldSaveToCache(){return!!(0,c.getMe)()&&!!this.id}}t.ConnImpl=y,y.Proxy="conn";const S=new((0,u.defineModel)(y))({id:"1"});t.Conn=S},332161:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=new RegExp("[A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]");t.default=n},400121:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(611782)),a=n(708727),o=n(864795),s=n(408139),l=n(978820),c=r(n(389867)),u=n(562054),d=r(n(332161)),p=n(647969),f=n(500959),_=r(n(914296)),h=n(393170),g=n(132826),m=n(317239),y=n(411290),S=n(582039),E=n(46133),v=n(845222);const T=/^[^0-9]+$/;class C extends y.BaseModel{constructor(){super(...arguments),this.id=(0,y.prop)(),this.name=(0,y.prop)(),this.shortName=(0,y.prop)(),this.pushname=(0,y.prop)(),this.type=(0,y.prop)("in"),this.verifiedName=(0,y.prop)(),this.isBusiness=(0,y.prop)(),this.isEnterprise=(0,y.prop)(),this.verifiedLevel=(0,y.prop)(),this.privacyMode=(0,y.prop)(),this.statusMute=(0,y.prop)(),this.sectionHeader=(0,y.prop)(),this.labels=(0,y.prop)(),this.isContactSyncCompleted=(0,y.prop)(),this.forcedBusinessUpdateFromServer=(0,y.prop)(),this.disappearingModeDuration=(0,y.prop)(),this.disappearingModeSettingTimestamp=(0,y.prop)(),this.selfPnExposed=(0,y.session)(!1),this.isContactBlocked=(0,y.session)(!1),this.verificationString=(0,y.session)(),this.verificationBinary=(0,y.session)(),this.pendingAction=(0,y.session)(),this.promises=(0,y.session)((()=>({}))),this.status=(0,y.session)(),this.profilePicThumb=(0,y.session)(),this.businessProfile=(0,y.session)(),this.commonGroups=(0,y.session)(),this.liveLocations=(0,y.session)(),this.businessCatalog=(0,y.session)(),this.locale=(0,y.session)(),this.phoneJid=(0,y.session)(),this.displayNameLID=(0,y.session)(),this.notifyName=(0,y.derived)((function(){return this.isBusiness&&this.verifiedLevel!==h.VERIFIED_LEVEL.HIGH?this.verifiedName:this.pushname}),["pushname","isBusiness","verifiedLevel","verifiedName"]),this.mentionName=(0,y.derived)((function(){return!this.isMyContact&&this.isBusiness&&this.verifiedLevel!==h.VERIFIED_LEVEL.HIGH?null:this.name||this.notifyName}),["isMyContact","isBusiness","verifiedLevel","name","notifyName"]),this.displayName=(0,y.derived)((function(){return this.isMe&&m.Conn.pushname?m.Conn.pushname:null!=this.mentionName&&""!==this.mentionName?this.mentionName:this.formattedPhone}),["id","mentionName","isMe","formattedPhone"]),this.displayNameOrPnForLid=(0,y.derived)((function(){var e;return null!=this.phoneJid?(0,u.widToFormattedUser)(this.phoneJid):null!==(e=this.displayNameLID)&&void 0!==e?e:" "}),["phoneJid","displayNameLID"]),this.formattedPhone=(0,y.derived)((function(){return this.id.isLid()?this.displayNameOrPnForLid:(0,u.widToFormattedUser)(this.id)}),["displayNameOrPnForLid"]),this.userid=(0,y.derived)((function(){return this.isUser?c.default.user(this.id):null})),this.userhash=(0,y.derived)((function(){return this.isUser?(0,i.default)((this.id.user||"")+"WA_ADD_NOTIF"):null})),this.searchName=(0,y.derived)((function(){return c.default.isPSA(this.id)?_.default.accentFold(_.default.t(868)):c.default.isSupportAccount(this.id)?_.default.accentFold("WhatsApp Support"):this.name?_.default.accentFold(this.name):null}),["name","id","locale"]),this.searchVerifiedName=(0,y.derived)((function(){return this.verifiedLevel!==h.VERIFIED_LEVEL.HIGH?null:this.verifiedName?_.default.accentFold(this.verifiedName):null}),["verifiedLevel","verifiedName"]),this.header=(0,y.derived)((function(){if(this.name){const e=this.name.toLowerCase(),t=d.default.exec(e);if(t&&0===t.index||t&&T.test(e.slice(t.index))){const e=t[0],n=_.default.removeAccents(e);return(0,p.getCollator)().compare(n,e)?e:n}return"#"}}),["name"]),this.isMe=(0,y.derived)((function(){return this.id.equals((0,l.getMaybeMeUser)())})),this.isUser=(0,y.derived)((function(){return c.default.isUser(this.id)})),this.isGroup=(0,y.derived)((function(){return c.default.isGroup(this.id)})),this.isBroadcast=(0,y.derived)((function(){return c.default.isBroadcast(this.id)})),this.isPSA=(0,y.derived)((function(){return c.default.isPSA(this.id)})),this.isSupportAccount=(0,y.derived)((function(){return c.default.isSupportAccount(this.id)})),this.formattedShortNameWithNonBreakingSpaces=(0,y.derived)((function(){return this.id?this.isMe?_.default.t(859):this.shortName||this.formattedName&&this.formattedName.replace(/\s/g," "):""}),["shortName","formattedName","id","locale"]),this.formattedShortName=(0,y.derived)((function(){return this.id?this.isMe?_.default.t(859):this.shortName||this.formattedName:""}),["shortName","formattedName","id","locale"]),this.formattedName=(0,y.derived)((function(){return this.id?this.isMe?_.default.t(859):c.default.isPSA(this.id)?_.default.t(868):c.default.isSupportAccount(this.id)?"WhatsApp Support":this.name?this.name:this.verifiedLevel===h.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:this.isUser?this.formattedPhone:"":""}),["name","id","locale","verifiedLevel","verifiedName","formattedPhone"]),this.formattedUser=(0,y.derived)((function(){return this.getFormattedUser()}),["name","id","locale","verifiedLevel","verifiedName","formattedPhone"]),this.isWAContact=(0,y.derived)((function(){return this.isUser&&"in"===this.type}),["type"]),this.isMyContact=(0,y.derived)((function(){var e;return!(!this.isUser||!(null===(e=this.name)||void 0===e?void 0:e.length))}),["name"]),this.showBusinessCheckmarkAsPrimary=(0,y.derived)((function(){return this.isSupportAccount||this.isBusiness&&this.verifiedLevel===h.VERIFIED_LEVEL.HIGH&&(this.name===this.verifiedName||!this.name)}),["isBusiness","verifiedLevel","name","verifiedName"]),this.showBusinessCheckmarkAsSecondary=(0,y.derived)((function(){return this.isBusiness&&this.verifiedLevel===h.VERIFIED_LEVEL.HIGH&&Boolean(this.name)&&this.name!==this.verifiedName}),["isBusiness","verifiedLevel","name","verifiedName"]),this.shouldForceBusinessUpdate=(0,y.derived)((function(){return!this.forcedBusinessUpdateFromServer&&!this.isContactSyncCompleted}),["forcedBusinessUpdateFromServer","isContactSyncCompleted"])}initialize(){super.initialize(),this.id&&(this.isMe&&this.addChild("status",E.StatusCollection.gadd(this.id)),this.isMe&&this.addChild("profilePicThumb",S.ProfilePicThumbCollection.gadd(this.id)),(this.isBusiness||this.isMe&&m.Conn.isSMB)&&this.addChild("businessProfile",n(493581).BusinessProfileCollection.gadd(this.id)),this.listenTo(this,"change:isBusiness",(()=>(0,a.handleBusinessChange)(this))),this.isMe&&this.listenTo(m.Conn,"change:pushname",(()=>{this.set({pushname:m.Conn.pushname})})),this.listenTo(_.default,"locale_change",(()=>{this.locale=_.default.getLocale()})),this.listenTo(this,"change:name",this.updateShortName),this.isContactBlocked=!!g.BlocklistCollection.get(this.id),this.pendingAction=0,m.Conn.isSMB&&(0,o.initializeLabels)(this),(0,v.attachContactLidInfo)(this))}updateShortName(){if(this.isUser&&this.name&&!this.shortName){const e=(0,f.getShortName)(this.name);e&&this.set("shortName",e)}}getStatus(){return c.default.user(this.id)||__LOG__(2)`contact:getStatus for non-user ${this.id.toString()}`,this.status=E.StatusCollection.gadd(this.id)}getProfilePicThumb(){return this.profilePicThumb=S.ProfilePicThumbCollection.gadd(this.id)}addPendingAction(e){const t=()=>{this.decPending()};return e.then(t,t),this.pendingAction++,e}decPending(){this.pendingAction>0?this.pendingAction--:(__LOG__(2)`contact:onPendingActionUpdate pendingAction value is invalid`,this.pendingAction=0)}isBlocked(){return!!g.BlocklistCollection.get(this.id)}searchMatch(e,t,n){var r;return(0,s.canDisplayLabel)()&&n?!(e&&this.searchName&&!this.searchName.includes(e))&&Boolean(null===(r=this.labels)||void 0===r?void 0:r.includes(n)):!!e&&(!(!this.searchName||!this.searchName.includes(e))||(!(!this.userid||!this.userid.includes(e))||(!!(t&&this.userid&&this.userid.includes(t))||(!(!this.searchVerifiedName||!this.searchVerifiedName.includes(e))||!(!this.pushname||!_.default.accentFold(this.pushname).includes(e))))))}getFormattedUser(){return this.id?c.default.isPSA(this.id)?_.default.t(868):c.default.isSupportAccount(this.id)?"WhatsApp Support":this.name?this.name:this.verifiedLevel===h.VERIFIED_LEVEL.HIGH&&this.verifiedName?this.verifiedName:this.formattedPhone:""}set(e,t,n){const r=super.set(e,t,n);if("string"!=typeof e&&(null==t?void 0:t.merge)&&r){if(r.isPSA)return r;!e.name&&r.name&&(r.unset("name"),r.unset("shortName")),!e.verifiedName&&r.verifiedName&&r.unset("verifiedName")}return r}getCollection(){return n(719380).ContactCollection}setNotMyContact(){this.name&&this.set("name",void 0)}}C.Proxy="contact",C.idClass=c.default;var A=(0,y.defineModel)(C);t.default=A},719380:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ContactCollectionImpl=t.ContactCollection=void 0;var i=r(n(23279)),a=n(450796),o=n(492574),s=n(813042),l=r(n(312523)),c=n(988376),u=n(555452),d=r(n(400121)),p=n(647969),f=r(n(135029)),_=n(662583),h=n(545873),g=n(908071),m=r(n(914296)),y=n(801255),S=n(765044);class E extends y.BaseCollection{constructor(){super(),this._contactHashes=new f.default,this.checksum=void 0,this._frequentContacts={},this._sort=(0,i.default)((()=>super.sort()),1e3),this._silentSort=(0,i.default)((()=>super.sort({silent:!0})),1e3),this.listenTo(m.default,"locale_change",(()=>this.sort())),this.listenTo(this,"change:name",this.sort),this.listenTo(S.Socket,"change:stream",(()=>{S.Socket.stream===_.SOCKET_STREAM.RESUMING&&this.forEach((e=>{e.unset("verificationString"),e.unset("verificationBinary")}))})),this.listenTo(this,"add",this.contactAdded),this.listenTo(this,"remove",this.contactRemoved)}sort(e){return(null==e?void 0:e.silent)?this._silentSort():this._sort()}ensureSorted(){this._sort.flush()}initializeFromCache(e){e&&(__LOG__(2)`Store:Contact init from cache`,this.add(e,{silent:!0,merge:!0}))}contactAdded(e){this._contactHashes.put(e)}contactRemoved(e){this._contactHashes.remove(e)}contactHashLength(){return this._contactHashes.length}delete(){super.delete(),this.setChecksum(),delete this.checksum,this._frequentContacts={},(0,g.setFrequent)({}).catch((()=>{})),this._contactHashes.clear()}isFilteredContact(e){return!!e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}getFilteredContacts(){return this.filter((function(e){return e.name&&!e.isMe&&!e.isPSA&&e.isWAContact}))}getGroupContacts(){return this.filter((e=>e.isGroup))}_find(e){const t=this.get(e);return t?Promise.resolve(t):Promise.resolve({id:e})}_findQuery(e){return(0,c.contactFindQuery)(e)}sync(){return this.findQuery({}).catch((0,a.filteredCatch)(o.WebdDrop,(()=>{}))),(0,l.default)(this,s.COLLECTION_HAS_SYNCED)}updateFrequentContacts(e){this._frequentContacts=e}frequentContacts(e,t){let n=e&&this._frequentContacts[e];if(n||(n=this._frequentContacts.message),!n)return[];const r=null==t?void 0:t.id;return n.map((e=>this.get(e))).filter((e=>!!e&&!e.id.equals(r)))}getUserCount(){return this.map((e=>e.isUser?1:0)).reduce(((e,t)=>e+t),0)}setChecksum(e){this.checksum=e,(0,u.setContactChecksum)(this.checksum),(0,h.setChecksum)(e).catch((()=>{}))}resolveWidsFromHash(e){return this._contactHashes.get(e)}}t.ContactCollectionImpl=E,E.model=d.default,E.comparator=p.ContactComparator;const v=new E;t.ContactCollection=v},647969:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactComparator=void 0,t.getCollator=function(){return o};var r=n(781572),i=n(978820),a=n(833970);let o;s(),r.Cmd.on("set_collator",s);function s(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DEFAULT_LOCALE;if(null===(e=self.Intl)||void 0===e?void 0:e.Collator){const e=self.Intl.Collator([t],{sensitivity:"base"});o={compare(t,n){try{return e.compare(t,n)}catch(e){return 0}}}}else o={compare:(e,t)=>e.localeCompare(t)}}t.ContactComparator=(e,t)=>{const n=e.id.toString(),r=t.id.toString(),a=(0,i.getMaybeMeUser)(),s=a&&a.toString();if(n===s)return 1;if(r===s)return-1;const l=e.name,c=t.name;if(!l&&c)return 1;if(l&&!c)return-1;if(l&&c&&e.header&&t.header){const n=o.compare(e.header,t.header);return 0===n?o.compare(l,c):n}return n&&r?n.localeCompare(r):-1}},500959:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getShortName=function(e){if(null==e)return null;const[t]=e.split(/\s/);if(i.default.exec(t))return t;return __LOG__(2)`[short-name] unable to get short name for contact: ${e}`,null};var i=r(n(332161))},135029:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(82729)),a=r(n(145095)),o=r(n(389867));class s{constructor(){this._map={},this.length=0}static getSidelistHash(e){return e.isUser?"string"==typeof e.userhash&&e.userhash.slice?e.userhash.slice(0,4):(__LOG__(3)`Store:Contact can't call slice on contact.userhash`,null):null}put(e){const t=s.getSidelistHash(e);if(t&&!this._map[t]){if(this._map[t]){const n=this._map[t];n instanceof o.default?this._map[t]=[n,e.id]:n instanceof Array&&n.push(e.id)}else this._map[t]=e.id;this.length++}}remove(e){const t=s.getSidelistHash(e);if(!t||!this._map[t])return;const n=(0,a.default)(this._map[t],"this._map[hash]");n instanceof o.default?delete this._map[t]:n instanceof Array&&(0,i.default)(n,(t=>t.equals(e.id))),this.length++}get(e){const t=this._map[e];return t instanceof o.default?[t]:t}clear(){this._map={},this.length=0}}t.default=s},118787:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ConversionTupleExpiry=t.ConversionTuple=void 0;var i=n(108584),a=r(n(485074)),o=n(40234),s=r(n(389867)),l=n(411290);const c=604800;t.ConversionTupleExpiry=c;class u extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.conversionData=(0,l.prop)(),this.conversionSource=(0,l.prop)(),this.timestamp=(0,l.prop)((()=>o.Clock.globalUnixTime())),this.alarmId=(0,l.session)()}initialize(){super.initialize(),this.listenTo(this,"change:timestamp",this._setExpiryTimer),this._setExpiryTimer()}_setExpiryTimer(){const e=this.timestamp+c;if(e<0)return __LOG__(3)`Invalid conversionTuple timer`,void this.delete();this.alarmId=a.default.setLocalTimeout((()=>{this.delete()}),1e3*e,this.alarmId)}_clearAlarm(){this.alarmId&&(a.default.clearTimeout(this.alarmId),this.alarmId=void 0)}elapsedSeconds(){return o.Clock.globalUnixTime()-this.timestamp}formatTuple(){const e={conversionDelaySeconds:this.elapsedSeconds()};return this.conversionData&&(e.conversionData=this.conversionData),this.conversionSource&&(e.conversionSource=this.conversionSource),e}toJSON(){const e=this.serialize(),t=e.conversionData;if(t instanceof ArrayBuffer){const n=new i.Binary(t);e.conversionData=n.readString(t.byteLength)}return e}delete(){super.delete(),this.getCollection().remove(this.id),this._clearAlarm()}getCollection(){return n(835667).default}}u.Proxy="conversionTuple",u.idClass=s.default;const d=(0,l.defineModel)(u);t.ConversionTuple=d},835667:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(40234),i=n(118787),a=n(801255),o=n(714648),s=n(114259);class l extends a.BaseCollection{initializeFromCache(e){if(!e)return;const t=r.Clock.globalUnixTime()-i.ConversionTupleExpiry,n=e.filter((e=>e.timestamp-t>0)).map((e=>{const t=(0,s.parseConversionData)(e.conversionData);return t?e.conversionData=t:delete e.conversionData,e}));this.add(n),this.saveToCache()}}l.model=i.ConversionTuple,l.cachePolicy={id:"conversion_tuple",policy:o.CACHE_POLICY.LOAD,delay:1e3};var c=new l;t.default=c},221547:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrinaDailyActionType=t.DailyAggregatedStats=void 0;var r=n(411290);const i=n(76672)({NARRATIVE_APPEAR:1,DIALOG_APPEAR:2,DIALOG_SELECT:3});t.PrinaDailyActionType=i;const a=864e5;class o extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.startTime=(0,r.prop)(),this.pttCancelBroadcast=(0,r.prop)(0),this.pttCancelGroup=(0,r.prop)(0),this.pttCancelIndividual=(0,r.prop)(0),this.pttDraftReviewBroadcast=(0,r.prop)(0),this.pttDraftReviewGroup=(0,r.prop)(0),this.pttDraftReviewIndividual=(0,r.prop)(0),this.pttFastplaybackBroadcast=(0,r.prop)(0),this.pttFastplaybackGroup=(0,r.prop)(0),this.pttFastplaybackIndividual=(0,r.prop)(0),this.pttLockBroadcast=(0,r.prop)(0),this.pttLockGroup=(0,r.prop)(0),this.pttLockIndividual=(0,r.prop)(0),this.pttPlaybackBroadcast=(0,r.prop)(0),this.pttPlaybackGroup=(0,r.prop)(0),this.pttPlaybackIndividual=(0,r.prop)(0),this.pttRecordBroadcast=(0,r.prop)(0),this.pttRecordGroup=(0,r.prop)(0),this.pttRecordIndividual=(0,r.prop)(0),this.pttSendBroadcast=(0,r.prop)(0),this.pttSendGroup=(0,r.prop)(0),this.pttSendIndividual=(0,r.prop)(0),this.pttPausedRecordBroadcast=(0,r.prop)(0),this.pttPausedRecordGroup=(0,r.prop)(0),this.pttPausedRecordIndividual=(0,r.prop)(0),this.pttStopTapBroadcast=(0,r.prop)(0),this.pttStopTapGroup=(0,r.prop)(0),this.pttStopTapIndividual=(0,r.prop)(0),this.pttOutOfChatBroadcast=(0,r.prop)(0),this.pttOutOfChatGroup=(0,r.prop)(0),this.pttOutOfChatIndividual=(0,r.prop)(0),this.goldenBoxContactNarrativeAppearCount=(0,r.prop)(0),this.goldenBoxContactDialogAppearCount=(0,r.prop)(0),this.goldenBoxContactDialogSelectCount=(0,r.prop)(0),this.goldenBoxGroupNarrativeAppearCount=(0,r.prop)(0),this.goldenBoxGroupDialogAppearCount=(0,r.prop)(0),this.goldenBoxGroupDialogSelectCount=(0,r.prop)(0),this.infoScreenContactNarrativeAppearCount=(0,r.prop)(0),this.infoScreenContactDialogAppearCount=(0,r.prop)(0),this.infoScreenContactDialogSelectCount=(0,r.prop)(0),this.infoScreenGroupNarrativeAppearCount=(0,r.prop)(0),this.infoScreenGroupDialogAppearCount=(0,r.prop)(0),this.infoScreenGroupDialogSelectCount=(0,r.prop)(0),this.chatsListNarrativeAppearCount=(0,r.prop)(0),this.chatsListDialogAppearCount=(0,r.prop)(0),this.chatsListDialogSelectCount=(0,r.prop)(0),this.statusListNarrativeAppearCount=(0,r.prop)(0),this.statusListDialogAppearCount=(0,r.prop)(0),this.statusListDialogSelectCount=(0,r.prop)(0),this.callingScreenAudioNarrativeAppearCount=(0,r.prop)(0),this.callingScreenAudioDialogAppearCount=(0,r.prop)(0),this.callingScreenAudioDialogSelectCount=(0,r.prop)(0),this.prinaLastEvent=(0,r.prop)(0),this.communityTabGroupNavigations=(0,r.prop)(0),this.communityTabToHomeViews=(0,r.prop)(0),this.communityTabViews=(0,r.prop)(0),this.communityNoActionTabViews=(0,r.prop)(0),this.communityHome=(0,r.prop)((()=>({}))),this.groupMessageNotificationTaps=(0,r.prop)(0),this.groupMessageNotifications=(0,r.prop)(0),this.kicGroupNotificationTaps=(0,r.prop)(0),this.kicGroupNotifications=(0,r.prop)(0),this.kicNotificationTaps=(0,r.prop)(0),this.kicNotifications=(0,r.prop)(0),this.totalNotificationTaps=(0,r.prop)(0),this.totalNotifications=(0,r.prop)(0),this.userMessageNotifications=(0,r.prop)(0),this.userMessageNotificationTaps=(0,r.prop)(0)}initialize(){super.initialize()}getEndTime(){return this.startTime+a}shouldBeSubmitted(){return!this.isExpired()&&this.getEndTime()<Date.now()}isExpired(){const e=Date.now()-18144e5;return this.startTime<e}}o.Proxy="daily-aggregated-stats";const s=(0,r.defineModel)(o);t.DailyAggregatedStats=s},966423:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DailyAggregatedStatsCollectionImpl=t.DailyAggregatedStatsCollection=void 0;var i=r(n(145095)),a=n(555452),o=n(221547),s=n(801255),l=n(714648);const c=864e5;class u extends s.BaseCollection{gaddForDate(e){var t;const n=(0,a.getDailyStatsStartTime)(),r=e.getTime()-n,o=Math.floor(r/c),s=n+c*o;return null!==(t=this.get(s))&&void 0!==t?t:(0,i.default)(this.add({id:s.toString(),startTime:s})[0],"this.add({\n  id: startTime.toString(),\n  startTime\n})[0]")}gaddForToday(){return this.gaddForDate(new Date)}initializeFromCache(e){if(null==e)return;const t=e.map((e=>new o.DailyAggregatedStats(e))).filter((e=>p(e)&&!e.isExpired()));this.add(t)}serialize(){return this.toArray().filter((e=>p(e)&&!e.isExpired())).map((e=>e.toJSON()))}}t.DailyAggregatedStatsCollectionImpl=u,u.model=o.DailyAggregatedStats,u.cachePolicy={id:"daily_aggregated_stats",policy:l.CACHE_POLICY.LOAD,delay:1e3};const d=new u;function p(e){return(e.startTime-(0,a.getDailyStatsStartTime)())%c==0}t.DailyAggregatedStatsCollection=d},748805:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationDailyCountKind=void 0,t.incrementNotificationDailyCount=function(e,t){const n=r.DailyAggregatedStatsCollection.gaddForToday();switch(t){case"chat":if(e===i.NOTIFICATION)n.totalNotifications++,n.userMessageNotifications++;else if(e===i.NOTIFICATION_TAP)n.totalNotificationTaps++,n.userMessageNotificationTaps++;else if(e===i.KIC_NOTIFICATION)n.kicNotifications++,n.totalNotifications++,n.userMessageNotifications++;else{if(e!==i.KIC_NOTIFICATION_TAP)throw new Error(`Invalid count kind ${e}`);n.kicNotificationTaps++}break;case"group":if(e===i.NOTIFICATION)n.totalNotifications++,n.groupMessageNotifications++;else if(e===i.NOTIFICATION_TAP)n.totalNotificationTaps++,n.groupMessageNotificationTaps++;else if(e===i.KIC_NOTIFICATION)n.kicNotifications++,n.kicGroupNotifications++,n.totalNotifications++,n.groupMessageNotifications++;else{if(e!==i.KIC_NOTIFICATION_TAP)throw new Error(`Invalid count kind ${e}`);n.kicNotificationTaps++,n.kicGroupNotificationTaps++}break;case"broadcast":case"community":e===i.NOTIFICATION?n.totalNotifications++:e===i.NOTIFICATION_TAP&&n.totalNotificationTaps++;break;default:throw new Error(`Invalid chat kind ${t}`)}};var r=n(966423);const i=n(76672).Mirrored(["NOTIFICATION","NOTIFICATION_TAP","KIC_NOTIFICATION","KIC_NOTIFICATION_TAP"]);t.NotificationDailyCountKind=i},120472:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.variant=(0,r.prop)()}}i.Proxy="emojiVariant";var a=(0,r.defineModel)(i);t.default=a},513185:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiVariantCollectionImpl=t.EmojiVariantCollection=void 0;var i=n(546718),a=r(n(120472)),o=n(767247),s=n(801255),l=n(714648);class c extends s.BaseCollection{setVariant(e,t){const n=o.EmojiUtil.getSkinToneBase(e);if(!n)throw new Error("attempt to store variantless emoji");this.gadd({id:n,variant:t})}getVariant(e){if(o.EmojiUtil.getSkinToneBase(e)){const t=this.get(e);return t?o.EmojiUtil.normalizeEmoji(t.variant):null}throw new Error("attempt to get variantless emoji")}getVariantIfExists(e){if(o.EmojiUtil.getSkinToneBase(e)){const t=this.get(e);return t?o.EmojiUtil.normalizeEmoji(t.variant):null}return null}}t.EmojiVariantCollectionImpl=c,c.model=a.default,c.cachePolicy={id:i.KEYS.EMOJI_VARIANT_COLLECTION,policy:l.CACHE_POLICY.LOAD,delay:1e3};const u=new c;t.EmojiVariantCollection=u},93894:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.weight=(0,r.prop)()}}i.Proxy="recentEmoji";var a=(0,r.defineModel)(i);t.default=a},492671:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiCollectionImpl=t.RecentEmojiCollection=void 0;var i=r(n(823493)),a=r(n(23279)),o=n(450796),s=n(492574),l=n(88555),c=n(438184),u=n(546718),d=r(n(93894)),p=r(n(656891)),f=n(767247),_=n(801255),h=n(714648);class g extends _.BaseCollection{constructor(){super(),this.dirty=!1,this._throttledSync=(0,i.default)((function(e){e.sync()}),36,{leading:!1}),this.listenTo(this,"change:weight change:length",(0,a.default)(this._sortTrimScale,100))}_sortTrimScale(){const e=this.length;e&&(this.sort(),e>36&&this.remove(this.slice(36)))}delete(){super.delete(),this.dirty=!1,this._throttledSync.cancel()}sync(){return this.findQuery({},{set:!0}).finally((()=>{this.dirty=!1})).catch((0,o.filteredCatch)(s.WebdDrop,(()=>{})))}_findQuery(){return c.LegacyPhoneFeatures.supportsFeature(c.LegacyPhoneFeatures.F.RECENT_EMOJI_SYNC)&&(0,l.isLegacyWebdBackend)()?p.default.recentEmojiQuery(this.dirty?this.toArray():void 0).then((function(e){if(Array.isArray(e))return e.forEach((function(e){e.id=f.EmojiUtil.normalizeAllEmojis(e.id)})),e;throw __LOG__(3)`models:recentEmoji:findQuery error`,new Error("recent emoji fetch error")})):Promise.reject(new _.CollectionSilentQueryError("gk recent emoji sync unsupported"))}throttledSync(){c.LegacyPhoneFeatures.supportsFeature(c.LegacyPhoneFeatures.F.RECENT_EMOJI_SYNC)&&(__LOG__(2)`models:RecentEmoji:throttledSync dirty: ${String(this.dirty)}`,this._throttledSync(this))}increment(e){const t=f.EmojiUtil.getSkinToneBase(e)||e;this.get(t)||this.add({id:t,weight:0}),this.forEach((e=>{e.id===t?e.weight+=1:e.weight*=.9})),this.dirty=!0,this.throttledSync()}}t.RecentEmojiCollectionImpl=g,g.cachePolicy={id:u.KEYS.RECENT_EMOJI_COLLECTION,policy:h.CACHE_POLICY.LOAD,delay:2e3},g.comparator=(e,t)=>e.weight>t.weight?-1:1,g.model=d.default;const m=new g;t.RecentEmojiCollection=m},614423:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(450796),o=n(657319),s=n(257243),l=n(227101),c=n(492574),u=n(88555),d=n(190013),p=n(408139),f=n(312889),_=n(978820),h=r(n(389867)),g=n(79196),m=n(455981),y=r(n(296091)),S=r(n(179677)),E=r(n(848911)),v=r(n(511824)),T=r(n(656891)),C=(r(n(11339)),n(669951)),A=n(719380),b=n(411290),P=n(562415),O=n(548360);class M extends b.BaseModel{constructor(){super(...arguments),this.participants=(0,b.collection)(y.default),this.pendingParticipants=(0,b.collection)(E.default),this.pastParticipants=(0,b.collection)(S.default),this.id=(0,b.prop)(),this.creation=(0,b.prop)(),this.owner=(0,b.prop)(),this.desc=(0,b.prop)(),this.descId=(0,b.prop)(),this.descTime=(0,b.prop)(),this.descOwner=(0,b.prop)(),this.restrict=(0,b.prop)(),this.announce=(0,b.prop)(),this.noFrequentlyForwarded=(0,b.prop)(),this.ephemeralDuration=(0,b.prop)(),this.membershipApprovalMode=(0,b.prop)(),this.growthLockExpiration=(0,b.prop)(),this.growthLockType=(0,b.prop)(),this.size=(0,b.prop)(),this.numSubgroups=(0,b.prop)(),this.support=(0,b.prop)(),this.suspended=(0,b.prop)(!1),this.terminated=(0,b.prop)(!1),this.uniqueShortNameMap=(0,b.prop)(),this.isParentGroup=(0,b.prop)(),this.parentGroup=(0,b.prop)(),this.defaultSubgroup=(0,b.prop)(),this.unjoinedSubgroups=(0,b.session)((()=>[])),this.joinedSubgroups=(0,b.session)((()=>[])),this.acknowledgedCadminPromotion=(0,b.prop)(!1),this.lastActivityTimestamp=(0,b.prop)(),this.lastSeenActivityTimestamp=(0,b.prop)(),this.stale=(0,b.session)(!0),this.deviceStale=(0,b.session)(!1),this.trusted=(0,b.session)(!0),this.inviteCode=(0,b.session)(),this.groupInviteCodePromise=(0,b.session)(),this.revokeGroupInvitePromise=(0,b.session)(),this.participantQueryPromise=(0,b.session)(),this.deviceQueryPromise=(0,b.session)(),this.displayedDesc=(0,b.session)(""),this.revokeGroupV4AddInvitePromise=(0,b.session)(),this.groupInviteLink=(0,b.derived)((function(){return this.inviteCode?`https://chat.whatsapp.com/${this.inviteCode}`:null}),["inviteCode"]),this.cachedDeviceCount=(0,b.session)(),this.cachedDeviceSizeBucket=(0,b.session)(),this.groupType=(0,b.derived)((function(){return!0===this.defaultSubgroup?m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP:null!=this.parentGroup?m.GroupType.SUBGROUP:!0===this.isParentGroup?m.GroupType.COMMUNITY:m.GroupType.DEFAULT}),["parentGroup","isParentGroup","defaultSubgroup"])}hasUniqueShortNameMention(e){var t;if(!this.uniqueShortNameMap||!e.shortName||!e.isMyContact)return!1;const n=this._normalizeShortName(e.shortName);return null!==(t=this.uniqueShortNameMap.get(n))&&void 0!==t&&t}_normalizeShortName(e){return e.toLowerCase().trim()}isSuspendedOrTerminated(){return(this.suspended||this.terminated)&&(0,s.getABPropConfigValue)("group_suspend_v1_enabled")}delete(){super.delete(),this.getCollection().remove(this.id),this.participants.delete()}canSetSubject(){return(!(0,p.communitiesEnabled)()||this.groupType!==m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&this.groupType!==m.GroupType.COMMUNITY)&&(!this.isSuspendedOrTerminated()&&(!!this.participants.iAmMember()&&((this.participants.iAmAdmin()||!0!==this.restrict)&&!this.support)))}canSetDescription(){return!(!this.participants.iAmMember()||!this.participants.iAmAdmin()&&this.restrict)&&(!this.isSuspendedOrTerminated()&&(!((0,p.communitiesEnabled)()&&(this.groupType===m.GroupType.COMMUNITY||this.groupType===m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)&&!this.participants.iAmAdmin())&&!this.support))}canSetGroupProperty(){return!this.isSuspendedOrTerminated()&&((!(0,p.communitiesEnabled)()||this.groupType!==m.GroupType.COMMUNITY&&this.groupType!==m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP)&&(!!this.participants.iAmAdmin()&&!this.support))}canSetEphemeralSetting(){const e=!this.support;return!this.isSuspendedOrTerminated()&&(!!this.participants.iAmMember()&&(this.participants.iAmAdmin()?e:!this.restrict&&(!(!(0,u.isMDBackend)()||!(0,s.getABPropConfigValue)("ephemeral_allow_group_members"))&&(this.groupType!==m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP&&e))))}initialize(){b.BaseModel.prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:isSuperAdmin change:contact.isMyContact sort remove reset",(()=>{this.isTrusted(),this._updateDisplayedDesc()})),this.listenTo(this.participants,"add remove reset",this.triggerParticipantsChange),this.listenTo(this,"change:owner",this.isTrusted),this.listenTo(this,"change:isParentGroup",this._updateSubgroups),this.listenTo(this,"change:desc",this._updateDisplayedDesc),this.listenTo(this,"change:groupType",this._updateDisplayedDesc),this._updateDisplayedDesc(),this.isTrusted(),this._updateUniqueShortNameMapTimer=this._createUniqueNameMapShiftTimer(),this.listenTo(this.participants,"change:contact.shortName",this._handleParticipantShortNameUpdated),this.uniqueShortNameMap=new Map,this.unreadMentionMetadata=new v.default,this.groupType===m.GroupType.COMMUNITY&&this._updateSubgroups()}_handleParticipantShortNameUpdated(){var e;null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(M.UPDATE_NAME_MAP_DEBOUNCE_TIME)}triggerParticipantsChange(){var e;(0,l.isDropLastNameEnabled)()&&(null===(e=this._updateUniqueShortNameMapTimer)||void 0===e||e.debounce(M.UPDATE_NAME_MAP_DEBOUNCE_TIME));this.trigger("change:participants")}_createUniqueNameMapShiftTimer(){return new o.ShiftTimer((()=>{if((0,l.isDropLastNameEnabled)()){const e=new Map;this.participants&&this.participants.forEach((t=>{if(t.contact.shortName&&t.contact.isMyContact){const n=this._normalizeShortName(t.contact.shortName);e.has(n)?e.set(n,!1):e.set(n,!0)}})),this.uniqueShortNameMap=e}}))}_isGroupAdminInAddressBook(){return this.participants.some((e=>e.isAdmin&&e.contact.isMyContact))}isTrusted(){if(this.stale)return this.trusted;if(this.support)return this.trusted=!0;if(this.owner){if((0,_.isMeAccount)(this.owner))return this.trusted=!0;const e=A.ContactCollection.get(this.owner);if(null==e?void 0:e.isMyContact)return this.trusted=!0}return this._isGroupAdminInAddressBook()?this.trusted=!0:this.trusted=!1}hasJoined(){const{id:e,groupType:t,joinedSubgroups:n}=this;if(t===m.GroupType.COMMUNITY)return n.length>0;const r=C.ChatCollection.get(e);return null!=r&&!r.isReadOnly}_updateDisplayedDesc(){!(0,p.communitiesEnabled)()||this.groupType!==m.GroupType.DEFAULT_ANNOUNCEMENT_GROUP||this.canSetDescription()||null!=this.desc&&""!==this.desc?this.displayedDesc=this.desc:this.displayedDesc=O.fbt._("",null,{hk:"4kc4Kr"}).toString()}_updateSubgroups(){(0,f.updateJoinedSubgroups)(this),(0,f.updateUnjoinedSubgroups)(this)}revokeGroupV4AddInvite(e){if(this.revokeGroupV4AddInvitePromise)return this.revokeGroupV4AddInvitePromise;const t=(0,g.widToGroupJid)(this.id),{pendingParticipants:n}=this;let r=Promise.resolve();return r=(0,d.revokeGroupInviteV4)(e,t),this.revokeGroupV4AddInvitePromise=r.then((t=>(t.status>=200&&t.status<300&&n.remove(e),t.status))).catch((()=>(__LOG__(3)`models:groupMetadata:participantCollection:revokeGroupV4AddInvite failed`,500))).finally((()=>{this.revokeGroupV4AddInvitePromise=null}))}queryGroupV4PendingInvite(){var e=this;return(0,i.default)((function*(){if((0,u.isMDBackend)())return void(yield(0,P.updatePendingParticipants)(e.id));const t=(0,_.getMaybeMeUser)().toString(),n=e.id.toString();return T.default.findGroupPendingInvitesFromPhone(t,n).then((t=>{e.collection&&e.collection.add({id:e.id,pendingParticipants:t.participants},{merge:!0})})).catch((0,a.filteredCatch)(c.WebdDrop,(()=>{})))}))()}getJoinedSubgroupsMetadata(){const e=this.getCollection();return this.joinedSubgroups.map((t=>e.get(t.toString()))).filter(Boolean)}getUnjoinedSubgroupsMetadata(){const e=this.getUnjoinedCollection();return this.unjoinedSubgroups.map((t=>e.get(t.toString()))).filter(Boolean)}getSubgroupsMetadata(){return[...this.getJoinedSubgroupsMetadata(),...this.getUnjoinedSubgroupsMetadata()]}getParentGroupChat(){const e=this.parentGroup;if(e)return C.ChatCollection.get(e)}isParentGroupParticipant(){const e=this.parentGroup;if(!e)return!1;const t=this.getCollection().get(e);return!!(null==t?void 0:t.joinedSubgroups.length)}getUnjoinedCollection(){return n(873213).default}getCollection(){return n(963928).default}}M.Proxy="groupMetadata",M.idClass=h.default,M.UPDATE_NAME_MAP_DEBOUNCE_TIME=200;var I=(0,b.defineModel)(M);t.default=I},963928:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(393386)),o=n(450796),s=n(492574),l=n(88555),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),u=n(93949),d=n(312889),p=r(n(389867)),f=n(745454),_=r(n(614423)),h=r(n(656891)),g=n(35270),m=n(669951),y=n(801255);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}class E extends y.BaseCollection{constructor(){super(),this.listenTo(this,"add",this.onGroupAdd),this.listenTo(this,"remove",this.onGroupRemove),this.listenTo(this,"change:parentGroup",this.onParentGroupChange)}onGroupAdd(e){if(!e.participants.iAmMember())return;const t=e.parentGroup?this.get(e.parentGroup.toString()):null;if(null!=t){const n=e.id;(0,d.subgroupUnjoinedToJoined)(t,n)}}onGroupRemove(e){if(!e.participants.iAmMember())return;const t=e.parentGroup?this.get(e.parentGroup.toString()):null;null!=t&&(0,d.updateJoinedSubgroups)(t)}onParentGroupChange(e,t,n){if(!e.participants.iAmMember())return;const r=e.id,i=null!=t?this.get(t.toString()):null,a=null!=n?this.get(n.toString()):null;null!=i?((0,d.subgroupUnjoinedToJoined)(i,r),null!=a&&(0,d.updateJoinedSubgroups)(a)):null!=a&&(0,d.unlinkParentGroup)(a,r)}onResume(){(0,a.default)(m.ChatCollection.where({active:!0}).filter((e=>e.isGroup||e.isBroadcast)),m.ChatCollection.where({isBroadcast:!0})).forEach((e=>{this.find(e.id).catch((0,o.filteredCatch)([s.WebdDrop,c.ProtoVersionUndefined],(()=>{})))}))}_find(e){var t=this;return(0,i.default)((function*(){if(p.default.isGroup(e)){const t=n(669951).ChatCollection.get(e);return(null==t?void 0:t.isReadOnly)?(0,l.isMDBackend)()?(__LOG__(3)`queryGroupFromPhone: not implemented for MD`,Promise.resolve({id:e})):(0,u.queryGroupFromPhone)(e):(0,g.findGroupMetadata)(e)}if(p.default.isBroadcast(e)){if((0,l.isMDBackend)())return __LOG__(3)`contactFindBroadcast: not implemented for MD`,Promise.resolve({id:e});const n=yield h.default.contactFindBroadcast(e);if(200===n.status){const r=t.get(e);return r&&!r.stale?r:{id:e,participants:n.recipients}}if(404===n.status)return __LOG__(3)`models:GroupMetadataCollection:_find:False broadcast list query`,{id:e};throw __LOG__(3)`models:GroupMetadataCollection:_find:bclist error: ${n.status}`,new Error("models:GroupMetadataCollection:_find:bclist error: "+n.status)}return __LOG__(2)`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`,Promise.reject(new Error(`groupMetadata:find trying to fetch non-group/bclist wid ${e.toString()}`))}))()}_handle(e){return e}handlePendingInvite(e){const{gid:t,participants:n}=e;this.add({id:(0,f.createWid)(t),pendingParticipants:n},{merge:!0})}}E.model=_.default,E.staleCollection=!0;var v=new E;t.default=v},945152:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=(0,n(667294).createContext)(null);t.default=r},455981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupType=void 0;const r=n(76672).Mirrored(["DEFAULT","COMMUNITY","SUBGROUP","DEFAULT_ANNOUNCEMENT_GROUP"]);t.GroupType=r},245077:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(389867)),a=n(719380),o=n(411290);class s extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.isAdmin=(0,o.prop)(),this.isSuperAdmin=(0,o.prop)(),this.leaveTs=(0,o.prop)(),this.leaveReason=(0,o.prop)(),this.contact=(0,o.session)()}initialize(){super.initialize(),this.addChild("contact",a.ContactCollection.gadd(this.id))}}s.Proxy="participant",s.idClass=i.default;var l=(0,o.defineModel)(s);t.default=l},296091:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=n(88555),o=n(833601),s=n(408139),l=n(312889),c=n(978820),u=n(455981),d=r(n(245077)),p=r(n(826812)),f=r(n(914296)),_=n(669951),h=n(719380),g=r(n(631727));class m extends g.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._updateSubgroup=e=>{var t,n,r;const i=(0,c.getMaybeMeUser)();if(!i||!i.equals(e.id))return;const a=this.parent.id,o=a?null===(t=_.ChatCollection.get(a.toString()))||void 0===t||null===(n=t.groupMetadata)||void 0===n?void 0:n.parentGroup:null,s=o?null===(r=_.ChatCollection.get(o.toString()))||void 0===r?void 0:r.groupMetadata:null;null!=s&&(this.iAmMember()?(0,l.subgroupUnjoinedToJoined)(s,a):(0,l.subgroupJoinedToUnjoined)(s,a))},this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.sendForNeededAddRequest=e=>{var t,n;const r=this.getChat(),i=null!==(t=null===(n=r.groupMetadata)||void 0===n?void 0:n.desc)&&void 0!==t?t:"";(0,o.sendForNeededAddRequest)(e,r.formattedTitle||r.name,i,this.parent.id)},this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(f.default,"locale_change",this._debouncedSort),this.listenTo(this,"add remove",this._updateSubgroup)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e,t){const n=t||{};return n.isParticipantCollectionAdd||(n.remove=!0),super.set(e,n)}add(e,t){const n=t||{};return n.isParticipantCollectionAdd=!0,super.add(e,n)}canAdd(){return!!this.iAmAdmin()}canPromote(e,t){var n;if(!e)return!1;if((0,c.getMaybeMeUser)().equals(e.id))return!1;if(!this.iAmAdmin())return!1;if(e.isAdmin)return!1;return(null===(n=this.getChat().groupMetadata)||void 0===n?void 0:n.groupType)!==u.GroupType.DEFAULT_ANNOUNCEMENT_GROUP||!0===t}canDemote(e){var t;if(!e)return!1;if(!this.iAmAdmin())return!1;const n=this.getChat();if((!(0,s.communitiesEnabled)()||(null===(t=n.groupMetadata)||void 0===t?void 0:t.groupType)!==u.GroupType.COMMUNITY)&&(0,c.getMaybeMeUser)().equals(e.id))return!1;var r;return e.isSuperAdmin?!(!(0,s.communitiesEnabled)()||(null===(r=n.groupMetadata)||void 0===r?void 0:r.groupType)!==u.GroupType.COMMUNITY)&&(0,c.getMaybeMeUser)().equals(e.id):!!e.isAdmin}canRemove(e){var t;return!!e&&(!(0,c.getMaybeMeUser)().equals(e.id)&&(!!this.iAmAdmin()&&((null===(t=this.getChat().groupMetadata)||void 0===t?void 0:t.groupType)!==u.GroupType.DEFAULT_ANNOUNCEMENT_GROUP||!e.isAdmin&&!e.isSuperAdmin)))}canVerifyIdentity(e){return!(0,a.isLegacyWebdBackend)()&&(!!e&&!(0,c.getMaybeMeUser)().equals(e.id))}iAmMember(){return 1===this.filter((e=>e.id.equals((0,c.getMaybeMeUser)()))).length}iAmRestrictedMember(){var e;return!0===(null===(e=this.getChat().groupMetadata)||void 0===e?void 0:e.restrict)&&!this.iAmAdmin()}iAmAdmin(){return 1===this.filter((e=>e.id.equals((0,c.getMaybeMeUser)())&&e.isAdmin)).length}iAmSuperAdmin(){return 1===this.filter((e=>e.id.equals((0,c.getMaybeMeUser)())&&e.isSuperAdmin)).length}getAdmins(){return this.where({isAdmin:!0})}getSuperAdmin(){return this.findFirst((e=>e.isSuperAdmin))}getMyContacts(){return this.filter((e=>{var t;return!!(null===(t=h.ContactCollection.get(e.id))||void 0===t?void 0:t.isMyContact)}))}getMeParticipant(){return this.findFirst((e=>e.id.equals((0,c.getMaybeMeUser)())))}getChat(){const e=this.parent.id;return _.ChatCollection.assertGet(e)}}t.default=m,m.model=d.default,m.comparator=p.default},826812:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(647969);var i=(e,t)=>(0,r.ContactComparator)(e.contact,t.contact);t.default=i},179677:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(892844),a=n(312380),o=r(n(245077)),s=r(n(631727));class l extends s.default{getValidRecords(){return this.filter((e=>{const t=(0,i.castToUnixTime)(e.leaveTs);return(0,i.happenedWithin)(t,i.DAY_SECONDS*a.PAST_PARTICIPANT_EXPIRATION_DAYS)}))}}t.default=l,l.model=o.default,l.comparator=(e,t)=>t.leaveTs-e.leaveTs},848911:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=r(n(245077)),o=r(n(826812)),s=r(n(914296)),l=r(n(631727));class c extends l.default{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this._debouncedSort=(0,i.default)((()=>this.sort()),1e3),this.listenTo(this,"change:contact.name",this._debouncedSort),this.listenTo(s.default,"locale_change",this._debouncedSort)}delete(){this.forEach((function(e){e.delete()})),this.stopListening(),this.reset()}ensureSorted(){this._debouncedSort.flush()}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd||(t.remove=!0),super.set(e,t)}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.isParticipantCollectionAdd=!0,super.add(e,t)}}t.default=c,c.model=a.default,c.comparator=o.default},733689:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(389867)),a=n(455981),o=r(n(296091)),s=n(411290),l=n(548360);class c extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.subject=(0,s.prop)(),this.subjectTime=(0,s.prop)(),this.parentGroupId=(0,s.prop)(),this.defaultSubgroup=(0,s.prop)(),this.desc=(0,s.prop)(),this.creation=(0,s.prop)(),this.owner=(0,s.prop)(),this.size=(0,s.prop)(),this.participants=(0,s.collection)(o.default),this.groupType=(0,s.derived)((function(){return!0===this.defaultSubgroup?a.GroupType.DEFAULT_ANNOUNCEMENT_GROUP:a.GroupType.SUBGROUP}),["defaultSubgroup"]),this.displayedDesc=(0,s.derived)((function(){return this.groupType!==a.GroupType.DEFAULT_ANNOUNCEMENT_GROUP||null!=this.desc&&""!==this.desc?this.desc:l.fbt._("",null,{hk:"3BnLJ3"}).toString()}),["desc","groupType"])}}c.Proxy="unjoinedSubgroupMetadata",c.idClass=i.default;var u=(0,s.defineModel)(c);t.default=u},873213:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(312889),a=r(n(963928)),o=r(n(733689)),s=n(801255);class l extends s.BaseCollection{constructor(){super(),this.listenTo(this,"add",this._handleAddRemove),this.listenTo(this,"remove",this._handleAddRemove),this.listenTo(this,"change:parentGroupId",this._handleChange)}_updateParent(e){e&&(0,i.updateUnjoinedSubgroups)(e)}_handleAddRemove(e){const t=a.default.get(e.parentGroupId.toString());this._updateParent(t)}_handleChange(e,t,n){const r=null!=t?a.default.get(t.toString()):null,i=null!=n?a.default.get(n.toString()):null;this._updateParent(r),this._updateParent(i)}}l.model=o.default;var c=new l;t.default=c},511824:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;n(743323);var i=r(n(11006)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.unreadMentionCollection=(0,a.prop)(),this.pendingUnreadMentionCount=(0,a.prop)()}initialize(){this.unreadMentionCollection=new i.default,this.pendingUnreadMentionCount=0}hasMentionId(e){return null!=this.unreadMentionCollection.get(e)}addUnreadMentions(e){this.unreadMentionCollection.add(e)}removeUnreadMentions(e){this.unreadMentionCollection.remove(e)}oldestUnreadMention(){return this.unreadMentionCollection.oldestUnreadMention()}reset(){this.pendingUnreadMentionCount=0,this.unreadMentionCollection.reset()}getUnreadMentionCount(){return this.pendingUnreadMentionCount+this.unreadMentionCollection.length}}var s=(0,a.defineModel)(o);t.default=s},743323:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadMessageType=void 0;const r=n(76672).Mirrored(["NEW_MESSAGE","PERSISTANCE_LOAD","HISTORYC_SYNC_CHUNK"]);t.UnreadMessageType=r},105109:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.KeptMsgCollection=void 0;var i=r(n(348926)),a=n(801255),o=n(17304);class s extends a.BaseCollection{constructor(){super(...arguments),this.isSynced=!0,this.syncPromise=null}process(){}sync(){return(0,i.default)((function*(){}))()}updateMsgs(){}}t.KeptMsgCollection=s,s.model=o.Msg,s.comparator=(e,t)=>t.t-e.t},801255:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionSilentQueryError=t.BaseCollection=void 0;var i=r(n(348926)),a=r(n(81109)),o=r(n(873955)),s=r(n(639693)),l=r(n(643063)),c=n(450796),u=n(551737),d=n(492574),p=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),f=(n(665397),n(491442)),_=n(714648),h=n(573923),g=r(n(631727)),m=n(317239),y=n(662583),S=n(608080),E=n(765044);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}const T="QUERY",C="FIND",A="UPDATE",b=(new Object).toString(),P={id:"none",policy:_.CACHE_POLICY.NONE};class O extends Error{constructor(e){super(e),this.name="CollectionSilentQueryError",this.message=e}}t.CollectionSilentQueryError=O;class M extends g.default{constructor(){super(),this._inflight={},this._cachePolicy=(0,h.createCachePolicy)(this,this.constructor.cachePolicy||P),this._staleCollection=this.constructor.staleCollection||!1,this._resumeOnAvailable=this.constructor.resumeOnAvailable||!1,(!0===this._staleCollection||(0,u.isFunction)(this.onResume))&&(this.listenTo(E.Socket,"change:stream",this._handleStreamChange),this.listenTo(E.Socket,"didResume",this._onResume),this._resumeOnAvailable&&this.listenTo(S.Stream,"change:available",(()=>{S.Stream.available&&this._needsUpdate&&this._onResume()}))),this._cachePolicy.enableCaching(),this._cachePolicy.constructor.policy===_.CACHE_POLICY.LOAD&&this.listenTo(m.Conn,"me_ready",this._updateFromCache)}initializeFromCache(e){this.add(e)}saveToCache(){if(!m.Conn.shouldSaveToCache())return;const{id:e}=this._cachePolicy;__LOG__(2)`baseCollection:saveToCache save: ${String(e)}`,f.userPreferencesStore.setCollection(e,this.toJSON())}add(e,t){if(e){if(m.Conn.blockStoreAdds)throw new d.LogoutDrop("adding to store when blocking store adds");const n=Array.isArray(e)?e:[e];if(n.every((e=>null==e?void 0:e.isState))){const e=(0,l.default)(n,(e=>this.get(e.id)));return e.length&&super.add(e,t),n}}return super.add(e,t)}findQuery(e,t){return this._query(T,e,t)}find(e,t){return e?this._query(C,e,t):(__LOG__(4,void 0,new Error,!0)`Called find without an id`,SEND_LOGS("find-without-id"),Promise.reject(new Error("called find without an id")))}update(e,t){return e?this._query(A,e,t):(__LOG__(4,void 0,new Error,!0)`Called update without an id`,SEND_LOGS("update-without-id"),Promise.reject(new Error("called update without an id")))}handle(e){const t=this._handle(e.shift());if(this._staleCollection){const e=Array.isArray(t)?t:[t];(0,s.default)(e).forEach((e=>{e.stale=!1}))}this.add(t,{merge:!0})}gadd(e,t){if(this.modelClass.prototype.isIdType(e)){const n=this.get(e);return n||this.add({id:e},t)[0]}if(e.id){const n=t||{};return n.merge=!0,this.add(e,n)[0]}throw new Error("gadd called without an id attr (id)")}gaddUp(e){let t,n=this._staleCollection;if(this.modelClass.prototype.isIdType(e)){const r={stale:n,id:e};t=this.get(e)||this.add(r,{merge:!0})[0]}else e.id&&(this.get(e.id)&&(n=!1),e=(0,a.default)({stale:n},e),t=this.add(e,{merge:!0})[0]);if(t){const e=t;return t.stale&&this.find(t.id).catch((0,c.filteredCatch)(d.WebdDrop,(()=>{}))),e}throw new Error(".gaddUp called without an id attr (id)")}delete(){this._inflight={},this.reset()}isStateStale(e){const t=this.get(e);return!!t&&t.stale}_handleResume(){switch(E.Socket.stream){case y.SOCKET_STREAM.DISCONNECTED:if(!this._staleCollection)return;this.forEach((e=>{e&&(e.stale=!0)}));break;case y.SOCKET_STREAM.RESUMING:case y.SOCKET_STREAM.SYNCING:case y.SOCKET_STREAM.CONNECTED:}}_onResume(){(0,u.isFunction)(this.onResume)&&(this._resumeOnAvailable&&!S.Stream.available?this._needsUpdate=!0:(this.onResume(),this._needsUpdate=!1))}_query(e,t,n){let r=(0,u.isString)(t)?t:t.toString();r===b&&(r=(0,o.default)("collection_query_"));const i=e===T?void 0:this.get(t),a="force-"+r;return(this._inflight[a]&&e===C||e===A)&&(r=a),this._inflight[r]?e===C&&i&&!i.stale?Promise.resolve(i):this._inflight[r]:!i||i.stale||e===A?this._inflight[r]=this._serverQuery(e,t,n).finally((()=>{delete this._inflight[r]})).catch((0,c.filteredCatch)(d.LogoutDrop,(e=>{__LOG__(3)`LogoutDrop error: ${e.toString()}`}))).catch((e=>{if(!(e instanceof O))throw e;__LOG__(2)`baseCollection:query query promise rejected: ${String(e)}`})).catch((0,c.filteredCatch)(d.WebdDrop,(function(e){throw __LOG__(3)`WebdDrop error: ${e.toString()}`,e}))):Promise.resolve(i)}_serverQuery(e,t,n){var r=this;return(0,i.default)((function*(){let i;if(e===A)i=r._update(t,n);else if(e===C)i=r._find(t,n);else{const e=null==n?void 0:n.logOnSend;i=r._findQuery(t,e)}const a=yield i;if(r._staleCollection){const e=Array.isArray(a)?a:[a];(0,s.default)(e).forEach((function(e){void 0===e.stale&&(e.stale=!1)}))}let o;if(o=(null==n?void 0:n.set)?r.set(a):r.add(a,{merge:!0}),Array.isArray(a))return o;if(o[0])return o[0];throw new p.ModelCreateError("Unknown",a)}))()}_update(e,t){return this._find(e,t)}_handleStreamChange(){this._handleResume(),this._cachePolicy.constructor.policy===_.CACHE_POLICY.LOAD&&this._updateFromCache()}_updateFromCache(){const{id:e}=this._cachePolicy;this._cachePolicy.disableCaching(),m.Conn.shouldSaveToCache()&&(__LOG__(2)`baseCollection:initFromCache load: ${String(e)}`,this.initializeFromCache(f.userPreferencesStore.getCollection(e)),this._cachePolicy.enableCaching())}}t.BaseCollection=M},325389:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMirror=void 0,t.genBitMask=function(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[`change:${t[r]}`],a=Math.floor(i/32);o(n,a+1),n[a]|=1<<i%32}return n},t.genMirrorMask=function(e){const t={};let n=0;const r=e=>{t[`change:${e}`]=n++};e.props&&Object.keys(e.props).forEach(r);e.session&&Object.keys(e.session).forEach(r);e.derived&&Object.keys(e.derived).forEach(r);return t};var i=r(n(604788));function a(e,t){e[t]=e[e.length-1],e.pop()}function o(e,t){if(t<=e.length)return;const n=t-e.length;for(let t=0;t<n;t++)e.push(0)}t.BaseMirror=class{constructor(e){this.state=e}destructor(){this.state.off("all",this.onGatherEvent,this)}initListener(){this.state.on("all",this.onGatherEvent,this),this.masks=[],this.listeners=[],this.changeEvents=[]}onGatherEvent(e){if("change"===e){if(!this.changeEvents.filter(Boolean).length)return;this.onChange(),this.changeEvents=[]}else{const t=this.state.mirrorMask[e];if(void 0===t)return;const n=t/32|0;o(this.changeEvents,n+1),this.changeEvents[n]|=1<<(t%32|0)}}onChange(){const e=this.state,t=this.changeEvents;(0,i.default)(this.masks,this.listeners).forEach((n=>{let[r,i]=n;const a=Math.min(t.length,r.length);for(let n=0;n<a;n++)if(t[n]&r[n]){const[t,n]=i;null!=t&&null!=n&&t(n,e);break}}))}addListener(e,t,n){this.listeners||this.initListener(),this.masks.push(t),this.listeners.push([e,n])}removeListener(e){const t=this.listeners;for(let n=0;n<t.length;n++)t[n][0]===e&&(t[n][0]=null,t[n][1]=null,a(this.masks,n),a(t,n))}}},411290:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModel=void 0,Object.defineProperty(t,"collection",{enumerable:!0,get:function(){return h.collection}}),t.defineModel=function(e){const t=(0,h.convert)(e),n=(0,h.stateExtend)(y,t);if(e.Proxy){const r=(0,_.genMirrorMask)(t);n.prototype.mirrorMask=r,n.prototype.proxyName=e.Proxy,(0,g.ProxyStateFactory)(e.Proxy,t,r)}return n},Object.defineProperty(t,"derived",{enumerable:!0,get:function(){return h.derived}}),Object.defineProperty(t,"prop",{enumerable:!0,get:function(){return h.prop}}),Object.defineProperty(t,"session",{enumerable:!0,get:function(){return h.session}});var i=r(n(81109)),a=r(n(907287)),o=r(n(402525)),s=r(n(352353)),l=r(n(114176)),c=n(450796),u=n(551737),d=n(492574),p=n(781572),f=r(n(876521)),_=n(325389),h=n(867820),g=n(980134);const m=/^change:/;class y extends f.default{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(),this.stale=(0,h.session)(!1),this.__fired=null,this.__changes=null,this.__initialized=!1,t._internalInitializationDoNotUse)return;this.stale=(null==e?void 0:e.stale)||this.getDefault("stale"),this.parent=t.parent,this.collection=t.collection,this._initDeriveds(),this._initCollections();const n=this.__defaults,r=n?(0,i.default)((0,i.default)({},n),e):e;r&&!function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}(r)&&this.set(r,(0,i.default)({silent:!0},t)),this.initialize(),this.__initialized=!0}initialize(){if(this.collection&&this.id&&!this.collection.modelClass.prototype.isIdType(this.id))throw new Error(`Model id:${String(this.id)} is wrong type`);this._uiObservers=0,this.mirrorMask&&(this.mirror=new _.BaseMirror(this))}_refreshStaleModel(){if(this._uiObservers||!this.stale){if(!this.getCollection)throw new Error("base_model:_refreshStaleModel getCollection does not exist");this.getCollection().find(this.id).catch((0,c.filteredCatch)(d.WebdDrop,(()=>{})))}}incObservers(e){if(this._uiObservers++,e)return;n(681602).default.online&&this.stale&&(p.Cmd.uiBusy?this.listenToOnce(p.Cmd,"ui_idle",this._refreshStaleModel):this._refreshStaleModel())}decObservers(){this._uiObservers>0&&this._uiObservers--,0===this._uiObservers&&this.stopListening(p.Cmd,"ui_idle",this._refreshStaleModel)}hasObservers(){return this._uiObservers>0}addChild(e,t){const n={};n[e]=t,this.set(n,{silent:!0}),this.listenTo(t,"all",this._getCachedEventBubblingHandler(e))}get(e){return this[e]}set(e,t,n){var r;let i=n;return"string"==typeof e?this._set(e,t,i):(i=t,(null===(r=i)||void 0===r?void 0:r.merge)?this._set((0,l.default)(e,s.default),i):this._set(e,i))}_markChange(e,t){this.__initialized&&(this._getChanges().push({key:e,oldValue:t}),this.__fired&&(this.__fired[e]=!1))}_set(e,t,n){const r=!!this.__changes,[i,a]=(0,u.isString)(e)?[{[e]:t},n]:[e,t];let o=Object.keys(i).reduce(((e,t)=>{const n=this._setKV(t,i[t],a);return n&&e.push(...n),e}),[]),s=0;for(;o&&o.length>0;){if(s++>5)throw new Error("Circular derived properties / event listeners");const e=this._topo;if(!e)throw new Error("_topo unexpectedly undefined");const t=S(e,o);o=t.reduce(((e,n,r)=>{const i=this._setD(n,t.slice(r+1));return i&&e.push(...i),e}),[])}if(!(null==a?void 0:a.silent)&&this.hasUnfiredChanges()){const e=this.__fired={},t=this._getChanges(),n=t.length>0;for(;t.length;){const{key:n,oldValue:r}=t.shift();if(!e[n]){e[n]=!0;const t=this._definition[n].evt;if(this.isListening(t)||this.isListening("all")){const e=this[n];this.trigger(t,this,e,r)}}}(n&&this.isListening("change")||this.isListening("all"))&&this.trigger("change",this)}return r||(this.__changes&&(this.__changes=null),this.__fired&&(this.__fired=null)),this}_setKV(e,t,n){if(this._collections[e])return void this[e].set(t,n);const r=this._definition[e];if(!r)return void(this[e]=t);if(r.attr===h.Attr.DERIVED)throw new Error(`Attempting to directly set derived property: ${e}`);const i=r.sk,a=this[e];if(t===a)return;this[i]=t,this._markChange(e,a);const o=this._deps;return(null==o?void 0:o[e])?o[e]:void 0}_setD(e,t){var n;const r=this._definition[e],i=r.sk,a=r.fn.call(this),o=this[i];if(a!==o&&(this[i]=a,this._markChange(e,o),null===(n=this._deps)||void 0===n?void 0:n[e])){const n=function(e,t){const n=new Set(t);return e.filter((e=>!n.has(e)))}(this._deps[e],t);if(n.length)return n}}hasUnfiredChanges(){const e=this.__fired,t=this.__changes;if(!t)return!1;if(!e)return!0;for(let n=0;n<t.length;n++)if(!e[t[n].key])return!0;return!1}_getChanges(){return this.__changes||(this.__changes=[])}_initDeriveds(){this.__derived.forEach((e=>{this[this._definition[e].sk]=h.INIT}))}_initCollections(){(0,o.default)(this._collections,((e,t)=>{this[t]=new e(null,{parent:this})}))}unset(e,t){const n=Array.isArray(e)?e:[e];this.set((0,a.default)(n),t)}clear(){this.unset([...this.__props,...this.__session])}delete(){this.stopListening()}reset(){this.set(this.__defaults)}toJSON(){return this.serialize()}serialize(){const e={};for(let t=0;t<this.__props.length;t++)e[this.__props[t]]=this[this.__props[t]];return(0,o.default)(this._collections,((t,n)=>{e[n]=this[n].serialize()})),e}getDefault(e){const t=this._definition[e];if(!t)return;const n=t.defaultValue;return(0,u.isFunction)(n)?n():n}_getCachedEventBubblingHandler(e){return function(t,n,r){m.test(t)?this.trigger("change:"+e+"."+t.split(":")[1],n,r):"change"===t&&this.trigger("change",this)}.bind(this)}static isIdType(e){return!(!this.allowedIds||!this.allowedIds.includes(e))||(this.idClass?e instanceof this.idClass:"string"==typeof e)}}function S(e,t){const n=new Set(t);return e.filter((e=>n.has(e)))}t.BaseModel=y},714648:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_POLICY=t.BaseCachePolicy=void 0;var i=r(n(876521));const a={LOAD:"LOAD",NONE:"NONE"};t.CACHE_POLICY=a;class o extends i.default{constructor(e,t){super(),this.collection=e,this.id=t}enableCaching(){}disableCaching(){}}t.BaseCachePolicy=o,o.policy=a.NONE},573923:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createCachePolicy=function(e,t){switch(t.policy){case"LOAD":return new i.default(e,t);case"NONE":return new a.default(e,t)}return new a.default(e,{id:"none",policy:"NONE"})};var i=r(n(701088)),a=r(n(858433))},701088:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(23279)),a=n(714648);class o extends a.BaseCachePolicy{constructor(e,t){super(e,t.id),this._trigger=t.trigger||"all",this._delay=t.delay,this._saveToCache=(0,i.default)(this.saveToCache,this._delay)}saveToCache(){this.collection.saveToCache()}enableCaching(){this.listenTo(this.collection,this._trigger,this._saveToCache)}disableCaching(){this.stopListening(this.collection,this._trigger,this._saveToCache)}}t.default=o,o.policy=a.CACHE_POLICY.LOAD},858433:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(714648);class i extends r.BaseCachePolicy{constructor(e,t){super(e,t.id)}}t.default=i,i.policy=r.CACHE_POLICY.NONE},631727:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(348206),o=r(n(876521));class s extends o.default{constructor(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),e.parent&&(this.parent=e.parent);const{model:t,comparator:n}=this.constructor;if(!t)throw new Error("Collection initialized without model. It is likely that you have a circular dependency. Run `yarn lint:circular` to find it and use inline `require` instead of `import` to avoid it.");this.modelClass=t,n&&(this._comparator=n),this._reset();const r=this;Object.defineProperty(this,"length",{get:()=>r._models.length})}add(e,t){let n;return n=Array.isArray(e)?e.slice():e?[e]:[],this.set(n,(0,i.default)({merge:!1,add:!0,remove:!1},t))}set(e,t){if(!e)return __LOG__(3)`collection:set called with no models`,[];const n=(0,i.default)({add:!0,remove:!0,merge:!0},t);let r,a,o,s;const l=this._comparator&&!1!==n.sort,c=[],u=[],d={},{add:p,merge:f,remove:_}=n,h=null!=n.at?n.at:void 0,g=!(l||!p||!_)&&[];for(let t=0,i=e.length;t<i;t++){if(s=e[t],this.isModel(s)&&(a=s),r=s.id,!r){__LOG__(3)`collection:set model has no id`;continue}if(o=this.get(r),o){const r=o;_&&(d[o.id.toString()]=!0),f&&(s=a&&s===a?a.attributes:s,r.set(s,n)),e[t]=r}else if(p){if(a=e[t]=this._prepareModel(s,n),!a)continue;{const e=a;c.push(e),this._addReference(e)}}if(a=o||a,!a)continue;const i=a;!g||a.id&&d[a.id.toString()]||g.push(i),d[i.id.toString()]=!0}if(_){for(let e=0,t=this.length;e<t;e++){a=this._models[e];const t=a;d[a.id.toString()]||u.push(t)}u.length&&this.remove(u,(0,i.default)({},n))}let m;if(c.length||g.length)if(l&&(m=!0),"number"==typeof h)this._models.splice(h,0,...c);else{const e=g||c;for(let t=0,n=e.length;t<n;t++)this._models.push(e[t])}if(m&&this.sort({silent:!0}),!n.silent){for(let e=0,t=c.length;e<t;e++)a=c[e],a.trigger?a.trigger("add",a,this,n):this.trigger("add",a,this,n);(m||g.length)&&this.trigger("sort",this,n)}return e}remove(e){let t,n,r,i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=Array.isArray(e)?e.slice():[e],s=[];for(let e=0,l=o.length;e<l;e++)if(i=o[e],i&&(r=i instanceof this.modelClass?i.id:i,t=s[e]=this.get(r),t)){const e=t;this._deIndex(t),n=this._models.indexOf(t),this._models.splice(n,1),a.silent||(a.index=n,e.trigger?e.trigger("remove",t,this,a):this.trigger("remove",t,this,a)),this._removeReference(e)}return s}reset(){for(let e=0,t=this._models.length;e<t;e++)this._removeReference(this._models[e]);this._reset(),this.trigger("reset",this)}sort(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._comparator)throw new Error("Cannot sort without comparator");return this._models.sort(this._comparator.bind(this)),e.silent||this.trigger("sort",this,e),this}replaceId(e,t){const n=this.get(e);n&&(this._removeFromIndex(e),n.set({id:t}),this._addIndex(n))}reorderMutate(e,t){(0,a.arrayMoveMutate)(this._models,e,t)}get(e){return this._index[e]}assertGet(e){const t=this._index[e];return t||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Collection:assertGet no result")),t}at(e){return this._models[e]}serialize(){return this.map((e=>e.toJSON()))}toJSON(){return this.serialize()}isModel(e){return e instanceof this.modelClass}includes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return 0===t?e instanceof this.modelClass&&null!=this.get(e.id):this._models.includes(e,t)}indexOf(e,t){return this._models.indexOf(e,t)}lastIndexOf(e,t){return this._models.lastIndexOf(e,t)}every(e){return this._models.every(e)}some(e){return this._models.some(e)}forEach(e){this._models.forEach(e)}map(e){return this._models.map(e)}filter(e){return this._models.filter(e)}findFirst(e){return this._models.find(e)}reduce(e,t){return this._models.reduce(e,t)}slice(e,t){return this._models.slice(e,t)}where(e){return this.filter((t=>{for(const n in e)if(e[n]!==t.get(n))return!1;return!0}))}head(){return this._models[0]}last(){return this._models[this._models.length-1]}toArray(){return this._models.slice()}getModelsArray(){return this._models}reorder(e,t){return(0,a.arrayMove)(this._models,e,t)}_reset(){this._models=[],this._index={}}_prepareModel(e,t){if(this.isModel(e))return e.collection||(e.collection=this),e;const n=(0,i.default)((0,i.default)({},t),{},{collection:this});try{return new this.modelClass(e,n)}catch(e){return void __LOG__(3)`collection:_prepareModel exception: ${e.stack}`}}_addReference(e){this._addIndex(e),e.collection||(e.collection=this),e.on&&e.on("all",this._handleModelEvent,this)}_removeReference(e){this===e.collection&&delete e.collection,this._deIndex(e),e.off&&e.off("all",this._handleModelEvent,this)}_addIndex(e){this._index[e.id]=e}_deIndex(e){delete this._index[e.id]}_removeFromIndex(e){this.get(e)&&delete this._index[e]}_handleModelEvent(e,t,n,r){const i=e.indexOf(":"),a=-1===i?e:e.slice(0,i);("add"!==a&&"remove"!==a||n===this)&&("destroy"===a&&this.remove(t,r),this.trigger.apply(this,arguments))}}t.default=s},867820:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.NO_DEFAULT_VALUE=t.INIT=t.Attr=void 0,t.collection=function(e){return{val:e,type:m}},t.convert=function(e){const t=new e({},{_internalInitializationDoNotUse:!0}),n={name:e.name||"Unknown",props:{},session:{},derived:{},collections:{},isIdType:e.isIdType};e.Collection&&(n.Collection=e.Collection);e.idClass&&(n.idClass=e.idClass);e.allowedIds&&(n.allowedIds=e.allowedIds);const r=new Set(["constructor"]),i=new Set(["collection","parent","__changes","__fired","__initialized"]);(function(e){const t=[];for(const n in e)"function"!=typeof e[n]&&t.push([n,e[n]]);return t})(t).forEach((t=>{let[a,s]=t;if(!i.has(a)&&null!=s)switch(s.type){case _:n.props[a]=y(s);break;case h:n.session[a]=y(s);break;case g:n.derived[a]=(0,o.default)(s,"type"),r.add(s.fn.name);break;case m:n.collections[a]=s.val;break;default:throw new Error(`Invalid defineModel Class type for ${e.name}:${a}.`)}}));const a=function(e){const t={},n=Object.getPrototypeOf({});let r=e;Object.getOwnPropertyNames(r).forEach((e=>{"function"==typeof r[e]&&(t[e]=r[e])}));for(;(r=Object.getPrototypeOf(r))&&r!==n;)Object.getOwnPropertyNames(r).forEach((e=>{e in t||(t[e]=r[e])}));return t}(t);return r.forEach((e=>{delete a[e]})),Object.assign(n,a),n},t.derived=function(e,t){return{fn:e,deps:t,type:g}},t.prop=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;const t={defaultValue:e,type:_};return t},t.session=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;const t={defaultValue:e,type:h};return t},t.stateExtend=function(e,t){const n=(0,l.default)(t.name,"protoDef.name");delete t.name;const r=function(e,t){return{[t]:class extends e{}}[t]}(e,n),s=r.prototype,c=s.__props=[],f=s.__session=[],_=s.__derived=[],h=s._collections={},g=s._definition={},m=s._derived={};(0,a.default)(t.props,(function(e,t){c.push(t),E(s,t,e,p.PROP)})),(0,a.default)(t.session,(function(e,t){f.push(t),E(s,t,e,p.SESSION)})),(0,a.default)(t.derived,(function(e,t){_.push(t),function(e,t,n){const r=S(t),i=n.fn;e._definition[t]=e._derived[t]={sk:r,evt:"change:"+t,attr:p.DERIVED,fn:i,deps:n.deps},Object.defineProperty(e,t,{get(){const e=this[r];if(e!==d)return e;const t=i.call(this);return this[r]=t,t},set(){throw new TypeError(`'${t}' is a derived property, it can't be set directly.`)}})}(s,t,e)})),(0,a.default)(t.collections,(function(e,t){h[t]=e})),Object.assign(s,(0,o.default)(t,["props","session","derived","collections"]));const y=c.concat(f),v=y.length;Object.defineProperties(s,{attributes:{get(){const e={};for(let t=0;t<v;++t)e[y[t]]=this[y[t]];return e}},isState:{get:()=>!0,set(){throw new Error("attempt to set isState")}}});const T={};for(let e=0;e<v;e++){const t=y[e];"defaultValue"in g[t]&&(T[t]=d)}(0,i.default)(T)||(s.__defaults=T);if(_.length){const e=[],t={},n={};(0,a.default)(m,((r,i)=>{n[i]=!0,(0,a.default)(r.deps,(r=>{n[r]=!0,(t[r]||(t[r]=[])).push(i),e.push([i,r])}))})),e.length&&(s._deps=t,s._topo=u.default.array(Object.keys(n),e).reverse())}return r};var i=r(n(441609)),a=r(n(402525)),o=r(n(957557)),s=r(n(513218)),l=r(n(145095)),c=n(551737),u=r(n(394633));const d={sentinel:"DEFAULT VALUE PLACEHOLDER"};t.INIT=d;const p={PROP:"PROP",SESSION:"SESSION",DERIVED:"DERIVED"};t.Attr=p;const f=Symbol("NO_DEFAULT_VALUE");t.NO_DEFAULT_VALUE=f;const _="Props",h="Session",g="Derived",m="Collection";function y(e){const t=e.defaultValue;return t===f?{}:{defaultValue:t}}function S(e){return"__x_"+e}function E(e,t,n,r){if(!(0,s.default)(n))throw new Error("Invalid Prop/Session definition.");const i={sk:S(t),evt:`change:${t}`,attr:r};void 0!==n.defaultValue&&(i.defaultValue=n.defaultValue),e._definition[t]=i;const a=(0,c.isFunction)(i.defaultValue);if(null!=i.defaultValue&&!a){if(Array.isArray(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: Array provided.");if((0,s.default)(i.defaultValue))throw new Error("Do not return mutable types as default values as they are shared. Type: WAUnsafeObjectType provided.")}const o=i.sk;Object.defineProperty(e,t,{set(e){this.set(t,e)},get(){const e=this[o];return e!==d?e:a?this[o]=i.defaultValue():i.defaultValue}})}},980134:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyStates=t.ProxyStateFactory=t.DuplicatedProxyProperty=void 0;var i=r(n(506479)),a=n(640265);const o=["props","session","collections","derived"];class s extends((0,a.customError)("DuplicatedProxyProperty")){}t.DuplicatedProxyProperty=s;const l={};t.ProxyStates=l;t.ProxyStateFactory=(e,t,n)=>{const{props:r,session:a,collections:c,derived:u}=t,d=(0,i.default)(t,o),p=function(e){this.$ProxyState$state=e},f={};if([r,a,c,u].forEach((t=>{t&&Object.keys(t).forEach((t=>{f[t]={get(){return __LOG__(4,void 0,new Error,!0)`Cannot read proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Access"),this.$ProxyState$state[t]},set(n){__LOG__(4,void 0,new Error,!0)`Cannot write proxy property "${e}.${t}" created in <${this.$ProxyState$ComponentName}/>. Make sure it is in your list of concerns.`,SEND_LOGS("Invalid ProxyState Write"),this.$ProxyState$state[t]=n}}}))})),f.proxyName={value:e},f.mirrorMask={value:n},f.isProxyOf={value(e){return this.$ProxyState$state===e}},["set","get",...Object.keys(d)].forEach((e=>{f[e]={value(){const t=this.$ProxyState$state;return t[e].apply(t,arguments)}}})),(p.prototype=Object.create(null,f)).constructor=p,e in l)throw new s(`Duplicated proxy property "${e}".`);l[e]=p}},118146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unproxy=function(e){if(null==e?void 0:e.$ProxyState$state)return e.$ProxyState$state;return e}},71306:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(450796),a=n(492574),o=n(88555),s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=S(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),l=n(694816),c=n(978820),u=r(n(389867)),d=r(n(233861)),p=r(n(656891)),f=r(n(914296)),_=n(446331),h=n(669951),g=n(411290),m=n(548360),y=n(785893);function S(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(S=function(e){return e?n:t})(e)}class E extends g.BaseModel{constructor(){super(...arguments),this.id=(0,g.prop)(),this.duration=(0,g.prop)(),this.participants=(0,g.collection)(d.default),this.active=(0,g.session)(!1),this.keepAliveTimer=(0,g.session)(),this.stopPromise=(0,g.session)()}initialize(){super.initialize(),this.listenTo(this.participants,"remove reset",(()=>{this.hasParticipants()||this.delete()}));const e=h.ChatCollection.get(this.id);e&&!e.liveLocation&&(e.liveLocation=this)}delete(){super.delete(),this.stopViewingMap(),this.participants.delete(),this.getCollection().remove(this.id);const e=h.ChatCollection.get(this.id);e&&(e.liveLocation=void 0)}hasParticipants(){return this.participants.length>0}startViewingMap(){this.active||(this.active=!0,this._updateLiveLocations(),this._startKeepAlive())}stopViewingMap(){this.active&&(this.active=!1,this._pauseLiveLocations(),this._stopKeepAlive())}userHasLiveLocation(e){return!!this.participants.get(e)}iHaveLiveLocation(){return this.userHasLiveLocation((0,c.getMaybeMeUser)())}stopMyLiveLocation(e){if(!this.iHaveLiveLocation())return Promise.reject(new s.ActionError);if(this.stopPromise)return this.stopPromise;if((0,o.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const t=this.stopPromise=p.default.disableLiveLocation(this.id),n=new _.ActionType(m.fbt._("Stopping live location sharing",null,{hk:"3Zapuy"})),r=e||(0,_.genId)(),i=t.then((e=>200===e.status?new _.ActionType(m.fbt._("Stopped sharing live location",null,{hk:"1sRjWg"})):e.status>=400?new _.ActionType(m.fbt._("Couldn't stop sharing live location",null,{hk:"2ckYx4"})):void 0)).catch((()=>(__LOG__(3)`models:liveLocation:disableLiveLocation dropped`,new _.ActionType(m.fbt._("Couldn't stop sharing live location",null,{hk:"2ckYx4"}),{actionText:f.default.t(122),actionHandler:this.stopMyLiveLocation.bind(this,r)}))));return l.ToastManager.open((0,y.jsx)(_.ActionToast,{id:r,initialAction:n,pendingAction:i})),t.then((e=>{if(200===e.status&&!e._duplicate){const e=this.participants.get((0,c.getMaybeMeUser)());e&&e.disable()}})).finally((()=>{this.stopPromise=null}))}_updateLiveLocations(){this.getCollection().update(this.id).catch((()=>{}))}_pauseLiveLocations(){p.default.unsubscribeLiveLocation(this.id).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))}_sendKeepAlive(){p.default.subscribeLiveLocation(this.id,!1).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))}_startKeepAlive(){if(null!=this.keepAliveTimer)return;const e=this.duration;null!=e&&0!==e&&(this.keepAliveTimer=window.setInterval(this._sendKeepAlive.bind(this),1e3*e))}_stopKeepAlive(){null!=this.keepAliveTimer&&(window.clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}getCollection(){return n(985865).LiveLocationCollection}}E.Proxy="liveLocation",E.idClass=u.default;var v=(0,g.defineModel)(E);t.default=v},985865:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LiveLocationCollectionImpl=t.LiveLocationCollection=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(450796),s=n(551737),l=n(492574),c=n(88555),u=n(40234),d=n(115461),p=r(n(389867)),f=r(n(71306)),_=r(n(656891)),h=n(719380),g=n(801255);class m extends g.BaseCollection{_find(e){var t=this;return(0,a.default)((function*(){if(!p.default.isUser(e)&&!p.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));if((0,c.isMDBackend)())return Promise.reject(new Error("This call is only supported in non-MD mode"));const n=yield _.default.subscribeLiveLocation(e,!0);if(n.status&&n.status>=400)return 499===n.status?__LOG__(2)`liveLocation:subscribe query not implemented on the phone`:__LOG__(3)`model:LiveLocation:_find error ${n.status}`,Promise.reject(n.status);const r=(0,s.isNumber)(n.duration)?n.duration:void 0,a=n.participants?n.participants.map((e=>(0,i.default)((0,i.default)({},t._extractLocationFields(e)),{},{id:e.id,expiration:0===e.expiration?1/0:e.expiration}))):[];return{id:e,duration:r,participants:a}}))()}getActive(e){var t=this;return(0,a.default)((function*(){if(!p.default.isUser(e)&&!p.default.isGroup(e))return Promise.reject(new Error("invalid wid for live location: "+e));try{const n=yield _.default.queryActiveLiveLocation(e);if(n.status&&n.status>=400)return 499===n.status?__LOG__(2)`liveLocation:participant query not implemented on the phone`:__LOG__(3)`model:LiveLocation:getActive error ${n.status}`,Promise.reject(n.status);if(!n.participants||!n.participants.length)return;const r=n.participants.map((e=>({id:e.id,expiration:0===e.expiration?1/0:e.expiration})));t.add({id:e,participants:r},{merge:!0})}catch(e){return(0,o.filteredCatch)(l.WebdDrop,(()=>{}))(e)}}))()}onResume(){this.filter((e=>e.active&&e.hasParticipants())).forEach((e=>{this.update(e.id)}))}handle(e){Array.isArray(e)?e.forEach((e=>{switch(e.type){case"update":{const t=this._extractLocationFields(e),n=h.ContactCollection.get(e.jid);(null==n?void 0:n.liveLocations)&&n.liveLocations.forEach((e=>e.set(t)));break}case"disable":{const t=this.get(e.chat);if(t){const n=t.participants.get(e.jid);n&&(e.seq>n.sequence||-1===e.seq)&&n.disable()}break}default:__LOG__(3)`models:liveLocation:handle unknown type: ${e.type}`}})):__LOG__(3)`models:liveLocation:handle unrecognized payload`}processMsg(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.type===d.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to process non live-location msg"));const n=e.id.remote,{lat:r,lng:i,accuracy:a,speed:o,degrees:s,sequence:l,comment:c,shareDuration:p,t:f}=e;if(!f||!p)return;const _=f+p;if(_<=u.Clock.globalUnixTime())return;const h={id:e.sender,lat:r,lng:i,accuracy:a,speed:o,degrees:s,sequence:l,comment:c,expiration:_,lastUpdated:f,msg:e};-1===l&&delete h.sequence;const g=this.get(n);if(g){const e=g.participants.get(h.id);if(t)return void(e&&e.lastUpdated<=h.lastUpdated&&e.set(h));if(e&&g.participants.removeParticipant(e),g.hasParticipants())return void g.participants.add(h)}this.add({id:n,participants:[h]})}removeMsg(e){e.type===d.MSG_TYPE.LOCATION&&e.isLive||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("collection:liveLocation trying to remove non live-location msg"));const t=e.id.remote,n=e.sender,r=this.get(t);r&&r.participants.remove(n)}_extractLocationFields(e){return void 0===e.lat||void 0===e.lng?{}:{lastUpdated:u.Clock.globalUnixTime()-e.elapsed,lat:e.lat,lng:e.lng,accuracy:e.accuracy,speed:e.speed,degrees:e.degrees,comment:e.comment}}}t.LiveLocationCollectionImpl=m,m.model=f.default,m.staleCollection=!0,m.resumeOnAvailable=!0;const y=new m;t.LiveLocationCollection=y},257465:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(551737),a=r(n(485074)),o=n(40234),s=n(122367),l=n(978820),c=r(n(389867)),u=n(719380),d=n(411290);class p extends d.BaseModel{constructor(){super(...arguments),this.id=(0,d.prop)(),this.msg=(0,d.prop)(),this.lat=(0,d.prop)(),this.lng=(0,d.prop)(),this.accuracy=(0,d.prop)(),this.speed=(0,d.prop)(),this.degrees=(0,d.prop)(),this.sequence=(0,d.prop)(),this.comment=(0,d.prop)(),this.expiration=(0,d.prop)(),this.lastUpdated=(0,d.prop)(),this.contact=(0,d.session)(),this.expireTimerId=(0,d.session)(),this.disabled=(0,d.session)(!1),this.isMe=(0,d.derived)((function(){return this.id.equals((0,l.getMaybeMeUser)())}),["id"]),this.valid=(0,d.derived)((function(){return t=this.lat,(0,i.isNumber)(t)&&t>=-90&&t<=90&&(e=this.lng,(0,i.isNumber)(e)&&e>=-180&&e<=180);var e,t}),["lat","lng"])}initialize(){super.initialize(),this.addChild("contact",u.ContactCollection.gadd(this.id)),(0,s.addLiveLocation)(this.contact,this),this.listenTo(this,"change:expiration",this._setExpireTimer),this._setExpireTimer()}delete(){super.delete(),this._disableMsg(),(0,s.removeLiveLocation)(this.contact,this),this._clearExpireTimer()}remainingTime(){return this.expiration-o.Clock.globalUnixTime()}elapsedTime(){return o.Clock.globalUnixTime()-this.lastUpdated}disable(){this.disabled=!0}_disableMsg(){const e=this.msg;e&&(e.shareDuration=o.Clock.globalUnixTime()-e.t-1)}_setExpireTimer(){this.expiration&&(this.remainingTime()<=0?this._expire():this.expireTimerId=a.default.setGlobalTimeout(this._expire.bind(this),1e3*this.expiration,this.expireTimerId))}_clearExpireTimer(){a.default.clearTimeout(this.expireTimerId),this.expireTimerId=null}_expire(){this.disable()}}p.Proxy="liveLocationParticipant",p.idClass=c.default;var f=(0,d.defineModel)(p);t.default=f},233861:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(978820),a=r(n(257465)),o=n(647969),s=n(801255);class l extends s.BaseCollection{constructor(){super(),this.listenTo(this,"change:disabled",(e=>{e.disabled&&this.removeParticipant(e)}))}delete(){this.forEach((e=>this.removeParticipant(e)))}validLocations(){return this.filter((e=>e.valid))}removeParticipant(e){this.remove(e),e.delete()}}t.default=l,l.model=a.default,l.comparator=(e,t)=>{const n=(0,i.getMaybeMeUser)();return e.contact.id.equals(n)?-1:t.contact.id.equals(n)?1:(0,o.ContactComparator)(e.contact,t.contact)}},196876:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(657319),a=n(40234),o=n(438184),s=n(555452),l=n(411290),c=r(n(268132)),u=n(765044);class d extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.showAwarenessMsg=(0,l.prop)(!1),this.showCountDownMsg=(0,l.prop)(!1),this.daysLeftTillDeadline=(0,l.prop)(0),this.expirationTime=(0,l.prop)(),this.deadlineExpiredLogoutTimer=(0,l.session)()}processMdOptInDeadline(){if(o.LegacyPhoneFeatures.supportsFeature(o.LegacyPhoneFeatures.F.EXTERNAL_MD_OPT_IN_AVAILABLE)&&c.default.mdOptInDeadline.timestamp>0){const e=c.default.mdOptInDeadline.timestamp,t=a.Clock.globalUnixTime(),n=a.Clock.daysDelta(t,e);if(t>e)return __LOG__(2)`MdOptInDeadline:processMdOptInDeadline logout due to MD opt-in deadline expiration`,(0,s.setMdOptedIn)(!0),(0,s.setShowMdUpgradeCompleteMsg)(!0),(0,s.setForcedMdUpgradeComplete)(!0),void u.Socket.logout();0===n?this.set({showCountDownMsg:!0,expirationTime:a.Clock.relativeStr(e).toString(),daysLeftTillDeadline:null,showAwarenessMsg:!1}):n<=7?this.set({showCountDownMsg:!0,daysLeftTillDeadline:n,expirationTime:null,showAwarenessMsg:!1}):this.set({showAwarenessMsg:!0,expirationTime:null,daysLeftTillDeadline:null,showCountDownMsg:!1}),this.deadlineExpiredLogoutTimer.cancel(),this.deadlineExpiredLogoutTimer.onOrAfter(1e3*(e-t))}}initialize(){super.initialize(),this.deadlineExpiredLogoutTimer=new i.ShiftTimer((function(){__LOG__(2)`MdOptInDeadline:deadlineExpiredLogoutTimer logout due to MD opt-in deadline expiration`,(0,s.setMdOptedIn)(!0),(0,s.setShowMdUpgradeCompleteMsg)(!0),(0,s.setForcedMdUpgradeComplete)(!0),u.Socket.logout()}))}}d.Proxy="mdOptInDeadline";var p=new((0,l.defineModel)(d));t.default=p},17304:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgImpl=t.Msg=void 0,t.createProductInquiry=function(e,t,n,r){const i=function(e){return new Oe(e)}({ack:y.ACK.CLOCK,id:new N.default({id:"product_inquiry",remote:t,fromMe:!0}),from:t,t:A.Clock.globalUnixTime(),type:L.MSG_TYPE.PRODUCT,title:e.name,description:e.description,businessOwnerJid:t.toString({legacy:!0}),productId:e.id.toString(),url:e.url,productImageCount:e.getProductImageCollectionCount(),body:n.preview instanceof pe.default?n.preview.getBase64():null,currencyCode:e.currency,priceAmount1000:e.priceAmount1000,salePriceAmount1000:(0,z.isSalePriceActive)(e)?e.salePriceAmount1000:null,sessionId:r});return i.mediaData.set(n),i};var i=r(n(348926)),a=r(n(23279)),o=r(n(957557)),s=r(n(545578)),l=r(n(441609)),c=r(n(339138)),u=be(n(293131)),d=r(n(145095)),p=n(240277),f=n(927870),_=n(88156),h=n(551737),g=n(164331),m=n(227101),y=n(535470),S=n(88555),E=n(864795),v=n(286274),T=n(933852),C=n(173679),A=n(40234),b=n(781572),P=n(237540),O=r(n(364369)),M=n(471682),I=r(n(312523)),w=be(n(995726)),R=n(408139),N=r(n(465212)),L=n(115461),D=n(586031),k=n(745042),U=n(20551),G=n(387674),x=n(515411),B=r(n(984145)),F=r(n(376139)),j=n(978820),Y=n(893778),K=r(n(389867)),W=n(745454),H=n(562054),V=r(n(384064)),$=r(n(905165)),z=n(713151),q=n(317239),J=n(719380),Q=n(411290),X=be(n(554676)),Z=n(72472),ee=r(n(53988)),te=n(284728),ne=n(964551),re=n(608080),ie=r(n(963236)),ae=n(111902),oe=n(197563),se=n(837626),le=n(524606),ce=n(6901),ue=n(529805),de=r(n(914296)),pe=r(n(534949)),fe=be(n(778986)),_e=r(n(502320)),he=n(58668),ge=n(843257),me=n(124808),ye=r(n(11339)),Se=n(364481),Ee=n(114259),ve=n(767247),Te=r(n(945017)),Ce=n(563448);function Ae(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Ae=function(e){return e?n:t})(e)}function be(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Ae(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class Pe extends Q.BaseModel{constructor(){super(...arguments),this.id=(0,Q.prop)(),this.rowId=(0,Q.prop)(),this.body=(0,Q.prop)(),this.type=(0,Q.prop)(),this.subtype=(0,Q.prop)(),this.t=(0,Q.prop)(),this.revokeTimestamp=(0,Q.prop)(),this.notifyName=(0,Q.prop)(),this.from=(0,Q.prop)(),this.to=(0,Q.prop)(),this.author=(0,Q.prop)(),this.self=(0,Q.prop)("in"),this.ack=(0,Q.prop)(),this.invis=(0,Q.prop)(),this.isNewMsg=(0,Q.prop)(),this.star=(0,Q.prop)(!1),this.kicKey=(0,Q.prop)(),this.kicState=(0,Q.prop)(),this.kicTimestamp=(0,Q.prop)(),this.kicNotified=(0,Q.prop)(!1),this.keepType=(0,Q.prop)(),this.keptMessageKey=(0,Q.prop)(),this.recvFresh=(0,Q.prop)(),this.caption=(0,Q.prop)(),this.interactiveAnnotations=(0,Q.prop)(),this.contextInfo=(0,Q.prop)(),this.clientUrl=(0,Q.prop)(),this.loc=(0,Q.prop)(),this.lat=(0,Q.prop)(),this.lng=(0,Q.prop)(),this.isLive=(0,Q.prop)(),this.accuracy=(0,Q.prop)(),this.speed=(0,Q.prop)(),this.degrees=(0,Q.prop)(),this.comment=(0,Q.prop)(),this.sequence=(0,Q.prop)(),this.shareDuration=(0,Q.prop)(),this.finalLat=(0,Q.prop)(),this.finalLng=(0,Q.prop)(),this.finalAccuracy=(0,Q.prop)(),this.finalThumbnail=(0,Q.prop)(),this.finalSpeed=(0,Q.prop)(),this.finalDegrees=(0,Q.prop)(),this.finalTimeOffset=(0,Q.prop)(),this.deprecatedMms3Url=(0,Q.prop)(),this.directPath=(0,Q.prop)(),this.mimetype=(0,Q.prop)(),this.duration=(0,Q.prop)(),this.filehash=(0,Q.prop)(),this.encFilehash=(0,Q.prop)(),this.size=(0,Q.prop)(),this.filename=(0,Q.prop)(),this.streamingSidecar=(0,Q.prop)(),this.mediaKey=(0,Q.prop)(),this.mediaKeyTimestamp=(0,Q.prop)(),this.pageCount=(0,Q.prop)(),this.isGif=(0,Q.prop)(),this.gifAttribution=(0,Q.prop)(),this.isViewOnce=(0,Q.prop)(),this.streamable=(0,Q.prop)(),this.width=(0,Q.prop)(),this.height=(0,Q.prop)(),this.thumbnailDirectPath=(0,Q.prop)(),this.thumbnailSha256=(0,Q.prop)(),this.thumbnailEncSha256=(0,Q.prop)(),this.thumbnailHeight=(0,Q.prop)(),this.thumbnailWidth=(0,Q.prop)(),this.waveform=(0,Q.prop)(),this.staticUrl=(0,Q.prop)(),this.stickerPackId=(0,Q.prop)(),this.stickerPackName=(0,Q.prop)(),this.stickerPackPublisher=(0,Q.prop)(),this.scanLengths=(0,Q.prop)(),this.scansSidecar=(0,Q.prop)(),this.isFromTemplate=(0,Q.prop)(!1),this.devicesAdded=(0,Q.prop)(),this.devicesRemoved=(0,Q.prop)(),this.isThisDeviceAdded=(0,Q.prop)(),this.firstFrameLength=(0,Q.prop)(),this.firstFrameSidecar=(0,Q.prop)(),this.isAnimated=(0,Q.prop)(),this.canonicalUrl=(0,Q.prop)(),this.matchedText=(0,Q.prop)(),this.thumbnail=(0,Q.prop)(),this.thumbnailHQ=(0,Q.prop)(),this.richPreviewType=(0,Q.prop)(),this.doNotPlayInline=(0,Q.prop)(),this.title=(0,Q.prop)(),this.description=(0,Q.prop)(),this.businessOwnerJid=(0,Q.prop)(),this.productId=(0,Q.prop)(),this.currencyCode=(0,Q.prop)(),this.priceAmount1000=(0,Q.prop)(),this.salePriceAmount1000=(0,Q.prop)(),this.retailerId=(0,Q.prop)(),this.url=(0,Q.prop)(),this.productImageCount=(0,Q.prop)(),this.sessionId=(0,Q.prop)(),this.pollName=(0,Q.prop)(),this.pollOptions=(0,Q.prop)(),this.pollSelectableOptionsCount=(0,Q.prop)(),this.pollUpdateParentKey=(0,Q.prop)(),this.encPollVote=(0,Q.prop)(),this.senderTimestampMs=(0,Q.prop)(),this.recipients=(0,Q.prop)(),this.broadcast=(0,Q.prop)(),this.quotedMsg=(0,Q.prop)(),this.quotedStanzaID=(0,Q.prop)(),this.quotedRemoteJid=(0,Q.prop)(),this.quotedParticipant=(0,Q.prop)(),this.quotedGroupSubject=(0,Q.prop)(),this.quotedParentGroupJid=(0,Q.prop)(),this.mentionedJidList=(0,Q.prop)(),this.footer=(0,Q.prop)(),this.hydratedButtons=(0,Q.prop)(),this.buttons=(0,Q.prop)(),this.selectedId=(0,Q.prop)(),this.selectedIndex=(0,Q.prop)(),this.multicast=(0,Q.prop)(),this.urlText=(0,Q.prop)(),this.urlNumber=(0,Q.prop)(),this.clearMedia=(0,Q.prop)(),this.isVcardOverMmsDocument=(0,Q.prop)(!1),this.isCaptionByUser=(0,Q.prop)(),this.vcardList=(0,Q.prop)(),this.vcardFormattedName=(0,Q.prop)(),this.revokeSender=(0,Q.prop)(),this.protocolMessageKey=(0,Q.prop)(),this.futureproofBuffer=(0,Q.prop)(),this.templateParams=(0,Q.prop)(),this.textColor=(0,Q.prop)(),this.backgroundColor=(0,Q.prop)(),this.font=(0,Q.prop)(),this.campaignId=(0,Q.prop)(),this.campaignDuration=(0,Q.prop)(),this.actionLink=(0,Q.prop)(),this.statusPSAReadTimestamp=(0,Q.prop)(),this.isForwarded=(0,Q.prop)(!1),this.forwardingScore=(0,Q.prop)(),this.labels=(0,Q.prop)(),this.hasReaction=(0,Q.prop)(!1),this.paymentCurrency=(0,Q.prop)(),this.paymentAmount1000=(0,Q.prop)(),this.paymentMessageReceiverJid=(0,Q.prop)(),this.paymentTransactionTimestamp=(0,Q.prop)(),this.paymentStatus=(0,Q.prop)(),this.paymentTxnStatus=(0,Q.prop)(),this.paymentNoteMsg=(0,Q.prop)(),this.paymentRequestMessageKey=(0,Q.prop)(),this.paymentExpiryTimestamp=(0,Q.prop)(),this.paymentInviteServiceType=(0,Q.prop)(),this.paymentBackground=(0,Q.prop)(),this.ephemeralStartTimestamp=(0,Q.prop)(),this.ephemeralDuration=(0,Q.prop)(),this.ephemeralSettingTimestamp=(0,Q.prop)(),this.ephemeralOutOfSync=(0,Q.prop)(),this.ephemeralSharedSecret=(0,Q.prop)(),this.disappearingModeInitiator=(0,Q.prop)(),this.messageSecret=(0,Q.prop)(),this.bizPrivacyStatus=(0,Q.prop)(),this.privacyModeWhenSent=(0,Q.prop)(),this.verifiedBizName=(0,Q.prop)(),this.inviteCode=(0,Q.prop)(),this.inviteCodeExp=(0,Q.prop)(),this.inviteGrp=(0,Q.prop)(),this.inviteGrpName=(0,Q.prop)(),this.inviteGrpJpegThum=(0,Q.prop)(),this.inviteGrpType=(0,Q.prop)(),this.sellerJid=(0,Q.prop)(),this.message=(0,Q.prop)(),this.orderTitle=(0,Q.prop)(),this.itemCount=(0,Q.prop)(),this.orderId=(0,Q.prop)(),this.surface=(0,Q.prop)(),this.status=(0,Q.prop)(),this.token=(0,Q.prop)(),this.totalAmount1000=(0,Q.prop)(),this.totalCurrencyCode=(0,Q.prop)(),this.historySyncMetaData=(0,Q.prop)(),this.mdDowngrade=(0,Q.prop)(),this.isSendFailure=(0,Q.prop)(),this.appStateSyncKeyShare=(0,Q.prop)(),this.appStateSyncKeyRequest=(0,Q.prop)(),this.appStateFatalExceptionNotification=(0,Q.prop)(),this.broadcastParticipants=(0,Q.prop)(),this.broadcastEphSettings=(0,Q.prop)(),this.broadcastId=(0,Q.prop)(),this.ctwaContext=(0,Q.prop)(),this.list=(0,Q.prop)(),this.listResponse=(0,Q.prop)(),this.productListItemCount=(0,Q.prop)(),this.productHeaderImageRejected=(0,Q.prop)(!1),this.agentId=(0,Q.prop)(),this.lastPlaybackProgress=(0,Q.prop)(0),this.sendDeferred=(0,Q.session)(),this.local=(0,Q.session)(),this.search=(0,Q.session)(),this.msgChunk=(0,Q.session)(),this.phoneUploading=(0,Q.session)(),this.startOfDay=(0,Q.session)(),this.startOfDaySkew=(0,Q.session)(),this._quotedMsgObj=(0,Q.session)(),this.isQuotedMsgAvailable=(0,Q.session)(!0),this.senderObj=(0,Q.session)(),this.mediaData=(0,Q.session)(),this.forwardedFromWeb=(0,Q.session)(!1),this.squelch=(0,Q.session)(),this.wamMessageSendReporter=(0,Q.session)(),this.wamMessageSendPerfReporter=(0,Q.session)(),this.pendingDeleteForMe=(0,Q.session)(!1),this.isDynamicReplyButtonsMsg=(0,Q.prop)(!1),this.dynamicReplyButtons=(0,Q.prop)(),this.replyButtons=(0,Q.prop)(),this.buttonsResponse=(0,Q.prop)(),this.selectedButtonId=(0,Q.prop)(),this.headerType=(0,Q.prop)(),this.nativeFlowName=(0,Q.prop)(),this.nativeFlowButtons=(0,Q.prop)(),this.interactiveHeader=(0,Q.prop)(),this.interactiveType=(0,Q.prop)(),this.interactivePayload=(0,Q.prop)(),this.reactionParentKey=(0,Q.prop)(),this.reactionText=(0,Q.prop)(),this.reactionTimestamp=(0,Q.prop)(),this.revokeDuration=(0,Q.session)(),this.isMdHistoryMsg=(0,Q.prop)(!1),this._links=(0,Q.session)((()=>[])),this._headerLinks=(0,Q.session)((()=>[])),this._footerLinks=(0,Q.session)((()=>[])),this.linksIndexParsed=(0,Q.session)(0),this._phoneNumbers=(0,Q.session)((()=>[])),this._headerPhoneNumbers=(0,Q.session)((()=>[])),this._footerPhoneNumbers=(0,Q.session)((()=>[])),this.phoneNumbersIndexParsed=(0,Q.session)(0),this._waitForPhoneUploadPromise=(0,Q.session)(),this.requiresDirectConnection=(0,Q.prop)(null),this.pttForwardedFeaturesEnabled=(0,Q.prop)(!1),this.chat=(0,Q.derived)((function(){return this._getChatCollection().get(this.id.remote)})),this.hasTemplateButtons=(0,Q.derived)((function(){return this.isFromTemplate&&null!=this.buttons&&this.buttons.length>0}),["buttons"]),this.ephemeralExpirationTimestamp=(0,Q.derived)((function(){const{ephemeralDuration:e,ephemeralStartTimestamp:t,t:n,subtype:r,id:{fromMe:i}}=this;return(0,ce.getEphemeralExpirationTimestamp)(e,t,n,r,i)}),["t","subtype","ephemeralStartTimestamp","ephemeralDuration"]),this.isEphemeral=(0,Q.derived)((function(){return(this.type!==L.MSG_TYPE.PROTOCOL||"ephemeral_setting"!==this.subtype)&&(null!=this.ephemeralDuration&&0!==this.ephemeralDuration)}),["ephemeralDuration","type","subtype"]),this.isRevoke=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.PROTOCOL&&["sender_revoke","admin_revoke"].includes(this.subtype)}),["type","subtype"]),this.isQuickReply=(0,Q.derived)((function(){if(!this.hasTemplateButtons)return!1;if(null==this.buttons)return!1;const e=this.buttons.at(0);return null!=e&&e.subtype===x.TEMPLATE_BUTTON_SUBTYPE.QUICK_REPLY}),["buttons"]),this.isKept=(0,Q.derived)((function(){return this.kicState===se.KeepInChatState.KEPT}),["kicState"]),this.isUnkept=(0,Q.derived)((function(){return this.kicState===se.KeepInChatState.UNKEPT}),["kicState"]),this.isFutureproof=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.UNKNOWN||this.type===L.MSG_TYPE.PAYMENT&&"futureproof"===this.subtype}),["type","subtype"]),this.isGroupMsg=(0,Q.derived)((function(){return(0,P.isGroupMsg)(this)})),this.isStickerMsg=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.STICKER})),this.isCommerceMsg=(0,Q.derived)((function(){var e;const t=new Set([L.MSG_TYPE.PRODUCT,L.MSG_TYPE.ORDER,L.MSG_TYPE.LIST]);return t.has(this.type)||t.has(null===(e=this.quotedMsg)||void 0===e?void 0:e.type)||!(!this.matchedText||!F.default.isCommerceDeepLink(this.matchedText))||this.type===L.MSG_TYPE.NATIVE_FLOW&&(this.nativeFlowName===$.default.ORDER_DETAILS||this.nativeFlowName===$.default.ORDER_STATUS)})),this.isStatusV3=(0,Q.derived)((function(){return(0,P.isStatusV3)(this)})),this.isPSA=(0,Q.derived)((function(){return K.default.isPSA(this.id.remote)})),this.isProductListMessage=(0,Q.derived)((function(){var e;return this.type===L.MSG_TYPE.LIST&&(null===(e=this.list)||void 0===e?void 0:e.listType)===me.Message$ListMessage$ListType.PRODUCT_LIST})),this.isRTL=(0,Q.derived)((function(){return"rtl"===this.dir||void 0===this.dir&&de.default.isRTL()}),["dir"]),this.asProductInquiry=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.PRODUCT&&e.id&&e.id.id.startsWith(v.PRODUCT_INQUIRY_TYPE)?e:null})),this.statusV3TextBg=(0,Q.derived)((function(){if(!this.isStatusV3)return null;const e=this.backgroundColor;return e?`rgba(${e>>16&255}, ${e>>8&255}, ${255&e}, ${e>>24&255})`:null})),this.isSentByMe=(0,Q.derived)((function(){return(0,P.isSentByMe)(this)})),this.isSentByMeFromWeb=(0,Q.derived)((function(){return this.id.fromMe&&this.local&&this.isUserCreatedType}),["isUserCreatedType"]),this.isRevokedByMe=(0,Q.derived)((function(){return null!=this.revokeSender&&(0,j.isMeAccount)(this.revokeSender)})),this.isInternational=(0,Q.derived)((function(){var e;const t=this.id.fromMe?this.to.toString({legacy:!0}):this.from.toString({legacy:!0}),n=null===(e=(0,j.getMaybeMeUser)())||void 0===e?void 0:e.toString({legacy:!0});return t&&n?(0,p.phoneCC)(t)!==(0,p.phoneCC)(n):(__LOG__(3)`Msg: could not derive isInternational as some data is missing`,!1)})),this.isNotification=(0,Q.derived)((function(){return(0,P.isNotificationType)(this.type,this.subtype)}),["type","subtype"]),this.asGroupNotification=(0,Q.derived)((function(){const e=this.safe();switch(e.type){case L.MSG_TYPE.GROUP_NOTIFICATION:case L.MSG_TYPE.GP2:return e;default:return null}}),["type"]),this.asBroadcastNotification=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.BROADCAST_NOTIFICATION?e:null}),["type"]),this.isBizNotification=(0,Q.derived)((function(){if(this.type===L.MSG_TYPE.NOTIFICATION_TEMPLATE){if(v.BIZ_SYSTEM_MSG_SUBTYPES.includes(this.subtype))return!0;if(v.BIZ_SYSTEM_MSG_SUBTYPES_V2.includes(this.subtype))return!0;switch(this.subtype){case"verified_initial_unknown":case"verified_initial_low":case"verified_initial_high":case"verified_transition_any_to_none":case"verified_transition_any_to_high":case"verified_transition_high_to_low":case"verified_transition_high_to_unknown":case"verified_transition_unknown_to_low":case"verified_transition_low_to_unknown":case"verified_transition_none_to_low":case"verified_transition_none_to_unknown":case"biz_verified_transition_top_to_bottom":case"biz_verified_transition_bottom_to_top":case"biz_intro_top":case"biz_intro_bottom":case"biz_name_change":case"biz_move_to_consumer_app":case"biz_two_tier_migration_top":case"biz_two_tier_migration_bottom":return!0;default:return!1}}return!1}),["type","subtype"]),this.asProduct=(0,Q.derived)((function(){const e=this.safe();return"product"===e.type?e:null}),["type"]),this.asAlbumAsset=(0,Q.derived)((function(){const e=this.safe();return e.type!==L.MSG_TYPE.IMAGE&&(e.type!==L.MSG_TYPE.VIDEO||!0===e.isGif)||e.isNotification||e.caption||e.asRevoked||e.quotedMsg||e.ctwaContext||e.isViewOnce?null:e}),["type","isNotification","caption","isForwarded","asRevoked","isGif","quotedMsg","ctwaContext","isViewOnce"]),this.asAutoDownloadableMedia=(0,Q.derived)((function(){const e=this.safe();switch(e.type){case L.MSG_TYPE.IMAGE:case L.MSG_TYPE.STICKER:case L.MSG_TYPE.AUDIO:case L.MSG_TYPE.PTT:case L.MSG_TYPE.VIDEO:case L.MSG_TYPE.DOCUMENT:return e}return(0,X.typeIsUrl)(e)?e:null}),["type"]),this.asGroupedSticker=(0,Q.derived)((function(){const e=this.safe();return e.type!==L.MSG_TYPE.STICKER||e.isNotification||e.asRevoked||e.quotedMsg||e.ctwaContext?null:e}),["type","isNotification","asRevoked","quotedMsg","ctwaContext"]),this.isMedia=(0,Q.derived)((function(){return["image","video","audio"].includes(this.type)}),["type"]),this.asDoc=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.DOCUMENT?e:null}),["type"]),this.asImage=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.IMAGE?e:null}),["type"]),this.asVideo=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.VIDEO?e:null}),["type"]),this.asAudio=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.AUDIO?e:null}),["type"]),this.asPtt=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.PTT?e:null}),["type"]),this.asPollCreation=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.POLL_CREATION?e:null}),["type"]),this.asPollUpdate=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.POLL_UPDATE?e:null}),["type"]),this.asRequestPhoneNumber=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.REQUEST_PHONE_NUMBER?e:null}),["type"]),this.asMms=(0,Q.derived)((function(){const e=this.safe();return(0,X.typeIsMms)(e)?e:null}),["type"]),this.asUrl=(0,Q.derived)((function(){const e=this.safe();return(0,X.typeIsUrl)(e)?e:null}),["type","subtype"]),this.asRevoked=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.REVOKED?e:null}),["type"]),this.asViewOnce=(0,Q.derived)((function(){const e=this.asVisualMedia;return(null==e?void 0:e.isViewOnce)?e:null}),["type","isViewOnce"]),this.asVisualMedia=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.IMAGE||e.type===L.MSG_TYPE.VIDEO?e:null}),["type"]),this.numTimesForwarded=(0,Q.derived)((function(){return this.forwardingScore?this.forwardingScore||0:this.isForwarded?1:0}),["isForwarded","forwardingScore"]),this.isFrequentlyForwarded=(0,Q.derived)((function(){return this.numTimesForwarded>=O.default.FREQUENTLY_FORWARDED_SENTINEL}),["numTimesForwarded"]),this.eventType=(0,Q.derived)((function(){if(!this.isNewMsg)return"i";const e=(0,P.eventTypeFromMsgType)(this);return this.invis?"i"===e?"i":"n":e}),["type","invis","isNewMsg"]),this.sender=(0,Q.derived)((function(){return(0,P.getSender)(this)})),this.text=(0,Q.derived)((function(){var e;if(this.isFromTemplate||this.isDynamicReplyButtonsMsg)return this.type===L.MSG_TYPE.CHAT?this.body:this.caption;switch(this.type){case L.MSG_TYPE.CHAT:case L.MSG_TYPE.INTERACTIVE_RESPONSE:return this.body;case L.MSG_TYPE.IMAGE:case L.MSG_TYPE.VIDEO:case L.MSG_TYPE.DOCUMENT:return this.caption;case L.MSG_TYPE.LOCATION:return this.isLive?this.comment:void 0;case L.MSG_TYPE.PAYMENT:const{paymentNoteMsg:t}=this;return t?t.body:void 0;case L.MSG_TYPE.GROUPS_V4_INVITE:return this.comment;case L.MSG_TYPE.LIST:return null===(e=this.list)||void 0===e?void 0:e.description;case L.MSG_TYPE.PRODUCT:return(0,c.default)(this.title,{length:Se.MAX_REPLY_PRODUCT_TITLE_LENGTH});case L.MSG_TYPE.HSM:case L.MSG_TYPE.TEMPLATE_BUTTON_REPLY:return this.body;case L.MSG_TYPE.INTERACTIVE:return null!=this.nativeFlowName?(0,Ce.formatNFMText)(this):this.caption;case L.MSG_TYPE.NATIVE_FLOW:return(0,Ce.formatNFMText)(this);default:return}}),["type","body","caption","comment","isLive","paymentNoteMsg","subtype"]),this.containsEmoji=(0,Q.derived)((function(){const{text:e}=this;return!!e&&ve.EmojiUtil.containsEmoji(e)}),["text"]),this.isFailed=(0,Q.derived)((function(){const e=this.isSentByMe&&this.ack<y.ACK.CLOCK;return(0,S.isMDBackend)()?e||!!this.mdDowngrade||!!this.isSendFailure:e}),["isSentByMe","ack","mdDowngrade","isSendFailure"]),this.vcard=(0,Q.derived)((function(){if(this.type===L.MSG_TYPE.VCARD)try{return(0,Y.parseVcard)(this.body)}catch(e){return}}),["type","body"]),this.isUnsentMedia=(0,Q.derived)((function(){return this.ack<y.ACK.SENT&&null!=this.asMms&&this.isSentByMe}),["ack","asMms","isSentByMe"]),this.dir=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.VCARD?this.subtype?u.dir(this.subtype):void 0:this.text?u.dir(this.text):void 0}),["type","text","subtype"]),this.rtl=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.VCARD?!!this.subtype&&"rtl"===u.dir(this.subtype):!!this.text&&"rtl"===u.dir(this.text)}),["type","text","subtype"]),this.linkPreview=(0,Q.derived)((function(){return(0,h.isString)(this.matchedText)&&(!(0,l.default)(this.title)||!(0,l.default)(this.description))&&this.body.includes(this.matchedText)}),["matchedText","body","title","description"]),this.isGroupsV4InviteExpired=(0,Q.derived)((function(){if(this.type!==L.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(!this.inviteCode)return!0;const e=(new Date).getTime()/1e3;return parseInt(e,10)>=parseInt(this.inviteCodeExp,10)}),["type","inviteCode","inviteCodeExp"]),this.isUnreadType=(0,Q.derived)((function(){return(0,P.isUnreadTypeMsg)(this)}),["type"]),this.isUserCreatedType=(0,Q.derived)((function(){switch(this.type){case"protocol":case"chat":case"location":case"vcard":case"multi_vcard":case"image":case"video":case"audio":case"ptt":case"document":case"sticker":case"product":case"groups_v4_invite":case"order":case"poll_creation":return!0;case"biz-cover-photo":case"broadcast_notification":case"buttons_response":case"call_log":case"ciphertext":case"debug":case"e2e_notification":case"gp2":case"group_notification":case"hsm":case"interactive":case"interactive_response":case"keep_in_chat":case"list":case"list_response":case"native_flow":case"notification":case"notification_template":case"oversized":case"payment":case"poll_update":case"reaction":case"request_phone_number":case"revoked":case"template_button_reply":case"unknown":return!1;default:return this.type,!1}}),["type"]),this.supportsMessageFooter=(0,Q.derived)((function(){return this.isFromTemplate||this.isDynamicReplyButtonsMsg}),["isDynamicReplyButtonsMsg","isFromTemplate"]),this.supportsMessageFooterLinks=(0,Q.derived)((function(){return this.isDynamicReplyButtonsMsg||this.type===L.MSG_TYPE.LIST||this.type===L.MSG_TYPE.INTERACTIVE}),["type","isDynamicReplyButtonsMsg"]),this.hasBodyOrFooter=(0,Q.derived)((function(){return null!=this.text||null!=this.footer}),["text","footer"]),this.initialPageSize=(0,Q.derived)((function(){return this.isFrequentlyForwarded?308:768}),["isFrequentlyForwarded"]),this.productListHeaderImage=(0,Q.derived)((function(){var e,t,n,r;return!0===this.productHeaderImageRejected?null:null!==(e=null===(t=this.list)||void 0===t||null===(n=t.productListInfo)||void 0===n||null===(r=n.headerImage)||void 0===r?void 0:r.jpegThumbnail)&&void 0!==e?e:null}),["productHeaderImageRejected","list"]),this.isInitialE2ENotification=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===this.subtype||v.BIZ_SYSTEM_MSG_SUBTYPES_V2_INIT.includes(this.subtype)}),["type","subtype"]),this.isDisappearingModeSystemMessage=(0,Q.derived)((function(){return this.type===L.MSG_TYPE.NOTIFICATION_TEMPLATE&&"disappearing_mode"===this.subtype}),["type","subtype"]),this.asPttLike=(0,Q.derived)((function(){const e=this.safe();return e.type===L.MSG_TYPE.PTT||e.pttForwardedFeaturesEnabled&&e.type===L.MSG_TYPE.AUDIO&&(0,ge.isOpus)(e.mimetype)&&null!=e.waveform?e:null}),["type","mimetype","pttForwardedFeaturesEnabled","waveform"]),this.kicSender=(0,Q.derived)((function(){if(null!=this.kicKey){if(this.kicKey.fromMe)return(0,j.getMaybeMeUser)();if(this.isGroupMsg&&null!=this.kicKey.participant)return(0,W.toUserWid)(this.kicKey.participant);if(!this.isGroupMsg)return(0,W.toUserWid)(this.kicKey.remote)}}),["kicKey","isGroupMsg"]),this._saveLastPlaybackProgress=(0,a.default)(((e,t)=>{(0,oe.updateLocal)(e,{lastPlaybackProgress:t})}),500)}initialize(){if(super.initialize(),this.pttForwardedFeaturesEnabled=ne.ServerProps.pttForwardedFeaturesEnabled,this._pendingAckUpdate=new f.PromiseQueue,this.sender)this.addChild("senderObj",J.ContactCollection.gadd(this.sender));else switch(this.type){case L.MSG_TYPE.NOTIFICATION:case L.MSG_TYPE.NOTIFICATION_TEMPLATE:case L.MSG_TYPE.GROUP_NOTIFICATION:case L.MSG_TYPE.GP2:case L.MSG_TYPE.BROADCAST_NOTIFICATION:case L.MSG_TYPE.E2E_NOTIFICATION:case L.MSG_TYPE.CALL_LOG:case L.MSG_TYPE.PROTOCOL:break;default:__LOG__(2)`msg:msg with no sender id:${this.id.toString()}, from:${this.from.toString()}, author:${this.author&&this.author.toString()}, type:${this.type}`}let e;this.mentionedJidList=this.mentionedJidList||[],this.mentionedJidList.forEach((e=>J.ContactCollection.gadd(e)));const t=this.getCollection();(e=t.preAck[this.id])&&(__LOG__(2)`Msg:initialize updating msg with out of order ack`,this.updateAck(e.ack,e.t),delete t.preAck[this.id]),this.type===L.MSG_TYPE.CIPHERTEXT&&this.listenToOnce(this,"change:type",this._handleCiphertextDecrypted),this.mediaObject=void 0,X.typeIsMms(this)&&(this._createMediaDataChild(),this.isViewOnce&&!(0,te.isUnviewed)(this.safe())||fe.registerMsg(this)),this.isSentByMeFromWeb&&(this.sendDeferred=new _.Resolvable,this.sendDeferred.promise.finally((()=>{this.sendDeferred=null}))),this.isLive&&n(985865).LiveLocationCollection.processMsg(this,!1),q.Conn.isSMB&&(0,E.initializeLabels)(this),this.isViewOnce&&(this.listenTo(this,"change:ack",this._handleViewOnceMediaStatusChanged),this.listenTo(this.mediaData,"change:mediaStage",this._handleViewOnceMediaStatusChanged))}_getLinks(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const n=(0,g.firstNCodepoints)(e,t);let r=w.findLinks(n,false,this.sender);if((0,g.numCodepoints)(e)>t&&r.length>0){const i=r[r.length-1];(0,g.numCodepoints)(n.slice(0,i.index))+(0,g.numCodepoints)(i.url)===t&&(r=w.findLinks(e,false,this.sender))}return[r,t]}_getPhoneNumbers(e){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)>=t)return[arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t];const n=(0,g.firstNCodepoints)(e,t);let r=(0,Te.default)(n);if((0,g.numCodepoints)(e)>t&&r.length>0){const i=r[r.length-1];(0,g.numCodepoints)(n.slice(0,i.index))+(0,g.numCodepoints)(i.phone)===t&&(r=(0,Te.default)(e))}return[r,t]}getLinks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;const{text:t}=this;if(null==t)return this._links;const[n,r]=this._getLinks(t,this._links,this.linksIndexParsed,e);return this.linksIndexParsed=r,this._links=n}_displayHeaderLinksForListMessages(){var e,t;return"list"===this.type&&(null===(e=this.list)||void 0===e?void 0:e.listType)===me.Message$ListMessage$ListType.SINGLE_SELECT&&null!=(null===(t=this.list)||void 0===t?void 0:t.title)}_displayHeaderLinksForNonListMessages(){return!0===this.isDynamicReplyButtonsMsg&&null!=this.title}_getHeaderLinks(e){if(this._headerLinks.length>0)return this._headerLinks;const[t]=this._getLinks(e,this._headerLinks);return this._headerLinks=t}getHeaderLinks(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderLinks((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderLinks(this.title):this.type===L.MSG_TYPE.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderLinks(this.interactiveHeader.title):[]}getFooterLinks(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerLinks.length>0)return this._footerLinks;const[e]=this._getLinks(this.footer,this._footerLinks);return this._footerLinks=e}getGalleryLinks(){return(0,s.default)(this.getLinks(),"href").filter((e=>e.isHttp))}getSuspiciousLinks(){return this.getLinks().filter((e=>{var t;return null===(t=e.suspiciousCharacters)||void 0===t?void 0:t.size}))}getPhoneNumbers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPageSize+1;const{text:t}=this;if(null==t)return this._phoneNumbers;const[n,r]=this._getPhoneNumbers(t,this._phoneNumbers,this.phoneNumbersIndexParsed,e);return this.phoneNumbersIndexParsed=r,this._phoneNumbers=n}_getHeaderPhoneNumbers(e){if(this._headerPhoneNumbers.length>0)return this._headerPhoneNumbers;const[t]=this._getPhoneNumbers(e,this._headerPhoneNumbers);return this._headerPhoneNumbers=t}getHeaderPhoneNumbers(){var e,t;return this._displayHeaderLinksForListMessages()?this._getHeaderPhoneNumbers((null===(t=this.list)||void 0===t?void 0:t.title)||""):this._displayHeaderLinksForNonListMessages()?this._getHeaderPhoneNumbers(this.title):this.type===L.MSG_TYPE.INTERACTIVE&&null!=(null===(e=this.interactiveHeader)||void 0===e?void 0:e.title)?this._getHeaderPhoneNumbers(this.interactiveHeader.title):[]}getFooterPhoneNumbers(){if(!this.supportsMessageFooterLinks||null==this.footer)return[];if(this._footerPhoneNumbers.length>0)return this._footerPhoneNumbers;const[e]=this._getPhoneNumbers(this.footer,this._footerPhoneNumbers);return this._footerPhoneNumbers=e}_createMediaDataChild(){this.addChild("mediaData",new _e.default)}hasSymbol(){return this.type===L.MSG_TYPE.INTERACTIVE?this.interactiveType===V.default.SHOPS_STOREFRONT||this.interactiveType===V.default.NATIVE_FLOW&&this.nativeFlowName===$.default.ORDER_DETAILS:this.type===L.MSG_TYPE.NATIVE_FLOW?this.nativeFlowName===$.default.ORDER_DETAILS:["image","video","audio","ptt","location","vcard","multi_vcard","document","ciphertext","oversized","unknown","call_log","revoked","sticker","payment","poll_creation","groups_v4_invite","product","order"].includes(this.type)}mayFail(){return this.isSentByMe&&this.ack<y.ACK.SENT}isReply(){return Boolean(this.quotedMsg)}isStatusReply(){var e;return!!(null===(e=this.quotedMsgObj())||void 0===e?void 0:e.isStatusV3)}isUnsentPhoneMsg(){return!this.local&&this.isSentByMe&&this.ack<y.ACK.SENT}replyChecks(){return!this.mayFail()&&!this.isNotification&&!(0,C.isSuspendedGroup)(this.chat)&&!(0,C.isTerminatedGroup)(this.chat)&&this.type!==L.MSG_TYPE.UNKNOWN&&this.type!==L.MSG_TYPE.CIPHERTEXT&&this.type!==L.MSG_TYPE.OVERSIZED&&this.type!==L.MSG_TYPE.REVOKED&&this.interactiveButtonsReleased()}canReply(){return!(this.type===L.MSG_TYPE.LIST&&!(0,X.listMsgCanRender)(this))&&(this.chat.canSend&&this.replyChecks())}canPrivateReply(){return!this.mayFail()&&!this.isNotification&&this.type!==L.MSG_TYPE.UNKNOWN&&this.type!==L.MSG_TYPE.CIPHERTEXT&&this.type!==L.MSG_TYPE.OVERSIZED&&this.type!==L.MSG_TYPE.REVOKED&&!this.isSentByMe&&this.isGroupMsg&&this.interactiveButtonsReleased()}canPrivateReplyInRestrictedGrp(){return!!this.chat.isAnnounceGrpRestrict&&!this.chat.isReadOnly&&!this.mayFail()&&!this.isSentByMe&&!this.isNotification&&this.type!==L.MSG_TYPE.UNKNOWN&&this.type!==L.MSG_TYPE.CIPHERTEXT&&this.type!==L.MSG_TYPE.OVERSIZED&&this.type!==L.MSG_TYPE.REVOKED&&this.interactiveButtonsReleased()}canForward(){var e,t;if(this.type===L.MSG_TYPE.CIPHERTEXT)return!1;if(this.type===L.MSG_TYPE.OVERSIZED)return!1;if(this.type===L.MSG_TYPE.REVOKED)return!1;if(this.type===L.MSG_TYPE.UNKNOWN)return!1;if(this.type===L.MSG_TYPE.PAYMENT)return!1;if(this.type===L.MSG_TYPE.POLL_CREATION)return!1;if(this.type===L.MSG_TYPE.LIST)return(null===(e=this.list)||void 0===e?void 0:e.listType)===me.Message$ListMessage$ListType.PRODUCT_LIST&&(0,X.listMsgCanRender)(this);if(this.type===L.MSG_TYPE.GROUPS_V4_INVITE)return!1;if(this.type===L.MSG_TYPE.LOCATION&&this.isLive)return!1;if(this.type===L.MSG_TYPE.ORDER)return!1;if(this.type===L.MSG_TYPE.INTERACTIVE&&null!=this.nativeFlowName)return!1;if(!this.interactiveButtonsReleased())return!1;if(this.ack<y.ACK.SENT&&this.isSentByMe)return!1;if(this.asMms){const e=this.mediaData;if(e.mediaStage===he.MEDIA_DATA_STAGE.EXISTS)return!0;if(e.mediaStage===he.MEDIA_DATA_STAGE.ERROR_MISSING)return!1;if(e.mediaStage===he.MEDIA_DATA_STAGE.ERROR_UNSUPPORTED)return!1;if(e.mediaStage!==he.MEDIA_DATA_STAGE.RESOLVED&&(this.type===L.MSG_TYPE.IMAGE||this.type===L.MSG_TYPE.VIDEO||this.type===L.MSG_TYPE.PTT))return!1;if(this.isViewOnce)return!1;if(this.isUnsentMedia)return!1}return!(null===(t=this.nativeFlowButtons)||void 0===t?void 0:t.length)}canQuickForward(){return!(!this.canForward()||this.isFrequentlyForwarded||0!==this.getSuspiciousLinks().length||null!=this.asPttLike||this.type===L.MSG_TYPE.STICKER||!this.interactiveButtonsReleased())&&(null!=this.asMms||this.linkPreview||this.type===L.MSG_TYPE.VCARD||this.type===L.MSG_TYPE.LOCATION||null!=this.ctwaContext)}canStar(){return!(this.type===L.MSG_TYPE.LIST&&!(0,X.listMsgCanRender)(this))&&((!this.isEphemeral||this.supportsStarWithKeepInChat())&&!this.isNotification&&!this.isFutureproof&&!this.isViewOnce&&this.type!==L.MSG_TYPE.REVOKED&&!(this.ack<y.ACK.SENT&&this.isSentByMe)&&this.interactiveButtonsReleased())}supportsStarWithKeepInChat(){return!!(0,ue.isKeepInChatFullyDisabled)()||this.isEphemeral&&((0,ue.isKeepInChatReadOnlyEnabled)()||(0,ue.isKICFullyEnabled)()&&this.star)}canReport(){return!this.isSentByMe&&G.SPAM_REPORT_SUPPORTED_MESSAGE_TYPES.has(this.type)}interactiveButtonsReleased(){return this.isFromTemplate||!this.hasTemplateButtons&&this.type!==L.MSG_TYPE.TEMPLATE_BUTTON_REPLY}isGroupLeave(){return"gp2"===this.type&&("leave"===this.subtype||"remove"===this.subtype)&&(0,j.isMeAccount)(this.recipients[0])}isTrusted(){var e;return!!(0,j.isMeAccount)(this.sender)||(!!(null===(e=this.senderObj)||void 0===e?void 0:e.isMyContact)||(this.isGroupMsg?this.chat.isTrusted():!!this.isPSA||this.chat.notSpam))}getVcardWids(){return this.type!==L.MSG_TYPE.VCARD?null:(0,Y.vcardWids)(this.vcard)}getLocObject(){const e=this.loc;if(e){const[t,n=null]=e.split("\n");return{name:t,addr:n}}return null}resumeRemoteUpload(){return this.isUnsentPhoneMsg()&&!this.phoneUploading&&((0,k.sendMsgRecord)(this).then((e=>{e!==U.SendMsgResult.OK&&(this.phoneUploading=!1)})),this.phoneUploading=!0),this.forceDownloadMediaEvenIfExpensive()}forceRMR(){return Promise.reject(new Error("unimplemented forceRMR"))}isForcingRMR(){return!1}cancelDownload(){fe.cancelDownloadMsg(this)}resumeUpload(){return this.mediaData.mediaStage!==he.MEDIA_DATA_STAGE.NEED_UPLOAD&&(__LOG__(4,void 0,new Error,!0)`resumeUpload called while state was ${this.mediaData.mediaStage}`,SEND_LOGS("resume-non-need-upload")),fe.resumeUploadMsg(this)}cancelUpload(){fe.cancelUploadMsg(this)}waitForPhoneUpload(){var e=this;return(0,i.default)((function*(){Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()||(e._waitForPhoneUploadPromise||(e._waitForPhoneUploadPromise=(0,I.default)(e.mediaData,"change:mediaStage change:filehash",(()=>Boolean(e.mediaData.filehash)&&!e.isUnsentPhoneMsg()))),yield e._waitForPhoneUploadPromise,e._waitForPhoneUploadPromise=null)}))()}forceDownloadMediaEvenIfExpensive(){return this.downloadMedia({downloadEvenIfExpensive:!0,rmrReason:ye.default.WEBC_RMR_REASON_CODE.MSG_CLICK,isUserInitiated:!0})}downloadMedia(e){if(this.asRevoked)return Promise.resolve();const{downloadEvenIfExpensive:t,rmrReason:n,isUserInitiated:r,isAutoDownload:i}=e;if(!r&&!this.isTrusted())return Promise.resolve();if(this.asMms||(__LOG__(4,void 0,new Error,!0)`id: ${this.id.toString()} type: ${this.type}`,SEND_LOGS("media-fault: downloadMedia msg is not mms type")),this.isUnsentPhoneMsg()){let t=this._waitForPhoneUploadPromise;return t||(t=this._waitForPhoneUploadPromise=(0,I.default)(this.mediaData,"change:mediaStage change:filehash",(()=>!!this.mediaData.filehash&&!this.isUnsentPhoneMsg())).then((()=>{this._waitForPhoneUploadPromise=null}))),t.then((()=>this.downloadMedia(e)))}return fe.downloadMsg({msg:this,isUserClick:n===ye.default.WEBC_RMR_REASON_CODE.MSG_CLICK,downloadEvenIfExpensive:t,rmrReason:n,rmrData:this._getRmrData(n),mode:r?"manual":"auto",isAutoDownload:i})}_getRmrData(e){const t={webcRmrReason:e,webcMessageT:this.t},n=this.chat;if(n){t.webcChatType=n.getWebcChatType(),null!=n.initialIndex&&(t.webcChatPosition=n.initialIndex);const{msgChunk:e}=this;e&&e===n.msgs&&(t.webcMessageIndex=e.length-e.indexOf(this)-1)}return t}applyUpdate(e){if(e.type&&this.type!==e.type&&X.typeIsMms(e))return this.type!==L.MSG_TYPE.CIPHERTEXT&&(__LOG__(4,void 0,new Error,!0)`updated ${this.id.toString()} from ${this.type} to ${String(e.type)}`,SEND_LOGS("invalid-type-update")),this._createMediaDataChild(),fe.registerMsgEarly(this,e),fe.prepareMsg(this).then((()=>{this.set(e)})).catch((e=>{__LOG__(4,void 0,new Error,!0)`error = ${String(e)}`,SEND_LOGS("preregister-error")}));if(this.set(e),this.isLive&&n(985865).LiveLocationCollection.processMsg(this,!0),this.paymentTransactionTimestamp){this.getCollection().updateLastTransactionTime(this.id.remote,this.paymentTransactionTimestamp)}return Promise.resolve()}waitForPrep(){var e=this;return(0,i.default)((function*(){var t;const n=null==e.requiresDirectConnection?(0,M.genDirectConnectionMessageModifiers)(e.type,null===(t=e.list)||void 0===t?void 0:t.listType,e.businessOwnerJid).then((t=>e.set(t))):Promise.resolve(),r=X.typeIsMms(e)?fe.prepareMsg(e):Promise.resolve();return yield n,r}))()}delete(e){super.delete();n(719011).AllStarredMsgsCollection.remove(this),this.isLive&&n(985865).LiveLocationCollection.removeMsg(this);this.getCollection().remove(this.id),this.msgChunk&&this.msgChunk.remove(this.id,{},Boolean(null==e?void 0:e.skipUpdatingSortTime)),X.typeIsMms(this)&&fe.deregisterMsg(this),n(316770).LabelCollection.removeAllLabelsMD(this);const t=this._getChatCollection().get(this.id.remote);if(t){t.unreadMsgAnchor===this&&(t.unreadMsgAnchor=void 0);if((!e||!e.doNotResetLastReceived)&&t.lastReceivedKey===this.id){let e;const n=(0,T.getLastReceivedMsg)(t);n&&(e=n.id),(0,ae.setLastReceivedKey)(t.id,e).then((()=>{t.lastReceivedKey=e}))}t.composeQuotedMsg===this&&(t.composeQuotedMsg=null)}}isLastMessage(){const e=this.chat.msgs.last();return this.id.equals(null==e?void 0:e.id)}quotedMsgObj(){if(!this.quotedMsg&&!this.paymentRequestMessageKey)return null;if(this._quotedMsgObj){const e=this.getCollection();return X.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}if(this.quotedMsg)this._quotedMsgObj=this._getQuotedMsgObj();else{if(!this.paymentRequestMessageKey)return null;this._quotedMsgObj=this._getQuotedPaymentRequestMsg()}const e=this.getCollection();return X.getOriginalQuotedMsgIfPossible(this._quotedMsgObj,e)}_getQuotedMsgObj(){const e=(0,j.getMaybeMeUser)(),t=(0,d.default)(this.quotedParticipant,"this.quotedParticipant"),n=(0,j.isMeAccount)(t),r=n?"out":"in",i=this.quotedRemoteJid?this.quotedRemoteJid:this.id.remote,a={id:this.quotedStanzaID,from:n?e:i,to:n?i:e,self:r,author:t,remote:i};return!(K.default.isGroup(a.from)||K.default.isGroup(a.to))&&!K.default.isStatusV3(i)||(0,j.isMeAccount)(t)&&!(0,S.isMDBackend)()||(a.participant=(0,d.default)(this.quotedParticipant,"this.quotedParticipant")),Object.assign(a,this.quotedMsg),X.createQuotedMsg(a)}_getQuotedPaymentRequestMsg(){if(!this.paymentRequestMessageKey)return null;const e=this.paymentRequestMessageKey.remote?this.paymentRequestMessageKey.remote:this.id.remote,t=this.paymentRequestMessageKey.fromMe,n=null!=this.paymentRequestMessageKey.self?this.paymentRequestMessageKey.self:t?"out":"in",r=this.paymentRequestMessageKey.participant||this.paymentMessageReceiverJid,i={id:this.paymentRequestMessageKey.id,from:t?(0,j.getMaybeMeUser)():e,to:t?e:(0,j.getMaybeMeUser)(),self:n,participant:r,author:r,remote:e,amount1000:this.paymentAmount1000,currency:this.paymentCurrency,receiverJid:this.sender,type:this.type,subtype:"request"};return X.createQuotedMsg(i)}getQuotedMsgAdminGroupJid(){return null==this.quotedMsg?this.quotedRemoteJid:null}getQuotedMsgAdminGroupSubject(){return null==this.quotedMsg?this.quotedGroupSubject:null}getQuotedMsgAdminParentGroupJid(){return null==this.quotedMsg?this.quotedParentGroupJid:null}msgContextInfo(e){const t=(0,o.default)(this.toJSON(),["id","t","notifyName","from","to","author","self","ack","invis","isNewMsg","star","recvFresh","recipients","broadcast","quotedMsg","quotedStanzaID","quotedRemoteJid","quotedParticipant","senderObj","multicast","replyButtons","buttons"]);let n=null;return e&&!this.id.remote.equals(e)&&(n=this.id.remote),{quotedMsg:t,quotedParticipant:this.sender,quotedStanzaID:this.id.id,quotedRemoteJid:n}}displayName(e,t){if(!this.sender)return"";if((0,j.isMeAccount)(this.sender))return de.default.t(859);const n=this.senderObj,r=e?n.shortName:void 0;if(r)return r;if(n.name)return n.name;const i=t&&this.notifyName?" ~"+this.notifyName:"";return(this.sender.isLid()?n.displayNameOrPnForLid:(0,H.widToFormattedUser)(this.sender))+i}isQuoted(e){const t=this.quotedMsgObj();return!!t&&t.sender.equals(e)}isMentioned(e){return!!this.mentionedJidList&&this.mentionedJidList.findIndex((t=>t.equals(e)))>-1}mentionMap(){if(!this.mentionedJidList)return null;if(!this.mentionedJidList.length)return null;const e={};return this.mentionedJidList.forEach((t=>{e[`@${K.default.user(t)||""}`]=J.ContactCollection.gadd(t)})),e}updateAck(e,t){const n=this.ack;(0,S.isMDBackend)()&&!this.isStatusV3&&this.chat.isGroup&&this.isMdHistoryMsg&&e>=y.ACK.RECEIVED&&this.id.fromMe||((0,h.isNumber)(e)&&(void 0===n||e>n||e===y.ACK.FAILED)?(this.ack=e,e>=1&&null!=t&&null==this.ephemeralStartTimestamp&&this.updateEphemeralStartTimestamp(t),"ephemeral_setting"===this.subtype&&1===e&&null!=t&&(0,B.default)(this.chat,t),this._pendingAckUpdate.enqueue((()=>(0,oe.updateLocal)(this.id,{ack:e})))):e===y.ACK.FAILED&&this.ack===y.ACK.CLOCK&&(this.ack=y.ACK.FAILED,this.phoneUploading=!1,this._pendingAckUpdate.enqueue((()=>(0,oe.updateLocal)(this.id,{ack:e})))))}updateLastPlaybackProgress(e){this.lastPlaybackProgress=e,this._saveLastPlaybackProgress(this.id,e)}avParams(){return fe.mediaMetadata(this)}resend(){var e=this;if(this.isFailed){const t={ack:y.ACK.CLOCK};return(0,S.isMDBackend)()&&(t.isSendFailure=!1,t.mdDowngrade=!1),this._pendingAckUpdate.enqueue((0,i.default)((function*(){yield(0,oe.updateLocal)(e.id,t),e.set(t)}))),this.asMms?this.isSentByMeFromWeb?this.resumeUpload():this.resumeRemoteUpload():(0,k.sendMsgRecord)(this)}return Promise.resolve()}_handleCiphertextDecrypted(){if(this.isStatusV3)return;const e=this.chat,t=e.msgs.length,n=e.msgs.indexOf(this);-1!==n&&t-n<=10&&b.Cmd.alertNewMsg(this)}_handleViewOnceMediaStatusChanged(){if(!this.isViewOnce)return;if(null==this.mediaData)return;const e=this.isSentByMe&&this.ack>=y.ACK.SENT&&this.mediaData.mediaStage===he.MEDIA_DATA_STAGE.RESOLVED,t=!this.isSentByMe&&this.ack>=y.ACK.PLAYED;(e||t)&&(this.stopListening(this,"change:ack",this._handleViewOnceMediaStatusChanged),this.stopListening(this.mediaData,"change:mediaStage",this._handleViewOnceMediaStatusChanged),fe.deregisterMsg(this))}_canRevoke(){var e;return!(this.chat.isGroup&&!(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmMember()))&&(this.isUserCreatedType&&(!K.default.isBroadcast(this.id.remote)||"iphone"===q.Conn.platform)&&!this.broadcast&&!this.isUnsentPhoneMsg()&&!this.isUnsentMedia&&!(0,C.isSuspendedGroup)(this.chat)&&!(0,C.isTerminatedGroup)(this.chat))}canSenderRevoke(){const e=(0,m.isSenderRevokeWindowSenderEnabled)()?D.REVOKE_WINDOW_V2:D.REVOKE_WINDOW,t=Math.trunc(+new Date/1e3)-this.t<=e;return this._canRevoke()&&this.id.fromMe&&t}canAdminRevoke(){var e;const t=Math.trunc(+new Date/1e3)-this.t<=D.REVOKE_WINDOW_V2;return(0,R.adminRevokeSenderEnabled)()&&this._canRevoke()&&!this.id.fromMe&&Boolean(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmAdmin())&&t}getWamDisappearingModeInitiator(){const e=this.disappearingModeInitiator;if(null==e)return null;switch(e){case le.DisappearingModeInitiator.InitiatedByMe:return ye.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_ME;case le.DisappearingModeInitiator.InitiatedByOther:return ye.default.DISAPPEARING_CHAT_INITIATOR_TYPE.INITIATED_BY_OTHER;case le.DisappearingModeInitiator.ChangedInChat:return ye.default.DISAPPEARING_CHAT_INITIATOR_TYPE.CHAT}}getWamMessageType(){return this.isStatusV3?ye.default.MESSAGE_TYPE.STATUS:this.isGroupMsg?ye.default.MESSAGE_TYPE.GROUP:K.default.isBroadcast(this.id.remote)?ye.default.MESSAGE_TYPE.BROADCAST:ye.default.MESSAGE_TYPE.INDIVIDUAL}getWamMediaType(){var e,t;if(!0===this.isDynamicReplyButtonsMsg)return ye.default.MEDIA_TYPE.BUTTON_MESSAGE;switch(this.type){case L.MSG_TYPE.IMAGE:return ye.default.MEDIA_TYPE.PHOTO;case L.MSG_TYPE.VIDEO:return this.mediaData.isGif?ye.default.MEDIA_TYPE.GIF:ye.default.MEDIA_TYPE.VIDEO;case L.MSG_TYPE.AUDIO:return ye.default.MEDIA_TYPE.AUDIO;case L.MSG_TYPE.PTT:return ye.default.MEDIA_TYPE.PTT;case L.MSG_TYPE.DOCUMENT:return ye.default.MEDIA_TYPE.DOCUMENT;case L.MSG_TYPE.UNKNOWN:return ye.default.MEDIA_TYPE.FUTURE;case L.MSG_TYPE.LOCATION:return this.isLive?ye.default.MEDIA_TYPE.LIVE_LOCATION:ye.default.MEDIA_TYPE.LOCATION;case L.MSG_TYPE.VCARD:return ye.default.MEDIA_TYPE.CONTACT;case L.MSG_TYPE.MULTI_VCARD:return ye.default.MEDIA_TYPE.CONTACT_ARRAY;case L.MSG_TYPE.CHAT:return this.linkPreview?(0,Ee.matchCatalogUrl)(this.matchedText)?ye.default.MEDIA_TYPE.CATALOG_LINK:(0,Ee.matchProductUrl)(this.matchedText)?ye.default.MEDIA_TYPE.PRODUCT_LINK:ye.default.MEDIA_TYPE.URL:ye.default.MEDIA_TYPE.NONE;case L.MSG_TYPE.STICKER:return ye.default.MEDIA_TYPE.STICKER;case L.MSG_TYPE.PRODUCT:return ye.default.MEDIA_TYPE.PRODUCT_IMAGE;case L.MSG_TYPE.LIST:switch(null!==(e=null===(t=this.list)||void 0===t?void 0:t.listType)&&void 0!==e?e:me.Message$ListMessage$ListType.UNKNOWN){case me.Message$ListMessage$ListType.SINGLE_SELECT:return ye.default.MEDIA_TYPE.LIST;case me.Message$ListMessage$ListType.PRODUCT_LIST:return ye.default.MEDIA_TYPE.PRODUCT_LIST;default:return ye.default.MEDIA_TYPE.NONE}case L.MSG_TYPE.LIST_RESPONSE:return ye.default.MEDIA_TYPE.LIST_REPLY;case L.MSG_TYPE.BUTTONS_RESPONSE:return ye.default.MEDIA_TYPE.BUTTON_RESPONSE_MESSAGE;case L.MSG_TYPE.ORDER:return ye.default.MEDIA_TYPE.ORDER;case L.MSG_TYPE.INTERACTIVE:return(0,ee.default)(this.interactiveType);case L.MSG_TYPE.REACTION:return ye.default.MEDIA_TYPE.REACTION;default:return ye.default.MEDIA_TYPE.NONE}}getForwardingScoreWhenForwarded(){const e=this.numTimesForwarded+(this.id.fromMe?0:1);return e>=ne.ServerProps.frequentlyForwardedThreshold?O.default.FREQUENTLY_FORWARDED_SENTINEL:e}updateEphemeralStartTimestamp(e){var t=this;return(0,i.default)((function*(){yield(0,oe.updateLocal)(t.id,{ephemeralStartTimestamp:e}),t.ephemeralStartTimestamp=e}))()}isExpired(){return null!=this.ephemeralExpirationTimestamp&&this.ephemeralExpirationTimestamp<=A.Clock.globalUnixTime()}timeUntilExpiration(){const e=this.ephemeralExpirationTimestamp;return null==e?null:this.isExpired()?0:e-A.Clock.globalUnixTime()}_logStorageEstimate(e){return(0,i.default)((function*(){const t=yield(0,ie.default)();t&&(e.webcBrowserStorageQuotaBytes=t.quota,e.webcBrowserStorageQuotaUsedBytes=t.usage)}))()}getCollection(){return n(559871).MsgCollection}_getChatCollection(){return n(669951).ChatCollection}isDownloadable(){var e;return!this.asRevoked&&(!this.isViewOnce&&(this.type===L.MSG_TYPE.VCARD||this.type===L.MSG_TYPE.MULTI_VCARD||!!(null===(e=this.mediaData)||void 0===e?void 0:e.isDownloadable())&&this.type!==L.MSG_TYPE.STICKER))}safe(){return this}unsafe(){return this}meUserIsLastKICActor(){return K.default.equals(this.kicSender,(0,j.getMaybeMeUser)())}keepIsLockedForMe(){return this.isUnkept&&K.default.equals(this.kicSender,this.sender)&&!this.meUserIsLastKICActor()}_isKICEnabled(){return this.isEphemeral&&re.Stream.displayInfo!==re.StreamInfo.OFFLINE&&this.type!==L.MSG_TYPE.REVOKED}canKeepOrUnkeep(){return this.canKeep()||this.canUnkeep()}canKeep(){return!!(0,ue.isKICFullyEnabled)()&&(this._isKICEnabled()&&(0,C.canSendToGroup)(this.chat)&&!this.keepIsLockedForMe()&&!this.star)}canUnkeep(){return this.isKept&&this._isKICEnabled()&&(this.canRevokeUnkeep()||this.canKeep())}canRevokeUnkeep(){var e;return(0,ue.isKeepInChatReadEnabled)()&&this.isSentByMe&&(!this.chat.isGroup||!0===(null===(e=this.chat.groupMetadata)||void 0===e?void 0:e.participants.iAmMember()))}isPastUnkeepExpirationLimit(){const e=this.ephemeralExpirationTimestamp;if(null!=e){const t=Math.trunc(+new Date/1e3)-e;return this.isKept&&t>(0,ue.getUndoKeepInChatExpiration)()}return!1}shouldShowNotificationPreview(){var e;return!(null===(e=this.asViewOnce)||void 0===e?void 0:e.isViewOnce)&&Z.MuteCollection.getGlobalPreviews()}}t.MsgImpl=Pe,Pe.Proxy="msg",Pe.idClass=N.default;const Oe=(0,Q.defineModel)(Pe);t.Msg=Oe},252846:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(465212)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.unsyncedButtonReplies=(0,a.prop)()}}o.Proxy="msgButtonReplyMsg",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},881037:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(801255),a=r(n(252846));class o extends i.BaseCollection{}t.default=o,o.model=a.default},559871:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgCollectionImpl=t.MsgCollection=t.MEDIA_QUERY_LIMIT=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(450796),s=r(n(145095)),l=n(367602),c=n(551737),u=n(535470),d=n(492574),p=n(88555),f=n(933852),_=n(813042),h=r(n(312523)),g=r(n(465212)),m=n(115461),y=n(702040),S=n(978820),E=r(n(389867)),v=n(745454),T=n(801255),C=n(17304),A=r(n(881037)),b=n(964551),P=r(n(286500)),O=n(765044),M=n(662583),I=r(n(656891)),w=n(76581),R=n(580872),N=n(124808),L=n(729984);t.MEDIA_QUERY_LIMIT=50;class D extends T.BaseCollection{constructor(){super(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.productListMessagesPrefetchChain=Promise.resolve([]),this._handleSearchTag=e=>{this.pendingSearchTag=e},this.listenTo(b.ServerProps,"change:pttForwardedFeaturesEnabled",(()=>{this.forEach((e=>{"ptt"!==e.type&&"audio"!==e.type||(e.pttForwardedFeaturesEnabled=b.ServerProps.pttForwardedFeaturesEnabled)}))})),this.listenTo(O.Socket,"change:stream",(function(){O.Socket.stream===M.SOCKET_STREAM.DISCONNECTED&&(this.preAck={})})),this.listenTo(this,"remove",this.removeFromCollection)}removeFromCollection(e){e.chat&&e.chat.removeFromCollection(e)}_findQuery(e,t){var r=this;return(0,a.default)((function*(){const i=r;let a;switch(e.direction){case"before":case"after":a=e.direction;break;default:a="before"}const o={add:a,isHistory:!0},s=yield(0,w.msgFindQuery)(a,e,t,void 0);return s.status>=400?(__LOG__(3)`model:Msg:findQuery error ${s.status}`,Promise.reject(s.status)):(s.forEach((function(e){e.invis=!0})),__LOG__(2)`model:Msg:findQuery:got:${s.length}:${e.direction}`,i.processMultipleMessages(e.remote,s,o,(function(){const t=i.get(e),r=n(669951).ChatCollection.get(e.remote);return t?t.msgChunk:r?r.msgs:void 0})))}))()}add(e,t){const n=(Array.isArray(e)?e:[e]).filter((e=>{if(null==e.ephemeralDuration||0===e.ephemeralDuration)return!0;return!new C.Msg(e).isExpired()})),r=super.add(n,t);return this._syncTemplateButtonClickState(r),this._syncQuickReplyButtonClickState(r),this._prefetchProductListMessages(r),r}_prefetchProductListMessages(e){const t=n(18952).ProductMessageListCollection;this.productListMessagesPrefetchChain=e.filter((e=>{var t,n;return null!=e&&e.isNewMsg&&e.type===m.MSG_TYPE.LIST&&(null===(t=e.list)||void 0===t?void 0:t.listType)===N.Message$ListMessage$ListType.PRODUCT_LIST&&null!=(null===(n=e.list)||void 0===n?void 0:n.productListInfo)})).reduce(((e,n)=>{var r,i;if(null==n)return e;const a=n.requiresDirectConnection,o=n.isForwarded?n.businessOwnerJid:n.from.toString({legacy:!0}),s=null===(r=n.list)||void 0===r?void 0:r.productListInfo;if(null==o||null==s)return e;const l=t.getOrAdd(n.id,s,a,o,null===(i=n.list)||void 0===i?void 0:i.title);return null==l||0!==l.productCollection.getModelsArray().length||l.isFetching()?e:e.then((()=>t.update(l.id)))}),this.productListMessagesPrefetchChain)}_syncTemplateButtonClickState(e){for(let t=0;t<e.length;t++){const n=e[t];if(!n)continue;const r=n.chat;if(n.type===m.MSG_TYPE.TEMPLATE_BUTTON_REPLY&&null!=n.selectedIndex&&n.sender.equals((0,S.getMaybeMeUser)())){null==r.msgUnsyncedButtonReplyMsgs&&(r.msgUnsyncedButtonReplyMsgs=new A.default);const{msgUnsyncedButtonReplyMsgs:e}=r,t=n.quotedMsgObj();if(!t)continue;let i=e.get(t.id);i||(e.add({id:t.id,unsyncedButtonReplies:new P.default}),i=e.get(t.id));const{unsyncedButtonReplies:a}=(0,s.default)(i,"buttonReplyMsg");a.add(n);const o=this.get(t.id);if(null==o?void 0:o.buttons){const e=o.buttons.get(`${(0,s.default)(n.selectedIndex,"msg.selectedIndex")}`);e&&(e.selected=!0),a.remove(n)}}else if(n.isFromTemplate&&n.buttons){const{msgUnsyncedButtonReplyMsgs:e}=r;if(null==e)continue;const t=e.get(n.id);t&&(t.unsyncedButtonReplies.forEach((e=>{const t=(0,s.default)(n.buttons,"msg.buttons").get(`${(0,s.default)(e.selectedIndex,"replyMsg.selectedIndex")}`);t&&(t.selected=!0)})),t.unsyncedButtonReplies.delete())}}}_syncQuickReplyButtonClickState(e){for(let t=0;t<e.length;t++){const n=e[t];if(n)if(n.type===m.MSG_TYPE.BUTTONS_RESPONSE&&null!=n.selectedButtonId&&n.sender.equals((0,S.getMaybeMeUser)())){const e=n.quotedMsgObj();if(!e)continue;const t=this.get(e.id);if(null==t?void 0:t.replyButtons){const e=t.replyButtons.get(n.selectedButtonId);e&&(e.selected=!0)}}else if(n.isDynamicReplyButtonsMsg&&n.replyButtons&&n.replyButtons.every((e=>!e.selected))&&n.chat){const e=Math.max(0,n.chat.msgs.length-1e3);n.chat.msgs.getModelsArray().slice(e).filter((e=>{var t;return e.type===m.MSG_TYPE.BUTTONS_RESPONSE&&null!=e.selectedButtonId&&e.sender.equals((0,S.getMaybeMeUser)())&&(null===(t=e.quotedMsgObj())||void 0===t?void 0:t.id.toString())===n.id.toString()})).map((e=>{let{selectedButtonId:t}=e;return t})).forEach((e=>{var t;const r=null===(t=n.replyButtons)||void 0===t?void 0:t.get(e);null!=r&&(r.selected=!0)}))}}}getStarred(e,t,n){var r=this;return(0,a.default)((function*(){const i={count:"number"!=typeof t||isNaN(t)?_.PAGE_SIZE:t,chat:e||void 0,remote:null==n?void 0:n.remote,id:null==n?void 0:n.id,fromMe:null==n?void 0:n.fromMe,participant:null==n?void 0:n.participant},a=yield(0,w.msgFindQuery)("star",i),o=a.status;return a.status>=400?(499===o?__LOG__(2)`model:Msg:getStarred error 499 (unimplemented)`:__LOG__(3)`model:Msg:getStarred error ${o}`,Promise.reject(o)):r.processMultipleMessages(void 0,a,{add:"search"})}))()}getMessagesById(e){var t=this;return(0,a.default)((function*(){const n=yield(0,w.msgFindByIds)(e);return(0,l.promiseProps)({messages:t.processMultipleMessages(void 0,n,{add:"search"}),eof:!0,canceled:!1})}))()}queryVcard(e){var t=this;return(0,a.default)((function*(){const n=yield(0,w.queryVcard)(e);return 499===n.status?(__LOG__(2)`model:Msg:queryVcard error 499 (unimplemented)`,Promise.reject(new d.E499)):t.processMultipleMessages(void 0,n,{add:"search"})}))()}incrementalStarredUpdate(e){return this.processMultipleMessages(void 0,e,{add:"search"})}search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const a=`${e}__${i.label||i.kind&&i.kind||""}`;if(1===t&&!r){const o=this.ftsCache[a];if(o)return o;const s=this._search(e,t,n,r,i.label,i.kind);this.ftsCache[a]=s;const l=()=>{this.ftsCache[a]=null};return setTimeout(l,R.FTS_TTL),s.catch(l),s}return this._search(e,t,n,r,i.label,i.kind)}_search(e,t,n,r,i,o){var s=this;return(0,a.default)((function*(){const a={searchTerm:e,page:(0,c.isNumber)(t)&&0!==t?t:1,count:(0,c.isNumber)(n)&&0!==n?n:_.PAGE_SIZE,remote:r,tagToCancel:r?s.pendingSearchTag:void 0,label:i,kind:o},u=yield(0,w.msgFindQuery)("search",a,void 0,s._handleSearchTag);if(a.tagToCancel===s.pendingSearchTag&&(s.pendingSearchTag=void 0),499===u.status)return(0,l.promiseProps)({messages:Promise.resolve([]),eof:!1,canceled:!0});if(404===u.status)return Promise.reject(new d.E404);if(u.status>=400)return __LOG__(3)`model:Msg:search error ${u.status}`,Promise.reject(new d.ServerStatusCodeError(u.status,"failed to find a msg during fts"));const p=Array.isArray(u)?u:u.messages,f=!!Array.isArray(u)||u.eof;return(0,l.promiseProps)({messages:s.processMultipleMessages(void 0,p,{add:"search"}),eof:f,canceled:!1})}))()}queryMedia(e,t,n,r,i){var o=this;return(0,a.default)((function*(){const a={remote:e,count:(0,c.isNumber)(t)&&0!==t?t:_.PAGE_SIZE,id:null==r?void 0:r.id,fromMe:null==r?void 0:r.fromMe,participant:null==r?void 0:r.participant,direction:n||"before",media:i},s=yield(0,w.msgFindQuery)("media",a);return s.status>=400?(__LOG__(3)`model:Msg:media error ${s.status}`,404===s.status?Promise.reject(new d.E404):Promise.reject(new d.ServerStatusCodeError(s.status,"failed to find a msg during media query"))):i?o.processMultipleMessages(void 0,s,{add:"search"}):(0,l.promiseProps)({docCount:s.docCount,linkCount:s.linkCount,mediaCount:s.mediaCount,messages:o.processMultipleMessages(void 0,s.messages,{add:"search"})})}))()}getContext(e,t,n){const r=this.get(e);if(r)return Promise.all([(0,w.msgFindQuery)("before",e,n),(0,w.msgFindQuery)("after",e,n)]).then((n=>{let[i,a]=n;if(!Array.isArray(i)||!Array.isArray(a))throw __LOG__(3)`model:msg:getContext fetch error`,i.status||a.status;return r.search=!1,Promise.all([this.processMultipleMessages(e.remote,i,{add:"before",isHistory:!0},t),this.processMultipleMessages(e.remote,a,{add:"after",isHistory:!0},t)])}));const i={add:"after",isHistory:!0};return(0,w.msgFindQuery)("after",e,n).then((n=>{if(!Array.isArray(n))throw __LOG__(3)`model:msg:getContext:after fetch error`,n.status;if(E.default.isStatusV3(n[0].id.remote))throw new Error("statusV3, stop querying before the msg");return this.processMultipleMessages(e.remote,n,i,t)})).then((t=>{const r=(0,s.default)(t[0],"after[0]"),i=r.id.clone();i.count=e.count+1;const a={add:"before",isHistory:!0};return Promise.all([(0,w.msgFindQuery)("before",i,n).then((t=>{if(!Array.isArray(t))throw __LOG__(3)`model:msg:getContext:before fetch error`,t.status;if(!t[t.length-1].id.equals(e))throw __LOG__(3)`model:msg:getContext:before ctx message mismatch`,405;return this.processMultipleMessages(e.remote,t,a,(function(){return r.msgChunk}))})),Promise.resolve(t)])}))}hasSynced(){return(0,h.default)(this,_.COLLECTION_HAS_SYNCED)}delete(){super.delete(),this.lastReceivedReceipt={},this.lastReceivedPaymentTransaction={},this.preAck={}}getKeysForResyncReceipts(){const e=[],t=(0,i.default)((0,i.default)({},this.lastReceivedReceipt),this.lastReceivedPaymentTransaction);for(const r in t){const t=(0,v.createWid)(r),i=n(669951).ChatCollection.get(t);let a;if(i&&(a=(0,f.getFirstMsgWithStatus)(i)),a){const n=a.id;n.t=this.lastReceivedReceipt[t]||a.t||0,n.payT=this.lastReceivedPaymentTransaction[t],e.push(n)}else __LOG__(3)`Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: ${t.toString()}`}return e}resyncReceipts(){__LOG__(2)`Msg:resyncReceipts`;const e=this.getKeysForResyncReceipts();return 0===e.length?Promise.resolve():(0,p.isMDBackend)()?Promise.reject(new Error("This call is only supported in non-MD mode")):I.default.resyncReceipts(e).then((e=>{Array.isArray(e)?(__LOG__(2)`Msg:resyncReceipts success`,e.forEach((e=>{this.updateLastReceipt(e.id,e.t),this.updateLastTransactionTime(e.id,e.payT),e.acks.forEach((t=>{const{id:n,fromMe:r,participant:i,status:a,t:o}=t;if(null!=n&&null!=r&&null!=a){const t=new g.default({fromMe:r,remote:e.id,id:n,participant:i}),s=this.get(t);s&&(s.isEphemeral&&o?s.updateEphemeralStartTimestamp(o):s.updateAck(a))}else __LOG__(3)`Msg:resyncReceipts invalid response: ${JSON.stringify(t)}`})),e.msgs.length>0&&this.processMultipleMessages(e.id,e.msgs,{update:!0,isHistory:!1}).catch((0,o.filteredCatch)(d.LogoutDrop,(()=>{})))}))):__LOG__(3)`Msg:resyncReceipts error`})).catch((0,o.filteredCatch)([d.LogoutDrop,d.EphemeralDrop,d.BrowserReplacedDrop],(()=>{}))).catch((e=>{throw __LOG__(3)`Msg:resyncReceipts dropped ${String(e)} ${e?e.stack:"no stack"}`,new Error("Msg:resyncReceipts dropped")}))}updateLastReceipt(e,t){const n=this.lastReceivedReceipt[e];(0,L.isNonZeroNumber)(t)&&(!n||t>n)&&(this.lastReceivedReceipt[e]=t)}updateLastTransactionTime(e,t){const n=this.lastReceivedPaymentTransaction[e];t&&(!n||t>n)&&(this.lastReceivedPaymentTransaction[e]=t)}processMultipleMessages(e,t,n,r){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const a=()=>(0,y._processMultipleMessages)(e,t,n,r);if(e){let t;const n=this.pendingAdd[e];return t=n&&i?n.then(a):a(),t.finally((()=>{e&&this.pendingAdd[e]===t&&(this.pendingAdd[e]=null)})).catch((()=>{})),this.pendingAdd[e]=t}return a()}markAllAsStale(){this.forEach((e=>e.unset("recvFresh")))}hasUnsentMessages(){return this.some((e=>e.ack===u.ACK.CLOCK&&e.local&&e.isSentByMe))}}t.MsgCollectionImpl=D,D.model=C.Msg;const k=new D;t.MsgCollection=k},754311:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantCollection=t.MsgInfoParticipant=t.MsgInfo=void 0;var i=r(n(465212)),a=r(n(389867)),o=n(719380),s=n(647969),l=n(411290),c=r(n(631727));class u extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.t=(0,l.prop)(),this.contact=(0,l.session)()}initialize(){super.initialize(),this.addChild("contact",o.ContactCollection.gadd(this.id))}}u.Proxy="msgInfoParticipant",u.idClass=a.default;const d=(0,l.defineModel)(u);t.MsgInfoParticipant=d;class p extends c.default{}t.ParticipantCollection=p,p.model=d,p.comparator=(e,t)=>(0,s.ContactComparator)(e.contact,t.contact);class f extends l.BaseModel{constructor(){super(...arguments),this.id=(0,l.prop)(),this.usePlayReceipt=(0,l.prop)(),this.playedRemaining=(0,l.prop)(0),this.readRemaining=(0,l.prop)(0),this.deliveryRemaining=(0,l.prop)(0),this.deliveryPrivacyMode=(0,l.prop)(),this.played=(0,l.collection)(p),this.read=(0,l.collection)(p),this.delivery=(0,l.collection)(p),this.settled=(0,l.derived)((function(){return this.usePlayReceipt?!this.playedRemaining:!this.readRemaining}),["usePlayReceipt","playedRemaining","readRemaining"])}getCollection(){return n(617972).MsgInfoCollection}}f.Proxy="msgInfo",f.idClass=i.default;const _=(0,l.defineModel)(f);t.MsgInfo=_},617972:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoCollectionImpl=t.MsgInfoCollection=void 0;var i=n(219534),a=r(n(465212)),o=n(801255),s=n(754311),l=n(765044),c=n(662583),u=n(628259);class d extends o.BaseCollection{_initializeStaleCollection(){this.listenTo(l.Socket,"change:stream",(()=>{l.Socket.stream===c.SOCKET_STREAM.DISCONNECTED&&this.forEach((e=>{e.settled||e.set("stale",!0)}))}))}_find(e){const t=n(559871).MsgCollection.get(e);return t?t.isSentByMe?(0,u.sendQueryMsgInfo)(t):Promise.reject(new o.CollectionSilentQueryError("message not sent by me")):Promise.reject(new o.CollectionSilentQueryError(`No message found for id: ${e}`))}updateInfo(e,t,n,r,o,s){const l=new a.default({from:t,to:n,id:e,participant:o}),c=new a.default({from:t,to:n,id:e}),u=this.get(l)||this.get(c);if(u)return(0,i.updateMsgInfo)(u,r,o,s)}}t.MsgInfoCollectionImpl=d,d.model=s.MsgInfo,d.staleCollection=!0;const p=new d;t.MsgInfoCollection=p},554676:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addRecordsToChat=E,t.broadcastFanout=function(e){let t;if(!e.invis){const r=S(e);r&&(t=r.map((e=>e.remote)),r.forEach((t=>{const r=n(559871).MsgCollection;if(!r.some((0,o.default)({id:t}))){const i=A(e);i.to=t.remote,i.id=t,i.broadcast=!0;const a=r.add(i,{merge:!0});(0,n(211739).findChat)(t.remote).then((function(e){a.forEach((t=>{if(t.type!==p.MSG_TYPE.PROTOCOL){e.isEphemeralSettingOn()&&(t.ephemeralDuration=e.getEphemeralSetting());const n=e.getEphemeralSettingTimestamp();null!=n&&(t.ephemeralSettingTimestamp=n);const r=e.getDisappearingModeInitiator();null!=r&&(t.disappearingModeInitiator=r)}})),E(a,e,!0)}))}})))}return t},t.createQuotedMsg=function(e){if(!e)return null;const t=new d.default({from:e.from,to:e.to,id:e.id,participant:e.participant,selfDir:e.self});e.id=t;return new(0,n(17304).Msg)(e).safe()},t.getBroadcastFanoutKeys=S,t.getOriginalQuotedMsgIfPossible=function(e,t){var n;if(!e)return e;const r=null===(n=t.get(e.id))||void 0===n?void 0:n.safe();return r&&!r.asRevoked?r:e},t.getReadMsgKeys=function(e){return e.filter((e=>e.ack===l.ACK.READ)).map((e=>e.id.toString()))},t.getReferentialKey=function(e){const t=n(745454);if(e.broadcastId&&t.isWidlike(e.broadcastId)){const n=e.id;return new d.default({fromMe:n.fromMe,remote:t.createWidFromWidLike(e.broadcastId),id:n.id,participant:n.remote})}return e.id},t.listMsgCanRender=function(e){var t;return(null===(t=e.list)||void 0===t?void 0:t.listType)!==y.Message$ListMessage$ListType.PRODUCT_LIST||(0,u.productListMessagesEnabled)()&&!h.ServerProps.webProductListMessageRenderKillSwitch},t.msgMatchesType=function(e,t){switch(t){case"text":return e.type===p.MSG_TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===p.MSG_TYPE.IMAGE;case"video":return e.type===p.MSG_TYPE.VIDEO&&!e.isGif;case"gif":return e.type===p.MSG_TYPE.VIDEO&&e.isGif;case"audio":return e.type===p.MSG_TYPE.AUDIO;case"ptt":return e.type===p.MSG_TYPE.PTT;case"document":return e.type===p.MSG_TYPE.DOCUMENT;case"location":return e.type===p.MSG_TYPE.LOCATION;case"vcard":return e.type===p.MSG_TYPE.VCARD||e.type===p.MSG_TYPE.MULTI_VCARD;case"url":return e.type===p.MSG_TYPE.CHAT&&"url"===e.subtype;case"sticker":return e.type===p.MSG_TYPE.STICKER;case void 0:default:return!1}},t.typeIsMms=function(e){var t;switch(e.type){case"image":case"video":case"audio":case"ptt":case"sticker":case"document":case"product":return!0;case"protocol":return"history_sync_notification"===e.subtype;case p.MSG_TYPE.NATIVE_FLOW:return e.headerType===y.Message$ButtonsMessage$HeaderType.IMAGE;case p.MSG_TYPE.INTERACTIVE:return Boolean((null===(t=e.interactiveHeader)||void 0===t?void 0:t.mediaType)&&_.IM_MEDIA_HEADER_TYPES.has(e.interactiveHeader.mediaType));default:return!1}},t.typeIsUrl=function(e){return e.type===p.MSG_TYPE.CHAT&&"url"===e.subtype},t.viewOnceMessageOpened=function(e){return e.isViewOnce&&!e.isSentByMe&&e.ack>=l.ACK.PLAYED};var i=r(n(348926)),a=r(n(530988)),o=r(n(706410)),s=r(n(435161)),l=n(535470),c=n(492574),u=n(408139),d=r(n(465212)),p=n(115461),f=r(n(389867)),_=n(534535),h=n(964551),g=r(n(978144)),m=n(111902),y=n(124808);function S(e){var t;let r,i,a;if(e instanceof n(17304).Msg)i=e,a=e.id;else{if(!(e instanceof d.default))return void __LOG__(3)`model:msgs:broadcastFanout: unknown msgOrKey: ${String(e)}`;a=e}if(!f.default.isStatusV3(a.remote)){if((null===(t=i)||void 0===t?void 0:t.recipients)&&0!==i.recipients.length)r=i.recipients;else{const e=n(963928).default.get(a.remote);e?r=(0,s.default)(A(e.participants),"id"):__LOG__(2)`model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: ${a.remote.toString()}`}return r?r.map((e=>new d.default({fromMe:a.fromMe,remote:e,id:a.id}))):void 0}}function E(e,t,r,i,a,o){const s=i||t.msgs;if(0===e.length)return;let l=s===t.msgs;if(o)if(l)__LOG__(2)`models:msg:store:resetMostRecentMsgs .msgs === cmc !`,v(t,s,e);else{l=!0;v(t,s,e).then((()=>{const e=new(0,n(951612).ChatMsgsCollection);e.replace(t.msgs),t.msgChunks.push(e),t.replaceMsgsCollection(s),t.msgs.trigger("change:last",t.msgs.last())}))}else r?l?v(t,s,e):C(s,e):C(s,e,{at:0,silent:e.every(b)});const c=n(559871).MsgCollection;if(r&&l||!c.lastReceivedReceipt[t.id]){for(let t=e.length-1;t>=0;t--){const n=e[t],r=n.id;if(r.fromMe&&!n.isNotification){c.updateLastReceipt(r.remote,n.t);break}}}if(r&&l||!c.lastReceivedPaymentTransaction[t.id]){for(let t=e.length-1;t>=0;t--){const n=e[t],r=n.id;n.paymentTransactionTimestamp&&c.updateLastTransactionTime(r.remote,n.paymentTransactionTimestamp)}}const u=a;u&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=e.find((function(e){return e.id.toString()===u.toString()})))}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n){const r=(0,a.default)(n,(e=>!!e));if(!r)return Promise.resolve();C(t,n),yield(0,m.setLastReceivedKey)(e.id,r.id),e.lastReceivedKey=r.id}))).apply(this,arguments)}function C(e,t,n){try{e.add(t,n)}catch(e){if(!(e instanceof c.LogoutDrop))throw e;__LOG__(3)`setRecords LogoutDrop: ${e.toString()}`}}function A(e){return null!=e&&"object"==typeof e?JSON.parse(JSON.stringify(e),g.default):e}function b(e){return"i"===e.eventType}},440214:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Mute=t.GLOBAL_REACTIONS_MUTE=t.GLOBAL_MUTE=void 0;var i=n(551737),a=r(n(485074)),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=h(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),s=n(694816),l=r(n(389867)),c=n(411290),u=n(745197),d=r(n(914296)),p=n(446331),f=r(n(730381)),_=n(785893);function h(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(h=function(e){return e?n:t})(e)}const g="global_mute";t.GLOBAL_MUTE=g;const m="global_reactions_mute";t.GLOBAL_REACTIONS_MUTE=m;class y extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.expiration=(0,c.prop)(0),this.callExpiration=(0,c.prop)(0),this._unmuteTimer=(0,c.session)(),this._unmuteCallTimer=(0,c.session)(),this.promises=(0,c.session)((()=>({mute:null,unmute:null}))),this.isMuted=(0,c.derived)((function(){return!!this.expiration}),["expiration"]),this.isCallMuted=(0,c.derived)((function(){return!!this.callExpiration}),["callExpiration"])}initialize(){super.initialize(),null!=this.expiration&&0!==this.expiration&&this.mute(this.expiration),null!=this.callExpiration&&0!==this.callExpiration&&this.muteCall(this.callExpiration)}setMute(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))}mute(e,t,n){let r=e;if(!(0,i.isNumber)(r))return __LOG__(2)`models:Mute:mute called with invalid expiration ${r}`,Promise.reject(new o.ActionError);r=Math.round(r),r>2e9&&__LOG__(2)`models:Mute:mute called with wrong units?${this.id.toString()} exp:${r}`;const c=()=>{if(this.isMuted&&(a.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer")),-1===r)__LOG__(2)`models:Mute:mute ${this.id.toString()} muted, no expiration`;else{const e=r-(0,f.default)().unix();__LOG__(2)`models:Mute:mute ${this.id.toString()} duration:${e}`,this._unmuteTimer=a.default.setGlobalTimeout(this.unmute.bind(this),1e3*r)}this.set({expiration:r})},h=l.default.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;const e=this.promises.mute=(0,u.sendConversationMute)(this.id,r,this.expiration),i=h?new p.ActionType(d.default.t(65)):new p.ActionType(d.default.t(31)),a=n||(0,p.genId)(),o=this.promises.mute.catch((()=>{__LOG__(3)`models:Mute:mute dropped`;const e=h?d.default.t(63):d.default.t(29);throw new p.ActionType(e,{actionText:d.default.t(122),actionHandler:this.mute.bind(this,r,t,a)})})).then((e=>{if(200===e.status){const e=h?d.default.t(64):d.default.t(30);return new p.ActionType(e,{actionText:d.default.t(126),actionHandler:this.unmute.bind(this,t,a)})}if(e.status>=400)throw h?new p.ActionType(d.default.t(63)):new p.ActionType(d.default.t(29))}));return s.ToastManager.open((0,_.jsx)(p.ActionToast,{id:a,initialAction:i,pendingAction:o})),e.then((function(e){200!==e.status||e._duplicate||c()})).finally((()=>{this.promises.mute=null}))}return c(),Promise.resolve()}muteCall(e){let t=e;if(!(0,i.isNumber)(t))return __LOG__(2)`models:Mute:muteCall called with invalid expiration ${t}`,Promise.reject(new o.ActionError);if(t=Math.round(t),t>2e9&&__LOG__(2)`models:Mute:muteCall called with wrong units?${this.id.toString()} exp:${t}`,this.isCallMuted&&(a.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer")),-1===t)__LOG__(2)`models:Mute:muteCall ${this.id.toString()} muted, no expiration`;else{const e=t-(0,f.default)().unix();__LOG__(2)`models:Mute:muteCall ${this.id.toString()} duration:${e}`,this._unmuteCallTimer=a.default.setGlobalTimeout(this.unmuteCall.bind(this),1e3*t)}return this.set({callExpiration:t}),Promise.resolve()}canMute(){let e=!1;if(l.default.isGroup(this.id)){const t=n(963928).default.get(this.id);t&&(e=t.participants.iAmMember())}return e||l.default.isUser(this.id)}_clearUnmuteTimer(){a.default.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0}_clearUnmuteCallTimer(){a.default.clearTimeout(this._unmuteCallTimer),this.unset("_unmuteCallTimer"),this.callExpiration=0}unmute(e,t){const n=()=>{__LOG__(2)`models:Mute:unmute ${this.id.toString()}`,this._clearUnmuteTimer()},r=l.default.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;const i=this.promises.unmute=(0,u.sendConversationMute)(this.id,0,this.expiration),a=r?new p.ActionType(d.default.t(72)):new p.ActionType(d.default.t(42)),o=t||(0,p.genId)(),l=this.promises.unmute.catch((()=>{__LOG__(3)`models:Mute:unmute dropped`;const t=r?d.default.t(70):d.default.t(40);throw new p.ActionType(t,{actionText:d.default.t(122),actionHandler:this.unmute.bind(this,e,o)})})).then((e=>{if(200===e.status)return r?new p.ActionType(d.default.t(71)):new p.ActionType(d.default.t(41));if(e.status>=400)throw r?new p.ActionType(d.default.t(70)):new p.ActionType(d.default.t(40))}));return s.ToastManager.open((0,_.jsx)(p.ActionToast,{id:o,initialAction:a,pendingAction:l})),i.then((function(e){200!==e.status||e._duplicate||n()})).finally((()=>{this.promises.unmute=null}))}return n(),Promise.resolve()}unmuteCall(){return __LOG__(2)`models:Mute:unmuteCall ${this.id.toString()}`,this._clearUnmuteCallTimer(),Promise.resolve()}delete(){super.delete(),this.getCollection().remove(this.id),this._clearUnmuteTimer()}getCollection(){return n(72472).MuteCollection}}y.Proxy="mute",y.idClass=l.default,y.allowedIds=[g,m];const S=(0,c.defineModel)(y);t.Mute=S},72472:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MuteCollectionImpl=t.MuteCollection=void 0;var r=n(408139),i=n(555452),a=n(491442),o=n(714648),s=n(801255),l=n(317239),c=n(440214);let u=!0,d=!0,p=!1,f=!1,_=!1,h=!1,g=!1;class m extends s.BaseCollection{initializeFromCache(e){Array.isArray(e)?e.forEach((e=>{[c.GLOBAL_MUTE,c.GLOBAL_REACTIONS_MUTE].includes(e.id)&&this.add(e,{remove:!1})})):null!=e&&e.id===c.GLOBAL_MUTE&&this.add(e,{remove:!1}),this.setGlobalNotifications((0,i.getGlobalNotifications)()),this.setGlobalOfflineNotifications((0,i.getGlobalOfflineNotifications)()),this.setGlobalSounds((0,i.getGlobalSounds)()),this.setGlobalCallRingtone((0,i.getGlobalCallRingtone)()),this.setGlobalPreviews((0,i.getGlobalPreviews)()),this.setCollapseMuted((0,i.getCollapseMuted)()),this.setOutgoingMessageSound((0,i.getOutgoingMessageSound)())}saveToCache(){if(!l.Conn.shouldSaveToCache())return;const{id:e}=this.constructor.cachePolicy,t=[];__LOG__(2)`models:mute:cache-save: ${String(e)}`;const n=this.get(c.GLOBAL_MUTE),i=this.get(c.GLOBAL_REACTIONS_MUTE);n&&t.push(n.toJSON()),(0,r.receiveReactionsEnabled)()&&i&&t.push(i.toJSON()),t.length?a.userPreferencesStore.setCollection(e,t):__LOG__(3)`models:mute:cache-save: globalMuteModel or globalReactionsMuteModel does not exist`}globalMute(){const e=this.get(c.GLOBAL_MUTE);return e||this.add({id:c.GLOBAL_MUTE})[0]}globalReactionsMute(){const e=this.get(c.GLOBAL_REACTIONS_MUTE);return e||this.add({id:c.GLOBAL_REACTIONS_MUTE})[0]}getGlobalSounds(){return u}setGlobalSounds(e){u=e,(0,i.setGlobalSounds)(e)}getGlobalCallRingtone(){return d}setGlobalCallRingtone(e){d=e,(0,i.setGlobalCallRingtone)(e)}getGlobalNotifications(){return p}setGlobalNotifications(e){p=e,(0,i.setGlobalNotifications)(e)}getGlobalOfflineNotifications(){return f}setGlobalOfflineNotifications(e){f=e,(0,i.setGlobalOfflineNotifications)(e)}getGlobalPreviews(){return _}setGlobalPreviews(e){_=e,(0,i.setGlobalPreviews)(e)}getCollapseMuted(){return h}setCollapseMuted(e){h=e,(0,i.setCollapseMuted)(e),this.trigger("change:collapseMuted",h)}getOutgoingMessageSound(){return g}setOutgoingMessageSound(e){g=e,(0,i.setOutgoingMessageSound)(e)}getIgnoreNondirectGroupMsg(){return!1}setIgnoreNondirectGroupMsg(e){}handle(e){e.forEach((e=>{const t=n(669951).ChatCollection.get(e.id);t&&"mute"===e.type&&t.mute.setMute(e.muteExpiration)}))}}t.MuteCollectionImpl=m,m.model=c.Mute,m.cachePolicy={id:"mute",policy:o.CACHE_POLICY.LOAD,delay:1e3};const y=new m;t.MuteCollection=y},851783:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n(81109)),o=i(n(348926)),s=n(389385),l=n(918925),c=i(n(842341)),u=n(640265),d=n(450796),p=i(n(145095)),f=n(240277),_=n(237178),h=n(492574),g=n(923082),m=n(438184),y=i(n(506631)),S=i(n(376139)),E=n(555452),v=n(978820),T=n(317239),C=n(411290),A=n(964551),b=i(n(914296)),P=i(n(11339)),O=n(729984);class M extends((0,u.customError)("NoticeJsonParseError")){}const I=["logout","refresh"],w=(0,_.createTimer)({algo:{type:"constant",delay:432e5}}),R=(0,_.createTimer)({algo:{type:"fibonacci",first:0,second:1},max:18e6});class N extends C.BaseModel{constructor(){super(...arguments),this.id=(0,C.prop)(),this.noticeId=(0,C.prop)(),this.blocking=(0,C.prop)(),this.policyVersion=(0,C.prop)(),this.banner=(0,C.prop)(),this.blockingModal=(0,C.prop)(),this.shouldShowButterBar=(0,C.session)(!0),this.backgroundFetches=(0,C.session)()}initialize(){super.initialize(),this.fetchNoticeData=this.fetchNoticeData.bind(this),this.listenTo(b.default,"locale_change",this.fetchNoticeData)}dismissButterBarNotice(){0!==A.ServerProps.greenAlertBannerDuration&&(new P.default.UserNotice({userNoticeId:this.noticeId,userNoticeContentVersion:this.policyVersion,userNoticeEvent:P.default.USER_NOTICE_EVENT.BANNER_DISMISS}).commit(),this._dismissAndStartButterBarTimer(A.ServerProps.greenAlertBannerDuration),(0,E.setNoticeBannerClosedAt)(Date.now()))}_dismissAndStartButterBarTimer(e){this.shouldShowButterBar=!1,this._clearButterBarTimer(),this._butterBarTimeoutHandler=window.setTimeout((()=>{this.shouldShowButterBar=!0,(0,E.setNoticeBannerClosedAt)(null)}),e)}delete(){this.resetNotice(),super.delete()}sanitizeBlockingModal(e){if(!e)return null;const t=e=>{if(!e)return null;const t=e.action;if(t){const n=I.find((e=>`whatsapp:user-notice?action=${e}`===t));if(n)return e.action=n,e;__LOG__(3)`Notice: Unknown action type ${t}`}return null};return e.primaryButton=t(e.primaryButton),e.secondaryButton=t(e.secondaryButton),e}_isoFromCallingCode(e){const t=parseInt(e,10),n=c.default[t];return(0,p.default)(n,"isoFromCC")}validateResponseFields(e,t){e.forEach((e=>{if(!(e in t))throw new Error(`Missing field ${e} in notice content.`)}))}extractBlockingModal(e){if(e)return this.validateResponseFields(["icon","iconDescription","title","body","primaryButton"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconSvg:{light:"",dark:""},iconDescription:e.iconDescription,title:e.title,body:e.body,primaryButton:e.primaryButton,secondaryButton:e.secondaryButton}}extractBanner(e){if(e)return this.validateResponseFields(["icon","iconDescription","text"],e),this.validateResponseFields(["light","dark"],e.icon),{icon:{light:e.icon.light,dark:e.icon.dark},iconDescription:e.iconDescription,text:e.text,iconSvg:{light:"",dark:""}}}extractUserNoticeContent(e){const{policyVersion:t}=e;if(!t)throw new Error("Missing field policyVersion in notice content.");__LOG__(2)`Notice:fetchNoticeData successful for policyVersion ${t}`;const n=e.banner&&this.extractBanner(e.banner),r=e["blocking-modal"]&&this.extractBlockingModal(e["blocking-modal"]),i=r&&this.sanitizeBlockingModal(r);this.set({policyVersion:t,blockingModal:i,banner:n}),this.makeIconFetch(n,i)}resetBackgroundFetches(){var e;null===(e=this.backgroundFetches)||void 0===e||e.forEach((e=>{__LOG__(2)`Notice: aborting fetches`,e.abort()}))}resetNotice(){this.resetBackgroundFetches(),this.unset(["banner","blocking","blockingModal","noticeId","policyVersion"]),(0,E.setNoticeId)(null),(0,E.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0}_clearButterBarTimer(){const e=this._butterBarTimeoutHandler;null!=e&&window.clearTimeout(e)}fetchNoticeData(){if((0,O.isNonZeroNumber)(this.noticeId)&&m.LegacyPhoneFeatures.supportsFeature(m.LegacyPhoneFeatures.F.USER_NOTICE)){var e,t;this.resetBackgroundFetches(),this.set({blockingModal:void 0,banner:void 0});const n=(0,v.getMeUser)(),r=(0,f.findCC)(n.user),i=this._isoFromCallingCode(r),a=S.default.build("https://www.whatsapp.com/user-notice/v1/",{id:this.noticeId,lg:null!==(e=T.Conn.lg)&&void 0!==e?e:"zz",lc:null!==(t=T.Conn.lc)&&void 0!==t?t:"ZZ",cc:i,platform:T.Conn.isSMB?"smbweb":"web"});this.makeContentFetch(a)}}_shouldUpdateVersion(e,t){return null==e||null!=t&&t>e}handleResponse(e){if(m.LegacyPhoneFeatures.supportsFeature(m.LegacyPhoneFeatures.F.USER_NOTICE))if(e.length){const{blocking:t,id:n,version:r}=e[0],i=this.noticeId,a=this._shouldUpdateVersion(this.policyVersion,r);__LOG__(2)`Notice: received notice id: ${n}, blocking: ${t}, version: ${r}`,this.set({blocking:t,noticeId:n,policyVersion:a?r:this.policyVersion}),(n!==i||a)&&this.fetchNoticeData();n!==(0,E.getNoticeId)()&&((0,E.setNoticeId)(n),(0,E.setNoticeBannerClosedAt)(null),this._clearButterBarTimer(),this.shouldShowButterBar=!0),e.length>1&&(__LOG__(4,void 0,new Error,!0)`Notice: more than one notice from phone response`,SEND_LOGS("notice-unallowed-length"))}else __LOG__(2)`Notice: received empty notice`,this.resetNotice()}sync(e){!0!==e&&this._initializeShouldShowButterBar();const t="Notice:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,n(656891).default.queryNoticeState)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.notices)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,d.filteredCatch)(h.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("notice-query-failed")}))}_initializeShouldShowButterBar(){const e=(0,E.getNoticeBannerClosedAt)();if(null!=e&&0!==A.ServerProps.greenAlertBannerDuration){const t=e+A.ServerProps.greenAlertBannerDuration-Date.now();if(t>0)return void this._dismissAndStartButterBarTimer(t)}this.shouldShowButterBar=!0}makeContentFetch(e){var t=this;return(0,o.default)((function*(){try{const n=yield t.attemptFirstFetchAndRetriesAfter(e);try{const e=n&&JSON.parse(n);e&&t.extractUserNoticeContent(e)}catch(e){throw new P.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:P.default.USER_NOTICE_ERROR_EVENT.JSON_PARSE}).commit(),new M(`Received invalid User Notice content for id ${t.noticeId}`)}}catch(e){if(e.name===s.ABORT_ERROR)return;if("NoticeJsonParseError"!==e.name){new P.default.UserNoticeError({userNoticeId:t.noticeId,userNoticeContentVersion:t.policyVersion,userNoticeErrorEvent:P.default.USER_NOTICE_ERROR_EVENT.JSON_FETCH}).commit()}t.resetNotice(),__LOG__(4,void 0,new Error,!0)`Notice: Error Message : ${e.message}`,SEND_LOGS("notice-content-error")}}))()}makeIconFetch(e,t){var n=this;return(0,o.default)((function*(){const r=[null==e?void 0:e.icon.light,null==e?void 0:e.icon.dark,null==t?void 0:t.icon.light,null==t?void 0:t.icon.dark].map((e=>e?n.attemptFirstFetchAndRetriesAfter(e):Promise.resolve(null)));try{const[e,t,i,o]=yield Promise.all(r);let s=n.banner,l=n.blockingModal;n.banner&&e&&t&&(s=(0,a.default)((0,a.default)({},n.banner),{iconSvg:{light:e,dark:t}})),n.blockingModal&&i&&o&&(l=(0,a.default)((0,a.default)({},n.blockingModal),{iconSvg:{light:i,dark:o}})),n.set({banner:s,blockingModal:l})}catch(e){if(e.name===s.ABORT_ERROR)return;new P.default.UserNoticeError({userNoticeId:n.noticeId,userNoticeContentVersion:n.policyVersion,userNoticeErrorEvent:P.default.USER_NOTICE_ERROR_EVENT.IMAGE_FETCH}).commit(),__LOG__(4,void 0,new Error,!0)`Notice: Icon fetch error : ${e.message}`,SEND_LOGS("notice-icon-fetch-error")}}))()}shouldRetry(e){return 404===e||429===e||e>=500}attemptFirstFetchAndRetriesAfter(e){var t=this;return(0,o.default)((function*(){var n;const i=new r,a=i.signal,o=null!==(n=t.backgroundFetches)&&void 0!==n?n:[];t.backgroundFetches=[...o,i];try{const n=yield(0,y.default)(e,{signal:a});if(!n.ok){const e=n.status;throw t.shouldRetry(e)?new g.HttpStatusCodeError(e,"noticeFetchErr"):new Error("contentResponseUnhandledError")}return n.text()}catch(n){if("HttpStatusCodeError"===n.name)return t.retryFetch(e,n.status);throw n}}))()}retryFetch(e,t){var n,i=this;const a=new r,s=a.signal,c=null!==(n=this.backgroundFetches)&&void 0!==n?n:[];this.backgroundFetches=[...c,a];const u=function(){var t=(0,o.default)((function*(t){__LOG__(2)`Notice: Fetch Retry attempt`;const n=yield(0,y.default)(e,{signal:s});if(!n.ok){if(__LOG__(3)`Notice: Could Not download`,i.shouldRetry(n.status))return t(new Error("retryFailed"));throw new Error("contentResponseUnhandledError")}return n.text()}));return function(){return t.apply(this,arguments)}}();let d,p;return 404===t?(p=2,d=e=>{let{taskDuration:t}=e;const n=w();return Math.max(n-t,0)}):(p=8,d=e=>{let{taskDuration:t}=e;const n=36e5*R();return Math.max(n-t,0)}),(0,l.backoff)({delay:d,retries:p,signal:s},u)}}N.Proxy="notice";var L=new((0,C.defineModel)(N))({id:"default_notice_id"});t.default=L},988258:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PollVote=void 0;var i=r(n(145095)),a=n(719380),o=n(411290),s=n(559871);class l extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.msgKey=(0,o.prop)(),this.parentMsgKey=(0,o.prop)(),this.selectedOptionLocalIds=(0,o.prop)(),this.senderTimestampMs=(0,o.prop)(),this.sender=(0,o.prop)(),this.parentMsg=(0,o.derived)((function(){var e;return(0,i.default)(null===(e=s.MsgCollection.get(this.parentMsgKey))||void 0===e?void 0:e.asPollCreation,"MsgCollection.get(this.parentMsgKey)?.asPollCreation")})),this.senderObj=(0,o.derived)((function(){return a.ContactCollection.gadd(this.sender)}))}getData(){return{msgKey:this.msgKey,parentMsgKey:this.parentMsgKey,selectedOptionLocalIds:this.selectedOptionLocalIds,senderTimestampMs:this.senderTimestampMs,sender:this.sender}}}l.Proxy="poll_vote";const c=(0,o.defineModel)(l);t.PollVote=c},90585:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PollVoteCollectionImpl=t.PollVoteCollection=t.GroupedPollVoteCollection=void 0;var i=r(n(145095)),a=n(988258),o=n(801255);class s extends o.BaseCollection{getVoteFromSender(e){return this.findFirst((t=>t.sender.equals(e)))}}t.GroupedPollVoteCollection=s,s.model=a.PollVote;class l extends o.BaseCollection{constructor(){super(...arguments),this._parentMsgKeyToCollection=new Map}add(e,t){const n=super.add(e,t),r=u(n.filter(Boolean));for(const[e,t]of r)this.getForParent(e).add(t);return n}remove(e,t){const n=super.remove(e,t),r=u(n.filter(Boolean));for(const[e,t]of r)this.getForParent(e).remove(t);return n}reset(){super.reset();for(const e of this._parentMsgKeyToCollection.values())e.reset();this._parentMsgKeyToCollection.clear()}getForParent(e){let t=this._parentMsgKeyToCollection.get(e.toString());return null==t&&(t=new s,t.add(this.filter((t=>t.parentMsgKey.equals(e)))),this._parentMsgKeyToCollection.set(e.toString(),t)),t}}t.PollVoteCollectionImpl=l,l.model=a.PollVote;const c=new l;function u(e){const t=new Map;return e?(e.forEach((e=>{const n=e.parentMsgKey;t.has(n)||t.set(n,[]),(0,i.default)(t.get(n),"parentKeyToVotes.get(key)").push(e)})),t):t}t.PollVoteCollection=c},33e4:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Presence=t.ChatstateCollection=t.Chatstate=void 0,t.processStagesRecursively=m;var i=r(n(23279)),a=n(40234),o=r(n(389867)),s=n(719380),l=n(801255),c=n(411290),u=n(242931),d=r(n(914296)),p=n(548360);class f extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.type=(0,c.prop)(),this.t=(0,c.prop)(),this.deny=(0,c.prop)(),this.updateTime=(0,c.session)(),this.expireTimerId=(0,c.session)()}}f.Proxy="chatstate",f.idClass=o.default;const _=(0,c.defineModel)(f);t.Chatstate=_;class h extends l.BaseCollection{}t.ChatstateCollection=h,h.model=_;class g extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.isOnline=(0,c.session)(!1),this.stale=(0,c.session)(!0),this.hasData=(0,c.session)(!1),this.isSubscribed=(0,c.session)(!1),this.withholdDisplayStage=(0,c.session)(u.WithholdDisplayStage.None),this.forceDisplay=(0,c.session)(!1),this.chatActive=(0,c.session)(!1),this.withholdDisplayTimer=(0,c.session)(),this.forceDisplayTimer=(0,c.session)(),this.chatstate=(0,c.session)(),this.chatstates=(0,c.collection)(h),this.isGroup=(0,c.derived)((function(){return o.default.isGroup(this.id)})),this.isUser=(0,c.derived)((function(){return o.default.isUser(this.id)}))}initialize(){super.initialize();const e=this.isGroup?{id:"",type:"unavailable"}:{id:this.id};this.addChild("chatstate",new _(e)),this.isGroup?this.listenTo(this.chatstates,"add change",(0,i.default)((()=>{let e,t=!1;this.chatstates.forEach((n=>{"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type})),this.set({isOnline:t}),this.chatstate.set({id:e?e.id:"",type:e?e.type:"unavailable"})}))):this.listenTo(this.chatstate,"change:type",(()=>{this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this._handleChatActiveChange)}delete(){super.delete(),this.getCollection().remove(this.id),this.chatstate.delete(),this.chatstates.forEach((e=>e.delete()))}reset(){this.hasData=!1,this.isGroup?this.chatstates.forEach((e=>{e.type="unavailable"})):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})}isActive(){const e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)}getGroupSubtitleText(){if(!this.hasData)return null;if(!this.isGroup)return __LOG__(4,void 0,new Error,!0)`getGroupSubtitleText is used when presence is not for a group`,SEND_LOGS("getGroupSubtitleText-not-group"),null;const e=this._getActiveContact();if(null==e)return null;const t=e.formattedShortName;return"composing"===this.chatstate.type?d.default.t(708,{participant:t}):d.default.t(709,{participant:t})}_getActiveContact(){const e=this.chatstate.id;return e?s.ContactCollection.get(e):null}getUserSubtitleText(){if(!this.hasData)return null;if(!this.isUser)return __LOG__(4,void 0,new Error,!0)`getUserSubtitleText is used when presence is not for a user`,SEND_LOGS("getUserSubtitleText-not-user"),null;const e=this.chatstate;switch(e.type){case"available":return d.default.t(703);case"composing":return p.fbt._("typing…",null,{hk:"49dYir"});case"recording":return p.fbt._("recording audio…",null,{hk:"21blv0"});case"unavailable":return e.deny||null==e.t?null:a.Clock.lastSeenStr(e.t)}}getFormattedString(){return this.hasData?this.isGroup?this.getGroupSubtitleText():this.isUser?this.getUserSubtitleText():null:null}_handleChatActiveChange(){if(this.chatActive){if(this.hasData)this.withholdDisplayStage=u.WithholdDisplayStage.None;else{const e=this._getActiveContact();!0===(null==e?void 0:e.isBusiness)?m(this,[u.WithholdDisplayStage.Business,u.WithholdDisplayStage.Info,u.WithholdDisplayStage.None]):m(this,[u.WithholdDisplayStage.Info,u.WithholdDisplayStage.None])}this.forceDisplayTimer=setTimeout((()=>{this.set({forceDisplay:!0,forceDisplayTimer:void 0})}),2e3)}else this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=void 0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=void 0)}subscribe(){return this.getCollection().find(this.id)}getCollection(){return n(868315).PresenceCollection}}function m(e,t){if(0===t.length)return;const[n,...r]=t;e.set({withholdDisplayStage:n,withholdDisplayTimer:n===u.WithholdDisplayStage.None?null:setTimeout((()=>{m(e,r)}),n===u.WithholdDisplayStage.Business?5e3:1500)})}g.Proxy="presence",g.idClass=o.default;const y=(0,c.defineModel)(g);t.Presence=y},868315:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceCollectionImpl=t.PresenceCollection=void 0;var i=r(n(348926)),a=n(257243),o=n(88555),s=n(564603),l=r(n(389867)),c=n(801255),u=n(33e4),d=n(102253);class p extends c.BaseCollection{_subscribe(e){return(0,i.default)((function*(){const t=n(669951).ChatCollection.get(e);if((0,o.isMDBackend)()&&(0,a.getABPropConfigValue)("trusted_contacts_reciprocity")&&null!=t){const e=null!=t.tcTokenSenderTimestamp&&(0,s.isTokenExpired)(t.tcTokenSenderTimestamp,s.TcTokenMode.Receiver);if(!t.contact.isBusiness&&!e&&!t.contact.isWAContact)return}yield(0,d.subscribePresence)(e,null==t?void 0:t.getTcToken())}))()}_find(e){var t=this;return(0,i.default)((function*(){return!t.gadd(e).isUser||l.default.isServer(e)||l.default.isPSA(e)||(yield t._subscribe(e)),{id:e}}))()}reSubscribeWhenActive(e){var t=this;return(0,i.default)((function*(){const n=t.get(e);null!=n&&!1!==n.isSubscribed&&(yield t._subscribe(e))}))()}clearAllPresence(){this.forEach((e=>{e.reset(),e.set({stale:!0,isSubscribed:!1})}))}}t.PresenceCollectionImpl=p,p.model=u.Presence,p.staleCollection=!0;const f=new p;t.PresenceCollection=f},242931:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WithholdDisplayStage=void 0;const r=n(76672).Mirrored(["Info","Business","None"]);t.WithholdDisplayStage=r},634771:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryFeaturesClass=t.PrimaryFeatures=void 0;var r=n(555452),i=n(411290);class a extends i.BaseModel{constructor(){super(...arguments),this.features=(0,i.prop)(),this.contactExcept=(0,i.prop)(!1),this.reactionsSend=(0,i.prop)(!1),this.ddmSettings=(0,i.prop)(!1),this.clearAndDeleteChatSync=(0,i.prop)(!1),this.viewOnceSpReceiver=(0,i.prop)(!1)}initializeFromLocalStorage(){this._setPrimaryFeatures((0,r.getPrimaryFeatures)())}setPrimaryFeatures(e){(0,r.setPrimaryFeatures)(e),this._setPrimaryFeatures(e)}_setPrimaryFeatures(e){this.features=e;const t=new Set(e);this.contactExcept=t.has("contact_except"),this.reactionsSend=t.has("reactions_send"),this.ddmSettings=t.has("ddm_settings"),this.clearAndDeleteChatSync=t.has("clear_and_delete_chat_sync"),this.viewOnceSpReceiver=t.has("vo_sp_receiver")}}t.PrimaryFeaturesClass=a,a.Proxy="primaryFeatures";const o=new((0,i.defineModel)(a))({id:"1"});t.PrimaryFeatures=o},748694:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrimaryForceUpgradeClass=t.PrimaryForceUpgrade=void 0;var i=n(257243),a=n(781572),o=n(826066),s=n(411290),l=n(634771),c=r(n(11339));class u extends s.BaseModel{constructor(){super(...arguments),this.forceUpgradeReason=(0,s.prop)(),this.shouldForceUpgrade=(0,s.derived)((function(){return null!=this.forceUpgradeReason}),["forceUpgradeReason"])}setup(){this._update(),this.listenTo(a.Cmd,"on_ab_props_update",(()=>{this._update()})),this.listenTo(l.PrimaryFeatures,"change:features",(()=>{this._update()}))}_update(){try{var e;const n=function(){const e=(0,i.getABPropConfigValue)("companion_min_versions");return JSON.parse(e.substr(5)).map((e=>{let{feature:t,min_version:n}=e;return{feature:t,minVersion:n}}))}(),r=new Set(null!==(e=l.PrimaryFeatures.features)&&void 0!==e?e:[]),a=new o.Version(o.SANITIZED_VERSION_STR),s=n.find((e=>{let{feature:t,minVersion:n}=e;return r.has(t)&&a.lt(n)})),u=this.shouldForceUpgrade;var t;if(this.forceUpgradeReason=null==s?void 0:s.feature,!u&&this.shouldForceUpgrade)new c.default.CompanionForceUpgradeUserActionV2({forceUpgradeUserActionV2:c.default.FORCE_UPGRADE_USER_ACTION_TYPE_V2.SHOW,forceUpgradeReasonV2:null!==(t=this.forceUpgradeReason)&&void 0!==t?t:""}).commit();__LOG__(2)`PrimaryForceUpgradeClass: shouldForceUpgrade ${this.shouldForceUpgrade}`}catch(e){__LOG__(4,void 0,new Error,!0)`PrimaryForceUpgradeClass: ${e}`,SEND_LOGS("primary-force-upgrade-error")}}}t.PrimaryForceUpgradeClass=u,u.Proxy="primaryForceUpgrade";const d=new((0,s.defineModel)(u))({id:"1"});t.PrimaryForceUpgrade=d},241601:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROFILE_PIC_COMMAND=t.PP_URL=t.PP_TOK=t.PP_REF=void 0;t.PP_URL="https://web.whatsapp.com/pp";t.PP_REF="/pp";t.PP_TOK="/pp";const n=Object.freeze({REMOVE:"remove",SET:"set"});t.PROFILE_PIC_COMMAND=n},793836:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumb=t.FALLBACK=void 0;var i=r(n(81109)),a=n(88555),o=r(n(376139)),s=n(978820),l=r(n(389867)),c=n(411290),u=n(241601),d=r(n(8425));const p={SINGLE:"SINGLE",GROUP:"GROUP"};t.FALLBACK=p;class f extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.token=(0,c.prop)(),this.tag=(0,c.prop)(),this.raw=(0,c.prop)(),this.eurl=(0,c.prop)(),this.previewEurl=(0,c.prop)(),this.stale=(0,c.session)(!0),this.eurlStale=(0,c.session)(!1),this.pendingPic=(0,c.session)(),this.img=(0,c.derived)((function(){return this.raw?"data:image/jpeg;base64,"+this.raw:!this.tag&&this.stale?null:this.tag?(0,a.isMDBackend)()?this.previewEurl:this.generateUrl("s"):void 0}),["tag","raw","stale","eurl","eurlStale","previewEurl"]),this.imgFull=(0,c.derived)((function(){return!this.raw&&this.tag||!this.stale?!this.raw&&this.tag?(0,a.isMDBackend)()?this.eurl:this.generateUrl("l"):void 0:null}),["tag","raw","stale","eurl","eurlStale"]),this.fallbackType=(0,c.derived)((function(){return l.default.isUser(this.id)?p.SINGLE:(l.default.isGroup(this.id),p.GROUP)}),["id"])}markStale(e){this.stale=!0,(null==e?void 0:e.eurl)&&(this.eurlStale=!0)}validate(){if(this.stale||this.eurlStale)return this.getCollection().update(this.id)}generateUrl(e){let t={t:e,u:this.id.toString(),i:this.tag||"",n:this.token||""};return this.token||(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("profilePicThumb::generateUrl: empty token for profile pic")),d.default.alive&&this.eurl&&!this.eurlStale&&(t=(0,i.default)({e:this.eurl},t)),o.default.build(u.PP_URL,t)}canSet(){if(l.default.isGroup(this.id)){var e;const t=n(669951).ChatCollection.get(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!!this.id.equals((0,s.getMaybeMeUser)())}canDelete(){if(l.default.isGroup(this.id)&&this.tag){var e;const t=n(669951).ChatCollection.assertGet(this.id);return!(null==t||null===(e=t.groupMetadata)||void 0===e?void 0:e.participants.iAmRestrictedMember())}return!(!this.id.equals((0,s.getMaybeMeUser)())||!this.tag)}getCollection(){return n(582039).ProfilePicThumbCollection}}f.Proxy="profilePicThumb",f.idClass=l.default;const _=(0,c.defineModel)(f);t.ProfilePicThumb=_},582039:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbCollectionImpl=t.ProfilePicThumbCollection=void 0;var i=r(n(441609)),a=n(450796),o=r(n(611782)),s=n(492574),l=n(88555),c=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),u=n(491442),d=n(893778),p=r(n(389867)),f=n(745454),_=n(317239),h=n(455981),g=n(801255),m=n(714648),y=n(241601),S=n(793836),E=n(78426);function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}class T extends g.BaseCollection{get(e){const t=super.get(e);if(!this.modelClass.prototype.isIdType(e))return t;const n=super.get((0,o.default)(e.toString()));if(n){if(this.remove(n,{silent:!0}),t&&t.tag)return t;const r=n.toJSON();return r.id=e,this.add(r,{silent:!0,merge:!0})[0]}return t||void 0}saveToCache(){if(!_.Conn.shouldSaveToCache())return;const e=T.cachePolicy.id;let t=this.filter((e=>p.default.isWid(e.id)&&!!e.eurl&&!!e.token));t=t.map((function(e){const t=e.toJSON();return t.id=(0,o.default)(t.id.toString()),t})),__LOG__(2)`models:profilePic:cache-save: ${String(e)}`,u.userPreferencesStore.setCollection(e,t)}initializeFromCache(e){if(!this.length||!e)return;const t=this.reduce(((e,t)=>(e[(0,o.default)(t.id.toString())]=t.id.toString(),e)),new Object);if((0,i.default)(t))return;const n=e.reduce(((e,n)=>(t[n.id]&&(n.id=(0,f.createWid)(t[n.id]),n.stale=!0,n.token&&e.push(n)),e)),[]);this.add(n,{merge:!0})}onResume(){const e=this.filter((e=>{const t=n(669951).ChatCollection.get(e.id);return e.hasObservers()&&e.stale&&(p.default.isUser(e.id)||p.default.isGroup(e.id))&&!(null==t?void 0:t.isReadOnly)})).map((e=>(e.tag||e.unset("tag",{silent:!0}),e)));this.resyncPictures(e)}_find(e){var t,r;const i=n(669951).ChatCollection.get(e),o=(null==i||null===(t=i.groupMetadata)||void 0===t?void 0:t.groupType)===h.GroupType.COMMUNITY,u=n(873213).default.get(e.toString());if((null==i?void 0:i.isReadOnly)&&!o&&null==u||(null==i||null===(r=i.groupMetadata)||void 0===r?void 0:r.terminated))return(0,l.isMDBackend)()?Promise.resolve({id:e,stale:!0}):(0,E.profilePicFindThumbFromPhone)(e,this.get(e)).then((e=>(e.tag||e.raw||(e.eurl=null,e.tag=null,e.raw=null,e.eurlStale=!1),e))).catch((0,a.filteredCatch)(c.ProtoVersionUndefined,(()=>({id:e,stale:!0}))));if((p.default.isUser(e)||p.default.isGroup(e))&&!p.default.isPSA(e)){const t={id:e},n={};return p.default.isGroup(e)&&(o?n.parentGroupId=e:null!=u&&(n.parentGroupId=u.parentGroupId)),(0,E.profilePicFind)(e,n).then((e=>(t.tag=e.tag,t.raw=null,t.eurl=e.eurl,t.eurlStale=!1,t.token=e.token,(0,l.isMDBackend)()&&(t.previewEurl=e.previewEurl),t))).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{switch(e.status){case 401:t.tag="",t.raw=void 0;break;case 423:case 429:t.stale=!0;break;default:t.tag=null,t.eurl=null,t.eurlStale=!1}return Promise.resolve(t)}))).catch((0,a.filteredCatch)(s.WebdDrop,(function(){return{id:e,stale:!0}})))}return Promise.resolve({id:e,tag:null})}imageChanged(e,t){const n=this.get(e);n&&(t===y.PROFILE_PIC_COMMAND.REMOVE?n.set({tag:void 0,eurl:void 0}):t!==y.PROFILE_PIC_COMMAND.SET&&n.tag===t||this.update(n.id).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{}))))}resyncPictures(e){return 0===e.length?Promise.resolve():(0,E.profilePicResync)(e.map((function(e){return{id:e.id,tag:e.tag}}))).then((t=>{__LOG__(2)`ProfilePicThumbStore:resyncPictures success`,t.forEach((t=>{const n=this.get(t.id);n&&n.set({tag:t.tag,token:t.token,raw:void 0,stale:!1,eurl:t.eurl,eurlStale:!1,previewEurl:t.previewEurl}),e.forEach((e=>{e.eurlStale&&this.update(e.id)})),e.forEach((e=>{e.stale=!1}))}))})).catch((0,a.filteredCatch)(s.WebdDrop,(()=>{}))).catch((0,a.filteredCatch)(s.ServerStatusCodeError,(e=>{423===e.status||429===e.status?__LOG__(3)`ProfilePicThumbStore:resyncPictures blocked ${e.status}`:e.status>=400&&__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))).catch((function(e){__LOG__(3)`ProfilePicThumbStore:resyncPictures dropped: ${String(e)}`}))}findThumbnailWid(e){return e.find((e=>{var t;return null===(t=this.get(e))||void 0===t?void 0:t.img}))}getThumbnailWidFromVcard(e){if(!e)return null;const t=(0,d.vcardWids)(e);if(!t)return;const n=this.findThumbnailWid(t);return n||(t.length?t[0]:null)}}t.ProfilePicThumbCollectionImpl=T,T.model=S.ProfilePicThumb,T.staleCollection=!0,T.resumeOnAvailable=!0,T.cachePolicy={id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:m.CACHE_POLICY.LOAD,delay:5e3};const C=new T;t.ProfilePicThumbCollection=C},981130:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSendersCollection=t.ReactionsSenders=t.Reactions=t.AggReactionsCollection=t.AggReactions=void 0;var i=r(n(594654)),a=n(535470),o=r(n(465212)),s=n(867811),l=n(745454),c=n(719380),u=n(411290),d=r(n(631727));class p extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.prop)(),this.msgKey=(0,u.prop)(),this.parentMsgKey=(0,u.prop)(),this.reactionText=(0,u.prop)(),this.timestamp=(0,u.prop)(),this.senderUserJid=(0,u.prop)(),this.read=(0,u.prop)(),this.orphan=(0,u.prop)(),this.ack=(0,u.prop)(),this.isSendFailure=(0,u.prop)(),this.isFailed=(0,u.derived)((function(){return(0,s.isReactionByMe)(this.senderUserJid)&&null!=this.ack&&this.ack<a.ACK.CLOCK||Boolean(this.isSendFailure)}),["ack","isSendFailure"]),this.senderObj=(0,u.session)(),this.parentMsg=(0,u.derived)((function(){return this._getMsgCollection().get(this.parentMsgKey)}))}initialize(){super.initialize(),this.addChild("senderObj",c.ContactCollection.gadd((0,l.createUserWid)(this.senderUserJid)))}_getMsgCollection(){return n(559871).MsgCollection}isEqual(e){return this.id.equals(e.id)}}p.Proxy="reactionsSenders",p.idClass=o.default;const f=(0,u.defineModel)(p);t.ReactionsSenders=f;class _ extends d.default{}t.ReactionsSendersCollection=_,_.model=f,_.comparator=(e,t)=>(0,s.isReactionByMe)(e.senderUserJid)?-1:(0,s.isReactionByMe)(t.senderUserJid)?1:t.timestamp-e.timestamp;class h extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.prop)(),this.aggregateEmoji=(0,u.prop)(),this.hasReactionByMe=(0,u.prop)(),this.senders=(0,u.collection)(_)}}h.Proxy="aggReactions";const g=(0,u.defineModel)(h);t.AggReactions=g;class m extends d.default{}t.AggReactionsCollection=m,m.model=g,m.comparator=(e,t)=>{const n=t.senders.length-e.senders.length;if(e.hasReactionByMe)return-1;if(t.hasReactionByMe)return 1;if(0===n){const n=t.senders.at(0),r=e.senders.at(0);if(n&&r)return n.timestamp-r.timestamp}return n};class y extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.prop)(),this.reactionByMe=(0,u.prop)(),this.reactions=(0,u.collection)(m)}unreadSenders(){return(0,i.default)(this.reactions.toArray(),(e=>e.senders.filter((e=>!e.read&&!(0,s.isReactionByMe)(e.senderUserJid))))).map((e=>{let{id:t,parentMsgKey:n,reactionText:r,senderUserJid:i}=e;return{msgKey:t,parentMsgKey:o.default.fromString(n),reactionText:r,senderUserJid:i}}))}getReactionSenderModel(e,t){const n=this.reactions.get(e);return null==n?void 0:n.senders.findFirst((e=>e.senderUserJid===t))}getCollection(){return n(257162).ReactionsCollection}}y.Proxy="reactions",y.idClass=o.default;const S=(0,u.defineModel)(y);t.Reactions=S},257162:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsCollectionImpl=t.ReactionsCollection=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(551737),s=n(535470),l=r(n(465212)),c=n(867811),u=n(981130),d=n(15665),p=n(767247),f=n(801255);class _ extends f.BaseCollection{_find(e){return(0,a.default)((function*(){const t=n(559871).MsgCollection,r=t.get(e);if(!r){const{messages:n}=yield t.getMessagesById([e]),r=n[0];return r?(0,d.sendQueryReactions)(r):Promise.reject(new f.CollectionSilentQueryError(`No message found for id: ${e}`))}return(0,d.sendQueryReactions)(r)}))()}addOrUpdateReaction(e){if(e.reactionText===c.REVOKED_REACTION_TEXT)return this.removeReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionSenderModel:n,reactionAggregateWithSender:r}=this.getAggregateEmojiAndSender(t,e.senderUserJid);if(r&&n)return e.timestamp>n.timestamp?((0,c.isReactionByMe)(e.senderUserJid)&&(n.trigger("revoked"),r.set({hasReactionByMe:!1})),this._addNewReactionToAggregate(e,t),void(r.aggregateEmoji===p.EmojiUtil.getEmojiAggregate(e.reactionText)?(r.senders.remove(n.id),t.reactions.trigger("change:senders")):this._removeAggregateEmojiAndSender(t,n,r))):void 0;this._addNewReactionToAggregate(e,t)}}removeReaction(e){if((0,c.isReactionByMe)(e.senderUserJid))return this._removeSelfReaction(e);const t=this.get(e.parentMsgKey);if(t){const{reactionAggregateWithSender:n,reactionSenderModel:r}=this.getAggregateEmojiAndSender(t,e.senderUserJid);n&&r&&(this._removeAggregateEmojiAndSender(t,r,n),r.trigger("revoked"))}else __LOG__(3)`reactions_collection:removeReaction no reactions model found`}_addNewReactionToAggregate(e,t){const n=p.EmojiUtil.getEmojiAggregate(e.reactionText),r=t.reactions.get(n),a=l.default.fromString(e.msgKey),o=(0,i.default)((0,i.default)({},e),{},{id:a}),s=(0,c.isReactionByMe)(e.senderUserJid);r?(s&&(r.set({hasReactionByMe:!0}),t.set({reactionByMe:e})),r.senders.add(o),t.reactions.sort(),r.trigger("change:senders")):(s&&t.set({reactionByMe:e}),t.reactions.add({aggregateEmoji:n,hasReactionByMe:s,id:n,senders:[o]}))}_removeAggregateEmojiAndSender(e,t,n){n.senders.remove(t.id),0===n.senders.length?e.reactions.remove(n.id):e.reactions.sort(),n.trigger("change:senders")}getAggregateEmojiAndSender(e,t){let n=null,r=null;for(let i=0;i<e.reactions.length;i++){const a=e.reactions.at(i),o=null==a?void 0:a.senders.findFirst((e=>e.senderUserJid===t));if(o){n=o,r=a;break}}return{reactionSenderModel:n,reactionAggregateWithSender:r}}_removeSelfReaction(e){const t=this.get(e.parentMsgKey);if(null==t||t.set({reactionByMe:null}),t){const{reactionAggregateWithSender:n,reactionSenderModel:r}=this.getAggregateEmojiAndSender(t,e.senderUserJid);null==n||n.set({hasReactionByMe:!1}),n&&r&&(this._removeAggregateEmojiAndSender(t,r,n),r.trigger("revoked"))}}markReactionsAsRead(e){e.forEach((e=>{const{parentMsgKey:t,msgKey:n,reactionText:r}=e,a=p.EmojiUtil.getEmojiAggregate(r),o=this.get(t);if(o){const e=o.reactions.get(a),t=null==e?void 0:e.senders.get(n);t?t.set((0,i.default)((0,i.default)({},t),{},{read:!0})):__LOG__(3)`reactions_collection:markReactionsAsRead Reaction sender model not found`}}))}getExistingSenderModelFromReactionDetails(e){const{parentMsgKey:t,msgKey:n,reactionText:r}=e,i=p.EmojiUtil.getEmojiAggregate(r),a=this.get(t);if(a){const e=a.reactions.get(i);return null==e?void 0:e.senders.get(n)}__LOG__(3)`reactions_collection:getExistingSenderModelFromReactionDetails Reactions sender model not found for this message id`}updateFailedPropsForExistingSentReaction(e,t,n){const r=this.getExistingSenderModelFromReactionDetails(e);if(r){const e={};null!=t&&(e.ack=t),null!=n&&(e.isSendFailure=n),r.set((0,i.default)((0,i.default)({},r),e))}}shouldUpdateAck(e,t){const n=this.getExistingSenderModelFromReactionDetails(e);if(n){const e=n.ack;return!(!(0,o.isNumber)(t)||!(void 0===e||null==e||t>e||t===s.ACK.FAILED))}return __LOG__(3)`reactions_collection:shouldUpdateAck Reaction sender model not found`,!1}deleteReactionsByParentMessageKey(e){this.remove(e)}}t.ReactionsCollectionImpl=_,_.model=u.Reactions;const h=new _;t.ReactionsCollection=h},313274:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.reactionText=(0,r.prop)(),this.timestamp=(0,r.prop)()}}i.Proxy="recentReaction";var a=(0,r.defineModel)(i);t.default=a},505104:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentReactionsCollectionImpl=t.RecentReactionsCollection=t.RECENT_REACTIONS_LIMIT=t.LISTENER_DEBOUNCE_WAIT=void 0;var i=r(n(23279)),a=n(546718),o=r(n(313274)),s=n(801255),l=n(714648);t.RECENT_REACTIONS_LIMIT=16;t.LISTENER_DEBOUNCE_WAIT=100;class c extends s.BaseCollection{constructor(){super(),this.listenTo(this,"add",(0,i.default)(this._sortTrim,100))}_find(e){return Promise.resolve(e)}_sortTrim(){const e=this.length;e&&(this.sort(),e>16&&this.remove(this.slice(16)))}}t.RecentReactionsCollectionImpl=c,c.model=o.default,c.cachePolicy={id:a.KEYS.RECENT_REACTIONS_COLLECTION,policy:l.CACHE_POLICY.LOAD,delay:2e3},c.comparator=(e,t)=>t.timestamp-e.timestamp;const u=new c;t.RecentReactionsCollection=u},53988:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(null==e)return i.default.MEDIA_TYPE.NONE;switch(e){case a.default.SHOPS_STOREFRONT:return i.default.MEDIA_TYPE.SHOP_STOREFRONT;case a.default.NATIVE_FLOW:return i.default.MEDIA_TYPE.INTERACTIVE_NFM}};var i=r(n(11339)),a=r(n(384064))},726287:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getNativeFlowNameByButtonName=function(e){switch(e){case"review_and_pay":return o.default.ORDER_DETAILS;case"review_order":return o.default.ORDER_STATUS}},t.isValidNativeFlowMessage=void 0;var i=n(834841),a=n(988998),o=r(n(905165));t.isValidNativeFlowMessage=e=>{if(null==e.nativeFlowName)return!1;switch(e.nativeFlowName){case o.default.ORDER_DETAILS:return null!=(0,i.getOrderInfo)(e);case o.default.ORDER_STATUS:return null!=(0,a.getOrderStatusInfo)(e)}}},834841:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderInfo=t.getOrderInfo=t.getCustomItemIdPrefix=void 0;var i=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=l(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(979158)),a=n(115461),o=r(n(384064)),s=r(n(905165));function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(l=function(e){return e?n:t})(e)}function c(e){var t;const n=null==e?void 0:e.value;if(null==n)return;const r=null!==(t=null==e?void 0:e.offset)&&void 0!==t?t:1;return parseFloat(null!=n?n:0)/parseInt(r,10)}const u=()=>"custom-item";t.getCustomItemIdPrefix=u;const d=(e,t)=>{var n,r;if("review_and_pay"!==e||null==t)return null;const a=i.parse(t),{order:o,currency:s,reference_id:l}=a,u=c(a.total_amount),d=null!==(n=null==o?void 0:o.items)&&void 0!==n?n:[],p=d.map((e=>{var t,n,r,i,a,o,s;return{id:null!==(t=null!==(n=null==e?void 0:e.product_id)&&void 0!==n?n:null==e?void 0:e.retailer_id)&&void 0!==t?t:"",name:null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"",amount:c(null==e?void 0:e.amount),quantity:parseInt(null!==(i=null==e?void 0:e.quantity)&&void 0!==i?i:0,10),isCustomItem:null!==(a=null==e?void 0:e.isCustomItem)&&void 0!==a?a:0===(null==e||null===(o=e.retailer_id)||void 0===o?void 0:o.indexOf("custom-item")),isQuantitySet:null===(s=null==e?void 0:e.isQuantitySet)||void 0===s||s}})),f=p.reduce(((e,t)=>e+t.quantity),0),_=null===(r=d[0])||void 0===r?void 0:r.name;if(null==_||null==l||null==s||null==u)return null;return{title:_,referenceId:l,currency:s,quantity:f,shipping:c(null==o?void 0:o.shipping),tax:c(null==o?void 0:o.tax),discount:c(null==o?void 0:o.discount),subtotal:c(null==o?void 0:o.subtotal),totalAmount:u,items:p,type:a.type}};t.paramsJsonToOrderInfo=d;t.getOrderInfo=e=>{var t;if(e.nativeFlowName!==s.default.ORDER_DETAILS)return null;if(e.type===a.MSG_TYPE.INTERACTIVE&&e.interactiveType===o.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:n}=e.interactivePayload.buttons[0];return d(t,n)}if(e.type===a.MSG_TYPE.NATIVE_FLOW){var n;const{nativeFlowInfo:t}=(null!==(n=e.nativeFlowButtons)&&void 0!==n?n:[])[0];return d(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}}},988998:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.paramsJsonToOrderStatusInfo=t.getOrderStatusInfo=t.getOrderMessage=t.getDefaultOrderStatus=t.findOrderStatusMessage=t.findOrderStatus=t.findOrderDetailsMessage=t.OrderStatus=void 0;var i=r(n(530988)),a=n(115461),o=n(834841),s=r(n(384064)),l=r(n(905165));const c=n(76672)({Pending:"pending",Processing:"processing",PartiallyShipped:"partially_shipped",Shipped:"shipped",Complete:"completed",Canceled:"canceled"});t.OrderStatus=c;const u=(e,t)=>{if("review_order"!==e||null==t)return null;const{order:n,reference_id:r}=JSON.parse(t),i=c.cast(null==n?void 0:n.status);return null==i||null==r?null:{refId:r,status:i}};t.paramsJsonToOrderStatusInfo=u;const d=e=>{var t;if(e.nativeFlowName!==l.default.ORDER_STATUS)return null;if(e.type===a.MSG_TYPE.INTERACTIVE&&e.interactiveType===s.default.NATIVE_FLOW&&(null===(t=e.interactivePayload)||void 0===t?void 0:t.buttons)){const{name:t,buttonParamsJson:n}=e.interactivePayload.buttons[0];return u(t,n)}if(e.type===a.MSG_TYPE.NATIVE_FLOW){var n;const{nativeFlowInfo:t}=(null!==(n=e.nativeFlowButtons)&&void 0!==n?n:[])[0];return u(null==t?void 0:t.name,null==t?void 0:t.paramsJson)}};t.getOrderStatusInfo=d;const p=(e,t)=>{var n;const r=e.msgs.getModelsArray().slice(-1e3);return null===(n=(0,i.default)(r,(e=>{var n;return e.nativeFlowName===l.default.ORDER_DETAILS&&(null===(n=(0,o.getOrderInfo)(e))||void 0===n?void 0:n.referenceId)===t})))||void 0===n?void 0:n.safe()};t.findOrderDetailsMessage=p;t.getOrderMessage=e=>{var t;const n=null===(t=d(e))||void 0===t?void 0:t.refId;return null==n?null:p(e.chat,n)};const f=(e,t)=>{var n;const r=e.msgs.getModelsArray().slice(-1e3);return null===(n=(0,i.default)(r,(e=>{var n;return e.nativeFlowName===l.default.ORDER_STATUS&&(null===(n=d(e))||void 0===n?void 0:n.refId)===t})))||void 0===n?void 0:n.safe()};t.findOrderStatusMessage=f;const _=()=>c.Pending;t.getDefaultOrderStatus=_;t.findOrderStatus=(e,t)=>{var n;const r=f(e,t),i=null!=r?d(r):null;return null!==(n=null==i?void 0:i.status)&&void 0!==n?n:_()}},390837:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateOrderAndSendReceipt=void 0;var r=n(988998),i=n(599326),a=n(669951);const o=new Set([r.OrderStatus.Complete,r.OrderStatus.Canceled]);t.validateOrderAndSendReceipt=(e,t)=>{if(!e)return!0;const n=a.ChatCollection.get(e.remote.toString());if(!n)return!0;const s=(0,r.getOrderStatusInfo)(t);if(!s)return!0;const l=(0,r.findOrderStatusMessage)(n,s.refId);if(!l)return!0;const c=(0,r.getOrderStatusInfo)(l);if(!c)return!0;if(c.status===s.status)return!1;const u=s.status!==(0,r.getDefaultOrderStatus)()&&!o.has(c.status);return u||(0,i.sendOrderStatusUpdateFailureReceipt)(e.id,e.remote,i.BizErrorReason.InvalidTransition),u}},599326:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BizErrorReason=void 0,t.sendOrderStatusUpdateFailureReceipt=function(e,t,n){(0,r.castStanza)((0,i.wap)("receipt",{type:"error",to:(0,i.CUSTOM_STRING)(t.toJid()),id:(0,i.CUSTOM_STRING)(e)},(0,i.wap)("biz",{reason:(0,i.CUSTOM_STRING)(String(n))}),(0,i.wap)("error",{type:"order-status-update-failed"})))};var r=n(736184),i=n(831914);const a=n(76672)({InvalidTransition:"invalid-transition",CancellationFailed:"cancellation-failed"});t.BizErrorReason=a},284728:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VIEW_ONCE_EXPIRE_AFTER=void 0,t.isExpired=c,t.isUnviewed=function(e){return!l(e)&&!c(e)},t.isViewed=l,t.setViewOnceTestExpire_INTERNAL=function(){};var r=n(535470),i=n(40234),a=n(118146);let o=1209600;function s(e){const t=(0,a.unproxy)(e);return null!=t?t.asViewOnce:null}function l(e){var t;return(null===(t=s(e))||void 0===t?void 0:t.ack)===r.ACK.PLAYED}function c(e){const t=s(e);if(null==t)return!1;const n=i.Clock.globalUnixTime()-(0,a.unproxy)(t).t;return!l(t)&&n>=o}t.VIEW_ONCE_EXPIRE_AFTER=o},964551:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.UNINITIALIZED_VALUE_WEB_BIZ_PROFILE_OPTIONS=t.ServerPropsImpl=t.ServerProps=t.DEFAULT_MAX_FILE_SIZE_BYTES=void 0,t.getMaxFilesSizeServerProp=function(){return S.maxFileSize};var i=n(310206),a=n(438184),o=r(n(177853)),s=n(240264),l=n(411290),c=r(n(11339));const u={imageMaxKBytes:function(e){if("number"==typeof e&&e>0)return 1024*e},pttConversationWaveform:function(e){return Boolean(e)},pttOotPlayback:function(e){return Boolean(e)},pttRememberPlayPosition:function(e){return Boolean(e)},pttWaveformSend:function(e){return Boolean(e)},pttPausableEnabled:function(e){return Boolean(e)},pttForwardedFeaturesEnabled:function(e){return Boolean(e)},maxParticipants:function(e){if("number"==typeof e&&e>0)return e-1},media:h,maxElectronFileSize:_,maxFileSize:_,streamingUploadChunkSize:h,groupDescLength:g,statusVideoMaxDuration:g,muteAlways:m,ctwaContextRender:m,serverPropsVersion:g,wallpapersV2:m,hfmStringChanges:m,webServerStickerPanel:m,shopsProductGrid:m,stickerMaker:function(e){return Boolean(e)},downloadHostSwitchingEnabled:function(e){return Boolean(e)},uploadHostSwitchingEnabled:function(e){return Boolean(e)},webUploadDocumentThumbMmsEnabled:y,webDownloadDocumentThumbMmsEnabled:y,webDownloadStatusThumbMmsEnabled:function(e){return!!(0,i.isFeatureEnabled)("download_status_thumb_mms")&&Boolean(e)}},d=104857600;t.DEFAULT_MAX_FILE_SIZE_BYTES=d;t.UNINITIALIZED_VALUE_WEB_BIZ_PROFILE_OPTIONS=3;const p=604800;class f extends l.BaseModel{constructor(){super(...arguments),this.serverPropsVersion=(0,l.prop)(),this.gifSearch=(0,l.prop)(!1),this.imageMaxEdge=(0,l.prop)(1600),this.imageMaxKBytes=(0,l.prop)(1048576),this.maxParticipants=(0,l.prop)(101),this.maxSubject=(0,l.prop)(25),this.media=(0,l.prop)(16777216),this.maxElectronFileSize=(0,l.prop)(d),this.maxFileSize=(0,l.prop)(d),this.streamingUploadChunkSize=(0,l.prop)(0),this.groupDescLength=(0,l.prop)(0),this.multicastLimitGlobal=(0,l.prop)(5),this.frequentlyForwardedThreshold=(0,l.prop)(5),this.frequentlyForwardedMax=(0,l.prop)(1),this.ephemeralMessagesAllowedValues=(0,l.prop)("604800"),this.productMediaAttachments=(0,l.prop)(!1),this.muteAlways=(0,l.prop)(!1),this.wallpapersV2=(0,l.prop)(!1),this.hfmStringChanges=(0,l.prop)(!1),this.mmsVCacheAggregationEnabled=(0,l.prop)(!1),this.mmsHotContentTimespan=(0,l.prop)(0),this.mmsCatV1ForwardHotOverrideEnabled=(0,l.prop)(!1),this.pttConversationWaveform=(0,l.prop)(!1),this.pttOotPlayback=(0,l.prop)(!1),this.pttPausableEnabled=(0,l.prop)(!1),this.pttPlaybackSpeedEnabled=(0,l.prop)(!1),this.pttPlaybackSpeedHideDelay=(0,l.prop)(1500),this.pttWaveformSend=(0,l.prop)(!1),this.pttRememberPlayPosition=(0,l.prop)(!1),this.pttForwardedFeaturesEnabled=(0,l.prop)(!1),this.templateDocMimeTypes=(0,l.prop)(1),this.mmsMediaKeyTTL=(0,l.prop)(1/0),this.vcardAsDocumentSizeKb=(0,l.prop)(0),this.vcardMaxSizeKb=(0,l.prop)(1e3),this.mmsVcardAutodownloadSizeKb=(0,l.prop)(1024),this.webUploadDocumentThumbMmsEnabled=(0,l.prop)(!1),this.webDownloadDocumentThumbMmsEnabled=(0,l.prop)(!1),this.webSendDocumentThumbInMessageDisabled=(0,l.prop)(!1),this.webDownloadStatusThumbMmsEnabled=(0,l.prop)(!1),this.statusVideoMaxDuration=(0,l.prop)(30),this.groupCallMaxParticipants=(0,l.prop)(0),this.webVoipMacOsMinVersion=(0,l.prop)(""),this.webVoipWindowsOsMinVersion=(0,l.prop)(""),this.ctwaContextRender=(0,l.prop)(!1),this.ctwaContextCompose=(0,l.prop)(!1),this.syncdInlineMutationsMaxCount=(0,l.prop)(1e3),this.syncdPatchProtobufMaxSize=(0,l.prop)(100),this.syncdKeyMaxUseDays=(0,l.prop)(30),this.syncdWaitForKeyTimeoutDays=(0,l.prop)(2),this.syncdAdditionalMutations=(0,l.prop)(1),this.syncdSentinelTimeoutSeconds=(0,l.prop)(3),this.syncdPatchDeviceIndexIncluded=(0,l.prop)(!1),this.syncdClearChatDeleteChatEnabled=(0,l.prop)(!1),this.syncdPinChatEnabled=(0,l.prop)(!1),this.syncdQPLLoggingEnabled=(0,l.prop)(!1),this.webPaymentBackgroundEnabled=(0,l.prop)(!1),this.webBizProfileOptions=(0,l.prop)(3),this.webBizProfileEdit=(0,l.prop)(!1),this.webBizProfileV3Enabled=(0,l.prop)(!1),this.webBizProfileV3M2=(0,l.prop)(!1),this.webShopsChatHeaderButtonEnabled=(0,l.prop)(!1),this.shopsHideCatalogAttachmentEntrypoint=(0,l.prop)(!1),this.shopsHeaderDropdownMenuItem=(0,l.prop)(!1),this.shopsProductGrid=(0,l.prop)(!1),this.webListMessage=(0,l.prop)(!1),this.webButtonsMessage=(0,l.prop)(!1),this.greenAlertBannerDuration=(0,l.prop)(0),this.webSMBUpsellInBizProfile=(0,l.prop)(!1),this.webProductListMessage=(0,l.prop)(!1),this.webProductListMessageRenderKillSwitch=(0,l.prop)(!1),this.webProductListMessagePageSize=(0,l.prop)(s.PRODUCT_PAGE_SIZE),this.webMediaAutoDownloadEnabled=(0,l.prop)(!1),this.webYouTubePlayerEnhancements=(0,l.prop)(!1),this.webServerStickerPanel=(0,l.prop)(!1),this.webCollectionsDisplay=(0,l.prop)(!1),this.webCollectionsManagement=(0,l.prop)(!1),this.webCollectionsAppealEnabled=(0,l.prop)(!1),this.webCartOnOffToggle=(0,l.prop)(!1),this.downloadHostSwitchingEnabled=(0,l.prop)(!1),this.uploadHostSwitchingEnabled=(0,l.prop)(!1),this.isDirectConnectionForPLMTransparent=(0,l.prop)(!0),this.webPipRedesign=(0,l.prop)(!1),this.blockCatalogCreationEcommerceComplianceIndia=(0,l.prop)(!1),this.ecommerceComplianceIndia=(0,l.prop)(!1),this.editEcommerceComplianceIndia=(0,l.prop)(!1),this.smbEcommerceComplianceIndiaM4=(0,l.prop)(!1),this.smbEcommerceComplianceIndiaM4_5=(0,l.prop)(!1),this.webMdMigrationExperience=(0,l.prop)(!1),this.stickerMaker=(0,l.prop)(!1),this.webLogUploadDownloadCrashes=(0,l.prop)(!1),this.webLargeFilesUi=(0,l.prop)(!1),this.webMdMmsSyncDeletionRequest=(0,l.prop)(!0),this.webLegacyUsersShouldUpdatePrimaryExperience=(0,l.prop)(!1),this.winUwpDeprecationKillswitchEnabled=(0,l.prop)(!1),this.maxKeys=(0,l.prop)(200)}delete(){super.delete(),this.updateProps({})}initialize(){super.initialize()}updateProps(e){let t=e;c.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let n=t[e];void 0===n?n="serverPropsVersion"===e?this.serverPropsVersion:this.getDefault(e):u[e]&&(n=u[e](n),void 0===n&&(n=this.getDefault(e))),this.set(e,n)}));for(const e in a.LegacyPhoneFeatures.F)void 0!==t[e]&&a.LegacyPhoneFeatures.setFeature(e,t[e])}updateSelectiveProps(e){let t=e;c.default.Global.webcBucket=t.bucket||null,this.__props.forEach((e=>{let n=t[e];void 0!==n&&(u[e]&&(n=u[e](n),void 0===n&&(n=this.getDefault(e))),this.set(e,n))}));for(const n in a.LegacyPhoneFeatures.F)void 0!==t[n]&&a.LegacyPhoneFeatures.setFeature(n,e[n])}extendAndOverrideFromURLParams(e){const t=new o.default(window.location.search),n=e;return this.__props.forEach((e=>{if(!0===t.has(e)){const r=t.get(e);if(null==r)return;"true"===r||"false"===r?n[e]="true"===r:isNaN(r)||isNaN(parseFloat(r))?n[e]=r:n[e]=parseFloat(r)}})),n}_handlePayload(e){"number"==typeof e.status&&e.status>=400||this.updateProps(e)}handle(e){const t=e.shift();this._handlePayload(t)}getGroupCallMaxParticipants(){return this.groupCallMaxParticipants}getEphemeralMessagesAllowedValues(){try{return this.ephemeralMessagesAllowedValues.split(",").map((e=>parseInt(e,10)))}catch(e){return __LOG__(4,void 0,new Error,!0)`[ephemeral] incorrect type for ephemeralMessagesAllowedValues`,SEND_LOGS("ephemeral"),[p]}}}function _(e){return h(e)}function h(e){if("number"==typeof e&&e>0)return 1024*e*1024}function g(e){if("number"==typeof e&&e>0)return e}function m(e){if("number"==typeof e)return!!e}function y(e){return Boolean(e)}t.ServerPropsImpl=f,f.Proxy="serverProps";const S=new((0,l.defineModel)(f))({id:"1"});t.ServerProps=S},268132:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(450796),i=n(492574),a=n(408139),o=n(411290),s=n(580208);const l={classic:!1,enabled:!1},c={timestamp:0};class u extends o.BaseModel{constructor(){super(...arguments),this.id=(0,o.prop)(),this.archive=(0,o.prop)(),this.disappearingMode=(0,o.prop)(),this.mdOptInDeadline=(0,o.prop)(),this.showArchiveV2=(0,o.derived)((function(){return!!this.archive.enabled&&!this.archive.classic}),["archive","enabled"])}delete(){this.set({archive:l,disappearingMode:l,mdOptInDeadline:c}),super.delete()}handleResponse(e){e.length?e.forEach((e=>{switch(__LOG__(2)`Settings: received setting type: ${e.type}`,e.type){case s.ARCHIVE_SETTINGS_KEY:var t;if(!(0,a.archiveV2Supported)()){__LOG__(4,void 0,new Error,!0)`Settings:handleResponse archive settings response is unsupported`,SEND_LOGS("archive-setting-unsupported");break}this.set({archive:{classic:e.value.classic,enabled:null!==(t=e.value.enabled)&&void 0!==t?t:this.archive.enabled}});break;case s.DISAPPEARING_MODE_SETTINGS_KEY:this.set({disappearingMode:{duration:e.value.duration,settingTimestamp:e.value.settingTimestamp}});break;case s.MD_OPT_IN_DEADLINE_SETTINGS_KEY:this.set({mdOptInDeadline:{timestamp:e.value.timestamp}})}})):__LOG__(2)`Settings: received empty settings`,n(196876).default.processMdOptInDeadline()}sync(e){const t="Settings:sync"+(e?" resume":"");__LOG__(2)`${t}`;return(0,n(656891).default.querySettings)(e).then((e=>{200===e.status?(__LOG__(2)`${t} success`,this.handleResponse(e.settings)):__LOG__(3)`${t} error receive status code ${e.status}`})).catch((0,r.filteredCatch)(i.WebdDrop,(function(){__LOG__(3)`${t} dropped`}))).catch((e=>{__LOG__(4,void 0,new Error,!0)`${t} failed with error: ${e}`,SEND_LOGS("settings-query-failed")}))}}u.Proxy="settings";var d=new((0,o.defineModel)(u))({id:"default_settings_id",archive:l,disappearingMode:{duration:0,settingTimestamp:0},mdOptInDeadline:c});t.default=d},719011:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredMsgCollection=t.AllStarredMsgsCollection=void 0,t.addStarredMsgs=function(e){p.add(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}))},t.removeStarredMsgs=f;var i=r(n(145095)),a=n(813042),o=n(801255),s=n(17304),l=n(559871),c=n(765044),u=n(662583);class d extends o.BaseCollection{constructor(){super(),this.syncPromise=null,this.isSynced=!1,this.listenTo(c.Socket,"change:stream",(()=>{c.Socket.stream===u.SOCKET_STREAM.DISCONNECTED?this.isSynced=!1:c.Socket.stream===u.SOCKET_STREAM.CONNECTED&&this.delete()}))}process(e,t,n,r){r?this.delete():this.updateMsgs(e,t,n)}sync(e){if(this.isSynced)return Promise.resolve();if(null!=this.syncPromise)return this.syncPromise;const t=this;let n;const r=this.last();return r&&(n=r.id),this.syncPromise=l.MsgCollection.getStarred(e,a.PAGE_SIZE,n).then((function(e){e.length&&t.add(e,{silent:!0}),e.length<a.PAGE_SIZE&&(t.isSynced=!0)})).catch((function(){__LOG__(3)`starred msg sync error: `})).finally((()=>{t.syncPromise=null,t.trigger("sync")})),this.trigger("sync"),(0,i.default)(this.syncPromise,"syncPromise can not be null")}updateMsgs(e,t,n){const r=this.syncPromise||Promise.resolve();this.syncPromise=r.then((()=>{if(e){return(t.length>0?l.MsgCollection.incrementalStarredUpdate(t):Promise.resolve([])).then((e=>{const t=e.concat(n);this.isSynced&&this.add(t,{silent:!0}),t.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.add(e)})),this.trigger("sync")})).catch((()=>{__LOG__(3)`models:starred:update:error: `}))}f(t.concat(n).filter((e=>!e.star)))})).finally((()=>{this.syncPromise=null}))}delete(){this.isSynced=!1,super.delete()}}t.StarredMsgCollection=d,d.model=s.Msg,d.comparator=(e,t)=>t.t-e.t;const p=new d;function f(e){p.remove(e),e.forEach((e=>{e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}))}t.AllStarredMsgsCollection=p},167234:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(389867)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.id=(0,a.prop)(),this.status=(0,a.prop)(),this.stale=(0,a.session)(!0)}getCollection(){return n(46133).StatusCollection}}o.Proxy="status",o.idClass=i.default;var s=(0,a.defineModel)(o);t.default=s},46133:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCollectionImpl=t.StatusCollection=void 0;var i=n(450796),a=n(492574),o=n(994059),s=r(n(389867)),l=n(745454),c=n(801255),u=r(n(167234));class d extends c.BaseCollection{onResume(){this.filter((e=>e.hasObservers())).forEach((e=>{this.find(e.id).catch((0,i.filteredCatch)(a.WebdDrop,(()=>{})))}))}_find(e){const t=e instanceof s.default?e:(0,l.createWid)(e);return(0,o.getStatus)(t)}handle(e){let[t]=e;const n=this.get(t.id);n&&(n.status=t.status,n.stale=!1)}}t.StatusCollectionImpl=d,d.model=u.default,d.idClass=s.default,d.staleCollection=!0,d.resumeOnAvailable=!0;const p=new d;t.StatusCollection=p},532591:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPSACampaigns=a,t.getPsaCampaignIndex=function(e,t){if(0===t.length)return-1;let n=0,r=t[0].campaignId;for(let i=1;i<t.length;i++){const{id:a,campaignId:o}=t[i];if(r!==o?(r=o,n=0):n++,a.toString()===e.toString())return n}return-1},t.getPsaCampaignsString=function(e){const t=a(e),n=[];return Object.keys(t).forEach((e=>{const r=t[e],{numberOfStatus:i,numberOfReadStatus:a}=r;n.push(`${e}:${i-a}`)})),n.join(",")},t.isCampaignExpired=o,t.isExpiredStatusPSA=function(e,t){const n=a(e);return Object.keys(n).every((e=>o(n[e],t)))};var r=n(892844),i=n(40234);function a(e){const t={};return e.forEach((e=>{let{t:n,campaignId:r,campaignDuration:i,statusPSAReadTimestamp:a}=e;if(!r)return;t[r]||(t[r]={id:r,t:n,duration:i,firstReadTimestamp:null,numberOfStatus:0,numberOfReadStatus:0});const o=t[r];o.numberOfStatus++,null!=a&&(o.numberOfReadStatus++,(null==o.firstReadTimestamp||a<o.firstReadTimestamp)&&(o.firstReadTimestamp=a))})),t}function o(e,t){const n=e.firstReadTimestamp;if(null!=n)return(0,r.castToUnixTime)(i.Clock.globalUnixTime()-n)>t;const a=e.duration;return null!=a&&i.Clock.globalUnixTime()-e.t>a}},547896:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(485074)),o=n(40234),s=n(813042),l=r(n(389867)),c=n(532591),u=n(546898),d=n(719380),p=n(411290),f=r(n(558492));const _=86400;class h extends f.default{constructor(){super(...arguments),this.id=(0,p.prop)(),this.t=(0,p.prop)(),this.unreadCount=(0,p.prop)(0),this.totalCount=(0,p.prop)(0),this.pic=(0,p.prop)(),this._msgs=(0,p.prop)((()=>[])),this.readKeys=(0,p.session)((()=>({}))),this.contact=(0,p.session)(),this.expireTimer=(0,p.session)(),this.expireTs=(0,p.session)(),this.hasUnread=(0,p.derived)((function(){return this.unreadCount>0}),["unreadCount"]),this.readCount=(0,p.derived)((function(){const e=this.totalCount-this.unreadCount;return Number.isFinite(e)?e:(__LOG__(3)`Bad status v3 read count, ${this.totalCount}, ${this.unreadCount}`,0)}),["unreadCount","totalCount"]),this.lastStatus=(0,p.derived)((function(){return this.msgs.last()}),["msgsChanged","totalCount"])}initialize(){super.initialize(),this.addChild("contact",d.ContactCollection.gadd(this.id)),this.listenTo(this.msgs,"add bulk_add",(()=>{window.setTimeout((()=>{this.setupStatusExpiration()}))})),this.listenTo(this,"change:lastStatus",(()=>{this.lastStatus&&(this.t=this.lastStatus.t)}))}isExpired(){return this.id.isPSA()?(0,c.isExpiredStatusPSA)(this.msgs.toArray(),_):o.Clock.globalUnixTime()-this.t>_}setupStatusExpiration(){const e=this.msgs.at(0);if(!e)return;if("number"==typeof this.expireTs&&this.expireTs<=e.t)return;const t=e.t+_+1;t<o.Clock.globalUnixTime()?window.setTimeout((()=>{this.expireMsg()})):(this.expireTimer=a.default.setGlobalTimeout(this.expireMsg.bind(this),1e3*t,this.expireTimer),this.expireTs=e.t)}_removeSingleMsg(e){const t=this.msgs;this.unreadCount>this.totalCount-1&&this.unreadCount--,this.totalCount--,t.remove(e),e.delete()}expireMsg(){if(this.id.isPSA())return void this.expirePSAMsg();const e=this.msgs;for(;e.length>0;){const t=e.at(0);if(!t)break;if(t.t+_>o.Clock.globalUnixTime())break;this._removeSingleMsg(t)}this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}expirePSAMsg(){const e=(0,c.getPSACampaigns)(this.msgs.toArray());this.msgs.forEach((t=>{const{campaignId:n}=t;if(null==n)return;(0,c.isCampaignExpired)(e[n],_)&&this._removeSingleMsg(t)})),this.expireTs=void 0,this.expireTimer=void 0,0!==this.totalCount&&this.setupStatusExpiration()}revokeMsgs(e){const t=new Set(e);this.msgs.filter((e=>t.has(e.id.toString()))).forEach((e=>this._removeSingleMsg(e))),0===this.totalCount&&(this.expireTs=void 0,this.expireTimer=void 0)}delete(){__LOG__(2)`Status v3 deleted with total count: ${this.totalCount}`,super.delete(),this.expireTimer&&a.default.clearTimeout(this.expireTimer),null!=this.expireTs&&(this.expireTs=void 0),this.getCollection().remove(this.id)}onEmptyMRM(){__LOG__(2)`Status V3 onEmptyMRM with total count: ${this.totalCount}, noEarlierMsgs: ${this.msgs.msgLoadState.noEarlierMsgs?"true":"false"}`,this.msgs.msgLoadState.noEarlierMsgs&&0===this.totalCount?this.delete():this.totalCount>0&&this.loadMore().catch((()=>{})).finally((()=>{this.msgs.length||this.delete()}))}loadMore(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.PAGE_SIZE;return(0,i.default)((function*(){if(e.msgs.msgLoadState.noEarlierMsgs)return Promise.resolve();if(e.msgs.msgLoadState.isLoadingEarlierMsgs)return e.msgs.loadEarlierPromise;const n=0!==t?t:s.PAGE_SIZE,r=e.getCollection();try{const t=yield r.loadMore(e.id,n,e.msgs.last());return Array.isArray(t)&&t.length<n&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t}catch(t){return 404===t&&e.delete(),Promise.reject(t)}}))()}handleReadStatus(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0&&this.unreadCount--)}sendReadStatus(e,t){var n=this;return(0,i.default)((function*(){(yield(0,u.sendReadStatus)(e,t))&&n.handleReadStatus(e.id)}))()}getCollection(){return n(459387).StatusV3Collection}}h.Proxy="statusV3",h.idClass=l.default;var g=(0,p.defineModel)(h);t.default=g},459387:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3CollectionImpl=t.StatusV3Collection=void 0;var i=r(n(348926)),a=r(n(441609)),o=r(n(763105)),s=r(n(112297)),l=n(450796),c=n(252230),u=n(257243),d=n(492574),p=n(88555),f=n(40234),_=n(978820),h=n(745454),g=r(n(547896)),m=n(546898),y=r(n(534949)),S=r(n(11339)),E=n(801255),v=n(559871),T=n(554676);class C extends E.BaseCollection{delete(){super.delete(),delete this.checksum}_find(e){return Promise.resolve({id:e})}findQuery(e,t){var n=()=>super.findQuery,r=this;return(0,i.default)((function*(){const i=(yield n().call(r,e,t))||[];return yield Promise.all(i.map((e=>{if(!e)return;let t=0;return e.msgs.forEach((n=>{t<e._msgs.length&&e._msgs[t].id.toString()===n.id.toString()?++t:n.delete()})),e._msgs.length>0?r.addStatusMessages(e.id,e._msgs):Promise.resolve()}))),i}))()}_findQuery(){var e=this;return(0,i.default)((function*(){const t=yield(0,m.queryStatusAll)();return e.checksum=t.checksum,Promise.all(t.statuses.map((e=>{e.totalCount!==e._msgs.length&&e.totalCount<=20&&__LOG__(3)`Received ${e._msgs.length} status V3 messages when total count is ${e.totalCount} for ${e.id}`;const t=e.pic;return t?y.default.createFromData(t,"image/jpeg").then((t=>(e.pic=t,e))):e})))}))()}loadMore(e,t,n){return(0,i.default)((function*(){const r=yield(0,m.queryStatusUpdate)(e,t,null==n?void 0:n.id);return r.status>=400?(__LOG__(3)`model:statusv3:findQuery error ${r.status}`,Promise.reject(r.status)):(r.forEach((function(e){e.invis=!0})),__LOG__(2)`model:statusv3:loadMore:${r.length}`,v.MsgCollection.processMultipleMessages((0,h.createWid)(c.STATUS_JID),r,{add:"after",isHistory:!0}))}))()}sync(e){const t=window.performance.now();return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()}).catch((0,l.filteredCatch)(d.WebdDrop,(()=>{}))).finally((()=>{this.trigger("sync")})).then((e=>{const n=window.performance.now(),r=Math.round(n-t);return this.logMetrics({type:"sync",syncTime:r}),this.forEach((e=>{e.msgs.length>e.totalCount&&__LOG__(2)`Total count: ${e.totalCount}, msgs length: ${e.msgs.length}`})),e})):Promise.resolve(void 0)}logMetrics(e){let t;t="sync"===e.type?new S.default.WebcStatusSync({webcStatusSyncT:e.syncTime}):new S.default.WebcStatusSession({webcStatusSessionId:e.sessionId});const n=this.filter((e=>!e.contact.isMe)),r=n.filter((e=>!e.contact.statusMute)),i=r.filter((e=>e.hasUnread)),a=r.filter((e=>!e.hasUnread)),o=n.filter((e=>e.contact.statusMute)),l=(0,s.default)(r.map((e=>e.unreadCount))),c=(0,s.default)(r.map((e=>e.readCount))),u=(0,s.default)(o.map((e=>e.totalCount)));t.webcStatusRecentItemCount=l,t.webcStatusRecentRowCount=i.length,t.webcStatusViewedItemCount=c,t.webcStatusViewedRowCount=a.length,t.webcStatusMutedItemCount=u,t.webcStatusMutedRowCount=o.length,t.commit()}hasSynced(){return!!(0,p.isMDBackend)()||!!this.checksum}handleUpdate(e,t,n){const r=e.id.fromMe?(0,_.getMaybeMeUser)():e.author;if(this.updateChecksum(t),this.hasSynced()){if(n)return!0;const t=this.get(r);if(t){const n=(0,p.isMDBackend)()||t.totalCount===t.msgs.length;if("sender_revoke"===e.subtype){const n=(0,T.getReadMsgKeys)(t.msgs.toArray()),r={totalCount:t.totalCount-1};n.find((t=>t===e.protocolMessageKey.toString()))||t.readKeys[e.protocolMessageKey.toString()]||(r.unreadCount=t.unreadCount-1),t.set(r)}else{const n={totalCount:t.totalCount+1};e.invis||(n.unreadCount=t.unreadCount+1),n.t=e.t,t.set(n)}return!n&&e.body&&y.default.createFromBase64Jpeg(e.body).then((e=>{t.pic=e})),n}return this.add({id:r,t:e.t,unreadCount:e.invis?0:1,totalCount:1}),!0}return!1}updateChecksum(e){e?this.hasSynced()&&(this.checksum=e):__LOG__(2)`models:statusV3:no_checksum`}handle(e){const t=e.shift();if(Array.isArray(t))__LOG__(3)`models:statusV3:unexpected update`;else switch(t.type){case"read":this.updateChecksum(t.checksum);const e=this.get(t.chat);e?e.handleReadStatus(t.key):__LOG__(2)`models:statusV3:read:no_status:${[t.chat,t.key].join()}`;break;default:__LOG__(3)`models:statusV3:unknown:${t.type}`}}addStatusMessages(e,t){return v.MsgCollection.processMultipleMessages((0,h.createWid)(c.STATUS_JID),t,{add:"after",isHistory:!0})}getUnexpired(e){let t=!1;(0,p.isMDBackend)()&&(t=(0,u.getABPropConfigValue)("web_status_psa"));const n=this.filter((e=>!(e.totalCount<=0)&&(!e.isExpired()&&(!e.contact.isMe&&(!!e.contact.isMyContact||!!e.contact.isPSA&&t)))));if(t&&n.sort(((e,t)=>e.contact.isPSA===t.contact.isPSA?0:e.contact.isPSA?-1:1)),e){return(0,o.default)(n,(e=>e.unreadCount>0))}return(0,o.default)(n,(e=>0===e.unreadCount))}getMyStatus(){const e=this.filter((e=>e.contact.isMe));if(!((0,a.default)(e)||f.Clock.globalUnixTime()-e[0].t>86400))return e[0]}getPSAStatus(){const e=this.filter((e=>e.contact.isPSA));if(0!==e.length)return e[0]}}t.StatusV3CollectionImpl=C,C.model=g.default,C.comparator=(e,t)=>t.t-e.t;const A=new C;t.StatusV3Collection=A},177040:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.sticker=(0,r.prop)(),this.timestamp=(0,r.prop)(),this.stickerHashWithoutMeta=(0,r.prop)()}}i.Proxy="favoriteSticker";var a=(0,r.defineModel)(i);t.default=a},870723:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=n(40234),o=n(930764),s=r(n(969667)),l=r(n(177040)),c=n(689867),u=n(555975),d=n(801255),p=n(776214);class f extends d.BaseCollection{_addSaveTask(){this._idleTaskId&&o.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=o.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=e.toArray().map((e=>{const t=e.sticker.toDbData();return{id:e.id,timestamp:e.timestamp,sticker:{index:t.index,width:t.width,height:t.height,size:t.size,mimetype:t.mimetype,filehash:t.filehash,directPath:t.directPath,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,encFilehash:t.encFilehash,deprecatedMms3Url:t.deprecatedMms3Url,type:"sticker"},stickerHashWithoutMeta:e.stickerHashWithoutMeta}}));try{const e=(0,p.getFavoriteStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`FavoriteStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}_dbDataToModel(e){return new l.default({id:e.id,timestamp:e.timestamp,stickerHashWithoutMeta:e.stickerHashWithoutMeta,sticker:new c.StickerModel(e.sticker)})}_getStickerHashWithoutMeta(e){return(0,i.default)((function*(){const t=yield u.LruMediaStore.get(e);return null==t?e:(0,s.default)(t)}))()}addNewSticker(e){var t=this;return(0,i.default)((function*(){if(t.get(e.filehash))return;const n=new l.default({id:e.filehash,sticker:e,stickerHashWithoutMeta:yield t._getStickerHashWithoutMeta(e.filehash),timestamp:a.Clock.globalUnixTime()});t.add(n),t._addSaveTask()}))()}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.remove(e,t);return n.length&&this._addSaveTask(),n}initializeFromCache(e){const t=e.map((e=>this._dbDataToModel(e)));this.add(t),this._addSaveTask()}}f.model=l.default;var _=new f;t.default=_},620238:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.sticker=(0,r.prop)(),this.timestamp=(0,r.prop)(),this.msgId=(0,r.prop)()}}i.Proxy="recentSticker";var a=(0,r.defineModel)(i);t.default=a},191692:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionImpl=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=r(n(348926)),a=r(n(81109)),o=r(n(506479)),s=r(n(278403)),l=r(n(145095)),c=n(88555),u=n(408139),d=n(689867),p=r(n(656891)),f=n(317239),_=n(801255);const h=["weight"],g=32;t.RECENT_STICKERS_LIMIT=g;class m extends _.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._weightMap=new Map,this._sortTrimScale=()=>{const e=this.length;if(!e)return;if(this.sort(),e>g){for(let t=g;t<e;t++)this._weightMap.delete((0,l.default)(this.at(t),"this.at(i)").id);this.remove(this.slice(g))}const t=this.head(),n=this.last();t&&n&&this._getWeight(t)<10&&this._getWeight(n)>.01||this.forEach(((t,n)=>{this._weightMap.set(t.id,1+(e-n)/e*3)}))}}_comparator(e,t){return f.Conn.platform===f.PLATFORMS.ANDROID?this._getWeight(t)-this._getWeight(e):e.index>t.index?1:-1}_getWeight(e){return(0,l.default)(this._weightMap.get(e.id),"this._weightMap.get(sticker.id)")}_findQuery(){return(0,u.isRecentStickersEnabled)()?(0,c.isMDBackend)()?Promise.reject(new Error("This call is only supported in non-MD mode")):p.default.queryRecentStickers().then((e=>{let{checksum:t,stickers:n}=e;return this.setChecksum(t),f.Conn.platform===f.PLATFORMS.ANDROID&&(this._weightMap.clear(),n.forEach((e=>{let{id:t,weight:n}=e;this._weightMap.set(t,n)}))),n.map(((e,t)=>{let{weight:n}=e,r=(0,o.default)(e,h);return(0,a.default)((0,a.default)({},r),{},{mediaKey:(0,s.default)(r.mediaKey),index:t})}))})):Promise.reject(new Error("gk recent sticker sync unsupported"))}enqueue(e){(0,u.isRecentStickersEnabled)()&&0!==e.length&&(f.Conn.platform===f.PLATFORMS.ANDROID?this._enqueueAndroid(e):this._enqueueiOS(e))}addStickerWithMediaData(e){const t=new d.StickerModel(e);t.id||(t.id=t.filehash),this.enqueue([t])}_enqueueAndroid(e){e.forEach((e=>{this.get(e.id)||(this._weightMap.set(e.id,0),this.add(e)),this.forEach((t=>{let n=this._getWeight(t);t.id===e.id?n+=1:n*=.9,this._weightMap.set(t.id,Math.round(1e3*n)/1e3)}))})),this._sortTrimScale()}_enqueueiOS(e){this.forEach(((e,t)=>{e.index=g+t}));const t=new Set(e.map((e=>e.id)));e.reduce(((e,n)=>t.has(n.id)?(t.delete(n.id),[n].concat(e)):e),[]).slice(0,g).forEach(((e,t)=>{const n=this.get(e.id);n?n.index=t:this.add({id:e.id,deprecatedMms3Url:e.deprecatedMms3Url,directPath:e.directPath,filehash:e.filehash,encFilehash:e.encFilehash,mediaKey:e.mediaKey,mediaKeyTimestamp:e.mediaKeyTimestamp,width:e.width,height:e.height,size:e.size,mimetype:e.mimetype,type:e.type,index:t})})),this.sort(),this.remove(this.slice(g))}setChecksum(e){this._checksum=e}sync(e){var t=this;return(0,i.default)((function*(){(0,u.isRecentStickersEnabled)()&&(null!=e&&e===t._checksum||(yield t._sync()))}))()}_sync(){var e=this;return(0,i.default)((function*(){if("INPROGRESS"!==e._syncStatus){e._syncStatus="INPROGRESS";try{yield e.findQuery({},{set:!0}),e.sort(),e._syncStatus="SUCCESS"}catch(t){__LOG__(3)`collection:recent_sticker:_sync error `,e._syncStatus="FAILURE"}}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}reset(){return this._syncStatus="NONE",this._weightMap.clear(),super.reset()}}t.RecentStickerCollectionImpl=m,m.model=d.StickerModel;const y=new m;t.RecentStickerCollection=y},249264:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RecentStickerCollectionMd=t.RecentStickerCollection=t.RECENT_STICKERS_LIMIT=void 0;var i=r(n(348926)),a=n(40234),o=n(930764),s=r(n(620238)),l=n(689867),c=n(988297),u=n(801255),d=n(559871),p=n(776214);t.RECENT_STICKERS_LIMIT=32;class f extends u.BaseCollection{constructor(){super(...arguments),this._hasInitializedFromCache=!1}_comparator(e,t){return e.timestamp<t.timestamp?1:-1}_dbDataToModel(e){return new s.default({id:e.id,timestamp:e.timestamp,msgId:e.msgId,sticker:new l.StickerModel(e.sticker)})}_addSaveTask(){this._idleTaskId&&o.IdleCallbackTasks.isInQueue(this._idleTaskId)||(this._idleTaskId=o.IdleCallbackTasks.enqueue((()=>{this._saveToDb()})))}_saveToDb(){var e=this;return(0,i.default)((function*(){const t=e.toArray().map((e=>{const t=e.sticker.toDbData();return{id:e.id,timestamp:e.timestamp,msgId:e.msgId,sticker:{id:t.id,index:t.index,width:t.width,height:t.height,size:t.size,mimetype:t.mimetype,filehash:t.filehash,directPath:t.directPath,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,encFilehash:t.encFilehash,deprecatedMms3Url:t.deprecatedMms3Url,type:"sticker"}}}));try{const e=(0,p.getRecentStickersTable)();yield e.clear(),yield e.bulkCreateOrReplace(t)}catch(e){__LOG__(4,void 0,new Error,!0)`RecentStickerCollection attempt to save to database failed`,SEND_LOGS(e)}}))()}addStickerWithMediaData(e,t){this.addNewSticker(new l.StickerModel(e),t)}addNewSticker(e,t){e.id||(e.id=e.filehash),this.enqueue([[e,a.Clock.globalUnixTime(),t]])}enqueue(e){if(0===e.length)return;const t=new Set(e.map((e=>e[0].id))),n=e.reduce(((e,n)=>{let[r,i,a]=n;return t.has(r.id)?(t.delete(r.id),[[r,i,a]].concat(e)):e}),[]),r=[];let i=!1;n.forEach((e=>{let[t,n,a]=e;const o=this.get(t.id);if(o)o.timestamp<=n&&(o.timestamp=n,i=!0);else{const e=this._dbDataToModel({id:t.id,timestamp:n,sticker:{id:t.id,index:t.index,width:t.width,height:t.height,size:t.size,mimetype:t.mimetype,filehash:t.filehash,directPath:t.directPath,mediaKey:t.mediaKey,mediaKeyTimestamp:t.mediaKeyTimestamp,encFilehash:t.encFilehash,deprecatedMms3Url:t.deprecatedMms3Url,type:"sticker"},msgId:a});r.push(e),i=!0}})),i&&(this.addAndSort(r),this._hasInitializedFromCache&&this._addSaveTask())}updateDirectPath(e,t){const n=this.get(e);(null==n?void 0:n.sticker)?(n.sticker.directPath=t,this.set([n],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask()):__LOG__(4,void 0,new Error)`updateDirectPaths called with a stickerId that doesn't match any in the collection`}updateStickerMediaData(e,t){const n=this.get(e);null!=t&&null!=n&&(t.directPath&&(n.sticker.directPath=t.directPath),t.encFilehash&&(n.sticker.encFilehash=t.encFilehash),t.mediaKey&&(n.sticker.mediaKey=t.mediaKey),t.mediaKeyTimestamp&&(n.sticker.mediaKeyTimestamp=t.mediaKeyTimestamp),this.set([n],{remove:!1,add:!1,silent:!0,sort:!1}),this._addSaveTask())}stickersMissingDirerctPath(e){return e.filter((e=>null==e.sticker.directPath))}associateStickerWithMsg(e,t){return(0,i.default)((function*(){var n;const{messages:r}=yield d.MsgCollection.getMessagesById([t]),i=(null===(n=e.mediaObject)||void 0===n?void 0:n.associatedMsgs())||[];!e.mediaObject||0!==i.length&&r.some((e=>i.includes(e)))||(0,c.associateMediaWithMsg)(e.mediaObject,r[r.length-1])}))()}initializeFromCache(e){const t=e.map((e=>{const t=this._dbDataToModel(e);return this.associateStickerWithMsg(t.sticker,t.msgId),t})),n=this.toArray();if(this.addAndSort(t),n.length){const e=new Set(t.map((e=>e.id)));n.some((t=>e.has(t)))&&this._addSaveTask()}this._hasInitializedFromCache=!0}addAndSort(e){this.add(e),this.sort(),this.length>32&&this.set(this.toArray().slice(0,32))}removeAndSave(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.remove(e,t);return n.length&&this._addSaveTask(),n}delete(){super.delete()}}t.RecentStickerCollection=f,f.model=s.default;const _=new f;t.RecentStickerCollectionMd=_},16774:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStickerCollectionImpl=t.StarredStickerCollection=t.STARRED_STICKERS_PAGE_SIZE=void 0;var i=r(n(348926)),a=r(n(81109)),o=r(n(278403)),s=n(88555),l=n(408139),c=n(689867),u=r(n(656891)),d=n(801255);t.STARRED_STICKERS_PAGE_SIZE=24;class p extends d.BaseCollection{constructor(){super(...arguments),this._checksum="",this._syncStatus="NONE",this._currentPage=0,this._total=0}_findQuery(){return(0,l.isStarredStickersEnabled)()?(0,s.isMDBackend)()?Promise.reject(new Error("This call is only supported in non-MD mode")):u.default.queryStarredStickers(this._currentPage+1,24).then((e=>{let{checksum:t,total:n,stickers:r}=e;return this._checksum=t,this._currentPage+=1,this._total=n,r.map(((e,t)=>(0,a.default)((0,a.default)({},e),{},{mediaKey:(0,o.default)(e.mediaKey),index:this.length+t})))})):Promise.reject(new Error("gk starred sticker sync unsupported"))}add(e,t,n){return n&&(this._total+=1),super.add(e,t)}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._total-=1,super.remove(e,t)}syncNextPage(){return this.canLoadMore()?this._sync(!1).then((()=>{this.trigger("next_page_sync")})):Promise.resolve()}sync(e){return(0,l.isStarredStickersEnabled)()&&(null==e||e!==this._checksum)?(this.reset(),this._sync(!0).then((()=>{this.trigger("sync")}))):Promise.resolve()}_sync(e){var t=this;return(0,i.default)((function*(){if("INPROGRESS"===t._syncStatus)return Promise.resolve();t._syncStatus="INPROGRESS";try{yield t.findQuery({},{set:e}),t._syncStatus="SUCCESS"}catch(e){__LOG__(3)`collection:starred_sticker:_sync error `,t._syncStatus="FAILURE"}}))()}isSynced(){return"SUCCESS"===this._syncStatus||"FAILURE"===this._syncStatus}canLoadMore(){return 0!==this._total&&this.length<this._total}getRemaining(){return this._total-this.length}reset(){return this._syncStatus="NONE",this._currentPage=0,this._checksum="",this._total=0,super.reset()}}t.StarredStickerCollectionImpl=p,p.model=c.StickerModel,p.comparator=(e,t)=>e.index>=t.index?1:-1;const f=new p;t.StarredStickerCollection=f},689867:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerModel=t.Sticker=void 0;var i=r(n(751463)),a=n(40234),o=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(778986)),s=r(n(502320)),l=n(58668),c=n(411290);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}const d=(0,i.default)((()=>new _({id:"placeholder",isPlaceholder:!0}))),p=(0,i.default)((()=>new _({id:"createButton",isCreateButton:!0})));class f extends c.BaseModel{constructor(){super(...arguments),this.id=(0,c.prop)(),this.mediaData=(0,c.session)(),this.mediaObject=(0,c.prop)(),this.deprecatedMms3Url=(0,c.prop)(),this.directPath=(0,c.prop)(),this.filehash=(0,c.prop)(),this.height=(0,c.prop)(),this.index=(0,c.prop)(),this.mediaKey=(0,c.prop)(),this.mediaKeyTimestamp=(0,c.prop)(),this.mimetype=(0,c.prop)(),this.size=(0,c.prop)(),this.type=(0,c.prop)(l.OUTWARD_TYPES.STICKER),this.encFilehash=(0,c.prop)(),this.width=(0,c.prop)(),this.stickerPackId=(0,c.prop)(),this.stickerPackName=(0,c.prop)(),this.stickerPackPublisher=(0,c.prop)(),this.isPlaceholder=(0,c.prop)(),this.isCreateButton=(0,c.prop)()}initialize(){super.initialize(),this.addChild("mediaData",new s.default),this.isPlaceholder||this.isCreateButton||o.registerSticker(this)}downloadMedia(){return o.downloadStickerOrStickerPackIcon(this,"STICKER").catch((e=>{__LOG__(4,void 0,new Error,!0,["non-sad"])`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker download failed")}))}toDbData(){return{id:this.id||this.filehash,index:this.index||0,width:this.width,height:this.height,size:this.size,mimetype:this.mimetype,filehash:this.filehash,directPath:this.directPath,mediaKey:this.mediaKey,mediaKeyTimestamp:null!=this.mediaKeyTimestamp?this.mediaKeyTimestamp:a.Clock.globalUnixTime(),encFilehash:this.encFilehash,deprecatedMms3Url:this.deprecatedMms3Url,type:l.OUTWARD_TYPES.STICKER}}delete(){super.delete(),o.deregisterSticker(this)}}t.Sticker=f,f.Proxy="sticker",f.getPlaceholder=d,f.getCreateButton=p;const _=(0,c.defineModel)(f);t.StickerModel=_,_.getPlaceholder=d},767963:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickerCollectionImpl=t.StickerCollection=t.FETCH_STATE=void 0;var r=n(689867),i=n(801255);t.FETCH_STATE={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};class a extends i.BaseCollection{fetch(){throw new Error(`${this.constructor.name}.fetch is not implemented`)}}t.StickerCollectionImpl=a,a.model=r.StickerModel;const o=new a;t.StickerCollection=o},574470:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackModel=t.StickerPack=t.PRE_PLACEHOLDER_ID=void 0;var i=r(n(763488)),a=r(n(502320)),o=n(58668),s=n(411290);const l="placeholder:";t.PRE_PLACEHOLDER_ID=l;const c=e=>{let{index:t,page:n}=e;return new d({id:`placeholder:${t}`,index:t,page:n})};class u extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.index=(0,s.prop)(),this.name=(0,s.prop)(),this.page=(0,s.prop)(),this.url=(0,s.prop)(),this.mimetype=(0,s.prop)("image/png"),this.mediaData=(0,s.session)(),this.mediaObject=(0,s.prop)(),this.directPath=(0,s.prop)(),this.filehash=(0,s.prop)(),this.mediaKey=(0,s.prop)(),this.mediaKeyTimestamp=(0,s.prop)(),this.size=(0,s.prop)(),this.type=(0,s.prop)(o.OUTWARD_TYPES.IMAGE),this.encFilehash=(0,s.prop)(),this.deprecatedMms3Url=(0,s.derived)((function(){return this.isFirstParty?"":this.url}),["isFirstParty"]),this.stickers=(0,s.derived)((function(){return this._stickers=this._stickers||new i.default(this.id.split("#")[0],this.isFirstParty),this._stickers}),["id"]),this.isPlaceholder=(0,s.derived)((function(){return u.isPlaceholderId(this.id)}),["id"]),this.isFirstParty=(0,s.derived)((function(){return Boolean(this.url)&&!this.mediaKey}),["url","mediaKey"])}initialize(){super.initialize(),this.isPlaceholder||this.isFirstParty||(this.addChild("mediaData",new a.default({renderableUrl:""})),n(778986).registerStickerPackIcon(this))}downloadMedia(){return this.isPlaceholder||this.isFirstParty?Promise.resolve():n(778986).downloadStickerOrStickerPackIcon(this,"STICKER_PACK").catch((e=>{__LOG__(4,void 0,new Error,!0)`id: ${this.id}, error: ${String(e.stack||e)}`,SEND_LOGS("sticker-panel:sticker-pack download failed")}))}delete(){super.delete(),n(778986).deregisterStickerPackIcon(this)}}t.StickerPack=u,u.Proxy="stickerPack",u.createPlaceholder=c,u.isPlaceholderId=e=>new RegExp("^placeholder:").test(e);const d=(0,s.defineModel)(u);t.StickerPackModel=d,d.createPlaceholder=c,d.isPlaceholderId=u.isPlaceholderId},366299:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackCollectionImpl=t.StickerPackCollection=t.PAGE_SIZE_POPUP=t.PAGE_SIZE_COMPOSE_BOX=t.PAGE_FETCH_STATE=void 0;var a=i(n(81109)),o=i(n(348926)),s=i(n(498913)),l=i(n(478718)),c=n(389385),u=i(n(747259)),d=n(574470),p=i(n(656891)),f=n(801255);t.PAGE_SIZE_COMPOSE_BOX=9;t.PAGE_SIZE_POPUP=6;const _={PENDING:"PENDING",SUCCESS:"SUCCESS",ERROR:"ERROR"};t.PAGE_FETCH_STATE=_;class h extends f.BaseCollection{constructor(){super(),this.checksum=null,this._pageFetchRequests={},this.pageFetchStates={},this._handleChecksumChange=()=>{Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),this._resetRangeWithPlaceholders(0,this.length),this.fetchAt(0,!1,!0)},this.listenTo(this,"change:checksum",this._handleChecksumChange)}createPlaceholder(e){return h.createPlaceholder(e)}preFetch(){var e=this;return(0,o.default)((function*(){yield e.fetchAt(0).then((()=>Promise.all(e.filter((e=>e.isFirstParty)).map((e=>e.stickers.fetch())))))}))()}fetchAt(e,t,n){return this._fetchPageWithIndex(e,Boolean(t),Boolean(n))}hasFetchedData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===_.SUCCESS))}isFetchingData(){return Object.keys(this.pageFetchStates).some((e=>this.pageFetchStates[parseInt(e,10)]===_.PENDING))}pageWithIndex(e){return h.pageWithIndex(e)}reset(){return this.setChecksum(null,{silent:!0}),Object.keys(this.pageFetchStates).forEach((e=>this._resetFetchPageStateAndPromise(parseInt(e,10)))),super.reset()}sync(e){this.setChecksum(e)}setChecksum(e,t){if(this.checksum!==e){this.checksum=e;return(null==t?void 0:t.silent)||this.trigger("change:checksum",e),!0}return!1}_fetchPageWithIndex(e,t,n){const r=this.pageWithIndex(e);return this._fetchPage(r,t,n)}_fetchPage(e,t,n){const i=this.pageFetchStates[e];if(t&&i!==_.PENDING){const t=this._pageFetchRequests[e];t&&(t.controller.abort(),delete this._pageFetchRequests[e])}if(this._pageFetchRequests[e])return this._pageFetchRequests[e].promise;const a=this.length;this._insertPagePlaceholders(e),this._setFetchPageState(e,_.PENDING);const o=new r,s=o.signal,l=(0,u.default)(p.default.queryStickerPacks(e,9),s).then((t=>{if(s.aborted)throw new c.AbortError;const r=this._parseStickerPacksRes(e,t),i=n||this.setChecksum(t.checksum,{silent:!0}),o=9*(e-1),l=9*(e+0);this._resetRange(o,l,r),i&&(this._resetRangeWithPlaceholders(0,o),this._resetRangeWithPlaceholders(Math.min(o+r.length,l),t.count));const u=this.length;a!==u&&this.trigger("change:length",u),this._setFetchPageState(e,_.SUCCESS)})).catch((t=>{if(t.name===c.ABORT_ERROR)return __LOG__(2)`StickerPack page fetch promise cancelled: ${e}`,void this._unsetFetchPageStateAndPromise(e);this._setFetchPageState(e,_.ERROR)}));return this._pageFetchRequests[e]={promise:l,controller:o},l}_insertPagePlaceholders(e){const t=e-1;this._resetRangeWithPlaceholders(9*t,9*(t+1))}_parseStickerPacksRes(e,t){if(200!==t.status||!t.data)throw new Error("sticker packs query error");return t.data.map(((t,n)=>(0,a.default)((0,a.default)({},(0,l.default)(t,["id","mimetype","name","url","mediaKey","filehash","directPath"])),{},{encFilehash:t.encFilehash,page:e,index:9*(e-1)+n})))}_resetRangeWithPlaceholders(e,t){this._resetRange(e,t,(0,s.default)(t-e,(t=>h.createPlaceholder(e+t))))}_resetRange(e,t,n){this._forEachInRange(e,t,((t,r)=>{const i=n[r-e];if(t)if(i)t.id===i.id?(this.remove(t,{silent:!0}),this.add(i)):(this.remove(t),this.add(i));else{let e=t;for(;e;)this.remove(e),e=this.at(r)}else i&&this.add(i)}))}_forEachInRange(e,t,n){for(let r=e;r<t;r++){n(this.at(r),r)}}_resetFetchPageStateAndPromise(e){if(e in this.pageFetchStates){var t;if(this.pageFetchStates[e]===_.PENDING)null===(t=this._pageFetchRequests[e])||void 0===t||t.controller.abort();else this._unsetFetchPageStateAndPromise(e)}}_setFetchPageState(e,t){this.pageFetchStates[e]!==t&&(this.pageFetchStates[e]=t,this.trigger("change:pageFetchStates",e,t))}_unsetFetchPageState(e){e in this.pageFetchStates&&(delete this.pageFetchStates[e],this.trigger("change:pageFetchStates",e))}_unsetFetchPageStateAndPromise(e){delete this._pageFetchRequests[e],this._unsetFetchPageState(e)}}t.StickerPackCollectionImpl=h,h.model=d.StickerPackModel,h.comparator=function(e,t){return e.index<t.index?-1:e.index>t.index?1:0},h.createPlaceholder=function(e){return d.StickerPackModel.createPlaceholder({index:e,page:this.pageWithIndex(e)})},h.pageWithIndex=function(e){return Math.floor(e/9)+1};const g=new h;t.StickerPackCollection=g},344333:(e,t,n)=>{"use strict";var r=n(280366).default,i=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackCollectionMd=t.StickerPackCollection=t.FETCH_STATE=void 0;var a=i(n(348926)),o=n(389385),s=n(40234),l=n(279628),c=n(132873),u=i(n(914296)),d=n(490669),p=n(801255);const f=n(76672).Mirrored(["INITIAL","PENDING","SUCCESS","ERROR"]);t.FETCH_STATE=f;class _ extends p.BaseCollection{constructor(){super(),this.fetchState=f.INITIAL,this.packFetchState=new Map,this._fetchTimestamp=null,this._packFetchTimestamp=new Map,this._abortController=null,this._packAbortController=new Map,this.listenTo(u.default,"locale_change",(()=>this._resetState()))}_resetState(){this._resetStickerPacksFetchState(),this.reset()}_resetStickerPacksFetchState(){var e;null===(e=this._abortController)||void 0===e||e.abort(),this._abortController=null,this._packAbortController.forEach((e=>e.abort())),this._packAbortController.clear(),this._resetFetchState(),this._resetPackFetchState(),this._fetchTimestamp=null,this._packFetchTimestamp.clear()}_setFetchState(e){e!==this.fetchState&&(this.fetchState=e,this.trigger("change:fetchState",e))}_resetFetchState(){this._setFetchState(f.INITIAL)}_setPackFetchState(e,t){t!==this.packFetchState.get(e)&&(this.packFetchState.set(e,t),this.trigger("change:packFetchState",e,t))}_resetPackFetchState(){this.packFetchState.clear(),this.trigger("change:packFetchState")}_resetRange(e,t,n){this._forEachInRange(e,t,((t,r)=>{const i=n[r-e];if(t)if(i)t.id!==i.id||t.imageDataHash===i.imageDataHash&&t.index===i.index?(this.remove(t),this.add(i)):(this.remove(t,{silent:!0}),this.add(i));else{let e=t;for(;e;)this.remove(e),e=this.at(r)}else i&&this.add(i)})),this._resetPackFetchState(),this._packFetchTimestamp.clear()}_forEachInRange(e,t,n){for(let r=e;r<t;r++){n(this.at(r),r)}}fetch(){var e=this;return(0,a.default)((function*(){var t;if(!(e.fetchState===f.PENDING||e.fetchState===f.SUCCESS&&s.Clock.globalUnixTime()-(null!==(t=e._fetchTimestamp)&&void 0!==t?t:0)<d.STICKER_PACK_FETCH_TIMEOUT)){e._setFetchState(f.PENDING),e._fetchTimestamp=s.Clock.globalUnixTime(),e._abortController=new r;try{const t=yield(0,l.fetchFirstPartyStickerPacks)({signal:e._abortController.signal}),n=Math.max(e.length,t.length);e._resetRange(0,n,t),e._setFetchState(f.SUCCESS)}catch(t){if(e._setFetchState(f.ERROR),t.name===o.ABORT_ERROR)return void __LOG__(2)`First party sticker packs request cancelled`;__LOG__(3,void 0,void 0,!0)`First party sticker packs request failed: error: ${t}`,SEND_LOGS("sticker-packs-fetch-request-failed")}}}))()}fetchStickerPack(e){var t=this;return(0,a.default)((function*(){var n;if(!e)return;if(t.get(e))return;const i=t.packFetchState.get(e),a=null!==(n=t._packFetchTimestamp.get(e))&&void 0!==n?n:0;if(i===f.PENDING||i===f.SUCCESS&&s.Clock.globalUnixTime()-a<d.STICKER_PACK_FETCH_TIMEOUT)return;t._setPackFetchState(e,f.PENDING),t._packFetchTimestamp.set(e,s.Clock.globalUnixTime());const c=new r;t._packAbortController.set(e,c);try{const n=yield(0,l.fetchFirstPartyStickerPack)({id:e,signal:c.signal});t._setPackFetchState(e,f.SUCCESS),t.add(n)}catch(n){if(t._setPackFetchState(e,f.ERROR),n.name===o.ABORT_ERROR)return void __LOG__(2)`First party sticker pack request cancelled`;__LOG__(3,void 0,void 0,!0)`First party sticker pack request failed: error: ${n}`,SEND_LOGS("sticker-packs-fetch-request-failed")}}))()}delete(){super.delete(),this.stopListening(),this._resetStickerPacksFetchState()}}t.StickerPackCollection=_,_.model=c.StickerPackModel,_.comparator=(e,t)=>e.index<t.index?-1:e.index>t.index?1:0;const h=new _;t.StickerPackCollectionMd=h},132873:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPackModel=t.StickerPack=void 0;var i=r(n(763488)),a=n(411290);class o extends a.BaseModel{constructor(){super(...arguments),this.index=(0,a.prop)(),this.id=(0,a.prop)(),this.name=(0,a.prop)(),this.publisher=(0,a.prop)(),this.description=(0,a.prop)(),this.fileSize=(0,a.prop)(),this.imageDataHash=(0,a.prop)(),this.animated=(0,a.prop)(),this.previewImageIds=(0,a.prop)(),this.trayImageId=(0,a.prop)(),this.trayImagePreview=(0,a.prop)(),this.stickers=(0,a.derived)((function(){const e=this.id;return this._stickers=this._stickers||new i.default(e,!0),this._stickers}),["id"])}}t.StickerPack=o,o.Proxy="stickerPackMd";const s=(0,a.defineModel)(o);t.StickerPackModel=s},763488:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=r(n(478718)),o=n(88555),s=n(40234),l=n(973336),c=n(767963),u=r(n(656891)),d=n(490669);class p extends c.StickerCollectionImpl{constructor(e,t){super(),this._parseStickersRes=e=>{if(200!==e.status||!e.data)throw new Error("sticker pack stickers query error");return e.data.map(((e,t)=>(0,i.default)((0,i.default)({},(0,a.default)(e,["directPath","mimetype","mediaKey","filehash","width","height"])),{},{index:t,id:e.filehash,deprecatedMms3Url:e.url,encFilehash:e.encFilehash,mediaKeyTimestamp:0})))},this.stickerPackId=e,this.isFirstParty=t,this._firstPartyFetchTimestamp=null;const n=p._cache[this.stickerPackId];if(n)return n;let r;const o=this;Object.defineProperty(this,"fetchState",{get:()=>r,set(e){r!==e&&(r=e,o.trigger("change:fetchState",e))}})}fetch(e){var t;const r=(0,o.isMDBackend)()&&this.isFirstParty&&s.Clock.globalUnixTime()-(null!==(t=this._firstPartyFetchTimestamp)&&void 0!==t?t:0)>=d.STICKER_PACK_FETCH_TIMEOUT;if((e||r)&&this.fetchState!==c.FETCH_STATE.PENDING&&delete this._fetchPromise,this._fetchPromise)return this._fetchPromise;this.fetchState=c.FETCH_STATE.PENDING;if(n(574470).StickerPackModel.isPlaceholderId(this.stickerPackId))return this._fetchPromise=new Promise((()=>{})),this._fetchPromise;let i;return this.isFirstParty?((0,o.isMDBackend)()&&(this._firstPartyFetchTimestamp=s.Clock.globalUnixTime()),i=(0,l.fetchFirstPartyStickers)(this.stickerPackId)):i=u.default.queryStickersInStickerPack(this.stickerPackId).then(this._parseStickersRes),this._fetchPromise=i.then((e=>{const t=Math.max(this.length||e.length);this._resetRange(0,t,e),this.fetchState=c.FETCH_STATE.SUCCESS})).catch((()=>{this.fetchState=c.FETCH_STATE.ERROR})),this._fetchPromise}_resetRange(e,t,n){this._forEachInRange(e,t,((t,r)=>{const i=n[r-e];t?i?t.id===i.id?t.set(i):(this.remove(t),this.add(i)):this.remove(t):i&&this.add(i)}))}_forEachInRange(e,t,n){for(let r=e;r<t;r++){n(this.at(r),r)}}}t.default=p,p._cache={},p.comparator=(e,t)=>e.index<t.index?-1:e.index>t.index?1:0},545068:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StickerSearchCollectionImpl=t.StickerSearchCollection=void 0;var i=r(n(348926)),a=n(900769),o=n(689867),s=(n(157297),n(767247)),l=r(n(917136)),c=n(801255);const u={HAPPY:["😂","🤣","😀","😁","😆","🙂","😇","☺️","😄","😃"],LOVE:["😍","😘","❤️","💕","🥰","😗","😙","😻","👩‍❤️‍👩","💐","💌","💛","💚","💙","💜","💓","💘","💏","💑","🌹","🤟","🏩"],GREETINGS:["👋","😂","🤣","🙏","✋","🧕","🚶‍♀️","🚶","👠","🥾","🙈","🦛","🌺","⚡","🎯","🚄","🚅","💒","🛕","🛣️","🕉️","🔊"],SAD:["😭","😔","😢","😞","😟","😕","🙁","☹️","😖","😫","😩","🥺","😥","😓","😪","😿","💧","💔"],ANGRY:["😠","😡","😤","👺","💢","🗯️","👿"],CELEBRATE:["🥳","🥂","🎈","🎊","🎉"]};class d extends c.BaseCollection{constructor(){super(...arguments),this._cache=new Map,this._hasFetched=!1,this._isFetching=!0}isFetchingData(){return this._isFetching}hasFetchedData(){return this._hasFetched}setStartFetching(){this._isFetching=!0,this.trigger("start_fetching")}setStopFetching(){this._isFetching=!1,this.trigger("stop_fetching")}search(e){var t=()=>super.delete,n=this;return(0,i.default)((function*(){n._lastQuery!==e&&n._hasFetched&&t().call(n);const r=e.trim().toUpperCase();if(n._cache.has(e)){const t=n._cache.get(e);if(null!=t)return n.add(t),void(n._lastQuery=e);__LOG__(2)`StickerMoodCollection cache was invalid, re-searching.`}const i=[];if(u.hasOwnProperty(r))i.push(...u[r]);else{const a=s.EmojiUtil.containsOnlyEmoji(r)?s.EmojiUtil.splitEmojis(r):(0,l.default)(r);if(null==a||0===a.length)return n._lastQuery=e,n.setStopFetching(),void t().call(n);i.push(...a)}n.setStartFetching();let o=[];try{o=yield(0,a.searchFirstPartyStickers)(i)}catch(e){return __LOG__(3,void 0,void 0,!0)`Sticker search request failed: error: ${e}`,SEND_LOGS("sticker-search-request-failed"),void n.setStopFetching()}n._cache.set(e,o),n._hasFetched=!0,n._lastQuery=e,n.add(o),n.setStopFetching()}))()}searchMood(e){return this.search(e)}delete(){super.delete(),this._cache=new Map,this._hasFetched=!1,this._isFetching=!1}}t.StickerSearchCollectionImpl=d,d.model=o.StickerModel;const p=new d;t.StickerSearchCollection=p},608080:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StreamMode=t.StreamInfo=t.Stream=t.Obscurity=void 0;var i=r(n(23279)),a=n(657319),o=n(88555),s=n(781572),l=r(n(681602)),c=n(366517),u=n(400922),d=n(646239),p=n(555452),f=n(711597),_=n(411290),h=n(765044),g=n(662583),m=n(12099),y=r(n(11339)),S=n(771119),E=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=v(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(243840));function v(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(v=function(e){return e?n:t})(e)}const T=n(76672).Mirrored(["OFFLINE","OPENING","PAIRING","SYNCING","RESUMING","CONNECTING","NORMAL","TIMEOUT","SCREEN_LOCKED"]);t.StreamInfo=T;const C=n(76672).Mirrored(["QR","MAIN","SYNCING","OFFLINE","CONFLICT","PROXYBLOCK","TOS_BLOCK","SMB_TOS_BLOCK","DEPRECATED_VERSION","LOCK"]);t.StreamMode=C;const A=n(76672).Mirrored(["SHOW","OBSCURE","HIDE"]);t.Obscurity=A;class b extends _.BaseModel{constructor(){super(...arguments),this.info=(0,_.session)(T.NORMAL),this.mode=(0,_.session)(C.SYNCING),this.obscurity=(0,_.session)(A.HIDE),this.needsUpdate=(0,_.session)(),this.clientExpired=(0,_.session)(!1),this.hardExpired=(0,_.session)(!1),this.lastSyncStart=(0,_.session)(M()),this.needsManualDownload=(0,_.session)(),this.couldForce=(0,_.session)(),this.uiActive=(0,_.session)(),this.available=(0,_.session)(!0),this.unavailableShiftTimer=(0,_.session)(),this.unavailableLogoutTimer=(0,_.session)(),this.unobscureShiftTimer=(0,_.session)(),this.timeoutEvent=(0,_.session)(),this.resumeCount=(0,_.session)(0),this.phoneAuthed=(0,_.session)(!1),this._activeModeMeasure=(0,_.session)(),this.displayInfo=(0,_.derived)((function(){return function(e,t){switch(t){case A.SHOW:return e;case A.HIDE:return h.Socket.hasSynced?T.NORMAL:T.CONNECTING;case A.OBSCURE:switch(e){case T.OPENING:case T.PAIRING:case T.SYNCING:case T.RESUMING:return T.CONNECTING;default:return e}}return __LOG__(3)`Stream:unknown obscure level:`,e}(this.info,this.obscurity)}),["info","obscurity"])}initialize(){super.initialize(),(0,o.isMDBackend)()&&!(0,f.isRegistered)()&&(this.mode=C.QR),this._activeModeMeasure=E.startMeasure(`Stream.mode: ${this.mode}`),__LOG__(2)`Stream:rememberMe: ${String(d.userPreferencesStoreBase.getRememberMe())}`,this.unavailableShiftTimer=new a.ShiftTimer((()=>this.markUnavailable())),this.unobscureShiftTimer=new a.ShiftTimer((()=>this.unobscure())),this.unavailableLogoutTimer=new a.ShiftTimer((function(){d.userPreferencesStoreBase.getRememberMe()||(__LOG__(2)`Stream:unavailableLogoutTimer logout due to inactivity`,h.Socket.logout())})),this.listenTo(h.Socket,"change:state change:stream change:hasSynced",this._handleSocketUpdate),this.listenTo(l.default,"change:online",this._handleSocketUpdate),this.listenTo(this,"change:available",this._handleAvailableUpdate),this.listenTo(this,"change:phoneAuthed",this._handlePhoneAuthedUpdate),this.listenTo(this,"change:info change:displayInfo change:mode",(0,i.default)(this._handleSelfUpdate)),this.listenTo(this,"change:info",this.logPageResume),this.listenTo(this,"change:info",this.updateWamLog),this.listenTo(this,"change:mode",this.logModeChange),this.listenTo(this,"change:available change:uiActive",this.updateCouldForce),this.listenTo(s.Cmd,"midnight",this.updateHardExpire.bind(this)),(0,o.isMDBackend)()&&this.listenTo(s.Cmd,"socket_stream_disconnected",(()=>{n(868315).PresenceCollection.clearAllPresence()})),window.document&&document.addEventListener("visibilitychange",this.updateCouldForce),this.updateCouldForce(),this.updateHardExpire()}delete(){}markAvailable(){this.unavailableShiftTimer.cancel(),this.available=!0}markUnavailable(e){null!=e&&0!==e?this.unavailableShiftTimer.onOrBefore(e):(this.unavailableShiftTimer.cancel(),this.available=!1)}_handleSelfUpdate(){__LOG__(2)`Stream:onSelfUpdate mode:${this.mode} info:${this.info} view:${this.displayInfo}`;let e=this.timeoutEvent;if(this.info===T.TIMEOUT)e||(this.timeoutEvent=e=new y.default.WebcPhoneDisconnected),this.displayInfo===T.TIMEOUT&&null==this._bbarTime&&(this._bbarTime=Date.now());else if(e){e.markWebcPhoneDisconnectedT();const t=this._bbarTime;null!=t&&(e.webcPhoneBbarShownT=Date.now()-t),e.commit(),this.timeoutEvent=null,this._bbarTime=null}this.mode===C.MAIN&&s.Cmd.readyForMainStreamModeLegacy()}_handleSocketUpdate(){const e={},t=function(){switch(h.Socket.state){case g.SOCKET_STATE.SCREEN_LOCKED:return T.SCREEN_LOCKED;case g.SOCKET_STATE.TIMEOUT:return T.TIMEOUT;case g.SOCKET_STATE.OPENING:return l.default.online?T.OPENING:T.OFFLINE;case g.SOCKET_STATE.PAIRING:return h.Socket.hasSynced?T.RESUMING:T.PAIRING;case g.SOCKET_STATE.CONNECTED:return h.Socket.stream!==g.SOCKET_STREAM.CONNECTED?h.Socket.hasSynced?T.NORMAL:T.SYNCING:T.NORMAL;case g.SOCKET_STATE.UNLAUNCHED:case g.SOCKET_STATE.PROXYBLOCK:default:return T.NORMAL}}();if(e.info=t,e.mode=function(){let e=!1;e=(0,o.isMDBackend)()?(0,f.isRegistered)():(0,p.knowsPhone)();if(!e&&h.Socket.state!==g.SOCKET_STATE.PROXYBLOCK)return C.QR;const t=h.Socket.hasSynced;switch(h.Socket.state){case g.SOCKET_STATE.PROXYBLOCK:return C.PROXYBLOCK;case g.SOCKET_STATE.CONFLICT:return C.CONFLICT;case g.SOCKET_STATE.TOS_BLOCK:return C.TOS_BLOCK;case g.SOCKET_STATE.SMB_TOS_BLOCK:return C.SMB_TOS_BLOCK;case g.SOCKET_STATE.DEPRECATED_VERSION:return C.DEPRECATED_VERSION;case g.SOCKET_STATE.UNLAUNCHED:return C.SYNCING;case g.SOCKET_STATE.UNPAIRED_IDLE:case g.SOCKET_STATE.UNPAIRED:return C.QR;case g.SOCKET_STATE.LOCKED:return C.LOCK;case g.SOCKET_STATE.OPENING:if(!l.default.online&&!h.Socket.hasSynced)return C.OFFLINE;default:return t||h.Socket.stream===g.SOCKET_STREAM.CONNECTED?C.MAIN:C.SYNCING}}(),e.phoneAuthed=h.Socket.stream!==g.SOCKET_STREAM.DISCONNECTED,t===T.NORMAL)this.unobscureShiftTimer.cancel(),e.obscurity=A.HIDE;else if(t===T.OFFLINE)this.unobscureShiftTimer.cancel(),e.obscurity=A.OBSCURE;else switch(this.obscurity){case A.HIDE:this.unobscureShiftTimer.onOrBefore(18e3);break;case A.OBSCURE:this.unobscureShiftTimer.onOrBefore(3e3);break;case A.SHOW:}this.set(e)}unobscure(){this.obscurity=A.SHOW}_handlePhoneAuthedUpdate(){if(this.phoneAuthed){this.sendAvailability(!0);n(492671).RecentEmojiCollection.sync()}}_handleAvailableUpdate(){const e=this.available;if(__LOG__(2)`Stream:onAvailableUpdate user ${e?"available":"unavailable"}`,e||d.userPreferencesStoreBase.getRememberMe()?this.unavailableLogoutTimer.cancel():this.unavailableLogoutTimer.onOrBefore(78e4),this.sendAvailability(!1),(0,o.isMDBackend)())if(e){const{sendDeliveryReceiptsAfterPresence:e}=n(807992);e()}else{n(868315).PresenceCollection.clearAllPresence()}}sendAvailability(e){(e||this.uiActive)&&(this.available?(0,c.sendPresenceAvailable)():(0,c.sendPresenceUnavailable)())}updateCouldForce(){this.couldForce=!this.uiActive||!this.available&&document.hidden}updateHardExpire(){u.Updater.isExpired()&&(this.hardExpired=!0,u.Updater.restart(!0))}logPageResume(){this.info===T.RESUMING&&(this.resumeCount++,new y.default.WebcPageResume({webcResumeCount:this.resumeCount}).commit())}updateWamLog(){const e=this.info===T.NORMAL;(0,S.streamInfoChange)(this.info,m.WatchedSocketModel.numSocketsAttempted,e),e&&this.stopListening(this,"change:info",this.updateWamLog)}logModeChange(){this._activeModeMeasure&&this._activeModeMeasure.end(),this.mode===C.SYNCING&&(this.lastSyncStart=M()),this._activeModeMeasure=E.startMeasure(`Stream.mode: ${this.mode}`),new y.default.WebcStreamModeChange({webcStreamMode:P(this.mode)}).commit()}}function P(e){switch(e){case C.QR:return y.default.WEBC_STREAM_MODE_CODE.QR;case C.MAIN:return y.default.WEBC_STREAM_MODE_CODE.MAIN;case C.SYNCING:return y.default.WEBC_STREAM_MODE_CODE.SYNCING;case C.OFFLINE:return y.default.WEBC_STREAM_MODE_CODE.OFFLINE;case C.CONFLICT:return y.default.WEBC_STREAM_MODE_CODE.CONFLICT;case C.PROXYBLOCK:return y.default.WEBC_STREAM_MODE_CODE.PROXYBLOCK;case C.DEPRECATED_VERSION:return y.default.WEBC_STREAM_MODE_CODE.DEPRECATED_VERSION;case C.TOS_BLOCK:case C.SMB_TOS_BLOCK:return y.default.WEBC_STREAM_MODE_CODE.TOS_BLOCK;case C.LOCK:return y.default.WEBC_STREAM_MODE_CODE.LOCK}}b.Proxy="stream";const O=new((0,_.defineModel)(b));function M(){return Math.floor(window.performance.now())}t.Stream=O},558492:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(82569)),a=r(n(385564)),o=n(951612),s=n(411290);class l extends s.BaseModel{constructor(){super(...arguments),this.id=(0,s.prop)(),this.pendingMsgs=(0,s.prop)(),this.labels=(0,s.prop)(),this.msgChunks=(0,s.session)((()=>[])),this.lastReceivedKey=(0,s.session)(),this.unreadMsgAnchor=(0,s.session)(),this.disableUnreadAnchor=(0,s.session)(),this.msgsLength=(0,s.session)(),this.msgsChanged=(0,s.session)(0),this.msgs=(0,s.collection)(o.ChatMsgsCollection)}initialize(){super.initialize(),this.listenTo(this.msgs,"change:last",(()=>{this.msgsChanged++})),this.listenTo(this.msgs,"add remove bulk_add",(()=>{this.msgsChanged++,this.msgsLength=this.msgs.length}))}onEmptyMRM(){throw new Error("onEmptyMRM not implemented")}delete(){super.delete(),this.getAllCMCs().forEach((e=>{e.forEach((e=>{e.delete()})),e.delete()}))}removeMsg(e){const t=e.msgChunk;if(!t)return;t.indexOf(e)<0||(__LOG__(2)`models:Chat:removeMsg ${e.get("id")}`,t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}getAllCMCs(){return this.msgChunks.concat([this.msgs])}getAllMsgs(){return(0,a.default)(this.getAllCMCs().map((e=>e.getModelsArray())))}replaceMsgsCollection(e){__LOG__(2)`model:Chat:replaceMsgsCollection:${this.id.toString()}`;const t={msg:e.last()};this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs,t),this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}removeMsgsCollection(e){this.msgChunks=(0,i.default)(this.msgChunks,e),e.delete()}notifyMsgCollectionMerge(e,t,n,r){this.trigger("change:cmc:merge",e,t,n,r)}}t.default=l},311897:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.displayText=(0,r.prop)(),this.subtype=(0,r.prop)(),this.url=(0,r.prop)(),this.phoneNumber=(0,r.prop)(),this.selectionId=(0,r.prop)(),this.selected=(0,r.session)(!1)}}i.Proxy="templateButton";var a=(0,r.defineModel)(i);t.default=a},682988:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TemplateButtonCollection=void 0;var i=n(801255),a=r(n(311897));class o extends i.BaseCollection{}t.TemplateButtonCollection=o,o.model=a.default,o.comparator=(e,t)=>e.id<t.id?-1:e.id>t.id?1:0},286500:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(801255),i=n(17304);class a extends r.BaseCollection{}t.default=a,a.model=i.Msg,a.comparator=function(e,t){return t.t-e.t}},441809:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.timestamp=(0,r.prop)()}}i.Proxy="unreadMention";var a=(0,r.defineModel)(i);t.default=a},991036:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateDisappearingMode=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(227101),o=n(745454),s=n(27211),l=n(719380);function c(){return(c=(0,i.default)((function*(e,t,n){if(!(0,a.isDisappearingModeEnabled)())return Promise.resolve();const r=(0,o.createUserWid)(e.user),i=l.ContactCollection.get(r);if(i){const{disappearingModeSettingTimestamp:e}=i;if(null==e&&0!==n||null!=e&&e<n){const e={disappearingModeDuration:t,disappearingModeSettingTimestamp:n};yield(0,s.updateLocal)(r,e),i.set(e),__LOG__(2)`updateDisappearingMode: Contact=${r.toString()} updated, new duration=${t} t=${n}.`}}}))).apply(this,arguments)}},736473:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(422712),a=n(781572),o=r(n(847791)),s=n(669594),l=n(749835),c=n(317239),u=n(411290);class d extends u.BaseModel{constructor(){super(...arguments),this.id=(0,u.prop)(),this.peerJid=(0,u.prop)(),this.offerTime=(0,u.prop)(),this.isVideo=(0,u.prop)(!1),this.isGroup=(0,u.prop)(!1),this.groupCallParticipants=(0,u.prop)(),this.canHandleLocally=(0,u.prop)(!1),this.outgoing=(0,u.prop)(!1),this.webClientShouldHandle=(0,u.prop)(!1),this.participants=(0,u.collection)(o.default),this.callInfo=(0,u.prop)(),this._state=(0,u.prop)(),this._ringTimeout=(0,u.prop)()}getState(){return this._state}setState(e){var t;(t=this._state,e in f[t||"EMPTY"])&&(this._state=e,this._handleNotification())}_handleNotification(){const e=this.getState();if(!(!c.Conn.tosShowCallNotification||!this.peerJid||(0,s.isVoiceCallEnabled)()&&!this.isVideo||(0,s.isVideoCallEnabled)()&&this.isVideo))if(e===l.CALL_STATES.INCOMING_RING){a.Cmd.alertCall(this.peerJid,this.id,this.isVideo,this.isGroup,this.canHandleLocally);i.MainAudioChannel.claim(this,(()=>{}))()}else a.Cmd.cancelCall(this.peerJid)}getCollection(){return n(160868).CallCollection}}d.Proxy="call";var p=(0,u.defineModel)(d);t.default=p;const f={EMPTY:{[l.CALL_STATES.INCOMING_RING]:!0,[l.CALL_STATES.OUTGOING_CALLING]:!0,[l.CALL_STATES.CONNECTING]:!0,[l.CALL_STATES.REJECTED]:!0,[l.CALL_STATES.HANDLED_REMOTELY]:!0,[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.FAILED]:!0},INCOMING_RING:{[l.CALL_STATES.HANDLED_REMOTELY]:!0,[l.CALL_STATES.CONNECTING]:!0,[l.CALL_STATES.ACTIVE]:!0,[l.CALL_STATES.REJECTED]:!0,[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[l.CALL_STATES.FAILED]:!0},OUTGOING_CALLING:{[l.CALL_STATES.OUTGOING_RING]:!0,[l.CALL_STATES.CONNECTING]:!0,[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.FAILED]:!0,[l.CALL_STATES.ACTIVE]:!0,[l.CALL_STATES.NOT_ANSWERED]:!0,[l.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0},OUTGOING_RING:{[l.CALL_STATES.CONNECTING]:!0,[l.CALL_STATES.ACTIVE]:!0,[l.CALL_STATES.REJECTED]:!0,[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.FAILED]:!0,[l.CALL_STATES.NOT_ANSWERED]:!0},CONNECTING:{[l.CALL_STATES.ACTIVE]:!0,[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.REMOTE_CALL_IN_PROGRESS]:!0,[l.CALL_STATES.FAILED]:!0},CONNECTION_LOST:{[l.CALL_STATES.ACTIVE]:!0,[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.FAILED]:!0},ACTIVE:{[l.CALL_STATES.ENDED]:!0,[l.CALL_STATES.FAILED]:!0,[l.CALL_STATES.CONNECTION_LOST]:!0},HANDLED_REMOTELY:{},ENDED:{},REJECTED:{},REMOTE_CALL_IN_PROGRESS:{},FAILED:{},NOT_ANSWERED:{}}},160868:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.CallCollectionImpl=t.CallCollection=void 0;var i=r(n(81109)),a=r(n(682492)),o=r(n(114176)),s=n(88156),l=n(422712),c=r(n(364369)),u=r(n(736473)),d=r(n(29861)),p=n(266934),f=r(n(983938)),_=n(669594),h=n(445473),g=n(749835),m=n(930351),y=n(801255);const{VOIP_LOG_COLOR:S}=c.default;let E=null,v=null;class T extends y.BaseCollection{constructor(){super(...arguments),this.pendingOffers={},this.pendingVoipCapChecks={}}handleQuery(){return Promise.resolve()}handle(e){var t;E&&v||(E=n(84356).Voip,v=n(84356).checkVoipCapability);const r=e.shift();if(null===(t=r.data)||void 0===t?void 0:t[0]){const e=p.VoipSignaling.parseCallSignalingMsg(r);if(!e)return;let t={};(0,_.isVoiceCallEnabled)()&&(Array.isArray(r.data[0])&&(r.data=r.data[0]),(0,p.base64DecodeRecursively)(r.data),t={peer_jid:e.peer_jid,payload:r.data,peer_platform:e.peer_platform,peer_app_version:e.peer_version,epoch_msec:null!=e.t?String(1e3*e.t):void 0,elapsed_msec:null!=e.e?String(1e3*e.e):void 0,is_offline:r.data[1].offline});const n=e.call_id;let a=null,o=null,l=null;const c=JSON.parse(JSON.stringify(r)),u=c.data[2]&&c.data[2].find((e=>"enc"===e[0]));u&&(u[2]="xxx bytes"),__LOG__(2)`voip:incoming_signaling(peer):${JSON.stringify(e)}:`;let g=!1;switch(e.type){case h.TYPE.OFFER:if((0,m.getDoNotDisturb)()&&!d.default.isFocused)return void __LOG__(2)`CallCollection:handle: ignoring incoming call offer because do not disturb mode is enabled or screen is locked`;if(g=!0,a=e.isVideoCall,o=e.isGroupCall_DEPRECATED,l=e.t,E.isInitialized()){this.pendingVoipCapChecks[n]=Promise.all([v((0,i.default)({},e)),(0,f.default)()]).then((e=>{let[t,n]=e;return t&&n}));const t=r.data[2]&&r.data[2].find((e=>"enc"===e[0]));this.pendingOffers[n]=new s.Resolvable,this.pendingOffers[n].promise.then((e=>{e&&p.VoipSignaling.receiveCallOfferKey(e,t)}))}}this.pendingVoipCapChecks[n]?this.pendingVoipCapChecks[n].then((i=>{let s;var c;(s=!o&&(a?i&&(0,_.isVideoCallEnabled)():i),this.processIncomingCall(n,r.from,{isVideo:a,isGroupCall:o,canHandleLocally:s,offerTime:l}),s&&this.pendingOffers[n]&&(0,_.isVoiceCallEnabled)())?this.pendingOffers[n].promise.then((()=>{var n;null===(n=E)||void 0===n||n.handleIncomingSignalingMessage(e,t)})):(this.cleanupPendingOffer(n),null===(c=E)||void 0===c||c.handleIncomingSignalingMessage(e,t))})).finally((()=>{delete this.pendingVoipCapChecks[n]})):this.pendingOffers[n]?(g&&this.processIncomingCall(n,r.from),(0,_.isVoiceCallEnabled)()&&this.pendingOffers[n].promise.then((()=>{var n;null===(n=E)||void 0===n||n.handleIncomingSignalingMessage(e,t)}))):(g&&this.processIncomingCall(n,r.from,{isVideo:a,isGroupCall:o,canHandleLocally:!1,offerTime:l}),E.handleIncomingSignalingMessage(e,t))}else{__LOG__(2)`voip:incoming_signaling(paired phone):${JSON.stringify(r)}:`;const e=this.get(r.id);switch(r.type){case"offer_key":const t=this.pendingOffers[r.id];t&&r.key instanceof ArrayBuffer?t.resolve(r.key):__LOG__(3)`received offer_key: no pending offer`;break;case"accept":case"reject":e&&e.setState(g.CALL_STATES.HANDLED_REMOTELY),E.callEndByHandledRemotely(r.id),this.cleanupPendingOffer(r.id);break;case"terminate":e&&e.setState(g.CALL_STATES.ENDED),this.cleanupPendingOffer(r.id)}}}processIncomingCall(e,t,n){if(null!=this.get(e))return void __LOG__(2)`voip:processIncomingCall: Attempting to add existing call with call ID`;let r=n;const i={id:e};null!=t&&(i.peerJid=t),r&&(r=(0,o.default)(r,(e=>null==e)),(0,a.default)(i,r)),this.add(i,{merge:!0})}cleanupPendingOffer(e){delete this.pendingOffers[e]}setActiveCall(e){var t,n;this.activeCall,null===(t=this.activeCall)||void 0===t||t.webClientShouldHandle;this.activeCall=e,this.trigger("change:activeCall",e),null===(n=this._releaseAudioChannelClaim)||void 0===n||n.call(this),null!=e&&(this._releaseAudioChannelClaim=l.MainAudioChannel.claim(this,(()=>{})))}}t.CallCollectionImpl=T,T.model=u.default;const C=new T;t.CallCollection=C},850064:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.id=(0,r.prop)(),this.callId=(0,r.prop)(),this.isIncoming=(0,r.prop)(!1),this.isRinging=(0,r.prop)(!1),this.isInterrupted=(0,r.prop)(!1),this.isMuted=(0,r.prop)(!1),this.isTrafficStopped=(0,r.prop)(!1),this.isInvitingToGroupCall=(0,r.prop)(!1),this.isVideoStopped=(0,r.prop)(!1),this.isVideoPaused=(0,r.prop)(!1),this.isVideoDecodePaused=(0,r.prop)(!1),this.isVideoDecodeStarted=(0,r.prop)(!1),this.isOfferingVideoUpgrade=(0,r.prop)(!1)}}i.Proxy="callParticipant";var a=(0,r.defineModel)(i);t.default=a},847791:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(132304)),a=r(n(850064)),o=n(801255);class s extends o.BaseCollection{}t.default=s,s.model=a.default,s.comparator=(e,t)=>e.id===t.id?0:(0,i.default)(e.id,t.id)?-1:1},29861:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(411290);class i extends r.BaseModel{constructor(){super(...arguments),this.isFocused=(0,r.session)(!0)}initialize(){super.initialize(),this._handleFocus=this._handleFocus.bind(this),this._handleBlur=this._handleBlur.bind(this)}delete(){super.delete()}_handleFocus(){this.isFocused=!0}_handleBlur(){this.isFocused=!1}}i.Proxy="mainWindowState";var a=new((0,r.defineModel)(i));t.default=a},277107:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(749835),i=n(411290);class a extends i.BaseModel{constructor(){super(...arguments),this.callId=(0,i.prop)(),this.peerJid=(0,i.prop)(),this.pc=(0,i.prop)(),this.answer=(0,i.prop)(),this.localStream=(0,i.prop)(),this.remoteAudioStream=(0,i.prop)(),this.remoteVideoStream=(0,i.prop)(),this._state=(0,i.prop)(r.WEB_CALL_STATES.NONE)}getState(){return this._state}setState(e){const t=e;(function(e,t){const n=e||r.WEB_CALL_STATES.NONE;return t in s[n]})(this._state,t)&&(this._state=t)}}a.Proxy="webCall";var o=(0,i.defineModel)(a);t.default=o;const s={NONE:{[r.WEB_CALL_STATES.OUTGOING_CALLING]:!0,[r.WEB_CALL_STATES.INCOMING_CALLING]:!0},OUTGOING_CALLING:{[r.WEB_CALL_STATES.ACTIVE]:!0,[r.WEB_CALL_STATES.NONE]:!0},INCOMING_CALLING:{[r.WEB_CALL_STATES.ACTIVE]:!0,[r.WEB_CALL_STATES.NONE]:!0},ACTIVE:{[r.WEB_CALL_STATES.NONE]:!0}}},919037:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const n={cache:{},delete(){n.cache={}}};var r=n;t.default=r},765044:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Socket=void 0;var i=r(n(348926)),a=r(n(706410)),o=r(n(82569)),s=r(n(763105)),l=r(n(402525)),c=r(n(291966)),u=r(n(513218)),d=r(n(478718)),p=r(n(435161)),f=r(n(441609)),_=n(389385),h=n(180284),g=n(615688),m=n(108584),y=n(736184),S=n(640265),E=n(450796),v=n(413959),T=n(904352),C=n(638284),A=n(257243),b=n(492574),P=n(88555),O=n(40234),M=n(781572),I=Ie(n(386374)),w=n(845831),R=n(438184),N=r(n(904285)),L=n(854602),D=n(788950),k=r(n(379264)),U=Ie(n(435232)),G=n(408139),x=n(859557),B=n(36172),F=n(400922),j=n(826066),Y=n(280863),K=n(555452),W=n(546718),H=n(978820),V=n(711597),$=Ie(n(266333)),z=n(491442),q=r(n(738469)),J=r(n(730381)),Q=n(47406),X=n(411290),Z=r(n(604550)),ee=r(n(169048)),te=n(317239),ne=r(n(766405)),re=r(n(617327)),ie=r(n(833163)),ae=r(n(171520)),oe=r(n(319902)),se=n(727086),le=n(277303),ce=n(216703),ue=n(546582),de=n(776214),pe=r(n(851783)),fe=n(685417),_e=n(294398),he=r(n(807353)),ge=n(964551),me=r(n(268132)),ye=n(400318),Se=n(662583),Ee=r(n(794030)),ve=n(424439),Te=r(n(177853)),Ce=r(n(312523)),Ae=r(n(297744)),be=r(n(3121)),Pe=r(n(615078)),Oe=n(966567);function Me(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(Me=function(e){return e?n:t})(e)}function Ie(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=Me(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}class we extends((0,S.customError)("ExternalPoke")){}class Re extends((0,S.customError)("MustExitLoop")){}class Ne extends((0,S.customError)("Denied401Failed")){}class Le extends((0,S.customError)("Denied409Conflict")){}class De extends((0,S.customError)("DeniedTOS")){}class ke extends((0,S.customError)("DeniedTOSGDPR",!0,De)){}class Ue extends((0,S.customError)("DeniedTOSSMB",!0,De)){}class Ge extends((0,S.customError)("DeniedUnknown")){}class xe extends((0,S.customError)("ForcedRefresh")){}class Be extends((0,S.customError)("TooManyRefRequest")){}class Fe extends((0,S.customError)("UILogout")){}class je extends((0,S.customError)("WindowOffline")){}class Ye extends((0,S.customError)("PhoneFailedPing")){}class Ke extends((0,S.customError)("AssertionFailed")){}class We extends((0,S.customError)("TakeoverRequested")){}class He extends((0,S.customError)("PhoneReplacedClient")){}class Ve extends((0,S.customError)("NoSecretBundle")){}class $e extends((0,S.customError)("PhoneKickedClient")){}class ze extends((0,S.customError)("TempServerError")){}const qe={SYNC_INFO:["Conn",ie.default.OBJECT],CHALLENGE:["Cmd",{type:"challenge",challenge:ie.default.STRING}],DISCONNECT:["Cmd",{type:"disconnect",kind:void 0}],HARD_REFRESH:["Cmd",{type:"update"}],UPGRADE_MD_FOR_INTERNAL_USER:["Cmd",{type:"upgrade_md"}],UPGRADE_MD_FOR_PROD:["Cmd",{type:"upgrade_md_prod",version:void 0}],PONG:["Pong",ie.default.BOOLEAN]},Je={TAG:e=>new ie.default({tag:e,data:ie.default.ANY,binarySize:ie.default.ANY}),SYNC_INFO:new ie.default({tag:ie.default.ANY,data:qe.SYNC_INFO,binarySize:ie.default.ANY}),CHALLENGE:new ie.default({tag:ie.default.ANY,data:qe.CHALLENGE,binarySize:ie.default.ANY}),DISCONNECT:new ie.default({tag:ie.default.ANY,data:qe.DISCONNECT,binarySize:ie.default.ANY}),HARD_REFRESH:new ie.default({tag:ie.default.ANY,data:qe.HARD_REFRESH,binarySize:ie.default.ANY}),UPGRADE_MD_FOR_INTERNAL_USER:new ie.default({tag:ie.default.ANY,data:qe.UPGRADE_MD_FOR_INTERNAL_USER,binarySize:ie.default.ANY}),UPGRADE_MD_FOR_PROD:new ie.default({tag:ie.default.ANY,data:qe.UPGRADE_MD_FOR_PROD,binarySize:ie.default.ANY}),PONG:new ie.default({tag:ie.default.ANY,data:qe.PONG,binarySize:ie.default.ANY})},Qe=new ie.default({status:e=>"number"==typeof e&&e>=500,_:void 0}),Xe=new ie.default({status:e=>"number"==typeof e&&499===e,_:void 0}),Ze=new ie.default({status:e=>"number"==typeof e,_:void 0});class et extends X.BaseModel{constructor(){super(...arguments),this.socketPreload=(0,X.session)(),this.socket=(0,X.session)(),this.launchGeneration=(0,X.session)(0),this.backoffGeneration=(0,X.session)(0),this.hasSynced=(0,X.session)(),this.state=(0,X.session)(Se.SOCKET_STATE.UNLAUNCHED),this.stream=(0,X.session)(Se.SOCKET_STREAM.DISCONNECTED),this.canSend=(0,X.session)(),this.sendQueue=(0,X.session)(),this.sendHash=(0,X.session)(),this.cancelHash=(0,X.session)(),this.doubleAckHash=(0,X.session)(),this.sequence=(0,X.session)(0),this.shortTagBase=(0,X.session)(),this.socketWatcher=(0,X.session)(),this.refWatcher=(0,X.session)(),this.phoneWatchdog=(0,X.session)(),this.pendingPhoneReqs=(0,X.session)(0),this.isIncognito=(0,X.session)(),this.runPromise=(0,X.session)(),this.streamPromise=(0,X.session)(),this.conflictPromise=(0,X.session)(),this.resumePromise=(0,X.session)(),this.logoutMutex=(0,X.session)(0),this.retryTimestamp=(0,X.session)(),this.pokeable=(0,X.session)(),this.launched=(0,X.session)(),this.mustExitLoop=(0,X.session)(),this.syncTag=(0,X.session)(),this.lastPhoneMessage=(0,X.session)(),this.shouldForceReconnect=(0,X.session)(!1),this.shouldUpgradeToMDIntern=(0,X.session)(!1),this.shouldUpgradeToMDPord=(0,X.session)(!1)}initialize(){(0,P.isLegacyWebdBackend)()&&(this.sendQueue=[],this.sendHash={},this.cancelHash={},this.doubleAckHash={},this.phoneWatchdog=new Oe.Watchdog({waitAlgorithm:(0,Oe.fibonacci)(3e3,3e3,36e5),onTimeout:this.phoneTimedOut.bind(this),onActivated:this._handlePhoneWatchdogActivated.bind(this),onFed:this._handlePhoneWatchdogFed.bind(this),onDeactivated:this._handlePhoneWatchdogDeactivated.bind(this)})),this.listenTo(this,"change:state",this._handleStateChange.bind(this)),this.listenTo(this,"change:stream",this._handleStreamChange.bind(this)),(0,v.delayMs)(0).then(oe.default).then((e=>{this.isIncognito=e})),this.listenTo(M.Cmd,"log_socket_summary",this.summary),this.listenTo(M.Cmd,"set_socket_state",(e=>{this.state=e})),this.listenTo(M.Cmd,"open_socket_stream",(()=>{this.openStream(),this.hasSynced&&this.set({stream:Se.SOCKET_STREAM.CONNECTED})})),this.listenTo(M.Cmd,"socket_stream_disconnected",(()=>{this.set({stream:Se.SOCKET_STREAM.DISCONNECTED})})),this.listenTo(M.Cmd,"on_critical_sync_done",(()=>{__LOG__(2)`[ws2] observed on_critical_sync_done`,this._handleCriticalSyncDone()})),this.listenTo(M.Cmd,"main_stream_mode_ready",(()=>{__LOG__(2)`[ws2] observed main_stream_mode_ready`,!(0,P.isMDBackend)()||(0,V.getAllCriticalDataSynced)()?(__LOG__(2)`[ws2] moving to main screen from main_stream_mode_ready`,this.set({hasSynced:!0,stream:Se.SOCKET_STREAM.CONNECTED})):__LOG__(2)`[ws2] did not meet conditions to move to main screen`})),this.listenTo(M.Cmd,"socket_stream_disconnected",(()=>{this.stream=Se.SOCKET_STREAM.DISCONNECTED}))}preload(){(0,P.isLegacyWebdBackend)()&&(this.socketPreload=new Ee.default)}send(e){const t=new he.default(e);this.sendQueue.push(t),this.flushQueue()}send2(e){return new Promise(((t,n)=>{const r=new he.default(e);r.onSend=t,r.onDrop=n,this.sendQueue.push(r),this.flushQueue()}))}shortTag(){return this.shortTagBase||(this.shortTagBase=((0,J.default)().unix()%1e3).toString()),`${this.shortTagBase}.--${this.sequence++}`}tag(e){return`${(0,J.default)().unix()}.--${this.sequence++}`}launch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;__LOG__(2)`ws2:Launch gen${this.launchGeneration} (backoff gen${this.backoffGeneration})`;const n=300*(0,h.expBackoff)(this.backoffGeneration,100),r=Date.now()+n;if(this.launched)return __LOG__(4,void 0,new Error,!0)`ws2:launch redundantly called!`,void SEND_LOGS("redundant-launch");function i(){__LOG__(2)`ws2:socket loop closed`,this.socketPreload&&this.socketPreload.deactivate(),this.clearState(),this.set({state:Se.SOCKET_STATE.UNLAUNCHED,mustExitLoop:!1,launched:!1,socketPreload:null})}this.mustExitLoop?i.call(this):(this.launched=!0,this.run(t,e).then((function(e){return[e,!1]})).catch((0,E.filteredCatch)(Re,(()=>(this.mustExitLoop=!0,[!1,!1])))).catch((0,E.filteredCatch)(We,(function(){return[!1,!0]}))).catch((e=>(__LOG__(3,!0,void 0,!0)`ws2:run error unknown!\n${e.stack}`,SEND_LOGS("unknown-error-in-ws-loop"),this.clearState(),[!0,!1]))).then((e=>{let[t,a]=e;if(this.mustExitLoop)i.call(this);else{const e=Date.now();this.launchGeneration++,this.backoffGeneration=t&&e<r+6e4?this.backoffGeneration+1:0;const i=e<r?Math.min(r-e,n):0;this.launched=!1,this.launch(a,i)}})))}poke(){this.pokeable?this.pokeable.poke():this.phoneWatchdog.forceTimeout()}takeover(){if(!this.conflictPromise)throw"Takeover called without conflict!";this.conflictPromise.cancel(new We)}exitLoop(e){this.mustExitLoop=!0,this.runPromise&&this.runPromise.cancel(e||new Re)}_setLogoutDirtyBit(){N.default&&N.default.setItem(W.KEYS.LOGOUT_DIRTY_BIT,"1")}_removeLogoutDirtyBit(){N.default&&N.default.removeItem(W.KEYS.LOGOUT_DIRTY_BIT)}_hasDirtyBitSet(){N.default&&N.default.getItem(W.KEYS.LOGOUT_DIRTY_BIT)}clearCredentialsAndStoredData(e){var t=this;return(0,i.default)((function*(){let n=!1;e===D.LogoutReason.ClientFatalError&&(n=!0),t._setLogoutDirtyBit(),n=yield t.clearCredentials(),t._hasDirtyBitSet()&&(n=!0),t._setLogoutDirtyBit();try{yield t.destroyStorage()}catch(e){n=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`destroyStorage: failed with error ${e}`}(0,P.isMDBackend)()&&((0,x.handleOfflineNotifications)(!1),(0,A.clearABPropConfigs)()),n||t._removeLogoutDirtyBit();const r=new Te.default;if(n&&"Firefox"!==k.default.info().name&&r.set("post_logout","1"),e){const t=(0,L.getErrorCodeFromLogoutReason)(e);t&&r.set("logout_reason",t)}const i=r.toString();null==i||""===i?window.location.reload():window.location.href=`${window.location.pathname}?${r.toString()}`}))()}destroyStorage(){return(0,i.default)((function*(){const e=[(0,de.destroy)(),(0,ve.destroyStorage)()];(0,P.isMDBackend)()&&(e.push((0,se.destroy)()),e.push((0,fe.destroy)()),e.push((0,ce.destroy)()),e.push((0,_e.destroy)()),e.push(ee.default.clearInitializationPromises())),yield Promise.all(e)}))()}logout(){var e=this;let t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.LogoutReason.UserInitiated;N.default&&(0,P.isMDBackend)()&&(N.default.removeItem("WebEncKeySalt"),N.default.removeItem("WANoiseInfo")),(0,le.get)().setLogoutState(!0),(0,P.isLegacyWebdBackend)()?t=this.runPromise:M.Cmd.onStartingLogout(),__LOG__(2)`ws2:user logged out`;let o=Promise.resolve();if((0,P.isMDBackend)()){const e=Math.min(20,Math.max(0,ge.ServerProps.syncdSentinelTimeoutSeconds));o=(0,C.promiseTimeout)(n(837933).Z(),1e3*e).catch((()=>__LOG__(3)`ws2: multi-device logout did not manage to send sentinel patch`))}(0,C.promiseTimeout)(o.then((()=>{this.stream===Se.SOCKET_STREAM.DISCONNECTED||r?this.sendCurrentLogout(null,a):this.sendCurrentLogout(this.socket,a)})).catch(function(){var t=(0,i.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sendCurrentLogoutPromise errored with ${t}`,yield e.clearCredentialsAndStoredData(a),M.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()),3e3,"network request took more than 3 seconds").then((0,i.default)((function*(){(0,P.isLegacyWebdBackend)()&&(M.Cmd.onStartingLogout(),yield new Promise((e=>setTimeout(e,100)))),yield e.clearCredentialsAndStoredData(a),t&&t.cancel(new Fe),e.state===Se.SOCKET_STATE.OPENING&&e.trigger("change:state"),M.Cmd.logout()}))).catch(function(){var t=(0,i.default)((function*(t){__LOG__(4,void 0,new Error)`ws2: [logout error] sentinelPromise or sendCurrentLogoutPromise timed out with ${t}`,yield e.clearCredentialsAndStoredData(a),M.Cmd.logout()}));return function(){return t.apply(this,arguments)}}()).finally((()=>{(0,le.get)().setLogoutState(!1)}))}lockScreen(){this.set({state:Se.SOCKET_STATE.LOCKED})}unlockScreen(){this.set({state:Se.SOCKET_STATE.CONNECTED})}summary(){__LOG__(2)`ws:summary --------------------------------`,__LOG__(2)`ws state           ${this.state}`,__LOG__(2)`wd online:         ${String(navigator.onLine)}`,__LOG__(2)`ws socket id:      ${this.socket?this.socket.id:"n/a"}`,__LOG__(2)`ws queue:`,(0,f.default)(this.sendQueue)||q.default.print((0,p.default)(this.sendQueue,(function(e){const t=(0,d.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`})),__LOG__(2)`ws hash:`,(0,f.default)(this.sendHash)||q.default.print((0,p.default)(this.sendHash,(function(e){const t=(0,d.default)(e,"tag","state","age","ephemeral","isToPhone");return(null==e?void 0:e.toString)&&(t.debug=e.toString()),t}))).split(/\n/).forEach((function(e){__LOG__(2)`${e}`}))}registerHandler(e){(0,P.isMDBackend)()||(this.handler&&(__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("ws2: attempting to register handler multiple times")),this.handler=e)}_handleStateChange(){__LOG__(2)`ws2:state change: ${this.state}`}_handleStreamChange(){__LOG__(2)`ws2:stream change: ${this.stream}`,this.stream===Se.SOCKET_STREAM.DISCONNECTED&&((0,P.isMDBackend)()?Pe.default.clear():this._handleRefCycle(),this.unset("resumePromise"))}_handleRefCycle(){__LOG__(2)`ws2:onRefCycle`,this.sendQueue.forEach((function(e){e.state=he.default.STATE.NEW,e.age=0})),this.clearSendHash()}_handleActivity(e){if(e){const t=e.data;if(Je.UPGRADE_MD_FOR_INTERNAL_USER.test(e))__LOG__(2)`ws2: can upgrade to md! (flow for internal users)`,this.shouldUpgradeToMDIntern=!0,this.exitLoop();else if(Je.UPGRADE_MD_FOR_PROD.test(e)){if(__LOG__(2)`ws2: upgrade to md! (flow for external users)`,Array.isArray(t)&&2===(null==t?void 0:t.length)&&t[1]&&t[1].type&&t[1].version){const e="string"==typeof t[1].version&&t[1].version,n=e&&new j.Version(e),r=new j.Version(j.SANITIZED_VERSION_STR);if(n&&r.lt(n))return(0,K.setMdOptedIn)(!0),F.Updater.restart(!0),void this.exitLoop()}this.shouldUpgradeToMDPord=!0,this.exitLoop()}else if(Je.HARD_REFRESH.test(e))__LOG__(2)`ws2:hard refresh!`,F.Updater.restart(!0);else if(t){const n=Array.isArray(t)?` [${String(t[0])}, ...]`:"",r=(0,u.default)(t)&&"number"==typeof t.status?t.status:null;Pe.default.logRecv(e.tag,e.binarySize,r);const i=null!=r?`,{status:${r}}`:"";__LOG__(2)`    recv: ${e.tag}${n}${i}`}else Pe.default.logAck(e.tag),__LOG__(2)`     ack: ${e.tag}`}else O.Clock.setSkew(this.socket.timeSkew||0);this.sendRemainingLogouts()}_handlePhoneWatchdogActivated(){}_handlePhoneWatchdogFed(){this.state=Se.SOCKET_STATE.CONNECTED}_handlePhoneWatchdogDeactivated(){}flushQueue(){if(!this.sendQueue.length)return;const e=this.sendQueue.filter((e=>e.state===he.default.STATE.NEW&&this.canRequestBeSent(e))),t=O.Clock.localUnixTime(),n=[],r=[];e.forEach((e=>{!function(e,t){if(e.resendGuard&&!e.resendGuard())return!0;if(e.binaryOpts&&null!=e.binaryOpts.expires&&0!==e.binaryOpts.expires)return t-e.binaryOpts.expires>120;return!1}(e,t)?r.push(e):n.push(e)})),this.sendQueue=(0,c.default)(this.sendQueue,n),n.forEach((e=>{delete this.sendHash[e.tag],delete this.doubleAckHash[e.tag],Pe.default.delete(e.tag),e.onSend({status:408})})),r.length&&r.forEach((e=>{this._send(e)}))}phoneTimedOut(){const e=this.phoneWatchdog.failGeneration;if(1===e){__LOG__(3)`ws2:Phone timed out`;const e=(0,p.default)(this.sendHash,"tag");__LOG__(3)`ws2:Outstanding Reqs: ${e.join(",")}`}M.Cmd.sentPing(e);const t=this.phoneWatchdog.waitAlgorithm(this.phoneWatchdog);return this.set({state:Se.SOCKET_STATE.TIMEOUT,retryTimestamp:Date.now()+t}),this._basicSend({tag:this.tag("ping"),data:["admin","test"]},"ping"),!0}clearSendHash(e){if(e)(0,l.default)(this.sendHash,(function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new b.LogoutDrop(e.toString()))}));else{const e=(0,s.default)(this.sendHash,"ephemeral");__LOG__(3)`Ephemeral Drop: ${(0,p.default)(e,"tag").join(",")}`,e.forEach((function(e){e.resendTimer&&clearTimeout(e.resendTimer),e.onDrop(new b.EphemeralDrop(e.toString()))}))}this.sendHash={},this.doubleAckHash={},this.pendingPhoneReqs=0,this.phoneWatchdog&&this.phoneWatchdog.deactivate(),Pe.default.clear()}_basicSend(e,t){__LOG__(2)`low-send: ${t} ${String(e.tag)}`,Pe.default.logBasicSend(e.tag,e.data),this.socket.cast(`${String(e.tag)},${String(JSON.stringify(e.data))}`)}_send(e){e.tag=e.getTag()||this.shortTag(),e.onTag&&e.onTag(e.tag),this.sendHash[e.tag]=e,e.tagToCancel&&(this.cancelHash[e.tag]=e.tagToCancel),(e.isCallOffer||e.isWap4Bridge)&&(this.doubleAckHash[e.tag]=e),e.binaryOpts?e.binaryOpts.debugObj:e.data,Pe.default.logSend(e),__LOG__(2)`    send: ${String(e.tag)}, ${e.toString()}`,this.socket.send(e.serialize()),e.isToPhone&&this.pendingPhoneReqs++,e.state=he.default.STATE.SENT}sendBasic(e){return this.socket?(e.tag=this.tag(),this._basicSend(e,"external"),this.socket.nextMessage(Je.TAG(e.tag))):Promise.reject(new Error("socket not open"))}sendEphemeral(e){e.ephemeral=!0;const t=new he.default(e);this.canRequestBeSent(t)?this._send(t):t.onDrop(new b.EphemeralDrop(t.toString()))}sendEphemeral2(e){return new Promise(((t,n)=>{const r=new he.default(e);r.ephemeral=!0,this.canRequestBeSent(r)?(r.onSend=t,r.onDrop=e=>{__LOG__(4,void 0,new Error)`ws2:sendEphemeral2:request.onDrop`,n(e)},this._send(r)):n(new b.EphemeralDrop(r.toString()))}))}sendEphemeralIgnore(e){e.ephemeral=!0,e.ignore=!0,e.tag=this.tag();const t=new he.default(e);if(this.canRequestBeSent(t)){const e=t.serialize();this.socket.send(e),__LOG__(2)`sending: ${String(t.tag)}, ${t.toString()}`}else t.onDrop(new b.EphemeralDrop(t.toString()))}on5xx(e){__LOG__(3)`ws2:onMessage 5xx error ${String(e.tag)}`,e.on5xx&&e.on5xx(),e.resends>=5?(__LOG__(3)`ws2:onMessage dropping ${String(e.tag)}`,e.onDrop(new b.Server5xxDrop),delete this.sendHash[e.tag],Pe.default.delete(e.tag),this.sendQueue=(0,o.default)(this.sendQueue,e)):this.maybeResendRequestEventually(e)}_handleMessage(e){const t=e.tag,r=e.data,i=e.binarySize;if(tt(r)&&(this.lastPhoneMessage=(0,J.default)().unix()),Je.PONG.test(e)){if(r[1]){let e=0,t=!1;(0,l.default)(this.sendHash,(function(r){if(!r.isToPhone)return;const i=++r.age;40===i?(t=!0,__LOG__(4,void 0,new Error)`${r.tag+" likely dead: "+r.toString()}`,M.Cmd.cannotReachPhone("("+r.tag+") "+r.toString()),n(656891).default.cannotReachPhone()):i<40&&e++})),this.pendingPhoneReqs=e,this.phoneWatchdog.feed(),0===e&&this.phoneWatchdog.deactivate(),t&&__LOG__(3)`ws2:error-cannot-reach-phone`}else this.state!==Se.SOCKET_STATE.TIMEOUT?__LOG__(3)`ws2:Pang while not timed-out`:this.runPromise.cancel(new Ye);return}const a=this.sendHash[t];if(a){if(!r)return a.state=he.default.STATE.WEBDACKED,void(a.isToPhone&&this.phoneWatchdog.activate());if(a.retryOn5xx&&Qe.test(r))this.on5xx(a,r);else{let n=!0;if(this.doubleAckHash[t]&&(delete this.doubleAckHash[t],!a.isCallOffer&&!a.isWap4Bridge||200!==r.status||r.payload||(n=!1)),n){let n;try{a.logOnSend&&a.logOnSend(e),n=a.onSend(r)}catch(e){if(e instanceof b.E401)return void this.logout();__LOG__(3)`ws2:onMessage error`,a.onDrop(e)}if(Qe.test(n)?this.on5xx(a,n):(delete this.sendHash[t],this.sendQueue=(0,o.default)(this.sendQueue,a)),Xe.test(r)){const e=this.cancelHash[t];if(e){const n=this.sendHash[e];delete this.cancelHash[t],delete this.sendHash[e],this.sendQueue=(0,o.default)(this.sendQueue,n)}}}}a.isToPhone&&(a.age<40&&this.pendingPhoneReqs--,this.phoneWatchdog.feed(),0===this.pendingPhoneReqs&&this.phoneWatchdog.deactivate())}else if(r){if(Ze.test(r))__LOG__(3)`ws2: unexpected response status`;else if(r instanceof ArrayBuffer)n(656891).default.handle(r,this,t,i).catch((0,E.filteredCatch)(b.WebdDrop,(()=>{})));else try{this.handler?this.handler(r):__LOG__(3)`ws2: received message, but no handler is registered`}catch(e){if(e instanceof U.UpdateImmediately)this.exitLoop(e);else{if(!(e instanceof U.DeprecatedProtocolVersion))throw e;this.runPromise&&this.runPromise.cancel(e)}}tt(r)&&this.phoneWatchdog.feed()}}run(e,t){var n=this;return this.runPromise=ae.default.resolve(e).cancellable().then((e=>{if(this.state=Se.SOCKET_STATE.OPENING,M.Cmd.incrementProgress(),e>0){__LOG__(2)`ws2:Run Backoff ${e}ms`;const t=(0,v.delayMs)(e).cancellable().catch((0,E.filteredCatch)(we,(()=>{})));return this.setPokeable(t,Date.now()+e),t}})).finally((()=>{this.unset("pokeable"),this.unset("retryTimestamp")})).then((()=>(M.Cmd.incrementProgress(),__LOG__(2)`ws2:Running`,this.openSocket()))).then((e=>{if(M.Cmd.incrementProgress(),e.onactivity=this._handleActivity.bind(this),this.socket=e,this.socketWatcher=(0,re.default)(this.runPromise,this.throwOnClose()),this.state=Se.SOCKET_STATE.PAIRING,void 0===this.isIncognito)return(0,Ce.default)(this,"change:isIncognito")})).then((()=>{M.Cmd.incrementProgress(),this.shortTagBase=((0,J.default)().unix()%1e3).toString();const e=this.initConn();if((0,K.knowsPhone)()){const n=this.requestSync(t),r=Promise.all([e,n]).finally((function(){e.cancel(),n.cancel()})),i=(0,ue.requireChatCollection)().then((e=>{this.hasSynced&&e.length<=5e3&&(0,P.isLegacyWebdBackend)()&&(this.resumePromise=this.runResume(!0))}));return Promise.all([r,i])}return e.then((()=>{this.set({state:Se.SOCKET_STATE.UNPAIRED,refWatcher:(0,re.default)(this.runPromise,this.manageRef())})}))})).then((()=>this.waitForSyncInfo())).finally((()=>{this.refWatcher&&(this.refWatcher.cancel(),this.unset("refWatcher"))})).then(function(){var e=(0,i.default)((function*(e){return M.Cmd.incrementProgress(),__LOG__(2)`ws2:completed ${n.hasSynced?"re-auth":"auth"}`,n.state=Se.SOCKET_STATE.CONNECTED,te.Conn.blockStoreAdds=!1,te.Conn.platform=e.platform,yield(0,Ae.default)(),e}));return function(){return e.apply(this,arguments)}}()).then((function(e){return __LOG__(2)`ws2:main loaded`,e.initial=!0,(0,ne.default)([e])})).then((()=>(0,de.initialize)().catch((e=>{__LOG__(3)`Error initializing database during sync: ${e}`,__LOG__(4,void 0,new Error,!0)`Assertion failed!`,SEND_LOGS("Error initializing database during sync")})))).then((()=>{const e=this.openStream();return this.streamPromise=e,e})).then((function(){return new ae.default})).catch((0,E.filteredCatch)(U.SocketClosed,(function(e){throw e.event instanceof Fe?e.event:e}))).catch((e=>{__LOG__(3)`ws2:run loop interrupt: ${e}`,this.set({canSend:!1,stream:Se.SOCKET_STREAM.DISCONNECTED,runPromise:null}),this.phoneWatchdog.deactivate(),this.streamPromise&&(this.streamPromise.cancel(),this.unset("streamPromise")),this.socketWatcher&&(this.socketWatcher.cancel(),this.unset("socketWatcher"));const t=this.socket;if(t&&t.state!==Se.WATCHED_SOCKET_STATE.CLOSED&&(t.detachCallbacks(),t.close(!0,e)),this.unset("socket"),this.shouldUpgradeToMDIntern)return M.Cmd.upgradeToMDInternal(),!1;if(this.shouldUpgradeToMDPord)return M.Cmd.upgradeToMDProd(),!1;throw e})).catch((0,E.filteredCatch)(U.UpdateImmediately,(e=>{throw this.updateImmediately(e.message),new Re}))).catch((0,E.filteredCatch)(U.DeprecatedProtocolVersion,(()=>this.deprecatedVersion()))).catch((0,E.filteredCatch)([b.E401,Ye],(function(){return!1}))).catch((0,E.filteredCatch)(xe,(()=>(this.clearState(),!1)))).catch((0,E.filteredCatch)([U.SocketClosed,U.SocketError,ze],(()=>!0))).catch((0,E.filteredCatch)(Ge,function(){var e=(0,i.default)((function*(){return __LOG__(3)`ws2:sync rejected, logging out`,yield n.sendCurrentLogout(null,D.LogoutReason.UnknownCompanion),yield n.clearCredentialsAndStoredData(),M.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,E.filteredCatch)([Ne,$e],function(){var e=(0,i.default)((function*(e){return __LOG__(2)`ws2:phone disassociated via ${String(e)}`,yield n.clearCredentialsAndStoredData(),M.Cmd.logout(),!1}));return function(){return e.apply(this,arguments)}}())).catch((0,E.filteredCatch)(Ve,(0,i.default)((function*(){return __LOG__(3,void 0,void 0,!0)`ws2:No secret bundle!`,SEND_LOGS("no-secret-bundle"),yield n.clearCredentialsAndStoredData(),M.Cmd.logout(),!1})))).catch((0,E.filteredCatch)(Be,(()=>(this.state=Se.SOCKET_STATE.UNPAIRED_IDLE,this.setPokeable((0,be.default)().then((()=>{throw new je})).catch((0,E.filteredCatch)(we,(()=>!1)))))))).catch((0,E.filteredCatch)(U.BlockedByProxy,(()=>(k.default.promptUnloadGuards++,this.state=Se.SOCKET_STATE.PROXYBLOCK,this.setPokeable((new ae.default).catch((0,E.filteredCatch)(we,(()=>!1))).finally((function(){k.default.promptUnloadGuards--}))))))).catch((0,E.filteredCatch)(De,(e=>{__LOG__(2)`ws2:denied tos`;const t=this.setPokeable((new ae.default).cancellable().catch((0,E.filteredCatch)(we,(()=>!1)))).cancellable(),n=e instanceof ke?Se.SOCKET_STATE.TOS_BLOCK:Se.SOCKET_STATE.SMB_TOS_BLOCK;return this.clearState(),this.set({state:n,runPromise:t}),t}))).catch((0,E.filteredCatch)([Le,He],(e=>{e instanceof Le?__LOG__(2)`ws2:phone denied (conflict)`:__LOG__(2)`ws2:phone replaced`;const t=(new ae.default).cancellable();return this.set({state:Se.SOCKET_STATE.CONFLICT,conflictPromise:t,runPromise:t}),this.clearState(),t}))).finally((()=>{this.conflictPromise&&this.conflictPromise.cancel()})).catch((0,E.filteredCatch)([Fe,je],(function(){return!1})))}openSocket(){const e=this.socketPreload;if(this.socketPreload=null,(null==e?void 0:e.socket)&&e.socket.state===Se.WATCHED_SOCKET_STATE.OPEN)return Promise.resolve(e.socket);const t=e&&e.active?e:new Ee.default,n=()=>{this.retryTimestamp=t.retryTimestamp};t.on("change:retryTimestamp",n),this.pokeable=t;const r=(0,Ce.default)(t,"change:socket").cancellable().then((()=>t.socket)).finally((()=>{t.off("change:retryTimestamp",n),t.onerror=null,t.deactivate(),this.pokeable=null}));return t.onerror=e=>{r.cancel(e)},r}initConn(){var e=this;return(0,i.default)((function*(){const t=e.tag("init"),n=k.default.info(),r=[Number("2"),Number("2228"),Number("14")];e._basicSend({tag:t,data:["admin","init",r,[n.os||"Unknown",n.name||"Unknown",n.version||"Unknown"],k.default.id(),!e.isIncognito&&!!z.userPreferencesStore.getRememberMe()]},"init");const i=yield e.socket.nextMessage(Je.TAG(t)).get("data");O.Clock.setSkew(Date.now()-i.time),(0,ne.default)([{id:"1",ref:i.ref,refTTL:i.ttl}])}))()}manageRef(){var e=this;return(0,T.promiseLoop)(function(){var t=(0,i.default)((function*(t,n,r){const i=te.Conn.refExpiry-Date.now()-500,a=(yield(0,v.delayMs)(Math.max(i,0)).cancellable().then((()=>{if(r>=5)throw new Be;__LOG__(2)`ws2:Requesting Ref Update`;const t=e.tag("qr"+r);return e._basicSend({tag:t,data:["admin","Conn","reref"]},"reref"),e.socket.nextMessage(Je.TAG(t))}))).data;switch(a.status){case 200:return __LOG__(2)`ws2:Updating Ref`,void(0,ne.default)([{ref:a.ref,refTTL:a.ttl}]);case 304:return __LOG__(2)`ws2:Keeping Ref`,void t();case 429:throw __LOG__(2)`ws2:Server denied new ref`,new Be;default:throw __LOG__(3)`ws2:Bad Ref Response!`,new Ke("unrecognized ref request status ("+a.status+")")}}));return function(){return t.apply(this,arguments)}}()).cancellable()}requestSync(e){if(this.syncTag=this.tag("sync"),!$.load())return Promise.reject(new Ve);const{client:t,server:n}=(0,K.getLoginTokens)(),r=["admin","login",t,n,k.default.id()];e?r.push("takeover"):this.hasSynced&&(r.push(this.shouldForceReconnect?"force_reconnect":"reconnect"),r.push((0,H.getMaybeMeUser)()));const i=()=>(this._basicSend({tag:this.syncTag,data:r},"sync"),!0),a=new Oe.Watchdog({waitAlgorithm:(0,Oe.fibonacci)(0,8500,6e4),onTimeout:i});a.on("change:ts",(()=>{this.retryTimestamp=a.ts})),this.pokeable=a,a.activate(),i();const o=this.socket.nextMessage(Je.TAG(this.syncTag)),s=this.lookForAndHandleChallenge().catch((0,_.catchAbort)((()=>{}))).catch(o.cancel.bind(o));return o.then((e=>{__LOG__(2)`ws2:login`;const t=e.data;switch(t.status){case 200:return e;case 401:throw new Ne;case 403:throw t.tos>=2?new ke:t.smbTos?new Ue:new Ge;case 405:throw __LOG__(3,void 0,void 0,!0)`ws2:Already authorized!`,SEND_LOGS("already-authorized"),new xe;case 409:throw new Le;case 500:throw new ze;default:throw __LOG__(3)`ws2:unknown error! status:${t.status}`,new Ge}})).finally((()=>{s.cancel(),a.deactivate(),this.unset("pokeable"),this.unset("retryTimestamp")}))}waitForSyncInfo(){var e=this;return(0,i.default)((function*(){return(yield e.socket.nextMessage(Je.SYNC_INFO)).data[1]}))()}lookForAndHandleChallenge(){var e=this;return(0,i.default)((function*(){const t=yield e.socket.nextMessage(Je.CHALLENGE).then((function(e){__LOG__(2)`ws2:challenged!`;const t=(0,g.decodeB64)(e.data[1].challenge);return $.getSecurityToken(t)})).then((t=>{const n=(0,K.getLoginTokens)(),r=n?n.server:void 0;if(!r)throw __LOG__(3)`ws2:handleChallenge no server token!`,new Error("Handle challenge no server token");const i=e.tag("challenge");return e._basicSend({tag:i,data:["admin","challenge",t,r,k.default.id()]},"challenge"),e.socket.nextMessage(Je.TAG(i))}));return t.data.status>=500?Promise.reject(new ze):t.data.status>=400?(__LOG__(3)`ws2:handleChallenge failed challenge!`,Promise.reject(new Ne)):void __LOG__(2)`ws2:handleChallenge passed challenge`}))()}throwOnClose(){return this.socket.nextMessage(Je.DISCONNECT).then((function(e){throw"replaced"===e.data[1].kind?new He:new $e}))}_handleCriticalSyncDone(){(0,P.isMDBackend)()&&(__LOG__(2)`[ws2] moving to main screen from onCriticalSyncDone`,this.set({hasSynced:!0,stream:Se.SOCKET_STREAM.CONNECTED}))}openStream(){var e=this;return(0,i.default)((function*(){if((0,P.isMDBackend)()){return(0,H.getMeUser)()&&(te.Conn.blockStoreAdds=!1,te.Conn.id="1",te.Conn.trigger("me_ready")),void(yield(0,Q.addMeToContacts)())}let t;if(e.canSend=!0,e.hasSynced)e.resumePromise||(e.resumePromise=e.runResume(!1)),t=e.resumePromise.finally((()=>{e.unset("resumePromise")}));else{const r=(0,ue.requireContactCollection)().then((e=>e.sync()));if(t=(0,ue.requireChatCollection)().then((e=>e.sync())).cancellable().then((()=>(e.set({hasSynced:!0,stream:Se.SOCKET_STREAM.CONNECTED}),(0,ue.requireStickerPackCollection)().then((e=>{e.preFetch()})).catch((e=>{__LOG__(3)`Error: prefetch StickerPacks\n${e.stack}`})),R.LegacyPhoneFeatures.supportsFeature(R.LegacyPhoneFeatures.F.USER_NOTICE)&&pe.default.sync(),R.LegacyPhoneFeatures.supportsFeature(R.LegacyPhoneFeatures.F.SETTINGS_SYNC)&&me.default.sync(),r))).catch((t=>{throw e.set({hasSynced:!1,stream:Se.SOCKET_STREAM.DISCONNECTED}),t})).catch((0,_.catchAbort)((()=>{}))),(0,ue.requireStatusV3Collection)().then((e=>{e.sync()})),te.Conn.isSMB){if(R.LegacyPhoneFeatures.supportsFeature(R.LegacyPhoneFeatures.F.QUICK_REPLIES_QUERY)){n(999662).QuickReplyCollection.sync()}(0,G.canDisplayLabel)()&&(0,ue.requireLabelCollection)().then((e=>{e.sync()}))}}try{return yield(0,ue.requireMsgCollection)().cancellable().then((e=>{e.markAllAsStale()})),e.stream=e.hasSynced?Se.SOCKET_STREAM.RESUMING:Se.SOCKET_STREAM.SYNCING,e.socket.onmessage=e._handleMessage.bind(e),e.socket.releaseMessages(),t}catch(e){return(0,_.catchAbort)((function(){t.cancel()}))(e)}}))()}queryReceivedActions(){const e=this,t=(0,s.default)(this.sendQueue,"clientCacheable"),r=(0,p.default)(t,"tag").filter((function(e){return e}));return __LOG__(2)`ws2:queryReceivedActions`,0===r.length?Promise.resolve():n(656891).default.queryReceivedActions(r).then((function(n){Array.isArray(n)?n.forEach((function(t){const n=function(e,t){for(let n=t;n<e.length;n++){const t=e[n];if(t.tag)return t}}(e.sendQueue,parseInt(t.id,10)||0);if(n)if(__LOG__(2)`ws2:queryReceivedActions found dup: ${t.id},${t.code}`,delete e.sendHash[t.id],Pe.default.delete(t.id),e.sendQueue=(0,o.default)(e.sendQueue,n),n.onSend){const e=n.onSend({status:t.code,_duplicate:!0});Qe.test(e)&&n.onDrop(new b.Server5xxDrop)}else __LOG__(3)`ws2:queryReceivedActions onSendDup undefined; should be defined: ${t.id}`,n.onDrop(new b.ConventionViolationDrop);else __LOG__(3)`ws2:queryReceivedActions unknown tag in response: ${t.id}`})):"replaced"===n?(t.forEach((function(e){e.onDrop(new b.BrowserReplacedDrop)})),e.sendQueue=(0,c.default)(e.sendQueue,t)):__LOG__(3)`ws2:queryReceivedActions error`}))}runResume(e){return Promise.all([this.queryReceivedActions(),(0,ue.requireChatCollection)().then((e=>e.resyncMessages())),(0,ue.requireMsgCollection)().then((e=>e.resyncReceipts()))]).then((()=>{this.trigger("didResume"),this.flushQueue(),this.stream=Se.SOCKET_STREAM.CONNECTED})).catch((0,E.filteredCatch)(b.WebdDrop,(()=>{this.stream=Se.SOCKET_STREAM.DISCONNECTED}))).catch((0,_.catchAbort)((()=>{this.stream=Se.SOCKET_STREAM.DISCONNECTED}))).catch((t=>{if(!e)throw __LOG__(3,!0,void 0,!0)`ws2:error during resume, resyncing: ${String(t)}\n${t.stack}`,SEND_LOGS("error-on-resume"),this.stream=Se.SOCKET_STREAM.DISCONNECTED,new xe;if(this.canSend)return this.runResume(!1);this.unset("resumePromise")}))}setPokeable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.retryTimestamp;return this.set({pokeable:{poke(){e.cancel(new we)}},retryTimestamp:t}),e}clearCredentials(){var e=this;return(0,i.default)((function*(){z.userPreferencesStore.updatePreservedUserKeys();let t=!1;try{t=yield e.clearState()}catch(e){t=!0}try{(0,K.setBrowserId)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearState error ${e}`}try{(0,K.setUnknownId)()}catch(e){__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setUnknownId error ${e}`}try{(0,H.setMe)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:setMe error ${e}`}if((0,P.isMDBackend)()){try{yield(0,V.clearRegistrationInfo)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearRegistrationInfo error ${e}`}try{yield(0,ye.destroy)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:destroySignal error ${e}`}try{yield(0,w.deleteEncKeysAndCache)();(0,n(276559).cn)()}catch(e){t=!0}}else{try{(0,K.clearTokens)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearTokens error ${e}`}try{$.clear()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:SecretBundle clear error ${e}`}}try{yield(0,Y.clearAllLocalState)()}catch(e){t=!0,__LOG__(4,void 0,new Error,void 0,["logout"])`ws2:clearAllLocalState error ${e}`}return t}))()}clearState(){var e=this;return(0,i.default)((function*(){__LOG__(2)`ws2:clearState`;let t=!1;e.sendQueue=[],e.clearSendHash(!0),e.unset("hasSynced");try{(yield(0,ue.requireClearAppStates)())()}catch(e){t=!0,e instanceof U.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_session_app_state"))}try{yield(0,Z.default)()}catch(e){t=!0,e instanceof U.DbOnLogoutAbort?__LOG__(3)`ws2:clearState failed due to DB operations aborted: ${e.stack}`:(__LOG__(4,void 0,new Error,!0)`ws2:clearState error ${e.stack}`,SEND_LOGS("clear_persistent_app_state"))}return t}))()}maybeResendRequestEventually(e){const t=300*(0,h.expBackoff)(e.resends,100);__LOG__(2)`ws2:Resending ${e.toString()} in ${t}ms`,e.state=he.default.STATE.WILL_RETRY,e.resendTimer=setTimeout((()=>{e.resends++,e.resendTimer=void 0,this.sendHash[e.tag]===e&&(!e.resendGuard||e.resendGuard()?this._send(e):e.onSend({status:408}))}),t)}sendCurrentLogout(e,t){let r;if((0,P.isMDBackend)())r=(0,B.unpairDevice)(t).then((e=>{200!==e.status&&__LOG__(3)`ws2:multi-device logout failed with error code ${e.status}`,(0,y.stopComms)()})).catch((e=>{__LOG__(4,!0,new Error)`[CRITICAL] unpairDevice failed with error, preoceed with local logout \n${e.stack}`})),r||(r=Promise.reject(new Error("sendCurrentLogout: should not reach")));else{let t;t=$.load()?n(656891).default.logoutToken().then((e=>{const t={t:(0,K.getLogoutToken)(),m:e},n=(0,K.getOldLogoutCreds)();return n.push(t),(0,K.setOldLogoutCreds)(n),t})):Promise.resolve({}),r=t.then((t=>{if(e&&e.state===Se.WATCHED_SOCKET_STATE.OPEN){let n=this.logoutMutex;this.logoutMutex=n<=0?n=1:++n,__LOG__(2)`ws2:logout through socket`,e.partingSend(new Fe,'goodbye,,["admin","Conn","disconnect"]',(e=>0===e.indexOf("goodbye,"))).then((function(e){e?(__LOG__(2)`ws2:logout through socket success`,nt(t)):__LOG__(3)`ws2:logout through socket failure, will POST`})).finally((()=>{this.logoutMutex===n&&(this.logoutMutex=0)}))}else this.logoutMutex<0&&(this.logoutMutex=0),this.sendRemainingLogouts()}))}return r}sendRemainingLogouts(){let e=this.logoutMutex;if(0!==e)return;const t=n(511854).default,r=(0,K.getOldLogoutCreds)();0!==r.length?(this.logoutMutex=e=1,Promise.all((0,p.default)(r,function(){var e=(0,i.default)((function*(e){__LOG__(2)`ws2:POST logout`;try{yield t.post("https://web.whatsapp.com/logout",e),nt(e)}catch(e){__LOG__(3)`ws2:POST logout failure`}}));return function(){return e.apply(this,arguments)}}())).finally((()=>{e===this.logoutMutex&&(this.logoutMutex=0)}))):this.logoutMutex=-1}updateImmediately(e){I.upload({reason:e,immediate:!0}).finally((()=>{F.Updater.restart(!0)}))}deprecatedVersion(){__LOG__(2)`ws2:deprecated version`,I.upload({reason:"ws2:deprecated version",immediate:!0});const e=this.setPokeable((new ae.default).cancellable().catch((0,E.filteredCatch)(we,(()=>!1)))).cancellable();return this.clearState(),this.set({state:Se.SOCKET_STATE.DEPRECATED_VERSION,runPromise:e}),e}canRequestBeSent(e){return!!this.canSend||Boolean(this.socket)&&(0,K.knowsPhone)()&&e.serverCacheable}}function tt(e){return e instanceof m.Binary}function nt(e){const t=(0,K.getOldLogoutCreds)(),n=(0,a.default)(e);(0,K.setOldLogoutCreds)((0,s.default)(t,(e=>!n(e))))}const rt=new((0,X.defineModel)(et));t.Socket=rt},727086:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){f=null},t.destroy=function(){return(0,d.destroyStorage)().catch((()=>i.default.resolve(new p.default(d.DATABASE_NAME).delete()))).finally((()=>(f=null,i.default.resolve(new p.default("fts-storage-dogfooding").delete()))))},Object.defineProperty(t,"getIndexV1Table",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getIndexV2Table",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getIndexV3Table",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getManifestTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getPurgeRangeQueueTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getV2TokenToPrefixMappingTable",{enumerable:!0,get:function(){return c.getTable}}),t.initialize=function(){null==f&&((0,d.createStorage)(),(0,a.addTable)(),(0,s.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,o.addTable)(),(0,u.addTable)(),f=(0,d.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize fts storage"),e})));return f};var i=r(n(74121)),a=n(166991),o=n(969508),s=n(494831),l=n(857810),c=n(380277),u=n(222812),d=n(336376),p=r(n(986128));let f},166991:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=t.ManifestKeys=void 0,t.addTable=function(){(0,o.getStorage)().add(l).version((0,s.manifestCreateTable)(),[new a.default("key"),new i.default("tokenizerVersion"),new i.default("schemaVersion"),new i.default("isCurrent"),new i.default("lastMsgKeyViaFullIndexer"),new i.default("isFullIndexingComplete")]).view((e=>e||null))},t.getTable=function(){return(0,o.getStorage)().table(l)};var i=r(n(743960)),a=r(n(680982)),o=n(336376),s=n(443809);const l="manifest";t.TABLE_NAME=l;const c=Object.freeze({PREV_VERSION:"prev.version",CURR_VERSION:"curr.version",NEXT_VERSION:"next.version"});t.ManifestKeys=c},969508:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,o.getStorage)().add(l).version((0,s.purgeRangeQueueCreateTable)(),[new a.default(["chatId","tsOfLastMessage","startRowId","endRowId"]),new i.default("offset")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table(l)};var i=r(n(743960)),a=r(n(750472)),o=n(336376),s=n(443809);const l="fts-purge-range-queue";t.TABLE_NAME=l},494831:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,l.getStorage)().add(u).version((0,c.ftsV1IndexCreateTable)(),[new s.default("token"),new o.default("ids"),new a.default("ids"),new o.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildEntry)(e.prefixes,e.ids):null))},t.getTable=function(){return(0,l.getStorage)().table(u)};var i=n(196573),a=r(n(788389)),o=r(n(743960)),s=r(n(680982)),l=n(336376),c=n(443809);const u="fts-v1-index";t.TABLE_NAME=u},857810:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(d).version((0,u.ftsV2IndexCreateTable)(),[new l.default(["id","chatId","token"]),new s.default("id"),new s.default("chatId"),new s.default("token"),new o.default(["chatId","token"]),new a.default("timestamp"),new o.default(["id","token"])]).view((e=>e?(0,i.buildEntry)(e.id,e.chatId,e.token,e.timestamp):null))},t.getTable=function(){return(0,c.getStorage)().table(d)};var i=n(844152),a=r(n(743960)),o=r(n(361309)),s=r(n(998125)),l=r(n(750472)),c=n(336376),u=n(443809);const d="fts-v2-index";t.TABLE_NAME=d},380277:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,s.getStorage)().add(c).version((0,l.ftsV2TokenToPrefixesCreateTable)(),[new o.default("token"),new a.default("prefixes"),new i.default("prefixes")]).view((e=>e||null))},t.getTable=function(){return(0,s.getStorage)().table(c)};var i=r(n(788389)),a=r(n(743960)),o=r(n(680982)),s=n(336376),l=n(443809);const c="fts-v2-token-prefixes";t.TABLE_NAME=c},222812:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.TABLE_NAME=void 0,t.addTable=function(){(0,c.getStorage)().add(d).version((0,u.ftsV3IndexCreateTable)(),[new l.default("ftsRowId"),new o.default("id"),new s.default("id"),new o.default("chatId"),new s.default("chatId"),new o.default("timestamp"),new o.default("prefixes"),new a.default("prefixes")]).view((e=>e?(0,i.buildDBEntry)(e.ftsRowId,e.id,e.chatId,e.timestamp,e.prefixes):null))},t.getTable=function(){return(0,c.getStorage)().table(d)};var i=n(514056),a=r(n(788389)),o=r(n(743960)),s=r(n(998125)),l=r(n(581019)),c=n(336376),u=n(443809);const d="fts-v3-index";t.TABLE_NAME=d},336376:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new i.default(c);u=new a.Storage(e),u.addErrorHandler(s.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&o.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==u)return Promise.reject(new Error("[fts-storage] Storage should be created first before being destroyed"));return u.purge().then((()=>{u=null})).catch((e=>{throw u=null,e}))},t.getStorage=function(){return(0,l.default)(null!=u,"[fts-storage] Storage should be created first before being accessed"),u};var i=r(n(15378)),a=n(94899),o=n(123918),s=r(n(986128)),l=r(n(441143));const c="fts-storage";t.DATABASE_NAME=c;let u=null},443809:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ftsV1IndexCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.ftsV2IndexCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.ftsV2TokenToPrefixesCreateTable=function(){return(0,r.getStorage)().versions.version(4)},t.ftsV3IndexCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.manifestCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.purgeRangeQueueCreateTable=function(){return(0,r.getStorage)().versions.version(2)};var r=n(336376)},216703:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,o.destroyStorage)().catch((()=>i.default.resolve(new s.default(o.DATABASE_NAME).delete()))).finally((()=>{l=null}))},t.initialize=function(){null==l&&((0,o.createStorage)(),(0,a.addTable)(),l=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize jobs storage"),e})));return l};var i=r(n(74121)),a=n(657267),o=n(687758),s=r(n(986128));let l},657267:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("jobs-store").version((0,c.jobsCreateV1Table)(),[new o.default("jobId"),new i.default("type"),new i.default("uniqKey"),new a.default("uniqKey"),new i.default("original"),new i.default("current"),new i.default("step"),new i.default("startTime"),new i.default("endTime"),new i.default("stepHardStartCountAfterTimeout"),new i.default("stepFirstStartTime"),new i.default("waitUntil"),new i.default("backedOffCount"),new i.default("version")]).version((0,c.jobsCreateV2Table)(),[new i.default("stepUnexpectedErrorCount"),new s.default("endTime")]).view((e=>({jobId:e.jobId,type:e.type,uniqKey:e.uniqKey,original:e.original,current:e.current,step:e.step,startTime:e.startTime,stepHardStartCountAfterTimeout:e.stepHardStartCountAfterTimeout,stepFirstStartTime:e.stepFirstStartTime,waitUntil:e.waitUntil,backedOffCount:e.backedOffCount,version:e.version,stepUnexpectedErrorCount:e.stepUnexpectedErrorCount})))},t.getTable=function(){return(0,l.getStorage)().table("jobs-store")};var i=r(n(743960)),a=r(n(998125)),o=r(n(581019)),s=r(n(449358)),l=n(687758),c=n(993695)},687758:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new i.default(c);u=new a.Storage(e),u.addErrorHandler(s.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&o.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==u)return Promise.reject(new Error("[jobs-storage] Storage should be created first before being destroyed"));return u.purge().then((()=>{u=null})).catch((e=>{throw u=null,e}))},t.getStorage=function(){return(0,l.default)(null!=u,"[jobs-storage] Storage should be created first before being accessed"),u};var i=r(n(15378)),a=n(94899),o=n(123918),s=r(n(986128)),l=r(n(441143));const c="jobs-storage";t.DATABASE_NAME=c;let u=null},993695:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.jobsCreateV1Table=function(){return(0,r.getStorage)().versions.version(0)},t.jobsCreateV2Table=function(){return(0,r.getStorage)().versions.version(1)};var r=n(687758)},94899:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=t.NotInitializedError=t.NoSuchTableError=t.NoSuchDatabaseError=t.NoFallbackError=t.DuplicateTableError=t.DuplicateDatabaseError=t.AlreadyInitializedError=void 0;var i=r(n(348926)),a=r(n(427897)),o=r(n(862176)),s=n(392232);class l extends Error{constructor(){super(...arguments),this.name="AlreadyInitializedError"}}t.AlreadyInitializedError=l;class c extends Error{constructor(){super(...arguments),this.name="DuplicateDatabaseError"}}t.DuplicateDatabaseError=c;class u extends Error{constructor(){super(...arguments),this.name="DuplicateTableError"}}t.DuplicateTableError=u;class d extends Error{constructor(){super(...arguments),this.name="NoFallbackError"}}t.NoFallbackError=d;class p extends Error{constructor(){super(...arguments),this.name="NoSuchDatabaseError"}}t.NoSuchDatabaseError=p;class f extends Error{constructor(){super(...arguments),this.name="NoSuchTableError"}}t.NoSuchTableError=f;class _ extends Error{constructor(){super(...arguments),this.name="NotInitializedError"}}t.NotInitializedError=_;t.Storage=class{constructor(e){this.tables=new Map,this.views=new Map,this.state=1,this.versions=new s.StorageVersionManager,this.errorHandlers=new Map,this._database=e}addErrorHandler(e,t){const n=(new e).name;this.errorHandlers.set(n,t)}add(e){if(this.tables.has(e))throw new u(`Table "${e}" already added. Reuse the definition.`);const t=new o.default(e,this.versions);return this.tables.set(e,t),t}_getBackingDB(){return this._database}_unsafeGetOrCreateView(e){if(this.views.has(e))return this.views.get(e);const t=this._database.view(e.name,e.rowview,e.shouldEnablePropFilter,e.shouldUseDbMsgEncKeyForEncryptedCol);return this.views.set(e,t),t}_guardInitializedThunk(e){return()=>{if(3&this.state)throw new _("Storage must be initialized before accessing a table!");return e()}}table(e){const t=this.tables.get(e);if(!t)throw new f(`Unknown table ${e} requested, ensure table is defined!`);if(!this._getBackingDB())throw new p(`Unable to find associated database with table "${e}"`);return new a.default(this._guardInitializedThunk((()=>this._unsafeGetOrCreateView(t))),this.errorHandlers)}lock(e,t){if(3&this.state)return Promise.reject(new _("Initialize storage before attempting to lock tables!"));for(let t=0;t<e.length;++t)if(!this.tables.has(e[t]))return Promise.reject(new f(`Requested lock of unknown table "${e[t]}"`));const n=e.map((e=>{const t=this.tables.get(e);if(t)return t;throw new f(`Requested lock of unknown table "${e}"`)})).map((e=>this._unsafeGetOrCreateView(e)));return this._getBackingDB().transact(e,(0,i.default)((function*(){return t(n)}))).finally((()=>{}))}_getUpgraderForCurrentVersion(e,t){for(let n=0;n<e.length;n++)if(e[n].maxVersion===t){const r=e[n].upgraders.get(t);if(r)return{name:e[n].name,callback:r}}}_applyDatabaseVersion(e,t,n){const r=t,i=n.map((e=>e.schema(r))).filter(Boolean);return e.initialize(t,i,this._getUpgraderForCurrentVersion(n,r),this.errorHandlers)}initialize(){var e=this;return(0,i.default)((function*(){if(4&e.state)throw new l("Storage instance has already been initialized");if(e.versions.validate(),!e._database)throw new p(`"${e._database.constructor.name}" failed availability check!`);yield e._database.available();const t=Array.from(e.tables.values()),n=e._getBackingDB();if(t&&n){for(let r=0;r<=e.versions.getMax();r++)yield e._applyDatabaseVersion(n,r,t);yield n.open(),e.state=4}}))()}purge(){return this.state=2,this.views=new Map,this._getBackingDB().reset().then((()=>{}))}}},310927:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PRIMARY_KEY_TYPE=t.INDEX_TYPE=void 0,t.cloneSchema=function(e){return{name:e.name,columns:e.columns.map((e=>(0,i.default)({},e))),indexes:e.indexes.map(c),encryptedColumns:(0,i.default)({},e.encryptedColumns||{}),deleted:e.deleted}},t.emptySchema=function(e){return{name:e,columns:[],indexes:[],encryptedColumns:{}}},t.findIndex=function(e,t){return e.indexes.findIndex((e=>function(e,t){if(e.type!==t.type)return!1;switch(e.type){case s.SIMPLE:case s.ARRAY:case s.UNIQUE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.column===t.column;case s.COMPOSITE:return(0,a.default)(t.type===e.type,"Index types are not equal"),e.columns.length===t.columns.length&&!e.columns.some((e=>!t.columns.includes(e)))}throw new Error(`cannot compare unknown indexes of types: ${e.type}, ${t.type}`)}(t,e)))},t.freezeSchema=function(e){return Object.freeze({name:e.name,columns:Object.freeze(e.columns.map(Object.freeze)),indexes:Object.freeze(e.indexes.map(l)),encryptedColumns:Object.freeze((0,i.default)({},e.encryptedColumns||{})),deleted:e.deleted})},t.indexContainsColumn=function(e,t){switch(e.type){case s.SIMPLE:case s.ARRAY:case s.UNIQUE:return e.column===t;case s.COMPOSITE:return!!e.columns.find((e=>e===t))}throw new Error(`cannot check indexes of unknown index type: ${e.type}`)};var i=r(n(81109)),a=r(n(441143));const o=Object.freeze({AUTO_INCREMENT:"auto-increment",USER_DEFINED:"user-defined",COMPOSITE:"composite"});t.PRIMARY_KEY_TYPE=o;const s=Object.freeze({SIMPLE:"simple",COMPOSITE:"composite",ARRAY:"array",UNIQUE:"unique"});function l(e){switch(e.type){case s.SIMPLE:return Object.freeze({type:s.SIMPLE,column:e.column});case s.ARRAY:return Object.freeze({type:s.ARRAY,column:e.column});case s.COMPOSITE:return Object.freeze({type:s.COMPOSITE,columns:Object.freeze(e.columns.map(Object.freeze))});case s.UNIQUE:return Object.freeze({type:s.UNIQUE,column:e.column})}throw new Error(`cannot freeze index of unknown type: ${e.type}`)}function c(e){switch(e.type){case s.SIMPLE:return{type:s.SIMPLE,column:e.column};case s.UNIQUE:return{type:s.UNIQUE,column:e.column};case s.COMPOSITE:return{type:s.COMPOSITE,columns:e.columns.map((e=>e))};case s.ARRAY:return{type:s.ARRAY,column:e.column}}throw new Error(`cannot clone unknown index type: ${e.type}`)}t.INDEX_TYPE=s},862176:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(81109)),a=n(725528),o=n(310927),s=r(n(441143));function l(e){return e}t.default=class{constructor(e,t){this.maxVersion=-1,this.versions=new Map,this.upgraders=new Map,this.shouldEnablePropFilter=!0,this.shouldUseDbMsgEncKeyForEncryptedCol=!1,this.name=e,this.versionManager=t}version(e,t,n){this.versionManager.claim(e),(0,s.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,s.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const r=this.schema(e)||(0,o.emptySchema)(this.name),i=(0,a.sortMutations)(t).reduce(((e,t)=>(t.validate(e),t.apply(e))),(0,o.cloneSchema)(r));return this.versions.set(e,(0,o.freezeSchema)(i)),this.upgraders.set(e,n),this}delete(e){this.versionManager.claim(e),(0,s.default)(!this.versions.has(e),`Table "${this.name}" already has version #${+e} defined!`),(0,s.default)(e>this.maxVersion,`Versions for table ${this.name} must be defined in order`),this.maxVersion=e;const t=this.schema(e)||(0,o.emptySchema)(this.name),n=(0,i.default)((0,i.default)({},t),{},{deleted:!0});return this.versions.set(e,(0,o.freezeSchema)(n)),this}view(e){return this.rowview=e,this}enablePropFilter(e){return this.shouldEnablePropFilter=e,this}useDbMsgEncKeyForEncryptedCol(e){return this.shouldUseDbMsgEncKeyForEncryptedCol=e,this}schema(e){const t=this.versions.get(e);if(t)return t;const n=Array.from(this.versions.keys()).map(l).sort(((e,t)=>e-t)).filter((t=>t<e)).pop();return n||0===n?this.versions.get(n)||(0,o.emptySchema)(this.name):null}}},392232:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageVersionManager=t.MissingVersionError=t.InvalidVersionError=t.DuplicateVersionError=void 0;class n extends Error{constructor(){super(...arguments),this.name="DuplicateVersionError"}}t.DuplicateVersionError=n;class r extends Error{constructor(){super(...arguments),this.name="InvalidVersionError"}}t.InvalidVersionError=r;class i extends Error{constructor(){super(...arguments),this.name="MissingVersionError"}}t.MissingVersionError=i;t.StorageVersionManager=class{constructor(){this.versions=new Set,this._max=-1}claim(e){if(e<0)throw new r("Versions must by greater than or equal to zero!");if(this.versions.has(e))throw new n(`Version #${e} has already been claimed!`);this.versions.add(e),this._max=Math.max(this.getMax(),e)}version(e){if(e<0)throw new r("Versions must by greater than or equal to zero!");return e}validate(){for(let e=0;e<=this.getMax();++e)if(!this.versions.has(e))throw new i(`Schema version #${e} is missing!`)}getMax(){return this._max}}},15378:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(348926)),a=r(n(145095)),o=n(166751),s=r(n(74121)),l=n(624256),c=n(780723),u=n(310927),d=r(n(986128)),p=r(n(441143));function f(){return(f=(0,i.default)((function*(e,t,n,r){if(!l.DbEncKeyStore)throw new Error("feature is not yet implemented");const i=r?l.DbEncKeyStore.getDbMsgEncKeys():l.DbEncKeyStore.getEncKeys(),a=i[i.length-1],o=new Uint8Array(16);self.crypto.getRandomValues(o);const u=n===c.ENCRYPTED_VALUE_TYPE.STRING?(new TextEncoder).encode(e):e;try{const e=self.crypto.subtle.encrypt({iv:o,name:l.DB_ENCRYPTION_CIPHER},a.key,u),t=null==d.default.currentTransaction?e:d.default.waitFor(e);return{_data:yield s.default.resolve(t),iv:o,_keyId:a.id}}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e,t,n,r){if(!l.DbEncKeyStore)throw new Error("feature is not yet implemented");const{_data:i,iv:a,_keyId:o}=e,u=r?l.DbEncKeyStore.getDbMsgEncKeys().filter((e=>e.id===o))[0]:l.DbEncKeyStore.getEncKeys().filter((e=>e.id===o))[0];if((0,p.default)(null!=u,"Encryption key id not found"),null==i)return i;try{const e=self.crypto.subtle.decrypt({iv:a,name:l.DB_ENCRYPTION_CIPHER},u.key,i),t=null==d.default.currentTransaction?e:d.default.waitFor(e),r=yield s.default.resolve(t);return n===c.ENCRYPTED_VALUE_TYPE.STRING?new TextDecoder("utf-8").decode(r):r}catch(e){throw v(e,"encryptDbMaterial",null),e}}))).apply(this,arguments)}d.default.Promise.PSD.onunhandled=()=>{};class h{constructor(e,t,n,r,i,a){this.table=e,this.view=n,this.db=t,this.propFilter=r,this.tableEncryptedColumns=new Map(Object.keys(i).map((e=>[e,i[e]]))),this.shouldUseDbMsgEncKeyForEncryptedCol=a}asyncView(e){var t=this;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return(0,i.default)((function*(){if(!t._hasEncryptedColumn()||!n)return t.view(e);const r=yield t._decryptColumns(e);return t.view(r)}))()}_decryptColumns(e){var t=this;return(0,i.default)((function*(){(0,p.default)("object"==typeof e,"Called `_decryptColumns` with primitive value");const n=Array.from(t.tableEncryptedColumns.entries()).map((n=>{let[r,i]=n;const a=e[r];return(null==a?void 0:a._data)&&(null==a?void 0:a.iv)?function(){return _.apply(this,arguments)}(a,r,i,t.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[r]=t})):a}));return yield Promise.all(n),e}))()}_encryptColumns(e){const t=Array.from(this.tableEncryptedColumns.entries()).map((t=>{let[n,r]=t;const i=e[n];return null==i?i:function(){return f.apply(this,arguments)}(i,n,r,this.shouldUseDbMsgEncKeyForEncryptedCol).then((t=>{e[n]=t}))}));return Promise.all(t).then((()=>e))}_addAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.add(e);const n=yield t._encryptSingleUpdate(e);return t.table.add(n)}))()}_putAndEncrypt(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return t.table.put(e);const n=yield t._encryptColumns(e);return t.table.put(n)}))()}_bulkAddAndEncrypt(e){return this._hasEncryptedColumn()?this._encryptBulkUpdates(e).then((e=>this.table.bulkAdd(e))):this.table.bulkAdd(e)}_bulkPutAndEncrypt(e){return this._hasEncryptedColumn()?d.default.waitFor(this._encryptBulkUpdates(e)).then((e=>this.table.bulkPut(e))):this.table.bulkPut(e)}_encryptBulkUpdates(e){if(!this._hasEncryptedColumn())return s.default.resolve(e);const t=[],n=e.map(((e,n)=>this._encryptColumns(e).then((e=>{t[n]=e}))));return Promise.all(n).then((()=>t))}_encryptSingleUpdate(e){var t=this;return(0,i.default)((function*(){if(!t._hasEncryptedColumn())return e;return yield t._encryptColumns(e)}))()}asyncViewMap(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._hasEncryptedColumn()||!t)return Promise.resolve(e.map((e=>e?this.view(e):null)));const n=e.map((e=>null!=e?this.asyncView(e):s.default.resolve(null)));return s.default.resolve(null==d.default.currentTransaction?Promise.all(n):d.default.waitFor(Promise.all(n)))}preflightEncryptSingleRecord(e){return this.tableEncryptedColumns,Object.keys(e).forEach((t=>{this.tableEncryptedColumns.has(t)||delete e[t]})),this._encryptColumns(e)}postflightDecryptSingleRecord(e){var t=this;return(0,i.default)((function*(){const n=yield t._decryptColumns(e);return t.view(n)}))()}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return 0===e.length?s.default.resolve():(T(e,this.tableEncryptedColumns),s.default.resolve(this.table.bulkAdd(e)).catch((e=>{throw v(e,"bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY",this.table.name),e})))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return 0===e.length?s.default.resolve():(T(e,this.tableEncryptedColumns),s.default.resolve(this.table.bulkPut(e)).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e})))}create(e){const t=this.propFilter(e);return s.default.resolve(this._addAndEncrypt(t)).catch((e=>{throw v(e,"create",this.table.name),e}))}createOrReplace(e){const t=this.propFilter(e);return s.default.resolve(this._putAndEncrypt(t)).catch((e=>{throw v(e,"createOrReplace",this.table.name),e}))}createOrMerge(e,t){var n=this;return(0,i.default)((function*(){const r=n.propFilter(t),i=yield n._encryptColumns(r);return s.default.resolve(n.db.transaction("rw",n.table,(()=>n.table.where(":id").equals(e).modify((e=>{Object.assign(e,i)})).then((e=>{if(1!==e)return n.table.add(i)})))).then((()=>{}))).catch((e=>{throw v(e,"createOrMerge",n.table.name),e}))}))()}get(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return s.default.resolve(this.table.get(e)).then((e=>e?this.asyncView(e,t):null)).catch((e=>{throw v(e,"get",this.table.name),e}))}merge(e,t){var n=this;return(0,i.default)((function*(){const r=n.propFilter(t),i=yield n._encryptSingleUpdate(r);return s.default.resolve(n.table.update(e,i)).catch((e=>{throw v(e,"merge",n.table.name),e}))}))()}remove(e){return s.default.resolve(this.table.delete(e)).catch((e=>{throw v(e,"remove",this.table.name),e}))}bulkCreate(e){if(0===e.length)return s.default.resolve();const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?s.default.resolve(this.db.transaction("rw",this.table,(()=>this._bulkAddAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreate",this.table.name),e})):s.default.resolve(this.table.bulkAdd(t))}bulkCreateOrReplace(e){if(0===e.length)return s.default.resolve();const t=e.map((e=>this.propFilter(e)));return this._hasEncryptedColumn()?s.default.resolve(this.db.transaction("rw",this.table,(()=>this._bulkPutAndEncrypt(t)))).catch((e=>{throw v(e,"bulkCreateOrReplace",this.table.name),e})):s.default.resolve(this.table.bulkPut(t))}bulkCreateOrMerge(e){var t=this;return(0,i.default)((function*(){if(0===e.length)return s.default.resolve();const n=new Map,r=t._primaryKey();function a(){return(a=(0,i.default)((function*(e){const n=t.table.where(":id").anyOf(Array.from(e.keys()));yield n.modify((t=>{Object.assign(t,e.get(t[r])),e.delete(t[r])}));return Array.from(e.values())}))).apply(this,arguments)}return(yield t._encryptBulkUpdates(e)).forEach((e=>{const i=t.propFilter(e);(0,p.default)(r in i,"Called `bulkCreateOrMerge` with item(s) not including the primary key"),n.set(i[r],i)})),s.default.resolve(t.db.transaction("rw",t.table,(()=>function(){return a.apply(this,arguments)}(n).then((e=>0===e.length?s.default.resolve():t.table.bulkPut(e)))))).catch((e=>{throw v(e,"bulkCreateOrMerge",t.table.name),e}))}))()}bulkGet(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return 0===e.length?s.default.resolve([]):s.default.resolve(this.db.transaction("r",this.table,(()=>{const t=e.map((e=>this.table.get(e)));return d.default.Promise.all(t)}))).then((e=>this.asyncViewMap(e,t))).catch((e=>{throw v(e,"bulkGet",this.table.name),e}))}bulkRemove(e){return 0===e.length?s.default.resolve():s.default.resolve(this.db.transaction("rw",this.table,(()=>this.table.bulkDelete(e)))).catch((e=>{throw v(e,"bulkRemove",this.table.name),e}))}bulkRemoveByIndex(e,t){return 0===t.length?s.default.resolve():s.default.resolve(S(this.table.where(y(e)).anyOf(t)).delete()).catch((e=>{throw v(e,"bulkRemoveByIndex",this.table.name),e}))}all(e,t){let n=S(this.table.orderBy((null==e?void 0:e.index)?y(e.index):":id"),e);t&&(n=n.until(t));let r=null;switch(null==e?void 0:e.returnKeyType){case"keys":r=s.default.resolve(n.keys());break;case"primary_key":r=s.default.resolve(n.primaryKeys());break;default:r=s.default.resolve(n.toArray()).then((t=>this.asyncViewMap(t,null==e?void 0:e.shouldDecrypt)))}return r.catch((e=>{throw v(e,"all",this.table.name),e}))}count(){return s.default.resolve(this.table.count()).catch((e=>{throw v(e,"count",this.table.name),e}))}bulkDeleteRange(e,t,n,r){return S(this.table.where(y(e)).between(t,n,!!(null==r?void 0:r.lowerInclusive),!!(null==r?void 0:r.upperInclusive)),r).delete().catch((e=>{throw v(e,"bulkDeleteRange",this.table.name),e}))}equals(e,t,n){return s.default.resolve(S(this.table.where(y(e)).equals(t),n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"equals",this.table.name),e}))}anyOf(e,t,n){return 0===t.length?s.default.resolve([]):s.default.resolve(S(this.table.where(y(e)).anyOf(t),n).distinct().toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"anyOf",this.table.name),e}))}startsWithAnyOf(e,t,n){return 0===t.length?s.default.resolve([]):s.default.resolve(S(this.table.where(y(e)).startsWithAnyOf(t),n).distinct().toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"startsWithAnyOf",this.table.name),e}))}greaterThan(e,t,n){const r=(null==n?void 0:n.inclusive)?this.table.where(y(e)).aboveOrEqual(t):this.table.where(y(e)).above(t);return s.default.resolve(S(r,n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"greaterThan",this.table.name),e}))}lessThan(e,t,n){const r=(null==n?void 0:n.inclusive)?this.table.where(y(e)).belowOrEqual(t):this.table.where(y(e)).below(t);return s.default.resolve(S(r,n).toArray()).then((e=>this.asyncViewMap(e,null==n?void 0:n.shouldDecrypt))).catch((e=>{throw v(e,"lessThan",this.table.name),e}))}between(e,t,n,r,i){const a=S(this.table.where(y(e)).between(t,n,!!(null==r?void 0:r.lowerInclusive),!!(null==r?void 0:r.upperInclusive)),r);let o=null;switch(null==r?void 0:r.returnKeyType){case"keys":o=s.default.resolve(a.keys());break;case"primary_key":o=s.default.resolve(a.primaryKeys());break;default:o=i?s.default.resolve(a.until(i).toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt))):s.default.resolve(a.toArray()).then((e=>this.asyncViewMap(e,null==r?void 0:r.shouldDecrypt)))}return o.catch((e=>{throw v(e,"between",this.table.name),e}))}forEachSortedBy(e,t){var n=this;return this.table.orderBy(e).each(function(){var e=(0,i.default)((function*(e){const r=yield n._decryptColumns(e);return t(r)}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEachSortedBy",this.table.name),e}))}forEach(e){var t=this;return this.table.each(function(){var n=(0,i.default)((function*(n){const r=yield t._decryptColumns(n);return e(r)}));return function(){return n.apply(this,arguments)}}()).catch((e=>{throw v(e,"forEach",this.table.name),e}))}clear(){return s.default.resolve(this.table.clear()).catch((e=>{throw v(e,"clear",this.table.name),e}))}_primaryKey(){return this.table.schema.primKey.name}_hasEncryptedColumn(){return this.tableEncryptedColumns.size>0}}function g(e){if(e.length>1)return e.forEach((e=>{(0,p.default)(e.primaryKey&&e.primaryKey===u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`")})),`[${e.map((e=>e.name)).join("+")}]`;const t=e[0];return(0,p.default)(t.primaryKey&&t.primaryKey!==u.PRIMARY_KEY_TYPE.COMPOSITE,"Invalid column passed to `formatPrimaryKey`"),t.primaryKey===u.PRIMARY_KEY_TYPE.AUTO_INCREMENT?`${t.name}++`:t.name}function m(e){switch(e.type){case u.INDEX_TYPE.SIMPLE:return e.column;case u.INDEX_TYPE.COMPOSITE:return`[${e.columns.join("+")}]`;case u.INDEX_TYPE.ARRAY:return`*${e.column}`;case u.INDEX_TYPE.UNIQUE:return`&${e.column}`}throw new Error(`Cannot format index of type "${e.type}"`)}function y(e){return 1===e.length?e[0]:`[${e.join("+")}]`}function S(e,t){let n=e;return(null==t?void 0:t.reverse)&&(n=n.reverse()),t&&null!=t.offset&&(n=n.offset(t.offset)),t&&null!=t.limit&&0!==t.limit&&(n=n.limit(t.limit)),n}function E(e){return s.default.resolve(e)}function v(e,t,n){__LOG__(3,!0)`idb faild to do Operation: ${t} on Table: ${n}. Failed with error ${e}`}function T(e,t){const n=Array.from(t.entries());e.forEach((()=>{n.forEach((t=>{let[n,r]=t;if(e[n]&&!(e[n]._keyId&&e[n]._data&&e[n].iv))throw new Error("[CRITICAL] Records contain unencrypted field")}))}))}t.default=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E;this.tableNames=new Map,this.tableColumns=new Map,this.tableEncryptedColumns=new Map,this.errorHandlers=new Map,this.name=e,this.db=new d.default(this.name),this.transformSchema=t}initialize(e,t,n,r){return r&&(this.errorHandlers=r),function(e,t,n,r,i){return(0,o.promiseReduce)(e,((e,a)=>i((0,u.cloneSchema)(a)).then((i=>{if((0,p.default)(!(i.name in e),"Multiple tables resulted in the same transformed name"),i.deleted)return e[i.name]=null,e;t.set(a.name,i.name),n.set(a.name,i.columns.map((e=>e.name))),r.set(a.name,i.encryptedColumns||{});const o=i.columns.filter((e=>e.primaryKey));(0,p.default)(o.length>=1,`No primary key was defined for "${a.name}"`);const s=[g(o)].concat(i.indexes.map(m)).join(", ");return e[i.name]=s,e}))),{})}(t,this.tableNames,this.tableColumns,this.tableEncryptedColumns,this.transformSchema).then((t=>{this.db.version(e+1).stores(t).upgrade((e=>{var t;if(n)return null===(t=e[n.name])||void 0===t?void 0:t.toCollection().modify(n.callback)}))}))}open(){return s.default.resolve(this.db.open())}transact(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rw";return s.default.resolve(this.db.transaction(n,e,(()=>t()))).catch((e=>{const t=this.errorHandlers.get(e.name);if(!t)throw e;t(e)}))}close(){return this.db.close(),s.default.resolve()}view(e,t,n,r){(0,p.default)(this.tableNames.has(e),`Attemped to get view for uninitialized table "${e}"`),(0,p.default)(this.tableColumns.has(e),`Attemped to get columns for uninitialized table "${e}"`);const i=n?function(e){if(!e)return e=>e;return t=>{const n={};return e.forEach((e=>{t.hasOwnProperty(e)&&(n[e]=t[e])})),n}}(this.tableColumns.get(e)):e=>e;return new h(this.db.table(this.tableNames.get(e)),this.db,t,i,(0,a.default)(this.tableEncryptedColumns.get(e),"this.tableEncryptedColumns.get(table)"),r)}available(){return s.default.resolve(!0)}reset(){return this.tableNames=new Map,s.default.resolve(this.db.delete())}}},427897:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(435232),a=r(n(652991));t.default=class{constructor(e,t){this.errorHandlers=new Map,this._view=e,t&&(this.errorHandlers=t)}_maybeHandleError(e){const t=this.errorHandlers.get(e.name);t&&t(e)}_read(e){if(a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db read operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}_write(e){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&a.default.isLogoutInProgress)return Promise.reject(new i.DbOnLogoutAbort("dropping db write operation due to logout"));return e(this._view()).catch((e=>{throw this._maybeHandleError(e),e}))}create(e){return this._write((t=>t.create(e)))}preflightEncryptSingleRecord(e){return this._write((t=>t.preflightEncryptSingleRecord(e)),!1,!0)}postflightDecryptSingleRecord(e){return this._write((t=>t.postflightDecryptSingleRecord(e)),!1,!0)}bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateWith_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e){return this._write((t=>t.bulkCreateOrReplace_ALREADY_ENCRYPTED_RECORDS_ONLY(e)))}createOrReplace(e){return this._write((t=>t.createOrReplace(e)))}createOrMerge(e,t){return this._write((n=>n.createOrMerge(e,t)))}get(e){return this._read((t=>t.get(e)))}merge(e,t){return this._write((n=>n.merge(e,t)))}remove(e){return this._write((t=>t.remove(e)))}bulkCreate(e){return this._write((t=>t.bulkCreate(e)))}bulkCreateOrReplace(e){return this._write((t=>t.bulkCreateOrReplace(e)))}bulkCreateOrMerge(e){return this._write((t=>t.bulkCreateOrMerge(e)))}bulkGet(e,t){return this._read((n=>n.bulkGet(e,t)))}bulkRemoveByIndex(e,t){return this._write((n=>n.bulkRemoveByIndex(e,t)))}bulkRemove(e){return this._write((t=>t.bulkRemove(e)))}bulkDeleteRange(e,t,n){return this._write((r=>r.bulkDeleteRange(e,t,n)))}all(e,t){return this._read((n=>n.all(e,t)))}count(){return this._read((e=>e.count()))}equals(e,t,n){return this._read((r=>r.equals(e,t,n)))}anyOf(e,t,n){return this._read((r=>r.anyOf(e,t,n)))}startsWithAnyOf(e,t,n){return this._read((r=>r.startsWithAnyOf(e,t,n)))}greaterThan(e,t,n){return this._read((r=>r.greaterThan(e,t,n)))}lessThan(e,t,n){return this._read((r=>r.lessThan(e,t,n)))}between(e,t,n,r,i){return this._read((a=>a.between(e,t,n,r,i)))}forEachSortedBy(e,t){return this._read((n=>n.forEachSortedBy(e,t)))}forEach(e){return this._read((t=>t.forEach(e)))}clear(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._write((e=>e.clear()),e)}}},337408:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=r(n(441143));class o extends i.default{constructor(e){super(),(0,a.default)("AbstractPrimaryKey"!==this.constructor.name,"Cannot instantiate abstract class AbstractPrimaryKey"),Array.isArray(e)?this.columns=[...e]:this.columns=[e]}validate(e){(0,a.default)(0===e.columns.length,"Attempted to add primary key after other columns")}apply(){throw new Error("Subclass of `AbstractPrimaryKey` must implement `apply` method")}}t.default=o},788389:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,o.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,o.default)(t&&(!t.primaryKey||t.primaryKey===a.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,o.default)(!e.indexes.some((e=>(e.type===a.INDEX_TYPE.ARRAY||e.type===a.INDEX_TYPE.SIMPLE||e.type===a.INDEX_TYPE.UNIQUE)&&(0,a.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:a.INDEX_TYPE.ARRAY,column:this.column}}}t.default=s},743960:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.name=e}validate(e){(0,o.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,a.cloneSchema)(e);return t.columns.push({name:this.name}),t}}t.default=s},361309:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.columns=[...e]}validate(e){this.columns.forEach((t=>{(0,o.default)(e.columns.find((e=>e.name===t)),`Attempted to add index on non-existent column "${t}" in "${e.name}"`)})),(0,o.default)(this.columns.length>1,"Attempted to add composite index for only 1 column"),(0,o.default)(-1===(0,a.findIndex)(e,this._getIndex()),`Attempted to add index [${String(this.columns)}], which already exists in "${e.name}"`);const t=e.columns.filter((e=>e.primaryKey&&e.primaryKey===a.PRIMARY_KEY_TYPE.COMPOSITE)).map((e=>e.name));(0,o.default)(t.length!==this.columns.length||t.some((e=>!this.columns.includes(e))),`Attempted to add index [${String(this.columns)}], which already is the primary key in "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:a.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=s},780723:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_VALUE_TYPE=t.AddEncryptedColumn=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));const s=Object.freeze({STRING:"String",ARRAY_BUFFER:"ArrayBuffer"});t.ENCRYPTED_VALUE_TYPE=s;class l extends i.default{constructor(e,t){super(),this.name=e,this.dataType=t}validate(e){(0,o.default)(!e.columns.find((e=>e.name===this.name)),`Attempted to add encrypted column "${this.name}" to "${e.name}" but it already exists`)}apply(e){const t=(0,a.cloneSchema)(e);return t.columns.push({name:this.name}),t.encryptedColumns[this.name]=this.dataType,t}}t.AddEncryptedColumn=l},998125:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.keyPath=e,this.column=e.split(".")[0]}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,o.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,o.default)(t&&(!t.primaryKey||t.primaryKey===a.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,o.default)(!e.indexes.some((e=>(e.type===a.INDEX_TYPE.ARRAY||e.type===a.INDEX_TYPE.SIMPLE||e.type===a.INDEX_TYPE.UNIQUE)&&(0,a.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:a.INDEX_TYPE.SIMPLE,column:this.keyPath}}}t.default=s},512040:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.column=e}validate(e){const t=e.columns.find((e=>e.name===this.column));(0,o.default)(t,`Attempted to add index on non-existent column "${this.column}" in "${e.name}"`),(0,o.default)(t&&(!t.primaryKey||t.primaryKey===a.PRIMARY_KEY_TYPE.COMPOSITE),`Cannot add index on primary key on table "${e.name}"`),(0,o.default)(!e.indexes.some((e=>(e.type===a.INDEX_TYPE.ARRAY||e.type===a.INDEX_TYPE.SIMPLE||e.type===a.INDEX_TYPE.UNIQUE)&&(0,a.indexContainsColumn)(e,this.column))),`Attempted to add index "${this.column}" which already exists in "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e);return t.indexes.push(this._getIndex()),t}_getIndex(){return{type:a.INDEX_TYPE.UNIQUE,column:this.column}}}t.default=s},581019:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(337408)),a=n(310927),o=r(n(441143));class s extends i.default{validate(e){super.validate(e),(0,o.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,a.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:a.PRIMARY_KEY_TYPE.AUTO_INCREMENT}),t}}t.default=s},750472:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(337408)),a=n(310927),o=r(n(441143));class s extends i.default{validate(e){super.validate(e),(0,o.default)(this.columns&&this.columns.length>1,"Attempted to add composite primary key for only 1 column")}apply(e){const t=(0,a.cloneSchema)(e);return this.columns.forEach((e=>{t.columns.push({name:e,primaryKey:a.PRIMARY_KEY_TYPE.COMPOSITE})})),t}}t.default=s},617854:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(441143));t.default=class{constructor(){(0,i.default)("Mutation"!==this.constructor.name,"Cannot instantiate abstract class Mutation")}validate(){throw new Error("Subclasses of Mutaton must implement `validate`")}apply(){throw new Error("Subclasses of Mutaton must implement `apply`")}}},725528:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.sortMutations=function(e){return[...e].sort(S)};var i=r(n(788389)),a=r(n(743960)),o=r(n(361309)),s=n(780723),l=r(n(998125)),c=r(n(512040)),u=r(n(581019)),d=r(n(750472)),p=r(n(105559)),f=r(n(449358)),_=r(n(27801)),h=r(n(16250)),g=r(n(680982)),m=r(n(441143));const y=[_.default,p.default,h.default,f.default,u.default,g.default,d.default,a.default,l.default,i.default,o.default,c.default,s.AddEncryptedColumn];function S(e,t){const n=y.indexOf(e.constructor),r=y.indexOf(t.constructor);return(0,m.default)(-1!==n,`Mutation ${e.constructor.name} is not a known mutation type`),(0,m.default)(-1!==r,`Mutation ${e.constructor.name} is not a known mutation type`),n-r}},105559:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.column=e}validate(e){(0,o.default)(-1!==(0,a.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e),n=(0,a.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:a.INDEX_TYPE.ARRAY,column:this.column}}}t.default=s},449358:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.name=e}validate(e){const t=e.columns.find((e=>e.name===this.name));(0,o.default)(t,`Attempted to remove column "${this.name}" from "${e.name}" but it doesn't exist`),(0,o.default)(!t.primaryKey,`Attempted to remove primary key column "${this.name}". Removing primary keys is not supported.`),(0,o.default)(!e.indexes.some((e=>(0,a.indexContainsColumn)(e,this.name))),`Attempted to remove column "${this.name}" from "${e.name}" but an index exists with the column`)}apply(e){const t=(0,a.cloneSchema)(e);return t.columns.splice(t.columns.findIndex((e=>e.name===this.name)),1),t}}t.default=s},27801:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.columns=[...e].sort()}validate(e){(0,o.default)(-1!==(0,a.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index [${String(this.columns)}] on "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e),n=(0,a.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:a.INDEX_TYPE.COMPOSITE,columns:this.columns}}}t.default=s},16250:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(617854)),a=n(310927),o=r(n(441143));class s extends i.default{constructor(e){super(),this.column=e}validate(e){(0,o.default)(-1!==(0,a.findIndex)(e,this._getIndex()),`Attempted to remove non-existent index "${this.column}" on "${e.name}"`)}apply(e){const t=(0,a.cloneSchema)(e),n=(0,a.findIndex)(e,this._getIndex());return t.indexes.splice(n,1),t}_getIndex(){return{type:a.INDEX_TYPE.SIMPLE,column:this.column}}}t.default=s},680982:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n(337408)),a=n(310927),o=r(n(441143));class s extends i.default{validate(e){super.validate(e),(0,o.default)(this.columns&&1===this.columns.length,"Attempted to add UserDefinedPrimaryKey over wrong number of columns")}apply(e){const t=(0,a.cloneSchema)(e);return t.columns.unshift({name:this.columns[0],primaryKey:a.PRIMARY_KEY_TYPE.USER_DEFINED}),t}}t.default=s},429830:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.initialize=void 0;var i=r(n(751463)),a=n(424439);const o=(0,i.default)((()=>(0,a.getStorage)().initialize()));t.initialize=o},703971:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePrimaryIndex=t.storeDataIndex=t.IdbArrayBufferTable=void 0;var i=r(n(743960)),a=r(n(680982)),o=n(424439);const s="id";t.storePrimaryIndex=s;const l="data";t.storeDataIndex=l;const c="lru-media-array-buffer";(0,o.getStorage)().add(c).version((0,o.getStorage)().versions.version(0),[new a.default(s),new i.default(l)]).view((e=>({id:e.id,data:e.data})));const u=(0,o.getStorage)().table(c);t.IdbArrayBufferTable=u},209362:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.metaInfoSizeIndex=t.metaInfoPrimaryIndex=t.metaInfoDateIndex=t.IdbMetaInfoTable=void 0;var i=r(n(743960)),a=r(n(998125)),o=r(n(680982)),s=n(424439);t.metaInfoPrimaryIndex="id";const l="timestamp";t.metaInfoDateIndex=l;const c="size";t.metaInfoSizeIndex=c;const u="lru-media-meta-info";(0,s.getStorage)().add(u).version((0,s.getStorage)().versions.version(1),[new o.default("id"),new i.default(l),new a.default(l)]).version((0,s.getStorage)().versions.version(2),[new i.default(c)]).view((e=>({id:e.id,timestamp:e.timestamp,size:e.size||0})));const d=(0,s.getStorage)().table(u);t.IdbMetaInfoTable=d},424439:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=p,t.destroyStorage=function(){return f.apply(this,arguments)},t.getStorage=function(){return(0,c.default)(null!=d,"[lru-media-storage-idb] Storage should be created first before being accessed"),d};var i=r(n(348926)),a=r(n(15378)),o=n(94899),s=n(123918),l=r(n(986128)),c=r(n(441143));const u="lru-media-storage-idb";t.DATABASE_NAME=u;let d=null;function p(){const e=new a.default(u);d=new o.Storage(e),d.addErrorHandler(l.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&s.StorageCmd.trigger("storage_not_enough_space")}))}function f(){return(f=(0,i.default)((function*(){if(null==d)throw new Error("[lru-media-storage-idb] Storage should be created first before being destroyed");try{yield d.purge()}finally{d=null}}))).apply(this,arguments)}p()},834541:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getABPropConfigs=function(){return(0,s.initializeWithoutGKs)().then((()=>(0,l.getTable)().all().then((e=>e))))},t.getConfigValue=function(e){const t=a.ABPropConfigs[e];if(null==t)return __LOG__(4,!0,new Error,!0)`invalid ABProps config name`,SEND_LOGS("invalid ABProps config name: "+e),Promise.reject(new Error("invalid ABProps config name"));const[n,r,i,o]=t,c=i;return(0,s.initializeWithoutGKs)().then((()=>(0,l.getTable)().get(String(n)).then((e=>e?u(e.configValue,r,c):c))))},t.parseConfigValue=u,t.setConfigAccessed=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.get(String(e));null!=r&&!0!==(null==r?void 0:r.hasAccessed)&&(yield n.merge(String(e),{hasAccessed:!0}))}));return function(){return t.apply(this,arguments)}}())},t.updateABPropConfigs=function(e){return(0,c.getStorage)().lock(["abpropConfigs"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.all(),i=new Map;r.forEach((e=>{null!=e.configExpoKey&&i.set(e.configCode,{configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})}));let a=!1;const s=[];e.forEach(((e,t)=>{let n=!1;const r=i.get(String(t));if(r){const i=r.configExpoKey;null!=i&&e.configExpoKey!==i?(o.exposureKeys.delete(i),a=!0,o.accessedConfigs.delete(t)):null!=i&&(n=r.hasAccessed)}s.push({configCode:String(t),configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:n})})),a&&(0,o.updateGlobalExpoKey)(),yield n.clear(),yield n.bulkCreate(s)}));return function(){return t.apply(this,arguments)}}())};var i=r(n(348926)),a=n(73074),o=n(246440),s=n(923356),l=n(532446),c=n(799069);function u(e,t,n){return null==e||null==t?n:"bool"===t?"1"===e||"True"===e||"true"===e:"int"===t?parseInt(e,10):"float"===t?parseFloat(e):e}},438342:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._cache=void 0,t.addActiveMessageRange=function(){return h.apply(this,arguments)},t.bulkUpdateActiveMessageRanges=function(e){return f.bulkCreateOrReplaceRanges(e)},t.getActiveMessageRanges=function(e){return f.getRangesForChat(e)},t.getActiveRangeAction=function(e,t){switch(e){case"archive":return u.ActiveRangeAction.Archive;case"markChatAsRead":return u.ActiveRangeAction.MarkChatAsRead;case"clearChat":return(null==t?void 0:t.deleteStarred)&&t.deleteMedia?u.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:(null==t?void 0:t.deleteStarred)&&!t.deleteMedia?u.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:(null==t?void 0:t.deleteMedia)&&!t.deleteStarred?u.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:u.ActiveRangeAction.ClearChatKeepStarredKeepMedia;case"deleteChat":return(null==t?void 0:t.deleteMedia)?u.ActiveRangeAction.DeleteChatDeleteMedia:u.ActiveRangeAction.DeleteChatKeepMedia;default:throw new Error("unsupported active message range action")}},t.removeActiveMessageRange=function(e,t){return f.removeRange(e,t)},t.updateActiveMessageRange=function(e){return f.createOrReplaceRange(e)};var i=r(n(81109)),a=r(n(348926)),o=r(n(145095)),s=n(381),l=n(330986),c=n(923356),u=n(569702),d=n(484902);let p=new Map;const f={reset:()=>{p=new Map},removeRange(e,t){var n;return null===(n=p.get(e))||void 0===n||n.delete(t),(0,c.getActiveMessageRangesTable)().remove([e,t])},createOrReplaceRange(e){let t=p.get(e.chatId);return null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e),(0,c.getActiveMessageRangesTable)().createOrReplace(e)},bulkCreateOrReplaceRanges:e=>(e.forEach((e=>{let t=p.get(e.chatId);null==t&&(t=new Map,p.set(e.chatId,t)),t.set(e.action,e)})),(0,c.getActiveMessageRangesTable)().bulkCreateOrReplace(e)),getRangesForChat:e=>(0,a.default)((function*(){let t=p.get(e);if(null==t){const n=yield(0,c.getActiveMessageRangesTable)().anyOf(["chatId"],[e]);t=new Map(n.map((e=>[e.action,e]))),p.set(e,t)}return Array.from(t.values())}))()};function _(e,t){switch(e){case u.ActiveRangeAction.Archive:return{action:u.ActiveRangeAction.Archive,actionValue:(0,o.default)(t.archiveChatAction,"syncActionValue.archiveChatAction")};case u.ActiveRangeAction.MarkChatAsRead:return{action:u.ActiveRangeAction.MarkChatAsRead,actionValue:(0,o.default)(t.markChatAsReadAction,"syncActionValue.markChatAsReadAction")};case u.ActiveRangeAction.ClearChatKeepStarredKeepMedia:return{action:u.ActiveRangeAction.ClearChatKeepStarredKeepMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case u.ActiveRangeAction.ClearChatKeepStarredDeleteMedia:return{action:u.ActiveRangeAction.ClearChatKeepStarredDeleteMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case u.ActiveRangeAction.ClearChatDeleteStarredKeepMedia:return{action:u.ActiveRangeAction.ClearChatDeleteStarredKeepMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case u.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia:return{action:u.ActiveRangeAction.ClearChatDeleteStarredDeleteMedia,actionValue:(0,o.default)(t.clearChatAction,"syncActionValue.clearChatAction")};case u.ActiveRangeAction.DeleteChatDeleteMedia:return{action:u.ActiveRangeAction.DeleteChatDeleteMedia,actionValue:(0,o.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};case u.ActiveRangeAction.DeleteChatKeepMedia:return{action:u.ActiveRangeAction.DeleteChatKeepMedia,actionValue:(0,o.default)(t.deleteChatAction,"syncActionValue.deleteChatAction")};default:throw new Error(`unsupported action for message ranges: ${String(e)}`)}}function h(){return(h=(0,a.default)((function*(e,t,n){var r;const a=(0,d.decodeProtobuf)(s.SyncActionValueSpec,n),{actionValue:o}=_(t,a),c=(null===(r=o.messageRange)||void 0===r?void 0:r.messages)||[],u=yield(0,l.filterReceivedMessagesInRange)(e,c),p=Math.max(0,c.length-u.length);return f.createOrReplaceRange((0,i.default)((0,i.default)({chatId:e},_(t,a)),{},{remainingMessages:p}))}))).apply(this,arguments)}t._cache=f},528842:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addOnProviders=void 0,t.getProviderForAddOnType=function(e){switch(e){case a.MessageAddOnsType.PollVote:return i.pollVotesAddOnProvider;case a.MessageAddOnsType.KeepInChat:return r.keepInChatAddOnProvider;case a.MessageAddOnsType.Reaction:case a.MessageAddOnsType.Unknown:return null}};var r=n(932466),i=n(196340),a=n(800789);const o=[i.pollVotesAddOnProvider,r.keepInChatAddOnProvider];t.addOnProviders=o},932466:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.keepInChatAddOnProvider=void 0;var i=r(n(348926)),a=n(96759),o=n(115461),s=n(529805);const l={type:n(800789).MessageAddOnsType.KeepInChat,matches:e=>e.type===o.MSG_TYPE.KEEP_IN_CHAT,processOrphansForNewMsg:(e,t)=>(0,i.default)((function*(){const e=t.map((e=>e.parsedMsgPayload)),n=(0,s.runKeepInChatTieBreaker)(e);__LOG__(2)`keepInChatAddOnProvider: found orphan`,null!=n&&(yield(0,a.processKeepInChatMsg)(n))}))()};t.keepInChatAddOnProvider=l},196340:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pollVotesAddOnProvider=void 0;var r=n(115461),i=n(62290);const a={type:n(800789).MessageAddOnsType.PollVote,matches:e=>e.type===r.MSG_TYPE.POLL_UPDATE&&null!=e.encPollVote,processOrphansForNewMsg:(e,t)=>(0,i.processPollUpdateMsgsOnline)(t.map((e=>e.parsedMsgPayload)))};t.pollVotesAddOnProvider=a},542618:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.processOrphansForNewMsg=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=r(n(385564)),o=n(528842),s=n(160960),l=n(800789);function c(){return(c=(0,i.default)((function*(e){const t=yield(0,s.getMessageOrphansByParentMsgKey)(e.id);t.length&&__LOG__(2)`processOrphansForNewMsg: found orphans`;const n=new Map;for(const e of t){var r;const t=(0,o.getProviderForAddOnType)(e.type);if(!t)continue;const i=null!==(r=n.get(t))&&void 0!==r?r:[];i.push(e),n.set(t,i)}const i=[];for(const[t,r]of n.entries())i.push(t.processOrphansForNewMsg(e,r));yield Promise.all(i);const c=(0,a.default)(Array.from(n.values())).map((e=>e.msgKey));yield(0,l.getTable)().bulkRemove(c)}))).apply(this,arguments)}},373382:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBlocklist=function(){if((0,r.isLegacyWebdBackend)())return Promise.resolve([]);return(0,a.getTable)().all().then((e=>e.map((e=>(0,i.createUserWid)(e.id)))))},t.updateBlocklist=function(e){if((0,r.isLegacyWebdBackend)()||!e)return Promise.resolve(!1);const t=e.map((e=>({id:e.toString()})));return(0,o.getStorage)().lock(["blocklist"],(e=>{let[n]=e;return n.clear().then((()=>n.bulkCreate(t).then((()=>!0))))}))};var r=n(88555),i=n(745454),a=n(489426),o=n(799069)},460112:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateChatEvents=function(e){return d.enqueue((0,i.default)((function*(){const t=(yield(0,c.getTable)().bulkGet(e.map((e=>{let{chatId:t,startTs:n}=e;return[t,n]})))).map(((t,n)=>{const r=e[n],i=function(e,t,n){if(null==n)return(0,a.default)({chatId:e,startTs:t},u);return Object.keys(u).reduce(((e,t)=>(null==e[t]&&(e[t]=u[t]),e)),n)}(r.chatId,r.startTs,t);return l.COUNT_FIELD_NAMES.forEach((e=>{i[e]+=r[e]})),s.FLAG_FIELD_NAMES.forEach((e=>{i[e]=r[e]})),i.msgsSent+=r.addMsgsSent,i.msgsReceived+=r.addMsgsReceived,i.viewOnceMsgsSent+=r.addViewOnceMsgsSent,i.viewOnceMsgsReceived+=r.addViewOnceMsgsReceived,i.viewOnceMessagesOpened+=r.addViewOnceMsgsOpened,i.callOffersSent+=r.addCallOffersSent,i.callOffersReceived+=r.addCallOffersReceived,i.totalCallDuration+=r.addTotalCallDuration,i.commerceMsgsSent+=r.addCommerceMsgsSent,i.commerceMsgsReceived+=r.addCommerceMsgsReceived,i.pdpInquiriesSent+=r.addPdpInquiriesSent,i}));return(0,c.getTable)().bulkCreateOrReplace(t)})))},t.deleteBeforeInclusive=function(){return p.apply(this,arguments)},t.getBeforeInclusive=function(e){return(0,c.getTable)().lessThan(["startTs"],e,{inclusive:!0})},t.getChatEvent=function(e,t){return(0,c.getTable)().get([e,t])};var i=r(n(348926)),a=r(n(81109)),o=n(927870),s=n(777495),l=n(329948),c=n(891314);const u=Object.freeze((0,a.default)((0,a.default)((0,a.default)({},l.COUNT_FIELDS),s.FLAG_FIELDS),{},{msgsSent:0,msgsReceived:0,viewOnceMsgsSent:0,viewOnceMsgsReceived:0,viewOnceMessagesOpened:0,callOffersSent:0,callOffersReceived:0,totalCallDuration:0,commerceMsgsSent:0,commerceMsgsReceived:0,pdpInquiriesSent:0})),d=new o.PromiseQueue;function p(){return(p=(0,i.default)((function*(e){return yield(0,c.getTable)().bulkDeleteRange(["startTs"],0,e+1)}))).apply(this,arguments)}},448285:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUnreadMentionChat=function(e,t){return(0,h.getStorage)().lock(["chat"],function(){var n=(0,i.default)((function*(n){let[r]=n;const i=Array.from(e.keys());if(0===i.length)return;const a=yield(0,f.getTable)().bulkGet(i);if(!a||0===a.length)return void __LOG__(4,void 0,new Error)`addUnreadMentionChat: could not find chats`;const o=[];return a.forEach((n=>{if(n){var r;const a=n.id.toString();let s=null!==(r=n.unreadMentionsOfMe)&&void 0!==r?r:[];const l=e.get(a);l&&(s=s.concat(l));let c={id:a,unreadMentionsOfMe:s};if(t){var i;c={id:a,unreadMentionsOfMe:s,unreadMentionCount:null!==(i=t.get(a))&&void 0!==i?i:0}}o.push(c)}})),(0,f.getTable)().bulkCreateOrMerge(o)}));return function(){return n.apply(this,arguments)}}())},t.bulkUpdateChatLastReactionPreview=function(e){const t=Array.from(e).map((e=>{let[t,n]=e;return{id:t,lastReactionPreview:n}}));return(0,f.getTable)().bulkCreateOrMerge(t)},t.createChat=function(e,t){return(0,f.getTable)().create((0,a.default)({id:e.toString()},t)).catch((e=>{if(e instanceof d.DbOnLogoutAbort)throw e;throw __LOG__(4,!0,new Error)`update chat table failed`,new Error("update chat table failed")}))},t.getChatLastReactionPreview=function(){return m.apply(this,arguments)},t.getChatMeta=function(){return g.apply(this,arguments)},t.markMessageAndChatAsRead=function(e,t,n){return(0,h.getStorage)().lock(["message","chat"],function(){var r=(0,i.default)((function*(r){let[i,a]=r;const o=yield(0,_.getTable)().equals(["from","pendingReadReceipt"],[t,1],{shouldDecrypt:!1}),c=[];let d=0;const p=[];o.forEach((t=>{if(null==e||null!=t.rowId&&t.rowId>e){if(d++,(0,s.isGroupCatchUpEnabled)()&&(0,u.isImportantMessage)(t)){const e={id:t.id,timestamp:t.t};p.push(e)}}else c.push({id:t.id,ack:Math.max(t.ack,l.ACK.READ),pendingReadReceipt:null})}));const f=0===d&&n?-1:d,h=[a.createOrMerge(t,{id:t,unreadCount:f,unreadMentionsOfMe:p,unreadMentionCount:0})];c.length>0&&h.push((0,_.getTable)().bulkCreateOrMerge(c)),yield Promise.all(h)}));return function(){return r.apply(this,arguments)}}())},t.pruneExpiredTcTokens=function(){if((0,c.isLegacyWebdBackend)()||!(0,o.getABPropConfigValue)("trusted_contacts"))return Promise.resolve();const e=(0,p.tokenExpirationCutoff)(p.TcTokenMode.Receiver);return(0,h.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.lessThan(["tcTokenTimestamp"],e);if(!r||0===r.length)return;const i=r.map((e=>({id:e.id,tcToken:null,tcTokenTimestamp:null})));return n.bulkCreateOrMerge(i)}));return function(){return t.apply(this,arguments)}}())},t.reduceChatUnreadCount=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,h.getStorage)().lock(["chat"],function(){var n=(0,i.default)((function*(n){let[r]=n;const i=yield r.get(e);if(null==i)return void __LOG__(4,void 0,new Error)`reduceChatUnreadCount: could not find chat with id ${e}`;const a=Math.max(i.unreadCount-t,0);return r.merge(e,{unreadCount:a})}));return function(){return n.apply(this,arguments)}}())},t.removeUnreadMentionChat=function(e){return(0,h.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=Array.from(e.keys());if(0===r.length)return;const i=yield(0,f.getTable)().bulkGet(r);if(!i||0===i.length)return void __LOG__(4,void 0,new Error)`removeUnreadMentionChat: could not find chats`;const a=[];return i.forEach((t=>{if(t){var n;let r=null!==(n=t.unreadMentionsOfMe)&&void 0!==n?n:[];const i=e.get(t.id.toString());i&&(r=r.filter((e=>!i.includes(e.id)))),a.push({id:t.id.toString(),unreadMentionsOfMe:r})}})),(0,f.getTable)().bulkCreateOrMerge(a)}));return function(){return t.apply(this,arguments)}}())},t.updateChatArchiveDrawer=function(e){return(0,h.getStorage)().lock(["chat"],(t=>{let[n]=t;const r=Array.from(e.keys());if(0===r.length)return Promise.resolve();const i=r.map((t=>{var n;return{id:t,archiveAtMentionViewedInDrawer:null!==(n=e.get(t))&&void 0!==n&&n}}));return n.bulkCreateOrMerge(i)}))},t.updateChatForMarkAsReadSync=function(e){return(0,h.getStorage)().lock(["chat"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=yield n.get(e);if(null!=r)return-1===r.unreadCount?n.createOrMerge(e,{id:e,unreadCount:0,unreadMentionsOfMe:[],unreadMentionCount:0}):void 0;__LOG__(4,void 0,new Error)`updateMarkChatAsReadSync: could not find chat with id ${e}`}));return function(){return t.apply(this,arguments)}}())};var i=r(n(348926)),a=r(n(81109)),o=n(257243),s=n(227101),l=n(535470),c=n(88555),u=n(237540),d=n(435232),p=n(564603),f=n(68638),_=n(290981),h=n(799069);function g(){return(g=(0,i.default)((function*(e){const t=yield(0,f.getTable)().get(e.toString());return t?{unreadCount:t.unreadCount,timestamp:t.t}:Promise.reject(new Error("Failed to find row in chat table with id:"+e.toString()))}))).apply(this,arguments)}function m(){return(m=(0,i.default)((function*(e){const t=yield(0,f.getTable)().get(e.toString());return t?t.lastReactionPreview:Promise.reject(new Error("Failed to find row in chat table with id:"+e.toString()))}))).apply(this,arguments)}},835673:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.isAddressBookContact=function(){return l.apply(this,arguments)},t.setNotAddressBookContacts=function(e){if((0,a.isMDBackend)())return(0,s.getStorage)().lock(["contact"],(()=>{const t=e.map((e=>({id:e,isAddressBookContact:0,name:void 0,shortName:void 0})));return(0,o.getContactTable)().bulkCreateOrMerge(t)}));return Promise.resolve()};var i=r(n(348926)),a=n(88555),o=n(776214),s=n(799069);function l(){return(l=(0,i.default)((function*(e){const t=yield(0,o.getContactTable)().get(e);return null!=t&&0!==t.isAddressBookContact}))).apply(this,arguments)}},209108:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.bulkCreateOrReplaceDeviceRecord=function(){return E.apply(this,arguments)},t.bulkGetDeviceRecord=m,t.createOrReplaceDeviceRecord=function(){return S.apply(this,arguments)},t.doesDeviceHashMatch=function(){return b.apply(this,arguments)},t.getAllDeviceLists=function(){return(0,p.getTable)().all()},t.getDeviceIds=v,t.getDeviceInfoForSync=function(){return A.apply(this,arguments)},t.getDeviceRecord=h,t.getMyDeviceList=function(){return P.apply(this,arguments)},t.hasDevice=function(){return C.apply(this,arguments)};var i=r(n(348926)),a=r(n(594654)),o=n(252230),s=n(142430),l=n(88555),c=n(769315),u=n(978820),d=n(745454),p=n(460996),f=n(325397);const _=new s.LruCache({sizeLimit:2e3,getSize:()=>1});function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(e){if((0,l.isMDBackend)()){const t=(0,f.createDeviceListPK)(e);if(!_.has(t)){const e=yield(0,p.getTable)().get(t);_.put(t,e)}return _.get(t)}return Promise.reject(new Error("getDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){if((0,l.isMDBackend)()){const t=[];e.forEach((e=>{_.has((0,f.createDeviceListPK)(e))||t.push((0,f.createDeviceListPK)(e))}));return(yield(0,p.getTable)().bulkGet(t)).forEach(((e,n)=>{_.put(t[n],e)})),e.map((e=>_.get((0,f.createDeviceListPK)(e))))}return Promise.reject(new Error("bulkGetDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function S(){return(S=(0,i.default)((function*(e){return(0,l.isMDBackend)()?(yield(0,p.getTable)().createOrReplace(e),void _.put(e.id,e)):Promise.reject(new Error("createOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function E(){return(E=(0,i.default)((function*(e){return(0,l.isMDBackend)()?(yield(0,p.getTable)().bulkCreateOrReplace(e),void e.forEach((e=>{_.put(e.id,e)}))):Promise.reject(new Error("bulkCreateOrReplaceDeviceRecord: not supported for non md"))}))).apply(this,arguments)}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e){if((0,l.isMDBackend)()){return(yield m(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){if((0,l.isLegacyWebdBackend)())return!1;if(t===o.DEFAULT_DEVICE_ID)return!0;const[n]=yield v([e]);return!!n&&!!n.devices.includes(t)}))).apply(this,arguments)}function A(){return(A=(0,i.default)((function*(e){if((0,l.isMDBackend)()){return(yield m(e)).map((e=>{if(e&&!e.deleted){const t=e.devices.map((e=>e.id));return{id:e.id,devices:t,timestamp:e.timestamp,expectedTs:e.expectedTs}}return null}))}return Promise.reject(new Error("getDeviceIds: not supported without model storage and md backend"))}))).apply(this,arguments)}function b(){return(b=(0,i.default)((function*(e,t){if((0,l.isMDBackend)()){if(null==t)return!0;const n=(yield v([e])).map((e=>null==e?[]:e.devices.map((t=>(0,d.createDeviceWidFromDeviceListPk)(e.id,t))))),r=(0,a.default)(n,(e=>e));return(yield(0,c.phashV2)(r))!==t}return!1}))).apply(this,arguments)}function P(){return(P=(0,i.default)((function*(){const e=(0,u.assertGetMe)(),t=yield h(e);if(!t||t.deleted)throw new Error("syncd: cannot find my device list");return t}))).apply(this,arguments)}},236993:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateDirectConnectionKeys=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().createOrMerge(e.id,e);return Promise.resolve()},t.fetchDirectConnectionKeys=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().get(e);return Promise.resolve()},t.removeDirectConnectionKeys=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().remove(e);return Promise.resolve()};var r=n(88555),i=n(568259)},562415:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.persistGroupInviteV4Msg=function(e,t){if((0,o.isMDBackend)())return(0,u.getTable)().createOrMerge(e,t);return Promise.resolve()},t.revokeGroupInvites=function(){return d.apply(this,arguments)},t.updatePendingParticipants=function(){return p.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(88555),s=n(40234),l=n(978820),c=n(745454),u=n(935884);function d(){return(d=(0,a.default)((function*(e,t,n,r){if((0,o.isMDBackend)()){const a=yield(0,u.getTable)().equals(["from","to","groupId"],[e,t,n]).then((e=>e.filter((e=>!e.expired&&e.expiration<=r))));return(0,u.getTable)().bulkCreateOrReplace(a.map((e=>(0,i.default)((0,i.default)({},e),{},{expired:!0})))),a}return Promise.resolve(null)}))).apply(this,arguments)}function p(){return(p=(0,a.default)((function*(e){if((0,o.isMDBackend)()){var t;const r=null===(t=(0,l.getMaybeMeUser)())||void 0===t?void 0:t.toString(),i=n(963928).default.gadd(e);yield(0,u.getTable)().equals(["from","groupId"],[r,e.toString()]).then((e=>e.filter((e=>!e.expired&&s.Clock.globalUnixTime()<=e.expiration)))).then((e=>{e.forEach((e=>{i.pendingParticipants.add({id:(0,c.createUserWid)(e.to)})}))}))}return Promise.resolve()}))).apply(this,arguments)}},141037:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addNotification=f,t.enqueueNotification=function(){return _.apply(this,arguments)},t.fetchNextHitorySyncChunkForProcessing=function(){return h.apply(this,arguments)},t.getByChunkOrderNumber=function(e,t){let n;if((0,o.isLegacyWebdBackend)())n=Promise.reject(new Error("getNotificationForChunk for history sync notification: not supported without md backend"));else if(n=(0,l.getTable)().equals(["chunkOrder","syncType"],[e,t]),!n)return Promise.reject(new Error("getNotificationForChunk history sync notification: not supported for non MD"));return n},t.getNextUnProcessedNotification=d,t.markChunkForReuploadPending=function(e){return c.delete(e),(0,l.getTable)().merge(e,{reuploadPending:!0})},t.removeLocalFailureFromInFlightChunk=function(e){c.delete(e)},t.updateCurrentlyProcessed=p;var i=r(n(81109)),a=r(n(348926)),o=n(88555),s=n(711597),l=n(115118);const c=new Set;function u(){return(u=(0,a.default)((function*(e,t,n){const r=(0,s.getLastHistorySycnedChunk)();if(4===e)return!0;if([2,3].includes(e)&&1===t){if(3===e){return!!(0,s.getInitialHistorySyncComplete)()}const t=(0,s.getHistorySyncStatus)();return!!(null==t?void 0:t.recentCompleted)}if(null==r)return!1;const[i,a]=r.split("_");return i===`${e}`&&a===""+(t-1)||(i===`${e}`&&a===`${t}`?(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed: next chunk already processed ${e}_${t}, last processed: ${r} `,yield p(n),!1):(__LOG__(2,void 0,void 0,void 0,["History sync"])`isPreviousChunkProcessed returned false for ${e}_${t}, last processed: ${r} `,!1))}))).apply(this,arguments)}function d(){let e;if((0,o.isLegacyWebdBackend)())e=Promise.reject(new Error("getNextUnProcessed for history sync notification: not supported without md backend"));else if(e=(0,l.getTable)().equals(["processed"],0,{shouldDecrypt:!1}).then(function(){var e=(0,a.default)((function*(e){var t;const n=e.filter((e=>!c.has(e.msgKey)&&!e.reuploadPending)).sort(((e,t)=>e.syncType<t.syncType?1:e.syncType>t.syncType?-1:e.syncType===t.syncType&&null!=e.chunkOrder&&null!=t.chunkOrder?e.chunkOrder-t.chunkOrder:0));let r=n.length>0?n[0]:void 0;if(null!=(null===(t=r)||void 0===t?void 0:t.chunkOrder)){if(r){if(!(yield function(){return u.apply(this,arguments)}(r.syncType,r.chunkOrder,r.msgKey)))return;r=yield(0,l.getTable)().postflightDecryptSingleRecord(r)}return r}var i;__LOG__(2,void 0,void 0,void 0,["History sync"])`getNextUnProcessedNotification chunkOrder is null, ${null===(i=r)||void 0===i?void 0:i.msgKey}`}));return function(){return e.apply(this,arguments)}}()),!e)return Promise.reject(new Error("getNextUnProcessed history sync notification: not supported for non MD"));return e}function p(e){let t;if((0,o.isLegacyWebdBackend)())t=Promise.reject(new Error("updateCurrentProcessed for history sync notification: not supported without md backend"));else if(c.delete(e),t=(0,l.getTable)().remove(e),!t)return Promise.reject(new Error("updateCurrentProcessed history sync notification: not supported for non MD"));return t.catch((e=>{__LOG__(2,void 0,void 0,void 0,["History sync"])`updateCurrentlyProcessed failed with error ${e}`}))}function f(e){let t;if((0,o.isLegacyWebdBackend)())t=Promise.reject(new Error("add history sync notification: not supported without md backend"));else{const n=e.downloadOptions.mediaKey,r=e.downloadOptions.directPath,a=e.downloadOptions.filehash,o=e.downloadOptions.encFilehash;e.downloadOptions.mediaKey="",e.downloadOptions.directPath="",e.downloadOptions.filehash="",e.downloadOptions.encFilehash="";const s=(0,i.default)((0,i.default)({},e),{},{chunkEncryptionKey:n,directPath:r,filehash:a,encFilehash:o});if(e.processed=0,t=(0,l.getTable)().createOrMerge(e.msgKey,s),!t)return Promise.reject(new Error("add history sync notification: not supported for non MD"))}return t}function _(){return(_=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];yield f(e),t&&c.add(e.msgKey)}))).apply(this,arguments)}function h(){return(h=(0,a.default)((function*(){if(c.size>0)return null;const e=yield d();return e&&(e.downloadOptions.mediaKey=e.chunkEncryptionKey,delete e.chunkEncryptionKey,e.downloadOptions.directPath=e.directPath||e.downloadOptions.directPath,delete e.directPath,e.downloadOptions.filehash=""===e.downloadOptions.filehash?e.filehash:e.downloadOptions.filehash,delete e.filehash,e.downloadOptions.encFilehash=e.encFilehash,delete e.encFilehash,c.add(e.msgKey)),e}))).apply(this,arguments)}},154598:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryAndRemoveLocalLabelAssociation=function(){return s.apply(this,arguments)},t.queryLocalLabelAssociation=o;var i=r(n(348926)),a=n(82663);function o(e){return(0,a.getTable)().anyOf(["associationId","type"],e.map((e=>{let{associationId:t,type:n}=e;return[t,n]})))}function s(){return(s=(0,i.default)((function*(e){const t=yield o(e);yield(0,a.getTable)().bulkRemove(t.map((e=>{let{labelId:t,associationId:n,type:r}=e;return[t,n,r]})))}))).apply(this,arguments)}},845222:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.attachContactLidInfo=function(){return p.apply(this,arguments)},t.clearLidInfoMappingCache=function(){u.clear(),d.clear()},t.createOrReplaceDisplayNames=function(){return f.apply(this,arguments)},t.createOrReplaceLidPnMappings=function(){return _.apply(this,arguments)};var i=r(n(348926)),a=n(40234),o=n(745454),s=n(463015),l=n(130086),c=n(799069);const u=new Map,d=new Map;function p(){return(p=(0,i.default)((function*(e){if(!e.id.isLid())return;const t=e.id.user;let n,r;if(u.has(t))n=u.get(t);else{const e=yield(0,l.getTable)().get(t);n=null==e?void 0:e.phoneNumber,u.set(t,n)}if(null!=n&&(e.phoneJid=(0,o.createUserWid)(n)),d.has(t))r=d.get(t);else{const e=yield(0,s.getTable)().get(t);r=null==e?void 0:e.displayName,d.set(t,r)}null!=r&&(e.displayNameLID=r)}))).apply(this,arguments)}function f(){return(f=(0,i.default)((function*(e){const t=e.filter((e=>{let{lid:t,displayName:n}=e;return d.get(t)!==n}));if(0===t.length)return;const{ContactCollection:r}=n(719380);t.forEach((e=>{let{lid:t,displayName:n}=e;d.set(t,n);const i=r.get((0,o.createUserWid)(t,"lid"));null!=i&&(i.displayNameLID=n)})),yield(0,s.getTable)().bulkCreateOrReplace(t.map((e=>{let{lid:t,displayName:n}=e;return{id:t,displayName:n}})))}))).apply(this,arguments)}function _(){return(_=(0,i.default)((function*(e){const t=e.filter((e=>{let{lid:t,pn:n}=e;return u.get(t)!==n}));if(0===t.length)return;const{ContactCollection:r}=n(719380);t.forEach((e=>{let{lid:t,pn:n}=e;u.set(t,n);const i=r.get((0,o.createUserWid)(t,"lid"));null!=i&&(i.phoneJid=(0,o.createUserWid)(n))})),yield(0,c.getStorage)().lock(["lid-pn-mapping"],(0,i.default)((function*(){const e=yield(0,l.getTable)().bulkGet(t.map((e=>{let{lid:t}=e;return t}))),n=new Map(e.filter((e=>null!=e)).map((e=>[e.id,e.phoneNumber]))),r=t.filter((e=>{let{lid:t,pn:r}=e;return n.get(t)!==r}));if(0===r.length)return;const i=a.Clock.globalUnixTime();yield(0,l.getTable)().bulkCreateOrReplace(r.map((e=>{let{lid:t,pn:n}=e;return{id:t,phoneNumber:n,createdAtTimestamp:i}})))})))}))).apply(this,arguments)}},614748:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceUpdateLock=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,r.isLegacyWebdBackend)())return Promise.reject(new Error("This call is only supported in MD mode"));let a=["participant","device-list"];t&&(a=[...a,"message"]);n&&(a=[...a,"missing-keys"]);return(0,i.getStorage)().lock(a,(t=>e(t)))};var r=n(88555),i=n(799069)},847124:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.RetryEligibilityResult=void 0,t.createOrMergeReceiptRecords=function(e){if((0,l.isMDBackend)()){const t=new Map;return e.forEach((e=>{var n;const{msgKey:r,receiverId:i}=e,a=(0,u.toUserWid)(i).toString(),s=r.toString(),l=`${s},${a}`,c=null!==(n=i.device)&&void 0!==n?n:o.DEFAULT_DEVICE_ID,d=t.get(l);d?d.deviceNotDelivered.push(c):t.set(l,{msgKey:s,receiverUserJid:a,deviceDelivered:[],deviceNotDelivered:[c]})})),(0,f.getStorage)().lock(["message-info"],function(){var e=(0,a.default)((function*(e){let[n]=e;const r=Array.from(t.values()).map((e=>[e.msgKey,e.receiverUserJid]));return(yield n.anyOf(["msgKey","receiverUserJid"],r)).forEach((e=>{const n=`${e.msgKey},${e.receiverUserJid}`,r=t.get(n);r&&t.set(n,(0,i.default)((0,i.default)({},e),{},{deviceNotDelivered:[...e.deviceNotDelivered,...r.deviceNotDelivered]}))})),(0,p.getTable)().bulkCreateOrReplace(Array.from(t.values()))}));return function(){return e.apply(this,arguments)}}())}return Promise.reject(new Error("createOrMergeReceiptRecords: not supported for non MD"))},t.isRetryEligible=function(e,t,n,r){if((0,l.isMDBackend)()){const i=(0,u.toUserWid)(t).toString(),a=t.device||0;return(0,p.getTable)().get([e.toString(),i]).then((s=>s?s.deviceNotDelivered.includes(a)?null!=n&&r>=n?g.ELIGIBLE:null!=t.device&&t.device!==o.DEFAULT_DEVICE_ID||null!=s.delivery?g.INELIGIBLE_CHANGED_IDENTITY:g.ELIGIBLE:(__LOG__(2)`MessageInfoStore: ${e.toString()},${i}:${a} has been delivered`,g.INELIGIBLE_ALREADY_DELIVERED):(__LOG__(2)`MessageInfoStore: missing record for ${e.toString()},${i}`,g.INELIGIBLE_RECORD_MISSING)))}return Promise.resolve(g.INELIGIBLE_NOT_MD)},t.queryMsgInfo=function(e){if((0,l.isMDBackend)()){const t=String(e);return(0,d.getTable)().get(t).then((t=>{const n=t?t.count:null;return(0,p.getTable)().equals(["msgKey"],e.toString()).then((t=>{const r={delivery:[],deliveryRemaining:0,played:[],playedRemaining:0,read:[],readRemaining:0};let i=0;t.forEach((e=>{const t=(0,u.createWid)(e.receiverUserJid);if(!(0,c.getMeUser)().equals(t)){!function(e){const t=e.read;null!=t&&(null==e.delivery||e.delivery>t)&&(e.delivery=t)}(e);for(let n=0;n<h.length;n++){const i=h[n],a=e[i];if(null!=a){r[i].push({id:t,t:a});break}}null!=e.delivery&&null!=e.deliveryPrivacyMode&&(r.deliveryPrivacyMode=e.deliveryPrivacyMode),i+=1}}));const a=null!=n&&0!==n?n:i;return __LOG__(2)`queryMsgInfo: ${e}, ack count: ${n}, receiver: ${a},
played: ${r.played.length}, read: ${r.read.length}, delivery: ${r.delivery.length}`,r.playedRemaining=a-r.played.length,r.readRemaining=r.playedRemaining-r.read.length,r.deliveryRemaining=r.readRemaining-r.delivery.length,r}))}))}return Promise.reject(new Error("queryMsgInfo: not supported without model storage"))},t.updateReceiptRecords=function(e,t,n,r,i){if((0,l.isMDBackend)()){const a=_[e],o=(0,u.toUserWid)(n).toString(),l=n.device||0;return a?function(e,t,n,r,i,a){if(0===i.length)return Promise.resolve();return(0,f.getStorage)().lock(["message-info"],(o=>{let[l]=o;const c=i.map((e=>[e,n]));return l.bulkGet(c).then((o=>{const c=[];return i.forEach(((i,l)=>{const u=o[l];if(!u){__LOG__(2)`updateReceiptRecords: got receipt for peer msg ${i},${n}`;const r={msgKey:i,receiverUserJid:n,[e]:t,deviceDelivered:[],deviceNotDelivered:[]};return e===s.ACK_STRING.DELIVERY&&null!=a&&(r.deliveryPrivacyMode=a),void c.push(r)}if(e!==_[s.ACK.INACTIVE]){const n=u[e];(null==u[e]||n>t)&&(u[e]=t),e===s.ACK_STRING.DELIVERY&&null!=a&&(u.deliveryPrivacyMode=a)}u.deviceNotDelivered.length>0&&(u.deviceDelivered.push(r),u.deviceDelivered=u.deviceDelivered.filter(((e,t,n)=>n.indexOf(e)===t)),u.deviceNotDelivered=u.deviceNotDelivered.filter((e=>e!==r))),c.push(u)})),l.bulkCreateOrReplace(c)}))}))}(a,t,o,l,r,i):Promise.reject(new Error(`updateReceiptRecords: not supported ack type ${e}`))}return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(535470),l=n(88555),c=n(978820),u=(r(n(389867)),n(745454)),d=n(290981),p=n(352489),f=n(799069);const _={[s.ACK.RECEIVED]:s.ACK_STRING.DELIVERY,[s.ACK.READ]:s.ACK_STRING.READ,[s.ACK.PLAYED]:s.ACK_STRING.PLAYED,[s.ACK.INACTIVE]:s.ACK_STRING.INACTIVE},h=[s.ACK_STRING.PLAYED,s.ACK_STRING.READ,s.ACK_STRING.DELIVERY],g=Object.freeze({ELIGIBLE:"ELGIBLE",INELIGIBLE_RECORD_MISSING:"INELIGIBLE_RECORD_MISSING",INELIGIBLE_ALREADY_DELIVERED:"INELIGIBLE_ALREADY_DELIVERED",INELIGIBLE_NOT_MD:"INELIGIBLE_NOT_MD",INELIGIBLE_CHANGED_IDENTITY:"INELIGIBLE_CHANGED_IDENTITY"});t.RetryEligibilityResult=g},160960:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageOrphansByParentMsgKey=function(e){return(0,s.getTable)().equals(["parentMsgKey"],String(e)).then((e=>e.filter(Boolean).map((e=>(0,a.default)((0,a.default)({},e),{},{parsedMsgPayload:(0,o.messageFromDbRow)(e.parsedMsgPayload)})))))},t.getMessageOrphansByParentMsgKeys=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=n(536051),s=n(800789);function l(){return(l=(0,i.default)((function*(e){const t=new Set(e.map((e=>String(e)))),n=yield(0,s.getTable)().anyOf(["parentMsgKey"],Array.from(t)),r=new Map;return n.forEach((e=>{const t=r.get(e.parentMsgKey)||[];t.push(e),r.set(e.parentMsgKey,t)})),r}))).apply(this,arguments)}},740946:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.purgeExpiredOrphanRecords=function(){return c.apply(this,arguments)};var i=r(n(348926)),a=n(115461),o=n(290981),s=n(800789),l=r(n(730381));function c(){return(c=(0,i.default)((function*(e,t){const n=(0,l.default)().subtract(e,"days").unix(),r=(0,l.default)().subtract(t,"days").unix(),i=yield(0,s.getTable)().between(["t"],0,n),c=new Set(i.map((e=>e.parentMsgKey))),u=yield(0,o.getTable)().bulkGet(Array.from(c)),d=new Set(u.filter((e=>e&&e.type===a.MSG_TYPE.UNKNOWN)).map((e=>null==e?void 0:e.id))),p=i.filter((e=>!d.has(e.parentMsgKey)||e.t<r)).map((e=>e.msgKey));return(0,s.getTable)().bulkRemove(p)}))).apply(this,arguments)}},469440:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.storeMessageOrphans=function(){return c.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(536051),s=n(528842),l=n(800789);function c(){return(c=(0,a.default)((function*(e,t){__LOG__(2)`storeMessageOrphans:`;const n=e.map((e=>{var n,r;return{msgKey:e.id.toString(),parentMsgKey:t(e).toString(),sender:e.sender,parsedMsgPayload:(0,o.dbRowFromMessage)((0,i.default)({},e)),type:null!==(n=null===(r=s.addOnProviders.find((t=>t.matches(e))))||void 0===r?void 0:r.type)&&void 0!==n?n:l.MessageAddOnsType.Unknown,senderTimestampMs:e.senderTimestampMs,t:e.t}}));yield(0,l.getTable)().bulkCreate(n)}))).apply(this,arguments)}},986868:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.removeMessagesFromHistory=function(e){if((0,i.isMDBackend)()){const t=[];return(0,s.initializeWithoutGKs)().then((()=>{if(e.length>0)return(0,c.getTable)().bulkGet(e).then((e=>{e.forEach((e=>{null!=(null==e?void 0:e.rowId)&&t.push(String(e.rowId))}))}))})).then((()=>(0,u.getStorage)().lock(["message","label-association"],(()=>{const t=(0,o.queryAndRemoveLocalLabelAssociation)(e.map((e=>({associationId:e,type:l.LabelAssociationType.Message}))));return Promise.all([(0,c.getTable)().bulkRemove(e),t])})))).then((()=>{t.length>0&&a.default.purge(t).catch((()=>{}))})).then((()=>{})).catch((e=>{throw __LOG__(4,void 0,new Error)`removeMessagesFromHistory: error ${e}`,e}))}return Promise.resolve()};var i=n(88555),a=r(n(169048)),o=n(154598),s=n(923356),l=n(82663),c=n(290981),u=n(799069);n(979038)},760324:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pruneExpiredMessages=function(){if((0,r.isMDBackend)())return __LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages started`,(0,o.getTable)().lessThan(["expiredTimestamp"],i.Clock.globalUnixTime(),{shouldDecrypt:!1}).then((e=>(0,a.removeMessagesFromHistory)(e.map((e=>e.id.toString()))).then((()=>(__LOG__(2,void 0,void 0,void 0,["ephemeral-messages"])`pruneExpiredMessages completed`,e)))));return Promise.resolve([])},t.removeExpiredMessagesFromHistory=function(e){if((0,r.isMDBackend)())return(0,a.removeMessagesFromHistory)(e.map((e=>e.id.toString())));return Promise.resolve()};var r=n(88555),i=n(40234),a=n(986868),o=n(290981)},935588:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.msgFindQuery=function(e,t){if(null!=t.label)return Promise.resolve([]);if("before"===e)return function(){return m.apply(this,arguments)}(t,t.count);if("after"===e)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;if((0,s.isMDBackend)()&&e instanceof d.default){const n=e.remote.toString();return(0,f.getTable)().equals(["id"],e.toString()).then((r=>{if(0===r.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new h;const i=r[0],a=(0,c.getInChatMsgId)(i.internalId||""),o=(0,c.craftInternalId)(n,a);let s=(0,c.craftInternalId)(n,a+t);const d={lowerInclusive:!1,upperInclusive:!0};return(0,u.receiveReactionsEnabled)()?(s=(0,c.endOfChat)(e.remote),(0,p.queryChatVisibleMessageHelper)(o,s,d,t).then((e=>e.map(l.messageFromDbRow)))):(0,p.queryChatMessageHelper)(o,s,d).then((e=>e.map(l.messageFromDbRow)))}))}return Promise.resolve([])}(t,t.count).catch((0,o.filteredCatch)(h,(()=>({status:404}))));if("star"===e){const e=null==t.id?void 0:new d.default(t);return null!=t.chat?function(e,t,n){if((0,s.isMDBackend)())return Promise.resolve().then((()=>{if(null!=n)return(0,f.getTable)().get(n.toString())})).then((n=>{const r=null==n?[(0,c.endOfChat)(e),1/0]:[n.internalId,n.isStarred],i=[(0,c.beginningOfChat)(e),0];return(0,f.getTable)().between(["internalId","isStarred"],i,r,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:t}).then((e=>e.map(l.messageFromDbRow)))}));return Promise.resolve([])}(t.chat,t.count,e):function(e,t){if((0,s.isMDBackend)())return Promise.resolve().then((()=>{if(null!=t)return(0,f.getTable)().get(t.toString())})).then((t=>{const n=null==t?1/0:t.isStarred;return(0,f.getTable)().between(["isStarred"],0,n,{lowerInclusive:!1,upperInclusive:!1,reverse:!0,limit:e}).then((e=>e.map(l.messageFromDbRow)))}));return Promise.resolve([])}(t.count,e)}if("search"===e){const e={};t.remote&&(e.remote=t.remote.toString()),t.count&&t.page>=0&&(e.limit=t.count,e.page=t.page);const{default:r}=n(169048);return r.search(t.searchTerm,e)}if("media"===e){const e=t.remote,n=null==t.id?void 0:new d.default(t);return"document"===t.media?g(e,t.count,t.direction,"isDocMsg",n).then((e=>e.map(l.messageFromDbRow))):"url"===t.media?g(e,t.count,t.direction,"hasLink",n).then((e=>e.map(l.messageFromDbRow))):Promise.all(["isMediaMsg","isDocMsg","hasLink"].map((r=>g(e,t.count,t.direction,r,n).then((e=>e.map(l.messageFromDbRow)))))).then((e=>{let[t,n,r]=e;const i=[t,r,n].flat();return{docCount:n.length,linkCount:r.length,mediaCount:t.length,messages:i}}))}return __LOG__(3)`Message query type ${e} not implemented.`,Promise.reject(new Error(`Message query type ${e} not implemented.`))},t.queryMessageType=g,t.queryVcard=function(e){if((0,s.isMDBackend)())return(0,f.getTable)().equals(["vcardWAids"],e.toString()).then((e=>e.map(l.messageFromDbRow)));return Promise.resolve()};var i=r(n(81109)),a=r(n(348926)),o=n(450796),s=n(88555),l=n(536051),c=n(861948),u=n(408139),d=r(n(465212)),p=n(312896),f=n(290981);const _=20;class h extends Error{constructor(){super(...arguments),this.name="NoAnchorMessageError"}}function g(e,t,n,r,i){if((0,s.isMDBackend)()){return(null==i?Promise.resolve(void 0):(0,f.getTable)().equals(["id"],i.toString())).then((a=>{if(i&&null!=a&&0===a.length)throw __LOG__(3)`Anchor message ${i&&i.toString()} does not exist in message table`,new h;const o=null==a?void 0:a[0];let s,l,u=!1;return"before"===n?(s=(0,c.beginningOfChat)(e),l=null==o?(0,c.endOfChat)(e):(0,c.craftInternalId)(e.toString(),(0,c.getInChatMsgId)(o.internalId||"")),u=!0):(s=null==o?(0,c.beginningOfChat)(e):(0,c.craftInternalId)(e.toString(),(0,c.getInChatMsgId)(o.internalId||"")),l=(0,c.endOfChat)(e)),(0,f.getTable)().between(["internalId",r],[s,0],[l,1/0],{lowerInclusive:!1,upperInclusive:!1,limit:t,reverse:u})}))}return Promise.resolve([])}function m(){return(m=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_;if(!(0,s.isMDBackend)()||!e.remote)return Promise.resolve([]);const n=e.remote.toString();let r;if(e instanceof d.default){const t=yield(0,f.getTable)().equals(["id"],e.toString());if(0===t.length)throw __LOG__(3)`Anchor message ${e.toString()} does not exist in message table`,new h;r=t[0]}let a=(0,c.beginningOfChat)(e.remote),o=(0,c.endOfChat)(e.remote);if(r){const e=(0,c.getInChatMsgId)(r.internalId||""),i=Math.max(0,e-t);o=(0,c.craftInternalId)(n,e),a=(0,c.craftInternalId)(n,i)}const g={lowerInclusive:!0,upperInclusive:!1};if((0,u.receiveReactionsEnabled)()){a=(0,c.beginningOfChat)(e.remote);return(yield(0,p.queryChatVisibleMessageHelper)(a,o,(0,i.default)((0,i.default)({},g),{},{reverse:!0}),t)).reverse().map(l.messageFromDbRow)}const m=yield(0,p.queryChatMessageHelper)(a,o,g);return m.map(l.messageFromDbRow)}))).apply(this,arguments)}},584886:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DuplicateMessageError",{enumerable:!0,get:function(){return r.DuplicateMessageError}}),Object.defineProperty(t,"getMsgByMsgKey",{enumerable:!0,get:function(){return a.getMsgByMsgKey}}),Object.defineProperty(t,"getMsgsByMsgKey",{enumerable:!0,get:function(){return a.getMsgsByMsgKey}}),Object.defineProperty(t,"msgFindQuery",{enumerable:!0,get:function(){return i.msgFindQuery}}),Object.defineProperty(t,"processPaymentMessages",{enumerable:!0,get:function(){return r.processPaymentMessages}}),Object.defineProperty(t,"processRevokeMsgs",{enumerable:!0,get:function(){return r.processRevokeMsgs}}),Object.defineProperty(t,"queryVcard",{enumerable:!0,get:function(){return i.queryVcard}}),Object.defineProperty(t,"removeMessagesFromHistory",{enumerable:!0,get:function(){return o.removeMessagesFromHistory}}),Object.defineProperty(t,"starMessages",{enumerable:!0,get:function(){return r.starMessages}}),Object.defineProperty(t,"storeInitialSyncMessages",{enumerable:!0,get:function(){return r.storeInitialSyncMessages}}),Object.defineProperty(t,"storeMessages",{enumerable:!0,get:function(){return r.storeMessages}}),Object.defineProperty(t,"storeRecentAndFullHistSyncMessages",{enumerable:!0,get:function(){return r.storeRecentAndFullHistSyncMessages}}),Object.defineProperty(t,"unstarMessages",{enumerable:!0,get:function(){return r.unstarMessages}}),Object.defineProperty(t,"updateExistingMessages",{enumerable:!0,get:function(){return r.updateExistingMessages}}),Object.defineProperty(t,"updateMessage",{enumerable:!0,get:function(){return r.updateMessage}});var r=n(390641),i=n(935588),a=n(767050),o=n(986868)},330986:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t._test=void 0,t.deleteMessagesInMessageRange=function(e,t,n){const{lastMessageTimestamp:r,lastSystemMessageTimestamp:a,messages:o}=t;return(0,h.getStorage)().lock(["message"],function(){var t=(0,i.default)((function*(t){let[i]=t,s=[];const l=[];null!=r&&(l.push(v(e,r,c.MessagePropertyType.IncomingChatMessage,n)),l.push(v(e,r,c.MessagePropertyType.Outgoing,n)));const u=null!=a?a:r;null!=u&&l.push(v(e,u,c.MessagePropertyType.SystemMessage,n)),l.push(function(){return C.apply(this,arguments)}(o,n));const d=yield Promise.all(l);s=s.concat(...d);const p=null==n?void 0:n.skipMessages;return p&&(s=s.filter((e=>!p.has(e)))),yield i.bulkRemove(s),s}));return function(){return t.apply(this,arguments)}}())},t.filterReceivedMessagesInRange=function(){return y.apply(this,arguments)},t.fixMessageRange=function(e){var t,n;const r=e.messages,i={messages:r,lastMessageTimestamp:e.lastMessageTimestamp};if(__LOG__(2)`syncd: additionalMessages length: ${r.length}`,r.length>g){const{messages:e,newLastMessageTimestamp:t}=S(r,g);null!=t&&(i.lastMessageTimestamp=t,A(i.lastMessageTimestamp,"resultantRange")),i.messages=e}(0,a.numberOrThrowIfTooLarge)(null!==(t=e.lastSystemMessageTimestamp)&&void 0!==t?t:0)>(0,a.numberOrThrowIfTooLarge)(null!==(n=i.lastMessageTimestamp)&&void 0!==n?n:0)&&(i.lastSystemMessageTimestamp=e.lastSystemMessageTimestamp);return i},t.getAdditionalMessages=function(){return m.apply(this,arguments)},t.getFirstSystemMessageTimestamp=function(e){return(0,_.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.SystemMessage),(0,f.endOfMessageRange)(e,c.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!1,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,f.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastMessageTimestamp=function(e){return(0,_.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.IncomingChatMessage),(0,f.endOfMessageRange)(e,c.MessagePropertyType.IncomingChatMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,f.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.getLastSystemMessageTimestamp=function(e){return(0,_.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.SystemMessage),(0,f.endOfMessageRange)(e,c.MessagePropertyType.SystemMessage),{lowerInclusive:!0,reverse:!0,limit:1,shouldDecrypt:!1}).then((e=>{var t;return(0,f.extractC2STimestampFromMessageRangeIndex)(null===(t=e[0])||void 0===t?void 0:t.messageRangeIndex)}))},t.logMaybeMillisecondTimestamp=A,t.timestampComparison=E;var i=r(n(348926)),a=n(608243),o=r(n(145095)),s=n(892844),l=n(40234),c=n(861948),u=n(985947),d=r(n(465212)),p=n(115461),f=n(312896),_=n(290981),h=n(799069);const g=1e3;function m(){return(m=(0,i.default)((function*(e,t,n){const r=(0,_.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.Outgoing,t),(0,f.endOfMessageRange)(e,c.MessagePropertyType.Outgoing),{reverse:!0,shouldDecrypt:!1}),i=(0,_.getTable)().anyOf(["messageRangeIndex"],[(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.IncomingChatMessage,t),(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.Outgoing,t),(0,f.beginningOfMessageRange)(e,c.MessagePropertyType.Outgoing)],{reverse:!0,shouldDecrypt:!1}),a=yield Promise.all([r,i]).then((e=>{let[t,r]=e;return t.concat(r).filter((e=>-1!==e.ack&&!e.isSendFailure&&!e.mdDowngrade)).filter((e=>!((null==n?void 0:n.excludeStarred)&&e.isStarred))).map((e=>{var t;const n=d.default.fromString(e.id),r=null!==(t=(0,f.extractC2STimestampFromMessageRangeIndex)(e.messageRangeIndex))&&void 0!==t?t:void 0;return{key:(0,u.msgKeyToProtobuf)(n),timestamp:r}}))})),{messages:o,newLastMessageTimestamp:s}=S(a,(null==n?void 0:n.limit)||g);return{messages:o,newLastMessageTimestamp:s}}))).apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e,t){if(0===t.length)return t;const n=t.map((e=>(0,u.protobufToMsgKey)((0,o.default)(e.key,"syncActionMessage.key")).toString())),r=yield(0,_.getTable)().bulkGet(n,!1);return t.filter(((e,t)=>null!=r[t]))}))).apply(this,arguments)}function S(e,t){const n=[],r=[];if(e.forEach((e=>{null!=e.timestamp?n.push(e):r.push(e)})),n.length<t)return{messages:e};const i=n.sort(E).slice(0,t),s=i[i.length-1];return A(s.timestamp,"smallestTimestampMessage"),{messages:i.concat(r),newLastMessageTimestamp:(0,a.numberOrThrowIfTooLarge)((0,o.default)(s.timestamp,"smallestTimestampMessage.timestamp"))}}function E(e,t){const[n,r]=[e,t].map((e=>(0,a.numberOrThrowIfTooLarge)((0,o.default)(e.timestamp,"syncActionMessage.timestamp"))));return r-n}function v(){return T.apply(this,arguments)}function T(){return(T=(0,i.default)((function*(e,t,n,r){let i=yield(0,_.getTable)().between(["messageRangeIndex"],(0,f.beginningOfMessageRange)(e,n),(0,f.beginningOfMessageRange)(e,n,(0,a.numberOrThrowIfTooLarge)(t)),{lowerInclusive:!0,upperInclusive:!0,shouldDecrypt:!1});return n===c.MessagePropertyType.SystemMessage&&!1!==(null==r?void 0:r.skipRecentSystemMessages)&&(i=i.filter((e=>!((0,f.isSecuritySensitiveMessage)(e)&&e.t>l.Clock.globalUnixTime()-s.DAY_SECONDS)))),(null==r?void 0:r.skipStarred)&&(i=i.filter((e=>void 0===e.isStarred))),n===c.MessagePropertyType.SystemMessage&&(i=i.filter((e=>!(e.type===p.MSG_TYPE.E2E_NOTIFICATION&&"encrypt"===e.subtype)))),i.map((e=>e.id))}))).apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){const n=e.map((e=>(0,u.protobufToMsgKey)((0,o.default)(e.key,"syncActionMessage.key")).toString())),r=yield(0,_.getTable)().bulkGet(n),i=[];return r.forEach((e=>{null!=e&&((null==t?void 0:t.skipStarred)&&null!=e.isStarred||i.push(e.id))})),i}))).apply(this,arguments)}function A(e,t){try{(0,a.numberOrThrowIfTooLarge)(null!=e?e:0)/(0,s.unixTime)()>10&&(__LOG__(4,void 0,new Error,!0)`syncd: large timestamp: ${t} returned a large timestamp: ${e}`,SEND_LOGS(`syncd: ${t} returned a large timestamp`))}catch(t){__LOG__(4,void 0,new Error)`syncd: error reporting logMaybeMillisecondTimestamp for ${e}: ${t}`}}const b={limitAdditionalMessages:S};t._test=b},767050:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getMsgByMsgKey=function(e){if((0,i.isMDBackend)()){let t;return t=e instanceof o.default?e.toString():e,(0,s.getTable)().get(t).then((e=>e?(0,a.messageFromDbRow)(e):null))}return Promise.resolve(null)},t.getMsgsByMsgKey=function(e){if((0,i.isMDBackend)())return(0,s.getTable)().bulkGet(e).then((e=>e.filter(Boolean).map(a.messageFromDbRow)));return Promise.resolve([])};var i=n(88555),a=n(536051),o=r(n(465212)),s=n(290981)},390641:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PreviousMsgNotPlaceholderError=t.DuplicateMessageError=void 0,t.processPaymentMessages=function(){return te.apply(this,arguments)},t.processPollUpdateMsgs=function(){return re.apply(this,arguments)},t.processReactionMsgs=function(){return ne.apply(this,arguments)},t.processRevokeMsgs=function(){return ee.apply(this,arguments)},t.starMessages=function(e){if((0,d.isMDBackend)())return(0,H.getTable)().bulkGet(e).then((e=>{const t=e.filter(Boolean).map((e=>({id:e.id,isStarred:e.rowId})));return(0,H.getTable)().bulkCreateOrMerge(t)}));return Promise.resolve()},t.storeInitialSyncMessages=function(){return Q.apply(this,arguments)},t.storeMessageInTransaction=ie,t.storeMessages=function(){return Z.apply(this,arguments)},t.storeRecentAndFullHistSyncMessages=function(){return X.apply(this,arguments)},t.unstarMessages=function(e){if((0,d.isMDBackend)())return(0,H.getTable)().bulkCreateOrMerge(e.map((e=>({id:e,isStarred:void 0}))));return Promise.resolve()},t.updateExistingMessages=function(e,t){if((0,d.isMDBackend)()){var n;const r=null==t?null===(n=e[0])||void 0===n?void 0:n.id.remote:t;if(r){const t=e.map((e=>ce((0,g.dbRowFromMessage)(e),r.toString(),!!(0,S.findLink)(e.body,!0))));return Promise.resolve((0,H.getTable)().bulkCreateOrMerge(t)).then((()=>{N.default.index().catch((()=>{}))})).catch((e=>{throw __LOG__(3)`Error storing messages`,e}))}}return Promise.resolve()},t.updateMessage=function(e){if((0,d.isMDBackend)())return(0,V.getStorage)().lock(["message"],function(){var t=(0,a.default)((function*(t){let[n]=t;const r=yield n.get(e.id.toString());if(!r)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, Failed to find previous message row in message table`);if(!function(e){if(null==e?void 0:e.type){if(e.type===T.MSG_TYPE.CIPHERTEXT)return!0;if(e.type===T.MSG_TYPE.UNKNOWN&&"fanout"===e.subtype)return!0}return!1}(r))throw __LOG__(2,void 0,void 0,void 0,["messaging"])`updateMessage: msgId::${e.id.toString()}, Previous row in message table is not a placeholder`,new J;null!=r.t&&(e.t=r.t),r.ack>e.ack&&(e.ack=r.ack);const i=ce((0,g.dbRowFromMessage)(e),e.from.toString(),!!(0,S.findLink)(e.body,!0),void 0,void 0,r.pendingReadReceipt);if(i.rowId=r.rowId,i.internalId=r.internalId,null==i.rowId||null==i.internalId)throw new Error(`[messaging] updateMessage: msgId::${e.id.toString()}, missing rowId or internalId`);yield n.createOrReplace(i),(0,u.populatePlaceHolderAction)(r),N.default.index().catch((()=>{}))}));return function(){return t.apply(this,arguments)}}());return Promise.resolve()};var i=r(n(81109)),a=r(n(348926)),o=r(n(402525)),s=n(252230),l=r(n(145095)),c=n(227101),u=n(276167),d=n(88555),p=n(40234),f=n(237540),_=n(624256),h=n(365063),g=n(536051),m=n(861948),y=n(262240),S=n(995726),E=n(408139),v=r(n(465212)),T=n(115461),C=n(867811),A=n(978820),b=r(n(389867)),P=n(745454),O=n(767050),M=n(312896),I=n(900267),w=n(940357),R=n(6901),N=r(n(169048)),L=n(421224),D=n(743323),k=r(n(441809)),U=n(765044),G=n(776214),x=n(448285),B=n(562415),F=n(649831),j=n(135686),Y=n(83113),K=n(307394),W=n(144936),H=n(290981),V=n(799069),$=r(n(986128));const z=1e9;class q extends Error{constructor(){super(...arguments),this.name="DuplicateMessageError"}}t.DuplicateMessageError=q;class J extends Error{constructor(){super(...arguments),this.name="PreviousMsgNotPlaceholderError"}}function Q(){return(Q=(0,a.default)((function*(e){if((0,d.isMDBackend)()){yield _.DbEncKeyStore.waitForFinalDbMsgEncKey();let t=0;(0,o.default)(e,(e=>{let{msgs:n}=e;return t+=n.length}));const r=new Map,i=new Map,a=Object.keys(e).reduce(((t,n)=>{let i=t.nextRowId,a=z-e[n].msgs.length;const{pendingUnreadIds:o,unreadMentions:s}=oe(e[n].chatInfo.unreadCount||0,e[n].msgs);(0,c.isGroupCatchUpEnabled)()&&s.length&&r.set(n,s);const l=[];return e[n].msgs.forEach((e=>{try{i++,a++,e.isMdHistoryMsg=!0;const t=ce((0,g.dbRowFromMessage)(e),(0,P.createWid)(n).toString(),!!(0,S.findLink)(e.body,!0),i,a,o.has(String(e.id)));l.push(t)}catch(e){if(e instanceof h.DroppingMsgRowDueToLogout)throw e;__LOG__(4,void 0,new Error,void 0,["message-store"])`storeInitialSyncMessages failed with error: ${e.name}, message: ${e.message}, stack: ${e.stack}`}})),{nextRowId:i,messages:t.messages.concat(l)}}),{nextRowId:z-t,messages:[]});return a.messages.forEach((e=>{e.type===T.MSG_TYPE.GROUPS_V4_INVITE&&(0,B.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:p.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)})})),(0,c.isGroupCatchUpEnabled)()&&r.size&&(r.forEach(((e,t)=>{var r,a;const o=n(669951).ChatCollection.get((0,P.createWid)(t)),s=e.map((e=>{let{id:t,timestamp:n}=e;return new k.default({id:t,timestamp:n})})),l=null==o||null===(r=o.groupMetadata)||void 0===r?void 0:r.unreadMentionMetadata,c=null!==(a=null==l?void 0:l.pendingUnreadMentionCount)&&void 0!==a?a:0;(null==l?void 0:l.pendingUnreadMentionCount)&&(l.pendingUnreadMentionCount=Math.max(c-s.length,0),i.set(t,l.pendingUnreadMentionCount)),null==l||l.addUnreadMentions(s,D.UnreadMessageType.HISTORYC_SYNC_CHUNK)})),(0,x.addUnreadMentionChat)(r,i)),(0,V.getStorage)().lock(["message"],(e=>{let[t]=e;return t.bulkCreate(a.messages).catch((e=>{if(__LOG__(3)`Error storing MD initial sync messages with error ${e}`,e instanceof $.default.BulkError||e instanceof $.default.ConstraintError)return __LOG__(2,void 0,void 0,void 0,["History sync"])`Retrying initial sync bulk add on error`,t.bulkCreateOrMerge(a.messages);throw e}))})).then((()=>{$.default.ignoreTransaction((()=>{(0,W.getTable)().bulkCreateOrReplace(a.messages.map((e=>({id:String(e.rowId)})))).then((()=>{N.default.index().catch((()=>{}))}))}))})).catch((e=>{__LOG__(3)`Error storing MD initial sync messages with error ${e} after retry`}))}return Promise.resolve()}))).apply(this,arguments)}function X(){return(X=(0,a.default)((function*(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if((0,d.isMDBackend)()){let a=e;const o=n(669951).ChatCollection,s=new Map,l=new Map;try{a=yield(0,F.applyOrphanRevoke)(e)}catch(e){__LOG__(4,void 0,new Error,void 0,["History sync"])`applyOrphanRevoke failed with error ${e}`}a.forEach((e=>{if(e.type===T.MSG_TYPE.GROUPS_V4_INVITE&&(0,B.persistGroupInviteV4Msg)(e.id.toString(),{id:e.id.toString(),from:e.from.toString(),to:e.to.toString(),groupId:e.inviteGrp,expiration:parseInt(e.inviteCodeExp,10),expired:p.Clock.globalUnixTime()>=parseInt(e.inviteCodeExp,10)}),(0,c.isGroupCatchUpEnabled)()&&(0,f.isImportantMessage)(e)){const a=e.id.remote.toString();let c=0;if(l.has(a)){var t;c=null!==(t=l.get(a))&&void 0!==t?t:0}else{var n,r;const e=o.get(a);c=null!==(n=null==e||null===(r=e.groupMetadata)||void 0===r?void 0:r.unreadMentionMetadata.pendingUnreadMentionCount)&&void 0!==n?n:0,l.set(a,c)}if(c>0){l.set(a,c-1);const t={id:e.id.toString(),timestamp:e.t};var i;if(s.has(a))null===(i=s.get(a))||void 0===i||i.push(t);else s.set(a,[t])}}}));const u=yield(0,h.encryptMultipleDBMsgs)(a,r);return(0,y.storeEncryptedDBMessages)(u,t,i).then((()=>{(0,c.isGroupCatchUpEnabled)()&&s.size>0&&(s.forEach(((e,t)=>{var n,r;const i=o.get(t),a=null!==(n=l.get(t))&&void 0!==n?n:0,c=null==i||null===(r=i.groupMetadata)||void 0===r?void 0:r.unreadMentionMetadata;if(0===(null==c?void 0:c.pendingUnreadMentionCount)||(null==i?void 0:i.hasChatBeenOpened))s.delete(t);else if(c&&c.pendingUnreadMentionCount>0){c.pendingUnreadMentionCount=a;const t=e.map((e=>new k.default({id:e.id.toString(),timestamp:e.timestamp})));c.addUnreadMentions(t,D.UnreadMessageType.HISTORYC_SYNC_CHUNK)}})),s.size>0&&(0,x.addUnreadMentionChat)(s,l))})).catch((()=>{__LOG__(3)`Error storing MD recent or full sync messages`}))}return Promise.resolve()}))).apply(this,arguments)}function Z(){return(Z=(0,a.default)((function*(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,d.isMDBackend)()?(yield _.DbEncKeyStore.waitForFinalDbMsgEncKey(),Promise.resolve(ie(e,t,n)).then((()=>{N.default.index().catch((()=>{}))})).catch((e=>{throw e instanceof $.default.BulkError||e instanceof $.default.ConstraintError?new q:(__LOG__(3)`Error storing messages`,e)}))):Promise.resolve()}))).apply(this,arguments)}function ee(){return(ee=(0,a.default)((function*(e){if((0,d.isMDBackend)()){const t=[],n=[],r=[],i=new Map,o=e.filter((e=>{const{revokeMsgKey:t,newMsgKey:n,subtype:r}=e;let i=!0;return"admin_revoke"===r?(0,E.adminRevokeReceiverEnabled)()?b.default.isGroup(t.remote)?b.default.equals(t.remote,n.remote)||(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke came for the different group than the original message was in`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: ${String(t)} has not been revoked`,__LOG__(3,void 0,void 0,!0)`processRevokeMsgs: admin revoke was sent to a non-group chat`,SEND_LOGS("process-admin-revoke-message")):(i=!1,__LOG__(2)`processRevokeMsgs: admin revoke feature is disabled, ${String(t)} has not been revoked`):(i=b.default.equals(t.remote,n.remote)&&b.default.equals(t.participant,n.participant)&&t.fromMe===n.fromMe,i||__LOG__(2)`processRevokeMsgs: invalid revoke request ${String(t)}, ${String(n)}`),i}));o.forEach((e=>{n.push(e.revokeMsgKey.toString()),r.push(e.newMsgKey.toString())}));const s=o.length;yield(0,V.getStorage)().lock(["message","orphan-revoke"],function(){var e=(0,a.default)((function*(e){let[a,l]=e;const u=yield(0,G.getMessageTable)().bulkGet(n.concat(r),!1),d=u.slice(0,s),p=u.slice(s),_=[],h=[];d.forEach(((e,a)=>{var s,l;if(null==e)return __LOG__(2)`processRevokeMsg: orphan revoke message key ${d[a]}`,void h.push({msgKey:n[a],sender:o[a].sender,timestamp:o[a].timestamp,subtype:null!==(l=o[a].subtype)&&void 0!==l?l:"sender_revoke"});if(_.push({id:r[a],to:e.to,author:e.author,type:T.MSG_TYPE.REVOKED,subtype:"admin_revoke"===o[a].subtype?"admin":"sender",revokeSender:o[a].sender,protocolMessageKey:n[a],protocolMessageRowId:null===(s=p[a])||void 0===s?void 0:s.rowId,from:e.from,t:e.t,rowId:e.rowId,internalId:e.internalId,messageRangeIndex:e.messageRangeIndex,revokeTimestamp:o[a].revokeTimestamp}),t.push(String(e.rowId)),(0,c.isGroupCatchUpEnabled)()&&(0,f.isImportantMessage)(e)){const t=v.default.fromString(e.id).remote.toString();if(i.has(t)){var u;const n=null!==(u=i.get(t))&&void 0!==u?u:[];i.set(t,[...n,e.id])}else i.set(t,[e.id])}}));const g=[(0,G.getMessageTable)().bulkRemove(n),(0,G.getMessageTable)().bulkCreateOrReplace(_)];h.length>0&&g.push((0,G.getOrphanRevokeTable)().bulkCreateOrReplace(h)),yield Promise.all(g)}));return function(){return e.apply(this,arguments)}}()),N.default.purge(t).catch((()=>{})),(0,c.isGroupCatchUpEnabled)()&&(0,x.removeUnreadMentionChat)(i)}return Promise.resolve()}))).apply(this,arguments)}function te(){return(te=(0,a.default)((function*(e){if((0,d.isMDBackend)()){const t=[],n=[],r=e.map((e=>e.paymentRequestMessageKey?e.paymentRequestMessageKey.toString():"")).filter((e=>""!==e)),i=e.filter((e=>"payment_action_request_declined"===e.subtype||"payment_transaction_request_cancelled"===e.subtype)).map((e=>e.id.toString()));return(0,V.getStorage)().lock(["message"],function(){var o=(0,a.default)((function*(a){let[o]=a;const s=yield(0,O.getMsgsByMsgKey)(r.concat(i)),l=new Map;return s.forEach((e=>{null!=e&&l.set(e.id.toString(),e)})),e.forEach((e=>{var r;const i=null===(r=e.paymentRequestMessageKey)||void 0===r?void 0:r.toString(),a=l.get(i||"");if(a)if("send"===e.subtype&&null!=e.paymentTxnStatus)t.push({id:i,paymentTxnStatus:e.paymentTxnStatus});else{const n=a.from.isGroup()?a.author:a.from,r=a.paymentMessageReceiverJid.equals((0,A.getMeUser)())?n:a.paymentMessageReceiverJid;"payment_action_request_declined"===e.subtype?t.push({id:i,paymentStatus:L.PaymentInfo$Status.REJECTED,paymentTxnStatus:L.PaymentInfo$TxnStatus.COLLECT_REJECTED}):"payment_transaction_request_cancelled"===e.subtype&&t.push({id:i,paymentStatus:L.PaymentInfo$Status.CANCELLED,paymentTxnStatus:L.PaymentInfo$TxnStatus.COLLECT_CANCELED}),t.push({id:e.id.toString(),type:T.MSG_TYPE.NOTIFICATION_TEMPLATE,templateParams:[r,a.paymentCurrency,String(a.paymentAmount1000)]})}else l.get(e.id.toString())&&!e.isMdHistoryMsg&&n.push(e.id.toString())})),yield(0,G.getMessageTable)().bulkRemove(n),yield(0,G.getMessageTable)().bulkCreateOrMerge(t),t}));return function(){return o.apply(this,arguments)}}())}return null}))).apply(this,arguments)}function ne(){return(ne=(0,a.default)((function*(e){if(e.length>0){const t=yield(0,C.createReactionsRowFromMsg)(e),n=yield(0,K.createOrUpdateReactions)(t);if((0,C.updateHasReactionFromParent)(n),(0,E.showReactionChatListPreview)()){const e=yield(0,I.filterChatsWithReactionPreviewUpdates)(n);yield(0,x.bulkUpdateChatLastReactionPreview)(e)}}}))).apply(this,arguments)}function re(){return(re=(0,a.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(0===e.length)return;const{pollUpdateMsgsToParentMsgs:r,orphans:i}=yield(0,j.getParentMessages)(e);yield Promise.all([(0,a.default)((function*(){if(0===i.length)return;const{storeMessageOrphans:e}=n(469440);yield e(i,(e=>(0,l.default)(e.pollUpdateParentKey,"pollUpdateMsg.pollUpdateParentKey")))}))(),(0,a.default)((function*(){if(0===r.size)return;const e=yield(0,w.extractPollVotes)(r);yield Promise.all([t(e),(0,Y.upsertVotes)(e)])}))()])}))).apply(this,arguments)}function ie(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=null==t?e[0].id.remote:t,i=(0,m.beginningOfChat)(r),o=(0,m.endOfChat)(r);return(0,V.getStorage)().lock(["chat","message"],function(){var t=(0,a.default)((function*(t){let[a,s]=t;const l=yield a.get(r.toString());if(!r.isStatusV3()&&(null!=l||(0,M.shouldCreateChatWithMsgs)(e))){const t=yield se(l,e,r);yield a.createOrMerge(r.toString(),t)}const c=s.all({reverse:!n,limit:1,index:["rowId"],returnKeyType:"keys"}).then((e=>0===e.length?z:e[0])),u=s.between(["internalId"],i,o,{limit:1,reverse:!n,returnKeyType:"keys"}).then((e=>0===e.length?z:(0,m.getInChatMsgId)(e[0]))),[d,p]=yield Promise.all([c,u]),f=n?d-e.length:d+1,_=n?p-e.length:p+1,h=e.map(((e,t)=>{const i=(0,g.dbRowFromMessage)(e),a=!n&&ae(e.id,e);return ce(i,r.toString(),!!(0,S.findLink)(e.body,!0),f+t,_+t,a)}));return s.bulkCreate(h).then((()=>h))}));return function(){return t.apply(this,arguments)}}()).then((e=>{$.default.ignoreTransaction((()=>{(0,W.getTable)().bulkCreateOrReplace(e.map((e=>({id:String(e.rowId)}))))}))}))}function ae(e,t){if(e.fromMe||e.remote.isStatusV3())return!1;const n=(0,f.eventTypeFromMsgType)(t);return"a"===n||"d"===n}function oe(e,t){let n=e;const r=new Set,i=[];for(let e=t.length-1;e>=0&&!(n<=0);e--){const a=t[e];if(ae(a.id,a)&&(n--,r.add(String(a.id)),(0,c.isGroupCatchUpEnabled)()&&(0,f.isImportantMessage)(a))){const e={id:String(a.id),timestamp:a.t};i.push(e)}}return{pendingUnreadIds:r,unreadMentions:i}}function se(){return le.apply(this,arguments)}function le(){return(le=(0,a.default)((function*(e,t,n){var r;let i,a=Math.max(0,e?e.unreadCount:0);const o=null!==(r=null==e?void 0:e.unreadMentionsOfMe)&&void 0!==r?r:[];return t.forEach((e=>{const t=(0,f.eventTypeFromMsgType)(e);if("i"!==t&&(e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),"a"!==t&&"d"!==t||e.id.fromMe||(a+=1),(0,c.isGroupCatchUpEnabled)())){if(ae(e.id,e)&&(0,f.isImportantMessage)(e)){const t={id:e.id.toString(),timestamp:e.t};o.push(t)}}})),e&&null!=e.t&&(null==i||e.t>i)&&(i=e.t),{id:n.toString(),unreadCount:a,t:i,unreadMentionsOfMe:o}}))).apply(this,arguments)}function ce(e,t,n,r,a,o){const l=[T.MSG_TYPE.IMAGE,T.MSG_TYPE.VIDEO,T.MSG_TYPE.AUDIO].includes(e.type),c=(0,i.default)((0,i.default)({},e),{},{vcardWAids:e.vcardWAids||(0,m.getVcardWids)(e),id:e.id.toString(),isStarred:e.star?r:void 0,hasLink:"chat"===e.type&&n?r:void 0,isMediaMsg:l?r:void 0,isDocMsg:e.type===T.MSG_TYPE.DOCUMENT?r:void 0,expiredTimestamp:ue(e)});null!=r&&(c.rowId=r),null!=a&&(c.internalId=(0,m.craftInternalId)(t,a)),o&&t!==s.STATUS_JID&&(c.pendingReadReceipt=1);let u=e.c2sTimestamp;var d;e.id.fromMe&&!U.Socket.hasSynced?u=null!==(d=e.c2sTimestamp)&&void 0!==d?d:e.t:u=e.t;try{e.type!==T.MSG_TYPE.REACTION&&(c.messageRangeIndex=(0,m.craftMessageRangeIndex)(t,!v.default.fromString(e.id).fromMe,T.SYSTEM_MESSAGE_TYPES.includes(e.type),u))}catch(e){__LOG__(4,void 0,new Error)`[process-msg] craftMessageRangeIndex failed with error ${e}`}return c}function ue(e){const{ephemeralDuration:t,ephemeralStartTimestamp:n,t:r,subtype:i,id:{fromMe:a}}=e,o=(0,R.getEphemeralExpirationTimestamp)(t,n,r,i,a);return null!=o?o:void 0}t.PreviousMsgNotPlaceholderError=J},413946:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundsForChat=function(){return c.apply(this,arguments)},t.queryAndRemoveMessageHistory=function(){return d.apply(this,arguments)},t.queryAndRemoveMessagesInMessageRange=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(861948),o=n(330986),s=r(n(169048)),l=n(290981);function c(){return(c=(0,i.default)((function*(e){const t=(0,a.beginningOfChat)(e),n=(0,a.endOfChat)(e),r=yield(0,l.getTable)().between(["internalId"],t,n,{lowerInclusive:!1,upperInclusive:!1,limit:1});if(0===r.length)return null;const i=r[0].rowId,o=yield(0,l.getTable)().between(["internalId"],t,n,{lowerInclusive:!1,upperInclusive:!1,limit:1,reverse:!0});if(0===o.length)return null;const s=o[0].rowId,c=o[0].t;return null==i||null==s?null:{startRowId:i,endRowId:s,tsOfLastMessage:c}}))).apply(this,arguments)}function u(){return(u=(0,i.default)((function*(e,t,n){const r=yield(0,o.deleteMessagesInMessageRange)(e,t,n);return s.default.purge(r).catch((()=>{})),r}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){const t=(0,a.beginningOfChat)(e),n=(0,a.endOfChat)(e),r=yield(0,l.getTable)().between(["internalId"],t,n,{lowerInclusive:!1,upperInclusive:!1,returnKeyType:"primary_key"});return yield(0,l.getTable)().bulkRemove(r),r}))).apply(this,arguments)}},312896:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.beginningOfMessageRange=function(e,t,n){const r=null!=n?function(e){const t=e.toString(16);return(t.length-1).toString(16)+t}(n):"";return`${e.toString()}_${t}_${r}`},t.endOfMessageRange=function(e,t){return`${e.toString()}_${t}_g`},t.extractC2STimestampFromMessageRangeIndex=function(e){if(e){const t=e.split("_")[2];return t?(0,u.undoOrderPreservingHex)(t):null}return null},t.getKeyMsgsFromChatHistory=function(e,t){if((0,l.isMDBackend)()){performance.now();const r=(0,o.getABPropConfigValue)("web_init_chat_max_unread_message_count");let i,a,s,l,u=e.unreadCount,p=0;const _=[];let h=0;const m=[];let y=0;const S=o=>{if(p++,o.type===f.MSG_TYPE.PROTOCOL)return!1;if(o.type===f.MSG_TYPE.REACTION)return!1;if(o.type===f.MSG_TYPE.POLL_UPDATE)return!1;if((0,d.receiveReactionsEnabled)()&&v(o))return 0!==r&&h>=r?(l||(l=o.id),s||(__LOG__(3)`[init-from-storage] getKeyMsgsFromChatHistory: Exceeded limit ${r} to find a non futureproof reaction message`,s=o),!0):(t||_.push(o),h++,!1);const{isKeepInChatReadEnabled:g}=n(529805);return g()&&T(o)?0!==r&&y>=r?(l||(l=o.id),s||(__LOG__(3)`[init-from-storage] getKeyMsgsFromChatHistory: Exceeded limit ${r} to find a non futureproof keep in chat message`,s=o),!0):(t||m.push(o),y++,!1):(l||(l=o.id),s||(s=o),a||[f.MSG_TYPE.E2E_NOTIFICATION,f.MSG_TYPE.PROTOCOL,f.MSG_TYPE.REACTION].includes(o.type)||(a=o),!t&&(null!=a||p>10)||(!(!(0===u||0!==r&&e.unreadCount>=r)||!a)||!!(u>0&&(0,c.isUnreadTypeMsg)(o)&&(u-=1,0===u))&&(i=o.id.toString(),!0)))};return(0,g.getTable)().between(["internalId"],`${e.id}_/`,`${e.id}_g`,{reverse:!0},S).then((()=>{if(_.length){(0,n(701283).o0)(_)}return{anchor:i,previewMsg:a||s,lastReceivedKey:l}}))}return Promise.resolve({anchor:void 0,previewMsg:void 0,lastReceivedKey:void 0})},t.getMessagesBefore=function(e,t){return(0,g.getTable)().between(["internalId"],`${e}_/`,`${e}_g`,{reverse:!0},t)},t.isKeepInChatFutureproof=T,t.isReactionFutureproof=v,t.isSecuritySensitiveMessage=function(e){var t;const n=new Map([[f.MSG_TYPE.GP2,["remove","add","ephemeral","invite","leave"]],[f.MSG_TYPE.E2E_NOTIFICATION,["encrypt","encrypt_now","e2e_identity_unavailable","identity","device"]],[f.MSG_TYPE.NOTIFICATION_TEMPLATE,["change_number","verified_initial_unknown","verified_initial_low","verified_initial_high","verified_transition_any_to_none","verified_transition_any_to_high","verified_transition_high_to_low","verified_transition_high_to_unknown","verified_transition_unknown_to_low","verified_transition_low_to_unknown","verified_transition_none_to_low","verified_transition_none_to_unknown","payment_transaction_status_update_failed","payment_transaction_status_update_refunded","payment_transaction_status_update_refund_failed","payment_transaction_status_receiver_pending_setup","payment_transaction_status_receiver_success_after_hiccup","payment_transaction_request_cancelled","payment_action_account_setup_reminder","payment_action_send_payment_reminder","payment_action_send_payment_invitation","payment_action_request_declined","payment_action_request_expired"]]]);return(null===(t=n.get(e.type))||void 0===t?void 0:t.includes(e.subtype))||!1},t.queryChatMessageHelper=function(){return S.apply(this,arguments)},t.queryChatVisibleMessageHelper=function(){return E.apply(this,arguments)},t.shouldCreateChatWithMsgs=function(e){return e.some((e=>e.type!==f.MSG_TYPE.NOTIFICATION_TEMPLATE))},t.shouldRenderInUI=C;var i=r(n(506479)),a=r(n(348926)),o=n(257243),s=n(535470),l=n(88555),c=n(237540),u=n(861948),d=n(408139),p=r(n(465212)),f=n(115461),_=n(978820),h=n(745454),g=n(290981),m=n(352489);const y=["limit"];function S(){return(S=(0,a.default)((function*(e,t,n){if((0,l.isMDBackend)()){const r=(yield(0,g.getTable)().between(["internalId"],e,t,n)).filter((e=>C(e)));return yield A(r),r}return Promise.resolve([])}))).apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e,t,r,a){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];const{limit:u}=r,p=(0,i.default)(r,y),f=(0,o.getABPropConfigValue)("web_init_chat_max_unread_message_count");if((0,l.isMDBackend)()){const r=[],i=[];let o=0;const l=e=>null!=a&&o===a||!!C(e,s,c)&&(o++,o>f&&__LOG__(3)`queryChatVisibleMessageHelper: visibleMsgsCount exceeds the threshold`,!1),u=(yield(0,g.getTable)().between(["internalId"],e,t,p,l)).filter((e=>{if((0,d.receiveReactionsEnabled)()&&v(e)&&!s.includes(e.id.toString()))return r.push(e),!1;const{isKeepInChatReadEnabled:t}=n(529805);return t()&&T(e)&&!c.includes(e.id.toString())?(i.push(e),!1):!!C(e,s,c)}));if(r.length){(0,n(701283).o0)(r)}if(i.length){(0,n(272729).v7)(i)}return yield A(u),u}return Promise.resolve([])}))).apply(this,arguments)}function v(e){return e.type===f.MSG_TYPE.UNKNOWN&&e.subtype===f.MSG_TYPE.REACTION}function T(e){return e.type===f.MSG_TYPE.UNKNOWN&&e.subtype===f.MSG_TYPE.KEEP_IN_CHAT}function C(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type===f.MSG_TYPE.REACTION)return!1;if(e.type===f.MSG_TYPE.POLL_UPDATE)return!1;if(e.type===f.MSG_TYPE.DEBUG)return!1;if((0,d.receiveReactionsEnabled)()&&v(e)&&!t.includes(e.id.toString()))return!1;const{isKeepInChatReadEnabled:i}=n(529805);return!(i()&&T(e)&&!r.includes(e.id.toString()))}function A(){return b.apply(this,arguments)}function b(){return(b=(0,a.default)((function*(e){const t=P(e);if(0===t.length)return;const n=yield(0,m.getTable)().anyOf(["msgKey"],t.map((e=>e.id))),r=new Map,i=[];n.forEach((e=>{const t=(0,h.createWid)(e.receiverUserJid);if((0,_.getMeUser)().equals(t))return;const n=r.get(e.msgKey)||{played:0,read:0,delivery:0};null!=e.played?n.played++:null!=e.read?n.read++:null!=e.delivery&&n.delivery++,r.set(e.msgKey,n)})),t.forEach((e=>{const{ack:t,id:n}=e,a=r.get(n);if(!a)return;let o=null,l=e.count||1;0==(l-=a.played)?o=s.ACK.PLAYED:0==(l-=a.read)?o=s.ACK.READ:0==(l-=a.delivery)&&(o=s.ACK.RECEIVED),null!=o&&o>t&&(e.ack=o,i.push({id:n,ack:o})),i.length>0&&(__LOG__(2,void 0,void 0,void 0,["message-store"])`maybeUpdateMsgAck: storing ack updates ${JSON.stringify(i)}`,(0,g.getTable)().bulkCreateOrMerge(i))}))}))).apply(this,arguments)}function P(e){return e.filter((e=>{if(!(0,c.isUnreadTypeMsg)(e))return!1;if(e.type===f.MSG_TYPE.CIPHERTEXT||e.type===f.MSG_TYPE.UNKNOWN||e.ack<=s.ACK.CLOCK)return!1;const t=p.default.fromString(e.id);if(!t.fromMe)return!1;if(t.remote.isGroup()&&(null!=e.rowId&&e.rowId<1e9||null==e.count))return __LOG__(2,void 0,void 0,void 0,["message-store"])`getMsgMayNeedAckUpdate: skip update for history group message ${e.id}`,!1;if(e.type===f.MSG_TYPE.PTT){if(e.ack===s.ACK.PLAYED)return!1}else if(e.ack===s.ACK.READ)return!1;return!0}))}},940221:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateOrphanReceipt=function(e,t,n){if((0,r.isMDBackend)())return(0,a.getStorage)().lock(["orphan-receipt"],(r=>{let[i]=r;return i.bulkGet(n).then((r=>{const a=n.reduce(((n,i,a)=>{let o=r[a];o||(o={msgKey:i});const s=o[e];return(null==s||s>t)&&(o[e]=t,n.push(o)),n}),[]);return i.bulkCreateOrReplace(a)}))}));return Promise.reject(new Error("updateReceiptRecords: not supported for non MD"))},t.getOrphanReceipt=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().get(e);return Promise.reject(new Error("getOrphanReceipt: not supported for non MD"))},t.removeOrphanReceipt=function(e){if((0,r.isMDBackend)())return(0,i.getTable)().remove(e);return Promise.reject(new Error("removeOrphanReceipt: not supported for non MD"))};var r=n(88555),i=n(156161),a=n(799069)},649831:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.applyOrphanRevoke=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(115461),s=r(n(389867)),l=n(745454),c=n(88851);function u(){return(u=(0,i.default)((function*(e){if((0,a.isMDBackend)()){const t=yield(0,c.getTable)().bulkGet(e.map((e=>String(e.id)))),n=[],r=[];return t.forEach(((t,i)=>{const a=e[i];if(null!=t){var c;if(__LOG__(2)`applyOrphanRevoke: find orphan revoke for message ${a.id.toString()}`,!s.default.isStatusV3(a.id.remote))r.push({id:a.id,to:a.to,author:a.author,revokeSender:(0,l.createWidFromWidLike)(null!==(c=t.sender)&&void 0!==c?c:a.sender),type:o.MSG_TYPE.REVOKED,subtype:"admin_revoke"===t.subtype?"admin":"sender",protocolMessageKey:a.id,from:a.from,t:a.t,broadcast:a.broadcast});n.push(t.msgKey)}else r.push(a)})),(0,c.getTable)().bulkRemove(n),r}return Promise.reject(new Error("applyOrphanRevoke: called in non-md mode"))}))).apply(this,arguments)}},724319:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateOrphanTcToken=function(e,t){if((0,a.isMDBackend)())return(0,o.getTable)().createOrMerge(e,(0,i.default)({chatId:e},t));return Promise.reject(new Error("createOrUpdateOrphanTcToken: not supported for non MD"))},t.getOrphanTcToken=function(e){if((0,a.isMDBackend)())return(0,o.getTable)().get(e);return Promise.reject(new Error("getOrphanTcToken: not supported for non MD"))},t.removeOrphanTcToken=function(e){if((0,a.isMDBackend)())return(0,o.getTable)().remove(e);return Promise.reject(new Error("removeOrphanTcToken: not supported for non MD"))};var i=r(n(81109)),a=n(88555),o=n(408433)},543201:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.GroupUnSyncedError=void 0,t.clearAdminshipCache=function(e){null!=e?m.delete(e):m.clear()},t.getGroupSenderKeyList=function(e){let t;if((0,s.isLegacyWebdBackend)())t=Promise.reject(new Error("getGroupSenderKeyList: not supported without model storage and md backend"));else{const r=e.toString();if(t=(0,p.getTable)().get(r).then((t=>{const r=[],i=[];if(!t)return{skDistribList:r,skList:i,rotateKey:!1};const{senderKey:a,rotateKey:o}=t;return Array.from(a.keys()).forEach((e=>{a.get(e)?i.push((0,u.createWid)(e)):r.push((0,u.createWid)(e))})),function(e,t){const r=n(963928).default.get(e);null!=r&&(r.cachedDeviceCount=t,r.cachedDeviceSizeBucket=(0,d.default)(t))}(e,r.length+i.length),o?{skDistribList:r.concat(i),skList:[],rotateKey:o}:{skDistribList:r,skList:i,rotateKey:o}})),!t)return Promise.reject(new Error("getGroupSenderKeyList: not supported"))}return t},t.injectPastParticipantsFromDB=function(){return g.apply(this,arguments)},t.isCurrentUserGroupAdmin=function(e){const t=(0,c.getMaybeMeUser)();if(!m.has(e)){const n=(0,p.getTable)().get(e).then((e=>!!e&&e.admins.includes(null==t?void 0:t.toString())));m.set(e,n)}const n=m.get(e);return Promise.resolve(n)},t.markForgetSenderKey=function(e,t){let n;if((0,s.isLegacyWebdBackend)())n=Promise.reject(new Error("markForgetSenderKey: not supported without model storage and md backend"));else{const r=e.toString();if(n=(0,f.getStorage)().lock(["participant"],(e=>{let[n]=e;return n.get(r).then((e=>{if(e)return n.createOrReplace(h(e,t,!1));__LOG__(2)`markForgetSenderKey: group participant info missing for group ${r}`}))})),!n)return Promise.reject(new Error("markForgetSenderKey: not supported"))}return n},t.markHasSenderKey=function(e,t){let n;if((0,s.isLegacyWebdBackend)())n=Promise.reject(new Error("markHasSenderKey: not supported without model storage and md backend"));else{const r=e.toString();if(n=(0,f.getStorage)().lock(["participant"],(e=>{let[n]=e;return n.get(r).then((e=>{if(e)return n.createOrReplace(h(e,t,!0));__LOG__(2)`markHasSenderKey: group participant info missing for group ${r}`}))})),!n)return Promise.reject(new Error("markHasSenderKey: not supported"))}return n},t.pruneExpiredPastParticipants=function(){if((0,s.isLegacyWebdBackend)())return Promise.reject(new Error("pruneExpiredPastParticipants: not supported for non MD"));return(0,f.getStorage)().lock(["participant"],function(){var e=(0,a.default)((function*(e){let[t]=e;const n=yield(0,p.getTable)().all(),r=[];return n.forEach((e=>{const t=e.pastParticipants.filter((e=>{const t=(0,o.castToUnixTime)(e.leaveTs);return(0,o.happenedWithin)(t,o.DAY_SECONDS*l.PAST_PARTICIPANT_EXPIRATION_DAYS)}));if(t.length!==e.pastParticipants.length){const n=(0,i.default)((0,i.default)({},e),{},{pastParticipants:t});r.push(n)}})),r.length,t.bulkCreateOrReplace(r)}));return function(){return e.apply(this,arguments)}}())},t.setAdminshipCache=function(e,t){m.set(e,t)};var i=r(n(81109)),a=r(n(348926)),o=n(892844),s=n(88555),l=n(312380),c=n(978820),u=n(745454),d=r(n(616786)),p=n(396826),f=n(799069);class _ extends Error{constructor(){super(...arguments),this.name="GroupUnSyncedError"}}function h(e,t,n){const r=new Map(e.senderKey);let i=!1;return t.forEach((e=>{if(e.equals((0,c.assertGetMe)()))return;const t=String(e);r.has(t)?r.set(t,n):i=!0})),{groupId:e.groupId,senderKey:r,participants:e.participants,pastParticipants:e.pastParticipants,admins:e.admins,rotateKey:i,deviceSyncComplete:e.deviceSyncComplete}}function g(){return(g=(0,a.default)((function*(e){const t=e.map((e=>e.id.toString())),n=yield(0,p.getTable)().bulkGet(t);return e.map(((e,t)=>{var r,a;return(0,i.default)((0,i.default)({},e),{},{pastParticipants:null===(r=n[t])||void 0===r||null===(a=r.pastParticipants)||void 0===a?void 0:a.map((e=>{let{jid:t,leaveTs:n,leaveReason:r}=e;return{id:(0,u.createWid)(t),leaveTs:n,leaveReason:r}}))})}))}))).apply(this,arguments)}t.GroupUnSyncedError=_;const m=new Map},400238:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.storePeerMessages=function(e){const t=e.map((e=>(0,i.default)((0,i.default)({},e.toJSON()),{},{id:String(e.id),to:String(e.to)})));(0,a.getTable)().bulkCreate(t)};var i=r(n(81109)),a=n(398136)},135686:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.getParentMessages=function(){return s.apply(this,arguments)};var i=r(n(348926)),a=r(n(145095)),o=n(767050);function s(){return(s=(0,i.default)((function*(e){const t=new Set(e.map(l)),n=yield(0,o.getMsgsByMsgKey)(Array.from(t)),r=new Map(n.map((e=>[e.id.toString(),e]))),i=new Map,a=[];for(const t of e){const e=r.get(l(t));null==e?a.push(t):i.set(t,e)}return{pollUpdateMsgsToParentMsgs:i,orphans:a}}))).apply(this,arguments)}function l(e){return(0,a.default)(e.pollUpdateParentKey,"pollUpdateMsgData.pollUpdateParentKey").toString()}},83113:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.upsertVotes=function(e){if(!(0,o.isMDBackend)())return Promise.reject(new Error("upsertVotes: not supported for non MD"));const t=(0,a.maxPerGroup)(e,(e=>e.senderTimestampMs),s.getVoteKey);return(0,c.getStorage)().lock(["poll-votes"],function(){var e=(0,i.default)((function*(e){let[n]=e;const r=yield n.anyOf(["parentMsgKey","sender"],t.map((e=>[e.parentMsgKey.toString(),e.sender.toString()]))),i=new Map;for(const e of r)i.set((0,s.getVoteKey)(e),e);const a=t.filter((e=>{const t=i.get((0,s.getVoteKey)(e));return null==t||e.senderTimestampMs>=t.senderTimestampMs}));0!==a.length&&(yield n.bulkCreateOrReplace(a.map(l.dbRowFromVote)))}));return function(){return e.apply(this,arguments)}}())};var i=r(n(348926)),a=n(634114),o=n(88555),s=n(887426),l=n(270160),c=n(799069)},270160:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.dbRowFromVote=function(e){return{msgKey:e.msgKey.toString(),parentMsgKey:e.parentMsgKey.toString(),selectedOptionLocalIds:new Uint8Array(e.selectedOptionLocalIds).buffer,senderTimestampMs:e.senderTimestampMs,sender:e.sender.toString()}},t.voteFromDbRow=function(e){return{msgKey:i.default.fromString(e.msgKey),parentMsgKey:i.default.fromString(e.parentMsgKey),selectedOptionLocalIds:Array.from(new Uint8Array(e.selectedOptionLocalIds)),senderTimestampMs:e.senderTimestampMs,sender:(0,a.createUserWid)(e.sender)}};var i=r(n(465212)),a=n(745454)},575861:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.disallowedRowsToLists=s,t.queryDisallowedLists=function(){return o.apply(this,arguments)};var i=r(n(348926)),a=n(861319);function o(){return(o=(0,i.default)((function*(){try{return s(yield(0,a.getTable)().all())}catch(e){return __LOG__(4,!0,new Error,!0)`privacy_settings_drawer: get all privacy disallowed lists failed`,SEND_LOGS("privacy_settings_drawer: get all privacy disallowed lists failed"),{status:null,groupadd:null,last:null,profile:null}}}))).apply(this,arguments)}function s(e){const t={status:null,groupadd:null,last:null,profile:null};return e.forEach((e=>{switch(e.id){case a.PrivacyDisallowedListType.About:return void(t.status=e);case a.PrivacyDisallowedListType.GroupAdd:return void(t.groupadd=e);case a.PrivacyDisallowedListType.LastSeen:return void(t.last=e);case a.PrivacyDisallowedListType.ProfilePicture:t.profile=e}})),t}},215565:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.changeOrphanStateReactions=function(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("changeOrphanStateReactions: not supported for non MD"));return(0,s.getStorage)().lock(["reactions"],function(){var t=(0,i.default)((function*(t){let[n]=t;const r=e.map((e=>[e,1])),i=yield(0,o.getTable)().anyOf(["parentMsgKey","orphan"],r);return i.forEach((e=>{e.orphan=0,e.orphanReason=void 0})),yield n.bulkCreateOrReplace(i),i}));return function(){return t.apply(this,arguments)}}())};var i=r(n(348926)),a=n(88555),o=n(672821),s=n(799069)},307394:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateReactions=function(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("createOrUpdateReactions: not supported for non MD"));const t=new Map;return e.forEach((e=>{const{parentMsgKey:n,senderUserJid:r}=e;(0,o.isReactionByMe)(r)&&(e.read=!0);const i=`${n},${r}`,a=t.get(i);a?a.timestamp<=e.timestamp&&t.set(i,e):t.set(i,e)})),(0,s.getStorage)().lock(["reactions"],function(){var e=(0,i.default)((function*(e){let[n]=e;const r=Array.from(t.values()).map((e=>[e.parentMsgKey,e.senderUserJid]));return(yield n.anyOf(["parentMsgKey","senderUserJid"],r)).forEach((e=>{const n=`${e.parentMsgKey},${e.senderUserJid}`,r=t.get(n);r&&r.timestamp<=e.timestamp&&t.delete(n)})),yield n.bulkCreateOrReplace(Array.from(t.values())),Array.from(t.values())}));return function(){return e.apply(this,arguments)}}())};var i=r(n(348926)),a=n(88555),o=n(867811),s=n(799069)},727485:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.deleteReactionsByParentMessageKey=function(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"));const t=[];return(0,o.getStorage)().lock(["reactions"],function(){var n=(0,i.default)((function*(n){let[r]=n;return(yield r.equals(["parentMsgKey"],e)).forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),r.bulkRemove(t)}));return function(){return n.apply(this,arguments)}}())},t.deleteReactionsByParentMessageKeys=function(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("deleteReactionsByParentMessageKeys: not supported for non MD"));const t=[];return(0,o.getStorage)().lock(["reactions"],function(){var n=(0,i.default)((function*(n){let[r]=n;const i=yield r.anyOf(["parentMsgKey"],e);return i.forEach((e=>t.push([e.parentMsgKey,e.senderUserJid]))),yield r.bulkRemove(t),i.map((e=>e.msgKey))}));return function(){return n.apply(this,arguments)}}())},t.deleteReactionsByRecords=function(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("deleteReactionsByRecords: not supported for non MD"));return(0,o.getStorage)().lock(["reactions"],function(){var t=(0,i.default)((function*(t){let[n]=t;yield n.bulkRemove(e)}));return function(){return t.apply(this,arguments)}}())};var i=r(n(348926)),a=n(88555),o=n(799069)},957881:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.existsReaction=function(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("existsReaction: not supported for non MD"));return(0,l.getTable)().get([e.parentMsgKey,e.senderUserJid])},t.getAllReactionsFromParentMsgs=function(e){return(0,c.getStorage)().lock(["reactions"],(t=>{let[n]=t;return n.anyOf(["parentMsgKey"],e)}))},t.getFilteredReactionsFromParentMsgs=function(){return p.apply(this,arguments)},t.getReactions=function(){return d.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(867811),s=n(767247),l=n(672821),c=n(799069),u=r(n(5030));function d(){return(d=(0,i.default)((function*(e){if(!(0,a.isMDBackend)())return Promise.reject(new Error("getReactions: not supported for non MD"));const t=yield(0,l.getTable)().equals(["parentMsgKey"],e),n={reactions:[],reactionByMe:null},r=new Map;t.forEach((e=>{const{reactionText:t,orphan:i}=e;if(t!==o.REVOKED_REACTION_TEXT&&1!==i){var a;const i=s.EmojiUtil.getEmojiAggregate(t),o=null!==(a=r.get(i))&&void 0!==a?a:[];r.set(i,[...o,e]);(0,u.default)(e.msgKey).fromMe&&(n.reactionByMe=e)}}));const i=n.reactionByMe?s.EmojiUtil.getEmojiAggregate(n.reactionByMe.reactionText):"";return r.forEach(((e,t)=>{let r=!1;t===i&&(r=!0),n.reactions.push({aggregateEmoji:t,senders:e,hasReactionByMe:r})})),n}))).apply(this,arguments)}function p(){return(p=(0,i.default)((function*(e){const t=new Map;return yield(0,c.getStorage)().lock(["reactions"],function(){var n=(0,i.default)((function*(n){let[r]=n;(yield r.anyOf(["parentMsgKey"],e)).forEach((e=>{const{reactionText:n,orphan:r}=e;if(n!==o.REVOKED_REACTION_TEXT&&1!==r){var i;const n=null!==(i=t.get(e.parentMsgKey))&&void 0!==i?i:[];n.push(e),t.set(e.parentMsgKey,n)}}))}));return function(){return n.apply(this,arguments)}}()),t}))).apply(this,arguments)}},979491:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.markReactionRowsAsRead=function(e){return l({reactions:e,read:!0})},t.markReactionsAsReadByMessageKeysInStore=function(e){if(!(0,o.isMDBackend)())return Promise.reject(new Error("deleteReactionsByParentMessageKey: not supported for non MD"));return(0,s.getStorage)().lock(["reactions"],function(){var t=(0,a.default)((function*(t){let[n]=t;const r=(yield n.anyOf(["msgKey"],e.map((e=>e.toString())))).map((e=>(0,i.default)((0,i.default)({},e),{},{read:!0})));return yield n.bulkCreateOrReplace(r),r}));return function(){return t.apply(this,arguments)}}())},t.markReactionsAsReadOrOrphan=l;var i=r(n(81109)),a=r(n(348926)),o=n(88555),s=(n(926704),n(799069));function l(e){let{reactions:t,read:n,orphan:r,orphanReason:l}=e;return 0===t.length?Promise.resolve():(0,o.isMDBackend)()?(0,s.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[a]=e;const o=t.map((e=>[e.parentMsgKey,e.senderUserJid])),s=yield a.anyOf(["parentMsgKey","senderUserJid"],o),c={};n&&(c.read=n),void 0!==r&&(c.orphan=r,void 0!==l&&(c.orphanReason=l));const u=s.map((e=>(0,i.default)((0,i.default)({},e),c)));return a.bulkCreateOrReplace(u)}));return function(){return e.apply(this,arguments)}}()):Promise.reject(new Error("markReactionsAsReadOrOrphan: not supported for non MD"))}},766379:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PARENT_MSG_PLACEHOLDER_ORPHAN_THRESHOLD=void 0,t.pruneExpiredOrphanReactions=function(){if(!(0,s.isMDBackend)())return Promise.reject(new Error("pruneExpiredOrphanReactions: not supported for non MD"));return(0,u.getStorage)().lock(["reactions"],function(){var e=(0,i.default)((function*(e){let[t]=e;const n=yield(0,l.getTable)().equals(["orphan"],1),r=[];n.forEach((e=>{const t=(0,a.castToUnixTime)(e.timestamp/1e3);let n;if(e.orphanReason===c.OrphanReactionsReasonType.ParentMsgMissing?n=(0,o.getABPropConfigValue)("reaction_cleanup_days"):e.orphanReason===c.OrphanReactionsReasonType.ParentMsgPlaceholder&&(n=60),null!=n){!(0,a.happenedWithin)(t,a.DAY_SECONDS*n)&&r.push(e)}}));const i=r.map((e=>[e.parentMsgKey,e.senderUserJid]));return i.length,t.bulkRemove(i)}));return function(){return e.apply(this,arguments)}}())};var i=r(n(348926)),a=n(892844),o=n(257243),s=n(88555),l=n(672821),c=n(926704),u=n(799069);t.PARENT_MSG_PLACEHOLDER_ORPHAN_THRESHOLD=60},916551:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updateFailedPropsForSentReactions=function(e){let{reaction:t,ack:n,isSendFailure:r}=e;if(!(0,o.isMDBackend)())return Promise.reject(new Error("updateFailedPropsForSentReactions: not supported for non MD"));return(0,s.getStorage)().lock(["reactions"],function(){var e=(0,a.default)((function*(e){let[a]=e;const o=yield a.get([t.parentMsgKey,t.senderUserJid]);o||__LOG__(3)`reactions-store:updateFailedPropsForSentReactions record not found`;const s={};return null!=n&&(s.ack=n),null!=r&&(s.isSendFailure=r),a.createOrReplace((0,i.default)((0,i.default)({},o),s))}));return function(){return e.apply(this,arguments)}}())};var i=r(n(81109)),a=r(n(348926)),o=n(88555),s=n(799069)},706331:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.queryStatusAllMD=function(){const e=(0,p.createWid)(a.STATUS_JID);return l.DbEncKeyStore.waitForFinalDbMsgEncKey().then((()=>(0,f.queryChatMessageHelper)((0,u.beginningOfChat)(e),(0,u.endOfChat)(e),{lowerInclusive:!1,upperInclusive:!1}).then((e=>{const t=[],n=[];e.forEach((e=>{e.author?(0,o.happenedWithin)((0,o.castToUnixTime)(e.t),o.DAY_SECONDS)&&e.type!==d.MSG_TYPE.REVOKED?n.push((0,c.messageFromDbRow)(e)):t.push(e.id):__LOG__(3)`Author is null for status v3 message`})),(0,_.getTable)().bulkRemove(t);const r=(0,i.default)(n,(e=>e.author.toString())),a=[];for(const e in r){const t=r[e],n=t.filter((e=>e.ack<s.ACK.READ)).length,i=t[t.length-1].t;a.push({id:(0,p.createWid)(e),unreadCount:n,totalCount:t.length,t:i,_msgs:t})}return{statuses:a}}))))};var i=r(n(607739)),a=n(252230),o=n(892844),s=n(535470),l=n(624256),c=n(536051),u=n(861948),d=n(115461),p=n(745454),f=n(312896),_=n(290981)},760998:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTaskScheduledTime=function(e){return(0,r.getTable)().get(e).then((e=>null==e?void 0:e.time))},t.updateTaskScheduledTime=function(e,t){return(0,i.getStorage)().lock(["tasks-scheduled-time"],(n=>{let[r]=n;return r.createOrReplace({taskName:e,time:t})}))};var r=n(333850),i=n(799069)},395716:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.cleanUnjoinedSubgroups=function(){return d.apply(this,arguments)},t.getUnjoinedSubgroupsMetadataFromStorage=function(e){const t=e.map((e=>e.toString()));return(0,s.getTable)().bulkGet(t)},t.removeUnjoinedSubgroupMetadataFromStorage=function(e){(0,s.getTable)().remove(e.toString())},t.updateAsDb=c,t.updateUnjoinedSubgroups=function(){return u.apply(this,arguments)};var i=r(n(348926)),a=r(n(81109)),o=r(n(506479)),s=n(807528);const l=["defaultSubgroup","parentGroupId"];function c(e){const t={},{defaultSubgroup:n,parentGroupId:r}=e,i=(0,o.default)(e,l);return null!=n&&(t.defaultSubgroup=n),null!=r&&(t.parentGroup=r.toString()),(0,a.default)((0,a.default)((0,a.default)({},i),t),{},{id:e.id.toString()})}function u(){return(u=(0,i.default)((function*(e){let{unjoinedSubgroups:t,parentGroupId:n,link:r}=e;if(!r)return void(yield(0,s.getTable)().bulkRemove(t.map((e=>e.id.toString()))));let i=[];const o=yield(0,s.getTable)().bulkGet(t.map((e=>e.id.toString())));i=t.map(((e,t)=>{const r=o[t];let i={subject:e.subject,subjectTime:e.subjectTime||0};if(r){const e=r.subjectTime||0;e>i.subjectTime&&(i={subject:r.subject,subjectTime:e})}return c((0,a.default)((0,a.default)((0,a.default)({},e),i),{},{parentGroupId:n}))})),yield(0,s.getTable)().bulkCreateOrMerge(i)}))).apply(this,arguments)}function d(){return(d=(0,i.default)((function*(e){let{unjoinedSubgroupIds:t,parentGroupId:n}=e;const r=(yield(0,s.getTable)().equals(["parentGroup"],n.toString())).map((e=>e.id)),i=t.map((e=>e.toString())),a=r.filter((e=>!i.includes(e)));yield(0,s.getTable)().bulkRemoveByIndex(["id"],a)}))).apply(this,arguments)}},464448:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.hydrateWids=function e(t){if(Array.isArray(t))return t.map(((t,n)=>e((0,a.default)(n,t,i.isWidlike,i.createWidFromWidLike))));if(t&&"object"==typeof t){const n=Object.keys(t);for(let r=0;r<n.length;r++){const o=n[r];t[o]=e((0,a.default)(o,t[o],i.isWidlike,i.createWidFromWidLike))}return t}return t};var i=n(745454),a=r(n(978144))},468708:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.VerifiedBusinessNameUpdateType=void 0,t.createOrUpdateVerifiedBusinessName=function(){return l.apply(this,arguments)},t.getAllVerifiedNames=function(){let e=Promise.resolve([]);e=(0,a.isLegacyWebdBackend)()?Promise.reject(new Error("getAllVerifiedNames: not supported without md backend")):(0,o.getTable)().all();return e},t.hasBusinessNameVerificationChanged=function(e,t,n){if((0,a.isLegacyWebdBackend)())return Promise.reject(new Error("hasBusinessNameVerificationChanged: not supported without md backend"));return(0,o.getTable)().get(e.user).then((e=>!e||e.serial!==n||e.level!==t))};var i=r(n(348926)),a=n(88555),o=n(785808);const s=n(76672).Mirrored(["Replace","Merge"]);function l(){return(l=(0,i.default)((function*(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Replace;if(!(0,a.isMDBackend)())throw new Error("createOrUpdateVerifiedBusinessName: not supported without md backend");{const n=(0,o.getTable)();t===s.Replace?yield n.createOrReplace(e):yield n.createOrMerge(e.id,e)}}))).apply(this,arguments)}t.VerifiedBusinessNameUpdateType=s},776214:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={initialize:!0};t.initialize=function(){if((0,i.isLegacyWebdBackend)())return Promise.resolve();return(0,a.initializeWithoutGKs)()};var i=n(88555),a=n(923356);Object.keys(a).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))}))},923356:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.clearInitializePromise=function(){ee=null},t.destroy=function(){return(0,X.destroyStorage)().catch((()=>i.default.resolve(new Z.default(X.DATABASE_NAME).delete()))).finally((()=>{ee=null}))},Object.defineProperty(t,"getABPropConfigsTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getActiveMessageRangesTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getAgentTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getBlocklistTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getCartTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getChatTable",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getCollectionVersionTable",{enumerable:!0,get:function(){return p.getTable}}),Object.defineProperty(t,"getContactTable",{enumerable:!0,get:function(){return f.getTable}}),Object.defineProperty(t,"getDeviceListTable",{enumerable:!0,get:function(){return _.getTable}}),Object.defineProperty(t,"getDirectConnectionKeysTable",{enumerable:!0,get:function(){return h.getTable}}),Object.defineProperty(t,"getEncryptedMutationsTable",{enumerable:!0,get:function(){return g.getTable}}),Object.defineProperty(t,"getFavoriteStickersTable",{enumerable:!0,get:function(){return m.getTable}}),Object.defineProperty(t,"getFtsIndexingQueueTable",{enumerable:!0,get:function(){return y.getTable}}),Object.defineProperty(t,"getGroupInviteV4Table",{enumerable:!0,get:function(){return S.getTable}}),Object.defineProperty(t,"getGroupMetadataTable",{enumerable:!0,get:function(){return E.getTable}}),Object.defineProperty(t,"getHistorySyncNotificationTable",{enumerable:!0,get:function(){return v.getTable}}),Object.defineProperty(t,"getInactiveReceiptTable",{enumerable:!0,get:function(){return T.getTable}}),Object.defineProperty(t,"getLabelAssociationTable",{enumerable:!0,get:function(){return A.getTable}}),Object.defineProperty(t,"getLabelTable",{enumerable:!0,get:function(){return C.getTable}}),Object.defineProperty(t,"getMessageOrphansTable",{enumerable:!0,get:function(){return I.getTable}}),Object.defineProperty(t,"getMessageTable",{enumerable:!0,get:function(){return O.getTable}}),Object.defineProperty(t,"getMissingKeysTable",{enumerable:!0,get:function(){return w.getTable}}),Object.defineProperty(t,"getMsgInfoTable",{enumerable:!0,get:function(){return M.getTable}}),Object.defineProperty(t,"getOrphanPaymentNotificationTable",{enumerable:!0,get:function(){return R.getTable}}),Object.defineProperty(t,"getOrphanReceiptTable",{enumerable:!0,get:function(){return N.getTable}}),Object.defineProperty(t,"getOrphanRevokeTable",{enumerable:!0,get:function(){return L.getTable}}),Object.defineProperty(t,"getOrphanTcTokenTable",{enumerable:!0,get:function(){return D.getTable}}),Object.defineProperty(t,"getParticipantTable",{enumerable:!0,get:function(){return k.getTable}}),Object.defineProperty(t,"getPeerMessageTable",{enumerable:!0,get:function(){return G.getTable}}),Object.defineProperty(t,"getPendingMutationsTable",{enumerable:!0,get:function(){return x.getTable}}),Object.defineProperty(t,"getPollVotesTable",{enumerable:!0,get:function(){return B.getTable}}),Object.defineProperty(t,"getPrivacyDisallowedListTable",{enumerable:!0,get:function(){return F.getTable}}),Object.defineProperty(t,"getProfilePicThumbTable",{enumerable:!0,get:function(){return j.getTable}}),Object.defineProperty(t,"getQuickReplyTable",{enumerable:!0,get:function(){return Y.getTable}}),Object.defineProperty(t,"getReactionsTable",{enumerable:!0,get:function(){return K.getTable}}),Object.defineProperty(t,"getRecentStickersTable",{enumerable:!0,get:function(){return W.getTable}}),Object.defineProperty(t,"getSyncActionsTable",{enumerable:!0,get:function(){return V.getTable}}),Object.defineProperty(t,"getSyncKeysTable",{enumerable:!0,get:function(){return $.getTable}}),Object.defineProperty(t,"getTasksScheduledTimeTable",{enumerable:!0,get:function(){return z.getTable}}),Object.defineProperty(t,"getVerifiedBusinessNameTable",{enumerable:!0,get:function(){return Q.getTable}}),t.initializeWithoutGKs=function(){null==ee&&((0,X.createStorage)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,u.addTable)(),(0,d.addTable)(),(0,p.addTable)(),(0,f.addTable)(),(0,_.addTable)(),(0,h.addTable)(),(0,g.addTable)(),(0,m.addTable)(),(0,y.addTable)(),(0,S.addTable)(),(0,E.addTable)(),(0,v.addTable)(),(0,T.addTable)(),(0,A.addTable)(),(0,C.addTable)(),(0,b.addTable)(),(0,P.addTable)(),(0,O.addTable)(),(0,w.addTable)(),(0,M.addTable)(),(0,R.addTable)(),(0,N.addTable)(),(0,L.addTable)(),(0,D.addTable)(),(0,k.addTable)(),(0,U.addTable)(),(0,G.addTable)(),(0,x.addTable)(),(0,B.addTable)(),(0,F.addTable)(),(0,j.addTable)(),(0,Y.addTable)(),(0,K.addTable)(),(0,W.addTable)(),(0,H.addTable)(),(0,V.addTable)(),(0,$.addTable)(),(0,z.addTable)(),(0,q.addTable)(),(0,J.addTable)(),(0,Q.addTable)(),(0,I.addTable)(),ee=(0,X.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize model storage"),e})));return ee};var i=r(n(74121)),a=n(532446),o=n(569702),s=n(311785),l=n(489426),c=n(344786),u=n(68638),d=n(891314),p=n(94771),f=n(4233),_=n(460996),h=n(568259),g=n(605198),m=n(851722),y=n(144936),S=n(935884),E=n(864632),v=n(115118),T=n(571720),C=n(694337),A=n(82663),b=n(463015),P=n(130086),O=n(290981),M=n(352489),I=n(800789),w=n(747274),R=n(845377),N=n(156161),L=n(88851),D=n(408433),k=n(396826),U=n(141803),G=n(398136),x=n(787125),B=n(604586),F=n(861319),j=n(996189),Y=n(73821),K=n(672821),W=n(729953),H=n(712901),V=n(134296),$=n(63776),z=n(333850),q=n(807528),J=n(818),Q=n(785808),X=n(799069),Z=r(n(986128));let ee},532446:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("abpropConfigs").version((0,s.abpropsConfigCreateTable)(),[new a.default("configCode"),new i.default("configValue"),new i.default("configExpoKey")]).version((0,s.addHasAccessedToAbpropsConfigTable)(),[new i.default("hasAccessed")]).view((e=>({configCode:e.configCode,configValue:e.configValue,configExpoKey:e.configExpoKey,hasAccessed:e.hasAccessed})))},t.getTable=function(){return(0,o.getStorage)().table("abpropConfigs")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},569702:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveRangeAction=void 0,t.addTable=function(){(0,s.getStorage)().add("active-message-ranges").version((0,l.activeMessageRangesCreateTable)(),[new o.default(["chatId","action"]),new a.default("chatId"),new i.default("actionValue"),new i.default("remainingMessages")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("active-message-ranges")};var i=r(n(743960)),a=r(n(998125)),o=r(n(750472)),s=n(799069),l=n(600406);const c=Object.freeze({Unknown:"unknown",Archive:"archive",MarkChatAsRead:"markChatAsRead",ClearChatKeepStarredKeepMedia:"clearChat_0_0",ClearChatKeepStarredDeleteMedia:"clearChat_0_1",ClearChatDeleteStarredKeepMedia:"clearChat_1_0",ClearChatDeleteStarredDeleteMedia:"clearChat_1_1",DeleteChatDeleteMedia:"deleteChat_1",DeleteChatKeepMedia:"deleteChat_0"});t.ActiveRangeAction=c},311785:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("agent").version((0,s.agentCreateTable)(),[new a.default("id"),new i.default("deviceId"),new i.default("name"),new i.default("isDeleted")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("agent")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},489426:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("blocklist").version((0,o.blocklistCreateTable)(),[new i.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,a.getStorage)().table("blocklist")};var i=r(n(680982)),a=n(799069),o=n(600406)},344786:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("cart").version((0,s.cartCreateTable)(),[new a.default("id"),new i.default("products"),new i.default("message"),new i.default("total"),new i.default("currency"),new i.default("itemCount")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("cart")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},891314:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,c.getStorage)().add(d).version((0,u.addChatThreadLoggingTable)(),[new l.default(["chatId","startTs"]),new s.default("chatId"),new s.default("startTs"),new o.default("msgsSent"),new o.default("msgsReceived"),new o.default("viewOnceMsgsSent"),new o.default("viewOnceMsgsReceived"),new o.default("viewOnceMessagesOpened"),new o.default("callOffersSent"),new o.default("callOffersReceived"),new o.default("totalCallDuration"),new o.default("commerceMsgsSent"),new o.default("commerceMsgsReceived"),new o.default("pdpInquiriesSent"),...[...a.COUNT_FIELD_NAMES,...i.FLAG_FIELD_NAMES].map((e=>new o.default(e)))]).view((e=>e))},t.getTable=function(){return(0,c.getStorage)().table(d)};var i=n(777495),a=n(329948),o=r(n(743960)),s=r(n(998125)),l=r(n(750472)),c=n(799069),u=n(600406);const d="chat-thread-logging-pending-events"},68638:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("chat").version((0,c.chatCreateTable)(),[new s.default("id"),new i.default("t"),new i.default("unreadCount"),new i.default("archive"),new i.default("isReadOnly"),new i.default("isAnnounceGrpRestrict"),new i.default("modifyTag"),new i.default("muteExpiration"),new i.default("name"),new i.default("notSpam"),new i.default("pin"),new i.default("changeNumberOldJid"),new i.default("changeNumberNewJid"),new i.default("ephemeralDuration"),new i.default("ephemeralSettingTimestamp"),new i.default("unreadMsgAnchorId"),new i.default("endOfHistoryTransferType"),new i.default("lastReactionPreview")]).version((0,c.chatAddDisappearingModeInitiator)(),[new i.default("disappearingModeInitiator")]).version((0,c.addUnreadMentionToChatTable)(),[new i.default("unreadMentionsOfMe")]).version((0,c.addUnreadMentionCountToChatTable)(),[new i.default("unreadMentionCount")]).version((0,c.addTcTokenToChatTable)(),[new a.AddEncryptedColumn("tcToken",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER)]).version((0,c.addTcTokenTimestampToChatTable)(),[new i.default("tcTokenTimestamp"),new o.default("tcTokenTimestamp")]).version((0,c.addArchiveAtMentionViewedInDrawer)(),[new i.default("archiveAtMentionViewedInDrawer")]).version((0,c.addTcTokenSenderTimestampToChatTable)(),[new i.default("tcTokenSenderTimestamp")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("chat")};var i=r(n(743960)),a=n(780723),o=r(n(998125)),s=r(n(680982)),l=n(799069),c=n(600406)},94771:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("collection-version").version((0,s.collectionVersionCreateTable)(),[new a.default("collection"),new i.default("version"),new i.default("state"),new i.default("finiteFailureStartTime"),new i.default("ltHash")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("collection-version")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},4233:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("contact").version((0,l.contactCreateTable)(),[new o.default("id"),new i.default("name"),new i.default("shortName"),new i.default("pushname"),new i.default("type"),new i.default("verifiedName"),new i.default("isBusiness"),new i.default("isEnterprise"),new i.default("verifiedLevel"),new i.default("statusMute"),new i.default("sectionHeader"),new i.default("isAddressBookContact"),new a.default("isAddressBookContact")]).version((0,l.contactAddIsContactSyncCompleted)(),[new i.default("isContactSyncCompleted"),new a.default("isContactSyncCompleted")]).version((0,l.contactAddDisappearingModeProperties)(),[new i.default("disappearingModeDuration"),new i.default("disappearingModeSettingTimestamp")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("contact")};var i=r(n(743960)),a=r(n(998125)),o=r(n(680982)),s=n(799069),l=n(600406)},460996:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("device-list").version((0,s.deviceListCreateTable)(),[new a.default("id"),new i.default("devices"),new i.default("nextVersion"),new i.default("rawId"),new i.default("timestamp"),new i.default("validIndexes"),new i.default("currentIndex")]).version((0,s.deviceListAddDelete)(),[new i.default("deleted")]).version((0,s.deviceListAddV2Fields)(),[new i.default("expectedTs"),new i.default("expectedTsLastDeviceJobTs"),new i.default("expectedTsUpdateTs")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("device-list")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},568259:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("direct-connection-keys").version((0,s.directConnectionKeysCreateTable)(),[new a.default("id"),new i.default("certificateChain"),new i.default("cypher"),new i.default("cypherExpirationTimestamp")]).version((0,s.directConnectionKeysAddPostcodeColumns)(),[new i.default("cypherType"),new i.default("postcode"),new i.default("postcodeSetByUser"),new i.default("postcodeLocationName")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("direct-connection-keys")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},605198:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("encrypted-mutations").version((0,s.encryptedMutationsCreateTable)(),[new a.default("id"),new i.default("collectionName"),new i.default("keyId"),new i.default("indexMac"),new i.default("operation"),new i.default("indexAndValueCipherText")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("encrypted-mutations")};var i=r(n(743960)),a=r(n(581019)),o=n(799069),s=n(600406)},851722:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("favorite-stickers").version((0,s.favoriteStickersCreateTable)(),[new a.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("stickerHashWithoutMeta")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("favorite-stickers")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},144936:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("fts-indexing-queue").version((0,o.ftsIndexingQueueCreateTable)(),[new i.default("id")]).view((e=>e))},t.getTable=function(){return(0,a.getStorage)().table("fts-indexing-queue")};var i=r(n(680982)),a=n(799069),o=n(600406)},935884:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("group-invite-v4").version((0,l.groupInviteV4CreateTable)(),[new o.default("id"),new i.default("from"),new i.default("to"),new i.default("groupId"),new i.default("expiration"),new i.default("expired"),new a.default(["from","to","groupId"])]).version((0,l.addGroupFromKeyToGroupInviteV4)(),[new a.default(["from","groupId"])]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("group-invite-v4")};var i=r(n(743960)),a=r(n(361309)),o=r(n(680982)),s=n(799069),l=n(600406)},864632:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("group-metadata").version((0,l.groupMetadataCreateTable)(),[new o.default("id"),new i.default("subject"),new i.default("subjectTime"),new i.default("creation"),new i.default("owner"),new i.default("desc"),new i.default("descId"),new i.default("descTime"),new i.default("descOwner"),new i.default("restrict"),new i.default("announce"),new i.default("a_v_id"),new i.default("noFrequentlyForwarded"),new i.default("ephemeralDuration"),new i.default("membershipApprovalMode"),new i.default("size"),new i.default("support"),new i.default("suspended"),new i.default("terminated"),new i.default("notAddedByContact"),new i.default("addedBy"),new i.default("parentGroup"),new i.default("subgroups"),new i.default("isParentGroup"),new i.default("defaultSubgroup"),new i.default("growthLockExpiration"),new i.default("growthLockType"),new i.default("lastActivityTimestamp"),new i.default("lastSeenActivityTimestamp")]).version((0,l.migrateSubgroupsArray)(),[new a.default("subgroups"),new i.default("unjoinedSubgroups")]).version((0,l.removeUnjoinedSubgroups)(),[new a.default("unjoinedSubgroups")]).version((0,l.removeSpamColumnsInGroupMetadata)(),[new a.default("notAddedByContact"),new a.default("addedBy")]).version((0,l.addCommunityAdminPromotionColumns)(),[new i.default("displayCadminPromotion")]).version((0,l.renameCommunityAdminPromotionColumns)(),[new a.default("displayCadminPromotion"),new i.default("acknowledgedCadminPromotion")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("group-metadata")};var i=r(n(743960)),a=r(n(449358)),o=r(n(680982)),s=n(799069),l=n(600406)},115118:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("history-sync-notification").version((0,c.historySyncNotificationsCreateTable)(),[new s.default("msgKey"),new i.default("downloadOptions"),new i.default("syncType"),new a.AddEncryptedColumn("chunkEncryptionKey",a.ENCRYPTED_VALUE_TYPE.STRING),new i.default("chunkOrder"),new i.default("processed"),new o.default("syncType"),new o.default("chunkOrder"),new o.default("processed"),new i.default("isReupload"),new i.default("historySyncStepStartedTs"),new i.default("historySyncPayloadSize"),new i.default("reuploadPending")]).version((0,c.encryptHistorySyncDirectPath)(),[new a.AddEncryptedColumn("directPath",a.ENCRYPTED_VALUE_TYPE.STRING)]).version((0,c.encryptHistorySyncFilehash)(),[new a.AddEncryptedColumn("filehash",a.ENCRYPTED_VALUE_TYPE.STRING),new a.AddEncryptedColumn("encFilehash",a.ENCRYPTED_VALUE_TYPE.STRING)]).view((e=>e)).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,l.getStorage)().table("history-sync-notification")};var i=r(n(743960)),a=n(780723),o=r(n(998125)),s=r(n(680982)),l=n(799069),c=n(600406)},571720:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("inactive-receipt").version((0,s.inactiveReceiptCreateTable)(),[new a.default("msgId"),new i.default("chatId"),new i.default("participantId")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("inactive-receipt")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},82663:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.LabelAssociationType=void 0,t.addTable=function(){(0,s.getStorage)().add("label-association").version((0,l.labelAssociationCreateTable)(),[new o.default(["labelId","associationId","type"]),new a.default("labelId"),new i.default(["associationId","type"])]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("label-association")};var i=r(n(361309)),a=r(n(998125)),o=r(n(750472)),s=n(799069),l=n(600406);const c=n(76672)({Jid:"jid",Message:"message"});t.LabelAssociationType=c},694337:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("label").version((0,s.labelCreateTable)(),[new a.default("id"),new i.default("name"),new i.default("colorIndex"),new i.default("predefinedId")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("label")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},463015:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("lid-display-name-mapping").version((0,s.lidDisplayNameMappingCreateTable)(),[new a.default("id"),new i.default("displayName")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("lid-display-name-mapping")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},130086:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("lid-pn-mapping").version((0,c.lidPnMappingCreateTable)(),[new s.default("id"),new i.default("phoneNumber"),new a.default("phoneNumber"),new i.default("createdAtTimestamp"),new i.default("displayName")]).version((0,c.lidPnMappingRemoveDisplayName)(),[new o.default("displayName")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("lid-pn-mapping")};var i=r(n(743960)),a=r(n(998125)),o=r(n(449358)),s=r(n(680982)),l=n(799069),c=n(600406)},352489:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("message-info").version((0,l.messageInfoCreateTable)(),[new o.default(["msgKey","receiverUserJid"]),new i.default("delivery"),new i.default("read"),new i.default("played"),new i.default("deviceDelivered"),new i.default("deviceNotDelivered"),new a.default("msgKey")]).version((0,l.messageInfoAddDeliveryPrivacyMode)(),[new i.default("deliveryPrivacyMode")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("message-info")};var i=r(n(743960)),a=r(n(998125)),o=r(n(750472)),s=n(799069),l=n(600406)},800789:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageAddOnsType=void 0,t.addTable=function(){(0,l.getStorage)().add("message-orphans").version((0,c.messageOrphansCreateTable)(),[new s.default("msgKey"),new i.default("parentMsgKey"),new a.default("parentMsgKey"),new i.default("sender"),new i.default("parsedMsgPayload"),new i.default("senderTimestampMs"),new a.default("senderTimestampMs")]).version((0,c.messageOrphansAddColumns)(),[new i.default("t"),new a.default("t"),new i.default("type"),new o.default("senderTimestampMs")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("message-orphans")};var i=r(n(743960)),a=r(n(998125)),o=r(n(16250)),s=r(n(680982)),l=n(799069),c=n(600406);const u=n(76672)({Reaction:"reaction",PollVote:"poll_vote",KeepInChat:"keep_in_chat",Unknown:"unknown"});t.MessageAddOnsType=u},290981:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,p.getStorage)().add("message").version((0,f.messageCreateTable)(),[new d.default("id"),new a.default("internalId"),new c.default("internalId"),new a.default("rowId"),new c.default("rowId"),new a.default("type"),new a.default("subtype"),new a.default("t"),new a.default("notifyName"),new a.default("from"),new a.default("to"),new a.default("author"),new a.default("self"),new a.default("ack"),new a.default("invis"),new a.default("isStarred"),new l.default("isStarred"),new a.default("mentionedJidList"),new a.default("count"),new a.default("devicesAdded"),new a.default("devicesRemoved"),new a.default("isThisDeviceAdded"),new a.default("recipients"),new a.default("protocolMessageKey"),new a.default("protocolMessageRowId"),new a.default("templateParams"),new o.default(["internalId","isStarred"]),new a.default("vcardWAids"),new i.default("vcardWAids"),new a.default("hasLink"),new a.default("isMediaMsg"),new a.default("isDocMsg"),new o.default(["internalId","isMediaMsg"]),new o.default(["internalId","isDocMsg"]),new o.default(["internalId","hasLink"]),new a.default("ephemeralStartTimestamp"),new a.default("ephemeralDuration"),new a.default("ephemeralSettingTimestamp"),new a.default("ephemeralOutOfSync"),new a.default("expiredTimestamp"),new l.default("expiredTimestamp"),new a.default("directPath"),new a.default("mimetype"),new a.default("duration"),new a.default("filehash"),new a.default("uploadhash"),new a.default("size"),new a.default("filename"),new a.default("streamingSidecar"),new a.default("mediaKey"),new a.default("mediaKeyTimestamp"),new a.default("pageCount"),new a.default("isGif"),new a.default("gifAttribution"),new a.default("isViewOnce"),new a.default("width"),new a.default("height"),new a.default("scanLengths"),new a.default("scansSidecar"),new a.default("interactiveAnnotations"),new a.default("firstFrameLength"),new a.default("firstFrameSidecar"),new a.default("isAnimated"),new a.default("thumbnail"),new a.default("richPreviewType"),new a.default("doNotPlayInline"),new a.default("broadcast"),new a.default("broadcastParticipants"),new a.default("broadcastId"),new a.default("quotedMsg"),new a.default("quotedStanzaID"),new a.default("quotedRemoteJid"),new a.default("quotedParticipant"),new a.default("footer"),new a.default("hydratedButtons"),new a.default("selectedId"),new a.default("selectedIndex"),new a.default("vcardFormattedName"),new a.default("isVcardOverMmsDocument"),new a.default("isCaptionByUser"),new a.default("businessOwnerJid"),new a.default("productId"),new a.default("currencyCode"),new a.default("priceAmount1000"),new a.default("retailerId"),new a.default("url"),new a.default("productImageCount"),new a.default("paymentCurrency"),new a.default("paymentMessageReceiverJid"),new a.default("paymentTransactionTimestamp"),new a.default("paymentStatus"),new a.default("paymentNoteMsg"),new a.default("paymentRequestMessageKey"),new a.default("paymentExpiryTimestamp"),new a.default("message"),new a.default("orderTitle"),new a.default("itemCount"),new a.default("orderId"),new a.default("surface"),new a.default("status"),new a.default("token"),new a.default("textColor"),new a.default("backgroundColor"),new a.default("font"),new a.default("isForwarded"),new a.default("forwardingScore"),new a.default("ctwaContext"),new a.default("mdDowngrade"),new a.default("messageRangeIndex"),new l.default("messageRangeIndex"),new a.default("vcardList"),new a.default("totalAmount1000"),new a.default("totalCurrencyCode"),new a.default("list"),new a.default("listResponse"),new a.default("isDynamicReplyButtonsMsg"),new a.default("dynamicReplyButtons"),new a.default("selectedButtonId"),new a.default("sellerJid"),new a.default("deprecatedMms3Url"),new a.default("encFilehash"),new s.AddEncryptedColumn("msgRowOpaqueData",s.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new a.default("thumbnailDirectPath"),new a.default("thumbnailSha256"),new a.default("thumbnailEncSha256"),new a.default("thumbnailHeight"),new a.default("thumbnailWidth"),new a.default("revokeSender"),new a.default("pendingReadReceipt"),new o.default(["from","pendingReadReceipt"]),new a.default("inviteGrpType"),new a.default("quotedGroupSubject"),new a.default("quotedParentGroupJid"),new a.default("reactionParentKey"),new a.default("reactionTimestamp"),new a.default("reactionText"),new a.default("lastPlaybackProgress"),new a.default("hasReaction"),new a.default("kicKey"),new a.default("kicState"),new a.default("kicTimestamp"),new a.default("kicNotified"),new a.default("agentId"),new a.default("revokeTimestamp")]).version((0,f.messageAddIsSendFailureProperties)(),[new a.default("isSendFailure")]).version((0,f.messageAddPaymentTxnStatus)(),[new a.default("paymentTxnStatus")]).version((0,f.messageAddProductListPreviewInfo)(),[new a.default("productListItemCount")]).version((0,f.messageAddPrivacyModeFields)(),[new a.default("privacyModeWhenSent"),new a.default("bizPrivacyStatus")]).version((0,f.messageAddProductListPreviewHeaderImage)(),[new a.default("productHeaderImageRejected")]).version((0,f.messageAddDisappearingModeInitiator)(),[new a.default("disappearingModeInitiator")]).version((0,f.messageAddGroupInviteV4)(),[new a.default("inviteGrp"),new a.default("inviteGrpName"),new a.default("comment"),new a.default("inviteCode"),new a.default("inviteCodeExp")]).version((0,f.addSupportForHSMButtons)(),[new a.default("isFromTemplate")]).version((0,f.messageAddPaymentRequestNFMFields)(),[new a.default("nativeFlowButtons"),new a.default("paymentRequestHeader")]).version((0,f.addWaveformToAudioMessages)(),[new a.default("waveform")]).version((0,f.messageRemovePaymentRequestHeaderField)(),[new u.default("paymentRequestHeader")]).version((0,f.messageAddNativeFlowNameField)(),[new a.default("nativeFlowName")]).version((0,f.addStaticURLToImageVideoMessages)(),[new a.default("staticUrl")]).version((0,f.addRequiresDirectConnection)(),[new a.default("requiresDirectConnection")]).version((0,f.messageAddPaymentInviteServiceType)(),[new a.default("paymentInviteServiceType")]).version((0,f.addStatusPSACampaignFields)(),[new a.default("campaignId"),new a.default("campaignDuration")]).version((0,f.messageAddPaymentBackground)(),[new a.default("paymentBackground")]).version((0,f.messageAddInteractiveMessageFields)(),[new a.default("interactiveHeader"),new a.default("interactiveType"),new a.default("interactivePayload")]).version((0,f.messageAddActionLink)(),[new a.default("actionLink")]).version((0,f.messageAddHeaderType)(),[new a.default("headerType")]).version((0,f.messageStatusPSAReadTimestamp)(),[new a.default("statusPSAReadTimestamp")]).view((e=>e)).enablePropFilter(!0).useDbMsgEncKeyForEncryptedCol(!0)},t.getTable=function(){return(0,p.getStorage)().table("message")};var i=r(n(788389)),a=r(n(743960)),o=r(n(361309)),s=n(780723),l=r(n(998125)),c=r(n(512040)),u=r(n(449358)),d=r(n(680982)),p=(n(837626),n(799069)),f=n(600406)},747274:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("missing-keys").version((0,s.missingKeysCreateTable)(),[new a.default("keyHex"),new i.default("keyId"),new i.default("timestamp"),new i.default("deviceResponses")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("missing-keys")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},845377:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("orphan-payment-notification").version((0,s.orphanPaymentNotificationCreateTable)(),[new a.default("msgKey"),new i.default("receiver"),new i.default("currency"),new i.default("amount1000"),new i.default("type"),new i.default("status"),new i.default("ts")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("orphan-payment-notification")};var i=r(n(743960)),a=r(n(680982)),o=(n(552586),n(799069)),s=n(600406)},156161:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("orphan-receipt").version((0,s.orphanReceiptCreateTable)(),[new a.default("msgKey"),new i.default("delivery"),new i.default("read"),new i.default("played")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("orphan-receipt")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},88851:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("orphan-revoke").version((0,s.orphanRevokeCreateTable)(),[new a.default("msgKey"),new i.default("sender"),new i.default("timestamp"),new i.default("subtype")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("orphan-revoke")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},408433:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("orphan-tc-token").version((0,l.orphanTcTokenCreateTable)(),[new o.default("chatId"),new a.AddEncryptedColumn("tcToken",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new i.default("tcTokenTimestamp"),new i.default("tcTokenSenderTimestamp")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("orphan-tc-token")};var i=r(n(743960)),a=n(780723),o=r(n(680982)),s=n(799069),l=n(600406)},396826:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("participant").version((0,l.participantCreateTable)(),[new o.default("groupId"),new a.default("senderKey"),new a.default("participants"),new a.default("pastParticipants"),new a.default("admins"),new a.default("rotateKey"),new a.default("version"),new i.default("participants"),new a.default("deviceSyncComplete"),new a.default("staleType")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("participant")};var i=r(n(788389)),a=r(n(743960)),o=r(n(680982)),s=n(799069),l=n(600406)},141803:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("payment-backgrounds").version((0,s.paymentBackgroundsCreateTable)(),[new a.default("id"),new i.default("imageBuffer")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("payment-backgrounds")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},398136:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("peer-message").version((0,s.peerMessageCreateTable)(),[new a.default("id"),new i.default("to"),new i.default("type"),new i.default("subtype"),new i.default("appStateSyncKeyShare"),new i.default("appStateSyncKeyRequest"),new i.default("appStateFatalExceptionNotification")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("peer-message")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},787125:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("pending-mutations").version((0,l.pendingMutationsCreateTable)(),[new o.default("id"),new i.default("collection"),new i.default("index"),new a.default("index"),new i.default("timestamp"),new a.default("collection"),new i.default("version"),new i.default("operation"),new i.default("binarySyncAction")]).version((0,l.addActionToPendingMutations)(),[new i.default("action"),new a.default("action")]).view((e=>e))},t.convertToPendingMutationFromRow=function(e){const{id:t,collection:n,index:r,binarySyncAction:i,version:a,operation:o,timestamp:s,action:l}=e;return{id:t,collection:n,index:r,binarySyncAction:i,version:a,operation:o,timestamp:s,action:l}},t.getTable=function(){return(0,s.getStorage)().table("pending-mutations")};var i=r(n(743960)),a=r(n(998125)),o=r(n(581019)),s=n(799069),l=n(600406)},604586:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("poll-votes").version((0,c.pollVotesCreateTable)(),[new s.default(["parentMsgKey","sender"]),new i.default("msgKey"),new o.default("parentMsgKey"),new a.AddEncryptedColumn("selectedOptionLocalIds",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new i.default("senderTimestampMs")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("poll-votes")};var i=r(n(743960)),a=n(780723),o=r(n(998125)),s=r(n(750472)),l=n(799069),c=n(600406)},861319:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.PrivacyDisallowedListType=void 0,t.addTable=function(){(0,o.getStorage)().add("privacy-disallowed-list").version((0,s.privacyDisallowedListCreateTable)(),[new a.default("id"),new i.default("disallowedList")]).version((0,s.privacyDisallowedListAddDhashField)(),[new i.default("dhash")]).view((e=>({id:e.id,disallowedList:e.disallowedList,dhash:e.dhash})))},t.getTable=function(){return(0,o.getStorage)().table("privacy-disallowed-list")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406);const l=n(76672)({About:"status",GroupAdd:"groupadd",LastSeen:"last",ProfilePicture:"profile"});t.PrivacyDisallowedListType=l},996189:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("profile-pic-thumb").version((0,s.profilePicThumbCreateTable)(),[new a.default("id"),new i.default("tag"),new i.default("raw"),new i.default("eurl"),new i.default("previewEurl")]).view((e=>({id:e.id,tag:e.tag,raw:e.raw,eurl:e.eurl,previewEurl:e.previewEurl})))},t.getTable=function(){return(0,o.getStorage)().table("profile-pic-thumb")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},73821:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("quick-reply").version((0,s.quickReplyCreateTable)(),[new a.default("id"),new i.default("shortcut"),new i.default("message"),new i.default("count"),new i.default("keywords")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("quick-reply")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},672821:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("reactions").version((0,c.reactionsCreateTable)(),[new s.default(["parentMsgKey","senderUserJid"]),new i.default("msgKey"),new i.default("reactionText"),new i.default("timestamp"),new i.default("orphan"),new i.default("orphanReason"),new i.default("read"),new i.default("ack"),new i.default("isSendFailure"),new o.default("parentMsgKey"),new o.default("orphan")]).version((0,c.addReactionTableOrphanIndex)(),[new a.default(["parentMsgKey","orphan"])]).version((0,c.addReactionTableMsgKeyIndex)(),[new o.default("msgKey")]).view((e=>e))},t.getTable=function(){return(0,l.getStorage)().table("reactions")};var i=r(n(743960)),a=r(n(361309)),o=r(n(998125)),s=r(n(750472)),l=(n(926704),n(799069)),c=n(600406)},729953:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("recent-stickers").version((0,s.recentStickersCreateTable)(),[new a.default("id"),new i.default("timestamp"),new i.default("sticker"),new i.default("msgId"),new i.default("weight")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("recent-stickers")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},712901:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("subscription").version((0,s.subscriptionCreateTable)(),[new a.default("id"),new i.default("isDeactivated"),new i.default("isAutoRenewing"),new i.default("expirationDate")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("subscription")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},134296:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,c.getStorage)().add("sync-actions").version((0,u.syncActionsCreateTable)(),[new l.default("index"),new a.default("keyId"),new a.default("version"),new a.default("actionState"),new s.default("actionState"),new a.default("modelId"),new a.default("modelType"),new o.default(["modelId","modelType","actionState"]),new a.default("valueMac"),new a.default("indexMac"),new s.default("indexMac"),new a.default("collection"),new s.default("collection"),new a.default("timestamp"),new a.default("action"),new s.default("action"),new a.default("binarySyncAction"),new a.default("binarySyncData")]).view(d)},t.convertFromSyncActionToRow=function(e){return e},t.convertToSyncActionFromRow=function(e){return e},t.convertToSyncActionsRowFromInternal=d,t.getTable=function(){return(0,c.getStorage)().table("sync-actions")};var i=n(408708),a=r(n(743960)),o=r(n(361309)),s=r(n(998125)),l=r(n(680982)),c=n(799069),u=n(600406);function d(e){const{index:t,binarySyncAction:n,actionState:r,version:a,keyId:o,modelId:s,modelType:l,indexMac:c,valueMac:u,collection:d,timestamp:p,action:f}=e;let{binarySyncData:_}=e;if(null==_){if(null==n)throw __LOG__(4,void 0,new Error,!0,["syncd"])`syncd: binarySyncAction should not be null when binarySyncData is null`,SEND_LOGS("syncd: syncd binarySyncAction should not be null when binarySyncData is null"),new Error("syncd: binarySyncAction should not be null when binarySyncData is null");_=(0,i.syncActionToSyncData)(n)}return{index:t,binarySyncData:_,actionState:r,version:a,keyId:o,modelId:s,modelType:l,indexMac:c,valueMac:u,collection:d,timestamp:p,action:f}}},63776:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,l.getStorage)().add("sync-keys").version((0,c.syncKeysCreateTable)(),[new s.default("keyId"),new i.default("timestamp"),new i.default("fingerprint"),new a.AddEncryptedColumn("keyData",a.ENCRYPTED_VALUE_TYPE.ARRAY_BUFFER),new i.default("keyEpoch"),new o.default("keyEpoch")]).view((e=>e))},t.convertToSyncKeyFromRow=function(e){const{keyId:t,keyData:n,keyEpoch:r,timestamp:i,fingerprint:a}=e;return{keyId:t.buffer,keyData:n,keyEpoch:r,timestamp:i,fingerprint:a}},t.getTable=function(){return(0,l.getStorage)().table("sync-keys")};var i=r(n(743960)),a=n(780723),o=r(n(998125)),s=r(n(680982)),l=n(799069),c=n(600406)},333850:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("tasks-scheduled-time").version((0,s.tasksScheduledTimeCreateTable)(),[new a.default("taskName"),new i.default("time")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("tasks-scheduled-time")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},926704:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OrphanReactionsReasonType=void 0;const r=n(76672).Mirrored(["ParentMsgPlaceholder","ParentMsgMissing"]);t.OrphanReactionsReasonType=r},807528:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("unjoined-subgroup-metadata").version((0,l.unjoinedSubgroupMetadataCreateTable)(),[new o.default("id"),new i.default("subject"),new i.default("subjectTime"),new i.default("defaultSubgroup"),new i.default("parentGroup")]).version((0,l.unjoinedSubgroupParentGroupIndex)(),[new a.default("parentGroup")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("unjoined-subgroup-metadata")};var i=r(n(743960)),a=r(n(998125)),o=r(n(680982)),s=n(799069),l=n(600406)},818:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("user-prefs").version((0,s.userPrefsCreateTable)(),[new a.default("key"),new i.default("value")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("user-prefs")};var i=r(n(743960)),a=r(n(680982)),o=n(799069),s=n(600406)},785808:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("verified-business-name").version((0,l.verifiedBusinessNameCreateTable)(),[new o.default("id"),new i.default("serial"),new i.default("name"),new i.default("isApi"),new i.default("level"),new i.default("actualActors"),new i.default("hostStorage"),new i.default("privacyModeTs")]).version((0,l.verifiedBusinessNameAddPrivacyMode)(),[new i.default("privacyMode"),new a.default("actualActors"),new a.default("hostStorage"),new a.default("privacyModeTs")]).view((e=>e))},t.getTable=function(){return(0,s.getStorage)().table("verified-business-name")};var i=r(n(743960)),a=r(n(449358)),o=r(n(680982)),s=n(799069),l=n(600406)},799069:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new i.default(c);u=new a.Storage(e),u.addErrorHandler(s.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&o.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==u)return Promise.reject(new Error("[model-storage] Storage should be created first before being destroyed"));return u.purge().then((()=>{u=null})).catch((e=>{throw u=null,e}))},t.getStorage=function(){return(0,l.default)(null!=u,"[model-storage] Storage should be created first before being accessed"),u};var i=r(n(15378)),a=n(94899),o=n(123918),s=r(n(986128)),l=r(n(441143));const c="model-storage";t.DATABASE_NAME=c;let u=null},325397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createDeviceListPK=function(e){switch(e.server){case"lid":return`${e.user}@lid`;case"c.us":return e.user}throw new Error(`Jid ${e.toString({legacy:!0})} is not fully qualified to create a device list pk, jid.server should be "c.us" or "lid"`)}},736163:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.restoreAgents=function(){return Te.apply(this,arguments)},t.restoreArchiveV2Settings=function(){if((0,m.archiveV2Supported)()){const e=(0,T.getArchiveV2EnabledSetting)(),t=(0,T.getUnarchiveChatsSetting)();null!=e&&(Y.default.archive=(0,a.default)((0,a.default)({},Y.default.archive),{},{enabled:e})),null!=t&&(Y.default.archive=(0,a.default)((0,a.default)({},Y.default.archive),{},{classic:t}))}},t.restoreBlocklist=function(){return(0,q.getTable)().all().then((e=>{N.BlocklistCollection.initializeFromCache(e.map(V.hydrateWids))}))},t.restoreCarts=function(){return(0,J.getTable)().all().then((e=>{I.CartCollection.initializeFromCache(e.map(V.hydrateWids))}))},t.restoreChatsAndMessages=function(){return ye.apply(this,arguments)},t.restoreFavoriteStickers=function(){if((0,u.isMDBackend)()&&(0,c.getABPropConfigValue)("sticker_md_favorite_stickers_enabled"))return(0,Z.getTable)().all().then((e=>K.default.initializeFromCache(e)));return Promise.resolve()},t.restoreGroupsContactsAndProfilePics=function(){return(0,$.initializeWithoutGKs)().then((()=>{performance.now();const e=(0,X.getTable)().all().then((e=>{U.ContactCollection.checksum=(0,v.getContactChecksum)()||"",U.ContactCollection.add(e.map(V.hydrateWids),{silent:!0,merge:!0})})),t=(0,ee.getTable)().all().then((e=>{G.default.add(e.map(V.hydrateWids)),e.forEach((e=>{const t=(0,C.createWidFromWidLike)(e.id);!0===e.isParentGroup&&L.ChatCollection.gadd({id:t,isReadOnly:!1}),(0,A.updateSubject)(t,e.subject)}))})),n=(0,c.getABPropConfigValue)("web_profile_picture_db_cache_disabled")?Promise.resolve():(0,ae.getTable)().all().then((e=>{F.ProfilePicThumbCollection.add(e.map(V.hydrateWids),{silent:!0})}));return Promise.all([e,t,n])})).then((()=>{}))},t.restoreImportantMetaData=function(){__LOG__(2)`[InitFromStorage] will attempt to initialize metadata from storage`,k.Conn.trigger("me_ready");const e=(0,E.getPushname)(),t=(0,E.getLastMobilePlatform)();if(null==t)throw new Error("platform not found in UserPrefs.");k.Conn.pushname=e,k.Conn.platform=t,__LOG__(2)`[InitFromStorage] important metadata loaded`},t.restoreLabelAssociations=function(){if((0,m.canDisplayLabel)())return(0,ne.getTable)().all().then((e=>{w.LabelCollection.initializeAssociationsFromCache(e)}));return Promise.resolve()},t.restoreLabels=function(){if((0,m.canDisplayLabel)())return(0,te.getTable)().all().then((e=>{w.LabelCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreQuickReplies=function(){if((0,m.canSendQuickReply)())return(0,oe.getTable)().all().then((e=>{R.QuickReplyCollection.initializeFromCache(e)}));return Promise.resolve()},t.restoreRecentStickers=function(){if((0,u.isMDBackend)()&&j.ServerProps.webServerStickerPanel)return(0,se.getTable)().all().then((e=>W.RecentStickerCollectionMd.initializeFromCache(e)));return Promise.resolve()},t.restoreSubscriptions=function(){return Ce.apply(this,arguments)},t.updateGKFeatures=function(){(0,u.isMDBackend)()&&((0,v.setGKProto)(g.LegacyPhoneFeatures.proto),(0,v.setGKFeatures)(g.LegacyPhoneFeatures.features))};var i=r(n(348926)),a=r(n(81109)),o=n(524674),s=n(927870),l=n(892844),c=n(257243),u=n(88555),d=n(624256),p=n(536051),f=n(861948),_=n(104622),h=r(n(355184)),g=n(438184),m=n(408139),y=r(n(465212)),S=n(879274),E=n(555452),v=n(233776),T=n(711597),C=n(745454),A=n(810790),b=n(797480),P=n(672894),O=n(503027),M=n(393170),I=n(612392),w=n(316770),R=n(999662),N=n(132826),L=n(669951),D=n(951612),k=n(317239),U=n(719380),G=r(n(963928)),x=r(n(245077)),B=n(559871),F=n(582039),j=n(964551),Y=r(n(268132)),K=r(n(870723)),W=n(249264),H=n(312896),V=n(464448),$=n(923356),z=n(311785),q=n(489426),J=n(344786),Q=n(68638),X=n(4233),Z=n(851722),ee=n(864632),te=n(694337),ne=n(82663),re=n(290981),ie=n(396826),ae=n(996189),oe=n(73821),se=n(729953),le=n(712901),ce=n(785808),ue=n(546983),de=n(529805);n(979038);function pe(e){return null!=e.t&&(0,l.happenedWithin)((0,l.castToUnixTime)(e.t),l.DAY_SECONDS)||null!=e.pin&&e.pin>0}function fe(e){return Promise.all(e.map((e=>{const t=pe(e);return(0,H.getKeyMsgsFromChatHistory)(e,t).then((n=>{let{anchor:r,previewMsg:i,lastReceivedKey:o}=n;return{chat:(0,a.default)((0,a.default)({},e),{},{unreadMsgAnchorId:t?r:void 0}),previewMsg:i,lastReceivedKey:o}}))})))}function _e(e){const{tasks:t,lastMessageKeys:n}=function(e){const t=[],n=[];return e.forEach((e=>{let{chat:r,previewMsg:i,lastReceivedKey:o}=e;pe(r)||i&&i.id!==o?(performance.now(),t.push(function(e,t){if(pe(e)){if(e.unreadCount>=20)return he(e,t).then((()=>function(e){if(!e.unreadMsgAnchorId)return __LOG__(3)`unreadMsgAnchorId is not defined`,Promise.resolve();return(0,re.getTable)().equals(["id"],e.unreadMsgAnchorId).then((t=>{if(0===t.length)return void __LOG__(3)`Unread anchor message does not exist in message table`;const n=(0,f.getInChatMsgId)(t[0].internalId||""),r=Math.max(0,n-5);let i;if((0,m.receiveReactionsEnabled)()){const t=function(e,t){const n=(0,f.beginningOfChat)((0,C.createWid)(e.id)),r=(0,f.craftInternalId)(e.id,t);return(0,H.queryChatVisibleMessageHelper)(n,r,(0,a.default)((0,a.default)({},{lowerInclusive:!0,upperInclusive:!1}),{},{reverse:!0}),5).then((e=>e.reverse()))}(e,n),r=function(e,t){return(0,H.queryChatVisibleMessageHelper)((0,f.craftInternalId)(e.id,t),(0,f.endOfChat)((0,C.createWid)(e.id)),{lowerInclusive:!0,upperInclusive:!1},5)}(e,n);i=Promise.all([t,r]).then((e=>{let[t,n]=e;return[...t,...n]}))}else i=(0,H.queryChatMessageHelper)((0,f.craftInternalId)(e.id,r),(0,f.craftInternalId)(e.id,n+5),{lowerInclusive:!0,upperInclusive:!1});return i.then((t=>{if(t.length-5<0)return;const n=t[t.length-5].id,r=t.map((e=>{const t=(0,p.messageFromDbRow)(e);return t.invis=!0,t}));return B.MsgCollection.processMultipleMessages((0,C.createWidFromWidLike)(e.id),r,{pendingMsgsDone:!0,resume:!1,add:"unread",isHistory:!0,firstUnreadKey:y.default.fromString(n)},new D.ChatMsgsCollection)})).then()}))}(e)));if(0===e.unreadCount)return he(e,t);let n;if(__LOG__(2)`restoreMessagesForChat: restoring last ${e.unreadCount+5} messages.`,(0,m.receiveReactionsEnabled)()){const r=[];t&&(0,H.isReactionFutureproof)(t)&&r.push(t.id.toString()),n=(0,H.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},e.unreadCount+5,r)}else if((0,de.isKeepInChatReadEnabled)()){const r=[];t&&(0,H.isKeepInChatFutureproof)(t)&&r.push(t.id.toString()),n=(0,H.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},e.unreadCount+5,[],r)}else n=(0,H.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:e.unreadCount+5});return n.then((t=>B.MsgCollection.processMultipleMessages((0,C.createWidFromWidLike)(e.id),t.map(p.messageFromDbRow).reverse(),{pendingMsgsDone:!0,resume:!1,add:"last",isHistory:!0}))).then()}return he(e,t)}(r,i).then((()=>{if(r.unreadMsgAnchorId){const e=y.default.fromString(r.unreadMsgAnchorId),t=B.MsgCollection.get(e);if(!t)return void __LOG__(3)`Unread anchor message is not in message collection.`;const n=L.ChatCollection.get((0,C.createWidFromWidLike)(r.id));n&&(n.unreadMsgAnchor=t)}})))):n.push(String(o))})),{tasks:t,lastMessageKeys:n}}(e);return t.push(function(e){return performance.now(),(0,re.getTable)().bulkGet(e).then(function(){var e=(0,i.default)((function*(e){yield Promise.all(e.map((e=>{if(!e)return Promise.resolve();const t=(0,p.messageFromDbRow)(e);return t.invis=!0,B.MsgCollection.processMultipleMessages(t.id.remote,[t],{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})})))}));return function(){return e.apply(this,arguments)}}()).catch((e=>{throw __LOG__(4,void 0,new Error)`loadLastMessagesFromDB: failed with error: ${e}`,e}))}(n)),Promise.all(t)}function he(){return ge.apply(this,arguments)}function ge(){return(ge=(0,i.default)((function*(e,t){let n;const r=[],i=[];if(null!=t&&null!=t.internalId){const a=t.internalId;(0,m.receiveReactionsEnabled)()?(t&&(0,H.isReactionFutureproof)(t)&&r.push(t.id.toString()),t&&(0,H.isKeepInChatFutureproof)(t)&&i.push(t.id.toString()),n=yield(0,H.queryChatVisibleMessageHelper)(a,`${e.id}_g`,{lowerInclusive:!0},void 0,r,i)):n=yield(0,H.queryChatMessageHelper)(a,`${e.id}_g`,{lowerInclusive:!0})}else{const t=1;n=(0,m.receiveReactionsEnabled)()?yield(0,H.queryChatVisibleMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0},t):yield(0,H.queryChatMessageHelper)(`${e.id}_/`,`${e.id}_g`,{reverse:!0,limit:t})}__LOG__(2)`processPreviewMessageInChat: restoring ${n.length} message.`,B.MsgCollection.processMultipleMessages((0,C.createWidFromWidLike)(e.id),n.map((e=>{const t=(0,p.messageFromDbRow)(e);return t.invis=!0,t})),{pendingMsgsDone:!1,resume:!1,add:"last",isHistory:!0})}))).apply(this,arguments)}function me(e){switch(e){case"unknown":return M.VERIFIED_LEVEL.UNKNOWN;case"low":return M.VERIFIED_LEVEL.LOW;case"high":return M.VERIFIED_LEVEL.HIGH;default:return M.VERIFIED_LEVEL.UNKNOWN}}function ye(){return(ye=(0,i.default)((function*(){return yield d.DbEncKeyStore.waitForFinalDbMsgEncKey(),(0,$.initializeWithoutGKs)().then(ue.updatePeerReceipts).then((0,i.default)((function*(){const e=yield(0,Q.getTable)().all();(0,u.isMDBackend)()&&b.OfflineResumeReporter.logOfflineChatThreadCount(e.length),e.sort(((e,t)=>{var n,r;return-((null!==(n=e.t)&&void 0!==n?n:0)-(null!==(r=t.t)&&void 0!==r?r:0))})),L.ChatCollection.add(e.map((e=>{var t;return(0,V.hydrateWids)((0,a.default)((0,a.default)({},e),{},{pendingInitialLoading:!0,isReadOnly:null!==(t=e.isReadOnly)&&void 0!==t&&t}))})),{merge:!0});const t=(0,c.getABPropConfigValue)("web_init_chat_batch_size")||100;return yield Se(e,t)}))).then(Ee).catch((e=>{throw __LOG__(4,void 0,new Error)`restoreChatsAndMessages: failed with error: ${e}`,e}))}))).apply(this,arguments)}function Se(e,t){let n=Promise.resolve();const r=new s.PromiseQueue;for(let a=0;a<e.length;a+=t){const s=e.slice(a,a+t),l=function(){var e=(0,i.default)((function*(){performance.now();const e=yield fe(s);yield _e(e);const t=[];e.forEach((e=>{let{chat:n}=e;const r=L.ChatCollection.get(n.id);r&&(r.set({pendingInitialLoading:!1}),r.isGroup&&t.push(n.id))})),Ae(t)}));return function(){return e.apply(this,arguments)}}();0===a?n=r.enqueue((()=>new S.NonPersistJob("initialChatLoad",l,{priority:o.JOB_PRIORITY.SKIP}).waitUntilCompleted())):r.enqueue((0,i.default)((function*(){return yield(0,h.default)(),new S.NonPersistJob("initialChatLoad",l).waitUntilCompleted()})))}return n}function Ee(){return ve.apply(this,arguments)}function ve(){return(ve=(0,i.default)((function*(){(yield(0,ce.getTable)().all()).forEach((e=>{let t;try{t=(0,C.createUserWid)(e.id)}catch(e){return __LOG__(4,void 0,new Error,!0)`restore-business-info: invalid wid`,void SEND_LOGS("restore-business-info: invalid wid")}const n=L.ChatCollection.get(t);if(n){const t={isBusiness:!0,isEnterprise:e.isApi,verifiedName:e.name,verifiedLevel:me(e.level||"unknown"),privacyMode:e.privacyMode};n.contact.set(t),"high"===e.level&&e.name&&!n.contact.name&&n.contact.set({name:e.name})}}))}))).apply(this,arguments)}function Te(){return(Te=(0,i.default)((function*(){if((0,m.isMultiDeviceAgentsEnabled)()){const e=yield(0,z.getTable)().all();P.AgentCollection.initializeFromCache(e)}}))).apply(this,arguments)}function Ce(){return(Ce=(0,i.default)((function*(){const e=yield(0,le.getTable)().all();O.SubscriptionCollection.initializeFromCache(e)}))).apply(this,arguments)}function Ae(){return be.apply(this,arguments)}function be(){return(be=(0,i.default)((function*(e){const t=new Map;e.forEach((e=>{const n=G.default.get(e);!n||n.participantQueryPromise||n.participants.length>0?__LOG__(2)`[init-from-storage]: restoreGroupParticipantsForChats: skip for chat - ${e}`:n.participantQueryPromise=new Promise((n=>{t.set(e,n)}))}));const n=Array.from(t.keys());try{(yield(0,ie.getTable)().bulkGet(n)).forEach(function(){var e=(0,i.default)((function*(e,r){var i;const a=G.default.get(n[r]),o=!!(null===(i=L.ChatCollection.get(n[r]))||void 0===i?void 0:i.isReadOnly);if(a)try{let i=[],c=[];if(null==e||null!=e.deviceSyncComplete&&!e.deviceSyncComplete||e.staleType===_.STALE_TYPES.PARTICIPANT)if(o)__LOG__(2)`[init-from-storage]: restoreGroupParticipantsForChats: skip sync stale participant for read only chat ${n[r]}`;else{var s;__LOG__(2)`[init-from-storage]: restoreGroupParticipantsForChats: sync stale participant for ${n[r]}`;const e=yield(0,A.sendQueryGroup)((0,C.createWid)(n[r]));i=(null!==(s=null==e?void 0:e.participants)&&void 0!==s?s:[]).map((e=>new x.default(e)))}else{const t=new Set(e.admins);i=e.participants.map((e=>new x.default({id:(0,C.createUserWid)(e),isAdmin:t.has(e),isSuperAdmin:!1})))}var l;if(null==e)c=[];else c=null===(l=e.pastParticipants)||void 0===l?void 0:l.map((e=>{let{jid:t,leaveTs:n,leaveReason:r}=e;return new x.default({id:(0,C.createWid)(t),leaveTs:n,leaveReason:r})}));a.participants.add(i,{merge:!0}),a.pastParticipants.add(c,{merge:!0}),a.stale=!1,a.deviceStale=(null==e?void 0:e.staleType)===_.STALE_TYPES.DEVICE}finally{const e=t.get(n[r]);null==e||e(),a.participantQueryPromise=null}}));return function(){return e.apply(this,arguments)}}())}catch(e){return void n.forEach((e=>{const n=t.get(e);null==n||n();const r=G.default.get(e);r&&(r.participantQueryPromise=null)}))}}))).apply(this,arguments)}},600406:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.abpropsConfigCreateTable=function(){return(0,r.getStorage)().versions.version(19)},t.activeMessageRangesCreateTable=function(){return(0,r.getStorage)().versions.version(23)},t.addActionToPendingMutations=function(){return(0,r.getStorage)().versions.version(48)},t.addArchiveAtMentionViewedInDrawer=function(){return(0,r.getStorage)().versions.version(61)},t.addChatThreadLoggingTable=function(){return(0,r.getStorage)().versions.version(78)},t.addCommunityAdminPromotionColumns=function(){return(0,r.getStorage)().versions.version(88)},t.addGroupFromKeyToGroupInviteV4=function(){return(0,r.getStorage)().versions.version(55)},t.addHasAccessedToAbpropsConfigTable=function(){return(0,r.getStorage)().versions.version(77)},t.addReactionTableMsgKeyIndex=function(){return(0,r.getStorage)().versions.version(75)},t.addReactionTableOrphanIndex=function(){return(0,r.getStorage)().versions.version(71)},t.addRequiresDirectConnection=function(){return(0,r.getStorage)().versions.version(63)},t.addStaticURLToImageVideoMessages=function(){return(0,r.getStorage)().versions.version(60)},t.addStatusPSACampaignFields=function(){return(0,r.getStorage)().versions.version(65)},t.addSupportForHSMButtons=function(){return(0,r.getStorage)().versions.version(46)},t.addTcTokenSenderTimestampToChatTable=function(){return(0,r.getStorage)().versions.version(62)},t.addTcTokenTimestampToChatTable=function(){return(0,r.getStorage)().versions.version(57)},t.addTcTokenToChatTable=function(){return(0,r.getStorage)().versions.version(56)},t.addUnreadMentionCountToChatTable=function(){return(0,r.getStorage)().versions.version(51)},t.addUnreadMentionToChatTable=function(){return(0,r.getStorage)().versions.version(44)},t.addWaveformToAudioMessages=function(){return(0,r.getStorage)().versions.version(50)},t.agentCreateTable=function(){return(0,r.getStorage)().versions.version(82)},t.blocklistCreateTable=function(){return(0,r.getStorage)().versions.version(4)},t.cartCreateTable=function(){return(0,r.getStorage)().versions.version(25)},t.chatAddDisappearingModeInitiator=function(){return(0,r.getStorage)().versions.version(36)},t.chatCreateTable=function(){return(0,r.getStorage)().versions.version(6)},t.collectionVersionCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.contactAddDisappearingModeProperties=function(){return(0,r.getStorage)().versions.version(35)},t.contactAddIsContactSyncCompleted=function(){return(0,r.getStorage)().versions.version(28)},t.contactCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.deviceListAddDelete=function(){return(0,r.getStorage)().versions.version(41)},t.deviceListAddV2Fields=function(){return(0,r.getStorage)().versions.version(59)},t.deviceListCreateTable=function(){return(0,r.getStorage)().versions.version(11)},t.directConnectionKeysAddPostcodeColumns=function(){return(0,r.getStorage)().versions.version(84)},t.directConnectionKeysCreateTable=function(){return(0,r.getStorage)().versions.version(70)},t.encryptHistorySyncDirectPath=function(){return(0,r.getStorage)().versions.version(42)},t.encryptHistorySyncFilehash=function(){return(0,r.getStorage)().versions.version(45)},t.encryptedMutationsCreateTable=function(){return(0,r.getStorage)().versions.version(15)},t.favoriteStickersCreateTable=function(){return(0,r.getStorage)().versions.version(73)},t.ftsIndexingQueueCreateTable=function(){return(0,r.getStorage)().versions.version(24)},t.groupInviteV4CreateTable=function(){return(0,r.getStorage)().versions.version(39)},t.groupMetadataCreateTable=function(){return(0,r.getStorage)().versions.version(20)},t.historySyncNotificationsCreateTable=function(){return(0,r.getStorage)().versions.version(14)},t.inactiveReceiptCreateTable=function(){return(0,r.getStorage)().versions.version(12)},t.labelAssociationCreateTable=function(){return(0,r.getStorage)().versions.version(17)},t.labelCreateTable=function(){return(0,r.getStorage)().versions.version(16)},t.lidDisplayNameMappingCreateTable=function(){return(0,r.getStorage)().versions.version(94)},t.lidPnMappingCreateTable=function(){return(0,r.getStorage)().versions.version(90)},t.lidPnMappingRemoveDisplayName=function(){return(0,r.getStorage)().versions.version(95)},t.messageAddActionLink=function(){return(0,r.getStorage)().versions.version(72)},t.messageAddDisappearingModeInitiator=function(){return(0,r.getStorage)().versions.version(37)},t.messageAddGroupInviteV4=function(){return(0,r.getStorage)().versions.version(38)},t.messageAddHeaderType=function(){return(0,r.getStorage)().versions.version(74)},t.messageAddInteractiveMessageFields=function(){return(0,r.getStorage)().versions.version(69)},t.messageAddIsSendFailureProperties=function(){return(0,r.getStorage)().versions.version(27)},t.messageAddNativeFlowNameField=function(){return(0,r.getStorage)().versions.version(54)},t.messageAddPaymentBackground=function(){return(0,r.getStorage)().versions.version(68)},t.messageAddPaymentInviteServiceType=function(){return(0,r.getStorage)().versions.version(64)},t.messageAddPaymentRequestNFMFields=function(){return(0,r.getStorage)().versions.version(49)},t.messageAddPaymentTxnStatus=function(){return(0,r.getStorage)().versions.version(29)},t.messageAddPrivacyModeFields=function(){return(0,r.getStorage)().versions.version(32)},t.messageAddProductListPreviewHeaderImage=function(){return(0,r.getStorage)().versions.version(34)},t.messageAddProductListPreviewInfo=function(){return(0,r.getStorage)().versions.version(30)},t.messageCreateTable=function(){return(0,r.getStorage)().versions.version(7)},t.messageInfoAddDeliveryPrivacyMode=function(){return(0,r.getStorage)().versions.version(33)},t.messageInfoCreateTable=function(){return(0,r.getStorage)().versions.version(8)},t.messageOrphansAddColumns=function(){return(0,r.getStorage)().versions.version(97)},t.messageOrphansCreateTable=function(){return(0,r.getStorage)().versions.version(92)},t.messageRemovePaymentRequestHeaderField=function(){return(0,r.getStorage)().versions.version(52)},t.messageStatusPSAReadTimestamp=function(){return(0,r.getStorage)().versions.version(76)},t.migrateSubgroupsArray=function(){return(0,r.getStorage)().versions.version(80)},t.missingKeysCreateTable=function(){return(0,r.getStorage)().versions.version(26)},t.orphanPaymentNotificationCreateTable=function(){return(0,r.getStorage)().versions.version(40)},t.orphanReceiptCreateTable=function(){return(0,r.getStorage)().versions.version(10)},t.orphanRevokeCreateTable=function(){return(0,r.getStorage)().versions.version(47)},t.orphanTcTokenCreateTable=function(){return(0,r.getStorage)().versions.version(89)},t.participantCreateTable=function(){return(0,r.getStorage)().versions.version(9)},t.paymentBackgroundsCreateTable=function(){return(0,r.getStorage)().versions.version(79)},t.peerMessageCreateTable=function(){return(0,r.getStorage)().versions.version(43)},t.pendingMutationsCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.pollVotesCreateTable=function(){return(0,r.getStorage)().versions.version(91)},t.privacyDisallowedListAddDhashField=function(){return(0,r.getStorage)().versions.version(67)},t.privacyDisallowedListCreateTable=function(){return(0,r.getStorage)().versions.version(58)},t.profilePicThumbCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.quickReplyCreateTable=function(){return(0,r.getStorage)().versions.version(18)},t.reactionsCreateTable=function(){return(0,r.getStorage)().versions.version(66)},t.recentStickersCreateTable=function(){return(0,r.getStorage)().versions.version(53)},t.removeSpamColumnsInGroupMetadata=function(){return(0,r.getStorage)().versions.version(87)},t.removeUnjoinedSubgroups=function(){return(0,r.getStorage)().versions.version(83)},t.renameCommunityAdminPromotionColumns=function(){return(0,r.getStorage)().versions.version(96)},t.subscriptionCreateTable=function(){return(0,r.getStorage)().versions.version(85)},t.syncActionsCreateTable=function(){return(0,r.getStorage)().versions.version(2)},t.syncKeysCreateTable=function(){return(0,r.getStorage)().versions.version(21)},t.tasksScheduledTimeCreateTable=function(){return(0,r.getStorage)().versions.version(22)},t.unjoinedSubgroupMetadataCreateTable=function(){return(0,r.getStorage)().versions.version(81)},t.unjoinedSubgroupParentGroupIndex=function(){return(0,r.getStorage)().versions.version(86)},t.userPrefsCreateTable=function(){return(0,r.getStorage)().versions.version(93)},t.verifiedBusinessNameAddPrivacyMode=function(){return(0,r.getStorage)().versions.version(31)},t.verifiedBusinessNameCreateTable=function(){return(0,r.getStorage)().versions.version(13)};var r=n(799069)},446308:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addUserToPendingDeviceSync=function(e){if((0,a.isMDBackend)())return(0,s.getTable)().bulkCreateOrMerge(e.map((e=>({id:e}))));return Promise.resolve()},t.doPendingDeviceSync=function(){return l.apply(this,arguments)};var i=r(n(348926)),a=n(88555),o=n(745454),s=n(212071);function l(){return(l=(0,i.default)((function*(){if((0,a.isMDBackend)())try{const e=yield(0,s.getTable)().all(),t=n(550111).syncDeviceListJob;yield t(e.map((e=>(0,o.createWid)(e.id))),null,null),yield(0,s.getTable)().bulkRemove(e.map((e=>e.id)))}catch(e){__LOG__(4,!0,new Error)`doPendingDeviceSync failed during RESUME_WITH_OPEN_TAB`}yield Promise.resolve()}))).apply(this,arguments)}},685417:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,c.destroyStorage)().catch((()=>i.default.resolve(new u.default(c.DATABASE_NAME).delete()))).finally((()=>{d=null}))},t.initialize=function(){null==d&&((0,c.createStorage)(),(0,l.addTable)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),d=(0,c.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize offd storage"),e})));return d};var i=r(n(74121)),a=n(93771),o=n(578956),s=n(212071),l=n(533235),c=n(843950),u=r(n(986128));let d},93771:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("dangling-receipt").version((0,o.getStorage)().versions.version(1),[new a.default("id"),new i.default("receipts")]).view((e=>({id:e.id,receipts:e.receipts})))},t.getTable=function(){return(0,o.getStorage)().table("dangling-receipt")};var i=r(n(743960)),a=r(n(581019)),o=n(843950)},578956:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("peer-read-receipt").version((0,o.getStorage)().versions.version(2),[new a.default("id"),new i.default("msgKeys"),new i.default("ts"),new i.default("ack")]).view((e=>({id:e.id,ts:e.ts,msgKeys:e.msgKeys,ack:e.ack})))},t.getTable=function(){return(0,o.getStorage)().table("peer-read-receipt")};var i=r(n(743960)),a=r(n(581019)),o=n(843950)},212071:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,a.getStorage)().add("pending-device-sync").version((0,a.getStorage)().versions.version(4),[new i.default("id")]).view((e=>({id:e.id})))},t.getTable=function(){return(0,a.getStorage)().table("pending-device-sync")};var i=r(n(680982)),a=n(843950)},533235:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("read-receipt").version((0,o.getStorage)().versions.version(0),[new a.default("id"),new i.default("externalIds")]).delete((0,o.getStorage)().versions.version(3)).view((e=>({id:e.id,externalIds:e.externalIds})))},t.getTable=function(){return(0,o.getStorage)().table("read-receipt")};var i=r(n(743960)),a=r(n(680982)),o=n(843950)},843950:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new i.default(c);u=new a.Storage(e),u.addErrorHandler(s.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&o.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==u)return Promise.reject(new Error("[offd-storage] Storage should be created first before being destroyed"));return u.purge().then((()=>{u=null})).catch((e=>{throw u=null,e}))},t.getStorage=function(){return(0,l.default)(null!=u,"[offd-storage] Storage should be created first before being accessed"),u};var i=r(n(15378)),a=n(94899),o=n(123918),s=r(n(986128)),l=r(n(441143));const c="offd-storage";t.DATABASE_NAME=c;let u=null},546983:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.updatePeerReceipts=function(){return y.apply(this,arguments)};var i=r(n(81109)),a=r(n(348926)),o=n(252230),s=n(227101),l=n(535470),c=n(88555),u=n(237540),d=n(408139),p=r(n(465212)),f=n(837398),_=n(578956),h=n(290981),g=n(672821),m=n(799069);function y(){return(y=(0,a.default)((function*(){if((0,c.isMDBackend)()){const e=yield(0,_.getTable)().all(),t=[],n=[];e.forEach((e=>{e.ack===l.ACK.READ?t.push(e):e.ack===l.ACK.PLAYED?n.push(e):__LOG__(3)`updatePeerReceipts: unknown ack type: ${e.ack}`}));const{chatUpdates:r,ackUpdates:a,reactionUpdates:o}=yield S(t),s=new Map(a.map((e=>[e.id,e])));v(n).forEach((e=>{const t=s.get(e.id);null==t?s.set(e.id,e):s.set(e.id,(0,i.default)((0,i.default)({},t),{},{ack:e.ack}))}));const c=Array.from(s.values());if(yield(0,m.getStorage)().lock(["message","chat"],(e=>{let[t,n]=e;return Promise.all([t.bulkCreateOrMerge(c),n.bulkCreateOrMerge(r)])})),(0,d.receiveReactionsEnabled)()&&o.length>0){const e=o.map((e=>p.default.fromString(e)));yield(0,f.markReactionsAsReadByMessageKeys)(e)}return(0,_.getTable)().clear()}return Promise.resolve()}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,a.default)((function*(e){const t=new Set(e.flatMap((e=>e.msgKeys)));const n=function(e){return new Map(e.flatMap((e=>e.msgKeys)).map(_).filter((e=>e!==o.STATUS_JID)).map((e=>[e,{unreadCount:0,lastUnreadMsgRowId:void 0,unreadMentionsOfMe:[],unreadMentionCount:0}])))}(e),r=Array.from(n.keys()),i=yield(0,h.getTable)().anyOf(["from","pendingReadReceipt"],r.map((e=>[e,1])),{shouldDecrypt:!1});i.forEach((e=>function(e,n){const{rowId:r,id:i}=n;if(null==e||null==r)return;t.has(i)&&(null==e.lastUnreadMsgRowId||r>e.lastUnreadMsgRowId)&&(e.lastUnreadMsgRowId=r)}(n.get(e.from),e))),i.forEach((e=>function(e,t){const{rowId:n}=t;if(null==e||null==n||null==e.lastUnreadMsgRowId)return;if(n>e.lastUnreadMsgRowId&&(e.unreadCount+=1,(0,s.isGroupCatchUpEnabled)()&&(0,u.isImportantMessage)(t))){const n={id:t.id,timestamp:t.t};e.unreadMentionsOfMe.push(n)}}(n.get(e.from),e)));const c=i.flatMap((e=>{const{rowId:t}=e,r=n.get(e.from);return null==r||null==t||null==r.lastUnreadMsgRowId?[]:t<=r.lastUnreadMsgRowId?[{id:e.id,ack:l.ACK.READ,pendingReadReceipt:null}]:[]})).concat((f=t,Array.from(f).filter((e=>_(e)===o.STATUS_JID)).map((e=>({id:e,ack:l.ACK.READ})))));var f;return{chatUpdates:r.map((e=>{const t=n.get(e);return null!=t&&null!=t.lastUnreadMsgRowId?{id:e,unreadCount:t.unreadCount,unreadMentionsOfMe:t.unreadMentionsOfMe}:null})).filter(Boolean),ackUpdates:c,reactionUpdates:yield function(){return m.apply(this,arguments)}(t)};function _(e){return p.default.fromString(e).remote.toString()}function m(){return(m=(0,a.default)((function*(e){return(0,d.receiveReactionsEnabled)()?(yield(0,g.getTable)().anyOf(["msgKey"],Array.from(e))).map((e=>e.msgKey)):Promise.resolve([])}))).apply(this,arguments)}}))).apply(this,arguments)}function v(e){const t=new Set;return e.forEach((e=>{e.ack===l.ACK.PLAYED&&e.msgKeys.forEach((e=>t.add(e)))})),Array.from(t).map((e=>({id:e,ack:l.ACK.PLAYED,pendingReadReceipt:null})))}},663719:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.add=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,o.getABKey)()||"abkey";p=p.concat(e.map(_(t))),f()},t.clear=function(){return v.apply(this,arguments)},t.deleteRange=T,t.getFromBottom=m,t.rowCount=S;var i=r(n(348926)),a=r(n(823493)),o=n(464358),s=n(382828),l=n(294398),c=n(294398);const u=1e5,d=parseInt("387902353",10)||0;let p=[];const f=(0,a.default)((()=>b()),200);function _(e){return function(t){return function(e,t){return{marker_id:e.marker_id,method:e.method,action_id:e.action_id,duration_ns:e.duration_ns,marker_type:e.marker_type,sample_rate:e.sample_rate,points:e.points,instance_id:e.instance_id,metadata:e.metadata||{application_analytics:{time_since_qpl_module_init:0}},flags:e.flags,annotations_bool_array:e.annotations_bool_array,annotations_bool:e.annotations_bool,annotations_double_array:e.annotations_double_array,annotations_double:e.annotations_double,annotations_int_array:e.annotations_int_array,annotations_int:e.annotations_int,annotations_string_array:e.annotations_string_array,annotations:e.annotations,app_version:"2.2228.14",app_build_number:d,wa_ab_key2:t}}(t,e)}}function h(){return g.apply(this,arguments)}function g(){return(g=(0,i.default)((function*(){try{yield(0,l.initialize)()}catch(e){throw __LOG__(4,!0,new Error,!0)`QPL Storage, error calling initializeQplStorage, error ${e}`,SEND_LOGS("QPL Storage init error"),e}}))).apply(this,arguments)}function m(){return y.apply(this,arguments)}function y(){return(y=(0,i.default)((function*(e){return yield h(),(0,c.getQplEventsTable)().all({limit:e,offset:0})}))).apply(this,arguments)}function S(){return E.apply(this,arguments)}function E(){return(E=(0,i.default)((function*(){return yield h(),(0,c.getQplEventsTable)().count()}))).apply(this,arguments)}function v(){return(v=(0,i.default)((function*(){return yield h(),(0,c.getQplEventsTable)().clear(!0)}))).apply(this,arguments)}function T(){return C.apply(this,arguments)}function C(){return(C=(0,i.default)((function*(e,t){return yield h(),(0,c.getQplEventsTable)().bulkDeleteRange(["id"],e-1,t+1).then((()=>{}))}))).apply(this,arguments)}let A=null;function b(){return P.apply(this,arguments)}function P(){return(P=(0,i.default)((function*(){if(yield h(),A)A.then(b);else if(p.length>0){const e=p;p=[];try{const t=yield S();if(t+e.length>u){(0,s.maxStorageEventCountReached)();const n=t+e.length-u;yield O(n)}}catch(e){return __LOG__(4,!0,new Error,!0)`QPL Storage, error during checking for excessive events ${e}`,void SEND_LOGS("QPL Storage, error saving events")}A=(0,c.getQplEventsTable)().bulkCreate(e).then((()=>{A=null})).catch((e=>{__LOG__(4,!0,new Error,!0)`QPL Storage, error saving events ${e}`,SEND_LOGS("QPL Storage, error saving events"),A=null}))}}))).apply(this,arguments)}function O(){return M.apply(this,arguments)}function M(){return(M=(0,i.default)((function*(e){const t=yield m(e),n=t[0].id||0,r=t[t.length-1].id||0;yield T(n,r)}))).apply(this,arguments)}},294398:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,o.destroyStorage)().catch((()=>i.default.resolve(new s.default(o.DATABASE_NAME).delete()))).finally((()=>{l=null}))},Object.defineProperty(t,"getQplEventsTable",{enumerable:!0,get:function(){return a.getTable}}),t.initialize=function(){null==l&&((0,o.createStorage)(),(0,a.addTable)(),l=(0,o.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize qpl storage"),e})));return l};var i=r(n(74121)),a=n(704882),o=n(196367),s=r(n(986128));let l},704882:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("qpl-events").version((0,s.qplEventsCreateTable)(),[new a.default("id"),new i.default("marker_id"),new i.default("instance_id"),new i.default("action_id"),new i.default("sample_rate"),new i.default("method"),new i.default("duration_ns"),new i.default("points"),new i.default("metadata"),new i.default("marker_type"),new i.default("flags"),new i.default("annotations"),new i.default("annotations_double"),new i.default("annotations_int"),new i.default("annotations_bool"),new i.default("annotations_string_array"),new i.default("annotations_double_array"),new i.default("annotations_int_array"),new i.default("annotations_bool_array"),new i.default("app_version"),new i.default("app_build_number"),new i.default("wa_ab_key2")]).view((e=>e))},t.getTable=function(){return(0,o.getStorage)().table("qpl-events")};var i=r(n(743960)),a=r(n(581019)),o=n(196367),s=n(951542)},196367:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new i.default(c);u=new a.Storage(e),u.addErrorHandler(s.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&o.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==u)return Promise.reject(new Error("[qpl-storage] Storage should be created first before being destroyed"));return u.purge().then((()=>{u=null})).catch((e=>{throw u=null,e}))},t.getStorage=function(){return(0,l.default)(null!=u,"[qpl-storage] Storage should be created first before being accessed"),u};var i=r(n(15378)),a=n(94899),o=n(123918),s=r(n(986128)),l=r(n(441143));const c="qpl-storage";t.DATABASE_NAME=c;let u=null},951542:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qplEventsCreateTable=function(){return(0,r.getStorage)().versions.version(0)};var r=n(196367)},400318:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.destroy=function(){return(0,p.destroyStorage)().catch((()=>i.default.resolve(new f.default(p.DATABASE_NAME).delete()))).finally((()=>{_=null}))},Object.defineProperty(t,"getBaseKeyTable",{enumerable:!0,get:function(){return a.getTable}}),Object.defineProperty(t,"getIdentityTable",{enumerable:!0,get:function(){return o.getTable}}),Object.defineProperty(t,"getMetaTable",{enumerable:!0,get:function(){return s.getTable}}),Object.defineProperty(t,"getPreKeyTable",{enumerable:!0,get:function(){return l.getTable}}),Object.defineProperty(t,"getSenderKeyTable",{enumerable:!0,get:function(){return c.getTable}}),Object.defineProperty(t,"getSessionTable",{enumerable:!0,get:function(){return u.getTable}}),Object.defineProperty(t,"getSignedPreKeyTable",{enumerable:!0,get:function(){return d.getTable}}),t.initialize=function(){null==_&&((0,p.createStorage)(),(0,a.addTable)(),(0,o.addTable)(),(0,s.addTable)(),(0,l.addTable)(),(0,c.addTable)(),(0,u.addTable)(),(0,d.addTable)(),_=(0,p.getStorage)().initialize().catch((e=>{throw __LOG__(4,!0,new Error,!0)`Assertion failed!`,SEND_LOGS("Failed to initialize signal storage"),e})));return _};var i=r(n(74121)),a=n(550930),o=n(135523),s=n(880919),l=n(764415),c=n(306259),u=n(601777),d=n(945726),p=n(677246),f=r(n(986128));let _},550930:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("baseKey-store").version((0,l.baseKeyCreateTable)(),[new o.default("id"),new i.default("address"),new i.default("originalMsgId"),new i.default("baseKey"),new a.default(["address","originalMsgId"])]).view((e=>({id:e.id,address:e.address,originalMsgId:e.originalMsgId,baseKey:e.baseKey})))},t.getTable=function(){return(0,s.getStorage)().table("baseKey-store")};var i=r(n(743960)),a=r(n(361309)),o=r(n(581019)),s=n(677246),l=n(112126)},135523:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("identity-store").version((0,s.identityCreateTable)(),[new a.default("identifier"),new i.default("identityKey"),new i.default("rowId")]).view((e=>({identifier:e.identifier,identityKey:e.identityKey,rowId:e.rowId})))},t.getTable=function(){return(0,o.getStorage)().table("identity-store")};var i=r(n(743960)),a=r(n(680982)),o=n(677246),s=n(112126)},880919:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("signal-meta-store").version((0,s.metaCreateTable)(),[new a.default("key"),new i.default("value")]).view((e=>({key:e.key,value:e.value})))},t.getTable=function(){return(0,o.getStorage)().table("signal-meta-store")};var i=r(n(743960)),a=r(n(680982)),o=n(677246),s=n(112126)},764415:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("prekey-store").version((0,s.preKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("isDirectDistribution")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,isDirectDistribution:e.isDirectDistribution})))},t.getTable=function(){return(0,o.getStorage)().table("prekey-store")};var i=r(n(743960)),a=r(n(581019)),o=n(677246),s=n(112126)},306259:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,s.getStorage)().add("senderkey-store").version((0,l.senderKeyCreateTable)(),[new o.default("senderKeyName"),new i.default("senderKey"),new i.default("senderId"),new a.default("senderId")]).view((e=>({senderKeyName:e.senderKeyName,senderKey:e.senderKey,senderId:e.senderId})))},t.getTable=function(){return(0,s.getStorage)().table("senderkey-store")};var i=r(n(743960)),a=r(n(998125)),o=r(n(680982)),s=n(677246),l=n(112126)},601777:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("session-store").version((0,s.sessionCreateTable)(),[new a.default("address"),new i.default("session")]).view((e=>({address:e.address,session:e.session})))},t.getTable=function(){return(0,o.getStorage)().table("session-store")};var i=r(n(743960)),a=r(n(680982)),o=n(677246),s=n(112126)},945726:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.addTable=function(){(0,o.getStorage)().add("signed-prekey-store").version((0,s.signedPreKeyCreateTable)(),[new a.default("keyId"),new i.default("keyPair"),new i.default("signature")]).view((e=>({keyId:e.keyId,keyPair:e.keyPair,signature:e.signature})))},t.getTable=function(){return(0,o.getStorage)().table("signed-prekey-store")};var i=r(n(743960)),a=r(n(581019)),o=n(677246),s=n(112126)},677246:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.DATABASE_NAME=void 0,t.createStorage=function(){const e=new i.default(c);u=new a.Storage(e),u.addErrorHandler(s.default.AbortError,(e=>{e.message.includes("QuotaExceededError")&&o.StorageCmd.trigger("storage_not_enough_space")}))},t.destroyStorage=function(){if(null==u)return Promise.reject(new Error("[signal-storage] Storage should be created first before being destroyed"));return u.purge().then((()=>{u=null})).catch((e=>{throw u=null,e}))},t.getStorage=function(){return(0,l.default)(null!=u,"[signal-storage] Storage should be created first before being accessed"),u};var i=r(n(15378)),a=n(94899),o=n(123918),s=r(n(986128)),l=r(n(441143));const c="signal-storage";t.DATABASE_NAME=c;let u=null},112126:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.baseKeyCreateTable=function(){return(0,r.getStorage)().versions.version(5)},t.identityCreateTable=function(){return(0,r.getStorage)().versions.version(0)},t.metaCreateTable=function(){return(0,r.getStorage)().versions.version(1)},t.preKeyCreateTable=function(){return(0,r.getStorage)().versions.version(2)},t.senderKeyCreateTable=function(){return(0,r.getStorage)().versions.version(6)},t.sessionCreateTable=function(){return(0,r.getStorage)().versions.version(3)},t.signedPreKeyCreateTable=function(){return(0,r.getStorage)().versions.version(4)};var r=n(677246)},624256:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.ENC_KEY_TTL=t.ENC_KEY_TABLE_NAME=t.ENC_KEY_DB_NAME=t.DbEncKeyStore=t.DB_ENCRYPTION_CIPHER=void 0;var i=r(n(81109)),a=r(n(348926)),o=n(615688),s=n(88156),l=r(n(74121)),c=n(892844),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=f(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=i?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}r.default=e,n&&n.set(e,r);return r}(n(435232)),d=r(n(986128)),p=r(n(441143));function f(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(f=function(e){return e?n:t})(e)}const _="wawc_db_enc";t.ENC_KEY_DB_NAME=_;const h="keys";t.ENC_KEY_TABLE_NAME=h;const g={name:"HKDF"},m={hash:"SHA-256"},y=4*c.WEEK_MILLISECONDS*24;t.ENC_KEY_TTL=y;const S="fts_hmac_keys",E="AES-CBC";t.DB_ENCRYPTION_CIPHER=E;function v(){const e=new Uint8Array(128);return self.crypto.getRandomValues(e),self.crypto.subtle.importKey("raw",e,g,!1,["deriveKey"])}const T=new class{constructor(){var e=this;this._waitUntilFinalDbEncKeyReady=new s.Resolvable,this._waitUntilEncKeyReady=new s.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new s.Resolvable,this._getOrUpdateEncKeys=e=>this._getDbOrThrow().keys.orderBy("id").toArray().then((t=>{if(!t||0===t.length)return this._addNewEncKey(e);const n=t[t.length-1]._expiration;if(null!=n&&n<=(new Date).getTime())return this._addNewEncKey(e);this._ephemeralLocalEncSalt=e;const r=t.map(function(){var t=(0,a.default)((function*(t){const n=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:e,info:new Uint8Array(1)}),t.key,{name:E,length:128},!1,["encrypt","decrypt"]);return(0,i.default)((0,i.default)({},t),{},{key:n})}));return function(){return t.apply(this,arguments)}}());return Promise.all(r).then((e=>{this._keys=e,this._waitUntilEncKeyReady.resolve()}))})),this._getOrUpdateFtsKey=()=>this._getDbOrThrow().fts_hmac_keys.orderBy("id").toArray().then((e=>{if(!e||0===e.length)return this._addNewFtsHMACKey();if(e.length>1)throw new u.DBInvalidFtsHMACKey;this._ftsHMACKey=e[e.length-1]})),this._addNewEncKey=e=>v().then((t=>this._getDbOrThrow().keys.add({key:t,_expiration:(new Date).getTime()+y}).then((()=>this._getOrUpdateEncKeys(e))))),this._addNewFtsHMACKey=()=>v().then((e=>this._getDbOrThrow().fts_hmac_keys.add({key:e}).then((()=>this._getOrUpdateFtsKey())))),this.generateFinalDbEncryptionAndFtsKey=e=>{if(null!=this._finalDbMsgEncKeys||null==this._ephemeralLocalEncSalt)return Promise.resolve();const t=(0,o.decodeB64)(e);return this._generateFinalFtsHmacKey(t),this._generateFinalDbMsgEncryptionKey(t),Promise.resolve()},this._generateFinalDbMsgEncryptionKey=t=>this._getDbOrThrow().keys.orderBy("id").toArray().then((n=>{const r=n.map(function(){var n=(0,a.default)((function*(n){let r;(0,p.default)(null!=e._ephemeralLocalEncSalt,"local salt is undefined");try{r=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:t,info:new Uint8Array(e._ephemeralLocalEncSalt||0)}),n.key,{name:E,length:128},!1,["encrypt","decrypt"])}catch(t){throw e._ephemeralLocalEncSalt=null,t}return(0,i.default)((0,i.default)({},n),{},{key:r})}));return function(){return n.apply(this,arguments)}}());return Promise.all(r).then((e=>{this._ephemeralLocalEncSalt=null,this._finalDbMsgEncKeys=e,this._waitUntilFinalDbEncKeyReady.resolve()}))})).finally((()=>{this._ephemeralLocalEncSalt=null})),this._generateFinalFtsHmacKey=function(){var t=(0,a.default)((function*(t){if(!e._ftsHMACKey||null==e._ftsHMACKey.key||null==e._ftsHMACKey.id)throw __LOG__(2)`Base ftsHMACKey is null in _generateFinalFtsHmacKey`,new u.DBInvalidFtsHMACKey;const[n,r]=[e._ftsHMACKey.id,e._ftsHMACKey.key],a=yield self.crypto.subtle.deriveKey((0,i.default)((0,i.default)((0,i.default)({},g),m),{},{salt:t,info:new Uint8Array(0)}),r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);e._finalFtsHmacKey={id:n,key:a},e._waitUntilFinalFtsHmacKeyReady.resolve()}));return function(){return t.apply(this,arguments)}}()}init(e){if(this._db)return l.default.resolve();this._db=new d.default(_),this._getDbOrThrow().version(1).stores({[h]:"++id, _expirtation",[S]:"++id"}),this._getDbOrThrow().version(2).stores({[h]:"++id",[S]:"++id"});const t=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);return l.default.resolve(this._getDbOrThrow().open()).then((()=>Promise.all([this._getOrUpdateEncKeys(t),this._getOrUpdateFtsKey()])))}_getDbOrThrow(){if(null==this._db)throw new Error("[db_encryption_key] db is not initialized");return this._db}deleteKeys(){return Promise.all([this._getDbOrThrow().table(h).clear(),this._getDbOrThrow().table(S).clear()]).then((()=>{})).finally((()=>(this._db=null,l.default.resolve(d.default.delete(_)).catch((()=>d.default.delete(_))))))}deleteKeyCache(){this._keys=null,this._ftsHMACKey=null,this._finalDbMsgEncKeys=null,this._waitUntilFinalDbEncKeyReady=new s.Resolvable,this._waitUntilFinalFtsHmacKeyReady=new s.Resolvable,this._waitUntilEncKeyReady=new s.Resolvable,this._finalFtsHmacKey=null,this._ephemeralLocalEncSalt=null}waitForEncKey(){return this._waitUntilEncKeyReady.promise}waitForFinalDbMsgEncKey(){return this._waitUntilFinalDbEncKeyReady.promise}waitForFinalFtsHmacKey(){return this._waitUntilFinalFtsHmacKeyReady.promise}getEncKeys(){if(!this._keys)throw new u.DbEncKeyNotLoaded(h);return this._keys}getDbMsgEncKeys(){if(!this._finalDbMsgEncKeys)throw new u.DbMsgEncKeyNotLoaded(h);return this._finalDbMsgEncKeys}getFtsHMACKey(){if(!this._finalFtsHmacKey)throw new u.DbEncKeyNotLoaded(S);return this._finalFtsHmacKey}};t.DbEncKeyStore=T},477589:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return a.apply(this,arguments)};var i=r(n(348926));function a(){return(a=(0,i.default)((function*(){const e=window.caches;if(null==e)return;const t=yield e.keys();yield Promise.all(t.map((t=>e.delete(t))))}))).apply(this,arguments)}},123918:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.StorageCmdImpl=t.StorageCmd=void 0;var i=r(n(876521));class a extends i.default{}t.StorageCmdImpl=a;const o=new a;t.StorageCmd=o},111554:(e,t,n)=>{"use strict";var r=n(595318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(640265),a=n(450796),o=n(638284),s=n(805558),l=n(26741),c=r(n(11339)),u=r(n(986128)),d=r(n(730381));const p={ERROR:"error",OPENING:"opening",BLOCKED:"blocked",OPEN:"open",CLOSED:"closed",FAILED:"failed"};let f=!1,_=null;function h(){this._dbName=s.WEB_IDB_DB_NAMES.wawc,this._db=new u.default(this._dbName),this._db.on("versionchange",(e=>{this._db.close(),__LOG__(2)`db: close db due to versionchange`,e&&null!=e.newVersion&&e.newVersion!==e.oldVersion&&(f=!0,_&&_())})),this._db.version(1).stores({logs:"line,log"}),this._db.version(2).stores({logs:"line,log",assets:"key,hash,data"}),this._db.version(3).stores({logs:"line,log",assets:"key,hash,data",wam:",buffer,prevValues,lastSend"}),this._db.version(4).stores({logs:"line,log",assets:"key,hash,data",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((function(e){e.wam.toCollection().modify((function(e){e.key=e.lastSend,delete e.prevValues,delete e.lastSend}))})),this._db.version(5).stores({logs:"line,log",assets:null,wam:",key,buffer",l10n:"key,hash,t"}),this._db.version(6).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t"}).upgrade((e=>{e.logs.toCollection().count().then((()=>{e.logs.toCollection().modify((e=>{const{log:t}=e;e.timestamp=1e3*(0,d.default)(t.slice(5,28),"YYYY-MM-DD HH:mm:ss.SSS").unix()}))}))})),this._db.version(7).stores({logs:"line,log,timestamp",wam:",key,buffer",l10n:"key,hash,t",user:"key"}),this._db.version(8).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",l10n:"key,hash,t",user:"key"}).upgrade((e=>{e.wam.toCollection().modify((e=>{e.channel="regular"}))})),this._db.version(9).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",l10n:"key,hash,t",user:"key"}),this._db.version(10).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",ps_meta:"key, value, rotateInDays, lastRotationTimeUtc",ps_tokens:"key",l10n:"key,hash,t",user:"key"}),this._db.version(11).stores({logs:"line,log,timestamp",wam:",key,buffer,channel",wam_meta:"streamId,seqNum",ps_meta:"key, value, rotateInDays, lastRotationTimeUtc",ps_tokens:"key",l10n:"key,hash,t",user:"key",core_wam:"key, streamId",core_wam_meta:"streamId"}),this.openAttempt=0,this.openDB().catch((e=>{__LOG__(3)`openDB failed: ${e}`})),this._dbState=p.OPENING}h.prototype.loadUserIdb=function(){return this.idb().then((e=>e.transaction("rw",e.user,(()=>e.user.toArray().then((e=>e.forEach((e=>{this.permanentStorage.dataStore[e.key]=e.value})))))))).catch((e=>{__LOG__(3)`db:loadUserIdb:Error ${e}`}))},h.prototype.openDB=function(){this._db.isOpen()&&(this._db.close(),__LOG__(2)`db: close db due to duplicate openDB`);const e=(0,o.promiseTimeout)(Promise.resolve(this._db.open()),1e4).then((()=>{__LOG__(2)`db: Successfully opened db`;return new c.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!0,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.OPEN,p.OPEN})).catch((0,a.filteredCatch)(i.TimeoutError,(()=>{__LOG__(2)`db:openDB blocked`;return new c.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),this._dbState=p.BLOCKED,p.BLOCKED}))).catch((e=>{if(__LOG__(3)`db:openDB:Error ${e}`,this.openAttempt>1||l.UA.isSafari){this.opening=void 0,this._dbState=p.ERROR;throw new c.default.WebcDbOpen({webcDbName:this._dbName,webcDbOpenWasSuccess:!1,webcDbOpenNumAttempts:this.openAttempt}).commit(),p.ERROR}return this.openAttempt+=1,this._db.delete().catch((e=>{throw __LOG__(3)`db:deleteDB:Error ${e}`,this.opening=void 0,this._dbState=p.ERROR,p.ERROR})).then((()=>this.openDB()))})).then((e=>{if(this.opening=void 0,e===p.BLOCKED)throw p.BLOCKED;return this._db}));return this.opening||(this.opening=e),e},h.prototype.idb=function(){return this._db.isOpen()?Promise.resolve(this._db):this._db.hasFailed()?(__LOG__(3)`Dexie: database failed to open, hasClosed ${this._db.hasBeenClosed()}`,Promise.reject(new Error(p.FAILED))):this._dbState===p.BLOCKED?(__LOG__(3)`Dexie: database is blocked`,Promise.reject(new Error(p.BLOCKED))):this.opening?this.opening:(__LOG__(3)`Dexie: database is closed`,Promise.reject(new Error(p.CLOSED)))},h.prototype.onVersionChange=function(e){_=e,f&&_()},h.prototype.State=p;var g=new h;t.default=g},364045:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let{error:t}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,i.default)({},null);if(null!=t)return t;return new Error(e)};var i=r(n(73982))},757538:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=Object.freeze({BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222});t.default=n},94474:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(r(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(let a=0;a<i.length;a++)if(!n.call(t,i[a])||!r(e[i[a]],t[i[a]]))return!1;return!0};const n=Object.prototype.hasOwnProperty;function r(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}},215206:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};for(const[n,r]of(0,i.default)(e))null!=r&&(t[n]=r);return t};var i=r(n(289916))},289916:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return Object.entries(e)}},566919:(e,t,n)=>{"use strict";var r=n(307914);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};if(!(e instanceof Object)||Array.isArray(e))throw(0,i.default)("keyMirror(...): Argument must be an object.","comet_infra");for(const n in e)e.hasOwnProperty(n)&&(t[n]=n);return t};var i=r(n(364045))},357291:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[];for(const n of e)null!=n&&t.push(n);return t}},629347:(e,t,n)=>{e.exports=n.p+"img/bg-chat-tile-dark_a4be512e7195b6b733d9110b408f075d.png"},833557:(e,t,n)=>{e.exports=n.p+"img/bg-chat-tile-light_04fcacde539c58cca6745483d4858c52.png"},731213:(e,t,n)=>{e.exports=n.p+"img/f00_50f7c47f611e65a746f1d8328172af4c.png"},8750:(e,t,n)=>{e.exports=n.p+"img/f01_3d1e81d38917ed4427168024350d8df6.png"},448738:(e,t,n)=>{e.exports=n.p+"img/f02_c83a3786caa656cdcea06396bbc6c1fc.png"},415494:(e,t,n)=>{e.exports=n.p+"img/f03_dc76f32180586199d7e1872dd004832c.png"},115885:(e,t,n)=>{e.exports=n.p+"img/f04_f13406e16c2b6a8dda89763cf005b02b.png"},305851:(e,t,n)=>{e.exports=n.p+"img/f05_566b33dfb23660bf5fa83125a9dd8218.png"},568540:(e,t,n)=>{e.exports=n.p+"img/f06_f564cba48589a560af4b6e8408ae1718.png"},930293:(e,t,n)=>{e.exports=n.p+"img/f07_ae76e3caeb9dde2ad18eab0ce141d223.png"},291131:(e,t,n)=>{e.exports=n.p+"img/f08_59c98baa006f5eac6629be0957fd73f2.png"},627879:(e,t,n)=>{e.exports=n.p+"img/f09_1a7f295d0fa98fa1d2a63f8dc4600341.png"},808610:(e,t,n)=>{e.exports=n.p+"img/f10_53c9084de35f9f003ed395e1d120d9b6.png"},132641:(e,t,n)=>{e.exports=n.p+"img/f11_c129c05bc58cad686e0934357d6194fb.png"},398479:(e,t,n)=>{e.exports=n.p+"img/f12_bf90fa5257d34005ad5b75ffebb9b74c.png"},925670:(e,t,n)=>{e.exports=n.p+"img/f13_156bc51d4150b9b257fa4e2e774ce985.png"},500759:(e,t,n)=>{e.exports=n.p+"img/f14_95fa7d926a8cf1638985d3cd551fac31.png"},852264:(e,t,n)=>{e.exports=n.p+"img/f15_454f1add82fcb11fbb4086c8be3b1bd9.png"},686035:(e,t,n)=>{e.exports=n.p+"img/f16_9ca6324f98317f9d73084696719d2b9b.png"},694878:(e,t,n)=>{e.exports=n.p+"img/f17_9376c16fcd9b554de8a081973bebe9aa.png"},267514:(e,t,n)=>{e.exports=n.p+"img/f18_cc883fb28c32b1652826de5dc16feee0.png"},23533:(e,t,n)=>{e.exports=n.p+"img/f19_c448ba8ef94abcf763e25003aa15d27d.png"},586319:(e,t,n)=>{e.exports=n.p+"img/f20_4ebcff229b29e651b73640d0cd8eccb2.png"},365664:(e,t,n)=>{e.exports=n.p+"img/f21_54d02a1f6ad665760923ecfae9c9ff25.png"},310191:(e,t,n)=>{e.exports=n.p+"img/f22_ca38cbb571fbddb6900518455b8a20b9.png"},348850:(e,t,n)=>{e.exports=n.p+"img/f23_851a6d2ec552319ddaac7ff8ff37263e.png"},392553:(e,t,n)=>{e.exports=n.p+"img/f24_7806bc8ea69d9441ff27032fbaf52907.png"},853453:(e,t,n)=>{e.exports=n.p+"img/f25_68d927d9d12aef33387b683be6341340.png"},278691:(e,t,n)=>{e.exports=n.p+"img/f26_eb28a47950f61dc80827a74063d8786a.png"},717430:(e,t,n)=>{e.exports=n.p+"img/f27_d53f3b6cf583d7a41f3434d18fe4456e.png"},640610:(e,t,n)=>{e.exports=n.p+"img/f28_245f3d8d8dae33bdc04373918922c5a8.png"},678643:(e,t,n)=>{e.exports=n.p+"img/f29_31c6170329c4cf5808fe773488b5d143.png"},573434:(e,t,n)=>{e.exports=n.p+"img/f30_105e340803065abb74841ce2fff42b4b.png"},854981:(e,t,n)=>{e.exports=n.p+"img/f31_db46b1350eb553583212866aa44e2ac0.png"},686488:(e,t,n)=>{e.exports=n.p+"img/f32_4c358e4136bab81e06b7fd7171a7908c.png"},728881:(e,t,n)=>{e.exports=n.p+"img/f33_5a8f246313db052d67853a40f77a6427.png"},371199:(e,t,n)=>{e.exports=n.p+"img/f34_8588016a836bc826824d0656c8b7b0bc.png"},97836:(e,t,n)=>{e.exports=n.p+"img/f35_8aefe3b46c378109f0f780b6954e18db.png"},177985:(e,t,n)=>{e.exports=n.p+"img/f36_793fc72fadaf963507fc6802a9470970.png"},173570:(e,t,n)=>{e.exports=n.p+"img/f37_8d8f6653cbe1f6dd3783174a8af618da.png"},642949:(e,t,n)=>{e.exports=n.p+"img/f38_54b8f37e9f1251bfe9a2a2ef88a31912.png"},621404:(e,t,n)=>{e.exports=n.p+"img/f39_23a6e90aa9166a2fb981cc171abe8513.png"},721792:(e,t,n)=>{e.exports=n.p+"img/f40_923f39f07df4b8ad006e1115dcb206ec.png"},986197:(e,t,n)=>{e.exports=n.p+"img/f41_87448793e4bcea7fae3cfa7532e45033.png"},79685:(e,t,n)=>{e.exports=n.p+"img/f42_cd0e42183cff2e75bdde0c139bbb641a.png"},139346:(e,t,n)=>{e.exports=n.p+"img/f43_9f44150edcf010967cf272c80bd4ff14.png"},255878:(e,t,n)=>{e.exports=n.p+"img/f44_7f5d4a3e29f21bd5d5572a1543448949.png"},986904:(e,t,n)=>{e.exports=n.p+"img/f45_04c55805346c4afbc7f8084570a2cd48.png"},186906:(e,t,n)=>{e.exports=n.p+"img/f46_1e9f9b05193093b5d0d80d9c936bcb36.png"},363265:(e,t,n)=>{e.exports=n.p+"img/f47_152a85c5e9ff12d5f85050ecad1d4313.png"},307029:(e,t,n)=>{e.exports=n.p+"img/f48_bd6d89500662b8605997f54027b2e650.png"},139871:(e,t,n)=>{e.exports=n.p+"img/f49_42185158c0bfff92c70f417c74297ce7.png"},58360:(e,t,n)=>{e.exports=n.p+"img/f50_d825d156222c0d93428f4ecd78564c75.png"},535277:(e,t,n)=>{e.exports=n.p+"img/f51_51e116016636d309962001419e70d5f1.png"},163418:(e,t,n)=>{e.exports=n.p+"img/f52_5296e30be9bec98ccf173a9be6e711a9.png"},958235:(e,t,n)=>{e.exports=n.p+"img/f53_f81b7a3702779e190aeefb7e2183e636.png"},333929:(e,t,n)=>{e.exports=n.p+"img/f54_37b3eb612da7ad6c0b20b65e4fdae582.png"},133417:(e,t,n)=>{e.exports=n.p+"img/f55_0c3d912e971e18d6fe8946550262d0e6.png"},150407:(e,t,n)=>{e.exports=n.p+"img/f56_97a65c1c44dced234e0fbb5f78cb277f.png"},629423:(e,t,n)=>{e.exports=n.p+"img/f57_88b41898da1ce86274ee318e1713f437.png"},232176:(e,t,n)=>{e.exports=n.p+"img/f58_56649fe103006ec4fc5bdea5c69f7828.png"},450874:(e,t,n)=>{e.exports=n.p+"img/f59_1dd065a271b58e1ecb9bb3b6c261107f.png"},721578:(e,t,n)=>{e.exports=n.p+"img/f60_4b277b056575663ee9dbf81fecce989e.png"},622129:(e,t,n)=>{e.exports=n.p+"img/f61_ef3fba8c7e6d895afacfb334e7a746ff.png"},433819:(e,t,n)=>{e.exports=n.p+"img/f62_edecb61bfd5cd13895dd8134898d4402.png"},997359:(e,t,n)=>{e.exports=n.p+"img/f63_245e85a3728d5fed6ff9acf1182f4797.png"},239887:(e,t,n)=>{e.exports=n.p+"img/f64_48df8c352924ef1153bb8fd56f5af198.png"},638275:(e,t,n)=>{e.exports=n.p+"img/f65_162b82a8adaf7d2815129f38f265bfb6.png"},471673:(e,t,n)=>{e.exports=n.p+"img/f66_c626c592461087351ad719fa3118959d.png"},621264:(e,t,n)=>{e.exports=n.p+"img/f67_daa263ddff773a14e3ababc4b485a7c9.png"},596007:(e,t,n)=>{e.exports=n.p+"img/f68_ec21f5c8c90ec3bbf634290d6e6025c0.png"},959163:(e,t,n)=>{e.exports=n.p+"img/f69_549a880f1517135abf8914b4cb31fa92.png"},91732:(e,t,n)=>{e.exports=n.p+"img/f70_a69c6599124e3c33d7fac368b07c0249.png"},303913:(e,t,n)=>{e.exports=n.p+"img/f71_4aceb1dc5eaeb5f9cdddf4975e45a841.png"},392293:(e,t,n)=>{e.exports=n.p+"img/f72_f4ed6835609bf3831a20437e8e47d2dc.png"},851577:(e,t,n)=>{e.exports=n.p+"img/f73_94b8b5d2760e6afd967fd74a008cfae0.png"},26347:(e,t,n)=>{e.exports=n.p+"img/f74_2cd31cfe47f05fabb12f9b9f76fc2b6b.png"},170345:(e,t,n)=>{e.exports=n.p+"img/f75_25366bc618fe77d5dfd9db90133f2766.png"},760318:(e,t,n)=>{e.exports=n.p+"img/f76_1347ad29de86f3d0ceb3bf329b06a0a7.png"},186426:(e,t,n)=>{e.exports=n.p+"img/f77_6749eab5d350640476c8ec39ebc3e4db.png"},762002:(e,t,n)=>{e.exports=n.p+"img/f78_9effc679939e4458adafae48294a5db5.png"},349889:(e,t,n)=>{e.exports=n.p+"img/f79_36df3d2cd225fa6b3a6c84c69b72bed1.png"},224324:(e,t,n)=>{e.exports=n.p+"img/f80_f94a52bb981c25a9f8643a55d023be59.png"},959354:(e,t,n)=>{e.exports=n.p+"img/f81_fb74d3d4cc5a27e62e93586c7d09e47e.png"},874992:(e,t,n)=>{e.exports=n.p+"img/f82_2741f2d09772f3e9e836f2c50fb0bf99.png"},780502:(e,t,n)=>{e.exports=n.p+"img/f83_f8586167f3fde3b1e0c7dbb479e5c0ab.png"},74260:(e,t,n)=>{e.exports=n.p+"img/f84_f5b79393aa7e2979b376c76f46d39b52.png"},64108:(e,t,n)=>{e.exports=n.p+"img/f85_7ea40f8452fb838a747fb0881ffd5980.png"},171042:(e,t,n)=>{e.exports=n.p+"img/f86_486fdf332fda50c1cd7c4b9bd8a3f993.png"},795563:(e,t,n)=>{e.exports=n.p+"img/f87_91e88bfc16e4baddaf2fc4f881c3efc5.png"},264594:(e,t,n)=>{e.exports=n.p+"img/f88_286401f05def8a122db7f4686e383691.png"},768005:(e,t,n)=>{e.exports=n.p+"img/f89_658f39d559719b5b6208346f6a7753b9.png"},516888:(e,t,n)=>{e.exports=n.p+"img/f90_d5612bad79e603d92135c3bbfbcd14d1.png"},352943:(e,t,n)=>{e.exports=n.p+"img/f91_58bb429f953c740a98bcab0c032e8e25.png"},324613:(e,t,n)=>{e.exports=n.p+"img/f92_970e0969177b051897bdd55bf12ee3ae.png"},994922:(e,t,n)=>{e.exports=n.p+"img/f93_4776ec98a5d48ae85b24621ad1eac6eb.png"},518725:(e,t,n)=>{e.exports=n.p+"img/f94_296c4ae16a836cf0903cc5ef0476333c.png"},982950:(e,t,n)=>{e.exports=n.p+"img/f95_888ec2f78b312aed756a8d7008dc979b.png"},607251:(e,t,n)=>{e.exports=n.p+"img/f96_5b97286be655dbd4f5aa79f5f008c5ce.png"},617978:(e,t,n)=>{e.exports=n.p+"img/f97_b4ff99d92592c44b5d8a5b501fc24da6.png"},486273:(e,t,n)=>{e.exports=n.p+"img/f98_0922d228059acde80cc489a2879fe864.png"},831666:(e,t,n)=>{e.exports=n.p+"img/f99_c608e2edac2f741a5a39b814ba36c287.png"},715688:(e,t,n)=>{e.exports=n.p+"img/favicon-error_ac2b4ac0b3a8a9d2256d517e69a3e272.png"},372174:(e,t,n)=>{e.exports=n.p+"img/favicon-error2_fb2afa4bfd23495c7bd2555bb080bb35.png"},868431:(e,t,n)=>{e.exports=n.p+"img/favicon_c5088e888c97ad440a61d247596f88e5.png"},795203:(e,t,n)=>{e.exports=n.p+"img/f00_81a748c30861e19178cb90ab8b31c9e4.png"},266574:(e,t,n)=>{e.exports=n.p+"img/f01_78cd893586564a736b94f919cd2851f7.png"},419833:(e,t,n)=>{e.exports=n.p+"img/f02_4bfcfe058a11109e81b7e9cbdfdeb02a.png"},839974:(e,t,n)=>{e.exports=n.p+"img/f03_577fd59324f5db48af17efcba0a23ea5.png"},586727:(e,t,n)=>{e.exports=n.p+"img/f04_841c20c722f90620ba13762ae73f6143.png"},678808:(e,t,n)=>{e.exports=n.p+"img/f05_c1bde74d642126370c5da5fb0de680c6.png"},571258:(e,t,n)=>{e.exports=n.p+"img/f06_eb85be6945aa4a51c3e05d97ecb1c290.png"},464497:(e,t,n)=>{e.exports=n.p+"img/f07_4d1031e781a9619d0579571eb2049ee6.png"},866114:(e,t,n)=>{e.exports=n.p+"img/f08_4d61c3d691066fa829ad43af1d6063ca.png"},212430:(e,t,n)=>{e.exports=n.p+"img/f09_f9d4e1b3266f81e8952251520de80711.png"},729809:(e,t,n)=>{e.exports=n.p+"img/f10_1f2eeb1340d4c4b4d423117d47d5f56e.png"},41191:(e,t,n)=>{e.exports=n.p+"img/f11_699424412fed1628d27e04957a284d2e.png"},887642:(e,t,n)=>{e.exports=n.p+"img/f12_ef4dd9b4bc88503d33fde312a57af7f9.png"},26841:(e,t,n)=>{e.exports=n.p+"img/f13_0bf1895a611a2187f9758ac305e87d2e.png"},307967:(e,t,n)=>{e.exports=n.p+"img/f14_df2ad83835b022116ce26f030de1a13d.png"},338817:(e,t,n)=>{e.exports=n.p+"img/f15_cffc8769d0c2ef7f8f8d5fc16e339cab.png"},965587:(e,t,n)=>{e.exports=n.p+"img/f16_8b958a65cb9dbf5c7716f1c865391473.png"},538297:(e,t,n)=>{e.exports=n.p+"img/f17_83147bc30e9d1cfe9ae417bf4afc2f77.png"},561665:(e,t,n)=>{e.exports=n.p+"img/f18_9595be739a769411763ad68c24cb245f.png"},316962:(e,t,n)=>{e.exports=n.p+"img/f19_2b465cf764fb53292292e003e070268a.png"},942387:(e,t,n)=>{e.exports=n.p+"img/f20_a781e4e7a5b4d97c226843b0f2d1472d.png"},374420:(e,t,n)=>{e.exports=n.p+"img/f21_b03a1e45532edd017ebbda6b8e2566bb.png"},584319:(e,t,n)=>{e.exports=n.p+"img/f22_809ee1be83cf9aba76ecde6bf3e65e58.png"},743302:(e,t,n)=>{e.exports=n.p+"img/f23_e2c0fa78795ee79b68fdbdca50a960ae.png"},834444:(e,t,n)=>{e.exports=n.p+"img/f24_3832927a08d4eec1867a7d7c4ba2fcd7.png"},114231:(e,t,n)=>{e.exports=n.p+"img/f25_0ade03b46b6e8819de9523bc8ff6a7cd.png"},415842:(e,t,n)=>{e.exports=n.p+"img/f26_e38c0e2c62dae55d9cdf26d8c22b6b9d.png"},425925:(e,t,n)=>{e.exports=n.p+"img/f27_b4871a7570313a9f599b1911f339413d.png"},810149:(e,t,n)=>{e.exports=n.p+"img/f28_1b3971aa7b75218570c3d9940aa4a73d.png"},690154:(e,t,n)=>{e.exports=n.p+"img/f29_f2c7a605126e29e8885601cdc65e6aa0.png"},500701:(e,t,n)=>{e.exports=n.p+"img/f30_712d71bfb048818a771a9d144b40d9aa.png"},727707:(e,t,n)=>{e.exports=n.p+"img/f31_1d19e90516ce464192bd7016d05a2dba.png"},695169:(e,t,n)=>{e.exports=n.p+"img/f32_9a70dc1de944f622b350752076a6310d.png"},677763:(e,t,n)=>{e.exports=n.p+"img/f33_1f3382e82a8abe7cdce46f789f7c4ede.png"},898593:(e,t,n)=>{e.exports=n.p+"img/f34_29dc69ea8e91117dae46fcf7e7f58417.png"},716569:(e,t,n)=>{e.exports=n.p+"img/f35_fa478612d2487e2fead293b7005566ea.png"},435807:(e,t,n)=>{e.exports=n.p+"img/f36_bb827e69f0979553e18c0fd1cb192b02.png"},382439:(e,t,n)=>{e.exports=n.p+"img/f37_b06f5850d2c8eda0c51ad5491779af6c.png"},841360:(e,t,n)=>{e.exports=n.p+"img/f38_0b370e976457b876910c4a638ac302e2.png"},493127:(e,t,n)=>{e.exports=n.p+"img/f39_a09d7dfecc70b04ec35edc2967c60a30.png"},162369:(e,t,n)=>{e.exports=n.p+"img/f40_ed134cdcd59bb430218f2be2cdd20aa1.png"},955876:(e,t,n)=>{e.exports=n.p+"img/f41_a785dbfd120b89c2e8616357b9722163.png"},31990:(e,t,n)=>{e.exports=n.p+"img/f42_4149402ff16c6de0b1b06eff01619455.png"},36009:(e,t,n)=>{e.exports=n.p+"img/f43_d543d1bc6a09014ac24d7189b0ced761.png"},924580:(e,t,n)=>{e.exports=n.p+"img/f44_9ffa8beb4bd1c21f328fdd822cba19a7.png"},61400:(e,t,n)=>{e.exports=n.p+"img/f45_0c3cea68945b437380dacd15cbe90ded.png"},578354:(e,t,n)=>{e.exports=n.p+"img/f46_58320ab4676a6287d9dec0790f0d88fc.png"},527020:(e,t,n)=>{e.exports=n.p+"img/f47_5f2ac6f7a9fe79dc3d9a701872c0d0f8.png"},127961:(e,t,n)=>{e.exports=n.p+"img/f48_5fdbdf26d5c581f2a84ebfa50355bd2d.png"},608725:(e,t,n)=>{e.exports=n.p+"img/f49_7bd9cdf5a225ef778b0abd7c9b5310ba.png"},725129:(e,t,n)=>{e.exports=n.p+"img/f50_f4b49b8b3eb729c1fd7c991958aa67b7.png"},933690:(e,t,n)=>{e.exports=n.p+"img/f51_cccd95bad4c9b8e03d05f634e91d2cc8.png"},715722:(e,t,n)=>{e.exports=n.p+"img/f52_8cc8a9757166f53c59a5a1c5e2ebeb00.png"},194416:(e,t,n)=>{e.exports=n.p+"img/f53_623900497390a42269ea6c7ffd812ecc.png"},759965:(e,t,n)=>{e.exports=n.p+"img/f54_c114021c7945464df273df92403987cb.png"},197937:(e,t,n)=>{e.exports=n.p+"img/f55_bcfef9ad8bf26d250613af9b04c918cf.png"},191425:(e,t,n)=>{e.exports=n.p+"img/f56_76dd317a660aa4927e72484ef9d903fb.png"},540564:(e,t,n)=>{e.exports=n.p+"img/f57_72ed0f17ab92bb06761245cb5a7fd73b.png"},335705:(e,t,n)=>{e.exports=n.p+"img/f58_8b9aa917870bcfabc296989c8a810446.png"},422762:(e,t,n)=>{e.exports=n.p+"img/f59_1a64de23c9ec094314b18a18108319ce.png"},405285:(e,t,n)=>{e.exports=n.p+"img/f60_4926d3e8b53f38a3c792cb7b3e07d48d.png"},160792:(e,t,n)=>{e.exports=n.p+"img/f61_08509dff37749613925fe8b16a84ba56.png"},1219:(e,t,n)=>{e.exports=n.p+"img/f62_0869c06452d4ebecdc99f7192ebc702f.png"},266899:(e,t,n)=>{e.exports=n.p+"img/f63_6083f333c2239cba7bbde44e7607a67c.png"},514772:(e,t,n)=>{e.exports=n.p+"img/f64_5d2e1af055fb2cb08326de8e4a844eab.png"},561160:(e,t,n)=>{e.exports=n.p+"img/f65_c863d05c20e4ff179c46170a5311afaf.png"},726671:(e,t,n)=>{e.exports=n.p+"img/f66_1971ad2c6440b2fc909759d8614ef901.png"},618327:(e,t,n)=>{e.exports=n.p+"img/f67_8817a536067dadbc7dc0b1ce0c7cca51.png"},508659:(e,t,n)=>{e.exports=n.p+"img/f68_11393ba2b52ac23a884f923672858aa3.png"},980157:(e,t,n)=>{e.exports=n.p+"img/f69_6a31bf9a0987d546a53d7e8e148d9fa3.png"},214440:(e,t,n)=>{e.exports=n.p+"img/f70_6a12b8c8cf306de335b3174c92c7d63d.png"},90805:(e,t,n)=>{e.exports=n.p+"img/f71_363e1241dbcac22f3bebce9bb5e03e85.png"},439619:(e,t,n)=>{e.exports=n.p+"img/f72_ae6ac1146134ea79656c595a1a2d0e8b.png"},730472:(e,t,n)=>{e.exports=n.p+"img/f73_c9b6d05e598e5adf69ceab85f5db96ac.png"},260325:(e,t,n)=>{e.exports=n.p+"img/f74_67c9ceb4623d37c005ae86e28e4e9fbe.png"},159019:(e,t,n)=>{e.exports=n.p+"img/f75_62cbd93e646a20f624123b595584f2a2.png"},369536:(e,t,n)=>{e.exports=n.p+"img/f76_6862123772ba72af8d1f307c0d2b4895.png"},570577:(e,t,n)=>{e.exports=n.p+"img/f77_78710dcf8b6d89f3951e7887f95408bf.png"},835033:(e,t,n)=>{e.exports=n.p+"img/f78_59e408dc54ae0bd33f3617f7ee9bb2e0.png"},562003:(e,t,n)=>{e.exports=n.p+"img/f79_6682dcc8dd4b1c197e7ec7b9b3deb601.png"},565263:(e,t,n)=>{e.exports=n.p+"img/f80_0d13bdc19570b4c3577062fd0a3a1428.png"},39681:(e,t,n)=>{e.exports=n.p+"img/f81_bfb32e248b9a30d62e32a1f7ea4e7e98.png"},361422:(e,t,n)=>{e.exports=n.p+"img/f82_286f2cdea929dc7b1565aad502aaf165.png"},250966:(e,t,n)=>{e.exports=n.p+"img/f83_4984ad9c5348e8717965f575ac7ea534.png"},860408:(e,t,n)=>{e.exports=n.p+"img/f84_4d4303666006c977553c896dd850fc1b.png"},669738:(e,t,n)=>{e.exports=n.p+"img/f85_10cbc8d1444126f654a032456a74a72c.png"},87724:(e,t,n)=>{e.exports=n.p+"img/f86_03d43f57ad876d0367274524fd27b4ec.png"},93370:(e,t,n)=>{e.exports=n.p+"img/f87_610b9a8f68249032da365af5a664fc41.png"},563963:(e,t,n)=>{e.exports=n.p+"img/f88_5ad6ef9e65165c4bb4c670ce875a5fb5.png"},713976:(e,t,n)=>{e.exports=n.p+"img/f89_e049c6b076ab9212a901406939d7274e.png"},626034:(e,t,n)=>{e.exports=n.p+"img/f90_88c16bdd2fd8228ad1ec89ce3f0cb118.png"},841727:(e,t,n)=>{e.exports=n.p+"img/f91_78d445d5baae7479cac968c11f6724dc.png"},354257:(e,t,n)=>{e.exports=n.p+"img/f92_34f845f9fa2a3667d8d747453f63ad68.png"},61109:(e,t,n)=>{e.exports=n.p+"img/f93_2f324509fe48d002f5a944b003cd180d.png"},402801:(e,t,n)=>{e.exports=n.p+"img/f94_c406ffa6170c14bcbe3158ab7879ce16.png"},811318:(e,t,n)=>{e.exports=n.p+"img/f95_7ce72143c371f981d394ab9b3391f5ea.png"},725889:(e,t,n)=>{e.exports=n.p+"img/f96_bc32095dc9dab040674f58592e10451b.png"},430341:(e,t,n)=>{e.exports=n.p+"img/f97_eedf5849b413d903c4cc72cca6ce0576.png"},351222:(e,t,n)=>{e.exports=n.p+"img/f98_8d47ec83349711222b6d9346049676f1.png"},153279:(e,t,n)=>{e.exports=n.p+"img/f99_d27a48329dde7e88d3d7cd348d745f91.png"},981740:(e,t,n)=>{e.exports=n.p+"img/favicon-error_ef91873fcda4eda22679f675ebf6ed24.png"},605079:(e,t,n)=>{e.exports=n.p+"img/favicon-error2_7ce1b67dbef23e87862b3c12b9b32676.png"},149420:(e,t,n)=>{e.exports=n.p+"img/favicon_94e99ab189284094867d2e1220e42e9f.png"},891672:(e,t,n)=>{e.exports=n.p+"img/icon-group-default_92b8a80d57227e2f342bd57ccf6382d8.png"},210795:(e,t,n)=>{e.exports=n.p+"img/icon-user-default_bfb4ec026499f5b2d80e673a1a3a5bd7.png"},935729:(e,t,n)=>{e.exports=n.p+"img/intro-connection-dark_0ee01153183b5ebd9b296399cc2104b0.jpg"},474548:(e,t,n)=>{e.exports=n.p+"img/intro-connection-hq-dark_f8cb12a6fc73afaf9d5903b7849bebd6.jpg"},412891:(e,t,n)=>{e.exports=n.p+"img/intro-connection-hq-light_9466a20e6d2921a21ac7ab82419be157.jpg"},705250:(e,t,n)=>{e.exports=n.p+"img/intro-connection-light_c98cc75f2aa905314d74375a975d2cf2.jpg"},107246:(e,t,n)=>{e.exports=n.p+"img/qr-video-hq_c001ebd6ddb0ba5fc7de491dfb556024.png"},717818:(e,t,n)=>{e.exports=n.p+"img/qr-video_0c6ec69b054fdeb31cf3e5e10290fd8e.png"},637211:(e,t,n)=>{e.exports=n.p+"notification_2a485d84012c106acef03b527bb54635.mp3"},673727:(e,t,n)=>{e.exports=n.p+"whatsapp-webclient-login-hq_0e0caf2391158ebc09fe32edd1022d03.mp4"},479061:(e,t,n)=>{e.exports=n.p+"whatsapp-webclient-login_c09223f0813e7c3adc16476cba2a5d0d.mp4"},395741:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={"landing-wrapper":"_1-4Rd",landingWrapper:"_1-4Rd","landing-window":"_153VF",landingWindow:"_153VF","landing-main":"v_mws",landingMain:"v_mws","landing-header":"_3J26o",landingHeader:"_3J26o","landing-headerTitle":"e0z5v",landingHeaderTitle:"e0z5v","landing-header-upgradeCompleteText":"_1PEnt",landingHeaderUpgradeCompleteText:"_1PEnt","edge-fix":"sTQ-C",edgeFix:"sTQ-C","landing-icon":"_1qVm2",landingIcon:"_1qVm2","landing-logo":"_2edWd",landingLogo:"_2edWd","landing-title":"_1jAkd",landingTitle:"_1jAkd",headline:"_3BJgQ",listItem:"_1x0Qz",text:"_28IPF",hint:"_3tKX1",qr:"_2ytz1",toggle:"_1xFmQ"}},806357:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={wrapper:"_1ADa8",isQR:"nMnIl",isQr:"nMnIl",draggableHeader:"_2jOS3",isMain:"_3Nsgw"}},785954:(e,t,n)=>{"use strict";n.r(t)},1691:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={"-windows-title-bar-height":"29px",windowsTitleBarHeight:"29px"}},851340:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={container:"Zu0md",containerFull:"_2wJ6P",icon:"_2FjqD",containerCircleIconFull:"_1jy-1",name:"_3gkyZ",labelFilter:"E_3Ky",iconContainer:"yHoVW",drawerTitle:"_1xeSZ",circleIcon:"l_tuI"}},144889:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={button:"_20C5O",plainWhite:"GObVX",primary:"_2Zdgs",secondary:"_1zOyO",solidWarning:"_3opZY",strongPrimary:"pNwLD",warning:"_1XvHd",itemFocused:"_2yKMT",disabled:"_3fyVm",nowrap:"_1gUOr",simplified:"_1RguK",strong:"SEZ8N"}},897922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={noop:"tm2tP"}},408581:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={noop:"i0jNr"}},926306:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={avatar:"_3GlyB",avatarDefault:"_1lPgH",avatarImage:"_8hzr9",isLoaded:"M0JmA",avatarSquare:"_3eYBS",avatarSquircle:"_18q5X",avatarBorder:"_32GIw",avatarProfileRingBorder:"_-1LqN",avatarDefaultAnnouncementGroup:"_2zzR9",inviteModal:"_11T5Z",status_v3:"_1DSb6",statusV3:"_1DSb6",wrapper:"_36VU6",badge:"JUffF",chatList:"Vu6GJ",conversationHeader:"_1FnbI",badgeIcon:"_1D5Hn"}},423257:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={"-emoji-picker-width":"388px",emojiPickerWidth:"388px","-reaction-details-width":"375px",reactionDetailsWidth:"375px",container:"o--vV",reactionDetails:"_3HjyJ",reactionSendTray:"B_YVs",right:"wGJyi",picker:"_3nQGi",tooltip:"_3t1CR",items:"_1HnQz",nib:"_2hkxa",tooltipHighlight:"_156-d",inverse:"QLmve",colorPicker:"fe-ue",emoji:"_3IU7z",sticker:"_1166F",reactionPicker:"_2BB8j",inverseVertical:"_24No0",text:"_3h2j_",attachMenu:"_14ik1"}},919328:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={item:"_2qR8G",text:"_18oo2",hover:"_19zgN",action:"dJxPU",compact:"_3gcnK",icon:"_26nDl",emoji:"_17jhh",emojiGrid:"_34jUG",emojiPreview:"_3-ePY",ellipsify:"_2oldI",disabled:"_3BFHH",shortcut:"_1wMaz"}},677793:(e,t,n)=>{"use strict";n.r(t)},124242:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={wrapper:"_3Xwf5",icon:"_3I5Fs",textWrapper:"_162_t",error:"U_F60",warn:"_2jaWt"}},865301:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={verified:"_3vLho",psa:"_2A4wP",icon:"_1M6Ay",hasLabels:"_3q9s6",labels:"_3dulN"}},480648:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={progress:"_35Zb2"}},671937:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={video:"_3-soo",container:"_1hsvr",player:"_1WD62",poster:"kqpxs",hidden:"_2XlyB",overlay:"_1E40b",button:"_2wAIt",play:"_11Jja"}},866937:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={qrWrapper:"_1N3oL",text:"_2WuPw",qr:"_25pwu",headline:"_3-XoE",list:"_2A31C",listItem:"QtrYx",hint:"_3aF8K",toggle:"_2lolS",tip:"_2jR6Q",rememberMeTip:"w2rV5",codeCopy:"_3YgA3",qrcode:"_2UwZ_",codeLogo:"b77wc",idle:"n4LVt",qrButton:"_2znac",qrButtonIcon:"_1pFa_",groupInviteTip:"_3Egqg",icon:"_30yMe"}},858425:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={"weight-light":"_7qtH8",weightLight:"_7qtH8","weight-normal":"_1lF7t",weightNormal:"_1lF7t","weight-medium":"_3EVTz",weightMedium:"_3EVTz","weight-semibold":"_3VDu5",weightSemibold:"_3VDu5","weight-bold":"_2I4o9",weightBold:"_2I4o9","size-8":"_2Le-W",size8:"_2Le-W","size-9":"_2lMoY",size9:"_2lMoY","size-10":"_3QN-O",size10:"_3QN-O","size-11":"_1uSon",size11:"_1uSon","size-12":"_1MfDb",size12:"_1MfDb","size-13":"_2xTZM",size13:"_2xTZM","size-14":"VWPRY",size14:"VWPRY","size-15":"_3SFxP",size15:"_3SFxP","size-16":"_1FXE6",size16:"_1FXE6","size-17":"_2LoZ-",size17:"_2LoZ-","size-18":"ioBp1",size18:"ioBp1","size-19":"oUgLo",size19:"oUgLo","size-20":"_1ioN3",size20:"_1ioN3","size-22":"Urfuj",size22:"Urfuj","size-24":"_3rp2W",size24:"_3rp2W","size-26":"_1651n",size26:"_1651n","size-28":"_1o3ni",size28:"_1o3ni","size-30":"_3jq2u",size30:"_3jq2u","size-32":"_1Zkh5",size32:"_1Zkh5","size-36":"_2gaDs",size36:"_2gaDs","size-48":"i_P7s",size48:"i_P7s","size-60":"_116zp",size60:"_116zp",title:"_3NUK1",large:"_3WYXy","section-title":"_2MNpf",sectionTitle:"_2MNpf","chat-info-section-title":"x2dsD",chatInfoSectionTitle:"x2dsD","section-title-larger":"_24CNZ",sectionTitleLarger:"_24CNZ",small:"TWzFz",muted:"_3Bg5b","muted-small":"_2gdKz",mutedSmall:"_2gdKz",plain:"_26jM1","popup-title":"wMe6l",popupTitle:"wMe6l","color-accent":"_35orJ",colorAccent:"_35orJ","color-danger":"_2Hpjf",colorDanger:"_2Hpjf","color-dark":"PoW1D",colorDark:"PoW1D","color-primary":"_2cf_G",colorPrimary:"_2cf_G","color-secondary":"AjtLy",colorSecondary:"AjtLy","color-muted":"_2P9Q7",colorMuted:"_2P9Q7","color-success":"_3Vwf8",colorSuccess:"_3Vwf8"}},757312:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={highRes:"_2UdhN",wrapper:"_3R6rC",large:"_3zyju",lowRes:"_2LodA",medium:"_3Ci02",xlarge:"_1xeoG",animation:"KPHJD",invisible:"_1gSQr",heartbeat:"_1jJBG"}},223766:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={image:"_3mSTX",default:"LacDz",icon:"_3TcVw",container:"_1JhMF",hasBorder:"_374fh",dimmed:"Qrclb",hasInnerBorder:"_1HLgI",hasLargeInnerBorder:"_2OuQU",square:"_1avFe",col:"_3UWjv",row:"_3nYfM"}},213702:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={spinner:"_3_EXz"}},791545:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={ul:"_1NDS0",inline:"_3JZr1"}},489613:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={inline:"_3toqL"}},842438:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={container:"_2J8hu"}},324326:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={container:"_1INL_",web:"_1UG2S",containerFixed:"_1iyey",graphic:"_26aja",logo:"_35GDA",dots:"_2pp-n",laptop:"_1JPfm",shimmering:"_1dEQH",shimmer:"_3vobx",initialLoad:"_2FX6G",didYouKnow:"WD35o",logout:"_3iu7m",organizing:"A_WMk",progress:"_30oB1",main:"_2dfCc",secondary:"_2e4Ei",warning:"QgIWN",showWarning:"_3dIM5",dot:"behLh",connecting:"_2VJL-",downloading:"ygjbp"}},179436:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={background:"_2c_rw",mainWrapper:"_5XBCY",logoutTitle:"_329-Z"}},317152:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={backdrop:"_2B4d4",popupContainer:"_3ev9-",popup:"_3J6wB",popupBody:"nne8e",popupTitle:"_1bpDE",backdropCover:"_1QH2G",showOverStatusV3:"_3LIC8",popupContents:"_2Nr6U",popupBox:"_2DOJ8",popupBoxLarge:"_220P7",popupFlex:"_2EOHJ",popupAuto:"_1PdSy",popupControls:"_2i3w0",popupFlexInvite:"_3cUTm",popupFlexInviteNew:"_36f5g",popupFlexUpgrade:"_1jalA",popupTower:"_2ctZG",popupGuide:"_1hMip",popupColumnButtons:"_1Nf9C",popupMultiline:"_37AQP",popupStatusV3ViewerList:"_3jLOW",popupPromote:"_3Kwj9",popupCommandPalette:"_2CV_t",popupQuickReplies:"_1uhDt"}},39326:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={action:"_1WVC6",textTip:"_14jEY",divider:"_1Uvap"}},757525:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={textTip:"_2Z6v5",divider:"_2Xgjp"}},143047:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={suspiciousHostname:"_1xz_9",suspiciousCharacter:"_2x-Eg",explanation:"_3eYuR",url:"_6nRAy"}},321338:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});const r={focusAnimation:"_2BW67",focusAnimationKeyframes:"k4bcw"}},789350:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"opus.74879d30478111ab142c.worker.js")}n.r(t),n.d(t,{default:()=>r})},735474:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"index.81aa4d6bdfbf365cbbde.worker.js")}n.r(t),n.d(t,{default:()=>r})},991528:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"milan.310cb59b4037a323a063.worker.js")}n.r(t),n.d(t,{default:()=>r})},258904:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"WAWebRgbaToWebp.worker.247b6e7ed738757ebedc.worker.js")}n.r(t),n.d(t,{default:()=>r})},926281:(e,t,n)=>{"use strict";function r(){return new Worker(n.p+"WAWebWebpToRgba.worker.0d915335547c9b91ea19.worker.js")}n.r(t),n.d(t,{default:()=>r})},442329:()=>{}},e=>{"use strict";e.O(0,[1174],(()=>{return t=129821,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=https://web.whatsapp.com/bootstrap_qr.bcb4a4e9e67767700178.js.map
